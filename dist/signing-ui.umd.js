(function(wI,b){typeof exports=="object"&&typeof module<"u"?module.exports=b(require("vue"),require("pdfjs-dist")):typeof define=="function"&&define.amd?define(["vue","pdfjs-dist"],b):(wI=typeof globalThis<"u"?globalThis:wI||self,wI.SigningUI=b(wI.Vue,wI.pdfjsLib))})(this,function(vue,pdfjsDist){"use strict";var PC=Object.defineProperty;var BC=wI=>{throw TypeError(wI)};var fC=(wI,b,ZI)=>b in wI?PC(wI,b,{enumerable:!0,configurable:!0,writable:!0,value:ZI}):wI[b]=ZI;var fI=(wI,b,ZI)=>fC(wI,typeof b!="symbol"?b+"":b,ZI),pg=(wI,b,ZI)=>b.has(wI)||BC("Cannot "+ZI);var I=(wI,b,ZI)=>(pg(wI,b,"read from private field"),ZI?ZI.call(wI):b.get(wI)),_=(wI,b,ZI)=>b.has(wI)?BC("Cannot add the same private member more than once"):b instanceof WeakSet?b.add(wI):b.set(wI,ZI),gI=(wI,b,ZI,G)=>(pg(wI,b,"write to private field"),G?G.call(wI,ZI):b.set(wI,ZI),ZI),O=(wI,b,ZI)=>(pg(wI,b,"access private method"),ZI);var bg=(wI,b,ZI,G)=>({set _(R){gI(wI,b,R,ZI)},get _(){return I(wI,b,G)}});function getAugmentedNamespace(wI){if(wI.__esModule)return wI;var b=wI.default;if(typeof b=="function"){var ZI=function G(){return this instanceof G?Reflect.construct(b,arguments,this.constructor):b.apply(this,arguments)};ZI.prototype=b.prototype}else ZI={};return Object.defineProperty(ZI,"__esModule",{value:!0}),Object.keys(wI).forEach(function(G){var R=Object.getOwnPropertyDescriptor(wI,G);Object.defineProperty(ZI,G,R.get?R:{enumerable:!0,get:function(){return wI[G]}})}),ZI}function commonjsRequire(wI){throw new Error('Could not dynamically require "'+wI+'". Please configure the dynamicRequireTargets or/and ignoreDynamicRequires option of @rollup/plugin-commonjs appropriately for this require call to work.')}var pdf={exports:{}};const __viteBrowserExternal={},__viteBrowserExternal$1=Object.freeze(Object.defineProperty({__proto__:null,default:__viteBrowserExternal},Symbol.toStringTag,{value:"Module"})),require$$5=getAugmentedNamespace(__viteBrowserExternal$1);(function(module,exports){(function(b,ZI){module.exports=b.pdfjsLib=ZI()})(globalThis,()=>(()=>{var __webpack_modules__=[,(wI,b)=>{var rI;Object.defineProperty(b,"__esModule",{value:!0}),b.VerbosityLevel=b.Util=b.UnknownErrorException=b.UnexpectedResponseException=b.TextRenderingMode=b.RenderingIntentFlag=b.PromiseCapability=b.PermissionFlag=b.PasswordResponses=b.PasswordException=b.PageActionEventType=b.OPS=b.MissingPDFException=b.MAX_IMAGE_SIZE_TO_CACHE=b.LINE_FACTOR=b.LINE_DESCENT_FACTOR=b.InvalidPDFException=b.ImageKind=b.IDENTITY_MATRIX=b.FormatError=b.FeatureTest=b.FONT_IDENTITY_MATRIX=b.DocumentActionEventType=b.CMapCompressionType=b.BaseException=b.BASELINE_FACTOR=b.AnnotationType=b.AnnotationReplyType=b.AnnotationPrefix=b.AnnotationMode=b.AnnotationFlag=b.AnnotationFieldFlag=b.AnnotationEditorType=b.AnnotationEditorPrefix=b.AnnotationEditorParamsType=b.AnnotationBorderStyleType=b.AnnotationActionEventType=b.AbortException=void 0,b.assert=M,b.bytesToString=bI,b.createValidAbsoluteUrl=P,b.getModificationDate=yI,b.getUuid=JI,b.getVerbosityLevel=j,b.info=r,b.isArrayBuffer=E,b.isArrayEqual=MI,b.isNodeJS=void 0,b.normalizeUnicode=eI,b.objectFromMap=aI,b.objectSize=XI,b.setVerbosityLevel=lI,b.shadow=N,b.string32=YI,b.stringToBytes=sI,b.stringToPDFString=mI,b.stringToUTF8String=NI,b.unreachable=dI,b.utf8StringToString=hI,b.warn=T;const ZI=typeof process=="object"&&process+""=="[object process]"&&!process.versions.nw&&!(process.versions.electron&&process.type&&process.type!=="browser");b.isNodeJS=ZI;const G=[1,0,0,1,0,0];b.IDENTITY_MATRIX=G;const R=[.001,0,0,.001,0,0];b.FONT_IDENTITY_MATRIX=R;const cI=1e7;b.MAX_IMAGE_SIZE_TO_CACHE=cI;const U=1.35;b.LINE_FACTOR=U;const WI=.35;b.LINE_DESCENT_FACTOR=WI;const L=WI/U;b.BASELINE_FACTOR=L;const e={ANY:1,DISPLAY:2,PRINT:4,SAVE:8,ANNOTATIONS_FORMS:16,ANNOTATIONS_STORAGE:32,ANNOTATIONS_DISABLE:64,OPLIST:256};b.RenderingIntentFlag=e;const W={DISABLE:0,ENABLE:1,ENABLE_FORMS:2,ENABLE_STORAGE:3};b.AnnotationMode=W;const z="pdfjs_internal_editor_";b.AnnotationEditorPrefix=z;const J={DISABLE:-1,NONE:0,FREETEXT:3,STAMP:13,INK:15};b.AnnotationEditorType=J;const V={RESIZE:1,CREATE:2,FREETEXT_SIZE:11,FREETEXT_COLOR:12,FREETEXT_OPACITY:13,INK_COLOR:21,INK_THICKNESS:22,INK_OPACITY:23};b.AnnotationEditorParamsType=V;const o={PRINT:4,MODIFY_CONTENTS:8,COPY:16,MODIFY_ANNOTATIONS:32,FILL_INTERACTIVE_FORMS:256,COPY_FOR_ACCESSIBILITY:512,ASSEMBLE:1024,PRINT_HIGH_QUALITY:2048};b.PermissionFlag=o;const y={FILL:0,STROKE:1,FILL_STROKE:2,INVISIBLE:3,FILL_ADD_TO_PATH:4,STROKE_ADD_TO_PATH:5,FILL_STROKE_ADD_TO_PATH:6,ADD_TO_PATH:7,FILL_STROKE_MASK:3,ADD_TO_PATH_FLAG:4};b.TextRenderingMode=y;const B={GRAYSCALE_1BPP:1,RGB_24BPP:2,RGBA_32BPP:3};b.ImageKind=B;const s={TEXT:1,LINK:2,FREETEXT:3,LINE:4,SQUARE:5,CIRCLE:6,POLYGON:7,POLYLINE:8,HIGHLIGHT:9,UNDERLINE:10,SQUIGGLY:11,STRIKEOUT:12,STAMP:13,CARET:14,INK:15,POPUP:16,FILEATTACHMENT:17,SOUND:18,MOVIE:19,WIDGET:20,SCREEN:21,PRINTERMARK:22,TRAPNET:23,WATERMARK:24,THREED:25,REDACT:26};b.AnnotationType=s;const Y={GROUP:"Group",REPLY:"R"};b.AnnotationReplyType=Y;const t={INVISIBLE:1,HIDDEN:2,PRINT:4,NOZOOM:8,NOROTATE:16,NOVIEW:32,READONLY:64,LOCKED:128,TOGGLENOVIEW:256,LOCKEDCONTENTS:512};b.AnnotationFlag=t;const h={READONLY:1,REQUIRED:2,NOEXPORT:4,MULTILINE:4096,PASSWORD:8192,NOTOGGLETOOFF:16384,RADIO:32768,PUSHBUTTON:65536,COMBO:131072,EDIT:262144,SORT:524288,FILESELECT:1048576,MULTISELECT:2097152,DONOTSPELLCHECK:4194304,DONOTSCROLL:8388608,COMB:16777216,RICHTEXT:33554432,RADIOSINUNISON:33554432,COMMITONSELCHANGE:67108864};b.AnnotationFieldFlag=h;const Z={SOLID:1,DASHED:2,BEVELED:3,INSET:4,UNDERLINE:5};b.AnnotationBorderStyleType=Z;const i={E:"Mouse Enter",X:"Mouse Exit",D:"Mouse Down",U:"Mouse Up",Fo:"Focus",Bl:"Blur",PO:"PageOpen",PC:"PageClose",PV:"PageVisible",PI:"PageInvisible",K:"Keystroke",F:"Format",V:"Validate",C:"Calculate"};b.AnnotationActionEventType=i;const A={WC:"WillClose",WS:"WillSave",DS:"DidSave",WP:"WillPrint",DP:"DidPrint"};b.DocumentActionEventType=A;const d={O:"PageOpen",C:"PageClose"};b.PageActionEventType=d;const c={ERRORS:0,WARNINGS:1,INFOS:5};b.VerbosityLevel=c;const F={NONE:0,BINARY:1};b.CMapCompressionType=F;const l={dependency:1,setLineWidth:2,setLineCap:3,setLineJoin:4,setMiterLimit:5,setDash:6,setRenderingIntent:7,setFlatness:8,setGState:9,save:10,restore:11,transform:12,moveTo:13,lineTo:14,curveTo:15,curveTo2:16,curveTo3:17,closePath:18,rectangle:19,stroke:20,closeStroke:21,fill:22,eoFill:23,fillStroke:24,eoFillStroke:25,closeFillStroke:26,closeEOFillStroke:27,endPath:28,clip:29,eoClip:30,beginText:31,endText:32,setCharSpacing:33,setWordSpacing:34,setHScale:35,setLeading:36,setFont:37,setTextRenderingMode:38,setTextRise:39,moveText:40,setLeadingMoveText:41,setTextMatrix:42,nextLine:43,showText:44,showSpacedText:45,nextLineShowText:46,nextLineSetSpacingShowText:47,setCharWidth:48,setCharWidthAndBounds:49,setStrokeColorSpace:50,setFillColorSpace:51,setStrokeColor:52,setStrokeColorN:53,setFillColor:54,setFillColorN:55,setStrokeGray:56,setFillGray:57,setStrokeRGBColor:58,setFillRGBColor:59,setStrokeCMYKColor:60,setFillCMYKColor:61,shadingFill:62,beginInlineImage:63,beginImageData:64,endInlineImage:65,paintXObject:66,markPoint:67,markPointProps:68,beginMarkedContent:69,beginMarkedContentProps:70,endMarkedContent:71,beginCompat:72,endCompat:73,paintFormXObjectBegin:74,paintFormXObjectEnd:75,beginGroup:76,endGroup:77,beginAnnotation:80,endAnnotation:81,paintImageMaskXObject:83,paintImageMaskXObjectGroup:84,paintImageXObject:85,paintInlineImageXObject:86,paintInlineImageXObjectGroup:87,paintImageXObjectRepeat:88,paintImageMaskXObjectRepeat:89,paintSolidColorImageMask:90,constructPath:91};b.OPS=l;const X={NEED_PASSWORD:1,INCORRECT_PASSWORD:2};b.PasswordResponses=X;let K=c.WARNINGS;function lI(VI){Number.isInteger(VI)&&(K=VI)}function j(){return K}function r(VI){K>=c.INFOS&&console.log(`Info: ${VI}`)}function T(VI){K>=c.WARNINGS&&console.log(`Warning: ${VI}`)}function dI(VI){throw new Error(VI)}function M(VI,II){VI||dI(II)}function k(VI){switch(VI==null?void 0:VI.protocol){case"http:":case"https:":case"ftp:":case"mailto:":case"tel:":return!0;default:return!1}}function P(VI,II=null,AI=null){if(!VI)return null;try{if(AI&&typeof VI=="string"){if(AI.addDefaultProtocol&&VI.startsWith("www.")){const OI=VI.match(/\./g);(OI==null?void 0:OI.length)>=2&&(VI=`http://${VI}`)}if(AI.tryConvertEncoding)try{VI=NI(VI)}catch{}}const DI=II?new URL(VI,II):new URL(VI);if(k(DI))return DI}catch{}return null}function N(VI,II,AI,DI=!1){return Object.defineProperty(VI,II,{value:AI,enumerable:!DI,configurable:!0,writable:!1}),AI}const g=function(){function II(AI,DI){this.constructor===II&&dI("Cannot initialize BaseException."),this.message=AI,this.name=DI}return II.prototype=new Error,II.constructor=II,II}();b.BaseException=g;class C extends g{constructor(II,AI){super(II,"PasswordException"),this.code=AI}}b.PasswordException=C;class m extends g{constructor(II,AI){super(II,"UnknownErrorException"),this.details=AI}}b.UnknownErrorException=m;class u extends g{constructor(II){super(II,"InvalidPDFException")}}b.InvalidPDFException=u;class n extends g{constructor(II){super(II,"MissingPDFException")}}b.MissingPDFException=n;class D extends g{constructor(II,AI){super(II,"UnexpectedResponseException"),this.status=AI}}b.UnexpectedResponseException=D;class x extends g{constructor(II){super(II,"FormatError")}}b.FormatError=x;class CI extends g{constructor(II){super(II,"AbortException")}}b.AbortException=CI;function bI(VI){(typeof VI!="object"||(VI==null?void 0:VI.length)===void 0)&&dI("Invalid argument for bytesToString");const II=VI.length,AI=8192;if(II<AI)return String.fromCharCode.apply(null,VI);const DI=[];for(let OI=0;OI<II;OI+=AI){const xI=Math.min(OI+AI,II),S=VI.subarray(OI,xI);DI.push(String.fromCharCode.apply(null,S))}return DI.join("")}function sI(VI){typeof VI!="string"&&dI("Invalid argument for stringToBytes");const II=VI.length,AI=new Uint8Array(II);for(let DI=0;DI<II;++DI)AI[DI]=VI.charCodeAt(DI)&255;return AI}function YI(VI){return String.fromCharCode(VI>>24&255,VI>>16&255,VI>>8&255,VI&255)}function XI(VI){return Object.keys(VI).length}function aI(VI){const II=Object.create(null);for(const[AI,DI]of VI)II[AI]=DI;return II}function f(){const VI=new Uint8Array(4);return VI[0]=1,new Uint32Array(VI.buffer,0,1)[0]===1}function $(){try{return new Function(""),!0}catch{return!1}}class w{static get isLittleEndian(){return N(this,"isLittleEndian",f())}static get isEvalSupported(){return N(this,"isEvalSupported",$())}static get isOffscreenCanvasSupported(){return N(this,"isOffscreenCanvasSupported",typeof OffscreenCanvas<"u")}static get platform(){return typeof navigator>"u"?N(this,"platform",{isWin:!1,isMac:!1}):N(this,"platform",{isWin:navigator.platform.includes("Win"),isMac:navigator.platform.includes("Mac")})}static get isCSSRoundSupported(){var II,AI;return N(this,"isCSSRoundSupported",(AI=(II=globalThis.CSS)==null?void 0:II.supports)==null?void 0:AI.call(II,"width: round(1.5px, 1px)"))}}b.FeatureTest=w;const p=[...Array(256).keys()].map(VI=>VI.toString(16).padStart(2,"0"));class v{static makeHexColor(II,AI,DI){return`#${p[II]}${p[AI]}${p[DI]}`}static scaleMinMax(II,AI){let DI;II[0]?(II[0]<0&&(DI=AI[0],AI[0]=AI[1],AI[1]=DI),AI[0]*=II[0],AI[1]*=II[0],II[3]<0&&(DI=AI[2],AI[2]=AI[3],AI[3]=DI),AI[2]*=II[3],AI[3]*=II[3]):(DI=AI[0],AI[0]=AI[2],AI[2]=DI,DI=AI[1],AI[1]=AI[3],AI[3]=DI,II[1]<0&&(DI=AI[2],AI[2]=AI[3],AI[3]=DI),AI[2]*=II[1],AI[3]*=II[1],II[2]<0&&(DI=AI[0],AI[0]=AI[1],AI[1]=DI),AI[0]*=II[2],AI[1]*=II[2]),AI[0]+=II[4],AI[1]+=II[4],AI[2]+=II[5],AI[3]+=II[5]}static transform(II,AI){return[II[0]*AI[0]+II[2]*AI[1],II[1]*AI[0]+II[3]*AI[1],II[0]*AI[2]+II[2]*AI[3],II[1]*AI[2]+II[3]*AI[3],II[0]*AI[4]+II[2]*AI[5]+II[4],II[1]*AI[4]+II[3]*AI[5]+II[5]]}static applyTransform(II,AI){const DI=II[0]*AI[0]+II[1]*AI[2]+AI[4],OI=II[0]*AI[1]+II[1]*AI[3]+AI[5];return[DI,OI]}static applyInverseTransform(II,AI){const DI=AI[0]*AI[3]-AI[1]*AI[2],OI=(II[0]*AI[3]-II[1]*AI[2]+AI[2]*AI[5]-AI[4]*AI[3])/DI,xI=(-II[0]*AI[1]+II[1]*AI[0]+AI[4]*AI[1]-AI[5]*AI[0])/DI;return[OI,xI]}static getAxialAlignedBoundingBox(II,AI){const DI=this.applyTransform(II,AI),OI=this.applyTransform(II.slice(2,4),AI),xI=this.applyTransform([II[0],II[3]],AI),S=this.applyTransform([II[2],II[1]],AI);return[Math.min(DI[0],OI[0],xI[0],S[0]),Math.min(DI[1],OI[1],xI[1],S[1]),Math.max(DI[0],OI[0],xI[0],S[0]),Math.max(DI[1],OI[1],xI[1],S[1])]}static inverseTransform(II){const AI=II[0]*II[3]-II[1]*II[2];return[II[3]/AI,-II[1]/AI,-II[2]/AI,II[0]/AI,(II[2]*II[5]-II[4]*II[3])/AI,(II[4]*II[1]-II[5]*II[0])/AI]}static singularValueDecompose2dScale(II){const AI=[II[0],II[2],II[1],II[3]],DI=II[0]*AI[0]+II[1]*AI[2],OI=II[0]*AI[1]+II[1]*AI[3],xI=II[2]*AI[0]+II[3]*AI[2],S=II[2]*AI[1]+II[3]*AI[3],BI=(DI+S)/2,HI=Math.sqrt((DI+S)**2-4*(DI*S-xI*OI))/2,SI=BI+HI||1,zI=BI-HI||1;return[Math.sqrt(SI),Math.sqrt(zI)]}static normalizeRect(II){const AI=II.slice(0);return II[0]>II[2]&&(AI[0]=II[2],AI[2]=II[0]),II[1]>II[3]&&(AI[1]=II[3],AI[3]=II[1]),AI}static intersect(II,AI){const DI=Math.max(Math.min(II[0],II[2]),Math.min(AI[0],AI[2])),OI=Math.min(Math.max(II[0],II[2]),Math.max(AI[0],AI[2]));if(DI>OI)return null;const xI=Math.max(Math.min(II[1],II[3]),Math.min(AI[1],AI[3])),S=Math.min(Math.max(II[1],II[3]),Math.max(AI[1],AI[3]));return xI>S?null:[DI,xI,OI,S]}static bezierBoundingBox(II,AI,DI,OI,xI,S,BI,HI){const SI=[],zI=[[],[]];let nI,H,a,Q,GI,iI,oI,RI;for(let QI=0;QI<2;++QI){if(QI===0?(H=6*II-12*DI+6*xI,nI=-3*II+9*DI-9*xI+3*BI,a=3*DI-3*II):(H=6*AI-12*OI+6*S,nI=-3*AI+9*OI-9*S+3*HI,a=3*OI-3*AI),Math.abs(nI)<1e-12){if(Math.abs(H)<1e-12)continue;Q=-a/H,0<Q&&Q<1&&SI.push(Q);continue}oI=H*H-4*a*nI,RI=Math.sqrt(oI),!(oI<0)&&(GI=(-H+RI)/(2*nI),0<GI&&GI<1&&SI.push(GI),iI=(-H-RI)/(2*nI),0<iI&&iI<1&&SI.push(iI))}let tI=SI.length,KI;const uI=tI;for(;tI--;)Q=SI[tI],KI=1-Q,zI[0][tI]=KI*KI*KI*II+3*KI*KI*Q*DI+3*KI*Q*Q*xI+Q*Q*Q*BI,zI[1][tI]=KI*KI*KI*AI+3*KI*KI*Q*OI+3*KI*Q*Q*S+Q*Q*Q*HI;return zI[0][uI]=II,zI[1][uI]=AI,zI[0][uI+1]=BI,zI[1][uI+1]=HI,zI[0].length=zI[1].length=uI+2,[Math.min(...zI[0]),Math.min(...zI[1]),Math.max(...zI[0]),Math.max(...zI[1])]}}b.Util=v;const q=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,728,711,710,729,733,731,730,732,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,8226,8224,8225,8230,8212,8211,402,8260,8249,8250,8722,8240,8222,8220,8221,8216,8217,8218,8482,64257,64258,321,338,352,376,381,305,322,339,353,382,0,8364];function mI(VI){if(VI[0]>="ï"){let AI;if(VI[0]==="þ"&&VI[1]==="ÿ"?AI="utf-16be":VI[0]==="ÿ"&&VI[1]==="þ"?AI="utf-16le":VI[0]==="ï"&&VI[1]==="»"&&VI[2]==="¿"&&(AI="utf-8"),AI)try{const DI=new TextDecoder(AI,{fatal:!0}),OI=sI(VI);return DI.decode(OI)}catch(DI){T(`stringToPDFString: "${DI}".`)}}const II=[];for(let AI=0,DI=VI.length;AI<DI;AI++){const OI=q[VI.charCodeAt(AI)];II.push(OI?String.fromCharCode(OI):VI.charAt(AI))}return II.join("")}function NI(VI){return decodeURIComponent(escape(VI))}function hI(VI){return unescape(encodeURIComponent(VI))}function E(VI){return typeof VI=="object"&&(VI==null?void 0:VI.byteLength)!==void 0}function MI(VI,II){if(VI.length!==II.length)return!1;for(let AI=0,DI=VI.length;AI<DI;AI++)if(VI[AI]!==II[AI])return!1;return!0}function yI(VI=new Date){return[VI.getUTCFullYear().toString(),(VI.getUTCMonth()+1).toString().padStart(2,"0"),VI.getUTCDate().toString().padStart(2,"0"),VI.getUTCHours().toString().padStart(2,"0"),VI.getUTCMinutes().toString().padStart(2,"0"),VI.getUTCSeconds().toString().padStart(2,"0")].join("")}class TI{constructor(){_(this,rI,!1);this.promise=new Promise((II,AI)=>{this.resolve=DI=>{gI(this,rI,!0),II(DI)},this.reject=DI=>{gI(this,rI,!0),AI(DI)}})}get settled(){return I(this,rI)}}rI=new WeakMap,b.PromiseCapability=TI;let LI=null,UI=null;function eI(VI){return LI||(LI=/([\u00a0\u00b5\u037e\u0eb3\u2000-\u200a\u202f\u2126\ufb00-\ufb04\ufb06\ufb20-\ufb36\ufb38-\ufb3c\ufb3e\ufb40-\ufb41\ufb43-\ufb44\ufb46-\ufba1\ufba4-\ufba9\ufbae-\ufbb1\ufbd3-\ufbdc\ufbde-\ufbe7\ufbea-\ufbf8\ufbfc-\ufbfd\ufc00-\ufc5d\ufc64-\ufcf1\ufcf5-\ufd3d\ufd88\ufdf4\ufdfa-\ufdfb\ufe71\ufe77\ufe79\ufe7b\ufe7d]+)|(\ufb05+)/gu,UI=new Map([["ﬅ","ſt"]])),VI.replaceAll(LI,(II,AI,DI)=>AI?AI.normalize("NFKC"):UI.get(DI))}function JI(){if(typeof crypto<"u"&&typeof(crypto==null?void 0:crypto.randomUUID)=="function")return crypto.randomUUID();const VI=new Uint8Array(32);if(typeof crypto<"u"&&typeof(crypto==null?void 0:crypto.getRandomValues)=="function")crypto.getRandomValues(VI);else for(let II=0;II<32;II++)VI[II]=Math.floor(Math.random()*255);return bI(VI)}const vI="pdfjs_internal_id_";b.AnnotationPrefix=vI},(__unused_webpack_module,exports,__w_pdfjs_require__)=>{var wI,ZI,G,R,Zg,Vg,WI,L,e,W,z,J,V,o,y,Xg,s,Y,Sg,h,Z;Object.defineProperty(exports,"__esModule",{value:!0}),exports.RenderTask=exports.PDFWorkerUtil=exports.PDFWorker=exports.PDFPageProxy=exports.PDFDocumentProxy=exports.PDFDocumentLoadingTask=exports.PDFDataRangeTransport=exports.LoopbackPort=exports.DefaultStandardFontDataFactory=exports.DefaultFilterFactory=exports.DefaultCanvasFactory=exports.DefaultCMapReaderFactory=void 0,Object.defineProperty(exports,"SVGGraphics",{enumerable:!0,get:function(){return _displaySvg.SVGGraphics}}),exports.build=void 0,exports.getDocument=getDocument,exports.version=void 0;var _util=__w_pdfjs_require__(1),_annotation_storage=__w_pdfjs_require__(3),_display_utils=__w_pdfjs_require__(6),_font_loader=__w_pdfjs_require__(9),_displayNode_utils=__w_pdfjs_require__(10),_canvas=__w_pdfjs_require__(11),_worker_options=__w_pdfjs_require__(14),_message_handler=__w_pdfjs_require__(15),_metadata=__w_pdfjs_require__(16),_optional_content_config=__w_pdfjs_require__(17),_transport_stream=__w_pdfjs_require__(18),_displayFetch_stream=__w_pdfjs_require__(19),_displayNetwork=__w_pdfjs_require__(22),_displayNode_stream=__w_pdfjs_require__(23),_displaySvg=__w_pdfjs_require__(24),_xfa_text=__w_pdfjs_require__(25);const DEFAULT_RANGE_CHUNK_SIZE=65536,RENDERING_CANCELLED_TIMEOUT=100,DELAYED_CLEANUP_TIMEOUT=5e3,DefaultCanvasFactory=_util.isNodeJS?_displayNode_utils.NodeCanvasFactory:_display_utils.DOMCanvasFactory;exports.DefaultCanvasFactory=DefaultCanvasFactory;const DefaultCMapReaderFactory=_util.isNodeJS?_displayNode_utils.NodeCMapReaderFactory:_display_utils.DOMCMapReaderFactory;exports.DefaultCMapReaderFactory=DefaultCMapReaderFactory;const DefaultFilterFactory=_util.isNodeJS?_displayNode_utils.NodeFilterFactory:_display_utils.DOMFilterFactory;exports.DefaultFilterFactory=DefaultFilterFactory;const DefaultStandardFontDataFactory=_util.isNodeJS?_displayNode_utils.NodeStandardFontDataFactory:_display_utils.DOMStandardFontDataFactory;exports.DefaultStandardFontDataFactory=DefaultStandardFontDataFactory;function getDocument(A){if(typeof A=="string"||A instanceof URL?A={url:A}:(0,_util.isArrayBuffer)(A)&&(A={data:A}),typeof A!="object")throw new Error("Invalid parameter in getDocument, need parameter object.");if(!A.url&&!A.data&&!A.range)throw new Error("Invalid parameter object: need either .data, .range or .url");const d=new PDFDocumentLoadingTask,{docId:c}=d,F=A.url?getUrlProp(A.url):null,l=A.data?getDataProp(A.data):null,X=A.httpHeaders||null,K=A.withCredentials===!0,lI=A.password??null,j=A.range instanceof PDFDataRangeTransport?A.range:null,r=Number.isInteger(A.rangeChunkSize)&&A.rangeChunkSize>0?A.rangeChunkSize:DEFAULT_RANGE_CHUNK_SIZE;let T=A.worker instanceof PDFWorker?A.worker:null;const dI=A.verbosity,M=typeof A.docBaseUrl=="string"&&!(0,_display_utils.isDataScheme)(A.docBaseUrl)?A.docBaseUrl:null,k=typeof A.cMapUrl=="string"?A.cMapUrl:null,P=A.cMapPacked!==!1,N=A.CMapReaderFactory||DefaultCMapReaderFactory,g=typeof A.standardFontDataUrl=="string"?A.standardFontDataUrl:null,C=A.StandardFontDataFactory||DefaultStandardFontDataFactory,m=A.stopAtErrors!==!0,u=Number.isInteger(A.maxImageSize)&&A.maxImageSize>-1?A.maxImageSize:-1,n=A.isEvalSupported!==!1,D=typeof A.isOffscreenCanvasSupported=="boolean"?A.isOffscreenCanvasSupported:!_util.isNodeJS,x=Number.isInteger(A.canvasMaxAreaInBytes)?A.canvasMaxAreaInBytes:-1,CI=typeof A.disableFontFace=="boolean"?A.disableFontFace:_util.isNodeJS,bI=A.fontExtraProperties===!0,sI=A.enableXfa===!0,YI=A.ownerDocument||globalThis.document,XI=A.disableRange===!0,aI=A.disableStream===!0,f=A.disableAutoFetch===!0,$=A.pdfBug===!0,w=j?j.length:A.length??NaN,p=typeof A.useSystemFonts=="boolean"?A.useSystemFonts:!_util.isNodeJS&&!CI,v=typeof A.useWorkerFetch=="boolean"?A.useWorkerFetch:N===_display_utils.DOMCMapReaderFactory&&C===_display_utils.DOMStandardFontDataFactory&&k&&g&&(0,_display_utils.isValidFetchUrl)(k,document.baseURI)&&(0,_display_utils.isValidFetchUrl)(g,document.baseURI),q=A.canvasFactory||new DefaultCanvasFactory({ownerDocument:YI}),mI=A.filterFactory||new DefaultFilterFactory({docId:c,ownerDocument:YI}),NI=null;(0,_util.setVerbosityLevel)(dI);const hI={canvasFactory:q,filterFactory:mI};if(v||(hI.cMapReaderFactory=new N({baseUrl:k,isCompressed:P}),hI.standardFontDataFactory=new C({baseUrl:g})),!T){const yI={verbosity:dI,port:_worker_options.GlobalWorkerOptions.workerPort};T=yI.port?PDFWorker.fromPort(yI):new PDFWorker(yI),d._worker=T}const E={docId:c,apiVersion:"3.11.174",data:l,password:lI,disableAutoFetch:f,rangeChunkSize:r,length:w,docBaseUrl:M,enableXfa:sI,evaluatorOptions:{maxImageSize:u,disableFontFace:CI,ignoreErrors:m,isEvalSupported:n,isOffscreenCanvasSupported:D,canvasMaxAreaInBytes:x,fontExtraProperties:bI,useSystemFonts:p,cMapUrl:v?k:null,standardFontDataUrl:v?g:null}},MI={ignoreErrors:m,isEvalSupported:n,disableFontFace:CI,fontExtraProperties:bI,enableXfa:sI,ownerDocument:YI,disableAutoFetch:f,pdfBug:$,styleElement:NI};return T.promise.then(function(){if(d.destroyed)throw new Error("Loading aborted");const yI=_fetchDocument(T,E),TI=new Promise(function(LI){let UI;j?UI=new _transport_stream.PDFDataTransportStream({length:w,initialData:j.initialData,progressiveDone:j.progressiveDone,contentDispositionFilename:j.contentDispositionFilename,disableRange:XI,disableStream:aI},j):l||(UI=(JI=>_util.isNodeJS?new _displayNode_stream.PDFNodeStream(JI):(0,_display_utils.isValidFetchUrl)(JI.url)?new _displayFetch_stream.PDFFetchStream(JI):new _displayNetwork.PDFNetworkStream(JI))({url:F,length:w,httpHeaders:X,withCredentials:K,rangeChunkSize:r,disableRange:XI,disableStream:aI})),LI(UI)});return Promise.all([yI,TI]).then(function([LI,UI]){if(d.destroyed)throw new Error("Loading aborted");const eI=new _message_handler.MessageHandler(c,LI,T.port),JI=new WorkerTransport(eI,d,UI,MI,hI);d._transport=JI,eI.send("Ready",null)})}).catch(d._capability.reject),d}async function _fetchDocument(A,d){if(A.destroyed)throw new Error("Worker was destroyed");const c=await A.messageHandler.sendWithPromise("GetDocRequest",d,d.data?[d.data.buffer]:null);if(A.destroyed)throw new Error("Worker was destroyed");return c}function getUrlProp(A){if(A instanceof URL)return A.href;try{return new URL(A,window.location).href}catch{if(_util.isNodeJS&&typeof A=="string")return A}throw new Error("Invalid PDF url data: either string or URL-object is expected in the url property.")}function getDataProp(A){if(_util.isNodeJS&&typeof Buffer<"u"&&A instanceof Buffer)throw new Error("Please provide binary data as `Uint8Array`, rather than `Buffer`.");if(A instanceof Uint8Array&&A.byteLength===A.buffer.byteLength)return A;if(typeof A=="string")return(0,_util.stringToBytes)(A);if(typeof A=="object"&&!isNaN(A==null?void 0:A.length)||(0,_util.isArrayBuffer)(A))return new Uint8Array(A);throw new Error("Invalid PDF binary data: either TypedArray, string, or array-like object is expected in the data property.")}const b=class b{constructor(){this._capability=new _util.PromiseCapability,this._transport=null,this._worker=null,this.docId=`d${bg(b,wI)._++}`,this.destroyed=!1,this.onPassword=null,this.onProgress=null}get promise(){return this._capability.promise}async destroy(){var d,c,F;this.destroyed=!0;try{(d=this._worker)!=null&&d.port&&(this._worker._pendingDestroy=!0),await((c=this._transport)==null?void 0:c.destroy())}catch(l){throw(F=this._worker)!=null&&F.port&&delete this._worker._pendingDestroy,l}this._transport=null,this._worker&&(this._worker.destroy(),this._worker=null)}};wI=new WeakMap,_(b,wI,0);let PDFDocumentLoadingTask=b;exports.PDFDocumentLoadingTask=PDFDocumentLoadingTask;class PDFDataRangeTransport{constructor(d,c,F=!1,l=null){this.length=d,this.initialData=c,this.progressiveDone=F,this.contentDispositionFilename=l,this._rangeListeners=[],this._progressListeners=[],this._progressiveReadListeners=[],this._progressiveDoneListeners=[],this._readyCapability=new _util.PromiseCapability}addRangeListener(d){this._rangeListeners.push(d)}addProgressListener(d){this._progressListeners.push(d)}addProgressiveReadListener(d){this._progressiveReadListeners.push(d)}addProgressiveDoneListener(d){this._progressiveDoneListeners.push(d)}onDataRange(d,c){for(const F of this._rangeListeners)F(d,c)}onDataProgress(d,c){this._readyCapability.promise.then(()=>{for(const F of this._progressListeners)F(d,c)})}onDataProgressiveRead(d){this._readyCapability.promise.then(()=>{for(const c of this._progressiveReadListeners)c(d)})}onDataProgressiveDone(){this._readyCapability.promise.then(()=>{for(const d of this._progressiveDoneListeners)d()})}transportReady(){this._readyCapability.resolve()}requestDataRange(d,c){(0,_util.unreachable)("Abstract method PDFDataRangeTransport.requestDataRange")}abort(){}}exports.PDFDataRangeTransport=PDFDataRangeTransport;class PDFDocumentProxy{constructor(d,c){this._pdfInfo=d,this._transport=c,Object.defineProperty(this,"getJavaScript",{value:()=>((0,_display_utils.deprecated)("`PDFDocumentProxy.getJavaScript`, please use `PDFDocumentProxy.getJSActions` instead."),this.getJSActions().then(F=>{if(!F)return F;const l=[];for(const X in F)l.push(...F[X]);return l}))})}get annotationStorage(){return this._transport.annotationStorage}get filterFactory(){return this._transport.filterFactory}get numPages(){return this._pdfInfo.numPages}get fingerprints(){return this._pdfInfo.fingerprints}get isPureXfa(){return(0,_util.shadow)(this,"isPureXfa",!!this._transport._htmlForXfa)}get allXfaHtml(){return this._transport._htmlForXfa}getPage(d){return this._transport.getPage(d)}getPageIndex(d){return this._transport.getPageIndex(d)}getDestinations(){return this._transport.getDestinations()}getDestination(d){return this._transport.getDestination(d)}getPageLabels(){return this._transport.getPageLabels()}getPageLayout(){return this._transport.getPageLayout()}getPageMode(){return this._transport.getPageMode()}getViewerPreferences(){return this._transport.getViewerPreferences()}getOpenAction(){return this._transport.getOpenAction()}getAttachments(){return this._transport.getAttachments()}getJSActions(){return this._transport.getDocJSActions()}getOutline(){return this._transport.getOutline()}getOptionalContentConfig(){return this._transport.getOptionalContentConfig()}getPermissions(){return this._transport.getPermissions()}getMetadata(){return this._transport.getMetadata()}getMarkInfo(){return this._transport.getMarkInfo()}getData(){return this._transport.getData()}saveDocument(){return this._transport.saveDocument()}getDownloadInfo(){return this._transport.downloadInfoCapability.promise}cleanup(d=!1){return this._transport.startCleanup(d||this.isPureXfa)}destroy(){return this.loadingTask.destroy()}get loadingParams(){return this._transport.loadingParams}get loadingTask(){return this._transport.loadingTask}getFieldObjects(){return this._transport.getFieldObjects()}hasJSActions(){return this._transport.hasJSActions()}getCalculationOrderIds(){return this._transport.getCalculationOrderIds()}}exports.PDFDocumentProxy=PDFDocumentProxy;class PDFPageProxy{constructor(d,c,F,l=!1){_(this,R);_(this,ZI,null);_(this,G,!1);this._pageIndex=d,this._pageInfo=c,this._transport=F,this._stats=l?new _display_utils.StatTimer:null,this._pdfBug=l,this.commonObjs=F.commonObjs,this.objs=new PDFObjects,this._maybeCleanupAfterRender=!1,this._intentStates=new Map,this.destroyed=!1}get pageNumber(){return this._pageIndex+1}get rotate(){return this._pageInfo.rotate}get ref(){return this._pageInfo.ref}get userUnit(){return this._pageInfo.userUnit}get view(){return this._pageInfo.view}getViewport({scale:d,rotation:c=this.rotate,offsetX:F=0,offsetY:l=0,dontFlip:X=!1}={}){return new _display_utils.PageViewport({viewBox:this.view,scale:d,rotation:c,offsetX:F,offsetY:l,dontFlip:X})}getAnnotations({intent:d="display"}={}){const c=this._transport.getRenderingIntent(d);return this._transport.getAnnotations(this._pageIndex,c.renderingIntent)}getJSActions(){return this._transport.getPageJSActions(this._pageIndex)}get filterFactory(){return this._transport.filterFactory}get isPureXfa(){return(0,_util.shadow)(this,"isPureXfa",!!this._transport._htmlForXfa)}async getXfa(){var d;return((d=this._transport._htmlForXfa)==null?void 0:d.children[this._pageIndex])||null}render({canvasContext:d,viewport:c,intent:F="display",annotationMode:l=_util.AnnotationMode.ENABLE,transform:X=null,background:K=null,optionalContentConfigPromise:lI=null,annotationCanvasMap:j=null,pageColors:r=null,printAnnotationStorage:T=null}){var C,m;(C=this._stats)==null||C.time("Overall");const dI=this._transport.getRenderingIntent(F,l,T);gI(this,G,!1),O(this,R,Vg).call(this),lI||(lI=this._transport.getOptionalContentConfig());let M=this._intentStates.get(dI.cacheKey);M||(M=Object.create(null),this._intentStates.set(dI.cacheKey,M)),M.streamReaderCancelTimeout&&(clearTimeout(M.streamReaderCancelTimeout),M.streamReaderCancelTimeout=null);const k=!!(dI.renderingIntent&_util.RenderingIntentFlag.PRINT);M.displayReadyCapability||(M.displayReadyCapability=new _util.PromiseCapability,M.operatorList={fnArray:[],argsArray:[],lastChunk:!1,separateAnnots:null},(m=this._stats)==null||m.time("Page Request"),this._pumpOperatorList(dI));const P=u=>{var n,D;M.renderTasks.delete(N),(this._maybeCleanupAfterRender||k)&&gI(this,G,!0),O(this,R,Zg).call(this,!k),u?(N.capability.reject(u),this._abortOperatorList({intentState:M,reason:u instanceof Error?u:new Error(u)})):N.capability.resolve(),(n=this._stats)==null||n.timeEnd("Rendering"),(D=this._stats)==null||D.timeEnd("Overall")},N=new InternalRenderTask({callback:P,params:{canvasContext:d,viewport:c,transform:X,background:K},objs:this.objs,commonObjs:this.commonObjs,annotationCanvasMap:j,operatorList:M.operatorList,pageIndex:this._pageIndex,canvasFactory:this._transport.canvasFactory,filterFactory:this._transport.filterFactory,useRequestAnimationFrame:!k,pdfBug:this._pdfBug,pageColors:r});(M.renderTasks||(M.renderTasks=new Set)).add(N);const g=N.task;return Promise.all([M.displayReadyCapability.promise,lI]).then(([u,n])=>{var D;if(this.destroyed){P();return}(D=this._stats)==null||D.time("Rendering"),N.initializeGraphics({transparency:u,optionalContentConfig:n}),N.operatorListChanged()}).catch(P),g}getOperatorList({intent:d="display",annotationMode:c=_util.AnnotationMode.ENABLE,printAnnotationStorage:F=null}={}){var j;function l(){K.operatorList.lastChunk&&(K.opListReadCapability.resolve(K.operatorList),K.renderTasks.delete(lI))}const X=this._transport.getRenderingIntent(d,c,F,!0);let K=this._intentStates.get(X.cacheKey);K||(K=Object.create(null),this._intentStates.set(X.cacheKey,K));let lI;return K.opListReadCapability||(lI=Object.create(null),lI.operatorListChanged=l,K.opListReadCapability=new _util.PromiseCapability,(K.renderTasks||(K.renderTasks=new Set)).add(lI),K.operatorList={fnArray:[],argsArray:[],lastChunk:!1,separateAnnots:null},(j=this._stats)==null||j.time("Page Request"),this._pumpOperatorList(X)),K.opListReadCapability.promise}streamTextContent({includeMarkedContent:d=!1,disableNormalization:c=!1}={}){return this._transport.messageHandler.sendWithStream("GetTextContent",{pageIndex:this._pageIndex,includeMarkedContent:d===!0,disableNormalization:c===!0},{highWaterMark:100,size(l){return l.items.length}})}getTextContent(d={}){if(this._transport._htmlForXfa)return this.getXfa().then(F=>_xfa_text.XfaText.textContent(F));const c=this.streamTextContent(d);return new Promise(function(F,l){function X(){K.read().then(function({value:j,done:r}){if(r){F(lI);return}Object.assign(lI.styles,j.styles),lI.items.push(...j.items),X()},l)}const K=c.getReader(),lI={items:[],styles:Object.create(null)};X()})}getStructTree(){return this._transport.getStructTree(this._pageIndex)}_destroy(){this.destroyed=!0;const d=[];for(const c of this._intentStates.values())if(this._abortOperatorList({intentState:c,reason:new Error("Page was destroyed."),force:!0}),!c.opListReadCapability)for(const F of c.renderTasks)d.push(F.completed),F.cancel();return this.objs.clear(),gI(this,G,!1),O(this,R,Vg).call(this),Promise.all(d)}cleanup(d=!1){gI(this,G,!0);const c=O(this,R,Zg).call(this,!1);return d&&c&&this._stats&&(this._stats=new _display_utils.StatTimer),c}_startRenderPage(d,c){var l,X;const F=this._intentStates.get(c);F&&((l=this._stats)==null||l.timeEnd("Page Request"),(X=F.displayReadyCapability)==null||X.resolve(d))}_renderPageChunk(d,c){for(let F=0,l=d.length;F<l;F++)c.operatorList.fnArray.push(d.fnArray[F]),c.operatorList.argsArray.push(d.argsArray[F]);c.operatorList.lastChunk=d.lastChunk,c.operatorList.separateAnnots=d.separateAnnots;for(const F of c.renderTasks)F.operatorListChanged();d.lastChunk&&O(this,R,Zg).call(this,!0)}_pumpOperatorList({renderingIntent:d,cacheKey:c,annotationStorageSerializable:F}){const{map:l,transfers:X}=F,lI=this._transport.messageHandler.sendWithStream("GetOperatorList",{pageIndex:this._pageIndex,intent:d,cacheKey:c,annotationStorage:l},X).getReader(),j=this._intentStates.get(c);j.streamReader=lI;const r=()=>{lI.read().then(({value:T,done:dI})=>{if(dI){j.streamReader=null;return}this._transport.destroyed||(this._renderPageChunk(T,j),r())},T=>{if(j.streamReader=null,!this._transport.destroyed){if(j.operatorList){j.operatorList.lastChunk=!0;for(const dI of j.renderTasks)dI.operatorListChanged();O(this,R,Zg).call(this,!0)}if(j.displayReadyCapability)j.displayReadyCapability.reject(T);else if(j.opListReadCapability)j.opListReadCapability.reject(T);else throw T}})};r()}_abortOperatorList({intentState:d,reason:c,force:F=!1}){if(d.streamReader){if(d.streamReaderCancelTimeout&&(clearTimeout(d.streamReaderCancelTimeout),d.streamReaderCancelTimeout=null),!F){if(d.renderTasks.size>0)return;if(c instanceof _display_utils.RenderingCancelledException){let l=RENDERING_CANCELLED_TIMEOUT;c.extraDelay>0&&c.extraDelay<1e3&&(l+=c.extraDelay),d.streamReaderCancelTimeout=setTimeout(()=>{d.streamReaderCancelTimeout=null,this._abortOperatorList({intentState:d,reason:c,force:!0})},l);return}}if(d.streamReader.cancel(new _util.AbortException(c.message)).catch(()=>{}),d.streamReader=null,!this._transport.destroyed){for(const[l,X]of this._intentStates)if(X===d){this._intentStates.delete(l);break}this.cleanup()}}}get stats(){return this._stats}}ZI=new WeakMap,G=new WeakMap,R=new WeakSet,Zg=function(d=!1){if(O(this,R,Vg).call(this),!I(this,G)||this.destroyed)return!1;if(d)return gI(this,ZI,setTimeout(()=>{gI(this,ZI,null),O(this,R,Zg).call(this,!1)},DELAYED_CLEANUP_TIMEOUT)),!1;for(const{renderTasks:c,operatorList:F}of this._intentStates.values())if(c.size>0||!F.lastChunk)return!1;return this._intentStates.clear(),this.objs.clear(),gI(this,G,!1),!0},Vg=function(){I(this,ZI)&&(clearTimeout(I(this,ZI)),gI(this,ZI,null))},exports.PDFPageProxy=PDFPageProxy;class LoopbackPort{constructor(){_(this,WI,new Set);_(this,L,Promise.resolve())}postMessage(d,c){const F={data:structuredClone(d,c?{transfer:c}:null)};I(this,L).then(()=>{for(const l of I(this,WI))l.call(this,F)})}addEventListener(d,c){I(this,WI).add(c)}removeEventListener(d,c){I(this,WI).delete(c)}terminate(){I(this,WI).clear()}}WI=new WeakMap,L=new WeakMap,exports.LoopbackPort=LoopbackPort;const PDFWorkerUtil={isWorkerDisabled:!1,fallbackWorkerSrc:null,fakeWorkerId:0};exports.PDFWorkerUtil=PDFWorkerUtil;{if(_util.isNodeJS&&typeof commonjsRequire=="function")PDFWorkerUtil.isWorkerDisabled=!0,PDFWorkerUtil.fallbackWorkerSrc="./pdf.worker.js";else if(typeof document=="object"){const A=(e=document==null?void 0:document.currentScript)==null?void 0:e.src;A&&(PDFWorkerUtil.fallbackWorkerSrc=A.replace(/(\.(?:min\.)?js)(\?.*)?$/i,".worker$1$2"))}PDFWorkerUtil.isSameOrigin=function(A,d){let c;try{if(c=new URL(A),!c.origin||c.origin==="null")return!1}catch{return!1}const F=new URL(d,c);return c.origin===F.origin},PDFWorkerUtil.createCDNWrapper=function(A){const d=`importScripts("${A}");`;return URL.createObjectURL(new Blob([d]))}}const _PDFWorker=class _PDFWorker{constructor({name:A=null,port:d=null,verbosity:c=(0,_util.getVerbosityLevel)()}={}){var F;if(this.name=A,this.destroyed=!1,this.verbosity=c,this._readyCapability=new _util.PromiseCapability,this._port=null,this._webWorker=null,this._messageHandler=null,d){if((F=I(_PDFWorker,W))!=null&&F.has(d))throw new Error("Cannot use more than one PDFWorker per port.");(I(_PDFWorker,W)||gI(_PDFWorker,W,new WeakMap)).set(d,this),this._initializeFromPort(d);return}this._initialize()}get promise(){return this._readyCapability.promise}get port(){return this._port}get messageHandler(){return this._messageHandler}_initializeFromPort(A){this._port=A,this._messageHandler=new _message_handler.MessageHandler("main","worker",A),this._messageHandler.on("ready",function(){}),this._readyCapability.resolve(),this._messageHandler.send("configure",{verbosity:this.verbosity})}_initialize(){if(!PDFWorkerUtil.isWorkerDisabled&&!_PDFWorker._mainThreadWorkerMessageHandler){let{workerSrc:A}=_PDFWorker;try{PDFWorkerUtil.isSameOrigin(window.location.href,A)||(A=PDFWorkerUtil.createCDNWrapper(new URL(A,window.location).href));const d=new Worker(A),c=new _message_handler.MessageHandler("main","worker",d),F=()=>{d.removeEventListener("error",l),c.destroy(),d.terminate(),this.destroyed?this._readyCapability.reject(new Error("Worker was destroyed")):this._setupFakeWorker()},l=()=>{this._webWorker||F()};d.addEventListener("error",l),c.on("test",K=>{if(d.removeEventListener("error",l),this.destroyed){F();return}K?(this._messageHandler=c,this._port=d,this._webWorker=d,this._readyCapability.resolve(),c.send("configure",{verbosity:this.verbosity})):(this._setupFakeWorker(),c.destroy(),d.terminate())}),c.on("ready",K=>{if(d.removeEventListener("error",l),this.destroyed){F();return}try{X()}catch{this._setupFakeWorker()}});const X=()=>{const K=new Uint8Array;c.send("test",K,[K.buffer])};X();return}catch{(0,_util.info)("The worker has been disabled.")}}this._setupFakeWorker()}_setupFakeWorker(){PDFWorkerUtil.isWorkerDisabled||((0,_util.warn)("Setting up fake worker."),PDFWorkerUtil.isWorkerDisabled=!0),_PDFWorker._setupFakeWorkerGlobal.then(A=>{if(this.destroyed){this._readyCapability.reject(new Error("Worker was destroyed"));return}const d=new LoopbackPort;this._port=d;const c=`fake${PDFWorkerUtil.fakeWorkerId++}`,F=new _message_handler.MessageHandler(c+"_worker",c,d);A.setup(F,d);const l=new _message_handler.MessageHandler(c,c+"_worker",d);this._messageHandler=l,this._readyCapability.resolve(),l.send("configure",{verbosity:this.verbosity})}).catch(A=>{this._readyCapability.reject(new Error(`Setting up fake worker failed: "${A.message}".`))})}destroy(){var A;this.destroyed=!0,this._webWorker&&(this._webWorker.terminate(),this._webWorker=null),(A=I(_PDFWorker,W))==null||A.delete(this._port),this._port=null,this._messageHandler&&(this._messageHandler.destroy(),this._messageHandler=null)}static fromPort(A){var c;if(!(A!=null&&A.port))throw new Error("PDFWorker.fromPort - invalid method signature.");const d=(c=I(this,W))==null?void 0:c.get(A.port);if(d){if(d._pendingDestroy)throw new Error("PDFWorker.fromPort - the worker is being destroyed.\nPlease remember to await `PDFDocumentLoadingTask.destroy()`-calls.");return d}return new _PDFWorker(A)}static get workerSrc(){if(_worker_options.GlobalWorkerOptions.workerSrc)return _worker_options.GlobalWorkerOptions.workerSrc;if(PDFWorkerUtil.fallbackWorkerSrc!==null)return _util.isNodeJS||(0,_display_utils.deprecated)('No "GlobalWorkerOptions.workerSrc" specified.'),PDFWorkerUtil.fallbackWorkerSrc;throw new Error('No "GlobalWorkerOptions.workerSrc" specified.')}static get _mainThreadWorkerMessageHandler(){var A;try{return((A=globalThis.pdfjsWorker)==null?void 0:A.WorkerMessageHandler)||null}catch{return null}}static get _setupFakeWorkerGlobal(){const loader=async()=>{const mainWorkerMessageHandler=this._mainThreadWorkerMessageHandler;if(mainWorkerMessageHandler)return mainWorkerMessageHandler;if(_util.isNodeJS&&typeof commonjsRequire=="function"){const worker=eval("require")(this.workerSrc);return worker.WorkerMessageHandler}return await(0,_display_utils.loadScript)(this.workerSrc),window.pdfjsWorker.WorkerMessageHandler};return(0,_util.shadow)(this,"_setupFakeWorkerGlobal",loader())}};W=new WeakMap,_(_PDFWorker,W);let PDFWorker=_PDFWorker;exports.PDFWorker=PDFWorker;class WorkerTransport{constructor(d,c,F,l,X){_(this,y);_(this,z,new Map);_(this,J,new Map);_(this,V,new Map);_(this,o,null);this.messageHandler=d,this.loadingTask=c,this.commonObjs=new PDFObjects,this.fontLoader=new _font_loader.FontLoader({ownerDocument:l.ownerDocument,styleElement:l.styleElement}),this._params=l,this.canvasFactory=X.canvasFactory,this.filterFactory=X.filterFactory,this.cMapReaderFactory=X.cMapReaderFactory,this.standardFontDataFactory=X.standardFontDataFactory,this.destroyed=!1,this.destroyCapability=null,this._networkStream=F,this._fullReader=null,this._lastProgress=null,this.downloadInfoCapability=new _util.PromiseCapability,this.setupMessageHandler()}get annotationStorage(){return(0,_util.shadow)(this,"annotationStorage",new _annotation_storage.AnnotationStorage)}getRenderingIntent(d,c=_util.AnnotationMode.ENABLE,F=null,l=!1){let X=_util.RenderingIntentFlag.DISPLAY,K=_annotation_storage.SerializableEmpty;switch(d){case"any":X=_util.RenderingIntentFlag.ANY;break;case"display":break;case"print":X=_util.RenderingIntentFlag.PRINT;break;default:(0,_util.warn)(`getRenderingIntent - invalid intent: ${d}`)}switch(c){case _util.AnnotationMode.DISABLE:X+=_util.RenderingIntentFlag.ANNOTATIONS_DISABLE;break;case _util.AnnotationMode.ENABLE:break;case _util.AnnotationMode.ENABLE_FORMS:X+=_util.RenderingIntentFlag.ANNOTATIONS_FORMS;break;case _util.AnnotationMode.ENABLE_STORAGE:X+=_util.RenderingIntentFlag.ANNOTATIONS_STORAGE,K=(X&_util.RenderingIntentFlag.PRINT&&F instanceof _annotation_storage.PrintAnnotationStorage?F:this.annotationStorage).serializable;break;default:(0,_util.warn)(`getRenderingIntent - invalid annotationMode: ${c}`)}return l&&(X+=_util.RenderingIntentFlag.OPLIST),{renderingIntent:X,cacheKey:`${X}_${K.hash}`,annotationStorageSerializable:K}}destroy(){var F;if(this.destroyCapability)return this.destroyCapability.promise;this.destroyed=!0,this.destroyCapability=new _util.PromiseCapability,(F=I(this,o))==null||F.reject(new Error("Worker was destroyed during onPassword callback"));const d=[];for(const l of I(this,J).values())d.push(l._destroy());I(this,J).clear(),I(this,V).clear(),this.hasOwnProperty("annotationStorage")&&this.annotationStorage.resetModified();const c=this.messageHandler.sendWithPromise("Terminate",null);return d.push(c),Promise.all(d).then(()=>{var l;this.commonObjs.clear(),this.fontLoader.clear(),I(this,z).clear(),this.filterFactory.destroy(),(l=this._networkStream)==null||l.cancelAllRequests(new _util.AbortException("Worker was terminated.")),this.messageHandler&&(this.messageHandler.destroy(),this.messageHandler=null),this.destroyCapability.resolve()},this.destroyCapability.reject),this.destroyCapability.promise}setupMessageHandler(){const{messageHandler:d,loadingTask:c}=this;d.on("GetReader",(F,l)=>{(0,_util.assert)(this._networkStream,"GetReader - no `IPDFStream` instance available."),this._fullReader=this._networkStream.getFullReader(),this._fullReader.onProgress=X=>{this._lastProgress={loaded:X.loaded,total:X.total}},l.onPull=()=>{this._fullReader.read().then(function({value:X,done:K}){if(K){l.close();return}(0,_util.assert)(X instanceof ArrayBuffer,"GetReader - expected an ArrayBuffer."),l.enqueue(new Uint8Array(X),1,[X])}).catch(X=>{l.error(X)})},l.onCancel=X=>{this._fullReader.cancel(X),l.ready.catch(K=>{if(!this.destroyed)throw K})}}),d.on("ReaderHeadersReady",F=>{const l=new _util.PromiseCapability,X=this._fullReader;return X.headersReady.then(()=>{var K;(!X.isStreamingSupported||!X.isRangeSupported)&&(this._lastProgress&&((K=c.onProgress)==null||K.call(c,this._lastProgress)),X.onProgress=lI=>{var j;(j=c.onProgress)==null||j.call(c,{loaded:lI.loaded,total:lI.total})}),l.resolve({isStreamingSupported:X.isStreamingSupported,isRangeSupported:X.isRangeSupported,contentLength:X.contentLength})},l.reject),l.promise}),d.on("GetRangeReader",(F,l)=>{(0,_util.assert)(this._networkStream,"GetRangeReader - no `IPDFStream` instance available.");const X=this._networkStream.getRangeReader(F.begin,F.end);if(!X){l.close();return}l.onPull=()=>{X.read().then(function({value:K,done:lI}){if(lI){l.close();return}(0,_util.assert)(K instanceof ArrayBuffer,"GetRangeReader - expected an ArrayBuffer."),l.enqueue(new Uint8Array(K),1,[K])}).catch(K=>{l.error(K)})},l.onCancel=K=>{X.cancel(K),l.ready.catch(lI=>{if(!this.destroyed)throw lI})}}),d.on("GetDoc",({pdfInfo:F})=>{this._numPages=F.numPages,this._htmlForXfa=F.htmlForXfa,delete F.htmlForXfa,c._capability.resolve(new PDFDocumentProxy(F,this))}),d.on("DocException",function(F){let l;switch(F.name){case"PasswordException":l=new _util.PasswordException(F.message,F.code);break;case"InvalidPDFException":l=new _util.InvalidPDFException(F.message);break;case"MissingPDFException":l=new _util.MissingPDFException(F.message);break;case"UnexpectedResponseException":l=new _util.UnexpectedResponseException(F.message,F.status);break;case"UnknownErrorException":l=new _util.UnknownErrorException(F.message,F.details);break;default:(0,_util.unreachable)("DocException - expected a valid Error.")}c._capability.reject(l)}),d.on("PasswordRequest",F=>{if(gI(this,o,new _util.PromiseCapability),c.onPassword){const l=X=>{X instanceof Error?I(this,o).reject(X):I(this,o).resolve({password:X})};try{c.onPassword(l,F.code)}catch(X){I(this,o).reject(X)}}else I(this,o).reject(new _util.PasswordException(F.message,F.code));return I(this,o).promise}),d.on("DataLoaded",F=>{var l;(l=c.onProgress)==null||l.call(c,{loaded:F.length,total:F.length}),this.downloadInfoCapability.resolve(F)}),d.on("StartRenderPage",F=>{if(this.destroyed)return;I(this,J).get(F.pageIndex)._startRenderPage(F.transparency,F.cacheKey)}),d.on("commonobj",([F,l,X])=>{var K;if(!this.destroyed&&!this.commonObjs.has(F))switch(l){case"Font":const lI=this._params;if("error"in X){const T=X.error;(0,_util.warn)(`Error during font loading: ${T}`),this.commonObjs.resolve(F,T);break}const j=lI.pdfBug&&((K=globalThis.FontInspector)!=null&&K.enabled)?(T,dI)=>globalThis.FontInspector.fontAdded(T,dI):null,r=new _font_loader.FontFaceObject(X,{isEvalSupported:lI.isEvalSupported,disableFontFace:lI.disableFontFace,ignoreErrors:lI.ignoreErrors,inspectFont:j});this.fontLoader.bind(r).catch(T=>d.sendWithPromise("FontFallback",{id:F})).finally(()=>{!lI.fontExtraProperties&&r.data&&(r.data=null),this.commonObjs.resolve(F,r)});break;case"FontPath":case"Image":case"Pattern":this.commonObjs.resolve(F,X);break;default:throw new Error(`Got unknown common object type ${l}`)}}),d.on("obj",([F,l,X,K])=>{var j;if(this.destroyed)return;const lI=I(this,J).get(l);if(!lI.objs.has(F))switch(X){case"Image":if(lI.objs.resolve(F,K),K){let r;if(K.bitmap){const{width:T,height:dI}=K;r=T*dI*4}else r=((j=K.data)==null?void 0:j.length)||0;r>_util.MAX_IMAGE_SIZE_TO_CACHE&&(lI._maybeCleanupAfterRender=!0)}break;case"Pattern":lI.objs.resolve(F,K);break;default:throw new Error(`Got unknown object type ${X}`)}}),d.on("DocProgress",F=>{var l;this.destroyed||(l=c.onProgress)==null||l.call(c,{loaded:F.loaded,total:F.total})}),d.on("FetchBuiltInCMap",F=>this.destroyed?Promise.reject(new Error("Worker was destroyed.")):this.cMapReaderFactory?this.cMapReaderFactory.fetch(F):Promise.reject(new Error("CMapReaderFactory not initialized, see the `useWorkerFetch` parameter."))),d.on("FetchStandardFontData",F=>this.destroyed?Promise.reject(new Error("Worker was destroyed.")):this.standardFontDataFactory?this.standardFontDataFactory.fetch(F):Promise.reject(new Error("StandardFontDataFactory not initialized, see the `useWorkerFetch` parameter.")))}getData(){return this.messageHandler.sendWithPromise("GetData",null)}saveDocument(){var F;this.annotationStorage.size<=0&&(0,_util.warn)("saveDocument called while `annotationStorage` is empty, please use the getData-method instead.");const{map:d,transfers:c}=this.annotationStorage.serializable;return this.messageHandler.sendWithPromise("SaveDocument",{isPureXfa:!!this._htmlForXfa,numPages:this._numPages,annotationStorage:d,filename:((F=this._fullReader)==null?void 0:F.filename)??null},c).finally(()=>{this.annotationStorage.resetModified()})}getPage(d){if(!Number.isInteger(d)||d<=0||d>this._numPages)return Promise.reject(new Error("Invalid page request."));const c=d-1,F=I(this,V).get(c);if(F)return F;const l=this.messageHandler.sendWithPromise("GetPage",{pageIndex:c}).then(X=>{if(this.destroyed)throw new Error("Transport destroyed");const K=new PDFPageProxy(c,X,this,this._params.pdfBug);return I(this,J).set(c,K),K});return I(this,V).set(c,l),l}getPageIndex(d){return typeof d!="object"||d===null||!Number.isInteger(d.num)||d.num<0||!Number.isInteger(d.gen)||d.gen<0?Promise.reject(new Error("Invalid pageIndex request.")):this.messageHandler.sendWithPromise("GetPageIndex",{num:d.num,gen:d.gen})}getAnnotations(d,c){return this.messageHandler.sendWithPromise("GetAnnotations",{pageIndex:d,intent:c})}getFieldObjects(){return O(this,y,Xg).call(this,"GetFieldObjects")}hasJSActions(){return O(this,y,Xg).call(this,"HasJSActions")}getCalculationOrderIds(){return this.messageHandler.sendWithPromise("GetCalculationOrderIds",null)}getDestinations(){return this.messageHandler.sendWithPromise("GetDestinations",null)}getDestination(d){return typeof d!="string"?Promise.reject(new Error("Invalid destination request.")):this.messageHandler.sendWithPromise("GetDestination",{id:d})}getPageLabels(){return this.messageHandler.sendWithPromise("GetPageLabels",null)}getPageLayout(){return this.messageHandler.sendWithPromise("GetPageLayout",null)}getPageMode(){return this.messageHandler.sendWithPromise("GetPageMode",null)}getViewerPreferences(){return this.messageHandler.sendWithPromise("GetViewerPreferences",null)}getOpenAction(){return this.messageHandler.sendWithPromise("GetOpenAction",null)}getAttachments(){return this.messageHandler.sendWithPromise("GetAttachments",null)}getDocJSActions(){return O(this,y,Xg).call(this,"GetDocJSActions")}getPageJSActions(d){return this.messageHandler.sendWithPromise("GetPageJSActions",{pageIndex:d})}getStructTree(d){return this.messageHandler.sendWithPromise("GetStructTree",{pageIndex:d})}getOutline(){return this.messageHandler.sendWithPromise("GetOutline",null)}getOptionalContentConfig(){return this.messageHandler.sendWithPromise("GetOptionalContentConfig",null).then(d=>new _optional_content_config.OptionalContentConfig(d))}getPermissions(){return this.messageHandler.sendWithPromise("GetPermissions",null)}getMetadata(){const d="GetMetadata",c=I(this,z).get(d);if(c)return c;const F=this.messageHandler.sendWithPromise(d,null).then(l=>{var X,K;return{info:l[0],metadata:l[1]?new _metadata.Metadata(l[1]):null,contentDispositionFilename:((X=this._fullReader)==null?void 0:X.filename)??null,contentLength:((K=this._fullReader)==null?void 0:K.contentLength)??null}});return I(this,z).set(d,F),F}getMarkInfo(){return this.messageHandler.sendWithPromise("GetMarkInfo",null)}async startCleanup(d=!1){if(!this.destroyed){await this.messageHandler.sendWithPromise("Cleanup",null);for(const c of I(this,J).values())if(!c.cleanup())throw new Error(`startCleanup: Page ${c.pageNumber} is currently rendering.`);this.commonObjs.clear(),d||this.fontLoader.clear(),I(this,z).clear(),this.filterFactory.destroy(!0)}}get loadingParams(){const{disableAutoFetch:d,enableXfa:c}=this._params;return(0,_util.shadow)(this,"loadingParams",{disableAutoFetch:d,enableXfa:c})}}z=new WeakMap,J=new WeakMap,V=new WeakMap,o=new WeakMap,y=new WeakSet,Xg=function(d,c=null){const F=I(this,z).get(d);if(F)return F;const l=this.messageHandler.sendWithPromise(d,c);return I(this,z).set(d,l),l};class PDFObjects{constructor(){_(this,Y);_(this,s,Object.create(null))}get(d,c=null){if(c){const l=O(this,Y,Sg).call(this,d);return l.capability.promise.then(()=>c(l.data)),null}const F=I(this,s)[d];if(!(F!=null&&F.capability.settled))throw new Error(`Requesting object that isn't resolved yet ${d}.`);return F.data}has(d){const c=I(this,s)[d];return(c==null?void 0:c.capability.settled)||!1}resolve(d,c=null){const F=O(this,Y,Sg).call(this,d);F.data=c,F.capability.resolve()}clear(){var d;for(const c in I(this,s)){const{data:F}=I(this,s)[c];(d=F==null?void 0:F.bitmap)==null||d.close()}gI(this,s,Object.create(null))}}s=new WeakMap,Y=new WeakSet,Sg=function(d){var c;return(c=I(this,s))[d]||(c[d]={capability:new _util.PromiseCapability,data:null})};class RenderTask{constructor(d){_(this,h,null);gI(this,h,d),this.onContinue=null}get promise(){return I(this,h).capability.promise}cancel(d=0){I(this,h).cancel(null,d)}get separateAnnots(){const{separateAnnots:d}=I(this,h).operatorList;if(!d)return!1;const{annotationCanvasMap:c}=I(this,h);return d.form||d.canvas&&(c==null?void 0:c.size)>0}}h=new WeakMap,exports.RenderTask=RenderTask;const i=class i{constructor({callback:d,params:c,objs:F,commonObjs:l,annotationCanvasMap:X,operatorList:K,pageIndex:lI,canvasFactory:j,filterFactory:r,useRequestAnimationFrame:T=!1,pdfBug:dI=!1,pageColors:M=null}){this.callback=d,this.params=c,this.objs=F,this.commonObjs=l,this.annotationCanvasMap=X,this.operatorListIdx=null,this.operatorList=K,this._pageIndex=lI,this.canvasFactory=j,this.filterFactory=r,this._pdfBug=dI,this.pageColors=M,this.running=!1,this.graphicsReadyCallback=null,this.graphicsReady=!1,this._useRequestAnimationFrame=T===!0&&typeof window<"u",this.cancelled=!1,this.capability=new _util.PromiseCapability,this.task=new RenderTask(this),this._cancelBound=this.cancel.bind(this),this._continueBound=this._continue.bind(this),this._scheduleNextBound=this._scheduleNext.bind(this),this._nextBound=this._next.bind(this),this._canvas=c.canvasContext.canvas}get completed(){return this.capability.promise.catch(function(){})}initializeGraphics({transparency:d=!1,optionalContentConfig:c}){var lI,j;if(this.cancelled)return;if(this._canvas){if(I(i,Z).has(this._canvas))throw new Error("Cannot use the same canvas during multiple render() operations. Use different canvas or ensure previous operations were cancelled or completed.");I(i,Z).add(this._canvas)}this._pdfBug&&((lI=globalThis.StepperManager)!=null&&lI.enabled)&&(this.stepper=globalThis.StepperManager.create(this._pageIndex),this.stepper.init(this.operatorList),this.stepper.nextBreakPoint=this.stepper.getNextBreakPoint());const{canvasContext:F,viewport:l,transform:X,background:K}=this.params;this.gfx=new _canvas.CanvasGraphics(F,this.commonObjs,this.objs,this.canvasFactory,this.filterFactory,{optionalContentConfig:c},this.annotationCanvasMap,this.pageColors),this.gfx.beginDrawing({transform:X,viewport:l,transparency:d,background:K}),this.operatorListIdx=0,this.graphicsReady=!0,(j=this.graphicsReadyCallback)==null||j.call(this)}cancel(d=null,c=0){var F;this.running=!1,this.cancelled=!0,(F=this.gfx)==null||F.endDrawing(),I(i,Z).delete(this._canvas),this.callback(d||new _display_utils.RenderingCancelledException(`Rendering cancelled, page ${this._pageIndex+1}`,c))}operatorListChanged(){var d;if(!this.graphicsReady){this.graphicsReadyCallback||(this.graphicsReadyCallback=this._continueBound);return}(d=this.stepper)==null||d.updateOperatorList(this.operatorList),!this.running&&this._continue()}_continue(){this.running=!0,!this.cancelled&&(this.task.onContinue?this.task.onContinue(this._scheduleNextBound):this._scheduleNext())}_scheduleNext(){this._useRequestAnimationFrame?window.requestAnimationFrame(()=>{this._nextBound().catch(this._cancelBound)}):Promise.resolve().then(this._nextBound).catch(this._cancelBound)}async _next(){this.cancelled||(this.operatorListIdx=this.gfx.executeOperatorList(this.operatorList,this.operatorListIdx,this._continueBound,this.stepper),this.operatorListIdx===this.operatorList.argsArray.length&&(this.running=!1,this.operatorList.lastChunk&&(this.gfx.endDrawing(),I(i,Z).delete(this._canvas),this.callback())))}};Z=new WeakMap,_(i,Z,new WeakSet);let InternalRenderTask=i;const version="3.11.174";exports.version=version;const build="ce8716743";exports.build=build},(wI,b,ZI)=>{var e,W,z,wC,V;Object.defineProperty(b,"__esModule",{value:!0}),b.SerializableEmpty=b.PrintAnnotationStorage=b.AnnotationStorage=void 0;var G=ZI(1),R=ZI(4),cI=ZI(8);const U=Object.freeze({map:null,hash:"",transfers:void 0});b.SerializableEmpty=U;class WI{constructor(){_(this,z);_(this,e,!1);_(this,W,new Map);this.onSetModified=null,this.onResetModified=null,this.onAnnotationEditor=null}getValue(y,B){const s=I(this,W).get(y);return s===void 0?B:Object.assign(B,s)}getRawValue(y){return I(this,W).get(y)}remove(y){if(I(this,W).delete(y),I(this,W).size===0&&this.resetModified(),typeof this.onAnnotationEditor=="function"){for(const B of I(this,W).values())if(B instanceof R.AnnotationEditor)return;this.onAnnotationEditor(null)}}setValue(y,B){const s=I(this,W).get(y);let Y=!1;if(s!==void 0)for(const[t,h]of Object.entries(B))s[t]!==h&&(Y=!0,s[t]=h);else Y=!0,I(this,W).set(y,B);Y&&O(this,z,wC).call(this),B instanceof R.AnnotationEditor&&typeof this.onAnnotationEditor=="function"&&this.onAnnotationEditor(B.constructor._type)}has(y){return I(this,W).has(y)}getAll(){return I(this,W).size>0?(0,G.objectFromMap)(I(this,W)):null}setAll(y){for(const[B,s]of Object.entries(y))this.setValue(B,s)}get size(){return I(this,W).size}resetModified(){I(this,e)&&(gI(this,e,!1),typeof this.onResetModified=="function"&&this.onResetModified())}get print(){return new L(this)}get serializable(){if(I(this,W).size===0)return U;const y=new Map,B=new cI.MurmurHash3_64,s=[],Y=Object.create(null);let t=!1;for(const[h,Z]of I(this,W)){const i=Z instanceof R.AnnotationEditor?Z.serialize(!1,Y):Z;i&&(y.set(h,i),B.update(`${h}:${JSON.stringify(i)}`),t||(t=!!i.bitmap))}if(t)for(const h of y.values())h.bitmap&&s.push(h.bitmap);return y.size>0?{map:y,hash:B.hexdigest(),transfers:s}:U}}e=new WeakMap,W=new WeakMap,z=new WeakSet,wC=function(){I(this,e)||(gI(this,e,!0),typeof this.onSetModified=="function"&&this.onSetModified())},b.AnnotationStorage=WI;class L extends WI{constructor(B){super();_(this,V);const{map:s,hash:Y,transfers:t}=B.serializable,h=structuredClone(s,t?{transfer:t}:null);gI(this,V,{map:h,hash:Y,transfers:t})}get print(){(0,G.unreachable)("Should not call PrintAnnotationStorage.print")}get serializable(){return I(this,V)}}V=new WeakMap,b.PrintAnnotationStorage=L},(wI,b,ZI)=>{var L,e,W,z,J,V,o,y,B,s,Y,t,h,Z,i,tg,Fg,c,zg,Jg,YC,oC,VC,Lg,XC;Object.defineProperty(b,"__esModule",{value:!0}),b.AnnotationEditor=void 0;var G=ZI(5),R=ZI(1),cI=ZI(6);const T=class T{constructor(M){_(this,i);_(this,L,"");_(this,e,!1);_(this,W,null);_(this,z,null);_(this,J,null);_(this,V,!1);_(this,o,null);_(this,y,this.focusin.bind(this));_(this,B,this.focusout.bind(this));_(this,s,!1);_(this,Y,!1);_(this,t,!1);fI(this,"_initialOptions",Object.create(null));fI(this,"_uiManager",null);fI(this,"_focusEventsAllowed",!0);fI(this,"_l10nPromise",null);_(this,h,!1);_(this,Z,T._zIndex++);this.constructor===T&&(0,R.unreachable)("Cannot initialize AnnotationEditor."),this.parent=M.parent,this.id=M.id,this.width=this.height=null,this.pageIndex=M.parent.pageIndex,this.name=M.name,this.div=null,this._uiManager=M.uiManager,this.annotationElementId=null,this._willKeepAspectRatio=!1,this._initialOptions.isCentered=M.isCentered,this._structTreeParentId=null;const{rotation:k,rawDims:{pageWidth:P,pageHeight:N,pageX:g,pageY:C}}=this.parent.viewport;this.rotation=k,this.pageRotation=(360+k-this._uiManager.viewParameters.rotation)%360,this.pageDimensions=[P,N],this.pageTranslation=[g,C];const[m,u]=this.parentDimensions;this.x=M.x/m,this.y=M.y/u,this.isAttachedToDOM=!1,this.deleted=!1}get editorType(){return Object.getPrototypeOf(this).constructor._type}static get _defaultLineColor(){return(0,R.shadow)(this,"_defaultLineColor",this._colorManager.getHexCode("CanvasText"))}static deleteAnnotationElement(M){const k=new WI({id:M.parent.getNextId(),parent:M.parent,uiManager:M._uiManager});k.annotationElementId=M.annotationElementId,k.deleted=!0,k._uiManager.addToAnnotationStorage(k)}static initialize(M,k=null){if(T._l10nPromise||(T._l10nPromise=new Map(["editor_alt_text_button_label","editor_alt_text_edit_button_label","editor_alt_text_decorative_tooltip"].map(N=>[N,M.get(N)]))),k!=null&&k.strings)for(const N of k.strings)T._l10nPromise.set(N,M.get(N));if(T._borderLineWidth!==-1)return;const P=getComputedStyle(document.documentElement);T._borderLineWidth=parseFloat(P.getPropertyValue("--outline-width"))||0}static updateDefaultParams(M,k){}static get defaultPropertiesToUpdate(){return[]}static isHandlingMimeForPasting(M){return!1}static paste(M,k){(0,R.unreachable)("Not implemented")}get propertiesToUpdate(){return[]}get _isDraggable(){return I(this,h)}set _isDraggable(M){var k;gI(this,h,M),(k=this.div)==null||k.classList.toggle("draggable",M)}center(){const[M,k]=this.pageDimensions;switch(this.parentRotation){case 90:this.x-=this.height*k/(M*2),this.y+=this.width*M/(k*2);break;case 180:this.x+=this.width/2,this.y+=this.height/2;break;case 270:this.x+=this.height*k/(M*2),this.y-=this.width*M/(k*2);break;default:this.x-=this.width/2,this.y-=this.height/2;break}this.fixAndSetPosition()}addCommands(M){this._uiManager.addCommands(M)}get currentLayer(){return this._uiManager.currentLayer}setInBackground(){this.div.style.zIndex=0}setInForeground(){this.div.style.zIndex=I(this,Z)}setParent(M){M!==null&&(this.pageIndex=M.pageIndex,this.pageDimensions=M.pageDimensions),this.parent=M}focusin(M){this._focusEventsAllowed&&(I(this,s)?gI(this,s,!1):this.parent.setSelected(this))}focusout(M){var P;if(!this._focusEventsAllowed||!this.isAttachedToDOM)return;const k=M.relatedTarget;k!=null&&k.closest(`#${this.id}`)||(M.preventDefault(),(P=this.parent)!=null&&P.isMultipleSelection||this.commitOrRemove())}commitOrRemove(){this.isEmpty()?this.remove():this.commit()}commit(){this.addToAnnotationStorage()}addToAnnotationStorage(){this._uiManager.addToAnnotationStorage(this)}setAt(M,k,P,N){const[g,C]=this.parentDimensions;[P,N]=this.screenToPageTranslation(P,N),this.x=(M+P)/g,this.y=(k+N)/C,this.fixAndSetPosition()}translate(M,k){O(this,i,tg).call(this,this.parentDimensions,M,k)}translateInPage(M,k){O(this,i,tg).call(this,this.pageDimensions,M,k),this.div.scrollIntoView({block:"nearest"})}drag(M,k){const[P,N]=this.parentDimensions;if(this.x+=M/P,this.y+=k/N,this.parent&&(this.x<0||this.x>1||this.y<0||this.y>1)){const{x:n,y:D}=this.div.getBoundingClientRect();this.parent.findNewParent(this,n,D)&&(this.x-=Math.floor(this.x),this.y-=Math.floor(this.y))}let{x:g,y:C}=this;const[m,u]=O(this,i,Fg).call(this);g+=m,C+=u,this.div.style.left=`${(100*g).toFixed(2)}%`,this.div.style.top=`${(100*C).toFixed(2)}%`,this.div.scrollIntoView({block:"nearest"})}fixAndSetPosition(){const[M,k]=this.pageDimensions;let{x:P,y:N,width:g,height:C}=this;switch(g*=M,C*=k,P*=M,N*=k,this.rotation){case 0:P=Math.max(0,Math.min(M-g,P)),N=Math.max(0,Math.min(k-C,N));break;case 90:P=Math.max(0,Math.min(M-C,P)),N=Math.min(k,Math.max(g,N));break;case 180:P=Math.min(M,Math.max(g,P)),N=Math.min(k,Math.max(C,N));break;case 270:P=Math.min(M,Math.max(C,P)),N=Math.max(0,Math.min(k-g,N));break}this.x=P/=M,this.y=N/=k;const[m,u]=O(this,i,Fg).call(this);P+=m,N+=u;const{style:n}=this.div;n.left=`${(100*P).toFixed(2)}%`,n.top=`${(100*N).toFixed(2)}%`,this.moveInDOM()}screenToPageTranslation(M,k){var P;return O(P=T,c,zg).call(P,M,k,this.parentRotation)}pageTranslationToScreen(M,k){var P;return O(P=T,c,zg).call(P,M,k,360-this.parentRotation)}get parentScale(){return this._uiManager.viewParameters.realScale}get parentRotation(){return(this._uiManager.viewParameters.rotation+this.pageRotation)%360}get parentDimensions(){const{parentScale:M,pageDimensions:[k,P]}=this,N=k*M,g=P*M;return R.FeatureTest.isCSSRoundSupported?[Math.round(N),Math.round(g)]:[N,g]}setDims(M,k){var g;const[P,N]=this.parentDimensions;this.div.style.width=`${(100*M/P).toFixed(2)}%`,I(this,V)||(this.div.style.height=`${(100*k/N).toFixed(2)}%`),(g=I(this,W))==null||g.classList.toggle("small",M<T.SMALL_EDITOR_SIZE||k<T.SMALL_EDITOR_SIZE)}fixDims(){const{style:M}=this.div,{height:k,width:P}=M,N=P.endsWith("%"),g=!I(this,V)&&k.endsWith("%");if(N&&g)return;const[C,m]=this.parentDimensions;N||(M.width=`${(100*parseFloat(P)/C).toFixed(2)}%`),!I(this,V)&&!g&&(M.height=`${(100*parseFloat(k)/m).toFixed(2)}%`)}getInitialTranslation(){return[0,0]}async addAltTextButton(){if(I(this,W))return;const M=gI(this,W,document.createElement("button"));M.className="altText";const k=await T._l10nPromise.get("editor_alt_text_button_label");M.textContent=k,M.setAttribute("aria-label",k),M.tabIndex="0",M.addEventListener("contextmenu",cI.noContextMenu),M.addEventListener("pointerdown",P=>P.stopPropagation()),M.addEventListener("click",P=>{P.preventDefault(),this._uiManager.editAltText(this)},{capture:!0}),M.addEventListener("keydown",P=>{P.target===M&&P.key==="Enter"&&(P.preventDefault(),this._uiManager.editAltText(this))}),O(this,i,Lg).call(this),this.div.append(M),T.SMALL_EDITOR_SIZE||(T.SMALL_EDITOR_SIZE=Math.min(128,Math.round(M.getBoundingClientRect().width*1.4)))}getClientDimensions(){return this.div.getBoundingClientRect()}get altTextData(){return{altText:I(this,L),decorative:I(this,e)}}set altTextData({altText:M,decorative:k}){I(this,L)===M&&I(this,e)===k||(gI(this,L,M),gI(this,e,k),O(this,i,Lg).call(this))}render(){this.div=document.createElement("div"),this.div.setAttribute("data-editor-rotation",(360-this.rotation)%360),this.div.className=this.name,this.div.setAttribute("id",this.id),this.div.setAttribute("tabIndex",0),this.setInForeground(),this.div.addEventListener("focusin",I(this,y)),this.div.addEventListener("focusout",I(this,B));const[M,k]=this.parentDimensions;this.parentRotation%180!==0&&(this.div.style.maxWidth=`${(100*k/M).toFixed(2)}%`,this.div.style.maxHeight=`${(100*M/k).toFixed(2)}%`);const[P,N]=this.getInitialTranslation();return this.translate(P,N),(0,G.bindEvents)(this,this.div,["pointerdown"]),this.div}pointerdown(M){const{isMac:k}=R.FeatureTest.platform;if(M.button!==0||M.ctrlKey&&k){M.preventDefault();return}gI(this,s,!0),O(this,i,XC).call(this,M)}moveInDOM(){var M;(M=this.parent)==null||M.moveEditorInDOM(this)}_setParentAndPosition(M,k,P){M.changeParent(this),this.x=k,this.y=P,this.fixAndSetPosition()}getRect(M,k){const P=this.parentScale,[N,g]=this.pageDimensions,[C,m]=this.pageTranslation,u=M/P,n=k/P,D=this.x*N,x=this.y*g,CI=this.width*N,bI=this.height*g;switch(this.rotation){case 0:return[D+u+C,g-x-n-bI+m,D+u+CI+C,g-x-n+m];case 90:return[D+n+C,g-x+u+m,D+n+bI+C,g-x+u+CI+m];case 180:return[D-u-CI+C,g-x+n+m,D-u+C,g-x+n+bI+m];case 270:return[D-n-bI+C,g-x-u-CI+m,D-n+C,g-x-u+m];default:throw new Error("Invalid rotation")}}getRectInCurrentCoords(M,k){const[P,N,g,C]=M,m=g-P,u=C-N;switch(this.rotation){case 0:return[P,k-C,m,u];case 90:return[P,k-N,u,m];case 180:return[g,k-N,m,u];case 270:return[g,k-C,u,m];default:throw new Error("Invalid rotation")}}onceAdded(){}isEmpty(){return!1}enableEditMode(){gI(this,t,!0)}disableEditMode(){gI(this,t,!1)}isInEditMode(){return I(this,t)}shouldGetKeyboardEvents(){return!1}needsToBeRebuilt(){return this.div&&!this.isAttachedToDOM}rebuild(){var M,k;(M=this.div)==null||M.addEventListener("focusin",I(this,y)),(k=this.div)==null||k.addEventListener("focusout",I(this,B))}serialize(M=!1,k=null){(0,R.unreachable)("An editor must be serializable")}static deserialize(M,k,P){const N=new this.prototype.constructor({parent:k,id:k.getNextId(),uiManager:P});N.rotation=M.rotation;const[g,C]=N.pageDimensions,[m,u,n,D]=N.getRectInCurrentCoords(M.rect,C);return N.x=m/g,N.y=u/C,N.width=n/g,N.height=D/C,N}remove(){var M;this.div.removeEventListener("focusin",I(this,y)),this.div.removeEventListener("focusout",I(this,B)),this.isEmpty()||this.commit(),this.parent?this.parent.remove(this):this._uiManager.removeEditor(this),(M=I(this,W))==null||M.remove(),gI(this,W,null),gI(this,z,null)}get isResizable(){return!1}makeResizable(){this.isResizable&&(O(this,i,YC).call(this),I(this,o).classList.remove("hidden"))}select(){var M;this.makeResizable(),(M=this.div)==null||M.classList.add("selectedEditor")}unselect(){var M,k,P;(M=I(this,o))==null||M.classList.add("hidden"),(k=this.div)==null||k.classList.remove("selectedEditor"),(P=this.div)!=null&&P.contains(document.activeElement)&&this._uiManager.currentLayer.div.focus()}updateParams(M,k){}disableEditing(){I(this,W)&&(I(this,W).hidden=!0)}enableEditing(){I(this,W)&&(I(this,W).hidden=!1)}enterInEditMode(){}get contentDiv(){return this.div}get isEditing(){return I(this,Y)}set isEditing(M){gI(this,Y,M),this.parent&&(M?(this.parent.setSelected(this),this.parent.setActiveEditor(this)):this.parent.setActiveEditor(null))}setAspectRatio(M,k){gI(this,V,!0);const P=M/k,{style:N}=this.div;N.aspectRatio=P,N.height="auto"}static get MIN_SIZE(){return 16}};L=new WeakMap,e=new WeakMap,W=new WeakMap,z=new WeakMap,J=new WeakMap,V=new WeakMap,o=new WeakMap,y=new WeakMap,B=new WeakMap,s=new WeakMap,Y=new WeakMap,t=new WeakMap,h=new WeakMap,Z=new WeakMap,i=new WeakSet,tg=function([M,k],P,N){[P,N]=this.screenToPageTranslation(P,N),this.x+=P/M,this.y+=N/k,this.fixAndSetPosition()},Fg=function(){const[M,k]=this.parentDimensions,{_borderLineWidth:P}=T,N=P/M,g=P/k;switch(this.rotation){case 90:return[-N,g];case 180:return[N,g];case 270:return[N,-g];default:return[-N,-g]}},c=new WeakSet,zg=function(M,k,P){switch(P){case 90:return[k,-M];case 180:return[-M,-k];case 270:return[-k,M];default:return[M,k]}},Jg=function(M){switch(M){case 90:{const[k,P]=this.pageDimensions;return[0,-k/P,P/k,0]}case 180:return[-1,0,0,-1];case 270:{const[k,P]=this.pageDimensions;return[0,k/P,-P/k,0]}default:return[1,0,0,1]}},YC=function(){if(I(this,o))return;gI(this,o,document.createElement("div")),I(this,o).classList.add("resizers");const M=["topLeft","topRight","bottomRight","bottomLeft"];this._willKeepAspectRatio||M.push("topMiddle","middleRight","bottomMiddle","middleLeft");for(const k of M){const P=document.createElement("div");I(this,o).append(P),P.classList.add("resizer",k),P.addEventListener("pointerdown",O(this,i,oC).bind(this,k)),P.addEventListener("contextmenu",cI.noContextMenu)}this.div.prepend(I(this,o))},oC=function(M,k){k.preventDefault();const{isMac:P}=R.FeatureTest.platform;if(k.button!==0||k.ctrlKey&&P)return;const N=O(this,i,VC).bind(this,M),g=this._isDraggable;this._isDraggable=!1;const C={passive:!0,capture:!0};window.addEventListener("pointermove",N,C);const m=this.x,u=this.y,n=this.width,D=this.height,x=this.parent.div.style.cursor,CI=this.div.style.cursor;this.div.style.cursor=this.parent.div.style.cursor=window.getComputedStyle(k.target).cursor;const bI=()=>{this._isDraggable=g,window.removeEventListener("pointerup",bI),window.removeEventListener("blur",bI),window.removeEventListener("pointermove",N,C),this.parent.div.style.cursor=x,this.div.style.cursor=CI;const sI=this.x,YI=this.y,XI=this.width,aI=this.height;sI===m&&YI===u&&XI===n&&aI===D||this.addCommands({cmd:()=>{this.width=XI,this.height=aI,this.x=sI,this.y=YI;const[f,$]=this.parentDimensions;this.setDims(f*XI,$*aI),this.fixAndSetPosition()},undo:()=>{this.width=n,this.height=D,this.x=m,this.y=u;const[f,$]=this.parentDimensions;this.setDims(f*n,$*D),this.fixAndSetPosition()},mustExec:!0})};window.addEventListener("pointerup",bI),window.addEventListener("blur",bI)},VC=function(M,k){const[P,N]=this.parentDimensions,g=this.x,C=this.y,m=this.width,u=this.height,n=T.MIN_SIZE/P,D=T.MIN_SIZE/N,x=eI=>Math.round(eI*1e4)/1e4,CI=O(this,i,Jg).call(this,this.rotation),bI=(eI,JI)=>[CI[0]*eI+CI[2]*JI,CI[1]*eI+CI[3]*JI],sI=O(this,i,Jg).call(this,360-this.rotation),YI=(eI,JI)=>[sI[0]*eI+sI[2]*JI,sI[1]*eI+sI[3]*JI];let XI,aI,f=!1,$=!1;switch(M){case"topLeft":f=!0,XI=(eI,JI)=>[0,0],aI=(eI,JI)=>[eI,JI];break;case"topMiddle":XI=(eI,JI)=>[eI/2,0],aI=(eI,JI)=>[eI/2,JI];break;case"topRight":f=!0,XI=(eI,JI)=>[eI,0],aI=(eI,JI)=>[0,JI];break;case"middleRight":$=!0,XI=(eI,JI)=>[eI,JI/2],aI=(eI,JI)=>[0,JI/2];break;case"bottomRight":f=!0,XI=(eI,JI)=>[eI,JI],aI=(eI,JI)=>[0,0];break;case"bottomMiddle":XI=(eI,JI)=>[eI/2,JI],aI=(eI,JI)=>[eI/2,0];break;case"bottomLeft":f=!0,XI=(eI,JI)=>[0,JI],aI=(eI,JI)=>[eI,0];break;case"middleLeft":$=!0,XI=(eI,JI)=>[0,JI/2],aI=(eI,JI)=>[eI,JI/2];break}const w=XI(m,u),p=aI(m,u);let v=bI(...p);const q=x(g+v[0]),mI=x(C+v[1]);let NI=1,hI=1,[E,MI]=this.screenToPageTranslation(k.movementX,k.movementY);if([E,MI]=YI(E/P,MI/N),f){const eI=Math.hypot(m,u);NI=hI=Math.max(Math.min(Math.hypot(p[0]-w[0]-E,p[1]-w[1]-MI)/eI,1/m,1/u),n/m,D/u)}else $?NI=Math.max(n,Math.min(1,Math.abs(p[0]-w[0]-E)))/m:hI=Math.max(D,Math.min(1,Math.abs(p[1]-w[1]-MI)))/u;const yI=x(m*NI),TI=x(u*hI);v=bI(...aI(yI,TI));const LI=q-v[0],UI=mI-v[1];this.width=yI,this.height=TI,this.x=LI,this.y=UI,this.setDims(P*yI,N*TI),this.fixAndSetPosition()},Lg=async function(){var P;const M=I(this,W);if(!M)return;if(!I(this,L)&&!I(this,e)){M.classList.remove("done"),(P=I(this,z))==null||P.remove();return}T._l10nPromise.get("editor_alt_text_edit_button_label").then(N=>{M.setAttribute("aria-label",N)});let k=I(this,z);if(!k){gI(this,z,k=document.createElement("span")),k.className="tooltip",k.setAttribute("role","tooltip");const N=k.id=`alt-text-tooltip-${this.id}`;M.setAttribute("aria-describedby",N);const g=100;M.addEventListener("mouseenter",()=>{gI(this,J,setTimeout(()=>{gI(this,J,null),I(this,z).classList.add("show"),this._uiManager._eventBus.dispatch("reporttelemetry",{source:this,details:{type:"editing",subtype:this.editorType,data:{action:"alt_text_tooltip"}}})},g))}),M.addEventListener("mouseleave",()=>{var C;clearTimeout(I(this,J)),gI(this,J,null),(C=I(this,z))==null||C.classList.remove("show")})}M.classList.add("done"),k.innerText=I(this,e)?await T._l10nPromise.get("editor_alt_text_decorative_tooltip"):I(this,L),k.parentNode||M.append(k)},XC=function(M){if(!this._isDraggable)return;const k=this._uiManager.isSelected(this);this._uiManager.setUpDragSession();let P,N;k&&(P={passive:!0,capture:!0},N=C=>{const[m,u]=this.screenToPageTranslation(C.movementX,C.movementY);this._uiManager.dragSelectedEditors(m,u)},window.addEventListener("pointermove",N,P));const g=()=>{if(window.removeEventListener("pointerup",g),window.removeEventListener("blur",g),k&&window.removeEventListener("pointermove",N,P),gI(this,s,!1),!this._uiManager.endDragSession()){const{isMac:C}=R.FeatureTest.platform;M.ctrlKey&&!C||M.shiftKey||M.metaKey&&C?this.parent.toggleSelected(this):this.parent.setSelected(this)}};window.addEventListener("pointerup",g),window.addEventListener("blur",g)},_(T,c),fI(T,"_borderLineWidth",-1),fI(T,"_colorManager",new G.ColorManager),fI(T,"_zIndex",1),fI(T,"SMALL_EDITOR_SIZE",0);let U=T;b.AnnotationEditor=U;class WI extends U{constructor(M){super(M),this.annotationElementId=M.annotationElementId,this.deleted=!0}serialize(){return{id:this.annotationElementId,deleted:!0,pageIndex:this.pageIndex}}}},(wI,b,ZI)=>{var V,o,y,B,s,kg,h,Z,i,A,d,hC,l,X,K,lI,j,r,T,dI,M,k,P,N,g,C,m,u,n,D,x,CI,bI,sI,YI,XI,aI,f,$,w,p,v,q,mI,NI,hI,E,aC,Tg,Qg,hg,jg,xg,$I,sg,NC,RC,Og,mg,Ug;Object.defineProperty(b,"__esModule",{value:!0}),b.KeyboardManager=b.CommandManager=b.ColorManager=b.AnnotationEditorUIManager=void 0,b.bindEvents=cI,b.opacityToHex=U;var G=ZI(1),R=ZI(6);function cI(xI,S,BI){for(const HI of BI)S.addEventListener(HI,xI[HI].bind(xI))}function U(xI){return Math.round(Math.min(255,Math.max(1,255*xI))).toString(16).padStart(2,"0")}class WI{constructor(){_(this,V,0)}getId(){return`${G.AnnotationEditorPrefix}${bg(this,V)._++}`}}V=new WeakMap;const t=class t{constructor(){_(this,s);_(this,o,(0,G.getUuid)());_(this,y,0);_(this,B,null)}static get _isSVGFittingCanvas(){const S='data:image/svg+xml;charset=UTF-8,<svg viewBox="0 0 1 1" width="1" height="1" xmlns="http://www.w3.org/2000/svg"><rect width="1" height="1" style="fill:red;"/></svg>',HI=new OffscreenCanvas(1,3).getContext("2d"),SI=new Image;SI.src=S;const zI=SI.decode().then(()=>(HI.drawImage(SI,0,0,1,1,0,0,1,3),new Uint32Array(HI.getImageData(0,0,1,1).data.buffer)[0]===0));return(0,G.shadow)(this,"_isSVGFittingCanvas",zI)}async getFromFile(S){const{lastModified:BI,name:HI,size:SI,type:zI}=S;return O(this,s,kg).call(this,`${BI}_${HI}_${SI}_${zI}`,S)}async getFromUrl(S){return O(this,s,kg).call(this,S,S)}async getFromId(S){I(this,B)||gI(this,B,new Map);const BI=I(this,B).get(S);return BI?BI.bitmap?(BI.refCounter+=1,BI):BI.file?this.getFromFile(BI.file):this.getFromUrl(BI.url):null}getSvgUrl(S){const BI=I(this,B).get(S);return BI!=null&&BI.isSvg?BI.svgUrl:null}deleteId(S){I(this,B)||gI(this,B,new Map);const BI=I(this,B).get(S);BI&&(BI.refCounter-=1,BI.refCounter===0&&(BI.bitmap=null))}isValidId(S){return S.startsWith(`image_${I(this,o)}_`)}};o=new WeakMap,y=new WeakMap,B=new WeakMap,s=new WeakSet,kg=async function(S,BI){I(this,B)||gI(this,B,new Map);let HI=I(this,B).get(S);if(HI===null)return null;if(HI!=null&&HI.bitmap)return HI.refCounter+=1,HI;try{HI||(HI={bitmap:null,id:`image_${I(this,o)}_${bg(this,y)._++}`,refCounter:0,isSvg:!1});let SI;if(typeof BI=="string"){HI.url=BI;const zI=await fetch(BI);if(!zI.ok)throw new Error(zI.statusText);SI=await zI.blob()}else SI=HI.file=BI;if(SI.type==="image/svg+xml"){const zI=t._isSVGFittingCanvas,nI=new FileReader,H=new Image,a=new Promise((Q,GI)=>{H.onload=()=>{HI.bitmap=H,HI.isSvg=!0,Q()},nI.onload=async()=>{const iI=HI.svgUrl=nI.result;H.src=await zI?`${iI}#svgView(preserveAspectRatio(none))`:iI},H.onerror=nI.onerror=GI});nI.readAsDataURL(SI),await a}else HI.bitmap=await createImageBitmap(SI);HI.refCounter=1}catch(SI){console.error(SI),HI=null}return I(this,B).set(S,HI),HI&&I(this,B).set(HI.id,HI),HI};let L=t;class e{constructor(S=128){_(this,h,[]);_(this,Z,!1);_(this,i);_(this,A,-1);gI(this,i,S)}add({cmd:S,undo:BI,mustExec:HI,type:SI=NaN,overwriteIfSameType:zI=!1,keepUndo:nI=!1}){if(HI&&S(),I(this,Z))return;const H={cmd:S,undo:BI,type:SI};if(I(this,A)===-1){I(this,h).length>0&&(I(this,h).length=0),gI(this,A,0),I(this,h).push(H);return}if(zI&&I(this,h)[I(this,A)].type===SI){nI&&(H.undo=I(this,h)[I(this,A)].undo),I(this,h)[I(this,A)]=H;return}const a=I(this,A)+1;a===I(this,i)?I(this,h).splice(0,1):(gI(this,A,a),a<I(this,h).length&&I(this,h).splice(a)),I(this,h).push(H)}undo(){I(this,A)!==-1&&(gI(this,Z,!0),I(this,h)[I(this,A)].undo(),gI(this,Z,!1),gI(this,A,I(this,A)-1))}redo(){I(this,A)<I(this,h).length-1&&(gI(this,A,I(this,A)+1),gI(this,Z,!0),I(this,h)[I(this,A)].cmd(),gI(this,Z,!1))}hasSomethingToUndo(){return I(this,A)!==-1}hasSomethingToRedo(){return I(this,A)<I(this,h).length-1}destroy(){gI(this,h,null)}}h=new WeakMap,Z=new WeakMap,i=new WeakMap,A=new WeakMap,b.CommandManager=e;class W{constructor(S){_(this,d);this.buffer=[],this.callbacks=new Map,this.allKeys=new Set;const{isMac:BI}=G.FeatureTest.platform;for(const[HI,SI,zI={}]of S)for(const nI of HI){const H=nI.startsWith("mac+");BI&&H?(this.callbacks.set(nI.slice(4),{callback:SI,options:zI}),this.allKeys.add(nI.split("+").at(-1))):!BI&&!H&&(this.callbacks.set(nI,{callback:SI,options:zI}),this.allKeys.add(nI.split("+").at(-1)))}}exec(S,BI){if(!this.allKeys.has(BI.key))return;const HI=this.callbacks.get(O(this,d,hC).call(this,BI));if(!HI)return;const{callback:SI,options:{bubbles:zI=!1,args:nI=[],checker:H=null}}=HI;H&&!H(S,BI)||(SI.bind(S,...nI)(),zI||(BI.stopPropagation(),BI.preventDefault()))}}d=new WeakSet,hC=function(S){S.altKey&&this.buffer.push("alt"),S.ctrlKey&&this.buffer.push("ctrl"),S.metaKey&&this.buffer.push("meta"),S.shiftKey&&this.buffer.push("shift"),this.buffer.push(S.key);const BI=this.buffer.join("+");return this.buffer.length=0,BI},b.KeyboardManager=W;const F=class F{get _colors(){const S=new Map([["CanvasText",null],["Canvas",null]]);return(0,R.getColorValues)(S),(0,G.shadow)(this,"_colors",S)}convert(S){const BI=(0,R.getRGB)(S);if(!window.matchMedia("(forced-colors: active)").matches)return BI;for(const[HI,SI]of this._colors)if(SI.every((zI,nI)=>zI===BI[nI]))return F._colorsMapping.get(HI);return BI}getHexCode(S){const BI=this._colors.get(S);return BI?G.Util.makeHexColor(...BI):S}};fI(F,"_colorsMapping",new Map([["CanvasText",[0,0,0]],["Canvas",[255,255,255]]]));let z=F;b.ColorManager=z;const OI=class OI{constructor(S,BI,HI,SI,zI,nI){_(this,E);_(this,l,null);_(this,X,new Map);_(this,K,new Map);_(this,lI,null);_(this,j,null);_(this,r,new e);_(this,T,0);_(this,dI,new Set);_(this,M,null);_(this,k,null);_(this,P,new Set);_(this,N,null);_(this,g,new WI);_(this,C,!1);_(this,m,!1);_(this,u,null);_(this,n,G.AnnotationEditorType.NONE);_(this,D,new Set);_(this,x,null);_(this,CI,this.blur.bind(this));_(this,bI,this.focus.bind(this));_(this,sI,this.copy.bind(this));_(this,YI,this.cut.bind(this));_(this,XI,this.paste.bind(this));_(this,aI,this.keydown.bind(this));_(this,f,this.onEditingAction.bind(this));_(this,$,this.onPageChanging.bind(this));_(this,w,this.onScaleChanging.bind(this));_(this,p,this.onRotationChanging.bind(this));_(this,v,{isEditing:!1,isEmpty:!0,hasSomethingToUndo:!1,hasSomethingToRedo:!1,hasSelectedEditor:!1});_(this,q,[0,0]);_(this,mI,null);_(this,NI,null);_(this,hI,null);gI(this,NI,S),gI(this,hI,BI),gI(this,lI,HI),this._eventBus=SI,this._eventBus._on("editingaction",I(this,f)),this._eventBus._on("pagechanging",I(this,$)),this._eventBus._on("scalechanging",I(this,w)),this._eventBus._on("rotationchanging",I(this,p)),gI(this,j,zI.annotationStorage),gI(this,N,zI.filterFactory),gI(this,x,nI),this.viewParameters={realScale:R.PixelsPerInch.PDF_TO_CSS_UNITS,rotation:0}}static get _keyboardManager(){const S=OI.prototype,BI=zI=>{const{activeElement:nI}=document;return nI&&I(zI,NI).contains(nI)&&zI.hasSomethingToControl()},HI=this.TRANSLATE_SMALL,SI=this.TRANSLATE_BIG;return(0,G.shadow)(this,"_keyboardManager",new W([[["ctrl+a","mac+meta+a"],S.selectAll],[["ctrl+z","mac+meta+z"],S.undo],[["ctrl+y","ctrl+shift+z","mac+meta+shift+z","ctrl+shift+Z","mac+meta+shift+Z"],S.redo],[["Backspace","alt+Backspace","ctrl+Backspace","shift+Backspace","mac+Backspace","mac+alt+Backspace","mac+ctrl+Backspace","Delete","ctrl+Delete","shift+Delete","mac+Delete"],S.delete],[["Escape","mac+Escape"],S.unselectAll],[["ArrowLeft","mac+ArrowLeft"],S.translateSelectedEditors,{args:[-HI,0],checker:BI}],[["ctrl+ArrowLeft","mac+shift+ArrowLeft"],S.translateSelectedEditors,{args:[-SI,0],checker:BI}],[["ArrowRight","mac+ArrowRight"],S.translateSelectedEditors,{args:[HI,0],checker:BI}],[["ctrl+ArrowRight","mac+shift+ArrowRight"],S.translateSelectedEditors,{args:[SI,0],checker:BI}],[["ArrowUp","mac+ArrowUp"],S.translateSelectedEditors,{args:[0,-HI],checker:BI}],[["ctrl+ArrowUp","mac+shift+ArrowUp"],S.translateSelectedEditors,{args:[0,-SI],checker:BI}],[["ArrowDown","mac+ArrowDown"],S.translateSelectedEditors,{args:[0,HI],checker:BI}],[["ctrl+ArrowDown","mac+shift+ArrowDown"],S.translateSelectedEditors,{args:[0,SI],checker:BI}]]))}destroy(){O(this,E,hg).call(this),O(this,E,Tg).call(this),this._eventBus._off("editingaction",I(this,f)),this._eventBus._off("pagechanging",I(this,$)),this._eventBus._off("scalechanging",I(this,w)),this._eventBus._off("rotationchanging",I(this,p));for(const S of I(this,K).values())S.destroy();I(this,K).clear(),I(this,X).clear(),I(this,P).clear(),gI(this,l,null),I(this,D).clear(),I(this,r).destroy(),I(this,lI).destroy()}get hcmFilter(){return(0,G.shadow)(this,"hcmFilter",I(this,x)?I(this,N).addHCMFilter(I(this,x).foreground,I(this,x).background):"none")}get direction(){return(0,G.shadow)(this,"direction",getComputedStyle(I(this,NI)).direction)}editAltText(S){var BI;(BI=I(this,lI))==null||BI.editAltText(this,S)}onPageChanging({pageNumber:S}){gI(this,T,S-1)}focusMainContainer(){I(this,NI).focus()}findParent(S,BI){for(const HI of I(this,K).values()){const{x:SI,y:zI,width:nI,height:H}=HI.div.getBoundingClientRect();if(S>=SI&&S<=SI+nI&&BI>=zI&&BI<=zI+H)return HI}return null}disableUserSelect(S=!1){I(this,hI).classList.toggle("noUserSelect",S)}addShouldRescale(S){I(this,P).add(S)}removeShouldRescale(S){I(this,P).delete(S)}onScaleChanging({scale:S}){this.commitOrRemove(),this.viewParameters.realScale=S*R.PixelsPerInch.PDF_TO_CSS_UNITS;for(const BI of I(this,P))BI.onScaleChanging()}onRotationChanging({pagesRotation:S}){this.commitOrRemove(),this.viewParameters.rotation=S}addToAnnotationStorage(S){!S.isEmpty()&&I(this,j)&&!I(this,j).has(S.id)&&I(this,j).setValue(S.id,S)}blur(){if(!this.hasSelection)return;const{activeElement:S}=document;for(const BI of I(this,D))if(BI.div.contains(S)){gI(this,u,[BI,S]),BI._focusEventsAllowed=!1;break}}focus(){if(!I(this,u))return;const[S,BI]=I(this,u);gI(this,u,null),BI.addEventListener("focusin",()=>{S._focusEventsAllowed=!0},{once:!0}),BI.focus()}addEditListeners(){O(this,E,Qg).call(this),O(this,E,jg).call(this)}removeEditListeners(){O(this,E,hg).call(this),O(this,E,xg).call(this)}copy(S){var HI;if(S.preventDefault(),(HI=I(this,l))==null||HI.commitOrRemove(),!this.hasSelection)return;const BI=[];for(const SI of I(this,D)){const zI=SI.serialize(!0);zI&&BI.push(zI)}BI.length!==0&&S.clipboardData.setData("application/pdfjs",JSON.stringify(BI))}cut(S){this.copy(S),this.delete()}paste(S){S.preventDefault();const{clipboardData:BI}=S;for(const zI of BI.items)for(const nI of I(this,k))if(nI.isHandlingMimeForPasting(zI.type)){nI.paste(zI,this.currentLayer);return}let HI=BI.getData("application/pdfjs");if(!HI)return;try{HI=JSON.parse(HI)}catch(zI){(0,G.warn)(`paste: "${zI.message}".`);return}if(!Array.isArray(HI))return;this.unselectAll();const SI=this.currentLayer;try{const zI=[];for(const a of HI){const Q=SI.deserialize(a);if(!Q)return;zI.push(Q)}const nI=()=>{for(const a of zI)O(this,E,Og).call(this,a);O(this,E,Ug).call(this,zI)},H=()=>{for(const a of zI)a.remove()};this.addCommands({cmd:nI,undo:H,mustExec:!0})}catch(zI){(0,G.warn)(`paste: "${zI.message}".`)}}keydown(S){var BI;(BI=this.getActive())!=null&&BI.shouldGetKeyboardEvents()||OI._keyboardManager.exec(this,S)}onEditingAction(S){["undo","redo","delete","selectAll"].includes(S.name)&&this[S.name]()}setEditingState(S){S?(O(this,E,aC).call(this),O(this,E,Qg).call(this),O(this,E,jg).call(this),O(this,E,$I).call(this,{isEditing:I(this,n)!==G.AnnotationEditorType.NONE,isEmpty:O(this,E,mg).call(this),hasSomethingToUndo:I(this,r).hasSomethingToUndo(),hasSomethingToRedo:I(this,r).hasSomethingToRedo(),hasSelectedEditor:!1})):(O(this,E,Tg).call(this),O(this,E,hg).call(this),O(this,E,xg).call(this),O(this,E,$I).call(this,{isEditing:!1}),this.disableUserSelect(!1))}registerEditorTypes(S){if(!I(this,k)){gI(this,k,S);for(const BI of I(this,k))O(this,E,sg).call(this,BI.defaultPropertiesToUpdate)}}getId(){return I(this,g).getId()}get currentLayer(){return I(this,K).get(I(this,T))}getLayer(S){return I(this,K).get(S)}get currentPageIndex(){return I(this,T)}addLayer(S){I(this,K).set(S.pageIndex,S),I(this,C)?S.enable():S.disable()}removeLayer(S){I(this,K).delete(S.pageIndex)}updateMode(S,BI=null){if(I(this,n)!==S){if(gI(this,n,S),S===G.AnnotationEditorType.NONE){this.setEditingState(!1),O(this,E,RC).call(this);return}this.setEditingState(!0),O(this,E,NC).call(this),this.unselectAll();for(const HI of I(this,K).values())HI.updateMode(S);if(BI){for(const HI of I(this,X).values())if(HI.annotationElementId===BI){this.setSelected(HI),HI.enterInEditMode();break}}}}updateToolbar(S){S!==I(this,n)&&this._eventBus.dispatch("switchannotationeditormode",{source:this,mode:S})}updateParams(S,BI){if(I(this,k)){if(S===G.AnnotationEditorParamsType.CREATE){this.currentLayer.addNewEditor(S);return}for(const HI of I(this,D))HI.updateParams(S,BI);for(const HI of I(this,k))HI.updateDefaultParams(S,BI)}}enableWaiting(S=!1){if(I(this,m)!==S){gI(this,m,S);for(const BI of I(this,K).values())S?BI.disableClick():BI.enableClick(),BI.div.classList.toggle("waiting",S)}}getEditors(S){const BI=[];for(const HI of I(this,X).values())HI.pageIndex===S&&BI.push(HI);return BI}getEditor(S){return I(this,X).get(S)}addEditor(S){I(this,X).set(S.id,S)}removeEditor(S){var BI;I(this,X).delete(S.id),this.unselect(S),(!S.annotationElementId||!I(this,dI).has(S.annotationElementId))&&((BI=I(this,j))==null||BI.remove(S.id))}addDeletedAnnotationElement(S){I(this,dI).add(S.annotationElementId),S.deleted=!0}isDeletedAnnotationElement(S){return I(this,dI).has(S)}removeDeletedAnnotationElement(S){I(this,dI).delete(S.annotationElementId),S.deleted=!1}setActiveEditor(S){I(this,l)!==S&&(gI(this,l,S),S&&O(this,E,sg).call(this,S.propertiesToUpdate))}toggleSelected(S){if(I(this,D).has(S)){I(this,D).delete(S),S.unselect(),O(this,E,$I).call(this,{hasSelectedEditor:this.hasSelection});return}I(this,D).add(S),S.select(),O(this,E,sg).call(this,S.propertiesToUpdate),O(this,E,$I).call(this,{hasSelectedEditor:!0})}setSelected(S){for(const BI of I(this,D))BI!==S&&BI.unselect();I(this,D).clear(),I(this,D).add(S),S.select(),O(this,E,sg).call(this,S.propertiesToUpdate),O(this,E,$I).call(this,{hasSelectedEditor:!0})}isSelected(S){return I(this,D).has(S)}unselect(S){S.unselect(),I(this,D).delete(S),O(this,E,$I).call(this,{hasSelectedEditor:this.hasSelection})}get hasSelection(){return I(this,D).size!==0}undo(){I(this,r).undo(),O(this,E,$I).call(this,{hasSomethingToUndo:I(this,r).hasSomethingToUndo(),hasSomethingToRedo:!0,isEmpty:O(this,E,mg).call(this)})}redo(){I(this,r).redo(),O(this,E,$I).call(this,{hasSomethingToUndo:!0,hasSomethingToRedo:I(this,r).hasSomethingToRedo(),isEmpty:O(this,E,mg).call(this)})}addCommands(S){I(this,r).add(S),O(this,E,$I).call(this,{hasSomethingToUndo:!0,hasSomethingToRedo:!1,isEmpty:O(this,E,mg).call(this)})}delete(){if(this.commitOrRemove(),!this.hasSelection)return;const S=[...I(this,D)],BI=()=>{for(const SI of S)SI.remove()},HI=()=>{for(const SI of S)O(this,E,Og).call(this,SI)};this.addCommands({cmd:BI,undo:HI,mustExec:!0})}commitOrRemove(){var S;(S=I(this,l))==null||S.commitOrRemove()}hasSomethingToControl(){return I(this,l)||this.hasSelection}selectAll(){for(const S of I(this,D))S.commit();O(this,E,Ug).call(this,I(this,X).values())}unselectAll(){if(I(this,l)){I(this,l).commitOrRemove();return}if(this.hasSelection){for(const S of I(this,D))S.unselect();I(this,D).clear(),O(this,E,$I).call(this,{hasSelectedEditor:!1})}}translateSelectedEditors(S,BI,HI=!1){if(HI||this.commitOrRemove(),!this.hasSelection)return;I(this,q)[0]+=S,I(this,q)[1]+=BI;const[SI,zI]=I(this,q),nI=[...I(this,D)],H=1e3;I(this,mI)&&clearTimeout(I(this,mI)),gI(this,mI,setTimeout(()=>{gI(this,mI,null),I(this,q)[0]=I(this,q)[1]=0,this.addCommands({cmd:()=>{for(const a of nI)I(this,X).has(a.id)&&a.translateInPage(SI,zI)},undo:()=>{for(const a of nI)I(this,X).has(a.id)&&a.translateInPage(-SI,-zI)},mustExec:!1})},H));for(const a of nI)a.translateInPage(S,BI)}setUpDragSession(){if(this.hasSelection){this.disableUserSelect(!0),gI(this,M,new Map);for(const S of I(this,D))I(this,M).set(S,{savedX:S.x,savedY:S.y,savedPageIndex:S.pageIndex,newX:0,newY:0,newPageIndex:-1})}}endDragSession(){if(!I(this,M))return!1;this.disableUserSelect(!1);const S=I(this,M);gI(this,M,null);let BI=!1;for(const[{x:SI,y:zI,pageIndex:nI},H]of S)H.newX=SI,H.newY=zI,H.newPageIndex=nI,BI||(BI=SI!==H.savedX||zI!==H.savedY||nI!==H.savedPageIndex);if(!BI)return!1;const HI=(SI,zI,nI,H)=>{if(I(this,X).has(SI.id)){const a=I(this,K).get(H);a?SI._setParentAndPosition(a,zI,nI):(SI.pageIndex=H,SI.x=zI,SI.y=nI)}};return this.addCommands({cmd:()=>{for(const[SI,{newX:zI,newY:nI,newPageIndex:H}]of S)HI(SI,zI,nI,H)},undo:()=>{for(const[SI,{savedX:zI,savedY:nI,savedPageIndex:H}]of S)HI(SI,zI,nI,H)},mustExec:!0}),!0}dragSelectedEditors(S,BI){if(I(this,M))for(const HI of I(this,M).keys())HI.drag(S,BI)}rebuild(S){if(S.parent===null){const BI=this.getLayer(S.pageIndex);BI?(BI.changeParent(S),BI.addOrRebuild(S)):(this.addEditor(S),this.addToAnnotationStorage(S),S.rebuild())}else S.parent.addOrRebuild(S)}isActive(S){return I(this,l)===S}getActive(){return I(this,l)}getMode(){return I(this,n)}get imageManager(){return(0,G.shadow)(this,"imageManager",new L)}};l=new WeakMap,X=new WeakMap,K=new WeakMap,lI=new WeakMap,j=new WeakMap,r=new WeakMap,T=new WeakMap,dI=new WeakMap,M=new WeakMap,k=new WeakMap,P=new WeakMap,N=new WeakMap,g=new WeakMap,C=new WeakMap,m=new WeakMap,u=new WeakMap,n=new WeakMap,D=new WeakMap,x=new WeakMap,CI=new WeakMap,bI=new WeakMap,sI=new WeakMap,YI=new WeakMap,XI=new WeakMap,aI=new WeakMap,f=new WeakMap,$=new WeakMap,w=new WeakMap,p=new WeakMap,v=new WeakMap,q=new WeakMap,mI=new WeakMap,NI=new WeakMap,hI=new WeakMap,E=new WeakSet,aC=function(){window.addEventListener("focus",I(this,bI)),window.addEventListener("blur",I(this,CI))},Tg=function(){window.removeEventListener("focus",I(this,bI)),window.removeEventListener("blur",I(this,CI))},Qg=function(){window.addEventListener("keydown",I(this,aI),{capture:!0})},hg=function(){window.removeEventListener("keydown",I(this,aI),{capture:!0})},jg=function(){document.addEventListener("copy",I(this,sI)),document.addEventListener("cut",I(this,YI)),document.addEventListener("paste",I(this,XI))},xg=function(){document.removeEventListener("copy",I(this,sI)),document.removeEventListener("cut",I(this,YI)),document.removeEventListener("paste",I(this,XI))},$I=function(S){Object.entries(S).some(([HI,SI])=>I(this,v)[HI]!==SI)&&this._eventBus.dispatch("annotationeditorstateschanged",{source:this,details:Object.assign(I(this,v),S)})},sg=function(S){this._eventBus.dispatch("annotationeditorparamschanged",{source:this,details:S})},NC=function(){if(!I(this,C)){gI(this,C,!0);for(const S of I(this,K).values())S.enable()}},RC=function(){if(this.unselectAll(),I(this,C)){gI(this,C,!1);for(const S of I(this,K).values())S.disable()}},Og=function(S){const BI=I(this,K).get(S.pageIndex);BI?BI.addOrRebuild(S):this.addEditor(S)},mg=function(){if(I(this,X).size===0)return!0;if(I(this,X).size===1)for(const S of I(this,X).values())return S.isEmpty();return!1},Ug=function(S){I(this,D).clear();for(const BI of S)BI.isEmpty()||(I(this,D).add(BI),BI.select());O(this,E,$I).call(this,{hasSelectedEditor:!0})},fI(OI,"TRANSLATE_SMALL",1),fI(OI,"TRANSLATE_BIG",10);let J=OI;b.AnnotationEditorUIManager=J},(wI,b,ZI)=>{var T,dI,M,k,P,N,g,C,m,u,n,D,dg,Gg,vg,ag,Ng,Wg,Bg;Object.defineProperty(b,"__esModule",{value:!0}),b.StatTimer=b.RenderingCancelledException=b.PixelsPerInch=b.PageViewport=b.PDFDateString=b.DOMStandardFontDataFactory=b.DOMSVGFactory=b.DOMFilterFactory=b.DOMCanvasFactory=b.DOMCMapReaderFactory=void 0,b.deprecated=A,b.getColorValues=X,b.getCurrentTransform=K,b.getCurrentTransformInverse=lI,b.getFilenameFromUrl=s,b.getPdfFilenameFromUrl=Y,b.getRGB=l,b.getXfaPageViewport=F,b.isDataScheme=y,b.isPdfFile=B,b.isValidFetchUrl=h,b.loadScript=i,b.noContextMenu=Z,b.setLayerDimensions=j;var G=ZI(7),R=ZI(1);const cI="http://www.w3.org/2000/svg",r=class r{};fI(r,"CSS",96),fI(r,"PDF",72),fI(r,"PDF_TO_CSS_UNITS",r.CSS/r.PDF);let U=r;b.PixelsPerInch=U;class WI extends G.BaseFilterFactory{constructor({docId:w,ownerDocument:p=globalThis.document}={}){super();_(this,D);_(this,T);_(this,dI);_(this,M);_(this,k);_(this,P);_(this,N);_(this,g);_(this,C);_(this,m);_(this,u);_(this,n,0);gI(this,M,w),gI(this,k,p)}addFilter(w){if(!w)return"none";let p=I(this,D,dg).get(w);if(p)return p;let v,q,mI,NI;if(w.length===1){const yI=w[0],TI=new Array(256);for(let LI=0;LI<256;LI++)TI[LI]=yI[LI]/255;NI=v=q=mI=TI.join(",")}else{const[yI,TI,LI]=w,UI=new Array(256),eI=new Array(256),JI=new Array(256);for(let vI=0;vI<256;vI++)UI[vI]=yI[vI]/255,eI[vI]=TI[vI]/255,JI[vI]=LI[vI]/255;v=UI.join(","),q=eI.join(","),mI=JI.join(","),NI=`${v}${q}${mI}`}if(p=I(this,D,dg).get(NI),p)return I(this,D,dg).set(w,p),p;const hI=`g_${I(this,M)}_transfer_map_${bg(this,n)._++}`,E=`url(#${hI})`;I(this,D,dg).set(w,E),I(this,D,dg).set(NI,E);const MI=O(this,D,ag).call(this,hI);return O(this,D,Wg).call(this,v,q,mI,MI),E}addHCMFilter(w,p){var TI;const v=`${w}-${p}`;if(I(this,N)===v)return I(this,g);if(gI(this,N,v),gI(this,g,"none"),(TI=I(this,P))==null||TI.remove(),!w||!p)return I(this,g);const q=O(this,D,Bg).call(this,w);w=R.Util.makeHexColor(...q);const mI=O(this,D,Bg).call(this,p);if(p=R.Util.makeHexColor(...mI),I(this,D,Gg).style.color="",w==="#000000"&&p==="#ffffff"||w===p)return I(this,g);const NI=new Array(256);for(let LI=0;LI<=255;LI++){const UI=LI/255;NI[LI]=UI<=.03928?UI/12.92:((UI+.055)/1.055)**2.4}const hI=NI.join(","),E=`g_${I(this,M)}_hcm_filter`,MI=gI(this,C,O(this,D,ag).call(this,E));O(this,D,Wg).call(this,hI,hI,hI,MI),O(this,D,vg).call(this,MI);const yI=(LI,UI)=>{const eI=q[LI]/255,JI=mI[LI]/255,vI=new Array(UI+1);for(let rI=0;rI<=UI;rI++)vI[rI]=eI+rI/UI*(JI-eI);return vI.join(",")};return O(this,D,Wg).call(this,yI(0,5),yI(1,5),yI(2,5),MI),gI(this,g,`url(#${E})`),I(this,g)}addHighlightHCMFilter(w,p,v,q){var JI;const mI=`${w}-${p}-${v}-${q}`;if(I(this,m)===mI)return I(this,u);if(gI(this,m,mI),gI(this,u,"none"),(JI=I(this,C))==null||JI.remove(),!w||!p)return I(this,u);const[NI,hI]=[w,p].map(O(this,D,Bg).bind(this));let E=Math.round(.2126*NI[0]+.7152*NI[1]+.0722*NI[2]),MI=Math.round(.2126*hI[0]+.7152*hI[1]+.0722*hI[2]),[yI,TI]=[v,q].map(O(this,D,Bg).bind(this));MI<E&&([E,MI,yI,TI]=[MI,E,TI,yI]),I(this,D,Gg).style.color="";const LI=(vI,rI,VI)=>{const II=new Array(256),AI=(MI-E)/VI,DI=vI/255,OI=(rI-vI)/(255*VI);let xI=0;for(let S=0;S<=VI;S++){const BI=Math.round(E+S*AI),HI=DI+S*OI;for(let SI=xI;SI<=BI;SI++)II[SI]=HI;xI=BI+1}for(let S=xI;S<256;S++)II[S]=II[xI-1];return II.join(",")},UI=`g_${I(this,M)}_hcm_highlight_filter`,eI=gI(this,C,O(this,D,ag).call(this,UI));return O(this,D,vg).call(this,eI),O(this,D,Wg).call(this,LI(yI[0],TI[0],5),LI(yI[1],TI[1],5),LI(yI[2],TI[2],5),eI),gI(this,u,`url(#${UI})`),I(this,u)}destroy(w=!1){w&&(I(this,g)||I(this,u))||(I(this,dI)&&(I(this,dI).parentNode.parentNode.remove(),gI(this,dI,null)),I(this,T)&&(I(this,T).clear(),gI(this,T,null)),gI(this,n,0))}}T=new WeakMap,dI=new WeakMap,M=new WeakMap,k=new WeakMap,P=new WeakMap,N=new WeakMap,g=new WeakMap,C=new WeakMap,m=new WeakMap,u=new WeakMap,n=new WeakMap,D=new WeakSet,dg=function(){return I(this,T)||gI(this,T,new Map)},Gg=function(){if(!I(this,dI)){const w=I(this,k).createElement("div"),{style:p}=w;p.visibility="hidden",p.contain="strict",p.width=p.height=0,p.position="absolute",p.top=p.left=0,p.zIndex=-1;const v=I(this,k).createElementNS(cI,"svg");v.setAttribute("width",0),v.setAttribute("height",0),gI(this,dI,I(this,k).createElementNS(cI,"defs")),w.append(v),v.append(I(this,dI)),I(this,k).body.append(w)}return I(this,dI)},vg=function(w){const p=I(this,k).createElementNS(cI,"feColorMatrix");p.setAttribute("type","matrix"),p.setAttribute("values","0.2126 0.7152 0.0722 0 0 0.2126 0.7152 0.0722 0 0 0.2126 0.7152 0.0722 0 0 0 0 0 1 0"),w.append(p)},ag=function(w){const p=I(this,k).createElementNS(cI,"filter");return p.setAttribute("color-interpolation-filters","sRGB"),p.setAttribute("id",w),I(this,D,Gg).append(p),p},Ng=function(w,p,v){const q=I(this,k).createElementNS(cI,p);q.setAttribute("type","discrete"),q.setAttribute("tableValues",v),w.append(q)},Wg=function(w,p,v,q){const mI=I(this,k).createElementNS(cI,"feComponentTransfer");q.append(mI),O(this,D,Ng).call(this,mI,"feFuncR",w),O(this,D,Ng).call(this,mI,"feFuncG",p),O(this,D,Ng).call(this,mI,"feFuncB",v)},Bg=function(w){return I(this,D,Gg).style.color=w,l(getComputedStyle(I(this,D,Gg)).getPropertyValue("color"))},b.DOMFilterFactory=WI;class L extends G.BaseCanvasFactory{constructor({ownerDocument:$=globalThis.document}={}){super(),this._document=$}_createCanvas($,w){const p=this._document.createElement("canvas");return p.width=$,p.height=w,p}}b.DOMCanvasFactory=L;async function e(f,$=!1){if(h(f,document.baseURI)){const w=await fetch(f);if(!w.ok)throw new Error(w.statusText);return $?new Uint8Array(await w.arrayBuffer()):(0,R.stringToBytes)(await w.text())}return new Promise((w,p)=>{const v=new XMLHttpRequest;v.open("GET",f,!0),$&&(v.responseType="arraybuffer"),v.onreadystatechange=()=>{if(v.readyState===XMLHttpRequest.DONE){if(v.status===200||v.status===0){let q;if($&&v.response?q=new Uint8Array(v.response):!$&&v.responseText&&(q=(0,R.stringToBytes)(v.responseText)),q){w(q);return}}p(new Error(v.statusText))}},v.send(null)})}class W extends G.BaseCMapReaderFactory{_fetchData($,w){return e($,this.isCompressed).then(p=>({cMapData:p,compressionType:w}))}}b.DOMCMapReaderFactory=W;class z extends G.BaseStandardFontDataFactory{_fetchData($){return e($,!0)}}b.DOMStandardFontDataFactory=z;class J extends G.BaseSVGFactory{_createSVG($){return document.createElementNS(cI,$)}}b.DOMSVGFactory=J;class V{constructor({viewBox:$,scale:w,rotation:p,offsetX:v=0,offsetY:q=0,dontFlip:mI=!1}){this.viewBox=$,this.scale=w,this.rotation=p,this.offsetX=v,this.offsetY=q;const NI=($[2]+$[0])/2,hI=($[3]+$[1])/2;let E,MI,yI,TI;switch(p%=360,p<0&&(p+=360),p){case 180:E=-1,MI=0,yI=0,TI=1;break;case 90:E=0,MI=1,yI=1,TI=0;break;case 270:E=0,MI=-1,yI=-1,TI=0;break;case 0:E=1,MI=0,yI=0,TI=-1;break;default:throw new Error("PageViewport: Invalid rotation, must be a multiple of 90 degrees.")}mI&&(yI=-yI,TI=-TI);let LI,UI,eI,JI;E===0?(LI=Math.abs(hI-$[1])*w+v,UI=Math.abs(NI-$[0])*w+q,eI=($[3]-$[1])*w,JI=($[2]-$[0])*w):(LI=Math.abs(NI-$[0])*w+v,UI=Math.abs(hI-$[1])*w+q,eI=($[2]-$[0])*w,JI=($[3]-$[1])*w),this.transform=[E*w,MI*w,yI*w,TI*w,LI-E*w*NI-yI*w*hI,UI-MI*w*NI-TI*w*hI],this.width=eI,this.height=JI}get rawDims(){const{viewBox:$}=this;return(0,R.shadow)(this,"rawDims",{pageWidth:$[2]-$[0],pageHeight:$[3]-$[1],pageX:$[0],pageY:$[1]})}clone({scale:$=this.scale,rotation:w=this.rotation,offsetX:p=this.offsetX,offsetY:v=this.offsetY,dontFlip:q=!1}={}){return new V({viewBox:this.viewBox.slice(),scale:$,rotation:w,offsetX:p,offsetY:v,dontFlip:q})}convertToViewportPoint($,w){return R.Util.applyTransform([$,w],this.transform)}convertToViewportRectangle($){const w=R.Util.applyTransform([$[0],$[1]],this.transform),p=R.Util.applyTransform([$[2],$[3]],this.transform);return[w[0],w[1],p[0],p[1]]}convertToPdfPoint($,w){return R.Util.applyInverseTransform([$,w],this.transform)}}b.PageViewport=V;class o extends R.BaseException{constructor($,w=0){super($,"RenderingCancelledException"),this.extraDelay=w}}b.RenderingCancelledException=o;function y(f){const $=f.length;let w=0;for(;w<$&&f[w].trim()==="";)w++;return f.substring(w,w+5).toLowerCase()==="data:"}function B(f){return typeof f=="string"&&/\.pdf$/i.test(f)}function s(f,$=!1){return $||([f]=f.split(/[#?]/,1)),f.substring(f.lastIndexOf("/")+1)}function Y(f,$="document.pdf"){if(typeof f!="string")return $;if(y(f))return(0,R.warn)('getPdfFilenameFromUrl: ignore "data:"-URL for performance reasons.'),$;const w=/^(?:(?:[^:]+:)?\/\/[^/]+)?([^?#]*)(\?[^#]*)?(#.*)?$/,p=/[^/?#=]+\.pdf\b(?!.*\.pdf\b)/i,v=w.exec(f);let q=p.exec(v[1])||p.exec(v[2])||p.exec(v[3]);if(q&&(q=q[0],q.includes("%")))try{q=p.exec(decodeURIComponent(q))[0]}catch{}return q||$}class t{constructor(){fI(this,"started",Object.create(null));fI(this,"times",[])}time($){$ in this.started&&(0,R.warn)(`Timer is already running for ${$}`),this.started[$]=Date.now()}timeEnd($){$ in this.started||(0,R.warn)(`Timer has not been started for ${$}`),this.times.push({name:$,start:this.started[$],end:Date.now()}),delete this.started[$]}toString(){const $=[];let w=0;for(const{name:p}of this.times)w=Math.max(p.length,w);for(const{name:p,start:v,end:q}of this.times)$.push(`${p.padEnd(w)} ${q-v}ms
`);return $.join("")}}b.StatTimer=t;function h(f,$){try{const{protocol:w}=$?new URL(f,$):new URL(f);return w==="http:"||w==="https:"}catch{return!1}}function Z(f){f.preventDefault()}function i(f,$=!1){return new Promise((w,p)=>{const v=document.createElement("script");v.src=f,v.onload=function(q){$&&v.remove(),w(q)},v.onerror=function(){p(new Error(`Cannot load script at: ${v.src}`))},(document.head||document.documentElement).append(v)})}function A(f){console.log("Deprecated API usage: "+f)}let d;class c{static toDateObject($){if(!$||typeof $!="string")return null;d||(d=new RegExp("^D:(\\d{4})(\\d{2})?(\\d{2})?(\\d{2})?(\\d{2})?(\\d{2})?([Z|+|-])?(\\d{2})?'?(\\d{2})?'?"));const w=d.exec($);if(!w)return null;const p=parseInt(w[1],10);let v=parseInt(w[2],10);v=v>=1&&v<=12?v-1:0;let q=parseInt(w[3],10);q=q>=1&&q<=31?q:1;let mI=parseInt(w[4],10);mI=mI>=0&&mI<=23?mI:0;let NI=parseInt(w[5],10);NI=NI>=0&&NI<=59?NI:0;let hI=parseInt(w[6],10);hI=hI>=0&&hI<=59?hI:0;const E=w[7]||"Z";let MI=parseInt(w[8],10);MI=MI>=0&&MI<=23?MI:0;let yI=parseInt(w[9],10)||0;return yI=yI>=0&&yI<=59?yI:0,E==="-"?(mI+=MI,NI+=yI):E==="+"&&(mI-=MI,NI-=yI),new Date(Date.UTC(p,v,q,mI,NI,hI))}}b.PDFDateString=c;function F(f,{scale:$=1,rotation:w=0}){const{width:p,height:v}=f.attributes.style,q=[0,0,parseInt(p),parseInt(v)];return new V({viewBox:q,scale:$,rotation:w})}function l(f){if(f.startsWith("#")){const $=parseInt(f.slice(1),16);return[($&16711680)>>16,($&65280)>>8,$&255]}return f.startsWith("rgb(")?f.slice(4,-1).split(",").map($=>parseInt($)):f.startsWith("rgba(")?f.slice(5,-1).split(",").map($=>parseInt($)).slice(0,3):((0,R.warn)(`Not a valid color format: "${f}"`),[0,0,0])}function X(f){const $=document.createElement("span");$.style.visibility="hidden",document.body.append($);for(const w of f.keys()){$.style.color=w;const p=window.getComputedStyle($).color;f.set(w,l(p))}$.remove()}function K(f){const{a:$,b:w,c:p,d:v,e:q,f:mI}=f.getTransform();return[$,w,p,v,q,mI]}function lI(f){const{a:$,b:w,c:p,d:v,e:q,f:mI}=f.getTransform().invertSelf();return[$,w,p,v,q,mI]}function j(f,$,w=!1,p=!0){if($ instanceof V){const{pageWidth:v,pageHeight:q}=$.rawDims,{style:mI}=f,NI=R.FeatureTest.isCSSRoundSupported,hI=`var(--scale-factor) * ${v}px`,E=`var(--scale-factor) * ${q}px`,MI=NI?`round(${hI}, 1px)`:`calc(${hI})`,yI=NI?`round(${E}, 1px)`:`calc(${E})`;!w||$.rotation%180===0?(mI.width=MI,mI.height=yI):(mI.width=yI,mI.height=MI)}p&&f.setAttribute("data-main-rotation",$.rotation)}},(wI,b,ZI)=>{Object.defineProperty(b,"__esModule",{value:!0}),b.BaseStandardFontDataFactory=b.BaseSVGFactory=b.BaseFilterFactory=b.BaseCanvasFactory=b.BaseCMapReaderFactory=void 0;var G=ZI(1);class R{constructor(){this.constructor===R&&(0,G.unreachable)("Cannot initialize BaseFilterFactory.")}addFilter(W){return"none"}addHCMFilter(W,z){return"none"}addHighlightHCMFilter(W,z,J,V){return"none"}destroy(W=!1){}}b.BaseFilterFactory=R;class cI{constructor(){this.constructor===cI&&(0,G.unreachable)("Cannot initialize BaseCanvasFactory.")}create(W,z){if(W<=0||z<=0)throw new Error("Invalid canvas size");const J=this._createCanvas(W,z);return{canvas:J,context:J.getContext("2d")}}reset(W,z,J){if(!W.canvas)throw new Error("Canvas is not specified");if(z<=0||J<=0)throw new Error("Invalid canvas size");W.canvas.width=z,W.canvas.height=J}destroy(W){if(!W.canvas)throw new Error("Canvas is not specified");W.canvas.width=0,W.canvas.height=0,W.canvas=null,W.context=null}_createCanvas(W,z){(0,G.unreachable)("Abstract method `_createCanvas` called.")}}b.BaseCanvasFactory=cI;class U{constructor({baseUrl:W=null,isCompressed:z=!0}){this.constructor===U&&(0,G.unreachable)("Cannot initialize BaseCMapReaderFactory."),this.baseUrl=W,this.isCompressed=z}async fetch({name:W}){if(!this.baseUrl)throw new Error('The CMap "baseUrl" parameter must be specified, ensure that the "cMapUrl" and "cMapPacked" API parameters are provided.');if(!W)throw new Error("CMap name must be specified.");const z=this.baseUrl+W+(this.isCompressed?".bcmap":""),J=this.isCompressed?G.CMapCompressionType.BINARY:G.CMapCompressionType.NONE;return this._fetchData(z,J).catch(V=>{throw new Error(`Unable to load ${this.isCompressed?"binary ":""}CMap at: ${z}`)})}_fetchData(W,z){(0,G.unreachable)("Abstract method `_fetchData` called.")}}b.BaseCMapReaderFactory=U;class WI{constructor({baseUrl:W=null}){this.constructor===WI&&(0,G.unreachable)("Cannot initialize BaseStandardFontDataFactory."),this.baseUrl=W}async fetch({filename:W}){if(!this.baseUrl)throw new Error('The standard font "baseUrl" parameter must be specified, ensure that the "standardFontDataUrl" API parameter is provided.');if(!W)throw new Error("Font filename must be specified.");const z=`${this.baseUrl}${W}`;return this._fetchData(z).catch(J=>{throw new Error(`Unable to load font data at: ${z}`)})}_fetchData(W){(0,G.unreachable)("Abstract method `_fetchData` called.")}}b.BaseStandardFontDataFactory=WI;class L{constructor(){this.constructor===L&&(0,G.unreachable)("Cannot initialize BaseSVGFactory.")}create(W,z,J=!1){if(W<=0||z<=0)throw new Error("Invalid SVG dimensions");const V=this._createSVG("svg:svg");return V.setAttribute("version","1.1"),J||(V.setAttribute("width",`${W}px`),V.setAttribute("height",`${z}px`)),V.setAttribute("preserveAspectRatio","none"),V.setAttribute("viewBox",`0 0 ${W} ${z}`),V}createElement(W){if(typeof W!="string")throw new Error("Invalid SVG element type");return this._createSVG(W)}_createSVG(W){(0,G.unreachable)("Abstract method `_createSVG` called.")}}b.BaseSVGFactory=L},(wI,b,ZI)=>{Object.defineProperty(b,"__esModule",{value:!0}),b.MurmurHash3_64=void 0;var G=ZI(1);const R=3285377520,cI=4294901760,U=65535;class WI{constructor(e){this.h1=e?e&4294967295:R,this.h2=e?e&4294967295:R}update(e){let W,z;if(typeof e=="string"){W=new Uint8Array(e.length*2),z=0;for(let A=0,d=e.length;A<d;A++){const c=e.charCodeAt(A);c<=255?W[z++]=c:(W[z++]=c>>>8,W[z++]=c&255)}}else if((0,G.isArrayBuffer)(e))W=e.slice(),z=W.byteLength;else throw new Error("Wrong data format in MurmurHash3_64_update. Input must be a string or array.");const J=z>>2,V=z-J*4,o=new Uint32Array(W.buffer,0,J);let y=0,B=0,s=this.h1,Y=this.h2;const t=3432918353,h=461845907,Z=t&U,i=h&U;for(let A=0;A<J;A++)A&1?(y=o[A],y=y*t&cI|y*Z&U,y=y<<15|y>>>17,y=y*h&cI|y*i&U,s^=y,s=s<<13|s>>>19,s=s*5+3864292196):(B=o[A],B=B*t&cI|B*Z&U,B=B<<15|B>>>17,B=B*h&cI|B*i&U,Y^=B,Y=Y<<13|Y>>>19,Y=Y*5+3864292196);switch(y=0,V){case 3:y^=W[J*4+2]<<16;case 2:y^=W[J*4+1]<<8;case 1:y^=W[J*4],y=y*t&cI|y*Z&U,y=y<<15|y>>>17,y=y*h&cI|y*i&U,J&1?s^=y:Y^=y}this.h1=s,this.h2=Y}hexdigest(){let e=this.h1,W=this.h2;return e^=W>>>1,e=e*3981806797&cI|e*36045&U,W=W*4283543511&cI|((W<<16|e>>>16)*2950163797&cI)>>>16,e^=W>>>1,e=e*444984403&cI|e*60499&U,W=W*3301882366&cI|((W<<16|e>>>16)*3120437893&cI)>>>16,e^=W>>>1,(e>>>0).toString(16).padStart(8,"0")+(W>>>0).toString(16).padStart(8,"0")}}b.MurmurHash3_64=WI},(wI,b,ZI)=>{var U;Object.defineProperty(b,"__esModule",{value:!0}),b.FontLoader=b.FontFaceObject=void 0;var G=ZI(1);class R{constructor({ownerDocument:L=globalThis.document,styleElement:e=null}){_(this,U,new Set);this._document=L,this.nativeFontFaces=new Set,this.styleElement=null,this.loadingRequests=[],this.loadTestFontId=0}addNativeFontFace(L){this.nativeFontFaces.add(L),this._document.fonts.add(L)}removeNativeFontFace(L){this.nativeFontFaces.delete(L),this._document.fonts.delete(L)}insertRule(L){this.styleElement||(this.styleElement=this._document.createElement("style"),this._document.documentElement.getElementsByTagName("head")[0].append(this.styleElement));const e=this.styleElement.sheet;e.insertRule(L,e.cssRules.length)}clear(){for(const L of this.nativeFontFaces)this._document.fonts.delete(L);this.nativeFontFaces.clear(),I(this,U).clear(),this.styleElement&&(this.styleElement.remove(),this.styleElement=null)}async loadSystemFont(L){if(!(!L||I(this,U).has(L.loadedName))){if((0,G.assert)(!this.disableFontFace,"loadSystemFont shouldn't be called when `disableFontFace` is set."),this.isFontLoadingAPISupported){const{loadedName:e,src:W,style:z}=L,J=new FontFace(e,W,z);this.addNativeFontFace(J);try{await J.load(),I(this,U).add(e)}catch{(0,G.warn)(`Cannot load system font: ${L.baseFontName}, installing it could help to improve PDF rendering.`),this.removeNativeFontFace(J)}return}(0,G.unreachable)("Not implemented: loadSystemFont without the Font Loading API.")}}async bind(L){if(L.attached||L.missingFile&&!L.systemFontInfo)return;if(L.attached=!0,L.systemFontInfo){await this.loadSystemFont(L.systemFontInfo);return}if(this.isFontLoadingAPISupported){const W=L.createNativeFontFace();if(W){this.addNativeFontFace(W);try{await W.loaded}catch(z){throw(0,G.warn)(`Failed to load font '${W.family}': '${z}'.`),L.disableFontFace=!0,z}}return}const e=L.createFontFaceRule();if(e){if(this.insertRule(e),this.isSyncFontLoadingSupported)return;await new Promise(W=>{const z=this._queueLoadingCallback(W);this._prepareFontLoadEvent(L,z)})}}get isFontLoadingAPISupported(){var e;const L=!!((e=this._document)!=null&&e.fonts);return(0,G.shadow)(this,"isFontLoadingAPISupported",L)}get isSyncFontLoadingSupported(){let L=!1;return(G.isNodeJS||typeof navigator<"u"&&/Mozilla\/5.0.*?rv:\d+.*? Gecko/.test(navigator.userAgent))&&(L=!0),(0,G.shadow)(this,"isSyncFontLoadingSupported",L)}_queueLoadingCallback(L){function e(){for((0,G.assert)(!z.done,"completeRequest() cannot be called twice."),z.done=!0;W.length>0&&W[0].done;){const J=W.shift();setTimeout(J.callback,0)}}const{loadingRequests:W}=this,z={done:!1,complete:e,callback:L};return W.push(z),z}get _loadTestFont(){const L=atob("T1RUTwALAIAAAwAwQ0ZGIDHtZg4AAAOYAAAAgUZGVE1lkzZwAAAEHAAAABxHREVGABQAFQAABDgAAAAeT1MvMlYNYwkAAAEgAAAAYGNtYXABDQLUAAACNAAAAUJoZWFk/xVFDQAAALwAAAA2aGhlYQdkA+oAAAD0AAAAJGhtdHgD6AAAAAAEWAAAAAZtYXhwAAJQAAAAARgAAAAGbmFtZVjmdH4AAAGAAAAAsXBvc3T/hgAzAAADeAAAACAAAQAAAAEAALZRFsRfDzz1AAsD6AAAAADOBOTLAAAAAM4KHDwAAAAAA+gDIQAAAAgAAgAAAAAAAAABAAADIQAAAFoD6AAAAAAD6AABAAAAAAAAAAAAAAAAAAAAAQAAUAAAAgAAAAQD6AH0AAUAAAKKArwAAACMAooCvAAAAeAAMQECAAACAAYJAAAAAAAAAAAAAQAAAAAAAAAAAAAAAFBmRWQAwAAuAC4DIP84AFoDIQAAAAAAAQAAAAAAAAAAACAAIAABAAAADgCuAAEAAAAAAAAAAQAAAAEAAAAAAAEAAQAAAAEAAAAAAAIAAQAAAAEAAAAAAAMAAQAAAAEAAAAAAAQAAQAAAAEAAAAAAAUAAQAAAAEAAAAAAAYAAQAAAAMAAQQJAAAAAgABAAMAAQQJAAEAAgABAAMAAQQJAAIAAgABAAMAAQQJAAMAAgABAAMAAQQJAAQAAgABAAMAAQQJAAUAAgABAAMAAQQJAAYAAgABWABYAAAAAAAAAwAAAAMAAAAcAAEAAAAAADwAAwABAAAAHAAEACAAAAAEAAQAAQAAAC7//wAAAC7////TAAEAAAAAAAABBgAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAMAAAAAAAD/gwAyAAAAAQAAAAAAAAAAAAAAAAAAAAABAAQEAAEBAQJYAAEBASH4DwD4GwHEAvgcA/gXBIwMAYuL+nz5tQXkD5j3CBLnEQACAQEBIVhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYAAABAQAADwACAQEEE/t3Dov6fAH6fAT+fPp8+nwHDosMCvm1Cvm1DAz6fBQAAAAAAAABAAAAAMmJbzEAAAAAzgTjFQAAAADOBOQpAAEAAAAAAAAADAAUAAQAAAABAAAAAgABAAAAAAAAAAAD6AAAAAAAAA==");return(0,G.shadow)(this,"_loadTestFont",L)}_prepareFontLoadEvent(L,e){function W(l,X){return l.charCodeAt(X)<<24|l.charCodeAt(X+1)<<16|l.charCodeAt(X+2)<<8|l.charCodeAt(X+3)&255}function z(l,X,K,lI){const j=l.substring(0,X),r=l.substring(X+K);return j+lI+r}let J,V;const o=this._document.createElement("canvas");o.width=1,o.height=1;const y=o.getContext("2d");let B=0;function s(l,X){if(++B>30){(0,G.warn)("Load test font never loaded."),X();return}if(y.font="30px "+l,y.fillText(".",0,20),y.getImageData(0,0,1,1).data[3]>0){X();return}setTimeout(s.bind(null,l,X))}const Y=`lt${Date.now()}${this.loadTestFontId++}`;let t=this._loadTestFont;t=z(t,976,Y.length,Y);const Z=16,i=1482184792;let A=W(t,Z);for(J=0,V=Y.length-3;J<V;J+=4)A=A-i+W(Y,J)|0;J<Y.length&&(A=A-i+W(Y+"XXX",J)|0),t=z(t,Z,4,(0,G.string32)(A));const d=`url(data:font/opentype;base64,${btoa(t)});`,c=`@font-face {font-family:"${Y}";src:${d}}`;this.insertRule(c);const F=this._document.createElement("div");F.style.visibility="hidden",F.style.width=F.style.height="10px",F.style.position="absolute",F.style.top=F.style.left="0px";for(const l of[L.loadedName,Y]){const X=this._document.createElement("span");X.textContent="Hi",X.style.fontFamily=l,F.append(X)}this._document.body.append(F),s(Y,()=>{F.remove(),e.complete()})}}U=new WeakMap,b.FontLoader=R;class cI{constructor(L,{isEvalSupported:e=!0,disableFontFace:W=!1,ignoreErrors:z=!1,inspectFont:J=null}){this.compiledGlyphs=Object.create(null);for(const V in L)this[V]=L[V];this.isEvalSupported=e!==!1,this.disableFontFace=W===!0,this.ignoreErrors=z===!0,this._inspectFont=J}createNativeFontFace(){var e;if(!this.data||this.disableFontFace)return null;let L;if(!this.cssFontInfo)L=new FontFace(this.loadedName,this.data,{});else{const W={weight:this.cssFontInfo.fontWeight};this.cssFontInfo.italicAngle&&(W.style=`oblique ${this.cssFontInfo.italicAngle}deg`),L=new FontFace(this.cssFontInfo.fontFamily,this.data,W)}return(e=this._inspectFont)==null||e.call(this,this),L}createFontFaceRule(){var z;if(!this.data||this.disableFontFace)return null;const L=(0,G.bytesToString)(this.data),e=`url(data:${this.mimetype};base64,${btoa(L)});`;let W;if(!this.cssFontInfo)W=`@font-face {font-family:"${this.loadedName}";src:${e}}`;else{let J=`font-weight: ${this.cssFontInfo.fontWeight};`;this.cssFontInfo.italicAngle&&(J+=`font-style: oblique ${this.cssFontInfo.italicAngle}deg;`),W=`@font-face {font-family:"${this.cssFontInfo.fontFamily}";${J}src:${e}}`}return(z=this._inspectFont)==null||z.call(this,this,e),W}getPathGenerator(L,e){if(this.compiledGlyphs[e]!==void 0)return this.compiledGlyphs[e];let W;try{W=L.get(this.loadedName+"_path_"+e)}catch(z){if(!this.ignoreErrors)throw z;return(0,G.warn)(`getPathGenerator - ignoring character: "${z}".`),this.compiledGlyphs[e]=function(J,V){}}if(this.isEvalSupported&&G.FeatureTest.isEvalSupported){const z=[];for(const J of W){const V=J.args!==void 0?J.args.join(","):"";z.push("c.",J.cmd,"(",V,`);
`)}return this.compiledGlyphs[e]=new Function("c","size",z.join(""))}return this.compiledGlyphs[e]=function(z,J){for(const V of W)V.cmd==="scale"&&(V.args=[J,-J]),z[V.cmd].apply(z,V.args)}}}b.FontFaceObject=cI},(wI,b,ZI)=>{Object.defineProperty(b,"__esModule",{value:!0}),b.NodeStandardFontDataFactory=b.NodeFilterFactory=b.NodeCanvasFactory=b.NodeCMapReaderFactory=void 0;var G=ZI(7);ZI(1);const R=function(e){return new Promise((W,z)=>{require$$5.readFile(e,(V,o)=>{if(V||!o){z(new Error(V));return}W(new Uint8Array(o))})})};class cI extends G.BaseFilterFactory{}b.NodeFilterFactory=cI;class U extends G.BaseCanvasFactory{_createCanvas(W,z){return require$$5.createCanvas(W,z)}}b.NodeCanvasFactory=U;class WI extends G.BaseCMapReaderFactory{_fetchData(W,z){return R(W).then(J=>({cMapData:J,compressionType:z}))}}b.NodeCMapReaderFactory=WI;class L extends G.BaseStandardFontDataFactory{_fetchData(W){return R(W)}}b.NodeStandardFontDataFactory=L},(wI,b,ZI)=>{var dI,Eg,rg;Object.defineProperty(b,"__esModule",{value:!0}),b.CanvasGraphics=void 0;var G=ZI(1),R=ZI(6),cI=ZI(12),U=ZI(13);const WI=16,L=100,e=4096,W=15,z=10,J=1e3,V=16;function o(N,g){if(N._removeMirroring)throw new Error("Context is already forwarding operations.");N.__originalSave=N.save,N.__originalRestore=N.restore,N.__originalRotate=N.rotate,N.__originalScale=N.scale,N.__originalTranslate=N.translate,N.__originalTransform=N.transform,N.__originalSetTransform=N.setTransform,N.__originalResetTransform=N.resetTransform,N.__originalClip=N.clip,N.__originalMoveTo=N.moveTo,N.__originalLineTo=N.lineTo,N.__originalBezierCurveTo=N.bezierCurveTo,N.__originalRect=N.rect,N.__originalClosePath=N.closePath,N.__originalBeginPath=N.beginPath,N._removeMirroring=()=>{N.save=N.__originalSave,N.restore=N.__originalRestore,N.rotate=N.__originalRotate,N.scale=N.__originalScale,N.translate=N.__originalTranslate,N.transform=N.__originalTransform,N.setTransform=N.__originalSetTransform,N.resetTransform=N.__originalResetTransform,N.clip=N.__originalClip,N.moveTo=N.__originalMoveTo,N.lineTo=N.__originalLineTo,N.bezierCurveTo=N.__originalBezierCurveTo,N.rect=N.__originalRect,N.closePath=N.__originalClosePath,N.beginPath=N.__originalBeginPath,delete N._removeMirroring},N.save=function(){g.save(),this.__originalSave()},N.restore=function(){g.restore(),this.__originalRestore()},N.translate=function(m,u){g.translate(m,u),this.__originalTranslate(m,u)},N.scale=function(m,u){g.scale(m,u),this.__originalScale(m,u)},N.transform=function(m,u,n,D,x,CI){g.transform(m,u,n,D,x,CI),this.__originalTransform(m,u,n,D,x,CI)},N.setTransform=function(m,u,n,D,x,CI){g.setTransform(m,u,n,D,x,CI),this.__originalSetTransform(m,u,n,D,x,CI)},N.resetTransform=function(){g.resetTransform(),this.__originalResetTransform()},N.rotate=function(m){g.rotate(m),this.__originalRotate(m)},N.clip=function(m){g.clip(m),this.__originalClip(m)},N.moveTo=function(C,m){g.moveTo(C,m),this.__originalMoveTo(C,m)},N.lineTo=function(C,m){g.lineTo(C,m),this.__originalLineTo(C,m)},N.bezierCurveTo=function(C,m,u,n,D,x){g.bezierCurveTo(C,m,u,n,D,x),this.__originalBezierCurveTo(C,m,u,n,D,x)},N.rect=function(C,m,u,n){g.rect(C,m,u,n),this.__originalRect(C,m,u,n)},N.closePath=function(){g.closePath(),this.__originalClosePath()},N.beginPath=function(){g.beginPath(),this.__originalBeginPath()}}class y{constructor(g){this.canvasFactory=g,this.cache=Object.create(null)}getCanvas(g,C,m){let u;return this.cache[g]!==void 0?(u=this.cache[g],this.canvasFactory.reset(u,C,m)):(u=this.canvasFactory.create(C,m),this.cache[g]=u),u}delete(g){delete this.cache[g]}clear(){for(const g in this.cache){const C=this.cache[g];this.canvasFactory.destroy(C),delete this.cache[g]}}}function B(N,g,C,m,u,n,D,x,CI,bI){const[sI,YI,XI,aI,f,$]=(0,R.getCurrentTransform)(N);if(YI===0&&XI===0){const v=D*sI+f,q=Math.round(v),mI=x*aI+$,NI=Math.round(mI),hI=(D+CI)*sI+f,E=Math.abs(Math.round(hI)-q)||1,MI=(x+bI)*aI+$,yI=Math.abs(Math.round(MI)-NI)||1;return N.setTransform(Math.sign(sI),0,0,Math.sign(aI),q,NI),N.drawImage(g,C,m,u,n,0,0,E,yI),N.setTransform(sI,YI,XI,aI,f,$),[E,yI]}if(sI===0&&aI===0){const v=x*XI+f,q=Math.round(v),mI=D*YI+$,NI=Math.round(mI),hI=(x+bI)*XI+f,E=Math.abs(Math.round(hI)-q)||1,MI=(D+CI)*YI+$,yI=Math.abs(Math.round(MI)-NI)||1;return N.setTransform(0,Math.sign(YI),Math.sign(XI),0,q,NI),N.drawImage(g,C,m,u,n,0,0,yI,E),N.setTransform(sI,YI,XI,aI,f,$),[yI,E]}N.drawImage(g,C,m,u,n,D,x,CI,bI);const w=Math.hypot(sI,YI),p=Math.hypot(XI,aI);return[w*CI,p*bI]}function s(N){const{width:g,height:C}=N;if(g>J||C>J)return null;const m=1e3,u=new Uint8Array([0,2,4,0,1,0,5,4,8,10,0,8,0,2,1,0]),n=g+1;let D=new Uint8Array(n*(C+1)),x,CI,bI;const sI=g+7&-8;let YI=new Uint8Array(sI*C),XI=0;for(const p of N.data){let v=128;for(;v>0;)YI[XI++]=p&v?0:255,v>>=1}let aI=0;for(XI=0,YI[XI]!==0&&(D[0]=1,++aI),CI=1;CI<g;CI++)YI[XI]!==YI[XI+1]&&(D[CI]=YI[XI]?2:1,++aI),XI++;for(YI[XI]!==0&&(D[CI]=2,++aI),x=1;x<C;x++){XI=x*sI,bI=x*n,YI[XI-sI]!==YI[XI]&&(D[bI]=YI[XI]?1:8,++aI);let p=(YI[XI]?4:0)+(YI[XI-sI]?8:0);for(CI=1;CI<g;CI++)p=(p>>2)+(YI[XI+1]?4:0)+(YI[XI-sI+1]?8:0),u[p]&&(D[bI+CI]=u[p],++aI),XI++;if(YI[XI-sI]!==YI[XI]&&(D[bI+CI]=YI[XI]?2:4,++aI),aI>m)return null}for(XI=sI*(C-1),bI=x*n,YI[XI]!==0&&(D[bI]=8,++aI),CI=1;CI<g;CI++)YI[XI]!==YI[XI+1]&&(D[bI+CI]=YI[XI]?4:8,++aI),XI++;if(YI[XI]!==0&&(D[bI+CI]=4,++aI),aI>m)return null;const f=new Int32Array([0,n,-1,0,-n,0,0,0,1]),$=new Path2D;for(x=0;aI&&x<=C;x++){let p=x*n;const v=p+g;for(;p<v&&!D[p];)p++;if(p===v)continue;$.moveTo(p%n,x);const q=p;let mI=D[p];do{const NI=f[mI];do p+=NI;while(!D[p]);const hI=D[p];hI!==5&&hI!==10?(mI=hI,D[p]=0):(mI=hI&51*mI>>4,D[p]&=mI>>2|mI<<2),$.lineTo(p%n,p/n|0),D[p]||--aI}while(q!==p);--x}return YI=null,D=null,function(p){p.save(),p.scale(1/g,-1/C),p.translate(0,-C),p.fill($),p.beginPath(),p.restore()}}class Y{constructor(g,C){this.alphaIsShape=!1,this.fontSize=0,this.fontSizeScale=1,this.textMatrix=G.IDENTITY_MATRIX,this.textMatrixScale=1,this.fontMatrix=G.FONT_IDENTITY_MATRIX,this.leading=0,this.x=0,this.y=0,this.lineX=0,this.lineY=0,this.charSpacing=0,this.wordSpacing=0,this.textHScale=1,this.textRenderingMode=G.TextRenderingMode.FILL,this.textRise=0,this.fillColor="#000000",this.strokeColor="#000000",this.patternFill=!1,this.fillAlpha=1,this.strokeAlpha=1,this.lineWidth=1,this.activeSMask=null,this.transferMaps="none",this.startNewPathAndClipBox([0,0,g,C])}clone(){const g=Object.create(this);return g.clipBox=this.clipBox.slice(),g}setCurrentPoint(g,C){this.x=g,this.y=C}updatePathMinMax(g,C,m){[C,m]=G.Util.applyTransform([C,m],g),this.minX=Math.min(this.minX,C),this.minY=Math.min(this.minY,m),this.maxX=Math.max(this.maxX,C),this.maxY=Math.max(this.maxY,m)}updateRectMinMax(g,C){const m=G.Util.applyTransform(C,g),u=G.Util.applyTransform(C.slice(2),g);this.minX=Math.min(this.minX,m[0],u[0]),this.minY=Math.min(this.minY,m[1],u[1]),this.maxX=Math.max(this.maxX,m[0],u[0]),this.maxY=Math.max(this.maxY,m[1],u[1])}updateScalingPathMinMax(g,C){G.Util.scaleMinMax(g,C),this.minX=Math.min(this.minX,C[0]),this.maxX=Math.max(this.maxX,C[1]),this.minY=Math.min(this.minY,C[2]),this.maxY=Math.max(this.maxY,C[3])}updateCurvePathMinMax(g,C,m,u,n,D,x,CI,bI,sI){const YI=G.Util.bezierBoundingBox(C,m,u,n,D,x,CI,bI);if(sI){sI[0]=Math.min(sI[0],YI[0],YI[2]),sI[1]=Math.max(sI[1],YI[0],YI[2]),sI[2]=Math.min(sI[2],YI[1],YI[3]),sI[3]=Math.max(sI[3],YI[1],YI[3]);return}this.updateRectMinMax(g,YI)}getPathBoundingBox(g=cI.PathType.FILL,C=null){const m=[this.minX,this.minY,this.maxX,this.maxY];if(g===cI.PathType.STROKE){C||(0,G.unreachable)("Stroke bounding box must include transform.");const u=G.Util.singularValueDecompose2dScale(C),n=u[0]*this.lineWidth/2,D=u[1]*this.lineWidth/2;m[0]-=n,m[1]-=D,m[2]+=n,m[3]+=D}return m}updateClipFromPath(){const g=G.Util.intersect(this.clipBox,this.getPathBoundingBox());this.startNewPathAndClipBox(g||[0,0,0,0])}isEmptyClip(){return this.minX===1/0}startNewPathAndClipBox(g){this.clipBox=g,this.minX=1/0,this.minY=1/0,this.maxX=0,this.maxY=0}getClippedPathBoundingBox(g=cI.PathType.FILL,C=null){return G.Util.intersect(this.clipBox,this.getPathBoundingBox(g,C))}}function t(N,g){if(typeof ImageData<"u"&&g instanceof ImageData){N.putImageData(g,0,0);return}const C=g.height,m=g.width,u=C%V,n=(C-u)/V,D=u===0?n:n+1,x=N.createImageData(m,V);let CI=0,bI;const sI=g.data,YI=x.data;let XI,aI,f,$;if(g.kind===G.ImageKind.GRAYSCALE_1BPP){const w=sI.byteLength,p=new Uint32Array(YI.buffer,0,YI.byteLength>>2),v=p.length,q=m+7>>3,mI=4294967295,NI=G.FeatureTest.isLittleEndian?4278190080:255;for(XI=0;XI<D;XI++){for(f=XI<n?V:u,bI=0,aI=0;aI<f;aI++){const hI=w-CI;let E=0;const MI=hI>q?m:hI*8-7,yI=MI&-8;let TI=0,LI=0;for(;E<yI;E+=8)LI=sI[CI++],p[bI++]=LI&128?mI:NI,p[bI++]=LI&64?mI:NI,p[bI++]=LI&32?mI:NI,p[bI++]=LI&16?mI:NI,p[bI++]=LI&8?mI:NI,p[bI++]=LI&4?mI:NI,p[bI++]=LI&2?mI:NI,p[bI++]=LI&1?mI:NI;for(;E<MI;E++)TI===0&&(LI=sI[CI++],TI=128),p[bI++]=LI&TI?mI:NI,TI>>=1}for(;bI<v;)p[bI++]=0;N.putImageData(x,0,XI*V)}}else if(g.kind===G.ImageKind.RGBA_32BPP){for(aI=0,$=m*V*4,XI=0;XI<n;XI++)YI.set(sI.subarray(CI,CI+$)),CI+=$,N.putImageData(x,0,aI),aI+=V;XI<D&&($=m*u*4,YI.set(sI.subarray(CI,CI+$)),N.putImageData(x,0,aI))}else if(g.kind===G.ImageKind.RGB_24BPP)for(f=V,$=m*f,XI=0;XI<D;XI++){for(XI>=n&&(f=u,$=m*f),bI=0,aI=$;aI--;)YI[bI++]=sI[CI++],YI[bI++]=sI[CI++],YI[bI++]=sI[CI++],YI[bI++]=255;N.putImageData(x,0,XI*V)}else throw new Error(`bad image kind: ${g.kind}`)}function h(N,g){if(g.bitmap){N.drawImage(g.bitmap,0,0);return}const C=g.height,m=g.width,u=C%V,n=(C-u)/V,D=u===0?n:n+1,x=N.createImageData(m,V);let CI=0;const bI=g.data,sI=x.data;for(let YI=0;YI<D;YI++){const XI=YI<n?V:u;({srcPos:CI}=(0,U.convertBlackAndWhiteToRGBA)({src:bI,srcPos:CI,dest:sI,width:m,height:XI,nonBlackColor:0})),N.putImageData(x,0,YI*V)}}function Z(N,g){const C=["strokeStyle","fillStyle","fillRule","globalAlpha","lineWidth","lineCap","lineJoin","miterLimit","globalCompositeOperation","font","filter"];for(const m of C)N[m]!==void 0&&(g[m]=N[m]);N.setLineDash!==void 0&&(g.setLineDash(N.getLineDash()),g.lineDashOffset=N.lineDashOffset)}function i(N){if(N.strokeStyle=N.fillStyle="#000000",N.fillRule="nonzero",N.globalAlpha=1,N.lineWidth=1,N.lineCap="butt",N.lineJoin="miter",N.miterLimit=10,N.globalCompositeOperation="source-over",N.font="10px sans-serif",N.setLineDash!==void 0&&(N.setLineDash([]),N.lineDashOffset=0),!G.isNodeJS){const{filter:g}=N;g!=="none"&&g!==""&&(N.filter="none")}}function A(N,g,C,m){const u=N.length;for(let n=3;n<u;n+=4){const D=N[n];if(D===0)N[n-3]=g,N[n-2]=C,N[n-1]=m;else if(D<255){const x=255-D;N[n-3]=N[n-3]*D+g*x>>8,N[n-2]=N[n-2]*D+C*x>>8,N[n-1]=N[n-1]*D+m*x>>8}}}function d(N,g,C){const m=N.length,u=1/255;for(let n=3;n<m;n+=4){const D=C?C[N[n]]:N[n];g[n]=g[n]*D*u|0}}function c(N,g,C){const m=N.length;for(let u=3;u<m;u+=4){const n=N[u-3]*77+N[u-2]*152+N[u-1]*28;g[u]=C?g[u]*C[n>>8]>>8:g[u]*n>>16}}function F(N,g,C,m,u,n,D,x,CI,bI,sI){const YI=!!n,XI=YI?n[0]:0,aI=YI?n[1]:0,f=YI?n[2]:0,$=u==="Luminosity"?c:d,p=Math.min(m,Math.ceil(1048576/C));for(let v=0;v<m;v+=p){const q=Math.min(p,m-v),mI=N.getImageData(x-bI,v+(CI-sI),C,q),NI=g.getImageData(x,v+CI,C,q);YI&&A(mI.data,XI,aI,f),$(mI.data,NI.data,D),g.putImageData(NI,x,v+CI)}}function l(N,g,C,m){const u=m[0],n=m[1],D=m[2]-u,x=m[3]-n;D===0||x===0||(F(g.context,C,D,x,g.subtype,g.backdrop,g.transferMap,u,n,g.offsetX,g.offsetY),N.save(),N.globalAlpha=1,N.globalCompositeOperation="source-over",N.setTransform(1,0,0,1,0,0),N.drawImage(C.canvas,0,0),N.restore())}function X(N,g){const C=G.Util.singularValueDecompose2dScale(N);C[0]=Math.fround(C[0]),C[1]=Math.fround(C[1]);const m=Math.fround((globalThis.devicePixelRatio||1)*R.PixelsPerInch.PDF_TO_CSS_UNITS);return g!==void 0?g:C[0]<=m||C[1]<=m}const K=["butt","round","square"],lI=["miter","round","bevel"],j={},r={},P=class P{constructor(g,C,m,u,n,{optionalContentConfig:D,markedContentStack:x=null},CI,bI){_(this,dI);this.ctx=g,this.current=new Y(this.ctx.canvas.width,this.ctx.canvas.height),this.stateStack=[],this.pendingClip=null,this.pendingEOFill=!1,this.res=null,this.xobjs=null,this.commonObjs=C,this.objs=m,this.canvasFactory=u,this.filterFactory=n,this.groupStack=[],this.processingType3=null,this.baseTransform=null,this.baseTransformStack=[],this.groupLevel=0,this.smaskStack=[],this.smaskCounter=0,this.tempSMask=null,this.suspendedCtx=null,this.contentVisible=!0,this.markedContentStack=x||[],this.optionalContentConfig=D,this.cachedCanvases=new y(this.canvasFactory),this.cachedPatterns=new Map,this.annotationCanvasMap=CI,this.viewportScale=1,this.outputScaleX=1,this.outputScaleY=1,this.pageColors=bI,this._cachedScaleForStroking=[-1,0],this._cachedGetSinglePixelWidth=null,this._cachedBitmapsMap=new Map}getObject(g,C=null){return typeof g=="string"?g.startsWith("g_")?this.commonObjs.get(g):this.objs.get(g):C}beginDrawing({transform:g,viewport:C,transparency:m=!1,background:u=null}){const n=this.ctx.canvas.width,D=this.ctx.canvas.height,x=this.ctx.fillStyle;if(this.ctx.fillStyle=u||"#ffffff",this.ctx.fillRect(0,0,n,D),this.ctx.fillStyle=x,m){const CI=this.cachedCanvases.getCanvas("transparent",n,D);this.compositeCtx=this.ctx,this.transparentCanvas=CI.canvas,this.ctx=CI.context,this.ctx.save(),this.ctx.transform(...(0,R.getCurrentTransform)(this.compositeCtx))}this.ctx.save(),i(this.ctx),g&&(this.ctx.transform(...g),this.outputScaleX=g[0],this.outputScaleY=g[0]),this.ctx.transform(...C.transform),this.viewportScale=C.scale,this.baseTransform=(0,R.getCurrentTransform)(this.ctx)}executeOperatorList(g,C,m,u){const n=g.argsArray,D=g.fnArray;let x=C||0;const CI=n.length;if(CI===x)return x;const bI=CI-x>z&&typeof m=="function",sI=bI?Date.now()+W:0;let YI=0;const XI=this.commonObjs,aI=this.objs;let f;for(;;){if(u!==void 0&&x===u.nextBreakPoint)return u.breakIt(x,m),x;if(f=D[x],f!==G.OPS.dependency)this[f].apply(this,n[x]);else for(const $ of n[x]){const w=$.startsWith("g_")?XI:aI;if(!w.has($))return w.get($,m),x}if(x++,x===CI)return x;if(bI&&++YI>z){if(Date.now()>sI)return m(),x;YI=0}}}endDrawing(){O(this,dI,Eg).call(this),this.cachedCanvases.clear(),this.cachedPatterns.clear();for(const g of this._cachedBitmapsMap.values()){for(const C of g.values())typeof HTMLCanvasElement<"u"&&C instanceof HTMLCanvasElement&&(C.width=C.height=0);g.clear()}this._cachedBitmapsMap.clear(),O(this,dI,rg).call(this)}_scaleImage(g,C){const m=g.width,u=g.height;let n=Math.max(Math.hypot(C[0],C[1]),1),D=Math.max(Math.hypot(C[2],C[3]),1),x=m,CI=u,bI="prescale1",sI,YI;for(;n>2&&x>1||D>2&&CI>1;){let XI=x,aI=CI;n>2&&x>1&&(XI=x>=16384?Math.floor(x/2)-1||1:Math.ceil(x/2),n/=x/XI),D>2&&CI>1&&(aI=CI>=16384?Math.floor(CI/2)-1||1:Math.ceil(CI)/2,D/=CI/aI),sI=this.cachedCanvases.getCanvas(bI,XI,aI),YI=sI.context,YI.clearRect(0,0,XI,aI),YI.drawImage(g,0,0,x,CI,0,0,XI,aI),g=sI.canvas,x=XI,CI=aI,bI=bI==="prescale1"?"prescale2":"prescale1"}return{img:g,paintWidth:x,paintHeight:CI}}_createMaskCanvas(g){const C=this.ctx,{width:m,height:u}=g,n=this.current.fillColor,D=this.current.patternFill,x=(0,R.getCurrentTransform)(C);let CI,bI,sI,YI;if((g.bitmap||g.data)&&g.count>1){const E=g.bitmap||g.data.buffer;bI=JSON.stringify(D?x:[x.slice(0,4),n]),CI=this._cachedBitmapsMap.get(E),CI||(CI=new Map,this._cachedBitmapsMap.set(E,CI));const MI=CI.get(bI);if(MI&&!D){const yI=Math.round(Math.min(x[0],x[2])+x[4]),TI=Math.round(Math.min(x[1],x[3])+x[5]);return{canvas:MI,offsetX:yI,offsetY:TI}}sI=MI}sI||(YI=this.cachedCanvases.getCanvas("maskCanvas",m,u),h(YI.context,g));let XI=G.Util.transform(x,[1/m,0,0,-1/u,0,0]);XI=G.Util.transform(XI,[1,0,0,1,0,-u]);const aI=G.Util.applyTransform([0,0],XI),f=G.Util.applyTransform([m,u],XI),$=G.Util.normalizeRect([aI[0],aI[1],f[0],f[1]]),w=Math.round($[2]-$[0])||1,p=Math.round($[3]-$[1])||1,v=this.cachedCanvases.getCanvas("fillCanvas",w,p),q=v.context,mI=Math.min(aI[0],f[0]),NI=Math.min(aI[1],f[1]);q.translate(-mI,-NI),q.transform(...XI),sI||(sI=this._scaleImage(YI.canvas,(0,R.getCurrentTransformInverse)(q)),sI=sI.img,CI&&D&&CI.set(bI,sI)),q.imageSmoothingEnabled=X((0,R.getCurrentTransform)(q),g.interpolate),B(q,sI,0,0,sI.width,sI.height,0,0,m,u),q.globalCompositeOperation="source-in";const hI=G.Util.transform((0,R.getCurrentTransformInverse)(q),[1,0,0,1,-mI,-NI]);return q.fillStyle=D?n.getPattern(C,this,hI,cI.PathType.FILL):n,q.fillRect(0,0,m,u),CI&&!D&&(this.cachedCanvases.delete("fillCanvas"),CI.set(bI,v.canvas)),{canvas:v.canvas,offsetX:Math.round(mI),offsetY:Math.round(NI)}}setLineWidth(g){g!==this.current.lineWidth&&(this._cachedScaleForStroking[0]=-1),this.current.lineWidth=g,this.ctx.lineWidth=g}setLineCap(g){this.ctx.lineCap=K[g]}setLineJoin(g){this.ctx.lineJoin=lI[g]}setMiterLimit(g){this.ctx.miterLimit=g}setDash(g,C){const m=this.ctx;m.setLineDash!==void 0&&(m.setLineDash(g),m.lineDashOffset=C)}setRenderingIntent(g){}setFlatness(g){}setGState(g){for(const[C,m]of g)switch(C){case"LW":this.setLineWidth(m);break;case"LC":this.setLineCap(m);break;case"LJ":this.setLineJoin(m);break;case"ML":this.setMiterLimit(m);break;case"D":this.setDash(m[0],m[1]);break;case"RI":this.setRenderingIntent(m);break;case"FL":this.setFlatness(m);break;case"Font":this.setFont(m[0],m[1]);break;case"CA":this.current.strokeAlpha=m;break;case"ca":this.current.fillAlpha=m,this.ctx.globalAlpha=m;break;case"BM":this.ctx.globalCompositeOperation=m;break;case"SMask":this.current.activeSMask=m?this.tempSMask:null,this.tempSMask=null,this.checkSMaskState();break;case"TR":this.ctx.filter=this.current.transferMaps=this.filterFactory.addFilter(m);break}}get inSMaskMode(){return!!this.suspendedCtx}checkSMaskState(){const g=this.inSMaskMode;this.current.activeSMask&&!g?this.beginSMaskMode():!this.current.activeSMask&&g&&this.endSMaskMode()}beginSMaskMode(){if(this.inSMaskMode)throw new Error("beginSMaskMode called while already in smask mode");const g=this.ctx.canvas.width,C=this.ctx.canvas.height,m="smaskGroupAt"+this.groupLevel,u=this.cachedCanvases.getCanvas(m,g,C);this.suspendedCtx=this.ctx,this.ctx=u.context;const n=this.ctx;n.setTransform(...(0,R.getCurrentTransform)(this.suspendedCtx)),Z(this.suspendedCtx,n),o(n,this.suspendedCtx),this.setGState([["BM","source-over"],["ca",1],["CA",1]])}endSMaskMode(){if(!this.inSMaskMode)throw new Error("endSMaskMode called while not in smask mode");this.ctx._removeMirroring(),Z(this.ctx,this.suspendedCtx),this.ctx=this.suspendedCtx,this.suspendedCtx=null}compose(g){if(!this.current.activeSMask)return;g?(g[0]=Math.floor(g[0]),g[1]=Math.floor(g[1]),g[2]=Math.ceil(g[2]),g[3]=Math.ceil(g[3])):g=[0,0,this.ctx.canvas.width,this.ctx.canvas.height];const C=this.current.activeSMask,m=this.suspendedCtx;l(m,C,this.ctx,g),this.ctx.save(),this.ctx.setTransform(1,0,0,1,0,0),this.ctx.clearRect(0,0,this.ctx.canvas.width,this.ctx.canvas.height),this.ctx.restore()}save(){this.inSMaskMode?(Z(this.ctx,this.suspendedCtx),this.suspendedCtx.save()):this.ctx.save();const g=this.current;this.stateStack.push(g),this.current=g.clone()}restore(){this.stateStack.length===0&&this.inSMaskMode&&this.endSMaskMode(),this.stateStack.length!==0&&(this.current=this.stateStack.pop(),this.inSMaskMode?(this.suspendedCtx.restore(),Z(this.suspendedCtx,this.ctx)):this.ctx.restore(),this.checkSMaskState(),this.pendingClip=null,this._cachedScaleForStroking[0]=-1,this._cachedGetSinglePixelWidth=null)}transform(g,C,m,u,n,D){this.ctx.transform(g,C,m,u,n,D),this._cachedScaleForStroking[0]=-1,this._cachedGetSinglePixelWidth=null}constructPath(g,C,m){const u=this.ctx,n=this.current;let D=n.x,x=n.y,CI,bI;const sI=(0,R.getCurrentTransform)(u),YI=sI[0]===0&&sI[3]===0||sI[1]===0&&sI[2]===0,XI=YI?m.slice(0):null;for(let aI=0,f=0,$=g.length;aI<$;aI++)switch(g[aI]|0){case G.OPS.rectangle:D=C[f++],x=C[f++];const w=C[f++],p=C[f++],v=D+w,q=x+p;u.moveTo(D,x),w===0||p===0?u.lineTo(v,q):(u.lineTo(v,x),u.lineTo(v,q),u.lineTo(D,q)),YI||n.updateRectMinMax(sI,[D,x,v,q]),u.closePath();break;case G.OPS.moveTo:D=C[f++],x=C[f++],u.moveTo(D,x),YI||n.updatePathMinMax(sI,D,x);break;case G.OPS.lineTo:D=C[f++],x=C[f++],u.lineTo(D,x),YI||n.updatePathMinMax(sI,D,x);break;case G.OPS.curveTo:CI=D,bI=x,D=C[f+4],x=C[f+5],u.bezierCurveTo(C[f],C[f+1],C[f+2],C[f+3],D,x),n.updateCurvePathMinMax(sI,CI,bI,C[f],C[f+1],C[f+2],C[f+3],D,x,XI),f+=6;break;case G.OPS.curveTo2:CI=D,bI=x,u.bezierCurveTo(D,x,C[f],C[f+1],C[f+2],C[f+3]),n.updateCurvePathMinMax(sI,CI,bI,D,x,C[f],C[f+1],C[f+2],C[f+3],XI),D=C[f+2],x=C[f+3],f+=4;break;case G.OPS.curveTo3:CI=D,bI=x,D=C[f+2],x=C[f+3],u.bezierCurveTo(C[f],C[f+1],D,x,D,x),n.updateCurvePathMinMax(sI,CI,bI,C[f],C[f+1],D,x,D,x,XI),f+=4;break;case G.OPS.closePath:u.closePath();break}YI&&n.updateScalingPathMinMax(sI,XI),n.setCurrentPoint(D,x)}closePath(){this.ctx.closePath()}stroke(g=!0){const C=this.ctx,m=this.current.strokeColor;C.globalAlpha=this.current.strokeAlpha,this.contentVisible&&(typeof m=="object"&&(m!=null&&m.getPattern)?(C.save(),C.strokeStyle=m.getPattern(C,this,(0,R.getCurrentTransformInverse)(C),cI.PathType.STROKE),this.rescaleAndStroke(!1),C.restore()):this.rescaleAndStroke(!0)),g&&this.consumePath(this.current.getClippedPathBoundingBox()),C.globalAlpha=this.current.fillAlpha}closeStroke(){this.closePath(),this.stroke()}fill(g=!0){const C=this.ctx,m=this.current.fillColor,u=this.current.patternFill;let n=!1;u&&(C.save(),C.fillStyle=m.getPattern(C,this,(0,R.getCurrentTransformInverse)(C),cI.PathType.FILL),n=!0);const D=this.current.getClippedPathBoundingBox();this.contentVisible&&D!==null&&(this.pendingEOFill?(C.fill("evenodd"),this.pendingEOFill=!1):C.fill()),n&&C.restore(),g&&this.consumePath(D)}eoFill(){this.pendingEOFill=!0,this.fill()}fillStroke(){this.fill(!1),this.stroke(!1),this.consumePath()}eoFillStroke(){this.pendingEOFill=!0,this.fillStroke()}closeFillStroke(){this.closePath(),this.fillStroke()}closeEOFillStroke(){this.pendingEOFill=!0,this.closePath(),this.fillStroke()}endPath(){this.consumePath()}clip(){this.pendingClip=j}eoClip(){this.pendingClip=r}beginText(){this.current.textMatrix=G.IDENTITY_MATRIX,this.current.textMatrixScale=1,this.current.x=this.current.lineX=0,this.current.y=this.current.lineY=0}endText(){const g=this.pendingTextPaths,C=this.ctx;if(g===void 0){C.beginPath();return}C.save(),C.beginPath();for(const m of g)C.setTransform(...m.transform),C.translate(m.x,m.y),m.addToPath(C,m.fontSize);C.restore(),C.clip(),C.beginPath(),delete this.pendingTextPaths}setCharSpacing(g){this.current.charSpacing=g}setWordSpacing(g){this.current.wordSpacing=g}setHScale(g){this.current.textHScale=g/100}setLeading(g){this.current.leading=-g}setFont(g,C){var sI;const m=this.commonObjs.get(g),u=this.current;if(!m)throw new Error(`Can't find font for ${g}`);if(u.fontMatrix=m.fontMatrix||G.FONT_IDENTITY_MATRIX,(u.fontMatrix[0]===0||u.fontMatrix[3]===0)&&(0,G.warn)("Invalid font matrix for font "+g),C<0?(C=-C,u.fontDirection=-1):u.fontDirection=1,this.current.font=m,this.current.fontSize=C,m.isType3Font)return;const n=m.loadedName||"sans-serif",D=((sI=m.systemFontInfo)==null?void 0:sI.css)||`"${n}", ${m.fallbackName}`;let x="normal";m.black?x="900":m.bold&&(x="bold");const CI=m.italic?"italic":"normal";let bI=C;C<WI?bI=WI:C>L&&(bI=L),this.current.fontSizeScale=C/bI,this.ctx.font=`${CI} ${x} ${bI}px ${D}`}setTextRenderingMode(g){this.current.textRenderingMode=g}setTextRise(g){this.current.textRise=g}moveText(g,C){this.current.x=this.current.lineX+=g,this.current.y=this.current.lineY+=C}setLeadingMoveText(g,C){this.setLeading(-C),this.moveText(g,C)}setTextMatrix(g,C,m,u,n,D){this.current.textMatrix=[g,C,m,u,n,D],this.current.textMatrixScale=Math.hypot(g,C),this.current.x=this.current.lineX=0,this.current.y=this.current.lineY=0}nextLine(){this.moveText(0,this.current.leading)}paintChar(g,C,m,u){const n=this.ctx,D=this.current,x=D.font,CI=D.textRenderingMode,bI=D.fontSize/D.fontSizeScale,sI=CI&G.TextRenderingMode.FILL_STROKE_MASK,YI=!!(CI&G.TextRenderingMode.ADD_TO_PATH_FLAG),XI=D.patternFill&&!x.missingFile;let aI;(x.disableFontFace||YI||XI)&&(aI=x.getPathGenerator(this.commonObjs,g)),x.disableFontFace||XI?(n.save(),n.translate(C,m),n.beginPath(),aI(n,bI),u&&n.setTransform(...u),(sI===G.TextRenderingMode.FILL||sI===G.TextRenderingMode.FILL_STROKE)&&n.fill(),(sI===G.TextRenderingMode.STROKE||sI===G.TextRenderingMode.FILL_STROKE)&&n.stroke(),n.restore()):((sI===G.TextRenderingMode.FILL||sI===G.TextRenderingMode.FILL_STROKE)&&n.fillText(g,C,m),(sI===G.TextRenderingMode.STROKE||sI===G.TextRenderingMode.FILL_STROKE)&&n.strokeText(g,C,m)),YI&&(this.pendingTextPaths||(this.pendingTextPaths=[])).push({transform:(0,R.getCurrentTransform)(n),x:C,y:m,fontSize:bI,addToPath:aI})}get isFontSubpixelAAEnabled(){const{context:g}=this.cachedCanvases.getCanvas("isFontSubpixelAAEnabled",10,10);g.scale(1.5,1),g.fillText("I",0,10);const C=g.getImageData(0,0,10,10).data;let m=!1;for(let u=3;u<C.length;u+=4)if(C[u]>0&&C[u]<255){m=!0;break}return(0,G.shadow)(this,"isFontSubpixelAAEnabled",m)}showText(g){const C=this.current,m=C.font;if(m.isType3Font)return this.showType3Text(g);const u=C.fontSize;if(u===0)return;const n=this.ctx,D=C.fontSizeScale,x=C.charSpacing,CI=C.wordSpacing,bI=C.fontDirection,sI=C.textHScale*bI,YI=g.length,XI=m.vertical,aI=XI?1:-1,f=m.defaultVMetrics,$=u*C.fontMatrix[0],w=C.textRenderingMode===G.TextRenderingMode.FILL&&!m.disableFontFace&&!C.patternFill;n.save(),n.transform(...C.textMatrix),n.translate(C.x,C.y+C.textRise),bI>0?n.scale(sI,-1):n.scale(sI,1);let p;if(C.patternFill){n.save();const hI=C.fillColor.getPattern(n,this,(0,R.getCurrentTransformInverse)(n),cI.PathType.FILL);p=(0,R.getCurrentTransform)(n),n.restore(),n.fillStyle=hI}let v=C.lineWidth;const q=C.textMatrixScale;if(q===0||v===0){const hI=C.textRenderingMode&G.TextRenderingMode.FILL_STROKE_MASK;(hI===G.TextRenderingMode.STROKE||hI===G.TextRenderingMode.FILL_STROKE)&&(v=this.getSinglePixelWidth())}else v/=q;if(D!==1&&(n.scale(D,D),v/=D),n.lineWidth=v,m.isInvalidPDFjsFont){const hI=[];let E=0;for(const MI of g)hI.push(MI.unicode),E+=MI.width;n.fillText(hI.join(""),0,0),C.x+=E*$*sI,n.restore(),this.compose();return}let mI=0,NI;for(NI=0;NI<YI;++NI){const hI=g[NI];if(typeof hI=="number"){mI+=aI*hI*u/1e3;continue}let E=!1;const MI=(hI.isSpace?CI:0)+x,yI=hI.fontChar,TI=hI.accent;let LI,UI,eI=hI.width;if(XI){const vI=hI.vmetric||f,rI=-(hI.vmetric?vI[1]:eI*.5)*$,VI=vI[2]*$;eI=vI?-vI[0]:eI,LI=rI/D,UI=(mI+VI)/D}else LI=mI/D,UI=0;if(m.remeasure&&eI>0){const vI=n.measureText(yI).width*1e3/u*D;if(eI<vI&&this.isFontSubpixelAAEnabled){const rI=eI/vI;E=!0,n.save(),n.scale(rI,1),LI/=rI}else eI!==vI&&(LI+=(eI-vI)/2e3*u/D)}if(this.contentVisible&&(hI.isInFont||m.missingFile)){if(w&&!TI)n.fillText(yI,LI,UI);else if(this.paintChar(yI,LI,UI,p),TI){const vI=LI+u*TI.offset.x/D,rI=UI-u*TI.offset.y/D;this.paintChar(TI.fontChar,vI,rI,p)}}const JI=XI?eI*$-MI*bI:eI*$+MI*bI;mI+=JI,E&&n.restore()}XI?C.y-=mI:C.x+=mI*sI,n.restore(),this.compose()}showType3Text(g){const C=this.ctx,m=this.current,u=m.font,n=m.fontSize,D=m.fontDirection,x=u.vertical?1:-1,CI=m.charSpacing,bI=m.wordSpacing,sI=m.textHScale*D,YI=m.fontMatrix||G.FONT_IDENTITY_MATRIX,XI=g.length,aI=m.textRenderingMode===G.TextRenderingMode.INVISIBLE;let f,$,w,p;if(!(aI||n===0)){for(this._cachedScaleForStroking[0]=-1,this._cachedGetSinglePixelWidth=null,C.save(),C.transform(...m.textMatrix),C.translate(m.x,m.y),C.scale(sI,D),f=0;f<XI;++f){if($=g[f],typeof $=="number"){p=x*$*n/1e3,this.ctx.translate(p,0),m.x+=p*sI;continue}const v=($.isSpace?bI:0)+CI,q=u.charProcOperatorList[$.operatorListId];if(!q){(0,G.warn)(`Type3 character "${$.operatorListId}" is not available.`);continue}this.contentVisible&&(this.processingType3=$,this.save(),C.scale(n,n),C.transform(...YI),this.executeOperatorList(q),this.restore()),w=G.Util.applyTransform([$.width,0],YI)[0]*n+v,C.translate(w,0),m.x+=w*sI}C.restore(),this.processingType3=null}}setCharWidth(g,C){}setCharWidthAndBounds(g,C,m,u,n,D){this.ctx.rect(m,u,n-m,D-u),this.ctx.clip(),this.endPath()}getColorN_Pattern(g){let C;if(g[0]==="TilingPattern"){const m=g[1],u=this.baseTransform||(0,R.getCurrentTransform)(this.ctx),n={createCanvasGraphics:D=>new P(D,this.commonObjs,this.objs,this.canvasFactory,this.filterFactory,{optionalContentConfig:this.optionalContentConfig,markedContentStack:this.markedContentStack})};C=new cI.TilingPattern(g,m,this.ctx,n,u)}else C=this._getPattern(g[1],g[2]);return C}setStrokeColorN(){this.current.strokeColor=this.getColorN_Pattern(arguments)}setFillColorN(){this.current.fillColor=this.getColorN_Pattern(arguments),this.current.patternFill=!0}setStrokeRGBColor(g,C,m){const u=G.Util.makeHexColor(g,C,m);this.ctx.strokeStyle=u,this.current.strokeColor=u}setFillRGBColor(g,C,m){const u=G.Util.makeHexColor(g,C,m);this.ctx.fillStyle=u,this.current.fillColor=u,this.current.patternFill=!1}_getPattern(g,C=null){let m;return this.cachedPatterns.has(g)?m=this.cachedPatterns.get(g):(m=(0,cI.getShadingPattern)(this.getObject(g)),this.cachedPatterns.set(g,m)),C&&(m.matrix=C),m}shadingFill(g){if(!this.contentVisible)return;const C=this.ctx;this.save();const m=this._getPattern(g);C.fillStyle=m.getPattern(C,this,(0,R.getCurrentTransformInverse)(C),cI.PathType.SHADING);const u=(0,R.getCurrentTransformInverse)(C);if(u){const{width:n,height:D}=C.canvas,[x,CI,bI,sI]=G.Util.getAxialAlignedBoundingBox([0,0,n,D],u);this.ctx.fillRect(x,CI,bI-x,sI-CI)}else this.ctx.fillRect(-1e10,-1e10,2e10,2e10);this.compose(this.current.getClippedPathBoundingBox()),this.restore()}beginInlineImage(){(0,G.unreachable)("Should not call beginInlineImage")}beginImageData(){(0,G.unreachable)("Should not call beginImageData")}paintFormXObjectBegin(g,C){if(this.contentVisible&&(this.save(),this.baseTransformStack.push(this.baseTransform),Array.isArray(g)&&g.length===6&&this.transform(...g),this.baseTransform=(0,R.getCurrentTransform)(this.ctx),C)){const m=C[2]-C[0],u=C[3]-C[1];this.ctx.rect(C[0],C[1],m,u),this.current.updateRectMinMax((0,R.getCurrentTransform)(this.ctx),C),this.clip(),this.endPath()}}paintFormXObjectEnd(){this.contentVisible&&(this.restore(),this.baseTransform=this.baseTransformStack.pop())}beginGroup(g){if(!this.contentVisible)return;this.save(),this.inSMaskMode&&(this.endSMaskMode(),this.current.activeSMask=null);const C=this.ctx;g.isolated||(0,G.info)("TODO: Support non-isolated groups."),g.knockout&&(0,G.warn)("Knockout groups not supported.");const m=(0,R.getCurrentTransform)(C);if(g.matrix&&C.transform(...g.matrix),!g.bbox)throw new Error("Bounding box is required.");let u=G.Util.getAxialAlignedBoundingBox(g.bbox,(0,R.getCurrentTransform)(C));const n=[0,0,C.canvas.width,C.canvas.height];u=G.Util.intersect(u,n)||[0,0,0,0];const D=Math.floor(u[0]),x=Math.floor(u[1]);let CI=Math.max(Math.ceil(u[2])-D,1),bI=Math.max(Math.ceil(u[3])-x,1),sI=1,YI=1;CI>e&&(sI=CI/e,CI=e),bI>e&&(YI=bI/e,bI=e),this.current.startNewPathAndClipBox([0,0,CI,bI]);let XI="groupAt"+this.groupLevel;g.smask&&(XI+="_smask_"+this.smaskCounter++%2);const aI=this.cachedCanvases.getCanvas(XI,CI,bI),f=aI.context;f.scale(1/sI,1/YI),f.translate(-D,-x),f.transform(...m),g.smask?this.smaskStack.push({canvas:aI.canvas,context:f,offsetX:D,offsetY:x,scaleX:sI,scaleY:YI,subtype:g.smask.subtype,backdrop:g.smask.backdrop,transferMap:g.smask.transferMap||null,startTransformInverse:null}):(C.setTransform(1,0,0,1,0,0),C.translate(D,x),C.scale(sI,YI),C.save()),Z(C,f),this.ctx=f,this.setGState([["BM","source-over"],["ca",1],["CA",1]]),this.groupStack.push(C),this.groupLevel++}endGroup(g){if(!this.contentVisible)return;this.groupLevel--;const C=this.ctx,m=this.groupStack.pop();if(this.ctx=m,this.ctx.imageSmoothingEnabled=!1,g.smask)this.tempSMask=this.smaskStack.pop(),this.restore();else{this.ctx.restore();const u=(0,R.getCurrentTransform)(this.ctx);this.restore(),this.ctx.save(),this.ctx.setTransform(...u);const n=G.Util.getAxialAlignedBoundingBox([0,0,C.canvas.width,C.canvas.height],u);this.ctx.drawImage(C.canvas,0,0),this.ctx.restore(),this.compose(n)}}beginAnnotation(g,C,m,u,n){if(O(this,dI,Eg).call(this),i(this.ctx),this.ctx.save(),this.save(),this.baseTransform&&this.ctx.setTransform(...this.baseTransform),Array.isArray(C)&&C.length===4){const D=C[2]-C[0],x=C[3]-C[1];if(n&&this.annotationCanvasMap){m=m.slice(),m[4]-=C[0],m[5]-=C[1],C=C.slice(),C[0]=C[1]=0,C[2]=D,C[3]=x;const[CI,bI]=G.Util.singularValueDecompose2dScale((0,R.getCurrentTransform)(this.ctx)),{viewportScale:sI}=this,YI=Math.ceil(D*this.outputScaleX*sI),XI=Math.ceil(x*this.outputScaleY*sI);this.annotationCanvas=this.canvasFactory.create(YI,XI);const{canvas:aI,context:f}=this.annotationCanvas;this.annotationCanvasMap.set(g,aI),this.annotationCanvas.savedCtx=this.ctx,this.ctx=f,this.ctx.save(),this.ctx.setTransform(CI,0,0,-bI,0,x*bI),i(this.ctx)}else i(this.ctx),this.ctx.rect(C[0],C[1],D,x),this.ctx.clip(),this.endPath()}this.current=new Y(this.ctx.canvas.width,this.ctx.canvas.height),this.transform(...m),this.transform(...u)}endAnnotation(){this.annotationCanvas&&(this.ctx.restore(),O(this,dI,rg).call(this),this.ctx=this.annotationCanvas.savedCtx,delete this.annotationCanvas.savedCtx,delete this.annotationCanvas)}paintImageMaskXObject(g){if(!this.contentVisible)return;const C=g.count;g=this.getObject(g.data,g),g.count=C;const m=this.ctx,u=this.processingType3;if(u&&(u.compiled===void 0&&(u.compiled=s(g)),u.compiled)){u.compiled(m);return}const n=this._createMaskCanvas(g),D=n.canvas;m.save(),m.setTransform(1,0,0,1,0,0),m.drawImage(D,n.offsetX,n.offsetY),m.restore(),this.compose()}paintImageMaskXObjectRepeat(g,C,m=0,u=0,n,D){if(!this.contentVisible)return;g=this.getObject(g.data,g);const x=this.ctx;x.save();const CI=(0,R.getCurrentTransform)(x);x.transform(C,m,u,n,0,0);const bI=this._createMaskCanvas(g);x.setTransform(1,0,0,1,bI.offsetX-CI[4],bI.offsetY-CI[5]);for(let sI=0,YI=D.length;sI<YI;sI+=2){const XI=G.Util.transform(CI,[C,m,u,n,D[sI],D[sI+1]]),[aI,f]=G.Util.applyTransform([0,0],XI);x.drawImage(bI.canvas,aI,f)}x.restore(),this.compose()}paintImageMaskXObjectGroup(g){if(!this.contentVisible)return;const C=this.ctx,m=this.current.fillColor,u=this.current.patternFill;for(const n of g){const{data:D,width:x,height:CI,transform:bI}=n,sI=this.cachedCanvases.getCanvas("maskCanvas",x,CI),YI=sI.context;YI.save();const XI=this.getObject(D,n);h(YI,XI),YI.globalCompositeOperation="source-in",YI.fillStyle=u?m.getPattern(YI,this,(0,R.getCurrentTransformInverse)(C),cI.PathType.FILL):m,YI.fillRect(0,0,x,CI),YI.restore(),C.save(),C.transform(...bI),C.scale(1,-1),B(C,sI.canvas,0,0,x,CI,0,-1,1,1),C.restore()}this.compose()}paintImageXObject(g){if(!this.contentVisible)return;const C=this.getObject(g);if(!C){(0,G.warn)("Dependent image isn't ready yet");return}this.paintInlineImageXObject(C)}paintImageXObjectRepeat(g,C,m,u){if(!this.contentVisible)return;const n=this.getObject(g);if(!n){(0,G.warn)("Dependent image isn't ready yet");return}const D=n.width,x=n.height,CI=[];for(let bI=0,sI=u.length;bI<sI;bI+=2)CI.push({transform:[C,0,0,m,u[bI],u[bI+1]],x:0,y:0,w:D,h:x});this.paintInlineImageXObjectGroup(n,CI)}applyTransferMapsToCanvas(g){return this.current.transferMaps!=="none"&&(g.filter=this.current.transferMaps,g.drawImage(g.canvas,0,0),g.filter="none"),g.canvas}applyTransferMapsToBitmap(g){if(this.current.transferMaps==="none")return g.bitmap;const{bitmap:C,width:m,height:u}=g,n=this.cachedCanvases.getCanvas("inlineImage",m,u),D=n.context;return D.filter=this.current.transferMaps,D.drawImage(C,0,0),D.filter="none",n.canvas}paintInlineImageXObject(g){if(!this.contentVisible)return;const C=g.width,m=g.height,u=this.ctx;if(this.save(),!G.isNodeJS){const{filter:x}=u;x!=="none"&&x!==""&&(u.filter="none")}u.scale(1/C,-1/m);let n;if(g.bitmap)n=this.applyTransferMapsToBitmap(g);else if(typeof HTMLElement=="function"&&g instanceof HTMLElement||!g.data)n=g;else{const CI=this.cachedCanvases.getCanvas("inlineImage",C,m).context;t(CI,g),n=this.applyTransferMapsToCanvas(CI)}const D=this._scaleImage(n,(0,R.getCurrentTransformInverse)(u));u.imageSmoothingEnabled=X((0,R.getCurrentTransform)(u),g.interpolate),B(u,D.img,0,0,D.paintWidth,D.paintHeight,0,-m,C,m),this.compose(),this.restore()}paintInlineImageXObjectGroup(g,C){if(!this.contentVisible)return;const m=this.ctx;let u;if(g.bitmap)u=g.bitmap;else{const n=g.width,D=g.height,CI=this.cachedCanvases.getCanvas("inlineImage",n,D).context;t(CI,g),u=this.applyTransferMapsToCanvas(CI)}for(const n of C)m.save(),m.transform(...n.transform),m.scale(1,-1),B(m,u,n.x,n.y,n.w,n.h,0,-1,1,1),m.restore();this.compose()}paintSolidColorImageMask(){this.contentVisible&&(this.ctx.fillRect(0,0,1,1),this.compose())}markPoint(g){}markPointProps(g,C){}beginMarkedContent(g){this.markedContentStack.push({visible:!0})}beginMarkedContentProps(g,C){g==="OC"?this.markedContentStack.push({visible:this.optionalContentConfig.isVisible(C)}):this.markedContentStack.push({visible:!0}),this.contentVisible=this.isContentVisible()}endMarkedContent(){this.markedContentStack.pop(),this.contentVisible=this.isContentVisible()}beginCompat(){}endCompat(){}consumePath(g){const C=this.current.isEmptyClip();this.pendingClip&&this.current.updateClipFromPath(),this.pendingClip||this.compose(g);const m=this.ctx;this.pendingClip&&(C||(this.pendingClip===r?m.clip("evenodd"):m.clip()),this.pendingClip=null),this.current.startNewPathAndClipBox(this.current.clipBox),m.beginPath()}getSinglePixelWidth(){if(!this._cachedGetSinglePixelWidth){const g=(0,R.getCurrentTransform)(this.ctx);if(g[1]===0&&g[2]===0)this._cachedGetSinglePixelWidth=1/Math.min(Math.abs(g[0]),Math.abs(g[3]));else{const C=Math.abs(g[0]*g[3]-g[2]*g[1]),m=Math.hypot(g[0],g[2]),u=Math.hypot(g[1],g[3]);this._cachedGetSinglePixelWidth=Math.max(m,u)/C}}return this._cachedGetSinglePixelWidth}getScaleForStroking(){if(this._cachedScaleForStroking[0]===-1){const{lineWidth:g}=this.current,{a:C,b:m,c:u,d:n}=this.ctx.getTransform();let D,x;if(m===0&&u===0){const CI=Math.abs(C),bI=Math.abs(n);if(CI===bI)if(g===0)D=x=1/CI;else{const sI=CI*g;D=x=sI<1?1/sI:1}else if(g===0)D=1/CI,x=1/bI;else{const sI=CI*g,YI=bI*g;D=sI<1?1/sI:1,x=YI<1?1/YI:1}}else{const CI=Math.abs(C*n-m*u),bI=Math.hypot(C,m),sI=Math.hypot(u,n);if(g===0)D=sI/CI,x=bI/CI;else{const YI=g*CI;D=sI>YI?sI/YI:1,x=bI>YI?bI/YI:1}}this._cachedScaleForStroking[0]=D,this._cachedScaleForStroking[1]=x}return this._cachedScaleForStroking}rescaleAndStroke(g){const{ctx:C}=this,{lineWidth:m}=this.current,[u,n]=this.getScaleForStroking();if(C.lineWidth=m||1,u===1&&n===1){C.stroke();return}const D=C.getLineDash();if(g&&C.save(),C.scale(u,n),D.length>0){const x=Math.max(u,n);C.setLineDash(D.map(CI=>CI/x)),C.lineDashOffset/=x}C.stroke(),g&&C.restore()}isContentVisible(){for(let g=this.markedContentStack.length-1;g>=0;g--)if(!this.markedContentStack[g].visible)return!1;return!0}};dI=new WeakSet,Eg=function(){for(;this.stateStack.length||this.inSMaskMode;)this.restore();this.ctx.restore(),this.transparentCanvas&&(this.ctx=this.compositeCtx,this.ctx.save(),this.ctx.setTransform(1,0,0,1,0,0),this.ctx.drawImage(this.transparentCanvas,0,0),this.ctx.restore(),this.transparentCanvas=null)},rg=function(){if(this.pageColors){const g=this.filterFactory.addHCMFilter(this.pageColors.foreground,this.pageColors.background);if(g!=="none"){const C=this.ctx.filter;this.ctx.filter=g,this.ctx.drawImage(this.ctx.canvas,0,0),this.ctx.filter=C}}};let T=P;b.CanvasGraphics=T;for(const N in G.OPS)T.prototype[N]!==void 0&&(T.prototype[G.OPS[N]]=T.prototype[N])},(wI,b,ZI)=>{Object.defineProperty(b,"__esModule",{value:!0}),b.TilingPattern=b.PathType=void 0,b.getShadingPattern=V;var G=ZI(1),R=ZI(6);const cI={FILL:"Fill",STROKE:"Stroke",SHADING:"Shading"};b.PathType=cI;function U(s,Y){if(!Y)return;const t=Y[2]-Y[0],h=Y[3]-Y[1],Z=new Path2D;Z.rect(Y[0],Y[1],t,h),s.clip(Z)}class WI{constructor(){this.constructor===WI&&(0,G.unreachable)("Cannot initialize BaseShadingPattern.")}getPattern(){(0,G.unreachable)("Abstract method `getPattern` called.")}}class L extends WI{constructor(Y){super(),this._type=Y[1],this._bbox=Y[2],this._colorStops=Y[3],this._p0=Y[4],this._p1=Y[5],this._r0=Y[6],this._r1=Y[7],this.matrix=null}_createGradient(Y){let t;this._type==="axial"?t=Y.createLinearGradient(this._p0[0],this._p0[1],this._p1[0],this._p1[1]):this._type==="radial"&&(t=Y.createRadialGradient(this._p0[0],this._p0[1],this._r0,this._p1[0],this._p1[1],this._r1));for(const h of this._colorStops)t.addColorStop(h[0],h[1]);return t}getPattern(Y,t,h,Z){let i;if(Z===cI.STROKE||Z===cI.FILL){const A=t.current.getClippedPathBoundingBox(Z,(0,R.getCurrentTransform)(Y))||[0,0,0,0],d=Math.ceil(A[2]-A[0])||1,c=Math.ceil(A[3]-A[1])||1,F=t.cachedCanvases.getCanvas("pattern",d,c,!0),l=F.context;l.clearRect(0,0,l.canvas.width,l.canvas.height),l.beginPath(),l.rect(0,0,l.canvas.width,l.canvas.height),l.translate(-A[0],-A[1]),h=G.Util.transform(h,[1,0,0,1,A[0],A[1]]),l.transform(...t.baseTransform),this.matrix&&l.transform(...this.matrix),U(l,this._bbox),l.fillStyle=this._createGradient(l),l.fill(),i=Y.createPattern(F.canvas,"no-repeat");const X=new DOMMatrix(h);i.setTransform(X)}else U(Y,this._bbox),i=this._createGradient(Y);return i}}function e(s,Y,t,h,Z,i,A,d){const c=Y.coords,F=Y.colors,l=s.data,X=s.width*4;let K;c[t+1]>c[h+1]&&(K=t,t=h,h=K,K=i,i=A,A=K),c[h+1]>c[Z+1]&&(K=h,h=Z,Z=K,K=A,A=d,d=K),c[t+1]>c[h+1]&&(K=t,t=h,h=K,K=i,i=A,A=K);const lI=(c[t]+Y.offsetX)*Y.scaleX,j=(c[t+1]+Y.offsetY)*Y.scaleY,r=(c[h]+Y.offsetX)*Y.scaleX,T=(c[h+1]+Y.offsetY)*Y.scaleY,dI=(c[Z]+Y.offsetX)*Y.scaleX,M=(c[Z+1]+Y.offsetY)*Y.scaleY;if(j>=M)return;const k=F[i],P=F[i+1],N=F[i+2],g=F[A],C=F[A+1],m=F[A+2],u=F[d],n=F[d+1],D=F[d+2],x=Math.round(j),CI=Math.round(M);let bI,sI,YI,XI,aI,f,$,w;for(let p=x;p<=CI;p++){if(p<T){const hI=p<j?0:(j-p)/(j-T);bI=lI-(lI-r)*hI,sI=k-(k-g)*hI,YI=P-(P-C)*hI,XI=N-(N-m)*hI}else{let hI;p>M?hI=1:T===M?hI=0:hI=(T-p)/(T-M),bI=r-(r-dI)*hI,sI=g-(g-u)*hI,YI=C-(C-n)*hI,XI=m-(m-D)*hI}let v;p<j?v=0:p>M?v=1:v=(j-p)/(j-M),aI=lI-(lI-dI)*v,f=k-(k-u)*v,$=P-(P-n)*v,w=N-(N-D)*v;const q=Math.round(Math.min(bI,aI)),mI=Math.round(Math.max(bI,aI));let NI=X*p+q*4;for(let hI=q;hI<=mI;hI++)v=(bI-hI)/(bI-aI),v<0?v=0:v>1&&(v=1),l[NI++]=sI-(sI-f)*v|0,l[NI++]=YI-(YI-$)*v|0,l[NI++]=XI-(XI-w)*v|0,l[NI++]=255}}function W(s,Y,t){const h=Y.coords,Z=Y.colors;let i,A;switch(Y.type){case"lattice":const d=Y.verticesPerRow,c=Math.floor(h.length/d)-1,F=d-1;for(i=0;i<c;i++){let l=i*d;for(let X=0;X<F;X++,l++)e(s,t,h[l],h[l+1],h[l+d],Z[l],Z[l+1],Z[l+d]),e(s,t,h[l+d+1],h[l+1],h[l+d],Z[l+d+1],Z[l+1],Z[l+d])}break;case"triangles":for(i=0,A=h.length;i<A;i+=3)e(s,t,h[i],h[i+1],h[i+2],Z[i],Z[i+1],Z[i+2]);break;default:throw new Error("illegal figure")}}class z extends WI{constructor(Y){super(),this._coords=Y[2],this._colors=Y[3],this._figures=Y[4],this._bounds=Y[5],this._bbox=Y[7],this._background=Y[8],this.matrix=null}_createMeshCanvas(Y,t,h){const d=Math.floor(this._bounds[0]),c=Math.floor(this._bounds[1]),F=Math.ceil(this._bounds[2])-d,l=Math.ceil(this._bounds[3])-c,X=Math.min(Math.ceil(Math.abs(F*Y[0]*1.1)),3e3),K=Math.min(Math.ceil(Math.abs(l*Y[1]*1.1)),3e3),lI=F/X,j=l/K,r={coords:this._coords,colors:this._colors,offsetX:-d,offsetY:-c,scaleX:1/lI,scaleY:1/j},T=X+2*2,dI=K+2*2,M=h.getCanvas("mesh",T,dI,!1),k=M.context,P=k.createImageData(X,K);if(t){const g=P.data;for(let C=0,m=g.length;C<m;C+=4)g[C]=t[0],g[C+1]=t[1],g[C+2]=t[2],g[C+3]=255}for(const g of this._figures)W(P,g,r);return k.putImageData(P,2,2),{canvas:M.canvas,offsetX:d-2*lI,offsetY:c-2*j,scaleX:lI,scaleY:j}}getPattern(Y,t,h,Z){U(Y,this._bbox);let i;if(Z===cI.SHADING)i=G.Util.singularValueDecompose2dScale((0,R.getCurrentTransform)(Y));else if(i=G.Util.singularValueDecompose2dScale(t.baseTransform),this.matrix){const d=G.Util.singularValueDecompose2dScale(this.matrix);i=[i[0]*d[0],i[1]*d[1]]}const A=this._createMeshCanvas(i,Z===cI.SHADING?null:this._background,t.cachedCanvases);return Z!==cI.SHADING&&(Y.setTransform(...t.baseTransform),this.matrix&&Y.transform(...this.matrix)),Y.translate(A.offsetX,A.offsetY),Y.scale(A.scaleX,A.scaleY),Y.createPattern(A.canvas,"no-repeat")}}class J extends WI{getPattern(){return"hotpink"}}function V(s){switch(s[0]){case"RadialAxial":return new L(s);case"Mesh":return new z(s);case"Dummy":return new J}throw new Error(`Unknown IR type: ${s[0]}`)}const o={COLORED:1,UNCOLORED:2},B=class B{constructor(Y,t,h,Z,i){this.operatorList=Y[2],this.matrix=Y[3]||[1,0,0,1,0,0],this.bbox=Y[4],this.xstep=Y[5],this.ystep=Y[6],this.paintType=Y[7],this.tilingType=Y[8],this.color=t,this.ctx=h,this.canvasGraphicsFactory=Z,this.baseTransform=i}createPatternCanvas(Y){const t=this.operatorList,h=this.bbox,Z=this.xstep,i=this.ystep,A=this.paintType,d=this.tilingType,c=this.color,F=this.canvasGraphicsFactory;(0,G.info)("TilingType: "+d);const l=h[0],X=h[1],K=h[2],lI=h[3],j=G.Util.singularValueDecompose2dScale(this.matrix),r=G.Util.singularValueDecompose2dScale(this.baseTransform),T=[j[0]*r[0],j[1]*r[1]],dI=this.getSizeAndScale(Z,this.ctx.canvas.width,T[0]),M=this.getSizeAndScale(i,this.ctx.canvas.height,T[1]),k=Y.cachedCanvases.getCanvas("pattern",dI.size,M.size,!0),P=k.context,N=F.createCanvasGraphics(P);N.groupLevel=Y.groupLevel,this.setFillAndStrokeStyleToContext(N,A,c);let g=l,C=X,m=K,u=lI;return l<0&&(g=0,m+=Math.abs(l)),X<0&&(C=0,u+=Math.abs(X)),P.translate(-(dI.scale*g),-(M.scale*C)),N.transform(dI.scale,0,0,M.scale,0,0),P.save(),this.clipBbox(N,g,C,m,u),N.baseTransform=(0,R.getCurrentTransform)(N.ctx),N.executeOperatorList(t),N.endDrawing(),{canvas:k.canvas,scaleX:dI.scale,scaleY:M.scale,offsetX:g,offsetY:C}}getSizeAndScale(Y,t,h){Y=Math.abs(Y);const Z=Math.max(B.MAX_PATTERN_SIZE,t);let i=Math.ceil(Y*h);return i>=Z?i=Z:h=i/Y,{scale:h,size:i}}clipBbox(Y,t,h,Z,i){const A=Z-t,d=i-h;Y.ctx.rect(t,h,A,d),Y.current.updateRectMinMax((0,R.getCurrentTransform)(Y.ctx),[t,h,Z,i]),Y.clip(),Y.endPath()}setFillAndStrokeStyleToContext(Y,t,h){const Z=Y.ctx,i=Y.current;switch(t){case o.COLORED:const A=this.ctx;Z.fillStyle=A.fillStyle,Z.strokeStyle=A.strokeStyle,i.fillColor=A.fillStyle,i.strokeColor=A.strokeStyle;break;case o.UNCOLORED:const d=G.Util.makeHexColor(h[0],h[1],h[2]);Z.fillStyle=d,Z.strokeStyle=d,i.fillColor=d,i.strokeColor=d;break;default:throw new G.FormatError(`Unsupported paint type: ${t}`)}}getPattern(Y,t,h,Z){let i=h;Z!==cI.SHADING&&(i=G.Util.transform(i,t.baseTransform),this.matrix&&(i=G.Util.transform(i,this.matrix)));const A=this.createPatternCanvas(t);let d=new DOMMatrix(i);d=d.translate(A.offsetX,A.offsetY),d=d.scale(1/A.scaleX,1/A.scaleY);const c=Y.createPattern(A.canvas,"repeat");return c.setTransform(d),c}};fI(B,"MAX_PATTERN_SIZE",3e3);let y=B;b.TilingPattern=y},(wI,b,ZI)=>{Object.defineProperty(b,"__esModule",{value:!0}),b.convertBlackAndWhiteToRGBA=cI,b.convertToRGBA=R,b.grayToRGBA=WI;var G=ZI(1);function R(L){switch(L.kind){case G.ImageKind.GRAYSCALE_1BPP:return cI(L);case G.ImageKind.RGB_24BPP:return U(L)}return null}function cI({src:L,srcPos:e=0,dest:W,width:z,height:J,nonBlackColor:V=4294967295,inverseDecode:o=!1}){const y=G.FeatureTest.isLittleEndian?4278190080:255,[B,s]=o?[V,y]:[y,V],Y=z>>3,t=z&7,h=L.length;W=new Uint32Array(W.buffer);let Z=0;for(let i=0;i<J;i++){for(const d=e+Y;e<d;e++){const c=e<h?L[e]:255;W[Z++]=c&128?s:B,W[Z++]=c&64?s:B,W[Z++]=c&32?s:B,W[Z++]=c&16?s:B,W[Z++]=c&8?s:B,W[Z++]=c&4?s:B,W[Z++]=c&2?s:B,W[Z++]=c&1?s:B}if(t===0)continue;const A=e<h?L[e++]:255;for(let d=0;d<t;d++)W[Z++]=A&1<<7-d?s:B}return{srcPos:e,destPos:Z}}function U({src:L,srcPos:e=0,dest:W,destPos:z=0,width:J,height:V}){let o=0;const y=L.length>>2,B=new Uint32Array(L.buffer,e,y);if(G.FeatureTest.isLittleEndian){for(;o<y-2;o+=3,z+=4){const s=B[o],Y=B[o+1],t=B[o+2];W[z]=s|4278190080,W[z+1]=s>>>24|Y<<8|4278190080,W[z+2]=Y>>>16|t<<16|4278190080,W[z+3]=t>>>8|4278190080}for(let s=o*4,Y=L.length;s<Y;s+=3)W[z++]=L[s]|L[s+1]<<8|L[s+2]<<16|4278190080}else{for(;o<y-2;o+=3,z+=4){const s=B[o],Y=B[o+1],t=B[o+2];W[z]=s|255,W[z+1]=s<<24|Y>>>8|255,W[z+2]=Y<<16|t>>>16|255,W[z+3]=t<<8|255}for(let s=o*4,Y=L.length;s<Y;s+=3)W[z++]=L[s]<<24|L[s+1]<<16|L[s+2]<<8|255}return{srcPos:e,destPos:z}}function WI(L,e){if(G.FeatureTest.isLittleEndian)for(let W=0,z=L.length;W<z;W++)e[W]=L[W]*65793|4278190080;else for(let W=0,z=L.length;W<z;W++)e[W]=L[W]*16843008|255}},(wI,b)=>{Object.defineProperty(b,"__esModule",{value:!0}),b.GlobalWorkerOptions=void 0;const ZI=Object.create(null);b.GlobalWorkerOptions=ZI,ZI.workerPort=null,ZI.workerSrc=""},(wI,b,ZI)=>{var L,yC,HC,Rg;Object.defineProperty(b,"__esModule",{value:!0}),b.MessageHandler=void 0;var G=ZI(1);const R={DATA:1,ERROR:2},cI={CANCEL:1,CANCEL_COMPLETE:2,CLOSE:3,ENQUEUE:4,ERROR:5,PULL:6,PULL_COMPLETE:7,START_COMPLETE:8};function U(J){switch(J instanceof Error||typeof J=="object"&&J!==null||(0,G.unreachable)('wrapReason: Expected "reason" to be a (possibly cloned) Error.'),J.name){case"AbortException":return new G.AbortException(J.message);case"MissingPDFException":return new G.MissingPDFException(J.message);case"PasswordException":return new G.PasswordException(J.message,J.code);case"UnexpectedResponseException":return new G.UnexpectedResponseException(J.message,J.status);case"UnknownErrorException":return new G.UnknownErrorException(J.message,J.details);default:return new G.UnknownErrorException(J.message,J.toString())}}class WI{constructor(V,o,y){_(this,L);this.sourceName=V,this.targetName=o,this.comObj=y,this.callbackId=1,this.streamId=1,this.streamSinks=Object.create(null),this.streamControllers=Object.create(null),this.callbackCapabilities=Object.create(null),this.actionHandler=Object.create(null),this._onComObjOnMessage=B=>{const s=B.data;if(s.targetName!==this.sourceName)return;if(s.stream){O(this,L,HC).call(this,s);return}if(s.callback){const t=s.callbackId,h=this.callbackCapabilities[t];if(!h)throw new Error(`Cannot resolve callback ${t}`);if(delete this.callbackCapabilities[t],s.callback===R.DATA)h.resolve(s.data);else if(s.callback===R.ERROR)h.reject(U(s.reason));else throw new Error("Unexpected callback case");return}const Y=this.actionHandler[s.action];if(!Y)throw new Error(`Unknown action from worker: ${s.action}`);if(s.callbackId){const t=this.sourceName,h=s.sourceName;new Promise(function(Z){Z(Y(s.data))}).then(function(Z){y.postMessage({sourceName:t,targetName:h,callback:R.DATA,callbackId:s.callbackId,data:Z})},function(Z){y.postMessage({sourceName:t,targetName:h,callback:R.ERROR,callbackId:s.callbackId,reason:U(Z)})});return}if(s.streamId){O(this,L,yC).call(this,s);return}Y(s.data)},y.addEventListener("message",this._onComObjOnMessage)}on(V,o){const y=this.actionHandler;if(y[V])throw new Error(`There is already an actionName called "${V}"`);y[V]=o}send(V,o,y){this.comObj.postMessage({sourceName:this.sourceName,targetName:this.targetName,action:V,data:o},y)}sendWithPromise(V,o,y){const B=this.callbackId++,s=new G.PromiseCapability;this.callbackCapabilities[B]=s;try{this.comObj.postMessage({sourceName:this.sourceName,targetName:this.targetName,action:V,callbackId:B,data:o},y)}catch(Y){s.reject(Y)}return s.promise}sendWithStream(V,o,y,B){const s=this.streamId++,Y=this.sourceName,t=this.targetName,h=this.comObj;return new ReadableStream({start:Z=>{const i=new G.PromiseCapability;return this.streamControllers[s]={controller:Z,startCall:i,pullCall:null,cancelCall:null,isClosed:!1},h.postMessage({sourceName:Y,targetName:t,action:V,streamId:s,data:o,desiredSize:Z.desiredSize},B),i.promise},pull:Z=>{const i=new G.PromiseCapability;return this.streamControllers[s].pullCall=i,h.postMessage({sourceName:Y,targetName:t,stream:cI.PULL,streamId:s,desiredSize:Z.desiredSize}),i.promise},cancel:Z=>{(0,G.assert)(Z instanceof Error,"cancel must have a valid reason");const i=new G.PromiseCapability;return this.streamControllers[s].cancelCall=i,this.streamControllers[s].isClosed=!0,h.postMessage({sourceName:Y,targetName:t,stream:cI.CANCEL,streamId:s,reason:U(Z)}),i.promise}},y)}destroy(){this.comObj.removeEventListener("message",this._onComObjOnMessage)}}L=new WeakSet,yC=function(V){const o=V.streamId,y=this.sourceName,B=V.sourceName,s=this.comObj,Y=this,t=this.actionHandler[V.action],h={enqueue(Z,i=1,A){if(this.isCancelled)return;const d=this.desiredSize;this.desiredSize-=i,d>0&&this.desiredSize<=0&&(this.sinkCapability=new G.PromiseCapability,this.ready=this.sinkCapability.promise),s.postMessage({sourceName:y,targetName:B,stream:cI.ENQUEUE,streamId:o,chunk:Z},A)},close(){this.isCancelled||(this.isCancelled=!0,s.postMessage({sourceName:y,targetName:B,stream:cI.CLOSE,streamId:o}),delete Y.streamSinks[o])},error(Z){(0,G.assert)(Z instanceof Error,"error must have a valid reason"),!this.isCancelled&&(this.isCancelled=!0,s.postMessage({sourceName:y,targetName:B,stream:cI.ERROR,streamId:o,reason:U(Z)}))},sinkCapability:new G.PromiseCapability,onPull:null,onCancel:null,isCancelled:!1,desiredSize:V.desiredSize,ready:null};h.sinkCapability.resolve(),h.ready=h.sinkCapability.promise,this.streamSinks[o]=h,new Promise(function(Z){Z(t(V.data,h))}).then(function(){s.postMessage({sourceName:y,targetName:B,stream:cI.START_COMPLETE,streamId:o,success:!0})},function(Z){s.postMessage({sourceName:y,targetName:B,stream:cI.START_COMPLETE,streamId:o,reason:U(Z)})})},HC=function(V){const o=V.streamId,y=this.sourceName,B=V.sourceName,s=this.comObj,Y=this.streamControllers[o],t=this.streamSinks[o];switch(V.stream){case cI.START_COMPLETE:V.success?Y.startCall.resolve():Y.startCall.reject(U(V.reason));break;case cI.PULL_COMPLETE:V.success?Y.pullCall.resolve():Y.pullCall.reject(U(V.reason));break;case cI.PULL:if(!t){s.postMessage({sourceName:y,targetName:B,stream:cI.PULL_COMPLETE,streamId:o,success:!0});break}t.desiredSize<=0&&V.desiredSize>0&&t.sinkCapability.resolve(),t.desiredSize=V.desiredSize,new Promise(function(h){var Z;h((Z=t.onPull)==null?void 0:Z.call(t))}).then(function(){s.postMessage({sourceName:y,targetName:B,stream:cI.PULL_COMPLETE,streamId:o,success:!0})},function(h){s.postMessage({sourceName:y,targetName:B,stream:cI.PULL_COMPLETE,streamId:o,reason:U(h)})});break;case cI.ENQUEUE:if((0,G.assert)(Y,"enqueue should have stream controller"),Y.isClosed)break;Y.controller.enqueue(V.chunk);break;case cI.CLOSE:if((0,G.assert)(Y,"close should have stream controller"),Y.isClosed)break;Y.isClosed=!0,Y.controller.close(),O(this,L,Rg).call(this,Y,o);break;case cI.ERROR:(0,G.assert)(Y,"error should have stream controller"),Y.controller.error(U(V.reason)),O(this,L,Rg).call(this,Y,o);break;case cI.CANCEL_COMPLETE:V.success?Y.cancelCall.resolve():Y.cancelCall.reject(U(V.reason)),O(this,L,Rg).call(this,Y,o);break;case cI.CANCEL:if(!t)break;new Promise(function(h){var Z;h((Z=t.onCancel)==null?void 0:Z.call(t,U(V.reason)))}).then(function(){s.postMessage({sourceName:y,targetName:B,stream:cI.CANCEL_COMPLETE,streamId:o,success:!0})},function(h){s.postMessage({sourceName:y,targetName:B,stream:cI.CANCEL_COMPLETE,streamId:o,reason:U(h)})}),t.sinkCapability.reject(U(V.reason)),t.isCancelled=!0,delete this.streamSinks[o];break;default:throw new Error("Unexpected stream case")}},Rg=async function(V,o){var y,B,s;await Promise.allSettled([(y=V.startCall)==null?void 0:y.promise,(B=V.pullCall)==null?void 0:B.promise,(s=V.cancelCall)==null?void 0:s.promise]),delete this.streamControllers[o]},b.MessageHandler=WI},(wI,b,ZI)=>{var cI,U;Object.defineProperty(b,"__esModule",{value:!0}),b.Metadata=void 0;var G=ZI(1);class R{constructor({parsedData:L,rawData:e}){_(this,cI);_(this,U);gI(this,cI,L),gI(this,U,e)}getRaw(){return I(this,U)}get(L){return I(this,cI).get(L)??null}getAll(){return(0,G.objectFromMap)(I(this,cI))}has(L){return I(this,cI).has(L)}}cI=new WeakMap,U=new WeakMap,b.Metadata=R},(wI,b,ZI)=>{var L,e,W,z,J,V,Pg;Object.defineProperty(b,"__esModule",{value:!0}),b.OptionalContentConfig=void 0;var G=ZI(1),R=ZI(8);const cI=Symbol("INTERNAL");class U{constructor(B,s){_(this,L,!0);this.name=B,this.intent=s}get visible(){return I(this,L)}_setVisible(B,s){B!==cI&&(0,G.unreachable)("Internal method `_setVisible` called."),gI(this,L,s)}}L=new WeakMap;class WI{constructor(B){_(this,V);_(this,e,null);_(this,W,new Map);_(this,z,null);_(this,J,null);if(this.name=null,this.creator=null,B!==null){this.name=B.name,this.creator=B.creator,gI(this,J,B.order);for(const s of B.groups)I(this,W).set(s.id,new U(s.name,s.intent));if(B.baseState==="OFF")for(const s of I(this,W).values())s._setVisible(cI,!1);for(const s of B.on)I(this,W).get(s)._setVisible(cI,!0);for(const s of B.off)I(this,W).get(s)._setVisible(cI,!1);gI(this,z,this.getHash())}}isVisible(B){if(I(this,W).size===0)return!0;if(!B)return(0,G.warn)("Optional content group not defined."),!0;if(B.type==="OCG")return I(this,W).has(B.id)?I(this,W).get(B.id).visible:((0,G.warn)(`Optional content group not found: ${B.id}`),!0);if(B.type==="OCMD"){if(B.expression)return O(this,V,Pg).call(this,B.expression);if(!B.policy||B.policy==="AnyOn"){for(const s of B.ids){if(!I(this,W).has(s))return(0,G.warn)(`Optional content group not found: ${s}`),!0;if(I(this,W).get(s).visible)return!0}return!1}else if(B.policy==="AllOn"){for(const s of B.ids){if(!I(this,W).has(s))return(0,G.warn)(`Optional content group not found: ${s}`),!0;if(!I(this,W).get(s).visible)return!1}return!0}else if(B.policy==="AnyOff"){for(const s of B.ids){if(!I(this,W).has(s))return(0,G.warn)(`Optional content group not found: ${s}`),!0;if(!I(this,W).get(s).visible)return!0}return!1}else if(B.policy==="AllOff"){for(const s of B.ids){if(!I(this,W).has(s))return(0,G.warn)(`Optional content group not found: ${s}`),!0;if(I(this,W).get(s).visible)return!1}return!0}return(0,G.warn)(`Unknown optional content policy ${B.policy}.`),!0}return(0,G.warn)(`Unknown group type ${B.type}.`),!0}setVisibility(B,s=!0){if(!I(this,W).has(B)){(0,G.warn)(`Optional content group not found: ${B}`);return}I(this,W).get(B)._setVisible(cI,!!s),gI(this,e,null)}get hasInitialVisibility(){return I(this,z)===null||this.getHash()===I(this,z)}getOrder(){return I(this,W).size?I(this,J)?I(this,J).slice():[...I(this,W).keys()]:null}getGroups(){return I(this,W).size>0?(0,G.objectFromMap)(I(this,W)):null}getGroup(B){return I(this,W).get(B)||null}getHash(){if(I(this,e)!==null)return I(this,e);const B=new R.MurmurHash3_64;for(const[s,Y]of I(this,W))B.update(`${s}:${Y.visible}`);return gI(this,e,B.hexdigest())}}e=new WeakMap,W=new WeakMap,z=new WeakMap,J=new WeakMap,V=new WeakSet,Pg=function(B){const s=B.length;if(s<2)return!0;const Y=B[0];for(let t=1;t<s;t++){const h=B[t];let Z;if(Array.isArray(h))Z=O(this,V,Pg).call(this,h);else if(I(this,W).has(h))Z=I(this,W).get(h).visible;else return(0,G.warn)(`Optional content group not found: ${h}`),!0;switch(Y){case"And":if(!Z)return!1;break;case"Or":if(Z)return!0;break;case"Not":return!Z;default:return!0}}return Y==="And"},b.OptionalContentConfig=WI},(wI,b,ZI)=>{Object.defineProperty(b,"__esModule",{value:!0}),b.PDFDataTransportStream=void 0;var G=ZI(1),R=ZI(6);class cI{constructor({length:e,initialData:W,progressiveDone:z=!1,contentDispositionFilename:J=null,disableRange:V=!1,disableStream:o=!1},y){if((0,G.assert)(y,'PDFDataTransportStream - missing required "pdfDataRangeTransport" argument.'),this._queuedChunks=[],this._progressiveDone=z,this._contentDispositionFilename=J,(W==null?void 0:W.length)>0){const B=W instanceof Uint8Array&&W.byteLength===W.buffer.byteLength?W.buffer:new Uint8Array(W).buffer;this._queuedChunks.push(B)}this._pdfDataRangeTransport=y,this._isStreamingSupported=!o,this._isRangeSupported=!V,this._contentLength=e,this._fullRequestReader=null,this._rangeReaders=[],this._pdfDataRangeTransport.addRangeListener((B,s)=>{this._onReceiveData({begin:B,chunk:s})}),this._pdfDataRangeTransport.addProgressListener((B,s)=>{this._onProgress({loaded:B,total:s})}),this._pdfDataRangeTransport.addProgressiveReadListener(B=>{this._onReceiveData({chunk:B})}),this._pdfDataRangeTransport.addProgressiveDoneListener(()=>{this._onProgressiveDone()}),this._pdfDataRangeTransport.transportReady()}_onReceiveData({begin:e,chunk:W}){const z=W instanceof Uint8Array&&W.byteLength===W.buffer.byteLength?W.buffer:new Uint8Array(W).buffer;if(e===void 0)this._fullRequestReader?this._fullRequestReader._enqueue(z):this._queuedChunks.push(z);else{const J=this._rangeReaders.some(function(V){return V._begin!==e?!1:(V._enqueue(z),!0)});(0,G.assert)(J,"_onReceiveData - no `PDFDataTransportStreamRangeReader` instance found.")}}get _progressiveDataLength(){var e;return((e=this._fullRequestReader)==null?void 0:e._loaded)??0}_onProgress(e){var W,z,J,V;e.total===void 0?(z=(W=this._rangeReaders[0])==null?void 0:W.onProgress)==null||z.call(W,{loaded:e.loaded}):(V=(J=this._fullRequestReader)==null?void 0:J.onProgress)==null||V.call(J,{loaded:e.loaded,total:e.total})}_onProgressiveDone(){var e;(e=this._fullRequestReader)==null||e.progressiveDone(),this._progressiveDone=!0}_removeRangeReader(e){const W=this._rangeReaders.indexOf(e);W>=0&&this._rangeReaders.splice(W,1)}getFullReader(){(0,G.assert)(!this._fullRequestReader,"PDFDataTransportStream.getFullReader can only be called once.");const e=this._queuedChunks;return this._queuedChunks=null,new U(this,e,this._progressiveDone,this._contentDispositionFilename)}getRangeReader(e,W){if(W<=this._progressiveDataLength)return null;const z=new WI(this,e,W);return this._pdfDataRangeTransport.requestDataRange(e,W),this._rangeReaders.push(z),z}cancelAllRequests(e){var W;(W=this._fullRequestReader)==null||W.cancel(e);for(const z of this._rangeReaders.slice(0))z.cancel(e);this._pdfDataRangeTransport.abort()}}b.PDFDataTransportStream=cI;class U{constructor(e,W,z=!1,J=null){this._stream=e,this._done=z||!1,this._filename=(0,R.isPdfFile)(J)?J:null,this._queuedChunks=W||[],this._loaded=0;for(const V of this._queuedChunks)this._loaded+=V.byteLength;this._requests=[],this._headersReady=Promise.resolve(),e._fullRequestReader=this,this.onProgress=null}_enqueue(e){this._done||(this._requests.length>0?this._requests.shift().resolve({value:e,done:!1}):this._queuedChunks.push(e),this._loaded+=e.byteLength)}get headersReady(){return this._headersReady}get filename(){return this._filename}get isRangeSupported(){return this._stream._isRangeSupported}get isStreamingSupported(){return this._stream._isStreamingSupported}get contentLength(){return this._stream._contentLength}async read(){if(this._queuedChunks.length>0)return{value:this._queuedChunks.shift(),done:!1};if(this._done)return{value:void 0,done:!0};const e=new G.PromiseCapability;return this._requests.push(e),e.promise}cancel(e){this._done=!0;for(const W of this._requests)W.resolve({value:void 0,done:!0});this._requests.length=0}progressiveDone(){this._done||(this._done=!0)}}class WI{constructor(e,W,z){this._stream=e,this._begin=W,this._end=z,this._queuedChunk=null,this._requests=[],this._done=!1,this.onProgress=null}_enqueue(e){if(!this._done){if(this._requests.length===0)this._queuedChunk=e;else{this._requests.shift().resolve({value:e,done:!1});for(const z of this._requests)z.resolve({value:void 0,done:!0});this._requests.length=0}this._done=!0,this._stream._removeRangeReader(this)}}get isStreamingSupported(){return!1}async read(){if(this._queuedChunk){const W=this._queuedChunk;return this._queuedChunk=null,{value:W,done:!1}}if(this._done)return{value:void 0,done:!0};const e=new G.PromiseCapability;return this._requests.push(e),e.promise}cancel(e){this._done=!0;for(const W of this._requests)W.resolve({value:void 0,done:!0});this._requests.length=0,this._stream._removeRangeReader(this)}}},(wI,b,ZI)=>{Object.defineProperty(b,"__esModule",{value:!0}),b.PDFFetchStream=void 0;var G=ZI(1),R=ZI(20);function cI(z,J,V){return{method:"GET",headers:z,signal:V.signal,mode:"cors",credentials:J?"include":"same-origin",redirect:"follow"}}function U(z){const J=new Headers;for(const V in z){const o=z[V];o!==void 0&&J.append(V,o)}return J}function WI(z){return z instanceof Uint8Array?z.buffer:z instanceof ArrayBuffer?z:((0,G.warn)(`getArrayBuffer - unexpected data format: ${z}`),new Uint8Array(z).buffer)}class L{constructor(J){this.source=J,this.isHttp=/^https?:/i.test(J.url),this.httpHeaders=this.isHttp&&J.httpHeaders||{},this._fullRequestReader=null,this._rangeRequestReaders=[]}get _progressiveDataLength(){var J;return((J=this._fullRequestReader)==null?void 0:J._loaded)??0}getFullReader(){return(0,G.assert)(!this._fullRequestReader,"PDFFetchStream.getFullReader can only be called once."),this._fullRequestReader=new e(this),this._fullRequestReader}getRangeReader(J,V){if(V<=this._progressiveDataLength)return null;const o=new W(this,J,V);return this._rangeRequestReaders.push(o),o}cancelAllRequests(J){var V;(V=this._fullRequestReader)==null||V.cancel(J);for(const o of this._rangeRequestReaders.slice(0))o.cancel(J)}}b.PDFFetchStream=L;class e{constructor(J){this._stream=J,this._reader=null,this._loaded=0,this._filename=null;const V=J.source;this._withCredentials=V.withCredentials||!1,this._contentLength=V.length,this._headersCapability=new G.PromiseCapability,this._disableRange=V.disableRange||!1,this._rangeChunkSize=V.rangeChunkSize,!this._rangeChunkSize&&!this._disableRange&&(this._disableRange=!0),this._abortController=new AbortController,this._isStreamingSupported=!V.disableStream,this._isRangeSupported=!V.disableRange,this._headers=U(this._stream.httpHeaders);const o=V.url;fetch(o,cI(this._headers,this._withCredentials,this._abortController)).then(y=>{if(!(0,R.validateResponseStatus)(y.status))throw(0,R.createResponseStatusError)(y.status,o);this._reader=y.body.getReader(),this._headersCapability.resolve();const B=t=>y.headers.get(t),{allowRangeRequests:s,suggestedLength:Y}=(0,R.validateRangeRequestCapabilities)({getResponseHeader:B,isHttp:this._stream.isHttp,rangeChunkSize:this._rangeChunkSize,disableRange:this._disableRange});this._isRangeSupported=s,this._contentLength=Y||this._contentLength,this._filename=(0,R.extractFilenameFromHeader)(B),!this._isStreamingSupported&&this._isRangeSupported&&this.cancel(new G.AbortException("Streaming is disabled."))}).catch(this._headersCapability.reject),this.onProgress=null}get headersReady(){return this._headersCapability.promise}get filename(){return this._filename}get contentLength(){return this._contentLength}get isRangeSupported(){return this._isRangeSupported}get isStreamingSupported(){return this._isStreamingSupported}async read(){var o;await this._headersCapability.promise;const{value:J,done:V}=await this._reader.read();return V?{value:J,done:V}:(this._loaded+=J.byteLength,(o=this.onProgress)==null||o.call(this,{loaded:this._loaded,total:this._contentLength}),{value:WI(J),done:!1})}cancel(J){var V;(V=this._reader)==null||V.cancel(J),this._abortController.abort()}}class W{constructor(J,V,o){this._stream=J,this._reader=null,this._loaded=0;const y=J.source;this._withCredentials=y.withCredentials||!1,this._readCapability=new G.PromiseCapability,this._isStreamingSupported=!y.disableStream,this._abortController=new AbortController,this._headers=U(this._stream.httpHeaders),this._headers.append("Range",`bytes=${V}-${o-1}`);const B=y.url;fetch(B,cI(this._headers,this._withCredentials,this._abortController)).then(s=>{if(!(0,R.validateResponseStatus)(s.status))throw(0,R.createResponseStatusError)(s.status,B);this._readCapability.resolve(),this._reader=s.body.getReader()}).catch(this._readCapability.reject),this.onProgress=null}get isStreamingSupported(){return this._isStreamingSupported}async read(){var o;await this._readCapability.promise;const{value:J,done:V}=await this._reader.read();return V?{value:J,done:V}:(this._loaded+=J.byteLength,(o=this.onProgress)==null||o.call(this,{loaded:this._loaded}),{value:WI(J),done:!1})}cancel(J){var V;(V=this._reader)==null||V.cancel(J),this._abortController.abort()}}},(wI,b,ZI)=>{Object.defineProperty(b,"__esModule",{value:!0}),b.createResponseStatusError=L,b.extractFilenameFromHeader=WI,b.validateRangeRequestCapabilities=U,b.validateResponseStatus=e;var G=ZI(1),R=ZI(21),cI=ZI(6);function U({getResponseHeader:W,isHttp:z,rangeChunkSize:J,disableRange:V}){const o={allowRangeRequests:!1,suggestedLength:void 0},y=parseInt(W("Content-Length"),10);return!Number.isInteger(y)||(o.suggestedLength=y,y<=2*J)||V||!z||W("Accept-Ranges")!=="bytes"||(W("Content-Encoding")||"identity")!=="identity"||(o.allowRangeRequests=!0),o}function WI(W){const z=W("Content-Disposition");if(z){let J=(0,R.getFilenameFromContentDispositionHeader)(z);if(J.includes("%"))try{J=decodeURIComponent(J)}catch{}if((0,cI.isPdfFile)(J))return J}return null}function L(W,z){return W===404||W===0&&z.startsWith("file:")?new G.MissingPDFException('Missing PDF "'+z+'".'):new G.UnexpectedResponseException(`Unexpected server response (${W}) while retrieving PDF "${z}".`,W)}function e(W){return W===200||W===206}},(wI,b,ZI)=>{Object.defineProperty(b,"__esModule",{value:!0}),b.getFilenameFromContentDispositionHeader=R;var G=ZI(1);function R(cI){let U=!0,WI=L("filename\\*","i").exec(cI);if(WI){WI=WI[1];let y=J(WI);return y=unescape(y),y=V(y),y=o(y),W(y)}if(WI=z(cI),WI){const y=o(WI);return W(y)}if(WI=L("filename","i").exec(cI),WI){WI=WI[1];let y=J(WI);return y=o(y),W(y)}function L(y,B){return new RegExp("(?:^|;)\\s*"+y+'\\s*=\\s*([^";\\s][^;\\s]*|"(?:[^"\\\\]|\\\\"?)+"?)',B)}function e(y,B){if(y){if(!/^[\x00-\xFF]+$/.test(B))return B;try{const s=new TextDecoder(y,{fatal:!0}),Y=(0,G.stringToBytes)(B);B=s.decode(Y),U=!1}catch{}}return B}function W(y){return U&&/[\x80-\xff]/.test(y)&&(y=e("utf-8",y),U&&(y=e("iso-8859-1",y))),y}function z(y){const B=[];let s;const Y=L("filename\\*((?!0\\d)\\d+)(\\*?)","ig");for(;(s=Y.exec(y))!==null;){let[,h,Z,i]=s;if(h=parseInt(h,10),h in B){if(h===0)break;continue}B[h]=[Z,i]}const t=[];for(let h=0;h<B.length&&h in B;++h){let[Z,i]=B[h];i=J(i),Z&&(i=unescape(i),h===0&&(i=V(i))),t.push(i)}return t.join("")}function J(y){if(y.startsWith('"')){const B=y.slice(1).split('\\"');for(let s=0;s<B.length;++s){const Y=B[s].indexOf('"');Y!==-1&&(B[s]=B[s].slice(0,Y),B.length=s+1),B[s]=B[s].replaceAll(/\\(.)/g,"$1")}y=B.join('"')}return y}function V(y){const B=y.indexOf("'");if(B===-1)return y;const s=y.slice(0,B),t=y.slice(B+1).replace(/^[^']*'/,"");return e(s,t)}function o(y){return!y.startsWith("=?")||/[\x00-\x19\x80-\xff]/.test(y)?y:y.replaceAll(/=\?([\w-]*)\?([QqBb])\?((?:[^?]|\?(?!=))*)\?=/g,function(B,s,Y,t){if(Y==="q"||Y==="Q")return t=t.replaceAll("_"," "),t=t.replaceAll(/=([0-9a-fA-F]{2})/g,function(h,Z){return String.fromCharCode(parseInt(Z,16))}),e(s,t);try{t=atob(t)}catch{}return e(s,t)})}return""}},(wI,b,ZI)=>{Object.defineProperty(b,"__esModule",{value:!0}),b.PDFNetworkStream=void 0;var G=ZI(1),R=ZI(20);const cI=200,U=206;function WI(J){const V=J.response;return typeof V!="string"?V:(0,G.stringToBytes)(V).buffer}class L{constructor(V,o={}){this.url=V,this.isHttp=/^https?:/i.test(V),this.httpHeaders=this.isHttp&&o.httpHeaders||Object.create(null),this.withCredentials=o.withCredentials||!1,this.currXhrId=0,this.pendingRequests=Object.create(null)}requestRange(V,o,y){const B={begin:V,end:o};for(const s in y)B[s]=y[s];return this.request(B)}requestFull(V){return this.request(V)}request(V){const o=new XMLHttpRequest,y=this.currXhrId++,B=this.pendingRequests[y]={xhr:o};o.open("GET",this.url),o.withCredentials=this.withCredentials;for(const s in this.httpHeaders){const Y=this.httpHeaders[s];Y!==void 0&&o.setRequestHeader(s,Y)}return this.isHttp&&"begin"in V&&"end"in V?(o.setRequestHeader("Range",`bytes=${V.begin}-${V.end-1}`),B.expectedStatus=U):B.expectedStatus=cI,o.responseType="arraybuffer",V.onError&&(o.onerror=function(s){V.onError(o.status)}),o.onreadystatechange=this.onStateChange.bind(this,y),o.onprogress=this.onProgress.bind(this,y),B.onHeadersReceived=V.onHeadersReceived,B.onDone=V.onDone,B.onError=V.onError,B.onProgress=V.onProgress,o.send(null),y}onProgress(V,o){var B;const y=this.pendingRequests[V];y&&((B=y.onProgress)==null||B.call(y,o))}onStateChange(V,o){var h,Z,i;const y=this.pendingRequests[V];if(!y)return;const B=y.xhr;if(B.readyState>=2&&y.onHeadersReceived&&(y.onHeadersReceived(),delete y.onHeadersReceived),B.readyState!==4||!(V in this.pendingRequests))return;if(delete this.pendingRequests[V],B.status===0&&this.isHttp){(h=y.onError)==null||h.call(y,B.status);return}const s=B.status||cI;if(!(s===cI&&y.expectedStatus===U)&&s!==y.expectedStatus){(Z=y.onError)==null||Z.call(y,B.status);return}const t=WI(B);if(s===U){const A=B.getResponseHeader("Content-Range"),d=/bytes (\d+)-(\d+)\/(\d+)/.exec(A);y.onDone({begin:parseInt(d[1],10),chunk:t})}else t?y.onDone({begin:0,chunk:t}):(i=y.onError)==null||i.call(y,B.status)}getRequestXhr(V){return this.pendingRequests[V].xhr}isPendingRequest(V){return V in this.pendingRequests}abortRequest(V){const o=this.pendingRequests[V].xhr;delete this.pendingRequests[V],o.abort()}}class e{constructor(V){this._source=V,this._manager=new L(V.url,{httpHeaders:V.httpHeaders,withCredentials:V.withCredentials}),this._rangeChunkSize=V.rangeChunkSize,this._fullRequestReader=null,this._rangeRequestReaders=[]}_onRangeRequestReaderClosed(V){const o=this._rangeRequestReaders.indexOf(V);o>=0&&this._rangeRequestReaders.splice(o,1)}getFullReader(){return(0,G.assert)(!this._fullRequestReader,"PDFNetworkStream.getFullReader can only be called once."),this._fullRequestReader=new W(this._manager,this._source),this._fullRequestReader}getRangeReader(V,o){const y=new z(this._manager,V,o);return y.onClosed=this._onRangeRequestReaderClosed.bind(this),this._rangeRequestReaders.push(y),y}cancelAllRequests(V){var o;(o=this._fullRequestReader)==null||o.cancel(V);for(const y of this._rangeRequestReaders.slice(0))y.cancel(V)}}b.PDFNetworkStream=e;class W{constructor(V,o){this._manager=V;const y={onHeadersReceived:this._onHeadersReceived.bind(this),onDone:this._onDone.bind(this),onError:this._onError.bind(this),onProgress:this._onProgress.bind(this)};this._url=o.url,this._fullRequestId=V.requestFull(y),this._headersReceivedCapability=new G.PromiseCapability,this._disableRange=o.disableRange||!1,this._contentLength=o.length,this._rangeChunkSize=o.rangeChunkSize,!this._rangeChunkSize&&!this._disableRange&&(this._disableRange=!0),this._isStreamingSupported=!1,this._isRangeSupported=!1,this._cachedChunks=[],this._requests=[],this._done=!1,this._storedError=void 0,this._filename=null,this.onProgress=null}_onHeadersReceived(){const V=this._fullRequestId,o=this._manager.getRequestXhr(V),y=Y=>o.getResponseHeader(Y),{allowRangeRequests:B,suggestedLength:s}=(0,R.validateRangeRequestCapabilities)({getResponseHeader:y,isHttp:this._manager.isHttp,rangeChunkSize:this._rangeChunkSize,disableRange:this._disableRange});B&&(this._isRangeSupported=!0),this._contentLength=s||this._contentLength,this._filename=(0,R.extractFilenameFromHeader)(y),this._isRangeSupported&&this._manager.abortRequest(V),this._headersReceivedCapability.resolve()}_onDone(V){if(V&&(this._requests.length>0?this._requests.shift().resolve({value:V.chunk,done:!1}):this._cachedChunks.push(V.chunk)),this._done=!0,!(this._cachedChunks.length>0)){for(const o of this._requests)o.resolve({value:void 0,done:!0});this._requests.length=0}}_onError(V){this._storedError=(0,R.createResponseStatusError)(V,this._url),this._headersReceivedCapability.reject(this._storedError);for(const o of this._requests)o.reject(this._storedError);this._requests.length=0,this._cachedChunks.length=0}_onProgress(V){var o;(o=this.onProgress)==null||o.call(this,{loaded:V.loaded,total:V.lengthComputable?V.total:this._contentLength})}get filename(){return this._filename}get isRangeSupported(){return this._isRangeSupported}get isStreamingSupported(){return this._isStreamingSupported}get contentLength(){return this._contentLength}get headersReady(){return this._headersReceivedCapability.promise}async read(){if(this._storedError)throw this._storedError;if(this._cachedChunks.length>0)return{value:this._cachedChunks.shift(),done:!1};if(this._done)return{value:void 0,done:!0};const V=new G.PromiseCapability;return this._requests.push(V),V.promise}cancel(V){this._done=!0,this._headersReceivedCapability.reject(V);for(const o of this._requests)o.resolve({value:void 0,done:!0});this._requests.length=0,this._manager.isPendingRequest(this._fullRequestId)&&this._manager.abortRequest(this._fullRequestId),this._fullRequestReader=null}}class z{constructor(V,o,y){this._manager=V;const B={onDone:this._onDone.bind(this),onError:this._onError.bind(this),onProgress:this._onProgress.bind(this)};this._url=V.url,this._requestId=V.requestRange(o,y,B),this._requests=[],this._queuedChunk=null,this._done=!1,this._storedError=void 0,this.onProgress=null,this.onClosed=null}_close(){var V;(V=this.onClosed)==null||V.call(this,this)}_onDone(V){const o=V.chunk;this._requests.length>0?this._requests.shift().resolve({value:o,done:!1}):this._queuedChunk=o,this._done=!0;for(const y of this._requests)y.resolve({value:void 0,done:!0});this._requests.length=0,this._close()}_onError(V){this._storedError=(0,R.createResponseStatusError)(V,this._url);for(const o of this._requests)o.reject(this._storedError);this._requests.length=0,this._queuedChunk=null}_onProgress(V){var o;this.isStreamingSupported||(o=this.onProgress)==null||o.call(this,{loaded:V.loaded})}get isStreamingSupported(){return!1}async read(){if(this._storedError)throw this._storedError;if(this._queuedChunk!==null){const o=this._queuedChunk;return this._queuedChunk=null,{value:o,done:!1}}if(this._done)return{value:void 0,done:!0};const V=new G.PromiseCapability;return this._requests.push(V),V.promise}cancel(V){this._done=!0;for(const o of this._requests)o.resolve({value:void 0,done:!0});this._requests.length=0,this._manager.isPendingRequest(this._requestId)&&this._manager.abortRequest(this._requestId),this._close()}}},(wI,b,ZI)=>{Object.defineProperty(b,"__esModule",{value:!0}),b.PDFNodeStream=void 0;var G=ZI(1),R=ZI(20);const cI=/^file:\/\/\/[a-zA-Z]:\//;function U(y){const B=require$$5,s=B.parse(y);return s.protocol==="file:"||s.host?s:/^[a-z]:[/\\]/i.test(y)?B.parse(`file:///${y}`):(s.host||(s.protocol="file:"),s)}class WI{constructor(B){this.source=B,this.url=U(B.url),this.isHttp=this.url.protocol==="http:"||this.url.protocol==="https:",this.isFsUrl=this.url.protocol==="file:",this.httpHeaders=this.isHttp&&B.httpHeaders||{},this._fullRequestReader=null,this._rangeRequestReaders=[]}get _progressiveDataLength(){var B;return((B=this._fullRequestReader)==null?void 0:B._loaded)??0}getFullReader(){return(0,G.assert)(!this._fullRequestReader,"PDFNodeStream.getFullReader can only be called once."),this._fullRequestReader=this.isFsUrl?new V(this):new z(this),this._fullRequestReader}getRangeReader(B,s){if(s<=this._progressiveDataLength)return null;const Y=this.isFsUrl?new o(this,B,s):new J(this,B,s);return this._rangeRequestReaders.push(Y),Y}cancelAllRequests(B){var s;(s=this._fullRequestReader)==null||s.cancel(B);for(const Y of this._rangeRequestReaders.slice(0))Y.cancel(B)}}b.PDFNodeStream=WI;class L{constructor(B){this._url=B.url,this._done=!1,this._storedError=null,this.onProgress=null;const s=B.source;this._contentLength=s.length,this._loaded=0,this._filename=null,this._disableRange=s.disableRange||!1,this._rangeChunkSize=s.rangeChunkSize,!this._rangeChunkSize&&!this._disableRange&&(this._disableRange=!0),this._isStreamingSupported=!s.disableStream,this._isRangeSupported=!s.disableRange,this._readableStream=null,this._readCapability=new G.PromiseCapability,this._headersCapability=new G.PromiseCapability}get headersReady(){return this._headersCapability.promise}get filename(){return this._filename}get contentLength(){return this._contentLength}get isRangeSupported(){return this._isRangeSupported}get isStreamingSupported(){return this._isStreamingSupported}async read(){var Y;if(await this._readCapability.promise,this._done)return{value:void 0,done:!0};if(this._storedError)throw this._storedError;const B=this._readableStream.read();return B===null?(this._readCapability=new G.PromiseCapability,this.read()):(this._loaded+=B.length,(Y=this.onProgress)==null||Y.call(this,{loaded:this._loaded,total:this._contentLength}),{value:new Uint8Array(B).buffer,done:!1})}cancel(B){if(!this._readableStream){this._error(B);return}this._readableStream.destroy(B)}_error(B){this._storedError=B,this._readCapability.resolve()}_setReadableStream(B){this._readableStream=B,B.on("readable",()=>{this._readCapability.resolve()}),B.on("end",()=>{B.destroy(),this._done=!0,this._readCapability.resolve()}),B.on("error",s=>{this._error(s)}),!this._isStreamingSupported&&this._isRangeSupported&&this._error(new G.AbortException("streaming is disabled")),this._storedError&&this._readableStream.destroy(this._storedError)}}class e{constructor(B){this._url=B.url,this._done=!1,this._storedError=null,this.onProgress=null,this._loaded=0,this._readableStream=null,this._readCapability=new G.PromiseCapability;const s=B.source;this._isStreamingSupported=!s.disableStream}get isStreamingSupported(){return this._isStreamingSupported}async read(){var Y;if(await this._readCapability.promise,this._done)return{value:void 0,done:!0};if(this._storedError)throw this._storedError;const B=this._readableStream.read();return B===null?(this._readCapability=new G.PromiseCapability,this.read()):(this._loaded+=B.length,(Y=this.onProgress)==null||Y.call(this,{loaded:this._loaded}),{value:new Uint8Array(B).buffer,done:!1})}cancel(B){if(!this._readableStream){this._error(B);return}this._readableStream.destroy(B)}_error(B){this._storedError=B,this._readCapability.resolve()}_setReadableStream(B){this._readableStream=B,B.on("readable",()=>{this._readCapability.resolve()}),B.on("end",()=>{B.destroy(),this._done=!0,this._readCapability.resolve()}),B.on("error",s=>{this._error(s)}),this._storedError&&this._readableStream.destroy(this._storedError)}}function W(y,B){return{protocol:y.protocol,auth:y.auth,host:y.hostname,port:y.port,path:y.path,method:"GET",headers:B}}class z extends L{constructor(B){super(B);const s=Y=>{if(Y.statusCode===404){const i=new G.MissingPDFException(`Missing PDF "${this._url}".`);this._storedError=i,this._headersCapability.reject(i);return}this._headersCapability.resolve(),this._setReadableStream(Y);const t=i=>this._readableStream.headers[i.toLowerCase()],{allowRangeRequests:h,suggestedLength:Z}=(0,R.validateRangeRequestCapabilities)({getResponseHeader:t,isHttp:B.isHttp,rangeChunkSize:this._rangeChunkSize,disableRange:this._disableRange});this._isRangeSupported=h,this._contentLength=Z||this._contentLength,this._filename=(0,R.extractFilenameFromHeader)(t)};if(this._request=null,this._url.protocol==="http:"){const Y=require$$5;this._request=Y.request(W(this._url,B.httpHeaders),s)}else{const Y=require$$5;this._request=Y.request(W(this._url,B.httpHeaders),s)}this._request.on("error",Y=>{this._storedError=Y,this._headersCapability.reject(Y)}),this._request.end()}}class J extends e{constructor(B,s,Y){super(B),this._httpHeaders={};for(const h in B.httpHeaders){const Z=B.httpHeaders[h];Z!==void 0&&(this._httpHeaders[h]=Z)}this._httpHeaders.Range=`bytes=${s}-${Y-1}`;const t=h=>{if(h.statusCode===404){const Z=new G.MissingPDFException(`Missing PDF "${this._url}".`);this._storedError=Z;return}this._setReadableStream(h)};if(this._request=null,this._url.protocol==="http:"){const h=require$$5;this._request=h.request(W(this._url,this._httpHeaders),t)}else{const h=require$$5;this._request=h.request(W(this._url,this._httpHeaders),t)}this._request.on("error",h=>{this._storedError=h}),this._request.end()}}class V extends L{constructor(B){super(B);let s=decodeURIComponent(this._url.path);cI.test(this._url.href)&&(s=s.replace(/^\//,""));const Y=require$$5;Y.lstat(s,(t,h)=>{if(t){t.code==="ENOENT"&&(t=new G.MissingPDFException(`Missing PDF "${s}".`)),this._storedError=t,this._headersCapability.reject(t);return}this._contentLength=h.size,this._setReadableStream(Y.createReadStream(s)),this._headersCapability.resolve()})}}class o extends e{constructor(B,s,Y){super(B);let t=decodeURIComponent(this._url.path);cI.test(this._url.href)&&(t=t.replace(/^\//,""));const h=require$$5;this._setReadableStream(h.createReadStream(t,{start:s,end:Y-1}))}}},(wI,b,ZI)=>{Object.defineProperty(b,"__esModule",{value:!0}),b.SVGGraphics=void 0;var G=ZI(6),R=ZI(1);const cI={fontStyle:"normal",fontWeight:"normal",fillColor:"#000000"},U="http://www.w3.org/XML/1998/namespace",WI="http://www.w3.org/1999/xlink",L=["butt","round","square"],e=["miter","round","bevel"],W=function(h,Z="",i=!1){if(URL.createObjectURL&&typeof Blob<"u"&&!i)return URL.createObjectURL(new Blob([h],{type:Z}));const A="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";let d=`data:${Z};base64,`;for(let c=0,F=h.length;c<F;c+=3){const l=h[c]&255,X=h[c+1]&255,K=h[c+2]&255,lI=l>>2,j=(l&3)<<4|X>>4,r=c+1<F?(X&15)<<2|K>>6:64,T=c+2<F?K&63:64;d+=A[lI]+A[j]+A[r]+A[T]}return d},z=function(){const h=new Uint8Array([137,80,78,71,13,10,26,10]),Z=12,i=new Int32Array(256);for(let K=0;K<256;K++){let lI=K;for(let j=0;j<8;j++)lI=lI&1?3988292384^lI>>1&2147483647:lI>>1&2147483647;i[K]=lI}function A(K,lI,j){let r=-1;for(let T=lI;T<j;T++){const dI=(r^K[T])&255,M=i[dI];r=r>>>8^M}return r^-1}function d(K,lI,j,r){let T=r;const dI=lI.length;j[T]=dI>>24&255,j[T+1]=dI>>16&255,j[T+2]=dI>>8&255,j[T+3]=dI&255,T+=4,j[T]=K.charCodeAt(0)&255,j[T+1]=K.charCodeAt(1)&255,j[T+2]=K.charCodeAt(2)&255,j[T+3]=K.charCodeAt(3)&255,T+=4,j.set(lI,T),T+=lI.length;const M=A(j,r+4,T);j[T]=M>>24&255,j[T+1]=M>>16&255,j[T+2]=M>>8&255,j[T+3]=M&255}function c(K,lI,j){let r=1,T=0;for(let dI=lI;dI<j;++dI)r=(r+(K[dI]&255))%65521,T=(T+r)%65521;return T<<16|r}function F(K){if(!R.isNodeJS)return l(K);try{const lI=parseInt(process.versions.node)>=8?K:Buffer.from(K),j=require$$5.deflateSync(lI,{level:9});return j instanceof Uint8Array?j:new Uint8Array(j)}catch(lI){(0,R.warn)("Not compressing PNG because zlib.deflateSync is unavailable: "+lI)}return l(K)}function l(K){let lI=K.length;const j=65535,r=Math.ceil(lI/j),T=new Uint8Array(2+lI+r*5+4);let dI=0;T[dI++]=120,T[dI++]=156;let M=0;for(;lI>j;)T[dI++]=0,T[dI++]=255,T[dI++]=255,T[dI++]=0,T[dI++]=0,T.set(K.subarray(M,M+j),dI),dI+=j,M+=j,lI-=j;T[dI++]=1,T[dI++]=lI&255,T[dI++]=lI>>8&255,T[dI++]=~lI&65535&255,T[dI++]=(~lI&65535)>>8&255,T.set(K.subarray(M),dI),dI+=K.length-M;const k=c(K,0,K.length);return T[dI++]=k>>24&255,T[dI++]=k>>16&255,T[dI++]=k>>8&255,T[dI++]=k&255,T}function X(K,lI,j,r){const T=K.width,dI=K.height;let M,k,P;const N=K.data;switch(lI){case R.ImageKind.GRAYSCALE_1BPP:k=0,M=1,P=T+7>>3;break;case R.ImageKind.RGB_24BPP:k=2,M=8,P=T*3;break;case R.ImageKind.RGBA_32BPP:k=6,M=8,P=T*4;break;default:throw new Error("invalid format")}const g=new Uint8Array((1+P)*dI);let C=0,m=0;for(let bI=0;bI<dI;++bI)g[C++]=0,g.set(N.subarray(m,m+P),C),m+=P,C+=P;if(lI===R.ImageKind.GRAYSCALE_1BPP&&r){C=0;for(let bI=0;bI<dI;bI++){C++;for(let sI=0;sI<P;sI++)g[C++]^=255}}const u=new Uint8Array([T>>24&255,T>>16&255,T>>8&255,T&255,dI>>24&255,dI>>16&255,dI>>8&255,dI&255,M,k,0,0,0]),n=F(g),D=h.length+Z*3+u.length+n.length,x=new Uint8Array(D);let CI=0;return x.set(h,CI),CI+=h.length,d("IHDR",u,x,CI),CI+=Z+u.length,d("IDATA",n,x,CI),CI+=Z+n.length,d("IEND",new Uint8Array(0),x,CI),W(x,"image/png",j)}return function(lI,j,r){const T=lI.kind===void 0?R.ImageKind.GRAYSCALE_1BPP:lI.kind;return X(lI,T,j,r)}}();class J{constructor(){this.fontSizeScale=1,this.fontWeight=cI.fontWeight,this.fontSize=0,this.textMatrix=R.IDENTITY_MATRIX,this.fontMatrix=R.FONT_IDENTITY_MATRIX,this.leading=0,this.textRenderingMode=R.TextRenderingMode.FILL,this.textMatrixScale=1,this.x=0,this.y=0,this.lineX=0,this.lineY=0,this.charSpacing=0,this.wordSpacing=0,this.textHScale=1,this.textRise=0,this.fillColor=cI.fillColor,this.strokeColor="#000000",this.fillAlpha=1,this.strokeAlpha=1,this.lineWidth=1,this.lineJoin="",this.lineCap="",this.miterLimit=0,this.dashArray=[],this.dashPhase=0,this.dependencies=[],this.activeClipUrl=null,this.clipGroup=null,this.maskId=""}clone(){return Object.create(this)}setCurrentPoint(Z,i){this.x=Z,this.y=i}}function V(h){let Z=[];const i=[];for(const A of h){if(A.fn==="save"){Z.push({fnId:92,fn:"group",items:[]}),i.push(Z),Z=Z.at(-1).items;continue}A.fn==="restore"?Z=i.pop():Z.push(A)}return Z}function o(h){if(Number.isInteger(h))return h.toString();const Z=h.toFixed(10);let i=Z.length-1;if(Z[i]!=="0")return Z;do i--;while(Z[i]==="0");return Z.substring(0,Z[i]==="."?i:i+1)}function y(h){if(h[4]===0&&h[5]===0){if(h[1]===0&&h[2]===0)return h[0]===1&&h[3]===1?"":`scale(${o(h[0])} ${o(h[3])})`;if(h[0]===h[3]&&h[1]===-h[2]){const Z=Math.acos(h[0])*180/Math.PI;return`rotate(${o(Z)})`}}else if(h[0]===1&&h[1]===0&&h[2]===0&&h[3]===1)return`translate(${o(h[4])} ${o(h[5])})`;return`matrix(${o(h[0])} ${o(h[1])} ${o(h[2])} ${o(h[3])} ${o(h[4])} ${o(h[5])})`}let B=0,s=0,Y=0;class t{constructor(Z,i,A=!1){(0,G.deprecated)("The SVG back-end is no longer maintained and *may* be removed in the future."),this.svgFactory=new G.DOMSVGFactory,this.current=new J,this.transformMatrix=R.IDENTITY_MATRIX,this.transformStack=[],this.extraStack=[],this.commonObjs=Z,this.objs=i,this.pendingClip=null,this.pendingEOFill=!1,this.embedFonts=!1,this.embeddedFonts=Object.create(null),this.cssStyle=null,this.forceDataSchema=!!A,this._operatorIdMapping=[];for(const d in R.OPS)this._operatorIdMapping[R.OPS[d]]=d}getObject(Z,i=null){return typeof Z=="string"?Z.startsWith("g_")?this.commonObjs.get(Z):this.objs.get(Z):i}save(){this.transformStack.push(this.transformMatrix);const Z=this.current;this.extraStack.push(Z),this.current=Z.clone()}restore(){this.transformMatrix=this.transformStack.pop(),this.current=this.extraStack.pop(),this.pendingClip=null,this.tgrp=null}group(Z){this.save(),this.executeOpTree(Z),this.restore()}loadDependencies(Z){const i=Z.fnArray,A=Z.argsArray;for(let d=0,c=i.length;d<c;d++)if(i[d]===R.OPS.dependency)for(const F of A[d]){const l=F.startsWith("g_")?this.commonObjs:this.objs,X=new Promise(K=>{l.get(F,K)});this.current.dependencies.push(X)}return Promise.all(this.current.dependencies)}transform(Z,i,A,d,c,F){const l=[Z,i,A,d,c,F];this.transformMatrix=R.Util.transform(this.transformMatrix,l),this.tgrp=null}getSVG(Z,i){this.viewport=i;const A=this._initialize(i);return this.loadDependencies(Z).then(()=>(this.transformMatrix=R.IDENTITY_MATRIX,this.executeOpTree(this.convertOpList(Z)),A))}convertOpList(Z){const i=this._operatorIdMapping,A=Z.argsArray,d=Z.fnArray,c=[];for(let F=0,l=d.length;F<l;F++){const X=d[F];c.push({fnId:X,fn:i[X],args:A[F]})}return V(c)}executeOpTree(Z){for(const i of Z){const A=i.fn,d=i.fnId,c=i.args;switch(d|0){case R.OPS.beginText:this.beginText();break;case R.OPS.dependency:break;case R.OPS.setLeading:this.setLeading(c);break;case R.OPS.setLeadingMoveText:this.setLeadingMoveText(c[0],c[1]);break;case R.OPS.setFont:this.setFont(c);break;case R.OPS.showText:this.showText(c[0]);break;case R.OPS.showSpacedText:this.showText(c[0]);break;case R.OPS.endText:this.endText();break;case R.OPS.moveText:this.moveText(c[0],c[1]);break;case R.OPS.setCharSpacing:this.setCharSpacing(c[0]);break;case R.OPS.setWordSpacing:this.setWordSpacing(c[0]);break;case R.OPS.setHScale:this.setHScale(c[0]);break;case R.OPS.setTextMatrix:this.setTextMatrix(c[0],c[1],c[2],c[3],c[4],c[5]);break;case R.OPS.setTextRise:this.setTextRise(c[0]);break;case R.OPS.setTextRenderingMode:this.setTextRenderingMode(c[0]);break;case R.OPS.setLineWidth:this.setLineWidth(c[0]);break;case R.OPS.setLineJoin:this.setLineJoin(c[0]);break;case R.OPS.setLineCap:this.setLineCap(c[0]);break;case R.OPS.setMiterLimit:this.setMiterLimit(c[0]);break;case R.OPS.setFillRGBColor:this.setFillRGBColor(c[0],c[1],c[2]);break;case R.OPS.setStrokeRGBColor:this.setStrokeRGBColor(c[0],c[1],c[2]);break;case R.OPS.setStrokeColorN:this.setStrokeColorN(c);break;case R.OPS.setFillColorN:this.setFillColorN(c);break;case R.OPS.shadingFill:this.shadingFill(c[0]);break;case R.OPS.setDash:this.setDash(c[0],c[1]);break;case R.OPS.setRenderingIntent:this.setRenderingIntent(c[0]);break;case R.OPS.setFlatness:this.setFlatness(c[0]);break;case R.OPS.setGState:this.setGState(c[0]);break;case R.OPS.fill:this.fill();break;case R.OPS.eoFill:this.eoFill();break;case R.OPS.stroke:this.stroke();break;case R.OPS.fillStroke:this.fillStroke();break;case R.OPS.eoFillStroke:this.eoFillStroke();break;case R.OPS.clip:this.clip("nonzero");break;case R.OPS.eoClip:this.clip("evenodd");break;case R.OPS.paintSolidColorImageMask:this.paintSolidColorImageMask();break;case R.OPS.paintImageXObject:this.paintImageXObject(c[0]);break;case R.OPS.paintInlineImageXObject:this.paintInlineImageXObject(c[0]);break;case R.OPS.paintImageMaskXObject:this.paintImageMaskXObject(c[0]);break;case R.OPS.paintFormXObjectBegin:this.paintFormXObjectBegin(c[0],c[1]);break;case R.OPS.paintFormXObjectEnd:this.paintFormXObjectEnd();break;case R.OPS.closePath:this.closePath();break;case R.OPS.closeStroke:this.closeStroke();break;case R.OPS.closeFillStroke:this.closeFillStroke();break;case R.OPS.closeEOFillStroke:this.closeEOFillStroke();break;case R.OPS.nextLine:this.nextLine();break;case R.OPS.transform:this.transform(c[0],c[1],c[2],c[3],c[4],c[5]);break;case R.OPS.constructPath:this.constructPath(c[0],c[1]);break;case R.OPS.endPath:this.endPath();break;case 92:this.group(i.items);break;default:(0,R.warn)(`Unimplemented operator ${A}`);break}}}setWordSpacing(Z){this.current.wordSpacing=Z}setCharSpacing(Z){this.current.charSpacing=Z}nextLine(){this.moveText(0,this.current.leading)}setTextMatrix(Z,i,A,d,c,F){const l=this.current;l.textMatrix=l.lineMatrix=[Z,i,A,d,c,F],l.textMatrixScale=Math.hypot(Z,i),l.x=l.lineX=0,l.y=l.lineY=0,l.xcoords=[],l.ycoords=[],l.tspan=this.svgFactory.createElement("svg:tspan"),l.tspan.setAttributeNS(null,"font-family",l.fontFamily),l.tspan.setAttributeNS(null,"font-size",`${o(l.fontSize)}px`),l.tspan.setAttributeNS(null,"y",o(-l.y)),l.txtElement=this.svgFactory.createElement("svg:text"),l.txtElement.append(l.tspan)}beginText(){const Z=this.current;Z.x=Z.lineX=0,Z.y=Z.lineY=0,Z.textMatrix=R.IDENTITY_MATRIX,Z.lineMatrix=R.IDENTITY_MATRIX,Z.textMatrixScale=1,Z.tspan=this.svgFactory.createElement("svg:tspan"),Z.txtElement=this.svgFactory.createElement("svg:text"),Z.txtgrp=this.svgFactory.createElement("svg:g"),Z.xcoords=[],Z.ycoords=[]}moveText(Z,i){const A=this.current;A.x=A.lineX+=Z,A.y=A.lineY+=i,A.xcoords=[],A.ycoords=[],A.tspan=this.svgFactory.createElement("svg:tspan"),A.tspan.setAttributeNS(null,"font-family",A.fontFamily),A.tspan.setAttributeNS(null,"font-size",`${o(A.fontSize)}px`),A.tspan.setAttributeNS(null,"y",o(-A.y))}showText(Z){const i=this.current,A=i.font,d=i.fontSize;if(d===0)return;const c=i.fontSizeScale,F=i.charSpacing,l=i.wordSpacing,X=i.fontDirection,K=i.textHScale*X,lI=A.vertical,j=lI?1:-1,r=A.defaultVMetrics,T=d*i.fontMatrix[0];let dI=0;for(const P of Z){if(P===null){dI+=X*l;continue}else if(typeof P=="number"){dI+=j*P*d/1e3;continue}const N=(P.isSpace?l:0)+F,g=P.fontChar;let C,m,u=P.width;if(lI){let D;const x=P.vmetric||r;D=P.vmetric?x[1]:u*.5,D=-D*T;const CI=x[2]*T;u=x?-x[0]:u,C=D/c,m=(dI+CI)/c}else C=dI/c,m=0;(P.isInFont||A.missingFile)&&(i.xcoords.push(i.x+C),lI&&i.ycoords.push(-i.y+m),i.tspan.textContent+=g);const n=lI?u*T-N*X:u*T+N*X;dI+=n}i.tspan.setAttributeNS(null,"x",i.xcoords.map(o).join(" ")),lI?i.tspan.setAttributeNS(null,"y",i.ycoords.map(o).join(" ")):i.tspan.setAttributeNS(null,"y",o(-i.y)),lI?i.y-=dI:i.x+=dI*K,i.tspan.setAttributeNS(null,"font-family",i.fontFamily),i.tspan.setAttributeNS(null,"font-size",`${o(i.fontSize)}px`),i.fontStyle!==cI.fontStyle&&i.tspan.setAttributeNS(null,"font-style",i.fontStyle),i.fontWeight!==cI.fontWeight&&i.tspan.setAttributeNS(null,"font-weight",i.fontWeight);const M=i.textRenderingMode&R.TextRenderingMode.FILL_STROKE_MASK;if(M===R.TextRenderingMode.FILL||M===R.TextRenderingMode.FILL_STROKE?(i.fillColor!==cI.fillColor&&i.tspan.setAttributeNS(null,"fill",i.fillColor),i.fillAlpha<1&&i.tspan.setAttributeNS(null,"fill-opacity",i.fillAlpha)):i.textRenderingMode===R.TextRenderingMode.ADD_TO_PATH?i.tspan.setAttributeNS(null,"fill","transparent"):i.tspan.setAttributeNS(null,"fill","none"),M===R.TextRenderingMode.STROKE||M===R.TextRenderingMode.FILL_STROKE){const P=1/(i.textMatrixScale||1);this._setStrokeAttributes(i.tspan,P)}let k=i.textMatrix;i.textRise!==0&&(k=k.slice(),k[5]+=i.textRise),i.txtElement.setAttributeNS(null,"transform",`${y(k)} scale(${o(K)}, -1)`),i.txtElement.setAttributeNS(U,"xml:space","preserve"),i.txtElement.append(i.tspan),i.txtgrp.append(i.txtElement),this._ensureTransformGroup().append(i.txtElement)}setLeadingMoveText(Z,i){this.setLeading(-i),this.moveText(Z,i)}addFontStyle(Z){if(!Z.data)throw new Error('addFontStyle: No font data available, ensure that the "fontExtraProperties" API parameter is set.');this.cssStyle||(this.cssStyle=this.svgFactory.createElement("svg:style"),this.cssStyle.setAttributeNS(null,"type","text/css"),this.defs.append(this.cssStyle));const i=W(Z.data,Z.mimetype,this.forceDataSchema);this.cssStyle.textContent+=`@font-face { font-family: "${Z.loadedName}"; src: url(${i}); }
`}setFont(Z){const i=this.current,A=this.commonObjs.get(Z[0]);let d=Z[1];i.font=A,this.embedFonts&&!A.missingFile&&!this.embeddedFonts[A.loadedName]&&(this.addFontStyle(A),this.embeddedFonts[A.loadedName]=A),i.fontMatrix=A.fontMatrix||R.FONT_IDENTITY_MATRIX;let c="normal";A.black?c="900":A.bold&&(c="bold");const F=A.italic?"italic":"normal";d<0?(d=-d,i.fontDirection=-1):i.fontDirection=1,i.fontSize=d,i.fontFamily=A.loadedName,i.fontWeight=c,i.fontStyle=F,i.tspan=this.svgFactory.createElement("svg:tspan"),i.tspan.setAttributeNS(null,"y",o(-i.y)),i.xcoords=[],i.ycoords=[]}endText(){var i;const Z=this.current;Z.textRenderingMode&R.TextRenderingMode.ADD_TO_PATH_FLAG&&((i=Z.txtElement)!=null&&i.hasChildNodes())&&(Z.element=Z.txtElement,this.clip("nonzero"),this.endPath())}setLineWidth(Z){Z>0&&(this.current.lineWidth=Z)}setLineCap(Z){this.current.lineCap=L[Z]}setLineJoin(Z){this.current.lineJoin=e[Z]}setMiterLimit(Z){this.current.miterLimit=Z}setStrokeAlpha(Z){this.current.strokeAlpha=Z}setStrokeRGBColor(Z,i,A){this.current.strokeColor=R.Util.makeHexColor(Z,i,A)}setFillAlpha(Z){this.current.fillAlpha=Z}setFillRGBColor(Z,i,A){this.current.fillColor=R.Util.makeHexColor(Z,i,A),this.current.tspan=this.svgFactory.createElement("svg:tspan"),this.current.xcoords=[],this.current.ycoords=[]}setStrokeColorN(Z){this.current.strokeColor=this._makeColorN_Pattern(Z)}setFillColorN(Z){this.current.fillColor=this._makeColorN_Pattern(Z)}shadingFill(Z){const{width:i,height:A}=this.viewport,d=R.Util.inverseTransform(this.transformMatrix),[c,F,l,X]=R.Util.getAxialAlignedBoundingBox([0,0,i,A],d),K=this.svgFactory.createElement("svg:rect");K.setAttributeNS(null,"x",c),K.setAttributeNS(null,"y",F),K.setAttributeNS(null,"width",l-c),K.setAttributeNS(null,"height",X-F),K.setAttributeNS(null,"fill",this._makeShadingPattern(Z)),this.current.fillAlpha<1&&K.setAttributeNS(null,"fill-opacity",this.current.fillAlpha),this._ensureTransformGroup().append(K)}_makeColorN_Pattern(Z){return Z[0]==="TilingPattern"?this._makeTilingPattern(Z):this._makeShadingPattern(Z)}_makeTilingPattern(Z){const i=Z[1],A=Z[2],d=Z[3]||R.IDENTITY_MATRIX,[c,F,l,X]=Z[4],K=Z[5],lI=Z[6],j=Z[7],r=`shading${Y++}`,[T,dI,M,k]=R.Util.normalizeRect([...R.Util.applyTransform([c,F],d),...R.Util.applyTransform([l,X],d)]),[P,N]=R.Util.singularValueDecompose2dScale(d),g=K*P,C=lI*N,m=this.svgFactory.createElement("svg:pattern");m.setAttributeNS(null,"id",r),m.setAttributeNS(null,"patternUnits","userSpaceOnUse"),m.setAttributeNS(null,"width",g),m.setAttributeNS(null,"height",C),m.setAttributeNS(null,"x",`${T}`),m.setAttributeNS(null,"y",`${dI}`);const u=this.svg,n=this.transformMatrix,D=this.current.fillColor,x=this.current.strokeColor,CI=this.svgFactory.create(M-T,k-dI);if(this.svg=CI,this.transformMatrix=d,j===2){const bI=R.Util.makeHexColor(...i);this.current.fillColor=bI,this.current.strokeColor=bI}return this.executeOpTree(this.convertOpList(A)),this.svg=u,this.transformMatrix=n,this.current.fillColor=D,this.current.strokeColor=x,m.append(CI.childNodes[0]),this.defs.append(m),`url(#${r})`}_makeShadingPattern(Z){switch(typeof Z=="string"&&(Z=this.objs.get(Z)),Z[0]){case"RadialAxial":const i=`shading${Y++}`,A=Z[3];let d;switch(Z[1]){case"axial":const c=Z[4],F=Z[5];d=this.svgFactory.createElement("svg:linearGradient"),d.setAttributeNS(null,"id",i),d.setAttributeNS(null,"gradientUnits","userSpaceOnUse"),d.setAttributeNS(null,"x1",c[0]),d.setAttributeNS(null,"y1",c[1]),d.setAttributeNS(null,"x2",F[0]),d.setAttributeNS(null,"y2",F[1]);break;case"radial":const l=Z[4],X=Z[5],K=Z[6],lI=Z[7];d=this.svgFactory.createElement("svg:radialGradient"),d.setAttributeNS(null,"id",i),d.setAttributeNS(null,"gradientUnits","userSpaceOnUse"),d.setAttributeNS(null,"cx",X[0]),d.setAttributeNS(null,"cy",X[1]),d.setAttributeNS(null,"r",lI),d.setAttributeNS(null,"fx",l[0]),d.setAttributeNS(null,"fy",l[1]),d.setAttributeNS(null,"fr",K);break;default:throw new Error(`Unknown RadialAxial type: ${Z[1]}`)}for(const c of A){const F=this.svgFactory.createElement("svg:stop");F.setAttributeNS(null,"offset",c[0]),F.setAttributeNS(null,"stop-color",c[1]),d.append(F)}return this.defs.append(d),`url(#${i})`;case"Mesh":return(0,R.warn)("Unimplemented pattern Mesh"),null;case"Dummy":return"hotpink";default:throw new Error(`Unknown IR type: ${Z[0]}`)}}setDash(Z,i){this.current.dashArray=Z,this.current.dashPhase=i}constructPath(Z,i){const A=this.current;let d=A.x,c=A.y,F=[],l=0;for(const X of Z)switch(X|0){case R.OPS.rectangle:d=i[l++],c=i[l++];const K=i[l++],lI=i[l++],j=d+K,r=c+lI;F.push("M",o(d),o(c),"L",o(j),o(c),"L",o(j),o(r),"L",o(d),o(r),"Z");break;case R.OPS.moveTo:d=i[l++],c=i[l++],F.push("M",o(d),o(c));break;case R.OPS.lineTo:d=i[l++],c=i[l++],F.push("L",o(d),o(c));break;case R.OPS.curveTo:d=i[l+4],c=i[l+5],F.push("C",o(i[l]),o(i[l+1]),o(i[l+2]),o(i[l+3]),o(d),o(c)),l+=6;break;case R.OPS.curveTo2:F.push("C",o(d),o(c),o(i[l]),o(i[l+1]),o(i[l+2]),o(i[l+3])),d=i[l+2],c=i[l+3],l+=4;break;case R.OPS.curveTo3:d=i[l+2],c=i[l+3],F.push("C",o(i[l]),o(i[l+1]),o(d),o(c),o(d),o(c)),l+=4;break;case R.OPS.closePath:F.push("Z");break}F=F.join(" "),A.path&&Z.length>0&&Z[0]!==R.OPS.rectangle&&Z[0]!==R.OPS.moveTo?F=A.path.getAttributeNS(null,"d")+F:(A.path=this.svgFactory.createElement("svg:path"),this._ensureTransformGroup().append(A.path)),A.path.setAttributeNS(null,"d",F),A.path.setAttributeNS(null,"fill","none"),A.element=A.path,A.setCurrentPoint(d,c)}endPath(){const Z=this.current;if(Z.path=null,!this.pendingClip)return;if(!Z.element){this.pendingClip=null;return}const i=`clippath${B++}`,A=this.svgFactory.createElement("svg:clipPath");A.setAttributeNS(null,"id",i),A.setAttributeNS(null,"transform",y(this.transformMatrix));const d=Z.element.cloneNode(!0);if(this.pendingClip==="evenodd"?d.setAttributeNS(null,"clip-rule","evenodd"):d.setAttributeNS(null,"clip-rule","nonzero"),this.pendingClip=null,A.append(d),this.defs.append(A),Z.activeClipUrl){Z.clipGroup=null;for(const c of this.extraStack)c.clipGroup=null;A.setAttributeNS(null,"clip-path",Z.activeClipUrl)}Z.activeClipUrl=`url(#${i})`,this.tgrp=null}clip(Z){this.pendingClip=Z}closePath(){const Z=this.current;if(Z.path){const i=`${Z.path.getAttributeNS(null,"d")}Z`;Z.path.setAttributeNS(null,"d",i)}}setLeading(Z){this.current.leading=-Z}setTextRise(Z){this.current.textRise=Z}setTextRenderingMode(Z){this.current.textRenderingMode=Z}setHScale(Z){this.current.textHScale=Z/100}setRenderingIntent(Z){}setFlatness(Z){}setGState(Z){for(const[i,A]of Z)switch(i){case"LW":this.setLineWidth(A);break;case"LC":this.setLineCap(A);break;case"LJ":this.setLineJoin(A);break;case"ML":this.setMiterLimit(A);break;case"D":this.setDash(A[0],A[1]);break;case"RI":this.setRenderingIntent(A);break;case"FL":this.setFlatness(A);break;case"Font":this.setFont(A);break;case"CA":this.setStrokeAlpha(A);break;case"ca":this.setFillAlpha(A);break;default:(0,R.warn)(`Unimplemented graphic state operator ${i}`);break}}fill(){const Z=this.current;Z.element&&(Z.element.setAttributeNS(null,"fill",Z.fillColor),Z.element.setAttributeNS(null,"fill-opacity",Z.fillAlpha),this.endPath())}stroke(){const Z=this.current;Z.element&&(this._setStrokeAttributes(Z.element),Z.element.setAttributeNS(null,"fill","none"),this.endPath())}_setStrokeAttributes(Z,i=1){const A=this.current;let d=A.dashArray;i!==1&&d.length>0&&(d=d.map(function(c){return i*c})),Z.setAttributeNS(null,"stroke",A.strokeColor),Z.setAttributeNS(null,"stroke-opacity",A.strokeAlpha),Z.setAttributeNS(null,"stroke-miterlimit",o(A.miterLimit)),Z.setAttributeNS(null,"stroke-linecap",A.lineCap),Z.setAttributeNS(null,"stroke-linejoin",A.lineJoin),Z.setAttributeNS(null,"stroke-width",o(i*A.lineWidth)+"px"),Z.setAttributeNS(null,"stroke-dasharray",d.map(o).join(" ")),Z.setAttributeNS(null,"stroke-dashoffset",o(i*A.dashPhase)+"px")}eoFill(){var Z;(Z=this.current.element)==null||Z.setAttributeNS(null,"fill-rule","evenodd"),this.fill()}fillStroke(){this.stroke(),this.fill()}eoFillStroke(){var Z;(Z=this.current.element)==null||Z.setAttributeNS(null,"fill-rule","evenodd"),this.fillStroke()}closeStroke(){this.closePath(),this.stroke()}closeFillStroke(){this.closePath(),this.fillStroke()}closeEOFillStroke(){this.closePath(),this.eoFillStroke()}paintSolidColorImageMask(){const Z=this.svgFactory.createElement("svg:rect");Z.setAttributeNS(null,"x","0"),Z.setAttributeNS(null,"y","0"),Z.setAttributeNS(null,"width","1px"),Z.setAttributeNS(null,"height","1px"),Z.setAttributeNS(null,"fill",this.current.fillColor),this._ensureTransformGroup().append(Z)}paintImageXObject(Z){const i=this.getObject(Z);if(!i){(0,R.warn)(`Dependent image with object ID ${Z} is not ready yet`);return}this.paintInlineImageXObject(i)}paintInlineImageXObject(Z,i){const A=Z.width,d=Z.height,c=z(Z,this.forceDataSchema,!!i),F=this.svgFactory.createElement("svg:rect");F.setAttributeNS(null,"x","0"),F.setAttributeNS(null,"y","0"),F.setAttributeNS(null,"width",o(A)),F.setAttributeNS(null,"height",o(d)),this.current.element=F,this.clip("nonzero");const l=this.svgFactory.createElement("svg:image");l.setAttributeNS(WI,"xlink:href",c),l.setAttributeNS(null,"x","0"),l.setAttributeNS(null,"y",o(-d)),l.setAttributeNS(null,"width",o(A)+"px"),l.setAttributeNS(null,"height",o(d)+"px"),l.setAttributeNS(null,"transform",`scale(${o(1/A)} ${o(-1/d)})`),i?i.append(l):this._ensureTransformGroup().append(l)}paintImageMaskXObject(Z){const i=this.getObject(Z.data,Z);if(i.bitmap){(0,R.warn)("paintImageMaskXObject: ImageBitmap support is not implemented, ensure that the `isOffscreenCanvasSupported` API parameter is disabled.");return}const A=this.current,d=i.width,c=i.height,F=A.fillColor;A.maskId=`mask${s++}`;const l=this.svgFactory.createElement("svg:mask");l.setAttributeNS(null,"id",A.maskId);const X=this.svgFactory.createElement("svg:rect");X.setAttributeNS(null,"x","0"),X.setAttributeNS(null,"y","0"),X.setAttributeNS(null,"width",o(d)),X.setAttributeNS(null,"height",o(c)),X.setAttributeNS(null,"fill",F),X.setAttributeNS(null,"mask",`url(#${A.maskId})`),this.defs.append(l),this._ensureTransformGroup().append(X),this.paintInlineImageXObject(i,l)}paintFormXObjectBegin(Z,i){if(Array.isArray(Z)&&Z.length===6&&this.transform(Z[0],Z[1],Z[2],Z[3],Z[4],Z[5]),i){const A=i[2]-i[0],d=i[3]-i[1],c=this.svgFactory.createElement("svg:rect");c.setAttributeNS(null,"x",i[0]),c.setAttributeNS(null,"y",i[1]),c.setAttributeNS(null,"width",o(A)),c.setAttributeNS(null,"height",o(d)),this.current.element=c,this.clip("nonzero"),this.endPath()}}paintFormXObjectEnd(){}_initialize(Z){const i=this.svgFactory.create(Z.width,Z.height),A=this.svgFactory.createElement("svg:defs");i.append(A),this.defs=A;const d=this.svgFactory.createElement("svg:g");return d.setAttributeNS(null,"transform",y(Z.transform)),i.append(d),this.svg=d,i}_ensureClipGroup(){if(!this.current.clipGroup){const Z=this.svgFactory.createElement("svg:g");Z.setAttributeNS(null,"clip-path",this.current.activeClipUrl),this.svg.append(Z),this.current.clipGroup=Z}return this.current.clipGroup}_ensureTransformGroup(){return this.tgrp||(this.tgrp=this.svgFactory.createElement("svg:g"),this.tgrp.setAttributeNS(null,"transform",y(this.transformMatrix)),this.current.activeClipUrl?this._ensureClipGroup().append(this.tgrp):this.svg.append(this.tgrp)),this.tgrp}}b.SVGGraphics=t},(wI,b)=>{Object.defineProperty(b,"__esModule",{value:!0}),b.XfaText=void 0;class ZI{static textContent(R){const cI=[],U={items:cI,styles:Object.create(null)};function WI(L){var z;if(!L)return;let e=null;const W=L.name;if(W==="#text")e=L.value;else if(ZI.shouldBuildText(W))(z=L==null?void 0:L.attributes)!=null&&z.textContent?e=L.attributes.textContent:L.value&&(e=L.value);else return;if(e!==null&&cI.push({str:e}),!!L.children)for(const J of L.children)WI(J)}return WI(R),U}static shouldBuildText(R){return!(R==="textarea"||R==="input"||R==="option"||R==="select")}}b.XfaText=ZI},(wI,b,ZI)=>{Object.defineProperty(b,"__esModule",{value:!0}),b.TextLayerRenderTask=void 0,b.renderTextLayer=y,b.updateTextLayer=B;var G=ZI(1),R=ZI(6);const cI=1e5,U=30,WI=.8,L=new Map;function e(s,Y){let t;if(Y&&G.FeatureTest.isOffscreenCanvasSupported)t=new OffscreenCanvas(s,s).getContext("2d",{alpha:!1});else{const h=document.createElement("canvas");h.width=h.height=s,t=h.getContext("2d",{alpha:!1})}return t}function W(s,Y){const t=L.get(s);if(t)return t;const h=e(U,Y);h.font=`${U}px ${s}`;const Z=h.measureText("");let i=Z.fontBoundingBoxAscent,A=Math.abs(Z.fontBoundingBoxDescent);if(i){const c=i/(i+A);return L.set(s,c),h.canvas.width=h.canvas.height=0,c}h.strokeStyle="red",h.clearRect(0,0,U,U),h.strokeText("g",0,0);let d=h.getImageData(0,0,U,U).data;A=0;for(let c=d.length-1-3;c>=0;c-=4)if(d[c]>0){A=Math.ceil(c/4/U);break}h.clearRect(0,0,U,U),h.strokeText("A",0,U),d=h.getImageData(0,0,U,U).data,i=0;for(let c=0,F=d.length;c<F;c+=4)if(d[c]>0){i=U-Math.floor(c/4/U);break}if(h.canvas.width=h.canvas.height=0,i){const c=i/(i+A);return L.set(s,c),c}return L.set(s,WI),WI}function z(s,Y,t){const h=document.createElement("span"),Z={angle:0,canvasWidth:0,hasText:Y.str!=="",hasEOL:Y.hasEOL,fontSize:0};s._textDivs.push(h);const i=G.Util.transform(s._transform,Y.transform);let A=Math.atan2(i[1],i[0]);const d=t[Y.fontName];d.vertical&&(A+=Math.PI/2);const c=Math.hypot(i[2],i[3]),F=c*W(d.fontFamily,s._isOffscreenCanvasSupported);let l,X;A===0?(l=i[4],X=i[5]-F):(l=i[4]+F*Math.sin(A),X=i[5]-F*Math.cos(A));const K="calc(var(--scale-factor)*",lI=h.style;s._container===s._rootContainer?(lI.left=`${(100*l/s._pageWidth).toFixed(2)}%`,lI.top=`${(100*X/s._pageHeight).toFixed(2)}%`):(lI.left=`${K}${l.toFixed(2)}px)`,lI.top=`${K}${X.toFixed(2)}px)`),lI.fontSize=`${K}${c.toFixed(2)}px)`,lI.fontFamily=d.fontFamily,Z.fontSize=c,h.setAttribute("role","presentation"),h.textContent=Y.str,h.dir=Y.dir,s._fontInspectorEnabled&&(h.dataset.fontName=Y.fontName),A!==0&&(Z.angle=A*(180/Math.PI));let j=!1;if(Y.str.length>1)j=!0;else if(Y.str!==" "&&Y.transform[0]!==Y.transform[3]){const r=Math.abs(Y.transform[0]),T=Math.abs(Y.transform[3]);r!==T&&Math.max(r,T)/Math.min(r,T)>1.5&&(j=!0)}j&&(Z.canvasWidth=d.vertical?Y.height:Y.width),s._textDivProperties.set(h,Z),s._isReadableStream&&s._layoutText(h)}function J(s){const{div:Y,scale:t,properties:h,ctx:Z,prevFontSize:i,prevFontFamily:A}=s,{style:d}=Y;let c="";if(h.canvasWidth!==0&&h.hasText){const{fontFamily:F}=d,{canvasWidth:l,fontSize:X}=h;(i!==X||A!==F)&&(Z.font=`${X*t}px ${F}`,s.prevFontSize=X,s.prevFontFamily=F);const{width:K}=Z.measureText(Y.textContent);K>0&&(c=`scaleX(${l*t/K})`)}h.angle!==0&&(c=`rotate(${h.angle}deg) ${c}`),c.length>0&&(d.transform=c)}function V(s){if(s._canceled)return;const Y=s._textDivs,t=s._capability;if(Y.length>cI){t.resolve();return}if(!s._isReadableStream)for(const Z of Y)s._layoutText(Z);t.resolve()}class o{constructor({textContentSource:Y,container:t,viewport:h,textDivs:Z,textDivProperties:i,textContentItemsStr:A,isOffscreenCanvasSupported:d}){var K;this._textContentSource=Y,this._isReadableStream=Y instanceof ReadableStream,this._container=this._rootContainer=t,this._textDivs=Z||[],this._textContentItemsStr=A||[],this._isOffscreenCanvasSupported=d,this._fontInspectorEnabled=!!((K=globalThis.FontInspector)!=null&&K.enabled),this._reader=null,this._textDivProperties=i||new WeakMap,this._canceled=!1,this._capability=new G.PromiseCapability,this._layoutTextParams={prevFontSize:null,prevFontFamily:null,div:null,scale:h.scale*(globalThis.devicePixelRatio||1),properties:null,ctx:e(0,d)};const{pageWidth:c,pageHeight:F,pageX:l,pageY:X}=h.rawDims;this._transform=[1,0,0,-1,-l,X+F],this._pageWidth=c,this._pageHeight=F,(0,R.setLayerDimensions)(t,h),this._capability.promise.finally(()=>{this._layoutTextParams=null}).catch(()=>{})}get promise(){return this._capability.promise}cancel(){this._canceled=!0,this._reader&&(this._reader.cancel(new G.AbortException("TextLayer task cancelled.")).catch(()=>{}),this._reader=null),this._capability.reject(new G.AbortException("TextLayer task cancelled."))}_processItems(Y,t){for(const h of Y){if(h.str===void 0){if(h.type==="beginMarkedContentProps"||h.type==="beginMarkedContent"){const Z=this._container;this._container=document.createElement("span"),this._container.classList.add("markedContent"),h.id!==null&&this._container.setAttribute("id",`${h.id}`),Z.append(this._container)}else h.type==="endMarkedContent"&&(this._container=this._container.parentNode);continue}this._textContentItemsStr.push(h.str),z(this,h,t)}}_layoutText(Y){const t=this._layoutTextParams.properties=this._textDivProperties.get(Y);if(this._layoutTextParams.div=Y,J(this._layoutTextParams),t.hasText&&this._container.append(Y),t.hasEOL){const h=document.createElement("br");h.setAttribute("role","presentation"),this._container.append(h)}}_render(){const Y=new G.PromiseCapability;let t=Object.create(null);if(this._isReadableStream){const h=()=>{this._reader.read().then(({value:Z,done:i})=>{if(i){Y.resolve();return}Object.assign(t,Z.styles),this._processItems(Z.items,t),h()},Y.reject)};this._reader=this._textContentSource.getReader(),h()}else if(this._textContentSource){const{items:h,styles:Z}=this._textContentSource;this._processItems(h,Z),Y.resolve()}else throw new Error('No "textContentSource" parameter specified.');Y.promise.then(()=>{t=null,V(this)},this._capability.reject)}}b.TextLayerRenderTask=o;function y(s){!s.textContentSource&&(s.textContent||s.textContentStream)&&((0,R.deprecated)("The TextLayerRender `textContent`/`textContentStream` parameters will be removed in the future, please use `textContentSource` instead."),s.textContentSource=s.textContent||s.textContentStream);const{container:Y,viewport:t}=s,h=getComputedStyle(Y),Z=h.getPropertyValue("visibility"),i=parseFloat(h.getPropertyValue("--scale-factor"));Z==="visible"&&(!i||Math.abs(i-t.scale)>1e-5)&&console.error("The `--scale-factor` CSS-variable must be set, to the same value as `viewport.scale`, either on the `container`-element itself or higher up in the DOM.");const A=new o(s);return A._render(),A}function B({container:s,viewport:Y,textDivs:t,textDivProperties:h,isOffscreenCanvasSupported:Z,mustRotate:i=!0,mustRescale:A=!0}){if(i&&(0,R.setLayerDimensions)(s,{rotation:Y.rotation}),A){const d=e(0,Z),F={prevFontSize:null,prevFontFamily:null,div:null,scale:Y.scale*(globalThis.devicePixelRatio||1),properties:null,ctx:d};for(const l of t)F.properties=h.get(l),F.div=l,J(F)}}},(wI,b,ZI)=>{var W,z,J,V,o,y,B,s,Y,t,h,fg,yg,qg,_g;Object.defineProperty(b,"__esModule",{value:!0}),b.AnnotationEditorLayer=void 0;var G=ZI(1),R=ZI(4),cI=ZI(28),U=ZI(33),WI=ZI(6),L=ZI(34);const c=class c{constructor({uiManager:l,pageIndex:X,div:K,accessibilityManager:lI,annotationLayer:j,viewport:r,l10n:T}){_(this,h);_(this,W);_(this,z,!1);_(this,J,null);_(this,V,this.pointerup.bind(this));_(this,o,this.pointerdown.bind(this));_(this,y,new Map);_(this,B,!1);_(this,s,!1);_(this,Y,!1);_(this,t);const dI=[cI.FreeTextEditor,U.InkEditor,L.StampEditor];if(!c._initialized){c._initialized=!0;for(const M of dI)M.initialize(T)}l.registerEditorTypes(dI),gI(this,t,l),this.pageIndex=X,this.div=K,gI(this,W,lI),gI(this,J,j),this.viewport=r,I(this,t).addLayer(this)}get isEmpty(){return I(this,y).size===0}updateToolbar(l){I(this,t).updateToolbar(l)}updateMode(l=I(this,t).getMode()){O(this,h,_g).call(this),l===G.AnnotationEditorType.INK?(this.addInkEditorIfNeeded(!1),this.disableClick()):this.enableClick(),l!==G.AnnotationEditorType.NONE&&(this.div.classList.toggle("freeTextEditing",l===G.AnnotationEditorType.FREETEXT),this.div.classList.toggle("inkEditing",l===G.AnnotationEditorType.INK),this.div.classList.toggle("stampEditing",l===G.AnnotationEditorType.STAMP),this.div.hidden=!1)}addInkEditorIfNeeded(l){if(!l&&I(this,t).getMode()!==G.AnnotationEditorType.INK)return;if(!l){for(const K of I(this,y).values())if(K.isEmpty()){K.setInBackground();return}}O(this,h,yg).call(this,{offsetX:0,offsetY:0},!1).setInBackground()}setEditingState(l){I(this,t).setEditingState(l)}addCommands(l){I(this,t).addCommands(l)}enable(){this.div.style.pointerEvents="auto";const l=new Set;for(const K of I(this,y).values())K.enableEditing(),K.annotationElementId&&l.add(K.annotationElementId);if(!I(this,J))return;const X=I(this,J).getEditableAnnotations();for(const K of X){if(K.hide(),I(this,t).isDeletedAnnotationElement(K.data.id)||l.has(K.data.id))continue;const lI=this.deserialize(K);lI&&(this.addOrRebuild(lI),lI.enableEditing())}}disable(){var X;gI(this,Y,!0),this.div.style.pointerEvents="none";const l=new Set;for(const K of I(this,y).values()){if(K.disableEditing(),!K.annotationElementId||K.serialize()!==null){l.add(K.annotationElementId);continue}(X=this.getEditableAnnotation(K.annotationElementId))==null||X.show(),K.remove()}if(I(this,J)){const K=I(this,J).getEditableAnnotations();for(const lI of K){const{id:j}=lI.data;l.has(j)||I(this,t).isDeletedAnnotationElement(j)||lI.show()}}O(this,h,_g).call(this),this.isEmpty&&(this.div.hidden=!0),gI(this,Y,!1)}getEditableAnnotation(l){var X;return((X=I(this,J))==null?void 0:X.getEditableAnnotation(l))||null}setActiveEditor(l){I(this,t).getActive()!==l&&I(this,t).setActiveEditor(l)}enableClick(){this.div.addEventListener("pointerdown",I(this,o)),this.div.addEventListener("pointerup",I(this,V))}disableClick(){this.div.removeEventListener("pointerdown",I(this,o)),this.div.removeEventListener("pointerup",I(this,V))}attach(l){I(this,y).set(l.id,l);const{annotationElementId:X}=l;X&&I(this,t).isDeletedAnnotationElement(X)&&I(this,t).removeDeletedAnnotationElement(l)}detach(l){var X;I(this,y).delete(l.id),(X=I(this,W))==null||X.removePointerInTextLayer(l.contentDiv),!I(this,Y)&&l.annotationElementId&&I(this,t).addDeletedAnnotationElement(l)}remove(l){this.detach(l),I(this,t).removeEditor(l),l.div.contains(document.activeElement)&&setTimeout(()=>{I(this,t).focusMainContainer()},0),l.div.remove(),l.isAttachedToDOM=!1,I(this,s)||this.addInkEditorIfNeeded(!1)}changeParent(l){var X;l.parent!==this&&(l.annotationElementId&&(I(this,t).addDeletedAnnotationElement(l.annotationElementId),R.AnnotationEditor.deleteAnnotationElement(l),l.annotationElementId=null),this.attach(l),(X=l.parent)==null||X.detach(l),l.setParent(this),l.div&&l.isAttachedToDOM&&(l.div.remove(),this.div.append(l.div)))}add(l){if(this.changeParent(l),I(this,t).addEditor(l),this.attach(l),!l.isAttachedToDOM){const X=l.render();this.div.append(X),l.isAttachedToDOM=!0}l.fixAndSetPosition(),l.onceAdded(),I(this,t).addToAnnotationStorage(l)}moveEditorInDOM(l){var K;if(!l.isAttachedToDOM)return;const{activeElement:X}=document;l.div.contains(X)&&(l._focusEventsAllowed=!1,setTimeout(()=>{l.div.contains(document.activeElement)?l._focusEventsAllowed=!0:(l.div.addEventListener("focusin",()=>{l._focusEventsAllowed=!0},{once:!0}),X.focus())},0)),l._structTreeParentId=(K=I(this,W))==null?void 0:K.moveElementInDOM(this.div,l.div,l.contentDiv,!0)}addOrRebuild(l){l.needsToBeRebuilt()?l.rebuild():this.add(l)}addUndoableEditor(l){const X=()=>l._uiManager.rebuild(l),K=()=>{l.remove()};this.addCommands({cmd:X,undo:K,mustExec:!1})}getNextId(){return I(this,t).getId()}pasteEditor(l,X){I(this,t).updateToolbar(l),I(this,t).updateMode(l);const{offsetX:K,offsetY:lI}=O(this,h,qg).call(this),j=this.getNextId(),r=O(this,h,fg).call(this,{parent:this,id:j,x:K,y:lI,uiManager:I(this,t),isCentered:!0,...X});r&&this.add(r)}deserialize(l){switch(l.annotationType??l.annotationEditorType){case G.AnnotationEditorType.FREETEXT:return cI.FreeTextEditor.deserialize(l,this,I(this,t));case G.AnnotationEditorType.INK:return U.InkEditor.deserialize(l,this,I(this,t));case G.AnnotationEditorType.STAMP:return L.StampEditor.deserialize(l,this,I(this,t))}return null}addNewEditor(){O(this,h,yg).call(this,O(this,h,qg).call(this),!0)}setSelected(l){I(this,t).setSelected(l)}toggleSelected(l){I(this,t).toggleSelected(l)}isSelected(l){return I(this,t).isSelected(l)}unselect(l){I(this,t).unselect(l)}pointerup(l){const{isMac:X}=G.FeatureTest.platform;if(!(l.button!==0||l.ctrlKey&&X)&&l.target===this.div&&I(this,B)){if(gI(this,B,!1),!I(this,z)){gI(this,z,!0);return}if(I(this,t).getMode()===G.AnnotationEditorType.STAMP){I(this,t).unselectAll();return}O(this,h,yg).call(this,l,!1)}}pointerdown(l){if(I(this,B)){gI(this,B,!1);return}const{isMac:X}=G.FeatureTest.platform;if(l.button!==0||l.ctrlKey&&X||l.target!==this.div)return;gI(this,B,!0);const K=I(this,t).getActive();gI(this,z,!K||K.isEmpty())}findNewParent(l,X,K){const lI=I(this,t).findParent(X,K);return lI===null||lI===this?!1:(lI.changeParent(l),!0)}destroy(){var l,X;((l=I(this,t).getActive())==null?void 0:l.parent)===this&&(I(this,t).commitOrRemove(),I(this,t).setActiveEditor(null));for(const K of I(this,y).values())(X=I(this,W))==null||X.removePointerInTextLayer(K.contentDiv),K.setParent(null),K.isAttachedToDOM=!1,K.div.remove();this.div=null,I(this,y).clear(),I(this,t).removeLayer(this)}render({viewport:l}){this.viewport=l,(0,WI.setLayerDimensions)(this.div,l);for(const X of I(this,t).getEditors(this.pageIndex))this.add(X);this.updateMode()}update({viewport:l}){I(this,t).commitOrRemove(),this.viewport=l,(0,WI.setLayerDimensions)(this.div,{rotation:l.rotation}),this.updateMode()}get pageDimensions(){const{pageWidth:l,pageHeight:X}=this.viewport.rawDims;return[l,X]}};W=new WeakMap,z=new WeakMap,J=new WeakMap,V=new WeakMap,o=new WeakMap,y=new WeakMap,B=new WeakMap,s=new WeakMap,Y=new WeakMap,t=new WeakMap,h=new WeakSet,fg=function(l){switch(I(this,t).getMode()){case G.AnnotationEditorType.FREETEXT:return new cI.FreeTextEditor(l);case G.AnnotationEditorType.INK:return new U.InkEditor(l);case G.AnnotationEditorType.STAMP:return new L.StampEditor(l)}return null},yg=function(l,X){const K=this.getNextId(),lI=O(this,h,fg).call(this,{parent:this,id:K,x:l.offsetX,y:l.offsetY,uiManager:I(this,t),isCentered:X});return lI&&this.add(lI),lI},qg=function(){const{x:l,y:X,width:K,height:lI}=this.div.getBoundingClientRect(),j=Math.max(0,l),r=Math.max(0,X),T=Math.min(window.innerWidth,l+K),dI=Math.min(window.innerHeight,X+lI),M=(j+T)/2-l,k=(r+dI)/2-X,[P,N]=this.viewport.rotation%180===0?[M,k]:[k,M];return{offsetX:P,offsetY:N}},_g=function(){gI(this,s,!0);for(const l of I(this,y).values())l.isEmpty()&&l.remove();gI(this,s,!1)},fI(c,"_initialized",!1);let e=c;b.AnnotationEditorLayer=e},(wI,b,ZI)=>{var L,e,W,z,J,V,o,y,B,s,MC,uC,nC,wg,$g,DC,IC;Object.defineProperty(b,"__esModule",{value:!0}),b.FreeTextEditor=void 0;var G=ZI(1),R=ZI(5),cI=ZI(4),U=ZI(29);const c=class c extends cI.AnnotationEditor{constructor(X){super({...X,name:"freeTextEditor"});_(this,s);_(this,L,this.editorDivBlur.bind(this));_(this,e,this.editorDivFocus.bind(this));_(this,W,this.editorDivInput.bind(this));_(this,z,this.editorDivKeydown.bind(this));_(this,J);_(this,V,"");_(this,o,`${this.id}-editor`);_(this,y);_(this,B,null);gI(this,J,X.color||c._defaultColor||cI.AnnotationEditor._defaultLineColor),gI(this,y,X.fontSize||c._defaultFontSize)}static get _keyboardManager(){const X=c.prototype,K=r=>r.isEmpty(),lI=R.AnnotationEditorUIManager.TRANSLATE_SMALL,j=R.AnnotationEditorUIManager.TRANSLATE_BIG;return(0,G.shadow)(this,"_keyboardManager",new R.KeyboardManager([[["ctrl+s","mac+meta+s","ctrl+p","mac+meta+p"],X.commitOrRemove,{bubbles:!0}],[["ctrl+Enter","mac+meta+Enter","Escape","mac+Escape"],X.commitOrRemove],[["ArrowLeft","mac+ArrowLeft"],X._translateEmpty,{args:[-lI,0],checker:K}],[["ctrl+ArrowLeft","mac+shift+ArrowLeft"],X._translateEmpty,{args:[-j,0],checker:K}],[["ArrowRight","mac+ArrowRight"],X._translateEmpty,{args:[lI,0],checker:K}],[["ctrl+ArrowRight","mac+shift+ArrowRight"],X._translateEmpty,{args:[j,0],checker:K}],[["ArrowUp","mac+ArrowUp"],X._translateEmpty,{args:[0,-lI],checker:K}],[["ctrl+ArrowUp","mac+shift+ArrowUp"],X._translateEmpty,{args:[0,-j],checker:K}],[["ArrowDown","mac+ArrowDown"],X._translateEmpty,{args:[0,lI],checker:K}],[["ctrl+ArrowDown","mac+shift+ArrowDown"],X._translateEmpty,{args:[0,j],checker:K}]]))}static initialize(X){cI.AnnotationEditor.initialize(X,{strings:["free_text2_default_content","editor_free_text2_aria_label"]});const K=getComputedStyle(document.documentElement);this._internalPadding=parseFloat(K.getPropertyValue("--freetext-padding"))}static updateDefaultParams(X,K){switch(X){case G.AnnotationEditorParamsType.FREETEXT_SIZE:c._defaultFontSize=K;break;case G.AnnotationEditorParamsType.FREETEXT_COLOR:c._defaultColor=K;break}}updateParams(X,K){switch(X){case G.AnnotationEditorParamsType.FREETEXT_SIZE:O(this,s,MC).call(this,K);break;case G.AnnotationEditorParamsType.FREETEXT_COLOR:O(this,s,uC).call(this,K);break}}static get defaultPropertiesToUpdate(){return[[G.AnnotationEditorParamsType.FREETEXT_SIZE,c._defaultFontSize],[G.AnnotationEditorParamsType.FREETEXT_COLOR,c._defaultColor||cI.AnnotationEditor._defaultLineColor]]}get propertiesToUpdate(){return[[G.AnnotationEditorParamsType.FREETEXT_SIZE,I(this,y)],[G.AnnotationEditorParamsType.FREETEXT_COLOR,I(this,J)]]}_translateEmpty(X,K){this._uiManager.translateSelectedEditors(X,K,!0)}getInitialTranslation(){const X=this.parentScale;return[-c._internalPadding*X,-(c._internalPadding+I(this,y))*X]}rebuild(){this.parent&&(super.rebuild(),this.div!==null&&(this.isAttachedToDOM||this.parent.add(this)))}enableEditMode(){this.isInEditMode()||(this.parent.setEditingState(!1),this.parent.updateToolbar(G.AnnotationEditorType.FREETEXT),super.enableEditMode(),this.overlayDiv.classList.remove("enabled"),this.editorDiv.contentEditable=!0,this._isDraggable=!1,this.div.removeAttribute("aria-activedescendant"),this.editorDiv.addEventListener("keydown",I(this,z)),this.editorDiv.addEventListener("focus",I(this,e)),this.editorDiv.addEventListener("blur",I(this,L)),this.editorDiv.addEventListener("input",I(this,W)))}disableEditMode(){this.isInEditMode()&&(this.parent.setEditingState(!0),super.disableEditMode(),this.overlayDiv.classList.add("enabled"),this.editorDiv.contentEditable=!1,this.div.setAttribute("aria-activedescendant",I(this,o)),this._isDraggable=!0,this.editorDiv.removeEventListener("keydown",I(this,z)),this.editorDiv.removeEventListener("focus",I(this,e)),this.editorDiv.removeEventListener("blur",I(this,L)),this.editorDiv.removeEventListener("input",I(this,W)),this.div.focus({preventScroll:!0}),this.isEditing=!1,this.parent.div.classList.add("freeTextEditing"))}focusin(X){this._focusEventsAllowed&&(super.focusin(X),X.target!==this.editorDiv&&this.editorDiv.focus())}onceAdded(){var X;if(this.width){O(this,s,IC).call(this);return}this.enableEditMode(),this.editorDiv.focus(),(X=this._initialOptions)!=null&&X.isCentered&&this.center(),this._initialOptions=null}isEmpty(){return!this.editorDiv||this.editorDiv.innerText.trim()===""}remove(){this.isEditing=!1,this.parent&&(this.parent.setEditingState(!0),this.parent.div.classList.add("freeTextEditing")),super.remove()}commit(){if(!this.isInEditMode())return;super.commit(),this.disableEditMode();const X=I(this,V),K=gI(this,V,O(this,s,nC).call(this).trimEnd());if(X===K)return;const lI=j=>{if(gI(this,V,j),!j){this.remove();return}O(this,s,$g).call(this),this._uiManager.rebuild(this),O(this,s,wg).call(this)};this.addCommands({cmd:()=>{lI(K)},undo:()=>{lI(X)},mustExec:!1}),O(this,s,wg).call(this)}shouldGetKeyboardEvents(){return this.isInEditMode()}enterInEditMode(){this.enableEditMode(),this.editorDiv.focus()}dblclick(X){this.enterInEditMode()}keydown(X){X.target===this.div&&X.key==="Enter"&&(this.enterInEditMode(),X.preventDefault())}editorDivKeydown(X){c._keyboardManager.exec(this,X)}editorDivFocus(X){this.isEditing=!0}editorDivBlur(X){this.isEditing=!1}editorDivInput(X){this.parent.div.classList.toggle("freeTextEditing",this.isEmpty())}disableEditing(){this.editorDiv.setAttribute("role","comment"),this.editorDiv.removeAttribute("aria-multiline")}enableEditing(){this.editorDiv.setAttribute("role","textbox"),this.editorDiv.setAttribute("aria-multiline",!0)}render(){if(this.div)return this.div;let X,K;this.width&&(X=this.x,K=this.y),super.render(),this.editorDiv=document.createElement("div"),this.editorDiv.className="internal",this.editorDiv.setAttribute("id",I(this,o)),this.enableEditing(),cI.AnnotationEditor._l10nPromise.get("editor_free_text2_aria_label").then(j=>{var r;return(r=this.editorDiv)==null?void 0:r.setAttribute("aria-label",j)}),cI.AnnotationEditor._l10nPromise.get("free_text2_default_content").then(j=>{var r;return(r=this.editorDiv)==null?void 0:r.setAttribute("default-content",j)}),this.editorDiv.contentEditable=!0;const{style:lI}=this.editorDiv;if(lI.fontSize=`calc(${I(this,y)}px * var(--scale-factor))`,lI.color=I(this,J),this.div.append(this.editorDiv),this.overlayDiv=document.createElement("div"),this.overlayDiv.classList.add("overlay","enabled"),this.div.append(this.overlayDiv),(0,R.bindEvents)(this,this.div,["dblclick","keydown"]),this.width){const[j,r]=this.parentDimensions;if(this.annotationElementId){const{position:T}=I(this,B);let[dI,M]=this.getInitialTranslation();[dI,M]=this.pageTranslationToScreen(dI,M);const[k,P]=this.pageDimensions,[N,g]=this.pageTranslation;let C,m;switch(this.rotation){case 0:C=X+(T[0]-N)/k,m=K+this.height-(T[1]-g)/P;break;case 90:C=X+(T[0]-N)/k,m=K-(T[1]-g)/P,[dI,M]=[M,-dI];break;case 180:C=X-this.width+(T[0]-N)/k,m=K-(T[1]-g)/P,[dI,M]=[-dI,-M];break;case 270:C=X+(T[0]-N-this.height*P)/k,m=K+(T[1]-g-this.width*k)/P,[dI,M]=[-M,dI];break}this.setAt(C*j,m*r,dI,M)}else this.setAt(X*j,K*r,this.width*j,this.height*r);O(this,s,$g).call(this),this._isDraggable=!0,this.editorDiv.contentEditable=!1}else this._isDraggable=!1,this.editorDiv.contentEditable=!0;return this.div}get contentDiv(){return this.editorDiv}static deserialize(X,K,lI){let j=null;if(X instanceof U.FreeTextAnnotationElement){const{data:{defaultAppearanceData:{fontSize:T,fontColor:dI},rect:M,rotation:k,id:P},textContent:N,textPosition:g,parent:{page:{pageNumber:C}}}=X;if(!N||N.length===0)return null;j=X={annotationType:G.AnnotationEditorType.FREETEXT,color:Array.from(dI),fontSize:T,value:N.join(`
`),position:g,pageIndex:C-1,rect:M,rotation:k,id:P,deleted:!1}}const r=super.deserialize(X,K,lI);return gI(r,y,X.fontSize),gI(r,J,G.Util.makeHexColor(...X.color)),gI(r,V,X.value),r.annotationElementId=X.id||null,gI(r,B,j),r}serialize(X=!1){if(this.isEmpty())return null;if(this.deleted)return{pageIndex:this.pageIndex,id:this.annotationElementId,deleted:!0};const K=c._internalPadding*this.parentScale,lI=this.getRect(K,K),j=cI.AnnotationEditor._colorManager.convert(this.isAttachedToDOM?getComputedStyle(this.editorDiv).color:I(this,J)),r={annotationType:G.AnnotationEditorType.FREETEXT,color:j,fontSize:I(this,y),value:I(this,V),pageIndex:this.pageIndex,rect:lI,rotation:this.rotation,structTreeParentId:this._structTreeParentId};return X?r:this.annotationElementId&&!O(this,s,DC).call(this,r)?null:(r.id=this.annotationElementId,r)}};L=new WeakMap,e=new WeakMap,W=new WeakMap,z=new WeakMap,J=new WeakMap,V=new WeakMap,o=new WeakMap,y=new WeakMap,B=new WeakMap,s=new WeakSet,MC=function(X){const K=j=>{this.editorDiv.style.fontSize=`calc(${j}px * var(--scale-factor))`,this.translate(0,-(j-I(this,y))*this.parentScale),gI(this,y,j),O(this,s,wg).call(this)},lI=I(this,y);this.addCommands({cmd:()=>{K(X)},undo:()=>{K(lI)},mustExec:!0,type:G.AnnotationEditorParamsType.FREETEXT_SIZE,overwriteIfSameType:!0,keepUndo:!0})},uC=function(X){const K=I(this,J);this.addCommands({cmd:()=>{gI(this,J,this.editorDiv.style.color=X)},undo:()=>{gI(this,J,this.editorDiv.style.color=K)},mustExec:!0,type:G.AnnotationEditorParamsType.FREETEXT_COLOR,overwriteIfSameType:!0,keepUndo:!0})},nC=function(){const X=this.editorDiv.getElementsByTagName("div");if(X.length===0)return this.editorDiv.innerText;const K=[];for(const lI of X)K.push(lI.innerText.replace(/\r\n?|\n/,""));return K.join(`
`)},wg=function(){const[X,K]=this.parentDimensions;let lI;if(this.isAttachedToDOM)lI=this.div.getBoundingClientRect();else{const{currentLayer:j,div:r}=this,T=r.style.display;r.style.display="hidden",j.div.append(this.div),lI=r.getBoundingClientRect(),r.remove(),r.style.display=T}this.rotation%180===this.parentRotation%180?(this.width=lI.width/X,this.height=lI.height/K):(this.width=lI.height/X,this.height=lI.width/K),this.fixAndSetPosition()},$g=function(){if(this.editorDiv.replaceChildren(),!!I(this,V))for(const X of I(this,V).split(`
`)){const K=document.createElement("div");K.append(X?document.createTextNode(X):document.createElement("br")),this.editorDiv.append(K)}},DC=function(X){const{value:K,fontSize:lI,color:j,rect:r,pageIndex:T}=I(this,B);return X.value!==K||X.fontSize!==lI||X.rect.some((dI,M)=>Math.abs(dI-r[M])>=1)||X.color.some((dI,M)=>dI!==j[M])||X.pageIndex!==T},IC=function(X=!1){if(!this.annotationElementId)return;if(O(this,s,wg).call(this),!X&&(this.width===0||this.height===0)){setTimeout(()=>O(this,s,IC).call(this,!0),0);return}const K=c._internalPadding*this.parentScale;I(this,B).rect=this.getRect(K,K)},fI(c,"_freeTextDefaultContent",""),fI(c,"_internalPadding",0),fI(c,"_defaultColor",null),fI(c,"_defaultFontSize",10),fI(c,"_type","freetext");let WI=c;b.FreeTextEditor=WI},(wI,b,ZI)=>{var m,n,lg,eC,CI,bI,sI,YI,XI,aI,f,$,w,p,v,q,mI,NI,hI,E,MI,yI,KC,Hg,gC,CC,JI,vI,rI,VI,II,AI,DI,AC,xI,S,BI,HI,pC,lC;Object.defineProperty(b,"__esModule",{value:!0}),b.StampAnnotationElement=b.InkAnnotationElement=b.FreeTextAnnotationElement=b.AnnotationLayer=void 0;var G=ZI(1),R=ZI(6),cI=ZI(3),U=ZI(30),WI=ZI(31),L=ZI(32);const e=1e3,W=9,z=new WeakSet;function J(nI){return{width:nI[2]-nI[0],height:nI[3]-nI[1]}}class V{static create(H){switch(H.data.annotationType){case G.AnnotationType.LINK:return new y(H);case G.AnnotationType.TEXT:return new B(H);case G.AnnotationType.WIDGET:switch(H.data.fieldType){case"Tx":return new Y(H);case"Btn":return H.data.radioButton?new Z(H):H.data.checkBox?new h(H):new i(H);case"Ch":return new A(H);case"Sig":return new t(H)}return new s(H);case G.AnnotationType.POPUP:return new d(H);case G.AnnotationType.FREETEXT:return new F(H);case G.AnnotationType.LINE:return new l(H);case G.AnnotationType.SQUARE:return new X(H);case G.AnnotationType.CIRCLE:return new K(H);case G.AnnotationType.POLYLINE:return new lI(H);case G.AnnotationType.CARET:return new r(H);case G.AnnotationType.INK:return new T(H);case G.AnnotationType.POLYGON:return new j(H);case G.AnnotationType.HIGHLIGHT:return new dI(H);case G.AnnotationType.UNDERLINE:return new M(H);case G.AnnotationType.SQUIGGLY:return new k(H);case G.AnnotationType.STRIKEOUT:return new P(H);case G.AnnotationType.STAMP:return new N(H);case G.AnnotationType.FILEATTACHMENT:return new g(H);default:return new o(H)}}}const u=class u{constructor(H,{isRenderable:a=!1,ignoreBorder:Q=!1,createQuadrilaterals:GI=!1}={}){_(this,m,!1);this.isRenderable=a,this.data=H.data,this.layer=H.layer,this.linkService=H.linkService,this.downloadManager=H.downloadManager,this.imageResourcesPath=H.imageResourcesPath,this.renderForms=H.renderForms,this.svgFactory=H.svgFactory,this.annotationStorage=H.annotationStorage,this.enableScripting=H.enableScripting,this.hasJSActions=H.hasJSActions,this._fieldObjects=H.fieldObjects,this.parent=H.parent,a&&(this.container=this._createContainer(Q)),GI&&this._createQuadrilaterals()}static _hasPopupData({titleObj:H,contentsObj:a,richText:Q}){return!!(H!=null&&H.str||a!=null&&a.str||Q!=null&&Q.str)}get hasPopupData(){return u._hasPopupData(this.data)}_createContainer(H){const{data:a,parent:{page:Q,viewport:GI}}=this,iI=document.createElement("section");iI.setAttribute("data-annotation-id",a.id),this instanceof s||(iI.tabIndex=e),iI.style.zIndex=this.parent.zIndex++,this.data.popupRef&&iI.setAttribute("aria-haspopup","dialog"),a.noRotate&&iI.classList.add("norotate");const{pageWidth:oI,pageHeight:RI,pageX:tI,pageY:KI}=GI.rawDims;if(!a.rect||this instanceof d){const{rotation:kI}=a;return!a.hasOwnCanvas&&kI!==0&&this.setRotation(kI,iI),iI}const{width:uI,height:QI}=J(a.rect),pI=G.Util.normalizeRect([a.rect[0],Q.view[3]-a.rect[1]+Q.view[1],a.rect[2],Q.view[3]-a.rect[3]+Q.view[1]]);if(!H&&a.borderStyle.width>0){iI.style.borderWidth=`${a.borderStyle.width}px`;const kI=a.borderStyle.horizontalCornerRadius,jI=a.borderStyle.verticalCornerRadius;if(kI>0||jI>0){const PI=`calc(${kI}px * var(--scale-factor)) / calc(${jI}px * var(--scale-factor))`;iI.style.borderRadius=PI}else if(this instanceof Z){const PI=`calc(${uI}px * var(--scale-factor)) / calc(${QI}px * var(--scale-factor))`;iI.style.borderRadius=PI}switch(a.borderStyle.style){case G.AnnotationBorderStyleType.SOLID:iI.style.borderStyle="solid";break;case G.AnnotationBorderStyleType.DASHED:iI.style.borderStyle="dashed";break;case G.AnnotationBorderStyleType.BEVELED:(0,G.warn)("Unimplemented border style: beveled");break;case G.AnnotationBorderStyleType.INSET:(0,G.warn)("Unimplemented border style: inset");break;case G.AnnotationBorderStyleType.UNDERLINE:iI.style.borderBottomStyle="solid";break}const EI=a.borderColor||null;EI?(gI(this,m,!0),iI.style.borderColor=G.Util.makeHexColor(EI[0]|0,EI[1]|0,EI[2]|0)):iI.style.borderWidth=0}iI.style.left=`${100*(pI[0]-tI)/oI}%`,iI.style.top=`${100*(pI[1]-KI)/RI}%`;const{rotation:FI}=a;return a.hasOwnCanvas||FI===0?(iI.style.width=`${100*uI/oI}%`,iI.style.height=`${100*QI/RI}%`):this.setRotation(FI,iI),iI}setRotation(H,a=this.container){if(!this.data.rect)return;const{pageWidth:Q,pageHeight:GI}=this.parent.viewport.rawDims,{width:iI,height:oI}=J(this.data.rect);let RI,tI;H%180===0?(RI=100*iI/Q,tI=100*oI/GI):(RI=100*oI/Q,tI=100*iI/GI),a.style.width=`${RI}%`,a.style.height=`${tI}%`,a.setAttribute("data-main-rotation",(360-H)%360)}get _commonActions(){const H=(a,Q,GI)=>{const iI=GI.detail[a],oI=iI[0],RI=iI.slice(1);GI.target.style[Q]=U.ColorConverters[`${oI}_HTML`](RI),this.annotationStorage.setValue(this.data.id,{[Q]:U.ColorConverters[`${oI}_rgb`](RI)})};return(0,G.shadow)(this,"_commonActions",{display:a=>{const{display:Q}=a.detail,GI=Q%2===1;this.container.style.visibility=GI?"hidden":"visible",this.annotationStorage.setValue(this.data.id,{noView:GI,noPrint:Q===1||Q===2})},print:a=>{this.annotationStorage.setValue(this.data.id,{noPrint:!a.detail.print})},hidden:a=>{const{hidden:Q}=a.detail;this.container.style.visibility=Q?"hidden":"visible",this.annotationStorage.setValue(this.data.id,{noPrint:Q,noView:Q})},focus:a=>{setTimeout(()=>a.target.focus({preventScroll:!1}),0)},userName:a=>{a.target.title=a.detail.userName},readonly:a=>{a.target.disabled=a.detail.readonly},required:a=>{this._setRequired(a.target,a.detail.required)},bgColor:a=>{H("bgColor","backgroundColor",a)},fillColor:a=>{H("fillColor","backgroundColor",a)},fgColor:a=>{H("fgColor","color",a)},textColor:a=>{H("textColor","color",a)},borderColor:a=>{H("borderColor","borderColor",a)},strokeColor:a=>{H("strokeColor","borderColor",a)},rotation:a=>{const Q=a.detail.rotation;this.setRotation(Q),this.annotationStorage.setValue(this.data.id,{rotation:Q})}})}_dispatchEventFromSandbox(H,a){const Q=this._commonActions;for(const GI of Object.keys(a.detail)){const iI=H[GI]||Q[GI];iI==null||iI(a)}}_setDefaultPropertiesFromJS(H){if(!this.enableScripting)return;const a=this.annotationStorage.getRawValue(this.data.id);if(!a)return;const Q=this._commonActions;for(const[GI,iI]of Object.entries(a)){const oI=Q[GI];if(oI){const RI={detail:{[GI]:iI},target:H};oI(RI),delete a[GI]}}}_createQuadrilaterals(){if(!this.container)return;const{quadPoints:H}=this.data;if(!H)return;const[a,Q,GI,iI]=this.data.rect;if(H.length===1){const[,{x:jI,y:EI},{x:PI,y:_I}]=H[0];if(GI===jI&&iI===EI&&a===PI&&Q===_I)return}const{style:oI}=this.container;let RI;if(I(this,m)){const{borderColor:jI,borderWidth:EI}=oI;oI.borderWidth=0,RI=["url('data:image/svg+xml;utf8,",'<svg xmlns="http://www.w3.org/2000/svg"',' preserveAspectRatio="none" viewBox="0 0 1 1">',`<g fill="transparent" stroke="${jI}" stroke-width="${EI}">`],this.container.classList.add("hasBorder")}const tI=GI-a,KI=iI-Q,{svgFactory:uI}=this,QI=uI.createElement("svg");QI.classList.add("quadrilateralsContainer"),QI.setAttribute("width",0),QI.setAttribute("height",0);const pI=uI.createElement("defs");QI.append(pI);const FI=uI.createElement("clipPath"),kI=`clippath_${this.data.id}`;FI.setAttribute("id",kI),FI.setAttribute("clipPathUnits","objectBoundingBox"),pI.append(FI);for(const[,{x:jI,y:EI},{x:PI,y:_I}]of H){const qI=uI.createElement("rect"),Ig=(PI-a)/tI,Cg=(iI-EI)/KI,Ag=(jI-PI)/tI,WC=(EI-_I)/KI;qI.setAttribute("x",Ig),qI.setAttribute("y",Cg),qI.setAttribute("width",Ag),qI.setAttribute("height",WC),FI.append(qI),RI==null||RI.push(`<rect vector-effect="non-scaling-stroke" x="${Ig}" y="${Cg}" width="${Ag}" height="${WC}"/>`)}I(this,m)&&(RI.push("</g></svg>')"),oI.backgroundImage=RI.join("")),this.container.append(QI),this.container.style.clipPath=`url(#${kI})`}_createPopup(){const{container:H,data:a}=this;H.setAttribute("aria-haspopup","dialog");const Q=new d({data:{color:a.color,titleObj:a.titleObj,modificationDate:a.modificationDate,contentsObj:a.contentsObj,richText:a.richText,parentRect:a.rect,borderStyle:0,id:`popup_${a.id}`,rotation:a.rotation},parent:this.parent,elements:[this]});this.parent.div.append(Q.render())}render(){(0,G.unreachable)("Abstract method `AnnotationElement.render` called")}_getElementsByName(H,a=null){const Q=[];if(this._fieldObjects){const GI=this._fieldObjects[H];if(GI)for(const{page:iI,id:oI,exportValues:RI}of GI){if(iI===-1||oI===a)continue;const tI=typeof RI=="string"?RI:null,KI=document.querySelector(`[data-element-id="${oI}"]`);if(KI&&!z.has(KI)){(0,G.warn)(`_getElementsByName - element not allowed: ${oI}`);continue}Q.push({id:oI,exportValue:tI,domElement:KI})}return Q}for(const GI of document.getElementsByName(H)){const{exportValue:iI}=GI,oI=GI.getAttribute("data-element-id");oI!==a&&z.has(GI)&&Q.push({id:oI,exportValue:iI,domElement:GI})}return Q}show(){var H;this.container&&(this.container.hidden=!1),(H=this.popup)==null||H.maybeShow()}hide(){var H;this.container&&(this.container.hidden=!0),(H=this.popup)==null||H.forceHide()}getElementsToTriggerPopup(){return this.container}addHighlightArea(){const H=this.getElementsToTriggerPopup();if(Array.isArray(H))for(const a of H)a.classList.add("highlightArea");else H.classList.add("highlightArea")}_editOnDoubleClick(){const{annotationEditorType:H,data:{id:a}}=this;this.container.addEventListener("dblclick",()=>{var Q;(Q=this.linkService.eventBus)==null||Q.dispatch("switchannotationeditormode",{source:this,mode:H,editId:a})})}};m=new WeakMap;let o=u;class y extends o{constructor(a,Q=null){super(a,{isRenderable:!0,ignoreBorder:!!(Q!=null&&Q.ignoreBorder),createQuadrilaterals:!0});_(this,n);this.isTooltipOnly=a.data.isTooltipOnly}render(){const{data:a,linkService:Q}=this,GI=document.createElement("a");GI.setAttribute("data-element-id",a.id);let iI=!1;return a.url?(Q.addLinkAttributes(GI,a.url,a.newWindow),iI=!0):a.action?(this._bindNamedAction(GI,a.action),iI=!0):a.attachment?(this._bindAttachment(GI,a.attachment),iI=!0):a.setOCGState?(O(this,n,eC).call(this,GI,a.setOCGState),iI=!0):a.dest?(this._bindLink(GI,a.dest),iI=!0):(a.actions&&(a.actions.Action||a.actions["Mouse Up"]||a.actions["Mouse Down"])&&this.enableScripting&&this.hasJSActions&&(this._bindJSAction(GI,a),iI=!0),a.resetForm?(this._bindResetFormAction(GI,a.resetForm),iI=!0):this.isTooltipOnly&&!iI&&(this._bindLink(GI,""),iI=!0)),this.container.classList.add("linkAnnotation"),iI&&this.container.append(GI),this.container}_bindLink(a,Q){a.href=this.linkService.getDestinationHash(Q),a.onclick=()=>(Q&&this.linkService.goToDestination(Q),!1),(Q||Q==="")&&O(this,n,lg).call(this)}_bindNamedAction(a,Q){a.href=this.linkService.getAnchorUrl(""),a.onclick=()=>(this.linkService.executeNamedAction(Q),!1),O(this,n,lg).call(this)}_bindAttachment(a,Q){a.href=this.linkService.getAnchorUrl(""),a.onclick=()=>{var GI;return(GI=this.downloadManager)==null||GI.openOrDownloadData(this.container,Q.content,Q.filename),!1},O(this,n,lg).call(this)}_bindJSAction(a,Q){a.href=this.linkService.getAnchorUrl("");const GI=new Map([["Action","onclick"],["Mouse Up","onmouseup"],["Mouse Down","onmousedown"]]);for(const iI of Object.keys(Q.actions)){const oI=GI.get(iI);oI&&(a[oI]=()=>{var RI;return(RI=this.linkService.eventBus)==null||RI.dispatch("dispatcheventinsandbox",{source:this,detail:{id:Q.id,name:iI}}),!1})}a.onclick||(a.onclick=()=>!1),O(this,n,lg).call(this)}_bindResetFormAction(a,Q){const GI=a.onclick;if(GI||(a.href=this.linkService.getAnchorUrl("")),O(this,n,lg).call(this),!this._fieldObjects){(0,G.warn)('_bindResetFormAction - "resetForm" action not supported, ensure that the `fieldObjects` parameter is provided.'),GI||(a.onclick=()=>!1);return}a.onclick=()=>{var QI;GI==null||GI();const{fields:iI,refs:oI,include:RI}=Q,tI=[];if(iI.length!==0||oI.length!==0){const pI=new Set(oI);for(const FI of iI){const kI=this._fieldObjects[FI]||[];for(const{id:jI}of kI)pI.add(jI)}for(const FI of Object.values(this._fieldObjects))for(const kI of FI)pI.has(kI.id)===RI&&tI.push(kI)}else for(const pI of Object.values(this._fieldObjects))tI.push(...pI);const KI=this.annotationStorage,uI=[];for(const pI of tI){const{id:FI}=pI;switch(uI.push(FI),pI.type){case"text":{const jI=pI.defaultValue||"";KI.setValue(FI,{value:jI});break}case"checkbox":case"radiobutton":{const jI=pI.defaultValue===pI.exportValues;KI.setValue(FI,{value:jI});break}case"combobox":case"listbox":{const jI=pI.defaultValue||"";KI.setValue(FI,{value:jI});break}default:continue}const kI=document.querySelector(`[data-element-id="${FI}"]`);if(kI){if(!z.has(kI)){(0,G.warn)(`_bindResetFormAction - element not allowed: ${FI}`);continue}}else continue;kI.dispatchEvent(new Event("resetform"))}return this.enableScripting&&((QI=this.linkService.eventBus)==null||QI.dispatch("dispatcheventinsandbox",{source:this,detail:{id:"app",ids:uI,name:"ResetForm"}})),!1}}}n=new WeakSet,lg=function(){this.container.setAttribute("data-internal-link","")},eC=function(a,Q){a.href=this.linkService.getAnchorUrl(""),a.onclick=()=>(this.linkService.executeSetOCGState(Q),!1),O(this,n,lg).call(this)};class B extends o{constructor(H){super(H,{isRenderable:!0})}render(){this.container.classList.add("textAnnotation");const H=document.createElement("img");return H.src=this.imageResourcesPath+"annotation-"+this.data.name.toLowerCase()+".svg",H.alt="[{{type}} Annotation]",H.dataset.l10nId="text_annotation_type",H.dataset.l10nArgs=JSON.stringify({type:this.data.name}),!this.data.popupRef&&this.hasPopupData&&this._createPopup(),this.container.append(H),this.container}}class s extends o{render(){return this.data.alternativeText&&(this.container.title=this.data.alternativeText),this.container}showElementAndHideCanvas(H){var a;this.data.hasOwnCanvas&&(((a=H.previousSibling)==null?void 0:a.nodeName)==="CANVAS"&&(H.previousSibling.hidden=!0),H.hidden=!1)}_getKeyModifier(H){const{isWin:a,isMac:Q}=G.FeatureTest.platform;return a&&H.ctrlKey||Q&&H.metaKey}_setEventListener(H,a,Q,GI,iI){Q.includes("mouse")?H.addEventListener(Q,oI=>{var RI;(RI=this.linkService.eventBus)==null||RI.dispatch("dispatcheventinsandbox",{source:this,detail:{id:this.data.id,name:GI,value:iI(oI),shift:oI.shiftKey,modifier:this._getKeyModifier(oI)}})}):H.addEventListener(Q,oI=>{var RI;if(Q==="blur"){if(!a.focused||!oI.relatedTarget)return;a.focused=!1}else if(Q==="focus"){if(a.focused)return;a.focused=!0}iI&&((RI=this.linkService.eventBus)==null||RI.dispatch("dispatcheventinsandbox",{source:this,detail:{id:this.data.id,name:GI,value:iI(oI)}}))})}_setEventListeners(H,a,Q,GI){var iI,oI,RI;for(const[tI,KI]of Q)(KI==="Action"||(iI=this.data.actions)!=null&&iI[KI])&&((KI==="Focus"||KI==="Blur")&&(a||(a={focused:!1})),this._setEventListener(H,a,tI,KI,GI),KI==="Focus"&&!((oI=this.data.actions)!=null&&oI.Blur)?this._setEventListener(H,a,"blur","Blur",null):KI==="Blur"&&!((RI=this.data.actions)!=null&&RI.Focus)&&this._setEventListener(H,a,"focus","Focus",null))}_setBackgroundColor(H){const a=this.data.backgroundColor||null;H.style.backgroundColor=a===null?"transparent":G.Util.makeHexColor(a[0],a[1],a[2])}_setTextStyle(H){const a=["left","center","right"],{fontColor:Q}=this.data.defaultAppearanceData,GI=this.data.defaultAppearanceData.fontSize||W,iI=H.style;let oI;const RI=2,tI=KI=>Math.round(10*KI)/10;if(this.data.multiLine){const KI=Math.abs(this.data.rect[3]-this.data.rect[1]-RI),uI=Math.round(KI/(G.LINE_FACTOR*GI))||1,QI=KI/uI;oI=Math.min(GI,tI(QI/G.LINE_FACTOR))}else{const KI=Math.abs(this.data.rect[3]-this.data.rect[1]-RI);oI=Math.min(GI,tI(KI/G.LINE_FACTOR))}iI.fontSize=`calc(${oI}px * var(--scale-factor))`,iI.color=G.Util.makeHexColor(Q[0],Q[1],Q[2]),this.data.textAlignment!==null&&(iI.textAlign=a[this.data.textAlignment])}_setRequired(H,a){a?H.setAttribute("required",!0):H.removeAttribute("required"),H.setAttribute("aria-required",a)}}class Y extends s{constructor(H){const a=H.renderForms||!H.data.hasAppearance&&!!H.data.fieldValue;super(H,{isRenderable:a})}setPropertyOnSiblings(H,a,Q,GI){const iI=this.annotationStorage;for(const oI of this._getElementsByName(H.name,H.id))oI.domElement&&(oI.domElement[a]=Q),iI.setValue(oI.id,{[GI]:Q})}render(){var GI,iI;const H=this.annotationStorage,a=this.data.id;this.container.classList.add("textWidgetAnnotation");let Q=null;if(this.renderForms){const oI=H.getValue(a,{value:this.data.fieldValue});let RI=oI.value||"";const tI=H.getValue(a,{charLimit:this.data.maxLen}).charLimit;tI&&RI.length>tI&&(RI=RI.slice(0,tI));let KI=oI.formattedValue||((GI=this.data.textContent)==null?void 0:GI.join(`
`))||null;KI&&this.data.comb&&(KI=KI.replaceAll(/\s+/g,""));const uI={userValue:RI,formattedValue:KI,lastCommittedValue:null,commitKey:1,focused:!1};this.data.multiLine?(Q=document.createElement("textarea"),Q.textContent=KI??RI,this.data.doNotScroll&&(Q.style.overflowY="hidden")):(Q=document.createElement("input"),Q.type="text",Q.setAttribute("value",KI??RI),this.data.doNotScroll&&(Q.style.overflowX="hidden")),this.data.hasOwnCanvas&&(Q.hidden=!0),z.add(Q),Q.setAttribute("data-element-id",a),Q.disabled=this.data.readOnly,Q.name=this.data.fieldName,Q.tabIndex=e,this._setRequired(Q,this.data.required),tI&&(Q.maxLength=tI),Q.addEventListener("input",pI=>{H.setValue(a,{value:pI.target.value}),this.setPropertyOnSiblings(Q,"value",pI.target.value,"value"),uI.formattedValue=null}),Q.addEventListener("resetform",pI=>{const FI=this.data.defaultFieldValue??"";Q.value=uI.userValue=FI,uI.formattedValue=null});let QI=pI=>{const{formattedValue:FI}=uI;FI!=null&&(pI.target.value=FI),pI.target.scrollLeft=0};if(this.enableScripting&&this.hasJSActions){Q.addEventListener("focus",FI=>{if(uI.focused)return;const{target:kI}=FI;uI.userValue&&(kI.value=uI.userValue),uI.lastCommittedValue=kI.value,uI.commitKey=1,uI.focused=!0}),Q.addEventListener("updatefromsandbox",FI=>{this.showElementAndHideCanvas(FI.target);const kI={value(jI){uI.userValue=jI.detail.value??"",H.setValue(a,{value:uI.userValue.toString()}),jI.target.value=uI.userValue},formattedValue(jI){const{formattedValue:EI}=jI.detail;uI.formattedValue=EI,EI!=null&&jI.target!==document.activeElement&&(jI.target.value=EI),H.setValue(a,{formattedValue:EI})},selRange(jI){jI.target.setSelectionRange(...jI.detail.selRange)},charLimit:jI=>{var qI;const{charLimit:EI}=jI.detail,{target:PI}=jI;if(EI===0){PI.removeAttribute("maxLength");return}PI.setAttribute("maxLength",EI);let _I=uI.userValue;!_I||_I.length<=EI||(_I=_I.slice(0,EI),PI.value=uI.userValue=_I,H.setValue(a,{value:_I}),(qI=this.linkService.eventBus)==null||qI.dispatch("dispatcheventinsandbox",{source:this,detail:{id:a,name:"Keystroke",value:_I,willCommit:!0,commitKey:1,selStart:PI.selectionStart,selEnd:PI.selectionEnd}}))}};this._dispatchEventFromSandbox(kI,FI)}),Q.addEventListener("keydown",FI=>{var EI;uI.commitKey=1;let kI=-1;if(FI.key==="Escape"?kI=0:FI.key==="Enter"&&!this.data.multiLine?kI=2:FI.key==="Tab"&&(uI.commitKey=3),kI===-1)return;const{value:jI}=FI.target;uI.lastCommittedValue!==jI&&(uI.lastCommittedValue=jI,uI.userValue=jI,(EI=this.linkService.eventBus)==null||EI.dispatch("dispatcheventinsandbox",{source:this,detail:{id:a,name:"Keystroke",value:jI,willCommit:!0,commitKey:kI,selStart:FI.target.selectionStart,selEnd:FI.target.selectionEnd}}))});const pI=QI;QI=null,Q.addEventListener("blur",FI=>{var jI;if(!uI.focused||!FI.relatedTarget)return;uI.focused=!1;const{value:kI}=FI.target;uI.userValue=kI,uI.lastCommittedValue!==kI&&((jI=this.linkService.eventBus)==null||jI.dispatch("dispatcheventinsandbox",{source:this,detail:{id:a,name:"Keystroke",value:kI,willCommit:!0,commitKey:uI.commitKey,selStart:FI.target.selectionStart,selEnd:FI.target.selectionEnd}})),pI(FI)}),(iI=this.data.actions)!=null&&iI.Keystroke&&Q.addEventListener("beforeinput",FI=>{var Cg;uI.lastCommittedValue=null;const{data:kI,target:jI}=FI,{value:EI,selectionStart:PI,selectionEnd:_I}=jI;let qI=PI,Ig=_I;switch(FI.inputType){case"deleteWordBackward":{const Ag=EI.substring(0,PI).match(/\w*[^\w]*$/);Ag&&(qI-=Ag[0].length);break}case"deleteWordForward":{const Ag=EI.substring(PI).match(/^[^\w]*\w*/);Ag&&(Ig+=Ag[0].length);break}case"deleteContentBackward":PI===_I&&(qI-=1);break;case"deleteContentForward":PI===_I&&(Ig+=1);break}FI.preventDefault(),(Cg=this.linkService.eventBus)==null||Cg.dispatch("dispatcheventinsandbox",{source:this,detail:{id:a,name:"Keystroke",value:EI,change:kI||"",willCommit:!1,selStart:qI,selEnd:Ig}})}),this._setEventListeners(Q,uI,[["focus","Focus"],["blur","Blur"],["mousedown","Mouse Down"],["mouseenter","Mouse Enter"],["mouseleave","Mouse Exit"],["mouseup","Mouse Up"]],FI=>FI.target.value)}if(QI&&Q.addEventListener("blur",QI),this.data.comb){const FI=(this.data.rect[2]-this.data.rect[0])/tI;Q.classList.add("comb"),Q.style.letterSpacing=`calc(${FI}px * var(--scale-factor) - 1ch)`}}else Q=document.createElement("div"),Q.textContent=this.data.fieldValue,Q.style.verticalAlign="middle",Q.style.display="table-cell";return this._setTextStyle(Q),this._setBackgroundColor(Q),this._setDefaultPropertiesFromJS(Q),this.container.append(Q),this.container}}class t extends s{constructor(H){super(H,{isRenderable:!!H.data.hasOwnCanvas})}}class h extends s{constructor(H){super(H,{isRenderable:H.renderForms})}render(){const H=this.annotationStorage,a=this.data,Q=a.id;let GI=H.getValue(Q,{value:a.exportValue===a.fieldValue}).value;typeof GI=="string"&&(GI=GI!=="Off",H.setValue(Q,{value:GI})),this.container.classList.add("buttonWidgetAnnotation","checkBox");const iI=document.createElement("input");return z.add(iI),iI.setAttribute("data-element-id",Q),iI.disabled=a.readOnly,this._setRequired(iI,this.data.required),iI.type="checkbox",iI.name=a.fieldName,GI&&iI.setAttribute("checked",!0),iI.setAttribute("exportValue",a.exportValue),iI.tabIndex=e,iI.addEventListener("change",oI=>{const{name:RI,checked:tI}=oI.target;for(const KI of this._getElementsByName(RI,Q)){const uI=tI&&KI.exportValue===a.exportValue;KI.domElement&&(KI.domElement.checked=uI),H.setValue(KI.id,{value:uI})}H.setValue(Q,{value:tI})}),iI.addEventListener("resetform",oI=>{const RI=a.defaultFieldValue||"Off";oI.target.checked=RI===a.exportValue}),this.enableScripting&&this.hasJSActions&&(iI.addEventListener("updatefromsandbox",oI=>{const RI={value(tI){tI.target.checked=tI.detail.value!=="Off",H.setValue(Q,{value:tI.target.checked})}};this._dispatchEventFromSandbox(RI,oI)}),this._setEventListeners(iI,null,[["change","Validate"],["change","Action"],["focus","Focus"],["blur","Blur"],["mousedown","Mouse Down"],["mouseenter","Mouse Enter"],["mouseleave","Mouse Exit"],["mouseup","Mouse Up"]],oI=>oI.target.checked)),this._setBackgroundColor(iI),this._setDefaultPropertiesFromJS(iI),this.container.append(iI),this.container}}class Z extends s{constructor(H){super(H,{isRenderable:H.renderForms})}render(){this.container.classList.add("buttonWidgetAnnotation","radioButton");const H=this.annotationStorage,a=this.data,Q=a.id;let GI=H.getValue(Q,{value:a.fieldValue===a.buttonValue}).value;typeof GI=="string"&&(GI=GI!==a.buttonValue,H.setValue(Q,{value:GI}));const iI=document.createElement("input");if(z.add(iI),iI.setAttribute("data-element-id",Q),iI.disabled=a.readOnly,this._setRequired(iI,this.data.required),iI.type="radio",iI.name=a.fieldName,GI&&iI.setAttribute("checked",!0),iI.tabIndex=e,iI.addEventListener("change",oI=>{const{name:RI,checked:tI}=oI.target;for(const KI of this._getElementsByName(RI,Q))H.setValue(KI.id,{value:!1});H.setValue(Q,{value:tI})}),iI.addEventListener("resetform",oI=>{const RI=a.defaultFieldValue;oI.target.checked=RI!=null&&RI===a.buttonValue}),this.enableScripting&&this.hasJSActions){const oI=a.buttonValue;iI.addEventListener("updatefromsandbox",RI=>{const tI={value:KI=>{const uI=oI===KI.detail.value;for(const QI of this._getElementsByName(KI.target.name)){const pI=uI&&QI.id===Q;QI.domElement&&(QI.domElement.checked=pI),H.setValue(QI.id,{value:pI})}}};this._dispatchEventFromSandbox(tI,RI)}),this._setEventListeners(iI,null,[["change","Validate"],["change","Action"],["focus","Focus"],["blur","Blur"],["mousedown","Mouse Down"],["mouseenter","Mouse Enter"],["mouseleave","Mouse Exit"],["mouseup","Mouse Up"]],RI=>RI.target.checked)}return this._setBackgroundColor(iI),this._setDefaultPropertiesFromJS(iI),this.container.append(iI),this.container}}class i extends y{constructor(H){super(H,{ignoreBorder:H.data.hasAppearance})}render(){const H=super.render();H.classList.add("buttonWidgetAnnotation","pushButton"),this.data.alternativeText&&(H.title=this.data.alternativeText);const a=H.lastChild;return this.enableScripting&&this.hasJSActions&&a&&(this._setDefaultPropertiesFromJS(a),a.addEventListener("updatefromsandbox",Q=>{this._dispatchEventFromSandbox({},Q)})),H}}class A extends s{constructor(H){super(H,{isRenderable:H.renderForms})}render(){this.container.classList.add("choiceWidgetAnnotation");const H=this.annotationStorage,a=this.data.id,Q=H.getValue(a,{value:this.data.fieldValue}),GI=document.createElement("select");z.add(GI),GI.setAttribute("data-element-id",a),GI.disabled=this.data.readOnly,this._setRequired(GI,this.data.required),GI.name=this.data.fieldName,GI.tabIndex=e;let iI=this.data.combo&&this.data.options.length>0;this.data.combo||(GI.size=this.data.options.length,this.data.multiSelect&&(GI.multiple=!0)),GI.addEventListener("resetform",uI=>{const QI=this.data.defaultFieldValue;for(const pI of GI.options)pI.selected=pI.value===QI});for(const uI of this.data.options){const QI=document.createElement("option");QI.textContent=uI.displayValue,QI.value=uI.exportValue,Q.value.includes(uI.exportValue)&&(QI.setAttribute("selected",!0),iI=!1),GI.append(QI)}let oI=null;if(iI){const uI=document.createElement("option");uI.value=" ",uI.setAttribute("hidden",!0),uI.setAttribute("selected",!0),GI.prepend(uI),oI=()=>{uI.remove(),GI.removeEventListener("input",oI),oI=null},GI.addEventListener("input",oI)}const RI=uI=>{const QI=uI?"value":"textContent",{options:pI,multiple:FI}=GI;return FI?Array.prototype.filter.call(pI,kI=>kI.selected).map(kI=>kI[QI]):pI.selectedIndex===-1?null:pI[pI.selectedIndex][QI]};let tI=RI(!1);const KI=uI=>{const QI=uI.target.options;return Array.prototype.map.call(QI,pI=>({displayValue:pI.textContent,exportValue:pI.value}))};return this.enableScripting&&this.hasJSActions?(GI.addEventListener("updatefromsandbox",uI=>{const QI={value(pI){oI==null||oI();const FI=pI.detail.value,kI=new Set(Array.isArray(FI)?FI:[FI]);for(const jI of GI.options)jI.selected=kI.has(jI.value);H.setValue(a,{value:RI(!0)}),tI=RI(!1)},multipleSelection(pI){GI.multiple=!0},remove(pI){const FI=GI.options,kI=pI.detail.remove;FI[kI].selected=!1,GI.remove(kI),FI.length>0&&Array.prototype.findIndex.call(FI,EI=>EI.selected)===-1&&(FI[0].selected=!0),H.setValue(a,{value:RI(!0),items:KI(pI)}),tI=RI(!1)},clear(pI){for(;GI.length!==0;)GI.remove(0);H.setValue(a,{value:null,items:[]}),tI=RI(!1)},insert(pI){const{index:FI,displayValue:kI,exportValue:jI}=pI.detail.insert,EI=GI.children[FI],PI=document.createElement("option");PI.textContent=kI,PI.value=jI,EI?EI.before(PI):GI.append(PI),H.setValue(a,{value:RI(!0),items:KI(pI)}),tI=RI(!1)},items(pI){const{items:FI}=pI.detail;for(;GI.length!==0;)GI.remove(0);for(const kI of FI){const{displayValue:jI,exportValue:EI}=kI,PI=document.createElement("option");PI.textContent=jI,PI.value=EI,GI.append(PI)}GI.options.length>0&&(GI.options[0].selected=!0),H.setValue(a,{value:RI(!0),items:KI(pI)}),tI=RI(!1)},indices(pI){const FI=new Set(pI.detail.indices);for(const kI of pI.target.options)kI.selected=FI.has(kI.index);H.setValue(a,{value:RI(!0)}),tI=RI(!1)},editable(pI){pI.target.disabled=!pI.detail.editable}};this._dispatchEventFromSandbox(QI,uI)}),GI.addEventListener("input",uI=>{var pI;const QI=RI(!0);H.setValue(a,{value:QI}),uI.preventDefault(),(pI=this.linkService.eventBus)==null||pI.dispatch("dispatcheventinsandbox",{source:this,detail:{id:a,name:"Keystroke",value:tI,changeEx:QI,willCommit:!1,commitKey:1,keyDown:!1}})}),this._setEventListeners(GI,null,[["focus","Focus"],["blur","Blur"],["mousedown","Mouse Down"],["mouseenter","Mouse Enter"],["mouseleave","Mouse Exit"],["mouseup","Mouse Up"],["input","Action"],["input","Validate"]],uI=>uI.target.value)):GI.addEventListener("input",function(uI){H.setValue(a,{value:RI(!0)})}),this.data.combo&&this._setTextStyle(GI),this._setBackgroundColor(GI),this._setDefaultPropertiesFromJS(GI),this.container.append(GI),this.container}}class d extends o{constructor(H){const{data:a,elements:Q}=H;super(H,{isRenderable:o._hasPopupData(a)}),this.elements=Q}render(){this.container.classList.add("popupAnnotation");const H=new c({container:this.container,color:this.data.color,titleObj:this.data.titleObj,modificationDate:this.data.modificationDate,contentsObj:this.data.contentsObj,richText:this.data.richText,rect:this.data.rect,parentRect:this.data.parentRect||null,parent:this.parent,elements:this.elements,open:this.data.open}),a=[];for(const Q of this.elements)Q.popup=H,a.push(Q.data.id),Q.addHighlightArea();return this.container.setAttribute("aria-controls",a.map(Q=>`${G.AnnotationPrefix}${Q}`).join(",")),this.container}}class c{constructor({container:H,color:a,elements:Q,titleObj:GI,modificationDate:iI,contentsObj:oI,richText:RI,parent:tI,rect:KI,parentRect:uI,open:QI}){_(this,yI);_(this,CI,null);_(this,bI,O(this,yI,KC).bind(this));_(this,sI,O(this,yI,CC).bind(this));_(this,YI,O(this,yI,gC).bind(this));_(this,XI,O(this,yI,Hg).bind(this));_(this,aI,null);_(this,f,null);_(this,$,null);_(this,w,null);_(this,p,null);_(this,v,null);_(this,q,!1);_(this,mI,null);_(this,NI,null);_(this,hI,null);_(this,E,null);_(this,MI,!1);var FI;gI(this,f,H),gI(this,E,GI),gI(this,$,oI),gI(this,hI,RI),gI(this,p,tI),gI(this,aI,a),gI(this,NI,KI),gI(this,v,uI),gI(this,w,Q);const pI=R.PDFDateString.toDateObject(iI);pI&&gI(this,CI,tI.l10n.get("annotation_date_string",{date:pI.toLocaleDateString(),time:pI.toLocaleTimeString()})),this.trigger=Q.flatMap(kI=>kI.getElementsToTriggerPopup());for(const kI of this.trigger)kI.addEventListener("click",I(this,XI)),kI.addEventListener("mouseenter",I(this,YI)),kI.addEventListener("mouseleave",I(this,sI)),kI.classList.add("popupTriggerArea");for(const kI of Q)(FI=kI.container)==null||FI.addEventListener("keydown",I(this,bI));I(this,f).hidden=!0,QI&&O(this,yI,Hg).call(this)}render(){if(I(this,mI))return;const{page:{view:H},viewport:{rawDims:{pageWidth:a,pageHeight:Q,pageX:GI,pageY:iI}}}=I(this,p),oI=gI(this,mI,document.createElement("div"));if(oI.className="popup",I(this,aI)){const qI=oI.style.outlineColor=G.Util.makeHexColor(...I(this,aI));CSS.supports("background-color","color-mix(in srgb, red 30%, white)")?oI.style.backgroundColor=`color-mix(in srgb, ${qI} 30%, white)`:oI.style.backgroundColor=G.Util.makeHexColor(...I(this,aI).map(Cg=>Math.floor(.7*(255-Cg)+Cg)))}const RI=document.createElement("span");RI.className="header";const tI=document.createElement("h1");if(RI.append(tI),{dir:tI.dir,str:tI.textContent}=I(this,E),oI.append(RI),I(this,CI)){const qI=document.createElement("span");qI.classList.add("popupDate"),I(this,CI).then(Ig=>{qI.textContent=Ig}),RI.append(qI)}const KI=I(this,$),uI=I(this,hI);if(uI!=null&&uI.str&&(!(KI!=null&&KI.str)||KI.str===uI.str))L.XfaLayer.render({xfaHtml:uI.html,intent:"richText",div:oI}),oI.lastChild.classList.add("richText","popupContent");else{const qI=this._formatContents(KI);oI.append(qI)}let QI=!!I(this,v),pI=QI?I(this,v):I(this,NI);for(const qI of I(this,w))if(!pI||G.Util.intersect(qI.data.rect,pI)!==null){pI=qI.data.rect,QI=!0;break}const FI=G.Util.normalizeRect([pI[0],H[3]-pI[1]+H[1],pI[2],H[3]-pI[3]+H[1]]),jI=QI?pI[2]-pI[0]+5:0,EI=FI[0]+jI,PI=FI[1],{style:_I}=I(this,f);_I.left=`${100*(EI-GI)/a}%`,_I.top=`${100*(PI-iI)/Q}%`,I(this,f).append(oI)}_formatContents({str:H,dir:a}){const Q=document.createElement("p");Q.classList.add("popupContent"),Q.dir=a;const GI=H.split(/(?:\r\n?|\n)/);for(let iI=0,oI=GI.length;iI<oI;++iI){const RI=GI[iI];Q.append(document.createTextNode(RI)),iI<oI-1&&Q.append(document.createElement("br"))}return Q}forceHide(){gI(this,MI,this.isVisible),I(this,MI)&&(I(this,f).hidden=!0)}maybeShow(){I(this,MI)&&(gI(this,MI,!1),I(this,f).hidden=!1)}get isVisible(){return I(this,f).hidden===!1}}CI=new WeakMap,bI=new WeakMap,sI=new WeakMap,YI=new WeakMap,XI=new WeakMap,aI=new WeakMap,f=new WeakMap,$=new WeakMap,w=new WeakMap,p=new WeakMap,v=new WeakMap,q=new WeakMap,mI=new WeakMap,NI=new WeakMap,hI=new WeakMap,E=new WeakMap,MI=new WeakMap,yI=new WeakSet,KC=function(H){H.altKey||H.shiftKey||H.ctrlKey||H.metaKey||(H.key==="Enter"||H.key==="Escape"&&I(this,q))&&O(this,yI,Hg).call(this)},Hg=function(){gI(this,q,!I(this,q)),I(this,q)?(O(this,yI,gC).call(this),I(this,f).addEventListener("click",I(this,XI)),I(this,f).addEventListener("keydown",I(this,bI))):(O(this,yI,CC).call(this),I(this,f).removeEventListener("click",I(this,XI)),I(this,f).removeEventListener("keydown",I(this,bI)))},gC=function(){I(this,mI)||this.render(),this.isVisible?I(this,q)&&I(this,f).classList.add("focused"):(I(this,f).hidden=!1,I(this,f).style.zIndex=parseInt(I(this,f).style.zIndex)+1e3)},CC=function(){I(this,f).classList.remove("focused"),!(I(this,q)||!this.isVisible)&&(I(this,f).hidden=!0,I(this,f).style.zIndex=parseInt(I(this,f).style.zIndex)-1e3)};class F extends o{constructor(H){super(H,{isRenderable:!0,ignoreBorder:!0}),this.textContent=H.data.textContent,this.textPosition=H.data.textPosition,this.annotationEditorType=G.AnnotationEditorType.FREETEXT}render(){if(this.container.classList.add("freeTextAnnotation"),this.textContent){const H=document.createElement("div");H.classList.add("annotationTextContent"),H.setAttribute("role","comment");for(const a of this.textContent){const Q=document.createElement("span");Q.textContent=a,H.append(Q)}this.container.append(H)}return!this.data.popupRef&&this.hasPopupData&&this._createPopup(),this._editOnDoubleClick(),this.container}}b.FreeTextAnnotationElement=F;class l extends o{constructor(a){super(a,{isRenderable:!0,ignoreBorder:!0});_(this,JI,null)}render(){this.container.classList.add("lineAnnotation");const a=this.data,{width:Q,height:GI}=J(a.rect),iI=this.svgFactory.create(Q,GI,!0),oI=gI(this,JI,this.svgFactory.createElement("svg:line"));return oI.setAttribute("x1",a.rect[2]-a.lineCoordinates[0]),oI.setAttribute("y1",a.rect[3]-a.lineCoordinates[1]),oI.setAttribute("x2",a.rect[2]-a.lineCoordinates[2]),oI.setAttribute("y2",a.rect[3]-a.lineCoordinates[3]),oI.setAttribute("stroke-width",a.borderStyle.width||1),oI.setAttribute("stroke","transparent"),oI.setAttribute("fill","transparent"),iI.append(oI),this.container.append(iI),!a.popupRef&&this.hasPopupData&&this._createPopup(),this.container}getElementsToTriggerPopup(){return I(this,JI)}addHighlightArea(){this.container.classList.add("highlightArea")}}JI=new WeakMap;class X extends o{constructor(a){super(a,{isRenderable:!0,ignoreBorder:!0});_(this,vI,null)}render(){this.container.classList.add("squareAnnotation");const a=this.data,{width:Q,height:GI}=J(a.rect),iI=this.svgFactory.create(Q,GI,!0),oI=a.borderStyle.width,RI=gI(this,vI,this.svgFactory.createElement("svg:rect"));return RI.setAttribute("x",oI/2),RI.setAttribute("y",oI/2),RI.setAttribute("width",Q-oI),RI.setAttribute("height",GI-oI),RI.setAttribute("stroke-width",oI||1),RI.setAttribute("stroke","transparent"),RI.setAttribute("fill","transparent"),iI.append(RI),this.container.append(iI),!a.popupRef&&this.hasPopupData&&this._createPopup(),this.container}getElementsToTriggerPopup(){return I(this,vI)}addHighlightArea(){this.container.classList.add("highlightArea")}}vI=new WeakMap;class K extends o{constructor(a){super(a,{isRenderable:!0,ignoreBorder:!0});_(this,rI,null)}render(){this.container.classList.add("circleAnnotation");const a=this.data,{width:Q,height:GI}=J(a.rect),iI=this.svgFactory.create(Q,GI,!0),oI=a.borderStyle.width,RI=gI(this,rI,this.svgFactory.createElement("svg:ellipse"));return RI.setAttribute("cx",Q/2),RI.setAttribute("cy",GI/2),RI.setAttribute("rx",Q/2-oI/2),RI.setAttribute("ry",GI/2-oI/2),RI.setAttribute("stroke-width",oI||1),RI.setAttribute("stroke","transparent"),RI.setAttribute("fill","transparent"),iI.append(RI),this.container.append(iI),!a.popupRef&&this.hasPopupData&&this._createPopup(),this.container}getElementsToTriggerPopup(){return I(this,rI)}addHighlightArea(){this.container.classList.add("highlightArea")}}rI=new WeakMap;class lI extends o{constructor(a){super(a,{isRenderable:!0,ignoreBorder:!0});_(this,VI,null);this.containerClassName="polylineAnnotation",this.svgElementName="svg:polyline"}render(){this.container.classList.add(this.containerClassName);const a=this.data,{width:Q,height:GI}=J(a.rect),iI=this.svgFactory.create(Q,GI,!0);let oI=[];for(const tI of a.vertices){const KI=tI.x-a.rect[0],uI=a.rect[3]-tI.y;oI.push(KI+","+uI)}oI=oI.join(" ");const RI=gI(this,VI,this.svgFactory.createElement(this.svgElementName));return RI.setAttribute("points",oI),RI.setAttribute("stroke-width",a.borderStyle.width||1),RI.setAttribute("stroke","transparent"),RI.setAttribute("fill","transparent"),iI.append(RI),this.container.append(iI),!a.popupRef&&this.hasPopupData&&this._createPopup(),this.container}getElementsToTriggerPopup(){return I(this,VI)}addHighlightArea(){this.container.classList.add("highlightArea")}}VI=new WeakMap;class j extends lI{constructor(H){super(H),this.containerClassName="polygonAnnotation",this.svgElementName="svg:polygon"}}class r extends o{constructor(H){super(H,{isRenderable:!0,ignoreBorder:!0})}render(){return this.container.classList.add("caretAnnotation"),!this.data.popupRef&&this.hasPopupData&&this._createPopup(),this.container}}class T extends o{constructor(a){super(a,{isRenderable:!0,ignoreBorder:!0});_(this,II,[]);this.containerClassName="inkAnnotation",this.svgElementName="svg:polyline",this.annotationEditorType=G.AnnotationEditorType.INK}render(){this.container.classList.add(this.containerClassName);const a=this.data,{width:Q,height:GI}=J(a.rect),iI=this.svgFactory.create(Q,GI,!0);for(const oI of a.inkLists){let RI=[];for(const KI of oI){const uI=KI.x-a.rect[0],QI=a.rect[3]-KI.y;RI.push(`${uI},${QI}`)}RI=RI.join(" ");const tI=this.svgFactory.createElement(this.svgElementName);I(this,II).push(tI),tI.setAttribute("points",RI),tI.setAttribute("stroke-width",a.borderStyle.width||1),tI.setAttribute("stroke","transparent"),tI.setAttribute("fill","transparent"),!a.popupRef&&this.hasPopupData&&this._createPopup(),iI.append(tI)}return this.container.append(iI),this.container}getElementsToTriggerPopup(){return I(this,II)}addHighlightArea(){this.container.classList.add("highlightArea")}}II=new WeakMap,b.InkAnnotationElement=T;class dI extends o{constructor(H){super(H,{isRenderable:!0,ignoreBorder:!0,createQuadrilaterals:!0})}render(){return!this.data.popupRef&&this.hasPopupData&&this._createPopup(),this.container.classList.add("highlightAnnotation"),this.container}}class M extends o{constructor(H){super(H,{isRenderable:!0,ignoreBorder:!0,createQuadrilaterals:!0})}render(){return!this.data.popupRef&&this.hasPopupData&&this._createPopup(),this.container.classList.add("underlineAnnotation"),this.container}}class k extends o{constructor(H){super(H,{isRenderable:!0,ignoreBorder:!0,createQuadrilaterals:!0})}render(){return!this.data.popupRef&&this.hasPopupData&&this._createPopup(),this.container.classList.add("squigglyAnnotation"),this.container}}class P extends o{constructor(H){super(H,{isRenderable:!0,ignoreBorder:!0,createQuadrilaterals:!0})}render(){return!this.data.popupRef&&this.hasPopupData&&this._createPopup(),this.container.classList.add("strikeoutAnnotation"),this.container}}class N extends o{constructor(H){super(H,{isRenderable:!0,ignoreBorder:!0})}render(){return this.container.classList.add("stampAnnotation"),!this.data.popupRef&&this.hasPopupData&&this._createPopup(),this.container}}b.StampAnnotationElement=N;class g extends o{constructor(a){var iI;super(a,{isRenderable:!0});_(this,DI);_(this,AI,null);const{filename:Q,content:GI}=this.data.file;this.filename=(0,R.getFilenameFromUrl)(Q,!0),this.content=GI,(iI=this.linkService.eventBus)==null||iI.dispatch("fileattachmentannotation",{source:this,filename:Q,content:GI})}render(){this.container.classList.add("fileAttachmentAnnotation");const{container:a,data:Q}=this;let GI;Q.hasAppearance||Q.fillAlpha===0?GI=document.createElement("div"):(GI=document.createElement("img"),GI.src=`${this.imageResourcesPath}annotation-${/paperclip/i.test(Q.name)?"paperclip":"pushpin"}.svg`,Q.fillAlpha&&Q.fillAlpha<1&&(GI.style=`filter: opacity(${Math.round(Q.fillAlpha*100)}%);`)),GI.addEventListener("dblclick",O(this,DI,AC).bind(this)),gI(this,AI,GI);const{isMac:iI}=G.FeatureTest.platform;return a.addEventListener("keydown",oI=>{oI.key==="Enter"&&(iI?oI.metaKey:oI.ctrlKey)&&O(this,DI,AC).call(this)}),!Q.popupRef&&this.hasPopupData?this._createPopup():GI.classList.add("popupTriggerArea"),a.append(GI),a}getElementsToTriggerPopup(){return I(this,AI)}addHighlightArea(){this.container.classList.add("highlightArea")}}AI=new WeakMap,DI=new WeakSet,AC=function(){var a;(a=this.downloadManager)==null||a.openOrDownloadData(this.container,this.content,this.filename)};class C{constructor({div:H,accessibilityManager:a,annotationCanvasMap:Q,l10n:GI,page:iI,viewport:oI}){_(this,HI);_(this,xI,null);_(this,S,null);_(this,BI,new Map);this.div=H,gI(this,xI,a),gI(this,S,Q),this.l10n=GI,this.page=iI,this.viewport=oI,this.zIndex=0,this.l10n||(this.l10n=WI.NullL10n)}async render(H){const{annotations:a}=H,Q=this.div;(0,R.setLayerDimensions)(Q,this.viewport);const GI=new Map,iI={data:null,layer:Q,linkService:H.linkService,downloadManager:H.downloadManager,imageResourcesPath:H.imageResourcesPath||"",renderForms:H.renderForms!==!1,svgFactory:new R.DOMSVGFactory,annotationStorage:H.annotationStorage||new cI.AnnotationStorage,enableScripting:H.enableScripting===!0,hasJSActions:H.hasJSActions,fieldObjects:H.fieldObjects,parent:this,elements:null};for(const oI of a){if(oI.noHTML)continue;const RI=oI.annotationType===G.AnnotationType.POPUP;if(RI){const uI=GI.get(oI.id);if(!uI)continue;iI.elements=uI}else{const{width:uI,height:QI}=J(oI.rect);if(uI<=0||QI<=0)continue}iI.data=oI;const tI=V.create(iI);if(!tI.isRenderable)continue;if(!RI&&oI.popupRef){const uI=GI.get(oI.popupRef);uI?uI.push(tI):GI.set(oI.popupRef,[tI])}tI.annotationEditorType>0&&I(this,BI).set(tI.data.id,tI);const KI=tI.render();oI.hidden&&(KI.style.visibility="hidden"),O(this,HI,pC).call(this,KI,oI.id)}O(this,HI,lC).call(this),await this.l10n.translate(Q)}update({viewport:H}){const a=this.div;this.viewport=H,(0,R.setLayerDimensions)(a,{rotation:H.rotation}),O(this,HI,lC).call(this),a.hidden=!1}getEditableAnnotations(){return Array.from(I(this,BI).values())}getEditableAnnotation(H){return I(this,BI).get(H)}}xI=new WeakMap,S=new WeakMap,BI=new WeakMap,HI=new WeakSet,pC=function(H,a){var GI;const Q=H.firstChild||H;Q.id=`${G.AnnotationPrefix}${a}`,this.div.append(H),(GI=I(this,xI))==null||GI.moveElementInDOM(this.div,H,Q,!1)},lC=function(){if(!I(this,S))return;const H=this.div;for(const[a,Q]of I(this,S)){const GI=H.querySelector(`[data-annotation-id="${a}"]`);if(!GI)continue;const{firstChild:iI}=GI;iI?iI.nodeName==="CANVAS"?iI.replaceWith(Q):iI.before(Q):GI.append(Q)}I(this,S).clear()},b.AnnotationLayer=C},(wI,b)=>{Object.defineProperty(b,"__esModule",{value:!0}),b.ColorConverters=void 0;function ZI(cI){return Math.floor(Math.max(0,Math.min(1,cI))*255).toString(16).padStart(2,"0")}function G(cI){return Math.max(0,Math.min(255,255*cI))}class R{static CMYK_G([U,WI,L,e]){return["G",1-Math.min(1,.3*U+.59*L+.11*WI+e)]}static G_CMYK([U]){return["CMYK",0,0,0,1-U]}static G_RGB([U]){return["RGB",U,U,U]}static G_rgb([U]){return U=G(U),[U,U,U]}static G_HTML([U]){const WI=ZI(U);return`#${WI}${WI}${WI}`}static RGB_G([U,WI,L]){return["G",.3*U+.59*WI+.11*L]}static RGB_rgb(U){return U.map(G)}static RGB_HTML(U){return`#${U.map(ZI).join("")}`}static T_HTML(){return"#00000000"}static T_rgb(){return[null]}static CMYK_RGB([U,WI,L,e]){return["RGB",1-Math.min(1,U+e),1-Math.min(1,L+e),1-Math.min(1,WI+e)]}static CMYK_rgb([U,WI,L,e]){return[G(1-Math.min(1,U+e)),G(1-Math.min(1,L+e)),G(1-Math.min(1,WI+e))]}static CMYK_HTML(U){const WI=this.CMYK_RGB(U).slice(1);return this.RGB_HTML(WI)}static RGB_CMYK([U,WI,L]){const e=1-U,W=1-WI,z=1-L,J=Math.min(e,W,z);return["CMYK",e,W,z,J]}}b.ColorConverters=R},(wI,b)=>{Object.defineProperty(b,"__esModule",{value:!0}),b.NullL10n=void 0,b.getL10nFallback=G;const ZI={of_pages:"of {{pagesCount}}",page_of_pages:"({{pageNumber}} of {{pagesCount}})",document_properties_kb:"{{size_kb}} KB ({{size_b}} bytes)",document_properties_mb:"{{size_mb}} MB ({{size_b}} bytes)",document_properties_date_string:"{{date}}, {{time}}",document_properties_page_size_unit_inches:"in",document_properties_page_size_unit_millimeters:"mm",document_properties_page_size_orientation_portrait:"portrait",document_properties_page_size_orientation_landscape:"landscape",document_properties_page_size_name_a3:"A3",document_properties_page_size_name_a4:"A4",document_properties_page_size_name_letter:"Letter",document_properties_page_size_name_legal:"Legal",document_properties_page_size_dimension_string:"{{width}} × {{height}} {{unit}} ({{orientation}})",document_properties_page_size_dimension_name_string:"{{width}} × {{height}} {{unit}} ({{name}}, {{orientation}})",document_properties_linearized_yes:"Yes",document_properties_linearized_no:"No",additional_layers:"Additional Layers",page_landmark:"Page {{page}}",thumb_page_title:"Page {{page}}",thumb_page_canvas:"Thumbnail of Page {{page}}",find_reached_top:"Reached top of document, continued from bottom",find_reached_bottom:"Reached end of document, continued from top","find_match_count[one]":"{{current}} of {{total}} match","find_match_count[other]":"{{current}} of {{total}} matches","find_match_count_limit[one]":"More than {{limit}} match","find_match_count_limit[other]":"More than {{limit}} matches",find_not_found:"Phrase not found",page_scale_width:"Page Width",page_scale_fit:"Page Fit",page_scale_auto:"Automatic Zoom",page_scale_actual:"Actual Size",page_scale_percent:"{{scale}}%",loading_error:"An error occurred while loading the PDF.",invalid_file_error:"Invalid or corrupted PDF file.",missing_file_error:"Missing PDF file.",unexpected_response_error:"Unexpected server response.",rendering_error:"An error occurred while rendering the page.",annotation_date_string:"{{date}}, {{time}}",printing_not_supported:"Warning: Printing is not fully supported by this browser.",printing_not_ready:"Warning: The PDF is not fully loaded for printing.",web_fonts_disabled:"Web fonts are disabled: unable to use embedded PDF fonts.",free_text2_default_content:"Start typing…",editor_free_text2_aria_label:"Text Editor",editor_ink2_aria_label:"Draw Editor",editor_ink_canvas_aria_label:"User-created image",editor_alt_text_button_label:"Alt text",editor_alt_text_edit_button_label:"Edit alt text",editor_alt_text_decorative_tooltip:"Marked as decorative"};ZI.print_progress_percent="{{progress}}%";function G(U,WI){switch(U){case"find_match_count":U=`find_match_count[${WI.total===1?"one":"other"}]`;break;case"find_match_count_limit":U=`find_match_count_limit[${WI.limit===1?"one":"other"}]`;break}return ZI[U]||""}function R(U,WI){return WI?U.replaceAll(/\{\{\s*(\w+)\s*\}\}/g,(L,e)=>e in WI?WI[e]:"{{"+e+"}}"):U}const cI={async getLanguage(){return"en-us"},async getDirection(){return"ltr"},async get(U,WI=null,L=G(U,WI)){return R(L,WI)},async translate(U){}};b.NullL10n=cI},(wI,b,ZI)=>{Object.defineProperty(b,"__esModule",{value:!0}),b.XfaLayer=void 0;var G=ZI(25);class R{static setupStorage(U,WI,L,e,W){const z=e.getValue(WI,{value:null});switch(L.name){case"textarea":if(z.value!==null&&(U.textContent=z.value),W==="print")break;U.addEventListener("input",J=>{e.setValue(WI,{value:J.target.value})});break;case"input":if(L.attributes.type==="radio"||L.attributes.type==="checkbox"){if(z.value===L.attributes.xfaOn?U.setAttribute("checked",!0):z.value===L.attributes.xfaOff&&U.removeAttribute("checked"),W==="print")break;U.addEventListener("change",J=>{e.setValue(WI,{value:J.target.checked?J.target.getAttribute("xfaOn"):J.target.getAttribute("xfaOff")})})}else{if(z.value!==null&&U.setAttribute("value",z.value),W==="print")break;U.addEventListener("input",J=>{e.setValue(WI,{value:J.target.value})})}break;case"select":if(z.value!==null){U.setAttribute("value",z.value);for(const J of L.children)J.attributes.value===z.value?J.attributes.selected=!0:J.attributes.hasOwnProperty("selected")&&delete J.attributes.selected}U.addEventListener("input",J=>{const V=J.target.options,o=V.selectedIndex===-1?"":V[V.selectedIndex].value;e.setValue(WI,{value:o})});break}}static setAttributes({html:U,element:WI,storage:L=null,intent:e,linkService:W}){const{attributes:z}=WI,J=U instanceof HTMLAnchorElement;z.type==="radio"&&(z.name=`${z.name}-${e}`);for(const[V,o]of Object.entries(z))if(o!=null)switch(V){case"class":o.length&&U.setAttribute(V,o.join(" "));break;case"dataId":break;case"id":U.setAttribute("data-element-id",o);break;case"style":Object.assign(U.style,o);break;case"textContent":U.textContent=o;break;default:(!J||V!=="href"&&V!=="newWindow")&&U.setAttribute(V,o)}J&&W.addLinkAttributes(U,z.href,z.newWindow),L&&z.dataId&&this.setupStorage(U,z.dataId,WI,L)}static render(U){var y;const WI=U.annotationStorage,L=U.linkService,e=U.xfaHtml,W=U.intent||"display",z=document.createElement(e.name);e.attributes&&this.setAttributes({html:z,element:e,intent:W,linkService:L});const J=[[e,-1,z]],V=U.div;if(V.append(z),U.viewport){const B=`matrix(${U.viewport.transform.join(",")})`;V.style.transform=B}W!=="richText"&&V.setAttribute("class","xfaLayer xfaFont");const o=[];for(;J.length>0;){const[B,s,Y]=J.at(-1);if(s+1===B.children.length){J.pop();continue}const t=B.children[++J.at(-1)[1]];if(t===null)continue;const{name:h}=t;if(h==="#text"){const i=document.createTextNode(t.value);o.push(i),Y.append(i);continue}const Z=(y=t==null?void 0:t.attributes)!=null&&y.xmlns?document.createElementNS(t.attributes.xmlns,h):document.createElement(h);if(Y.append(Z),t.attributes&&this.setAttributes({html:Z,element:t,storage:WI,intent:W,linkService:L}),t.children&&t.children.length>0)J.push([t,-1,Z]);else if(t.value){const i=document.createTextNode(t.value);G.XfaText.shouldBuildText(h)&&o.push(i),Z.append(i)}}for(const B of V.querySelectorAll(".xfaNonInteractive input, .xfaNonInteractive textarea"))B.setAttribute("readOnly",!0);return{textDivs:o}}static update(U){const WI=`matrix(${U.viewport.transform.join(",")})`;U.div.style.transform=WI,U.div.hidden=!1}}b.XfaLayer=R},(wI,b,ZI)=>{var e,W,z,J,V,o,y,B,s,Y,t,h,Z,i,A,SC,tC,FC,zC,ZC,JC,dC,LC,kC,TC,QC,jC,gg,GC,Mg,ug,cg,cC,ng,n,xC,iC,OC,UC,bC,Dg,ig;Object.defineProperty(b,"__esModule",{value:!0}),b.InkEditor=void 0;var G=ZI(1),R=ZI(4),cI=ZI(29),U=ZI(6),WI=ZI(5);const aI=class aI extends R.AnnotationEditor{constructor(w){super({...w,name:"inkEditor"});_(this,A);_(this,e,0);_(this,W,0);_(this,z,this.canvasPointermove.bind(this));_(this,J,this.canvasPointerleave.bind(this));_(this,V,this.canvasPointerup.bind(this));_(this,o,this.canvasPointerdown.bind(this));_(this,y,new Path2D);_(this,B,!1);_(this,s,!1);_(this,Y,!1);_(this,t,null);_(this,h,0);_(this,Z,0);_(this,i,null);this.color=w.color||null,this.thickness=w.thickness||null,this.opacity=w.opacity||null,this.paths=[],this.bezierPath2D=[],this.allRawPaths=[],this.currentPath=[],this.scaleFactor=1,this.translationX=this.translationY=0,this.x=0,this.y=0,this._willKeepAspectRatio=!0}static initialize(w){R.AnnotationEditor.initialize(w,{strings:["editor_ink_canvas_aria_label","editor_ink2_aria_label"]})}static updateDefaultParams(w,p){switch(w){case G.AnnotationEditorParamsType.INK_THICKNESS:aI._defaultThickness=p;break;case G.AnnotationEditorParamsType.INK_COLOR:aI._defaultColor=p;break;case G.AnnotationEditorParamsType.INK_OPACITY:aI._defaultOpacity=p/100;break}}updateParams(w,p){switch(w){case G.AnnotationEditorParamsType.INK_THICKNESS:O(this,A,SC).call(this,p);break;case G.AnnotationEditorParamsType.INK_COLOR:O(this,A,tC).call(this,p);break;case G.AnnotationEditorParamsType.INK_OPACITY:O(this,A,FC).call(this,p);break}}static get defaultPropertiesToUpdate(){return[[G.AnnotationEditorParamsType.INK_THICKNESS,aI._defaultThickness],[G.AnnotationEditorParamsType.INK_COLOR,aI._defaultColor||R.AnnotationEditor._defaultLineColor],[G.AnnotationEditorParamsType.INK_OPACITY,Math.round(aI._defaultOpacity*100)]]}get propertiesToUpdate(){return[[G.AnnotationEditorParamsType.INK_THICKNESS,this.thickness||aI._defaultThickness],[G.AnnotationEditorParamsType.INK_COLOR,this.color||aI._defaultColor||R.AnnotationEditor._defaultLineColor],[G.AnnotationEditorParamsType.INK_OPACITY,Math.round(100*(this.opacity??aI._defaultOpacity))]]}rebuild(){this.parent&&(super.rebuild(),this.div!==null&&(this.canvas||(O(this,A,Mg).call(this),O(this,A,ug).call(this)),this.isAttachedToDOM||(this.parent.add(this),O(this,A,cg).call(this)),O(this,A,ig).call(this)))}remove(){this.canvas!==null&&(this.isEmpty()||this.commit(),this.canvas.width=this.canvas.height=0,this.canvas.remove(),this.canvas=null,I(this,t).disconnect(),gI(this,t,null),super.remove())}setParent(w){!this.parent&&w?this._uiManager.removeShouldRescale(this):this.parent&&w===null&&this._uiManager.addShouldRescale(this),super.setParent(w)}onScaleChanging(){const[w,p]=this.parentDimensions,v=this.width*w,q=this.height*p;this.setDimensions(v,q)}enableEditMode(){I(this,B)||this.canvas===null||(super.enableEditMode(),this._isDraggable=!1,this.canvas.addEventListener("pointerdown",I(this,o)))}disableEditMode(){!this.isInEditMode()||this.canvas===null||(super.disableEditMode(),this._isDraggable=!this.isEmpty(),this.div.classList.remove("editing"),this.canvas.removeEventListener("pointerdown",I(this,o)))}onceAdded(){this._isDraggable=!this.isEmpty()}isEmpty(){return this.paths.length===0||this.paths.length===1&&this.paths[0].length===0}commit(){I(this,B)||(super.commit(),this.isEditing=!1,this.disableEditMode(),this.setInForeground(),gI(this,B,!0),this.div.classList.add("disabled"),O(this,A,ig).call(this,!0),this.makeResizable(),this.parent.addInkEditorIfNeeded(!0),this.moveInDOM(),this.div.focus({preventScroll:!0}))}focusin(w){this._focusEventsAllowed&&(super.focusin(w),this.enableEditMode())}canvasPointerdown(w){w.button!==0||!this.isInEditMode()||I(this,B)||(this.setInForeground(),w.preventDefault(),w.type!=="mouse"&&this.div.focus(),O(this,A,JC).call(this,w.offsetX,w.offsetY))}canvasPointermove(w){w.preventDefault(),O(this,A,dC).call(this,w.offsetX,w.offsetY)}canvasPointerup(w){w.preventDefault(),O(this,A,GC).call(this,w)}canvasPointerleave(w){O(this,A,GC).call(this,w)}get isResizable(){return!this.isEmpty()&&I(this,B)}render(){if(this.div)return this.div;let w,p;this.width&&(w=this.x,p=this.y),super.render(),R.AnnotationEditor._l10nPromise.get("editor_ink2_aria_label").then(hI=>{var E;return(E=this.div)==null?void 0:E.setAttribute("aria-label",hI)});const[v,q,mI,NI]=O(this,A,zC).call(this);if(this.setAt(v,q,0,0),this.setDims(mI,NI),O(this,A,Mg).call(this),this.width){const[hI,E]=this.parentDimensions;this.setAspectRatio(this.width*hI,this.height*E),this.setAt(w*hI,p*E,this.width*hI,this.height*E),gI(this,Y,!0),O(this,A,cg).call(this),this.setDims(this.width*hI,this.height*E),O(this,A,gg).call(this),this.div.classList.add("disabled")}else this.div.classList.add("editing"),this.enableEditMode();return O(this,A,ug).call(this),this.div}setDimensions(w,p){const v=Math.round(w),q=Math.round(p);if(I(this,h)===v&&I(this,Z)===q)return;gI(this,h,v),gI(this,Z,q),this.canvas.style.visibility="hidden";const[mI,NI]=this.parentDimensions;this.width=w/mI,this.height=p/NI,this.fixAndSetPosition(),I(this,B)&&O(this,A,cC).call(this,w,p),O(this,A,cg).call(this),O(this,A,gg).call(this),this.canvas.style.visibility="visible",this.fixDims()}static deserialize(w,p,v){var JI,vI,rI;if(w instanceof cI.InkAnnotationElement)return null;const q=super.deserialize(w,p,v);q.thickness=w.thickness,q.color=G.Util.makeHexColor(...w.color),q.opacity=w.opacity;const[mI,NI]=q.pageDimensions,hI=q.width*mI,E=q.height*NI,MI=q.parentScale,yI=w.thickness/2;gI(q,B,!0),gI(q,h,Math.round(hI)),gI(q,Z,Math.round(E));const{paths:TI,rect:LI,rotation:UI}=w;for(let{bezier:VI}of TI){VI=O(JI=aI,n,OC).call(JI,VI,LI,UI);const II=[];q.paths.push(II);let AI=MI*(VI[0]-yI),DI=MI*(VI[1]-yI);for(let xI=2,S=VI.length;xI<S;xI+=6){const BI=MI*(VI[xI]-yI),HI=MI*(VI[xI+1]-yI),SI=MI*(VI[xI+2]-yI),zI=MI*(VI[xI+3]-yI),nI=MI*(VI[xI+4]-yI),H=MI*(VI[xI+5]-yI);II.push([[AI,DI],[BI,HI],[SI,zI],[nI,H]]),AI=nI,DI=H}const OI=O(this,n,xC).call(this,II);q.bezierPath2D.push(OI)}const eI=O(vI=q,A,bC).call(vI);return gI(q,W,Math.max(R.AnnotationEditor.MIN_SIZE,eI[2]-eI[0])),gI(q,e,Math.max(R.AnnotationEditor.MIN_SIZE,eI[3]-eI[1])),O(rI=q,A,cC).call(rI,hI,E),q}serialize(){if(this.isEmpty())return null;const w=this.getRect(0,0),p=R.AnnotationEditor._colorManager.convert(this.ctx.strokeStyle);return{annotationType:G.AnnotationEditorType.INK,color:p,thickness:this.thickness,opacity:this.opacity,paths:O(this,A,UC).call(this,this.scaleFactor/this.parentScale,this.translationX,this.translationY,w),pageIndex:this.pageIndex,rect:w,rotation:this.rotation,structTreeParentId:this._structTreeParentId}}};e=new WeakMap,W=new WeakMap,z=new WeakMap,J=new WeakMap,V=new WeakMap,o=new WeakMap,y=new WeakMap,B=new WeakMap,s=new WeakMap,Y=new WeakMap,t=new WeakMap,h=new WeakMap,Z=new WeakMap,i=new WeakMap,A=new WeakSet,SC=function(w){const p=this.thickness;this.addCommands({cmd:()=>{this.thickness=w,O(this,A,ig).call(this)},undo:()=>{this.thickness=p,O(this,A,ig).call(this)},mustExec:!0,type:G.AnnotationEditorParamsType.INK_THICKNESS,overwriteIfSameType:!0,keepUndo:!0})},tC=function(w){const p=this.color;this.addCommands({cmd:()=>{this.color=w,O(this,A,gg).call(this)},undo:()=>{this.color=p,O(this,A,gg).call(this)},mustExec:!0,type:G.AnnotationEditorParamsType.INK_COLOR,overwriteIfSameType:!0,keepUndo:!0})},FC=function(w){w/=100;const p=this.opacity;this.addCommands({cmd:()=>{this.opacity=w,O(this,A,gg).call(this)},undo:()=>{this.opacity=p,O(this,A,gg).call(this)},mustExec:!0,type:G.AnnotationEditorParamsType.INK_OPACITY,overwriteIfSameType:!0,keepUndo:!0})},zC=function(){const{parentRotation:w,parentDimensions:[p,v]}=this;switch(w){case 90:return[0,v,v,p];case 180:return[p,v,p,v];case 270:return[p,0,v,p];default:return[0,0,p,v]}},ZC=function(){const{ctx:w,color:p,opacity:v,thickness:q,parentScale:mI,scaleFactor:NI}=this;w.lineWidth=q*mI/NI,w.lineCap="round",w.lineJoin="round",w.miterLimit=10,w.strokeStyle=`${p}${(0,WI.opacityToHex)(v)}`},JC=function(w,p){this.canvas.addEventListener("contextmenu",U.noContextMenu),this.canvas.addEventListener("pointerleave",I(this,J)),this.canvas.addEventListener("pointermove",I(this,z)),this.canvas.addEventListener("pointerup",I(this,V)),this.canvas.removeEventListener("pointerdown",I(this,o)),this.isEditing=!0,I(this,Y)||(gI(this,Y,!0),O(this,A,cg).call(this),this.thickness||(this.thickness=aI._defaultThickness),this.color||(this.color=aI._defaultColor||R.AnnotationEditor._defaultLineColor),this.opacity??(this.opacity=aI._defaultOpacity)),this.currentPath.push([w,p]),gI(this,s,!1),O(this,A,ZC).call(this),gI(this,i,()=>{O(this,A,TC).call(this),I(this,i)&&window.requestAnimationFrame(I(this,i))}),window.requestAnimationFrame(I(this,i))},dC=function(w,p){const[v,q]=this.currentPath.at(-1);if(this.currentPath.length>1&&w===v&&p===q)return;const mI=this.currentPath;let NI=I(this,y);if(mI.push([w,p]),gI(this,s,!0),mI.length<=2){NI.moveTo(...mI[0]),NI.lineTo(w,p);return}mI.length===3&&(gI(this,y,NI=new Path2D),NI.moveTo(...mI[0])),O(this,A,QC).call(this,NI,...mI.at(-3),...mI.at(-2),w,p)},LC=function(){if(this.currentPath.length===0)return;const w=this.currentPath.at(-1);I(this,y).lineTo(...w)},kC=function(w,p){gI(this,i,null),w=Math.min(Math.max(w,0),this.canvas.width),p=Math.min(Math.max(p,0),this.canvas.height),O(this,A,dC).call(this,w,p),O(this,A,LC).call(this);let v;if(this.currentPath.length!==1)v=O(this,A,jC).call(this);else{const E=[w,p];v=[[E,E.slice(),E.slice(),E]]}const q=I(this,y),mI=this.currentPath;this.currentPath=[],gI(this,y,new Path2D);const NI=()=>{this.allRawPaths.push(mI),this.paths.push(v),this.bezierPath2D.push(q),this.rebuild()},hI=()=>{this.allRawPaths.pop(),this.paths.pop(),this.bezierPath2D.pop(),this.paths.length===0?this.remove():(this.canvas||(O(this,A,Mg).call(this),O(this,A,ug).call(this)),O(this,A,ig).call(this))};this.addCommands({cmd:NI,undo:hI,mustExec:!0})},TC=function(){if(!I(this,s))return;gI(this,s,!1);const w=Math.ceil(this.thickness*this.parentScale),p=this.currentPath.slice(-3),v=p.map(NI=>NI[0]),q=p.map(NI=>NI[1]);Math.min(...v)-w,Math.max(...v)+w,Math.min(...q)-w,Math.max(...q)+w;const{ctx:mI}=this;mI.save(),mI.clearRect(0,0,this.canvas.width,this.canvas.height);for(const NI of this.bezierPath2D)mI.stroke(NI);mI.stroke(I(this,y)),mI.restore()},QC=function(w,p,v,q,mI,NI,hI){const E=(p+q)/2,MI=(v+mI)/2,yI=(q+NI)/2,TI=(mI+hI)/2;w.bezierCurveTo(E+2*(q-E)/3,MI+2*(mI-MI)/3,yI+2*(q-yI)/3,TI+2*(mI-TI)/3,yI,TI)},jC=function(){const w=this.currentPath;if(w.length<=2)return[[w[0],w[0],w.at(-1),w.at(-1)]];const p=[];let v,[q,mI]=w[0];for(v=1;v<w.length-2;v++){const[LI,UI]=w[v],[eI,JI]=w[v+1],vI=(LI+eI)/2,rI=(UI+JI)/2,VI=[q+2*(LI-q)/3,mI+2*(UI-mI)/3],II=[vI+2*(LI-vI)/3,rI+2*(UI-rI)/3];p.push([[q,mI],VI,II,[vI,rI]]),[q,mI]=[vI,rI]}const[NI,hI]=w[v],[E,MI]=w[v+1],yI=[q+2*(NI-q)/3,mI+2*(hI-mI)/3],TI=[E+2*(NI-E)/3,MI+2*(hI-MI)/3];return p.push([[q,mI],yI,TI,[E,MI]]),p},gg=function(){if(this.isEmpty()){O(this,A,ng).call(this);return}O(this,A,ZC).call(this);const{canvas:w,ctx:p}=this;p.setTransform(1,0,0,1,0,0),p.clearRect(0,0,w.width,w.height),O(this,A,ng).call(this);for(const v of this.bezierPath2D)p.stroke(v)},GC=function(w){this.canvas.removeEventListener("pointerleave",I(this,J)),this.canvas.removeEventListener("pointermove",I(this,z)),this.canvas.removeEventListener("pointerup",I(this,V)),this.canvas.addEventListener("pointerdown",I(this,o)),setTimeout(()=>{this.canvas.removeEventListener("contextmenu",U.noContextMenu)},10),O(this,A,kC).call(this,w.offsetX,w.offsetY),this.addToAnnotationStorage(),this.setInBackground()},Mg=function(){this.canvas=document.createElement("canvas"),this.canvas.width=this.canvas.height=0,this.canvas.className="inkEditorCanvas",R.AnnotationEditor._l10nPromise.get("editor_ink_canvas_aria_label").then(w=>{var p;return(p=this.canvas)==null?void 0:p.setAttribute("aria-label",w)}),this.div.append(this.canvas),this.ctx=this.canvas.getContext("2d")},ug=function(){gI(this,t,new ResizeObserver(w=>{const p=w[0].contentRect;p.width&&p.height&&this.setDimensions(p.width,p.height)})),I(this,t).observe(this.div)},cg=function(){if(!I(this,Y))return;const[w,p]=this.parentDimensions;this.canvas.width=Math.ceil(this.width*w),this.canvas.height=Math.ceil(this.height*p),O(this,A,ng).call(this)},cC=function(w,p){const v=O(this,A,Dg).call(this),q=(w-v)/I(this,W),mI=(p-v)/I(this,e);this.scaleFactor=Math.min(q,mI)},ng=function(){const w=O(this,A,Dg).call(this)/2;this.ctx.setTransform(this.scaleFactor,0,0,this.scaleFactor,this.translationX*this.scaleFactor+w,this.translationY*this.scaleFactor+w)},n=new WeakSet,xC=function(w){const p=new Path2D;for(let v=0,q=w.length;v<q;v++){const[mI,NI,hI,E]=w[v];v===0&&p.moveTo(...mI),p.bezierCurveTo(NI[0],NI[1],hI[0],hI[1],E[0],E[1])}return p},iC=function(w,p,v){const[q,mI,NI,hI]=p;switch(v){case 0:for(let E=0,MI=w.length;E<MI;E+=2)w[E]+=q,w[E+1]=hI-w[E+1];break;case 90:for(let E=0,MI=w.length;E<MI;E+=2){const yI=w[E];w[E]=w[E+1]+q,w[E+1]=yI+mI}break;case 180:for(let E=0,MI=w.length;E<MI;E+=2)w[E]=NI-w[E],w[E+1]+=mI;break;case 270:for(let E=0,MI=w.length;E<MI;E+=2){const yI=w[E];w[E]=NI-w[E+1],w[E+1]=hI-yI}break;default:throw new Error("Invalid rotation")}return w},OC=function(w,p,v){const[q,mI,NI,hI]=p;switch(v){case 0:for(let E=0,MI=w.length;E<MI;E+=2)w[E]-=q,w[E+1]=hI-w[E+1];break;case 90:for(let E=0,MI=w.length;E<MI;E+=2){const yI=w[E];w[E]=w[E+1]-mI,w[E+1]=yI-q}break;case 180:for(let E=0,MI=w.length;E<MI;E+=2)w[E]=NI-w[E],w[E+1]-=mI;break;case 270:for(let E=0,MI=w.length;E<MI;E+=2){const yI=w[E];w[E]=hI-w[E+1],w[E+1]=NI-yI}break;default:throw new Error("Invalid rotation")}return w},UC=function(w,p,v,q){var MI,yI;const mI=[],NI=this.thickness/2,hI=w*p+NI,E=w*v+NI;for(const TI of this.paths){const LI=[],UI=[];for(let eI=0,JI=TI.length;eI<JI;eI++){const[vI,rI,VI,II]=TI[eI],AI=w*vI[0]+hI,DI=w*vI[1]+E,OI=w*rI[0]+hI,xI=w*rI[1]+E,S=w*VI[0]+hI,BI=w*VI[1]+E,HI=w*II[0]+hI,SI=w*II[1]+E;eI===0&&(LI.push(AI,DI),UI.push(AI,DI)),LI.push(OI,xI,S,BI,HI,SI),UI.push(OI,xI),eI===JI-1&&UI.push(HI,SI)}mI.push({bezier:O(MI=aI,n,iC).call(MI,LI,q,this.rotation),points:O(yI=aI,n,iC).call(yI,UI,q,this.rotation)})}return mI},bC=function(){let w=1/0,p=-1/0,v=1/0,q=-1/0;for(const mI of this.paths)for(const[NI,hI,E,MI]of mI){const yI=G.Util.bezierBoundingBox(...NI,...hI,...E,...MI);w=Math.min(w,yI[0]),v=Math.min(v,yI[1]),p=Math.max(p,yI[2]),q=Math.max(q,yI[3])}return[w,v,p,q]},Dg=function(){return I(this,B)?Math.ceil(this.thickness*this.parentScale):0},ig=function(w=!1){if(this.isEmpty())return;if(!I(this,B)){O(this,A,gg).call(this);return}const p=O(this,A,bC).call(this),v=O(this,A,Dg).call(this);gI(this,W,Math.max(R.AnnotationEditor.MIN_SIZE,p[2]-p[0])),gI(this,e,Math.max(R.AnnotationEditor.MIN_SIZE,p[3]-p[1]));const q=Math.ceil(v+I(this,W)*this.scaleFactor),mI=Math.ceil(v+I(this,e)*this.scaleFactor),[NI,hI]=this.parentDimensions;this.width=q/NI,this.height=mI/hI,this.setAspectRatio(q,mI);const E=this.translationX,MI=this.translationY;this.translationX=-p[0],this.translationY=-p[1],O(this,A,cg).call(this),O(this,A,gg).call(this),gI(this,h,q),gI(this,Z,mI),this.setDims(q,mI);const yI=w?v/this.scaleFactor/2:0;this.translate(E-this.translationX-yI,MI-this.translationY-yI)},_(aI,n),fI(aI,"_defaultColor",null),fI(aI,"_defaultOpacity",1),fI(aI,"_defaultThickness",1),fI(aI,"_type","ink");let L=aI;b.InkEditor=L},(wI,b,ZI)=>{var L,e,W,z,J,V,o,y,B,s,Y,Yg,og,eg,sC,vC,EC,mC,Kg,rC;Object.defineProperty(b,"__esModule",{value:!0}),b.StampEditor=void 0;var G=ZI(1),R=ZI(4),cI=ZI(6),U=ZI(29);const X=class X extends R.AnnotationEditor{constructor(j){super({...j,name:"stampEditor"});_(this,Y);_(this,L,null);_(this,e,null);_(this,W,null);_(this,z,null);_(this,J,null);_(this,V,null);_(this,o,null);_(this,y,null);_(this,B,!1);_(this,s,!1);gI(this,z,j.bitmapUrl),gI(this,J,j.bitmapFile)}static initialize(j){R.AnnotationEditor.initialize(j)}static get supportedTypes(){const j=["apng","avif","bmp","gif","jpeg","png","svg+xml","webp","x-icon"];return(0,G.shadow)(this,"supportedTypes",j.map(r=>`image/${r}`))}static get supportedTypesStr(){return(0,G.shadow)(this,"supportedTypesStr",this.supportedTypes.join(","))}static isHandlingMimeForPasting(j){return this.supportedTypes.includes(j)}static paste(j,r){r.pasteEditor(G.AnnotationEditorType.STAMP,{bitmapFile:j.getAsFile()})}remove(){var j,r;I(this,e)&&(gI(this,L,null),this._uiManager.imageManager.deleteId(I(this,e)),(j=I(this,V))==null||j.remove(),gI(this,V,null),(r=I(this,o))==null||r.disconnect(),gI(this,o,null)),super.remove()}rebuild(){if(!this.parent){I(this,e)&&O(this,Y,eg).call(this);return}super.rebuild(),this.div!==null&&(I(this,e)&&O(this,Y,eg).call(this),this.isAttachedToDOM||this.parent.add(this))}onceAdded(){this._isDraggable=!0,this.div.focus()}isEmpty(){return!(I(this,W)||I(this,L)||I(this,z)||I(this,J))}get isResizable(){return!0}render(){if(this.div)return this.div;let j,r;if(this.width&&(j=this.x,r=this.y),super.render(),this.div.hidden=!0,I(this,L)?O(this,Y,sC).call(this):O(this,Y,eg).call(this),this.width){const[T,dI]=this.parentDimensions;this.setAt(j*T,r*dI,this.width*T,this.height*dI)}return this.div}static deserialize(j,r,T){if(j instanceof U.StampAnnotationElement)return null;const dI=super.deserialize(j,r,T),{rect:M,bitmapUrl:k,bitmapId:P,isSvg:N,accessibilityData:g}=j;P&&T.imageManager.isValidId(P)?gI(dI,e,P):gI(dI,z,k),gI(dI,B,N);const[C,m]=dI.pageDimensions;return dI.width=(M[2]-M[0])/C,dI.height=(M[3]-M[1])/m,g&&(dI.altTextData=g),dI}serialize(j=!1,r=null){if(this.isEmpty())return null;const T={annotationType:G.AnnotationEditorType.STAMP,bitmapId:I(this,e),pageIndex:this.pageIndex,rect:this.getRect(0,0),rotation:this.rotation,isSvg:I(this,B),structTreeParentId:this._structTreeParentId};if(j)return T.bitmapUrl=O(this,Y,Kg).call(this,!0),T.accessibilityData=this.altTextData,T;const{decorative:dI,altText:M}=this.altTextData;if(!dI&&M&&(T.accessibilityData={type:"Figure",alt:M}),r===null)return T;r.stamps||(r.stamps=new Map);const k=I(this,B)?(T.rect[2]-T.rect[0])*(T.rect[3]-T.rect[1]):null;if(!r.stamps.has(I(this,e)))r.stamps.set(I(this,e),{area:k,serialized:T}),T.bitmap=O(this,Y,Kg).call(this,!1);else if(I(this,B)){const P=r.stamps.get(I(this,e));k>P.area&&(P.area=k,P.serialized.bitmap.close(),P.serialized.bitmap=O(this,Y,Kg).call(this,!1))}return T}};L=new WeakMap,e=new WeakMap,W=new WeakMap,z=new WeakMap,J=new WeakMap,V=new WeakMap,o=new WeakMap,y=new WeakMap,B=new WeakMap,s=new WeakMap,Y=new WeakSet,Yg=function(j,r=!1){if(!j){this.remove();return}gI(this,L,j.bitmap),r||(gI(this,e,j.id),gI(this,B,j.isSvg)),O(this,Y,sC).call(this)},og=function(){gI(this,W,null),this._uiManager.enableWaiting(!1),I(this,V)&&this.div.focus()},eg=function(){if(I(this,e)){this._uiManager.enableWaiting(!0),this._uiManager.imageManager.getFromId(I(this,e)).then(r=>O(this,Y,Yg).call(this,r,!0)).finally(()=>O(this,Y,og).call(this));return}if(I(this,z)){const r=I(this,z);gI(this,z,null),this._uiManager.enableWaiting(!0),gI(this,W,this._uiManager.imageManager.getFromUrl(r).then(T=>O(this,Y,Yg).call(this,T)).finally(()=>O(this,Y,og).call(this)));return}if(I(this,J)){const r=I(this,J);gI(this,J,null),this._uiManager.enableWaiting(!0),gI(this,W,this._uiManager.imageManager.getFromFile(r).then(T=>O(this,Y,Yg).call(this,T)).finally(()=>O(this,Y,og).call(this)));return}const j=document.createElement("input");j.type="file",j.accept=X.supportedTypesStr,gI(this,W,new Promise(r=>{j.addEventListener("change",async()=>{if(!j.files||j.files.length===0)this.remove();else{this._uiManager.enableWaiting(!0);const T=await this._uiManager.imageManager.getFromFile(j.files[0]);O(this,Y,Yg).call(this,T)}r()}),j.addEventListener("cancel",()=>{this.remove(),r()})}).finally(()=>O(this,Y,og).call(this))),j.click()},sC=function(){const{div:j}=this;let{width:r,height:T}=I(this,L);const[dI,M]=this.pageDimensions,k=.75;if(this.width)r=this.width*dI,T=this.height*M;else if(r>k*dI||T>k*M){const C=Math.min(k*dI/r,k*M/T);r*=C,T*=C}const[P,N]=this.parentDimensions;this.setDims(r*P/dI,T*N/M),this._uiManager.enableWaiting(!1);const g=gI(this,V,document.createElement("canvas"));j.append(g),j.hidden=!1,O(this,Y,mC).call(this,r,T),O(this,Y,rC).call(this),I(this,s)||(this.parent.addUndoableEditor(this),gI(this,s,!0)),this._uiManager._eventBus.dispatch("reporttelemetry",{source:this,details:{type:"editing",subtype:this.editorType,data:{action:"inserted_image"}}}),this.addAltTextButton()},vC=function(j,r){var k;const[T,dI]=this.parentDimensions;this.width=j/T,this.height=r/dI,this.setDims(j,r),(k=this._initialOptions)!=null&&k.isCentered?this.center():this.fixAndSetPosition(),this._initialOptions=null,I(this,y)!==null&&clearTimeout(I(this,y)),gI(this,y,setTimeout(()=>{gI(this,y,null),O(this,Y,mC).call(this,j,r)},200))},EC=function(j,r){const{width:T,height:dI}=I(this,L);let M=T,k=dI,P=I(this,L);for(;M>2*j||k>2*r;){const N=M,g=k;M>2*j&&(M=M>=16384?Math.floor(M/2)-1:Math.ceil(M/2)),k>2*r&&(k=k>=16384?Math.floor(k/2)-1:Math.ceil(k/2));const C=new OffscreenCanvas(M,k);C.getContext("2d").drawImage(P,0,0,N,g,0,0,M,k),P=C.transferToImageBitmap()}return P},mC=function(j,r){j=Math.ceil(j),r=Math.ceil(r);const T=I(this,V);if(!T||T.width===j&&T.height===r)return;T.width=j,T.height=r;const dI=I(this,B)?I(this,L):O(this,Y,EC).call(this,j,r),M=T.getContext("2d");M.filter=this._uiManager.hcmFilter,M.drawImage(dI,0,0,dI.width,dI.height,0,0,j,r)},Kg=function(j){if(j){if(I(this,B)){const dI=this._uiManager.imageManager.getSvgUrl(I(this,e));if(dI)return dI}const r=document.createElement("canvas");return{width:r.width,height:r.height}=I(this,L),r.getContext("2d").drawImage(I(this,L),0,0),r.toDataURL()}if(I(this,B)){const[r,T]=this.pageDimensions,dI=Math.round(this.width*r*cI.PixelsPerInch.PDF_TO_CSS_UNITS),M=Math.round(this.height*T*cI.PixelsPerInch.PDF_TO_CSS_UNITS),k=new OffscreenCanvas(dI,M);return k.getContext("2d").drawImage(I(this,L),0,0,I(this,L).width,I(this,L).height,0,0,dI,M),k.transferToImageBitmap()}return structuredClone(I(this,L))},rC=function(){gI(this,o,new ResizeObserver(j=>{const r=j[0].contentRect;r.width&&r.height&&O(this,Y,vC).call(this,r.width,r.height)})),I(this,o).observe(this.div)},fI(X,"_type","stamp");let WI=X;b.StampEditor=WI}],__webpack_module_cache__={};function __w_pdfjs_require__(wI){var b=__webpack_module_cache__[wI];if(b!==void 0)return b.exports;var ZI=__webpack_module_cache__[wI]={exports:{}};return __webpack_modules__[wI](ZI,ZI.exports,__w_pdfjs_require__),ZI.exports}var __webpack_exports__={};return(()=>{var wI=__webpack_exports__;Object.defineProperty(wI,"__esModule",{value:!0}),Object.defineProperty(wI,"AbortException",{enumerable:!0,get:function(){return b.AbortException}}),Object.defineProperty(wI,"AnnotationEditorLayer",{enumerable:!0,get:function(){return cI.AnnotationEditorLayer}}),Object.defineProperty(wI,"AnnotationEditorParamsType",{enumerable:!0,get:function(){return b.AnnotationEditorParamsType}}),Object.defineProperty(wI,"AnnotationEditorType",{enumerable:!0,get:function(){return b.AnnotationEditorType}}),Object.defineProperty(wI,"AnnotationEditorUIManager",{enumerable:!0,get:function(){return U.AnnotationEditorUIManager}}),Object.defineProperty(wI,"AnnotationLayer",{enumerable:!0,get:function(){return WI.AnnotationLayer}}),Object.defineProperty(wI,"AnnotationMode",{enumerable:!0,get:function(){return b.AnnotationMode}}),Object.defineProperty(wI,"CMapCompressionType",{enumerable:!0,get:function(){return b.CMapCompressionType}}),Object.defineProperty(wI,"DOMSVGFactory",{enumerable:!0,get:function(){return G.DOMSVGFactory}}),Object.defineProperty(wI,"FeatureTest",{enumerable:!0,get:function(){return b.FeatureTest}}),Object.defineProperty(wI,"GlobalWorkerOptions",{enumerable:!0,get:function(){return L.GlobalWorkerOptions}}),Object.defineProperty(wI,"ImageKind",{enumerable:!0,get:function(){return b.ImageKind}}),Object.defineProperty(wI,"InvalidPDFException",{enumerable:!0,get:function(){return b.InvalidPDFException}}),Object.defineProperty(wI,"MissingPDFException",{enumerable:!0,get:function(){return b.MissingPDFException}}),Object.defineProperty(wI,"OPS",{enumerable:!0,get:function(){return b.OPS}}),Object.defineProperty(wI,"PDFDataRangeTransport",{enumerable:!0,get:function(){return ZI.PDFDataRangeTransport}}),Object.defineProperty(wI,"PDFDateString",{enumerable:!0,get:function(){return G.PDFDateString}}),Object.defineProperty(wI,"PDFWorker",{enumerable:!0,get:function(){return ZI.PDFWorker}}),Object.defineProperty(wI,"PasswordResponses",{enumerable:!0,get:function(){return b.PasswordResponses}}),Object.defineProperty(wI,"PermissionFlag",{enumerable:!0,get:function(){return b.PermissionFlag}}),Object.defineProperty(wI,"PixelsPerInch",{enumerable:!0,get:function(){return G.PixelsPerInch}}),Object.defineProperty(wI,"PromiseCapability",{enumerable:!0,get:function(){return b.PromiseCapability}}),Object.defineProperty(wI,"RenderingCancelledException",{enumerable:!0,get:function(){return G.RenderingCancelledException}}),Object.defineProperty(wI,"SVGGraphics",{enumerable:!0,get:function(){return ZI.SVGGraphics}}),Object.defineProperty(wI,"UnexpectedResponseException",{enumerable:!0,get:function(){return b.UnexpectedResponseException}}),Object.defineProperty(wI,"Util",{enumerable:!0,get:function(){return b.Util}}),Object.defineProperty(wI,"VerbosityLevel",{enumerable:!0,get:function(){return b.VerbosityLevel}}),Object.defineProperty(wI,"XfaLayer",{enumerable:!0,get:function(){return e.XfaLayer}}),Object.defineProperty(wI,"build",{enumerable:!0,get:function(){return ZI.build}}),Object.defineProperty(wI,"createValidAbsoluteUrl",{enumerable:!0,get:function(){return b.createValidAbsoluteUrl}}),Object.defineProperty(wI,"getDocument",{enumerable:!0,get:function(){return ZI.getDocument}}),Object.defineProperty(wI,"getFilenameFromUrl",{enumerable:!0,get:function(){return G.getFilenameFromUrl}}),Object.defineProperty(wI,"getPdfFilenameFromUrl",{enumerable:!0,get:function(){return G.getPdfFilenameFromUrl}}),Object.defineProperty(wI,"getXfaPageViewport",{enumerable:!0,get:function(){return G.getXfaPageViewport}}),Object.defineProperty(wI,"isDataScheme",{enumerable:!0,get:function(){return G.isDataScheme}}),Object.defineProperty(wI,"isPdfFile",{enumerable:!0,get:function(){return G.isPdfFile}}),Object.defineProperty(wI,"loadScript",{enumerable:!0,get:function(){return G.loadScript}}),Object.defineProperty(wI,"noContextMenu",{enumerable:!0,get:function(){return G.noContextMenu}}),Object.defineProperty(wI,"normalizeUnicode",{enumerable:!0,get:function(){return b.normalizeUnicode}}),Object.defineProperty(wI,"renderTextLayer",{enumerable:!0,get:function(){return R.renderTextLayer}}),Object.defineProperty(wI,"setLayerDimensions",{enumerable:!0,get:function(){return G.setLayerDimensions}}),Object.defineProperty(wI,"shadow",{enumerable:!0,get:function(){return b.shadow}}),Object.defineProperty(wI,"updateTextLayer",{enumerable:!0,get:function(){return R.updateTextLayer}}),Object.defineProperty(wI,"version",{enumerable:!0,get:function(){return ZI.version}});var b=__w_pdfjs_require__(1),ZI=__w_pdfjs_require__(2),G=__w_pdfjs_require__(6),R=__w_pdfjs_require__(26),cI=__w_pdfjs_require__(27),U=__w_pdfjs_require__(5),WI=__w_pdfjs_require__(29),L=__w_pdfjs_require__(14),e=__w_pdfjs_require__(32)})(),__webpack_exports__})())})(pdf);var pdfExports=pdf.exports;const pdfjsWorker="data:text/javascript;base64,LyoqCiAqIEBsaWNzdGFydCBUaGUgZm9sbG93aW5nIGlzIHRoZSBlbnRpcmUgbGljZW5zZSBub3RpY2UgZm9yIHRoZQogKiBKYXZhU2NyaXB0IGNvZGUgaW4gdGhpcyBwYWdlCiAqCiAqIENvcHlyaWdodCAyMDIzIE1vemlsbGEgRm91bmRhdGlvbgogKgogKiBMaWNlbnNlZCB1bmRlciB0aGUgQXBhY2hlIExpY2Vuc2UsIFZlcnNpb24gMi4wICh0aGUgIkxpY2Vuc2UiKTsKICogeW91IG1heSBub3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZSB3aXRoIHRoZSBMaWNlbnNlLgogKiBZb3UgbWF5IG9idGFpbiBhIGNvcHkgb2YgdGhlIExpY2Vuc2UgYXQKICoKICogICAgIGh0dHA6Ly93d3cuYXBhY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMAogKgogKiBVbmxlc3MgcmVxdWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRpbmcsIHNvZnR3YXJlCiAqIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNlIGlzIGRpc3RyaWJ1dGVkIG9uIGFuICJBUyBJUyIgQkFTSVMsCiAqIFdJVEhPVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWSBLSU5ELCBlaXRoZXIgZXhwcmVzcyBvciBpbXBsaWVkLgogKiBTZWUgdGhlIExpY2Vuc2UgZm9yIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMgYW5kCiAqIGxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLgogKgogKiBAbGljZW5kIFRoZSBhYm92ZSBpcyB0aGUgZW50aXJlIGxpY2Vuc2Ugbm90aWNlIGZvciB0aGUKICogSmF2YVNjcmlwdCBjb2RlIGluIHRoaXMgcGFnZQogKi8KCihmdW5jdGlvbiB3ZWJwYWNrVW5pdmVyc2FsTW9kdWxlRGVmaW5pdGlvbihyb290LCBmYWN0b3J5KSB7CglpZih0eXBlb2YgZXhwb3J0cyA9PT0gJ29iamVjdCcgJiYgdHlwZW9mIG1vZHVsZSA9PT0gJ29iamVjdCcpCgkJbW9kdWxlLmV4cG9ydHMgPSByb290LnBkZmpzV29ya2VyID0gZmFjdG9yeSgpOwoJZWxzZSBpZih0eXBlb2YgZGVmaW5lID09PSAnZnVuY3Rpb24nICYmIGRlZmluZS5hbWQpCgkJZGVmaW5lKCJwZGZqcy1kaXN0L2J1aWxkL3BkZi53b3JrZXIiLCBbXSwgKCkgPT4geyByZXR1cm4gKHJvb3QucGRmanNXb3JrZXIgPSBmYWN0b3J5KCkpOyB9KTsKCWVsc2UgaWYodHlwZW9mIGV4cG9ydHMgPT09ICdvYmplY3QnKQoJCWV4cG9ydHNbInBkZmpzLWRpc3QvYnVpbGQvcGRmLndvcmtlciJdID0gcm9vdC5wZGZqc1dvcmtlciA9IGZhY3RvcnkoKTsKCWVsc2UKCQlyb290WyJwZGZqcy1kaXN0L2J1aWxkL3BkZi53b3JrZXIiXSA9IHJvb3QucGRmanNXb3JrZXIgPSBmYWN0b3J5KCk7Cn0pKGdsb2JhbFRoaXMsICgpID0+IHsKcmV0dXJuIC8qKioqKiovICgoKSA9PiB7IC8vIHdlYnBhY2tCb290c3RyYXAKLyoqKioqKi8gCSJ1c2Ugc3RyaWN0IjsKLyoqKioqKi8gCXZhciBfX3dlYnBhY2tfbW9kdWxlc19fID0gKFsKLyogMCAqLywKLyogMSAqLwovKioqLyAoKF9fdW51c2VkX3dlYnBhY2tfbW9kdWxlLCBleHBvcnRzLCBfX3dfcGRmanNfcmVxdWlyZV9fKSA9PiB7CgoKCk9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCAiX19lc01vZHVsZSIsICh7CiAgdmFsdWU6IHRydWUKfSkpOwpleHBvcnRzLldvcmtlclRhc2sgPSBleHBvcnRzLldvcmtlck1lc3NhZ2VIYW5kbGVyID0gdm9pZCAwOwp2YXIgX3V0aWwgPSBfX3dfcGRmanNfcmVxdWlyZV9fKDIpOwp2YXIgX2NvcmVfdXRpbHMgPSBfX3dfcGRmanNfcmVxdWlyZV9fKDMpOwp2YXIgX3ByaW1pdGl2ZXMgPSBfX3dfcGRmanNfcmVxdWlyZV9fKDQpOwp2YXIgX3BkZl9tYW5hZ2VyID0gX193X3BkZmpzX3JlcXVpcmVfXyg2KTsKdmFyIF9hbm5vdGF0aW9uID0gX193X3BkZmpzX3JlcXVpcmVfXygxMCk7CnZhciBfY2xlYW51cF9oZWxwZXIgPSBfX3dfcGRmanNfcmVxdWlyZV9fKDY4KTsKdmFyIF93cml0ZXIgPSBfX3dfcGRmanNfcmVxdWlyZV9fKDczKTsKdmFyIF9tZXNzYWdlX2hhbmRsZXIgPSBfX3dfcGRmanNfcmVxdWlyZV9fKDEwNCk7CnZhciBfd29ya2VyX3N0cmVhbSA9IF9fd19wZGZqc19yZXF1aXJlX18oMTA1KTsKdmFyIF9zdHJ1Y3RfdHJlZSA9IF9fd19wZGZqc19yZXF1aXJlX18oNzIpOwpjbGFzcyBXb3JrZXJUYXNrIHsKICBjb25zdHJ1Y3RvcihuYW1lKSB7CiAgICB0aGlzLm5hbWUgPSBuYW1lOwogICAgdGhpcy50ZXJtaW5hdGVkID0gZmFsc2U7CiAgICB0aGlzLl9jYXBhYmlsaXR5ID0gbmV3IF91dGlsLlByb21pc2VDYXBhYmlsaXR5KCk7CiAgfQogIGdldCBmaW5pc2hlZCgpIHsKICAgIHJldHVybiB0aGlzLl9jYXBhYmlsaXR5LnByb21pc2U7CiAgfQogIGZpbmlzaCgpIHsKICAgIHRoaXMuX2NhcGFiaWxpdHkucmVzb2x2ZSgpOwogIH0KICB0ZXJtaW5hdGUoKSB7CiAgICB0aGlzLnRlcm1pbmF0ZWQgPSB0cnVlOwogIH0KICBlbnN1cmVOb3RUZXJtaW5hdGVkKCkgewogICAgaWYgKHRoaXMudGVybWluYXRlZCkgewogICAgICB0aHJvdyBuZXcgRXJyb3IoIldvcmtlciB0YXNrIHdhcyB0ZXJtaW5hdGVkIik7CiAgICB9CiAgfQp9CmV4cG9ydHMuV29ya2VyVGFzayA9IFdvcmtlclRhc2s7CmNsYXNzIFdvcmtlck1lc3NhZ2VIYW5kbGVyIHsKICBzdGF0aWMgc2V0dXAoaGFuZGxlciwgcG9ydCkgewogICAgbGV0IHRlc3RNZXNzYWdlUHJvY2Vzc2VkID0gZmFsc2U7CiAgICBoYW5kbGVyLm9uKCJ0ZXN0IiwgZnVuY3Rpb24gKGRhdGEpIHsKICAgICAgaWYgKHRlc3RNZXNzYWdlUHJvY2Vzc2VkKSB7CiAgICAgICAgcmV0dXJuOwogICAgICB9CiAgICAgIHRlc3RNZXNzYWdlUHJvY2Vzc2VkID0gdHJ1ZTsKICAgICAgaGFuZGxlci5zZW5kKCJ0ZXN0IiwgZGF0YSBpbnN0YW5jZW9mIFVpbnQ4QXJyYXkpOwogICAgfSk7CiAgICBoYW5kbGVyLm9uKCJjb25maWd1cmUiLCBmdW5jdGlvbiAoZGF0YSkgewogICAgICAoMCwgX3V0aWwuc2V0VmVyYm9zaXR5TGV2ZWwpKGRhdGEudmVyYm9zaXR5KTsKICAgIH0pOwogICAgaGFuZGxlci5vbigiR2V0RG9jUmVxdWVzdCIsIGZ1bmN0aW9uIChkYXRhKSB7CiAgICAgIHJldHVybiBXb3JrZXJNZXNzYWdlSGFuZGxlci5jcmVhdGVEb2N1bWVudEhhbmRsZXIoZGF0YSwgcG9ydCk7CiAgICB9KTsKICB9CiAgc3RhdGljIGNyZWF0ZURvY3VtZW50SGFuZGxlcihkb2NQYXJhbXMsIHBvcnQpIHsKICAgIGxldCBwZGZNYW5hZ2VyOwogICAgbGV0IHRlcm1pbmF0ZWQgPSBmYWxzZTsKICAgIGxldCBjYW5jZWxYSFJzID0gbnVsbDsKICAgIGNvbnN0IFdvcmtlclRhc2tzID0gbmV3IFNldCgpOwogICAgY29uc3QgdmVyYm9zaXR5ID0gKDAsIF91dGlsLmdldFZlcmJvc2l0eUxldmVsKSgpOwogICAgY29uc3QgewogICAgICBkb2NJZCwKICAgICAgYXBpVmVyc2lvbgogICAgfSA9IGRvY1BhcmFtczsKICAgIGNvbnN0IHdvcmtlclZlcnNpb24gPSAnMy4xMS4xNzQnOwogICAgaWYgKGFwaVZlcnNpb24gIT09IHdvcmtlclZlcnNpb24pIHsKICAgICAgdGhyb3cgbmV3IEVycm9yKGBUaGUgQVBJIHZlcnNpb24gIiR7YXBpVmVyc2lvbn0iIGRvZXMgbm90IG1hdGNoIGAgKyBgdGhlIFdvcmtlciB2ZXJzaW9uICIke3dvcmtlclZlcnNpb259Ii5gKTsKICAgIH0KICAgIGNvbnN0IGVudW1lcmFibGVQcm9wZXJ0aWVzID0gW107CiAgICBmb3IgKGNvbnN0IHByb3BlcnR5IGluIFtdKSB7CiAgICAgIGVudW1lcmFibGVQcm9wZXJ0aWVzLnB1c2gocHJvcGVydHkpOwogICAgfQogICAgaWYgKGVudW1lcmFibGVQcm9wZXJ0aWVzLmxlbmd0aCkgewogICAgICB0aHJvdyBuZXcgRXJyb3IoIlRoZSBgQXJyYXkucHJvdG90eXBlYCBjb250YWlucyB1bmV4cGVjdGVkIGVudW1lcmFibGUgcHJvcGVydGllczogIiArIGVudW1lcmFibGVQcm9wZXJ0aWVzLmpvaW4oIiwgIikgKyAiOyB0aHVzIGJyZWFraW5nIGUuZy4gYGZvci4uLmluYCBpdGVyYXRpb24gb2YgYEFycmF5YHMuIik7CiAgICB9CiAgICBjb25zdCB3b3JrZXJIYW5kbGVyTmFtZSA9IGRvY0lkICsgIl93b3JrZXIiOwogICAgbGV0IGhhbmRsZXIgPSBuZXcgX21lc3NhZ2VfaGFuZGxlci5NZXNzYWdlSGFuZGxlcih3b3JrZXJIYW5kbGVyTmFtZSwgZG9jSWQsIHBvcnQpOwogICAgZnVuY3Rpb24gZW5zdXJlTm90VGVybWluYXRlZCgpIHsKICAgICAgaWYgKHRlcm1pbmF0ZWQpIHsKICAgICAgICB0aHJvdyBuZXcgRXJyb3IoIldvcmtlciB3YXMgdGVybWluYXRlZCIpOwogICAgICB9CiAgICB9CiAgICBmdW5jdGlvbiBzdGFydFdvcmtlclRhc2sodGFzaykgewogICAgICBXb3JrZXJUYXNrcy5hZGQodGFzayk7CiAgICB9CiAgICBmdW5jdGlvbiBmaW5pc2hXb3JrZXJUYXNrKHRhc2spIHsKICAgICAgdGFzay5maW5pc2goKTsKICAgICAgV29ya2VyVGFza3MuZGVsZXRlKHRhc2spOwogICAgfQogICAgYXN5bmMgZnVuY3Rpb24gbG9hZERvY3VtZW50KHJlY292ZXJ5TW9kZSkgewogICAgICBhd2FpdCBwZGZNYW5hZ2VyLmVuc3VyZURvYygiY2hlY2tIZWFkZXIiKTsKICAgICAgYXdhaXQgcGRmTWFuYWdlci5lbnN1cmVEb2MoInBhcnNlU3RhcnRYUmVmIik7CiAgICAgIGF3YWl0IHBkZk1hbmFnZXIuZW5zdXJlRG9jKCJwYXJzZSIsIFtyZWNvdmVyeU1vZGVdKTsKICAgICAgYXdhaXQgcGRmTWFuYWdlci5lbnN1cmVEb2MoImNoZWNrRmlyc3RQYWdlIiwgW3JlY292ZXJ5TW9kZV0pOwogICAgICBhd2FpdCBwZGZNYW5hZ2VyLmVuc3VyZURvYygiY2hlY2tMYXN0UGFnZSIsIFtyZWNvdmVyeU1vZGVdKTsKICAgICAgY29uc3QgaXNQdXJlWGZhID0gYXdhaXQgcGRmTWFuYWdlci5lbnN1cmVEb2MoImlzUHVyZVhmYSIpOwogICAgICBpZiAoaXNQdXJlWGZhKSB7CiAgICAgICAgY29uc3QgdGFzayA9IG5ldyBXb3JrZXJUYXNrKCJsb2FkWGZhRm9udHMiKTsKICAgICAgICBzdGFydFdvcmtlclRhc2sodGFzayk7CiAgICAgICAgYXdhaXQgUHJvbWlzZS5hbGwoW3BkZk1hbmFnZXIubG9hZFhmYUZvbnRzKGhhbmRsZXIsIHRhc2spLmNhdGNoKHJlYXNvbiA9PiB7fSkudGhlbigoKSA9PiBmaW5pc2hXb3JrZXJUYXNrKHRhc2spKSwgcGRmTWFuYWdlci5sb2FkWGZhSW1hZ2VzKCldKTsKICAgICAgfQogICAgICBjb25zdCBbbnVtUGFnZXMsIGZpbmdlcnByaW50c10gPSBhd2FpdCBQcm9taXNlLmFsbChbcGRmTWFuYWdlci5lbnN1cmVEb2MoIm51bVBhZ2VzIiksIHBkZk1hbmFnZXIuZW5zdXJlRG9jKCJmaW5nZXJwcmludHMiKV0pOwogICAgICBjb25zdCBodG1sRm9yWGZhID0gaXNQdXJlWGZhID8gYXdhaXQgcGRmTWFuYWdlci5lbnN1cmVEb2MoImh0bWxGb3JYZmEiKSA6IG51bGw7CiAgICAgIHJldHVybiB7CiAgICAgICAgbnVtUGFnZXMsCiAgICAgICAgZmluZ2VycHJpbnRzLAogICAgICAgIGh0bWxGb3JYZmEKICAgICAgfTsKICAgIH0KICAgIGZ1bmN0aW9uIGdldFBkZk1hbmFnZXIoewogICAgICBkYXRhLAogICAgICBwYXNzd29yZCwKICAgICAgZGlzYWJsZUF1dG9GZXRjaCwKICAgICAgcmFuZ2VDaHVua1NpemUsCiAgICAgIGxlbmd0aCwKICAgICAgZG9jQmFzZVVybCwKICAgICAgZW5hYmxlWGZhLAogICAgICBldmFsdWF0b3JPcHRpb25zCiAgICB9KSB7CiAgICAgIGNvbnN0IHBkZk1hbmFnZXJBcmdzID0gewogICAgICAgIHNvdXJjZTogbnVsbCwKICAgICAgICBkaXNhYmxlQXV0b0ZldGNoLAogICAgICAgIGRvY0Jhc2VVcmwsCiAgICAgICAgZG9jSWQsCiAgICAgICAgZW5hYmxlWGZhLAogICAgICAgIGV2YWx1YXRvck9wdGlvbnMsCiAgICAgICAgaGFuZGxlciwKICAgICAgICBsZW5ndGgsCiAgICAgICAgcGFzc3dvcmQsCiAgICAgICAgcmFuZ2VDaHVua1NpemUKICAgICAgfTsKICAgICAgY29uc3QgcGRmTWFuYWdlckNhcGFiaWxpdHkgPSBuZXcgX3V0aWwuUHJvbWlzZUNhcGFiaWxpdHkoKTsKICAgICAgbGV0IG5ld1BkZk1hbmFnZXI7CiAgICAgIGlmIChkYXRhKSB7CiAgICAgICAgdHJ5IHsKICAgICAgICAgIHBkZk1hbmFnZXJBcmdzLnNvdXJjZSA9IGRhdGE7CiAgICAgICAgICBuZXdQZGZNYW5hZ2VyID0gbmV3IF9wZGZfbWFuYWdlci5Mb2NhbFBkZk1hbmFnZXIocGRmTWFuYWdlckFyZ3MpOwogICAgICAgICAgcGRmTWFuYWdlckNhcGFiaWxpdHkucmVzb2x2ZShuZXdQZGZNYW5hZ2VyKTsKICAgICAgICB9IGNhdGNoIChleCkgewogICAgICAgICAgcGRmTWFuYWdlckNhcGFiaWxpdHkucmVqZWN0KGV4KTsKICAgICAgICB9CiAgICAgICAgcmV0dXJuIHBkZk1hbmFnZXJDYXBhYmlsaXR5LnByb21pc2U7CiAgICAgIH0KICAgICAgbGV0IHBkZlN0cmVhbSwKICAgICAgICBjYWNoZWRDaHVua3MgPSBbXTsKICAgICAgdHJ5IHsKICAgICAgICBwZGZTdHJlYW0gPSBuZXcgX3dvcmtlcl9zdHJlYW0uUERGV29ya2VyU3RyZWFtKGhhbmRsZXIpOwogICAgICB9IGNhdGNoIChleCkgewogICAgICAgIHBkZk1hbmFnZXJDYXBhYmlsaXR5LnJlamVjdChleCk7CiAgICAgICAgcmV0dXJuIHBkZk1hbmFnZXJDYXBhYmlsaXR5LnByb21pc2U7CiAgICAgIH0KICAgICAgY29uc3QgZnVsbFJlcXVlc3QgPSBwZGZTdHJlYW0uZ2V0RnVsbFJlYWRlcigpOwogICAgICBmdWxsUmVxdWVzdC5oZWFkZXJzUmVhZHkudGhlbihmdW5jdGlvbiAoKSB7CiAgICAgICAgaWYgKCFmdWxsUmVxdWVzdC5pc1JhbmdlU3VwcG9ydGVkKSB7CiAgICAgICAgICByZXR1cm47CiAgICAgICAgfQogICAgICAgIHBkZk1hbmFnZXJBcmdzLnNvdXJjZSA9IHBkZlN0cmVhbTsKICAgICAgICBwZGZNYW5hZ2VyQXJncy5sZW5ndGggPSBmdWxsUmVxdWVzdC5jb250ZW50TGVuZ3RoOwogICAgICAgIHBkZk1hbmFnZXJBcmdzLmRpc2FibGVBdXRvRmV0Y2ggfHw9IGZ1bGxSZXF1ZXN0LmlzU3RyZWFtaW5nU3VwcG9ydGVkOwogICAgICAgIG5ld1BkZk1hbmFnZXIgPSBuZXcgX3BkZl9tYW5hZ2VyLk5ldHdvcmtQZGZNYW5hZ2VyKHBkZk1hbmFnZXJBcmdzKTsKICAgICAgICBmb3IgKGNvbnN0IGNodW5rIG9mIGNhY2hlZENodW5rcykgewogICAgICAgICAgbmV3UGRmTWFuYWdlci5zZW5kUHJvZ3Jlc3NpdmVEYXRhKGNodW5rKTsKICAgICAgICB9CiAgICAgICAgY2FjaGVkQ2h1bmtzID0gW107CiAgICAgICAgcGRmTWFuYWdlckNhcGFiaWxpdHkucmVzb2x2ZShuZXdQZGZNYW5hZ2VyKTsKICAgICAgICBjYW5jZWxYSFJzID0gbnVsbDsKICAgICAgfSkuY2F0Y2goZnVuY3Rpb24gKHJlYXNvbikgewogICAgICAgIHBkZk1hbmFnZXJDYXBhYmlsaXR5LnJlamVjdChyZWFzb24pOwogICAgICAgIGNhbmNlbFhIUnMgPSBudWxsOwogICAgICB9KTsKICAgICAgbGV0IGxvYWRlZCA9IDA7CiAgICAgIGNvbnN0IGZsdXNoQ2h1bmtzID0gZnVuY3Rpb24gKCkgewogICAgICAgIGNvbnN0IHBkZkZpbGUgPSAoMCwgX2NvcmVfdXRpbHMuYXJyYXlCdWZmZXJzVG9CeXRlcykoY2FjaGVkQ2h1bmtzKTsKICAgICAgICBpZiAobGVuZ3RoICYmIHBkZkZpbGUubGVuZ3RoICE9PSBsZW5ndGgpIHsKICAgICAgICAgICgwLCBfdXRpbC53YXJuKSgicmVwb3J0ZWQgSFRUUCBsZW5ndGggaXMgZGlmZmVyZW50IGZyb20gYWN0dWFsIik7CiAgICAgICAgfQogICAgICAgIHRyeSB7CiAgICAgICAgICBwZGZNYW5hZ2VyQXJncy5zb3VyY2UgPSBwZGZGaWxlOwogICAgICAgICAgbmV3UGRmTWFuYWdlciA9IG5ldyBfcGRmX21hbmFnZXIuTG9jYWxQZGZNYW5hZ2VyKHBkZk1hbmFnZXJBcmdzKTsKICAgICAgICAgIHBkZk1hbmFnZXJDYXBhYmlsaXR5LnJlc29sdmUobmV3UGRmTWFuYWdlcik7CiAgICAgICAgfSBjYXRjaCAoZXgpIHsKICAgICAgICAgIHBkZk1hbmFnZXJDYXBhYmlsaXR5LnJlamVjdChleCk7CiAgICAgICAgfQogICAgICAgIGNhY2hlZENodW5rcyA9IFtdOwogICAgICB9OwogICAgICBuZXcgUHJvbWlzZShmdW5jdGlvbiAocmVzb2x2ZSwgcmVqZWN0KSB7CiAgICAgICAgY29uc3QgcmVhZENodW5rID0gZnVuY3Rpb24gKHsKICAgICAgICAgIHZhbHVlLAogICAgICAgICAgZG9uZQogICAgICAgIH0pIHsKICAgICAgICAgIHRyeSB7CiAgICAgICAgICAgIGVuc3VyZU5vdFRlcm1pbmF0ZWQoKTsKICAgICAgICAgICAgaWYgKGRvbmUpIHsKICAgICAgICAgICAgICBpZiAoIW5ld1BkZk1hbmFnZXIpIHsKICAgICAgICAgICAgICAgIGZsdXNoQ2h1bmtzKCk7CiAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIGNhbmNlbFhIUnMgPSBudWxsOwogICAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgICAgfQogICAgICAgICAgICBsb2FkZWQgKz0gdmFsdWUuYnl0ZUxlbmd0aDsKICAgICAgICAgICAgaWYgKCFmdWxsUmVxdWVzdC5pc1N0cmVhbWluZ1N1cHBvcnRlZCkgewogICAgICAgICAgICAgIGhhbmRsZXIuc2VuZCgiRG9jUHJvZ3Jlc3MiLCB7CiAgICAgICAgICAgICAgICBsb2FkZWQsCiAgICAgICAgICAgICAgICB0b3RhbDogTWF0aC5tYXgobG9hZGVkLCBmdWxsUmVxdWVzdC5jb250ZW50TGVuZ3RoIHx8IDApCiAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgaWYgKG5ld1BkZk1hbmFnZXIpIHsKICAgICAgICAgICAgICBuZXdQZGZNYW5hZ2VyLnNlbmRQcm9ncmVzc2l2ZURhdGEodmFsdWUpOwogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgIGNhY2hlZENodW5rcy5wdXNoKHZhbHVlKTsKICAgICAgICAgICAgfQogICAgICAgICAgICBmdWxsUmVxdWVzdC5yZWFkKCkudGhlbihyZWFkQ2h1bmssIHJlamVjdCk7CiAgICAgICAgICB9IGNhdGNoIChlKSB7CiAgICAgICAgICAgIHJlamVjdChlKTsKICAgICAgICAgIH0KICAgICAgICB9OwogICAgICAgIGZ1bGxSZXF1ZXN0LnJlYWQoKS50aGVuKHJlYWRDaHVuaywgcmVqZWN0KTsKICAgICAgfSkuY2F0Y2goZnVuY3Rpb24gKGUpIHsKICAgICAgICBwZGZNYW5hZ2VyQ2FwYWJpbGl0eS5yZWplY3QoZSk7CiAgICAgICAgY2FuY2VsWEhScyA9IG51bGw7CiAgICAgIH0pOwogICAgICBjYW5jZWxYSFJzID0gZnVuY3Rpb24gKHJlYXNvbikgewogICAgICAgIHBkZlN0cmVhbS5jYW5jZWxBbGxSZXF1ZXN0cyhyZWFzb24pOwogICAgICB9OwogICAgICByZXR1cm4gcGRmTWFuYWdlckNhcGFiaWxpdHkucHJvbWlzZTsKICAgIH0KICAgIGZ1bmN0aW9uIHNldHVwRG9jKGRhdGEpIHsKICAgICAgZnVuY3Rpb24gb25TdWNjZXNzKGRvYykgewogICAgICAgIGVuc3VyZU5vdFRlcm1pbmF0ZWQoKTsKICAgICAgICBoYW5kbGVyLnNlbmQoIkdldERvYyIsIHsKICAgICAgICAgIHBkZkluZm86IGRvYwogICAgICAgIH0pOwogICAgICB9CiAgICAgIGZ1bmN0aW9uIG9uRmFpbHVyZShleCkgewogICAgICAgIGVuc3VyZU5vdFRlcm1pbmF0ZWQoKTsKICAgICAgICBpZiAoZXggaW5zdGFuY2VvZiBfdXRpbC5QYXNzd29yZEV4Y2VwdGlvbikgewogICAgICAgICAgY29uc3QgdGFzayA9IG5ldyBXb3JrZXJUYXNrKGBQYXNzd29yZEV4Y2VwdGlvbjogcmVzcG9uc2UgJHtleC5jb2RlfWApOwogICAgICAgICAgc3RhcnRXb3JrZXJUYXNrKHRhc2spOwogICAgICAgICAgaGFuZGxlci5zZW5kV2l0aFByb21pc2UoIlBhc3N3b3JkUmVxdWVzdCIsIGV4KS50aGVuKGZ1bmN0aW9uICh7CiAgICAgICAgICAgIHBhc3N3b3JkCiAgICAgICAgICB9KSB7CiAgICAgICAgICAgIGZpbmlzaFdvcmtlclRhc2sodGFzayk7CiAgICAgICAgICAgIHBkZk1hbmFnZXIudXBkYXRlUGFzc3dvcmQocGFzc3dvcmQpOwogICAgICAgICAgICBwZGZNYW5hZ2VyUmVhZHkoKTsKICAgICAgICAgIH0pLmNhdGNoKGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgZmluaXNoV29ya2VyVGFzayh0YXNrKTsKICAgICAgICAgICAgaGFuZGxlci5zZW5kKCJEb2NFeGNlcHRpb24iLCBleCk7CiAgICAgICAgICB9KTsKICAgICAgICB9IGVsc2UgaWYgKGV4IGluc3RhbmNlb2YgX3V0aWwuSW52YWxpZFBERkV4Y2VwdGlvbiB8fCBleCBpbnN0YW5jZW9mIF91dGlsLk1pc3NpbmdQREZFeGNlcHRpb24gfHwgZXggaW5zdGFuY2VvZiBfdXRpbC5VbmV4cGVjdGVkUmVzcG9uc2VFeGNlcHRpb24gfHwgZXggaW5zdGFuY2VvZiBfdXRpbC5Vbmtub3duRXJyb3JFeGNlcHRpb24pIHsKICAgICAgICAgIGhhbmRsZXIuc2VuZCgiRG9jRXhjZXB0aW9uIiwgZXgpOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICBoYW5kbGVyLnNlbmQoIkRvY0V4Y2VwdGlvbiIsIG5ldyBfdXRpbC5Vbmtub3duRXJyb3JFeGNlcHRpb24oZXgubWVzc2FnZSwgZXgudG9TdHJpbmcoKSkpOwogICAgICAgIH0KICAgICAgfQogICAgICBmdW5jdGlvbiBwZGZNYW5hZ2VyUmVhZHkoKSB7CiAgICAgICAgZW5zdXJlTm90VGVybWluYXRlZCgpOwogICAgICAgIGxvYWREb2N1bWVudChmYWxzZSkudGhlbihvblN1Y2Nlc3MsIGZ1bmN0aW9uIChyZWFzb24pIHsKICAgICAgICAgIGVuc3VyZU5vdFRlcm1pbmF0ZWQoKTsKICAgICAgICAgIGlmICghKHJlYXNvbiBpbnN0YW5jZW9mIF9jb3JlX3V0aWxzLlhSZWZQYXJzZUV4Y2VwdGlvbikpIHsKICAgICAgICAgICAgb25GYWlsdXJlKHJlYXNvbik7CiAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgIH0KICAgICAgICAgIHBkZk1hbmFnZXIucmVxdWVzdExvYWRlZFN0cmVhbSgpLnRoZW4oZnVuY3Rpb24gKCkgewogICAgICAgICAgICBlbnN1cmVOb3RUZXJtaW5hdGVkKCk7CiAgICAgICAgICAgIGxvYWREb2N1bWVudCh0cnVlKS50aGVuKG9uU3VjY2Vzcywgb25GYWlsdXJlKTsKICAgICAgICAgIH0pOwogICAgICAgIH0pOwogICAgICB9CiAgICAgIGVuc3VyZU5vdFRlcm1pbmF0ZWQoKTsKICAgICAgZ2V0UGRmTWFuYWdlcihkYXRhKS50aGVuKGZ1bmN0aW9uIChuZXdQZGZNYW5hZ2VyKSB7CiAgICAgICAgaWYgKHRlcm1pbmF0ZWQpIHsKICAgICAgICAgIG5ld1BkZk1hbmFnZXIudGVybWluYXRlKG5ldyBfdXRpbC5BYm9ydEV4Y2VwdGlvbigiV29ya2VyIHdhcyB0ZXJtaW5hdGVkLiIpKTsKICAgICAgICAgIHRocm93IG5ldyBFcnJvcigiV29ya2VyIHdhcyB0ZXJtaW5hdGVkIik7CiAgICAgICAgfQogICAgICAgIHBkZk1hbmFnZXIgPSBuZXdQZGZNYW5hZ2VyOwogICAgICAgIHBkZk1hbmFnZXIucmVxdWVzdExvYWRlZFN0cmVhbSh0cnVlKS50aGVuKHN0cmVhbSA9PiB7CiAgICAgICAgICBoYW5kbGVyLnNlbmQoIkRhdGFMb2FkZWQiLCB7CiAgICAgICAgICAgIGxlbmd0aDogc3RyZWFtLmJ5dGVzLmJ5dGVMZW5ndGgKICAgICAgICAgIH0pOwogICAgICAgIH0pOwogICAgICB9KS50aGVuKHBkZk1hbmFnZXJSZWFkeSwgb25GYWlsdXJlKTsKICAgIH0KICAgIGhhbmRsZXIub24oIkdldFBhZ2UiLCBmdW5jdGlvbiAoZGF0YSkgewogICAgICByZXR1cm4gcGRmTWFuYWdlci5nZXRQYWdlKGRhdGEucGFnZUluZGV4KS50aGVuKGZ1bmN0aW9uIChwYWdlKSB7CiAgICAgICAgcmV0dXJuIFByb21pc2UuYWxsKFtwZGZNYW5hZ2VyLmVuc3VyZShwYWdlLCAicm90YXRlIiksIHBkZk1hbmFnZXIuZW5zdXJlKHBhZ2UsICJyZWYiKSwgcGRmTWFuYWdlci5lbnN1cmUocGFnZSwgInVzZXJVbml0IiksIHBkZk1hbmFnZXIuZW5zdXJlKHBhZ2UsICJ2aWV3IildKS50aGVuKGZ1bmN0aW9uIChbcm90YXRlLCByZWYsIHVzZXJVbml0LCB2aWV3XSkgewogICAgICAgICAgcmV0dXJuIHsKICAgICAgICAgICAgcm90YXRlLAogICAgICAgICAgICByZWYsCiAgICAgICAgICAgIHVzZXJVbml0LAogICAgICAgICAgICB2aWV3CiAgICAgICAgICB9OwogICAgICAgIH0pOwogICAgICB9KTsKICAgIH0pOwogICAgaGFuZGxlci5vbigiR2V0UGFnZUluZGV4IiwgZnVuY3Rpb24gKGRhdGEpIHsKICAgICAgY29uc3QgcGFnZVJlZiA9IF9wcmltaXRpdmVzLlJlZi5nZXQoZGF0YS5udW0sIGRhdGEuZ2VuKTsKICAgICAgcmV0dXJuIHBkZk1hbmFnZXIuZW5zdXJlQ2F0YWxvZygiZ2V0UGFnZUluZGV4IiwgW3BhZ2VSZWZdKTsKICAgIH0pOwogICAgaGFuZGxlci5vbigiR2V0RGVzdGluYXRpb25zIiwgZnVuY3Rpb24gKGRhdGEpIHsKICAgICAgcmV0dXJuIHBkZk1hbmFnZXIuZW5zdXJlQ2F0YWxvZygiZGVzdGluYXRpb25zIik7CiAgICB9KTsKICAgIGhhbmRsZXIub24oIkdldERlc3RpbmF0aW9uIiwgZnVuY3Rpb24gKGRhdGEpIHsKICAgICAgcmV0dXJuIHBkZk1hbmFnZXIuZW5zdXJlQ2F0YWxvZygiZ2V0RGVzdGluYXRpb24iLCBbZGF0YS5pZF0pOwogICAgfSk7CiAgICBoYW5kbGVyLm9uKCJHZXRQYWdlTGFiZWxzIiwgZnVuY3Rpb24gKGRhdGEpIHsKICAgICAgcmV0dXJuIHBkZk1hbmFnZXIuZW5zdXJlQ2F0YWxvZygicGFnZUxhYmVscyIpOwogICAgfSk7CiAgICBoYW5kbGVyLm9uKCJHZXRQYWdlTGF5b3V0IiwgZnVuY3Rpb24gKGRhdGEpIHsKICAgICAgcmV0dXJuIHBkZk1hbmFnZXIuZW5zdXJlQ2F0YWxvZygicGFnZUxheW91dCIpOwogICAgfSk7CiAgICBoYW5kbGVyLm9uKCJHZXRQYWdlTW9kZSIsIGZ1bmN0aW9uIChkYXRhKSB7CiAgICAgIHJldHVybiBwZGZNYW5hZ2VyLmVuc3VyZUNhdGFsb2coInBhZ2VNb2RlIik7CiAgICB9KTsKICAgIGhhbmRsZXIub24oIkdldFZpZXdlclByZWZlcmVuY2VzIiwgZnVuY3Rpb24gKGRhdGEpIHsKICAgICAgcmV0dXJuIHBkZk1hbmFnZXIuZW5zdXJlQ2F0YWxvZygidmlld2VyUHJlZmVyZW5jZXMiKTsKICAgIH0pOwogICAgaGFuZGxlci5vbigiR2V0T3BlbkFjdGlvbiIsIGZ1bmN0aW9uIChkYXRhKSB7CiAgICAgIHJldHVybiBwZGZNYW5hZ2VyLmVuc3VyZUNhdGFsb2coIm9wZW5BY3Rpb24iKTsKICAgIH0pOwogICAgaGFuZGxlci5vbigiR2V0QXR0YWNobWVudHMiLCBmdW5jdGlvbiAoZGF0YSkgewogICAgICByZXR1cm4gcGRmTWFuYWdlci5lbnN1cmVDYXRhbG9nKCJhdHRhY2htZW50cyIpOwogICAgfSk7CiAgICBoYW5kbGVyLm9uKCJHZXREb2NKU0FjdGlvbnMiLCBmdW5jdGlvbiAoZGF0YSkgewogICAgICByZXR1cm4gcGRmTWFuYWdlci5lbnN1cmVDYXRhbG9nKCJqc0FjdGlvbnMiKTsKICAgIH0pOwogICAgaGFuZGxlci5vbigiR2V0UGFnZUpTQWN0aW9ucyIsIGZ1bmN0aW9uICh7CiAgICAgIHBhZ2VJbmRleAogICAgfSkgewogICAgICByZXR1cm4gcGRmTWFuYWdlci5nZXRQYWdlKHBhZ2VJbmRleCkudGhlbihmdW5jdGlvbiAocGFnZSkgewogICAgICAgIHJldHVybiBwZGZNYW5hZ2VyLmVuc3VyZShwYWdlLCAianNBY3Rpb25zIik7CiAgICAgIH0pOwogICAgfSk7CiAgICBoYW5kbGVyLm9uKCJHZXRPdXRsaW5lIiwgZnVuY3Rpb24gKGRhdGEpIHsKICAgICAgcmV0dXJuIHBkZk1hbmFnZXIuZW5zdXJlQ2F0YWxvZygiZG9jdW1lbnRPdXRsaW5lIik7CiAgICB9KTsKICAgIGhhbmRsZXIub24oIkdldE9wdGlvbmFsQ29udGVudENvbmZpZyIsIGZ1bmN0aW9uIChkYXRhKSB7CiAgICAgIHJldHVybiBwZGZNYW5hZ2VyLmVuc3VyZUNhdGFsb2coIm9wdGlvbmFsQ29udGVudENvbmZpZyIpOwogICAgfSk7CiAgICBoYW5kbGVyLm9uKCJHZXRQZXJtaXNzaW9ucyIsIGZ1bmN0aW9uIChkYXRhKSB7CiAgICAgIHJldHVybiBwZGZNYW5hZ2VyLmVuc3VyZUNhdGFsb2coInBlcm1pc3Npb25zIik7CiAgICB9KTsKICAgIGhhbmRsZXIub24oIkdldE1ldGFkYXRhIiwgZnVuY3Rpb24gKGRhdGEpIHsKICAgICAgcmV0dXJuIFByb21pc2UuYWxsKFtwZGZNYW5hZ2VyLmVuc3VyZURvYygiZG9jdW1lbnRJbmZvIiksIHBkZk1hbmFnZXIuZW5zdXJlQ2F0YWxvZygibWV0YWRhdGEiKV0pOwogICAgfSk7CiAgICBoYW5kbGVyLm9uKCJHZXRNYXJrSW5mbyIsIGZ1bmN0aW9uIChkYXRhKSB7CiAgICAgIHJldHVybiBwZGZNYW5hZ2VyLmVuc3VyZUNhdGFsb2coIm1hcmtJbmZvIik7CiAgICB9KTsKICAgIGhhbmRsZXIub24oIkdldERhdGEiLCBmdW5jdGlvbiAoZGF0YSkgewogICAgICByZXR1cm4gcGRmTWFuYWdlci5yZXF1ZXN0TG9hZGVkU3RyZWFtKCkudGhlbihmdW5jdGlvbiAoc3RyZWFtKSB7CiAgICAgICAgcmV0dXJuIHN0cmVhbS5ieXRlczsKICAgICAgfSk7CiAgICB9KTsKICAgIGhhbmRsZXIub24oIkdldEFubm90YXRpb25zIiwgZnVuY3Rpb24gKHsKICAgICAgcGFnZUluZGV4LAogICAgICBpbnRlbnQKICAgIH0pIHsKICAgICAgcmV0dXJuIHBkZk1hbmFnZXIuZ2V0UGFnZShwYWdlSW5kZXgpLnRoZW4oZnVuY3Rpb24gKHBhZ2UpIHsKICAgICAgICBjb25zdCB0YXNrID0gbmV3IFdvcmtlclRhc2soYEdldEFubm90YXRpb25zOiBwYWdlICR7cGFnZUluZGV4fWApOwogICAgICAgIHN0YXJ0V29ya2VyVGFzayh0YXNrKTsKICAgICAgICByZXR1cm4gcGFnZS5nZXRBbm5vdGF0aW9uc0RhdGEoaGFuZGxlciwgdGFzaywgaW50ZW50KS50aGVuKGRhdGEgPT4gewogICAgICAgICAgZmluaXNoV29ya2VyVGFzayh0YXNrKTsKICAgICAgICAgIHJldHVybiBkYXRhOwogICAgICAgIH0sIHJlYXNvbiA9PiB7CiAgICAgICAgICBmaW5pc2hXb3JrZXJUYXNrKHRhc2spOwogICAgICAgICAgdGhyb3cgcmVhc29uOwogICAgICAgIH0pOwogICAgICB9KTsKICAgIH0pOwogICAgaGFuZGxlci5vbigiR2V0RmllbGRPYmplY3RzIiwgZnVuY3Rpb24gKGRhdGEpIHsKICAgICAgcmV0dXJuIHBkZk1hbmFnZXIuZW5zdXJlRG9jKCJmaWVsZE9iamVjdHMiKTsKICAgIH0pOwogICAgaGFuZGxlci5vbigiSGFzSlNBY3Rpb25zIiwgZnVuY3Rpb24gKGRhdGEpIHsKICAgICAgcmV0dXJuIHBkZk1hbmFnZXIuZW5zdXJlRG9jKCJoYXNKU0FjdGlvbnMiKTsKICAgIH0pOwogICAgaGFuZGxlci5vbigiR2V0Q2FsY3VsYXRpb25PcmRlcklkcyIsIGZ1bmN0aW9uIChkYXRhKSB7CiAgICAgIHJldHVybiBwZGZNYW5hZ2VyLmVuc3VyZURvYygiY2FsY3VsYXRpb25PcmRlcklkcyIpOwogICAgfSk7CiAgICBoYW5kbGVyLm9uKCJTYXZlRG9jdW1lbnQiLCBhc3luYyBmdW5jdGlvbiAoewogICAgICBpc1B1cmVYZmEsCiAgICAgIG51bVBhZ2VzLAogICAgICBhbm5vdGF0aW9uU3RvcmFnZSwKICAgICAgZmlsZW5hbWUKICAgIH0pIHsKICAgICAgY29uc3QgZ2xvYmFsUHJvbWlzZXMgPSBbcGRmTWFuYWdlci5yZXF1ZXN0TG9hZGVkU3RyZWFtKCksIHBkZk1hbmFnZXIuZW5zdXJlQ2F0YWxvZygiYWNyb0Zvcm0iKSwgcGRmTWFuYWdlci5lbnN1cmVDYXRhbG9nKCJhY3JvRm9ybVJlZiIpLCBwZGZNYW5hZ2VyLmVuc3VyZURvYygic3RhcnRYUmVmIiksIHBkZk1hbmFnZXIuZW5zdXJlRG9jKCJ4cmVmIiksIHBkZk1hbmFnZXIuZW5zdXJlRG9jKCJsaW5lYXJpemF0aW9uIiksIHBkZk1hbmFnZXIuZW5zdXJlQ2F0YWxvZygic3RydWN0VHJlZVJvb3QiKV07CiAgICAgIGNvbnN0IHByb21pc2VzID0gW107CiAgICAgIGNvbnN0IG5ld0Fubm90YXRpb25zQnlQYWdlID0gIWlzUHVyZVhmYSA/ICgwLCBfY29yZV91dGlscy5nZXROZXdBbm5vdGF0aW9uc01hcCkoYW5ub3RhdGlvblN0b3JhZ2UpIDogbnVsbDsKICAgICAgY29uc3QgW3N0cmVhbSwgYWNyb0Zvcm0sIGFjcm9Gb3JtUmVmLCBzdGFydFhSZWYsIHhyZWYsIGxpbmVhcml6YXRpb24sIF9zdHJ1Y3RUcmVlUm9vdF0gPSBhd2FpdCBQcm9taXNlLmFsbChnbG9iYWxQcm9taXNlcyk7CiAgICAgIGNvbnN0IGNhdGFsb2dSZWYgPSB4cmVmLnRyYWlsZXIuZ2V0UmF3KCJSb290IikgfHwgbnVsbDsKICAgICAgbGV0IHN0cnVjdFRyZWVSb290OwogICAgICBpZiAobmV3QW5ub3RhdGlvbnNCeVBhZ2UpIHsKICAgICAgICBpZiAoIV9zdHJ1Y3RUcmVlUm9vdCkgewogICAgICAgICAgaWYgKGF3YWl0IF9zdHJ1Y3RfdHJlZS5TdHJ1Y3RUcmVlUm9vdC5jYW5DcmVhdGVTdHJ1Y3R1cmVUcmVlKHsKICAgICAgICAgICAgY2F0YWxvZ1JlZiwKICAgICAgICAgICAgcGRmTWFuYWdlciwKICAgICAgICAgICAgbmV3QW5ub3RhdGlvbnNCeVBhZ2UKICAgICAgICAgIH0pKSB7CiAgICAgICAgICAgIHN0cnVjdFRyZWVSb290ID0gbnVsbDsKICAgICAgICAgIH0KICAgICAgICB9IGVsc2UgaWYgKGF3YWl0IF9zdHJ1Y3RUcmVlUm9vdC5jYW5VcGRhdGVTdHJ1Y3RUcmVlKHsKICAgICAgICAgIHBkZk1hbmFnZXIsCiAgICAgICAgICBuZXdBbm5vdGF0aW9uc0J5UGFnZQogICAgICAgIH0pKSB7CiAgICAgICAgICBzdHJ1Y3RUcmVlUm9vdCA9IF9zdHJ1Y3RUcmVlUm9vdDsKICAgICAgICB9CiAgICAgICAgY29uc3QgaW1hZ2VQcm9taXNlcyA9IF9hbm5vdGF0aW9uLkFubm90YXRpb25GYWN0b3J5LmdlbmVyYXRlSW1hZ2VzKGFubm90YXRpb25TdG9yYWdlLnZhbHVlcygpLCB4cmVmLCBwZGZNYW5hZ2VyLmV2YWx1YXRvck9wdGlvbnMuaXNPZmZzY3JlZW5DYW52YXNTdXBwb3J0ZWQpOwogICAgICAgIGNvbnN0IG5ld0Fubm90YXRpb25Qcm9taXNlcyA9IHN0cnVjdFRyZWVSb290ID09PSB1bmRlZmluZWQgPyBwcm9taXNlcyA6IFtdOwogICAgICAgIGZvciAoY29uc3QgW3BhZ2VJbmRleCwgYW5ub3RhdGlvbnNdIG9mIG5ld0Fubm90YXRpb25zQnlQYWdlKSB7CiAgICAgICAgICBuZXdBbm5vdGF0aW9uUHJvbWlzZXMucHVzaChwZGZNYW5hZ2VyLmdldFBhZ2UocGFnZUluZGV4KS50aGVuKHBhZ2UgPT4gewogICAgICAgICAgICBjb25zdCB0YXNrID0gbmV3IFdvcmtlclRhc2soYFNhdmUgKGVkaXRvcik6IHBhZ2UgJHtwYWdlSW5kZXh9YCk7CiAgICAgICAgICAgIHJldHVybiBwYWdlLnNhdmVOZXdBbm5vdGF0aW9ucyhoYW5kbGVyLCB0YXNrLCBhbm5vdGF0aW9ucywgaW1hZ2VQcm9taXNlcykuZmluYWxseShmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgICAgZmluaXNoV29ya2VyVGFzayh0YXNrKTsKICAgICAgICAgICAgfSk7CiAgICAgICAgICB9KSk7CiAgICAgICAgfQogICAgICAgIGlmIChzdHJ1Y3RUcmVlUm9vdCA9PT0gbnVsbCkgewogICAgICAgICAgcHJvbWlzZXMucHVzaChQcm9taXNlLmFsbChuZXdBbm5vdGF0aW9uUHJvbWlzZXMpLnRoZW4oYXN5bmMgbmV3UmVmcyA9PiB7CiAgICAgICAgICAgIGF3YWl0IF9zdHJ1Y3RfdHJlZS5TdHJ1Y3RUcmVlUm9vdC5jcmVhdGVTdHJ1Y3R1cmVUcmVlKHsKICAgICAgICAgICAgICBuZXdBbm5vdGF0aW9uc0J5UGFnZSwKICAgICAgICAgICAgICB4cmVmLAogICAgICAgICAgICAgIGNhdGFsb2dSZWYsCiAgICAgICAgICAgICAgcGRmTWFuYWdlciwKICAgICAgICAgICAgICBuZXdSZWZzCiAgICAgICAgICAgIH0pOwogICAgICAgICAgICByZXR1cm4gbmV3UmVmczsKICAgICAgICAgIH0pKTsKICAgICAgICB9IGVsc2UgaWYgKHN0cnVjdFRyZWVSb290KSB7CiAgICAgICAgICBwcm9taXNlcy5wdXNoKFByb21pc2UuYWxsKG5ld0Fubm90YXRpb25Qcm9taXNlcykudGhlbihhc3luYyBuZXdSZWZzID0+IHsKICAgICAgICAgICAgYXdhaXQgc3RydWN0VHJlZVJvb3QudXBkYXRlU3RydWN0dXJlVHJlZSh7CiAgICAgICAgICAgICAgbmV3QW5ub3RhdGlvbnNCeVBhZ2UsCiAgICAgICAgICAgICAgcGRmTWFuYWdlciwKICAgICAgICAgICAgICBuZXdSZWZzCiAgICAgICAgICAgIH0pOwogICAgICAgICAgICByZXR1cm4gbmV3UmVmczsKICAgICAgICAgIH0pKTsKICAgICAgICB9CiAgICAgIH0KICAgICAgaWYgKGlzUHVyZVhmYSkgewogICAgICAgIHByb21pc2VzLnB1c2gocGRmTWFuYWdlci5zZXJpYWxpemVYZmFEYXRhKGFubm90YXRpb25TdG9yYWdlKSk7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgZm9yIChsZXQgcGFnZUluZGV4ID0gMDsgcGFnZUluZGV4IDwgbnVtUGFnZXM7IHBhZ2VJbmRleCsrKSB7CiAgICAgICAgICBwcm9taXNlcy5wdXNoKHBkZk1hbmFnZXIuZ2V0UGFnZShwYWdlSW5kZXgpLnRoZW4oZnVuY3Rpb24gKHBhZ2UpIHsKICAgICAgICAgICAgY29uc3QgdGFzayA9IG5ldyBXb3JrZXJUYXNrKGBTYXZlOiBwYWdlICR7cGFnZUluZGV4fWApOwogICAgICAgICAgICByZXR1cm4gcGFnZS5zYXZlKGhhbmRsZXIsIHRhc2ssIGFubm90YXRpb25TdG9yYWdlKS5maW5hbGx5KGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgICBmaW5pc2hXb3JrZXJUYXNrKHRhc2spOwogICAgICAgICAgICB9KTsKICAgICAgICAgIH0pKTsKICAgICAgICB9CiAgICAgIH0KICAgICAgY29uc3QgcmVmcyA9IGF3YWl0IFByb21pc2UuYWxsKHByb21pc2VzKTsKICAgICAgbGV0IG5ld1JlZnMgPSBbXTsKICAgICAgbGV0IHhmYURhdGEgPSBudWxsOwogICAgICBpZiAoaXNQdXJlWGZhKSB7CiAgICAgICAgeGZhRGF0YSA9IHJlZnNbMF07CiAgICAgICAgaWYgKCF4ZmFEYXRhKSB7CiAgICAgICAgICByZXR1cm4gc3RyZWFtLmJ5dGVzOwogICAgICAgIH0KICAgICAgfSBlbHNlIHsKICAgICAgICBuZXdSZWZzID0gcmVmcy5mbGF0KDIpOwogICAgICAgIGlmIChuZXdSZWZzLmxlbmd0aCA9PT0gMCkgewogICAgICAgICAgcmV0dXJuIHN0cmVhbS5ieXRlczsKICAgICAgICB9CiAgICAgIH0KICAgICAgY29uc3QgbmVlZEFwcGVhcmFuY2VzID0gYWNyb0Zvcm1SZWYgJiYgYWNyb0Zvcm0gaW5zdGFuY2VvZiBfcHJpbWl0aXZlcy5EaWN0ICYmIG5ld1JlZnMuc29tZShyZWYgPT4gcmVmLm5lZWRBcHBlYXJhbmNlcyk7CiAgICAgIGNvbnN0IHhmYSA9IGFjcm9Gb3JtIGluc3RhbmNlb2YgX3ByaW1pdGl2ZXMuRGljdCAmJiBhY3JvRm9ybS5nZXQoIlhGQSIpIHx8IG51bGw7CiAgICAgIGxldCB4ZmFEYXRhc2V0c1JlZiA9IG51bGw7CiAgICAgIGxldCBoYXNYZmFEYXRhc2V0c0VudHJ5ID0gZmFsc2U7CiAgICAgIGlmIChBcnJheS5pc0FycmF5KHhmYSkpIHsKICAgICAgICBmb3IgKGxldCBpID0gMCwgaWkgPSB4ZmEubGVuZ3RoOyBpIDwgaWk7IGkgKz0gMikgewogICAgICAgICAgaWYgKHhmYVtpXSA9PT0gImRhdGFzZXRzIikgewogICAgICAgICAgICB4ZmFEYXRhc2V0c1JlZiA9IHhmYVtpICsgMV07CiAgICAgICAgICAgIGhhc1hmYURhdGFzZXRzRW50cnkgPSB0cnVlOwogICAgICAgICAgfQogICAgICAgIH0KICAgICAgICBpZiAoeGZhRGF0YXNldHNSZWYgPT09IG51bGwpIHsKICAgICAgICAgIHhmYURhdGFzZXRzUmVmID0geHJlZi5nZXROZXdUZW1wb3JhcnlSZWYoKTsKICAgICAgICB9CiAgICAgIH0gZWxzZSBpZiAoeGZhKSB7CiAgICAgICAgKDAsIF91dGlsLndhcm4pKCJVbnN1cHBvcnRlZCBYRkEgdHlwZS4iKTsKICAgICAgfQogICAgICBsZXQgbmV3WHJlZkluZm8gPSBPYmplY3QuY3JlYXRlKG51bGwpOwogICAgICBpZiAoeHJlZi50cmFpbGVyKSB7CiAgICAgICAgY29uc3QgaW5mb09iaiA9IE9iamVjdC5jcmVhdGUobnVsbCk7CiAgICAgICAgY29uc3QgeHJlZkluZm8gPSB4cmVmLnRyYWlsZXIuZ2V0KCJJbmZvIikgfHwgbnVsbDsKICAgICAgICBpZiAoeHJlZkluZm8gaW5zdGFuY2VvZiBfcHJpbWl0aXZlcy5EaWN0KSB7CiAgICAgICAgICB4cmVmSW5mby5mb3JFYWNoKChrZXksIHZhbHVlKSA9PiB7CiAgICAgICAgICAgIGlmICh0eXBlb2YgdmFsdWUgPT09ICJzdHJpbmciKSB7CiAgICAgICAgICAgICAgaW5mb09ialtrZXldID0gKDAsIF91dGlsLnN0cmluZ1RvUERGU3RyaW5nKSh2YWx1ZSk7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0pOwogICAgICAgIH0KICAgICAgICBuZXdYcmVmSW5mbyA9IHsKICAgICAgICAgIHJvb3RSZWY6IGNhdGFsb2dSZWYsCiAgICAgICAgICBlbmNyeXB0UmVmOiB4cmVmLnRyYWlsZXIuZ2V0UmF3KCJFbmNyeXB0IikgfHwgbnVsbCwKICAgICAgICAgIG5ld1JlZjogeHJlZi5nZXROZXdUZW1wb3JhcnlSZWYoKSwKICAgICAgICAgIGluZm9SZWY6IHhyZWYudHJhaWxlci5nZXRSYXcoIkluZm8iKSB8fCBudWxsLAogICAgICAgICAgaW5mbzogaW5mb09iaiwKICAgICAgICAgIGZpbGVJZHM6IHhyZWYudHJhaWxlci5nZXQoIklEIikgfHwgbnVsbCwKICAgICAgICAgIHN0YXJ0WFJlZjogbGluZWFyaXphdGlvbiA/IHN0YXJ0WFJlZiA6IHhyZWYubGFzdFhSZWZTdHJlYW1Qb3MgPz8gc3RhcnRYUmVmLAogICAgICAgICAgZmlsZW5hbWUKICAgICAgICB9OwogICAgICB9CiAgICAgIHJldHVybiAoMCwgX3dyaXRlci5pbmNyZW1lbnRhbFVwZGF0ZSkoewogICAgICAgIG9yaWdpbmFsRGF0YTogc3RyZWFtLmJ5dGVzLAogICAgICAgIHhyZWZJbmZvOiBuZXdYcmVmSW5mbywKICAgICAgICBuZXdSZWZzLAogICAgICAgIHhyZWYsCiAgICAgICAgaGFzWGZhOiAhIXhmYSwKICAgICAgICB4ZmFEYXRhc2V0c1JlZiwKICAgICAgICBoYXNYZmFEYXRhc2V0c0VudHJ5LAogICAgICAgIG5lZWRBcHBlYXJhbmNlcywKICAgICAgICBhY3JvRm9ybVJlZiwKICAgICAgICBhY3JvRm9ybSwKICAgICAgICB4ZmFEYXRhCiAgICAgIH0pLmZpbmFsbHkoKCkgPT4gewogICAgICAgIHhyZWYucmVzZXROZXdUZW1wb3JhcnlSZWYoKTsKICAgICAgfSk7CiAgICB9KTsKICAgIGhhbmRsZXIub24oIkdldE9wZXJhdG9yTGlzdCIsIGZ1bmN0aW9uIChkYXRhLCBzaW5rKSB7CiAgICAgIGNvbnN0IHBhZ2VJbmRleCA9IGRhdGEucGFnZUluZGV4OwogICAgICBwZGZNYW5hZ2VyLmdldFBhZ2UocGFnZUluZGV4KS50aGVuKGZ1bmN0aW9uIChwYWdlKSB7CiAgICAgICAgY29uc3QgdGFzayA9IG5ldyBXb3JrZXJUYXNrKGBHZXRPcGVyYXRvckxpc3Q6IHBhZ2UgJHtwYWdlSW5kZXh9YCk7CiAgICAgICAgc3RhcnRXb3JrZXJUYXNrKHRhc2spOwogICAgICAgIGNvbnN0IHN0YXJ0ID0gdmVyYm9zaXR5ID49IF91dGlsLlZlcmJvc2l0eUxldmVsLklORk9TID8gRGF0ZS5ub3coKSA6IDA7CiAgICAgICAgcGFnZS5nZXRPcGVyYXRvckxpc3QoewogICAgICAgICAgaGFuZGxlciwKICAgICAgICAgIHNpbmssCiAgICAgICAgICB0YXNrLAogICAgICAgICAgaW50ZW50OiBkYXRhLmludGVudCwKICAgICAgICAgIGNhY2hlS2V5OiBkYXRhLmNhY2hlS2V5LAogICAgICAgICAgYW5ub3RhdGlvblN0b3JhZ2U6IGRhdGEuYW5ub3RhdGlvblN0b3JhZ2UKICAgICAgICB9KS50aGVuKGZ1bmN0aW9uIChvcGVyYXRvckxpc3RJbmZvKSB7CiAgICAgICAgICBmaW5pc2hXb3JrZXJUYXNrKHRhc2spOwogICAgICAgICAgaWYgKHN0YXJ0KSB7CiAgICAgICAgICAgICgwLCBfdXRpbC5pbmZvKShgcGFnZT0ke3BhZ2VJbmRleCArIDF9IC0gZ2V0T3BlcmF0b3JMaXN0OiB0aW1lPWAgKyBgJHtEYXRlLm5vdygpIC0gc3RhcnR9bXMsIGxlbj0ke29wZXJhdG9yTGlzdEluZm8ubGVuZ3RofWApOwogICAgICAgICAgfQogICAgICAgICAgc2luay5jbG9zZSgpOwogICAgICAgIH0sIGZ1bmN0aW9uIChyZWFzb24pIHsKICAgICAgICAgIGZpbmlzaFdvcmtlclRhc2sodGFzayk7CiAgICAgICAgICBpZiAodGFzay50ZXJtaW5hdGVkKSB7CiAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgIH0KICAgICAgICAgIHNpbmsuZXJyb3IocmVhc29uKTsKICAgICAgICB9KTsKICAgICAgfSk7CiAgICB9KTsKICAgIGhhbmRsZXIub24oIkdldFRleHRDb250ZW50IiwgZnVuY3Rpb24gKGRhdGEsIHNpbmspIHsKICAgICAgY29uc3QgewogICAgICAgIHBhZ2VJbmRleCwKICAgICAgICBpbmNsdWRlTWFya2VkQ29udGVudCwKICAgICAgICBkaXNhYmxlTm9ybWFsaXphdGlvbgogICAgICB9ID0gZGF0YTsKICAgICAgcGRmTWFuYWdlci5nZXRQYWdlKHBhZ2VJbmRleCkudGhlbihmdW5jdGlvbiAocGFnZSkgewogICAgICAgIGNvbnN0IHRhc2sgPSBuZXcgV29ya2VyVGFzaygiR2V0VGV4dENvbnRlbnQ6IHBhZ2UgIiArIHBhZ2VJbmRleCk7CiAgICAgICAgc3RhcnRXb3JrZXJUYXNrKHRhc2spOwogICAgICAgIGNvbnN0IHN0YXJ0ID0gdmVyYm9zaXR5ID49IF91dGlsLlZlcmJvc2l0eUxldmVsLklORk9TID8gRGF0ZS5ub3coKSA6IDA7CiAgICAgICAgcGFnZS5leHRyYWN0VGV4dENvbnRlbnQoewogICAgICAgICAgaGFuZGxlciwKICAgICAgICAgIHRhc2ssCiAgICAgICAgICBzaW5rLAogICAgICAgICAgaW5jbHVkZU1hcmtlZENvbnRlbnQsCiAgICAgICAgICBkaXNhYmxlTm9ybWFsaXphdGlvbgogICAgICAgIH0pLnRoZW4oZnVuY3Rpb24gKCkgewogICAgICAgICAgZmluaXNoV29ya2VyVGFzayh0YXNrKTsKICAgICAgICAgIGlmIChzdGFydCkgewogICAgICAgICAgICAoMCwgX3V0aWwuaW5mbykoYHBhZ2U9JHtwYWdlSW5kZXggKyAxfSAtIGdldFRleHRDb250ZW50OiB0aW1lPWAgKyBgJHtEYXRlLm5vdygpIC0gc3RhcnR9bXNgKTsKICAgICAgICAgIH0KICAgICAgICAgIHNpbmsuY2xvc2UoKTsKICAgICAgICB9LCBmdW5jdGlvbiAocmVhc29uKSB7CiAgICAgICAgICBmaW5pc2hXb3JrZXJUYXNrKHRhc2spOwogICAgICAgICAgaWYgKHRhc2sudGVybWluYXRlZCkgewogICAgICAgICAgICByZXR1cm47CiAgICAgICAgICB9CiAgICAgICAgICBzaW5rLmVycm9yKHJlYXNvbik7CiAgICAgICAgfSk7CiAgICAgIH0pOwogICAgfSk7CiAgICBoYW5kbGVyLm9uKCJHZXRTdHJ1Y3RUcmVlIiwgZnVuY3Rpb24gKGRhdGEpIHsKICAgICAgcmV0dXJuIHBkZk1hbmFnZXIuZ2V0UGFnZShkYXRhLnBhZ2VJbmRleCkudGhlbihmdW5jdGlvbiAocGFnZSkgewogICAgICAgIHJldHVybiBwZGZNYW5hZ2VyLmVuc3VyZShwYWdlLCAiZ2V0U3RydWN0VHJlZSIpOwogICAgICB9KTsKICAgIH0pOwogICAgaGFuZGxlci5vbigiRm9udEZhbGxiYWNrIiwgZnVuY3Rpb24gKGRhdGEpIHsKICAgICAgcmV0dXJuIHBkZk1hbmFnZXIuZm9udEZhbGxiYWNrKGRhdGEuaWQsIGhhbmRsZXIpOwogICAgfSk7CiAgICBoYW5kbGVyLm9uKCJDbGVhbnVwIiwgZnVuY3Rpb24gKGRhdGEpIHsKICAgICAgcmV0dXJuIHBkZk1hbmFnZXIuY2xlYW51cCh0cnVlKTsKICAgIH0pOwogICAgaGFuZGxlci5vbigiVGVybWluYXRlIiwgZnVuY3Rpb24gKGRhdGEpIHsKICAgICAgdGVybWluYXRlZCA9IHRydWU7CiAgICAgIGNvbnN0IHdhaXRPbiA9IFtdOwogICAgICBpZiAocGRmTWFuYWdlcikgewogICAgICAgIHBkZk1hbmFnZXIudGVybWluYXRlKG5ldyBfdXRpbC5BYm9ydEV4Y2VwdGlvbigiV29ya2VyIHdhcyB0ZXJtaW5hdGVkLiIpKTsKICAgICAgICBjb25zdCBjbGVhbnVwUHJvbWlzZSA9IHBkZk1hbmFnZXIuY2xlYW51cCgpOwogICAgICAgIHdhaXRPbi5wdXNoKGNsZWFudXBQcm9taXNlKTsKICAgICAgICBwZGZNYW5hZ2VyID0gbnVsbDsKICAgICAgfSBlbHNlIHsKICAgICAgICAoMCwgX2NsZWFudXBfaGVscGVyLmNsZWFyR2xvYmFsQ2FjaGVzKSgpOwogICAgICB9CiAgICAgIGlmIChjYW5jZWxYSFJzKSB7CiAgICAgICAgY2FuY2VsWEhScyhuZXcgX3V0aWwuQWJvcnRFeGNlcHRpb24oIldvcmtlciB3YXMgdGVybWluYXRlZC4iKSk7CiAgICAgIH0KICAgICAgZm9yIChjb25zdCB0YXNrIG9mIFdvcmtlclRhc2tzKSB7CiAgICAgICAgd2FpdE9uLnB1c2godGFzay5maW5pc2hlZCk7CiAgICAgICAgdGFzay50ZXJtaW5hdGUoKTsKICAgICAgfQogICAgICByZXR1cm4gUHJvbWlzZS5hbGwod2FpdE9uKS50aGVuKGZ1bmN0aW9uICgpIHsKICAgICAgICBoYW5kbGVyLmRlc3Ryb3koKTsKICAgICAgICBoYW5kbGVyID0gbnVsbDsKICAgICAgfSk7CiAgICB9KTsKICAgIGhhbmRsZXIub24oIlJlYWR5IiwgZnVuY3Rpb24gKGRhdGEpIHsKICAgICAgc2V0dXBEb2MoZG9jUGFyYW1zKTsKICAgICAgZG9jUGFyYW1zID0gbnVsbDsKICAgIH0pOwogICAgcmV0dXJuIHdvcmtlckhhbmRsZXJOYW1lOwogIH0KICBzdGF0aWMgaW5pdGlhbGl6ZUZyb21Qb3J0KHBvcnQpIHsKICAgIGNvbnN0IGhhbmRsZXIgPSBuZXcgX21lc3NhZ2VfaGFuZGxlci5NZXNzYWdlSGFuZGxlcigid29ya2VyIiwgIm1haW4iLCBwb3J0KTsKICAgIFdvcmtlck1lc3NhZ2VIYW5kbGVyLnNldHVwKGhhbmRsZXIsIHBvcnQpOwogICAgaGFuZGxlci5zZW5kKCJyZWFkeSIsIG51bGwpOwogIH0KfQpleHBvcnRzLldvcmtlck1lc3NhZ2VIYW5kbGVyID0gV29ya2VyTWVzc2FnZUhhbmRsZXI7CmZ1bmN0aW9uIGlzTWVzc2FnZVBvcnQobWF5YmVQb3J0KSB7CiAgcmV0dXJuIHR5cGVvZiBtYXliZVBvcnQucG9zdE1lc3NhZ2UgPT09ICJmdW5jdGlvbiIgJiYgIm9ubWVzc2FnZSIgaW4gbWF5YmVQb3J0Owp9CmlmICh0eXBlb2Ygd2luZG93ID09PSAidW5kZWZpbmVkIiAmJiAhX3V0aWwuaXNOb2RlSlMgJiYgdHlwZW9mIHNlbGYgIT09ICJ1bmRlZmluZWQiICYmIGlzTWVzc2FnZVBvcnQoc2VsZikpIHsKICBXb3JrZXJNZXNzYWdlSGFuZGxlci5pbml0aWFsaXplRnJvbVBvcnQoc2VsZik7Cn0KCi8qKiovIH0pLAovKiAyICovCi8qKiovICgoX191bnVzZWRfd2VicGFja19tb2R1bGUsIGV4cG9ydHMpID0+IHsKCgoKT2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsICJfX2VzTW9kdWxlIiwgKHsKICB2YWx1ZTogdHJ1ZQp9KSk7CmV4cG9ydHMuVmVyYm9zaXR5TGV2ZWwgPSBleHBvcnRzLlV0aWwgPSBleHBvcnRzLlVua25vd25FcnJvckV4Y2VwdGlvbiA9IGV4cG9ydHMuVW5leHBlY3RlZFJlc3BvbnNlRXhjZXB0aW9uID0gZXhwb3J0cy5UZXh0UmVuZGVyaW5nTW9kZSA9IGV4cG9ydHMuUmVuZGVyaW5nSW50ZW50RmxhZyA9IGV4cG9ydHMuUHJvbWlzZUNhcGFiaWxpdHkgPSBleHBvcnRzLlBlcm1pc3Npb25GbGFnID0gZXhwb3J0cy5QYXNzd29yZFJlc3BvbnNlcyA9IGV4cG9ydHMuUGFzc3dvcmRFeGNlcHRpb24gPSBleHBvcnRzLlBhZ2VBY3Rpb25FdmVudFR5cGUgPSBleHBvcnRzLk9QUyA9IGV4cG9ydHMuTWlzc2luZ1BERkV4Y2VwdGlvbiA9IGV4cG9ydHMuTUFYX0lNQUdFX1NJWkVfVE9fQ0FDSEUgPSBleHBvcnRzLkxJTkVfRkFDVE9SID0gZXhwb3J0cy5MSU5FX0RFU0NFTlRfRkFDVE9SID0gZXhwb3J0cy5JbnZhbGlkUERGRXhjZXB0aW9uID0gZXhwb3J0cy5JbWFnZUtpbmQgPSBleHBvcnRzLklERU5USVRZX01BVFJJWCA9IGV4cG9ydHMuRm9ybWF0RXJyb3IgPSBleHBvcnRzLkZlYXR1cmVUZXN0ID0gZXhwb3J0cy5GT05UX0lERU5USVRZX01BVFJJWCA9IGV4cG9ydHMuRG9jdW1lbnRBY3Rpb25FdmVudFR5cGUgPSBleHBvcnRzLkNNYXBDb21wcmVzc2lvblR5cGUgPSBleHBvcnRzLkJhc2VFeGNlcHRpb24gPSBleHBvcnRzLkJBU0VMSU5FX0ZBQ1RPUiA9IGV4cG9ydHMuQW5ub3RhdGlvblR5cGUgPSBleHBvcnRzLkFubm90YXRpb25SZXBseVR5cGUgPSBleHBvcnRzLkFubm90YXRpb25QcmVmaXggPSBleHBvcnRzLkFubm90YXRpb25Nb2RlID0gZXhwb3J0cy5Bbm5vdGF0aW9uRmxhZyA9IGV4cG9ydHMuQW5ub3RhdGlvbkZpZWxkRmxhZyA9IGV4cG9ydHMuQW5ub3RhdGlvbkVkaXRvclR5cGUgPSBleHBvcnRzLkFubm90YXRpb25FZGl0b3JQcmVmaXggPSBleHBvcnRzLkFubm90YXRpb25FZGl0b3JQYXJhbXNUeXBlID0gZXhwb3J0cy5Bbm5vdGF0aW9uQm9yZGVyU3R5bGVUeXBlID0gZXhwb3J0cy5Bbm5vdGF0aW9uQWN0aW9uRXZlbnRUeXBlID0gZXhwb3J0cy5BYm9ydEV4Y2VwdGlvbiA9IHZvaWQgMDsKZXhwb3J0cy5hc3NlcnQgPSBhc3NlcnQ7CmV4cG9ydHMuYnl0ZXNUb1N0cmluZyA9IGJ5dGVzVG9TdHJpbmc7CmV4cG9ydHMuY3JlYXRlVmFsaWRBYnNvbHV0ZVVybCA9IGNyZWF0ZVZhbGlkQWJzb2x1dGVVcmw7CmV4cG9ydHMuZ2V0TW9kaWZpY2F0aW9uRGF0ZSA9IGdldE1vZGlmaWNhdGlvbkRhdGU7CmV4cG9ydHMuZ2V0VXVpZCA9IGdldFV1aWQ7CmV4cG9ydHMuZ2V0VmVyYm9zaXR5TGV2ZWwgPSBnZXRWZXJib3NpdHlMZXZlbDsKZXhwb3J0cy5pbmZvID0gaW5mbzsKZXhwb3J0cy5pc0FycmF5QnVmZmVyID0gaXNBcnJheUJ1ZmZlcjsKZXhwb3J0cy5pc0FycmF5RXF1YWwgPSBpc0FycmF5RXF1YWw7CmV4cG9ydHMuaXNOb2RlSlMgPSB2b2lkIDA7CmV4cG9ydHMubm9ybWFsaXplVW5pY29kZSA9IG5vcm1hbGl6ZVVuaWNvZGU7CmV4cG9ydHMub2JqZWN0RnJvbU1hcCA9IG9iamVjdEZyb21NYXA7CmV4cG9ydHMub2JqZWN0U2l6ZSA9IG9iamVjdFNpemU7CmV4cG9ydHMuc2V0VmVyYm9zaXR5TGV2ZWwgPSBzZXRWZXJib3NpdHlMZXZlbDsKZXhwb3J0cy5zaGFkb3cgPSBzaGFkb3c7CmV4cG9ydHMuc3RyaW5nMzIgPSBzdHJpbmczMjsKZXhwb3J0cy5zdHJpbmdUb0J5dGVzID0gc3RyaW5nVG9CeXRlczsKZXhwb3J0cy5zdHJpbmdUb1BERlN0cmluZyA9IHN0cmluZ1RvUERGU3RyaW5nOwpleHBvcnRzLnN0cmluZ1RvVVRGOFN0cmluZyA9IHN0cmluZ1RvVVRGOFN0cmluZzsKZXhwb3J0cy51bnJlYWNoYWJsZSA9IHVucmVhY2hhYmxlOwpleHBvcnRzLnV0ZjhTdHJpbmdUb1N0cmluZyA9IHV0ZjhTdHJpbmdUb1N0cmluZzsKZXhwb3J0cy53YXJuID0gd2FybjsKY29uc3QgaXNOb2RlSlMgPSB0eXBlb2YgcHJvY2VzcyA9PT0gIm9iamVjdCIgJiYgcHJvY2VzcyArICIiID09PSAiW29iamVjdCBwcm9jZXNzXSIgJiYgIXByb2Nlc3MudmVyc2lvbnMubncgJiYgIShwcm9jZXNzLnZlcnNpb25zLmVsZWN0cm9uICYmIHByb2Nlc3MudHlwZSAmJiBwcm9jZXNzLnR5cGUgIT09ICJicm93c2VyIik7CmV4cG9ydHMuaXNOb2RlSlMgPSBpc05vZGVKUzsKY29uc3QgSURFTlRJVFlfTUFUUklYID0gWzEsIDAsIDAsIDEsIDAsIDBdOwpleHBvcnRzLklERU5USVRZX01BVFJJWCA9IElERU5USVRZX01BVFJJWDsKY29uc3QgRk9OVF9JREVOVElUWV9NQVRSSVggPSBbMC4wMDEsIDAsIDAsIDAuMDAxLCAwLCAwXTsKZXhwb3J0cy5GT05UX0lERU5USVRZX01BVFJJWCA9IEZPTlRfSURFTlRJVFlfTUFUUklYOwpjb25zdCBNQVhfSU1BR0VfU0laRV9UT19DQUNIRSA9IDEwZTY7CmV4cG9ydHMuTUFYX0lNQUdFX1NJWkVfVE9fQ0FDSEUgPSBNQVhfSU1BR0VfU0laRV9UT19DQUNIRTsKY29uc3QgTElORV9GQUNUT1IgPSAxLjM1OwpleHBvcnRzLkxJTkVfRkFDVE9SID0gTElORV9GQUNUT1I7CmNvbnN0IExJTkVfREVTQ0VOVF9GQUNUT1IgPSAwLjM1OwpleHBvcnRzLkxJTkVfREVTQ0VOVF9GQUNUT1IgPSBMSU5FX0RFU0NFTlRfRkFDVE9SOwpjb25zdCBCQVNFTElORV9GQUNUT1IgPSBMSU5FX0RFU0NFTlRfRkFDVE9SIC8gTElORV9GQUNUT1I7CmV4cG9ydHMuQkFTRUxJTkVfRkFDVE9SID0gQkFTRUxJTkVfRkFDVE9SOwpjb25zdCBSZW5kZXJpbmdJbnRlbnRGbGFnID0gewogIEFOWTogMHgwMSwKICBESVNQTEFZOiAweDAyLAogIFBSSU5UOiAweDA0LAogIFNBVkU6IDB4MDgsCiAgQU5OT1RBVElPTlNfRk9STVM6IDB4MTAsCiAgQU5OT1RBVElPTlNfU1RPUkFHRTogMHgyMCwKICBBTk5PVEFUSU9OU19ESVNBQkxFOiAweDQwLAogIE9QTElTVDogMHgxMDAKfTsKZXhwb3J0cy5SZW5kZXJpbmdJbnRlbnRGbGFnID0gUmVuZGVyaW5nSW50ZW50RmxhZzsKY29uc3QgQW5ub3RhdGlvbk1vZGUgPSB7CiAgRElTQUJMRTogMCwKICBFTkFCTEU6IDEsCiAgRU5BQkxFX0ZPUk1TOiAyLAogIEVOQUJMRV9TVE9SQUdFOiAzCn07CmV4cG9ydHMuQW5ub3RhdGlvbk1vZGUgPSBBbm5vdGF0aW9uTW9kZTsKY29uc3QgQW5ub3RhdGlvbkVkaXRvclByZWZpeCA9ICJwZGZqc19pbnRlcm5hbF9lZGl0b3JfIjsKZXhwb3J0cy5Bbm5vdGF0aW9uRWRpdG9yUHJlZml4ID0gQW5ub3RhdGlvbkVkaXRvclByZWZpeDsKY29uc3QgQW5ub3RhdGlvbkVkaXRvclR5cGUgPSB7CiAgRElTQUJMRTogLTEsCiAgTk9ORTogMCwKICBGUkVFVEVYVDogMywKICBTVEFNUDogMTMsCiAgSU5LOiAxNQp9OwpleHBvcnRzLkFubm90YXRpb25FZGl0b3JUeXBlID0gQW5ub3RhdGlvbkVkaXRvclR5cGU7CmNvbnN0IEFubm90YXRpb25FZGl0b3JQYXJhbXNUeXBlID0gewogIFJFU0laRTogMSwKICBDUkVBVEU6IDIsCiAgRlJFRVRFWFRfU0laRTogMTEsCiAgRlJFRVRFWFRfQ09MT1I6IDEyLAogIEZSRUVURVhUX09QQUNJVFk6IDEzLAogIElOS19DT0xPUjogMjEsCiAgSU5LX1RISUNLTkVTUzogMjIsCiAgSU5LX09QQUNJVFk6IDIzCn07CmV4cG9ydHMuQW5ub3RhdGlvbkVkaXRvclBhcmFtc1R5cGUgPSBBbm5vdGF0aW9uRWRpdG9yUGFyYW1zVHlwZTsKY29uc3QgUGVybWlzc2lvbkZsYWcgPSB7CiAgUFJJTlQ6IDB4MDQsCiAgTU9ESUZZX0NPTlRFTlRTOiAweDA4LAogIENPUFk6IDB4MTAsCiAgTU9ESUZZX0FOTk9UQVRJT05TOiAweDIwLAogIEZJTExfSU5URVJBQ1RJVkVfRk9STVM6IDB4MTAwLAogIENPUFlfRk9SX0FDQ0VTU0lCSUxJVFk6IDB4MjAwLAogIEFTU0VNQkxFOiAweDQwMCwKICBQUklOVF9ISUdIX1FVQUxJVFk6IDB4ODAwCn07CmV4cG9ydHMuUGVybWlzc2lvbkZsYWcgPSBQZXJtaXNzaW9uRmxhZzsKY29uc3QgVGV4dFJlbmRlcmluZ01vZGUgPSB7CiAgRklMTDogMCwKICBTVFJPS0U6IDEsCiAgRklMTF9TVFJPS0U6IDIsCiAgSU5WSVNJQkxFOiAzLAogIEZJTExfQUREX1RPX1BBVEg6IDQsCiAgU1RST0tFX0FERF9UT19QQVRIOiA1LAogIEZJTExfU1RST0tFX0FERF9UT19QQVRIOiA2LAogIEFERF9UT19QQVRIOiA3LAogIEZJTExfU1RST0tFX01BU0s6IDMsCiAgQUREX1RPX1BBVEhfRkxBRzogNAp9OwpleHBvcnRzLlRleHRSZW5kZXJpbmdNb2RlID0gVGV4dFJlbmRlcmluZ01vZGU7CmNvbnN0IEltYWdlS2luZCA9IHsKICBHUkFZU0NBTEVfMUJQUDogMSwKICBSR0JfMjRCUFA6IDIsCiAgUkdCQV8zMkJQUDogMwp9OwpleHBvcnRzLkltYWdlS2luZCA9IEltYWdlS2luZDsKY29uc3QgQW5ub3RhdGlvblR5cGUgPSB7CiAgVEVYVDogMSwKICBMSU5LOiAyLAogIEZSRUVURVhUOiAzLAogIExJTkU6IDQsCiAgU1FVQVJFOiA1LAogIENJUkNMRTogNiwKICBQT0xZR09OOiA3LAogIFBPTFlMSU5FOiA4LAogIEhJR0hMSUdIVDogOSwKICBVTkRFUkxJTkU6IDEwLAogIFNRVUlHR0xZOiAxMSwKICBTVFJJS0VPVVQ6IDEyLAogIFNUQU1QOiAxMywKICBDQVJFVDogMTQsCiAgSU5LOiAxNSwKICBQT1BVUDogMTYsCiAgRklMRUFUVEFDSE1FTlQ6IDE3LAogIFNPVU5EOiAxOCwKICBNT1ZJRTogMTksCiAgV0lER0VUOiAyMCwKICBTQ1JFRU46IDIxLAogIFBSSU5URVJNQVJLOiAyMiwKICBUUkFQTkVUOiAyMywKICBXQVRFUk1BUks6IDI0LAogIFRIUkVFRDogMjUsCiAgUkVEQUNUOiAyNgp9OwpleHBvcnRzLkFubm90YXRpb25UeXBlID0gQW5ub3RhdGlvblR5cGU7CmNvbnN0IEFubm90YXRpb25SZXBseVR5cGUgPSB7CiAgR1JPVVA6ICJHcm91cCIsCiAgUkVQTFk6ICJSIgp9OwpleHBvcnRzLkFubm90YXRpb25SZXBseVR5cGUgPSBBbm5vdGF0aW9uUmVwbHlUeXBlOwpjb25zdCBBbm5vdGF0aW9uRmxhZyA9IHsKICBJTlZJU0lCTEU6IDB4MDEsCiAgSElEREVOOiAweDAyLAogIFBSSU5UOiAweDA0LAogIE5PWk9PTTogMHgwOCwKICBOT1JPVEFURTogMHgxMCwKICBOT1ZJRVc6IDB4MjAsCiAgUkVBRE9OTFk6IDB4NDAsCiAgTE9DS0VEOiAweDgwLAogIFRPR0dMRU5PVklFVzogMHgxMDAsCiAgTE9DS0VEQ09OVEVOVFM6IDB4MjAwCn07CmV4cG9ydHMuQW5ub3RhdGlvbkZsYWcgPSBBbm5vdGF0aW9uRmxhZzsKY29uc3QgQW5ub3RhdGlvbkZpZWxkRmxhZyA9IHsKICBSRUFET05MWTogMHgwMDAwMDAxLAogIFJFUVVJUkVEOiAweDAwMDAwMDIsCiAgTk9FWFBPUlQ6IDB4MDAwMDAwNCwKICBNVUxUSUxJTkU6IDB4MDAwMTAwMCwKICBQQVNTV09SRDogMHgwMDAyMDAwLAogIE5PVE9HR0xFVE9PRkY6IDB4MDAwNDAwMCwKICBSQURJTzogMHgwMDA4MDAwLAogIFBVU0hCVVRUT046IDB4MDAxMDAwMCwKICBDT01CTzogMHgwMDIwMDAwLAogIEVESVQ6IDB4MDA0MDAwMCwKICBTT1JUOiAweDAwODAwMDAsCiAgRklMRVNFTEVDVDogMHgwMTAwMDAwLAogIE1VTFRJU0VMRUNUOiAweDAyMDAwMDAsCiAgRE9OT1RTUEVMTENIRUNLOiAweDA0MDAwMDAsCiAgRE9OT1RTQ1JPTEw6IDB4MDgwMDAwMCwKICBDT01COiAweDEwMDAwMDAsCiAgUklDSFRFWFQ6IDB4MjAwMDAwMCwKICBSQURJT1NJTlVOSVNPTjogMHgyMDAwMDAwLAogIENPTU1JVE9OU0VMQ0hBTkdFOiAweDQwMDAwMDAKfTsKZXhwb3J0cy5Bbm5vdGF0aW9uRmllbGRGbGFnID0gQW5ub3RhdGlvbkZpZWxkRmxhZzsKY29uc3QgQW5ub3RhdGlvbkJvcmRlclN0eWxlVHlwZSA9IHsKICBTT0xJRDogMSwKICBEQVNIRUQ6IDIsCiAgQkVWRUxFRDogMywKICBJTlNFVDogNCwKICBVTkRFUkxJTkU6IDUKfTsKZXhwb3J0cy5Bbm5vdGF0aW9uQm9yZGVyU3R5bGVUeXBlID0gQW5ub3RhdGlvbkJvcmRlclN0eWxlVHlwZTsKY29uc3QgQW5ub3RhdGlvbkFjdGlvbkV2ZW50VHlwZSA9IHsKICBFOiAiTW91c2UgRW50ZXIiLAogIFg6ICJNb3VzZSBFeGl0IiwKICBEOiAiTW91c2UgRG93biIsCiAgVTogIk1vdXNlIFVwIiwKICBGbzogIkZvY3VzIiwKICBCbDogIkJsdXIiLAogIFBPOiAiUGFnZU9wZW4iLAogIFBDOiAiUGFnZUNsb3NlIiwKICBQVjogIlBhZ2VWaXNpYmxlIiwKICBQSTogIlBhZ2VJbnZpc2libGUiLAogIEs6ICJLZXlzdHJva2UiLAogIEY6ICJGb3JtYXQiLAogIFY6ICJWYWxpZGF0ZSIsCiAgQzogIkNhbGN1bGF0ZSIKfTsKZXhwb3J0cy5Bbm5vdGF0aW9uQWN0aW9uRXZlbnRUeXBlID0gQW5ub3RhdGlvbkFjdGlvbkV2ZW50VHlwZTsKY29uc3QgRG9jdW1lbnRBY3Rpb25FdmVudFR5cGUgPSB7CiAgV0M6ICJXaWxsQ2xvc2UiLAogIFdTOiAiV2lsbFNhdmUiLAogIERTOiAiRGlkU2F2ZSIsCiAgV1A6ICJXaWxsUHJpbnQiLAogIERQOiAiRGlkUHJpbnQiCn07CmV4cG9ydHMuRG9jdW1lbnRBY3Rpb25FdmVudFR5cGUgPSBEb2N1bWVudEFjdGlvbkV2ZW50VHlwZTsKY29uc3QgUGFnZUFjdGlvbkV2ZW50VHlwZSA9IHsKICBPOiAiUGFnZU9wZW4iLAogIEM6ICJQYWdlQ2xvc2UiCn07CmV4cG9ydHMuUGFnZUFjdGlvbkV2ZW50VHlwZSA9IFBhZ2VBY3Rpb25FdmVudFR5cGU7CmNvbnN0IFZlcmJvc2l0eUxldmVsID0gewogIEVSUk9SUzogMCwKICBXQVJOSU5HUzogMSwKICBJTkZPUzogNQp9OwpleHBvcnRzLlZlcmJvc2l0eUxldmVsID0gVmVyYm9zaXR5TGV2ZWw7CmNvbnN0IENNYXBDb21wcmVzc2lvblR5cGUgPSB7CiAgTk9ORTogMCwKICBCSU5BUlk6IDEKfTsKZXhwb3J0cy5DTWFwQ29tcHJlc3Npb25UeXBlID0gQ01hcENvbXByZXNzaW9uVHlwZTsKY29uc3QgT1BTID0gewogIGRlcGVuZGVuY3k6IDEsCiAgc2V0TGluZVdpZHRoOiAyLAogIHNldExpbmVDYXA6IDMsCiAgc2V0TGluZUpvaW46IDQsCiAgc2V0TWl0ZXJMaW1pdDogNSwKICBzZXREYXNoOiA2LAogIHNldFJlbmRlcmluZ0ludGVudDogNywKICBzZXRGbGF0bmVzczogOCwKICBzZXRHU3RhdGU6IDksCiAgc2F2ZTogMTAsCiAgcmVzdG9yZTogMTEsCiAgdHJhbnNmb3JtOiAxMiwKICBtb3ZlVG86IDEzLAogIGxpbmVUbzogMTQsCiAgY3VydmVUbzogMTUsCiAgY3VydmVUbzI6IDE2LAogIGN1cnZlVG8zOiAxNywKICBjbG9zZVBhdGg6IDE4LAogIHJlY3RhbmdsZTogMTksCiAgc3Ryb2tlOiAyMCwKICBjbG9zZVN0cm9rZTogMjEsCiAgZmlsbDogMjIsCiAgZW9GaWxsOiAyMywKICBmaWxsU3Ryb2tlOiAyNCwKICBlb0ZpbGxTdHJva2U6IDI1LAogIGNsb3NlRmlsbFN0cm9rZTogMjYsCiAgY2xvc2VFT0ZpbGxTdHJva2U6IDI3LAogIGVuZFBhdGg6IDI4LAogIGNsaXA6IDI5LAogIGVvQ2xpcDogMzAsCiAgYmVnaW5UZXh0OiAzMSwKICBlbmRUZXh0OiAzMiwKICBzZXRDaGFyU3BhY2luZzogMzMsCiAgc2V0V29yZFNwYWNpbmc6IDM0LAogIHNldEhTY2FsZTogMzUsCiAgc2V0TGVhZGluZzogMzYsCiAgc2V0Rm9udDogMzcsCiAgc2V0VGV4dFJlbmRlcmluZ01vZGU6IDM4LAogIHNldFRleHRSaXNlOiAzOSwKICBtb3ZlVGV4dDogNDAsCiAgc2V0TGVhZGluZ01vdmVUZXh0OiA0MSwKICBzZXRUZXh0TWF0cml4OiA0MiwKICBuZXh0TGluZTogNDMsCiAgc2hvd1RleHQ6IDQ0LAogIHNob3dTcGFjZWRUZXh0OiA0NSwKICBuZXh0TGluZVNob3dUZXh0OiA0NiwKICBuZXh0TGluZVNldFNwYWNpbmdTaG93VGV4dDogNDcsCiAgc2V0Q2hhcldpZHRoOiA0OCwKICBzZXRDaGFyV2lkdGhBbmRCb3VuZHM6IDQ5LAogIHNldFN0cm9rZUNvbG9yU3BhY2U6IDUwLAogIHNldEZpbGxDb2xvclNwYWNlOiA1MSwKICBzZXRTdHJva2VDb2xvcjogNTIsCiAgc2V0U3Ryb2tlQ29sb3JOOiA1MywKICBzZXRGaWxsQ29sb3I6IDU0LAogIHNldEZpbGxDb2xvck46IDU1LAogIHNldFN0cm9rZUdyYXk6IDU2LAogIHNldEZpbGxHcmF5OiA1NywKICBzZXRTdHJva2VSR0JDb2xvcjogNTgsCiAgc2V0RmlsbFJHQkNvbG9yOiA1OSwKICBzZXRTdHJva2VDTVlLQ29sb3I6IDYwLAogIHNldEZpbGxDTVlLQ29sb3I6IDYxLAogIHNoYWRpbmdGaWxsOiA2MiwKICBiZWdpbklubGluZUltYWdlOiA2MywKICBiZWdpbkltYWdlRGF0YTogNjQsCiAgZW5kSW5saW5lSW1hZ2U6IDY1LAogIHBhaW50WE9iamVjdDogNjYsCiAgbWFya1BvaW50OiA2NywKICBtYXJrUG9pbnRQcm9wczogNjgsCiAgYmVnaW5NYXJrZWRDb250ZW50OiA2OSwKICBiZWdpbk1hcmtlZENvbnRlbnRQcm9wczogNzAsCiAgZW5kTWFya2VkQ29udGVudDogNzEsCiAgYmVnaW5Db21wYXQ6IDcyLAogIGVuZENvbXBhdDogNzMsCiAgcGFpbnRGb3JtWE9iamVjdEJlZ2luOiA3NCwKICBwYWludEZvcm1YT2JqZWN0RW5kOiA3NSwKICBiZWdpbkdyb3VwOiA3NiwKICBlbmRHcm91cDogNzcsCiAgYmVnaW5Bbm5vdGF0aW9uOiA4MCwKICBlbmRBbm5vdGF0aW9uOiA4MSwKICBwYWludEltYWdlTWFza1hPYmplY3Q6IDgzLAogIHBhaW50SW1hZ2VNYXNrWE9iamVjdEdyb3VwOiA4NCwKICBwYWludEltYWdlWE9iamVjdDogODUsCiAgcGFpbnRJbmxpbmVJbWFnZVhPYmplY3Q6IDg2LAogIHBhaW50SW5saW5lSW1hZ2VYT2JqZWN0R3JvdXA6IDg3LAogIHBhaW50SW1hZ2VYT2JqZWN0UmVwZWF0OiA4OCwKICBwYWludEltYWdlTWFza1hPYmplY3RSZXBlYXQ6IDg5LAogIHBhaW50U29saWRDb2xvckltYWdlTWFzazogOTAsCiAgY29uc3RydWN0UGF0aDogOTEKfTsKZXhwb3J0cy5PUFMgPSBPUFM7CmNvbnN0IFBhc3N3b3JkUmVzcG9uc2VzID0gewogIE5FRURfUEFTU1dPUkQ6IDEsCiAgSU5DT1JSRUNUX1BBU1NXT1JEOiAyCn07CmV4cG9ydHMuUGFzc3dvcmRSZXNwb25zZXMgPSBQYXNzd29yZFJlc3BvbnNlczsKbGV0IHZlcmJvc2l0eSA9IFZlcmJvc2l0eUxldmVsLldBUk5JTkdTOwpmdW5jdGlvbiBzZXRWZXJib3NpdHlMZXZlbChsZXZlbCkgewogIGlmIChOdW1iZXIuaXNJbnRlZ2VyKGxldmVsKSkgewogICAgdmVyYm9zaXR5ID0gbGV2ZWw7CiAgfQp9CmZ1bmN0aW9uIGdldFZlcmJvc2l0eUxldmVsKCkgewogIHJldHVybiB2ZXJib3NpdHk7Cn0KZnVuY3Rpb24gaW5mbyhtc2cpIHsKICBpZiAodmVyYm9zaXR5ID49IFZlcmJvc2l0eUxldmVsLklORk9TKSB7CiAgICBjb25zb2xlLmxvZyhgSW5mbzogJHttc2d9YCk7CiAgfQp9CmZ1bmN0aW9uIHdhcm4obXNnKSB7CiAgaWYgKHZlcmJvc2l0eSA+PSBWZXJib3NpdHlMZXZlbC5XQVJOSU5HUykgewogICAgY29uc29sZS5sb2coYFdhcm5pbmc6ICR7bXNnfWApOwogIH0KfQpmdW5jdGlvbiB1bnJlYWNoYWJsZShtc2cpIHsKICB0aHJvdyBuZXcgRXJyb3IobXNnKTsKfQpmdW5jdGlvbiBhc3NlcnQoY29uZCwgbXNnKSB7CiAgaWYgKCFjb25kKSB7CiAgICB1bnJlYWNoYWJsZShtc2cpOwogIH0KfQpmdW5jdGlvbiBfaXNWYWxpZFByb3RvY29sKHVybCkgewogIHN3aXRjaCAodXJsPy5wcm90b2NvbCkgewogICAgY2FzZSAiaHR0cDoiOgogICAgY2FzZSAiaHR0cHM6IjoKICAgIGNhc2UgImZ0cDoiOgogICAgY2FzZSAibWFpbHRvOiI6CiAgICBjYXNlICJ0ZWw6IjoKICAgICAgcmV0dXJuIHRydWU7CiAgICBkZWZhdWx0OgogICAgICByZXR1cm4gZmFsc2U7CiAgfQp9CmZ1bmN0aW9uIGNyZWF0ZVZhbGlkQWJzb2x1dGVVcmwodXJsLCBiYXNlVXJsID0gbnVsbCwgb3B0aW9ucyA9IG51bGwpIHsKICBpZiAoIXVybCkgewogICAgcmV0dXJuIG51bGw7CiAgfQogIHRyeSB7CiAgICBpZiAob3B0aW9ucyAmJiB0eXBlb2YgdXJsID09PSAic3RyaW5nIikgewogICAgICBpZiAob3B0aW9ucy5hZGREZWZhdWx0UHJvdG9jb2wgJiYgdXJsLnN0YXJ0c1dpdGgoInd3dy4iKSkgewogICAgICAgIGNvbnN0IGRvdHMgPSB1cmwubWF0Y2goL1wuL2cpOwogICAgICAgIGlmIChkb3RzPy5sZW5ndGggPj0gMikgewogICAgICAgICAgdXJsID0gYGh0dHA6Ly8ke3VybH1gOwogICAgICAgIH0KICAgICAgfQogICAgICBpZiAob3B0aW9ucy50cnlDb252ZXJ0RW5jb2RpbmcpIHsKICAgICAgICB0cnkgewogICAgICAgICAgdXJsID0gc3RyaW5nVG9VVEY4U3RyaW5nKHVybCk7CiAgICAgICAgfSBjYXRjaCB7fQogICAgICB9CiAgICB9CiAgICBjb25zdCBhYnNvbHV0ZVVybCA9IGJhc2VVcmwgPyBuZXcgVVJMKHVybCwgYmFzZVVybCkgOiBuZXcgVVJMKHVybCk7CiAgICBpZiAoX2lzVmFsaWRQcm90b2NvbChhYnNvbHV0ZVVybCkpIHsKICAgICAgcmV0dXJuIGFic29sdXRlVXJsOwogICAgfQogIH0gY2F0Y2gge30KICByZXR1cm4gbnVsbDsKfQpmdW5jdGlvbiBzaGFkb3cob2JqLCBwcm9wLCB2YWx1ZSwgbm9uU2VyaWFsaXphYmxlID0gZmFsc2UpIHsKICBPYmplY3QuZGVmaW5lUHJvcGVydHkob2JqLCBwcm9wLCB7CiAgICB2YWx1ZSwKICAgIGVudW1lcmFibGU6ICFub25TZXJpYWxpemFibGUsCiAgICBjb25maWd1cmFibGU6IHRydWUsCiAgICB3cml0YWJsZTogZmFsc2UKICB9KTsKICByZXR1cm4gdmFsdWU7Cn0KY29uc3QgQmFzZUV4Y2VwdGlvbiA9IGZ1bmN0aW9uIEJhc2VFeGNlcHRpb25DbG9zdXJlKCkgewogIGZ1bmN0aW9uIEJhc2VFeGNlcHRpb24obWVzc2FnZSwgbmFtZSkgewogICAgaWYgKHRoaXMuY29uc3RydWN0b3IgPT09IEJhc2VFeGNlcHRpb24pIHsKICAgICAgdW5yZWFjaGFibGUoIkNhbm5vdCBpbml0aWFsaXplIEJhc2VFeGNlcHRpb24uIik7CiAgICB9CiAgICB0aGlzLm1lc3NhZ2UgPSBtZXNzYWdlOwogICAgdGhpcy5uYW1lID0gbmFtZTsKICB9CiAgQmFzZUV4Y2VwdGlvbi5wcm90b3R5cGUgPSBuZXcgRXJyb3IoKTsKICBCYXNlRXhjZXB0aW9uLmNvbnN0cnVjdG9yID0gQmFzZUV4Y2VwdGlvbjsKICByZXR1cm4gQmFzZUV4Y2VwdGlvbjsKfSgpOwpleHBvcnRzLkJhc2VFeGNlcHRpb24gPSBCYXNlRXhjZXB0aW9uOwpjbGFzcyBQYXNzd29yZEV4Y2VwdGlvbiBleHRlbmRzIEJhc2VFeGNlcHRpb24gewogIGNvbnN0cnVjdG9yKG1zZywgY29kZSkgewogICAgc3VwZXIobXNnLCAiUGFzc3dvcmRFeGNlcHRpb24iKTsKICAgIHRoaXMuY29kZSA9IGNvZGU7CiAgfQp9CmV4cG9ydHMuUGFzc3dvcmRFeGNlcHRpb24gPSBQYXNzd29yZEV4Y2VwdGlvbjsKY2xhc3MgVW5rbm93bkVycm9yRXhjZXB0aW9uIGV4dGVuZHMgQmFzZUV4Y2VwdGlvbiB7CiAgY29uc3RydWN0b3IobXNnLCBkZXRhaWxzKSB7CiAgICBzdXBlcihtc2csICJVbmtub3duRXJyb3JFeGNlcHRpb24iKTsKICAgIHRoaXMuZGV0YWlscyA9IGRldGFpbHM7CiAgfQp9CmV4cG9ydHMuVW5rbm93bkVycm9yRXhjZXB0aW9uID0gVW5rbm93bkVycm9yRXhjZXB0aW9uOwpjbGFzcyBJbnZhbGlkUERGRXhjZXB0aW9uIGV4dGVuZHMgQmFzZUV4Y2VwdGlvbiB7CiAgY29uc3RydWN0b3IobXNnKSB7CiAgICBzdXBlcihtc2csICJJbnZhbGlkUERGRXhjZXB0aW9uIik7CiAgfQp9CmV4cG9ydHMuSW52YWxpZFBERkV4Y2VwdGlvbiA9IEludmFsaWRQREZFeGNlcHRpb247CmNsYXNzIE1pc3NpbmdQREZFeGNlcHRpb24gZXh0ZW5kcyBCYXNlRXhjZXB0aW9uIHsKICBjb25zdHJ1Y3Rvcihtc2cpIHsKICAgIHN1cGVyKG1zZywgIk1pc3NpbmdQREZFeGNlcHRpb24iKTsKICB9Cn0KZXhwb3J0cy5NaXNzaW5nUERGRXhjZXB0aW9uID0gTWlzc2luZ1BERkV4Y2VwdGlvbjsKY2xhc3MgVW5leHBlY3RlZFJlc3BvbnNlRXhjZXB0aW9uIGV4dGVuZHMgQmFzZUV4Y2VwdGlvbiB7CiAgY29uc3RydWN0b3IobXNnLCBzdGF0dXMpIHsKICAgIHN1cGVyKG1zZywgIlVuZXhwZWN0ZWRSZXNwb25zZUV4Y2VwdGlvbiIpOwogICAgdGhpcy5zdGF0dXMgPSBzdGF0dXM7CiAgfQp9CmV4cG9ydHMuVW5leHBlY3RlZFJlc3BvbnNlRXhjZXB0aW9uID0gVW5leHBlY3RlZFJlc3BvbnNlRXhjZXB0aW9uOwpjbGFzcyBGb3JtYXRFcnJvciBleHRlbmRzIEJhc2VFeGNlcHRpb24gewogIGNvbnN0cnVjdG9yKG1zZykgewogICAgc3VwZXIobXNnLCAiRm9ybWF0RXJyb3IiKTsKICB9Cn0KZXhwb3J0cy5Gb3JtYXRFcnJvciA9IEZvcm1hdEVycm9yOwpjbGFzcyBBYm9ydEV4Y2VwdGlvbiBleHRlbmRzIEJhc2VFeGNlcHRpb24gewogIGNvbnN0cnVjdG9yKG1zZykgewogICAgc3VwZXIobXNnLCAiQWJvcnRFeGNlcHRpb24iKTsKICB9Cn0KZXhwb3J0cy5BYm9ydEV4Y2VwdGlvbiA9IEFib3J0RXhjZXB0aW9uOwpmdW5jdGlvbiBieXRlc1RvU3RyaW5nKGJ5dGVzKSB7CiAgaWYgKHR5cGVvZiBieXRlcyAhPT0gIm9iamVjdCIgfHwgYnl0ZXM/Lmxlbmd0aCA9PT0gdW5kZWZpbmVkKSB7CiAgICB1bnJlYWNoYWJsZSgiSW52YWxpZCBhcmd1bWVudCBmb3IgYnl0ZXNUb1N0cmluZyIpOwogIH0KICBjb25zdCBsZW5ndGggPSBieXRlcy5sZW5ndGg7CiAgY29uc3QgTUFYX0FSR1VNRU5UX0NPVU5UID0gODE5MjsKICBpZiAobGVuZ3RoIDwgTUFYX0FSR1VNRU5UX0NPVU5UKSB7CiAgICByZXR1cm4gU3RyaW5nLmZyb21DaGFyQ29kZS5hcHBseShudWxsLCBieXRlcyk7CiAgfQogIGNvbnN0IHN0ckJ1ZiA9IFtdOwogIGZvciAobGV0IGkgPSAwOyBpIDwgbGVuZ3RoOyBpICs9IE1BWF9BUkdVTUVOVF9DT1VOVCkgewogICAgY29uc3QgY2h1bmtFbmQgPSBNYXRoLm1pbihpICsgTUFYX0FSR1VNRU5UX0NPVU5ULCBsZW5ndGgpOwogICAgY29uc3QgY2h1bmsgPSBieXRlcy5zdWJhcnJheShpLCBjaHVua0VuZCk7CiAgICBzdHJCdWYucHVzaChTdHJpbmcuZnJvbUNoYXJDb2RlLmFwcGx5KG51bGwsIGNodW5rKSk7CiAgfQogIHJldHVybiBzdHJCdWYuam9pbigiIik7Cn0KZnVuY3Rpb24gc3RyaW5nVG9CeXRlcyhzdHIpIHsKICBpZiAodHlwZW9mIHN0ciAhPT0gInN0cmluZyIpIHsKICAgIHVucmVhY2hhYmxlKCJJbnZhbGlkIGFyZ3VtZW50IGZvciBzdHJpbmdUb0J5dGVzIik7CiAgfQogIGNvbnN0IGxlbmd0aCA9IHN0ci5sZW5ndGg7CiAgY29uc3QgYnl0ZXMgPSBuZXcgVWludDhBcnJheShsZW5ndGgpOwogIGZvciAobGV0IGkgPSAwOyBpIDwgbGVuZ3RoOyArK2kpIHsKICAgIGJ5dGVzW2ldID0gc3RyLmNoYXJDb2RlQXQoaSkgJiAweGZmOwogIH0KICByZXR1cm4gYnl0ZXM7Cn0KZnVuY3Rpb24gc3RyaW5nMzIodmFsdWUpIHsKICByZXR1cm4gU3RyaW5nLmZyb21DaGFyQ29kZSh2YWx1ZSA+PiAyNCAmIDB4ZmYsIHZhbHVlID4+IDE2ICYgMHhmZiwgdmFsdWUgPj4gOCAmIDB4ZmYsIHZhbHVlICYgMHhmZik7Cn0KZnVuY3Rpb24gb2JqZWN0U2l6ZShvYmopIHsKICByZXR1cm4gT2JqZWN0LmtleXMob2JqKS5sZW5ndGg7Cn0KZnVuY3Rpb24gb2JqZWN0RnJvbU1hcChtYXApIHsKICBjb25zdCBvYmogPSBPYmplY3QuY3JlYXRlKG51bGwpOwogIGZvciAoY29uc3QgW2tleSwgdmFsdWVdIG9mIG1hcCkgewogICAgb2JqW2tleV0gPSB2YWx1ZTsKICB9CiAgcmV0dXJuIG9iajsKfQpmdW5jdGlvbiBpc0xpdHRsZUVuZGlhbigpIHsKICBjb25zdCBidWZmZXI4ID0gbmV3IFVpbnQ4QXJyYXkoNCk7CiAgYnVmZmVyOFswXSA9IDE7CiAgY29uc3QgdmlldzMyID0gbmV3IFVpbnQzMkFycmF5KGJ1ZmZlcjguYnVmZmVyLCAwLCAxKTsKICByZXR1cm4gdmlldzMyWzBdID09PSAxOwp9CmZ1bmN0aW9uIGlzRXZhbFN1cHBvcnRlZCgpIHsKICB0cnkgewogICAgbmV3IEZ1bmN0aW9uKCIiKTsKICAgIHJldHVybiB0cnVlOwogIH0gY2F0Y2ggewogICAgcmV0dXJuIGZhbHNlOwogIH0KfQpjbGFzcyBGZWF0dXJlVGVzdCB7CiAgc3RhdGljIGdldCBpc0xpdHRsZUVuZGlhbigpIHsKICAgIHJldHVybiBzaGFkb3codGhpcywgImlzTGl0dGxlRW5kaWFuIiwgaXNMaXR0bGVFbmRpYW4oKSk7CiAgfQogIHN0YXRpYyBnZXQgaXNFdmFsU3VwcG9ydGVkKCkgewogICAgcmV0dXJuIHNoYWRvdyh0aGlzLCAiaXNFdmFsU3VwcG9ydGVkIiwgaXNFdmFsU3VwcG9ydGVkKCkpOwogIH0KICBzdGF0aWMgZ2V0IGlzT2Zmc2NyZWVuQ2FudmFzU3VwcG9ydGVkKCkgewogICAgcmV0dXJuIHNoYWRvdyh0aGlzLCAiaXNPZmZzY3JlZW5DYW52YXNTdXBwb3J0ZWQiLCB0eXBlb2YgT2Zmc2NyZWVuQ2FudmFzICE9PSAidW5kZWZpbmVkIik7CiAgfQogIHN0YXRpYyBnZXQgcGxhdGZvcm0oKSB7CiAgICBpZiAodHlwZW9mIG5hdmlnYXRvciA9PT0gInVuZGVmaW5lZCIpIHsKICAgICAgcmV0dXJuIHNoYWRvdyh0aGlzLCAicGxhdGZvcm0iLCB7CiAgICAgICAgaXNXaW46IGZhbHNlLAogICAgICAgIGlzTWFjOiBmYWxzZQogICAgICB9KTsKICAgIH0KICAgIHJldHVybiBzaGFkb3codGhpcywgInBsYXRmb3JtIiwgewogICAgICBpc1dpbjogbmF2aWdhdG9yLnBsYXRmb3JtLmluY2x1ZGVzKCJXaW4iKSwKICAgICAgaXNNYWM6IG5hdmlnYXRvci5wbGF0Zm9ybS5pbmNsdWRlcygiTWFjIikKICAgIH0pOwogIH0KICBzdGF0aWMgZ2V0IGlzQ1NTUm91bmRTdXBwb3J0ZWQoKSB7CiAgICByZXR1cm4gc2hhZG93KHRoaXMsICJpc0NTU1JvdW5kU3VwcG9ydGVkIiwgZ2xvYmFsVGhpcy5DU1M/LnN1cHBvcnRzPy4oIndpZHRoOiByb3VuZCgxLjVweCwgMXB4KSIpKTsKICB9Cn0KZXhwb3J0cy5GZWF0dXJlVGVzdCA9IEZlYXR1cmVUZXN0Owpjb25zdCBoZXhOdW1iZXJzID0gWy4uLkFycmF5KDI1Nikua2V5cygpXS5tYXAobiA9PiBuLnRvU3RyaW5nKDE2KS5wYWRTdGFydCgyLCAiMCIpKTsKY2xhc3MgVXRpbCB7CiAgc3RhdGljIG1ha2VIZXhDb2xvcihyLCBnLCBiKSB7CiAgICByZXR1cm4gYCMke2hleE51bWJlcnNbcl19JHtoZXhOdW1iZXJzW2ddfSR7aGV4TnVtYmVyc1tiXX1gOwogIH0KICBzdGF0aWMgc2NhbGVNaW5NYXgodHJhbnNmb3JtLCBtaW5NYXgpIHsKICAgIGxldCB0ZW1wOwogICAgaWYgKHRyYW5zZm9ybVswXSkgewogICAgICBpZiAodHJhbnNmb3JtWzBdIDwgMCkgewogICAgICAgIHRlbXAgPSBtaW5NYXhbMF07CiAgICAgICAgbWluTWF4WzBdID0gbWluTWF4WzFdOwogICAgICAgIG1pbk1heFsxXSA9IHRlbXA7CiAgICAgIH0KICAgICAgbWluTWF4WzBdICo9IHRyYW5zZm9ybVswXTsKICAgICAgbWluTWF4WzFdICo9IHRyYW5zZm9ybVswXTsKICAgICAgaWYgKHRyYW5zZm9ybVszXSA8IDApIHsKICAgICAgICB0ZW1wID0gbWluTWF4WzJdOwogICAgICAgIG1pbk1heFsyXSA9IG1pbk1heFszXTsKICAgICAgICBtaW5NYXhbM10gPSB0ZW1wOwogICAgICB9CiAgICAgIG1pbk1heFsyXSAqPSB0cmFuc2Zvcm1bM107CiAgICAgIG1pbk1heFszXSAqPSB0cmFuc2Zvcm1bM107CiAgICB9IGVsc2UgewogICAgICB0ZW1wID0gbWluTWF4WzBdOwogICAgICBtaW5NYXhbMF0gPSBtaW5NYXhbMl07CiAgICAgIG1pbk1heFsyXSA9IHRlbXA7CiAgICAgIHRlbXAgPSBtaW5NYXhbMV07CiAgICAgIG1pbk1heFsxXSA9IG1pbk1heFszXTsKICAgICAgbWluTWF4WzNdID0gdGVtcDsKICAgICAgaWYgKHRyYW5zZm9ybVsxXSA8IDApIHsKICAgICAgICB0ZW1wID0gbWluTWF4WzJdOwogICAgICAgIG1pbk1heFsyXSA9IG1pbk1heFszXTsKICAgICAgICBtaW5NYXhbM10gPSB0ZW1wOwogICAgICB9CiAgICAgIG1pbk1heFsyXSAqPSB0cmFuc2Zvcm1bMV07CiAgICAgIG1pbk1heFszXSAqPSB0cmFuc2Zvcm1bMV07CiAgICAgIGlmICh0cmFuc2Zvcm1bMl0gPCAwKSB7CiAgICAgICAgdGVtcCA9IG1pbk1heFswXTsKICAgICAgICBtaW5NYXhbMF0gPSBtaW5NYXhbMV07CiAgICAgICAgbWluTWF4WzFdID0gdGVtcDsKICAgICAgfQogICAgICBtaW5NYXhbMF0gKj0gdHJhbnNmb3JtWzJdOwogICAgICBtaW5NYXhbMV0gKj0gdHJhbnNmb3JtWzJdOwogICAgfQogICAgbWluTWF4WzBdICs9IHRyYW5zZm9ybVs0XTsKICAgIG1pbk1heFsxXSArPSB0cmFuc2Zvcm1bNF07CiAgICBtaW5NYXhbMl0gKz0gdHJhbnNmb3JtWzVdOwogICAgbWluTWF4WzNdICs9IHRyYW5zZm9ybVs1XTsKICB9CiAgc3RhdGljIHRyYW5zZm9ybShtMSwgbTIpIHsKICAgIHJldHVybiBbbTFbMF0gKiBtMlswXSArIG0xWzJdICogbTJbMV0sIG0xWzFdICogbTJbMF0gKyBtMVszXSAqIG0yWzFdLCBtMVswXSAqIG0yWzJdICsgbTFbMl0gKiBtMlszXSwgbTFbMV0gKiBtMlsyXSArIG0xWzNdICogbTJbM10sIG0xWzBdICogbTJbNF0gKyBtMVsyXSAqIG0yWzVdICsgbTFbNF0sIG0xWzFdICogbTJbNF0gKyBtMVszXSAqIG0yWzVdICsgbTFbNV1dOwogIH0KICBzdGF0aWMgYXBwbHlUcmFuc2Zvcm0ocCwgbSkgewogICAgY29uc3QgeHQgPSBwWzBdICogbVswXSArIHBbMV0gKiBtWzJdICsgbVs0XTsKICAgIGNvbnN0IHl0ID0gcFswXSAqIG1bMV0gKyBwWzFdICogbVszXSArIG1bNV07CiAgICByZXR1cm4gW3h0LCB5dF07CiAgfQogIHN0YXRpYyBhcHBseUludmVyc2VUcmFuc2Zvcm0ocCwgbSkgewogICAgY29uc3QgZCA9IG1bMF0gKiBtWzNdIC0gbVsxXSAqIG1bMl07CiAgICBjb25zdCB4dCA9IChwWzBdICogbVszXSAtIHBbMV0gKiBtWzJdICsgbVsyXSAqIG1bNV0gLSBtWzRdICogbVszXSkgLyBkOwogICAgY29uc3QgeXQgPSAoLXBbMF0gKiBtWzFdICsgcFsxXSAqIG1bMF0gKyBtWzRdICogbVsxXSAtIG1bNV0gKiBtWzBdKSAvIGQ7CiAgICByZXR1cm4gW3h0LCB5dF07CiAgfQogIHN0YXRpYyBnZXRBeGlhbEFsaWduZWRCb3VuZGluZ0JveChyLCBtKSB7CiAgICBjb25zdCBwMSA9IHRoaXMuYXBwbHlUcmFuc2Zvcm0ociwgbSk7CiAgICBjb25zdCBwMiA9IHRoaXMuYXBwbHlUcmFuc2Zvcm0oci5zbGljZSgyLCA0KSwgbSk7CiAgICBjb25zdCBwMyA9IHRoaXMuYXBwbHlUcmFuc2Zvcm0oW3JbMF0sIHJbM11dLCBtKTsKICAgIGNvbnN0IHA0ID0gdGhpcy5hcHBseVRyYW5zZm9ybShbclsyXSwgclsxXV0sIG0pOwogICAgcmV0dXJuIFtNYXRoLm1pbihwMVswXSwgcDJbMF0sIHAzWzBdLCBwNFswXSksIE1hdGgubWluKHAxWzFdLCBwMlsxXSwgcDNbMV0sIHA0WzFdKSwgTWF0aC5tYXgocDFbMF0sIHAyWzBdLCBwM1swXSwgcDRbMF0pLCBNYXRoLm1heChwMVsxXSwgcDJbMV0sIHAzWzFdLCBwNFsxXSldOwogIH0KICBzdGF0aWMgaW52ZXJzZVRyYW5zZm9ybShtKSB7CiAgICBjb25zdCBkID0gbVswXSAqIG1bM10gLSBtWzFdICogbVsyXTsKICAgIHJldHVybiBbbVszXSAvIGQsIC1tWzFdIC8gZCwgLW1bMl0gLyBkLCBtWzBdIC8gZCwgKG1bMl0gKiBtWzVdIC0gbVs0XSAqIG1bM10pIC8gZCwgKG1bNF0gKiBtWzFdIC0gbVs1XSAqIG1bMF0pIC8gZF07CiAgfQogIHN0YXRpYyBzaW5ndWxhclZhbHVlRGVjb21wb3NlMmRTY2FsZShtKSB7CiAgICBjb25zdCB0cmFuc3Bvc2UgPSBbbVswXSwgbVsyXSwgbVsxXSwgbVszXV07CiAgICBjb25zdCBhID0gbVswXSAqIHRyYW5zcG9zZVswXSArIG1bMV0gKiB0cmFuc3Bvc2VbMl07CiAgICBjb25zdCBiID0gbVswXSAqIHRyYW5zcG9zZVsxXSArIG1bMV0gKiB0cmFuc3Bvc2VbM107CiAgICBjb25zdCBjID0gbVsyXSAqIHRyYW5zcG9zZVswXSArIG1bM10gKiB0cmFuc3Bvc2VbMl07CiAgICBjb25zdCBkID0gbVsyXSAqIHRyYW5zcG9zZVsxXSArIG1bM10gKiB0cmFuc3Bvc2VbM107CiAgICBjb25zdCBmaXJzdCA9IChhICsgZCkgLyAyOwogICAgY29uc3Qgc2Vjb25kID0gTWF0aC5zcXJ0KChhICsgZCkgKiogMiAtIDQgKiAoYSAqIGQgLSBjICogYikpIC8gMjsKICAgIGNvbnN0IHN4ID0gZmlyc3QgKyBzZWNvbmQgfHwgMTsKICAgIGNvbnN0IHN5ID0gZmlyc3QgLSBzZWNvbmQgfHwgMTsKICAgIHJldHVybiBbTWF0aC5zcXJ0KHN4KSwgTWF0aC5zcXJ0KHN5KV07CiAgfQogIHN0YXRpYyBub3JtYWxpemVSZWN0KHJlY3QpIHsKICAgIGNvbnN0IHIgPSByZWN0LnNsaWNlKDApOwogICAgaWYgKHJlY3RbMF0gPiByZWN0WzJdKSB7CiAgICAgIHJbMF0gPSByZWN0WzJdOwogICAgICByWzJdID0gcmVjdFswXTsKICAgIH0KICAgIGlmIChyZWN0WzFdID4gcmVjdFszXSkgewogICAgICByWzFdID0gcmVjdFszXTsKICAgICAgclszXSA9IHJlY3RbMV07CiAgICB9CiAgICByZXR1cm4gcjsKICB9CiAgc3RhdGljIGludGVyc2VjdChyZWN0MSwgcmVjdDIpIHsKICAgIGNvbnN0IHhMb3cgPSBNYXRoLm1heChNYXRoLm1pbihyZWN0MVswXSwgcmVjdDFbMl0pLCBNYXRoLm1pbihyZWN0MlswXSwgcmVjdDJbMl0pKTsKICAgIGNvbnN0IHhIaWdoID0gTWF0aC5taW4oTWF0aC5tYXgocmVjdDFbMF0sIHJlY3QxWzJdKSwgTWF0aC5tYXgocmVjdDJbMF0sIHJlY3QyWzJdKSk7CiAgICBpZiAoeExvdyA+IHhIaWdoKSB7CiAgICAgIHJldHVybiBudWxsOwogICAgfQogICAgY29uc3QgeUxvdyA9IE1hdGgubWF4KE1hdGgubWluKHJlY3QxWzFdLCByZWN0MVszXSksIE1hdGgubWluKHJlY3QyWzFdLCByZWN0MlszXSkpOwogICAgY29uc3QgeUhpZ2ggPSBNYXRoLm1pbihNYXRoLm1heChyZWN0MVsxXSwgcmVjdDFbM10pLCBNYXRoLm1heChyZWN0MlsxXSwgcmVjdDJbM10pKTsKICAgIGlmICh5TG93ID4geUhpZ2gpIHsKICAgICAgcmV0dXJuIG51bGw7CiAgICB9CiAgICByZXR1cm4gW3hMb3csIHlMb3csIHhIaWdoLCB5SGlnaF07CiAgfQogIHN0YXRpYyBiZXppZXJCb3VuZGluZ0JveCh4MCwgeTAsIHgxLCB5MSwgeDIsIHkyLCB4MywgeTMpIHsKICAgIGNvbnN0IHR2YWx1ZXMgPSBbXSwKICAgICAgYm91bmRzID0gW1tdLCBbXV07CiAgICBsZXQgYSwgYiwgYywgdCwgdDEsIHQyLCBiMmFjLCBzcXJ0YjJhYzsKICAgIGZvciAobGV0IGkgPSAwOyBpIDwgMjsgKytpKSB7CiAgICAgIGlmIChpID09PSAwKSB7CiAgICAgICAgYiA9IDYgKiB4MCAtIDEyICogeDEgKyA2ICogeDI7CiAgICAgICAgYSA9IC0zICogeDAgKyA5ICogeDEgLSA5ICogeDIgKyAzICogeDM7CiAgICAgICAgYyA9IDMgKiB4MSAtIDMgKiB4MDsKICAgICAgfSBlbHNlIHsKICAgICAgICBiID0gNiAqIHkwIC0gMTIgKiB5MSArIDYgKiB5MjsKICAgICAgICBhID0gLTMgKiB5MCArIDkgKiB5MSAtIDkgKiB5MiArIDMgKiB5MzsKICAgICAgICBjID0gMyAqIHkxIC0gMyAqIHkwOwogICAgICB9CiAgICAgIGlmIChNYXRoLmFicyhhKSA8IDFlLTEyKSB7CiAgICAgICAgaWYgKE1hdGguYWJzKGIpIDwgMWUtMTIpIHsKICAgICAgICAgIGNvbnRpbnVlOwogICAgICAgIH0KICAgICAgICB0ID0gLWMgLyBiOwogICAgICAgIGlmICgwIDwgdCAmJiB0IDwgMSkgewogICAgICAgICAgdHZhbHVlcy5wdXNoKHQpOwogICAgICAgIH0KICAgICAgICBjb250aW51ZTsKICAgICAgfQogICAgICBiMmFjID0gYiAqIGIgLSA0ICogYyAqIGE7CiAgICAgIHNxcnRiMmFjID0gTWF0aC5zcXJ0KGIyYWMpOwogICAgICBpZiAoYjJhYyA8IDApIHsKICAgICAgICBjb250aW51ZTsKICAgICAgfQogICAgICB0MSA9ICgtYiArIHNxcnRiMmFjKSAvICgyICogYSk7CiAgICAgIGlmICgwIDwgdDEgJiYgdDEgPCAxKSB7CiAgICAgICAgdHZhbHVlcy5wdXNoKHQxKTsKICAgICAgfQogICAgICB0MiA9ICgtYiAtIHNxcnRiMmFjKSAvICgyICogYSk7CiAgICAgIGlmICgwIDwgdDIgJiYgdDIgPCAxKSB7CiAgICAgICAgdHZhbHVlcy5wdXNoKHQyKTsKICAgICAgfQogICAgfQogICAgbGV0IGogPSB0dmFsdWVzLmxlbmd0aCwKICAgICAgbXQ7CiAgICBjb25zdCBqbGVuID0gajsKICAgIHdoaWxlIChqLS0pIHsKICAgICAgdCA9IHR2YWx1ZXNbal07CiAgICAgIG10ID0gMSAtIHQ7CiAgICAgIGJvdW5kc1swXVtqXSA9IG10ICogbXQgKiBtdCAqIHgwICsgMyAqIG10ICogbXQgKiB0ICogeDEgKyAzICogbXQgKiB0ICogdCAqIHgyICsgdCAqIHQgKiB0ICogeDM7CiAgICAgIGJvdW5kc1sxXVtqXSA9IG10ICogbXQgKiBtdCAqIHkwICsgMyAqIG10ICogbXQgKiB0ICogeTEgKyAzICogbXQgKiB0ICogdCAqIHkyICsgdCAqIHQgKiB0ICogeTM7CiAgICB9CiAgICBib3VuZHNbMF1bamxlbl0gPSB4MDsKICAgIGJvdW5kc1sxXVtqbGVuXSA9IHkwOwogICAgYm91bmRzWzBdW2psZW4gKyAxXSA9IHgzOwogICAgYm91bmRzWzFdW2psZW4gKyAxXSA9IHkzOwogICAgYm91bmRzWzBdLmxlbmd0aCA9IGJvdW5kc1sxXS5sZW5ndGggPSBqbGVuICsgMjsKICAgIHJldHVybiBbTWF0aC5taW4oLi4uYm91bmRzWzBdKSwgTWF0aC5taW4oLi4uYm91bmRzWzFdKSwgTWF0aC5tYXgoLi4uYm91bmRzWzBdKSwgTWF0aC5tYXgoLi4uYm91bmRzWzFdKV07CiAgfQp9CmV4cG9ydHMuVXRpbCA9IFV0aWw7CmNvbnN0IFBERlN0cmluZ1RyYW5zbGF0ZVRhYmxlID0gWzAsIDAsIDAsIDAsIDAsIDAsIDAsIDAsIDAsIDAsIDAsIDAsIDAsIDAsIDAsIDAsIDAsIDAsIDAsIDAsIDAsIDAsIDAsIDAsIDB4MmQ4LCAweDJjNywgMHgyYzYsIDB4MmQ5LCAweDJkZCwgMHgyZGIsIDB4MmRhLCAweDJkYywgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMHgyMDIyLCAweDIwMjAsIDB4MjAyMSwgMHgyMDI2LCAweDIwMTQsIDB4MjAxMywgMHgxOTIsIDB4MjA0NCwgMHgyMDM5LCAweDIwM2EsIDB4MjIxMiwgMHgyMDMwLCAweDIwMWUsIDB4MjAxYywgMHgyMDFkLCAweDIwMTgsIDB4MjAxOSwgMHgyMDFhLCAweDIxMjIsIDB4ZmIwMSwgMHhmYjAyLCAweDE0MSwgMHgxNTIsIDB4MTYwLCAweDE3OCwgMHgxN2QsIDB4MTMxLCAweDE0MiwgMHgxNTMsIDB4MTYxLCAweDE3ZSwgMCwgMHgyMGFjXTsKZnVuY3Rpb24gc3RyaW5nVG9QREZTdHJpbmcoc3RyKSB7CiAgaWYgKHN0clswXSA+PSAiXHhFRiIpIHsKICAgIGxldCBlbmNvZGluZzsKICAgIGlmIChzdHJbMF0gPT09ICJceEZFIiAmJiBzdHJbMV0gPT09ICJceEZGIikgewogICAgICBlbmNvZGluZyA9ICJ1dGYtMTZiZSI7CiAgICB9IGVsc2UgaWYgKHN0clswXSA9PT0gIlx4RkYiICYmIHN0clsxXSA9PT0gIlx4RkUiKSB7CiAgICAgIGVuY29kaW5nID0gInV0Zi0xNmxlIjsKICAgIH0gZWxzZSBpZiAoc3RyWzBdID09PSAiXHhFRiIgJiYgc3RyWzFdID09PSAiXHhCQiIgJiYgc3RyWzJdID09PSAiXHhCRiIpIHsKICAgICAgZW5jb2RpbmcgPSAidXRmLTgiOwogICAgfQogICAgaWYgKGVuY29kaW5nKSB7CiAgICAgIHRyeSB7CiAgICAgICAgY29uc3QgZGVjb2RlciA9IG5ldyBUZXh0RGVjb2RlcihlbmNvZGluZywgewogICAgICAgICAgZmF0YWw6IHRydWUKICAgICAgICB9KTsKICAgICAgICBjb25zdCBidWZmZXIgPSBzdHJpbmdUb0J5dGVzKHN0cik7CiAgICAgICAgcmV0dXJuIGRlY29kZXIuZGVjb2RlKGJ1ZmZlcik7CiAgICAgIH0gY2F0Y2ggKGV4KSB7CiAgICAgICAgd2Fybihgc3RyaW5nVG9QREZTdHJpbmc6ICIke2V4fSIuYCk7CiAgICAgIH0KICAgIH0KICB9CiAgY29uc3Qgc3RyQnVmID0gW107CiAgZm9yIChsZXQgaSA9IDAsIGlpID0gc3RyLmxlbmd0aDsgaSA8IGlpOyBpKyspIHsKICAgIGNvbnN0IGNvZGUgPSBQREZTdHJpbmdUcmFuc2xhdGVUYWJsZVtzdHIuY2hhckNvZGVBdChpKV07CiAgICBzdHJCdWYucHVzaChjb2RlID8gU3RyaW5nLmZyb21DaGFyQ29kZShjb2RlKSA6IHN0ci5jaGFyQXQoaSkpOwogIH0KICByZXR1cm4gc3RyQnVmLmpvaW4oIiIpOwp9CmZ1bmN0aW9uIHN0cmluZ1RvVVRGOFN0cmluZyhzdHIpIHsKICByZXR1cm4gZGVjb2RlVVJJQ29tcG9uZW50KGVzY2FwZShzdHIpKTsKfQpmdW5jdGlvbiB1dGY4U3RyaW5nVG9TdHJpbmcoc3RyKSB7CiAgcmV0dXJuIHVuZXNjYXBlKGVuY29kZVVSSUNvbXBvbmVudChzdHIpKTsKfQpmdW5jdGlvbiBpc0FycmF5QnVmZmVyKHYpIHsKICByZXR1cm4gdHlwZW9mIHYgPT09ICJvYmplY3QiICYmIHY/LmJ5dGVMZW5ndGggIT09IHVuZGVmaW5lZDsKfQpmdW5jdGlvbiBpc0FycmF5RXF1YWwoYXJyMSwgYXJyMikgewogIGlmIChhcnIxLmxlbmd0aCAhPT0gYXJyMi5sZW5ndGgpIHsKICAgIHJldHVybiBmYWxzZTsKICB9CiAgZm9yIChsZXQgaSA9IDAsIGlpID0gYXJyMS5sZW5ndGg7IGkgPCBpaTsgaSsrKSB7CiAgICBpZiAoYXJyMVtpXSAhPT0gYXJyMltpXSkgewogICAgICByZXR1cm4gZmFsc2U7CiAgICB9CiAgfQogIHJldHVybiB0cnVlOwp9CmZ1bmN0aW9uIGdldE1vZGlmaWNhdGlvbkRhdGUoZGF0ZSA9IG5ldyBEYXRlKCkpIHsKICBjb25zdCBidWZmZXIgPSBbZGF0ZS5nZXRVVENGdWxsWWVhcigpLnRvU3RyaW5nKCksIChkYXRlLmdldFVUQ01vbnRoKCkgKyAxKS50b1N0cmluZygpLnBhZFN0YXJ0KDIsICIwIiksIGRhdGUuZ2V0VVRDRGF0ZSgpLnRvU3RyaW5nKCkucGFkU3RhcnQoMiwgIjAiKSwgZGF0ZS5nZXRVVENIb3VycygpLnRvU3RyaW5nKCkucGFkU3RhcnQoMiwgIjAiKSwgZGF0ZS5nZXRVVENNaW51dGVzKCkudG9TdHJpbmcoKS5wYWRTdGFydCgyLCAiMCIpLCBkYXRlLmdldFVUQ1NlY29uZHMoKS50b1N0cmluZygpLnBhZFN0YXJ0KDIsICIwIildOwogIHJldHVybiBidWZmZXIuam9pbigiIik7Cn0KY2xhc3MgUHJvbWlzZUNhcGFiaWxpdHkgewogICNzZXR0bGVkID0gZmFsc2U7CiAgY29uc3RydWN0b3IoKSB7CiAgICB0aGlzLnByb21pc2UgPSBuZXcgUHJvbWlzZSgocmVzb2x2ZSwgcmVqZWN0KSA9PiB7CiAgICAgIHRoaXMucmVzb2x2ZSA9IGRhdGEgPT4gewogICAgICAgIHRoaXMuI3NldHRsZWQgPSB0cnVlOwogICAgICAgIHJlc29sdmUoZGF0YSk7CiAgICAgIH07CiAgICAgIHRoaXMucmVqZWN0ID0gcmVhc29uID0+IHsKICAgICAgICB0aGlzLiNzZXR0bGVkID0gdHJ1ZTsKICAgICAgICByZWplY3QocmVhc29uKTsKICAgICAgfTsKICAgIH0pOwogIH0KICBnZXQgc2V0dGxlZCgpIHsKICAgIHJldHVybiB0aGlzLiNzZXR0bGVkOwogIH0KfQpleHBvcnRzLlByb21pc2VDYXBhYmlsaXR5ID0gUHJvbWlzZUNhcGFiaWxpdHk7CmxldCBOb3JtYWxpemVSZWdleCA9IG51bGw7CmxldCBOb3JtYWxpemF0aW9uTWFwID0gbnVsbDsKZnVuY3Rpb24gbm9ybWFsaXplVW5pY29kZShzdHIpIHsKICBpZiAoIU5vcm1hbGl6ZVJlZ2V4KSB7CiAgICBOb3JtYWxpemVSZWdleCA9IC8oW1x1MDBhMFx1MDBiNVx1MDM3ZVx1MGViM1x1MjAwMC1cdTIwMGFcdTIwMmZcdTIxMjZcdWZiMDAtXHVmYjA0XHVmYjA2XHVmYjIwLVx1ZmIzNlx1ZmIzOC1cdWZiM2NcdWZiM2VcdWZiNDAtXHVmYjQxXHVmYjQzLVx1ZmI0NFx1ZmI0Ni1cdWZiYTFcdWZiYTQtXHVmYmE5XHVmYmFlLVx1ZmJiMVx1ZmJkMy1cdWZiZGNcdWZiZGUtXHVmYmU3XHVmYmVhLVx1ZmJmOFx1ZmJmYy1cdWZiZmRcdWZjMDAtXHVmYzVkXHVmYzY0LVx1ZmNmMVx1ZmNmNS1cdWZkM2RcdWZkODhcdWZkZjRcdWZkZmEtXHVmZGZiXHVmZTcxXHVmZTc3XHVmZTc5XHVmZTdiXHVmZTdkXSspfChcdWZiMDUrKS9ndTsKICAgIE5vcm1hbGl6YXRpb25NYXAgPSBuZXcgTWFwKFtbIu+shSIsICLFv3QiXV0pOwogIH0KICByZXR1cm4gc3RyLnJlcGxhY2VBbGwoTm9ybWFsaXplUmVnZXgsIChfLCBwMSwgcDIpID0+IHsKICAgIHJldHVybiBwMSA/IHAxLm5vcm1hbGl6ZSgiTkZLQyIpIDogTm9ybWFsaXphdGlvbk1hcC5nZXQocDIpOwogIH0pOwp9CmZ1bmN0aW9uIGdldFV1aWQoKSB7CiAgaWYgKHR5cGVvZiBjcnlwdG8gIT09ICJ1bmRlZmluZWQiICYmIHR5cGVvZiBjcnlwdG8/LnJhbmRvbVVVSUQgPT09ICJmdW5jdGlvbiIpIHsKICAgIHJldHVybiBjcnlwdG8ucmFuZG9tVVVJRCgpOwogIH0KICBjb25zdCBidWYgPSBuZXcgVWludDhBcnJheSgzMik7CiAgaWYgKHR5cGVvZiBjcnlwdG8gIT09ICJ1bmRlZmluZWQiICYmIHR5cGVvZiBjcnlwdG8/LmdldFJhbmRvbVZhbHVlcyA9PT0gImZ1bmN0aW9uIikgewogICAgY3J5cHRvLmdldFJhbmRvbVZhbHVlcyhidWYpOwogIH0gZWxzZSB7CiAgICBmb3IgKGxldCBpID0gMDsgaSA8IDMyOyBpKyspIHsKICAgICAgYnVmW2ldID0gTWF0aC5mbG9vcihNYXRoLnJhbmRvbSgpICogMjU1KTsKICAgIH0KICB9CiAgcmV0dXJuIGJ5dGVzVG9TdHJpbmcoYnVmKTsKfQpjb25zdCBBbm5vdGF0aW9uUHJlZml4ID0gInBkZmpzX2ludGVybmFsX2lkXyI7CmV4cG9ydHMuQW5ub3RhdGlvblByZWZpeCA9IEFubm90YXRpb25QcmVmaXg7CgovKioqLyB9KSwKLyogMyAqLwovKioqLyAoKF9fdW51c2VkX3dlYnBhY2tfbW9kdWxlLCBleHBvcnRzLCBfX3dfcGRmanNfcmVxdWlyZV9fKSA9PiB7CgoKCk9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCAiX19lc01vZHVsZSIsICh7CiAgdmFsdWU6IHRydWUKfSkpOwpleHBvcnRzLlhSZWZQYXJzZUV4Y2VwdGlvbiA9IGV4cG9ydHMuWFJlZkVudHJ5RXhjZXB0aW9uID0gZXhwb3J0cy5QYXJzZXJFT0ZFeGNlcHRpb24gPSBleHBvcnRzLlBERl9WRVJTSU9OX1JFR0VYUCA9IGV4cG9ydHMuTWlzc2luZ0RhdGFFeGNlcHRpb24gPSB2b2lkIDA7CmV4cG9ydHMuYXJyYXlCdWZmZXJzVG9CeXRlcyA9IGFycmF5QnVmZmVyc1RvQnl0ZXM7CmV4cG9ydHMuY29sbGVjdEFjdGlvbnMgPSBjb2xsZWN0QWN0aW9uczsKZXhwb3J0cy5lbmNvZGVUb1htbFN0cmluZyA9IGVuY29kZVRvWG1sU3RyaW5nOwpleHBvcnRzLmVzY2FwZVBERk5hbWUgPSBlc2NhcGVQREZOYW1lOwpleHBvcnRzLmVzY2FwZVN0cmluZyA9IGVzY2FwZVN0cmluZzsKZXhwb3J0cy5nZXRJbmhlcml0YWJsZVByb3BlcnR5ID0gZ2V0SW5oZXJpdGFibGVQcm9wZXJ0eTsKZXhwb3J0cy5nZXRMb29rdXBUYWJsZUZhY3RvcnkgPSBnZXRMb29rdXBUYWJsZUZhY3Rvcnk7CmV4cG9ydHMuZ2V0TmV3QW5ub3RhdGlvbnNNYXAgPSBnZXROZXdBbm5vdGF0aW9uc01hcDsKZXhwb3J0cy5nZXRSb3RhdGlvbk1hdHJpeCA9IGdldFJvdGF0aW9uTWF0cml4OwpleHBvcnRzLmlzQXNjaWkgPSBpc0FzY2lpOwpleHBvcnRzLmlzV2hpdGVTcGFjZSA9IGlzV2hpdGVTcGFjZTsKZXhwb3J0cy5sb2cyID0gbG9nMjsKZXhwb3J0cy5udW1iZXJUb1N0cmluZyA9IG51bWJlclRvU3RyaW5nOwpleHBvcnRzLnBhcnNlWEZBUGF0aCA9IHBhcnNlWEZBUGF0aDsKZXhwb3J0cy5yZWFkSW50OCA9IHJlYWRJbnQ4OwpleHBvcnRzLnJlYWRVaW50MTYgPSByZWFkVWludDE2OwpleHBvcnRzLnJlYWRVaW50MzIgPSByZWFkVWludDMyOwpleHBvcnRzLnJlY292ZXJKc1VSTCA9IHJlY292ZXJKc1VSTDsKZXhwb3J0cy5zdHJpbmdUb1VURjE2SGV4U3RyaW5nID0gc3RyaW5nVG9VVEYxNkhleFN0cmluZzsKZXhwb3J0cy5zdHJpbmdUb1VURjE2U3RyaW5nID0gc3RyaW5nVG9VVEYxNlN0cmluZzsKZXhwb3J0cy50b1JvbWFuTnVtZXJhbHMgPSB0b1JvbWFuTnVtZXJhbHM7CmV4cG9ydHMudmFsaWRhdGVDU1NGb250ID0gdmFsaWRhdGVDU1NGb250OwpleHBvcnRzLnZhbGlkYXRlRm9udE5hbWUgPSB2YWxpZGF0ZUZvbnROYW1lOwp2YXIgX3V0aWwgPSBfX3dfcGRmanNfcmVxdWlyZV9fKDIpOwp2YXIgX3ByaW1pdGl2ZXMgPSBfX3dfcGRmanNfcmVxdWlyZV9fKDQpOwp2YXIgX2Jhc2Vfc3RyZWFtID0gX193X3BkZmpzX3JlcXVpcmVfXyg1KTsKY29uc3QgUERGX1ZFUlNJT05fUkVHRVhQID0gL15bMS05XVwuXGQkLzsKZXhwb3J0cy5QREZfVkVSU0lPTl9SRUdFWFAgPSBQREZfVkVSU0lPTl9SRUdFWFA7CmZ1bmN0aW9uIGdldExvb2t1cFRhYmxlRmFjdG9yeShpbml0aWFsaXplcikgewogIGxldCBsb29rdXA7CiAgcmV0dXJuIGZ1bmN0aW9uICgpIHsKICAgIGlmIChpbml0aWFsaXplcikgewogICAgICBsb29rdXAgPSBPYmplY3QuY3JlYXRlKG51bGwpOwogICAgICBpbml0aWFsaXplcihsb29rdXApOwogICAgICBpbml0aWFsaXplciA9IG51bGw7CiAgICB9CiAgICByZXR1cm4gbG9va3VwOwogIH07Cn0KY2xhc3MgTWlzc2luZ0RhdGFFeGNlcHRpb24gZXh0ZW5kcyBfdXRpbC5CYXNlRXhjZXB0aW9uIHsKICBjb25zdHJ1Y3RvcihiZWdpbiwgZW5kKSB7CiAgICBzdXBlcihgTWlzc2luZyBkYXRhIFske2JlZ2lufSwgJHtlbmR9KWAsICJNaXNzaW5nRGF0YUV4Y2VwdGlvbiIpOwogICAgdGhpcy5iZWdpbiA9IGJlZ2luOwogICAgdGhpcy5lbmQgPSBlbmQ7CiAgfQp9CmV4cG9ydHMuTWlzc2luZ0RhdGFFeGNlcHRpb24gPSBNaXNzaW5nRGF0YUV4Y2VwdGlvbjsKY2xhc3MgUGFyc2VyRU9GRXhjZXB0aW9uIGV4dGVuZHMgX3V0aWwuQmFzZUV4Y2VwdGlvbiB7CiAgY29uc3RydWN0b3IobXNnKSB7CiAgICBzdXBlcihtc2csICJQYXJzZXJFT0ZFeGNlcHRpb24iKTsKICB9Cn0KZXhwb3J0cy5QYXJzZXJFT0ZFeGNlcHRpb24gPSBQYXJzZXJFT0ZFeGNlcHRpb247CmNsYXNzIFhSZWZFbnRyeUV4Y2VwdGlvbiBleHRlbmRzIF91dGlsLkJhc2VFeGNlcHRpb24gewogIGNvbnN0cnVjdG9yKG1zZykgewogICAgc3VwZXIobXNnLCAiWFJlZkVudHJ5RXhjZXB0aW9uIik7CiAgfQp9CmV4cG9ydHMuWFJlZkVudHJ5RXhjZXB0aW9uID0gWFJlZkVudHJ5RXhjZXB0aW9uOwpjbGFzcyBYUmVmUGFyc2VFeGNlcHRpb24gZXh0ZW5kcyBfdXRpbC5CYXNlRXhjZXB0aW9uIHsKICBjb25zdHJ1Y3Rvcihtc2cpIHsKICAgIHN1cGVyKG1zZywgIlhSZWZQYXJzZUV4Y2VwdGlvbiIpOwogIH0KfQpleHBvcnRzLlhSZWZQYXJzZUV4Y2VwdGlvbiA9IFhSZWZQYXJzZUV4Y2VwdGlvbjsKZnVuY3Rpb24gYXJyYXlCdWZmZXJzVG9CeXRlcyhhcnIpIHsKICBjb25zdCBsZW5ndGggPSBhcnIubGVuZ3RoOwogIGlmIChsZW5ndGggPT09IDApIHsKICAgIHJldHVybiBuZXcgVWludDhBcnJheSgwKTsKICB9CiAgaWYgKGxlbmd0aCA9PT0gMSkgewogICAgcmV0dXJuIG5ldyBVaW50OEFycmF5KGFyclswXSk7CiAgfQogIGxldCBkYXRhTGVuZ3RoID0gMDsKICBmb3IgKGxldCBpID0gMDsgaSA8IGxlbmd0aDsgaSsrKSB7CiAgICBkYXRhTGVuZ3RoICs9IGFycltpXS5ieXRlTGVuZ3RoOwogIH0KICBjb25zdCBkYXRhID0gbmV3IFVpbnQ4QXJyYXkoZGF0YUxlbmd0aCk7CiAgbGV0IHBvcyA9IDA7CiAgZm9yIChsZXQgaSA9IDA7IGkgPCBsZW5ndGg7IGkrKykgewogICAgY29uc3QgaXRlbSA9IG5ldyBVaW50OEFycmF5KGFycltpXSk7CiAgICBkYXRhLnNldChpdGVtLCBwb3MpOwogICAgcG9zICs9IGl0ZW0uYnl0ZUxlbmd0aDsKICB9CiAgcmV0dXJuIGRhdGE7Cn0KZnVuY3Rpb24gZ2V0SW5oZXJpdGFibGVQcm9wZXJ0eSh7CiAgZGljdCwKICBrZXksCiAgZ2V0QXJyYXkgPSBmYWxzZSwKICBzdG9wV2hlbkZvdW5kID0gdHJ1ZQp9KSB7CiAgbGV0IHZhbHVlczsKICBjb25zdCB2aXNpdGVkID0gbmV3IF9wcmltaXRpdmVzLlJlZlNldCgpOwogIHdoaWxlIChkaWN0IGluc3RhbmNlb2YgX3ByaW1pdGl2ZXMuRGljdCAmJiAhKGRpY3Qub2JqSWQgJiYgdmlzaXRlZC5oYXMoZGljdC5vYmpJZCkpKSB7CiAgICBpZiAoZGljdC5vYmpJZCkgewogICAgICB2aXNpdGVkLnB1dChkaWN0Lm9iaklkKTsKICAgIH0KICAgIGNvbnN0IHZhbHVlID0gZ2V0QXJyYXkgPyBkaWN0LmdldEFycmF5KGtleSkgOiBkaWN0LmdldChrZXkpOwogICAgaWYgKHZhbHVlICE9PSB1bmRlZmluZWQpIHsKICAgICAgaWYgKHN0b3BXaGVuRm91bmQpIHsKICAgICAgICByZXR1cm4gdmFsdWU7CiAgICAgIH0KICAgICAgKHZhbHVlcyB8fD0gW10pLnB1c2godmFsdWUpOwogICAgfQogICAgZGljdCA9IGRpY3QuZ2V0KCJQYXJlbnQiKTsKICB9CiAgcmV0dXJuIHZhbHVlczsKfQpjb25zdCBST01BTl9OVU1CRVJfTUFQID0gWyIiLCAiQyIsICJDQyIsICJDQ0MiLCAiQ0QiLCAiRCIsICJEQyIsICJEQ0MiLCAiRENDQyIsICJDTSIsICIiLCAiWCIsICJYWCIsICJYWFgiLCAiWEwiLCAiTCIsICJMWCIsICJMWFgiLCAiTFhYWCIsICJYQyIsICIiLCAiSSIsICJJSSIsICJJSUkiLCAiSVYiLCAiViIsICJWSSIsICJWSUkiLCAiVklJSSIsICJJWCJdOwpmdW5jdGlvbiB0b1JvbWFuTnVtZXJhbHMobnVtYmVyLCBsb3dlckNhc2UgPSBmYWxzZSkgewogICgwLCBfdXRpbC5hc3NlcnQpKE51bWJlci5pc0ludGVnZXIobnVtYmVyKSAmJiBudW1iZXIgPiAwLCAiVGhlIG51bWJlciBzaG91bGQgYmUgYSBwb3NpdGl2ZSBpbnRlZ2VyLiIpOwogIGNvbnN0IHJvbWFuQnVmID0gW107CiAgbGV0IHBvczsKICB3aGlsZSAobnVtYmVyID49IDEwMDApIHsKICAgIG51bWJlciAtPSAxMDAwOwogICAgcm9tYW5CdWYucHVzaCgiTSIpOwogIH0KICBwb3MgPSBudW1iZXIgLyAxMDAgfCAwOwogIG51bWJlciAlPSAxMDA7CiAgcm9tYW5CdWYucHVzaChST01BTl9OVU1CRVJfTUFQW3Bvc10pOwogIHBvcyA9IG51bWJlciAvIDEwIHwgMDsKICBudW1iZXIgJT0gMTA7CiAgcm9tYW5CdWYucHVzaChST01BTl9OVU1CRVJfTUFQWzEwICsgcG9zXSk7CiAgcm9tYW5CdWYucHVzaChST01BTl9OVU1CRVJfTUFQWzIwICsgbnVtYmVyXSk7CiAgY29uc3Qgcm9tYW5TdHIgPSByb21hbkJ1Zi5qb2luKCIiKTsKICByZXR1cm4gbG93ZXJDYXNlID8gcm9tYW5TdHIudG9Mb3dlckNhc2UoKSA6IHJvbWFuU3RyOwp9CmZ1bmN0aW9uIGxvZzIoeCkgewogIGlmICh4IDw9IDApIHsKICAgIHJldHVybiAwOwogIH0KICByZXR1cm4gTWF0aC5jZWlsKE1hdGgubG9nMih4KSk7Cn0KZnVuY3Rpb24gcmVhZEludDgoZGF0YSwgb2Zmc2V0KSB7CiAgcmV0dXJuIGRhdGFbb2Zmc2V0XSA8PCAyNCA+PiAyNDsKfQpmdW5jdGlvbiByZWFkVWludDE2KGRhdGEsIG9mZnNldCkgewogIHJldHVybiBkYXRhW29mZnNldF0gPDwgOCB8IGRhdGFbb2Zmc2V0ICsgMV07Cn0KZnVuY3Rpb24gcmVhZFVpbnQzMihkYXRhLCBvZmZzZXQpIHsKICByZXR1cm4gKGRhdGFbb2Zmc2V0XSA8PCAyNCB8IGRhdGFbb2Zmc2V0ICsgMV0gPDwgMTYgfCBkYXRhW29mZnNldCArIDJdIDw8IDggfCBkYXRhW29mZnNldCArIDNdKSA+Pj4gMDsKfQpmdW5jdGlvbiBpc1doaXRlU3BhY2UoY2gpIHsKICByZXR1cm4gY2ggPT09IDB4MjAgfHwgY2ggPT09IDB4MDkgfHwgY2ggPT09IDB4MGQgfHwgY2ggPT09IDB4MGE7Cn0KZnVuY3Rpb24gcGFyc2VYRkFQYXRoKHBhdGgpIHsKICBjb25zdCBwb3NpdGlvblBhdHRlcm4gPSAvKC4rKVxbKFxkKylcXSQvOwogIHJldHVybiBwYXRoLnNwbGl0KCIuIikubWFwKGNvbXBvbmVudCA9PiB7CiAgICBjb25zdCBtID0gY29tcG9uZW50Lm1hdGNoKHBvc2l0aW9uUGF0dGVybik7CiAgICBpZiAobSkgewogICAgICByZXR1cm4gewogICAgICAgIG5hbWU6IG1bMV0sCiAgICAgICAgcG9zOiBwYXJzZUludChtWzJdLCAxMCkKICAgICAgfTsKICAgIH0KICAgIHJldHVybiB7CiAgICAgIG5hbWU6IGNvbXBvbmVudCwKICAgICAgcG9zOiAwCiAgICB9OwogIH0pOwp9CmZ1bmN0aW9uIGVzY2FwZVBERk5hbWUoc3RyKSB7CiAgY29uc3QgYnVmZmVyID0gW107CiAgbGV0IHN0YXJ0ID0gMDsKICBmb3IgKGxldCBpID0gMCwgaWkgPSBzdHIubGVuZ3RoOyBpIDwgaWk7IGkrKykgewogICAgY29uc3QgY2hhciA9IHN0ci5jaGFyQ29kZUF0KGkpOwogICAgaWYgKGNoYXIgPCAweDIxIHx8IGNoYXIgPiAweDdlIHx8IGNoYXIgPT09IDB4MjMgfHwgY2hhciA9PT0gMHgyOCB8fCBjaGFyID09PSAweDI5IHx8IGNoYXIgPT09IDB4M2MgfHwgY2hhciA9PT0gMHgzZSB8fCBjaGFyID09PSAweDViIHx8IGNoYXIgPT09IDB4NWQgfHwgY2hhciA9PT0gMHg3YiB8fCBjaGFyID09PSAweDdkIHx8IGNoYXIgPT09IDB4MmYgfHwgY2hhciA9PT0gMHgyNSkgewogICAgICBpZiAoc3RhcnQgPCBpKSB7CiAgICAgICAgYnVmZmVyLnB1c2goc3RyLnN1YnN0cmluZyhzdGFydCwgaSkpOwogICAgICB9CiAgICAgIGJ1ZmZlci5wdXNoKGAjJHtjaGFyLnRvU3RyaW5nKDE2KX1gKTsKICAgICAgc3RhcnQgPSBpICsgMTsKICAgIH0KICB9CiAgaWYgKGJ1ZmZlci5sZW5ndGggPT09IDApIHsKICAgIHJldHVybiBzdHI7CiAgfQogIGlmIChzdGFydCA8IHN0ci5sZW5ndGgpIHsKICAgIGJ1ZmZlci5wdXNoKHN0ci5zdWJzdHJpbmcoc3RhcnQsIHN0ci5sZW5ndGgpKTsKICB9CiAgcmV0dXJuIGJ1ZmZlci5qb2luKCIiKTsKfQpmdW5jdGlvbiBlc2NhcGVTdHJpbmcoc3RyKSB7CiAgcmV0dXJuIHN0ci5yZXBsYWNlQWxsKC8oWygpXFxcblxyXSkvZywgbWF0Y2ggPT4gewogICAgaWYgKG1hdGNoID09PSAiXG4iKSB7CiAgICAgIHJldHVybiAiXFxuIjsKICAgIH0gZWxzZSBpZiAobWF0Y2ggPT09ICJcciIpIHsKICAgICAgcmV0dXJuICJcXHIiOwogICAgfQogICAgcmV0dXJuIGBcXCR7bWF0Y2h9YDsKICB9KTsKfQpmdW5jdGlvbiBfY29sbGVjdEpTKGVudHJ5LCB4cmVmLCBsaXN0LCBwYXJlbnRzKSB7CiAgaWYgKCFlbnRyeSkgewogICAgcmV0dXJuOwogIH0KICBsZXQgcGFyZW50ID0gbnVsbDsKICBpZiAoZW50cnkgaW5zdGFuY2VvZiBfcHJpbWl0aXZlcy5SZWYpIHsKICAgIGlmIChwYXJlbnRzLmhhcyhlbnRyeSkpIHsKICAgICAgcmV0dXJuOwogICAgfQogICAgcGFyZW50ID0gZW50cnk7CiAgICBwYXJlbnRzLnB1dChwYXJlbnQpOwogICAgZW50cnkgPSB4cmVmLmZldGNoKGVudHJ5KTsKICB9CiAgaWYgKEFycmF5LmlzQXJyYXkoZW50cnkpKSB7CiAgICBmb3IgKGNvbnN0IGVsZW1lbnQgb2YgZW50cnkpIHsKICAgICAgX2NvbGxlY3RKUyhlbGVtZW50LCB4cmVmLCBsaXN0LCBwYXJlbnRzKTsKICAgIH0KICB9IGVsc2UgaWYgKGVudHJ5IGluc3RhbmNlb2YgX3ByaW1pdGl2ZXMuRGljdCkgewogICAgaWYgKCgwLCBfcHJpbWl0aXZlcy5pc05hbWUpKGVudHJ5LmdldCgiUyIpLCAiSmF2YVNjcmlwdCIpKSB7CiAgICAgIGNvbnN0IGpzID0gZW50cnkuZ2V0KCJKUyIpOwogICAgICBsZXQgY29kZTsKICAgICAgaWYgKGpzIGluc3RhbmNlb2YgX2Jhc2Vfc3RyZWFtLkJhc2VTdHJlYW0pIHsKICAgICAgICBjb2RlID0ganMuZ2V0U3RyaW5nKCk7CiAgICAgIH0gZWxzZSBpZiAodHlwZW9mIGpzID09PSAic3RyaW5nIikgewogICAgICAgIGNvZGUgPSBqczsKICAgICAgfQogICAgICBjb2RlICYmPSAoMCwgX3V0aWwuc3RyaW5nVG9QREZTdHJpbmcpKGNvZGUpLnJlcGxhY2VBbGwoIlx4MDAiLCAiIik7CiAgICAgIGlmIChjb2RlKSB7CiAgICAgICAgbGlzdC5wdXNoKGNvZGUpOwogICAgICB9CiAgICB9CiAgICBfY29sbGVjdEpTKGVudHJ5LmdldFJhdygiTmV4dCIpLCB4cmVmLCBsaXN0LCBwYXJlbnRzKTsKICB9CiAgaWYgKHBhcmVudCkgewogICAgcGFyZW50cy5yZW1vdmUocGFyZW50KTsKICB9Cn0KZnVuY3Rpb24gY29sbGVjdEFjdGlvbnMoeHJlZiwgZGljdCwgZXZlbnRUeXBlKSB7CiAgY29uc3QgYWN0aW9ucyA9IE9iamVjdC5jcmVhdGUobnVsbCk7CiAgY29uc3QgYWRkaXRpb25hbEFjdGlvbnNEaWN0cyA9IGdldEluaGVyaXRhYmxlUHJvcGVydHkoewogICAgZGljdCwKICAgIGtleTogIkFBIiwKICAgIHN0b3BXaGVuRm91bmQ6IGZhbHNlCiAgfSk7CiAgaWYgKGFkZGl0aW9uYWxBY3Rpb25zRGljdHMpIHsKICAgIGZvciAobGV0IGkgPSBhZGRpdGlvbmFsQWN0aW9uc0RpY3RzLmxlbmd0aCAtIDE7IGkgPj0gMDsgaS0tKSB7CiAgICAgIGNvbnN0IGFkZGl0aW9uYWxBY3Rpb25zID0gYWRkaXRpb25hbEFjdGlvbnNEaWN0c1tpXTsKICAgICAgaWYgKCEoYWRkaXRpb25hbEFjdGlvbnMgaW5zdGFuY2VvZiBfcHJpbWl0aXZlcy5EaWN0KSkgewogICAgICAgIGNvbnRpbnVlOwogICAgICB9CiAgICAgIGZvciAoY29uc3Qga2V5IG9mIGFkZGl0aW9uYWxBY3Rpb25zLmdldEtleXMoKSkgewogICAgICAgIGNvbnN0IGFjdGlvbiA9IGV2ZW50VHlwZVtrZXldOwogICAgICAgIGlmICghYWN0aW9uKSB7CiAgICAgICAgICBjb250aW51ZTsKICAgICAgICB9CiAgICAgICAgY29uc3QgYWN0aW9uRGljdCA9IGFkZGl0aW9uYWxBY3Rpb25zLmdldFJhdyhrZXkpOwogICAgICAgIGNvbnN0IHBhcmVudHMgPSBuZXcgX3ByaW1pdGl2ZXMuUmVmU2V0KCk7CiAgICAgICAgY29uc3QgbGlzdCA9IFtdOwogICAgICAgIF9jb2xsZWN0SlMoYWN0aW9uRGljdCwgeHJlZiwgbGlzdCwgcGFyZW50cyk7CiAgICAgICAgaWYgKGxpc3QubGVuZ3RoID4gMCkgewogICAgICAgICAgYWN0aW9uc1thY3Rpb25dID0gbGlzdDsKICAgICAgICB9CiAgICAgIH0KICAgIH0KICB9CiAgaWYgKGRpY3QuaGFzKCJBIikpIHsKICAgIGNvbnN0IGFjdGlvbkRpY3QgPSBkaWN0LmdldCgiQSIpOwogICAgY29uc3QgcGFyZW50cyA9IG5ldyBfcHJpbWl0aXZlcy5SZWZTZXQoKTsKICAgIGNvbnN0IGxpc3QgPSBbXTsKICAgIF9jb2xsZWN0SlMoYWN0aW9uRGljdCwgeHJlZiwgbGlzdCwgcGFyZW50cyk7CiAgICBpZiAobGlzdC5sZW5ndGggPiAwKSB7CiAgICAgIGFjdGlvbnMuQWN0aW9uID0gbGlzdDsKICAgIH0KICB9CiAgcmV0dXJuICgwLCBfdXRpbC5vYmplY3RTaXplKShhY3Rpb25zKSA+IDAgPyBhY3Rpb25zIDogbnVsbDsKfQpjb25zdCBYTUxFbnRpdGllcyA9IHsKICAweDNjOiAiJmx0OyIsCiAgMHgzZTogIiZndDsiLAogIDB4MjY6ICImYW1wOyIsCiAgMHgyMjogIiZxdW90OyIsCiAgMHgyNzogIiZhcG9zOyIKfTsKZnVuY3Rpb24gZW5jb2RlVG9YbWxTdHJpbmcoc3RyKSB7CiAgY29uc3QgYnVmZmVyID0gW107CiAgbGV0IHN0YXJ0ID0gMDsKICBmb3IgKGxldCBpID0gMCwgaWkgPSBzdHIubGVuZ3RoOyBpIDwgaWk7IGkrKykgewogICAgY29uc3QgY2hhciA9IHN0ci5jb2RlUG9pbnRBdChpKTsKICAgIGlmICgweDIwIDw9IGNoYXIgJiYgY2hhciA8PSAweDdlKSB7CiAgICAgIGNvbnN0IGVudGl0eSA9IFhNTEVudGl0aWVzW2NoYXJdOwogICAgICBpZiAoZW50aXR5KSB7CiAgICAgICAgaWYgKHN0YXJ0IDwgaSkgewogICAgICAgICAgYnVmZmVyLnB1c2goc3RyLnN1YnN0cmluZyhzdGFydCwgaSkpOwogICAgICAgIH0KICAgICAgICBidWZmZXIucHVzaChlbnRpdHkpOwogICAgICAgIHN0YXJ0ID0gaSArIDE7CiAgICAgIH0KICAgIH0gZWxzZSB7CiAgICAgIGlmIChzdGFydCA8IGkpIHsKICAgICAgICBidWZmZXIucHVzaChzdHIuc3Vic3RyaW5nKHN0YXJ0LCBpKSk7CiAgICAgIH0KICAgICAgYnVmZmVyLnB1c2goYCYjeCR7Y2hhci50b1N0cmluZygxNikudG9VcHBlckNhc2UoKX07YCk7CiAgICAgIGlmIChjaGFyID4gMHhkN2ZmICYmIChjaGFyIDwgMHhlMDAwIHx8IGNoYXIgPiAweGZmZmQpKSB7CiAgICAgICAgaSsrOwogICAgICB9CiAgICAgIHN0YXJ0ID0gaSArIDE7CiAgICB9CiAgfQogIGlmIChidWZmZXIubGVuZ3RoID09PSAwKSB7CiAgICByZXR1cm4gc3RyOwogIH0KICBpZiAoc3RhcnQgPCBzdHIubGVuZ3RoKSB7CiAgICBidWZmZXIucHVzaChzdHIuc3Vic3RyaW5nKHN0YXJ0LCBzdHIubGVuZ3RoKSk7CiAgfQogIHJldHVybiBidWZmZXIuam9pbigiIik7Cn0KZnVuY3Rpb24gdmFsaWRhdGVGb250TmFtZShmb250RmFtaWx5LCBtdXN0V2FybiA9IGZhbHNlKSB7CiAgY29uc3QgbSA9IC9eKCJ8JykuKigifCcpJC8uZXhlYyhmb250RmFtaWx5KTsKICBpZiAobSAmJiBtWzFdID09PSBtWzJdKSB7CiAgICBjb25zdCByZSA9IG5ldyBSZWdFeHAoYFteXFxcXF0ke21bMV19YCk7CiAgICBpZiAocmUudGVzdChmb250RmFtaWx5LnNsaWNlKDEsIC0xKSkpIHsKICAgICAgaWYgKG11c3RXYXJuKSB7CiAgICAgICAgKDAsIF91dGlsLndhcm4pKGBGb250RmFtaWx5IGNvbnRhaW5zIHVuZXNjYXBlZCAke21bMV19OiAke2ZvbnRGYW1pbHl9LmApOwogICAgICB9CiAgICAgIHJldHVybiBmYWxzZTsKICAgIH0KICB9IGVsc2UgewogICAgZm9yIChjb25zdCBpZGVudCBvZiBmb250RmFtaWx5LnNwbGl0KC9bIFx0XSsvKSkgewogICAgICBpZiAoL14oXGR8KC0oXGR8LSkpKS8udGVzdChpZGVudCkgfHwgIS9eW1x3LVxcXSskLy50ZXN0KGlkZW50KSkgewogICAgICAgIGlmIChtdXN0V2FybikgewogICAgICAgICAgKDAsIF91dGlsLndhcm4pKGBGb250RmFtaWx5IGNvbnRhaW5zIGludmFsaWQgPGN1c3RvbS1pZGVudD46ICR7Zm9udEZhbWlseX0uYCk7CiAgICAgICAgfQogICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgfQogICAgfQogIH0KICByZXR1cm4gdHJ1ZTsKfQpmdW5jdGlvbiB2YWxpZGF0ZUNTU0ZvbnQoY3NzRm9udEluZm8pIHsKICBjb25zdCBERUZBVUxUX0NTU19GT05UX09CTElRVUUgPSAiMTQiOwogIGNvbnN0IERFRkFVTFRfQ1NTX0ZPTlRfV0VJR0hUID0gIjQwMCI7CiAgY29uc3QgQ1NTX0ZPTlRfV0VJR0hUX1ZBTFVFUyA9IG5ldyBTZXQoWyIxMDAiLCAiMjAwIiwgIjMwMCIsICI0MDAiLCAiNTAwIiwgIjYwMCIsICI3MDAiLCAiODAwIiwgIjkwMCIsICIxMDAwIiwgIm5vcm1hbCIsICJib2xkIiwgImJvbGRlciIsICJsaWdodGVyIl0pOwogIGNvbnN0IHsKICAgIGZvbnRGYW1pbHksCiAgICBmb250V2VpZ2h0LAogICAgaXRhbGljQW5nbGUKICB9ID0gY3NzRm9udEluZm87CiAgaWYgKCF2YWxpZGF0ZUZvbnROYW1lKGZvbnRGYW1pbHksIHRydWUpKSB7CiAgICByZXR1cm4gZmFsc2U7CiAgfQogIGNvbnN0IHdlaWdodCA9IGZvbnRXZWlnaHQgPyBmb250V2VpZ2h0LnRvU3RyaW5nKCkgOiAiIjsKICBjc3NGb250SW5mby5mb250V2VpZ2h0ID0gQ1NTX0ZPTlRfV0VJR0hUX1ZBTFVFUy5oYXMod2VpZ2h0KSA/IHdlaWdodCA6IERFRkFVTFRfQ1NTX0ZPTlRfV0VJR0hUOwogIGNvbnN0IGFuZ2xlID0gcGFyc2VGbG9hdChpdGFsaWNBbmdsZSk7CiAgY3NzRm9udEluZm8uaXRhbGljQW5nbGUgPSBpc05hTihhbmdsZSkgfHwgYW5nbGUgPCAtOTAgfHwgYW5nbGUgPiA5MCA/IERFRkFVTFRfQ1NTX0ZPTlRfT0JMSVFVRSA6IGl0YWxpY0FuZ2xlLnRvU3RyaW5nKCk7CiAgcmV0dXJuIHRydWU7Cn0KZnVuY3Rpb24gcmVjb3ZlckpzVVJMKHN0cikgewogIGNvbnN0IFVSTF9PUEVOX01FVEhPRFMgPSBbImFwcC5sYXVuY2hVUkwiLCAid2luZG93Lm9wZW4iLCAieGZhLmhvc3QuZ290b1VSTCJdOwogIGNvbnN0IHJlZ2V4ID0gbmV3IFJlZ0V4cCgiXlxccyooIiArIFVSTF9PUEVOX01FVEhPRFMuam9pbigifCIpLnJlcGxhY2VBbGwoIi4iLCAiXFwuIikgKyAiKVxcKCg/Oid8XCIpKFteJ1wiXSopKD86J3xcIikoPzosXFxzKihcXHcrKVxcKXxcXCkpIiwgImkiKTsKICBjb25zdCBqc1VybCA9IHJlZ2V4LmV4ZWMoc3RyKTsKICBpZiAoanNVcmw/LlsyXSkgewogICAgY29uc3QgdXJsID0ganNVcmxbMl07CiAgICBsZXQgbmV3V2luZG93ID0gZmFsc2U7CiAgICBpZiAoanNVcmxbM10gPT09ICJ0cnVlIiAmJiBqc1VybFsxXSA9PT0gImFwcC5sYXVuY2hVUkwiKSB7CiAgICAgIG5ld1dpbmRvdyA9IHRydWU7CiAgICB9CiAgICByZXR1cm4gewogICAgICB1cmwsCiAgICAgIG5ld1dpbmRvdwogICAgfTsKICB9CiAgcmV0dXJuIG51bGw7Cn0KZnVuY3Rpb24gbnVtYmVyVG9TdHJpbmcodmFsdWUpIHsKICBpZiAoTnVtYmVyLmlzSW50ZWdlcih2YWx1ZSkpIHsKICAgIHJldHVybiB2YWx1ZS50b1N0cmluZygpOwogIH0KICBjb25zdCByb3VuZGVkVmFsdWUgPSBNYXRoLnJvdW5kKHZhbHVlICogMTAwKTsKICBpZiAocm91bmRlZFZhbHVlICUgMTAwID09PSAwKSB7CiAgICByZXR1cm4gKHJvdW5kZWRWYWx1ZSAvIDEwMCkudG9TdHJpbmcoKTsKICB9CiAgaWYgKHJvdW5kZWRWYWx1ZSAlIDEwID09PSAwKSB7CiAgICByZXR1cm4gdmFsdWUudG9GaXhlZCgxKTsKICB9CiAgcmV0dXJuIHZhbHVlLnRvRml4ZWQoMik7Cn0KZnVuY3Rpb24gZ2V0TmV3QW5ub3RhdGlvbnNNYXAoYW5ub3RhdGlvblN0b3JhZ2UpIHsKICBpZiAoIWFubm90YXRpb25TdG9yYWdlKSB7CiAgICByZXR1cm4gbnVsbDsKICB9CiAgY29uc3QgbmV3QW5ub3RhdGlvbnNCeVBhZ2UgPSBuZXcgTWFwKCk7CiAgZm9yIChjb25zdCBba2V5LCB2YWx1ZV0gb2YgYW5ub3RhdGlvblN0b3JhZ2UpIHsKICAgIGlmICgha2V5LnN0YXJ0c1dpdGgoX3V0aWwuQW5ub3RhdGlvbkVkaXRvclByZWZpeCkpIHsKICAgICAgY29udGludWU7CiAgICB9CiAgICBsZXQgYW5ub3RhdGlvbnMgPSBuZXdBbm5vdGF0aW9uc0J5UGFnZS5nZXQodmFsdWUucGFnZUluZGV4KTsKICAgIGlmICghYW5ub3RhdGlvbnMpIHsKICAgICAgYW5ub3RhdGlvbnMgPSBbXTsKICAgICAgbmV3QW5ub3RhdGlvbnNCeVBhZ2Uuc2V0KHZhbHVlLnBhZ2VJbmRleCwgYW5ub3RhdGlvbnMpOwogICAgfQogICAgYW5ub3RhdGlvbnMucHVzaCh2YWx1ZSk7CiAgfQogIHJldHVybiBuZXdBbm5vdGF0aW9uc0J5UGFnZS5zaXplID4gMCA/IG5ld0Fubm90YXRpb25zQnlQYWdlIDogbnVsbDsKfQpmdW5jdGlvbiBpc0FzY2lpKHN0cikgewogIHJldHVybiAvXltceDAwLVx4N0ZdKiQvLnRlc3Qoc3RyKTsKfQpmdW5jdGlvbiBzdHJpbmdUb1VURjE2SGV4U3RyaW5nKHN0cikgewogIGNvbnN0IGJ1ZiA9IFtdOwogIGZvciAobGV0IGkgPSAwLCBpaSA9IHN0ci5sZW5ndGg7IGkgPCBpaTsgaSsrKSB7CiAgICBjb25zdCBjaGFyID0gc3RyLmNoYXJDb2RlQXQoaSk7CiAgICBidWYucHVzaCgoY2hhciA+PiA4ICYgMHhmZikudG9TdHJpbmcoMTYpLnBhZFN0YXJ0KDIsICIwIiksIChjaGFyICYgMHhmZikudG9TdHJpbmcoMTYpLnBhZFN0YXJ0KDIsICIwIikpOwogIH0KICByZXR1cm4gYnVmLmpvaW4oIiIpOwp9CmZ1bmN0aW9uIHN0cmluZ1RvVVRGMTZTdHJpbmcoc3RyLCBiaWdFbmRpYW4gPSBmYWxzZSkgewogIGNvbnN0IGJ1ZiA9IFtdOwogIGlmIChiaWdFbmRpYW4pIHsKICAgIGJ1Zi5wdXNoKCJceEZFXHhGRiIpOwogIH0KICBmb3IgKGxldCBpID0gMCwgaWkgPSBzdHIubGVuZ3RoOyBpIDwgaWk7IGkrKykgewogICAgY29uc3QgY2hhciA9IHN0ci5jaGFyQ29kZUF0KGkpOwogICAgYnVmLnB1c2goU3RyaW5nLmZyb21DaGFyQ29kZShjaGFyID4+IDggJiAweGZmKSwgU3RyaW5nLmZyb21DaGFyQ29kZShjaGFyICYgMHhmZikpOwogIH0KICByZXR1cm4gYnVmLmpvaW4oIiIpOwp9CmZ1bmN0aW9uIGdldFJvdGF0aW9uTWF0cml4KHJvdGF0aW9uLCB3aWR0aCwgaGVpZ2h0KSB7CiAgc3dpdGNoIChyb3RhdGlvbikgewogICAgY2FzZSA5MDoKICAgICAgcmV0dXJuIFswLCAxLCAtMSwgMCwgd2lkdGgsIDBdOwogICAgY2FzZSAxODA6CiAgICAgIHJldHVybiBbLTEsIDAsIDAsIC0xLCB3aWR0aCwgaGVpZ2h0XTsKICAgIGNhc2UgMjcwOgogICAgICByZXR1cm4gWzAsIC0xLCAxLCAwLCAwLCBoZWlnaHRdOwogICAgZGVmYXVsdDoKICAgICAgdGhyb3cgbmV3IEVycm9yKCJJbnZhbGlkIHJvdGF0aW9uIik7CiAgfQp9CgovKioqLyB9KSwKLyogNCAqLwovKioqLyAoKF9fdW51c2VkX3dlYnBhY2tfbW9kdWxlLCBleHBvcnRzLCBfX3dfcGRmanNfcmVxdWlyZV9fKSA9PiB7CgoKCk9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCAiX19lc01vZHVsZSIsICh7CiAgdmFsdWU6IHRydWUKfSkpOwpleHBvcnRzLlJlZlNldENhY2hlID0gZXhwb3J0cy5SZWZTZXQgPSBleHBvcnRzLlJlZiA9IGV4cG9ydHMuTmFtZSA9IGV4cG9ydHMuRU9GID0gZXhwb3J0cy5EaWN0ID0gZXhwb3J0cy5DbWQgPSBleHBvcnRzLkNJUkNVTEFSX1JFRiA9IHZvaWQgMDsKZXhwb3J0cy5jbGVhclByaW1pdGl2ZUNhY2hlcyA9IGNsZWFyUHJpbWl0aXZlQ2FjaGVzOwpleHBvcnRzLmlzQ21kID0gaXNDbWQ7CmV4cG9ydHMuaXNEaWN0ID0gaXNEaWN0OwpleHBvcnRzLmlzTmFtZSA9IGlzTmFtZTsKZXhwb3J0cy5pc1JlZnNFcXVhbCA9IGlzUmVmc0VxdWFsOwp2YXIgX3V0aWwgPSBfX3dfcGRmanNfcmVxdWlyZV9fKDIpOwpjb25zdCBDSVJDVUxBUl9SRUYgPSBTeW1ib2woIkNJUkNVTEFSX1JFRiIpOwpleHBvcnRzLkNJUkNVTEFSX1JFRiA9IENJUkNVTEFSX1JFRjsKY29uc3QgRU9GID0gU3ltYm9sKCJFT0YiKTsKZXhwb3J0cy5FT0YgPSBFT0Y7CmxldCBDbWRDYWNoZSA9IE9iamVjdC5jcmVhdGUobnVsbCk7CmxldCBOYW1lQ2FjaGUgPSBPYmplY3QuY3JlYXRlKG51bGwpOwpsZXQgUmVmQ2FjaGUgPSBPYmplY3QuY3JlYXRlKG51bGwpOwpmdW5jdGlvbiBjbGVhclByaW1pdGl2ZUNhY2hlcygpIHsKICBDbWRDYWNoZSA9IE9iamVjdC5jcmVhdGUobnVsbCk7CiAgTmFtZUNhY2hlID0gT2JqZWN0LmNyZWF0ZShudWxsKTsKICBSZWZDYWNoZSA9IE9iamVjdC5jcmVhdGUobnVsbCk7Cn0KY2xhc3MgTmFtZSB7CiAgY29uc3RydWN0b3IobmFtZSkgewogICAgdGhpcy5uYW1lID0gbmFtZTsKICB9CiAgc3RhdGljIGdldChuYW1lKSB7CiAgICByZXR1cm4gTmFtZUNhY2hlW25hbWVdIHx8PSBuZXcgTmFtZShuYW1lKTsKICB9Cn0KZXhwb3J0cy5OYW1lID0gTmFtZTsKY2xhc3MgQ21kIHsKICBjb25zdHJ1Y3RvcihjbWQpIHsKICAgIHRoaXMuY21kID0gY21kOwogIH0KICBzdGF0aWMgZ2V0KGNtZCkgewogICAgcmV0dXJuIENtZENhY2hlW2NtZF0gfHw9IG5ldyBDbWQoY21kKTsKICB9Cn0KZXhwb3J0cy5DbWQgPSBDbWQ7CmNvbnN0IG5vblNlcmlhbGl6YWJsZSA9IGZ1bmN0aW9uIG5vblNlcmlhbGl6YWJsZUNsb3N1cmUoKSB7CiAgcmV0dXJuIG5vblNlcmlhbGl6YWJsZTsKfTsKY2xhc3MgRGljdCB7CiAgY29uc3RydWN0b3IoeHJlZiA9IG51bGwpIHsKICAgIHRoaXMuX21hcCA9IE9iamVjdC5jcmVhdGUobnVsbCk7CiAgICB0aGlzLnhyZWYgPSB4cmVmOwogICAgdGhpcy5vYmpJZCA9IG51bGw7CiAgICB0aGlzLnN1cHByZXNzRW5jcnlwdGlvbiA9IGZhbHNlOwogICAgdGhpcy5fX25vblNlcmlhbGl6YWJsZV9fID0gbm9uU2VyaWFsaXphYmxlOwogIH0KICBhc3NpZ25YcmVmKG5ld1hyZWYpIHsKICAgIHRoaXMueHJlZiA9IG5ld1hyZWY7CiAgfQogIGdldCBzaXplKCkgewogICAgcmV0dXJuIE9iamVjdC5rZXlzKHRoaXMuX21hcCkubGVuZ3RoOwogIH0KICBnZXQoa2V5MSwga2V5Miwga2V5MykgewogICAgbGV0IHZhbHVlID0gdGhpcy5fbWFwW2tleTFdOwogICAgaWYgKHZhbHVlID09PSB1bmRlZmluZWQgJiYga2V5MiAhPT0gdW5kZWZpbmVkKSB7CiAgICAgIHZhbHVlID0gdGhpcy5fbWFwW2tleTJdOwogICAgICBpZiAodmFsdWUgPT09IHVuZGVmaW5lZCAmJiBrZXkzICE9PSB1bmRlZmluZWQpIHsKICAgICAgICB2YWx1ZSA9IHRoaXMuX21hcFtrZXkzXTsKICAgICAgfQogICAgfQogICAgaWYgKHZhbHVlIGluc3RhbmNlb2YgUmVmICYmIHRoaXMueHJlZikgewogICAgICByZXR1cm4gdGhpcy54cmVmLmZldGNoKHZhbHVlLCB0aGlzLnN1cHByZXNzRW5jcnlwdGlvbik7CiAgICB9CiAgICByZXR1cm4gdmFsdWU7CiAgfQogIGFzeW5jIGdldEFzeW5jKGtleTEsIGtleTIsIGtleTMpIHsKICAgIGxldCB2YWx1ZSA9IHRoaXMuX21hcFtrZXkxXTsKICAgIGlmICh2YWx1ZSA9PT0gdW5kZWZpbmVkICYmIGtleTIgIT09IHVuZGVmaW5lZCkgewogICAgICB2YWx1ZSA9IHRoaXMuX21hcFtrZXkyXTsKICAgICAgaWYgKHZhbHVlID09PSB1bmRlZmluZWQgJiYga2V5MyAhPT0gdW5kZWZpbmVkKSB7CiAgICAgICAgdmFsdWUgPSB0aGlzLl9tYXBba2V5M107CiAgICAgIH0KICAgIH0KICAgIGlmICh2YWx1ZSBpbnN0YW5jZW9mIFJlZiAmJiB0aGlzLnhyZWYpIHsKICAgICAgcmV0dXJuIHRoaXMueHJlZi5mZXRjaEFzeW5jKHZhbHVlLCB0aGlzLnN1cHByZXNzRW5jcnlwdGlvbik7CiAgICB9CiAgICByZXR1cm4gdmFsdWU7CiAgfQogIGdldEFycmF5KGtleTEsIGtleTIsIGtleTMpIHsKICAgIGxldCB2YWx1ZSA9IHRoaXMuX21hcFtrZXkxXTsKICAgIGlmICh2YWx1ZSA9PT0gdW5kZWZpbmVkICYmIGtleTIgIT09IHVuZGVmaW5lZCkgewogICAgICB2YWx1ZSA9IHRoaXMuX21hcFtrZXkyXTsKICAgICAgaWYgKHZhbHVlID09PSB1bmRlZmluZWQgJiYga2V5MyAhPT0gdW5kZWZpbmVkKSB7CiAgICAgICAgdmFsdWUgPSB0aGlzLl9tYXBba2V5M107CiAgICAgIH0KICAgIH0KICAgIGlmICh2YWx1ZSBpbnN0YW5jZW9mIFJlZiAmJiB0aGlzLnhyZWYpIHsKICAgICAgdmFsdWUgPSB0aGlzLnhyZWYuZmV0Y2godmFsdWUsIHRoaXMuc3VwcHJlc3NFbmNyeXB0aW9uKTsKICAgIH0KICAgIGlmIChBcnJheS5pc0FycmF5KHZhbHVlKSkgewogICAgICB2YWx1ZSA9IHZhbHVlLnNsaWNlKCk7CiAgICAgIGZvciAobGV0IGkgPSAwLCBpaSA9IHZhbHVlLmxlbmd0aDsgaSA8IGlpOyBpKyspIHsKICAgICAgICBpZiAodmFsdWVbaV0gaW5zdGFuY2VvZiBSZWYgJiYgdGhpcy54cmVmKSB7CiAgICAgICAgICB2YWx1ZVtpXSA9IHRoaXMueHJlZi5mZXRjaCh2YWx1ZVtpXSwgdGhpcy5zdXBwcmVzc0VuY3J5cHRpb24pOwogICAgICAgIH0KICAgICAgfQogICAgfQogICAgcmV0dXJuIHZhbHVlOwogIH0KICBnZXRSYXcoa2V5KSB7CiAgICByZXR1cm4gdGhpcy5fbWFwW2tleV07CiAgfQogIGdldEtleXMoKSB7CiAgICByZXR1cm4gT2JqZWN0LmtleXModGhpcy5fbWFwKTsKICB9CiAgZ2V0UmF3VmFsdWVzKCkgewogICAgcmV0dXJuIE9iamVjdC52YWx1ZXModGhpcy5fbWFwKTsKICB9CiAgc2V0KGtleSwgdmFsdWUpIHsKICAgIHRoaXMuX21hcFtrZXldID0gdmFsdWU7CiAgfQogIGhhcyhrZXkpIHsKICAgIHJldHVybiB0aGlzLl9tYXBba2V5XSAhPT0gdW5kZWZpbmVkOwogIH0KICBmb3JFYWNoKGNhbGxiYWNrKSB7CiAgICBmb3IgKGNvbnN0IGtleSBpbiB0aGlzLl9tYXApIHsKICAgICAgY2FsbGJhY2soa2V5LCB0aGlzLmdldChrZXkpKTsKICAgIH0KICB9CiAgc3RhdGljIGdldCBlbXB0eSgpIHsKICAgIGNvbnN0IGVtcHR5RGljdCA9IG5ldyBEaWN0KG51bGwpOwogICAgZW1wdHlEaWN0LnNldCA9IChrZXksIHZhbHVlKSA9PiB7CiAgICAgICgwLCBfdXRpbC51bnJlYWNoYWJsZSkoIlNob3VsZCBub3QgY2FsbCBgc2V0YCBvbiB0aGUgZW1wdHkgZGljdGlvbmFyeS4iKTsKICAgIH07CiAgICByZXR1cm4gKDAsIF91dGlsLnNoYWRvdykodGhpcywgImVtcHR5IiwgZW1wdHlEaWN0KTsKICB9CiAgc3RhdGljIG1lcmdlKHsKICAgIHhyZWYsCiAgICBkaWN0QXJyYXksCiAgICBtZXJnZVN1YkRpY3RzID0gZmFsc2UKICB9KSB7CiAgICBjb25zdCBtZXJnZWREaWN0ID0gbmV3IERpY3QoeHJlZiksCiAgICAgIHByb3BlcnRpZXMgPSBuZXcgTWFwKCk7CiAgICBmb3IgKGNvbnN0IGRpY3Qgb2YgZGljdEFycmF5KSB7CiAgICAgIGlmICghKGRpY3QgaW5zdGFuY2VvZiBEaWN0KSkgewogICAgICAgIGNvbnRpbnVlOwogICAgICB9CiAgICAgIGZvciAoY29uc3QgW2tleSwgdmFsdWVdIG9mIE9iamVjdC5lbnRyaWVzKGRpY3QuX21hcCkpIHsKICAgICAgICBsZXQgcHJvcGVydHkgPSBwcm9wZXJ0aWVzLmdldChrZXkpOwogICAgICAgIGlmIChwcm9wZXJ0eSA9PT0gdW5kZWZpbmVkKSB7CiAgICAgICAgICBwcm9wZXJ0eSA9IFtdOwogICAgICAgICAgcHJvcGVydGllcy5zZXQoa2V5LCBwcm9wZXJ0eSk7CiAgICAgICAgfSBlbHNlIGlmICghbWVyZ2VTdWJEaWN0cyB8fCAhKHZhbHVlIGluc3RhbmNlb2YgRGljdCkpIHsKICAgICAgICAgIGNvbnRpbnVlOwogICAgICAgIH0KICAgICAgICBwcm9wZXJ0eS5wdXNoKHZhbHVlKTsKICAgICAgfQogICAgfQogICAgZm9yIChjb25zdCBbbmFtZSwgdmFsdWVzXSBvZiBwcm9wZXJ0aWVzKSB7CiAgICAgIGlmICh2YWx1ZXMubGVuZ3RoID09PSAxIHx8ICEodmFsdWVzWzBdIGluc3RhbmNlb2YgRGljdCkpIHsKICAgICAgICBtZXJnZWREaWN0Ll9tYXBbbmFtZV0gPSB2YWx1ZXNbMF07CiAgICAgICAgY29udGludWU7CiAgICAgIH0KICAgICAgY29uc3Qgc3ViRGljdCA9IG5ldyBEaWN0KHhyZWYpOwogICAgICBmb3IgKGNvbnN0IGRpY3Qgb2YgdmFsdWVzKSB7CiAgICAgICAgZm9yIChjb25zdCBba2V5LCB2YWx1ZV0gb2YgT2JqZWN0LmVudHJpZXMoZGljdC5fbWFwKSkgewogICAgICAgICAgaWYgKHN1YkRpY3QuX21hcFtrZXldID09PSB1bmRlZmluZWQpIHsKICAgICAgICAgICAgc3ViRGljdC5fbWFwW2tleV0gPSB2YWx1ZTsKICAgICAgICAgIH0KICAgICAgICB9CiAgICAgIH0KICAgICAgaWYgKHN1YkRpY3Quc2l6ZSA+IDApIHsKICAgICAgICBtZXJnZWREaWN0Ll9tYXBbbmFtZV0gPSBzdWJEaWN0OwogICAgICB9CiAgICB9CiAgICBwcm9wZXJ0aWVzLmNsZWFyKCk7CiAgICByZXR1cm4gbWVyZ2VkRGljdC5zaXplID4gMCA/IG1lcmdlZERpY3QgOiBEaWN0LmVtcHR5OwogIH0KICBjbG9uZSgpIHsKICAgIGNvbnN0IGRpY3QgPSBuZXcgRGljdCh0aGlzLnhyZWYpOwogICAgZm9yIChjb25zdCBrZXkgb2YgdGhpcy5nZXRLZXlzKCkpIHsKICAgICAgZGljdC5zZXQoa2V5LCB0aGlzLmdldFJhdyhrZXkpKTsKICAgIH0KICAgIHJldHVybiBkaWN0OwogIH0KfQpleHBvcnRzLkRpY3QgPSBEaWN0OwpjbGFzcyBSZWYgewogIGNvbnN0cnVjdG9yKG51bSwgZ2VuKSB7CiAgICB0aGlzLm51bSA9IG51bTsKICAgIHRoaXMuZ2VuID0gZ2VuOwogIH0KICB0b1N0cmluZygpIHsKICAgIGlmICh0aGlzLmdlbiA9PT0gMCkgewogICAgICByZXR1cm4gYCR7dGhpcy5udW19UmA7CiAgICB9CiAgICByZXR1cm4gYCR7dGhpcy5udW19UiR7dGhpcy5nZW59YDsKICB9CiAgc3RhdGljIGZyb21TdHJpbmcoc3RyKSB7CiAgICBjb25zdCByZWYgPSBSZWZDYWNoZVtzdHJdOwogICAgaWYgKHJlZikgewogICAgICByZXR1cm4gcmVmOwogICAgfQogICAgY29uc3QgbSA9IC9eKFxkKylSKFxkKikkLy5leGVjKHN0cik7CiAgICBpZiAoIW0gfHwgbVsxXSA9PT0gIjAiKSB7CiAgICAgIHJldHVybiBudWxsOwogICAgfQogICAgcmV0dXJuIFJlZkNhY2hlW3N0cl0gPSBuZXcgUmVmKHBhcnNlSW50KG1bMV0pLCAhbVsyXSA/IDAgOiBwYXJzZUludChtWzJdKSk7CiAgfQogIHN0YXRpYyBnZXQobnVtLCBnZW4pIHsKICAgIGNvbnN0IGtleSA9IGdlbiA9PT0gMCA/IGAke251bX1SYCA6IGAke251bX1SJHtnZW59YDsKICAgIHJldHVybiBSZWZDYWNoZVtrZXldIHx8PSBuZXcgUmVmKG51bSwgZ2VuKTsKICB9Cn0KZXhwb3J0cy5SZWYgPSBSZWY7CmNsYXNzIFJlZlNldCB7CiAgY29uc3RydWN0b3IocGFyZW50ID0gbnVsbCkgewogICAgdGhpcy5fc2V0ID0gbmV3IFNldChwYXJlbnQ/Ll9zZXQpOwogIH0KICBoYXMocmVmKSB7CiAgICByZXR1cm4gdGhpcy5fc2V0LmhhcyhyZWYudG9TdHJpbmcoKSk7CiAgfQogIHB1dChyZWYpIHsKICAgIHRoaXMuX3NldC5hZGQocmVmLnRvU3RyaW5nKCkpOwogIH0KICByZW1vdmUocmVmKSB7CiAgICB0aGlzLl9zZXQuZGVsZXRlKHJlZi50b1N0cmluZygpKTsKICB9CiAgW1N5bWJvbC5pdGVyYXRvcl0oKSB7CiAgICByZXR1cm4gdGhpcy5fc2V0LnZhbHVlcygpOwogIH0KICBjbGVhcigpIHsKICAgIHRoaXMuX3NldC5jbGVhcigpOwogIH0KfQpleHBvcnRzLlJlZlNldCA9IFJlZlNldDsKY2xhc3MgUmVmU2V0Q2FjaGUgewogIGNvbnN0cnVjdG9yKCkgewogICAgdGhpcy5fbWFwID0gbmV3IE1hcCgpOwogIH0KICBnZXQgc2l6ZSgpIHsKICAgIHJldHVybiB0aGlzLl9tYXAuc2l6ZTsKICB9CiAgZ2V0KHJlZikgewogICAgcmV0dXJuIHRoaXMuX21hcC5nZXQocmVmLnRvU3RyaW5nKCkpOwogIH0KICBoYXMocmVmKSB7CiAgICByZXR1cm4gdGhpcy5fbWFwLmhhcyhyZWYudG9TdHJpbmcoKSk7CiAgfQogIHB1dChyZWYsIG9iaikgewogICAgdGhpcy5fbWFwLnNldChyZWYudG9TdHJpbmcoKSwgb2JqKTsKICB9CiAgcHV0QWxpYXMocmVmLCBhbGlhc1JlZikgewogICAgdGhpcy5fbWFwLnNldChyZWYudG9TdHJpbmcoKSwgdGhpcy5nZXQoYWxpYXNSZWYpKTsKICB9CiAgW1N5bWJvbC5pdGVyYXRvcl0oKSB7CiAgICByZXR1cm4gdGhpcy5fbWFwLnZhbHVlcygpOwogIH0KICBjbGVhcigpIHsKICAgIHRoaXMuX21hcC5jbGVhcigpOwogIH0KfQpleHBvcnRzLlJlZlNldENhY2hlID0gUmVmU2V0Q2FjaGU7CmZ1bmN0aW9uIGlzTmFtZSh2LCBuYW1lKSB7CiAgcmV0dXJuIHYgaW5zdGFuY2VvZiBOYW1lICYmIChuYW1lID09PSB1bmRlZmluZWQgfHwgdi5uYW1lID09PSBuYW1lKTsKfQpmdW5jdGlvbiBpc0NtZCh2LCBjbWQpIHsKICByZXR1cm4gdiBpbnN0YW5jZW9mIENtZCAmJiAoY21kID09PSB1bmRlZmluZWQgfHwgdi5jbWQgPT09IGNtZCk7Cn0KZnVuY3Rpb24gaXNEaWN0KHYsIHR5cGUpIHsKICByZXR1cm4gdiBpbnN0YW5jZW9mIERpY3QgJiYgKHR5cGUgPT09IHVuZGVmaW5lZCB8fCBpc05hbWUodi5nZXQoIlR5cGUiKSwgdHlwZSkpOwp9CmZ1bmN0aW9uIGlzUmVmc0VxdWFsKHYxLCB2MikgewogIHJldHVybiB2MS5udW0gPT09IHYyLm51bSAmJiB2MS5nZW4gPT09IHYyLmdlbjsKfQoKLyoqKi8gfSksCi8qIDUgKi8KLyoqKi8gKChfX3VudXNlZF93ZWJwYWNrX21vZHVsZSwgZXhwb3J0cywgX193X3BkZmpzX3JlcXVpcmVfXykgPT4gewoKCgpPYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgIl9fZXNNb2R1bGUiLCAoewogIHZhbHVlOiB0cnVlCn0pKTsKZXhwb3J0cy5CYXNlU3RyZWFtID0gdm9pZCAwOwp2YXIgX3V0aWwgPSBfX3dfcGRmanNfcmVxdWlyZV9fKDIpOwpjbGFzcyBCYXNlU3RyZWFtIHsKICBjb25zdHJ1Y3RvcigpIHsKICAgIGlmICh0aGlzLmNvbnN0cnVjdG9yID09PSBCYXNlU3RyZWFtKSB7CiAgICAgICgwLCBfdXRpbC51bnJlYWNoYWJsZSkoIkNhbm5vdCBpbml0aWFsaXplIEJhc2VTdHJlYW0uIik7CiAgICB9CiAgfQogIGdldCBsZW5ndGgoKSB7CiAgICAoMCwgX3V0aWwudW5yZWFjaGFibGUpKCJBYnN0cmFjdCBnZXR0ZXIgYGxlbmd0aGAgYWNjZXNzZWQiKTsKICB9CiAgZ2V0IGlzRW1wdHkoKSB7CiAgICAoMCwgX3V0aWwudW5yZWFjaGFibGUpKCJBYnN0cmFjdCBnZXR0ZXIgYGlzRW1wdHlgIGFjY2Vzc2VkIik7CiAgfQogIGdldCBpc0RhdGFMb2FkZWQoKSB7CiAgICByZXR1cm4gKDAsIF91dGlsLnNoYWRvdykodGhpcywgImlzRGF0YUxvYWRlZCIsIHRydWUpOwogIH0KICBnZXRCeXRlKCkgewogICAgKDAsIF91dGlsLnVucmVhY2hhYmxlKSgiQWJzdHJhY3QgbWV0aG9kIGBnZXRCeXRlYCBjYWxsZWQiKTsKICB9CiAgZ2V0Qnl0ZXMobGVuZ3RoKSB7CiAgICAoMCwgX3V0aWwudW5yZWFjaGFibGUpKCJBYnN0cmFjdCBtZXRob2QgYGdldEJ5dGVzYCBjYWxsZWQiKTsKICB9CiAgcGVla0J5dGUoKSB7CiAgICBjb25zdCBwZWVrZWRCeXRlID0gdGhpcy5nZXRCeXRlKCk7CiAgICBpZiAocGVla2VkQnl0ZSAhPT0gLTEpIHsKICAgICAgdGhpcy5wb3MtLTsKICAgIH0KICAgIHJldHVybiBwZWVrZWRCeXRlOwogIH0KICBwZWVrQnl0ZXMobGVuZ3RoKSB7CiAgICBjb25zdCBieXRlcyA9IHRoaXMuZ2V0Qnl0ZXMobGVuZ3RoKTsKICAgIHRoaXMucG9zIC09IGJ5dGVzLmxlbmd0aDsKICAgIHJldHVybiBieXRlczsKICB9CiAgZ2V0VWludDE2KCkgewogICAgY29uc3QgYjAgPSB0aGlzLmdldEJ5dGUoKTsKICAgIGNvbnN0IGIxID0gdGhpcy5nZXRCeXRlKCk7CiAgICBpZiAoYjAgPT09IC0xIHx8IGIxID09PSAtMSkgewogICAgICByZXR1cm4gLTE7CiAgICB9CiAgICByZXR1cm4gKGIwIDw8IDgpICsgYjE7CiAgfQogIGdldEludDMyKCkgewogICAgY29uc3QgYjAgPSB0aGlzLmdldEJ5dGUoKTsKICAgIGNvbnN0IGIxID0gdGhpcy5nZXRCeXRlKCk7CiAgICBjb25zdCBiMiA9IHRoaXMuZ2V0Qnl0ZSgpOwogICAgY29uc3QgYjMgPSB0aGlzLmdldEJ5dGUoKTsKICAgIHJldHVybiAoYjAgPDwgMjQpICsgKGIxIDw8IDE2KSArIChiMiA8PCA4KSArIGIzOwogIH0KICBnZXRCeXRlUmFuZ2UoYmVnaW4sIGVuZCkgewogICAgKDAsIF91dGlsLnVucmVhY2hhYmxlKSgiQWJzdHJhY3QgbWV0aG9kIGBnZXRCeXRlUmFuZ2VgIGNhbGxlZCIpOwogIH0KICBnZXRTdHJpbmcobGVuZ3RoKSB7CiAgICByZXR1cm4gKDAsIF91dGlsLmJ5dGVzVG9TdHJpbmcpKHRoaXMuZ2V0Qnl0ZXMobGVuZ3RoKSk7CiAgfQogIHNraXAobikgewogICAgdGhpcy5wb3MgKz0gbiB8fCAxOwogIH0KICByZXNldCgpIHsKICAgICgwLCBfdXRpbC51bnJlYWNoYWJsZSkoIkFic3RyYWN0IG1ldGhvZCBgcmVzZXRgIGNhbGxlZCIpOwogIH0KICBtb3ZlU3RhcnQoKSB7CiAgICAoMCwgX3V0aWwudW5yZWFjaGFibGUpKCJBYnN0cmFjdCBtZXRob2QgYG1vdmVTdGFydGAgY2FsbGVkIik7CiAgfQogIG1ha2VTdWJTdHJlYW0oc3RhcnQsIGxlbmd0aCwgZGljdCA9IG51bGwpIHsKICAgICgwLCBfdXRpbC51bnJlYWNoYWJsZSkoIkFic3RyYWN0IG1ldGhvZCBgbWFrZVN1YlN0cmVhbWAgY2FsbGVkIik7CiAgfQogIGdldEJhc2VTdHJlYW1zKCkgewogICAgcmV0dXJuIG51bGw7CiAgfQp9CmV4cG9ydHMuQmFzZVN0cmVhbSA9IEJhc2VTdHJlYW07CgovKioqLyB9KSwKLyogNiAqLwovKioqLyAoKF9fdW51c2VkX3dlYnBhY2tfbW9kdWxlLCBleHBvcnRzLCBfX3dfcGRmanNfcmVxdWlyZV9fKSA9PiB7CgoKCk9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCAiX19lc01vZHVsZSIsICh7CiAgdmFsdWU6IHRydWUKfSkpOwpleHBvcnRzLk5ldHdvcmtQZGZNYW5hZ2VyID0gZXhwb3J0cy5Mb2NhbFBkZk1hbmFnZXIgPSB2b2lkIDA7CnZhciBfdXRpbCA9IF9fd19wZGZqc19yZXF1aXJlX18oMik7CnZhciBfY2h1bmtlZF9zdHJlYW0gPSBfX3dfcGRmanNfcmVxdWlyZV9fKDcpOwp2YXIgX2NvcmVfdXRpbHMgPSBfX3dfcGRmanNfcmVxdWlyZV9fKDMpOwp2YXIgX2RvY3VtZW50ID0gX193X3BkZmpzX3JlcXVpcmVfXyg5KTsKdmFyIF9zdHJlYW0gPSBfX3dfcGRmanNfcmVxdWlyZV9fKDgpOwpmdW5jdGlvbiBwYXJzZURvY0Jhc2VVcmwodXJsKSB7CiAgaWYgKHVybCkgewogICAgY29uc3QgYWJzb2x1dGVVcmwgPSAoMCwgX3V0aWwuY3JlYXRlVmFsaWRBYnNvbHV0ZVVybCkodXJsKTsKICAgIGlmIChhYnNvbHV0ZVVybCkgewogICAgICByZXR1cm4gYWJzb2x1dGVVcmwuaHJlZjsKICAgIH0KICAgICgwLCBfdXRpbC53YXJuKShgSW52YWxpZCBhYnNvbHV0ZSBkb2NCYXNlVXJsOiAiJHt1cmx9Ii5gKTsKICB9CiAgcmV0dXJuIG51bGw7Cn0KY2xhc3MgQmFzZVBkZk1hbmFnZXIgewogIGNvbnN0cnVjdG9yKGFyZ3MpIHsKICAgIGlmICh0aGlzLmNvbnN0cnVjdG9yID09PSBCYXNlUGRmTWFuYWdlcikgewogICAgICAoMCwgX3V0aWwudW5yZWFjaGFibGUpKCJDYW5ub3QgaW5pdGlhbGl6ZSBCYXNlUGRmTWFuYWdlci4iKTsKICAgIH0KICAgIHRoaXMuX2RvY0Jhc2VVcmwgPSBwYXJzZURvY0Jhc2VVcmwoYXJncy5kb2NCYXNlVXJsKTsKICAgIHRoaXMuX2RvY0lkID0gYXJncy5kb2NJZDsKICAgIHRoaXMuX3Bhc3N3b3JkID0gYXJncy5wYXNzd29yZDsKICAgIHRoaXMuZW5hYmxlWGZhID0gYXJncy5lbmFibGVYZmE7CiAgICBhcmdzLmV2YWx1YXRvck9wdGlvbnMuaXNPZmZzY3JlZW5DYW52YXNTdXBwb3J0ZWQgJiY9IF91dGlsLkZlYXR1cmVUZXN0LmlzT2Zmc2NyZWVuQ2FudmFzU3VwcG9ydGVkOwogICAgdGhpcy5ldmFsdWF0b3JPcHRpb25zID0gYXJncy5ldmFsdWF0b3JPcHRpb25zOwogIH0KICBnZXQgZG9jSWQoKSB7CiAgICByZXR1cm4gdGhpcy5fZG9jSWQ7CiAgfQogIGdldCBwYXNzd29yZCgpIHsKICAgIHJldHVybiB0aGlzLl9wYXNzd29yZDsKICB9CiAgZ2V0IGRvY0Jhc2VVcmwoKSB7CiAgICByZXR1cm4gdGhpcy5fZG9jQmFzZVVybDsKICB9CiAgZ2V0IGNhdGFsb2coKSB7CiAgICByZXR1cm4gdGhpcy5wZGZEb2N1bWVudC5jYXRhbG9nOwogIH0KICBlbnN1cmVEb2MocHJvcCwgYXJncykgewogICAgcmV0dXJuIHRoaXMuZW5zdXJlKHRoaXMucGRmRG9jdW1lbnQsIHByb3AsIGFyZ3MpOwogIH0KICBlbnN1cmVYUmVmKHByb3AsIGFyZ3MpIHsKICAgIHJldHVybiB0aGlzLmVuc3VyZSh0aGlzLnBkZkRvY3VtZW50LnhyZWYsIHByb3AsIGFyZ3MpOwogIH0KICBlbnN1cmVDYXRhbG9nKHByb3AsIGFyZ3MpIHsKICAgIHJldHVybiB0aGlzLmVuc3VyZSh0aGlzLnBkZkRvY3VtZW50LmNhdGFsb2csIHByb3AsIGFyZ3MpOwogIH0KICBnZXRQYWdlKHBhZ2VJbmRleCkgewogICAgcmV0dXJuIHRoaXMucGRmRG9jdW1lbnQuZ2V0UGFnZShwYWdlSW5kZXgpOwogIH0KICBmb250RmFsbGJhY2soaWQsIGhhbmRsZXIpIHsKICAgIHJldHVybiB0aGlzLnBkZkRvY3VtZW50LmZvbnRGYWxsYmFjayhpZCwgaGFuZGxlcik7CiAgfQogIGxvYWRYZmFGb250cyhoYW5kbGVyLCB0YXNrKSB7CiAgICByZXR1cm4gdGhpcy5wZGZEb2N1bWVudC5sb2FkWGZhRm9udHMoaGFuZGxlciwgdGFzayk7CiAgfQogIGxvYWRYZmFJbWFnZXMoKSB7CiAgICByZXR1cm4gdGhpcy5wZGZEb2N1bWVudC5sb2FkWGZhSW1hZ2VzKCk7CiAgfQogIHNlcmlhbGl6ZVhmYURhdGEoYW5ub3RhdGlvblN0b3JhZ2UpIHsKICAgIHJldHVybiB0aGlzLnBkZkRvY3VtZW50LnNlcmlhbGl6ZVhmYURhdGEoYW5ub3RhdGlvblN0b3JhZ2UpOwogIH0KICBjbGVhbnVwKG1hbnVhbGx5VHJpZ2dlcmVkID0gZmFsc2UpIHsKICAgIHJldHVybiB0aGlzLnBkZkRvY3VtZW50LmNsZWFudXAobWFudWFsbHlUcmlnZ2VyZWQpOwogIH0KICBhc3luYyBlbnN1cmUob2JqLCBwcm9wLCBhcmdzKSB7CiAgICAoMCwgX3V0aWwudW5yZWFjaGFibGUpKCJBYnN0cmFjdCBtZXRob2QgYGVuc3VyZWAgY2FsbGVkIik7CiAgfQogIHJlcXVlc3RSYW5nZShiZWdpbiwgZW5kKSB7CiAgICAoMCwgX3V0aWwudW5yZWFjaGFibGUpKCJBYnN0cmFjdCBtZXRob2QgYHJlcXVlc3RSYW5nZWAgY2FsbGVkIik7CiAgfQogIHJlcXVlc3RMb2FkZWRTdHJlYW0obm9GZXRjaCA9IGZhbHNlKSB7CiAgICAoMCwgX3V0aWwudW5yZWFjaGFibGUpKCJBYnN0cmFjdCBtZXRob2QgYHJlcXVlc3RMb2FkZWRTdHJlYW1gIGNhbGxlZCIpOwogIH0KICBzZW5kUHJvZ3Jlc3NpdmVEYXRhKGNodW5rKSB7CiAgICAoMCwgX3V0aWwudW5yZWFjaGFibGUpKCJBYnN0cmFjdCBtZXRob2QgYHNlbmRQcm9ncmVzc2l2ZURhdGFgIGNhbGxlZCIpOwogIH0KICB1cGRhdGVQYXNzd29yZChwYXNzd29yZCkgewogICAgdGhpcy5fcGFzc3dvcmQgPSBwYXNzd29yZDsKICB9CiAgdGVybWluYXRlKHJlYXNvbikgewogICAgKDAsIF91dGlsLnVucmVhY2hhYmxlKSgiQWJzdHJhY3QgbWV0aG9kIGB0ZXJtaW5hdGVgIGNhbGxlZCIpOwogIH0KfQpjbGFzcyBMb2NhbFBkZk1hbmFnZXIgZXh0ZW5kcyBCYXNlUGRmTWFuYWdlciB7CiAgY29uc3RydWN0b3IoYXJncykgewogICAgc3VwZXIoYXJncyk7CiAgICBjb25zdCBzdHJlYW0gPSBuZXcgX3N0cmVhbS5TdHJlYW0oYXJncy5zb3VyY2UpOwogICAgdGhpcy5wZGZEb2N1bWVudCA9IG5ldyBfZG9jdW1lbnQuUERGRG9jdW1lbnQodGhpcywgc3RyZWFtKTsKICAgIHRoaXMuX2xvYWRlZFN0cmVhbVByb21pc2UgPSBQcm9taXNlLnJlc29sdmUoc3RyZWFtKTsKICB9CiAgYXN5bmMgZW5zdXJlKG9iaiwgcHJvcCwgYXJncykgewogICAgY29uc3QgdmFsdWUgPSBvYmpbcHJvcF07CiAgICBpZiAodHlwZW9mIHZhbHVlID09PSAiZnVuY3Rpb24iKSB7CiAgICAgIHJldHVybiB2YWx1ZS5hcHBseShvYmosIGFyZ3MpOwogICAgfQogICAgcmV0dXJuIHZhbHVlOwogIH0KICByZXF1ZXN0UmFuZ2UoYmVnaW4sIGVuZCkgewogICAgcmV0dXJuIFByb21pc2UucmVzb2x2ZSgpOwogIH0KICByZXF1ZXN0TG9hZGVkU3RyZWFtKG5vRmV0Y2ggPSBmYWxzZSkgewogICAgcmV0dXJuIHRoaXMuX2xvYWRlZFN0cmVhbVByb21pc2U7CiAgfQogIHRlcm1pbmF0ZShyZWFzb24pIHt9Cn0KZXhwb3J0cy5Mb2NhbFBkZk1hbmFnZXIgPSBMb2NhbFBkZk1hbmFnZXI7CmNsYXNzIE5ldHdvcmtQZGZNYW5hZ2VyIGV4dGVuZHMgQmFzZVBkZk1hbmFnZXIgewogIGNvbnN0cnVjdG9yKGFyZ3MpIHsKICAgIHN1cGVyKGFyZ3MpOwogICAgdGhpcy5zdHJlYW1NYW5hZ2VyID0gbmV3IF9jaHVua2VkX3N0cmVhbS5DaHVua2VkU3RyZWFtTWFuYWdlcihhcmdzLnNvdXJjZSwgewogICAgICBtc2dIYW5kbGVyOiBhcmdzLmhhbmRsZXIsCiAgICAgIGxlbmd0aDogYXJncy5sZW5ndGgsCiAgICAgIGRpc2FibGVBdXRvRmV0Y2g6IGFyZ3MuZGlzYWJsZUF1dG9GZXRjaCwKICAgICAgcmFuZ2VDaHVua1NpemU6IGFyZ3MucmFuZ2VDaHVua1NpemUKICAgIH0pOwogICAgdGhpcy5wZGZEb2N1bWVudCA9IG5ldyBfZG9jdW1lbnQuUERGRG9jdW1lbnQodGhpcywgdGhpcy5zdHJlYW1NYW5hZ2VyLmdldFN0cmVhbSgpKTsKICB9CiAgYXN5bmMgZW5zdXJlKG9iaiwgcHJvcCwgYXJncykgewogICAgdHJ5IHsKICAgICAgY29uc3QgdmFsdWUgPSBvYmpbcHJvcF07CiAgICAgIGlmICh0eXBlb2YgdmFsdWUgPT09ICJmdW5jdGlvbiIpIHsKICAgICAgICByZXR1cm4gdmFsdWUuYXBwbHkob2JqLCBhcmdzKTsKICAgICAgfQogICAgICByZXR1cm4gdmFsdWU7CiAgICB9IGNhdGNoIChleCkgewogICAgICBpZiAoIShleCBpbnN0YW5jZW9mIF9jb3JlX3V0aWxzLk1pc3NpbmdEYXRhRXhjZXB0aW9uKSkgewogICAgICAgIHRocm93IGV4OwogICAgICB9CiAgICAgIGF3YWl0IHRoaXMucmVxdWVzdFJhbmdlKGV4LmJlZ2luLCBleC5lbmQpOwogICAgICByZXR1cm4gdGhpcy5lbnN1cmUob2JqLCBwcm9wLCBhcmdzKTsKICAgIH0KICB9CiAgcmVxdWVzdFJhbmdlKGJlZ2luLCBlbmQpIHsKICAgIHJldHVybiB0aGlzLnN0cmVhbU1hbmFnZXIucmVxdWVzdFJhbmdlKGJlZ2luLCBlbmQpOwogIH0KICByZXF1ZXN0TG9hZGVkU3RyZWFtKG5vRmV0Y2ggPSBmYWxzZSkgewogICAgcmV0dXJuIHRoaXMuc3RyZWFtTWFuYWdlci5yZXF1ZXN0QWxsQ2h1bmtzKG5vRmV0Y2gpOwogIH0KICBzZW5kUHJvZ3Jlc3NpdmVEYXRhKGNodW5rKSB7CiAgICB0aGlzLnN0cmVhbU1hbmFnZXIub25SZWNlaXZlRGF0YSh7CiAgICAgIGNodW5rCiAgICB9KTsKICB9CiAgdGVybWluYXRlKHJlYXNvbikgewogICAgdGhpcy5zdHJlYW1NYW5hZ2VyLmFib3J0KHJlYXNvbik7CiAgfQp9CmV4cG9ydHMuTmV0d29ya1BkZk1hbmFnZXIgPSBOZXR3b3JrUGRmTWFuYWdlcjsKCi8qKiovIH0pLAovKiA3ICovCi8qKiovICgoX191bnVzZWRfd2VicGFja19tb2R1bGUsIGV4cG9ydHMsIF9fd19wZGZqc19yZXF1aXJlX18pID0+IHsKCgoKT2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsICJfX2VzTW9kdWxlIiwgKHsKICB2YWx1ZTogdHJ1ZQp9KSk7CmV4cG9ydHMuQ2h1bmtlZFN0cmVhbU1hbmFnZXIgPSBleHBvcnRzLkNodW5rZWRTdHJlYW0gPSB2b2lkIDA7CnZhciBfY29yZV91dGlscyA9IF9fd19wZGZqc19yZXF1aXJlX18oMyk7CnZhciBfdXRpbCA9IF9fd19wZGZqc19yZXF1aXJlX18oMik7CnZhciBfc3RyZWFtID0gX193X3BkZmpzX3JlcXVpcmVfXyg4KTsKY2xhc3MgQ2h1bmtlZFN0cmVhbSBleHRlbmRzIF9zdHJlYW0uU3RyZWFtIHsKICBjb25zdHJ1Y3RvcihsZW5ndGgsIGNodW5rU2l6ZSwgbWFuYWdlcikgewogICAgc3VwZXIobmV3IFVpbnQ4QXJyYXkobGVuZ3RoKSwgMCwgbGVuZ3RoLCBudWxsKTsKICAgIHRoaXMuY2h1bmtTaXplID0gY2h1bmtTaXplOwogICAgdGhpcy5fbG9hZGVkQ2h1bmtzID0gbmV3IFNldCgpOwogICAgdGhpcy5udW1DaHVua3MgPSBNYXRoLmNlaWwobGVuZ3RoIC8gY2h1bmtTaXplKTsKICAgIHRoaXMubWFuYWdlciA9IG1hbmFnZXI7CiAgICB0aGlzLnByb2dyZXNzaXZlRGF0YUxlbmd0aCA9IDA7CiAgICB0aGlzLmxhc3RTdWNjZXNzZnVsRW5zdXJlQnl0ZUNodW5rID0gLTE7CiAgfQogIGdldE1pc3NpbmdDaHVua3MoKSB7CiAgICBjb25zdCBjaHVua3MgPSBbXTsKICAgIGZvciAobGV0IGNodW5rID0gMCwgbiA9IHRoaXMubnVtQ2h1bmtzOyBjaHVuayA8IG47ICsrY2h1bmspIHsKICAgICAgaWYgKCF0aGlzLl9sb2FkZWRDaHVua3MuaGFzKGNodW5rKSkgewogICAgICAgIGNodW5rcy5wdXNoKGNodW5rKTsKICAgICAgfQogICAgfQogICAgcmV0dXJuIGNodW5rczsKICB9CiAgZ2V0IG51bUNodW5rc0xvYWRlZCgpIHsKICAgIHJldHVybiB0aGlzLl9sb2FkZWRDaHVua3Muc2l6ZTsKICB9CiAgZ2V0IGlzRGF0YUxvYWRlZCgpIHsKICAgIHJldHVybiB0aGlzLm51bUNodW5rc0xvYWRlZCA9PT0gdGhpcy5udW1DaHVua3M7CiAgfQogIG9uUmVjZWl2ZURhdGEoYmVnaW4sIGNodW5rKSB7CiAgICBjb25zdCBjaHVua1NpemUgPSB0aGlzLmNodW5rU2l6ZTsKICAgIGlmIChiZWdpbiAlIGNodW5rU2l6ZSAhPT0gMCkgewogICAgICB0aHJvdyBuZXcgRXJyb3IoYEJhZCBiZWdpbiBvZmZzZXQ6ICR7YmVnaW59YCk7CiAgICB9CiAgICBjb25zdCBlbmQgPSBiZWdpbiArIGNodW5rLmJ5dGVMZW5ndGg7CiAgICBpZiAoZW5kICUgY2h1bmtTaXplICE9PSAwICYmIGVuZCAhPT0gdGhpcy5ieXRlcy5sZW5ndGgpIHsKICAgICAgdGhyb3cgbmV3IEVycm9yKGBCYWQgZW5kIG9mZnNldDogJHtlbmR9YCk7CiAgICB9CiAgICB0aGlzLmJ5dGVzLnNldChuZXcgVWludDhBcnJheShjaHVuayksIGJlZ2luKTsKICAgIGNvbnN0IGJlZ2luQ2h1bmsgPSBNYXRoLmZsb29yKGJlZ2luIC8gY2h1bmtTaXplKTsKICAgIGNvbnN0IGVuZENodW5rID0gTWF0aC5mbG9vcigoZW5kIC0gMSkgLyBjaHVua1NpemUpICsgMTsKICAgIGZvciAobGV0IGN1ckNodW5rID0gYmVnaW5DaHVuazsgY3VyQ2h1bmsgPCBlbmRDaHVuazsgKytjdXJDaHVuaykgewogICAgICB0aGlzLl9sb2FkZWRDaHVua3MuYWRkKGN1ckNodW5rKTsKICAgIH0KICB9CiAgb25SZWNlaXZlUHJvZ3Jlc3NpdmVEYXRhKGRhdGEpIHsKICAgIGxldCBwb3NpdGlvbiA9IHRoaXMucHJvZ3Jlc3NpdmVEYXRhTGVuZ3RoOwogICAgY29uc3QgYmVnaW5DaHVuayA9IE1hdGguZmxvb3IocG9zaXRpb24gLyB0aGlzLmNodW5rU2l6ZSk7CiAgICB0aGlzLmJ5dGVzLnNldChuZXcgVWludDhBcnJheShkYXRhKSwgcG9zaXRpb24pOwogICAgcG9zaXRpb24gKz0gZGF0YS5ieXRlTGVuZ3RoOwogICAgdGhpcy5wcm9ncmVzc2l2ZURhdGFMZW5ndGggPSBwb3NpdGlvbjsKICAgIGNvbnN0IGVuZENodW5rID0gcG9zaXRpb24gPj0gdGhpcy5lbmQgPyB0aGlzLm51bUNodW5rcyA6IE1hdGguZmxvb3IocG9zaXRpb24gLyB0aGlzLmNodW5rU2l6ZSk7CiAgICBmb3IgKGxldCBjdXJDaHVuayA9IGJlZ2luQ2h1bms7IGN1ckNodW5rIDwgZW5kQ2h1bms7ICsrY3VyQ2h1bmspIHsKICAgICAgdGhpcy5fbG9hZGVkQ2h1bmtzLmFkZChjdXJDaHVuayk7CiAgICB9CiAgfQogIGVuc3VyZUJ5dGUocG9zKSB7CiAgICBpZiAocG9zIDwgdGhpcy5wcm9ncmVzc2l2ZURhdGFMZW5ndGgpIHsKICAgICAgcmV0dXJuOwogICAgfQogICAgY29uc3QgY2h1bmsgPSBNYXRoLmZsb29yKHBvcyAvIHRoaXMuY2h1bmtTaXplKTsKICAgIGlmIChjaHVuayA+IHRoaXMubnVtQ2h1bmtzKSB7CiAgICAgIHJldHVybjsKICAgIH0KICAgIGlmIChjaHVuayA9PT0gdGhpcy5sYXN0U3VjY2Vzc2Z1bEVuc3VyZUJ5dGVDaHVuaykgewogICAgICByZXR1cm47CiAgICB9CiAgICBpZiAoIXRoaXMuX2xvYWRlZENodW5rcy5oYXMoY2h1bmspKSB7CiAgICAgIHRocm93IG5ldyBfY29yZV91dGlscy5NaXNzaW5nRGF0YUV4Y2VwdGlvbihwb3MsIHBvcyArIDEpOwogICAgfQogICAgdGhpcy5sYXN0U3VjY2Vzc2Z1bEVuc3VyZUJ5dGVDaHVuayA9IGNodW5rOwogIH0KICBlbnN1cmVSYW5nZShiZWdpbiwgZW5kKSB7CiAgICBpZiAoYmVnaW4gPj0gZW5kKSB7CiAgICAgIHJldHVybjsKICAgIH0KICAgIGlmIChlbmQgPD0gdGhpcy5wcm9ncmVzc2l2ZURhdGFMZW5ndGgpIHsKICAgICAgcmV0dXJuOwogICAgfQogICAgY29uc3QgYmVnaW5DaHVuayA9IE1hdGguZmxvb3IoYmVnaW4gLyB0aGlzLmNodW5rU2l6ZSk7CiAgICBpZiAoYmVnaW5DaHVuayA+IHRoaXMubnVtQ2h1bmtzKSB7CiAgICAgIHJldHVybjsKICAgIH0KICAgIGNvbnN0IGVuZENodW5rID0gTWF0aC5taW4oTWF0aC5mbG9vcigoZW5kIC0gMSkgLyB0aGlzLmNodW5rU2l6ZSkgKyAxLCB0aGlzLm51bUNodW5rcyk7CiAgICBmb3IgKGxldCBjaHVuayA9IGJlZ2luQ2h1bms7IGNodW5rIDwgZW5kQ2h1bms7ICsrY2h1bmspIHsKICAgICAgaWYgKCF0aGlzLl9sb2FkZWRDaHVua3MuaGFzKGNodW5rKSkgewogICAgICAgIHRocm93IG5ldyBfY29yZV91dGlscy5NaXNzaW5nRGF0YUV4Y2VwdGlvbihiZWdpbiwgZW5kKTsKICAgICAgfQogICAgfQogIH0KICBuZXh0RW1wdHlDaHVuayhiZWdpbkNodW5rKSB7CiAgICBjb25zdCBudW1DaHVua3MgPSB0aGlzLm51bUNodW5rczsKICAgIGZvciAobGV0IGkgPSAwOyBpIDwgbnVtQ2h1bmtzOyArK2kpIHsKICAgICAgY29uc3QgY2h1bmsgPSAoYmVnaW5DaHVuayArIGkpICUgbnVtQ2h1bmtzOwogICAgICBpZiAoIXRoaXMuX2xvYWRlZENodW5rcy5oYXMoY2h1bmspKSB7CiAgICAgICAgcmV0dXJuIGNodW5rOwogICAgICB9CiAgICB9CiAgICByZXR1cm4gbnVsbDsKICB9CiAgaGFzQ2h1bmsoY2h1bmspIHsKICAgIHJldHVybiB0aGlzLl9sb2FkZWRDaHVua3MuaGFzKGNodW5rKTsKICB9CiAgZ2V0Qnl0ZSgpIHsKICAgIGNvbnN0IHBvcyA9IHRoaXMucG9zOwogICAgaWYgKHBvcyA+PSB0aGlzLmVuZCkgewogICAgICByZXR1cm4gLTE7CiAgICB9CiAgICBpZiAocG9zID49IHRoaXMucHJvZ3Jlc3NpdmVEYXRhTGVuZ3RoKSB7CiAgICAgIHRoaXMuZW5zdXJlQnl0ZShwb3MpOwogICAgfQogICAgcmV0dXJuIHRoaXMuYnl0ZXNbdGhpcy5wb3MrK107CiAgfQogIGdldEJ5dGVzKGxlbmd0aCkgewogICAgY29uc3QgYnl0ZXMgPSB0aGlzLmJ5dGVzOwogICAgY29uc3QgcG9zID0gdGhpcy5wb3M7CiAgICBjb25zdCBzdHJFbmQgPSB0aGlzLmVuZDsKICAgIGlmICghbGVuZ3RoKSB7CiAgICAgIGlmIChzdHJFbmQgPiB0aGlzLnByb2dyZXNzaXZlRGF0YUxlbmd0aCkgewogICAgICAgIHRoaXMuZW5zdXJlUmFuZ2UocG9zLCBzdHJFbmQpOwogICAgICB9CiAgICAgIHJldHVybiBieXRlcy5zdWJhcnJheShwb3MsIHN0ckVuZCk7CiAgICB9CiAgICBsZXQgZW5kID0gcG9zICsgbGVuZ3RoOwogICAgaWYgKGVuZCA+IHN0ckVuZCkgewogICAgICBlbmQgPSBzdHJFbmQ7CiAgICB9CiAgICBpZiAoZW5kID4gdGhpcy5wcm9ncmVzc2l2ZURhdGFMZW5ndGgpIHsKICAgICAgdGhpcy5lbnN1cmVSYW5nZShwb3MsIGVuZCk7CiAgICB9CiAgICB0aGlzLnBvcyA9IGVuZDsKICAgIHJldHVybiBieXRlcy5zdWJhcnJheShwb3MsIGVuZCk7CiAgfQogIGdldEJ5dGVSYW5nZShiZWdpbiwgZW5kKSB7CiAgICBpZiAoYmVnaW4gPCAwKSB7CiAgICAgIGJlZ2luID0gMDsKICAgIH0KICAgIGlmIChlbmQgPiB0aGlzLmVuZCkgewogICAgICBlbmQgPSB0aGlzLmVuZDsKICAgIH0KICAgIGlmIChlbmQgPiB0aGlzLnByb2dyZXNzaXZlRGF0YUxlbmd0aCkgewogICAgICB0aGlzLmVuc3VyZVJhbmdlKGJlZ2luLCBlbmQpOwogICAgfQogICAgcmV0dXJuIHRoaXMuYnl0ZXMuc3ViYXJyYXkoYmVnaW4sIGVuZCk7CiAgfQogIG1ha2VTdWJTdHJlYW0oc3RhcnQsIGxlbmd0aCwgZGljdCA9IG51bGwpIHsKICAgIGlmIChsZW5ndGgpIHsKICAgICAgaWYgKHN0YXJ0ICsgbGVuZ3RoID4gdGhpcy5wcm9ncmVzc2l2ZURhdGFMZW5ndGgpIHsKICAgICAgICB0aGlzLmVuc3VyZVJhbmdlKHN0YXJ0LCBzdGFydCArIGxlbmd0aCk7CiAgICAgIH0KICAgIH0gZWxzZSBpZiAoc3RhcnQgPj0gdGhpcy5wcm9ncmVzc2l2ZURhdGFMZW5ndGgpIHsKICAgICAgdGhpcy5lbnN1cmVCeXRlKHN0YXJ0KTsKICAgIH0KICAgIGZ1bmN0aW9uIENodW5rZWRTdHJlYW1TdWJzdHJlYW0oKSB7fQogICAgQ2h1bmtlZFN0cmVhbVN1YnN0cmVhbS5wcm90b3R5cGUgPSBPYmplY3QuY3JlYXRlKHRoaXMpOwogICAgQ2h1bmtlZFN0cmVhbVN1YnN0cmVhbS5wcm90b3R5cGUuZ2V0TWlzc2luZ0NodW5rcyA9IGZ1bmN0aW9uICgpIHsKICAgICAgY29uc3QgY2h1bmtTaXplID0gdGhpcy5jaHVua1NpemU7CiAgICAgIGNvbnN0IGJlZ2luQ2h1bmsgPSBNYXRoLmZsb29yKHRoaXMuc3RhcnQgLyBjaHVua1NpemUpOwogICAgICBjb25zdCBlbmRDaHVuayA9IE1hdGguZmxvb3IoKHRoaXMuZW5kIC0gMSkgLyBjaHVua1NpemUpICsgMTsKICAgICAgY29uc3QgbWlzc2luZ0NodW5rcyA9IFtdOwogICAgICBmb3IgKGxldCBjaHVuayA9IGJlZ2luQ2h1bms7IGNodW5rIDwgZW5kQ2h1bms7ICsrY2h1bmspIHsKICAgICAgICBpZiAoIXRoaXMuX2xvYWRlZENodW5rcy5oYXMoY2h1bmspKSB7CiAgICAgICAgICBtaXNzaW5nQ2h1bmtzLnB1c2goY2h1bmspOwogICAgICAgIH0KICAgICAgfQogICAgICByZXR1cm4gbWlzc2luZ0NodW5rczsKICAgIH07CiAgICBPYmplY3QuZGVmaW5lUHJvcGVydHkoQ2h1bmtlZFN0cmVhbVN1YnN0cmVhbS5wcm90b3R5cGUsICJpc0RhdGFMb2FkZWQiLCB7CiAgICAgIGdldCgpIHsKICAgICAgICBpZiAodGhpcy5udW1DaHVua3NMb2FkZWQgPT09IHRoaXMubnVtQ2h1bmtzKSB7CiAgICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgICB9CiAgICAgICAgcmV0dXJuIHRoaXMuZ2V0TWlzc2luZ0NodW5rcygpLmxlbmd0aCA9PT0gMDsKICAgICAgfSwKICAgICAgY29uZmlndXJhYmxlOiB0cnVlCiAgICB9KTsKICAgIGNvbnN0IHN1YlN0cmVhbSA9IG5ldyBDaHVua2VkU3RyZWFtU3Vic3RyZWFtKCk7CiAgICBzdWJTdHJlYW0ucG9zID0gc3ViU3RyZWFtLnN0YXJ0ID0gc3RhcnQ7CiAgICBzdWJTdHJlYW0uZW5kID0gc3RhcnQgKyBsZW5ndGggfHwgdGhpcy5lbmQ7CiAgICBzdWJTdHJlYW0uZGljdCA9IGRpY3Q7CiAgICByZXR1cm4gc3ViU3RyZWFtOwogIH0KICBnZXRCYXNlU3RyZWFtcygpIHsKICAgIHJldHVybiBbdGhpc107CiAgfQp9CmV4cG9ydHMuQ2h1bmtlZFN0cmVhbSA9IENodW5rZWRTdHJlYW07CmNsYXNzIENodW5rZWRTdHJlYW1NYW5hZ2VyIHsKICBjb25zdHJ1Y3RvcihwZGZOZXR3b3JrU3RyZWFtLCBhcmdzKSB7CiAgICB0aGlzLmxlbmd0aCA9IGFyZ3MubGVuZ3RoOwogICAgdGhpcy5jaHVua1NpemUgPSBhcmdzLnJhbmdlQ2h1bmtTaXplOwogICAgdGhpcy5zdHJlYW0gPSBuZXcgQ2h1bmtlZFN0cmVhbSh0aGlzLmxlbmd0aCwgdGhpcy5jaHVua1NpemUsIHRoaXMpOwogICAgdGhpcy5wZGZOZXR3b3JrU3RyZWFtID0gcGRmTmV0d29ya1N0cmVhbTsKICAgIHRoaXMuZGlzYWJsZUF1dG9GZXRjaCA9IGFyZ3MuZGlzYWJsZUF1dG9GZXRjaDsKICAgIHRoaXMubXNnSGFuZGxlciA9IGFyZ3MubXNnSGFuZGxlcjsKICAgIHRoaXMuY3VyclJlcXVlc3RJZCA9IDA7CiAgICB0aGlzLl9jaHVua3NOZWVkZWRCeVJlcXVlc3QgPSBuZXcgTWFwKCk7CiAgICB0aGlzLl9yZXF1ZXN0c0J5Q2h1bmsgPSBuZXcgTWFwKCk7CiAgICB0aGlzLl9wcm9taXNlc0J5UmVxdWVzdCA9IG5ldyBNYXAoKTsKICAgIHRoaXMucHJvZ3Jlc3NpdmVEYXRhTGVuZ3RoID0gMDsKICAgIHRoaXMuYWJvcnRlZCA9IGZhbHNlOwogICAgdGhpcy5fbG9hZGVkU3RyZWFtQ2FwYWJpbGl0eSA9IG5ldyBfdXRpbC5Qcm9taXNlQ2FwYWJpbGl0eSgpOwogIH0KICBzZW5kUmVxdWVzdChiZWdpbiwgZW5kKSB7CiAgICBjb25zdCByYW5nZVJlYWRlciA9IHRoaXMucGRmTmV0d29ya1N0cmVhbS5nZXRSYW5nZVJlYWRlcihiZWdpbiwgZW5kKTsKICAgIGlmICghcmFuZ2VSZWFkZXIuaXNTdHJlYW1pbmdTdXBwb3J0ZWQpIHsKICAgICAgcmFuZ2VSZWFkZXIub25Qcm9ncmVzcyA9IHRoaXMub25Qcm9ncmVzcy5iaW5kKHRoaXMpOwogICAgfQogICAgbGV0IGNodW5rcyA9IFtdLAogICAgICBsb2FkZWQgPSAwOwogICAgcmV0dXJuIG5ldyBQcm9taXNlKChyZXNvbHZlLCByZWplY3QpID0+IHsKICAgICAgY29uc3QgcmVhZENodW5rID0gKHsKICAgICAgICB2YWx1ZSwKICAgICAgICBkb25lCiAgICAgIH0pID0+IHsKICAgICAgICB0cnkgewogICAgICAgICAgaWYgKGRvbmUpIHsKICAgICAgICAgICAgY29uc3QgY2h1bmtEYXRhID0gKDAsIF9jb3JlX3V0aWxzLmFycmF5QnVmZmVyc1RvQnl0ZXMpKGNodW5rcyk7CiAgICAgICAgICAgIGNodW5rcyA9IG51bGw7CiAgICAgICAgICAgIHJlc29sdmUoY2h1bmtEYXRhKTsKICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgfQogICAgICAgICAgbG9hZGVkICs9IHZhbHVlLmJ5dGVMZW5ndGg7CiAgICAgICAgICBpZiAocmFuZ2VSZWFkZXIuaXNTdHJlYW1pbmdTdXBwb3J0ZWQpIHsKICAgICAgICAgICAgdGhpcy5vblByb2dyZXNzKHsKICAgICAgICAgICAgICBsb2FkZWQKICAgICAgICAgICAgfSk7CiAgICAgICAgICB9CiAgICAgICAgICBjaHVua3MucHVzaCh2YWx1ZSk7CiAgICAgICAgICByYW5nZVJlYWRlci5yZWFkKCkudGhlbihyZWFkQ2h1bmssIHJlamVjdCk7CiAgICAgICAgfSBjYXRjaCAoZSkgewogICAgICAgICAgcmVqZWN0KGUpOwogICAgICAgIH0KICAgICAgfTsKICAgICAgcmFuZ2VSZWFkZXIucmVhZCgpLnRoZW4ocmVhZENodW5rLCByZWplY3QpOwogICAgfSkudGhlbihkYXRhID0+IHsKICAgICAgaWYgKHRoaXMuYWJvcnRlZCkgewogICAgICAgIHJldHVybjsKICAgICAgfQogICAgICB0aGlzLm9uUmVjZWl2ZURhdGEoewogICAgICAgIGNodW5rOiBkYXRhLAogICAgICAgIGJlZ2luCiAgICAgIH0pOwogICAgfSk7CiAgfQogIHJlcXVlc3RBbGxDaHVua3Mobm9GZXRjaCA9IGZhbHNlKSB7CiAgICBpZiAoIW5vRmV0Y2gpIHsKICAgICAgY29uc3QgbWlzc2luZ0NodW5rcyA9IHRoaXMuc3RyZWFtLmdldE1pc3NpbmdDaHVua3MoKTsKICAgICAgdGhpcy5fcmVxdWVzdENodW5rcyhtaXNzaW5nQ2h1bmtzKTsKICAgIH0KICAgIHJldHVybiB0aGlzLl9sb2FkZWRTdHJlYW1DYXBhYmlsaXR5LnByb21pc2U7CiAgfQogIF9yZXF1ZXN0Q2h1bmtzKGNodW5rcykgewogICAgY29uc3QgcmVxdWVzdElkID0gdGhpcy5jdXJyUmVxdWVzdElkKys7CiAgICBjb25zdCBjaHVua3NOZWVkZWQgPSBuZXcgU2V0KCk7CiAgICB0aGlzLl9jaHVua3NOZWVkZWRCeVJlcXVlc3Quc2V0KHJlcXVlc3RJZCwgY2h1bmtzTmVlZGVkKTsKICAgIGZvciAoY29uc3QgY2h1bmsgb2YgY2h1bmtzKSB7CiAgICAgIGlmICghdGhpcy5zdHJlYW0uaGFzQ2h1bmsoY2h1bmspKSB7CiAgICAgICAgY2h1bmtzTmVlZGVkLmFkZChjaHVuayk7CiAgICAgIH0KICAgIH0KICAgIGlmIChjaHVua3NOZWVkZWQuc2l6ZSA9PT0gMCkgewogICAgICByZXR1cm4gUHJvbWlzZS5yZXNvbHZlKCk7CiAgICB9CiAgICBjb25zdCBjYXBhYmlsaXR5ID0gbmV3IF91dGlsLlByb21pc2VDYXBhYmlsaXR5KCk7CiAgICB0aGlzLl9wcm9taXNlc0J5UmVxdWVzdC5zZXQocmVxdWVzdElkLCBjYXBhYmlsaXR5KTsKICAgIGNvbnN0IGNodW5rc1RvUmVxdWVzdCA9IFtdOwogICAgZm9yIChjb25zdCBjaHVuayBvZiBjaHVua3NOZWVkZWQpIHsKICAgICAgbGV0IHJlcXVlc3RJZHMgPSB0aGlzLl9yZXF1ZXN0c0J5Q2h1bmsuZ2V0KGNodW5rKTsKICAgICAgaWYgKCFyZXF1ZXN0SWRzKSB7CiAgICAgICAgcmVxdWVzdElkcyA9IFtdOwogICAgICAgIHRoaXMuX3JlcXVlc3RzQnlDaHVuay5zZXQoY2h1bmssIHJlcXVlc3RJZHMpOwogICAgICAgIGNodW5rc1RvUmVxdWVzdC5wdXNoKGNodW5rKTsKICAgICAgfQogICAgICByZXF1ZXN0SWRzLnB1c2gocmVxdWVzdElkKTsKICAgIH0KICAgIGlmIChjaHVua3NUb1JlcXVlc3QubGVuZ3RoID4gMCkgewogICAgICBjb25zdCBncm91cGVkQ2h1bmtzVG9SZXF1ZXN0ID0gdGhpcy5ncm91cENodW5rcyhjaHVua3NUb1JlcXVlc3QpOwogICAgICBmb3IgKGNvbnN0IGdyb3VwZWRDaHVuayBvZiBncm91cGVkQ2h1bmtzVG9SZXF1ZXN0KSB7CiAgICAgICAgY29uc3QgYmVnaW4gPSBncm91cGVkQ2h1bmsuYmVnaW5DaHVuayAqIHRoaXMuY2h1bmtTaXplOwogICAgICAgIGNvbnN0IGVuZCA9IE1hdGgubWluKGdyb3VwZWRDaHVuay5lbmRDaHVuayAqIHRoaXMuY2h1bmtTaXplLCB0aGlzLmxlbmd0aCk7CiAgICAgICAgdGhpcy5zZW5kUmVxdWVzdChiZWdpbiwgZW5kKS5jYXRjaChjYXBhYmlsaXR5LnJlamVjdCk7CiAgICAgIH0KICAgIH0KICAgIHJldHVybiBjYXBhYmlsaXR5LnByb21pc2UuY2F0Y2gocmVhc29uID0+IHsKICAgICAgaWYgKHRoaXMuYWJvcnRlZCkgewogICAgICAgIHJldHVybjsKICAgICAgfQogICAgICB0aHJvdyByZWFzb247CiAgICB9KTsKICB9CiAgZ2V0U3RyZWFtKCkgewogICAgcmV0dXJuIHRoaXMuc3RyZWFtOwogIH0KICByZXF1ZXN0UmFuZ2UoYmVnaW4sIGVuZCkgewogICAgZW5kID0gTWF0aC5taW4oZW5kLCB0aGlzLmxlbmd0aCk7CiAgICBjb25zdCBiZWdpbkNodW5rID0gdGhpcy5nZXRCZWdpbkNodW5rKGJlZ2luKTsKICAgIGNvbnN0IGVuZENodW5rID0gdGhpcy5nZXRFbmRDaHVuayhlbmQpOwogICAgY29uc3QgY2h1bmtzID0gW107CiAgICBmb3IgKGxldCBjaHVuayA9IGJlZ2luQ2h1bms7IGNodW5rIDwgZW5kQ2h1bms7ICsrY2h1bmspIHsKICAgICAgY2h1bmtzLnB1c2goY2h1bmspOwogICAgfQogICAgcmV0dXJuIHRoaXMuX3JlcXVlc3RDaHVua3MoY2h1bmtzKTsKICB9CiAgcmVxdWVzdFJhbmdlcyhyYW5nZXMgPSBbXSkgewogICAgY29uc3QgY2h1bmtzVG9SZXF1ZXN0ID0gW107CiAgICBmb3IgKGNvbnN0IHJhbmdlIG9mIHJhbmdlcykgewogICAgICBjb25zdCBiZWdpbkNodW5rID0gdGhpcy5nZXRCZWdpbkNodW5rKHJhbmdlLmJlZ2luKTsKICAgICAgY29uc3QgZW5kQ2h1bmsgPSB0aGlzLmdldEVuZENodW5rKHJhbmdlLmVuZCk7CiAgICAgIGZvciAobGV0IGNodW5rID0gYmVnaW5DaHVuazsgY2h1bmsgPCBlbmRDaHVuazsgKytjaHVuaykgewogICAgICAgIGlmICghY2h1bmtzVG9SZXF1ZXN0LmluY2x1ZGVzKGNodW5rKSkgewogICAgICAgICAgY2h1bmtzVG9SZXF1ZXN0LnB1c2goY2h1bmspOwogICAgICAgIH0KICAgICAgfQogICAgfQogICAgY2h1bmtzVG9SZXF1ZXN0LnNvcnQoZnVuY3Rpb24gKGEsIGIpIHsKICAgICAgcmV0dXJuIGEgLSBiOwogICAgfSk7CiAgICByZXR1cm4gdGhpcy5fcmVxdWVzdENodW5rcyhjaHVua3NUb1JlcXVlc3QpOwogIH0KICBncm91cENodW5rcyhjaHVua3MpIHsKICAgIGNvbnN0IGdyb3VwZWRDaHVua3MgPSBbXTsKICAgIGxldCBiZWdpbkNodW5rID0gLTE7CiAgICBsZXQgcHJldkNodW5rID0gLTE7CiAgICBmb3IgKGxldCBpID0gMCwgaWkgPSBjaHVua3MubGVuZ3RoOyBpIDwgaWk7ICsraSkgewogICAgICBjb25zdCBjaHVuayA9IGNodW5rc1tpXTsKICAgICAgaWYgKGJlZ2luQ2h1bmsgPCAwKSB7CiAgICAgICAgYmVnaW5DaHVuayA9IGNodW5rOwogICAgICB9CiAgICAgIGlmIChwcmV2Q2h1bmsgPj0gMCAmJiBwcmV2Q2h1bmsgKyAxICE9PSBjaHVuaykgewogICAgICAgIGdyb3VwZWRDaHVua3MucHVzaCh7CiAgICAgICAgICBiZWdpbkNodW5rLAogICAgICAgICAgZW5kQ2h1bms6IHByZXZDaHVuayArIDEKICAgICAgICB9KTsKICAgICAgICBiZWdpbkNodW5rID0gY2h1bms7CiAgICAgIH0KICAgICAgaWYgKGkgKyAxID09PSBjaHVua3MubGVuZ3RoKSB7CiAgICAgICAgZ3JvdXBlZENodW5rcy5wdXNoKHsKICAgICAgICAgIGJlZ2luQ2h1bmssCiAgICAgICAgICBlbmRDaHVuazogY2h1bmsgKyAxCiAgICAgICAgfSk7CiAgICAgIH0KICAgICAgcHJldkNodW5rID0gY2h1bms7CiAgICB9CiAgICByZXR1cm4gZ3JvdXBlZENodW5rczsKICB9CiAgb25Qcm9ncmVzcyhhcmdzKSB7CiAgICB0aGlzLm1zZ0hhbmRsZXIuc2VuZCgiRG9jUHJvZ3Jlc3MiLCB7CiAgICAgIGxvYWRlZDogdGhpcy5zdHJlYW0ubnVtQ2h1bmtzTG9hZGVkICogdGhpcy5jaHVua1NpemUgKyBhcmdzLmxvYWRlZCwKICAgICAgdG90YWw6IHRoaXMubGVuZ3RoCiAgICB9KTsKICB9CiAgb25SZWNlaXZlRGF0YShhcmdzKSB7CiAgICBjb25zdCBjaHVuayA9IGFyZ3MuY2h1bms7CiAgICBjb25zdCBpc1Byb2dyZXNzaXZlID0gYXJncy5iZWdpbiA9PT0gdW5kZWZpbmVkOwogICAgY29uc3QgYmVnaW4gPSBpc1Byb2dyZXNzaXZlID8gdGhpcy5wcm9ncmVzc2l2ZURhdGFMZW5ndGggOiBhcmdzLmJlZ2luOwogICAgY29uc3QgZW5kID0gYmVnaW4gKyBjaHVuay5ieXRlTGVuZ3RoOwogICAgY29uc3QgYmVnaW5DaHVuayA9IE1hdGguZmxvb3IoYmVnaW4gLyB0aGlzLmNodW5rU2l6ZSk7CiAgICBjb25zdCBlbmRDaHVuayA9IGVuZCA8IHRoaXMubGVuZ3RoID8gTWF0aC5mbG9vcihlbmQgLyB0aGlzLmNodW5rU2l6ZSkgOiBNYXRoLmNlaWwoZW5kIC8gdGhpcy5jaHVua1NpemUpOwogICAgaWYgKGlzUHJvZ3Jlc3NpdmUpIHsKICAgICAgdGhpcy5zdHJlYW0ub25SZWNlaXZlUHJvZ3Jlc3NpdmVEYXRhKGNodW5rKTsKICAgICAgdGhpcy5wcm9ncmVzc2l2ZURhdGFMZW5ndGggPSBlbmQ7CiAgICB9IGVsc2UgewogICAgICB0aGlzLnN0cmVhbS5vblJlY2VpdmVEYXRhKGJlZ2luLCBjaHVuayk7CiAgICB9CiAgICBpZiAodGhpcy5zdHJlYW0uaXNEYXRhTG9hZGVkKSB7CiAgICAgIHRoaXMuX2xvYWRlZFN0cmVhbUNhcGFiaWxpdHkucmVzb2x2ZSh0aGlzLnN0cmVhbSk7CiAgICB9CiAgICBjb25zdCBsb2FkZWRSZXF1ZXN0cyA9IFtdOwogICAgZm9yIChsZXQgY3VyQ2h1bmsgPSBiZWdpbkNodW5rOyBjdXJDaHVuayA8IGVuZENodW5rOyArK2N1ckNodW5rKSB7CiAgICAgIGNvbnN0IHJlcXVlc3RJZHMgPSB0aGlzLl9yZXF1ZXN0c0J5Q2h1bmsuZ2V0KGN1ckNodW5rKTsKICAgICAgaWYgKCFyZXF1ZXN0SWRzKSB7CiAgICAgICAgY29udGludWU7CiAgICAgIH0KICAgICAgdGhpcy5fcmVxdWVzdHNCeUNodW5rLmRlbGV0ZShjdXJDaHVuayk7CiAgICAgIGZvciAoY29uc3QgcmVxdWVzdElkIG9mIHJlcXVlc3RJZHMpIHsKICAgICAgICBjb25zdCBjaHVua3NOZWVkZWQgPSB0aGlzLl9jaHVua3NOZWVkZWRCeVJlcXVlc3QuZ2V0KHJlcXVlc3RJZCk7CiAgICAgICAgaWYgKGNodW5rc05lZWRlZC5oYXMoY3VyQ2h1bmspKSB7CiAgICAgICAgICBjaHVua3NOZWVkZWQuZGVsZXRlKGN1ckNodW5rKTsKICAgICAgICB9CiAgICAgICAgaWYgKGNodW5rc05lZWRlZC5zaXplID4gMCkgewogICAgICAgICAgY29udGludWU7CiAgICAgICAgfQogICAgICAgIGxvYWRlZFJlcXVlc3RzLnB1c2gocmVxdWVzdElkKTsKICAgICAgfQogICAgfQogICAgaWYgKCF0aGlzLmRpc2FibGVBdXRvRmV0Y2ggJiYgdGhpcy5fcmVxdWVzdHNCeUNodW5rLnNpemUgPT09IDApIHsKICAgICAgbGV0IG5leHRFbXB0eUNodW5rOwogICAgICBpZiAodGhpcy5zdHJlYW0ubnVtQ2h1bmtzTG9hZGVkID09PSAxKSB7CiAgICAgICAgY29uc3QgbGFzdENodW5rID0gdGhpcy5zdHJlYW0ubnVtQ2h1bmtzIC0gMTsKICAgICAgICBpZiAoIXRoaXMuc3RyZWFtLmhhc0NodW5rKGxhc3RDaHVuaykpIHsKICAgICAgICAgIG5leHRFbXB0eUNodW5rID0gbGFzdENodW5rOwogICAgICAgIH0KICAgICAgfSBlbHNlIHsKICAgICAgICBuZXh0RW1wdHlDaHVuayA9IHRoaXMuc3RyZWFtLm5leHRFbXB0eUNodW5rKGVuZENodW5rKTsKICAgICAgfQogICAgICBpZiAoTnVtYmVyLmlzSW50ZWdlcihuZXh0RW1wdHlDaHVuaykpIHsKICAgICAgICB0aGlzLl9yZXF1ZXN0Q2h1bmtzKFtuZXh0RW1wdHlDaHVua10pOwogICAgICB9CiAgICB9CiAgICBmb3IgKGNvbnN0IHJlcXVlc3RJZCBvZiBsb2FkZWRSZXF1ZXN0cykgewogICAgICBjb25zdCBjYXBhYmlsaXR5ID0gdGhpcy5fcHJvbWlzZXNCeVJlcXVlc3QuZ2V0KHJlcXVlc3RJZCk7CiAgICAgIHRoaXMuX3Byb21pc2VzQnlSZXF1ZXN0LmRlbGV0ZShyZXF1ZXN0SWQpOwogICAgICBjYXBhYmlsaXR5LnJlc29sdmUoKTsKICAgIH0KICAgIHRoaXMubXNnSGFuZGxlci5zZW5kKCJEb2NQcm9ncmVzcyIsIHsKICAgICAgbG9hZGVkOiB0aGlzLnN0cmVhbS5udW1DaHVua3NMb2FkZWQgKiB0aGlzLmNodW5rU2l6ZSwKICAgICAgdG90YWw6IHRoaXMubGVuZ3RoCiAgICB9KTsKICB9CiAgb25FcnJvcihlcnIpIHsKICAgIHRoaXMuX2xvYWRlZFN0cmVhbUNhcGFiaWxpdHkucmVqZWN0KGVycik7CiAgfQogIGdldEJlZ2luQ2h1bmsoYmVnaW4pIHsKICAgIHJldHVybiBNYXRoLmZsb29yKGJlZ2luIC8gdGhpcy5jaHVua1NpemUpOwogIH0KICBnZXRFbmRDaHVuayhlbmQpIHsKICAgIHJldHVybiBNYXRoLmZsb29yKChlbmQgLSAxKSAvIHRoaXMuY2h1bmtTaXplKSArIDE7CiAgfQogIGFib3J0KHJlYXNvbikgewogICAgdGhpcy5hYm9ydGVkID0gdHJ1ZTsKICAgIHRoaXMucGRmTmV0d29ya1N0cmVhbT8uY2FuY2VsQWxsUmVxdWVzdHMocmVhc29uKTsKICAgIGZvciAoY29uc3QgY2FwYWJpbGl0eSBvZiB0aGlzLl9wcm9taXNlc0J5UmVxdWVzdC52YWx1ZXMoKSkgewogICAgICBjYXBhYmlsaXR5LnJlamVjdChyZWFzb24pOwogICAgfQogIH0KfQpleHBvcnRzLkNodW5rZWRTdHJlYW1NYW5hZ2VyID0gQ2h1bmtlZFN0cmVhbU1hbmFnZXI7CgovKioqLyB9KSwKLyogOCAqLwovKioqLyAoKF9fdW51c2VkX3dlYnBhY2tfbW9kdWxlLCBleHBvcnRzLCBfX3dfcGRmanNfcmVxdWlyZV9fKSA9PiB7CgoKCk9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCAiX19lc01vZHVsZSIsICh7CiAgdmFsdWU6IHRydWUKfSkpOwpleHBvcnRzLlN0cmluZ1N0cmVhbSA9IGV4cG9ydHMuU3RyZWFtID0gZXhwb3J0cy5OdWxsU3RyZWFtID0gdm9pZCAwOwp2YXIgX2Jhc2Vfc3RyZWFtID0gX193X3BkZmpzX3JlcXVpcmVfXyg1KTsKdmFyIF91dGlsID0gX193X3BkZmpzX3JlcXVpcmVfXygyKTsKY2xhc3MgU3RyZWFtIGV4dGVuZHMgX2Jhc2Vfc3RyZWFtLkJhc2VTdHJlYW0gewogIGNvbnN0cnVjdG9yKGFycmF5QnVmZmVyLCBzdGFydCwgbGVuZ3RoLCBkaWN0KSB7CiAgICBzdXBlcigpOwogICAgdGhpcy5ieXRlcyA9IGFycmF5QnVmZmVyIGluc3RhbmNlb2YgVWludDhBcnJheSA/IGFycmF5QnVmZmVyIDogbmV3IFVpbnQ4QXJyYXkoYXJyYXlCdWZmZXIpOwogICAgdGhpcy5zdGFydCA9IHN0YXJ0IHx8IDA7CiAgICB0aGlzLnBvcyA9IHRoaXMuc3RhcnQ7CiAgICB0aGlzLmVuZCA9IHN0YXJ0ICsgbGVuZ3RoIHx8IHRoaXMuYnl0ZXMubGVuZ3RoOwogICAgdGhpcy5kaWN0ID0gZGljdDsKICB9CiAgZ2V0IGxlbmd0aCgpIHsKICAgIHJldHVybiB0aGlzLmVuZCAtIHRoaXMuc3RhcnQ7CiAgfQogIGdldCBpc0VtcHR5KCkgewogICAgcmV0dXJuIHRoaXMubGVuZ3RoID09PSAwOwogIH0KICBnZXRCeXRlKCkgewogICAgaWYgKHRoaXMucG9zID49IHRoaXMuZW5kKSB7CiAgICAgIHJldHVybiAtMTsKICAgIH0KICAgIHJldHVybiB0aGlzLmJ5dGVzW3RoaXMucG9zKytdOwogIH0KICBnZXRCeXRlcyhsZW5ndGgpIHsKICAgIGNvbnN0IGJ5dGVzID0gdGhpcy5ieXRlczsKICAgIGNvbnN0IHBvcyA9IHRoaXMucG9zOwogICAgY29uc3Qgc3RyRW5kID0gdGhpcy5lbmQ7CiAgICBpZiAoIWxlbmd0aCkgewogICAgICByZXR1cm4gYnl0ZXMuc3ViYXJyYXkocG9zLCBzdHJFbmQpOwogICAgfQogICAgbGV0IGVuZCA9IHBvcyArIGxlbmd0aDsKICAgIGlmIChlbmQgPiBzdHJFbmQpIHsKICAgICAgZW5kID0gc3RyRW5kOwogICAgfQogICAgdGhpcy5wb3MgPSBlbmQ7CiAgICByZXR1cm4gYnl0ZXMuc3ViYXJyYXkocG9zLCBlbmQpOwogIH0KICBnZXRCeXRlUmFuZ2UoYmVnaW4sIGVuZCkgewogICAgaWYgKGJlZ2luIDwgMCkgewogICAgICBiZWdpbiA9IDA7CiAgICB9CiAgICBpZiAoZW5kID4gdGhpcy5lbmQpIHsKICAgICAgZW5kID0gdGhpcy5lbmQ7CiAgICB9CiAgICByZXR1cm4gdGhpcy5ieXRlcy5zdWJhcnJheShiZWdpbiwgZW5kKTsKICB9CiAgcmVzZXQoKSB7CiAgICB0aGlzLnBvcyA9IHRoaXMuc3RhcnQ7CiAgfQogIG1vdmVTdGFydCgpIHsKICAgIHRoaXMuc3RhcnQgPSB0aGlzLnBvczsKICB9CiAgbWFrZVN1YlN0cmVhbShzdGFydCwgbGVuZ3RoLCBkaWN0ID0gbnVsbCkgewogICAgcmV0dXJuIG5ldyBTdHJlYW0odGhpcy5ieXRlcy5idWZmZXIsIHN0YXJ0LCBsZW5ndGgsIGRpY3QpOwogIH0KfQpleHBvcnRzLlN0cmVhbSA9IFN0cmVhbTsKY2xhc3MgU3RyaW5nU3RyZWFtIGV4dGVuZHMgU3RyZWFtIHsKICBjb25zdHJ1Y3RvcihzdHIpIHsKICAgIHN1cGVyKCgwLCBfdXRpbC5zdHJpbmdUb0J5dGVzKShzdHIpKTsKICB9Cn0KZXhwb3J0cy5TdHJpbmdTdHJlYW0gPSBTdHJpbmdTdHJlYW07CmNsYXNzIE51bGxTdHJlYW0gZXh0ZW5kcyBTdHJlYW0gewogIGNvbnN0cnVjdG9yKCkgewogICAgc3VwZXIobmV3IFVpbnQ4QXJyYXkoMCkpOwogIH0KfQpleHBvcnRzLk51bGxTdHJlYW0gPSBOdWxsU3RyZWFtOwoKLyoqKi8gfSksCi8qIDkgKi8KLyoqKi8gKChfX3VudXNlZF93ZWJwYWNrX21vZHVsZSwgZXhwb3J0cywgX193X3BkZmpzX3JlcXVpcmVfXykgPT4gewoKCgpPYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgIl9fZXNNb2R1bGUiLCAoewogIHZhbHVlOiB0cnVlCn0pKTsKZXhwb3J0cy5QYWdlID0gZXhwb3J0cy5QREZEb2N1bWVudCA9IHZvaWQgMDsKdmFyIF91dGlsID0gX193X3BkZmpzX3JlcXVpcmVfXygyKTsKdmFyIF9hbm5vdGF0aW9uID0gX193X3BkZmpzX3JlcXVpcmVfXygxMCk7CnZhciBfY29yZV91dGlscyA9IF9fd19wZGZqc19yZXF1aXJlX18oMyk7CnZhciBfcHJpbWl0aXZlcyA9IF9fd19wZGZqc19yZXF1aXJlX18oNCk7CnZhciBfeGZhX2ZvbnRzID0gX193X3BkZmpzX3JlcXVpcmVfXyg1MSk7CnZhciBfYmFzZV9zdHJlYW0gPSBfX3dfcGRmanNfcmVxdWlyZV9fKDUpOwp2YXIgX2NyeXB0byA9IF9fd19wZGZqc19yZXF1aXJlX18oNzQpOwp2YXIgX2NhdGFsb2cgPSBfX3dfcGRmanNfcmVxdWlyZV9fKDY2KTsKdmFyIF9jbGVhbnVwX2hlbHBlciA9IF9fd19wZGZqc19yZXF1aXJlX18oNjgpOwp2YXIgX2RhdGFzZXRfcmVhZGVyID0gX193X3BkZmpzX3JlcXVpcmVfXygxMDIpOwp2YXIgX3BhcnNlciA9IF9fd19wZGZqc19yZXF1aXJlX18oMTYpOwp2YXIgX3N0cmVhbSA9IF9fd19wZGZqc19yZXF1aXJlX18oOCk7CnZhciBfb2JqZWN0X2xvYWRlciA9IF9fd19wZGZqc19yZXF1aXJlX18oNzYpOwp2YXIgX29wZXJhdG9yX2xpc3QgPSBfX3dfcGRmanNfcmVxdWlyZV9fKDY0KTsKdmFyIF9ldmFsdWF0b3IgPSBfX3dfcGRmanNfcmVxdWlyZV9fKDEzKTsKdmFyIF9kZWNvZGVfc3RyZWFtID0gX193X3BkZmpzX3JlcXVpcmVfXygxOCk7CnZhciBfc3RydWN0X3RyZWUgPSBfX3dfcGRmanNfcmVxdWlyZV9fKDcyKTsKdmFyIF93cml0ZXIgPSBfX3dfcGRmanNfcmVxdWlyZV9fKDczKTsKdmFyIF9mYWN0b3J5ID0gX193X3BkZmpzX3JlcXVpcmVfXyg3Nyk7CnZhciBfeHJlZiA9IF9fd19wZGZqc19yZXF1aXJlX18oMTAzKTsKY29uc3QgREVGQVVMVF9VU0VSX1VOSVQgPSAxLjA7CmNvbnN0IExFVFRFUl9TSVpFX01FRElBQk9YID0gWzAsIDAsIDYxMiwgNzkyXTsKY2xhc3MgUGFnZSB7CiAgY29uc3RydWN0b3IoewogICAgcGRmTWFuYWdlciwKICAgIHhyZWYsCiAgICBwYWdlSW5kZXgsCiAgICBwYWdlRGljdCwKICAgIHJlZiwKICAgIGdsb2JhbElkRmFjdG9yeSwKICAgIGZvbnRDYWNoZSwKICAgIGJ1aWx0SW5DTWFwQ2FjaGUsCiAgICBzdGFuZGFyZEZvbnREYXRhQ2FjaGUsCiAgICBnbG9iYWxJbWFnZUNhY2hlLAogICAgc3lzdGVtRm9udENhY2hlLAogICAgbm9uQmxlbmRNb2Rlc1NldCwKICAgIHhmYUZhY3RvcnkKICB9KSB7CiAgICB0aGlzLnBkZk1hbmFnZXIgPSBwZGZNYW5hZ2VyOwogICAgdGhpcy5wYWdlSW5kZXggPSBwYWdlSW5kZXg7CiAgICB0aGlzLnBhZ2VEaWN0ID0gcGFnZURpY3Q7CiAgICB0aGlzLnhyZWYgPSB4cmVmOwogICAgdGhpcy5yZWYgPSByZWY7CiAgICB0aGlzLmZvbnRDYWNoZSA9IGZvbnRDYWNoZTsKICAgIHRoaXMuYnVpbHRJbkNNYXBDYWNoZSA9IGJ1aWx0SW5DTWFwQ2FjaGU7CiAgICB0aGlzLnN0YW5kYXJkRm9udERhdGFDYWNoZSA9IHN0YW5kYXJkRm9udERhdGFDYWNoZTsKICAgIHRoaXMuZ2xvYmFsSW1hZ2VDYWNoZSA9IGdsb2JhbEltYWdlQ2FjaGU7CiAgICB0aGlzLnN5c3RlbUZvbnRDYWNoZSA9IHN5c3RlbUZvbnRDYWNoZTsKICAgIHRoaXMubm9uQmxlbmRNb2Rlc1NldCA9IG5vbkJsZW5kTW9kZXNTZXQ7CiAgICB0aGlzLmV2YWx1YXRvck9wdGlvbnMgPSBwZGZNYW5hZ2VyLmV2YWx1YXRvck9wdGlvbnM7CiAgICB0aGlzLnJlc291cmNlc1Byb21pc2UgPSBudWxsOwogICAgdGhpcy54ZmFGYWN0b3J5ID0geGZhRmFjdG9yeTsKICAgIGNvbnN0IGlkQ291bnRlcnMgPSB7CiAgICAgIG9iajogMAogICAgfTsKICAgIHRoaXMuX2xvY2FsSWRGYWN0b3J5ID0gY2xhc3MgZXh0ZW5kcyBnbG9iYWxJZEZhY3RvcnkgewogICAgICBzdGF0aWMgY3JlYXRlT2JqSWQoKSB7CiAgICAgICAgcmV0dXJuIGBwJHtwYWdlSW5kZXh9XyR7KytpZENvdW50ZXJzLm9ian1gOwogICAgICB9CiAgICAgIHN0YXRpYyBnZXRQYWdlT2JqSWQoKSB7CiAgICAgICAgcmV0dXJuIGBwJHtyZWYudG9TdHJpbmcoKX1gOwogICAgICB9CiAgICB9OwogIH0KICBfZ2V0SW5oZXJpdGFibGVQcm9wZXJ0eShrZXksIGdldEFycmF5ID0gZmFsc2UpIHsKICAgIGNvbnN0IHZhbHVlID0gKDAsIF9jb3JlX3V0aWxzLmdldEluaGVyaXRhYmxlUHJvcGVydHkpKHsKICAgICAgZGljdDogdGhpcy5wYWdlRGljdCwKICAgICAga2V5LAogICAgICBnZXRBcnJheSwKICAgICAgc3RvcFdoZW5Gb3VuZDogZmFsc2UKICAgIH0pOwogICAgaWYgKCFBcnJheS5pc0FycmF5KHZhbHVlKSkgewogICAgICByZXR1cm4gdmFsdWU7CiAgICB9CiAgICBpZiAodmFsdWUubGVuZ3RoID09PSAxIHx8ICEodmFsdWVbMF0gaW5zdGFuY2VvZiBfcHJpbWl0aXZlcy5EaWN0KSkgewogICAgICByZXR1cm4gdmFsdWVbMF07CiAgICB9CiAgICByZXR1cm4gX3ByaW1pdGl2ZXMuRGljdC5tZXJnZSh7CiAgICAgIHhyZWY6IHRoaXMueHJlZiwKICAgICAgZGljdEFycmF5OiB2YWx1ZQogICAgfSk7CiAgfQogIGdldCBjb250ZW50KCkgewogICAgcmV0dXJuIHRoaXMucGFnZURpY3QuZ2V0QXJyYXkoIkNvbnRlbnRzIik7CiAgfQogIGdldCByZXNvdXJjZXMoKSB7CiAgICBjb25zdCByZXNvdXJjZXMgPSB0aGlzLl9nZXRJbmhlcml0YWJsZVByb3BlcnR5KCJSZXNvdXJjZXMiKTsKICAgIHJldHVybiAoMCwgX3V0aWwuc2hhZG93KSh0aGlzLCAicmVzb3VyY2VzIiwgcmVzb3VyY2VzIGluc3RhbmNlb2YgX3ByaW1pdGl2ZXMuRGljdCA/IHJlc291cmNlcyA6IF9wcmltaXRpdmVzLkRpY3QuZW1wdHkpOwogIH0KICBfZ2V0Qm91bmRpbmdCb3gobmFtZSkgewogICAgaWYgKHRoaXMueGZhRGF0YSkgewogICAgICByZXR1cm4gdGhpcy54ZmFEYXRhLmJib3g7CiAgICB9CiAgICBsZXQgYm94ID0gdGhpcy5fZ2V0SW5oZXJpdGFibGVQcm9wZXJ0eShuYW1lLCB0cnVlKTsKICAgIGlmIChBcnJheS5pc0FycmF5KGJveCkgJiYgYm94Lmxlbmd0aCA9PT0gNCkgewogICAgICBib3ggPSBfdXRpbC5VdGlsLm5vcm1hbGl6ZVJlY3QoYm94KTsKICAgICAgaWYgKGJveFsyXSAtIGJveFswXSA+IDAgJiYgYm94WzNdIC0gYm94WzFdID4gMCkgewogICAgICAgIHJldHVybiBib3g7CiAgICAgIH0KICAgICAgKDAsIF91dGlsLndhcm4pKGBFbXB0eSwgb3IgaW52YWxpZCwgLyR7bmFtZX0gZW50cnkuYCk7CiAgICB9CiAgICByZXR1cm4gbnVsbDsKICB9CiAgZ2V0IG1lZGlhQm94KCkgewogICAgcmV0dXJuICgwLCBfdXRpbC5zaGFkb3cpKHRoaXMsICJtZWRpYUJveCIsIHRoaXMuX2dldEJvdW5kaW5nQm94KCJNZWRpYUJveCIpIHx8IExFVFRFUl9TSVpFX01FRElBQk9YKTsKICB9CiAgZ2V0IGNyb3BCb3goKSB7CiAgICByZXR1cm4gKDAsIF91dGlsLnNoYWRvdykodGhpcywgImNyb3BCb3giLCB0aGlzLl9nZXRCb3VuZGluZ0JveCgiQ3JvcEJveCIpIHx8IHRoaXMubWVkaWFCb3gpOwogIH0KICBnZXQgdXNlclVuaXQoKSB7CiAgICBsZXQgb2JqID0gdGhpcy5wYWdlRGljdC5nZXQoIlVzZXJVbml0Iik7CiAgICBpZiAodHlwZW9mIG9iaiAhPT0gIm51bWJlciIgfHwgb2JqIDw9IDApIHsKICAgICAgb2JqID0gREVGQVVMVF9VU0VSX1VOSVQ7CiAgICB9CiAgICByZXR1cm4gKDAsIF91dGlsLnNoYWRvdykodGhpcywgInVzZXJVbml0Iiwgb2JqKTsKICB9CiAgZ2V0IHZpZXcoKSB7CiAgICBjb25zdCB7CiAgICAgIGNyb3BCb3gsCiAgICAgIG1lZGlhQm94CiAgICB9ID0gdGhpczsKICAgIGlmIChjcm9wQm94ICE9PSBtZWRpYUJveCAmJiAhKDAsIF91dGlsLmlzQXJyYXlFcXVhbCkoY3JvcEJveCwgbWVkaWFCb3gpKSB7CiAgICAgIGNvbnN0IGJveCA9IF91dGlsLlV0aWwuaW50ZXJzZWN0KGNyb3BCb3gsIG1lZGlhQm94KTsKICAgICAgaWYgKGJveCAmJiBib3hbMl0gLSBib3hbMF0gPiAwICYmIGJveFszXSAtIGJveFsxXSA+IDApIHsKICAgICAgICByZXR1cm4gKDAsIF91dGlsLnNoYWRvdykodGhpcywgInZpZXciLCBib3gpOwogICAgICB9CiAgICAgICgwLCBfdXRpbC53YXJuKSgiRW1wdHkgL0Nyb3BCb3ggYW5kIC9NZWRpYUJveCBpbnRlcnNlY3Rpb24uIik7CiAgICB9CiAgICByZXR1cm4gKDAsIF91dGlsLnNoYWRvdykodGhpcywgInZpZXciLCBtZWRpYUJveCk7CiAgfQogIGdldCByb3RhdGUoKSB7CiAgICBsZXQgcm90YXRlID0gdGhpcy5fZ2V0SW5oZXJpdGFibGVQcm9wZXJ0eSgiUm90YXRlIikgfHwgMDsKICAgIGlmIChyb3RhdGUgJSA5MCAhPT0gMCkgewogICAgICByb3RhdGUgPSAwOwogICAgfSBlbHNlIGlmIChyb3RhdGUgPj0gMzYwKSB7CiAgICAgIHJvdGF0ZSAlPSAzNjA7CiAgICB9IGVsc2UgaWYgKHJvdGF0ZSA8IDApIHsKICAgICAgcm90YXRlID0gKHJvdGF0ZSAlIDM2MCArIDM2MCkgJSAzNjA7CiAgICB9CiAgICByZXR1cm4gKDAsIF91dGlsLnNoYWRvdykodGhpcywgInJvdGF0ZSIsIHJvdGF0ZSk7CiAgfQogIF9vblN1YlN0cmVhbUVycm9yKHJlYXNvbiwgb2JqSWQpIHsKICAgIGlmICh0aGlzLmV2YWx1YXRvck9wdGlvbnMuaWdub3JlRXJyb3JzKSB7CiAgICAgICgwLCBfdXRpbC53YXJuKShgZ2V0Q29udGVudFN0cmVhbSAtIGlnbm9yaW5nIHN1Yi1zdHJlYW0gKCR7b2JqSWR9KTogIiR7cmVhc29ufSIuYCk7CiAgICAgIHJldHVybjsKICAgIH0KICAgIHRocm93IHJlYXNvbjsKICB9CiAgZ2V0Q29udGVudFN0cmVhbSgpIHsKICAgIHJldHVybiB0aGlzLnBkZk1hbmFnZXIuZW5zdXJlKHRoaXMsICJjb250ZW50IikudGhlbihjb250ZW50ID0+IHsKICAgICAgaWYgKGNvbnRlbnQgaW5zdGFuY2VvZiBfYmFzZV9zdHJlYW0uQmFzZVN0cmVhbSkgewogICAgICAgIHJldHVybiBjb250ZW50OwogICAgICB9CiAgICAgIGlmIChBcnJheS5pc0FycmF5KGNvbnRlbnQpKSB7CiAgICAgICAgcmV0dXJuIG5ldyBfZGVjb2RlX3N0cmVhbS5TdHJlYW1zU2VxdWVuY2VTdHJlYW0oY29udGVudCwgdGhpcy5fb25TdWJTdHJlYW1FcnJvci5iaW5kKHRoaXMpKTsKICAgICAgfQogICAgICByZXR1cm4gbmV3IF9zdHJlYW0uTnVsbFN0cmVhbSgpOwogICAgfSk7CiAgfQogIGdldCB4ZmFEYXRhKCkgewogICAgcmV0dXJuICgwLCBfdXRpbC5zaGFkb3cpKHRoaXMsICJ4ZmFEYXRhIiwgdGhpcy54ZmFGYWN0b3J5ID8gewogICAgICBiYm94OiB0aGlzLnhmYUZhY3RvcnkuZ2V0Qm91bmRpbmdCb3godGhpcy5wYWdlSW5kZXgpCiAgICB9IDogbnVsbCk7CiAgfQogICNyZXBsYWNlSWRCeVJlZihhbm5vdGF0aW9ucywgZGVsZXRlZEFubm90YXRpb25zLCBleGlzdGluZ0Fubm90YXRpb25zKSB7CiAgICBmb3IgKGNvbnN0IGFubm90YXRpb24gb2YgYW5ub3RhdGlvbnMpIHsKICAgICAgaWYgKGFubm90YXRpb24uaWQpIHsKICAgICAgICBjb25zdCByZWYgPSBfcHJpbWl0aXZlcy5SZWYuZnJvbVN0cmluZyhhbm5vdGF0aW9uLmlkKTsKICAgICAgICBpZiAoIXJlZikgewogICAgICAgICAgKDAsIF91dGlsLndhcm4pKGBBIG5vbi1saW5rZWQgYW5ub3RhdGlvbiBjYW5ub3QgYmUgbW9kaWZpZWQ6ICR7YW5ub3RhdGlvbi5pZH1gKTsKICAgICAgICAgIGNvbnRpbnVlOwogICAgICAgIH0KICAgICAgICBpZiAoYW5ub3RhdGlvbi5kZWxldGVkKSB7CiAgICAgICAgICBkZWxldGVkQW5ub3RhdGlvbnMucHV0KHJlZik7CiAgICAgICAgICBjb250aW51ZTsKICAgICAgICB9CiAgICAgICAgZXhpc3RpbmdBbm5vdGF0aW9ucz8ucHV0KHJlZik7CiAgICAgICAgYW5ub3RhdGlvbi5yZWYgPSByZWY7CiAgICAgICAgZGVsZXRlIGFubm90YXRpb24uaWQ7CiAgICAgIH0KICAgIH0KICB9CiAgYXN5bmMgc2F2ZU5ld0Fubm90YXRpb25zKGhhbmRsZXIsIHRhc2ssIGFubm90YXRpb25zLCBpbWFnZVByb21pc2VzKSB7CiAgICBpZiAodGhpcy54ZmFGYWN0b3J5KSB7CiAgICAgIHRocm93IG5ldyBFcnJvcigiWEZBOiBDYW5ub3Qgc2F2ZSBuZXcgYW5ub3RhdGlvbnMuIik7CiAgICB9CiAgICBjb25zdCBwYXJ0aWFsRXZhbHVhdG9yID0gbmV3IF9ldmFsdWF0b3IuUGFydGlhbEV2YWx1YXRvcih7CiAgICAgIHhyZWY6IHRoaXMueHJlZiwKICAgICAgaGFuZGxlciwKICAgICAgcGFnZUluZGV4OiB0aGlzLnBhZ2VJbmRleCwKICAgICAgaWRGYWN0b3J5OiB0aGlzLl9sb2NhbElkRmFjdG9yeSwKICAgICAgZm9udENhY2hlOiB0aGlzLmZvbnRDYWNoZSwKICAgICAgYnVpbHRJbkNNYXBDYWNoZTogdGhpcy5idWlsdEluQ01hcENhY2hlLAogICAgICBzdGFuZGFyZEZvbnREYXRhQ2FjaGU6IHRoaXMuc3RhbmRhcmRGb250RGF0YUNhY2hlLAogICAgICBnbG9iYWxJbWFnZUNhY2hlOiB0aGlzLmdsb2JhbEltYWdlQ2FjaGUsCiAgICAgIHN5c3RlbUZvbnRDYWNoZTogdGhpcy5zeXN0ZW1Gb250Q2FjaGUsCiAgICAgIG9wdGlvbnM6IHRoaXMuZXZhbHVhdG9yT3B0aW9ucwogICAgfSk7CiAgICBjb25zdCBkZWxldGVkQW5ub3RhdGlvbnMgPSBuZXcgX3ByaW1pdGl2ZXMuUmVmU2V0KCk7CiAgICBjb25zdCBleGlzdGluZ0Fubm90YXRpb25zID0gbmV3IF9wcmltaXRpdmVzLlJlZlNldCgpOwogICAgdGhpcy4jcmVwbGFjZUlkQnlSZWYoYW5ub3RhdGlvbnMsIGRlbGV0ZWRBbm5vdGF0aW9ucywgZXhpc3RpbmdBbm5vdGF0aW9ucyk7CiAgICBjb25zdCBwYWdlRGljdCA9IHRoaXMucGFnZURpY3Q7CiAgICBjb25zdCBhbm5vdGF0aW9uc0FycmF5ID0gdGhpcy5hbm5vdGF0aW9ucy5maWx0ZXIoYSA9PiAhKGEgaW5zdGFuY2VvZiBfcHJpbWl0aXZlcy5SZWYgJiYgZGVsZXRlZEFubm90YXRpb25zLmhhcyhhKSkpOwogICAgY29uc3QgbmV3RGF0YSA9IGF3YWl0IF9hbm5vdGF0aW9uLkFubm90YXRpb25GYWN0b3J5LnNhdmVOZXdBbm5vdGF0aW9ucyhwYXJ0aWFsRXZhbHVhdG9yLCB0YXNrLCBhbm5vdGF0aW9ucywgaW1hZ2VQcm9taXNlcyk7CiAgICBmb3IgKGNvbnN0IHsKICAgICAgcmVmCiAgICB9IG9mIG5ld0RhdGEuYW5ub3RhdGlvbnMpIHsKICAgICAgaWYgKHJlZiBpbnN0YW5jZW9mIF9wcmltaXRpdmVzLlJlZiAmJiAhZXhpc3RpbmdBbm5vdGF0aW9ucy5oYXMocmVmKSkgewogICAgICAgIGFubm90YXRpb25zQXJyYXkucHVzaChyZWYpOwogICAgICB9CiAgICB9CiAgICBjb25zdCBzYXZlZERpY3QgPSBwYWdlRGljdC5nZXQoIkFubm90cyIpOwogICAgcGFnZURpY3Quc2V0KCJBbm5vdHMiLCBhbm5vdGF0aW9uc0FycmF5KTsKICAgIGNvbnN0IGJ1ZmZlciA9IFtdOwogICAgYXdhaXQgKDAsIF93cml0ZXIud3JpdGVPYmplY3QpKHRoaXMucmVmLCBwYWdlRGljdCwgYnVmZmVyLCB0aGlzLnhyZWYpOwogICAgaWYgKHNhdmVkRGljdCkgewogICAgICBwYWdlRGljdC5zZXQoIkFubm90cyIsIHNhdmVkRGljdCk7CiAgICB9CiAgICBjb25zdCBvYmplY3RzID0gbmV3RGF0YS5kZXBlbmRlbmNpZXM7CiAgICBvYmplY3RzLnB1c2goewogICAgICByZWY6IHRoaXMucmVmLAogICAgICBkYXRhOiBidWZmZXIuam9pbigiIikKICAgIH0sIC4uLm5ld0RhdGEuYW5ub3RhdGlvbnMpOwogICAgcmV0dXJuIG9iamVjdHM7CiAgfQogIHNhdmUoaGFuZGxlciwgdGFzaywgYW5ub3RhdGlvblN0b3JhZ2UpIHsKICAgIGNvbnN0IHBhcnRpYWxFdmFsdWF0b3IgPSBuZXcgX2V2YWx1YXRvci5QYXJ0aWFsRXZhbHVhdG9yKHsKICAgICAgeHJlZjogdGhpcy54cmVmLAogICAgICBoYW5kbGVyLAogICAgICBwYWdlSW5kZXg6IHRoaXMucGFnZUluZGV4LAogICAgICBpZEZhY3Rvcnk6IHRoaXMuX2xvY2FsSWRGYWN0b3J5LAogICAgICBmb250Q2FjaGU6IHRoaXMuZm9udENhY2hlLAogICAgICBidWlsdEluQ01hcENhY2hlOiB0aGlzLmJ1aWx0SW5DTWFwQ2FjaGUsCiAgICAgIHN0YW5kYXJkRm9udERhdGFDYWNoZTogdGhpcy5zdGFuZGFyZEZvbnREYXRhQ2FjaGUsCiAgICAgIGdsb2JhbEltYWdlQ2FjaGU6IHRoaXMuZ2xvYmFsSW1hZ2VDYWNoZSwKICAgICAgc3lzdGVtRm9udENhY2hlOiB0aGlzLnN5c3RlbUZvbnRDYWNoZSwKICAgICAgb3B0aW9uczogdGhpcy5ldmFsdWF0b3JPcHRpb25zCiAgICB9KTsKICAgIHJldHVybiB0aGlzLl9wYXJzZWRBbm5vdGF0aW9ucy50aGVuKGZ1bmN0aW9uIChhbm5vdGF0aW9ucykgewogICAgICBjb25zdCBuZXdSZWZzUHJvbWlzZXMgPSBbXTsKICAgICAgZm9yIChjb25zdCBhbm5vdGF0aW9uIG9mIGFubm90YXRpb25zKSB7CiAgICAgICAgaWYgKCFhbm5vdGF0aW9uLm11c3RCZVByaW50ZWQoYW5ub3RhdGlvblN0b3JhZ2UpKSB7CiAgICAgICAgICBjb250aW51ZTsKICAgICAgICB9CiAgICAgICAgbmV3UmVmc1Byb21pc2VzLnB1c2goYW5ub3RhdGlvbi5zYXZlKHBhcnRpYWxFdmFsdWF0b3IsIHRhc2ssIGFubm90YXRpb25TdG9yYWdlKS5jYXRjaChmdW5jdGlvbiAocmVhc29uKSB7CiAgICAgICAgICAoMCwgX3V0aWwud2FybikoInNhdmUgLSBpZ25vcmluZyBhbm5vdGF0aW9uIGRhdGEgZHVyaW5nICIgKyBgIiR7dGFzay5uYW1lfSIgdGFzazogIiR7cmVhc29ufSIuYCk7CiAgICAgICAgICByZXR1cm4gbnVsbDsKICAgICAgICB9KSk7CiAgICAgIH0KICAgICAgcmV0dXJuIFByb21pc2UuYWxsKG5ld1JlZnNQcm9taXNlcykudGhlbihmdW5jdGlvbiAobmV3UmVmcykgewogICAgICAgIHJldHVybiBuZXdSZWZzLmZpbHRlcihuZXdSZWYgPT4gISFuZXdSZWYpOwogICAgICB9KTsKICAgIH0pOwogIH0KICBsb2FkUmVzb3VyY2VzKGtleXMpIHsKICAgIGlmICghdGhpcy5yZXNvdXJjZXNQcm9taXNlKSB7CiAgICAgIHRoaXMucmVzb3VyY2VzUHJvbWlzZSA9IHRoaXMucGRmTWFuYWdlci5lbnN1cmUodGhpcywgInJlc291cmNlcyIpOwogICAgfQogICAgcmV0dXJuIHRoaXMucmVzb3VyY2VzUHJvbWlzZS50aGVuKCgpID0+IHsKICAgICAgY29uc3Qgb2JqZWN0TG9hZGVyID0gbmV3IF9vYmplY3RfbG9hZGVyLk9iamVjdExvYWRlcih0aGlzLnJlc291cmNlcywga2V5cywgdGhpcy54cmVmKTsKICAgICAgcmV0dXJuIG9iamVjdExvYWRlci5sb2FkKCk7CiAgICB9KTsKICB9CiAgZ2V0T3BlcmF0b3JMaXN0KHsKICAgIGhhbmRsZXIsCiAgICBzaW5rLAogICAgdGFzaywKICAgIGludGVudCwKICAgIGNhY2hlS2V5LAogICAgYW5ub3RhdGlvblN0b3JhZ2UgPSBudWxsCiAgfSkgewogICAgY29uc3QgY29udGVudFN0cmVhbVByb21pc2UgPSB0aGlzLmdldENvbnRlbnRTdHJlYW0oKTsKICAgIGNvbnN0IHJlc291cmNlc1Byb21pc2UgPSB0aGlzLmxvYWRSZXNvdXJjZXMoWyJDb2xvclNwYWNlIiwgIkV4dEdTdGF0ZSIsICJGb250IiwgIlBhdHRlcm4iLCAiUHJvcGVydGllcyIsICJTaGFkaW5nIiwgIlhPYmplY3QiXSk7CiAgICBjb25zdCBwYXJ0aWFsRXZhbHVhdG9yID0gbmV3IF9ldmFsdWF0b3IuUGFydGlhbEV2YWx1YXRvcih7CiAgICAgIHhyZWY6IHRoaXMueHJlZiwKICAgICAgaGFuZGxlciwKICAgICAgcGFnZUluZGV4OiB0aGlzLnBhZ2VJbmRleCwKICAgICAgaWRGYWN0b3J5OiB0aGlzLl9sb2NhbElkRmFjdG9yeSwKICAgICAgZm9udENhY2hlOiB0aGlzLmZvbnRDYWNoZSwKICAgICAgYnVpbHRJbkNNYXBDYWNoZTogdGhpcy5idWlsdEluQ01hcENhY2hlLAogICAgICBzdGFuZGFyZEZvbnREYXRhQ2FjaGU6IHRoaXMuc3RhbmRhcmRGb250RGF0YUNhY2hlLAogICAgICBnbG9iYWxJbWFnZUNhY2hlOiB0aGlzLmdsb2JhbEltYWdlQ2FjaGUsCiAgICAgIHN5c3RlbUZvbnRDYWNoZTogdGhpcy5zeXN0ZW1Gb250Q2FjaGUsCiAgICAgIG9wdGlvbnM6IHRoaXMuZXZhbHVhdG9yT3B0aW9ucwogICAgfSk7CiAgICBjb25zdCBuZXdBbm5vdGF0aW9uc0J5UGFnZSA9ICF0aGlzLnhmYUZhY3RvcnkgPyAoMCwgX2NvcmVfdXRpbHMuZ2V0TmV3QW5ub3RhdGlvbnNNYXApKGFubm90YXRpb25TdG9yYWdlKSA6IG51bGw7CiAgICBsZXQgZGVsZXRlZEFubm90YXRpb25zID0gbnVsbDsKICAgIGxldCBuZXdBbm5vdGF0aW9uc1Byb21pc2UgPSBQcm9taXNlLnJlc29sdmUobnVsbCk7CiAgICBpZiAobmV3QW5ub3RhdGlvbnNCeVBhZ2UpIHsKICAgICAgY29uc3QgbmV3QW5ub3RhdGlvbnMgPSBuZXdBbm5vdGF0aW9uc0J5UGFnZS5nZXQodGhpcy5wYWdlSW5kZXgpOwogICAgICBpZiAobmV3QW5ub3RhdGlvbnMpIHsKICAgICAgICBjb25zdCBhbm5vdGF0aW9uR2xvYmFsc1Byb21pc2UgPSB0aGlzLnBkZk1hbmFnZXIuZW5zdXJlRG9jKCJhbm5vdGF0aW9uR2xvYmFscyIpOwogICAgICAgIGxldCBpbWFnZVByb21pc2VzOwogICAgICAgIGNvbnN0IG1pc3NpbmdCaXRtYXBzID0gbmV3IFNldCgpOwogICAgICAgIGZvciAoY29uc3QgewogICAgICAgICAgYml0bWFwSWQsCiAgICAgICAgICBiaXRtYXAKICAgICAgICB9IG9mIG5ld0Fubm90YXRpb25zKSB7CiAgICAgICAgICBpZiAoYml0bWFwSWQgJiYgIWJpdG1hcCAmJiAhbWlzc2luZ0JpdG1hcHMuaGFzKGJpdG1hcElkKSkgewogICAgICAgICAgICBtaXNzaW5nQml0bWFwcy5hZGQoYml0bWFwSWQpOwogICAgICAgICAgfQogICAgICAgIH0KICAgICAgICBjb25zdCB7CiAgICAgICAgICBpc09mZnNjcmVlbkNhbnZhc1N1cHBvcnRlZAogICAgICAgIH0gPSB0aGlzLmV2YWx1YXRvck9wdGlvbnM7CiAgICAgICAgaWYgKG1pc3NpbmdCaXRtYXBzLnNpemUgPiAwKSB7CiAgICAgICAgICBjb25zdCBhbm5vdGF0aW9uV2l0aEJpdG1hcHMgPSBuZXdBbm5vdGF0aW9ucy5zbGljZSgpOwogICAgICAgICAgZm9yIChjb25zdCBba2V5LCBhbm5vdGF0aW9uXSBvZiBhbm5vdGF0aW9uU3RvcmFnZSkgewogICAgICAgICAgICBpZiAoIWtleS5zdGFydHNXaXRoKF91dGlsLkFubm90YXRpb25FZGl0b3JQcmVmaXgpKSB7CiAgICAgICAgICAgICAgY29udGludWU7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgaWYgKGFubm90YXRpb24uYml0bWFwICYmIG1pc3NpbmdCaXRtYXBzLmhhcyhhbm5vdGF0aW9uLmJpdG1hcElkKSkgewogICAgICAgICAgICAgIGFubm90YXRpb25XaXRoQml0bWFwcy5wdXNoKGFubm90YXRpb24pOwogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgICBpbWFnZVByb21pc2VzID0gX2Fubm90YXRpb24uQW5ub3RhdGlvbkZhY3RvcnkuZ2VuZXJhdGVJbWFnZXMoYW5ub3RhdGlvbldpdGhCaXRtYXBzLCB0aGlzLnhyZWYsIGlzT2Zmc2NyZWVuQ2FudmFzU3VwcG9ydGVkKTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgaW1hZ2VQcm9taXNlcyA9IF9hbm5vdGF0aW9uLkFubm90YXRpb25GYWN0b3J5LmdlbmVyYXRlSW1hZ2VzKG5ld0Fubm90YXRpb25zLCB0aGlzLnhyZWYsIGlzT2Zmc2NyZWVuQ2FudmFzU3VwcG9ydGVkKTsKICAgICAgICB9CiAgICAgICAgZGVsZXRlZEFubm90YXRpb25zID0gbmV3IF9wcmltaXRpdmVzLlJlZlNldCgpOwogICAgICAgIHRoaXMuI3JlcGxhY2VJZEJ5UmVmKG5ld0Fubm90YXRpb25zLCBkZWxldGVkQW5ub3RhdGlvbnMsIG51bGwpOwogICAgICAgIG5ld0Fubm90YXRpb25zUHJvbWlzZSA9IGFubm90YXRpb25HbG9iYWxzUHJvbWlzZS50aGVuKGFubm90YXRpb25HbG9iYWxzID0+IHsKICAgICAgICAgIGlmICghYW5ub3RhdGlvbkdsb2JhbHMpIHsKICAgICAgICAgICAgcmV0dXJuIG51bGw7CiAgICAgICAgICB9CiAgICAgICAgICByZXR1cm4gX2Fubm90YXRpb24uQW5ub3RhdGlvbkZhY3RvcnkucHJpbnROZXdBbm5vdGF0aW9ucyhhbm5vdGF0aW9uR2xvYmFscywgcGFydGlhbEV2YWx1YXRvciwgdGFzaywgbmV3QW5ub3RhdGlvbnMsIGltYWdlUHJvbWlzZXMpOwogICAgICAgIH0pOwogICAgICB9CiAgICB9CiAgICBjb25zdCBkYXRhUHJvbWlzZXMgPSBQcm9taXNlLmFsbChbY29udGVudFN0cmVhbVByb21pc2UsIHJlc291cmNlc1Byb21pc2VdKTsKICAgIGNvbnN0IHBhZ2VMaXN0UHJvbWlzZSA9IGRhdGFQcm9taXNlcy50aGVuKChbY29udGVudFN0cmVhbV0pID0+IHsKICAgICAgY29uc3Qgb3BMaXN0ID0gbmV3IF9vcGVyYXRvcl9saXN0Lk9wZXJhdG9yTGlzdChpbnRlbnQsIHNpbmspOwogICAgICBoYW5kbGVyLnNlbmQoIlN0YXJ0UmVuZGVyUGFnZSIsIHsKICAgICAgICB0cmFuc3BhcmVuY3k6IHBhcnRpYWxFdmFsdWF0b3IuaGFzQmxlbmRNb2Rlcyh0aGlzLnJlc291cmNlcywgdGhpcy5ub25CbGVuZE1vZGVzU2V0KSwKICAgICAgICBwYWdlSW5kZXg6IHRoaXMucGFnZUluZGV4LAogICAgICAgIGNhY2hlS2V5CiAgICAgIH0pOwogICAgICByZXR1cm4gcGFydGlhbEV2YWx1YXRvci5nZXRPcGVyYXRvckxpc3QoewogICAgICAgIHN0cmVhbTogY29udGVudFN0cmVhbSwKICAgICAgICB0YXNrLAogICAgICAgIHJlc291cmNlczogdGhpcy5yZXNvdXJjZXMsCiAgICAgICAgb3BlcmF0b3JMaXN0OiBvcExpc3QKICAgICAgfSkudGhlbihmdW5jdGlvbiAoKSB7CiAgICAgICAgcmV0dXJuIG9wTGlzdDsKICAgICAgfSk7CiAgICB9KTsKICAgIHJldHVybiBQcm9taXNlLmFsbChbcGFnZUxpc3RQcm9taXNlLCB0aGlzLl9wYXJzZWRBbm5vdGF0aW9ucywgbmV3QW5ub3RhdGlvbnNQcm9taXNlXSkudGhlbihmdW5jdGlvbiAoW3BhZ2VPcExpc3QsIGFubm90YXRpb25zLCBuZXdBbm5vdGF0aW9uc10pIHsKICAgICAgaWYgKG5ld0Fubm90YXRpb25zKSB7CiAgICAgICAgYW5ub3RhdGlvbnMgPSBhbm5vdGF0aW9ucy5maWx0ZXIoYSA9PiAhKGEucmVmICYmIGRlbGV0ZWRBbm5vdGF0aW9ucy5oYXMoYS5yZWYpKSk7CiAgICAgICAgZm9yIChsZXQgaSA9IDAsIGlpID0gbmV3QW5ub3RhdGlvbnMubGVuZ3RoOyBpIDwgaWk7IGkrKykgewogICAgICAgICAgY29uc3QgbmV3QW5ub3RhdGlvbiA9IG5ld0Fubm90YXRpb25zW2ldOwogICAgICAgICAgaWYgKG5ld0Fubm90YXRpb24ucmVmVG9SZXBsYWNlKSB7CiAgICAgICAgICAgIGNvbnN0IGogPSBhbm5vdGF0aW9ucy5maW5kSW5kZXgoYSA9PiBhLnJlZiAmJiAoMCwgX3ByaW1pdGl2ZXMuaXNSZWZzRXF1YWwpKGEucmVmLCBuZXdBbm5vdGF0aW9uLnJlZlRvUmVwbGFjZSkpOwogICAgICAgICAgICBpZiAoaiA+PSAwKSB7CiAgICAgICAgICAgICAgYW5ub3RhdGlvbnMuc3BsaWNlKGosIDEsIG5ld0Fubm90YXRpb24pOwogICAgICAgICAgICAgIG5ld0Fubm90YXRpb25zLnNwbGljZShpLS0sIDEpOwogICAgICAgICAgICAgIGlpLS07CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgYW5ub3RhdGlvbnMgPSBhbm5vdGF0aW9ucy5jb25jYXQobmV3QW5ub3RhdGlvbnMpOwogICAgICB9CiAgICAgIGlmIChhbm5vdGF0aW9ucy5sZW5ndGggPT09IDAgfHwgaW50ZW50ICYgX3V0aWwuUmVuZGVyaW5nSW50ZW50RmxhZy5BTk5PVEFUSU9OU19ESVNBQkxFKSB7CiAgICAgICAgcGFnZU9wTGlzdC5mbHVzaCh0cnVlKTsKICAgICAgICByZXR1cm4gewogICAgICAgICAgbGVuZ3RoOiBwYWdlT3BMaXN0LnRvdGFsTGVuZ3RoCiAgICAgICAgfTsKICAgICAgfQogICAgICBjb25zdCByZW5kZXJGb3JtcyA9ICEhKGludGVudCAmIF91dGlsLlJlbmRlcmluZ0ludGVudEZsYWcuQU5OT1RBVElPTlNfRk9STVMpLAogICAgICAgIGludGVudEFueSA9ICEhKGludGVudCAmIF91dGlsLlJlbmRlcmluZ0ludGVudEZsYWcuQU5ZKSwKICAgICAgICBpbnRlbnREaXNwbGF5ID0gISEoaW50ZW50ICYgX3V0aWwuUmVuZGVyaW5nSW50ZW50RmxhZy5ESVNQTEFZKSwKICAgICAgICBpbnRlbnRQcmludCA9ICEhKGludGVudCAmIF91dGlsLlJlbmRlcmluZ0ludGVudEZsYWcuUFJJTlQpOwogICAgICBjb25zdCBvcExpc3RQcm9taXNlcyA9IFtdOwogICAgICBmb3IgKGNvbnN0IGFubm90YXRpb24gb2YgYW5ub3RhdGlvbnMpIHsKICAgICAgICBpZiAoaW50ZW50QW55IHx8IGludGVudERpc3BsYXkgJiYgYW5ub3RhdGlvbi5tdXN0QmVWaWV3ZWQoYW5ub3RhdGlvblN0b3JhZ2UsIHJlbmRlckZvcm1zKSB8fCBpbnRlbnRQcmludCAmJiBhbm5vdGF0aW9uLm11c3RCZVByaW50ZWQoYW5ub3RhdGlvblN0b3JhZ2UpKSB7CiAgICAgICAgICBvcExpc3RQcm9taXNlcy5wdXNoKGFubm90YXRpb24uZ2V0T3BlcmF0b3JMaXN0KHBhcnRpYWxFdmFsdWF0b3IsIHRhc2ssIGludGVudCwgcmVuZGVyRm9ybXMsIGFubm90YXRpb25TdG9yYWdlKS5jYXRjaChmdW5jdGlvbiAocmVhc29uKSB7CiAgICAgICAgICAgICgwLCBfdXRpbC53YXJuKSgiZ2V0T3BlcmF0b3JMaXN0IC0gaWdub3JpbmcgYW5ub3RhdGlvbiBkYXRhIGR1cmluZyAiICsgYCIke3Rhc2submFtZX0iIHRhc2s6ICIke3JlYXNvbn0iLmApOwogICAgICAgICAgICByZXR1cm4gewogICAgICAgICAgICAgIG9wTGlzdDogbnVsbCwKICAgICAgICAgICAgICBzZXBhcmF0ZUZvcm06IGZhbHNlLAogICAgICAgICAgICAgIHNlcGFyYXRlQ2FudmFzOiBmYWxzZQogICAgICAgICAgICB9OwogICAgICAgICAgfSkpOwogICAgICAgIH0KICAgICAgfQogICAgICByZXR1cm4gUHJvbWlzZS5hbGwob3BMaXN0UHJvbWlzZXMpLnRoZW4oZnVuY3Rpb24gKG9wTGlzdHMpIHsKICAgICAgICBsZXQgZm9ybSA9IGZhbHNlLAogICAgICAgICAgY2FudmFzID0gZmFsc2U7CiAgICAgICAgZm9yIChjb25zdCB7CiAgICAgICAgICBvcExpc3QsCiAgICAgICAgICBzZXBhcmF0ZUZvcm0sCiAgICAgICAgICBzZXBhcmF0ZUNhbnZhcwogICAgICAgIH0gb2Ygb3BMaXN0cykgewogICAgICAgICAgcGFnZU9wTGlzdC5hZGRPcExpc3Qob3BMaXN0KTsKICAgICAgICAgIGZvcm0gfHw9IHNlcGFyYXRlRm9ybTsKICAgICAgICAgIGNhbnZhcyB8fD0gc2VwYXJhdGVDYW52YXM7CiAgICAgICAgfQogICAgICAgIHBhZ2VPcExpc3QuZmx1c2godHJ1ZSwgewogICAgICAgICAgZm9ybSwKICAgICAgICAgIGNhbnZhcwogICAgICAgIH0pOwogICAgICAgIHJldHVybiB7CiAgICAgICAgICBsZW5ndGg6IHBhZ2VPcExpc3QudG90YWxMZW5ndGgKICAgICAgICB9OwogICAgICB9KTsKICAgIH0pOwogIH0KICBleHRyYWN0VGV4dENvbnRlbnQoewogICAgaGFuZGxlciwKICAgIHRhc2ssCiAgICBpbmNsdWRlTWFya2VkQ29udGVudCwKICAgIGRpc2FibGVOb3JtYWxpemF0aW9uLAogICAgc2luawogIH0pIHsKICAgIGNvbnN0IGNvbnRlbnRTdHJlYW1Qcm9taXNlID0gdGhpcy5nZXRDb250ZW50U3RyZWFtKCk7CiAgICBjb25zdCByZXNvdXJjZXNQcm9taXNlID0gdGhpcy5sb2FkUmVzb3VyY2VzKFsiRXh0R1N0YXRlIiwgIkZvbnQiLCAiUHJvcGVydGllcyIsICJYT2JqZWN0Il0pOwogICAgY29uc3QgZGF0YVByb21pc2VzID0gUHJvbWlzZS5hbGwoW2NvbnRlbnRTdHJlYW1Qcm9taXNlLCByZXNvdXJjZXNQcm9taXNlXSk7CiAgICByZXR1cm4gZGF0YVByb21pc2VzLnRoZW4oKFtjb250ZW50U3RyZWFtXSkgPT4gewogICAgICBjb25zdCBwYXJ0aWFsRXZhbHVhdG9yID0gbmV3IF9ldmFsdWF0b3IuUGFydGlhbEV2YWx1YXRvcih7CiAgICAgICAgeHJlZjogdGhpcy54cmVmLAogICAgICAgIGhhbmRsZXIsCiAgICAgICAgcGFnZUluZGV4OiB0aGlzLnBhZ2VJbmRleCwKICAgICAgICBpZEZhY3Rvcnk6IHRoaXMuX2xvY2FsSWRGYWN0b3J5LAogICAgICAgIGZvbnRDYWNoZTogdGhpcy5mb250Q2FjaGUsCiAgICAgICAgYnVpbHRJbkNNYXBDYWNoZTogdGhpcy5idWlsdEluQ01hcENhY2hlLAogICAgICAgIHN0YW5kYXJkRm9udERhdGFDYWNoZTogdGhpcy5zdGFuZGFyZEZvbnREYXRhQ2FjaGUsCiAgICAgICAgZ2xvYmFsSW1hZ2VDYWNoZTogdGhpcy5nbG9iYWxJbWFnZUNhY2hlLAogICAgICAgIHN5c3RlbUZvbnRDYWNoZTogdGhpcy5zeXN0ZW1Gb250Q2FjaGUsCiAgICAgICAgb3B0aW9uczogdGhpcy5ldmFsdWF0b3JPcHRpb25zCiAgICAgIH0pOwogICAgICByZXR1cm4gcGFydGlhbEV2YWx1YXRvci5nZXRUZXh0Q29udGVudCh7CiAgICAgICAgc3RyZWFtOiBjb250ZW50U3RyZWFtLAogICAgICAgIHRhc2ssCiAgICAgICAgcmVzb3VyY2VzOiB0aGlzLnJlc291cmNlcywKICAgICAgICBpbmNsdWRlTWFya2VkQ29udGVudCwKICAgICAgICBkaXNhYmxlTm9ybWFsaXphdGlvbiwKICAgICAgICBzaW5rLAogICAgICAgIHZpZXdCb3g6IHRoaXMudmlldwogICAgICB9KTsKICAgIH0pOwogIH0KICBhc3luYyBnZXRTdHJ1Y3RUcmVlKCkgewogICAgY29uc3Qgc3RydWN0VHJlZVJvb3QgPSBhd2FpdCB0aGlzLnBkZk1hbmFnZXIuZW5zdXJlQ2F0YWxvZygic3RydWN0VHJlZVJvb3QiKTsKICAgIGlmICghc3RydWN0VHJlZVJvb3QpIHsKICAgICAgcmV0dXJuIG51bGw7CiAgICB9CiAgICBhd2FpdCB0aGlzLl9wYXJzZWRBbm5vdGF0aW9uczsKICAgIGNvbnN0IHN0cnVjdFRyZWUgPSBhd2FpdCB0aGlzLnBkZk1hbmFnZXIuZW5zdXJlKHRoaXMsICJfcGFyc2VTdHJ1Y3RUcmVlIiwgW3N0cnVjdFRyZWVSb290XSk7CiAgICByZXR1cm4gc3RydWN0VHJlZS5zZXJpYWxpemFibGU7CiAgfQogIF9wYXJzZVN0cnVjdFRyZWUoc3RydWN0VHJlZVJvb3QpIHsKICAgIGNvbnN0IHRyZWUgPSBuZXcgX3N0cnVjdF90cmVlLlN0cnVjdFRyZWVQYWdlKHN0cnVjdFRyZWVSb290LCB0aGlzLnBhZ2VEaWN0KTsKICAgIHRyZWUucGFyc2UodGhpcy5yZWYpOwogICAgcmV0dXJuIHRyZWU7CiAgfQogIGFzeW5jIGdldEFubm90YXRpb25zRGF0YShoYW5kbGVyLCB0YXNrLCBpbnRlbnQpIHsKICAgIGNvbnN0IGFubm90YXRpb25zID0gYXdhaXQgdGhpcy5fcGFyc2VkQW5ub3RhdGlvbnM7CiAgICBpZiAoYW5ub3RhdGlvbnMubGVuZ3RoID09PSAwKSB7CiAgICAgIHJldHVybiBhbm5vdGF0aW9uczsKICAgIH0KICAgIGNvbnN0IGFubm90YXRpb25zRGF0YSA9IFtdLAogICAgICB0ZXh0Q29udGVudFByb21pc2VzID0gW107CiAgICBsZXQgcGFydGlhbEV2YWx1YXRvcjsKICAgIGNvbnN0IGludGVudEFueSA9ICEhKGludGVudCAmIF91dGlsLlJlbmRlcmluZ0ludGVudEZsYWcuQU5ZKSwKICAgICAgaW50ZW50RGlzcGxheSA9ICEhKGludGVudCAmIF91dGlsLlJlbmRlcmluZ0ludGVudEZsYWcuRElTUExBWSksCiAgICAgIGludGVudFByaW50ID0gISEoaW50ZW50ICYgX3V0aWwuUmVuZGVyaW5nSW50ZW50RmxhZy5QUklOVCk7CiAgICBmb3IgKGNvbnN0IGFubm90YXRpb24gb2YgYW5ub3RhdGlvbnMpIHsKICAgICAgY29uc3QgaXNWaXNpYmxlID0gaW50ZW50QW55IHx8IGludGVudERpc3BsYXkgJiYgYW5ub3RhdGlvbi52aWV3YWJsZTsKICAgICAgaWYgKGlzVmlzaWJsZSB8fCBpbnRlbnRQcmludCAmJiBhbm5vdGF0aW9uLnByaW50YWJsZSkgewogICAgICAgIGFubm90YXRpb25zRGF0YS5wdXNoKGFubm90YXRpb24uZGF0YSk7CiAgICAgIH0KICAgICAgaWYgKGFubm90YXRpb24uaGFzVGV4dENvbnRlbnQgJiYgaXNWaXNpYmxlKSB7CiAgICAgICAgcGFydGlhbEV2YWx1YXRvciB8fD0gbmV3IF9ldmFsdWF0b3IuUGFydGlhbEV2YWx1YXRvcih7CiAgICAgICAgICB4cmVmOiB0aGlzLnhyZWYsCiAgICAgICAgICBoYW5kbGVyLAogICAgICAgICAgcGFnZUluZGV4OiB0aGlzLnBhZ2VJbmRleCwKICAgICAgICAgIGlkRmFjdG9yeTogdGhpcy5fbG9jYWxJZEZhY3RvcnksCiAgICAgICAgICBmb250Q2FjaGU6IHRoaXMuZm9udENhY2hlLAogICAgICAgICAgYnVpbHRJbkNNYXBDYWNoZTogdGhpcy5idWlsdEluQ01hcENhY2hlLAogICAgICAgICAgc3RhbmRhcmRGb250RGF0YUNhY2hlOiB0aGlzLnN0YW5kYXJkRm9udERhdGFDYWNoZSwKICAgICAgICAgIGdsb2JhbEltYWdlQ2FjaGU6IHRoaXMuZ2xvYmFsSW1hZ2VDYWNoZSwKICAgICAgICAgIHN5c3RlbUZvbnRDYWNoZTogdGhpcy5zeXN0ZW1Gb250Q2FjaGUsCiAgICAgICAgICBvcHRpb25zOiB0aGlzLmV2YWx1YXRvck9wdGlvbnMKICAgICAgICB9KTsKICAgICAgICB0ZXh0Q29udGVudFByb21pc2VzLnB1c2goYW5ub3RhdGlvbi5leHRyYWN0VGV4dENvbnRlbnQocGFydGlhbEV2YWx1YXRvciwgdGFzaywgWy1JbmZpbml0eSwgLUluZmluaXR5LCBJbmZpbml0eSwgSW5maW5pdHldKS5jYXRjaChmdW5jdGlvbiAocmVhc29uKSB7CiAgICAgICAgICAoMCwgX3V0aWwud2FybikoYGdldEFubm90YXRpb25zRGF0YSAtIGlnbm9yaW5nIHRleHRDb250ZW50IGR1cmluZyAiJHt0YXNrLm5hbWV9IiB0YXNrOiAiJHtyZWFzb259Ii5gKTsKICAgICAgICB9KSk7CiAgICAgIH0KICAgIH0KICAgIGF3YWl0IFByb21pc2UuYWxsKHRleHRDb250ZW50UHJvbWlzZXMpOwogICAgcmV0dXJuIGFubm90YXRpb25zRGF0YTsKICB9CiAgZ2V0IGFubm90YXRpb25zKCkgewogICAgY29uc3QgYW5ub3RzID0gdGhpcy5fZ2V0SW5oZXJpdGFibGVQcm9wZXJ0eSgiQW5ub3RzIik7CiAgICByZXR1cm4gKDAsIF91dGlsLnNoYWRvdykodGhpcywgImFubm90YXRpb25zIiwgQXJyYXkuaXNBcnJheShhbm5vdHMpID8gYW5ub3RzIDogW10pOwogIH0KICBnZXQgX3BhcnNlZEFubm90YXRpb25zKCkgewogICAgY29uc3QgcHJvbWlzZSA9IHRoaXMucGRmTWFuYWdlci5lbnN1cmUodGhpcywgImFubm90YXRpb25zIikudGhlbihhc3luYyBhbm5vdHMgPT4gewogICAgICBpZiAoYW5ub3RzLmxlbmd0aCA9PT0gMCkgewogICAgICAgIHJldHVybiBhbm5vdHM7CiAgICAgIH0KICAgICAgY29uc3QgYW5ub3RhdGlvbkdsb2JhbHMgPSBhd2FpdCB0aGlzLnBkZk1hbmFnZXIuZW5zdXJlRG9jKCJhbm5vdGF0aW9uR2xvYmFscyIpOwogICAgICBpZiAoIWFubm90YXRpb25HbG9iYWxzKSB7CiAgICAgICAgcmV0dXJuIFtdOwogICAgICB9CiAgICAgIGNvbnN0IGFubm90YXRpb25Qcm9taXNlcyA9IFtdOwogICAgICBmb3IgKGNvbnN0IGFubm90YXRpb25SZWYgb2YgYW5ub3RzKSB7CiAgICAgICAgYW5ub3RhdGlvblByb21pc2VzLnB1c2goX2Fubm90YXRpb24uQW5ub3RhdGlvbkZhY3RvcnkuY3JlYXRlKHRoaXMueHJlZiwgYW5ub3RhdGlvblJlZiwgYW5ub3RhdGlvbkdsb2JhbHMsIHRoaXMuX2xvY2FsSWRGYWN0b3J5LCBmYWxzZSwgdGhpcy5yZWYpLmNhdGNoKGZ1bmN0aW9uIChyZWFzb24pIHsKICAgICAgICAgICgwLCBfdXRpbC53YXJuKShgX3BhcnNlZEFubm90YXRpb25zOiAiJHtyZWFzb259Ii5gKTsKICAgICAgICAgIHJldHVybiBudWxsOwogICAgICAgIH0pKTsKICAgICAgfQogICAgICBjb25zdCBzb3J0ZWRBbm5vdGF0aW9ucyA9IFtdOwogICAgICBsZXQgcG9wdXBBbm5vdGF0aW9uczsKICAgICAgZm9yIChjb25zdCBhbm5vdGF0aW9uIG9mIGF3YWl0IFByb21pc2UuYWxsKGFubm90YXRpb25Qcm9taXNlcykpIHsKICAgICAgICBpZiAoIWFubm90YXRpb24pIHsKICAgICAgICAgIGNvbnRpbnVlOwogICAgICAgIH0KICAgICAgICBpZiAoYW5ub3RhdGlvbiBpbnN0YW5jZW9mIF9hbm5vdGF0aW9uLlBvcHVwQW5ub3RhdGlvbikgewogICAgICAgICAgKHBvcHVwQW5ub3RhdGlvbnMgfHw9IFtdKS5wdXNoKGFubm90YXRpb24pOwogICAgICAgICAgY29udGludWU7CiAgICAgICAgfQogICAgICAgIHNvcnRlZEFubm90YXRpb25zLnB1c2goYW5ub3RhdGlvbik7CiAgICAgIH0KICAgICAgaWYgKHBvcHVwQW5ub3RhdGlvbnMpIHsKICAgICAgICBzb3J0ZWRBbm5vdGF0aW9ucy5wdXNoKC4uLnBvcHVwQW5ub3RhdGlvbnMpOwogICAgICB9CiAgICAgIHJldHVybiBzb3J0ZWRBbm5vdGF0aW9uczsKICAgIH0pOwogICAgcmV0dXJuICgwLCBfdXRpbC5zaGFkb3cpKHRoaXMsICJfcGFyc2VkQW5ub3RhdGlvbnMiLCBwcm9taXNlKTsKICB9CiAgZ2V0IGpzQWN0aW9ucygpIHsKICAgIGNvbnN0IGFjdGlvbnMgPSAoMCwgX2NvcmVfdXRpbHMuY29sbGVjdEFjdGlvbnMpKHRoaXMueHJlZiwgdGhpcy5wYWdlRGljdCwgX3V0aWwuUGFnZUFjdGlvbkV2ZW50VHlwZSk7CiAgICByZXR1cm4gKDAsIF91dGlsLnNoYWRvdykodGhpcywgImpzQWN0aW9ucyIsIGFjdGlvbnMpOwogIH0KfQpleHBvcnRzLlBhZ2UgPSBQYWdlOwpjb25zdCBQREZfSEVBREVSX1NJR05BVFVSRSA9IG5ldyBVaW50OEFycmF5KFsweDI1LCAweDUwLCAweDQ0LCAweDQ2LCAweDJkXSk7CmNvbnN0IFNUQVJUWFJFRl9TSUdOQVRVUkUgPSBuZXcgVWludDhBcnJheShbMHg3MywgMHg3NCwgMHg2MSwgMHg3MiwgMHg3NCwgMHg3OCwgMHg3MiwgMHg2NSwgMHg2Nl0pOwpjb25zdCBFTkRPQkpfU0lHTkFUVVJFID0gbmV3IFVpbnQ4QXJyYXkoWzB4NjUsIDB4NmUsIDB4NjQsIDB4NmYsIDB4NjIsIDB4NmFdKTsKY29uc3QgRklOR0VSUFJJTlRfRklSU1RfQllURVMgPSAxMDI0Owpjb25zdCBFTVBUWV9GSU5HRVJQUklOVCA9ICJceDAwXHgwMFx4MDBceDAwXHgwMFx4MDBceDAwXHgwMFx4MDBceDAwXHgwMFx4MDBceDAwXHgwMFx4MDBceDAwIjsKZnVuY3Rpb24gZmluZChzdHJlYW0sIHNpZ25hdHVyZSwgbGltaXQgPSAxMDI0LCBiYWNrd2FyZHMgPSBmYWxzZSkgewogIGNvbnN0IHNpZ25hdHVyZUxlbmd0aCA9IHNpZ25hdHVyZS5sZW5ndGg7CiAgY29uc3Qgc2NhbkJ5dGVzID0gc3RyZWFtLnBlZWtCeXRlcyhsaW1pdCk7CiAgY29uc3Qgc2Nhbkxlbmd0aCA9IHNjYW5CeXRlcy5sZW5ndGggLSBzaWduYXR1cmVMZW5ndGg7CiAgaWYgKHNjYW5MZW5ndGggPD0gMCkgewogICAgcmV0dXJuIGZhbHNlOwogIH0KICBpZiAoYmFja3dhcmRzKSB7CiAgICBjb25zdCBzaWduYXR1cmVFbmQgPSBzaWduYXR1cmVMZW5ndGggLSAxOwogICAgbGV0IHBvcyA9IHNjYW5CeXRlcy5sZW5ndGggLSAxOwogICAgd2hpbGUgKHBvcyA+PSBzaWduYXR1cmVFbmQpIHsKICAgICAgbGV0IGogPSAwOwogICAgICB3aGlsZSAoaiA8IHNpZ25hdHVyZUxlbmd0aCAmJiBzY2FuQnl0ZXNbcG9zIC0gal0gPT09IHNpZ25hdHVyZVtzaWduYXR1cmVFbmQgLSBqXSkgewogICAgICAgIGorKzsKICAgICAgfQogICAgICBpZiAoaiA+PSBzaWduYXR1cmVMZW5ndGgpIHsKICAgICAgICBzdHJlYW0ucG9zICs9IHBvcyAtIHNpZ25hdHVyZUVuZDsKICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgfQogICAgICBwb3MtLTsKICAgIH0KICB9IGVsc2UgewogICAgbGV0IHBvcyA9IDA7CiAgICB3aGlsZSAocG9zIDw9IHNjYW5MZW5ndGgpIHsKICAgICAgbGV0IGogPSAwOwogICAgICB3aGlsZSAoaiA8IHNpZ25hdHVyZUxlbmd0aCAmJiBzY2FuQnl0ZXNbcG9zICsgal0gPT09IHNpZ25hdHVyZVtqXSkgewogICAgICAgIGorKzsKICAgICAgfQogICAgICBpZiAoaiA+PSBzaWduYXR1cmVMZW5ndGgpIHsKICAgICAgICBzdHJlYW0ucG9zICs9IHBvczsKICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgfQogICAgICBwb3MrKzsKICAgIH0KICB9CiAgcmV0dXJuIGZhbHNlOwp9CmNsYXNzIFBERkRvY3VtZW50IHsKICBjb25zdHJ1Y3RvcihwZGZNYW5hZ2VyLCBzdHJlYW0pIHsKICAgIGlmIChzdHJlYW0ubGVuZ3RoIDw9IDApIHsKICAgICAgdGhyb3cgbmV3IF91dGlsLkludmFsaWRQREZFeGNlcHRpb24oIlRoZSBQREYgZmlsZSBpcyBlbXB0eSwgaS5lLiBpdHMgc2l6ZSBpcyB6ZXJvIGJ5dGVzLiIpOwogICAgfQogICAgdGhpcy5wZGZNYW5hZ2VyID0gcGRmTWFuYWdlcjsKICAgIHRoaXMuc3RyZWFtID0gc3RyZWFtOwogICAgdGhpcy54cmVmID0gbmV3IF94cmVmLlhSZWYoc3RyZWFtLCBwZGZNYW5hZ2VyKTsKICAgIHRoaXMuX3BhZ2VQcm9taXNlcyA9IG5ldyBNYXAoKTsKICAgIHRoaXMuX3ZlcnNpb24gPSBudWxsOwogICAgY29uc3QgaWRDb3VudGVycyA9IHsKICAgICAgZm9udDogMAogICAgfTsKICAgIHRoaXMuX2dsb2JhbElkRmFjdG9yeSA9IGNsYXNzIHsKICAgICAgc3RhdGljIGdldERvY0lkKCkgewogICAgICAgIHJldHVybiBgZ18ke3BkZk1hbmFnZXIuZG9jSWR9YDsKICAgICAgfQogICAgICBzdGF0aWMgY3JlYXRlRm9udElkKCkgewogICAgICAgIHJldHVybiBgZiR7KytpZENvdW50ZXJzLmZvbnR9YDsKICAgICAgfQogICAgICBzdGF0aWMgY3JlYXRlT2JqSWQoKSB7CiAgICAgICAgKDAsIF91dGlsLnVucmVhY2hhYmxlKSgiQWJzdHJhY3QgbWV0aG9kIGBjcmVhdGVPYmpJZGAgY2FsbGVkLiIpOwogICAgICB9CiAgICAgIHN0YXRpYyBnZXRQYWdlT2JqSWQoKSB7CiAgICAgICAgKDAsIF91dGlsLnVucmVhY2hhYmxlKSgiQWJzdHJhY3QgbWV0aG9kIGBnZXRQYWdlT2JqSWRgIGNhbGxlZC4iKTsKICAgICAgfQogICAgfTsKICB9CiAgcGFyc2UocmVjb3ZlcnlNb2RlKSB7CiAgICB0aGlzLnhyZWYucGFyc2UocmVjb3ZlcnlNb2RlKTsKICAgIHRoaXMuY2F0YWxvZyA9IG5ldyBfY2F0YWxvZy5DYXRhbG9nKHRoaXMucGRmTWFuYWdlciwgdGhpcy54cmVmKTsKICB9CiAgZ2V0IGxpbmVhcml6YXRpb24oKSB7CiAgICBsZXQgbGluZWFyaXphdGlvbiA9IG51bGw7CiAgICB0cnkgewogICAgICBsaW5lYXJpemF0aW9uID0gX3BhcnNlci5MaW5lYXJpemF0aW9uLmNyZWF0ZSh0aGlzLnN0cmVhbSk7CiAgICB9IGNhdGNoIChlcnIpIHsKICAgICAgaWYgKGVyciBpbnN0YW5jZW9mIF9jb3JlX3V0aWxzLk1pc3NpbmdEYXRhRXhjZXB0aW9uKSB7CiAgICAgICAgdGhyb3cgZXJyOwogICAgICB9CiAgICAgICgwLCBfdXRpbC5pbmZvKShlcnIpOwogICAgfQogICAgcmV0dXJuICgwLCBfdXRpbC5zaGFkb3cpKHRoaXMsICJsaW5lYXJpemF0aW9uIiwgbGluZWFyaXphdGlvbik7CiAgfQogIGdldCBzdGFydFhSZWYoKSB7CiAgICBjb25zdCBzdHJlYW0gPSB0aGlzLnN0cmVhbTsKICAgIGxldCBzdGFydFhSZWYgPSAwOwogICAgaWYgKHRoaXMubGluZWFyaXphdGlvbikgewogICAgICBzdHJlYW0ucmVzZXQoKTsKICAgICAgaWYgKGZpbmQoc3RyZWFtLCBFTkRPQkpfU0lHTkFUVVJFKSkgewogICAgICAgIHN0YXJ0WFJlZiA9IHN0cmVhbS5wb3MgKyA2IC0gc3RyZWFtLnN0YXJ0OwogICAgICB9CiAgICB9IGVsc2UgewogICAgICBjb25zdCBzdGVwID0gMTAyNDsKICAgICAgY29uc3Qgc3RhcnRYUmVmTGVuZ3RoID0gU1RBUlRYUkVGX1NJR05BVFVSRS5sZW5ndGg7CiAgICAgIGxldCBmb3VuZCA9IGZhbHNlLAogICAgICAgIHBvcyA9IHN0cmVhbS5lbmQ7CiAgICAgIHdoaWxlICghZm91bmQgJiYgcG9zID4gMCkgewogICAgICAgIHBvcyAtPSBzdGVwIC0gc3RhcnRYUmVmTGVuZ3RoOwogICAgICAgIGlmIChwb3MgPCAwKSB7CiAgICAgICAgICBwb3MgPSAwOwogICAgICAgIH0KICAgICAgICBzdHJlYW0ucG9zID0gcG9zOwogICAgICAgIGZvdW5kID0gZmluZChzdHJlYW0sIFNUQVJUWFJFRl9TSUdOQVRVUkUsIHN0ZXAsIHRydWUpOwogICAgICB9CiAgICAgIGlmIChmb3VuZCkgewogICAgICAgIHN0cmVhbS5za2lwKDkpOwogICAgICAgIGxldCBjaDsKICAgICAgICBkbyB7CiAgICAgICAgICBjaCA9IHN0cmVhbS5nZXRCeXRlKCk7CiAgICAgICAgfSB3aGlsZSAoKDAsIF9jb3JlX3V0aWxzLmlzV2hpdGVTcGFjZSkoY2gpKTsKICAgICAgICBsZXQgc3RyID0gIiI7CiAgICAgICAgd2hpbGUgKGNoID49IDB4MjAgJiYgY2ggPD0gMHgzOSkgewogICAgICAgICAgc3RyICs9IFN0cmluZy5mcm9tQ2hhckNvZGUoY2gpOwogICAgICAgICAgY2ggPSBzdHJlYW0uZ2V0Qnl0ZSgpOwogICAgICAgIH0KICAgICAgICBzdGFydFhSZWYgPSBwYXJzZUludChzdHIsIDEwKTsKICAgICAgICBpZiAoaXNOYU4oc3RhcnRYUmVmKSkgewogICAgICAgICAgc3RhcnRYUmVmID0gMDsKICAgICAgICB9CiAgICAgIH0KICAgIH0KICAgIHJldHVybiAoMCwgX3V0aWwuc2hhZG93KSh0aGlzLCAic3RhcnRYUmVmIiwgc3RhcnRYUmVmKTsKICB9CiAgY2hlY2tIZWFkZXIoKSB7CiAgICBjb25zdCBzdHJlYW0gPSB0aGlzLnN0cmVhbTsKICAgIHN0cmVhbS5yZXNldCgpOwogICAgaWYgKCFmaW5kKHN0cmVhbSwgUERGX0hFQURFUl9TSUdOQVRVUkUpKSB7CiAgICAgIHJldHVybjsKICAgIH0KICAgIHN0cmVhbS5tb3ZlU3RhcnQoKTsKICAgIHN0cmVhbS5za2lwKFBERl9IRUFERVJfU0lHTkFUVVJFLmxlbmd0aCk7CiAgICBsZXQgdmVyc2lvbiA9ICIiLAogICAgICBjaDsKICAgIHdoaWxlICgoY2ggPSBzdHJlYW0uZ2V0Qnl0ZSgpKSA+IDB4MjAgJiYgdmVyc2lvbi5sZW5ndGggPCA3KSB7CiAgICAgIHZlcnNpb24gKz0gU3RyaW5nLmZyb21DaGFyQ29kZShjaCk7CiAgICB9CiAgICBpZiAoX2NvcmVfdXRpbHMuUERGX1ZFUlNJT05fUkVHRVhQLnRlc3QodmVyc2lvbikpIHsKICAgICAgdGhpcy5fdmVyc2lvbiA9IHZlcnNpb247CiAgICB9IGVsc2UgewogICAgICAoMCwgX3V0aWwud2FybikoYEludmFsaWQgUERGIGhlYWRlciB2ZXJzaW9uOiAke3ZlcnNpb259YCk7CiAgICB9CiAgfQogIHBhcnNlU3RhcnRYUmVmKCkgewogICAgdGhpcy54cmVmLnNldFN0YXJ0WFJlZih0aGlzLnN0YXJ0WFJlZik7CiAgfQogIGdldCBudW1QYWdlcygpIHsKICAgIGxldCBudW0gPSAwOwogICAgaWYgKHRoaXMuY2F0YWxvZy5oYXNBY3R1YWxOdW1QYWdlcykgewogICAgICBudW0gPSB0aGlzLmNhdGFsb2cubnVtUGFnZXM7CiAgICB9IGVsc2UgaWYgKHRoaXMueGZhRmFjdG9yeSkgewogICAgICBudW0gPSB0aGlzLnhmYUZhY3RvcnkuZ2V0TnVtUGFnZXMoKTsKICAgIH0gZWxzZSBpZiAodGhpcy5saW5lYXJpemF0aW9uKSB7CiAgICAgIG51bSA9IHRoaXMubGluZWFyaXphdGlvbi5udW1QYWdlczsKICAgIH0gZWxzZSB7CiAgICAgIG51bSA9IHRoaXMuY2F0YWxvZy5udW1QYWdlczsKICAgIH0KICAgIHJldHVybiAoMCwgX3V0aWwuc2hhZG93KSh0aGlzLCAibnVtUGFnZXMiLCBudW0pOwogIH0KICBfaGFzT25seURvY3VtZW50U2lnbmF0dXJlcyhmaWVsZHMsIHJlY3Vyc2lvbkRlcHRoID0gMCkgewogICAgY29uc3QgUkVDVVJTSU9OX0xJTUlUID0gMTA7CiAgICBpZiAoIUFycmF5LmlzQXJyYXkoZmllbGRzKSkgewogICAgICByZXR1cm4gZmFsc2U7CiAgICB9CiAgICByZXR1cm4gZmllbGRzLmV2ZXJ5KGZpZWxkID0+IHsKICAgICAgZmllbGQgPSB0aGlzLnhyZWYuZmV0Y2hJZlJlZihmaWVsZCk7CiAgICAgIGlmICghKGZpZWxkIGluc3RhbmNlb2YgX3ByaW1pdGl2ZXMuRGljdCkpIHsKICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgIH0KICAgICAgaWYgKGZpZWxkLmhhcygiS2lkcyIpKSB7CiAgICAgICAgaWYgKCsrcmVjdXJzaW9uRGVwdGggPiBSRUNVUlNJT05fTElNSVQpIHsKICAgICAgICAgICgwLCBfdXRpbC53YXJuKSgiX2hhc09ubHlEb2N1bWVudFNpZ25hdHVyZXM6IG1heGltdW0gcmVjdXJzaW9uIGRlcHRoIHJlYWNoZWQiKTsKICAgICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgICB9CiAgICAgICAgcmV0dXJuIHRoaXMuX2hhc09ubHlEb2N1bWVudFNpZ25hdHVyZXMoZmllbGQuZ2V0KCJLaWRzIiksIHJlY3Vyc2lvbkRlcHRoKTsKICAgICAgfQogICAgICBjb25zdCBpc1NpZ25hdHVyZSA9ICgwLCBfcHJpbWl0aXZlcy5pc05hbWUpKGZpZWxkLmdldCgiRlQiKSwgIlNpZyIpOwogICAgICBjb25zdCByZWN0YW5nbGUgPSBmaWVsZC5nZXQoIlJlY3QiKTsKICAgICAgY29uc3QgaXNJbnZpc2libGUgPSBBcnJheS5pc0FycmF5KHJlY3RhbmdsZSkgJiYgcmVjdGFuZ2xlLmV2ZXJ5KHZhbHVlID0+IHZhbHVlID09PSAwKTsKICAgICAgcmV0dXJuIGlzU2lnbmF0dXJlICYmIGlzSW52aXNpYmxlOwogICAgfSk7CiAgfQogIGdldCBfeGZhU3RyZWFtcygpIHsKICAgIGNvbnN0IGFjcm9Gb3JtID0gdGhpcy5jYXRhbG9nLmFjcm9Gb3JtOwogICAgaWYgKCFhY3JvRm9ybSkgewogICAgICByZXR1cm4gbnVsbDsKICAgIH0KICAgIGNvbnN0IHhmYSA9IGFjcm9Gb3JtLmdldCgiWEZBIik7CiAgICBjb25zdCBlbnRyaWVzID0gewogICAgICAieGRwOnhkcCI6ICIiLAogICAgICB0ZW1wbGF0ZTogIiIsCiAgICAgIGRhdGFzZXRzOiAiIiwKICAgICAgY29uZmlnOiAiIiwKICAgICAgY29ubmVjdGlvblNldDogIiIsCiAgICAgIGxvY2FsZVNldDogIiIsCiAgICAgIHN0eWxlc2hlZXQ6ICIiLAogICAgICAiL3hkcDp4ZHAiOiAiIgogICAgfTsKICAgIGlmICh4ZmEgaW5zdGFuY2VvZiBfYmFzZV9zdHJlYW0uQmFzZVN0cmVhbSAmJiAheGZhLmlzRW1wdHkpIHsKICAgICAgZW50cmllc1sieGRwOnhkcCJdID0geGZhOwogICAgICByZXR1cm4gZW50cmllczsKICAgIH0KICAgIGlmICghQXJyYXkuaXNBcnJheSh4ZmEpIHx8IHhmYS5sZW5ndGggPT09IDApIHsKICAgICAgcmV0dXJuIG51bGw7CiAgICB9CiAgICBmb3IgKGxldCBpID0gMCwgaWkgPSB4ZmEubGVuZ3RoOyBpIDwgaWk7IGkgKz0gMikgewogICAgICBsZXQgbmFtZTsKICAgICAgaWYgKGkgPT09IDApIHsKICAgICAgICBuYW1lID0gInhkcDp4ZHAiOwogICAgICB9IGVsc2UgaWYgKGkgPT09IGlpIC0gMikgewogICAgICAgIG5hbWUgPSAiL3hkcDp4ZHAiOwogICAgICB9IGVsc2UgewogICAgICAgIG5hbWUgPSB4ZmFbaV07CiAgICAgIH0KICAgICAgaWYgKCFlbnRyaWVzLmhhc093blByb3BlcnR5KG5hbWUpKSB7CiAgICAgICAgY29udGludWU7CiAgICAgIH0KICAgICAgY29uc3QgZGF0YSA9IHRoaXMueHJlZi5mZXRjaElmUmVmKHhmYVtpICsgMV0pOwogICAgICBpZiAoIShkYXRhIGluc3RhbmNlb2YgX2Jhc2Vfc3RyZWFtLkJhc2VTdHJlYW0pIHx8IGRhdGEuaXNFbXB0eSkgewogICAgICAgIGNvbnRpbnVlOwogICAgICB9CiAgICAgIGVudHJpZXNbbmFtZV0gPSBkYXRhOwogICAgfQogICAgcmV0dXJuIGVudHJpZXM7CiAgfQogIGdldCB4ZmFEYXRhc2V0cygpIHsKICAgIGNvbnN0IHN0cmVhbXMgPSB0aGlzLl94ZmFTdHJlYW1zOwogICAgaWYgKCFzdHJlYW1zKSB7CiAgICAgIHJldHVybiAoMCwgX3V0aWwuc2hhZG93KSh0aGlzLCAieGZhRGF0YXNldHMiLCBudWxsKTsKICAgIH0KICAgIGZvciAoY29uc3Qga2V5IG9mIFsiZGF0YXNldHMiLCAieGRwOnhkcCJdKSB7CiAgICAgIGNvbnN0IHN0cmVhbSA9IHN0cmVhbXNba2V5XTsKICAgICAgaWYgKCFzdHJlYW0pIHsKICAgICAgICBjb250aW51ZTsKICAgICAgfQogICAgICB0cnkgewogICAgICAgIGNvbnN0IHN0ciA9ICgwLCBfdXRpbC5zdHJpbmdUb1VURjhTdHJpbmcpKHN0cmVhbS5nZXRTdHJpbmcoKSk7CiAgICAgICAgY29uc3QgZGF0YSA9IHsKICAgICAgICAgIFtrZXldOiBzdHIKICAgICAgICB9OwogICAgICAgIHJldHVybiAoMCwgX3V0aWwuc2hhZG93KSh0aGlzLCAieGZhRGF0YXNldHMiLCBuZXcgX2RhdGFzZXRfcmVhZGVyLkRhdGFzZXRSZWFkZXIoZGF0YSkpOwogICAgICB9IGNhdGNoIHsKICAgICAgICAoMCwgX3V0aWwud2FybikoIlhGQSAtIEludmFsaWQgdXRmLTggc3RyaW5nLiIpOwogICAgICAgIGJyZWFrOwogICAgICB9CiAgICB9CiAgICByZXR1cm4gKDAsIF91dGlsLnNoYWRvdykodGhpcywgInhmYURhdGFzZXRzIiwgbnVsbCk7CiAgfQogIGdldCB4ZmFEYXRhKCkgewogICAgY29uc3Qgc3RyZWFtcyA9IHRoaXMuX3hmYVN0cmVhbXM7CiAgICBpZiAoIXN0cmVhbXMpIHsKICAgICAgcmV0dXJuIG51bGw7CiAgICB9CiAgICBjb25zdCBkYXRhID0gT2JqZWN0LmNyZWF0ZShudWxsKTsKICAgIGZvciAoY29uc3QgW2tleSwgc3RyZWFtXSBvZiBPYmplY3QuZW50cmllcyhzdHJlYW1zKSkgewogICAgICBpZiAoIXN0cmVhbSkgewogICAgICAgIGNvbnRpbnVlOwogICAgICB9CiAgICAgIHRyeSB7CiAgICAgICAgZGF0YVtrZXldID0gKDAsIF91dGlsLnN0cmluZ1RvVVRGOFN0cmluZykoc3RyZWFtLmdldFN0cmluZygpKTsKICAgICAgfSBjYXRjaCB7CiAgICAgICAgKDAsIF91dGlsLndhcm4pKCJYRkEgLSBJbnZhbGlkIHV0Zi04IHN0cmluZy4iKTsKICAgICAgICByZXR1cm4gbnVsbDsKICAgICAgfQogICAgfQogICAgcmV0dXJuIGRhdGE7CiAgfQogIGdldCB4ZmFGYWN0b3J5KCkgewogICAgbGV0IGRhdGE7CiAgICBpZiAodGhpcy5wZGZNYW5hZ2VyLmVuYWJsZVhmYSAmJiB0aGlzLmNhdGFsb2cubmVlZHNSZW5kZXJpbmcgJiYgdGhpcy5mb3JtSW5mby5oYXNYZmEgJiYgIXRoaXMuZm9ybUluZm8uaGFzQWNyb0Zvcm0pIHsKICAgICAgZGF0YSA9IHRoaXMueGZhRGF0YTsKICAgIH0KICAgIHJldHVybiAoMCwgX3V0aWwuc2hhZG93KSh0aGlzLCAieGZhRmFjdG9yeSIsIGRhdGEgPyBuZXcgX2ZhY3RvcnkuWEZBRmFjdG9yeShkYXRhKSA6IG51bGwpOwogIH0KICBnZXQgaXNQdXJlWGZhKCkgewogICAgcmV0dXJuIHRoaXMueGZhRmFjdG9yeSA/IHRoaXMueGZhRmFjdG9yeS5pc1ZhbGlkKCkgOiBmYWxzZTsKICB9CiAgZ2V0IGh0bWxGb3JYZmEoKSB7CiAgICByZXR1cm4gdGhpcy54ZmFGYWN0b3J5ID8gdGhpcy54ZmFGYWN0b3J5LmdldFBhZ2VzKCkgOiBudWxsOwogIH0KICBhc3luYyBsb2FkWGZhSW1hZ2VzKCkgewogICAgY29uc3QgeGZhSW1hZ2VzRGljdCA9IGF3YWl0IHRoaXMucGRmTWFuYWdlci5lbnN1cmVDYXRhbG9nKCJ4ZmFJbWFnZXMiKTsKICAgIGlmICgheGZhSW1hZ2VzRGljdCkgewogICAgICByZXR1cm47CiAgICB9CiAgICBjb25zdCBrZXlzID0geGZhSW1hZ2VzRGljdC5nZXRLZXlzKCk7CiAgICBjb25zdCBvYmplY3RMb2FkZXIgPSBuZXcgX29iamVjdF9sb2FkZXIuT2JqZWN0TG9hZGVyKHhmYUltYWdlc0RpY3QsIGtleXMsIHRoaXMueHJlZik7CiAgICBhd2FpdCBvYmplY3RMb2FkZXIubG9hZCgpOwogICAgY29uc3QgeGZhSW1hZ2VzID0gbmV3IE1hcCgpOwogICAgZm9yIChjb25zdCBrZXkgb2Yga2V5cykgewogICAgICBjb25zdCBzdHJlYW0gPSB4ZmFJbWFnZXNEaWN0LmdldChrZXkpOwogICAgICBpZiAoc3RyZWFtIGluc3RhbmNlb2YgX2Jhc2Vfc3RyZWFtLkJhc2VTdHJlYW0pIHsKICAgICAgICB4ZmFJbWFnZXMuc2V0KGtleSwgc3RyZWFtLmdldEJ5dGVzKCkpOwogICAgICB9CiAgICB9CiAgICB0aGlzLnhmYUZhY3Rvcnkuc2V0SW1hZ2VzKHhmYUltYWdlcyk7CiAgfQogIGFzeW5jIGxvYWRYZmFGb250cyhoYW5kbGVyLCB0YXNrKSB7CiAgICBjb25zdCBhY3JvRm9ybSA9IGF3YWl0IHRoaXMucGRmTWFuYWdlci5lbnN1cmVDYXRhbG9nKCJhY3JvRm9ybSIpOwogICAgaWYgKCFhY3JvRm9ybSkgewogICAgICByZXR1cm47CiAgICB9CiAgICBjb25zdCByZXNvdXJjZXMgPSBhd2FpdCBhY3JvRm9ybS5nZXRBc3luYygiRFIiKTsKICAgIGlmICghKHJlc291cmNlcyBpbnN0YW5jZW9mIF9wcmltaXRpdmVzLkRpY3QpKSB7CiAgICAgIHJldHVybjsKICAgIH0KICAgIGNvbnN0IG9iamVjdExvYWRlciA9IG5ldyBfb2JqZWN0X2xvYWRlci5PYmplY3RMb2FkZXIocmVzb3VyY2VzLCBbIkZvbnQiXSwgdGhpcy54cmVmKTsKICAgIGF3YWl0IG9iamVjdExvYWRlci5sb2FkKCk7CiAgICBjb25zdCBmb250UmVzID0gcmVzb3VyY2VzLmdldCgiRm9udCIpOwogICAgaWYgKCEoZm9udFJlcyBpbnN0YW5jZW9mIF9wcmltaXRpdmVzLkRpY3QpKSB7CiAgICAgIHJldHVybjsKICAgIH0KICAgIGNvbnN0IG9wdGlvbnMgPSBPYmplY3QuYXNzaWduKE9iamVjdC5jcmVhdGUobnVsbCksIHRoaXMucGRmTWFuYWdlci5ldmFsdWF0b3JPcHRpb25zKTsKICAgIG9wdGlvbnMudXNlU3lzdGVtRm9udHMgPSBmYWxzZTsKICAgIGNvbnN0IHBhcnRpYWxFdmFsdWF0b3IgPSBuZXcgX2V2YWx1YXRvci5QYXJ0aWFsRXZhbHVhdG9yKHsKICAgICAgeHJlZjogdGhpcy54cmVmLAogICAgICBoYW5kbGVyLAogICAgICBwYWdlSW5kZXg6IC0xLAogICAgICBpZEZhY3Rvcnk6IHRoaXMuX2dsb2JhbElkRmFjdG9yeSwKICAgICAgZm9udENhY2hlOiB0aGlzLmNhdGFsb2cuZm9udENhY2hlLAogICAgICBidWlsdEluQ01hcENhY2hlOiB0aGlzLmNhdGFsb2cuYnVpbHRJbkNNYXBDYWNoZSwKICAgICAgc3RhbmRhcmRGb250RGF0YUNhY2hlOiB0aGlzLmNhdGFsb2cuc3RhbmRhcmRGb250RGF0YUNhY2hlLAogICAgICBvcHRpb25zCiAgICB9KTsKICAgIGNvbnN0IG9wZXJhdG9yTGlzdCA9IG5ldyBfb3BlcmF0b3JfbGlzdC5PcGVyYXRvckxpc3QoKTsKICAgIGNvbnN0IHBkZkZvbnRzID0gW107CiAgICBjb25zdCBpbml0aWFsU3RhdGUgPSB7CiAgICAgIGdldCBmb250KCkgewogICAgICAgIHJldHVybiBwZGZGb250cy5hdCgtMSk7CiAgICAgIH0sCiAgICAgIHNldCBmb250KGZvbnQpIHsKICAgICAgICBwZGZGb250cy5wdXNoKGZvbnQpOwogICAgICB9LAogICAgICBjbG9uZSgpIHsKICAgICAgICByZXR1cm4gdGhpczsKICAgICAgfQogICAgfTsKICAgIGNvbnN0IGZvbnRzID0gbmV3IE1hcCgpOwogICAgZm9udFJlcy5mb3JFYWNoKChmb250TmFtZSwgZm9udCkgPT4gewogICAgICBmb250cy5zZXQoZm9udE5hbWUsIGZvbnQpOwogICAgfSk7CiAgICBjb25zdCBwcm9taXNlcyA9IFtdOwogICAgZm9yIChjb25zdCBbZm9udE5hbWUsIGZvbnRdIG9mIGZvbnRzKSB7CiAgICAgIGNvbnN0IGRlc2NyaXB0b3IgPSBmb250LmdldCgiRm9udERlc2NyaXB0b3IiKTsKICAgICAgaWYgKCEoZGVzY3JpcHRvciBpbnN0YW5jZW9mIF9wcmltaXRpdmVzLkRpY3QpKSB7CiAgICAgICAgY29udGludWU7CiAgICAgIH0KICAgICAgbGV0IGZvbnRGYW1pbHkgPSBkZXNjcmlwdG9yLmdldCgiRm9udEZhbWlseSIpOwogICAgICBmb250RmFtaWx5ID0gZm9udEZhbWlseS5yZXBsYWNlQWxsKC9bIF0rKFxkKS9nLCAiJDEiKTsKICAgICAgY29uc3QgZm9udFdlaWdodCA9IGRlc2NyaXB0b3IuZ2V0KCJGb250V2VpZ2h0Iik7CiAgICAgIGNvbnN0IGl0YWxpY0FuZ2xlID0gLWRlc2NyaXB0b3IuZ2V0KCJJdGFsaWNBbmdsZSIpOwogICAgICBjb25zdCBjc3NGb250SW5mbyA9IHsKICAgICAgICBmb250RmFtaWx5LAogICAgICAgIGZvbnRXZWlnaHQsCiAgICAgICAgaXRhbGljQW5nbGUKICAgICAgfTsKICAgICAgaWYgKCEoMCwgX2NvcmVfdXRpbHMudmFsaWRhdGVDU1NGb250KShjc3NGb250SW5mbykpIHsKICAgICAgICBjb250aW51ZTsKICAgICAgfQogICAgICBwcm9taXNlcy5wdXNoKHBhcnRpYWxFdmFsdWF0b3IuaGFuZGxlU2V0Rm9udChyZXNvdXJjZXMsIFtfcHJpbWl0aXZlcy5OYW1lLmdldChmb250TmFtZSksIDFdLCBudWxsLCBvcGVyYXRvckxpc3QsIHRhc2ssIGluaXRpYWxTdGF0ZSwgbnVsbCwgY3NzRm9udEluZm8pLmNhdGNoKGZ1bmN0aW9uIChyZWFzb24pIHsKICAgICAgICAoMCwgX3V0aWwud2FybikoYGxvYWRYZmFGb250czogIiR7cmVhc29ufSIuYCk7CiAgICAgICAgcmV0dXJuIG51bGw7CiAgICAgIH0pKTsKICAgIH0KICAgIGF3YWl0IFByb21pc2UuYWxsKHByb21pc2VzKTsKICAgIGNvbnN0IG1pc3NpbmdGb250cyA9IHRoaXMueGZhRmFjdG9yeS5zZXRGb250cyhwZGZGb250cyk7CiAgICBpZiAoIW1pc3NpbmdGb250cykgewogICAgICByZXR1cm47CiAgICB9CiAgICBvcHRpb25zLmlnbm9yZUVycm9ycyA9IHRydWU7CiAgICBwcm9taXNlcy5sZW5ndGggPSAwOwogICAgcGRmRm9udHMubGVuZ3RoID0gMDsKICAgIGNvbnN0IHJlYWxseU1pc3NpbmdGb250cyA9IG5ldyBTZXQoKTsKICAgIGZvciAoY29uc3QgbWlzc2luZyBvZiBtaXNzaW5nRm9udHMpIHsKICAgICAgaWYgKCEoMCwgX3hmYV9mb250cy5nZXRYZmFGb250TmFtZSkoYCR7bWlzc2luZ30tUmVndWxhcmApKSB7CiAgICAgICAgcmVhbGx5TWlzc2luZ0ZvbnRzLmFkZChtaXNzaW5nKTsKICAgICAgfQogICAgfQogICAgaWYgKHJlYWxseU1pc3NpbmdGb250cy5zaXplKSB7CiAgICAgIG1pc3NpbmdGb250cy5wdXNoKCJQZGZKUy1GYWxsYmFjayIpOwogICAgfQogICAgZm9yIChjb25zdCBtaXNzaW5nIG9mIG1pc3NpbmdGb250cykgewogICAgICBpZiAocmVhbGx5TWlzc2luZ0ZvbnRzLmhhcyhtaXNzaW5nKSkgewogICAgICAgIGNvbnRpbnVlOwogICAgICB9CiAgICAgIGZvciAoY29uc3QgZm9udEluZm8gb2YgW3sKICAgICAgICBuYW1lOiAiUmVndWxhciIsCiAgICAgICAgZm9udFdlaWdodDogNDAwLAogICAgICAgIGl0YWxpY0FuZ2xlOiAwCiAgICAgIH0sIHsKICAgICAgICBuYW1lOiAiQm9sZCIsCiAgICAgICAgZm9udFdlaWdodDogNzAwLAogICAgICAgIGl0YWxpY0FuZ2xlOiAwCiAgICAgIH0sIHsKICAgICAgICBuYW1lOiAiSXRhbGljIiwKICAgICAgICBmb250V2VpZ2h0OiA0MDAsCiAgICAgICAgaXRhbGljQW5nbGU6IDEyCiAgICAgIH0sIHsKICAgICAgICBuYW1lOiAiQm9sZEl0YWxpYyIsCiAgICAgICAgZm9udFdlaWdodDogNzAwLAogICAgICAgIGl0YWxpY0FuZ2xlOiAxMgogICAgICB9XSkgewogICAgICAgIGNvbnN0IG5hbWUgPSBgJHttaXNzaW5nfS0ke2ZvbnRJbmZvLm5hbWV9YDsKICAgICAgICBjb25zdCBkaWN0ID0gKDAsIF94ZmFfZm9udHMuZ2V0WGZhRm9udERpY3QpKG5hbWUpOwogICAgICAgIHByb21pc2VzLnB1c2gocGFydGlhbEV2YWx1YXRvci5oYW5kbGVTZXRGb250KHJlc291cmNlcywgW19wcmltaXRpdmVzLk5hbWUuZ2V0KG5hbWUpLCAxXSwgbnVsbCwgb3BlcmF0b3JMaXN0LCB0YXNrLCBpbml0aWFsU3RhdGUsIGRpY3QsIHsKICAgICAgICAgIGZvbnRGYW1pbHk6IG1pc3NpbmcsCiAgICAgICAgICBmb250V2VpZ2h0OiBmb250SW5mby5mb250V2VpZ2h0LAogICAgICAgICAgaXRhbGljQW5nbGU6IGZvbnRJbmZvLml0YWxpY0FuZ2xlCiAgICAgICAgfSkuY2F0Y2goZnVuY3Rpb24gKHJlYXNvbikgewogICAgICAgICAgKDAsIF91dGlsLndhcm4pKGBsb2FkWGZhRm9udHM6ICIke3JlYXNvbn0iLmApOwogICAgICAgICAgcmV0dXJuIG51bGw7CiAgICAgICAgfSkpOwogICAgICB9CiAgICB9CiAgICBhd2FpdCBQcm9taXNlLmFsbChwcm9taXNlcyk7CiAgICB0aGlzLnhmYUZhY3RvcnkuYXBwZW5kRm9udHMocGRmRm9udHMsIHJlYWxseU1pc3NpbmdGb250cyk7CiAgfQogIGFzeW5jIHNlcmlhbGl6ZVhmYURhdGEoYW5ub3RhdGlvblN0b3JhZ2UpIHsKICAgIHJldHVybiB0aGlzLnhmYUZhY3RvcnkgPyB0aGlzLnhmYUZhY3Rvcnkuc2VyaWFsaXplRGF0YShhbm5vdGF0aW9uU3RvcmFnZSkgOiBudWxsOwogIH0KICBnZXQgdmVyc2lvbigpIHsKICAgIHJldHVybiB0aGlzLmNhdGFsb2cudmVyc2lvbiB8fCB0aGlzLl92ZXJzaW9uOwogIH0KICBnZXQgZm9ybUluZm8oKSB7CiAgICBjb25zdCBmb3JtSW5mbyA9IHsKICAgICAgaGFzRmllbGRzOiBmYWxzZSwKICAgICAgaGFzQWNyb0Zvcm06IGZhbHNlLAogICAgICBoYXNYZmE6IGZhbHNlLAogICAgICBoYXNTaWduYXR1cmVzOiBmYWxzZQogICAgfTsKICAgIGNvbnN0IGFjcm9Gb3JtID0gdGhpcy5jYXRhbG9nLmFjcm9Gb3JtOwogICAgaWYgKCFhY3JvRm9ybSkgewogICAgICByZXR1cm4gKDAsIF91dGlsLnNoYWRvdykodGhpcywgImZvcm1JbmZvIiwgZm9ybUluZm8pOwogICAgfQogICAgdHJ5IHsKICAgICAgY29uc3QgZmllbGRzID0gYWNyb0Zvcm0uZ2V0KCJGaWVsZHMiKTsKICAgICAgY29uc3QgaGFzRmllbGRzID0gQXJyYXkuaXNBcnJheShmaWVsZHMpICYmIGZpZWxkcy5sZW5ndGggPiAwOwogICAgICBmb3JtSW5mby5oYXNGaWVsZHMgPSBoYXNGaWVsZHM7CiAgICAgIGNvbnN0IHhmYSA9IGFjcm9Gb3JtLmdldCgiWEZBIik7CiAgICAgIGZvcm1JbmZvLmhhc1hmYSA9IEFycmF5LmlzQXJyYXkoeGZhKSAmJiB4ZmEubGVuZ3RoID4gMCB8fCB4ZmEgaW5zdGFuY2VvZiBfYmFzZV9zdHJlYW0uQmFzZVN0cmVhbSAmJiAheGZhLmlzRW1wdHk7CiAgICAgIGNvbnN0IHNpZ0ZsYWdzID0gYWNyb0Zvcm0uZ2V0KCJTaWdGbGFncyIpOwogICAgICBjb25zdCBoYXNTaWduYXR1cmVzID0gISEoc2lnRmxhZ3MgJiAweDEpOwogICAgICBjb25zdCBoYXNPbmx5RG9jdW1lbnRTaWduYXR1cmVzID0gaGFzU2lnbmF0dXJlcyAmJiB0aGlzLl9oYXNPbmx5RG9jdW1lbnRTaWduYXR1cmVzKGZpZWxkcyk7CiAgICAgIGZvcm1JbmZvLmhhc0Fjcm9Gb3JtID0gaGFzRmllbGRzICYmICFoYXNPbmx5RG9jdW1lbnRTaWduYXR1cmVzOwogICAgICBmb3JtSW5mby5oYXNTaWduYXR1cmVzID0gaGFzU2lnbmF0dXJlczsKICAgIH0gY2F0Y2ggKGV4KSB7CiAgICAgIGlmIChleCBpbnN0YW5jZW9mIF9jb3JlX3V0aWxzLk1pc3NpbmdEYXRhRXhjZXB0aW9uKSB7CiAgICAgICAgdGhyb3cgZXg7CiAgICAgIH0KICAgICAgKDAsIF91dGlsLndhcm4pKGBDYW5ub3QgZmV0Y2ggZm9ybSBpbmZvcm1hdGlvbjogIiR7ZXh9Ii5gKTsKICAgIH0KICAgIHJldHVybiAoMCwgX3V0aWwuc2hhZG93KSh0aGlzLCAiZm9ybUluZm8iLCBmb3JtSW5mbyk7CiAgfQogIGdldCBkb2N1bWVudEluZm8oKSB7CiAgICBjb25zdCBkb2NJbmZvID0gewogICAgICBQREZGb3JtYXRWZXJzaW9uOiB0aGlzLnZlcnNpb24sCiAgICAgIExhbmd1YWdlOiB0aGlzLmNhdGFsb2cubGFuZywKICAgICAgRW5jcnlwdEZpbHRlck5hbWU6IHRoaXMueHJlZi5lbmNyeXB0ID8gdGhpcy54cmVmLmVuY3J5cHQuZmlsdGVyTmFtZSA6IG51bGwsCiAgICAgIElzTGluZWFyaXplZDogISF0aGlzLmxpbmVhcml6YXRpb24sCiAgICAgIElzQWNyb0Zvcm1QcmVzZW50OiB0aGlzLmZvcm1JbmZvLmhhc0Fjcm9Gb3JtLAogICAgICBJc1hGQVByZXNlbnQ6IHRoaXMuZm9ybUluZm8uaGFzWGZhLAogICAgICBJc0NvbGxlY3Rpb25QcmVzZW50OiAhIXRoaXMuY2F0YWxvZy5jb2xsZWN0aW9uLAogICAgICBJc1NpZ25hdHVyZXNQcmVzZW50OiB0aGlzLmZvcm1JbmZvLmhhc1NpZ25hdHVyZXMKICAgIH07CiAgICBsZXQgaW5mb0RpY3Q7CiAgICB0cnkgewogICAgICBpbmZvRGljdCA9IHRoaXMueHJlZi50cmFpbGVyLmdldCgiSW5mbyIpOwogICAgfSBjYXRjaCAoZXJyKSB7CiAgICAgIGlmIChlcnIgaW5zdGFuY2VvZiBfY29yZV91dGlscy5NaXNzaW5nRGF0YUV4Y2VwdGlvbikgewogICAgICAgIHRocm93IGVycjsKICAgICAgfQogICAgICAoMCwgX3V0aWwuaW5mbykoIlRoZSBkb2N1bWVudCBpbmZvcm1hdGlvbiBkaWN0aW9uYXJ5IGlzIGludmFsaWQuIik7CiAgICB9CiAgICBpZiAoIShpbmZvRGljdCBpbnN0YW5jZW9mIF9wcmltaXRpdmVzLkRpY3QpKSB7CiAgICAgIHJldHVybiAoMCwgX3V0aWwuc2hhZG93KSh0aGlzLCAiZG9jdW1lbnRJbmZvIiwgZG9jSW5mbyk7CiAgICB9CiAgICBmb3IgKGNvbnN0IGtleSBvZiBpbmZvRGljdC5nZXRLZXlzKCkpIHsKICAgICAgY29uc3QgdmFsdWUgPSBpbmZvRGljdC5nZXQoa2V5KTsKICAgICAgc3dpdGNoIChrZXkpIHsKICAgICAgICBjYXNlICJUaXRsZSI6CiAgICAgICAgY2FzZSAiQXV0aG9yIjoKICAgICAgICBjYXNlICJTdWJqZWN0IjoKICAgICAgICBjYXNlICJLZXl3b3JkcyI6CiAgICAgICAgY2FzZSAiQ3JlYXRvciI6CiAgICAgICAgY2FzZSAiUHJvZHVjZXIiOgogICAgICAgIGNhc2UgIkNyZWF0aW9uRGF0ZSI6CiAgICAgICAgY2FzZSAiTW9kRGF0ZSI6CiAgICAgICAgICBpZiAodHlwZW9mIHZhbHVlID09PSAic3RyaW5nIikgewogICAgICAgICAgICBkb2NJbmZvW2tleV0gPSAoMCwgX3V0aWwuc3RyaW5nVG9QREZTdHJpbmcpKHZhbHVlKTsKICAgICAgICAgICAgY29udGludWU7CiAgICAgICAgICB9CiAgICAgICAgICBicmVhazsKICAgICAgICBjYXNlICJUcmFwcGVkIjoKICAgICAgICAgIGlmICh2YWx1ZSBpbnN0YW5jZW9mIF9wcmltaXRpdmVzLk5hbWUpIHsKICAgICAgICAgICAgZG9jSW5mb1trZXldID0gdmFsdWU7CiAgICAgICAgICAgIGNvbnRpbnVlOwogICAgICAgICAgfQogICAgICAgICAgYnJlYWs7CiAgICAgICAgZGVmYXVsdDoKICAgICAgICAgIGxldCBjdXN0b21WYWx1ZTsKICAgICAgICAgIHN3aXRjaCAodHlwZW9mIHZhbHVlKSB7CiAgICAgICAgICAgIGNhc2UgInN0cmluZyI6CiAgICAgICAgICAgICAgY3VzdG9tVmFsdWUgPSAoMCwgX3V0aWwuc3RyaW5nVG9QREZTdHJpbmcpKHZhbHVlKTsKICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgY2FzZSAibnVtYmVyIjoKICAgICAgICAgICAgY2FzZSAiYm9vbGVhbiI6CiAgICAgICAgICAgICAgY3VzdG9tVmFsdWUgPSB2YWx1ZTsKICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgZGVmYXVsdDoKICAgICAgICAgICAgICBpZiAodmFsdWUgaW5zdGFuY2VvZiBfcHJpbWl0aXZlcy5OYW1lKSB7CiAgICAgICAgICAgICAgICBjdXN0b21WYWx1ZSA9IHZhbHVlOwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgIH0KICAgICAgICAgIGlmIChjdXN0b21WYWx1ZSA9PT0gdW5kZWZpbmVkKSB7CiAgICAgICAgICAgICgwLCBfdXRpbC53YXJuKShgQmFkIHZhbHVlLCBmb3IgY3VzdG9tIGtleSAiJHtrZXl9IiwgaW4gSW5mbzogJHt2YWx1ZX0uYCk7CiAgICAgICAgICAgIGNvbnRpbnVlOwogICAgICAgICAgfQogICAgICAgICAgaWYgKCFkb2NJbmZvLkN1c3RvbSkgewogICAgICAgICAgICBkb2NJbmZvLkN1c3RvbSA9IE9iamVjdC5jcmVhdGUobnVsbCk7CiAgICAgICAgICB9CiAgICAgICAgICBkb2NJbmZvLkN1c3RvbVtrZXldID0gY3VzdG9tVmFsdWU7CiAgICAgICAgICBjb250aW51ZTsKICAgICAgfQogICAgICAoMCwgX3V0aWwud2FybikoYEJhZCB2YWx1ZSwgZm9yIGtleSAiJHtrZXl9IiwgaW4gSW5mbzogJHt2YWx1ZX0uYCk7CiAgICB9CiAgICByZXR1cm4gKDAsIF91dGlsLnNoYWRvdykodGhpcywgImRvY3VtZW50SW5mbyIsIGRvY0luZm8pOwogIH0KICBnZXQgZmluZ2VycHJpbnRzKCkgewogICAgZnVuY3Rpb24gdmFsaWRhdGUoZGF0YSkgewogICAgICByZXR1cm4gdHlwZW9mIGRhdGEgPT09ICJzdHJpbmciICYmIGRhdGEubGVuZ3RoID4gMCAmJiBkYXRhICE9PSBFTVBUWV9GSU5HRVJQUklOVDsKICAgIH0KICAgIGZ1bmN0aW9uIGhleFN0cmluZyhoYXNoKSB7CiAgICAgIGNvbnN0IGJ1ZiA9IFtdOwogICAgICBmb3IgKGNvbnN0IG51bSBvZiBoYXNoKSB7CiAgICAgICAgY29uc3QgaGV4ID0gbnVtLnRvU3RyaW5nKDE2KTsKICAgICAgICBidWYucHVzaChoZXgucGFkU3RhcnQoMiwgIjAiKSk7CiAgICAgIH0KICAgICAgcmV0dXJuIGJ1Zi5qb2luKCIiKTsKICAgIH0KICAgIGNvbnN0IGlkQXJyYXkgPSB0aGlzLnhyZWYudHJhaWxlci5nZXQoIklEIik7CiAgICBsZXQgaGFzaE9yaWdpbmFsLCBoYXNoTW9kaWZpZWQ7CiAgICBpZiAoQXJyYXkuaXNBcnJheShpZEFycmF5KSAmJiB2YWxpZGF0ZShpZEFycmF5WzBdKSkgewogICAgICBoYXNoT3JpZ2luYWwgPSAoMCwgX3V0aWwuc3RyaW5nVG9CeXRlcykoaWRBcnJheVswXSk7CiAgICAgIGlmIChpZEFycmF5WzFdICE9PSBpZEFycmF5WzBdICYmIHZhbGlkYXRlKGlkQXJyYXlbMV0pKSB7CiAgICAgICAgaGFzaE1vZGlmaWVkID0gKDAsIF91dGlsLnN0cmluZ1RvQnl0ZXMpKGlkQXJyYXlbMV0pOwogICAgICB9CiAgICB9IGVsc2UgewogICAgICBoYXNoT3JpZ2luYWwgPSAoMCwgX2NyeXB0by5jYWxjdWxhdGVNRDUpKHRoaXMuc3RyZWFtLmdldEJ5dGVSYW5nZSgwLCBGSU5HRVJQUklOVF9GSVJTVF9CWVRFUyksIDAsIEZJTkdFUlBSSU5UX0ZJUlNUX0JZVEVTKTsKICAgIH0KICAgIHJldHVybiAoMCwgX3V0aWwuc2hhZG93KSh0aGlzLCAiZmluZ2VycHJpbnRzIiwgW2hleFN0cmluZyhoYXNoT3JpZ2luYWwpLCBoYXNoTW9kaWZpZWQgPyBoZXhTdHJpbmcoaGFzaE1vZGlmaWVkKSA6IG51bGxdKTsKICB9CiAgYXN5bmMgX2dldExpbmVhcml6YXRpb25QYWdlKHBhZ2VJbmRleCkgewogICAgY29uc3QgewogICAgICBjYXRhbG9nLAogICAgICBsaW5lYXJpemF0aW9uLAogICAgICB4cmVmCiAgICB9ID0gdGhpczsKICAgIGNvbnN0IHJlZiA9IF9wcmltaXRpdmVzLlJlZi5nZXQobGluZWFyaXphdGlvbi5vYmplY3ROdW1iZXJGaXJzdCwgMCk7CiAgICB0cnkgewogICAgICBjb25zdCBvYmogPSBhd2FpdCB4cmVmLmZldGNoQXN5bmMocmVmKTsKICAgICAgaWYgKG9iaiBpbnN0YW5jZW9mIF9wcmltaXRpdmVzLkRpY3QpIHsKICAgICAgICBsZXQgdHlwZSA9IG9iai5nZXRSYXcoIlR5cGUiKTsKICAgICAgICBpZiAodHlwZSBpbnN0YW5jZW9mIF9wcmltaXRpdmVzLlJlZikgewogICAgICAgICAgdHlwZSA9IGF3YWl0IHhyZWYuZmV0Y2hBc3luYyh0eXBlKTsKICAgICAgICB9CiAgICAgICAgaWYgKCgwLCBfcHJpbWl0aXZlcy5pc05hbWUpKHR5cGUsICJQYWdlIikgfHwgIW9iai5oYXMoIlR5cGUiKSAmJiAhb2JqLmhhcygiS2lkcyIpKSB7CiAgICAgICAgICBpZiAoIWNhdGFsb2cucGFnZUtpZHNDb3VudENhY2hlLmhhcyhyZWYpKSB7CiAgICAgICAgICAgIGNhdGFsb2cucGFnZUtpZHNDb3VudENhY2hlLnB1dChyZWYsIDEpOwogICAgICAgICAgfQogICAgICAgICAgaWYgKCFjYXRhbG9nLnBhZ2VJbmRleENhY2hlLmhhcyhyZWYpKSB7CiAgICAgICAgICAgIGNhdGFsb2cucGFnZUluZGV4Q2FjaGUucHV0KHJlZiwgMCk7CiAgICAgICAgICB9CiAgICAgICAgICByZXR1cm4gW29iaiwgcmVmXTsKICAgICAgICB9CiAgICAgIH0KICAgICAgdGhyb3cgbmV3IF91dGlsLkZvcm1hdEVycm9yKCJUaGUgTGluZWFyaXphdGlvbiBkaWN0aW9uYXJ5IGRvZXNuJ3QgcG9pbnQgdG8gYSB2YWxpZCBQYWdlIGRpY3Rpb25hcnkuIik7CiAgICB9IGNhdGNoIChyZWFzb24pIHsKICAgICAgKDAsIF91dGlsLndhcm4pKGBfZ2V0TGluZWFyaXphdGlvblBhZ2U6ICIke3JlYXNvbi5tZXNzYWdlfSIuYCk7CiAgICAgIHJldHVybiBjYXRhbG9nLmdldFBhZ2VEaWN0KHBhZ2VJbmRleCk7CiAgICB9CiAgfQogIGdldFBhZ2UocGFnZUluZGV4KSB7CiAgICBjb25zdCBjYWNoZWRQcm9taXNlID0gdGhpcy5fcGFnZVByb21pc2VzLmdldChwYWdlSW5kZXgpOwogICAgaWYgKGNhY2hlZFByb21pc2UpIHsKICAgICAgcmV0dXJuIGNhY2hlZFByb21pc2U7CiAgICB9CiAgICBjb25zdCB7CiAgICAgIGNhdGFsb2csCiAgICAgIGxpbmVhcml6YXRpb24sCiAgICAgIHhmYUZhY3RvcnkKICAgIH0gPSB0aGlzOwogICAgbGV0IHByb21pc2U7CiAgICBpZiAoeGZhRmFjdG9yeSkgewogICAgICBwcm9taXNlID0gUHJvbWlzZS5yZXNvbHZlKFtfcHJpbWl0aXZlcy5EaWN0LmVtcHR5LCBudWxsXSk7CiAgICB9IGVsc2UgaWYgKGxpbmVhcml6YXRpb24/LnBhZ2VGaXJzdCA9PT0gcGFnZUluZGV4KSB7CiAgICAgIHByb21pc2UgPSB0aGlzLl9nZXRMaW5lYXJpemF0aW9uUGFnZShwYWdlSW5kZXgpOwogICAgfSBlbHNlIHsKICAgICAgcHJvbWlzZSA9IGNhdGFsb2cuZ2V0UGFnZURpY3QocGFnZUluZGV4KTsKICAgIH0KICAgIHByb21pc2UgPSBwcm9taXNlLnRoZW4oKFtwYWdlRGljdCwgcmVmXSkgPT4gewogICAgICByZXR1cm4gbmV3IFBhZ2UoewogICAgICAgIHBkZk1hbmFnZXI6IHRoaXMucGRmTWFuYWdlciwKICAgICAgICB4cmVmOiB0aGlzLnhyZWYsCiAgICAgICAgcGFnZUluZGV4LAogICAgICAgIHBhZ2VEaWN0LAogICAgICAgIHJlZiwKICAgICAgICBnbG9iYWxJZEZhY3Rvcnk6IHRoaXMuX2dsb2JhbElkRmFjdG9yeSwKICAgICAgICBmb250Q2FjaGU6IGNhdGFsb2cuZm9udENhY2hlLAogICAgICAgIGJ1aWx0SW5DTWFwQ2FjaGU6IGNhdGFsb2cuYnVpbHRJbkNNYXBDYWNoZSwKICAgICAgICBzdGFuZGFyZEZvbnREYXRhQ2FjaGU6IGNhdGFsb2cuc3RhbmRhcmRGb250RGF0YUNhY2hlLAogICAgICAgIGdsb2JhbEltYWdlQ2FjaGU6IGNhdGFsb2cuZ2xvYmFsSW1hZ2VDYWNoZSwKICAgICAgICBzeXN0ZW1Gb250Q2FjaGU6IGNhdGFsb2cuc3lzdGVtRm9udENhY2hlLAogICAgICAgIG5vbkJsZW5kTW9kZXNTZXQ6IGNhdGFsb2cubm9uQmxlbmRNb2Rlc1NldCwKICAgICAgICB4ZmFGYWN0b3J5CiAgICAgIH0pOwogICAgfSk7CiAgICB0aGlzLl9wYWdlUHJvbWlzZXMuc2V0KHBhZ2VJbmRleCwgcHJvbWlzZSk7CiAgICByZXR1cm4gcHJvbWlzZTsKICB9CiAgYXN5bmMgY2hlY2tGaXJzdFBhZ2UocmVjb3ZlcnlNb2RlID0gZmFsc2UpIHsKICAgIGlmIChyZWNvdmVyeU1vZGUpIHsKICAgICAgcmV0dXJuOwogICAgfQogICAgdHJ5IHsKICAgICAgYXdhaXQgdGhpcy5nZXRQYWdlKDApOwogICAgfSBjYXRjaCAocmVhc29uKSB7CiAgICAgIGlmIChyZWFzb24gaW5zdGFuY2VvZiBfY29yZV91dGlscy5YUmVmRW50cnlFeGNlcHRpb24pIHsKICAgICAgICB0aGlzLl9wYWdlUHJvbWlzZXMuZGVsZXRlKDApOwogICAgICAgIGF3YWl0IHRoaXMuY2xlYW51cCgpOwogICAgICAgIHRocm93IG5ldyBfY29yZV91dGlscy5YUmVmUGFyc2VFeGNlcHRpb24oKTsKICAgICAgfQogICAgfQogIH0KICBhc3luYyBjaGVja0xhc3RQYWdlKHJlY292ZXJ5TW9kZSA9IGZhbHNlKSB7CiAgICBjb25zdCB7CiAgICAgIGNhdGFsb2csCiAgICAgIHBkZk1hbmFnZXIKICAgIH0gPSB0aGlzOwogICAgY2F0YWxvZy5zZXRBY3R1YWxOdW1QYWdlcygpOwogICAgbGV0IG51bVBhZ2VzOwogICAgdHJ5IHsKICAgICAgYXdhaXQgUHJvbWlzZS5hbGwoW3BkZk1hbmFnZXIuZW5zdXJlRG9jKCJ4ZmFGYWN0b3J5IiksIHBkZk1hbmFnZXIuZW5zdXJlRG9jKCJsaW5lYXJpemF0aW9uIiksIHBkZk1hbmFnZXIuZW5zdXJlQ2F0YWxvZygibnVtUGFnZXMiKV0pOwogICAgICBpZiAodGhpcy54ZmFGYWN0b3J5KSB7CiAgICAgICAgcmV0dXJuOwogICAgICB9IGVsc2UgaWYgKHRoaXMubGluZWFyaXphdGlvbikgewogICAgICAgIG51bVBhZ2VzID0gdGhpcy5saW5lYXJpemF0aW9uLm51bVBhZ2VzOwogICAgICB9IGVsc2UgewogICAgICAgIG51bVBhZ2VzID0gY2F0YWxvZy5udW1QYWdlczsKICAgICAgfQogICAgICBpZiAoIU51bWJlci5pc0ludGVnZXIobnVtUGFnZXMpKSB7CiAgICAgICAgdGhyb3cgbmV3IF91dGlsLkZvcm1hdEVycm9yKCJQYWdlIGNvdW50IGlzIG5vdCBhbiBpbnRlZ2VyLiIpOwogICAgICB9IGVsc2UgaWYgKG51bVBhZ2VzIDw9IDEpIHsKICAgICAgICByZXR1cm47CiAgICAgIH0KICAgICAgYXdhaXQgdGhpcy5nZXRQYWdlKG51bVBhZ2VzIC0gMSk7CiAgICB9IGNhdGNoIChyZWFzb24pIHsKICAgICAgdGhpcy5fcGFnZVByb21pc2VzLmRlbGV0ZShudW1QYWdlcyAtIDEpOwogICAgICBhd2FpdCB0aGlzLmNsZWFudXAoKTsKICAgICAgaWYgKHJlYXNvbiBpbnN0YW5jZW9mIF9jb3JlX3V0aWxzLlhSZWZFbnRyeUV4Y2VwdGlvbiAmJiAhcmVjb3ZlcnlNb2RlKSB7CiAgICAgICAgdGhyb3cgbmV3IF9jb3JlX3V0aWxzLlhSZWZQYXJzZUV4Y2VwdGlvbigpOwogICAgICB9CiAgICAgICgwLCBfdXRpbC53YXJuKShgY2hlY2tMYXN0UGFnZSAtIGludmFsaWQgL1BhZ2VzIHRyZWUgL0NvdW50OiAke251bVBhZ2VzfS5gKTsKICAgICAgbGV0IHBhZ2VzVHJlZTsKICAgICAgdHJ5IHsKICAgICAgICBwYWdlc1RyZWUgPSBhd2FpdCBjYXRhbG9nLmdldEFsbFBhZ2VEaWN0cyhyZWNvdmVyeU1vZGUpOwogICAgICB9IGNhdGNoIChyZWFzb25BbGwpIHsKICAgICAgICBpZiAocmVhc29uQWxsIGluc3RhbmNlb2YgX2NvcmVfdXRpbHMuWFJlZkVudHJ5RXhjZXB0aW9uICYmICFyZWNvdmVyeU1vZGUpIHsKICAgICAgICAgIHRocm93IG5ldyBfY29yZV91dGlscy5YUmVmUGFyc2VFeGNlcHRpb24oKTsKICAgICAgICB9CiAgICAgICAgY2F0YWxvZy5zZXRBY3R1YWxOdW1QYWdlcygxKTsKICAgICAgICByZXR1cm47CiAgICAgIH0KICAgICAgZm9yIChjb25zdCBbcGFnZUluZGV4LCBbcGFnZURpY3QsIHJlZl1dIG9mIHBhZ2VzVHJlZSkgewogICAgICAgIGxldCBwcm9taXNlOwogICAgICAgIGlmIChwYWdlRGljdCBpbnN0YW5jZW9mIEVycm9yKSB7CiAgICAgICAgICBwcm9taXNlID0gUHJvbWlzZS5yZWplY3QocGFnZURpY3QpOwogICAgICAgICAgcHJvbWlzZS5jYXRjaCgoKSA9PiB7fSk7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIHByb21pc2UgPSBQcm9taXNlLnJlc29sdmUobmV3IFBhZ2UoewogICAgICAgICAgICBwZGZNYW5hZ2VyLAogICAgICAgICAgICB4cmVmOiB0aGlzLnhyZWYsCiAgICAgICAgICAgIHBhZ2VJbmRleCwKICAgICAgICAgICAgcGFnZURpY3QsCiAgICAgICAgICAgIHJlZiwKICAgICAgICAgICAgZ2xvYmFsSWRGYWN0b3J5OiB0aGlzLl9nbG9iYWxJZEZhY3RvcnksCiAgICAgICAgICAgIGZvbnRDYWNoZTogY2F0YWxvZy5mb250Q2FjaGUsCiAgICAgICAgICAgIGJ1aWx0SW5DTWFwQ2FjaGU6IGNhdGFsb2cuYnVpbHRJbkNNYXBDYWNoZSwKICAgICAgICAgICAgc3RhbmRhcmRGb250RGF0YUNhY2hlOiBjYXRhbG9nLnN0YW5kYXJkRm9udERhdGFDYWNoZSwKICAgICAgICAgICAgZ2xvYmFsSW1hZ2VDYWNoZTogY2F0YWxvZy5nbG9iYWxJbWFnZUNhY2hlLAogICAgICAgICAgICBzeXN0ZW1Gb250Q2FjaGU6IGNhdGFsb2cuc3lzdGVtRm9udENhY2hlLAogICAgICAgICAgICBub25CbGVuZE1vZGVzU2V0OiBjYXRhbG9nLm5vbkJsZW5kTW9kZXNTZXQsCiAgICAgICAgICAgIHhmYUZhY3Rvcnk6IG51bGwKICAgICAgICAgIH0pKTsKICAgICAgICB9CiAgICAgICAgdGhpcy5fcGFnZVByb21pc2VzLnNldChwYWdlSW5kZXgsIHByb21pc2UpOwogICAgICB9CiAgICAgIGNhdGFsb2cuc2V0QWN0dWFsTnVtUGFnZXMocGFnZXNUcmVlLnNpemUpOwogICAgfQogIH0KICBmb250RmFsbGJhY2soaWQsIGhhbmRsZXIpIHsKICAgIHJldHVybiB0aGlzLmNhdGFsb2cuZm9udEZhbGxiYWNrKGlkLCBoYW5kbGVyKTsKICB9CiAgYXN5bmMgY2xlYW51cChtYW51YWxseVRyaWdnZXJlZCA9IGZhbHNlKSB7CiAgICByZXR1cm4gdGhpcy5jYXRhbG9nID8gdGhpcy5jYXRhbG9nLmNsZWFudXAobWFudWFsbHlUcmlnZ2VyZWQpIDogKDAsIF9jbGVhbnVwX2hlbHBlci5jbGVhckdsb2JhbENhY2hlcykoKTsKICB9CiAgI2NvbGxlY3RGaWVsZE9iamVjdHMobmFtZSwgZmllbGRSZWYsIHByb21pc2VzLCBhbm5vdGF0aW9uR2xvYmFscykgewogICAgY29uc3QgZmllbGQgPSB0aGlzLnhyZWYuZmV0Y2hJZlJlZihmaWVsZFJlZik7CiAgICBpZiAoZmllbGQuaGFzKCJUIikpIHsKICAgICAgY29uc3QgcGFydE5hbWUgPSAoMCwgX3V0aWwuc3RyaW5nVG9QREZTdHJpbmcpKGZpZWxkLmdldCgiVCIpKTsKICAgICAgbmFtZSA9IG5hbWUgPT09ICIiID8gcGFydE5hbWUgOiBgJHtuYW1lfS4ke3BhcnROYW1lfWA7CiAgICB9CiAgICBpZiAoIXByb21pc2VzLmhhcyhuYW1lKSkgewogICAgICBwcm9taXNlcy5zZXQobmFtZSwgW10pOwogICAgfQogICAgcHJvbWlzZXMuZ2V0KG5hbWUpLnB1c2goX2Fubm90YXRpb24uQW5ub3RhdGlvbkZhY3RvcnkuY3JlYXRlKHRoaXMueHJlZiwgZmllbGRSZWYsIGFubm90YXRpb25HbG9iYWxzLCB0aGlzLl9sb2NhbElkRmFjdG9yeSwgdHJ1ZSwgbnVsbCkudGhlbihhbm5vdGF0aW9uID0+IGFubm90YXRpb24/LmdldEZpZWxkT2JqZWN0KCkpLmNhdGNoKGZ1bmN0aW9uIChyZWFzb24pIHsKICAgICAgKDAsIF91dGlsLndhcm4pKGAjY29sbGVjdEZpZWxkT2JqZWN0czogIiR7cmVhc29ufSIuYCk7CiAgICAgIHJldHVybiBudWxsOwogICAgfSkpOwogICAgaWYgKGZpZWxkLmhhcygiS2lkcyIpKSB7CiAgICAgIGZvciAoY29uc3Qga2lkIG9mIGZpZWxkLmdldCgiS2lkcyIpKSB7CiAgICAgICAgdGhpcy4jY29sbGVjdEZpZWxkT2JqZWN0cyhuYW1lLCBraWQsIHByb21pc2VzLCBhbm5vdGF0aW9uR2xvYmFscyk7CiAgICAgIH0KICAgIH0KICB9CiAgZ2V0IGZpZWxkT2JqZWN0cygpIHsKICAgIGlmICghdGhpcy5mb3JtSW5mby5oYXNGaWVsZHMpIHsKICAgICAgcmV0dXJuICgwLCBfdXRpbC5zaGFkb3cpKHRoaXMsICJmaWVsZE9iamVjdHMiLCBQcm9taXNlLnJlc29sdmUobnVsbCkpOwogICAgfQogICAgY29uc3QgcHJvbWlzZSA9IHRoaXMucGRmTWFuYWdlci5lbnN1cmVEb2MoImFubm90YXRpb25HbG9iYWxzIikudGhlbihhc3luYyBhbm5vdGF0aW9uR2xvYmFscyA9PiB7CiAgICAgIGlmICghYW5ub3RhdGlvbkdsb2JhbHMpIHsKICAgICAgICByZXR1cm4gbnVsbDsKICAgICAgfQogICAgICBjb25zdCBhbGxGaWVsZHMgPSBPYmplY3QuY3JlYXRlKG51bGwpOwogICAgICBjb25zdCBmaWVsZFByb21pc2VzID0gbmV3IE1hcCgpOwogICAgICBmb3IgKGNvbnN0IGZpZWxkUmVmIG9mIHRoaXMuY2F0YWxvZy5hY3JvRm9ybS5nZXQoIkZpZWxkcyIpKSB7CiAgICAgICAgdGhpcy4jY29sbGVjdEZpZWxkT2JqZWN0cygiIiwgZmllbGRSZWYsIGZpZWxkUHJvbWlzZXMsIGFubm90YXRpb25HbG9iYWxzKTsKICAgICAgfQogICAgICBjb25zdCBhbGxQcm9taXNlcyA9IFtdOwogICAgICBmb3IgKGNvbnN0IFtuYW1lLCBwcm9taXNlc10gb2YgZmllbGRQcm9taXNlcykgewogICAgICAgIGFsbFByb21pc2VzLnB1c2goUHJvbWlzZS5hbGwocHJvbWlzZXMpLnRoZW4oZmllbGRzID0+IHsKICAgICAgICAgIGZpZWxkcyA9IGZpZWxkcy5maWx0ZXIoZmllbGQgPT4gISFmaWVsZCk7CiAgICAgICAgICBpZiAoZmllbGRzLmxlbmd0aCA+IDApIHsKICAgICAgICAgICAgYWxsRmllbGRzW25hbWVdID0gZmllbGRzOwogICAgICAgICAgfQogICAgICAgIH0pKTsKICAgICAgfQogICAgICBhd2FpdCBQcm9taXNlLmFsbChhbGxQcm9taXNlcyk7CiAgICAgIHJldHVybiBhbGxGaWVsZHM7CiAgICB9KTsKICAgIHJldHVybiAoMCwgX3V0aWwuc2hhZG93KSh0aGlzLCAiZmllbGRPYmplY3RzIiwgcHJvbWlzZSk7CiAgfQogIGdldCBoYXNKU0FjdGlvbnMoKSB7CiAgICBjb25zdCBwcm9taXNlID0gdGhpcy5wZGZNYW5hZ2VyLmVuc3VyZURvYygiX3BhcnNlSGFzSlNBY3Rpb25zIik7CiAgICByZXR1cm4gKDAsIF91dGlsLnNoYWRvdykodGhpcywgImhhc0pTQWN0aW9ucyIsIHByb21pc2UpOwogIH0KICBhc3luYyBfcGFyc2VIYXNKU0FjdGlvbnMoKSB7CiAgICBjb25zdCBbY2F0YWxvZ0pzQWN0aW9ucywgZmllbGRPYmplY3RzXSA9IGF3YWl0IFByb21pc2UuYWxsKFt0aGlzLnBkZk1hbmFnZXIuZW5zdXJlQ2F0YWxvZygianNBY3Rpb25zIiksIHRoaXMucGRmTWFuYWdlci5lbnN1cmVEb2MoImZpZWxkT2JqZWN0cyIpXSk7CiAgICBpZiAoY2F0YWxvZ0pzQWN0aW9ucykgewogICAgICByZXR1cm4gdHJ1ZTsKICAgIH0KICAgIGlmIChmaWVsZE9iamVjdHMpIHsKICAgICAgcmV0dXJuIE9iamVjdC52YWx1ZXMoZmllbGRPYmplY3RzKS5zb21lKGZpZWxkT2JqZWN0ID0+IGZpZWxkT2JqZWN0LnNvbWUob2JqZWN0ID0+IG9iamVjdC5hY3Rpb25zICE9PSBudWxsKSk7CiAgICB9CiAgICByZXR1cm4gZmFsc2U7CiAgfQogIGdldCBjYWxjdWxhdGlvbk9yZGVySWRzKCkgewogICAgY29uc3QgYWNyb0Zvcm0gPSB0aGlzLmNhdGFsb2cuYWNyb0Zvcm07CiAgICBpZiAoIWFjcm9Gb3JtPy5oYXMoIkNPIikpIHsKICAgICAgcmV0dXJuICgwLCBfdXRpbC5zaGFkb3cpKHRoaXMsICJjYWxjdWxhdGlvbk9yZGVySWRzIiwgbnVsbCk7CiAgICB9CiAgICBjb25zdCBjYWxjdWxhdGlvbk9yZGVyID0gYWNyb0Zvcm0uZ2V0KCJDTyIpOwogICAgaWYgKCFBcnJheS5pc0FycmF5KGNhbGN1bGF0aW9uT3JkZXIpIHx8IGNhbGN1bGF0aW9uT3JkZXIubGVuZ3RoID09PSAwKSB7CiAgICAgIHJldHVybiAoMCwgX3V0aWwuc2hhZG93KSh0aGlzLCAiY2FsY3VsYXRpb25PcmRlcklkcyIsIG51bGwpOwogICAgfQogICAgY29uc3QgaWRzID0gW107CiAgICBmb3IgKGNvbnN0IGlkIG9mIGNhbGN1bGF0aW9uT3JkZXIpIHsKICAgICAgaWYgKGlkIGluc3RhbmNlb2YgX3ByaW1pdGl2ZXMuUmVmKSB7CiAgICAgICAgaWRzLnB1c2goaWQudG9TdHJpbmcoKSk7CiAgICAgIH0KICAgIH0KICAgIGlmIChpZHMubGVuZ3RoID09PSAwKSB7CiAgICAgIHJldHVybiAoMCwgX3V0aWwuc2hhZG93KSh0aGlzLCAiY2FsY3VsYXRpb25PcmRlcklkcyIsIG51bGwpOwogICAgfQogICAgcmV0dXJuICgwLCBfdXRpbC5zaGFkb3cpKHRoaXMsICJjYWxjdWxhdGlvbk9yZGVySWRzIiwgaWRzKTsKICB9CiAgZ2V0IGFubm90YXRpb25HbG9iYWxzKCkgewogICAgcmV0dXJuICgwLCBfdXRpbC5zaGFkb3cpKHRoaXMsICJhbm5vdGF0aW9uR2xvYmFscyIsIF9hbm5vdGF0aW9uLkFubm90YXRpb25GYWN0b3J5LmNyZWF0ZUdsb2JhbHModGhpcy5wZGZNYW5hZ2VyKSk7CiAgfQp9CmV4cG9ydHMuUERGRG9jdW1lbnQgPSBQREZEb2N1bWVudDsKCi8qKiovIH0pLAovKiAxMCAqLwovKioqLyAoKF9fdW51c2VkX3dlYnBhY2tfbW9kdWxlLCBleHBvcnRzLCBfX3dfcGRmanNfcmVxdWlyZV9fKSA9PiB7CgoKCk9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCAiX19lc01vZHVsZSIsICh7CiAgdmFsdWU6IHRydWUKfSkpOwpleHBvcnRzLlBvcHVwQW5ub3RhdGlvbiA9IGV4cG9ydHMuTWFya3VwQW5ub3RhdGlvbiA9IGV4cG9ydHMuQW5ub3RhdGlvbkZhY3RvcnkgPSBleHBvcnRzLkFubm90YXRpb25Cb3JkZXJTdHlsZSA9IGV4cG9ydHMuQW5ub3RhdGlvbiA9IHZvaWQgMDsKZXhwb3J0cy5nZXRRdWFkUG9pbnRzID0gZ2V0UXVhZFBvaW50czsKdmFyIF91dGlsID0gX193X3BkZmpzX3JlcXVpcmVfXygyKTsKdmFyIF9jb3JlX3V0aWxzID0gX193X3BkZmpzX3JlcXVpcmVfXygzKTsKdmFyIF9kZWZhdWx0X2FwcGVhcmFuY2UgPSBfX3dfcGRmanNfcmVxdWlyZV9fKDExKTsKdmFyIF9wcmltaXRpdmVzID0gX193X3BkZmpzX3JlcXVpcmVfXyg0KTsKdmFyIF9zdHJlYW0gPSBfX3dfcGRmanNfcmVxdWlyZV9fKDgpOwp2YXIgX2Jhc2Vfc3RyZWFtID0gX193X3BkZmpzX3JlcXVpcmVfXyg1KTsKdmFyIF9iaWRpID0gX193X3BkZmpzX3JlcXVpcmVfXyg2MCk7CnZhciBfY2F0YWxvZyA9IF9fd19wZGZqc19yZXF1aXJlX18oNjYpOwp2YXIgX2NvbG9yc3BhY2UgPSBfX3dfcGRmanNfcmVxdWlyZV9fKDEyKTsKdmFyIF9maWxlX3NwZWMgPSBfX3dfcGRmanNfcmVxdWlyZV9fKDY5KTsKdmFyIF9qcGVnX3N0cmVhbSA9IF9fd19wZGZqc19yZXF1aXJlX18oMjYpOwp2YXIgX29iamVjdF9sb2FkZXIgPSBfX3dfcGRmanNfcmVxdWlyZV9fKDc2KTsKdmFyIF9vcGVyYXRvcl9saXN0ID0gX193X3BkZmpzX3JlcXVpcmVfXyg2NCk7CnZhciBfd3JpdGVyID0gX193X3BkZmpzX3JlcXVpcmVfXyg3Myk7CnZhciBfZmFjdG9yeSA9IF9fd19wZGZqc19yZXF1aXJlX18oNzcpOwpjbGFzcyBBbm5vdGF0aW9uRmFjdG9yeSB7CiAgc3RhdGljIGNyZWF0ZUdsb2JhbHMocGRmTWFuYWdlcikgewogICAgcmV0dXJuIFByb21pc2UuYWxsKFtwZGZNYW5hZ2VyLmVuc3VyZUNhdGFsb2coImFjcm9Gb3JtIiksIHBkZk1hbmFnZXIuZW5zdXJlRG9jKCJ4ZmFEYXRhc2V0cyIpLCBwZGZNYW5hZ2VyLmVuc3VyZUNhdGFsb2coInN0cnVjdFRyZWVSb290IiksIHBkZk1hbmFnZXIuZW5zdXJlQ2F0YWxvZygiYmFzZVVybCIpLCBwZGZNYW5hZ2VyLmVuc3VyZUNhdGFsb2coImF0dGFjaG1lbnRzIildKS50aGVuKChbYWNyb0Zvcm0sIHhmYURhdGFzZXRzLCBzdHJ1Y3RUcmVlUm9vdCwgYmFzZVVybCwgYXR0YWNobWVudHNdKSA9PiB7CiAgICAgIHJldHVybiB7CiAgICAgICAgcGRmTWFuYWdlciwKICAgICAgICBhY3JvRm9ybTogYWNyb0Zvcm0gaW5zdGFuY2VvZiBfcHJpbWl0aXZlcy5EaWN0ID8gYWNyb0Zvcm0gOiBfcHJpbWl0aXZlcy5EaWN0LmVtcHR5LAogICAgICAgIHhmYURhdGFzZXRzLAogICAgICAgIHN0cnVjdFRyZWVSb290LAogICAgICAgIGJhc2VVcmwsCiAgICAgICAgYXR0YWNobWVudHMKICAgICAgfTsKICAgIH0sIHJlYXNvbiA9PiB7CiAgICAgICgwLCBfdXRpbC53YXJuKShgY3JlYXRlR2xvYmFsczogIiR7cmVhc29ufSIuYCk7CiAgICAgIHJldHVybiBudWxsOwogICAgfSk7CiAgfQogIHN0YXRpYyBhc3luYyBjcmVhdGUoeHJlZiwgcmVmLCBhbm5vdGF0aW9uR2xvYmFscywgaWRGYWN0b3J5LCBjb2xsZWN0RmllbGRzLCBwYWdlUmVmKSB7CiAgICBjb25zdCBwYWdlSW5kZXggPSBjb2xsZWN0RmllbGRzID8gYXdhaXQgdGhpcy5fZ2V0UGFnZUluZGV4KHhyZWYsIHJlZiwgYW5ub3RhdGlvbkdsb2JhbHMucGRmTWFuYWdlcikgOiBudWxsOwogICAgcmV0dXJuIGFubm90YXRpb25HbG9iYWxzLnBkZk1hbmFnZXIuZW5zdXJlKHRoaXMsICJfY3JlYXRlIiwgW3hyZWYsIHJlZiwgYW5ub3RhdGlvbkdsb2JhbHMsIGlkRmFjdG9yeSwgY29sbGVjdEZpZWxkcywgcGFnZUluZGV4LCBwYWdlUmVmXSk7CiAgfQogIHN0YXRpYyBfY3JlYXRlKHhyZWYsIHJlZiwgYW5ub3RhdGlvbkdsb2JhbHMsIGlkRmFjdG9yeSwgY29sbGVjdEZpZWxkcyA9IGZhbHNlLCBwYWdlSW5kZXggPSBudWxsLCBwYWdlUmVmID0gbnVsbCkgewogICAgY29uc3QgZGljdCA9IHhyZWYuZmV0Y2hJZlJlZihyZWYpOwogICAgaWYgKCEoZGljdCBpbnN0YW5jZW9mIF9wcmltaXRpdmVzLkRpY3QpKSB7CiAgICAgIHJldHVybiB1bmRlZmluZWQ7CiAgICB9CiAgICBjb25zdCB7CiAgICAgIGFjcm9Gb3JtLAogICAgICBwZGZNYW5hZ2VyCiAgICB9ID0gYW5ub3RhdGlvbkdsb2JhbHM7CiAgICBjb25zdCBpZCA9IHJlZiBpbnN0YW5jZW9mIF9wcmltaXRpdmVzLlJlZiA/IHJlZi50b1N0cmluZygpIDogYGFubm90XyR7aWRGYWN0b3J5LmNyZWF0ZU9iaklkKCl9YDsKICAgIGxldCBzdWJ0eXBlID0gZGljdC5nZXQoIlN1YnR5cGUiKTsKICAgIHN1YnR5cGUgPSBzdWJ0eXBlIGluc3RhbmNlb2YgX3ByaW1pdGl2ZXMuTmFtZSA/IHN1YnR5cGUubmFtZSA6IG51bGw7CiAgICBjb25zdCBwYXJhbWV0ZXJzID0gewogICAgICB4cmVmLAogICAgICByZWYsCiAgICAgIGRpY3QsCiAgICAgIHN1YnR5cGUsCiAgICAgIGlkLAogICAgICBhbm5vdGF0aW9uR2xvYmFscywKICAgICAgY29sbGVjdEZpZWxkcywKICAgICAgbmVlZEFwcGVhcmFuY2VzOiAhY29sbGVjdEZpZWxkcyAmJiBhY3JvRm9ybS5nZXQoIk5lZWRBcHBlYXJhbmNlcyIpID09PSB0cnVlLAogICAgICBwYWdlSW5kZXgsCiAgICAgIGV2YWx1YXRvck9wdGlvbnM6IHBkZk1hbmFnZXIuZXZhbHVhdG9yT3B0aW9ucywKICAgICAgcGFnZVJlZgogICAgfTsKICAgIHN3aXRjaCAoc3VidHlwZSkgewogICAgICBjYXNlICJMaW5rIjoKICAgICAgICByZXR1cm4gbmV3IExpbmtBbm5vdGF0aW9uKHBhcmFtZXRlcnMpOwogICAgICBjYXNlICJUZXh0IjoKICAgICAgICByZXR1cm4gbmV3IFRleHRBbm5vdGF0aW9uKHBhcmFtZXRlcnMpOwogICAgICBjYXNlICJXaWRnZXQiOgogICAgICAgIGxldCBmaWVsZFR5cGUgPSAoMCwgX2NvcmVfdXRpbHMuZ2V0SW5oZXJpdGFibGVQcm9wZXJ0eSkoewogICAgICAgICAgZGljdCwKICAgICAgICAgIGtleTogIkZUIgogICAgICAgIH0pOwogICAgICAgIGZpZWxkVHlwZSA9IGZpZWxkVHlwZSBpbnN0YW5jZW9mIF9wcmltaXRpdmVzLk5hbWUgPyBmaWVsZFR5cGUubmFtZSA6IG51bGw7CiAgICAgICAgc3dpdGNoIChmaWVsZFR5cGUpIHsKICAgICAgICAgIGNhc2UgIlR4IjoKICAgICAgICAgICAgcmV0dXJuIG5ldyBUZXh0V2lkZ2V0QW5ub3RhdGlvbihwYXJhbWV0ZXJzKTsKICAgICAgICAgIGNhc2UgIkJ0biI6CiAgICAgICAgICAgIHJldHVybiBuZXcgQnV0dG9uV2lkZ2V0QW5ub3RhdGlvbihwYXJhbWV0ZXJzKTsKICAgICAgICAgIGNhc2UgIkNoIjoKICAgICAgICAgICAgcmV0dXJuIG5ldyBDaG9pY2VXaWRnZXRBbm5vdGF0aW9uKHBhcmFtZXRlcnMpOwogICAgICAgICAgY2FzZSAiU2lnIjoKICAgICAgICAgICAgcmV0dXJuIG5ldyBTaWduYXR1cmVXaWRnZXRBbm5vdGF0aW9uKHBhcmFtZXRlcnMpOwogICAgICAgIH0KICAgICAgICAoMCwgX3V0aWwud2FybikoYFVuaW1wbGVtZW50ZWQgd2lkZ2V0IGZpZWxkIHR5cGUgIiR7ZmllbGRUeXBlfSIsIGAgKyAiZmFsbGluZyBiYWNrIHRvIGJhc2UgZmllbGQgdHlwZS4iKTsKICAgICAgICByZXR1cm4gbmV3IFdpZGdldEFubm90YXRpb24ocGFyYW1ldGVycyk7CiAgICAgIGNhc2UgIlBvcHVwIjoKICAgICAgICByZXR1cm4gbmV3IFBvcHVwQW5ub3RhdGlvbihwYXJhbWV0ZXJzKTsKICAgICAgY2FzZSAiRnJlZVRleHQiOgogICAgICAgIHJldHVybiBuZXcgRnJlZVRleHRBbm5vdGF0aW9uKHBhcmFtZXRlcnMpOwogICAgICBjYXNlICJMaW5lIjoKICAgICAgICByZXR1cm4gbmV3IExpbmVBbm5vdGF0aW9uKHBhcmFtZXRlcnMpOwogICAgICBjYXNlICJTcXVhcmUiOgogICAgICAgIHJldHVybiBuZXcgU3F1YXJlQW5ub3RhdGlvbihwYXJhbWV0ZXJzKTsKICAgICAgY2FzZSAiQ2lyY2xlIjoKICAgICAgICByZXR1cm4gbmV3IENpcmNsZUFubm90YXRpb24ocGFyYW1ldGVycyk7CiAgICAgIGNhc2UgIlBvbHlMaW5lIjoKICAgICAgICByZXR1cm4gbmV3IFBvbHlsaW5lQW5ub3RhdGlvbihwYXJhbWV0ZXJzKTsKICAgICAgY2FzZSAiUG9seWdvbiI6CiAgICAgICAgcmV0dXJuIG5ldyBQb2x5Z29uQW5ub3RhdGlvbihwYXJhbWV0ZXJzKTsKICAgICAgY2FzZSAiQ2FyZXQiOgogICAgICAgIHJldHVybiBuZXcgQ2FyZXRBbm5vdGF0aW9uKHBhcmFtZXRlcnMpOwogICAgICBjYXNlICJJbmsiOgogICAgICAgIHJldHVybiBuZXcgSW5rQW5ub3RhdGlvbihwYXJhbWV0ZXJzKTsKICAgICAgY2FzZSAiSGlnaGxpZ2h0IjoKICAgICAgICByZXR1cm4gbmV3IEhpZ2hsaWdodEFubm90YXRpb24ocGFyYW1ldGVycyk7CiAgICAgIGNhc2UgIlVuZGVybGluZSI6CiAgICAgICAgcmV0dXJuIG5ldyBVbmRlcmxpbmVBbm5vdGF0aW9uKHBhcmFtZXRlcnMpOwogICAgICBjYXNlICJTcXVpZ2dseSI6CiAgICAgICAgcmV0dXJuIG5ldyBTcXVpZ2dseUFubm90YXRpb24ocGFyYW1ldGVycyk7CiAgICAgIGNhc2UgIlN0cmlrZU91dCI6CiAgICAgICAgcmV0dXJuIG5ldyBTdHJpa2VPdXRBbm5vdGF0aW9uKHBhcmFtZXRlcnMpOwogICAgICBjYXNlICJTdGFtcCI6CiAgICAgICAgcmV0dXJuIG5ldyBTdGFtcEFubm90YXRpb24ocGFyYW1ldGVycyk7CiAgICAgIGNhc2UgIkZpbGVBdHRhY2htZW50IjoKICAgICAgICByZXR1cm4gbmV3IEZpbGVBdHRhY2htZW50QW5ub3RhdGlvbihwYXJhbWV0ZXJzKTsKICAgICAgZGVmYXVsdDoKICAgICAgICBpZiAoIWNvbGxlY3RGaWVsZHMpIHsKICAgICAgICAgIGlmICghc3VidHlwZSkgewogICAgICAgICAgICAoMCwgX3V0aWwud2FybikoIkFubm90YXRpb24gaXMgbWlzc2luZyB0aGUgcmVxdWlyZWQgL1N1YnR5cGUuIik7CiAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAoMCwgX3V0aWwud2FybikoYFVuaW1wbGVtZW50ZWQgYW5ub3RhdGlvbiB0eXBlICIke3N1YnR5cGV9IiwgYCArICJmYWxsaW5nIGJhY2sgdG8gYmFzZSBhbm5vdGF0aW9uLiIpOwogICAgICAgICAgfQogICAgICAgIH0KICAgICAgICByZXR1cm4gbmV3IEFubm90YXRpb24ocGFyYW1ldGVycyk7CiAgICB9CiAgfQogIHN0YXRpYyBhc3luYyBfZ2V0UGFnZUluZGV4KHhyZWYsIHJlZiwgcGRmTWFuYWdlcikgewogICAgdHJ5IHsKICAgICAgY29uc3QgYW5ub3REaWN0ID0gYXdhaXQgeHJlZi5mZXRjaElmUmVmQXN5bmMocmVmKTsKICAgICAgaWYgKCEoYW5ub3REaWN0IGluc3RhbmNlb2YgX3ByaW1pdGl2ZXMuRGljdCkpIHsKICAgICAgICByZXR1cm4gLTE7CiAgICAgIH0KICAgICAgY29uc3QgcGFnZVJlZiA9IGFubm90RGljdC5nZXRSYXcoIlAiKTsKICAgICAgaWYgKHBhZ2VSZWYgaW5zdGFuY2VvZiBfcHJpbWl0aXZlcy5SZWYpIHsKICAgICAgICB0cnkgewogICAgICAgICAgY29uc3QgcGFnZUluZGV4ID0gYXdhaXQgcGRmTWFuYWdlci5lbnN1cmVDYXRhbG9nKCJnZXRQYWdlSW5kZXgiLCBbcGFnZVJlZl0pOwogICAgICAgICAgcmV0dXJuIHBhZ2VJbmRleDsKICAgICAgICB9IGNhdGNoIChleCkgewogICAgICAgICAgKDAsIF91dGlsLmluZm8pKGBfZ2V0UGFnZUluZGV4IC0tIG5vdCBhIHZhbGlkIHBhZ2UgcmVmZXJlbmNlOiAiJHtleH0iLmApOwogICAgICAgIH0KICAgICAgfQogICAgICBpZiAoYW5ub3REaWN0LmhhcygiS2lkcyIpKSB7CiAgICAgICAgcmV0dXJuIC0xOwogICAgICB9CiAgICAgIGNvbnN0IG51bVBhZ2VzID0gYXdhaXQgcGRmTWFuYWdlci5lbnN1cmVEb2MoIm51bVBhZ2VzIik7CiAgICAgIGZvciAobGV0IHBhZ2VJbmRleCA9IDA7IHBhZ2VJbmRleCA8IG51bVBhZ2VzOyBwYWdlSW5kZXgrKykgewogICAgICAgIGNvbnN0IHBhZ2UgPSBhd2FpdCBwZGZNYW5hZ2VyLmdldFBhZ2UocGFnZUluZGV4KTsKICAgICAgICBjb25zdCBhbm5vdGF0aW9ucyA9IGF3YWl0IHBkZk1hbmFnZXIuZW5zdXJlKHBhZ2UsICJhbm5vdGF0aW9ucyIpOwogICAgICAgIGZvciAoY29uc3QgYW5ub3RSZWYgb2YgYW5ub3RhdGlvbnMpIHsKICAgICAgICAgIGlmIChhbm5vdFJlZiBpbnN0YW5jZW9mIF9wcmltaXRpdmVzLlJlZiAmJiAoMCwgX3ByaW1pdGl2ZXMuaXNSZWZzRXF1YWwpKGFubm90UmVmLCByZWYpKSB7CiAgICAgICAgICAgIHJldHVybiBwYWdlSW5kZXg7CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICB9CiAgICB9IGNhdGNoIChleCkgewogICAgICAoMCwgX3V0aWwud2FybikoYF9nZXRQYWdlSW5kZXg6ICIke2V4fSIuYCk7CiAgICB9CiAgICByZXR1cm4gLTE7CiAgfQogIHN0YXRpYyBnZW5lcmF0ZUltYWdlcyhhbm5vdGF0aW9ucywgeHJlZiwgaXNPZmZzY3JlZW5DYW52YXNTdXBwb3J0ZWQpIHsKICAgIGlmICghaXNPZmZzY3JlZW5DYW52YXNTdXBwb3J0ZWQpIHsKICAgICAgKDAsIF91dGlsLndhcm4pKCJnZW5lcmF0ZUltYWdlczogT2Zmc2NyZWVuQ2FudmFzIGlzIG5vdCBzdXBwb3J0ZWQsIGNhbm5vdCBzYXZlIG9yIHByaW50IHNvbWUgYW5ub3RhdGlvbnMgd2l0aCBpbWFnZXMuIik7CiAgICAgIHJldHVybiBudWxsOwogICAgfQogICAgbGV0IGltYWdlUHJvbWlzZXM7CiAgICBmb3IgKGNvbnN0IHsKICAgICAgYml0bWFwSWQsCiAgICAgIGJpdG1hcAogICAgfSBvZiBhbm5vdGF0aW9ucykgewogICAgICBpZiAoIWJpdG1hcCkgewogICAgICAgIGNvbnRpbnVlOwogICAgICB9CiAgICAgIGltYWdlUHJvbWlzZXMgfHw9IG5ldyBNYXAoKTsKICAgICAgaW1hZ2VQcm9taXNlcy5zZXQoYml0bWFwSWQsIFN0YW1wQW5ub3RhdGlvbi5jcmVhdGVJbWFnZShiaXRtYXAsIHhyZWYpKTsKICAgIH0KICAgIHJldHVybiBpbWFnZVByb21pc2VzOwogIH0KICBzdGF0aWMgYXN5bmMgc2F2ZU5ld0Fubm90YXRpb25zKGV2YWx1YXRvciwgdGFzaywgYW5ub3RhdGlvbnMsIGltYWdlUHJvbWlzZXMpIHsKICAgIGNvbnN0IHhyZWYgPSBldmFsdWF0b3IueHJlZjsKICAgIGxldCBiYXNlRm9udFJlZjsKICAgIGNvbnN0IGRlcGVuZGVuY2llcyA9IFtdOwogICAgY29uc3QgcHJvbWlzZXMgPSBbXTsKICAgIGNvbnN0IHsKICAgICAgaXNPZmZzY3JlZW5DYW52YXNTdXBwb3J0ZWQKICAgIH0gPSBldmFsdWF0b3Iub3B0aW9uczsKICAgIGZvciAoY29uc3QgYW5ub3RhdGlvbiBvZiBhbm5vdGF0aW9ucykgewogICAgICBpZiAoYW5ub3RhdGlvbi5kZWxldGVkKSB7CiAgICAgICAgY29udGludWU7CiAgICAgIH0KICAgICAgc3dpdGNoIChhbm5vdGF0aW9uLmFubm90YXRpb25UeXBlKSB7CiAgICAgICAgY2FzZSBfdXRpbC5Bbm5vdGF0aW9uRWRpdG9yVHlwZS5GUkVFVEVYVDoKICAgICAgICAgIGlmICghYmFzZUZvbnRSZWYpIHsKICAgICAgICAgICAgY29uc3QgYmFzZUZvbnQgPSBuZXcgX3ByaW1pdGl2ZXMuRGljdCh4cmVmKTsKICAgICAgICAgICAgYmFzZUZvbnQuc2V0KCJCYXNlRm9udCIsIF9wcmltaXRpdmVzLk5hbWUuZ2V0KCJIZWx2ZXRpY2EiKSk7CiAgICAgICAgICAgIGJhc2VGb250LnNldCgiVHlwZSIsIF9wcmltaXRpdmVzLk5hbWUuZ2V0KCJGb250IikpOwogICAgICAgICAgICBiYXNlRm9udC5zZXQoIlN1YnR5cGUiLCBfcHJpbWl0aXZlcy5OYW1lLmdldCgiVHlwZTEiKSk7CiAgICAgICAgICAgIGJhc2VGb250LnNldCgiRW5jb2RpbmciLCBfcHJpbWl0aXZlcy5OYW1lLmdldCgiV2luQW5zaUVuY29kaW5nIikpOwogICAgICAgICAgICBjb25zdCBidWZmZXIgPSBbXTsKICAgICAgICAgICAgYmFzZUZvbnRSZWYgPSB4cmVmLmdldE5ld1RlbXBvcmFyeVJlZigpOwogICAgICAgICAgICBhd2FpdCAoMCwgX3dyaXRlci53cml0ZU9iamVjdCkoYmFzZUZvbnRSZWYsIGJhc2VGb250LCBidWZmZXIsIHhyZWYpOwogICAgICAgICAgICBkZXBlbmRlbmNpZXMucHVzaCh7CiAgICAgICAgICAgICAgcmVmOiBiYXNlRm9udFJlZiwKICAgICAgICAgICAgICBkYXRhOiBidWZmZXIuam9pbigiIikKICAgICAgICAgICAgfSk7CiAgICAgICAgICB9CiAgICAgICAgICBwcm9taXNlcy5wdXNoKEZyZWVUZXh0QW5ub3RhdGlvbi5jcmVhdGVOZXdBbm5vdGF0aW9uKHhyZWYsIGFubm90YXRpb24sIGRlcGVuZGVuY2llcywgewogICAgICAgICAgICBldmFsdWF0b3IsCiAgICAgICAgICAgIHRhc2ssCiAgICAgICAgICAgIGJhc2VGb250UmVmCiAgICAgICAgICB9KSk7CiAgICAgICAgICBicmVhazsKICAgICAgICBjYXNlIF91dGlsLkFubm90YXRpb25FZGl0b3JUeXBlLklOSzoKICAgICAgICAgIHByb21pc2VzLnB1c2goSW5rQW5ub3RhdGlvbi5jcmVhdGVOZXdBbm5vdGF0aW9uKHhyZWYsIGFubm90YXRpb24sIGRlcGVuZGVuY2llcykpOwogICAgICAgICAgYnJlYWs7CiAgICAgICAgY2FzZSBfdXRpbC5Bbm5vdGF0aW9uRWRpdG9yVHlwZS5TVEFNUDoKICAgICAgICAgIGlmICghaXNPZmZzY3JlZW5DYW52YXNTdXBwb3J0ZWQpIHsKICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICB9CiAgICAgICAgICBjb25zdCBpbWFnZSA9IGF3YWl0IGltYWdlUHJvbWlzZXMuZ2V0KGFubm90YXRpb24uYml0bWFwSWQpOwogICAgICAgICAgaWYgKGltYWdlLmltYWdlU3RyZWFtKSB7CiAgICAgICAgICAgIGNvbnN0IHsKICAgICAgICAgICAgICBpbWFnZVN0cmVhbSwKICAgICAgICAgICAgICBzbWFza1N0cmVhbQogICAgICAgICAgICB9ID0gaW1hZ2U7CiAgICAgICAgICAgIGNvbnN0IGJ1ZmZlciA9IFtdOwogICAgICAgICAgICBpZiAoc21hc2tTdHJlYW0pIHsKICAgICAgICAgICAgICBjb25zdCBzbWFza1JlZiA9IHhyZWYuZ2V0TmV3VGVtcG9yYXJ5UmVmKCk7CiAgICAgICAgICAgICAgYXdhaXQgKDAsIF93cml0ZXIud3JpdGVPYmplY3QpKHNtYXNrUmVmLCBzbWFza1N0cmVhbSwgYnVmZmVyLCB4cmVmKTsKICAgICAgICAgICAgICBkZXBlbmRlbmNpZXMucHVzaCh7CiAgICAgICAgICAgICAgICByZWY6IHNtYXNrUmVmLAogICAgICAgICAgICAgICAgZGF0YTogYnVmZmVyLmpvaW4oIiIpCiAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgaW1hZ2VTdHJlYW0uZGljdC5zZXQoIlNNYXNrIiwgc21hc2tSZWYpOwogICAgICAgICAgICAgIGJ1ZmZlci5sZW5ndGggPSAwOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGNvbnN0IGltYWdlUmVmID0gaW1hZ2UuaW1hZ2VSZWYgPSB4cmVmLmdldE5ld1RlbXBvcmFyeVJlZigpOwogICAgICAgICAgICBhd2FpdCAoMCwgX3dyaXRlci53cml0ZU9iamVjdCkoaW1hZ2VSZWYsIGltYWdlU3RyZWFtLCBidWZmZXIsIHhyZWYpOwogICAgICAgICAgICBkZXBlbmRlbmNpZXMucHVzaCh7CiAgICAgICAgICAgICAgcmVmOiBpbWFnZVJlZiwKICAgICAgICAgICAgICBkYXRhOiBidWZmZXIuam9pbigiIikKICAgICAgICAgICAgfSk7CiAgICAgICAgICAgIGltYWdlLmltYWdlU3RyZWFtID0gaW1hZ2Uuc21hc2tTdHJlYW0gPSBudWxsOwogICAgICAgICAgfQogICAgICAgICAgcHJvbWlzZXMucHVzaChTdGFtcEFubm90YXRpb24uY3JlYXRlTmV3QW5ub3RhdGlvbih4cmVmLCBhbm5vdGF0aW9uLCBkZXBlbmRlbmNpZXMsIHsKICAgICAgICAgICAgaW1hZ2UKICAgICAgICAgIH0pKTsKICAgICAgICAgIGJyZWFrOwogICAgICB9CiAgICB9CiAgICByZXR1cm4gewogICAgICBhbm5vdGF0aW9uczogYXdhaXQgUHJvbWlzZS5hbGwocHJvbWlzZXMpLAogICAgICBkZXBlbmRlbmNpZXMKICAgIH07CiAgfQogIHN0YXRpYyBhc3luYyBwcmludE5ld0Fubm90YXRpb25zKGFubm90YXRpb25HbG9iYWxzLCBldmFsdWF0b3IsIHRhc2ssIGFubm90YXRpb25zLCBpbWFnZVByb21pc2VzKSB7CiAgICBpZiAoIWFubm90YXRpb25zKSB7CiAgICAgIHJldHVybiBudWxsOwogICAgfQogICAgY29uc3QgewogICAgICBvcHRpb25zLAogICAgICB4cmVmCiAgICB9ID0gZXZhbHVhdG9yOwogICAgY29uc3QgcHJvbWlzZXMgPSBbXTsKICAgIGZvciAoY29uc3QgYW5ub3RhdGlvbiBvZiBhbm5vdGF0aW9ucykgewogICAgICBpZiAoYW5ub3RhdGlvbi5kZWxldGVkKSB7CiAgICAgICAgY29udGludWU7CiAgICAgIH0KICAgICAgc3dpdGNoIChhbm5vdGF0aW9uLmFubm90YXRpb25UeXBlKSB7CiAgICAgICAgY2FzZSBfdXRpbC5Bbm5vdGF0aW9uRWRpdG9yVHlwZS5GUkVFVEVYVDoKICAgICAgICAgIHByb21pc2VzLnB1c2goRnJlZVRleHRBbm5vdGF0aW9uLmNyZWF0ZU5ld1ByaW50QW5ub3RhdGlvbihhbm5vdGF0aW9uR2xvYmFscywgeHJlZiwgYW5ub3RhdGlvbiwgewogICAgICAgICAgICBldmFsdWF0b3IsCiAgICAgICAgICAgIHRhc2ssCiAgICAgICAgICAgIGV2YWx1YXRvck9wdGlvbnM6IG9wdGlvbnMKICAgICAgICAgIH0pKTsKICAgICAgICAgIGJyZWFrOwogICAgICAgIGNhc2UgX3V0aWwuQW5ub3RhdGlvbkVkaXRvclR5cGUuSU5LOgogICAgICAgICAgcHJvbWlzZXMucHVzaChJbmtBbm5vdGF0aW9uLmNyZWF0ZU5ld1ByaW50QW5ub3RhdGlvbihhbm5vdGF0aW9uR2xvYmFscywgeHJlZiwgYW5ub3RhdGlvbiwgewogICAgICAgICAgICBldmFsdWF0b3JPcHRpb25zOiBvcHRpb25zCiAgICAgICAgICB9KSk7CiAgICAgICAgICBicmVhazsKICAgICAgICBjYXNlIF91dGlsLkFubm90YXRpb25FZGl0b3JUeXBlLlNUQU1QOgogICAgICAgICAgaWYgKCFvcHRpb25zLmlzT2Zmc2NyZWVuQ2FudmFzU3VwcG9ydGVkKSB7CiAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgfQogICAgICAgICAgY29uc3QgaW1hZ2UgPSBhd2FpdCBpbWFnZVByb21pc2VzLmdldChhbm5vdGF0aW9uLmJpdG1hcElkKTsKICAgICAgICAgIGlmIChpbWFnZS5pbWFnZVN0cmVhbSkgewogICAgICAgICAgICBjb25zdCB7CiAgICAgICAgICAgICAgaW1hZ2VTdHJlYW0sCiAgICAgICAgICAgICAgc21hc2tTdHJlYW0KICAgICAgICAgICAgfSA9IGltYWdlOwogICAgICAgICAgICBpZiAoc21hc2tTdHJlYW0pIHsKICAgICAgICAgICAgICBpbWFnZVN0cmVhbS5kaWN0LnNldCgiU01hc2siLCBzbWFza1N0cmVhbSk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgaW1hZ2UuaW1hZ2VSZWYgPSBuZXcgX2pwZWdfc3RyZWFtLkpwZWdTdHJlYW0oaW1hZ2VTdHJlYW0sIGltYWdlU3RyZWFtLmxlbmd0aCk7CiAgICAgICAgICAgIGltYWdlLmltYWdlU3RyZWFtID0gaW1hZ2Uuc21hc2tTdHJlYW0gPSBudWxsOwogICAgICAgICAgfQogICAgICAgICAgcHJvbWlzZXMucHVzaChTdGFtcEFubm90YXRpb24uY3JlYXRlTmV3UHJpbnRBbm5vdGF0aW9uKGFubm90YXRpb25HbG9iYWxzLCB4cmVmLCBhbm5vdGF0aW9uLCB7CiAgICAgICAgICAgIGltYWdlLAogICAgICAgICAgICBldmFsdWF0b3JPcHRpb25zOiBvcHRpb25zCiAgICAgICAgICB9KSk7CiAgICAgICAgICBicmVhazsKICAgICAgfQogICAgfQogICAgcmV0dXJuIFByb21pc2UuYWxsKHByb21pc2VzKTsKICB9Cn0KZXhwb3J0cy5Bbm5vdGF0aW9uRmFjdG9yeSA9IEFubm90YXRpb25GYWN0b3J5OwpmdW5jdGlvbiBnZXRSZ2JDb2xvcihjb2xvciwgZGVmYXVsdENvbG9yID0gbmV3IFVpbnQ4Q2xhbXBlZEFycmF5KDMpKSB7CiAgaWYgKCFBcnJheS5pc0FycmF5KGNvbG9yKSkgewogICAgcmV0dXJuIGRlZmF1bHRDb2xvcjsKICB9CiAgY29uc3QgcmdiQ29sb3IgPSBkZWZhdWx0Q29sb3IgfHwgbmV3IFVpbnQ4Q2xhbXBlZEFycmF5KDMpOwogIHN3aXRjaCAoY29sb3IubGVuZ3RoKSB7CiAgICBjYXNlIDA6CiAgICAgIHJldHVybiBudWxsOwogICAgY2FzZSAxOgogICAgICBfY29sb3JzcGFjZS5Db2xvclNwYWNlLnNpbmdsZXRvbnMuZ3JheS5nZXRSZ2JJdGVtKGNvbG9yLCAwLCByZ2JDb2xvciwgMCk7CiAgICAgIHJldHVybiByZ2JDb2xvcjsKICAgIGNhc2UgMzoKICAgICAgX2NvbG9yc3BhY2UuQ29sb3JTcGFjZS5zaW5nbGV0b25zLnJnYi5nZXRSZ2JJdGVtKGNvbG9yLCAwLCByZ2JDb2xvciwgMCk7CiAgICAgIHJldHVybiByZ2JDb2xvcjsKICAgIGNhc2UgNDoKICAgICAgX2NvbG9yc3BhY2UuQ29sb3JTcGFjZS5zaW5nbGV0b25zLmNteWsuZ2V0UmdiSXRlbShjb2xvciwgMCwgcmdiQ29sb3IsIDApOwogICAgICByZXR1cm4gcmdiQ29sb3I7CiAgICBkZWZhdWx0OgogICAgICByZXR1cm4gZGVmYXVsdENvbG9yOwogIH0KfQpmdW5jdGlvbiBnZXRQZGZDb2xvckFycmF5KGNvbG9yKSB7CiAgcmV0dXJuIEFycmF5LmZyb20oY29sb3IsIGMgPT4gYyAvIDI1NSk7Cn0KZnVuY3Rpb24gZ2V0UXVhZFBvaW50cyhkaWN0LCByZWN0KSB7CiAgY29uc3QgcXVhZFBvaW50cyA9IGRpY3QuZ2V0QXJyYXkoIlF1YWRQb2ludHMiKTsKICBpZiAoIUFycmF5LmlzQXJyYXkocXVhZFBvaW50cykgfHwgcXVhZFBvaW50cy5sZW5ndGggPT09IDAgfHwgcXVhZFBvaW50cy5sZW5ndGggJSA4ID4gMCkgewogICAgcmV0dXJuIG51bGw7CiAgfQogIGNvbnN0IHF1YWRQb2ludHNMaXN0cyA9IFtdOwogIGZvciAobGV0IGkgPSAwLCBpaSA9IHF1YWRQb2ludHMubGVuZ3RoIC8gODsgaSA8IGlpOyBpKyspIHsKICAgIGxldCBtaW5YID0gSW5maW5pdHksCiAgICAgIG1heFggPSAtSW5maW5pdHksCiAgICAgIG1pblkgPSBJbmZpbml0eSwKICAgICAgbWF4WSA9IC1JbmZpbml0eTsKICAgIGZvciAobGV0IGogPSBpICogOCwgamogPSBpICogOCArIDg7IGogPCBqajsgaiArPSAyKSB7CiAgICAgIGNvbnN0IHggPSBxdWFkUG9pbnRzW2pdOwogICAgICBjb25zdCB5ID0gcXVhZFBvaW50c1tqICsgMV07CiAgICAgIG1pblggPSBNYXRoLm1pbih4LCBtaW5YKTsKICAgICAgbWF4WCA9IE1hdGgubWF4KHgsIG1heFgpOwogICAgICBtaW5ZID0gTWF0aC5taW4oeSwgbWluWSk7CiAgICAgIG1heFkgPSBNYXRoLm1heCh5LCBtYXhZKTsKICAgIH0KICAgIGlmIChyZWN0ICE9PSBudWxsICYmIChtaW5YIDwgcmVjdFswXSB8fCBtYXhYID4gcmVjdFsyXSB8fCBtaW5ZIDwgcmVjdFsxXSB8fCBtYXhZID4gcmVjdFszXSkpIHsKICAgICAgcmV0dXJuIG51bGw7CiAgICB9CiAgICBxdWFkUG9pbnRzTGlzdHMucHVzaChbewogICAgICB4OiBtaW5YLAogICAgICB5OiBtYXhZCiAgICB9LCB7CiAgICAgIHg6IG1heFgsCiAgICAgIHk6IG1heFkKICAgIH0sIHsKICAgICAgeDogbWluWCwKICAgICAgeTogbWluWQogICAgfSwgewogICAgICB4OiBtYXhYLAogICAgICB5OiBtaW5ZCiAgICB9XSk7CiAgfQogIHJldHVybiBxdWFkUG9pbnRzTGlzdHM7Cn0KZnVuY3Rpb24gZ2V0VHJhbnNmb3JtTWF0cml4KHJlY3QsIGJib3gsIG1hdHJpeCkgewogIGNvbnN0IFttaW5YLCBtaW5ZLCBtYXhYLCBtYXhZXSA9IF91dGlsLlV0aWwuZ2V0QXhpYWxBbGlnbmVkQm91bmRpbmdCb3goYmJveCwgbWF0cml4KTsKICBpZiAobWluWCA9PT0gbWF4WCB8fCBtaW5ZID09PSBtYXhZKSB7CiAgICByZXR1cm4gWzEsIDAsIDAsIDEsIHJlY3RbMF0sIHJlY3RbMV1dOwogIH0KICBjb25zdCB4UmF0aW8gPSAocmVjdFsyXSAtIHJlY3RbMF0pIC8gKG1heFggLSBtaW5YKTsKICBjb25zdCB5UmF0aW8gPSAocmVjdFszXSAtIHJlY3RbMV0pIC8gKG1heFkgLSBtaW5ZKTsKICByZXR1cm4gW3hSYXRpbywgMCwgMCwgeVJhdGlvLCByZWN0WzBdIC0gbWluWCAqIHhSYXRpbywgcmVjdFsxXSAtIG1pblkgKiB5UmF0aW9dOwp9CmNsYXNzIEFubm90YXRpb24gewogIGNvbnN0cnVjdG9yKHBhcmFtcykgewogICAgY29uc3QgewogICAgICBkaWN0LAogICAgICB4cmVmLAogICAgICBhbm5vdGF0aW9uR2xvYmFscwogICAgfSA9IHBhcmFtczsKICAgIHRoaXMuc2V0VGl0bGUoZGljdC5nZXQoIlQiKSk7CiAgICB0aGlzLnNldENvbnRlbnRzKGRpY3QuZ2V0KCJDb250ZW50cyIpKTsKICAgIHRoaXMuc2V0TW9kaWZpY2F0aW9uRGF0ZShkaWN0LmdldCgiTSIpKTsKICAgIHRoaXMuc2V0RmxhZ3MoZGljdC5nZXQoIkYiKSk7CiAgICB0aGlzLnNldFJlY3RhbmdsZShkaWN0LmdldEFycmF5KCJSZWN0IikpOwogICAgdGhpcy5zZXRDb2xvcihkaWN0LmdldEFycmF5KCJDIikpOwogICAgdGhpcy5zZXRCb3JkZXJTdHlsZShkaWN0KTsKICAgIHRoaXMuc2V0QXBwZWFyYW5jZShkaWN0KTsKICAgIHRoaXMuc2V0T3B0aW9uYWxDb250ZW50KGRpY3QpOwogICAgY29uc3QgTUsgPSBkaWN0LmdldCgiTUsiKTsKICAgIHRoaXMuc2V0Qm9yZGVyQW5kQmFja2dyb3VuZENvbG9ycyhNSyk7CiAgICB0aGlzLnNldFJvdGF0aW9uKE1LLCBkaWN0KTsKICAgIHRoaXMucmVmID0gcGFyYW1zLnJlZiBpbnN0YW5jZW9mIF9wcmltaXRpdmVzLlJlZiA/IHBhcmFtcy5yZWYgOiBudWxsOwogICAgdGhpcy5fc3RyZWFtcyA9IFtdOwogICAgaWYgKHRoaXMuYXBwZWFyYW5jZSkgewogICAgICB0aGlzLl9zdHJlYW1zLnB1c2godGhpcy5hcHBlYXJhbmNlKTsKICAgIH0KICAgIGNvbnN0IGlzTG9ja2VkID0gISEodGhpcy5mbGFncyAmIF91dGlsLkFubm90YXRpb25GbGFnLkxPQ0tFRCk7CiAgICBjb25zdCBpc0NvbnRlbnRMb2NrZWQgPSAhISh0aGlzLmZsYWdzICYgX3V0aWwuQW5ub3RhdGlvbkZsYWcuTE9DS0VEQ09OVEVOVFMpOwogICAgaWYgKGFubm90YXRpb25HbG9iYWxzLnN0cnVjdFRyZWVSb290KSB7CiAgICAgIGxldCBzdHJ1Y3RQYXJlbnQgPSBkaWN0LmdldCgiU3RydWN0UGFyZW50Iik7CiAgICAgIHN0cnVjdFBhcmVudCA9IE51bWJlci5pc0ludGVnZXIoc3RydWN0UGFyZW50KSAmJiBzdHJ1Y3RQYXJlbnQgPj0gMCA/IHN0cnVjdFBhcmVudCA6IC0xOwogICAgICBhbm5vdGF0aW9uR2xvYmFscy5zdHJ1Y3RUcmVlUm9vdC5hZGRBbm5vdGF0aW9uSWRUb1BhZ2UocGFyYW1zLnBhZ2VSZWYsIHN0cnVjdFBhcmVudCk7CiAgICB9CiAgICB0aGlzLmRhdGEgPSB7CiAgICAgIGFubm90YXRpb25GbGFnczogdGhpcy5mbGFncywKICAgICAgYm9yZGVyU3R5bGU6IHRoaXMuYm9yZGVyU3R5bGUsCiAgICAgIGNvbG9yOiB0aGlzLmNvbG9yLAogICAgICBiYWNrZ3JvdW5kQ29sb3I6IHRoaXMuYmFja2dyb3VuZENvbG9yLAogICAgICBib3JkZXJDb2xvcjogdGhpcy5ib3JkZXJDb2xvciwKICAgICAgcm90YXRpb246IHRoaXMucm90YXRpb24sCiAgICAgIGNvbnRlbnRzT2JqOiB0aGlzLl9jb250ZW50cywKICAgICAgaGFzQXBwZWFyYW5jZTogISF0aGlzLmFwcGVhcmFuY2UsCiAgICAgIGlkOiBwYXJhbXMuaWQsCiAgICAgIG1vZGlmaWNhdGlvbkRhdGU6IHRoaXMubW9kaWZpY2F0aW9uRGF0ZSwKICAgICAgcmVjdDogdGhpcy5yZWN0YW5nbGUsCiAgICAgIHN1YnR5cGU6IHBhcmFtcy5zdWJ0eXBlLAogICAgICBoYXNPd25DYW52YXM6IGZhbHNlLAogICAgICBub1JvdGF0ZTogISEodGhpcy5mbGFncyAmIF91dGlsLkFubm90YXRpb25GbGFnLk5PUk9UQVRFKSwKICAgICAgbm9IVE1MOiBpc0xvY2tlZCAmJiBpc0NvbnRlbnRMb2NrZWQKICAgIH07CiAgICBpZiAocGFyYW1zLmNvbGxlY3RGaWVsZHMpIHsKICAgICAgY29uc3Qga2lkcyA9IGRpY3QuZ2V0KCJLaWRzIik7CiAgICAgIGlmIChBcnJheS5pc0FycmF5KGtpZHMpKSB7CiAgICAgICAgY29uc3Qga2lkSWRzID0gW107CiAgICAgICAgZm9yIChjb25zdCBraWQgb2Yga2lkcykgewogICAgICAgICAgaWYgKGtpZCBpbnN0YW5jZW9mIF9wcmltaXRpdmVzLlJlZikgewogICAgICAgICAgICBraWRJZHMucHVzaChraWQudG9TdHJpbmcoKSk7CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIGlmIChraWRJZHMubGVuZ3RoICE9PSAwKSB7CiAgICAgICAgICB0aGlzLmRhdGEua2lkSWRzID0ga2lkSWRzOwogICAgICAgIH0KICAgICAgfQogICAgICB0aGlzLmRhdGEuYWN0aW9ucyA9ICgwLCBfY29yZV91dGlscy5jb2xsZWN0QWN0aW9ucykoeHJlZiwgZGljdCwgX3V0aWwuQW5ub3RhdGlvbkFjdGlvbkV2ZW50VHlwZSk7CiAgICAgIHRoaXMuZGF0YS5maWVsZE5hbWUgPSB0aGlzLl9jb25zdHJ1Y3RGaWVsZE5hbWUoZGljdCk7CiAgICAgIHRoaXMuZGF0YS5wYWdlSW5kZXggPSBwYXJhbXMucGFnZUluZGV4OwogICAgfQogICAgdGhpcy5faXNPZmZzY3JlZW5DYW52YXNTdXBwb3J0ZWQgPSBwYXJhbXMuZXZhbHVhdG9yT3B0aW9ucy5pc09mZnNjcmVlbkNhbnZhc1N1cHBvcnRlZDsKICAgIHRoaXMuX2ZhbGxiYWNrRm9udERpY3QgPSBudWxsOwogICAgdGhpcy5fbmVlZEFwcGVhcmFuY2VzID0gZmFsc2U7CiAgfQogIF9oYXNGbGFnKGZsYWdzLCBmbGFnKSB7CiAgICByZXR1cm4gISEoZmxhZ3MgJiBmbGFnKTsKICB9CiAgX2lzVmlld2FibGUoZmxhZ3MpIHsKICAgIHJldHVybiAhdGhpcy5faGFzRmxhZyhmbGFncywgX3V0aWwuQW5ub3RhdGlvbkZsYWcuSU5WSVNJQkxFKSAmJiAhdGhpcy5faGFzRmxhZyhmbGFncywgX3V0aWwuQW5ub3RhdGlvbkZsYWcuTk9WSUVXKTsKICB9CiAgX2lzUHJpbnRhYmxlKGZsYWdzKSB7CiAgICByZXR1cm4gdGhpcy5faGFzRmxhZyhmbGFncywgX3V0aWwuQW5ub3RhdGlvbkZsYWcuUFJJTlQpICYmICF0aGlzLl9oYXNGbGFnKGZsYWdzLCBfdXRpbC5Bbm5vdGF0aW9uRmxhZy5ISURERU4pICYmICF0aGlzLl9oYXNGbGFnKGZsYWdzLCBfdXRpbC5Bbm5vdGF0aW9uRmxhZy5JTlZJU0lCTEUpOwogIH0KICBtdXN0QmVWaWV3ZWQoYW5ub3RhdGlvblN0b3JhZ2UsIF9yZW5kZXJGb3JtcykgewogICAgY29uc3Qgbm9WaWV3ID0gYW5ub3RhdGlvblN0b3JhZ2U/LmdldCh0aGlzLmRhdGEuaWQpPy5ub1ZpZXc7CiAgICBpZiAobm9WaWV3ICE9PSB1bmRlZmluZWQpIHsKICAgICAgcmV0dXJuICFub1ZpZXc7CiAgICB9CiAgICByZXR1cm4gdGhpcy52aWV3YWJsZSAmJiAhdGhpcy5faGFzRmxhZyh0aGlzLmZsYWdzLCBfdXRpbC5Bbm5vdGF0aW9uRmxhZy5ISURERU4pOwogIH0KICBtdXN0QmVQcmludGVkKGFubm90YXRpb25TdG9yYWdlKSB7CiAgICBjb25zdCBub1ByaW50ID0gYW5ub3RhdGlvblN0b3JhZ2U/LmdldCh0aGlzLmRhdGEuaWQpPy5ub1ByaW50OwogICAgaWYgKG5vUHJpbnQgIT09IHVuZGVmaW5lZCkgewogICAgICByZXR1cm4gIW5vUHJpbnQ7CiAgICB9CiAgICByZXR1cm4gdGhpcy5wcmludGFibGU7CiAgfQogIGdldCB2aWV3YWJsZSgpIHsKICAgIGlmICh0aGlzLmRhdGEucXVhZFBvaW50cyA9PT0gbnVsbCkgewogICAgICByZXR1cm4gZmFsc2U7CiAgICB9CiAgICBpZiAodGhpcy5mbGFncyA9PT0gMCkgewogICAgICByZXR1cm4gdHJ1ZTsKICAgIH0KICAgIHJldHVybiB0aGlzLl9pc1ZpZXdhYmxlKHRoaXMuZmxhZ3MpOwogIH0KICBnZXQgcHJpbnRhYmxlKCkgewogICAgaWYgKHRoaXMuZGF0YS5xdWFkUG9pbnRzID09PSBudWxsKSB7CiAgICAgIHJldHVybiBmYWxzZTsKICAgIH0KICAgIGlmICh0aGlzLmZsYWdzID09PSAwKSB7CiAgICAgIHJldHVybiBmYWxzZTsKICAgIH0KICAgIHJldHVybiB0aGlzLl9pc1ByaW50YWJsZSh0aGlzLmZsYWdzKTsKICB9CiAgX3BhcnNlU3RyaW5nSGVscGVyKGRhdGEpIHsKICAgIGNvbnN0IHN0ciA9IHR5cGVvZiBkYXRhID09PSAic3RyaW5nIiA/ICgwLCBfdXRpbC5zdHJpbmdUb1BERlN0cmluZykoZGF0YSkgOiAiIjsKICAgIGNvbnN0IGRpciA9IHN0ciAmJiAoMCwgX2JpZGkuYmlkaSkoc3RyKS5kaXIgPT09ICJydGwiID8gInJ0bCIgOiAibHRyIjsKICAgIHJldHVybiB7CiAgICAgIHN0ciwKICAgICAgZGlyCiAgICB9OwogIH0KICBzZXREZWZhdWx0QXBwZWFyYW5jZShwYXJhbXMpIHsKICAgIGNvbnN0IHsKICAgICAgZGljdCwKICAgICAgYW5ub3RhdGlvbkdsb2JhbHMKICAgIH0gPSBwYXJhbXM7CiAgICBjb25zdCBkZWZhdWx0QXBwZWFyYW5jZSA9ICgwLCBfY29yZV91dGlscy5nZXRJbmhlcml0YWJsZVByb3BlcnR5KSh7CiAgICAgIGRpY3QsCiAgICAgIGtleTogIkRBIgogICAgfSkgfHwgYW5ub3RhdGlvbkdsb2JhbHMuYWNyb0Zvcm0uZ2V0KCJEQSIpOwogICAgdGhpcy5fZGVmYXVsdEFwcGVhcmFuY2UgPSB0eXBlb2YgZGVmYXVsdEFwcGVhcmFuY2UgPT09ICJzdHJpbmciID8gZGVmYXVsdEFwcGVhcmFuY2UgOiAiIjsKICAgIHRoaXMuZGF0YS5kZWZhdWx0QXBwZWFyYW5jZURhdGEgPSAoMCwgX2RlZmF1bHRfYXBwZWFyYW5jZS5wYXJzZURlZmF1bHRBcHBlYXJhbmNlKSh0aGlzLl9kZWZhdWx0QXBwZWFyYW5jZSk7CiAgfQogIHNldFRpdGxlKHRpdGxlKSB7CiAgICB0aGlzLl90aXRsZSA9IHRoaXMuX3BhcnNlU3RyaW5nSGVscGVyKHRpdGxlKTsKICB9CiAgc2V0Q29udGVudHMoY29udGVudHMpIHsKICAgIHRoaXMuX2NvbnRlbnRzID0gdGhpcy5fcGFyc2VTdHJpbmdIZWxwZXIoY29udGVudHMpOwogIH0KICBzZXRNb2RpZmljYXRpb25EYXRlKG1vZGlmaWNhdGlvbkRhdGUpIHsKICAgIHRoaXMubW9kaWZpY2F0aW9uRGF0ZSA9IHR5cGVvZiBtb2RpZmljYXRpb25EYXRlID09PSAic3RyaW5nIiA/IG1vZGlmaWNhdGlvbkRhdGUgOiBudWxsOwogIH0KICBzZXRGbGFncyhmbGFncykgewogICAgdGhpcy5mbGFncyA9IE51bWJlci5pc0ludGVnZXIoZmxhZ3MpICYmIGZsYWdzID4gMCA/IGZsYWdzIDogMDsKICB9CiAgaGFzRmxhZyhmbGFnKSB7CiAgICByZXR1cm4gdGhpcy5faGFzRmxhZyh0aGlzLmZsYWdzLCBmbGFnKTsKICB9CiAgc2V0UmVjdGFuZ2xlKHJlY3RhbmdsZSkgewogICAgdGhpcy5yZWN0YW5nbGUgPSBBcnJheS5pc0FycmF5KHJlY3RhbmdsZSkgJiYgcmVjdGFuZ2xlLmxlbmd0aCA9PT0gNCA/IF91dGlsLlV0aWwubm9ybWFsaXplUmVjdChyZWN0YW5nbGUpIDogWzAsIDAsIDAsIDBdOwogIH0KICBzZXRDb2xvcihjb2xvcikgewogICAgdGhpcy5jb2xvciA9IGdldFJnYkNvbG9yKGNvbG9yKTsKICB9CiAgc2V0TGluZUVuZGluZ3MobGluZUVuZGluZ3MpIHsKICAgIHRoaXMubGluZUVuZGluZ3MgPSBbIk5vbmUiLCAiTm9uZSJdOwogICAgaWYgKEFycmF5LmlzQXJyYXkobGluZUVuZGluZ3MpICYmIGxpbmVFbmRpbmdzLmxlbmd0aCA9PT0gMikgewogICAgICBmb3IgKGxldCBpID0gMDsgaSA8IDI7IGkrKykgewogICAgICAgIGNvbnN0IG9iaiA9IGxpbmVFbmRpbmdzW2ldOwogICAgICAgIGlmIChvYmogaW5zdGFuY2VvZiBfcHJpbWl0aXZlcy5OYW1lKSB7CiAgICAgICAgICBzd2l0Y2ggKG9iai5uYW1lKSB7CiAgICAgICAgICAgIGNhc2UgIk5vbmUiOgogICAgICAgICAgICAgIGNvbnRpbnVlOwogICAgICAgICAgICBjYXNlICJTcXVhcmUiOgogICAgICAgICAgICBjYXNlICJDaXJjbGUiOgogICAgICAgICAgICBjYXNlICJEaWFtb25kIjoKICAgICAgICAgICAgY2FzZSAiT3BlbkFycm93IjoKICAgICAgICAgICAgY2FzZSAiQ2xvc2VkQXJyb3ciOgogICAgICAgICAgICBjYXNlICJCdXR0IjoKICAgICAgICAgICAgY2FzZSAiUk9wZW5BcnJvdyI6CiAgICAgICAgICAgIGNhc2UgIlJDbG9zZWRBcnJvdyI6CiAgICAgICAgICAgIGNhc2UgIlNsYXNoIjoKICAgICAgICAgICAgICB0aGlzLmxpbmVFbmRpbmdzW2ldID0gb2JqLm5hbWU7CiAgICAgICAgICAgICAgY29udGludWU7CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgICgwLCBfdXRpbC53YXJuKShgSWdub3JpbmcgaW52YWxpZCBsaW5lRW5kaW5nOiAke29ian1gKTsKICAgICAgfQogICAgfQogIH0KICBzZXRSb3RhdGlvbihtaywgZGljdCkgewogICAgdGhpcy5yb3RhdGlvbiA9IDA7CiAgICBsZXQgYW5nbGUgPSBtayBpbnN0YW5jZW9mIF9wcmltaXRpdmVzLkRpY3QgPyBtay5nZXQoIlIiKSB8fCAwIDogZGljdC5nZXQoIlJvdGF0ZSIpIHx8IDA7CiAgICBpZiAoTnVtYmVyLmlzSW50ZWdlcihhbmdsZSkgJiYgYW5nbGUgIT09IDApIHsKICAgICAgYW5nbGUgJT0gMzYwOwogICAgICBpZiAoYW5nbGUgPCAwKSB7CiAgICAgICAgYW5nbGUgKz0gMzYwOwogICAgICB9CiAgICAgIGlmIChhbmdsZSAlIDkwID09PSAwKSB7CiAgICAgICAgdGhpcy5yb3RhdGlvbiA9IGFuZ2xlOwogICAgICB9CiAgICB9CiAgfQogIHNldEJvcmRlckFuZEJhY2tncm91bmRDb2xvcnMobWspIHsKICAgIGlmIChtayBpbnN0YW5jZW9mIF9wcmltaXRpdmVzLkRpY3QpIHsKICAgICAgdGhpcy5ib3JkZXJDb2xvciA9IGdldFJnYkNvbG9yKG1rLmdldEFycmF5KCJCQyIpLCBudWxsKTsKICAgICAgdGhpcy5iYWNrZ3JvdW5kQ29sb3IgPSBnZXRSZ2JDb2xvcihtay5nZXRBcnJheSgiQkciKSwgbnVsbCk7CiAgICB9IGVsc2UgewogICAgICB0aGlzLmJvcmRlckNvbG9yID0gdGhpcy5iYWNrZ3JvdW5kQ29sb3IgPSBudWxsOwogICAgfQogIH0KICBzZXRCb3JkZXJTdHlsZShib3JkZXJTdHlsZSkgewogICAgdGhpcy5ib3JkZXJTdHlsZSA9IG5ldyBBbm5vdGF0aW9uQm9yZGVyU3R5bGUoKTsKICAgIGlmICghKGJvcmRlclN0eWxlIGluc3RhbmNlb2YgX3ByaW1pdGl2ZXMuRGljdCkpIHsKICAgICAgcmV0dXJuOwogICAgfQogICAgaWYgKGJvcmRlclN0eWxlLmhhcygiQlMiKSkgewogICAgICBjb25zdCBkaWN0ID0gYm9yZGVyU3R5bGUuZ2V0KCJCUyIpOwogICAgICBjb25zdCBkaWN0VHlwZSA9IGRpY3QuZ2V0KCJUeXBlIik7CiAgICAgIGlmICghZGljdFR5cGUgfHwgKDAsIF9wcmltaXRpdmVzLmlzTmFtZSkoZGljdFR5cGUsICJCb3JkZXIiKSkgewogICAgICAgIHRoaXMuYm9yZGVyU3R5bGUuc2V0V2lkdGgoZGljdC5nZXQoIlciKSwgdGhpcy5yZWN0YW5nbGUpOwogICAgICAgIHRoaXMuYm9yZGVyU3R5bGUuc2V0U3R5bGUoZGljdC5nZXQoIlMiKSk7CiAgICAgICAgdGhpcy5ib3JkZXJTdHlsZS5zZXREYXNoQXJyYXkoZGljdC5nZXRBcnJheSgiRCIpKTsKICAgICAgfQogICAgfSBlbHNlIGlmIChib3JkZXJTdHlsZS5oYXMoIkJvcmRlciIpKSB7CiAgICAgIGNvbnN0IGFycmF5ID0gYm9yZGVyU3R5bGUuZ2V0QXJyYXkoIkJvcmRlciIpOwogICAgICBpZiAoQXJyYXkuaXNBcnJheShhcnJheSkgJiYgYXJyYXkubGVuZ3RoID49IDMpIHsKICAgICAgICB0aGlzLmJvcmRlclN0eWxlLnNldEhvcml6b250YWxDb3JuZXJSYWRpdXMoYXJyYXlbMF0pOwogICAgICAgIHRoaXMuYm9yZGVyU3R5bGUuc2V0VmVydGljYWxDb3JuZXJSYWRpdXMoYXJyYXlbMV0pOwogICAgICAgIHRoaXMuYm9yZGVyU3R5bGUuc2V0V2lkdGgoYXJyYXlbMl0sIHRoaXMucmVjdGFuZ2xlKTsKICAgICAgICBpZiAoYXJyYXkubGVuZ3RoID09PSA0KSB7CiAgICAgICAgICB0aGlzLmJvcmRlclN0eWxlLnNldERhc2hBcnJheShhcnJheVszXSwgdHJ1ZSk7CiAgICAgICAgfQogICAgICB9CiAgICB9IGVsc2UgewogICAgICB0aGlzLmJvcmRlclN0eWxlLnNldFdpZHRoKDApOwogICAgfQogIH0KICBzZXRBcHBlYXJhbmNlKGRpY3QpIHsKICAgIHRoaXMuYXBwZWFyYW5jZSA9IG51bGw7CiAgICBjb25zdCBhcHBlYXJhbmNlU3RhdGVzID0gZGljdC5nZXQoIkFQIik7CiAgICBpZiAoIShhcHBlYXJhbmNlU3RhdGVzIGluc3RhbmNlb2YgX3ByaW1pdGl2ZXMuRGljdCkpIHsKICAgICAgcmV0dXJuOwogICAgfQogICAgY29uc3Qgbm9ybWFsQXBwZWFyYW5jZVN0YXRlID0gYXBwZWFyYW5jZVN0YXRlcy5nZXQoIk4iKTsKICAgIGlmIChub3JtYWxBcHBlYXJhbmNlU3RhdGUgaW5zdGFuY2VvZiBfYmFzZV9zdHJlYW0uQmFzZVN0cmVhbSkgewogICAgICB0aGlzLmFwcGVhcmFuY2UgPSBub3JtYWxBcHBlYXJhbmNlU3RhdGU7CiAgICAgIHJldHVybjsKICAgIH0KICAgIGlmICghKG5vcm1hbEFwcGVhcmFuY2VTdGF0ZSBpbnN0YW5jZW9mIF9wcmltaXRpdmVzLkRpY3QpKSB7CiAgICAgIHJldHVybjsKICAgIH0KICAgIGNvbnN0IGFzID0gZGljdC5nZXQoIkFTIik7CiAgICBpZiAoIShhcyBpbnN0YW5jZW9mIF9wcmltaXRpdmVzLk5hbWUpIHx8ICFub3JtYWxBcHBlYXJhbmNlU3RhdGUuaGFzKGFzLm5hbWUpKSB7CiAgICAgIHJldHVybjsKICAgIH0KICAgIGNvbnN0IGFwcGVhcmFuY2UgPSBub3JtYWxBcHBlYXJhbmNlU3RhdGUuZ2V0KGFzLm5hbWUpOwogICAgaWYgKGFwcGVhcmFuY2UgaW5zdGFuY2VvZiBfYmFzZV9zdHJlYW0uQmFzZVN0cmVhbSkgewogICAgICB0aGlzLmFwcGVhcmFuY2UgPSBhcHBlYXJhbmNlOwogICAgfQogIH0KICBzZXRPcHRpb25hbENvbnRlbnQoZGljdCkgewogICAgdGhpcy5vYyA9IG51bGw7CiAgICBjb25zdCBvYyA9IGRpY3QuZ2V0KCJPQyIpOwogICAgaWYgKG9jIGluc3RhbmNlb2YgX3ByaW1pdGl2ZXMuTmFtZSkgewogICAgICAoMCwgX3V0aWwud2FybikoInNldE9wdGlvbmFsQ29udGVudDogU3VwcG9ydCBmb3IgL05hbWUtZW50cnkgaXMgbm90IGltcGxlbWVudGVkLiIpOwogICAgfSBlbHNlIGlmIChvYyBpbnN0YW5jZW9mIF9wcmltaXRpdmVzLkRpY3QpIHsKICAgICAgdGhpcy5vYyA9IG9jOwogICAgfQogIH0KICBsb2FkUmVzb3VyY2VzKGtleXMsIGFwcGVhcmFuY2UpIHsKICAgIHJldHVybiBhcHBlYXJhbmNlLmRpY3QuZ2V0QXN5bmMoIlJlc291cmNlcyIpLnRoZW4ocmVzb3VyY2VzID0+IHsKICAgICAgaWYgKCFyZXNvdXJjZXMpIHsKICAgICAgICByZXR1cm4gdW5kZWZpbmVkOwogICAgICB9CiAgICAgIGNvbnN0IG9iamVjdExvYWRlciA9IG5ldyBfb2JqZWN0X2xvYWRlci5PYmplY3RMb2FkZXIocmVzb3VyY2VzLCBrZXlzLCByZXNvdXJjZXMueHJlZik7CiAgICAgIHJldHVybiBvYmplY3RMb2FkZXIubG9hZCgpLnRoZW4oZnVuY3Rpb24gKCkgewogICAgICAgIHJldHVybiByZXNvdXJjZXM7CiAgICAgIH0pOwogICAgfSk7CiAgfQogIGFzeW5jIGdldE9wZXJhdG9yTGlzdChldmFsdWF0b3IsIHRhc2ssIGludGVudCwgcmVuZGVyRm9ybXMsIGFubm90YXRpb25TdG9yYWdlKSB7CiAgICBjb25zdCBkYXRhID0gdGhpcy5kYXRhOwogICAgbGV0IGFwcGVhcmFuY2UgPSB0aGlzLmFwcGVhcmFuY2U7CiAgICBjb25zdCBpc1VzaW5nT3duQ2FudmFzID0gISEodGhpcy5kYXRhLmhhc093bkNhbnZhcyAmJiBpbnRlbnQgJiBfdXRpbC5SZW5kZXJpbmdJbnRlbnRGbGFnLkRJU1BMQVkpOwogICAgaWYgKCFhcHBlYXJhbmNlKSB7CiAgICAgIGlmICghaXNVc2luZ093bkNhbnZhcykgewogICAgICAgIHJldHVybiB7CiAgICAgICAgICBvcExpc3Q6IG5ldyBfb3BlcmF0b3JfbGlzdC5PcGVyYXRvckxpc3QoKSwKICAgICAgICAgIHNlcGFyYXRlRm9ybTogZmFsc2UsCiAgICAgICAgICBzZXBhcmF0ZUNhbnZhczogZmFsc2UKICAgICAgICB9OwogICAgICB9CiAgICAgIGFwcGVhcmFuY2UgPSBuZXcgX3N0cmVhbS5TdHJpbmdTdHJlYW0oIiIpOwogICAgICBhcHBlYXJhbmNlLmRpY3QgPSBuZXcgX3ByaW1pdGl2ZXMuRGljdCgpOwogICAgfQogICAgY29uc3QgYXBwZWFyYW5jZURpY3QgPSBhcHBlYXJhbmNlLmRpY3Q7CiAgICBjb25zdCByZXNvdXJjZXMgPSBhd2FpdCB0aGlzLmxvYWRSZXNvdXJjZXMoWyJFeHRHU3RhdGUiLCAiQ29sb3JTcGFjZSIsICJQYXR0ZXJuIiwgIlNoYWRpbmciLCAiWE9iamVjdCIsICJGb250Il0sIGFwcGVhcmFuY2UpOwogICAgY29uc3QgYmJveCA9IGFwcGVhcmFuY2VEaWN0LmdldEFycmF5KCJCQm94IikgfHwgWzAsIDAsIDEsIDFdOwogICAgY29uc3QgbWF0cml4ID0gYXBwZWFyYW5jZURpY3QuZ2V0QXJyYXkoIk1hdHJpeCIpIHx8IFsxLCAwLCAwLCAxLCAwLCAwXTsKICAgIGNvbnN0IHRyYW5zZm9ybSA9IGdldFRyYW5zZm9ybU1hdHJpeChkYXRhLnJlY3QsIGJib3gsIG1hdHJpeCk7CiAgICBjb25zdCBvcExpc3QgPSBuZXcgX29wZXJhdG9yX2xpc3QuT3BlcmF0b3JMaXN0KCk7CiAgICBsZXQgb3B0aW9uYWxDb250ZW50OwogICAgaWYgKHRoaXMub2MpIHsKICAgICAgb3B0aW9uYWxDb250ZW50ID0gYXdhaXQgZXZhbHVhdG9yLnBhcnNlTWFya2VkQ29udGVudFByb3BzKHRoaXMub2MsIG51bGwpOwogICAgfQogICAgaWYgKG9wdGlvbmFsQ29udGVudCAhPT0gdW5kZWZpbmVkKSB7CiAgICAgIG9wTGlzdC5hZGRPcChfdXRpbC5PUFMuYmVnaW5NYXJrZWRDb250ZW50UHJvcHMsIFsiT0MiLCBvcHRpb25hbENvbnRlbnRdKTsKICAgIH0KICAgIG9wTGlzdC5hZGRPcChfdXRpbC5PUFMuYmVnaW5Bbm5vdGF0aW9uLCBbZGF0YS5pZCwgZGF0YS5yZWN0LCB0cmFuc2Zvcm0sIG1hdHJpeCwgaXNVc2luZ093bkNhbnZhc10pOwogICAgYXdhaXQgZXZhbHVhdG9yLmdldE9wZXJhdG9yTGlzdCh7CiAgICAgIHN0cmVhbTogYXBwZWFyYW5jZSwKICAgICAgdGFzaywKICAgICAgcmVzb3VyY2VzLAogICAgICBvcGVyYXRvckxpc3Q6IG9wTGlzdCwKICAgICAgZmFsbGJhY2tGb250RGljdDogdGhpcy5fZmFsbGJhY2tGb250RGljdAogICAgfSk7CiAgICBvcExpc3QuYWRkT3AoX3V0aWwuT1BTLmVuZEFubm90YXRpb24sIFtdKTsKICAgIGlmIChvcHRpb25hbENvbnRlbnQgIT09IHVuZGVmaW5lZCkgewogICAgICBvcExpc3QuYWRkT3AoX3V0aWwuT1BTLmVuZE1hcmtlZENvbnRlbnQsIFtdKTsKICAgIH0KICAgIHRoaXMucmVzZXQoKTsKICAgIHJldHVybiB7CiAgICAgIG9wTGlzdCwKICAgICAgc2VwYXJhdGVGb3JtOiBmYWxzZSwKICAgICAgc2VwYXJhdGVDYW52YXM6IGlzVXNpbmdPd25DYW52YXMKICAgIH07CiAgfQogIGFzeW5jIHNhdmUoZXZhbHVhdG9yLCB0YXNrLCBhbm5vdGF0aW9uU3RvcmFnZSkgewogICAgcmV0dXJuIG51bGw7CiAgfQogIGdldCBoYXNUZXh0Q29udGVudCgpIHsKICAgIHJldHVybiBmYWxzZTsKICB9CiAgYXN5bmMgZXh0cmFjdFRleHRDb250ZW50KGV2YWx1YXRvciwgdGFzaywgdmlld0JveCkgewogICAgaWYgKCF0aGlzLmFwcGVhcmFuY2UpIHsKICAgICAgcmV0dXJuOwogICAgfQogICAgY29uc3QgcmVzb3VyY2VzID0gYXdhaXQgdGhpcy5sb2FkUmVzb3VyY2VzKFsiRXh0R1N0YXRlIiwgIkZvbnQiLCAiUHJvcGVydGllcyIsICJYT2JqZWN0Il0sIHRoaXMuYXBwZWFyYW5jZSk7CiAgICBjb25zdCB0ZXh0ID0gW107CiAgICBjb25zdCBidWZmZXIgPSBbXTsKICAgIGxldCBmaXJzdFBvc2l0aW9uID0gbnVsbDsKICAgIGNvbnN0IHNpbmsgPSB7CiAgICAgIGRlc2lyZWRTaXplOiBNYXRoLkluZmluaXR5LAogICAgICByZWFkeTogdHJ1ZSwKICAgICAgZW5xdWV1ZShjaHVuaywgc2l6ZSkgewogICAgICAgIGZvciAoY29uc3QgaXRlbSBvZiBjaHVuay5pdGVtcykgewogICAgICAgICAgaWYgKGl0ZW0uc3RyID09PSB1bmRlZmluZWQpIHsKICAgICAgICAgICAgY29udGludWU7CiAgICAgICAgICB9CiAgICAgICAgICBmaXJzdFBvc2l0aW9uIHx8PSBpdGVtLnRyYW5zZm9ybS5zbGljZSgtMik7CiAgICAgICAgICBidWZmZXIucHVzaChpdGVtLnN0cik7CiAgICAgICAgICBpZiAoaXRlbS5oYXNFT0wpIHsKICAgICAgICAgICAgdGV4dC5wdXNoKGJ1ZmZlci5qb2luKCIiKSk7CiAgICAgICAgICAgIGJ1ZmZlci5sZW5ndGggPSAwOwogICAgICAgICAgfQogICAgICAgIH0KICAgICAgfQogICAgfTsKICAgIGF3YWl0IGV2YWx1YXRvci5nZXRUZXh0Q29udGVudCh7CiAgICAgIHN0cmVhbTogdGhpcy5hcHBlYXJhbmNlLAogICAgICB0YXNrLAogICAgICByZXNvdXJjZXMsCiAgICAgIGluY2x1ZGVNYXJrZWRDb250ZW50OiB0cnVlLAogICAgICBzaW5rLAogICAgICB2aWV3Qm94CiAgICB9KTsKICAgIHRoaXMucmVzZXQoKTsKICAgIGlmIChidWZmZXIubGVuZ3RoKSB7CiAgICAgIHRleHQucHVzaChidWZmZXIuam9pbigiIikpOwogICAgfQogICAgaWYgKHRleHQubGVuZ3RoID4gMSB8fCB0ZXh0WzBdKSB7CiAgICAgIGNvbnN0IGFwcGVhcmFuY2VEaWN0ID0gdGhpcy5hcHBlYXJhbmNlLmRpY3Q7CiAgICAgIGNvbnN0IGJib3ggPSBhcHBlYXJhbmNlRGljdC5nZXRBcnJheSgiQkJveCIpIHx8IFswLCAwLCAxLCAxXTsKICAgICAgY29uc3QgbWF0cml4ID0gYXBwZWFyYW5jZURpY3QuZ2V0QXJyYXkoIk1hdHJpeCIpIHx8IFsxLCAwLCAwLCAxLCAwLCAwXTsKICAgICAgY29uc3QgcmVjdCA9IHRoaXMuZGF0YS5yZWN0OwogICAgICBjb25zdCB0cmFuc2Zvcm0gPSBnZXRUcmFuc2Zvcm1NYXRyaXgocmVjdCwgYmJveCwgbWF0cml4KTsKICAgICAgdHJhbnNmb3JtWzRdIC09IHJlY3RbMF07CiAgICAgIHRyYW5zZm9ybVs1XSAtPSByZWN0WzFdOwogICAgICBmaXJzdFBvc2l0aW9uID0gX3V0aWwuVXRpbC5hcHBseVRyYW5zZm9ybShmaXJzdFBvc2l0aW9uLCB0cmFuc2Zvcm0pOwogICAgICBmaXJzdFBvc2l0aW9uID0gX3V0aWwuVXRpbC5hcHBseVRyYW5zZm9ybShmaXJzdFBvc2l0aW9uLCBtYXRyaXgpOwogICAgICB0aGlzLmRhdGEudGV4dFBvc2l0aW9uID0gZmlyc3RQb3NpdGlvbjsKICAgICAgdGhpcy5kYXRhLnRleHRDb250ZW50ID0gdGV4dDsKICAgIH0KICB9CiAgZ2V0RmllbGRPYmplY3QoKSB7CiAgICBpZiAodGhpcy5kYXRhLmtpZElkcykgewogICAgICByZXR1cm4gewogICAgICAgIGlkOiB0aGlzLmRhdGEuaWQsCiAgICAgICAgYWN0aW9uczogdGhpcy5kYXRhLmFjdGlvbnMsCiAgICAgICAgbmFtZTogdGhpcy5kYXRhLmZpZWxkTmFtZSwKICAgICAgICBzdHJva2VDb2xvcjogdGhpcy5kYXRhLmJvcmRlckNvbG9yLAogICAgICAgIGZpbGxDb2xvcjogdGhpcy5kYXRhLmJhY2tncm91bmRDb2xvciwKICAgICAgICB0eXBlOiAiIiwKICAgICAgICBraWRJZHM6IHRoaXMuZGF0YS5raWRJZHMsCiAgICAgICAgcGFnZTogdGhpcy5kYXRhLnBhZ2VJbmRleCwKICAgICAgICByb3RhdGlvbjogdGhpcy5yb3RhdGlvbgogICAgICB9OwogICAgfQogICAgcmV0dXJuIG51bGw7CiAgfQogIHJlc2V0KCkgewogICAgZm9yIChjb25zdCBzdHJlYW0gb2YgdGhpcy5fc3RyZWFtcykgewogICAgICBzdHJlYW0ucmVzZXQoKTsKICAgIH0KICB9CiAgX2NvbnN0cnVjdEZpZWxkTmFtZShkaWN0KSB7CiAgICBpZiAoIWRpY3QuaGFzKCJUIikgJiYgIWRpY3QuaGFzKCJQYXJlbnQiKSkgewogICAgICAoMCwgX3V0aWwud2FybikoIlVua25vd24gZmllbGQgbmFtZSwgZmFsbGluZyBiYWNrIHRvIGVtcHR5IGZpZWxkIG5hbWUuIik7CiAgICAgIHJldHVybiAiIjsKICAgIH0KICAgIGlmICghZGljdC5oYXMoIlBhcmVudCIpKSB7CiAgICAgIHJldHVybiAoMCwgX3V0aWwuc3RyaW5nVG9QREZTdHJpbmcpKGRpY3QuZ2V0KCJUIikpOwogICAgfQogICAgY29uc3QgZmllbGROYW1lID0gW107CiAgICBpZiAoZGljdC5oYXMoIlQiKSkgewogICAgICBmaWVsZE5hbWUudW5zaGlmdCgoMCwgX3V0aWwuc3RyaW5nVG9QREZTdHJpbmcpKGRpY3QuZ2V0KCJUIikpKTsKICAgIH0KICAgIGxldCBsb29wRGljdCA9IGRpY3Q7CiAgICBjb25zdCB2aXNpdGVkID0gbmV3IF9wcmltaXRpdmVzLlJlZlNldCgpOwogICAgaWYgKGRpY3Qub2JqSWQpIHsKICAgICAgdmlzaXRlZC5wdXQoZGljdC5vYmpJZCk7CiAgICB9CiAgICB3aGlsZSAobG9vcERpY3QuaGFzKCJQYXJlbnQiKSkgewogICAgICBsb29wRGljdCA9IGxvb3BEaWN0LmdldCgiUGFyZW50Iik7CiAgICAgIGlmICghKGxvb3BEaWN0IGluc3RhbmNlb2YgX3ByaW1pdGl2ZXMuRGljdCkgfHwgbG9vcERpY3Qub2JqSWQgJiYgdmlzaXRlZC5oYXMobG9vcERpY3Qub2JqSWQpKSB7CiAgICAgICAgYnJlYWs7CiAgICAgIH0KICAgICAgaWYgKGxvb3BEaWN0Lm9iaklkKSB7CiAgICAgICAgdmlzaXRlZC5wdXQobG9vcERpY3Qub2JqSWQpOwogICAgICB9CiAgICAgIGlmIChsb29wRGljdC5oYXMoIlQiKSkgewogICAgICAgIGZpZWxkTmFtZS51bnNoaWZ0KCgwLCBfdXRpbC5zdHJpbmdUb1BERlN0cmluZykobG9vcERpY3QuZ2V0KCJUIikpKTsKICAgICAgfQogICAgfQogICAgcmV0dXJuIGZpZWxkTmFtZS5qb2luKCIuIik7CiAgfQp9CmV4cG9ydHMuQW5ub3RhdGlvbiA9IEFubm90YXRpb247CmNsYXNzIEFubm90YXRpb25Cb3JkZXJTdHlsZSB7CiAgY29uc3RydWN0b3IoKSB7CiAgICB0aGlzLndpZHRoID0gMTsKICAgIHRoaXMuc3R5bGUgPSBfdXRpbC5Bbm5vdGF0aW9uQm9yZGVyU3R5bGVUeXBlLlNPTElEOwogICAgdGhpcy5kYXNoQXJyYXkgPSBbM107CiAgICB0aGlzLmhvcml6b250YWxDb3JuZXJSYWRpdXMgPSAwOwogICAgdGhpcy52ZXJ0aWNhbENvcm5lclJhZGl1cyA9IDA7CiAgfQogIHNldFdpZHRoKHdpZHRoLCByZWN0ID0gWzAsIDAsIDAsIDBdKSB7CiAgICBpZiAod2lkdGggaW5zdGFuY2VvZiBfcHJpbWl0aXZlcy5OYW1lKSB7CiAgICAgIHRoaXMud2lkdGggPSAwOwogICAgICByZXR1cm47CiAgICB9CiAgICBpZiAodHlwZW9mIHdpZHRoID09PSAibnVtYmVyIikgewogICAgICBpZiAod2lkdGggPiAwKSB7CiAgICAgICAgY29uc3QgbWF4V2lkdGggPSAocmVjdFsyXSAtIHJlY3RbMF0pIC8gMjsKICAgICAgICBjb25zdCBtYXhIZWlnaHQgPSAocmVjdFszXSAtIHJlY3RbMV0pIC8gMjsKICAgICAgICBpZiAobWF4V2lkdGggPiAwICYmIG1heEhlaWdodCA+IDAgJiYgKHdpZHRoID4gbWF4V2lkdGggfHwgd2lkdGggPiBtYXhIZWlnaHQpKSB7CiAgICAgICAgICAoMCwgX3V0aWwud2FybikoYEFubm90YXRpb25Cb3JkZXJTdHlsZS5zZXRXaWR0aCAtIGlnbm9yaW5nIHdpZHRoOiAke3dpZHRofWApOwogICAgICAgICAgd2lkdGggPSAxOwogICAgICAgIH0KICAgICAgfQogICAgICB0aGlzLndpZHRoID0gd2lkdGg7CiAgICB9CiAgfQogIHNldFN0eWxlKHN0eWxlKSB7CiAgICBpZiAoIShzdHlsZSBpbnN0YW5jZW9mIF9wcmltaXRpdmVzLk5hbWUpKSB7CiAgICAgIHJldHVybjsKICAgIH0KICAgIHN3aXRjaCAoc3R5bGUubmFtZSkgewogICAgICBjYXNlICJTIjoKICAgICAgICB0aGlzLnN0eWxlID0gX3V0aWwuQW5ub3RhdGlvbkJvcmRlclN0eWxlVHlwZS5TT0xJRDsKICAgICAgICBicmVhazsKICAgICAgY2FzZSAiRCI6CiAgICAgICAgdGhpcy5zdHlsZSA9IF91dGlsLkFubm90YXRpb25Cb3JkZXJTdHlsZVR5cGUuREFTSEVEOwogICAgICAgIGJyZWFrOwogICAgICBjYXNlICJCIjoKICAgICAgICB0aGlzLnN0eWxlID0gX3V0aWwuQW5ub3RhdGlvbkJvcmRlclN0eWxlVHlwZS5CRVZFTEVEOwogICAgICAgIGJyZWFrOwogICAgICBjYXNlICJJIjoKICAgICAgICB0aGlzLnN0eWxlID0gX3V0aWwuQW5ub3RhdGlvbkJvcmRlclN0eWxlVHlwZS5JTlNFVDsKICAgICAgICBicmVhazsKICAgICAgY2FzZSAiVSI6CiAgICAgICAgdGhpcy5zdHlsZSA9IF91dGlsLkFubm90YXRpb25Cb3JkZXJTdHlsZVR5cGUuVU5ERVJMSU5FOwogICAgICAgIGJyZWFrOwogICAgICBkZWZhdWx0OgogICAgICAgIGJyZWFrOwogICAgfQogIH0KICBzZXREYXNoQXJyYXkoZGFzaEFycmF5LCBmb3JjZVN0eWxlID0gZmFsc2UpIHsKICAgIGlmIChBcnJheS5pc0FycmF5KGRhc2hBcnJheSkgJiYgZGFzaEFycmF5Lmxlbmd0aCA+IDApIHsKICAgICAgbGV0IGlzVmFsaWQgPSB0cnVlOwogICAgICBsZXQgYWxsWmVyb3MgPSB0cnVlOwogICAgICBmb3IgKGNvbnN0IGVsZW1lbnQgb2YgZGFzaEFycmF5KSB7CiAgICAgICAgY29uc3QgdmFsaWROdW1iZXIgPSArZWxlbWVudCA+PSAwOwogICAgICAgIGlmICghdmFsaWROdW1iZXIpIHsKICAgICAgICAgIGlzVmFsaWQgPSBmYWxzZTsKICAgICAgICAgIGJyZWFrOwogICAgICAgIH0gZWxzZSBpZiAoZWxlbWVudCA+IDApIHsKICAgICAgICAgIGFsbFplcm9zID0gZmFsc2U7CiAgICAgICAgfQogICAgICB9CiAgICAgIGlmIChpc1ZhbGlkICYmICFhbGxaZXJvcykgewogICAgICAgIHRoaXMuZGFzaEFycmF5ID0gZGFzaEFycmF5OwogICAgICAgIGlmIChmb3JjZVN0eWxlKSB7CiAgICAgICAgICB0aGlzLnNldFN0eWxlKF9wcmltaXRpdmVzLk5hbWUuZ2V0KCJEIikpOwogICAgICAgIH0KICAgICAgfSBlbHNlIHsKICAgICAgICB0aGlzLndpZHRoID0gMDsKICAgICAgfQogICAgfSBlbHNlIGlmIChkYXNoQXJyYXkpIHsKICAgICAgdGhpcy53aWR0aCA9IDA7CiAgICB9CiAgfQogIHNldEhvcml6b250YWxDb3JuZXJSYWRpdXMocmFkaXVzKSB7CiAgICBpZiAoTnVtYmVyLmlzSW50ZWdlcihyYWRpdXMpKSB7CiAgICAgIHRoaXMuaG9yaXpvbnRhbENvcm5lclJhZGl1cyA9IHJhZGl1czsKICAgIH0KICB9CiAgc2V0VmVydGljYWxDb3JuZXJSYWRpdXMocmFkaXVzKSB7CiAgICBpZiAoTnVtYmVyLmlzSW50ZWdlcihyYWRpdXMpKSB7CiAgICAgIHRoaXMudmVydGljYWxDb3JuZXJSYWRpdXMgPSByYWRpdXM7CiAgICB9CiAgfQp9CmV4cG9ydHMuQW5ub3RhdGlvbkJvcmRlclN0eWxlID0gQW5ub3RhdGlvbkJvcmRlclN0eWxlOwpjbGFzcyBNYXJrdXBBbm5vdGF0aW9uIGV4dGVuZHMgQW5ub3RhdGlvbiB7CiAgY29uc3RydWN0b3IocGFyYW1zKSB7CiAgICBzdXBlcihwYXJhbXMpOwogICAgY29uc3QgewogICAgICBkaWN0CiAgICB9ID0gcGFyYW1zOwogICAgaWYgKGRpY3QuaGFzKCJJUlQiKSkgewogICAgICBjb25zdCByYXdJUlQgPSBkaWN0LmdldFJhdygiSVJUIik7CiAgICAgIHRoaXMuZGF0YS5pblJlcGx5VG8gPSByYXdJUlQgaW5zdGFuY2VvZiBfcHJpbWl0aXZlcy5SZWYgPyByYXdJUlQudG9TdHJpbmcoKSA6IG51bGw7CiAgICAgIGNvbnN0IHJ0ID0gZGljdC5nZXQoIlJUIik7CiAgICAgIHRoaXMuZGF0YS5yZXBseVR5cGUgPSBydCBpbnN0YW5jZW9mIF9wcmltaXRpdmVzLk5hbWUgPyBydC5uYW1lIDogX3V0aWwuQW5ub3RhdGlvblJlcGx5VHlwZS5SRVBMWTsKICAgIH0KICAgIGxldCBwb3B1cFJlZiA9IG51bGw7CiAgICBpZiAodGhpcy5kYXRhLnJlcGx5VHlwZSA9PT0gX3V0aWwuQW5ub3RhdGlvblJlcGx5VHlwZS5HUk9VUCkgewogICAgICBjb25zdCBwYXJlbnQgPSBkaWN0LmdldCgiSVJUIik7CiAgICAgIHRoaXMuc2V0VGl0bGUocGFyZW50LmdldCgiVCIpKTsKICAgICAgdGhpcy5kYXRhLnRpdGxlT2JqID0gdGhpcy5fdGl0bGU7CiAgICAgIHRoaXMuc2V0Q29udGVudHMocGFyZW50LmdldCgiQ29udGVudHMiKSk7CiAgICAgIHRoaXMuZGF0YS5jb250ZW50c09iaiA9IHRoaXMuX2NvbnRlbnRzOwogICAgICBpZiAoIXBhcmVudC5oYXMoIkNyZWF0aW9uRGF0ZSIpKSB7CiAgICAgICAgdGhpcy5kYXRhLmNyZWF0aW9uRGF0ZSA9IG51bGw7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgdGhpcy5zZXRDcmVhdGlvbkRhdGUocGFyZW50LmdldCgiQ3JlYXRpb25EYXRlIikpOwogICAgICAgIHRoaXMuZGF0YS5jcmVhdGlvbkRhdGUgPSB0aGlzLmNyZWF0aW9uRGF0ZTsKICAgICAgfQogICAgICBpZiAoIXBhcmVudC5oYXMoIk0iKSkgewogICAgICAgIHRoaXMuZGF0YS5tb2RpZmljYXRpb25EYXRlID0gbnVsbDsKICAgICAgfSBlbHNlIHsKICAgICAgICB0aGlzLnNldE1vZGlmaWNhdGlvbkRhdGUocGFyZW50LmdldCgiTSIpKTsKICAgICAgICB0aGlzLmRhdGEubW9kaWZpY2F0aW9uRGF0ZSA9IHRoaXMubW9kaWZpY2F0aW9uRGF0ZTsKICAgICAgfQogICAgICBwb3B1cFJlZiA9IHBhcmVudC5nZXRSYXcoIlBvcHVwIik7CiAgICAgIGlmICghcGFyZW50LmhhcygiQyIpKSB7CiAgICAgICAgdGhpcy5kYXRhLmNvbG9yID0gbnVsbDsKICAgICAgfSBlbHNlIHsKICAgICAgICB0aGlzLnNldENvbG9yKHBhcmVudC5nZXRBcnJheSgiQyIpKTsKICAgICAgICB0aGlzLmRhdGEuY29sb3IgPSB0aGlzLmNvbG9yOwogICAgICB9CiAgICB9IGVsc2UgewogICAgICB0aGlzLmRhdGEudGl0bGVPYmogPSB0aGlzLl90aXRsZTsKICAgICAgdGhpcy5zZXRDcmVhdGlvbkRhdGUoZGljdC5nZXQoIkNyZWF0aW9uRGF0ZSIpKTsKICAgICAgdGhpcy5kYXRhLmNyZWF0aW9uRGF0ZSA9IHRoaXMuY3JlYXRpb25EYXRlOwogICAgICBwb3B1cFJlZiA9IGRpY3QuZ2V0UmF3KCJQb3B1cCIpOwogICAgICBpZiAoIWRpY3QuaGFzKCJDIikpIHsKICAgICAgICB0aGlzLmRhdGEuY29sb3IgPSBudWxsOwogICAgICB9CiAgICB9CiAgICB0aGlzLmRhdGEucG9wdXBSZWYgPSBwb3B1cFJlZiBpbnN0YW5jZW9mIF9wcmltaXRpdmVzLlJlZiA/IHBvcHVwUmVmLnRvU3RyaW5nKCkgOiBudWxsOwogICAgaWYgKGRpY3QuaGFzKCJSQyIpKSB7CiAgICAgIHRoaXMuZGF0YS5yaWNoVGV4dCA9IF9mYWN0b3J5LlhGQUZhY3RvcnkuZ2V0UmljaFRleHRBc0h0bWwoZGljdC5nZXQoIlJDIikpOwogICAgfQogIH0KICBzZXRDcmVhdGlvbkRhdGUoY3JlYXRpb25EYXRlKSB7CiAgICB0aGlzLmNyZWF0aW9uRGF0ZSA9IHR5cGVvZiBjcmVhdGlvbkRhdGUgPT09ICJzdHJpbmciID8gY3JlYXRpb25EYXRlIDogbnVsbDsKICB9CiAgX3NldERlZmF1bHRBcHBlYXJhbmNlKHsKICAgIHhyZWYsCiAgICBleHRyYSwKICAgIHN0cm9rZUNvbG9yLAogICAgZmlsbENvbG9yLAogICAgYmxlbmRNb2RlLAogICAgc3Ryb2tlQWxwaGEsCiAgICBmaWxsQWxwaGEsCiAgICBwb2ludHNDYWxsYmFjawogIH0pIHsKICAgIGxldCBtaW5YID0gTnVtYmVyLk1BWF9WQUxVRTsKICAgIGxldCBtaW5ZID0gTnVtYmVyLk1BWF9WQUxVRTsKICAgIGxldCBtYXhYID0gTnVtYmVyLk1JTl9WQUxVRTsKICAgIGxldCBtYXhZID0gTnVtYmVyLk1JTl9WQUxVRTsKICAgIGNvbnN0IGJ1ZmZlciA9IFsicSJdOwogICAgaWYgKGV4dHJhKSB7CiAgICAgIGJ1ZmZlci5wdXNoKGV4dHJhKTsKICAgIH0KICAgIGlmIChzdHJva2VDb2xvcikgewogICAgICBidWZmZXIucHVzaChgJHtzdHJva2VDb2xvclswXX0gJHtzdHJva2VDb2xvclsxXX0gJHtzdHJva2VDb2xvclsyXX0gUkdgKTsKICAgIH0KICAgIGlmIChmaWxsQ29sb3IpIHsKICAgICAgYnVmZmVyLnB1c2goYCR7ZmlsbENvbG9yWzBdfSAke2ZpbGxDb2xvclsxXX0gJHtmaWxsQ29sb3JbMl19IHJnYCk7CiAgICB9CiAgICBsZXQgcG9pbnRzQXJyYXkgPSB0aGlzLmRhdGEucXVhZFBvaW50czsKICAgIGlmICghcG9pbnRzQXJyYXkpIHsKICAgICAgcG9pbnRzQXJyYXkgPSBbW3sKICAgICAgICB4OiB0aGlzLnJlY3RhbmdsZVswXSwKICAgICAgICB5OiB0aGlzLnJlY3RhbmdsZVszXQogICAgICB9LCB7CiAgICAgICAgeDogdGhpcy5yZWN0YW5nbGVbMl0sCiAgICAgICAgeTogdGhpcy5yZWN0YW5nbGVbM10KICAgICAgfSwgewogICAgICAgIHg6IHRoaXMucmVjdGFuZ2xlWzBdLAogICAgICAgIHk6IHRoaXMucmVjdGFuZ2xlWzFdCiAgICAgIH0sIHsKICAgICAgICB4OiB0aGlzLnJlY3RhbmdsZVsyXSwKICAgICAgICB5OiB0aGlzLnJlY3RhbmdsZVsxXQogICAgICB9XV07CiAgICB9CiAgICBmb3IgKGNvbnN0IHBvaW50cyBvZiBwb2ludHNBcnJheSkgewogICAgICBjb25zdCBbbVgsIE1YLCBtWSwgTVldID0gcG9pbnRzQ2FsbGJhY2soYnVmZmVyLCBwb2ludHMpOwogICAgICBtaW5YID0gTWF0aC5taW4obWluWCwgbVgpOwogICAgICBtYXhYID0gTWF0aC5tYXgobWF4WCwgTVgpOwogICAgICBtaW5ZID0gTWF0aC5taW4obWluWSwgbVkpOwogICAgICBtYXhZID0gTWF0aC5tYXgobWF4WSwgTVkpOwogICAgfQogICAgYnVmZmVyLnB1c2goIlEiKTsKICAgIGNvbnN0IGZvcm1EaWN0ID0gbmV3IF9wcmltaXRpdmVzLkRpY3QoeHJlZik7CiAgICBjb25zdCBhcHBlYXJhbmNlU3RyZWFtRGljdCA9IG5ldyBfcHJpbWl0aXZlcy5EaWN0KHhyZWYpOwogICAgYXBwZWFyYW5jZVN0cmVhbURpY3Quc2V0KCJTdWJ0eXBlIiwgX3ByaW1pdGl2ZXMuTmFtZS5nZXQoIkZvcm0iKSk7CiAgICBjb25zdCBhcHBlYXJhbmNlU3RyZWFtID0gbmV3IF9zdHJlYW0uU3RyaW5nU3RyZWFtKGJ1ZmZlci5qb2luKCIgIikpOwogICAgYXBwZWFyYW5jZVN0cmVhbS5kaWN0ID0gYXBwZWFyYW5jZVN0cmVhbURpY3Q7CiAgICBmb3JtRGljdC5zZXQoIkZtMCIsIGFwcGVhcmFuY2VTdHJlYW0pOwogICAgY29uc3QgZ3NEaWN0ID0gbmV3IF9wcmltaXRpdmVzLkRpY3QoeHJlZik7CiAgICBpZiAoYmxlbmRNb2RlKSB7CiAgICAgIGdzRGljdC5zZXQoIkJNIiwgX3ByaW1pdGl2ZXMuTmFtZS5nZXQoYmxlbmRNb2RlKSk7CiAgICB9CiAgICBpZiAodHlwZW9mIHN0cm9rZUFscGhhID09PSAibnVtYmVyIikgewogICAgICBnc0RpY3Quc2V0KCJDQSIsIHN0cm9rZUFscGhhKTsKICAgIH0KICAgIGlmICh0eXBlb2YgZmlsbEFscGhhID09PSAibnVtYmVyIikgewogICAgICBnc0RpY3Quc2V0KCJjYSIsIGZpbGxBbHBoYSk7CiAgICB9CiAgICBjb25zdCBzdGF0ZURpY3QgPSBuZXcgX3ByaW1pdGl2ZXMuRGljdCh4cmVmKTsKICAgIHN0YXRlRGljdC5zZXQoIkdTMCIsIGdzRGljdCk7CiAgICBjb25zdCByZXNvdXJjZXMgPSBuZXcgX3ByaW1pdGl2ZXMuRGljdCh4cmVmKTsKICAgIHJlc291cmNlcy5zZXQoIkV4dEdTdGF0ZSIsIHN0YXRlRGljdCk7CiAgICByZXNvdXJjZXMuc2V0KCJYT2JqZWN0IiwgZm9ybURpY3QpOwogICAgY29uc3QgYXBwZWFyYW5jZURpY3QgPSBuZXcgX3ByaW1pdGl2ZXMuRGljdCh4cmVmKTsKICAgIGFwcGVhcmFuY2VEaWN0LnNldCgiUmVzb3VyY2VzIiwgcmVzb3VyY2VzKTsKICAgIGNvbnN0IGJib3ggPSB0aGlzLmRhdGEucmVjdCA9IFttaW5YLCBtaW5ZLCBtYXhYLCBtYXhZXTsKICAgIGFwcGVhcmFuY2VEaWN0LnNldCgiQkJveCIsIGJib3gpOwogICAgdGhpcy5hcHBlYXJhbmNlID0gbmV3IF9zdHJlYW0uU3RyaW5nU3RyZWFtKCIvR1MwIGdzIC9GbTAgRG8iKTsKICAgIHRoaXMuYXBwZWFyYW5jZS5kaWN0ID0gYXBwZWFyYW5jZURpY3Q7CiAgICB0aGlzLl9zdHJlYW1zLnB1c2godGhpcy5hcHBlYXJhbmNlLCBhcHBlYXJhbmNlU3RyZWFtKTsKICB9CiAgc3RhdGljIGFzeW5jIGNyZWF0ZU5ld0Fubm90YXRpb24oeHJlZiwgYW5ub3RhdGlvbiwgZGVwZW5kZW5jaWVzLCBwYXJhbXMpIHsKICAgIGNvbnN0IGFubm90YXRpb25SZWYgPSBhbm5vdGF0aW9uLnJlZiB8fD0geHJlZi5nZXROZXdUZW1wb3JhcnlSZWYoKTsKICAgIGNvbnN0IGFwID0gYXdhaXQgdGhpcy5jcmVhdGVOZXdBcHBlYXJhbmNlU3RyZWFtKGFubm90YXRpb24sIHhyZWYsIHBhcmFtcyk7CiAgICBjb25zdCBidWZmZXIgPSBbXTsKICAgIGxldCBhbm5vdGF0aW9uRGljdDsKICAgIGlmIChhcCkgewogICAgICBjb25zdCBhcFJlZiA9IHhyZWYuZ2V0TmV3VGVtcG9yYXJ5UmVmKCk7CiAgICAgIGFubm90YXRpb25EaWN0ID0gdGhpcy5jcmVhdGVOZXdEaWN0KGFubm90YXRpb24sIHhyZWYsIHsKICAgICAgICBhcFJlZgogICAgICB9KTsKICAgICAgYXdhaXQgKDAsIF93cml0ZXIud3JpdGVPYmplY3QpKGFwUmVmLCBhcCwgYnVmZmVyLCB4cmVmKTsKICAgICAgZGVwZW5kZW5jaWVzLnB1c2goewogICAgICAgIHJlZjogYXBSZWYsCiAgICAgICAgZGF0YTogYnVmZmVyLmpvaW4oIiIpCiAgICAgIH0pOwogICAgfSBlbHNlIHsKICAgICAgYW5ub3RhdGlvbkRpY3QgPSB0aGlzLmNyZWF0ZU5ld0RpY3QoYW5ub3RhdGlvbiwgeHJlZiwge30pOwogICAgfQogICAgaWYgKE51bWJlci5pc0ludGVnZXIoYW5ub3RhdGlvbi5wYXJlbnRUcmVlSWQpKSB7CiAgICAgIGFubm90YXRpb25EaWN0LnNldCgiU3RydWN0UGFyZW50IiwgYW5ub3RhdGlvbi5wYXJlbnRUcmVlSWQpOwogICAgfQogICAgYnVmZmVyLmxlbmd0aCA9IDA7CiAgICBhd2FpdCAoMCwgX3dyaXRlci53cml0ZU9iamVjdCkoYW5ub3RhdGlvblJlZiwgYW5ub3RhdGlvbkRpY3QsIGJ1ZmZlciwgeHJlZik7CiAgICByZXR1cm4gewogICAgICByZWY6IGFubm90YXRpb25SZWYsCiAgICAgIGRhdGE6IGJ1ZmZlci5qb2luKCIiKQogICAgfTsKICB9CiAgc3RhdGljIGFzeW5jIGNyZWF0ZU5ld1ByaW50QW5ub3RhdGlvbihhbm5vdGF0aW9uR2xvYmFscywgeHJlZiwgYW5ub3RhdGlvbiwgcGFyYW1zKSB7CiAgICBjb25zdCBhcCA9IGF3YWl0IHRoaXMuY3JlYXRlTmV3QXBwZWFyYW5jZVN0cmVhbShhbm5vdGF0aW9uLCB4cmVmLCBwYXJhbXMpOwogICAgY29uc3QgYW5ub3RhdGlvbkRpY3QgPSB0aGlzLmNyZWF0ZU5ld0RpY3QoYW5ub3RhdGlvbiwgeHJlZiwgewogICAgICBhcAogICAgfSk7CiAgICBjb25zdCBuZXdBbm5vdGF0aW9uID0gbmV3IHRoaXMucHJvdG90eXBlLmNvbnN0cnVjdG9yKHsKICAgICAgZGljdDogYW5ub3RhdGlvbkRpY3QsCiAgICAgIHhyZWYsCiAgICAgIGFubm90YXRpb25HbG9iYWxzLAogICAgICBldmFsdWF0b3JPcHRpb25zOiBwYXJhbXMuZXZhbHVhdG9yT3B0aW9ucwogICAgfSk7CiAgICBpZiAoYW5ub3RhdGlvbi5yZWYpIHsKICAgICAgbmV3QW5ub3RhdGlvbi5yZWYgPSBuZXdBbm5vdGF0aW9uLnJlZlRvUmVwbGFjZSA9IGFubm90YXRpb24ucmVmOwogICAgfQogICAgcmV0dXJuIG5ld0Fubm90YXRpb247CiAgfQp9CmV4cG9ydHMuTWFya3VwQW5ub3RhdGlvbiA9IE1hcmt1cEFubm90YXRpb247CmNsYXNzIFdpZGdldEFubm90YXRpb24gZXh0ZW5kcyBBbm5vdGF0aW9uIHsKICBjb25zdHJ1Y3RvcihwYXJhbXMpIHsKICAgIHN1cGVyKHBhcmFtcyk7CiAgICBjb25zdCB7CiAgICAgIGRpY3QsCiAgICAgIHhyZWYsCiAgICAgIGFubm90YXRpb25HbG9iYWxzCiAgICB9ID0gcGFyYW1zOwogICAgY29uc3QgZGF0YSA9IHRoaXMuZGF0YTsKICAgIHRoaXMuX25lZWRBcHBlYXJhbmNlcyA9IHBhcmFtcy5uZWVkQXBwZWFyYW5jZXM7CiAgICBkYXRhLmFubm90YXRpb25UeXBlID0gX3V0aWwuQW5ub3RhdGlvblR5cGUuV0lER0VUOwogICAgaWYgKGRhdGEuZmllbGROYW1lID09PSB1bmRlZmluZWQpIHsKICAgICAgZGF0YS5maWVsZE5hbWUgPSB0aGlzLl9jb25zdHJ1Y3RGaWVsZE5hbWUoZGljdCk7CiAgICB9CiAgICBpZiAoZGF0YS5hY3Rpb25zID09PSB1bmRlZmluZWQpIHsKICAgICAgZGF0YS5hY3Rpb25zID0gKDAsIF9jb3JlX3V0aWxzLmNvbGxlY3RBY3Rpb25zKSh4cmVmLCBkaWN0LCBfdXRpbC5Bbm5vdGF0aW9uQWN0aW9uRXZlbnRUeXBlKTsKICAgIH0KICAgIGxldCBmaWVsZFZhbHVlID0gKDAsIF9jb3JlX3V0aWxzLmdldEluaGVyaXRhYmxlUHJvcGVydHkpKHsKICAgICAgZGljdCwKICAgICAga2V5OiAiViIsCiAgICAgIGdldEFycmF5OiB0cnVlCiAgICB9KTsKICAgIGRhdGEuZmllbGRWYWx1ZSA9IHRoaXMuX2RlY29kZUZvcm1WYWx1ZShmaWVsZFZhbHVlKTsKICAgIGNvbnN0IGRlZmF1bHRGaWVsZFZhbHVlID0gKDAsIF9jb3JlX3V0aWxzLmdldEluaGVyaXRhYmxlUHJvcGVydHkpKHsKICAgICAgZGljdCwKICAgICAga2V5OiAiRFYiLAogICAgICBnZXRBcnJheTogdHJ1ZQogICAgfSk7CiAgICBkYXRhLmRlZmF1bHRGaWVsZFZhbHVlID0gdGhpcy5fZGVjb2RlRm9ybVZhbHVlKGRlZmF1bHRGaWVsZFZhbHVlKTsKICAgIGlmIChmaWVsZFZhbHVlID09PSB1bmRlZmluZWQgJiYgYW5ub3RhdGlvbkdsb2JhbHMueGZhRGF0YXNldHMpIHsKICAgICAgY29uc3QgcGF0aCA9IHRoaXMuX3RpdGxlLnN0cjsKICAgICAgaWYgKHBhdGgpIHsKICAgICAgICB0aGlzLl9oYXNWYWx1ZUZyb21YRkEgPSB0cnVlOwogICAgICAgIGRhdGEuZmllbGRWYWx1ZSA9IGZpZWxkVmFsdWUgPSBhbm5vdGF0aW9uR2xvYmFscy54ZmFEYXRhc2V0cy5nZXRWYWx1ZShwYXRoKTsKICAgICAgfQogICAgfQogICAgaWYgKGZpZWxkVmFsdWUgPT09IHVuZGVmaW5lZCAmJiBkYXRhLmRlZmF1bHRGaWVsZFZhbHVlICE9PSBudWxsKSB7CiAgICAgIGRhdGEuZmllbGRWYWx1ZSA9IGRhdGEuZGVmYXVsdEZpZWxkVmFsdWU7CiAgICB9CiAgICBkYXRhLmFsdGVybmF0aXZlVGV4dCA9ICgwLCBfdXRpbC5zdHJpbmdUb1BERlN0cmluZykoZGljdC5nZXQoIlRVIikgfHwgIiIpOwogICAgdGhpcy5zZXREZWZhdWx0QXBwZWFyYW5jZShwYXJhbXMpOwogICAgZGF0YS5oYXNBcHBlYXJhbmNlIHx8PSB0aGlzLl9uZWVkQXBwZWFyYW5jZXMgJiYgZGF0YS5maWVsZFZhbHVlICE9PSB1bmRlZmluZWQgJiYgZGF0YS5maWVsZFZhbHVlICE9PSBudWxsOwogICAgY29uc3QgZmllbGRUeXBlID0gKDAsIF9jb3JlX3V0aWxzLmdldEluaGVyaXRhYmxlUHJvcGVydHkpKHsKICAgICAgZGljdCwKICAgICAga2V5OiAiRlQiCiAgICB9KTsKICAgIGRhdGEuZmllbGRUeXBlID0gZmllbGRUeXBlIGluc3RhbmNlb2YgX3ByaW1pdGl2ZXMuTmFtZSA/IGZpZWxkVHlwZS5uYW1lIDogbnVsbDsKICAgIGNvbnN0IGxvY2FsUmVzb3VyY2VzID0gKDAsIF9jb3JlX3V0aWxzLmdldEluaGVyaXRhYmxlUHJvcGVydHkpKHsKICAgICAgZGljdCwKICAgICAga2V5OiAiRFIiCiAgICB9KTsKICAgIGNvbnN0IGFjcm9Gb3JtUmVzb3VyY2VzID0gYW5ub3RhdGlvbkdsb2JhbHMuYWNyb0Zvcm0uZ2V0KCJEUiIpOwogICAgY29uc3QgYXBwZWFyYW5jZVJlc291cmNlcyA9IHRoaXMuYXBwZWFyYW5jZT8uZGljdC5nZXQoIlJlc291cmNlcyIpOwogICAgdGhpcy5fZmllbGRSZXNvdXJjZXMgPSB7CiAgICAgIGxvY2FsUmVzb3VyY2VzLAogICAgICBhY3JvRm9ybVJlc291cmNlcywKICAgICAgYXBwZWFyYW5jZVJlc291cmNlcywKICAgICAgbWVyZ2VkUmVzb3VyY2VzOiBfcHJpbWl0aXZlcy5EaWN0Lm1lcmdlKHsKICAgICAgICB4cmVmLAogICAgICAgIGRpY3RBcnJheTogW2xvY2FsUmVzb3VyY2VzLCBhcHBlYXJhbmNlUmVzb3VyY2VzLCBhY3JvRm9ybVJlc291cmNlc10sCiAgICAgICAgbWVyZ2VTdWJEaWN0czogdHJ1ZQogICAgICB9KQogICAgfTsKICAgIGRhdGEuZmllbGRGbGFncyA9ICgwLCBfY29yZV91dGlscy5nZXRJbmhlcml0YWJsZVByb3BlcnR5KSh7CiAgICAgIGRpY3QsCiAgICAgIGtleTogIkZmIgogICAgfSk7CiAgICBpZiAoIU51bWJlci5pc0ludGVnZXIoZGF0YS5maWVsZEZsYWdzKSB8fCBkYXRhLmZpZWxkRmxhZ3MgPCAwKSB7CiAgICAgIGRhdGEuZmllbGRGbGFncyA9IDA7CiAgICB9CiAgICBkYXRhLnJlYWRPbmx5ID0gdGhpcy5oYXNGaWVsZEZsYWcoX3V0aWwuQW5ub3RhdGlvbkZpZWxkRmxhZy5SRUFET05MWSk7CiAgICBkYXRhLnJlcXVpcmVkID0gdGhpcy5oYXNGaWVsZEZsYWcoX3V0aWwuQW5ub3RhdGlvbkZpZWxkRmxhZy5SRVFVSVJFRCk7CiAgICBkYXRhLmhpZGRlbiA9IHRoaXMuX2hhc0ZsYWcoZGF0YS5hbm5vdGF0aW9uRmxhZ3MsIF91dGlsLkFubm90YXRpb25GbGFnLkhJRERFTikgfHwgdGhpcy5faGFzRmxhZyhkYXRhLmFubm90YXRpb25GbGFncywgX3V0aWwuQW5ub3RhdGlvbkZsYWcuTk9WSUVXKTsKICB9CiAgX2RlY29kZUZvcm1WYWx1ZShmb3JtVmFsdWUpIHsKICAgIGlmIChBcnJheS5pc0FycmF5KGZvcm1WYWx1ZSkpIHsKICAgICAgcmV0dXJuIGZvcm1WYWx1ZS5maWx0ZXIoaXRlbSA9PiB0eXBlb2YgaXRlbSA9PT0gInN0cmluZyIpLm1hcChpdGVtID0+ICgwLCBfdXRpbC5zdHJpbmdUb1BERlN0cmluZykoaXRlbSkpOwogICAgfSBlbHNlIGlmIChmb3JtVmFsdWUgaW5zdGFuY2VvZiBfcHJpbWl0aXZlcy5OYW1lKSB7CiAgICAgIHJldHVybiAoMCwgX3V0aWwuc3RyaW5nVG9QREZTdHJpbmcpKGZvcm1WYWx1ZS5uYW1lKTsKICAgIH0gZWxzZSBpZiAodHlwZW9mIGZvcm1WYWx1ZSA9PT0gInN0cmluZyIpIHsKICAgICAgcmV0dXJuICgwLCBfdXRpbC5zdHJpbmdUb1BERlN0cmluZykoZm9ybVZhbHVlKTsKICAgIH0KICAgIHJldHVybiBudWxsOwogIH0KICBoYXNGaWVsZEZsYWcoZmxhZykgewogICAgcmV0dXJuICEhKHRoaXMuZGF0YS5maWVsZEZsYWdzICYgZmxhZyk7CiAgfQogIF9pc1ZpZXdhYmxlKGZsYWdzKSB7CiAgICByZXR1cm4gIXRoaXMuX2hhc0ZsYWcoZmxhZ3MsIF91dGlsLkFubm90YXRpb25GbGFnLklOVklTSUJMRSk7CiAgfQogIG11c3RCZVZpZXdlZChhbm5vdGF0aW9uU3RvcmFnZSwgcmVuZGVyRm9ybXMpIHsKICAgIGlmIChyZW5kZXJGb3JtcykgewogICAgICByZXR1cm4gdGhpcy52aWV3YWJsZTsKICAgIH0KICAgIHJldHVybiBzdXBlci5tdXN0QmVWaWV3ZWQoYW5ub3RhdGlvblN0b3JhZ2UsIHJlbmRlckZvcm1zKSAmJiAhdGhpcy5faGFzRmxhZyh0aGlzLmZsYWdzLCBfdXRpbC5Bbm5vdGF0aW9uRmxhZy5OT1ZJRVcpOwogIH0KICBnZXRSb3RhdGlvbk1hdHJpeChhbm5vdGF0aW9uU3RvcmFnZSkgewogICAgbGV0IHJvdGF0aW9uID0gYW5ub3RhdGlvblN0b3JhZ2U/LmdldCh0aGlzLmRhdGEuaWQpPy5yb3RhdGlvbjsKICAgIGlmIChyb3RhdGlvbiA9PT0gdW5kZWZpbmVkKSB7CiAgICAgIHJvdGF0aW9uID0gdGhpcy5yb3RhdGlvbjsKICAgIH0KICAgIGlmIChyb3RhdGlvbiA9PT0gMCkgewogICAgICByZXR1cm4gX3V0aWwuSURFTlRJVFlfTUFUUklYOwogICAgfQogICAgY29uc3Qgd2lkdGggPSB0aGlzLmRhdGEucmVjdFsyXSAtIHRoaXMuZGF0YS5yZWN0WzBdOwogICAgY29uc3QgaGVpZ2h0ID0gdGhpcy5kYXRhLnJlY3RbM10gLSB0aGlzLmRhdGEucmVjdFsxXTsKICAgIHJldHVybiAoMCwgX2NvcmVfdXRpbHMuZ2V0Um90YXRpb25NYXRyaXgpKHJvdGF0aW9uLCB3aWR0aCwgaGVpZ2h0KTsKICB9CiAgZ2V0Qm9yZGVyQW5kQmFja2dyb3VuZEFwcGVhcmFuY2VzKGFubm90YXRpb25TdG9yYWdlKSB7CiAgICBsZXQgcm90YXRpb24gPSBhbm5vdGF0aW9uU3RvcmFnZT8uZ2V0KHRoaXMuZGF0YS5pZCk/LnJvdGF0aW9uOwogICAgaWYgKHJvdGF0aW9uID09PSB1bmRlZmluZWQpIHsKICAgICAgcm90YXRpb24gPSB0aGlzLnJvdGF0aW9uOwogICAgfQogICAgaWYgKCF0aGlzLmJhY2tncm91bmRDb2xvciAmJiAhdGhpcy5ib3JkZXJDb2xvcikgewogICAgICByZXR1cm4gIiI7CiAgICB9CiAgICBjb25zdCB3aWR0aCA9IHRoaXMuZGF0YS5yZWN0WzJdIC0gdGhpcy5kYXRhLnJlY3RbMF07CiAgICBjb25zdCBoZWlnaHQgPSB0aGlzLmRhdGEucmVjdFszXSAtIHRoaXMuZGF0YS5yZWN0WzFdOwogICAgY29uc3QgcmVjdCA9IHJvdGF0aW9uID09PSAwIHx8IHJvdGF0aW9uID09PSAxODAgPyBgMCAwICR7d2lkdGh9ICR7aGVpZ2h0fSByZWAgOiBgMCAwICR7aGVpZ2h0fSAke3dpZHRofSByZWA7CiAgICBsZXQgc3RyID0gIiI7CiAgICBpZiAodGhpcy5iYWNrZ3JvdW5kQ29sb3IpIHsKICAgICAgc3RyID0gYCR7KDAsIF9kZWZhdWx0X2FwcGVhcmFuY2UuZ2V0UGRmQ29sb3IpKHRoaXMuYmFja2dyb3VuZENvbG9yLCB0cnVlKX0gJHtyZWN0fSBmIGA7CiAgICB9CiAgICBpZiAodGhpcy5ib3JkZXJDb2xvcikgewogICAgICBjb25zdCBib3JkZXJXaWR0aCA9IHRoaXMuYm9yZGVyU3R5bGUud2lkdGggfHwgMTsKICAgICAgc3RyICs9IGAke2JvcmRlcldpZHRofSB3ICR7KDAsIF9kZWZhdWx0X2FwcGVhcmFuY2UuZ2V0UGRmQ29sb3IpKHRoaXMuYm9yZGVyQ29sb3IsIGZhbHNlKX0gJHtyZWN0fSBTIGA7CiAgICB9CiAgICByZXR1cm4gc3RyOwogIH0KICBhc3luYyBnZXRPcGVyYXRvckxpc3QoZXZhbHVhdG9yLCB0YXNrLCBpbnRlbnQsIHJlbmRlckZvcm1zLCBhbm5vdGF0aW9uU3RvcmFnZSkgewogICAgaWYgKHJlbmRlckZvcm1zICYmICEodGhpcyBpbnN0YW5jZW9mIFNpZ25hdHVyZVdpZGdldEFubm90YXRpb24pICYmICF0aGlzLmRhdGEubm9IVE1MICYmICF0aGlzLmRhdGEuaGFzT3duQ2FudmFzKSB7CiAgICAgIHJldHVybiB7CiAgICAgICAgb3BMaXN0OiBuZXcgX29wZXJhdG9yX2xpc3QuT3BlcmF0b3JMaXN0KCksCiAgICAgICAgc2VwYXJhdGVGb3JtOiB0cnVlLAogICAgICAgIHNlcGFyYXRlQ2FudmFzOiBmYWxzZQogICAgICB9OwogICAgfQogICAgaWYgKCF0aGlzLl9oYXNUZXh0KSB7CiAgICAgIHJldHVybiBzdXBlci5nZXRPcGVyYXRvckxpc3QoZXZhbHVhdG9yLCB0YXNrLCBpbnRlbnQsIHJlbmRlckZvcm1zLCBhbm5vdGF0aW9uU3RvcmFnZSk7CiAgICB9CiAgICBjb25zdCBjb250ZW50ID0gYXdhaXQgdGhpcy5fZ2V0QXBwZWFyYW5jZShldmFsdWF0b3IsIHRhc2ssIGludGVudCwgYW5ub3RhdGlvblN0b3JhZ2UpOwogICAgaWYgKHRoaXMuYXBwZWFyYW5jZSAmJiBjb250ZW50ID09PSBudWxsKSB7CiAgICAgIHJldHVybiBzdXBlci5nZXRPcGVyYXRvckxpc3QoZXZhbHVhdG9yLCB0YXNrLCBpbnRlbnQsIHJlbmRlckZvcm1zLCBhbm5vdGF0aW9uU3RvcmFnZSk7CiAgICB9CiAgICBjb25zdCBvcExpc3QgPSBuZXcgX29wZXJhdG9yX2xpc3QuT3BlcmF0b3JMaXN0KCk7CiAgICBpZiAoIXRoaXMuX2RlZmF1bHRBcHBlYXJhbmNlIHx8IGNvbnRlbnQgPT09IG51bGwpIHsKICAgICAgcmV0dXJuIHsKICAgICAgICBvcExpc3QsCiAgICAgICAgc2VwYXJhdGVGb3JtOiBmYWxzZSwKICAgICAgICBzZXBhcmF0ZUNhbnZhczogZmFsc2UKICAgICAgfTsKICAgIH0KICAgIGNvbnN0IGlzVXNpbmdPd25DYW52YXMgPSAhISh0aGlzLmRhdGEuaGFzT3duQ2FudmFzICYmIGludGVudCAmIF91dGlsLlJlbmRlcmluZ0ludGVudEZsYWcuRElTUExBWSk7CiAgICBjb25zdCBtYXRyaXggPSBbMSwgMCwgMCwgMSwgMCwgMF07CiAgICBjb25zdCBiYm94ID0gWzAsIDAsIHRoaXMuZGF0YS5yZWN0WzJdIC0gdGhpcy5kYXRhLnJlY3RbMF0sIHRoaXMuZGF0YS5yZWN0WzNdIC0gdGhpcy5kYXRhLnJlY3RbMV1dOwogICAgY29uc3QgdHJhbnNmb3JtID0gZ2V0VHJhbnNmb3JtTWF0cml4KHRoaXMuZGF0YS5yZWN0LCBiYm94LCBtYXRyaXgpOwogICAgbGV0IG9wdGlvbmFsQ29udGVudDsKICAgIGlmICh0aGlzLm9jKSB7CiAgICAgIG9wdGlvbmFsQ29udGVudCA9IGF3YWl0IGV2YWx1YXRvci5wYXJzZU1hcmtlZENvbnRlbnRQcm9wcyh0aGlzLm9jLCBudWxsKTsKICAgIH0KICAgIGlmIChvcHRpb25hbENvbnRlbnQgIT09IHVuZGVmaW5lZCkgewogICAgICBvcExpc3QuYWRkT3AoX3V0aWwuT1BTLmJlZ2luTWFya2VkQ29udGVudFByb3BzLCBbIk9DIiwgb3B0aW9uYWxDb250ZW50XSk7CiAgICB9CiAgICBvcExpc3QuYWRkT3AoX3V0aWwuT1BTLmJlZ2luQW5ub3RhdGlvbiwgW3RoaXMuZGF0YS5pZCwgdGhpcy5kYXRhLnJlY3QsIHRyYW5zZm9ybSwgdGhpcy5nZXRSb3RhdGlvbk1hdHJpeChhbm5vdGF0aW9uU3RvcmFnZSksIGlzVXNpbmdPd25DYW52YXNdKTsKICAgIGNvbnN0IHN0cmVhbSA9IG5ldyBfc3RyZWFtLlN0cmluZ1N0cmVhbShjb250ZW50KTsKICAgIGF3YWl0IGV2YWx1YXRvci5nZXRPcGVyYXRvckxpc3QoewogICAgICBzdHJlYW0sCiAgICAgIHRhc2ssCiAgICAgIHJlc291cmNlczogdGhpcy5fZmllbGRSZXNvdXJjZXMubWVyZ2VkUmVzb3VyY2VzLAogICAgICBvcGVyYXRvckxpc3Q6IG9wTGlzdAogICAgfSk7CiAgICBvcExpc3QuYWRkT3AoX3V0aWwuT1BTLmVuZEFubm90YXRpb24sIFtdKTsKICAgIGlmIChvcHRpb25hbENvbnRlbnQgIT09IHVuZGVmaW5lZCkgewogICAgICBvcExpc3QuYWRkT3AoX3V0aWwuT1BTLmVuZE1hcmtlZENvbnRlbnQsIFtdKTsKICAgIH0KICAgIHJldHVybiB7CiAgICAgIG9wTGlzdCwKICAgICAgc2VwYXJhdGVGb3JtOiBmYWxzZSwKICAgICAgc2VwYXJhdGVDYW52YXM6IGlzVXNpbmdPd25DYW52YXMKICAgIH07CiAgfQogIF9nZXRNS0RpY3Qocm90YXRpb24pIHsKICAgIGNvbnN0IG1rID0gbmV3IF9wcmltaXRpdmVzLkRpY3QobnVsbCk7CiAgICBpZiAocm90YXRpb24pIHsKICAgICAgbWsuc2V0KCJSIiwgcm90YXRpb24pOwogICAgfQogICAgaWYgKHRoaXMuYm9yZGVyQ29sb3IpIHsKICAgICAgbWsuc2V0KCJCQyIsIGdldFBkZkNvbG9yQXJyYXkodGhpcy5ib3JkZXJDb2xvcikpOwogICAgfQogICAgaWYgKHRoaXMuYmFja2dyb3VuZENvbG9yKSB7CiAgICAgIG1rLnNldCgiQkciLCBnZXRQZGZDb2xvckFycmF5KHRoaXMuYmFja2dyb3VuZENvbG9yKSk7CiAgICB9CiAgICByZXR1cm4gbWsuc2l6ZSA+IDAgPyBtayA6IG51bGw7CiAgfQogIGFtZW5kU2F2ZWREaWN0KGFubm90YXRpb25TdG9yYWdlLCBkaWN0KSB7fQogIGFzeW5jIHNhdmUoZXZhbHVhdG9yLCB0YXNrLCBhbm5vdGF0aW9uU3RvcmFnZSkgewogICAgY29uc3Qgc3RvcmFnZUVudHJ5ID0gYW5ub3RhdGlvblN0b3JhZ2U/LmdldCh0aGlzLmRhdGEuaWQpOwogICAgbGV0IHZhbHVlID0gc3RvcmFnZUVudHJ5Py52YWx1ZSwKICAgICAgcm90YXRpb24gPSBzdG9yYWdlRW50cnk/LnJvdGF0aW9uOwogICAgaWYgKHZhbHVlID09PSB0aGlzLmRhdGEuZmllbGRWYWx1ZSB8fCB2YWx1ZSA9PT0gdW5kZWZpbmVkKSB7CiAgICAgIGlmICghdGhpcy5faGFzVmFsdWVGcm9tWEZBICYmIHJvdGF0aW9uID09PSB1bmRlZmluZWQpIHsKICAgICAgICByZXR1cm4gbnVsbDsKICAgICAgfQogICAgICB2YWx1ZSB8fD0gdGhpcy5kYXRhLmZpZWxkVmFsdWU7CiAgICB9CiAgICBpZiAocm90YXRpb24gPT09IHVuZGVmaW5lZCAmJiAhdGhpcy5faGFzVmFsdWVGcm9tWEZBICYmIEFycmF5LmlzQXJyYXkodmFsdWUpICYmIEFycmF5LmlzQXJyYXkodGhpcy5kYXRhLmZpZWxkVmFsdWUpICYmIHZhbHVlLmxlbmd0aCA9PT0gdGhpcy5kYXRhLmZpZWxkVmFsdWUubGVuZ3RoICYmIHZhbHVlLmV2ZXJ5KCh4LCBpKSA9PiB4ID09PSB0aGlzLmRhdGEuZmllbGRWYWx1ZVtpXSkpIHsKICAgICAgcmV0dXJuIG51bGw7CiAgICB9CiAgICBpZiAocm90YXRpb24gPT09IHVuZGVmaW5lZCkgewogICAgICByb3RhdGlvbiA9IHRoaXMucm90YXRpb247CiAgICB9CiAgICBsZXQgYXBwZWFyYW5jZSA9IG51bGw7CiAgICBpZiAoIXRoaXMuX25lZWRBcHBlYXJhbmNlcykgewogICAgICBhcHBlYXJhbmNlID0gYXdhaXQgdGhpcy5fZ2V0QXBwZWFyYW5jZShldmFsdWF0b3IsIHRhc2ssIF91dGlsLlJlbmRlcmluZ0ludGVudEZsYWcuU0FWRSwgYW5ub3RhdGlvblN0b3JhZ2UpOwogICAgICBpZiAoYXBwZWFyYW5jZSA9PT0gbnVsbCkgewogICAgICAgIHJldHVybiBudWxsOwogICAgICB9CiAgICB9IGVsc2Uge30KICAgIGxldCBuZWVkQXBwZWFyYW5jZXMgPSBmYWxzZTsKICAgIGlmIChhcHBlYXJhbmNlPy5uZWVkQXBwZWFyYW5jZXMpIHsKICAgICAgbmVlZEFwcGVhcmFuY2VzID0gdHJ1ZTsKICAgICAgYXBwZWFyYW5jZSA9IG51bGw7CiAgICB9CiAgICBjb25zdCB7CiAgICAgIHhyZWYKICAgIH0gPSBldmFsdWF0b3I7CiAgICBjb25zdCBvcmlnaW5hbERpY3QgPSB4cmVmLmZldGNoSWZSZWYodGhpcy5yZWYpOwogICAgaWYgKCEob3JpZ2luYWxEaWN0IGluc3RhbmNlb2YgX3ByaW1pdGl2ZXMuRGljdCkpIHsKICAgICAgcmV0dXJuIG51bGw7CiAgICB9CiAgICBjb25zdCBkaWN0ID0gbmV3IF9wcmltaXRpdmVzLkRpY3QoeHJlZik7CiAgICBmb3IgKGNvbnN0IGtleSBvZiBvcmlnaW5hbERpY3QuZ2V0S2V5cygpKSB7CiAgICAgIGlmIChrZXkgIT09ICJBUCIpIHsKICAgICAgICBkaWN0LnNldChrZXksIG9yaWdpbmFsRGljdC5nZXRSYXcoa2V5KSk7CiAgICAgIH0KICAgIH0KICAgIGNvbnN0IHhmYSA9IHsKICAgICAgcGF0aDogdGhpcy5kYXRhLmZpZWxkTmFtZSwKICAgICAgdmFsdWUKICAgIH07CiAgICBjb25zdCBlbmNvZGVyID0gdmFsID0+IHsKICAgICAgcmV0dXJuICgwLCBfY29yZV91dGlscy5pc0FzY2lpKSh2YWwpID8gdmFsIDogKDAsIF9jb3JlX3V0aWxzLnN0cmluZ1RvVVRGMTZTdHJpbmcpKHZhbCwgdHJ1ZSk7CiAgICB9OwogICAgZGljdC5zZXQoIlYiLCBBcnJheS5pc0FycmF5KHZhbHVlKSA/IHZhbHVlLm1hcChlbmNvZGVyKSA6IGVuY29kZXIodmFsdWUpKTsKICAgIHRoaXMuYW1lbmRTYXZlZERpY3QoYW5ub3RhdGlvblN0b3JhZ2UsIGRpY3QpOwogICAgY29uc3QgbWF5YmVNSyA9IHRoaXMuX2dldE1LRGljdChyb3RhdGlvbik7CiAgICBpZiAobWF5YmVNSykgewogICAgICBkaWN0LnNldCgiTUsiLCBtYXliZU1LKTsKICAgIH0KICAgIGNvbnN0IGJ1ZmZlciA9IFtdOwogICAgY29uc3QgY2hhbmdlcyA9IFt7CiAgICAgIHJlZjogdGhpcy5yZWYsCiAgICAgIGRhdGE6ICIiLAogICAgICB4ZmEsCiAgICAgIG5lZWRBcHBlYXJhbmNlcwogICAgfV07CiAgICBpZiAoYXBwZWFyYW5jZSAhPT0gbnVsbCkgewogICAgICBjb25zdCBuZXdSZWYgPSB4cmVmLmdldE5ld1RlbXBvcmFyeVJlZigpOwogICAgICBjb25zdCBBUCA9IG5ldyBfcHJpbWl0aXZlcy5EaWN0KHhyZWYpOwogICAgICBkaWN0LnNldCgiQVAiLCBBUCk7CiAgICAgIEFQLnNldCgiTiIsIG5ld1JlZik7CiAgICAgIGNvbnN0IHJlc291cmNlcyA9IHRoaXMuX2dldFNhdmVGaWVsZFJlc291cmNlcyh4cmVmKTsKICAgICAgY29uc3QgYXBwZWFyYW5jZVN0cmVhbSA9IG5ldyBfc3RyZWFtLlN0cmluZ1N0cmVhbShhcHBlYXJhbmNlKTsKICAgICAgY29uc3QgYXBwZWFyYW5jZURpY3QgPSBhcHBlYXJhbmNlU3RyZWFtLmRpY3QgPSBuZXcgX3ByaW1pdGl2ZXMuRGljdCh4cmVmKTsKICAgICAgYXBwZWFyYW5jZURpY3Quc2V0KCJTdWJ0eXBlIiwgX3ByaW1pdGl2ZXMuTmFtZS5nZXQoIkZvcm0iKSk7CiAgICAgIGFwcGVhcmFuY2VEaWN0LnNldCgiUmVzb3VyY2VzIiwgcmVzb3VyY2VzKTsKICAgICAgYXBwZWFyYW5jZURpY3Quc2V0KCJCQm94IiwgWzAsIDAsIHRoaXMuZGF0YS5yZWN0WzJdIC0gdGhpcy5kYXRhLnJlY3RbMF0sIHRoaXMuZGF0YS5yZWN0WzNdIC0gdGhpcy5kYXRhLnJlY3RbMV1dKTsKICAgICAgY29uc3Qgcm90YXRpb25NYXRyaXggPSB0aGlzLmdldFJvdGF0aW9uTWF0cml4KGFubm90YXRpb25TdG9yYWdlKTsKICAgICAgaWYgKHJvdGF0aW9uTWF0cml4ICE9PSBfdXRpbC5JREVOVElUWV9NQVRSSVgpIHsKICAgICAgICBhcHBlYXJhbmNlRGljdC5zZXQoIk1hdHJpeCIsIHJvdGF0aW9uTWF0cml4KTsKICAgICAgfQogICAgICBhd2FpdCAoMCwgX3dyaXRlci53cml0ZU9iamVjdCkobmV3UmVmLCBhcHBlYXJhbmNlU3RyZWFtLCBidWZmZXIsIHhyZWYpOwogICAgICBjaGFuZ2VzLnB1c2goewogICAgICAgIHJlZjogbmV3UmVmLAogICAgICAgIGRhdGE6IGJ1ZmZlci5qb2luKCIiKSwKICAgICAgICB4ZmE6IG51bGwsCiAgICAgICAgbmVlZEFwcGVhcmFuY2VzOiBmYWxzZQogICAgICB9KTsKICAgICAgYnVmZmVyLmxlbmd0aCA9IDA7CiAgICB9CiAgICBkaWN0LnNldCgiTSIsIGBEOiR7KDAsIF91dGlsLmdldE1vZGlmaWNhdGlvbkRhdGUpKCl9YCk7CiAgICBhd2FpdCAoMCwgX3dyaXRlci53cml0ZU9iamVjdCkodGhpcy5yZWYsIGRpY3QsIGJ1ZmZlciwgeHJlZik7CiAgICBjaGFuZ2VzWzBdLmRhdGEgPSBidWZmZXIuam9pbigiIik7CiAgICByZXR1cm4gY2hhbmdlczsKICB9CiAgYXN5bmMgX2dldEFwcGVhcmFuY2UoZXZhbHVhdG9yLCB0YXNrLCBpbnRlbnQsIGFubm90YXRpb25TdG9yYWdlKSB7CiAgICBjb25zdCBpc1Bhc3N3b3JkID0gdGhpcy5oYXNGaWVsZEZsYWcoX3V0aWwuQW5ub3RhdGlvbkZpZWxkRmxhZy5QQVNTV09SRCk7CiAgICBpZiAoaXNQYXNzd29yZCkgewogICAgICByZXR1cm4gbnVsbDsKICAgIH0KICAgIGNvbnN0IHN0b3JhZ2VFbnRyeSA9IGFubm90YXRpb25TdG9yYWdlPy5nZXQodGhpcy5kYXRhLmlkKTsKICAgIGxldCB2YWx1ZSwgcm90YXRpb247CiAgICBpZiAoc3RvcmFnZUVudHJ5KSB7CiAgICAgIHZhbHVlID0gc3RvcmFnZUVudHJ5LmZvcm1hdHRlZFZhbHVlIHx8IHN0b3JhZ2VFbnRyeS52YWx1ZTsKICAgICAgcm90YXRpb24gPSBzdG9yYWdlRW50cnkucm90YXRpb247CiAgICB9CiAgICBpZiAocm90YXRpb24gPT09IHVuZGVmaW5lZCAmJiB2YWx1ZSA9PT0gdW5kZWZpbmVkICYmICF0aGlzLl9uZWVkQXBwZWFyYW5jZXMpIHsKICAgICAgaWYgKCF0aGlzLl9oYXNWYWx1ZUZyb21YRkEgfHwgdGhpcy5hcHBlYXJhbmNlKSB7CiAgICAgICAgcmV0dXJuIG51bGw7CiAgICAgIH0KICAgIH0KICAgIGNvbnN0IGNvbG9ycyA9IHRoaXMuZ2V0Qm9yZGVyQW5kQmFja2dyb3VuZEFwcGVhcmFuY2VzKGFubm90YXRpb25TdG9yYWdlKTsKICAgIGlmICh2YWx1ZSA9PT0gdW5kZWZpbmVkKSB7CiAgICAgIHZhbHVlID0gdGhpcy5kYXRhLmZpZWxkVmFsdWU7CiAgICAgIGlmICghdmFsdWUpIHsKICAgICAgICByZXR1cm4gYC9UeCBCTUMgcSAke2NvbG9yc31RIEVNQ2A7CiAgICAgIH0KICAgIH0KICAgIGlmIChBcnJheS5pc0FycmF5KHZhbHVlKSAmJiB2YWx1ZS5sZW5ndGggPT09IDEpIHsKICAgICAgdmFsdWUgPSB2YWx1ZVswXTsKICAgIH0KICAgICgwLCBfdXRpbC5hc3NlcnQpKHR5cGVvZiB2YWx1ZSA9PT0gInN0cmluZyIsICJFeHBlY3RlZCBgdmFsdWVgIHRvIGJlIGEgc3RyaW5nLiIpOwogICAgdmFsdWUgPSB2YWx1ZS50cmltKCk7CiAgICBpZiAodGhpcy5kYXRhLmNvbWJvKSB7CiAgICAgIGNvbnN0IG9wdGlvbiA9IHRoaXMuZGF0YS5vcHRpb25zLmZpbmQoKHsKICAgICAgICBleHBvcnRWYWx1ZQogICAgICB9KSA9PiB2YWx1ZSA9PT0gZXhwb3J0VmFsdWUpOwogICAgICB2YWx1ZSA9IG9wdGlvbj8uZGlzcGxheVZhbHVlIHx8IHZhbHVlOwogICAgfQogICAgaWYgKHZhbHVlID09PSAiIikgewogICAgICByZXR1cm4gYC9UeCBCTUMgcSAke2NvbG9yc31RIEVNQ2A7CiAgICB9CiAgICBpZiAocm90YXRpb24gPT09IHVuZGVmaW5lZCkgewogICAgICByb3RhdGlvbiA9IHRoaXMucm90YXRpb247CiAgICB9CiAgICBsZXQgbGluZUNvdW50ID0gLTE7CiAgICBsZXQgbGluZXM7CiAgICBpZiAodGhpcy5kYXRhLm11bHRpTGluZSkgewogICAgICBsaW5lcyA9IHZhbHVlLnNwbGl0KC9cclxuP3xcbi8pLm1hcChsaW5lID0+IGxpbmUubm9ybWFsaXplKCJORkMiKSk7CiAgICAgIGxpbmVDb3VudCA9IGxpbmVzLmxlbmd0aDsKICAgIH0gZWxzZSB7CiAgICAgIGxpbmVzID0gW3ZhbHVlLnJlcGxhY2UoL1xyXG4/fFxuLywgIiIpLm5vcm1hbGl6ZSgiTkZDIildOwogICAgfQogICAgY29uc3QgZGVmYXVsdFBhZGRpbmcgPSAxOwogICAgY29uc3QgZGVmYXVsdEhQYWRkaW5nID0gMjsKICAgIGxldCB0b3RhbEhlaWdodCA9IHRoaXMuZGF0YS5yZWN0WzNdIC0gdGhpcy5kYXRhLnJlY3RbMV07CiAgICBsZXQgdG90YWxXaWR0aCA9IHRoaXMuZGF0YS5yZWN0WzJdIC0gdGhpcy5kYXRhLnJlY3RbMF07CiAgICBpZiAocm90YXRpb24gPT09IDkwIHx8IHJvdGF0aW9uID09PSAyNzApIHsKICAgICAgW3RvdGFsV2lkdGgsIHRvdGFsSGVpZ2h0XSA9IFt0b3RhbEhlaWdodCwgdG90YWxXaWR0aF07CiAgICB9CiAgICBpZiAoIXRoaXMuX2RlZmF1bHRBcHBlYXJhbmNlKSB7CiAgICAgIHRoaXMuZGF0YS5kZWZhdWx0QXBwZWFyYW5jZURhdGEgPSAoMCwgX2RlZmF1bHRfYXBwZWFyYW5jZS5wYXJzZURlZmF1bHRBcHBlYXJhbmNlKSh0aGlzLl9kZWZhdWx0QXBwZWFyYW5jZSA9ICIvSGVsdmV0aWNhIDAgVGYgMCBnIik7CiAgICB9CiAgICBsZXQgZm9udCA9IGF3YWl0IFdpZGdldEFubm90YXRpb24uX2dldEZvbnREYXRhKGV2YWx1YXRvciwgdGFzaywgdGhpcy5kYXRhLmRlZmF1bHRBcHBlYXJhbmNlRGF0YSwgdGhpcy5fZmllbGRSZXNvdXJjZXMubWVyZ2VkUmVzb3VyY2VzKTsKICAgIGxldCBkZWZhdWx0QXBwZWFyYW5jZSwgZm9udFNpemUsIGxpbmVIZWlnaHQ7CiAgICBjb25zdCBlbmNvZGVkTGluZXMgPSBbXTsKICAgIGxldCBlbmNvZGluZ0Vycm9yID0gZmFsc2U7CiAgICBmb3IgKGNvbnN0IGxpbmUgb2YgbGluZXMpIHsKICAgICAgY29uc3QgZW5jb2RlZFN0cmluZyA9IGZvbnQuZW5jb2RlU3RyaW5nKGxpbmUpOwogICAgICBpZiAoZW5jb2RlZFN0cmluZy5sZW5ndGggPiAxKSB7CiAgICAgICAgZW5jb2RpbmdFcnJvciA9IHRydWU7CiAgICAgIH0KICAgICAgZW5jb2RlZExpbmVzLnB1c2goZW5jb2RlZFN0cmluZy5qb2luKCIiKSk7CiAgICB9CiAgICBpZiAoZW5jb2RpbmdFcnJvciAmJiBpbnRlbnQgJiBfdXRpbC5SZW5kZXJpbmdJbnRlbnRGbGFnLlNBVkUpIHsKICAgICAgcmV0dXJuIHsKICAgICAgICBuZWVkQXBwZWFyYW5jZXM6IHRydWUKICAgICAgfTsKICAgIH0KICAgIGlmIChlbmNvZGluZ0Vycm9yICYmIHRoaXMuX2lzT2Zmc2NyZWVuQ2FudmFzU3VwcG9ydGVkKSB7CiAgICAgIGNvbnN0IGZvbnRGYW1pbHkgPSB0aGlzLmRhdGEuY29tYiA/ICJtb25vc3BhY2UiIDogInNhbnMtc2VyaWYiOwogICAgICBjb25zdCBmYWtlVW5pY29kZUZvbnQgPSBuZXcgX2RlZmF1bHRfYXBwZWFyYW5jZS5GYWtlVW5pY29kZUZvbnQoZXZhbHVhdG9yLnhyZWYsIGZvbnRGYW1pbHkpOwogICAgICBjb25zdCByZXNvdXJjZXMgPSBmYWtlVW5pY29kZUZvbnQuY3JlYXRlRm9udFJlc291cmNlcyhsaW5lcy5qb2luKCIiKSk7CiAgICAgIGNvbnN0IG5ld0ZvbnQgPSByZXNvdXJjZXMuZ2V0UmF3KCJGb250Iik7CiAgICAgIGlmICh0aGlzLl9maWVsZFJlc291cmNlcy5tZXJnZWRSZXNvdXJjZXMuaGFzKCJGb250IikpIHsKICAgICAgICBjb25zdCBvbGRGb250ID0gdGhpcy5fZmllbGRSZXNvdXJjZXMubWVyZ2VkUmVzb3VyY2VzLmdldCgiRm9udCIpOwogICAgICAgIGZvciAoY29uc3Qga2V5IG9mIG5ld0ZvbnQuZ2V0S2V5cygpKSB7CiAgICAgICAgICBvbGRGb250LnNldChrZXksIG5ld0ZvbnQuZ2V0UmF3KGtleSkpOwogICAgICAgIH0KICAgICAgfSBlbHNlIHsKICAgICAgICB0aGlzLl9maWVsZFJlc291cmNlcy5tZXJnZWRSZXNvdXJjZXMuc2V0KCJGb250IiwgbmV3Rm9udCk7CiAgICAgIH0KICAgICAgY29uc3QgZm9udE5hbWUgPSBmYWtlVW5pY29kZUZvbnQuZm9udE5hbWUubmFtZTsKICAgICAgZm9udCA9IGF3YWl0IFdpZGdldEFubm90YXRpb24uX2dldEZvbnREYXRhKGV2YWx1YXRvciwgdGFzaywgewogICAgICAgIGZvbnROYW1lLAogICAgICAgIGZvbnRTaXplOiAwCiAgICAgIH0sIHJlc291cmNlcyk7CiAgICAgIGZvciAobGV0IGkgPSAwLCBpaSA9IGVuY29kZWRMaW5lcy5sZW5ndGg7IGkgPCBpaTsgaSsrKSB7CiAgICAgICAgZW5jb2RlZExpbmVzW2ldID0gKDAsIF9jb3JlX3V0aWxzLnN0cmluZ1RvVVRGMTZTdHJpbmcpKGxpbmVzW2ldKTsKICAgICAgfQogICAgICBjb25zdCBzYXZlZERlZmF1bHRBcHBlYXJhbmNlID0gT2JqZWN0LmFzc2lnbihPYmplY3QuY3JlYXRlKG51bGwpLCB0aGlzLmRhdGEuZGVmYXVsdEFwcGVhcmFuY2VEYXRhKTsKICAgICAgdGhpcy5kYXRhLmRlZmF1bHRBcHBlYXJhbmNlRGF0YS5mb250U2l6ZSA9IDA7CiAgICAgIHRoaXMuZGF0YS5kZWZhdWx0QXBwZWFyYW5jZURhdGEuZm9udE5hbWUgPSBmb250TmFtZTsKICAgICAgW2RlZmF1bHRBcHBlYXJhbmNlLCBmb250U2l6ZSwgbGluZUhlaWdodF0gPSB0aGlzLl9jb21wdXRlRm9udFNpemUodG90YWxIZWlnaHQgLSAyICogZGVmYXVsdFBhZGRpbmcsIHRvdGFsV2lkdGggLSAyICogZGVmYXVsdEhQYWRkaW5nLCB2YWx1ZSwgZm9udCwgbGluZUNvdW50KTsKICAgICAgdGhpcy5kYXRhLmRlZmF1bHRBcHBlYXJhbmNlRGF0YSA9IHNhdmVkRGVmYXVsdEFwcGVhcmFuY2U7CiAgICB9IGVsc2UgewogICAgICBpZiAoIXRoaXMuX2lzT2Zmc2NyZWVuQ2FudmFzU3VwcG9ydGVkKSB7CiAgICAgICAgKDAsIF91dGlsLndhcm4pKCJfZ2V0QXBwZWFyYW5jZTogT2Zmc2NyZWVuQ2FudmFzIGlzIG5vdCBzdXBwb3J0ZWQsIGFubm90YXRpb24gbWF5IG5vdCByZW5kZXIgY29ycmVjdGx5LiIpOwogICAgICB9CiAgICAgIFtkZWZhdWx0QXBwZWFyYW5jZSwgZm9udFNpemUsIGxpbmVIZWlnaHRdID0gdGhpcy5fY29tcHV0ZUZvbnRTaXplKHRvdGFsSGVpZ2h0IC0gMiAqIGRlZmF1bHRQYWRkaW5nLCB0b3RhbFdpZHRoIC0gMiAqIGRlZmF1bHRIUGFkZGluZywgdmFsdWUsIGZvbnQsIGxpbmVDb3VudCk7CiAgICB9CiAgICBsZXQgZGVzY2VudCA9IGZvbnQuZGVzY2VudDsKICAgIGlmIChpc05hTihkZXNjZW50KSkgewogICAgICBkZXNjZW50ID0gX3V0aWwuQkFTRUxJTkVfRkFDVE9SICogbGluZUhlaWdodDsKICAgIH0gZWxzZSB7CiAgICAgIGRlc2NlbnQgPSBNYXRoLm1heChfdXRpbC5CQVNFTElORV9GQUNUT1IgKiBsaW5lSGVpZ2h0LCBNYXRoLmFicyhkZXNjZW50KSAqIGZvbnRTaXplKTsKICAgIH0KICAgIGNvbnN0IGRlZmF1bHRWUGFkZGluZyA9IE1hdGgubWluKE1hdGguZmxvb3IoKHRvdGFsSGVpZ2h0IC0gZm9udFNpemUpIC8gMiksIGRlZmF1bHRQYWRkaW5nKTsKICAgIGNvbnN0IGFsaWdubWVudCA9IHRoaXMuZGF0YS50ZXh0QWxpZ25tZW50OwogICAgaWYgKHRoaXMuZGF0YS5tdWx0aUxpbmUpIHsKICAgICAgcmV0dXJuIHRoaXMuX2dldE11bHRpbGluZUFwcGVhcmFuY2UoZGVmYXVsdEFwcGVhcmFuY2UsIGVuY29kZWRMaW5lcywgZm9udCwgZm9udFNpemUsIHRvdGFsV2lkdGgsIHRvdGFsSGVpZ2h0LCBhbGlnbm1lbnQsIGRlZmF1bHRIUGFkZGluZywgZGVmYXVsdFZQYWRkaW5nLCBkZXNjZW50LCBsaW5lSGVpZ2h0LCBhbm5vdGF0aW9uU3RvcmFnZSk7CiAgICB9CiAgICBpZiAodGhpcy5kYXRhLmNvbWIpIHsKICAgICAgcmV0dXJuIHRoaXMuX2dldENvbWJBcHBlYXJhbmNlKGRlZmF1bHRBcHBlYXJhbmNlLCBmb250LCBlbmNvZGVkTGluZXNbMF0sIGZvbnRTaXplLCB0b3RhbFdpZHRoLCB0b3RhbEhlaWdodCwgZGVmYXVsdEhQYWRkaW5nLCBkZWZhdWx0VlBhZGRpbmcsIGRlc2NlbnQsIGxpbmVIZWlnaHQsIGFubm90YXRpb25TdG9yYWdlKTsKICAgIH0KICAgIGNvbnN0IGJvdHRvbVBhZGRpbmcgPSBkZWZhdWx0VlBhZGRpbmcgKyBkZXNjZW50OwogICAgaWYgKGFsaWdubWVudCA9PT0gMCB8fCBhbGlnbm1lbnQgPiAyKSB7CiAgICAgIHJldHVybiBgL1R4IEJNQyBxICR7Y29sb3JzfUJUIGAgKyBkZWZhdWx0QXBwZWFyYW5jZSArIGAgMSAwIDAgMSAkeygwLCBfY29yZV91dGlscy5udW1iZXJUb1N0cmluZykoZGVmYXVsdEhQYWRkaW5nKX0gJHsoMCwgX2NvcmVfdXRpbHMubnVtYmVyVG9TdHJpbmcpKGJvdHRvbVBhZGRpbmcpfSBUbSAoJHsoMCwgX2NvcmVfdXRpbHMuZXNjYXBlU3RyaW5nKShlbmNvZGVkTGluZXNbMF0pfSkgVGpgICsgIiBFVCBRIEVNQyI7CiAgICB9CiAgICBjb25zdCBwcmV2SW5mbyA9IHsKICAgICAgc2hpZnQ6IDAKICAgIH07CiAgICBjb25zdCByZW5kZXJlZFRleHQgPSB0aGlzLl9yZW5kZXJUZXh0KGVuY29kZWRMaW5lc1swXSwgZm9udCwgZm9udFNpemUsIHRvdGFsV2lkdGgsIGFsaWdubWVudCwgcHJldkluZm8sIGRlZmF1bHRIUGFkZGluZywgYm90dG9tUGFkZGluZyk7CiAgICByZXR1cm4gYC9UeCBCTUMgcSAke2NvbG9yc31CVCBgICsgZGVmYXVsdEFwcGVhcmFuY2UgKyBgIDEgMCAwIDEgMCAwIFRtICR7cmVuZGVyZWRUZXh0fWAgKyAiIEVUIFEgRU1DIjsKICB9CiAgc3RhdGljIGFzeW5jIF9nZXRGb250RGF0YShldmFsdWF0b3IsIHRhc2ssIGFwcGVhcmFuY2VEYXRhLCByZXNvdXJjZXMpIHsKICAgIGNvbnN0IG9wZXJhdG9yTGlzdCA9IG5ldyBfb3BlcmF0b3JfbGlzdC5PcGVyYXRvckxpc3QoKTsKICAgIGNvbnN0IGluaXRpYWxTdGF0ZSA9IHsKICAgICAgZm9udDogbnVsbCwKICAgICAgY2xvbmUoKSB7CiAgICAgICAgcmV0dXJuIHRoaXM7CiAgICAgIH0KICAgIH07CiAgICBjb25zdCB7CiAgICAgIGZvbnROYW1lLAogICAgICBmb250U2l6ZQogICAgfSA9IGFwcGVhcmFuY2VEYXRhOwogICAgYXdhaXQgZXZhbHVhdG9yLmhhbmRsZVNldEZvbnQocmVzb3VyY2VzLCBbZm9udE5hbWUgJiYgX3ByaW1pdGl2ZXMuTmFtZS5nZXQoZm9udE5hbWUpLCBmb250U2l6ZV0sIG51bGwsIG9wZXJhdG9yTGlzdCwgdGFzaywgaW5pdGlhbFN0YXRlLCBudWxsKTsKICAgIHJldHVybiBpbml0aWFsU3RhdGUuZm9udDsKICB9CiAgX2dldFRleHRXaWR0aCh0ZXh0LCBmb250KSB7CiAgICByZXR1cm4gZm9udC5jaGFyc1RvR2x5cGhzKHRleHQpLnJlZHVjZSgod2lkdGgsIGdseXBoKSA9PiB3aWR0aCArIGdseXBoLndpZHRoLCAwKSAvIDEwMDA7CiAgfQogIF9jb21wdXRlRm9udFNpemUoaGVpZ2h0LCB3aWR0aCwgdGV4dCwgZm9udCwgbGluZUNvdW50KSB7CiAgICBsZXQgewogICAgICBmb250U2l6ZQogICAgfSA9IHRoaXMuZGF0YS5kZWZhdWx0QXBwZWFyYW5jZURhdGE7CiAgICBsZXQgbGluZUhlaWdodCA9IChmb250U2l6ZSB8fCAxMikgKiBfdXRpbC5MSU5FX0ZBQ1RPUiwKICAgICAgbnVtYmVyT2ZMaW5lcyA9IE1hdGgucm91bmQoaGVpZ2h0IC8gbGluZUhlaWdodCk7CiAgICBpZiAoIWZvbnRTaXplKSB7CiAgICAgIGNvbnN0IHJvdW5kV2l0aFR3b0RpZ2l0cyA9IHggPT4gTWF0aC5mbG9vcih4ICogMTAwKSAvIDEwMDsKICAgICAgaWYgKGxpbmVDb3VudCA9PT0gLTEpIHsKICAgICAgICBjb25zdCB0ZXh0V2lkdGggPSB0aGlzLl9nZXRUZXh0V2lkdGgodGV4dCwgZm9udCk7CiAgICAgICAgZm9udFNpemUgPSByb3VuZFdpdGhUd29EaWdpdHMoTWF0aC5taW4oaGVpZ2h0IC8gX3V0aWwuTElORV9GQUNUT1IsIHRleHRXaWR0aCA+IHdpZHRoID8gd2lkdGggLyB0ZXh0V2lkdGggOiBJbmZpbml0eSkpOwogICAgICAgIG51bWJlck9mTGluZXMgPSAxOwogICAgICB9IGVsc2UgewogICAgICAgIGNvbnN0IGxpbmVzID0gdGV4dC5zcGxpdCgvXHJcbj98XG4vKTsKICAgICAgICBjb25zdCBjYWNoZWRMaW5lcyA9IFtdOwogICAgICAgIGZvciAoY29uc3QgbGluZSBvZiBsaW5lcykgewogICAgICAgICAgY29uc3QgZW5jb2RlZCA9IGZvbnQuZW5jb2RlU3RyaW5nKGxpbmUpLmpvaW4oIiIpOwogICAgICAgICAgY29uc3QgZ2x5cGhzID0gZm9udC5jaGFyc1RvR2x5cGhzKGVuY29kZWQpOwogICAgICAgICAgY29uc3QgcG9zaXRpb25zID0gZm9udC5nZXRDaGFyUG9zaXRpb25zKGVuY29kZWQpOwogICAgICAgICAgY2FjaGVkTGluZXMucHVzaCh7CiAgICAgICAgICAgIGxpbmU6IGVuY29kZWQsCiAgICAgICAgICAgIGdseXBocywKICAgICAgICAgICAgcG9zaXRpb25zCiAgICAgICAgICB9KTsKICAgICAgICB9CiAgICAgICAgY29uc3QgaXNUb29CaWcgPSBmc2l6ZSA9PiB7CiAgICAgICAgICBsZXQgdG90YWxIZWlnaHQgPSAwOwogICAgICAgICAgZm9yIChjb25zdCBjYWNoZSBvZiBjYWNoZWRMaW5lcykgewogICAgICAgICAgICBjb25zdCBjaHVua3MgPSB0aGlzLl9zcGxpdExpbmUobnVsbCwgZm9udCwgZnNpemUsIHdpZHRoLCBjYWNoZSk7CiAgICAgICAgICAgIHRvdGFsSGVpZ2h0ICs9IGNodW5rcy5sZW5ndGggKiBmc2l6ZTsKICAgICAgICAgICAgaWYgKHRvdGFsSGVpZ2h0ID4gaGVpZ2h0KSB7CiAgICAgICAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgICB9OwogICAgICAgIG51bWJlck9mTGluZXMgPSBNYXRoLm1heChudW1iZXJPZkxpbmVzLCBsaW5lQ291bnQpOwogICAgICAgIHdoaWxlICh0cnVlKSB7CiAgICAgICAgICBsaW5lSGVpZ2h0ID0gaGVpZ2h0IC8gbnVtYmVyT2ZMaW5lczsKICAgICAgICAgIGZvbnRTaXplID0gcm91bmRXaXRoVHdvRGlnaXRzKGxpbmVIZWlnaHQgLyBfdXRpbC5MSU5FX0ZBQ1RPUik7CiAgICAgICAgICBpZiAoaXNUb29CaWcoZm9udFNpemUpKSB7CiAgICAgICAgICAgIG51bWJlck9mTGluZXMrKzsKICAgICAgICAgICAgY29udGludWU7CiAgICAgICAgICB9CiAgICAgICAgICBicmVhazsKICAgICAgICB9CiAgICAgIH0KICAgICAgY29uc3QgewogICAgICAgIGZvbnROYW1lLAogICAgICAgIGZvbnRDb2xvcgogICAgICB9ID0gdGhpcy5kYXRhLmRlZmF1bHRBcHBlYXJhbmNlRGF0YTsKICAgICAgdGhpcy5fZGVmYXVsdEFwcGVhcmFuY2UgPSAoMCwgX2RlZmF1bHRfYXBwZWFyYW5jZS5jcmVhdGVEZWZhdWx0QXBwZWFyYW5jZSkoewogICAgICAgIGZvbnRTaXplLAogICAgICAgIGZvbnROYW1lLAogICAgICAgIGZvbnRDb2xvcgogICAgICB9KTsKICAgIH0KICAgIHJldHVybiBbdGhpcy5fZGVmYXVsdEFwcGVhcmFuY2UsIGZvbnRTaXplLCBoZWlnaHQgLyBudW1iZXJPZkxpbmVzXTsKICB9CiAgX3JlbmRlclRleHQodGV4dCwgZm9udCwgZm9udFNpemUsIHRvdGFsV2lkdGgsIGFsaWdubWVudCwgcHJldkluZm8sIGhQYWRkaW5nLCB2UGFkZGluZykgewogICAgbGV0IHNoaWZ0OwogICAgaWYgKGFsaWdubWVudCA9PT0gMSkgewogICAgICBjb25zdCB3aWR0aCA9IHRoaXMuX2dldFRleHRXaWR0aCh0ZXh0LCBmb250KSAqIGZvbnRTaXplOwogICAgICBzaGlmdCA9ICh0b3RhbFdpZHRoIC0gd2lkdGgpIC8gMjsKICAgIH0gZWxzZSBpZiAoYWxpZ25tZW50ID09PSAyKSB7CiAgICAgIGNvbnN0IHdpZHRoID0gdGhpcy5fZ2V0VGV4dFdpZHRoKHRleHQsIGZvbnQpICogZm9udFNpemU7CiAgICAgIHNoaWZ0ID0gdG90YWxXaWR0aCAtIHdpZHRoIC0gaFBhZGRpbmc7CiAgICB9IGVsc2UgewogICAgICBzaGlmdCA9IGhQYWRkaW5nOwogICAgfQogICAgY29uc3Qgc2hpZnRTdHIgPSAoMCwgX2NvcmVfdXRpbHMubnVtYmVyVG9TdHJpbmcpKHNoaWZ0IC0gcHJldkluZm8uc2hpZnQpOwogICAgcHJldkluZm8uc2hpZnQgPSBzaGlmdDsKICAgIHZQYWRkaW5nID0gKDAsIF9jb3JlX3V0aWxzLm51bWJlclRvU3RyaW5nKSh2UGFkZGluZyk7CiAgICByZXR1cm4gYCR7c2hpZnRTdHJ9ICR7dlBhZGRpbmd9IFRkICgkeygwLCBfY29yZV91dGlscy5lc2NhcGVTdHJpbmcpKHRleHQpfSkgVGpgOwogIH0KICBfZ2V0U2F2ZUZpZWxkUmVzb3VyY2VzKHhyZWYpIHsKICAgIGNvbnN0IHsKICAgICAgbG9jYWxSZXNvdXJjZXMsCiAgICAgIGFwcGVhcmFuY2VSZXNvdXJjZXMsCiAgICAgIGFjcm9Gb3JtUmVzb3VyY2VzCiAgICB9ID0gdGhpcy5fZmllbGRSZXNvdXJjZXM7CiAgICBjb25zdCBmb250TmFtZSA9IHRoaXMuZGF0YS5kZWZhdWx0QXBwZWFyYW5jZURhdGE/LmZvbnROYW1lOwogICAgaWYgKCFmb250TmFtZSkgewogICAgICByZXR1cm4gbG9jYWxSZXNvdXJjZXMgfHwgX3ByaW1pdGl2ZXMuRGljdC5lbXB0eTsKICAgIH0KICAgIGZvciAoY29uc3QgcmVzb3VyY2VzIG9mIFtsb2NhbFJlc291cmNlcywgYXBwZWFyYW5jZVJlc291cmNlc10pIHsKICAgICAgaWYgKHJlc291cmNlcyBpbnN0YW5jZW9mIF9wcmltaXRpdmVzLkRpY3QpIHsKICAgICAgICBjb25zdCBsb2NhbEZvbnQgPSByZXNvdXJjZXMuZ2V0KCJGb250Iik7CiAgICAgICAgaWYgKGxvY2FsRm9udCBpbnN0YW5jZW9mIF9wcmltaXRpdmVzLkRpY3QgJiYgbG9jYWxGb250Lmhhcyhmb250TmFtZSkpIHsKICAgICAgICAgIHJldHVybiByZXNvdXJjZXM7CiAgICAgICAgfQogICAgICB9CiAgICB9CiAgICBpZiAoYWNyb0Zvcm1SZXNvdXJjZXMgaW5zdGFuY2VvZiBfcHJpbWl0aXZlcy5EaWN0KSB7CiAgICAgIGNvbnN0IGFjcm9Gb3JtRm9udCA9IGFjcm9Gb3JtUmVzb3VyY2VzLmdldCgiRm9udCIpOwogICAgICBpZiAoYWNyb0Zvcm1Gb250IGluc3RhbmNlb2YgX3ByaW1pdGl2ZXMuRGljdCAmJiBhY3JvRm9ybUZvbnQuaGFzKGZvbnROYW1lKSkgewogICAgICAgIGNvbnN0IHN1YkZvbnREaWN0ID0gbmV3IF9wcmltaXRpdmVzLkRpY3QoeHJlZik7CiAgICAgICAgc3ViRm9udERpY3Quc2V0KGZvbnROYW1lLCBhY3JvRm9ybUZvbnQuZ2V0UmF3KGZvbnROYW1lKSk7CiAgICAgICAgY29uc3Qgc3ViUmVzb3VyY2VzRGljdCA9IG5ldyBfcHJpbWl0aXZlcy5EaWN0KHhyZWYpOwogICAgICAgIHN1YlJlc291cmNlc0RpY3Quc2V0KCJGb250Iiwgc3ViRm9udERpY3QpOwogICAgICAgIHJldHVybiBfcHJpbWl0aXZlcy5EaWN0Lm1lcmdlKHsKICAgICAgICAgIHhyZWYsCiAgICAgICAgICBkaWN0QXJyYXk6IFtzdWJSZXNvdXJjZXNEaWN0LCBsb2NhbFJlc291cmNlc10sCiAgICAgICAgICBtZXJnZVN1YkRpY3RzOiB0cnVlCiAgICAgICAgfSk7CiAgICAgIH0KICAgIH0KICAgIHJldHVybiBsb2NhbFJlc291cmNlcyB8fCBfcHJpbWl0aXZlcy5EaWN0LmVtcHR5OwogIH0KICBnZXRGaWVsZE9iamVjdCgpIHsKICAgIHJldHVybiBudWxsOwogIH0KfQpjbGFzcyBUZXh0V2lkZ2V0QW5ub3RhdGlvbiBleHRlbmRzIFdpZGdldEFubm90YXRpb24gewogIGNvbnN0cnVjdG9yKHBhcmFtcykgewogICAgc3VwZXIocGFyYW1zKTsKICAgIHRoaXMuZGF0YS5oYXNPd25DYW52YXMgPSB0aGlzLmRhdGEucmVhZE9ubHkgJiYgIXRoaXMuZGF0YS5ub0hUTUw7CiAgICB0aGlzLl9oYXNUZXh0ID0gdHJ1ZTsKICAgIGNvbnN0IGRpY3QgPSBwYXJhbXMuZGljdDsKICAgIGlmICh0eXBlb2YgdGhpcy5kYXRhLmZpZWxkVmFsdWUgIT09ICJzdHJpbmciKSB7CiAgICAgIHRoaXMuZGF0YS5maWVsZFZhbHVlID0gIiI7CiAgICB9CiAgICBsZXQgYWxpZ25tZW50ID0gKDAsIF9jb3JlX3V0aWxzLmdldEluaGVyaXRhYmxlUHJvcGVydHkpKHsKICAgICAgZGljdCwKICAgICAga2V5OiAiUSIKICAgIH0pOwogICAgaWYgKCFOdW1iZXIuaXNJbnRlZ2VyKGFsaWdubWVudCkgfHwgYWxpZ25tZW50IDwgMCB8fCBhbGlnbm1lbnQgPiAyKSB7CiAgICAgIGFsaWdubWVudCA9IG51bGw7CiAgICB9CiAgICB0aGlzLmRhdGEudGV4dEFsaWdubWVudCA9IGFsaWdubWVudDsKICAgIGxldCBtYXhpbXVtTGVuZ3RoID0gKDAsIF9jb3JlX3V0aWxzLmdldEluaGVyaXRhYmxlUHJvcGVydHkpKHsKICAgICAgZGljdCwKICAgICAga2V5OiAiTWF4TGVuIgogICAgfSk7CiAgICBpZiAoIU51bWJlci5pc0ludGVnZXIobWF4aW11bUxlbmd0aCkgfHwgbWF4aW11bUxlbmd0aCA8IDApIHsKICAgICAgbWF4aW11bUxlbmd0aCA9IDA7CiAgICB9CiAgICB0aGlzLmRhdGEubWF4TGVuID0gbWF4aW11bUxlbmd0aDsKICAgIHRoaXMuZGF0YS5tdWx0aUxpbmUgPSB0aGlzLmhhc0ZpZWxkRmxhZyhfdXRpbC5Bbm5vdGF0aW9uRmllbGRGbGFnLk1VTFRJTElORSk7CiAgICB0aGlzLmRhdGEuY29tYiA9IHRoaXMuaGFzRmllbGRGbGFnKF91dGlsLkFubm90YXRpb25GaWVsZEZsYWcuQ09NQikgJiYgIXRoaXMuaGFzRmllbGRGbGFnKF91dGlsLkFubm90YXRpb25GaWVsZEZsYWcuTVVMVElMSU5FKSAmJiAhdGhpcy5oYXNGaWVsZEZsYWcoX3V0aWwuQW5ub3RhdGlvbkZpZWxkRmxhZy5QQVNTV09SRCkgJiYgIXRoaXMuaGFzRmllbGRGbGFnKF91dGlsLkFubm90YXRpb25GaWVsZEZsYWcuRklMRVNFTEVDVCkgJiYgdGhpcy5kYXRhLm1heExlbiAhPT0gMDsKICAgIHRoaXMuZGF0YS5kb05vdFNjcm9sbCA9IHRoaXMuaGFzRmllbGRGbGFnKF91dGlsLkFubm90YXRpb25GaWVsZEZsYWcuRE9OT1RTQ1JPTEwpOwogIH0KICBnZXQgaGFzVGV4dENvbnRlbnQoKSB7CiAgICByZXR1cm4gISF0aGlzLmFwcGVhcmFuY2UgJiYgIXRoaXMuX25lZWRBcHBlYXJhbmNlczsKICB9CiAgX2dldENvbWJBcHBlYXJhbmNlKGRlZmF1bHRBcHBlYXJhbmNlLCBmb250LCB0ZXh0LCBmb250U2l6ZSwgd2lkdGgsIGhlaWdodCwgaFBhZGRpbmcsIHZQYWRkaW5nLCBkZXNjZW50LCBsaW5lSGVpZ2h0LCBhbm5vdGF0aW9uU3RvcmFnZSkgewogICAgY29uc3QgY29tYldpZHRoID0gd2lkdGggLyB0aGlzLmRhdGEubWF4TGVuOwogICAgY29uc3QgY29sb3JzID0gdGhpcy5nZXRCb3JkZXJBbmRCYWNrZ3JvdW5kQXBwZWFyYW5jZXMoYW5ub3RhdGlvblN0b3JhZ2UpOwogICAgY29uc3QgYnVmID0gW107CiAgICBjb25zdCBwb3NpdGlvbnMgPSBmb250LmdldENoYXJQb3NpdGlvbnModGV4dCk7CiAgICBmb3IgKGNvbnN0IFtzdGFydCwgZW5kXSBvZiBwb3NpdGlvbnMpIHsKICAgICAgYnVmLnB1c2goYCgkeygwLCBfY29yZV91dGlscy5lc2NhcGVTdHJpbmcpKHRleHQuc3Vic3RyaW5nKHN0YXJ0LCBlbmQpKX0pIFRqYCk7CiAgICB9CiAgICBjb25zdCByZW5kZXJlZENvbWIgPSBidWYuam9pbihgICR7KDAsIF9jb3JlX3V0aWxzLm51bWJlclRvU3RyaW5nKShjb21iV2lkdGgpfSAwIFRkIGApOwogICAgcmV0dXJuIGAvVHggQk1DIHEgJHtjb2xvcnN9QlQgYCArIGRlZmF1bHRBcHBlYXJhbmNlICsgYCAxIDAgMCAxICR7KDAsIF9jb3JlX3V0aWxzLm51bWJlclRvU3RyaW5nKShoUGFkZGluZyl9ICR7KDAsIF9jb3JlX3V0aWxzLm51bWJlclRvU3RyaW5nKSh2UGFkZGluZyArIGRlc2NlbnQpfSBUbSAke3JlbmRlcmVkQ29tYn1gICsgIiBFVCBRIEVNQyI7CiAgfQogIF9nZXRNdWx0aWxpbmVBcHBlYXJhbmNlKGRlZmF1bHRBcHBlYXJhbmNlLCBsaW5lcywgZm9udCwgZm9udFNpemUsIHdpZHRoLCBoZWlnaHQsIGFsaWdubWVudCwgaFBhZGRpbmcsIHZQYWRkaW5nLCBkZXNjZW50LCBsaW5lSGVpZ2h0LCBhbm5vdGF0aW9uU3RvcmFnZSkgewogICAgY29uc3QgYnVmID0gW107CiAgICBjb25zdCB0b3RhbFdpZHRoID0gd2lkdGggLSAyICogaFBhZGRpbmc7CiAgICBjb25zdCBwcmV2SW5mbyA9IHsKICAgICAgc2hpZnQ6IDAKICAgIH07CiAgICBmb3IgKGxldCBpID0gMCwgaWkgPSBsaW5lcy5sZW5ndGg7IGkgPCBpaTsgaSsrKSB7CiAgICAgIGNvbnN0IGxpbmUgPSBsaW5lc1tpXTsKICAgICAgY29uc3QgY2h1bmtzID0gdGhpcy5fc3BsaXRMaW5lKGxpbmUsIGZvbnQsIGZvbnRTaXplLCB0b3RhbFdpZHRoKTsKICAgICAgZm9yIChsZXQgaiA9IDAsIGpqID0gY2h1bmtzLmxlbmd0aDsgaiA8IGpqOyBqKyspIHsKICAgICAgICBjb25zdCBjaHVuayA9IGNodW5rc1tqXTsKICAgICAgICBjb25zdCB2U2hpZnQgPSBpID09PSAwICYmIGogPT09IDAgPyAtdlBhZGRpbmcgLSAobGluZUhlaWdodCAtIGRlc2NlbnQpIDogLWxpbmVIZWlnaHQ7CiAgICAgICAgYnVmLnB1c2godGhpcy5fcmVuZGVyVGV4dChjaHVuaywgZm9udCwgZm9udFNpemUsIHdpZHRoLCBhbGlnbm1lbnQsIHByZXZJbmZvLCBoUGFkZGluZywgdlNoaWZ0KSk7CiAgICAgIH0KICAgIH0KICAgIGNvbnN0IGNvbG9ycyA9IHRoaXMuZ2V0Qm9yZGVyQW5kQmFja2dyb3VuZEFwcGVhcmFuY2VzKGFubm90YXRpb25TdG9yYWdlKTsKICAgIGNvbnN0IHJlbmRlcmVkVGV4dCA9IGJ1Zi5qb2luKCJcbiIpOwogICAgcmV0dXJuIGAvVHggQk1DIHEgJHtjb2xvcnN9QlQgYCArIGRlZmF1bHRBcHBlYXJhbmNlICsgYCAxIDAgMCAxIDAgJHsoMCwgX2NvcmVfdXRpbHMubnVtYmVyVG9TdHJpbmcpKGhlaWdodCl9IFRtICR7cmVuZGVyZWRUZXh0fWAgKyAiIEVUIFEgRU1DIjsKICB9CiAgX3NwbGl0TGluZShsaW5lLCBmb250LCBmb250U2l6ZSwgd2lkdGgsIGNhY2hlID0ge30pIHsKICAgIGxpbmUgPSBjYWNoZS5saW5lIHx8IGxpbmU7CiAgICBjb25zdCBnbHlwaHMgPSBjYWNoZS5nbHlwaHMgfHwgZm9udC5jaGFyc1RvR2x5cGhzKGxpbmUpOwogICAgaWYgKGdseXBocy5sZW5ndGggPD0gMSkgewogICAgICByZXR1cm4gW2xpbmVdOwogICAgfQogICAgY29uc3QgcG9zaXRpb25zID0gY2FjaGUucG9zaXRpb25zIHx8IGZvbnQuZ2V0Q2hhclBvc2l0aW9ucyhsaW5lKTsKICAgIGNvbnN0IHNjYWxlID0gZm9udFNpemUgLyAxMDAwOwogICAgY29uc3QgY2h1bmtzID0gW107CiAgICBsZXQgbGFzdFNwYWNlUG9zSW5TdHJpbmdTdGFydCA9IC0xLAogICAgICBsYXN0U3BhY2VQb3NJblN0cmluZ0VuZCA9IC0xLAogICAgICBsYXN0U3BhY2VQb3MgPSAtMSwKICAgICAgc3RhcnRDaHVuayA9IDAsCiAgICAgIGN1cnJlbnRXaWR0aCA9IDA7CiAgICBmb3IgKGxldCBpID0gMCwgaWkgPSBnbHlwaHMubGVuZ3RoOyBpIDwgaWk7IGkrKykgewogICAgICBjb25zdCBbc3RhcnQsIGVuZF0gPSBwb3NpdGlvbnNbaV07CiAgICAgIGNvbnN0IGdseXBoID0gZ2x5cGhzW2ldOwogICAgICBjb25zdCBnbHlwaFdpZHRoID0gZ2x5cGgud2lkdGggKiBzY2FsZTsKICAgICAgaWYgKGdseXBoLnVuaWNvZGUgPT09ICIgIikgewogICAgICAgIGlmIChjdXJyZW50V2lkdGggKyBnbHlwaFdpZHRoID4gd2lkdGgpIHsKICAgICAgICAgIGNodW5rcy5wdXNoKGxpbmUuc3Vic3RyaW5nKHN0YXJ0Q2h1bmssIHN0YXJ0KSk7CiAgICAgICAgICBzdGFydENodW5rID0gc3RhcnQ7CiAgICAgICAgICBjdXJyZW50V2lkdGggPSBnbHlwaFdpZHRoOwogICAgICAgICAgbGFzdFNwYWNlUG9zSW5TdHJpbmdTdGFydCA9IC0xOwogICAgICAgICAgbGFzdFNwYWNlUG9zID0gLTE7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIGN1cnJlbnRXaWR0aCArPSBnbHlwaFdpZHRoOwogICAgICAgICAgbGFzdFNwYWNlUG9zSW5TdHJpbmdTdGFydCA9IHN0YXJ0OwogICAgICAgICAgbGFzdFNwYWNlUG9zSW5TdHJpbmdFbmQgPSBlbmQ7CiAgICAgICAgICBsYXN0U3BhY2VQb3MgPSBpOwogICAgICAgIH0KICAgICAgfSBlbHNlIGlmIChjdXJyZW50V2lkdGggKyBnbHlwaFdpZHRoID4gd2lkdGgpIHsKICAgICAgICBpZiAobGFzdFNwYWNlUG9zSW5TdHJpbmdTdGFydCAhPT0gLTEpIHsKICAgICAgICAgIGNodW5rcy5wdXNoKGxpbmUuc3Vic3RyaW5nKHN0YXJ0Q2h1bmssIGxhc3RTcGFjZVBvc0luU3RyaW5nRW5kKSk7CiAgICAgICAgICBzdGFydENodW5rID0gbGFzdFNwYWNlUG9zSW5TdHJpbmdFbmQ7CiAgICAgICAgICBpID0gbGFzdFNwYWNlUG9zICsgMTsKICAgICAgICAgIGxhc3RTcGFjZVBvc0luU3RyaW5nU3RhcnQgPSAtMTsKICAgICAgICAgIGN1cnJlbnRXaWR0aCA9IDA7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIGNodW5rcy5wdXNoKGxpbmUuc3Vic3RyaW5nKHN0YXJ0Q2h1bmssIHN0YXJ0KSk7CiAgICAgICAgICBzdGFydENodW5rID0gc3RhcnQ7CiAgICAgICAgICBjdXJyZW50V2lkdGggPSBnbHlwaFdpZHRoOwogICAgICAgIH0KICAgICAgfSBlbHNlIHsKICAgICAgICBjdXJyZW50V2lkdGggKz0gZ2x5cGhXaWR0aDsKICAgICAgfQogICAgfQogICAgaWYgKHN0YXJ0Q2h1bmsgPCBsaW5lLmxlbmd0aCkgewogICAgICBjaHVua3MucHVzaChsaW5lLnN1YnN0cmluZyhzdGFydENodW5rLCBsaW5lLmxlbmd0aCkpOwogICAgfQogICAgcmV0dXJuIGNodW5rczsKICB9CiAgZ2V0RmllbGRPYmplY3QoKSB7CiAgICByZXR1cm4gewogICAgICBpZDogdGhpcy5kYXRhLmlkLAogICAgICB2YWx1ZTogdGhpcy5kYXRhLmZpZWxkVmFsdWUsCiAgICAgIGRlZmF1bHRWYWx1ZTogdGhpcy5kYXRhLmRlZmF1bHRGaWVsZFZhbHVlIHx8ICIiLAogICAgICBtdWx0aWxpbmU6IHRoaXMuZGF0YS5tdWx0aUxpbmUsCiAgICAgIHBhc3N3b3JkOiB0aGlzLmhhc0ZpZWxkRmxhZyhfdXRpbC5Bbm5vdGF0aW9uRmllbGRGbGFnLlBBU1NXT1JEKSwKICAgICAgY2hhckxpbWl0OiB0aGlzLmRhdGEubWF4TGVuLAogICAgICBjb21iOiB0aGlzLmRhdGEuY29tYiwKICAgICAgZWRpdGFibGU6ICF0aGlzLmRhdGEucmVhZE9ubHksCiAgICAgIGhpZGRlbjogdGhpcy5kYXRhLmhpZGRlbiwKICAgICAgbmFtZTogdGhpcy5kYXRhLmZpZWxkTmFtZSwKICAgICAgcmVjdDogdGhpcy5kYXRhLnJlY3QsCiAgICAgIGFjdGlvbnM6IHRoaXMuZGF0YS5hY3Rpb25zLAogICAgICBwYWdlOiB0aGlzLmRhdGEucGFnZUluZGV4LAogICAgICBzdHJva2VDb2xvcjogdGhpcy5kYXRhLmJvcmRlckNvbG9yLAogICAgICBmaWxsQ29sb3I6IHRoaXMuZGF0YS5iYWNrZ3JvdW5kQ29sb3IsCiAgICAgIHJvdGF0aW9uOiB0aGlzLnJvdGF0aW9uLAogICAgICB0eXBlOiAidGV4dCIKICAgIH07CiAgfQp9CmNsYXNzIEJ1dHRvbldpZGdldEFubm90YXRpb24gZXh0ZW5kcyBXaWRnZXRBbm5vdGF0aW9uIHsKICBjb25zdHJ1Y3RvcihwYXJhbXMpIHsKICAgIHN1cGVyKHBhcmFtcyk7CiAgICB0aGlzLmNoZWNrZWRBcHBlYXJhbmNlID0gbnVsbDsKICAgIHRoaXMudW5jaGVja2VkQXBwZWFyYW5jZSA9IG51bGw7CiAgICB0aGlzLmRhdGEuY2hlY2tCb3ggPSAhdGhpcy5oYXNGaWVsZEZsYWcoX3V0aWwuQW5ub3RhdGlvbkZpZWxkRmxhZy5SQURJTykgJiYgIXRoaXMuaGFzRmllbGRGbGFnKF91dGlsLkFubm90YXRpb25GaWVsZEZsYWcuUFVTSEJVVFRPTik7CiAgICB0aGlzLmRhdGEucmFkaW9CdXR0b24gPSB0aGlzLmhhc0ZpZWxkRmxhZyhfdXRpbC5Bbm5vdGF0aW9uRmllbGRGbGFnLlJBRElPKSAmJiAhdGhpcy5oYXNGaWVsZEZsYWcoX3V0aWwuQW5ub3RhdGlvbkZpZWxkRmxhZy5QVVNIQlVUVE9OKTsKICAgIHRoaXMuZGF0YS5wdXNoQnV0dG9uID0gdGhpcy5oYXNGaWVsZEZsYWcoX3V0aWwuQW5ub3RhdGlvbkZpZWxkRmxhZy5QVVNIQlVUVE9OKTsKICAgIHRoaXMuZGF0YS5pc1Rvb2x0aXBPbmx5ID0gZmFsc2U7CiAgICBpZiAodGhpcy5kYXRhLmNoZWNrQm94KSB7CiAgICAgIHRoaXMuX3Byb2Nlc3NDaGVja0JveChwYXJhbXMpOwogICAgfSBlbHNlIGlmICh0aGlzLmRhdGEucmFkaW9CdXR0b24pIHsKICAgICAgdGhpcy5fcHJvY2Vzc1JhZGlvQnV0dG9uKHBhcmFtcyk7CiAgICB9IGVsc2UgaWYgKHRoaXMuZGF0YS5wdXNoQnV0dG9uKSB7CiAgICAgIHRoaXMuZGF0YS5oYXNPd25DYW52YXMgPSB0cnVlOwogICAgICB0aGlzLl9wcm9jZXNzUHVzaEJ1dHRvbihwYXJhbXMpOwogICAgfSBlbHNlIHsKICAgICAgKDAsIF91dGlsLndhcm4pKCJJbnZhbGlkIGZpZWxkIGZsYWdzIGZvciBidXR0b24gd2lkZ2V0IGFubm90YXRpb24iKTsKICAgIH0KICB9CiAgYXN5bmMgZ2V0T3BlcmF0b3JMaXN0KGV2YWx1YXRvciwgdGFzaywgaW50ZW50LCByZW5kZXJGb3JtcywgYW5ub3RhdGlvblN0b3JhZ2UpIHsKICAgIGlmICh0aGlzLmRhdGEucHVzaEJ1dHRvbikgewogICAgICByZXR1cm4gc3VwZXIuZ2V0T3BlcmF0b3JMaXN0KGV2YWx1YXRvciwgdGFzaywgaW50ZW50LCBmYWxzZSwgYW5ub3RhdGlvblN0b3JhZ2UpOwogICAgfQogICAgbGV0IHZhbHVlID0gbnVsbDsKICAgIGxldCByb3RhdGlvbiA9IG51bGw7CiAgICBpZiAoYW5ub3RhdGlvblN0b3JhZ2UpIHsKICAgICAgY29uc3Qgc3RvcmFnZUVudHJ5ID0gYW5ub3RhdGlvblN0b3JhZ2UuZ2V0KHRoaXMuZGF0YS5pZCk7CiAgICAgIHZhbHVlID0gc3RvcmFnZUVudHJ5ID8gc3RvcmFnZUVudHJ5LnZhbHVlIDogbnVsbDsKICAgICAgcm90YXRpb24gPSBzdG9yYWdlRW50cnkgPyBzdG9yYWdlRW50cnkucm90YXRpb24gOiBudWxsOwogICAgfQogICAgaWYgKHZhbHVlID09PSBudWxsICYmIHRoaXMuYXBwZWFyYW5jZSkgewogICAgICByZXR1cm4gc3VwZXIuZ2V0T3BlcmF0b3JMaXN0KGV2YWx1YXRvciwgdGFzaywgaW50ZW50LCByZW5kZXJGb3JtcywgYW5ub3RhdGlvblN0b3JhZ2UpOwogICAgfQogICAgaWYgKHZhbHVlID09PSBudWxsIHx8IHZhbHVlID09PSB1bmRlZmluZWQpIHsKICAgICAgdmFsdWUgPSB0aGlzLmRhdGEuY2hlY2tCb3ggPyB0aGlzLmRhdGEuZmllbGRWYWx1ZSA9PT0gdGhpcy5kYXRhLmV4cG9ydFZhbHVlIDogdGhpcy5kYXRhLmZpZWxkVmFsdWUgPT09IHRoaXMuZGF0YS5idXR0b25WYWx1ZTsKICAgIH0KICAgIGNvbnN0IGFwcGVhcmFuY2UgPSB2YWx1ZSA/IHRoaXMuY2hlY2tlZEFwcGVhcmFuY2UgOiB0aGlzLnVuY2hlY2tlZEFwcGVhcmFuY2U7CiAgICBpZiAoYXBwZWFyYW5jZSkgewogICAgICBjb25zdCBzYXZlZEFwcGVhcmFuY2UgPSB0aGlzLmFwcGVhcmFuY2U7CiAgICAgIGNvbnN0IHNhdmVkTWF0cml4ID0gYXBwZWFyYW5jZS5kaWN0LmdldEFycmF5KCJNYXRyaXgiKSB8fCBfdXRpbC5JREVOVElUWV9NQVRSSVg7CiAgICAgIGlmIChyb3RhdGlvbikgewogICAgICAgIGFwcGVhcmFuY2UuZGljdC5zZXQoIk1hdHJpeCIsIHRoaXMuZ2V0Um90YXRpb25NYXRyaXgoYW5ub3RhdGlvblN0b3JhZ2UpKTsKICAgICAgfQogICAgICB0aGlzLmFwcGVhcmFuY2UgPSBhcHBlYXJhbmNlOwogICAgICBjb25zdCBvcGVyYXRvckxpc3QgPSBzdXBlci5nZXRPcGVyYXRvckxpc3QoZXZhbHVhdG9yLCB0YXNrLCBpbnRlbnQsIHJlbmRlckZvcm1zLCBhbm5vdGF0aW9uU3RvcmFnZSk7CiAgICAgIHRoaXMuYXBwZWFyYW5jZSA9IHNhdmVkQXBwZWFyYW5jZTsKICAgICAgYXBwZWFyYW5jZS5kaWN0LnNldCgiTWF0cml4Iiwgc2F2ZWRNYXRyaXgpOwogICAgICByZXR1cm4gb3BlcmF0b3JMaXN0OwogICAgfQogICAgcmV0dXJuIHsKICAgICAgb3BMaXN0OiBuZXcgX29wZXJhdG9yX2xpc3QuT3BlcmF0b3JMaXN0KCksCiAgICAgIHNlcGFyYXRlRm9ybTogZmFsc2UsCiAgICAgIHNlcGFyYXRlQ2FudmFzOiBmYWxzZQogICAgfTsKICB9CiAgYXN5bmMgc2F2ZShldmFsdWF0b3IsIHRhc2ssIGFubm90YXRpb25TdG9yYWdlKSB7CiAgICBpZiAodGhpcy5kYXRhLmNoZWNrQm94KSB7CiAgICAgIHJldHVybiB0aGlzLl9zYXZlQ2hlY2tib3goZXZhbHVhdG9yLCB0YXNrLCBhbm5vdGF0aW9uU3RvcmFnZSk7CiAgICB9CiAgICBpZiAodGhpcy5kYXRhLnJhZGlvQnV0dG9uKSB7CiAgICAgIHJldHVybiB0aGlzLl9zYXZlUmFkaW9CdXR0b24oZXZhbHVhdG9yLCB0YXNrLCBhbm5vdGF0aW9uU3RvcmFnZSk7CiAgICB9CiAgICByZXR1cm4gbnVsbDsKICB9CiAgYXN5bmMgX3NhdmVDaGVja2JveChldmFsdWF0b3IsIHRhc2ssIGFubm90YXRpb25TdG9yYWdlKSB7CiAgICBpZiAoIWFubm90YXRpb25TdG9yYWdlKSB7CiAgICAgIHJldHVybiBudWxsOwogICAgfQogICAgY29uc3Qgc3RvcmFnZUVudHJ5ID0gYW5ub3RhdGlvblN0b3JhZ2UuZ2V0KHRoaXMuZGF0YS5pZCk7CiAgICBsZXQgcm90YXRpb24gPSBzdG9yYWdlRW50cnk/LnJvdGF0aW9uLAogICAgICB2YWx1ZSA9IHN0b3JhZ2VFbnRyeT8udmFsdWU7CiAgICBpZiAocm90YXRpb24gPT09IHVuZGVmaW5lZCkgewogICAgICBpZiAodmFsdWUgPT09IHVuZGVmaW5lZCkgewogICAgICAgIHJldHVybiBudWxsOwogICAgICB9CiAgICAgIGNvbnN0IGRlZmF1bHRWYWx1ZSA9IHRoaXMuZGF0YS5maWVsZFZhbHVlID09PSB0aGlzLmRhdGEuZXhwb3J0VmFsdWU7CiAgICAgIGlmIChkZWZhdWx0VmFsdWUgPT09IHZhbHVlKSB7CiAgICAgICAgcmV0dXJuIG51bGw7CiAgICAgIH0KICAgIH0KICAgIGNvbnN0IGRpY3QgPSBldmFsdWF0b3IueHJlZi5mZXRjaElmUmVmKHRoaXMucmVmKTsKICAgIGlmICghKGRpY3QgaW5zdGFuY2VvZiBfcHJpbWl0aXZlcy5EaWN0KSkgewogICAgICByZXR1cm4gbnVsbDsKICAgIH0KICAgIGlmIChyb3RhdGlvbiA9PT0gdW5kZWZpbmVkKSB7CiAgICAgIHJvdGF0aW9uID0gdGhpcy5yb3RhdGlvbjsKICAgIH0KICAgIGlmICh2YWx1ZSA9PT0gdW5kZWZpbmVkKSB7CiAgICAgIHZhbHVlID0gdGhpcy5kYXRhLmZpZWxkVmFsdWUgPT09IHRoaXMuZGF0YS5leHBvcnRWYWx1ZTsKICAgIH0KICAgIGNvbnN0IHhmYSA9IHsKICAgICAgcGF0aDogdGhpcy5kYXRhLmZpZWxkTmFtZSwKICAgICAgdmFsdWU6IHZhbHVlID8gdGhpcy5kYXRhLmV4cG9ydFZhbHVlIDogIiIKICAgIH07CiAgICBjb25zdCBuYW1lID0gX3ByaW1pdGl2ZXMuTmFtZS5nZXQodmFsdWUgPyB0aGlzLmRhdGEuZXhwb3J0VmFsdWUgOiAiT2ZmIik7CiAgICBkaWN0LnNldCgiViIsIG5hbWUpOwogICAgZGljdC5zZXQoIkFTIiwgbmFtZSk7CiAgICBkaWN0LnNldCgiTSIsIGBEOiR7KDAsIF91dGlsLmdldE1vZGlmaWNhdGlvbkRhdGUpKCl9YCk7CiAgICBjb25zdCBtYXliZU1LID0gdGhpcy5fZ2V0TUtEaWN0KHJvdGF0aW9uKTsKICAgIGlmIChtYXliZU1LKSB7CiAgICAgIGRpY3Quc2V0KCJNSyIsIG1heWJlTUspOwogICAgfQogICAgY29uc3QgYnVmZmVyID0gW107CiAgICBhd2FpdCAoMCwgX3dyaXRlci53cml0ZU9iamVjdCkodGhpcy5yZWYsIGRpY3QsIGJ1ZmZlciwgZXZhbHVhdG9yLnhyZWYpOwogICAgcmV0dXJuIFt7CiAgICAgIHJlZjogdGhpcy5yZWYsCiAgICAgIGRhdGE6IGJ1ZmZlci5qb2luKCIiKSwKICAgICAgeGZhCiAgICB9XTsKICB9CiAgYXN5bmMgX3NhdmVSYWRpb0J1dHRvbihldmFsdWF0b3IsIHRhc2ssIGFubm90YXRpb25TdG9yYWdlKSB7CiAgICBpZiAoIWFubm90YXRpb25TdG9yYWdlKSB7CiAgICAgIHJldHVybiBudWxsOwogICAgfQogICAgY29uc3Qgc3RvcmFnZUVudHJ5ID0gYW5ub3RhdGlvblN0b3JhZ2UuZ2V0KHRoaXMuZGF0YS5pZCk7CiAgICBsZXQgcm90YXRpb24gPSBzdG9yYWdlRW50cnk/LnJvdGF0aW9uLAogICAgICB2YWx1ZSA9IHN0b3JhZ2VFbnRyeT8udmFsdWU7CiAgICBpZiAocm90YXRpb24gPT09IHVuZGVmaW5lZCkgewogICAgICBpZiAodmFsdWUgPT09IHVuZGVmaW5lZCkgewogICAgICAgIHJldHVybiBudWxsOwogICAgICB9CiAgICAgIGNvbnN0IGRlZmF1bHRWYWx1ZSA9IHRoaXMuZGF0YS5maWVsZFZhbHVlID09PSB0aGlzLmRhdGEuYnV0dG9uVmFsdWU7CiAgICAgIGlmIChkZWZhdWx0VmFsdWUgPT09IHZhbHVlKSB7CiAgICAgICAgcmV0dXJuIG51bGw7CiAgICAgIH0KICAgIH0KICAgIGNvbnN0IGRpY3QgPSBldmFsdWF0b3IueHJlZi5mZXRjaElmUmVmKHRoaXMucmVmKTsKICAgIGlmICghKGRpY3QgaW5zdGFuY2VvZiBfcHJpbWl0aXZlcy5EaWN0KSkgewogICAgICByZXR1cm4gbnVsbDsKICAgIH0KICAgIGlmICh2YWx1ZSA9PT0gdW5kZWZpbmVkKSB7CiAgICAgIHZhbHVlID0gdGhpcy5kYXRhLmZpZWxkVmFsdWUgPT09IHRoaXMuZGF0YS5idXR0b25WYWx1ZTsKICAgIH0KICAgIGlmIChyb3RhdGlvbiA9PT0gdW5kZWZpbmVkKSB7CiAgICAgIHJvdGF0aW9uID0gdGhpcy5yb3RhdGlvbjsKICAgIH0KICAgIGNvbnN0IHhmYSA9IHsKICAgICAgcGF0aDogdGhpcy5kYXRhLmZpZWxkTmFtZSwKICAgICAgdmFsdWU6IHZhbHVlID8gdGhpcy5kYXRhLmJ1dHRvblZhbHVlIDogIiIKICAgIH07CiAgICBjb25zdCBuYW1lID0gX3ByaW1pdGl2ZXMuTmFtZS5nZXQodmFsdWUgPyB0aGlzLmRhdGEuYnV0dG9uVmFsdWUgOiAiT2ZmIik7CiAgICBjb25zdCBidWZmZXIgPSBbXTsKICAgIGxldCBwYXJlbnREYXRhID0gbnVsbDsKICAgIGlmICh2YWx1ZSkgewogICAgICBpZiAodGhpcy5wYXJlbnQgaW5zdGFuY2VvZiBfcHJpbWl0aXZlcy5SZWYpIHsKICAgICAgICBjb25zdCBwYXJlbnQgPSBldmFsdWF0b3IueHJlZi5mZXRjaCh0aGlzLnBhcmVudCk7CiAgICAgICAgcGFyZW50LnNldCgiViIsIG5hbWUpOwogICAgICAgIGF3YWl0ICgwLCBfd3JpdGVyLndyaXRlT2JqZWN0KSh0aGlzLnBhcmVudCwgcGFyZW50LCBidWZmZXIsIGV2YWx1YXRvci54cmVmKTsKICAgICAgICBwYXJlbnREYXRhID0gYnVmZmVyLmpvaW4oIiIpOwogICAgICAgIGJ1ZmZlci5sZW5ndGggPSAwOwogICAgICB9IGVsc2UgaWYgKHRoaXMucGFyZW50IGluc3RhbmNlb2YgX3ByaW1pdGl2ZXMuRGljdCkgewogICAgICAgIHRoaXMucGFyZW50LnNldCgiViIsIG5hbWUpOwogICAgICB9CiAgICB9CiAgICBkaWN0LnNldCgiQVMiLCBuYW1lKTsKICAgIGRpY3Quc2V0KCJNIiwgYEQ6JHsoMCwgX3V0aWwuZ2V0TW9kaWZpY2F0aW9uRGF0ZSkoKX1gKTsKICAgIGNvbnN0IG1heWJlTUsgPSB0aGlzLl9nZXRNS0RpY3Qocm90YXRpb24pOwogICAgaWYgKG1heWJlTUspIHsKICAgICAgZGljdC5zZXQoIk1LIiwgbWF5YmVNSyk7CiAgICB9CiAgICBhd2FpdCAoMCwgX3dyaXRlci53cml0ZU9iamVjdCkodGhpcy5yZWYsIGRpY3QsIGJ1ZmZlciwgZXZhbHVhdG9yLnhyZWYpOwogICAgY29uc3QgbmV3UmVmcyA9IFt7CiAgICAgIHJlZjogdGhpcy5yZWYsCiAgICAgIGRhdGE6IGJ1ZmZlci5qb2luKCIiKSwKICAgICAgeGZhCiAgICB9XTsKICAgIGlmIChwYXJlbnREYXRhKSB7CiAgICAgIG5ld1JlZnMucHVzaCh7CiAgICAgICAgcmVmOiB0aGlzLnBhcmVudCwKICAgICAgICBkYXRhOiBwYXJlbnREYXRhLAogICAgICAgIHhmYTogbnVsbAogICAgICB9KTsKICAgIH0KICAgIHJldHVybiBuZXdSZWZzOwogIH0KICBfZ2V0RGVmYXVsdENoZWNrZWRBcHBlYXJhbmNlKHBhcmFtcywgdHlwZSkgewogICAgY29uc3Qgd2lkdGggPSB0aGlzLmRhdGEucmVjdFsyXSAtIHRoaXMuZGF0YS5yZWN0WzBdOwogICAgY29uc3QgaGVpZ2h0ID0gdGhpcy5kYXRhLnJlY3RbM10gLSB0aGlzLmRhdGEucmVjdFsxXTsKICAgIGNvbnN0IGJib3ggPSBbMCwgMCwgd2lkdGgsIGhlaWdodF07CiAgICBjb25zdCBGT05UX1JBVElPID0gMC44OwogICAgY29uc3QgZm9udFNpemUgPSBNYXRoLm1pbih3aWR0aCwgaGVpZ2h0KSAqIEZPTlRfUkFUSU87CiAgICBsZXQgbWV0cmljcywgY2hhcjsKICAgIGlmICh0eXBlID09PSAiY2hlY2siKSB7CiAgICAgIG1ldHJpY3MgPSB7CiAgICAgICAgd2lkdGg6IDAuNzU1ICogZm9udFNpemUsCiAgICAgICAgaGVpZ2h0OiAwLjcwNSAqIGZvbnRTaXplCiAgICAgIH07CiAgICAgIGNoYXIgPSAiXHgzMyI7CiAgICB9IGVsc2UgaWYgKHR5cGUgPT09ICJkaXNjIikgewogICAgICBtZXRyaWNzID0gewogICAgICAgIHdpZHRoOiAwLjc5MSAqIGZvbnRTaXplLAogICAgICAgIGhlaWdodDogMC43MDUgKiBmb250U2l6ZQogICAgICB9OwogICAgICBjaGFyID0gIlx4NkMiOwogICAgfSBlbHNlIHsKICAgICAgKDAsIF91dGlsLnVucmVhY2hhYmxlKShgX2dldERlZmF1bHRDaGVja2VkQXBwZWFyYW5jZSAtIHVuc3VwcG9ydGVkIHR5cGU6ICR7dHlwZX1gKTsKICAgIH0KICAgIGNvbnN0IHhTaGlmdCA9ICgwLCBfY29yZV91dGlscy5udW1iZXJUb1N0cmluZykoKHdpZHRoIC0gbWV0cmljcy53aWR0aCkgLyAyKTsKICAgIGNvbnN0IHlTaGlmdCA9ICgwLCBfY29yZV91dGlscy5udW1iZXJUb1N0cmluZykoKGhlaWdodCAtIG1ldHJpY3MuaGVpZ2h0KSAvIDIpOwogICAgY29uc3QgYXBwZWFyYW5jZSA9IGBxIEJUIC9QZGZKc1phRGIgJHtmb250U2l6ZX0gVGYgMCBnICR7eFNoaWZ0fSAke3lTaGlmdH0gVGQgKCR7Y2hhcn0pIFRqIEVUIFFgOwogICAgY29uc3QgYXBwZWFyYW5jZVN0cmVhbURpY3QgPSBuZXcgX3ByaW1pdGl2ZXMuRGljdChwYXJhbXMueHJlZik7CiAgICBhcHBlYXJhbmNlU3RyZWFtRGljdC5zZXQoIkZvcm1UeXBlIiwgMSk7CiAgICBhcHBlYXJhbmNlU3RyZWFtRGljdC5zZXQoIlN1YnR5cGUiLCBfcHJpbWl0aXZlcy5OYW1lLmdldCgiRm9ybSIpKTsKICAgIGFwcGVhcmFuY2VTdHJlYW1EaWN0LnNldCgiVHlwZSIsIF9wcmltaXRpdmVzLk5hbWUuZ2V0KCJYT2JqZWN0IikpOwogICAgYXBwZWFyYW5jZVN0cmVhbURpY3Quc2V0KCJCQm94IiwgYmJveCk7CiAgICBhcHBlYXJhbmNlU3RyZWFtRGljdC5zZXQoIk1hdHJpeCIsIFsxLCAwLCAwLCAxLCAwLCAwXSk7CiAgICBhcHBlYXJhbmNlU3RyZWFtRGljdC5zZXQoIkxlbmd0aCIsIGFwcGVhcmFuY2UubGVuZ3RoKTsKICAgIGNvbnN0IHJlc291cmNlcyA9IG5ldyBfcHJpbWl0aXZlcy5EaWN0KHBhcmFtcy54cmVmKTsKICAgIGNvbnN0IGZvbnQgPSBuZXcgX3ByaW1pdGl2ZXMuRGljdChwYXJhbXMueHJlZik7CiAgICBmb250LnNldCgiUGRmSnNaYURiIiwgdGhpcy5mYWxsYmFja0ZvbnREaWN0KTsKICAgIHJlc291cmNlcy5zZXQoIkZvbnQiLCBmb250KTsKICAgIGFwcGVhcmFuY2VTdHJlYW1EaWN0LnNldCgiUmVzb3VyY2VzIiwgcmVzb3VyY2VzKTsKICAgIHRoaXMuY2hlY2tlZEFwcGVhcmFuY2UgPSBuZXcgX3N0cmVhbS5TdHJpbmdTdHJlYW0oYXBwZWFyYW5jZSk7CiAgICB0aGlzLmNoZWNrZWRBcHBlYXJhbmNlLmRpY3QgPSBhcHBlYXJhbmNlU3RyZWFtRGljdDsKICAgIHRoaXMuX3N0cmVhbXMucHVzaCh0aGlzLmNoZWNrZWRBcHBlYXJhbmNlKTsKICB9CiAgX3Byb2Nlc3NDaGVja0JveChwYXJhbXMpIHsKICAgIGNvbnN0IGN1c3RvbUFwcGVhcmFuY2UgPSBwYXJhbXMuZGljdC5nZXQoIkFQIik7CiAgICBpZiAoIShjdXN0b21BcHBlYXJhbmNlIGluc3RhbmNlb2YgX3ByaW1pdGl2ZXMuRGljdCkpIHsKICAgICAgcmV0dXJuOwogICAgfQogICAgY29uc3Qgbm9ybWFsQXBwZWFyYW5jZSA9IGN1c3RvbUFwcGVhcmFuY2UuZ2V0KCJOIik7CiAgICBpZiAoIShub3JtYWxBcHBlYXJhbmNlIGluc3RhbmNlb2YgX3ByaW1pdGl2ZXMuRGljdCkpIHsKICAgICAgcmV0dXJuOwogICAgfQogICAgY29uc3QgYXNWYWx1ZSA9IHRoaXMuX2RlY29kZUZvcm1WYWx1ZShwYXJhbXMuZGljdC5nZXQoIkFTIikpOwogICAgaWYgKHR5cGVvZiBhc1ZhbHVlID09PSAic3RyaW5nIikgewogICAgICB0aGlzLmRhdGEuZmllbGRWYWx1ZSA9IGFzVmFsdWU7CiAgICB9CiAgICBjb25zdCB5ZXMgPSB0aGlzLmRhdGEuZmllbGRWYWx1ZSAhPT0gbnVsbCAmJiB0aGlzLmRhdGEuZmllbGRWYWx1ZSAhPT0gIk9mZiIgPyB0aGlzLmRhdGEuZmllbGRWYWx1ZSA6ICJZZXMiOwogICAgY29uc3QgZXhwb3J0VmFsdWVzID0gbm9ybWFsQXBwZWFyYW5jZS5nZXRLZXlzKCk7CiAgICBpZiAoZXhwb3J0VmFsdWVzLmxlbmd0aCA9PT0gMCkgewogICAgICBleHBvcnRWYWx1ZXMucHVzaCgiT2ZmIiwgeWVzKTsKICAgIH0gZWxzZSBpZiAoZXhwb3J0VmFsdWVzLmxlbmd0aCA9PT0gMSkgewogICAgICBpZiAoZXhwb3J0VmFsdWVzWzBdID09PSAiT2ZmIikgewogICAgICAgIGV4cG9ydFZhbHVlcy5wdXNoKHllcyk7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgZXhwb3J0VmFsdWVzLnVuc2hpZnQoIk9mZiIpOwogICAgICB9CiAgICB9IGVsc2UgaWYgKGV4cG9ydFZhbHVlcy5pbmNsdWRlcyh5ZXMpKSB7CiAgICAgIGV4cG9ydFZhbHVlcy5sZW5ndGggPSAwOwogICAgICBleHBvcnRWYWx1ZXMucHVzaCgiT2ZmIiwgeWVzKTsKICAgIH0gZWxzZSB7CiAgICAgIGNvbnN0IG90aGVyWWVzID0gZXhwb3J0VmFsdWVzLmZpbmQodiA9PiB2ICE9PSAiT2ZmIik7CiAgICAgIGV4cG9ydFZhbHVlcy5sZW5ndGggPSAwOwogICAgICBleHBvcnRWYWx1ZXMucHVzaCgiT2ZmIiwgb3RoZXJZZXMpOwogICAgfQogICAgaWYgKCFleHBvcnRWYWx1ZXMuaW5jbHVkZXModGhpcy5kYXRhLmZpZWxkVmFsdWUpKSB7CiAgICAgIHRoaXMuZGF0YS5maWVsZFZhbHVlID0gIk9mZiI7CiAgICB9CiAgICB0aGlzLmRhdGEuZXhwb3J0VmFsdWUgPSBleHBvcnRWYWx1ZXNbMV07CiAgICBjb25zdCBjaGVja2VkQXBwZWFyYW5jZSA9IG5vcm1hbEFwcGVhcmFuY2UuZ2V0KHRoaXMuZGF0YS5leHBvcnRWYWx1ZSk7CiAgICB0aGlzLmNoZWNrZWRBcHBlYXJhbmNlID0gY2hlY2tlZEFwcGVhcmFuY2UgaW5zdGFuY2VvZiBfYmFzZV9zdHJlYW0uQmFzZVN0cmVhbSA/IGNoZWNrZWRBcHBlYXJhbmNlIDogbnVsbDsKICAgIGNvbnN0IHVuY2hlY2tlZEFwcGVhcmFuY2UgPSBub3JtYWxBcHBlYXJhbmNlLmdldCgiT2ZmIik7CiAgICB0aGlzLnVuY2hlY2tlZEFwcGVhcmFuY2UgPSB1bmNoZWNrZWRBcHBlYXJhbmNlIGluc3RhbmNlb2YgX2Jhc2Vfc3RyZWFtLkJhc2VTdHJlYW0gPyB1bmNoZWNrZWRBcHBlYXJhbmNlIDogbnVsbDsKICAgIGlmICh0aGlzLmNoZWNrZWRBcHBlYXJhbmNlKSB7CiAgICAgIHRoaXMuX3N0cmVhbXMucHVzaCh0aGlzLmNoZWNrZWRBcHBlYXJhbmNlKTsKICAgIH0gZWxzZSB7CiAgICAgIHRoaXMuX2dldERlZmF1bHRDaGVja2VkQXBwZWFyYW5jZShwYXJhbXMsICJjaGVjayIpOwogICAgfQogICAgaWYgKHRoaXMudW5jaGVja2VkQXBwZWFyYW5jZSkgewogICAgICB0aGlzLl9zdHJlYW1zLnB1c2godGhpcy51bmNoZWNrZWRBcHBlYXJhbmNlKTsKICAgIH0KICAgIHRoaXMuX2ZhbGxiYWNrRm9udERpY3QgPSB0aGlzLmZhbGxiYWNrRm9udERpY3Q7CiAgICBpZiAodGhpcy5kYXRhLmRlZmF1bHRGaWVsZFZhbHVlID09PSBudWxsKSB7CiAgICAgIHRoaXMuZGF0YS5kZWZhdWx0RmllbGRWYWx1ZSA9ICJPZmYiOwogICAgfQogIH0KICBfcHJvY2Vzc1JhZGlvQnV0dG9uKHBhcmFtcykgewogICAgdGhpcy5kYXRhLmZpZWxkVmFsdWUgPSB0aGlzLmRhdGEuYnV0dG9uVmFsdWUgPSBudWxsOwogICAgY29uc3QgZmllbGRQYXJlbnQgPSBwYXJhbXMuZGljdC5nZXQoIlBhcmVudCIpOwogICAgaWYgKGZpZWxkUGFyZW50IGluc3RhbmNlb2YgX3ByaW1pdGl2ZXMuRGljdCkgewogICAgICB0aGlzLnBhcmVudCA9IHBhcmFtcy5kaWN0LmdldFJhdygiUGFyZW50Iik7CiAgICAgIGNvbnN0IGZpZWxkUGFyZW50VmFsdWUgPSBmaWVsZFBhcmVudC5nZXQoIlYiKTsKICAgICAgaWYgKGZpZWxkUGFyZW50VmFsdWUgaW5zdGFuY2VvZiBfcHJpbWl0aXZlcy5OYW1lKSB7CiAgICAgICAgdGhpcy5kYXRhLmZpZWxkVmFsdWUgPSB0aGlzLl9kZWNvZGVGb3JtVmFsdWUoZmllbGRQYXJlbnRWYWx1ZSk7CiAgICAgIH0KICAgIH0KICAgIGNvbnN0IGFwcGVhcmFuY2VTdGF0ZXMgPSBwYXJhbXMuZGljdC5nZXQoIkFQIik7CiAgICBpZiAoIShhcHBlYXJhbmNlU3RhdGVzIGluc3RhbmNlb2YgX3ByaW1pdGl2ZXMuRGljdCkpIHsKICAgICAgcmV0dXJuOwogICAgfQogICAgY29uc3Qgbm9ybWFsQXBwZWFyYW5jZSA9IGFwcGVhcmFuY2VTdGF0ZXMuZ2V0KCJOIik7CiAgICBpZiAoIShub3JtYWxBcHBlYXJhbmNlIGluc3RhbmNlb2YgX3ByaW1pdGl2ZXMuRGljdCkpIHsKICAgICAgcmV0dXJuOwogICAgfQogICAgZm9yIChjb25zdCBrZXkgb2Ygbm9ybWFsQXBwZWFyYW5jZS5nZXRLZXlzKCkpIHsKICAgICAgaWYgKGtleSAhPT0gIk9mZiIpIHsKICAgICAgICB0aGlzLmRhdGEuYnV0dG9uVmFsdWUgPSB0aGlzLl9kZWNvZGVGb3JtVmFsdWUoa2V5KTsKICAgICAgICBicmVhazsKICAgICAgfQogICAgfQogICAgY29uc3QgY2hlY2tlZEFwcGVhcmFuY2UgPSBub3JtYWxBcHBlYXJhbmNlLmdldCh0aGlzLmRhdGEuYnV0dG9uVmFsdWUpOwogICAgdGhpcy5jaGVja2VkQXBwZWFyYW5jZSA9IGNoZWNrZWRBcHBlYXJhbmNlIGluc3RhbmNlb2YgX2Jhc2Vfc3RyZWFtLkJhc2VTdHJlYW0gPyBjaGVja2VkQXBwZWFyYW5jZSA6IG51bGw7CiAgICBjb25zdCB1bmNoZWNrZWRBcHBlYXJhbmNlID0gbm9ybWFsQXBwZWFyYW5jZS5nZXQoIk9mZiIpOwogICAgdGhpcy51bmNoZWNrZWRBcHBlYXJhbmNlID0gdW5jaGVja2VkQXBwZWFyYW5jZSBpbnN0YW5jZW9mIF9iYXNlX3N0cmVhbS5CYXNlU3RyZWFtID8gdW5jaGVja2VkQXBwZWFyYW5jZSA6IG51bGw7CiAgICBpZiAodGhpcy5jaGVja2VkQXBwZWFyYW5jZSkgewogICAgICB0aGlzLl9zdHJlYW1zLnB1c2godGhpcy5jaGVja2VkQXBwZWFyYW5jZSk7CiAgICB9IGVsc2UgewogICAgICB0aGlzLl9nZXREZWZhdWx0Q2hlY2tlZEFwcGVhcmFuY2UocGFyYW1zLCAiZGlzYyIpOwogICAgfQogICAgaWYgKHRoaXMudW5jaGVja2VkQXBwZWFyYW5jZSkgewogICAgICB0aGlzLl9zdHJlYW1zLnB1c2godGhpcy51bmNoZWNrZWRBcHBlYXJhbmNlKTsKICAgIH0KICAgIHRoaXMuX2ZhbGxiYWNrRm9udERpY3QgPSB0aGlzLmZhbGxiYWNrRm9udERpY3Q7CiAgICBpZiAodGhpcy5kYXRhLmRlZmF1bHRGaWVsZFZhbHVlID09PSBudWxsKSB7CiAgICAgIHRoaXMuZGF0YS5kZWZhdWx0RmllbGRWYWx1ZSA9ICJPZmYiOwogICAgfQogIH0KICBfcHJvY2Vzc1B1c2hCdXR0b24ocGFyYW1zKSB7CiAgICBjb25zdCB7CiAgICAgIGRpY3QsCiAgICAgIGFubm90YXRpb25HbG9iYWxzCiAgICB9ID0gcGFyYW1zOwogICAgaWYgKCFkaWN0LmhhcygiQSIpICYmICFkaWN0LmhhcygiQUEiKSAmJiAhdGhpcy5kYXRhLmFsdGVybmF0aXZlVGV4dCkgewogICAgICAoMCwgX3V0aWwud2FybikoIlB1c2ggYnV0dG9ucyB3aXRob3V0IGFjdGlvbiBkaWN0aW9uYXJpZXMgYXJlIG5vdCBzdXBwb3J0ZWQiKTsKICAgICAgcmV0dXJuOwogICAgfQogICAgdGhpcy5kYXRhLmlzVG9vbHRpcE9ubHkgPSAhZGljdC5oYXMoIkEiKSAmJiAhZGljdC5oYXMoIkFBIik7CiAgICBfY2F0YWxvZy5DYXRhbG9nLnBhcnNlRGVzdERpY3Rpb25hcnkoewogICAgICBkZXN0RGljdDogZGljdCwKICAgICAgcmVzdWx0T2JqOiB0aGlzLmRhdGEsCiAgICAgIGRvY0Jhc2VVcmw6IGFubm90YXRpb25HbG9iYWxzLmJhc2VVcmwsCiAgICAgIGRvY0F0dGFjaG1lbnRzOiBhbm5vdGF0aW9uR2xvYmFscy5hdHRhY2htZW50cwogICAgfSk7CiAgfQogIGdldEZpZWxkT2JqZWN0KCkgewogICAgbGV0IHR5cGUgPSAiYnV0dG9uIjsKICAgIGxldCBleHBvcnRWYWx1ZXM7CiAgICBpZiAodGhpcy5kYXRhLmNoZWNrQm94KSB7CiAgICAgIHR5cGUgPSAiY2hlY2tib3giOwogICAgICBleHBvcnRWYWx1ZXMgPSB0aGlzLmRhdGEuZXhwb3J0VmFsdWU7CiAgICB9IGVsc2UgaWYgKHRoaXMuZGF0YS5yYWRpb0J1dHRvbikgewogICAgICB0eXBlID0gInJhZGlvYnV0dG9uIjsKICAgICAgZXhwb3J0VmFsdWVzID0gdGhpcy5kYXRhLmJ1dHRvblZhbHVlOwogICAgfQogICAgcmV0dXJuIHsKICAgICAgaWQ6IHRoaXMuZGF0YS5pZCwKICAgICAgdmFsdWU6IHRoaXMuZGF0YS5maWVsZFZhbHVlIHx8ICJPZmYiLAogICAgICBkZWZhdWx0VmFsdWU6IHRoaXMuZGF0YS5kZWZhdWx0RmllbGRWYWx1ZSwKICAgICAgZXhwb3J0VmFsdWVzLAogICAgICBlZGl0YWJsZTogIXRoaXMuZGF0YS5yZWFkT25seSwKICAgICAgbmFtZTogdGhpcy5kYXRhLmZpZWxkTmFtZSwKICAgICAgcmVjdDogdGhpcy5kYXRhLnJlY3QsCiAgICAgIGhpZGRlbjogdGhpcy5kYXRhLmhpZGRlbiwKICAgICAgYWN0aW9uczogdGhpcy5kYXRhLmFjdGlvbnMsCiAgICAgIHBhZ2U6IHRoaXMuZGF0YS5wYWdlSW5kZXgsCiAgICAgIHN0cm9rZUNvbG9yOiB0aGlzLmRhdGEuYm9yZGVyQ29sb3IsCiAgICAgIGZpbGxDb2xvcjogdGhpcy5kYXRhLmJhY2tncm91bmRDb2xvciwKICAgICAgcm90YXRpb246IHRoaXMucm90YXRpb24sCiAgICAgIHR5cGUKICAgIH07CiAgfQogIGdldCBmYWxsYmFja0ZvbnREaWN0KCkgewogICAgY29uc3QgZGljdCA9IG5ldyBfcHJpbWl0aXZlcy5EaWN0KCk7CiAgICBkaWN0LnNldCgiQmFzZUZvbnQiLCBfcHJpbWl0aXZlcy5OYW1lLmdldCgiWmFwZkRpbmdiYXRzIikpOwogICAgZGljdC5zZXQoIlR5cGUiLCBfcHJpbWl0aXZlcy5OYW1lLmdldCgiRmFsbGJhY2tUeXBlIikpOwogICAgZGljdC5zZXQoIlN1YnR5cGUiLCBfcHJpbWl0aXZlcy5OYW1lLmdldCgiRmFsbGJhY2tUeXBlIikpOwogICAgZGljdC5zZXQoIkVuY29kaW5nIiwgX3ByaW1pdGl2ZXMuTmFtZS5nZXQoIlphcGZEaW5nYmF0c0VuY29kaW5nIikpOwogICAgcmV0dXJuICgwLCBfdXRpbC5zaGFkb3cpKHRoaXMsICJmYWxsYmFja0ZvbnREaWN0IiwgZGljdCk7CiAgfQp9CmNsYXNzIENob2ljZVdpZGdldEFubm90YXRpb24gZXh0ZW5kcyBXaWRnZXRBbm5vdGF0aW9uIHsKICBjb25zdHJ1Y3RvcihwYXJhbXMpIHsKICAgIHN1cGVyKHBhcmFtcyk7CiAgICBjb25zdCB7CiAgICAgIGRpY3QsCiAgICAgIHhyZWYKICAgIH0gPSBwYXJhbXM7CiAgICB0aGlzLmluZGljZXMgPSBkaWN0LmdldEFycmF5KCJJIik7CiAgICB0aGlzLmhhc0luZGljZXMgPSBBcnJheS5pc0FycmF5KHRoaXMuaW5kaWNlcykgJiYgdGhpcy5pbmRpY2VzLmxlbmd0aCA+IDA7CiAgICB0aGlzLmRhdGEub3B0aW9ucyA9IFtdOwogICAgY29uc3Qgb3B0aW9ucyA9ICgwLCBfY29yZV91dGlscy5nZXRJbmhlcml0YWJsZVByb3BlcnR5KSh7CiAgICAgIGRpY3QsCiAgICAgIGtleTogIk9wdCIKICAgIH0pOwogICAgaWYgKEFycmF5LmlzQXJyYXkob3B0aW9ucykpIHsKICAgICAgZm9yIChsZXQgaSA9IDAsIGlpID0gb3B0aW9ucy5sZW5ndGg7IGkgPCBpaTsgaSsrKSB7CiAgICAgICAgY29uc3Qgb3B0aW9uID0geHJlZi5mZXRjaElmUmVmKG9wdGlvbnNbaV0pOwogICAgICAgIGNvbnN0IGlzT3B0aW9uQXJyYXkgPSBBcnJheS5pc0FycmF5KG9wdGlvbik7CiAgICAgICAgdGhpcy5kYXRhLm9wdGlvbnNbaV0gPSB7CiAgICAgICAgICBleHBvcnRWYWx1ZTogdGhpcy5fZGVjb2RlRm9ybVZhbHVlKGlzT3B0aW9uQXJyYXkgPyB4cmVmLmZldGNoSWZSZWYob3B0aW9uWzBdKSA6IG9wdGlvbiksCiAgICAgICAgICBkaXNwbGF5VmFsdWU6IHRoaXMuX2RlY29kZUZvcm1WYWx1ZShpc09wdGlvbkFycmF5ID8geHJlZi5mZXRjaElmUmVmKG9wdGlvblsxXSkgOiBvcHRpb24pCiAgICAgICAgfTsKICAgICAgfQogICAgfQogICAgaWYgKCF0aGlzLmhhc0luZGljZXMpIHsKICAgICAgaWYgKHR5cGVvZiB0aGlzLmRhdGEuZmllbGRWYWx1ZSA9PT0gInN0cmluZyIpIHsKICAgICAgICB0aGlzLmRhdGEuZmllbGRWYWx1ZSA9IFt0aGlzLmRhdGEuZmllbGRWYWx1ZV07CiAgICAgIH0gZWxzZSBpZiAoIXRoaXMuZGF0YS5maWVsZFZhbHVlKSB7CiAgICAgICAgdGhpcy5kYXRhLmZpZWxkVmFsdWUgPSBbXTsKICAgICAgfQogICAgfSBlbHNlIHsKICAgICAgdGhpcy5kYXRhLmZpZWxkVmFsdWUgPSBbXTsKICAgICAgY29uc3QgaWkgPSB0aGlzLmRhdGEub3B0aW9ucy5sZW5ndGg7CiAgICAgIGZvciAoY29uc3QgaSBvZiB0aGlzLmluZGljZXMpIHsKICAgICAgICBpZiAoTnVtYmVyLmlzSW50ZWdlcihpKSAmJiBpID49IDAgJiYgaSA8IGlpKSB7CiAgICAgICAgICB0aGlzLmRhdGEuZmllbGRWYWx1ZS5wdXNoKHRoaXMuZGF0YS5vcHRpb25zW2ldLmV4cG9ydFZhbHVlKTsKICAgICAgICB9CiAgICAgIH0KICAgIH0KICAgIHRoaXMuZGF0YS5jb21ibyA9IHRoaXMuaGFzRmllbGRGbGFnKF91dGlsLkFubm90YXRpb25GaWVsZEZsYWcuQ09NQk8pOwogICAgdGhpcy5kYXRhLm11bHRpU2VsZWN0ID0gdGhpcy5oYXNGaWVsZEZsYWcoX3V0aWwuQW5ub3RhdGlvbkZpZWxkRmxhZy5NVUxUSVNFTEVDVCk7CiAgICB0aGlzLl9oYXNUZXh0ID0gdHJ1ZTsKICB9CiAgZ2V0RmllbGRPYmplY3QoKSB7CiAgICBjb25zdCB0eXBlID0gdGhpcy5kYXRhLmNvbWJvID8gImNvbWJvYm94IiA6ICJsaXN0Ym94IjsKICAgIGNvbnN0IHZhbHVlID0gdGhpcy5kYXRhLmZpZWxkVmFsdWUubGVuZ3RoID4gMCA/IHRoaXMuZGF0YS5maWVsZFZhbHVlWzBdIDogbnVsbDsKICAgIHJldHVybiB7CiAgICAgIGlkOiB0aGlzLmRhdGEuaWQsCiAgICAgIHZhbHVlLAogICAgICBkZWZhdWx0VmFsdWU6IHRoaXMuZGF0YS5kZWZhdWx0RmllbGRWYWx1ZSwKICAgICAgZWRpdGFibGU6ICF0aGlzLmRhdGEucmVhZE9ubHksCiAgICAgIG5hbWU6IHRoaXMuZGF0YS5maWVsZE5hbWUsCiAgICAgIHJlY3Q6IHRoaXMuZGF0YS5yZWN0LAogICAgICBudW1JdGVtczogdGhpcy5kYXRhLmZpZWxkVmFsdWUubGVuZ3RoLAogICAgICBtdWx0aXBsZVNlbGVjdGlvbjogdGhpcy5kYXRhLm11bHRpU2VsZWN0LAogICAgICBoaWRkZW46IHRoaXMuZGF0YS5oaWRkZW4sCiAgICAgIGFjdGlvbnM6IHRoaXMuZGF0YS5hY3Rpb25zLAogICAgICBpdGVtczogdGhpcy5kYXRhLm9wdGlvbnMsCiAgICAgIHBhZ2U6IHRoaXMuZGF0YS5wYWdlSW5kZXgsCiAgICAgIHN0cm9rZUNvbG9yOiB0aGlzLmRhdGEuYm9yZGVyQ29sb3IsCiAgICAgIGZpbGxDb2xvcjogdGhpcy5kYXRhLmJhY2tncm91bmRDb2xvciwKICAgICAgcm90YXRpb246IHRoaXMucm90YXRpb24sCiAgICAgIHR5cGUKICAgIH07CiAgfQogIGFtZW5kU2F2ZWREaWN0KGFubm90YXRpb25TdG9yYWdlLCBkaWN0KSB7CiAgICBpZiAoIXRoaXMuaGFzSW5kaWNlcykgewogICAgICByZXR1cm47CiAgICB9CiAgICBsZXQgdmFsdWVzID0gYW5ub3RhdGlvblN0b3JhZ2U/LmdldCh0aGlzLmRhdGEuaWQpPy52YWx1ZTsKICAgIGlmICghQXJyYXkuaXNBcnJheSh2YWx1ZXMpKSB7CiAgICAgIHZhbHVlcyA9IFt2YWx1ZXNdOwogICAgfQogICAgY29uc3QgaW5kaWNlcyA9IFtdOwogICAgY29uc3QgewogICAgICBvcHRpb25zCiAgICB9ID0gdGhpcy5kYXRhOwogICAgZm9yIChsZXQgaSA9IDAsIGogPSAwLCBpaSA9IG9wdGlvbnMubGVuZ3RoOyBpIDwgaWk7IGkrKykgewogICAgICBpZiAob3B0aW9uc1tpXS5leHBvcnRWYWx1ZSA9PT0gdmFsdWVzW2pdKSB7CiAgICAgICAgaW5kaWNlcy5wdXNoKGkpOwogICAgICAgIGogKz0gMTsKICAgICAgfQogICAgfQogICAgZGljdC5zZXQoIkkiLCBpbmRpY2VzKTsKICB9CiAgYXN5bmMgX2dldEFwcGVhcmFuY2UoZXZhbHVhdG9yLCB0YXNrLCBpbnRlbnQsIGFubm90YXRpb25TdG9yYWdlKSB7CiAgICBpZiAodGhpcy5kYXRhLmNvbWJvKSB7CiAgICAgIHJldHVybiBzdXBlci5fZ2V0QXBwZWFyYW5jZShldmFsdWF0b3IsIHRhc2ssIGludGVudCwgYW5ub3RhdGlvblN0b3JhZ2UpOwogICAgfQogICAgbGV0IGV4cG9ydGVkVmFsdWUsIHJvdGF0aW9uOwogICAgY29uc3Qgc3RvcmFnZUVudHJ5ID0gYW5ub3RhdGlvblN0b3JhZ2U/LmdldCh0aGlzLmRhdGEuaWQpOwogICAgaWYgKHN0b3JhZ2VFbnRyeSkgewogICAgICByb3RhdGlvbiA9IHN0b3JhZ2VFbnRyeS5yb3RhdGlvbjsKICAgICAgZXhwb3J0ZWRWYWx1ZSA9IHN0b3JhZ2VFbnRyeS52YWx1ZTsKICAgIH0KICAgIGlmIChyb3RhdGlvbiA9PT0gdW5kZWZpbmVkICYmIGV4cG9ydGVkVmFsdWUgPT09IHVuZGVmaW5lZCAmJiAhdGhpcy5fbmVlZEFwcGVhcmFuY2VzKSB7CiAgICAgIHJldHVybiBudWxsOwogICAgfQogICAgaWYgKGV4cG9ydGVkVmFsdWUgPT09IHVuZGVmaW5lZCkgewogICAgICBleHBvcnRlZFZhbHVlID0gdGhpcy5kYXRhLmZpZWxkVmFsdWU7CiAgICB9IGVsc2UgaWYgKCFBcnJheS5pc0FycmF5KGV4cG9ydGVkVmFsdWUpKSB7CiAgICAgIGV4cG9ydGVkVmFsdWUgPSBbZXhwb3J0ZWRWYWx1ZV07CiAgICB9CiAgICBjb25zdCBkZWZhdWx0UGFkZGluZyA9IDE7CiAgICBjb25zdCBkZWZhdWx0SFBhZGRpbmcgPSAyOwogICAgbGV0IHRvdGFsSGVpZ2h0ID0gdGhpcy5kYXRhLnJlY3RbM10gLSB0aGlzLmRhdGEucmVjdFsxXTsKICAgIGxldCB0b3RhbFdpZHRoID0gdGhpcy5kYXRhLnJlY3RbMl0gLSB0aGlzLmRhdGEucmVjdFswXTsKICAgIGlmIChyb3RhdGlvbiA9PT0gOTAgfHwgcm90YXRpb24gPT09IDI3MCkgewogICAgICBbdG90YWxXaWR0aCwgdG90YWxIZWlnaHRdID0gW3RvdGFsSGVpZ2h0LCB0b3RhbFdpZHRoXTsKICAgIH0KICAgIGNvbnN0IGxpbmVDb3VudCA9IHRoaXMuZGF0YS5vcHRpb25zLmxlbmd0aDsKICAgIGNvbnN0IHZhbHVlSW5kaWNlcyA9IFtdOwogICAgZm9yIChsZXQgaSA9IDA7IGkgPCBsaW5lQ291bnQ7IGkrKykgewogICAgICBjb25zdCB7CiAgICAgICAgZXhwb3J0VmFsdWUKICAgICAgfSA9IHRoaXMuZGF0YS5vcHRpb25zW2ldOwogICAgICBpZiAoZXhwb3J0ZWRWYWx1ZS5pbmNsdWRlcyhleHBvcnRWYWx1ZSkpIHsKICAgICAgICB2YWx1ZUluZGljZXMucHVzaChpKTsKICAgICAgfQogICAgfQogICAgaWYgKCF0aGlzLl9kZWZhdWx0QXBwZWFyYW5jZSkgewogICAgICB0aGlzLmRhdGEuZGVmYXVsdEFwcGVhcmFuY2VEYXRhID0gKDAsIF9kZWZhdWx0X2FwcGVhcmFuY2UucGFyc2VEZWZhdWx0QXBwZWFyYW5jZSkodGhpcy5fZGVmYXVsdEFwcGVhcmFuY2UgPSAiL0hlbHZldGljYSAwIFRmIDAgZyIpOwogICAgfQogICAgY29uc3QgZm9udCA9IGF3YWl0IFdpZGdldEFubm90YXRpb24uX2dldEZvbnREYXRhKGV2YWx1YXRvciwgdGFzaywgdGhpcy5kYXRhLmRlZmF1bHRBcHBlYXJhbmNlRGF0YSwgdGhpcy5fZmllbGRSZXNvdXJjZXMubWVyZ2VkUmVzb3VyY2VzKTsKICAgIGxldCBkZWZhdWx0QXBwZWFyYW5jZTsKICAgIGxldCB7CiAgICAgIGZvbnRTaXplCiAgICB9ID0gdGhpcy5kYXRhLmRlZmF1bHRBcHBlYXJhbmNlRGF0YTsKICAgIGlmICghZm9udFNpemUpIHsKICAgICAgY29uc3QgbGluZUhlaWdodCA9ICh0b3RhbEhlaWdodCAtIGRlZmF1bHRQYWRkaW5nKSAvIGxpbmVDb3VudDsKICAgICAgbGV0IGxpbmVXaWR0aCA9IC0xOwogICAgICBsZXQgdmFsdWU7CiAgICAgIGZvciAoY29uc3QgewogICAgICAgIGRpc3BsYXlWYWx1ZQogICAgICB9IG9mIHRoaXMuZGF0YS5vcHRpb25zKSB7CiAgICAgICAgY29uc3Qgd2lkdGggPSB0aGlzLl9nZXRUZXh0V2lkdGgoZGlzcGxheVZhbHVlLCBmb250KTsKICAgICAgICBpZiAod2lkdGggPiBsaW5lV2lkdGgpIHsKICAgICAgICAgIGxpbmVXaWR0aCA9IHdpZHRoOwogICAgICAgICAgdmFsdWUgPSBkaXNwbGF5VmFsdWU7CiAgICAgICAgfQogICAgICB9CiAgICAgIFtkZWZhdWx0QXBwZWFyYW5jZSwgZm9udFNpemVdID0gdGhpcy5fY29tcHV0ZUZvbnRTaXplKGxpbmVIZWlnaHQsIHRvdGFsV2lkdGggLSAyICogZGVmYXVsdEhQYWRkaW5nLCB2YWx1ZSwgZm9udCwgLTEpOwogICAgfSBlbHNlIHsKICAgICAgZGVmYXVsdEFwcGVhcmFuY2UgPSB0aGlzLl9kZWZhdWx0QXBwZWFyYW5jZTsKICAgIH0KICAgIGNvbnN0IGxpbmVIZWlnaHQgPSBmb250U2l6ZSAqIF91dGlsLkxJTkVfRkFDVE9SOwogICAgY29uc3QgdlBhZGRpbmcgPSAobGluZUhlaWdodCAtIGZvbnRTaXplKSAvIDI7CiAgICBjb25zdCBudW1iZXJPZlZpc2libGVMaW5lcyA9IE1hdGguZmxvb3IodG90YWxIZWlnaHQgLyBsaW5lSGVpZ2h0KTsKICAgIGxldCBmaXJzdEluZGV4ID0gMDsKICAgIGlmICh2YWx1ZUluZGljZXMubGVuZ3RoID4gMCkgewogICAgICBjb25zdCBtaW5JbmRleCA9IE1hdGgubWluKC4uLnZhbHVlSW5kaWNlcyk7CiAgICAgIGNvbnN0IG1heEluZGV4ID0gTWF0aC5tYXgoLi4udmFsdWVJbmRpY2VzKTsKICAgICAgZmlyc3RJbmRleCA9IE1hdGgubWF4KDAsIG1heEluZGV4IC0gbnVtYmVyT2ZWaXNpYmxlTGluZXMgKyAxKTsKICAgICAgaWYgKGZpcnN0SW5kZXggPiBtaW5JbmRleCkgewogICAgICAgIGZpcnN0SW5kZXggPSBtaW5JbmRleDsKICAgICAgfQogICAgfQogICAgY29uc3QgZW5kID0gTWF0aC5taW4oZmlyc3RJbmRleCArIG51bWJlck9mVmlzaWJsZUxpbmVzICsgMSwgbGluZUNvdW50KTsKICAgIGNvbnN0IGJ1ZiA9IFsiL1R4IEJNQyBxIiwgYDEgMSAke3RvdGFsV2lkdGh9ICR7dG90YWxIZWlnaHR9IHJlIFcgbmBdOwogICAgaWYgKHZhbHVlSW5kaWNlcy5sZW5ndGgpIHsKICAgICAgYnVmLnB1c2goIjAuNjAwMDA2IDAuNzU2ODY2IDAuODU0OTA0IHJnIik7CiAgICAgIGZvciAoY29uc3QgaW5kZXggb2YgdmFsdWVJbmRpY2VzKSB7CiAgICAgICAgaWYgKGZpcnN0SW5kZXggPD0gaW5kZXggJiYgaW5kZXggPCBlbmQpIHsKICAgICAgICAgIGJ1Zi5wdXNoKGAxICR7dG90YWxIZWlnaHQgLSAoaW5kZXggLSBmaXJzdEluZGV4ICsgMSkgKiBsaW5lSGVpZ2h0fSAke3RvdGFsV2lkdGh9ICR7bGluZUhlaWdodH0gcmUgZmApOwogICAgICAgIH0KICAgICAgfQogICAgfQogICAgYnVmLnB1c2goIkJUIiwgZGVmYXVsdEFwcGVhcmFuY2UsIGAxIDAgMCAxIDAgJHt0b3RhbEhlaWdodH0gVG1gKTsKICAgIGNvbnN0IHByZXZJbmZvID0gewogICAgICBzaGlmdDogMAogICAgfTsKICAgIGZvciAobGV0IGkgPSBmaXJzdEluZGV4OyBpIDwgZW5kOyBpKyspIHsKICAgICAgY29uc3QgewogICAgICAgIGRpc3BsYXlWYWx1ZQogICAgICB9ID0gdGhpcy5kYXRhLm9wdGlvbnNbaV07CiAgICAgIGNvbnN0IHZwYWRkaW5nID0gaSA9PT0gZmlyc3RJbmRleCA/IHZQYWRkaW5nIDogMDsKICAgICAgYnVmLnB1c2godGhpcy5fcmVuZGVyVGV4dChkaXNwbGF5VmFsdWUsIGZvbnQsIGZvbnRTaXplLCB0b3RhbFdpZHRoLCAwLCBwcmV2SW5mbywgZGVmYXVsdEhQYWRkaW5nLCAtbGluZUhlaWdodCArIHZwYWRkaW5nKSk7CiAgICB9CiAgICBidWYucHVzaCgiRVQgUSBFTUMiKTsKICAgIHJldHVybiBidWYuam9pbigiXG4iKTsKICB9Cn0KY2xhc3MgU2lnbmF0dXJlV2lkZ2V0QW5ub3RhdGlvbiBleHRlbmRzIFdpZGdldEFubm90YXRpb24gewogIGNvbnN0cnVjdG9yKHBhcmFtcykgewogICAgc3VwZXIocGFyYW1zKTsKICAgIHRoaXMuZGF0YS5maWVsZFZhbHVlID0gbnVsbDsKICAgIHRoaXMuZGF0YS5oYXNPd25DYW52YXMgPSB0aGlzLmRhdGEubm9Sb3RhdGU7CiAgfQogIGdldEZpZWxkT2JqZWN0KCkgewogICAgcmV0dXJuIHsKICAgICAgaWQ6IHRoaXMuZGF0YS5pZCwKICAgICAgdmFsdWU6IG51bGwsCiAgICAgIHBhZ2U6IHRoaXMuZGF0YS5wYWdlSW5kZXgsCiAgICAgIHR5cGU6ICJzaWduYXR1cmUiCiAgICB9OwogIH0KfQpjbGFzcyBUZXh0QW5ub3RhdGlvbiBleHRlbmRzIE1hcmt1cEFubm90YXRpb24gewogIGNvbnN0cnVjdG9yKHBhcmFtcykgewogICAgY29uc3QgREVGQVVMVF9JQ09OX1NJWkUgPSAyMjsKICAgIHN1cGVyKHBhcmFtcyk7CiAgICB0aGlzLmRhdGEubm9Sb3RhdGUgPSB0cnVlOwogICAgdGhpcy5kYXRhLmhhc093bkNhbnZhcyA9IHRoaXMuZGF0YS5ub1JvdGF0ZTsKICAgIGNvbnN0IHsKICAgICAgZGljdAogICAgfSA9IHBhcmFtczsKICAgIHRoaXMuZGF0YS5hbm5vdGF0aW9uVHlwZSA9IF91dGlsLkFubm90YXRpb25UeXBlLlRFWFQ7CiAgICBpZiAodGhpcy5kYXRhLmhhc0FwcGVhcmFuY2UpIHsKICAgICAgdGhpcy5kYXRhLm5hbWUgPSAiTm9JY29uIjsKICAgIH0gZWxzZSB7CiAgICAgIHRoaXMuZGF0YS5yZWN0WzFdID0gdGhpcy5kYXRhLnJlY3RbM10gLSBERUZBVUxUX0lDT05fU0laRTsKICAgICAgdGhpcy5kYXRhLnJlY3RbMl0gPSB0aGlzLmRhdGEucmVjdFswXSArIERFRkFVTFRfSUNPTl9TSVpFOwogICAgICB0aGlzLmRhdGEubmFtZSA9IGRpY3QuaGFzKCJOYW1lIikgPyBkaWN0LmdldCgiTmFtZSIpLm5hbWUgOiAiTm90ZSI7CiAgICB9CiAgICBpZiAoZGljdC5oYXMoIlN0YXRlIikpIHsKICAgICAgdGhpcy5kYXRhLnN0YXRlID0gZGljdC5nZXQoIlN0YXRlIikgfHwgbnVsbDsKICAgICAgdGhpcy5kYXRhLnN0YXRlTW9kZWwgPSBkaWN0LmdldCgiU3RhdGVNb2RlbCIpIHx8IG51bGw7CiAgICB9IGVsc2UgewogICAgICB0aGlzLmRhdGEuc3RhdGUgPSBudWxsOwogICAgICB0aGlzLmRhdGEuc3RhdGVNb2RlbCA9IG51bGw7CiAgICB9CiAgfQp9CmNsYXNzIExpbmtBbm5vdGF0aW9uIGV4dGVuZHMgQW5ub3RhdGlvbiB7CiAgY29uc3RydWN0b3IocGFyYW1zKSB7CiAgICBzdXBlcihwYXJhbXMpOwogICAgY29uc3QgewogICAgICBkaWN0LAogICAgICBhbm5vdGF0aW9uR2xvYmFscwogICAgfSA9IHBhcmFtczsKICAgIHRoaXMuZGF0YS5hbm5vdGF0aW9uVHlwZSA9IF91dGlsLkFubm90YXRpb25UeXBlLkxJTks7CiAgICBjb25zdCBxdWFkUG9pbnRzID0gZ2V0UXVhZFBvaW50cyhkaWN0LCB0aGlzLnJlY3RhbmdsZSk7CiAgICBpZiAocXVhZFBvaW50cykgewogICAgICB0aGlzLmRhdGEucXVhZFBvaW50cyA9IHF1YWRQb2ludHM7CiAgICB9CiAgICB0aGlzLmRhdGEuYm9yZGVyQ29sb3IgfHw9IHRoaXMuZGF0YS5jb2xvcjsKICAgIF9jYXRhbG9nLkNhdGFsb2cucGFyc2VEZXN0RGljdGlvbmFyeSh7CiAgICAgIGRlc3REaWN0OiBkaWN0LAogICAgICByZXN1bHRPYmo6IHRoaXMuZGF0YSwKICAgICAgZG9jQmFzZVVybDogYW5ub3RhdGlvbkdsb2JhbHMuYmFzZVVybCwKICAgICAgZG9jQXR0YWNobWVudHM6IGFubm90YXRpb25HbG9iYWxzLmF0dGFjaG1lbnRzCiAgICB9KTsKICB9Cn0KY2xhc3MgUG9wdXBBbm5vdGF0aW9uIGV4dGVuZHMgQW5ub3RhdGlvbiB7CiAgY29uc3RydWN0b3IocGFyYW1zKSB7CiAgICBzdXBlcihwYXJhbXMpOwogICAgY29uc3QgewogICAgICBkaWN0CiAgICB9ID0gcGFyYW1zOwogICAgdGhpcy5kYXRhLmFubm90YXRpb25UeXBlID0gX3V0aWwuQW5ub3RhdGlvblR5cGUuUE9QVVA7CiAgICBpZiAodGhpcy5kYXRhLnJlY3RbMF0gPT09IHRoaXMuZGF0YS5yZWN0WzJdIHx8IHRoaXMuZGF0YS5yZWN0WzFdID09PSB0aGlzLmRhdGEucmVjdFszXSkgewogICAgICB0aGlzLmRhdGEucmVjdCA9IG51bGw7CiAgICB9CiAgICBsZXQgcGFyZW50SXRlbSA9IGRpY3QuZ2V0KCJQYXJlbnQiKTsKICAgIGlmICghcGFyZW50SXRlbSkgewogICAgICAoMCwgX3V0aWwud2FybikoIlBvcHVwIGFubm90YXRpb24gaGFzIGEgbWlzc2luZyBvciBpbnZhbGlkIHBhcmVudCBhbm5vdGF0aW9uLiIpOwogICAgICByZXR1cm47CiAgICB9CiAgICBjb25zdCBwYXJlbnRSZWN0ID0gcGFyZW50SXRlbS5nZXRBcnJheSgiUmVjdCIpOwogICAgdGhpcy5kYXRhLnBhcmVudFJlY3QgPSBBcnJheS5pc0FycmF5KHBhcmVudFJlY3QpICYmIHBhcmVudFJlY3QubGVuZ3RoID09PSA0ID8gX3V0aWwuVXRpbC5ub3JtYWxpemVSZWN0KHBhcmVudFJlY3QpIDogbnVsbDsKICAgIGNvbnN0IHJ0ID0gcGFyZW50SXRlbS5nZXQoIlJUIik7CiAgICBpZiAoKDAsIF9wcmltaXRpdmVzLmlzTmFtZSkocnQsIF91dGlsLkFubm90YXRpb25SZXBseVR5cGUuR1JPVVApKSB7CiAgICAgIHBhcmVudEl0ZW0gPSBwYXJlbnRJdGVtLmdldCgiSVJUIik7CiAgICB9CiAgICBpZiAoIXBhcmVudEl0ZW0uaGFzKCJNIikpIHsKICAgICAgdGhpcy5kYXRhLm1vZGlmaWNhdGlvbkRhdGUgPSBudWxsOwogICAgfSBlbHNlIHsKICAgICAgdGhpcy5zZXRNb2RpZmljYXRpb25EYXRlKHBhcmVudEl0ZW0uZ2V0KCJNIikpOwogICAgICB0aGlzLmRhdGEubW9kaWZpY2F0aW9uRGF0ZSA9IHRoaXMubW9kaWZpY2F0aW9uRGF0ZTsKICAgIH0KICAgIGlmICghcGFyZW50SXRlbS5oYXMoIkMiKSkgewogICAgICB0aGlzLmRhdGEuY29sb3IgPSBudWxsOwogICAgfSBlbHNlIHsKICAgICAgdGhpcy5zZXRDb2xvcihwYXJlbnRJdGVtLmdldEFycmF5KCJDIikpOwogICAgICB0aGlzLmRhdGEuY29sb3IgPSB0aGlzLmNvbG9yOwogICAgfQogICAgaWYgKCF0aGlzLnZpZXdhYmxlKSB7CiAgICAgIGNvbnN0IHBhcmVudEZsYWdzID0gcGFyZW50SXRlbS5nZXQoIkYiKTsKICAgICAgaWYgKHRoaXMuX2lzVmlld2FibGUocGFyZW50RmxhZ3MpKSB7CiAgICAgICAgdGhpcy5zZXRGbGFncyhwYXJlbnRGbGFncyk7CiAgICAgIH0KICAgIH0KICAgIHRoaXMuc2V0VGl0bGUocGFyZW50SXRlbS5nZXQoIlQiKSk7CiAgICB0aGlzLmRhdGEudGl0bGVPYmogPSB0aGlzLl90aXRsZTsKICAgIHRoaXMuc2V0Q29udGVudHMocGFyZW50SXRlbS5nZXQoIkNvbnRlbnRzIikpOwogICAgdGhpcy5kYXRhLmNvbnRlbnRzT2JqID0gdGhpcy5fY29udGVudHM7CiAgICBpZiAocGFyZW50SXRlbS5oYXMoIlJDIikpIHsKICAgICAgdGhpcy5kYXRhLnJpY2hUZXh0ID0gX2ZhY3RvcnkuWEZBRmFjdG9yeS5nZXRSaWNoVGV4dEFzSHRtbChwYXJlbnRJdGVtLmdldCgiUkMiKSk7CiAgICB9CiAgICB0aGlzLmRhdGEub3BlbiA9ICEhZGljdC5nZXQoIk9wZW4iKTsKICB9Cn0KZXhwb3J0cy5Qb3B1cEFubm90YXRpb24gPSBQb3B1cEFubm90YXRpb247CmNsYXNzIEZyZWVUZXh0QW5ub3RhdGlvbiBleHRlbmRzIE1hcmt1cEFubm90YXRpb24gewogIGNvbnN0cnVjdG9yKHBhcmFtcykgewogICAgc3VwZXIocGFyYW1zKTsKICAgIHRoaXMuZGF0YS5oYXNPd25DYW52YXMgPSB0cnVlOwogICAgY29uc3QgewogICAgICBldmFsdWF0b3JPcHRpb25zLAogICAgICB4cmVmCiAgICB9ID0gcGFyYW1zOwogICAgdGhpcy5kYXRhLmFubm90YXRpb25UeXBlID0gX3V0aWwuQW5ub3RhdGlvblR5cGUuRlJFRVRFWFQ7CiAgICB0aGlzLnNldERlZmF1bHRBcHBlYXJhbmNlKHBhcmFtcyk7CiAgICBpZiAodGhpcy5hcHBlYXJhbmNlKSB7CiAgICAgIGNvbnN0IHsKICAgICAgICBmb250Q29sb3IsCiAgICAgICAgZm9udFNpemUKICAgICAgfSA9ICgwLCBfZGVmYXVsdF9hcHBlYXJhbmNlLnBhcnNlQXBwZWFyYW5jZVN0cmVhbSkodGhpcy5hcHBlYXJhbmNlLCBldmFsdWF0b3JPcHRpb25zLCB4cmVmKTsKICAgICAgdGhpcy5kYXRhLmRlZmF1bHRBcHBlYXJhbmNlRGF0YS5mb250Q29sb3IgPSBmb250Q29sb3I7CiAgICAgIHRoaXMuZGF0YS5kZWZhdWx0QXBwZWFyYW5jZURhdGEuZm9udFNpemUgPSBmb250U2l6ZSB8fCAxMDsKICAgIH0gZWxzZSBpZiAodGhpcy5faXNPZmZzY3JlZW5DYW52YXNTdXBwb3J0ZWQpIHsKICAgICAgY29uc3Qgc3Ryb2tlQWxwaGEgPSBwYXJhbXMuZGljdC5nZXQoIkNBIik7CiAgICAgIGNvbnN0IGZha2VVbmljb2RlRm9udCA9IG5ldyBfZGVmYXVsdF9hcHBlYXJhbmNlLkZha2VVbmljb2RlRm9udCh4cmVmLCAic2Fucy1zZXJpZiIpOwogICAgICB0aGlzLmRhdGEuZGVmYXVsdEFwcGVhcmFuY2VEYXRhLmZvbnRTaXplIHx8PSAxMDsKICAgICAgY29uc3QgewogICAgICAgIGZvbnRDb2xvciwKICAgICAgICBmb250U2l6ZQogICAgICB9ID0gdGhpcy5kYXRhLmRlZmF1bHRBcHBlYXJhbmNlRGF0YTsKICAgICAgdGhpcy5hcHBlYXJhbmNlID0gZmFrZVVuaWNvZGVGb250LmNyZWF0ZUFwcGVhcmFuY2UodGhpcy5fY29udGVudHMuc3RyLCB0aGlzLnJlY3RhbmdsZSwgdGhpcy5yb3RhdGlvbiwgZm9udFNpemUsIGZvbnRDb2xvciwgc3Ryb2tlQWxwaGEpOwogICAgICB0aGlzLl9zdHJlYW1zLnB1c2godGhpcy5hcHBlYXJhbmNlLCBfZGVmYXVsdF9hcHBlYXJhbmNlLkZha2VVbmljb2RlRm9udC50b1VuaWNvZGVTdHJlYW0pOwogICAgfSBlbHNlIHsKICAgICAgKDAsIF91dGlsLndhcm4pKCJGcmVlVGV4dEFubm90YXRpb246IE9mZnNjcmVlbkNhbnZhcyBpcyBub3Qgc3VwcG9ydGVkLCBhbm5vdGF0aW9uIG1heSBub3QgcmVuZGVyIGNvcnJlY3RseS4iKTsKICAgIH0KICB9CiAgZ2V0IGhhc1RleHRDb250ZW50KCkgewogICAgcmV0dXJuICEhdGhpcy5hcHBlYXJhbmNlOwogIH0KICBzdGF0aWMgY3JlYXRlTmV3RGljdChhbm5vdGF0aW9uLCB4cmVmLCB7CiAgICBhcFJlZiwKICAgIGFwCiAgfSkgewogICAgY29uc3QgewogICAgICBjb2xvciwKICAgICAgZm9udFNpemUsCiAgICAgIHJlY3QsCiAgICAgIHJvdGF0aW9uLAogICAgICB1c2VyLAogICAgICB2YWx1ZQogICAgfSA9IGFubm90YXRpb247CiAgICBjb25zdCBmcmVldGV4dCA9IG5ldyBfcHJpbWl0aXZlcy5EaWN0KHhyZWYpOwogICAgZnJlZXRleHQuc2V0KCJUeXBlIiwgX3ByaW1pdGl2ZXMuTmFtZS5nZXQoIkFubm90IikpOwogICAgZnJlZXRleHQuc2V0KCJTdWJ0eXBlIiwgX3ByaW1pdGl2ZXMuTmFtZS5nZXQoIkZyZWVUZXh0IikpOwogICAgZnJlZXRleHQuc2V0KCJDcmVhdGlvbkRhdGUiLCBgRDokeygwLCBfdXRpbC5nZXRNb2RpZmljYXRpb25EYXRlKSgpfWApOwogICAgZnJlZXRleHQuc2V0KCJSZWN0IiwgcmVjdCk7CiAgICBjb25zdCBkYSA9IGAvSGVsdiAke2ZvbnRTaXplfSBUZiAkeygwLCBfZGVmYXVsdF9hcHBlYXJhbmNlLmdldFBkZkNvbG9yKShjb2xvciwgdHJ1ZSl9YDsKICAgIGZyZWV0ZXh0LnNldCgiREEiLCBkYSk7CiAgICBmcmVldGV4dC5zZXQoIkNvbnRlbnRzIiwgKDAsIF9jb3JlX3V0aWxzLmlzQXNjaWkpKHZhbHVlKSA/IHZhbHVlIDogKDAsIF9jb3JlX3V0aWxzLnN0cmluZ1RvVVRGMTZTdHJpbmcpKHZhbHVlLCB0cnVlKSk7CiAgICBmcmVldGV4dC5zZXQoIkYiLCA0KTsKICAgIGZyZWV0ZXh0LnNldCgiQm9yZGVyIiwgWzAsIDAsIDBdKTsKICAgIGZyZWV0ZXh0LnNldCgiUm90YXRlIiwgcm90YXRpb24pOwogICAgaWYgKHVzZXIpIHsKICAgICAgZnJlZXRleHQuc2V0KCJUIiwgKDAsIF9jb3JlX3V0aWxzLmlzQXNjaWkpKHVzZXIpID8gdXNlciA6ICgwLCBfY29yZV91dGlscy5zdHJpbmdUb1VURjE2U3RyaW5nKSh1c2VyLCB0cnVlKSk7CiAgICB9CiAgICBpZiAoYXBSZWYgfHwgYXApIHsKICAgICAgY29uc3QgbiA9IG5ldyBfcHJpbWl0aXZlcy5EaWN0KHhyZWYpOwogICAgICBmcmVldGV4dC5zZXQoIkFQIiwgbik7CiAgICAgIGlmIChhcFJlZikgewogICAgICAgIG4uc2V0KCJOIiwgYXBSZWYpOwogICAgICB9IGVsc2UgewogICAgICAgIG4uc2V0KCJOIiwgYXApOwogICAgICB9CiAgICB9CiAgICByZXR1cm4gZnJlZXRleHQ7CiAgfQogIHN0YXRpYyBhc3luYyBjcmVhdGVOZXdBcHBlYXJhbmNlU3RyZWFtKGFubm90YXRpb24sIHhyZWYsIHBhcmFtcykgewogICAgY29uc3QgewogICAgICBiYXNlRm9udFJlZiwKICAgICAgZXZhbHVhdG9yLAogICAgICB0YXNrCiAgICB9ID0gcGFyYW1zOwogICAgY29uc3QgewogICAgICBjb2xvciwKICAgICAgZm9udFNpemUsCiAgICAgIHJlY3QsCiAgICAgIHJvdGF0aW9uLAogICAgICB2YWx1ZQogICAgfSA9IGFubm90YXRpb247CiAgICBjb25zdCByZXNvdXJjZXMgPSBuZXcgX3ByaW1pdGl2ZXMuRGljdCh4cmVmKTsKICAgIGNvbnN0IGZvbnQgPSBuZXcgX3ByaW1pdGl2ZXMuRGljdCh4cmVmKTsKICAgIGlmIChiYXNlRm9udFJlZikgewogICAgICBmb250LnNldCgiSGVsdiIsIGJhc2VGb250UmVmKTsKICAgIH0gZWxzZSB7CiAgICAgIGNvbnN0IGJhc2VGb250ID0gbmV3IF9wcmltaXRpdmVzLkRpY3QoeHJlZik7CiAgICAgIGJhc2VGb250LnNldCgiQmFzZUZvbnQiLCBfcHJpbWl0aXZlcy5OYW1lLmdldCgiSGVsdmV0aWNhIikpOwogICAgICBiYXNlRm9udC5zZXQoIlR5cGUiLCBfcHJpbWl0aXZlcy5OYW1lLmdldCgiRm9udCIpKTsKICAgICAgYmFzZUZvbnQuc2V0KCJTdWJ0eXBlIiwgX3ByaW1pdGl2ZXMuTmFtZS5nZXQoIlR5cGUxIikpOwogICAgICBiYXNlRm9udC5zZXQoIkVuY29kaW5nIiwgX3ByaW1pdGl2ZXMuTmFtZS5nZXQoIldpbkFuc2lFbmNvZGluZyIpKTsKICAgICAgZm9udC5zZXQoIkhlbHYiLCBiYXNlRm9udCk7CiAgICB9CiAgICByZXNvdXJjZXMuc2V0KCJGb250IiwgZm9udCk7CiAgICBjb25zdCBoZWx2ID0gYXdhaXQgV2lkZ2V0QW5ub3RhdGlvbi5fZ2V0Rm9udERhdGEoZXZhbHVhdG9yLCB0YXNrLCB7CiAgICAgIGZvbnROYW1lOiAiSGVsdiIsCiAgICAgIGZvbnRTaXplCiAgICB9LCByZXNvdXJjZXMpOwogICAgY29uc3QgW3gxLCB5MSwgeDIsIHkyXSA9IHJlY3Q7CiAgICBsZXQgdyA9IHgyIC0geDE7CiAgICBsZXQgaCA9IHkyIC0geTE7CiAgICBpZiAocm90YXRpb24gJSAxODAgIT09IDApIHsKICAgICAgW3csIGhdID0gW2gsIHddOwogICAgfQogICAgY29uc3QgbGluZXMgPSB2YWx1ZS5zcGxpdCgiXG4iKTsKICAgIGNvbnN0IHNjYWxlID0gZm9udFNpemUgLyAxMDAwOwogICAgbGV0IHRvdGFsV2lkdGggPSAtSW5maW5pdHk7CiAgICBjb25zdCBlbmNvZGVkTGluZXMgPSBbXTsKICAgIGZvciAobGV0IGxpbmUgb2YgbGluZXMpIHsKICAgICAgY29uc3QgZW5jb2RlZCA9IGhlbHYuZW5jb2RlU3RyaW5nKGxpbmUpOwogICAgICBpZiAoZW5jb2RlZC5sZW5ndGggPiAxKSB7CiAgICAgICAgcmV0dXJuIG51bGw7CiAgICAgIH0KICAgICAgbGluZSA9IGVuY29kZWQuam9pbigiIik7CiAgICAgIGVuY29kZWRMaW5lcy5wdXNoKGxpbmUpOwogICAgICBsZXQgbGluZVdpZHRoID0gMDsKICAgICAgY29uc3QgZ2x5cGhzID0gaGVsdi5jaGFyc1RvR2x5cGhzKGxpbmUpOwogICAgICBmb3IgKGNvbnN0IGdseXBoIG9mIGdseXBocykgewogICAgICAgIGxpbmVXaWR0aCArPSBnbHlwaC53aWR0aCAqIHNjYWxlOwogICAgICB9CiAgICAgIHRvdGFsV2lkdGggPSBNYXRoLm1heCh0b3RhbFdpZHRoLCBsaW5lV2lkdGgpOwogICAgfQogICAgbGV0IGhzY2FsZSA9IDE7CiAgICBpZiAodG90YWxXaWR0aCA+IHcpIHsKICAgICAgaHNjYWxlID0gdyAvIHRvdGFsV2lkdGg7CiAgICB9CiAgICBsZXQgdnNjYWxlID0gMTsKICAgIGNvbnN0IGxpbmVIZWlnaHQgPSBfdXRpbC5MSU5FX0ZBQ1RPUiAqIGZvbnRTaXplOwogICAgY29uc3QgbGluZUFzY2VudCA9IChfdXRpbC5MSU5FX0ZBQ1RPUiAtIF91dGlsLkxJTkVfREVTQ0VOVF9GQUNUT1IpICogZm9udFNpemU7CiAgICBjb25zdCB0b3RhbEhlaWdodCA9IGxpbmVIZWlnaHQgKiBsaW5lcy5sZW5ndGg7CiAgICBpZiAodG90YWxIZWlnaHQgPiBoKSB7CiAgICAgIHZzY2FsZSA9IGggLyB0b3RhbEhlaWdodDsKICAgIH0KICAgIGNvbnN0IGZzY2FsZSA9IE1hdGgubWluKGhzY2FsZSwgdnNjYWxlKTsKICAgIGNvbnN0IG5ld0ZvbnRTaXplID0gZm9udFNpemUgKiBmc2NhbGU7CiAgICBsZXQgZmlyc3RQb2ludCwgY2xpcEJveCwgbWF0cml4OwogICAgc3dpdGNoIChyb3RhdGlvbikgewogICAgICBjYXNlIDA6CiAgICAgICAgbWF0cml4ID0gWzEsIDAsIDAsIDFdOwogICAgICAgIGNsaXBCb3ggPSBbcmVjdFswXSwgcmVjdFsxXSwgdywgaF07CiAgICAgICAgZmlyc3RQb2ludCA9IFtyZWN0WzBdLCByZWN0WzNdIC0gbGluZUFzY2VudF07CiAgICAgICAgYnJlYWs7CiAgICAgIGNhc2UgOTA6CiAgICAgICAgbWF0cml4ID0gWzAsIDEsIC0xLCAwXTsKICAgICAgICBjbGlwQm94ID0gW3JlY3RbMV0sIC1yZWN0WzJdLCB3LCBoXTsKICAgICAgICBmaXJzdFBvaW50ID0gW3JlY3RbMV0sIC1yZWN0WzBdIC0gbGluZUFzY2VudF07CiAgICAgICAgYnJlYWs7CiAgICAgIGNhc2UgMTgwOgogICAgICAgIG1hdHJpeCA9IFstMSwgMCwgMCwgLTFdOwogICAgICAgIGNsaXBCb3ggPSBbLXJlY3RbMl0sIC1yZWN0WzNdLCB3LCBoXTsKICAgICAgICBmaXJzdFBvaW50ID0gWy1yZWN0WzJdLCAtcmVjdFsxXSAtIGxpbmVBc2NlbnRdOwogICAgICAgIGJyZWFrOwogICAgICBjYXNlIDI3MDoKICAgICAgICBtYXRyaXggPSBbMCwgLTEsIDEsIDBdOwogICAgICAgIGNsaXBCb3ggPSBbLXJlY3RbM10sIHJlY3RbMF0sIHcsIGhdOwogICAgICAgIGZpcnN0UG9pbnQgPSBbLXJlY3RbM10sIHJlY3RbMl0gLSBsaW5lQXNjZW50XTsKICAgICAgICBicmVhazsKICAgIH0KICAgIGNvbnN0IGJ1ZmZlciA9IFsicSIsIGAke21hdHJpeC5qb2luKCIgIil9IDAgMCBjbWAsIGAke2NsaXBCb3guam9pbigiICIpfSByZSBXIG5gLCBgQlRgLCBgJHsoMCwgX2RlZmF1bHRfYXBwZWFyYW5jZS5nZXRQZGZDb2xvcikoY29sb3IsIHRydWUpfWAsIGAwIFRjIC9IZWx2ICR7KDAsIF9jb3JlX3V0aWxzLm51bWJlclRvU3RyaW5nKShuZXdGb250U2l6ZSl9IFRmYF07CiAgICBidWZmZXIucHVzaChgJHtmaXJzdFBvaW50LmpvaW4oIiAiKX0gVGQgKCR7KDAsIF9jb3JlX3V0aWxzLmVzY2FwZVN0cmluZykoZW5jb2RlZExpbmVzWzBdKX0pIFRqYCk7CiAgICBjb25zdCB2U2hpZnQgPSAoMCwgX2NvcmVfdXRpbHMubnVtYmVyVG9TdHJpbmcpKGxpbmVIZWlnaHQpOwogICAgZm9yIChsZXQgaSA9IDEsIGlpID0gZW5jb2RlZExpbmVzLmxlbmd0aDsgaSA8IGlpOyBpKyspIHsKICAgICAgY29uc3QgbGluZSA9IGVuY29kZWRMaW5lc1tpXTsKICAgICAgYnVmZmVyLnB1c2goYDAgLSR7dlNoaWZ0fSBUZCAoJHsoMCwgX2NvcmVfdXRpbHMuZXNjYXBlU3RyaW5nKShsaW5lKX0pIFRqYCk7CiAgICB9CiAgICBidWZmZXIucHVzaCgiRVQiLCAiUSIpOwogICAgY29uc3QgYXBwZWFyYW5jZSA9IGJ1ZmZlci5qb2luKCJcbiIpOwogICAgY29uc3QgYXBwZWFyYW5jZVN0cmVhbURpY3QgPSBuZXcgX3ByaW1pdGl2ZXMuRGljdCh4cmVmKTsKICAgIGFwcGVhcmFuY2VTdHJlYW1EaWN0LnNldCgiRm9ybVR5cGUiLCAxKTsKICAgIGFwcGVhcmFuY2VTdHJlYW1EaWN0LnNldCgiU3VidHlwZSIsIF9wcmltaXRpdmVzLk5hbWUuZ2V0KCJGb3JtIikpOwogICAgYXBwZWFyYW5jZVN0cmVhbURpY3Quc2V0KCJUeXBlIiwgX3ByaW1pdGl2ZXMuTmFtZS5nZXQoIlhPYmplY3QiKSk7CiAgICBhcHBlYXJhbmNlU3RyZWFtRGljdC5zZXQoIkJCb3giLCByZWN0KTsKICAgIGFwcGVhcmFuY2VTdHJlYW1EaWN0LnNldCgiUmVzb3VyY2VzIiwgcmVzb3VyY2VzKTsKICAgIGFwcGVhcmFuY2VTdHJlYW1EaWN0LnNldCgiTWF0cml4IiwgWzEsIDAsIDAsIDEsIC1yZWN0WzBdLCAtcmVjdFsxXV0pOwogICAgY29uc3QgYXAgPSBuZXcgX3N0cmVhbS5TdHJpbmdTdHJlYW0oYXBwZWFyYW5jZSk7CiAgICBhcC5kaWN0ID0gYXBwZWFyYW5jZVN0cmVhbURpY3Q7CiAgICByZXR1cm4gYXA7CiAgfQp9CmNsYXNzIExpbmVBbm5vdGF0aW9uIGV4dGVuZHMgTWFya3VwQW5ub3RhdGlvbiB7CiAgY29uc3RydWN0b3IocGFyYW1zKSB7CiAgICBzdXBlcihwYXJhbXMpOwogICAgY29uc3QgewogICAgICBkaWN0LAogICAgICB4cmVmCiAgICB9ID0gcGFyYW1zOwogICAgdGhpcy5kYXRhLmFubm90YXRpb25UeXBlID0gX3V0aWwuQW5ub3RhdGlvblR5cGUuTElORTsKICAgIHRoaXMuZGF0YS5oYXNPd25DYW52YXMgPSB0aGlzLmRhdGEubm9Sb3RhdGU7CiAgICBjb25zdCBsaW5lQ29vcmRpbmF0ZXMgPSBkaWN0LmdldEFycmF5KCJMIik7CiAgICB0aGlzLmRhdGEubGluZUNvb3JkaW5hdGVzID0gX3V0aWwuVXRpbC5ub3JtYWxpemVSZWN0KGxpbmVDb29yZGluYXRlcyk7CiAgICB0aGlzLnNldExpbmVFbmRpbmdzKGRpY3QuZ2V0QXJyYXkoIkxFIikpOwogICAgdGhpcy5kYXRhLmxpbmVFbmRpbmdzID0gdGhpcy5saW5lRW5kaW5nczsKICAgIGlmICghdGhpcy5hcHBlYXJhbmNlKSB7CiAgICAgIGNvbnN0IHN0cm9rZUNvbG9yID0gdGhpcy5jb2xvciA/IGdldFBkZkNvbG9yQXJyYXkodGhpcy5jb2xvcikgOiBbMCwgMCwgMF07CiAgICAgIGNvbnN0IHN0cm9rZUFscGhhID0gZGljdC5nZXQoIkNBIik7CiAgICAgIGNvbnN0IGludGVyaW9yQ29sb3IgPSBnZXRSZ2JDb2xvcihkaWN0LmdldEFycmF5KCJJQyIpLCBudWxsKTsKICAgICAgY29uc3QgZmlsbENvbG9yID0gaW50ZXJpb3JDb2xvciA/IGdldFBkZkNvbG9yQXJyYXkoaW50ZXJpb3JDb2xvcikgOiBudWxsOwogICAgICBjb25zdCBmaWxsQWxwaGEgPSBmaWxsQ29sb3IgPyBzdHJva2VBbHBoYSA6IG51bGw7CiAgICAgIGNvbnN0IGJvcmRlcldpZHRoID0gdGhpcy5ib3JkZXJTdHlsZS53aWR0aCB8fCAxLAogICAgICAgIGJvcmRlckFkanVzdCA9IDIgKiBib3JkZXJXaWR0aDsKICAgICAgY29uc3QgYmJveCA9IFt0aGlzLmRhdGEubGluZUNvb3JkaW5hdGVzWzBdIC0gYm9yZGVyQWRqdXN0LCB0aGlzLmRhdGEubGluZUNvb3JkaW5hdGVzWzFdIC0gYm9yZGVyQWRqdXN0LCB0aGlzLmRhdGEubGluZUNvb3JkaW5hdGVzWzJdICsgYm9yZGVyQWRqdXN0LCB0aGlzLmRhdGEubGluZUNvb3JkaW5hdGVzWzNdICsgYm9yZGVyQWRqdXN0XTsKICAgICAgaWYgKCFfdXRpbC5VdGlsLmludGVyc2VjdCh0aGlzLnJlY3RhbmdsZSwgYmJveCkpIHsKICAgICAgICB0aGlzLnJlY3RhbmdsZSA9IGJib3g7CiAgICAgIH0KICAgICAgdGhpcy5fc2V0RGVmYXVsdEFwcGVhcmFuY2UoewogICAgICAgIHhyZWYsCiAgICAgICAgZXh0cmE6IGAke2JvcmRlcldpZHRofSB3YCwKICAgICAgICBzdHJva2VDb2xvciwKICAgICAgICBmaWxsQ29sb3IsCiAgICAgICAgc3Ryb2tlQWxwaGEsCiAgICAgICAgZmlsbEFscGhhLAogICAgICAgIHBvaW50c0NhbGxiYWNrOiAoYnVmZmVyLCBwb2ludHMpID0+IHsKICAgICAgICAgIGJ1ZmZlci5wdXNoKGAke2xpbmVDb29yZGluYXRlc1swXX0gJHtsaW5lQ29vcmRpbmF0ZXNbMV19IG1gLCBgJHtsaW5lQ29vcmRpbmF0ZXNbMl19ICR7bGluZUNvb3JkaW5hdGVzWzNdfSBsYCwgIlMiKTsKICAgICAgICAgIHJldHVybiBbcG9pbnRzWzBdLnggLSBib3JkZXJXaWR0aCwgcG9pbnRzWzFdLnggKyBib3JkZXJXaWR0aCwgcG9pbnRzWzNdLnkgLSBib3JkZXJXaWR0aCwgcG9pbnRzWzFdLnkgKyBib3JkZXJXaWR0aF07CiAgICAgICAgfQogICAgICB9KTsKICAgIH0KICB9Cn0KY2xhc3MgU3F1YXJlQW5ub3RhdGlvbiBleHRlbmRzIE1hcmt1cEFubm90YXRpb24gewogIGNvbnN0cnVjdG9yKHBhcmFtcykgewogICAgc3VwZXIocGFyYW1zKTsKICAgIGNvbnN0IHsKICAgICAgZGljdCwKICAgICAgeHJlZgogICAgfSA9IHBhcmFtczsKICAgIHRoaXMuZGF0YS5hbm5vdGF0aW9uVHlwZSA9IF91dGlsLkFubm90YXRpb25UeXBlLlNRVUFSRTsKICAgIHRoaXMuZGF0YS5oYXNPd25DYW52YXMgPSB0aGlzLmRhdGEubm9Sb3RhdGU7CiAgICBpZiAoIXRoaXMuYXBwZWFyYW5jZSkgewogICAgICBjb25zdCBzdHJva2VDb2xvciA9IHRoaXMuY29sb3IgPyBnZXRQZGZDb2xvckFycmF5KHRoaXMuY29sb3IpIDogWzAsIDAsIDBdOwogICAgICBjb25zdCBzdHJva2VBbHBoYSA9IGRpY3QuZ2V0KCJDQSIpOwogICAgICBjb25zdCBpbnRlcmlvckNvbG9yID0gZ2V0UmdiQ29sb3IoZGljdC5nZXRBcnJheSgiSUMiKSwgbnVsbCk7CiAgICAgIGNvbnN0IGZpbGxDb2xvciA9IGludGVyaW9yQ29sb3IgPyBnZXRQZGZDb2xvckFycmF5KGludGVyaW9yQ29sb3IpIDogbnVsbDsKICAgICAgY29uc3QgZmlsbEFscGhhID0gZmlsbENvbG9yID8gc3Ryb2tlQWxwaGEgOiBudWxsOwogICAgICBpZiAodGhpcy5ib3JkZXJTdHlsZS53aWR0aCA9PT0gMCAmJiAhZmlsbENvbG9yKSB7CiAgICAgICAgcmV0dXJuOwogICAgICB9CiAgICAgIHRoaXMuX3NldERlZmF1bHRBcHBlYXJhbmNlKHsKICAgICAgICB4cmVmLAogICAgICAgIGV4dHJhOiBgJHt0aGlzLmJvcmRlclN0eWxlLndpZHRofSB3YCwKICAgICAgICBzdHJva2VDb2xvciwKICAgICAgICBmaWxsQ29sb3IsCiAgICAgICAgc3Ryb2tlQWxwaGEsCiAgICAgICAgZmlsbEFscGhhLAogICAgICAgIHBvaW50c0NhbGxiYWNrOiAoYnVmZmVyLCBwb2ludHMpID0+IHsKICAgICAgICAgIGNvbnN0IHggPSBwb2ludHNbMl0ueCArIHRoaXMuYm9yZGVyU3R5bGUud2lkdGggLyAyOwogICAgICAgICAgY29uc3QgeSA9IHBvaW50c1syXS55ICsgdGhpcy5ib3JkZXJTdHlsZS53aWR0aCAvIDI7CiAgICAgICAgICBjb25zdCB3aWR0aCA9IHBvaW50c1szXS54IC0gcG9pbnRzWzJdLnggLSB0aGlzLmJvcmRlclN0eWxlLndpZHRoOwogICAgICAgICAgY29uc3QgaGVpZ2h0ID0gcG9pbnRzWzFdLnkgLSBwb2ludHNbM10ueSAtIHRoaXMuYm9yZGVyU3R5bGUud2lkdGg7CiAgICAgICAgICBidWZmZXIucHVzaChgJHt4fSAke3l9ICR7d2lkdGh9ICR7aGVpZ2h0fSByZWApOwogICAgICAgICAgaWYgKGZpbGxDb2xvcikgewogICAgICAgICAgICBidWZmZXIucHVzaCgiQiIpOwogICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgYnVmZmVyLnB1c2goIlMiKTsKICAgICAgICAgIH0KICAgICAgICAgIHJldHVybiBbcG9pbnRzWzBdLngsIHBvaW50c1sxXS54LCBwb2ludHNbM10ueSwgcG9pbnRzWzFdLnldOwogICAgICAgIH0KICAgICAgfSk7CiAgICB9CiAgfQp9CmNsYXNzIENpcmNsZUFubm90YXRpb24gZXh0ZW5kcyBNYXJrdXBBbm5vdGF0aW9uIHsKICBjb25zdHJ1Y3RvcihwYXJhbXMpIHsKICAgIHN1cGVyKHBhcmFtcyk7CiAgICBjb25zdCB7CiAgICAgIGRpY3QsCiAgICAgIHhyZWYKICAgIH0gPSBwYXJhbXM7CiAgICB0aGlzLmRhdGEuYW5ub3RhdGlvblR5cGUgPSBfdXRpbC5Bbm5vdGF0aW9uVHlwZS5DSVJDTEU7CiAgICBpZiAoIXRoaXMuYXBwZWFyYW5jZSkgewogICAgICBjb25zdCBzdHJva2VDb2xvciA9IHRoaXMuY29sb3IgPyBnZXRQZGZDb2xvckFycmF5KHRoaXMuY29sb3IpIDogWzAsIDAsIDBdOwogICAgICBjb25zdCBzdHJva2VBbHBoYSA9IGRpY3QuZ2V0KCJDQSIpOwogICAgICBjb25zdCBpbnRlcmlvckNvbG9yID0gZ2V0UmdiQ29sb3IoZGljdC5nZXRBcnJheSgiSUMiKSwgbnVsbCk7CiAgICAgIGNvbnN0IGZpbGxDb2xvciA9IGludGVyaW9yQ29sb3IgPyBnZXRQZGZDb2xvckFycmF5KGludGVyaW9yQ29sb3IpIDogbnVsbDsKICAgICAgY29uc3QgZmlsbEFscGhhID0gZmlsbENvbG9yID8gc3Ryb2tlQWxwaGEgOiBudWxsOwogICAgICBpZiAodGhpcy5ib3JkZXJTdHlsZS53aWR0aCA9PT0gMCAmJiAhZmlsbENvbG9yKSB7CiAgICAgICAgcmV0dXJuOwogICAgICB9CiAgICAgIGNvbnN0IGNvbnRyb2xQb2ludHNEaXN0YW5jZSA9IDQgLyAzICogTWF0aC50YW4oTWF0aC5QSSAvICgyICogNCkpOwogICAgICB0aGlzLl9zZXREZWZhdWx0QXBwZWFyYW5jZSh7CiAgICAgICAgeHJlZiwKICAgICAgICBleHRyYTogYCR7dGhpcy5ib3JkZXJTdHlsZS53aWR0aH0gd2AsCiAgICAgICAgc3Ryb2tlQ29sb3IsCiAgICAgICAgZmlsbENvbG9yLAogICAgICAgIHN0cm9rZUFscGhhLAogICAgICAgIGZpbGxBbHBoYSwKICAgICAgICBwb2ludHNDYWxsYmFjazogKGJ1ZmZlciwgcG9pbnRzKSA9PiB7CiAgICAgICAgICBjb25zdCB4MCA9IHBvaW50c1swXS54ICsgdGhpcy5ib3JkZXJTdHlsZS53aWR0aCAvIDI7CiAgICAgICAgICBjb25zdCB5MCA9IHBvaW50c1swXS55IC0gdGhpcy5ib3JkZXJTdHlsZS53aWR0aCAvIDI7CiAgICAgICAgICBjb25zdCB4MSA9IHBvaW50c1szXS54IC0gdGhpcy5ib3JkZXJTdHlsZS53aWR0aCAvIDI7CiAgICAgICAgICBjb25zdCB5MSA9IHBvaW50c1szXS55ICsgdGhpcy5ib3JkZXJTdHlsZS53aWR0aCAvIDI7CiAgICAgICAgICBjb25zdCB4TWlkID0geDAgKyAoeDEgLSB4MCkgLyAyOwogICAgICAgICAgY29uc3QgeU1pZCA9IHkwICsgKHkxIC0geTApIC8gMjsKICAgICAgICAgIGNvbnN0IHhPZmZzZXQgPSAoeDEgLSB4MCkgLyAyICogY29udHJvbFBvaW50c0Rpc3RhbmNlOwogICAgICAgICAgY29uc3QgeU9mZnNldCA9ICh5MSAtIHkwKSAvIDIgKiBjb250cm9sUG9pbnRzRGlzdGFuY2U7CiAgICAgICAgICBidWZmZXIucHVzaChgJHt4TWlkfSAke3kxfSBtYCwgYCR7eE1pZCArIHhPZmZzZXR9ICR7eTF9ICR7eDF9ICR7eU1pZCArIHlPZmZzZXR9ICR7eDF9ICR7eU1pZH0gY2AsIGAke3gxfSAke3lNaWQgLSB5T2Zmc2V0fSAke3hNaWQgKyB4T2Zmc2V0fSAke3kwfSAke3hNaWR9ICR7eTB9IGNgLCBgJHt4TWlkIC0geE9mZnNldH0gJHt5MH0gJHt4MH0gJHt5TWlkIC0geU9mZnNldH0gJHt4MH0gJHt5TWlkfSBjYCwgYCR7eDB9ICR7eU1pZCArIHlPZmZzZXR9ICR7eE1pZCAtIHhPZmZzZXR9ICR7eTF9ICR7eE1pZH0gJHt5MX0gY2AsICJoIik7CiAgICAgICAgICBpZiAoZmlsbENvbG9yKSB7CiAgICAgICAgICAgIGJ1ZmZlci5wdXNoKCJCIik7CiAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICBidWZmZXIucHVzaCgiUyIpOwogICAgICAgICAgfQogICAgICAgICAgcmV0dXJuIFtwb2ludHNbMF0ueCwgcG9pbnRzWzFdLngsIHBvaW50c1szXS55LCBwb2ludHNbMV0ueV07CiAgICAgICAgfQogICAgICB9KTsKICAgIH0KICB9Cn0KY2xhc3MgUG9seWxpbmVBbm5vdGF0aW9uIGV4dGVuZHMgTWFya3VwQW5ub3RhdGlvbiB7CiAgY29uc3RydWN0b3IocGFyYW1zKSB7CiAgICBzdXBlcihwYXJhbXMpOwogICAgY29uc3QgewogICAgICBkaWN0LAogICAgICB4cmVmCiAgICB9ID0gcGFyYW1zOwogICAgdGhpcy5kYXRhLmFubm90YXRpb25UeXBlID0gX3V0aWwuQW5ub3RhdGlvblR5cGUuUE9MWUxJTkU7CiAgICB0aGlzLmRhdGEuaGFzT3duQ2FudmFzID0gdGhpcy5kYXRhLm5vUm90YXRlOwogICAgdGhpcy5kYXRhLnZlcnRpY2VzID0gW107CiAgICBpZiAoISh0aGlzIGluc3RhbmNlb2YgUG9seWdvbkFubm90YXRpb24pKSB7CiAgICAgIHRoaXMuc2V0TGluZUVuZGluZ3MoZGljdC5nZXRBcnJheSgiTEUiKSk7CiAgICAgIHRoaXMuZGF0YS5saW5lRW5kaW5ncyA9IHRoaXMubGluZUVuZGluZ3M7CiAgICB9CiAgICBjb25zdCByYXdWZXJ0aWNlcyA9IGRpY3QuZ2V0QXJyYXkoIlZlcnRpY2VzIik7CiAgICBpZiAoIUFycmF5LmlzQXJyYXkocmF3VmVydGljZXMpKSB7CiAgICAgIHJldHVybjsKICAgIH0KICAgIGZvciAobGV0IGkgPSAwLCBpaSA9IHJhd1ZlcnRpY2VzLmxlbmd0aDsgaSA8IGlpOyBpICs9IDIpIHsKICAgICAgdGhpcy5kYXRhLnZlcnRpY2VzLnB1c2goewogICAgICAgIHg6IHJhd1ZlcnRpY2VzW2ldLAogICAgICAgIHk6IHJhd1ZlcnRpY2VzW2kgKyAxXQogICAgICB9KTsKICAgIH0KICAgIGlmICghdGhpcy5hcHBlYXJhbmNlKSB7CiAgICAgIGNvbnN0IHN0cm9rZUNvbG9yID0gdGhpcy5jb2xvciA/IGdldFBkZkNvbG9yQXJyYXkodGhpcy5jb2xvcikgOiBbMCwgMCwgMF07CiAgICAgIGNvbnN0IHN0cm9rZUFscGhhID0gZGljdC5nZXQoIkNBIik7CiAgICAgIGNvbnN0IGJvcmRlcldpZHRoID0gdGhpcy5ib3JkZXJTdHlsZS53aWR0aCB8fCAxLAogICAgICAgIGJvcmRlckFkanVzdCA9IDIgKiBib3JkZXJXaWR0aDsKICAgICAgY29uc3QgYmJveCA9IFtJbmZpbml0eSwgSW5maW5pdHksIC1JbmZpbml0eSwgLUluZmluaXR5XTsKICAgICAgZm9yIChjb25zdCB2ZXJ0ZXggb2YgdGhpcy5kYXRhLnZlcnRpY2VzKSB7CiAgICAgICAgYmJveFswXSA9IE1hdGgubWluKGJib3hbMF0sIHZlcnRleC54IC0gYm9yZGVyQWRqdXN0KTsKICAgICAgICBiYm94WzFdID0gTWF0aC5taW4oYmJveFsxXSwgdmVydGV4LnkgLSBib3JkZXJBZGp1c3QpOwogICAgICAgIGJib3hbMl0gPSBNYXRoLm1heChiYm94WzJdLCB2ZXJ0ZXgueCArIGJvcmRlckFkanVzdCk7CiAgICAgICAgYmJveFszXSA9IE1hdGgubWF4KGJib3hbM10sIHZlcnRleC55ICsgYm9yZGVyQWRqdXN0KTsKICAgICAgfQogICAgICBpZiAoIV91dGlsLlV0aWwuaW50ZXJzZWN0KHRoaXMucmVjdGFuZ2xlLCBiYm94KSkgewogICAgICAgIHRoaXMucmVjdGFuZ2xlID0gYmJveDsKICAgICAgfQogICAgICB0aGlzLl9zZXREZWZhdWx0QXBwZWFyYW5jZSh7CiAgICAgICAgeHJlZiwKICAgICAgICBleHRyYTogYCR7Ym9yZGVyV2lkdGh9IHdgLAogICAgICAgIHN0cm9rZUNvbG9yLAogICAgICAgIHN0cm9rZUFscGhhLAogICAgICAgIHBvaW50c0NhbGxiYWNrOiAoYnVmZmVyLCBwb2ludHMpID0+IHsKICAgICAgICAgIGNvbnN0IHZlcnRpY2VzID0gdGhpcy5kYXRhLnZlcnRpY2VzOwogICAgICAgICAgZm9yIChsZXQgaSA9IDAsIGlpID0gdmVydGljZXMubGVuZ3RoOyBpIDwgaWk7IGkrKykgewogICAgICAgICAgICBidWZmZXIucHVzaChgJHt2ZXJ0aWNlc1tpXS54fSAke3ZlcnRpY2VzW2ldLnl9ICR7aSA9PT0gMCA/ICJtIiA6ICJsIn1gKTsKICAgICAgICAgIH0KICAgICAgICAgIGJ1ZmZlci5wdXNoKCJTIik7CiAgICAgICAgICByZXR1cm4gW3BvaW50c1swXS54LCBwb2ludHNbMV0ueCwgcG9pbnRzWzNdLnksIHBvaW50c1sxXS55XTsKICAgICAgICB9CiAgICAgIH0pOwogICAgfQogIH0KfQpjbGFzcyBQb2x5Z29uQW5ub3RhdGlvbiBleHRlbmRzIFBvbHlsaW5lQW5ub3RhdGlvbiB7CiAgY29uc3RydWN0b3IocGFyYW1zKSB7CiAgICBzdXBlcihwYXJhbXMpOwogICAgdGhpcy5kYXRhLmFubm90YXRpb25UeXBlID0gX3V0aWwuQW5ub3RhdGlvblR5cGUuUE9MWUdPTjsKICB9Cn0KY2xhc3MgQ2FyZXRBbm5vdGF0aW9uIGV4dGVuZHMgTWFya3VwQW5ub3RhdGlvbiB7CiAgY29uc3RydWN0b3IocGFyYW1zKSB7CiAgICBzdXBlcihwYXJhbXMpOwogICAgdGhpcy5kYXRhLmFubm90YXRpb25UeXBlID0gX3V0aWwuQW5ub3RhdGlvblR5cGUuQ0FSRVQ7CiAgfQp9CmNsYXNzIElua0Fubm90YXRpb24gZXh0ZW5kcyBNYXJrdXBBbm5vdGF0aW9uIHsKICBjb25zdHJ1Y3RvcihwYXJhbXMpIHsKICAgIHN1cGVyKHBhcmFtcyk7CiAgICB0aGlzLmRhdGEuaGFzT3duQ2FudmFzID0gdGhpcy5kYXRhLm5vUm90YXRlOwogICAgY29uc3QgewogICAgICBkaWN0LAogICAgICB4cmVmCiAgICB9ID0gcGFyYW1zOwogICAgdGhpcy5kYXRhLmFubm90YXRpb25UeXBlID0gX3V0aWwuQW5ub3RhdGlvblR5cGUuSU5LOwogICAgdGhpcy5kYXRhLmlua0xpc3RzID0gW107CiAgICBjb25zdCByYXdJbmtMaXN0cyA9IGRpY3QuZ2V0QXJyYXkoIklua0xpc3QiKTsKICAgIGlmICghQXJyYXkuaXNBcnJheShyYXdJbmtMaXN0cykpIHsKICAgICAgcmV0dXJuOwogICAgfQogICAgZm9yIChsZXQgaSA9IDAsIGlpID0gcmF3SW5rTGlzdHMubGVuZ3RoOyBpIDwgaWk7ICsraSkgewogICAgICB0aGlzLmRhdGEuaW5rTGlzdHMucHVzaChbXSk7CiAgICAgIGZvciAobGV0IGogPSAwLCBqaiA9IHJhd0lua0xpc3RzW2ldLmxlbmd0aDsgaiA8IGpqOyBqICs9IDIpIHsKICAgICAgICB0aGlzLmRhdGEuaW5rTGlzdHNbaV0ucHVzaCh7CiAgICAgICAgICB4OiB4cmVmLmZldGNoSWZSZWYocmF3SW5rTGlzdHNbaV1bal0pLAogICAgICAgICAgeTogeHJlZi5mZXRjaElmUmVmKHJhd0lua0xpc3RzW2ldW2ogKyAxXSkKICAgICAgICB9KTsKICAgICAgfQogICAgfQogICAgaWYgKCF0aGlzLmFwcGVhcmFuY2UpIHsKICAgICAgY29uc3Qgc3Ryb2tlQ29sb3IgPSB0aGlzLmNvbG9yID8gZ2V0UGRmQ29sb3JBcnJheSh0aGlzLmNvbG9yKSA6IFswLCAwLCAwXTsKICAgICAgY29uc3Qgc3Ryb2tlQWxwaGEgPSBkaWN0LmdldCgiQ0EiKTsKICAgICAgY29uc3QgYm9yZGVyV2lkdGggPSB0aGlzLmJvcmRlclN0eWxlLndpZHRoIHx8IDEsCiAgICAgICAgYm9yZGVyQWRqdXN0ID0gMiAqIGJvcmRlcldpZHRoOwogICAgICBjb25zdCBiYm94ID0gW0luZmluaXR5LCBJbmZpbml0eSwgLUluZmluaXR5LCAtSW5maW5pdHldOwogICAgICBmb3IgKGNvbnN0IGlua0xpc3RzIG9mIHRoaXMuZGF0YS5pbmtMaXN0cykgewogICAgICAgIGZvciAoY29uc3QgdmVydGV4IG9mIGlua0xpc3RzKSB7CiAgICAgICAgICBiYm94WzBdID0gTWF0aC5taW4oYmJveFswXSwgdmVydGV4LnggLSBib3JkZXJBZGp1c3QpOwogICAgICAgICAgYmJveFsxXSA9IE1hdGgubWluKGJib3hbMV0sIHZlcnRleC55IC0gYm9yZGVyQWRqdXN0KTsKICAgICAgICAgIGJib3hbMl0gPSBNYXRoLm1heChiYm94WzJdLCB2ZXJ0ZXgueCArIGJvcmRlckFkanVzdCk7CiAgICAgICAgICBiYm94WzNdID0gTWF0aC5tYXgoYmJveFszXSwgdmVydGV4LnkgKyBib3JkZXJBZGp1c3QpOwogICAgICAgIH0KICAgICAgfQogICAgICBpZiAoIV91dGlsLlV0aWwuaW50ZXJzZWN0KHRoaXMucmVjdGFuZ2xlLCBiYm94KSkgewogICAgICAgIHRoaXMucmVjdGFuZ2xlID0gYmJveDsKICAgICAgfQogICAgICB0aGlzLl9zZXREZWZhdWx0QXBwZWFyYW5jZSh7CiAgICAgICAgeHJlZiwKICAgICAgICBleHRyYTogYCR7Ym9yZGVyV2lkdGh9IHdgLAogICAgICAgIHN0cm9rZUNvbG9yLAogICAgICAgIHN0cm9rZUFscGhhLAogICAgICAgIHBvaW50c0NhbGxiYWNrOiAoYnVmZmVyLCBwb2ludHMpID0+IHsKICAgICAgICAgIGZvciAoY29uc3QgaW5rTGlzdCBvZiB0aGlzLmRhdGEuaW5rTGlzdHMpIHsKICAgICAgICAgICAgZm9yIChsZXQgaSA9IDAsIGlpID0gaW5rTGlzdC5sZW5ndGg7IGkgPCBpaTsgaSsrKSB7CiAgICAgICAgICAgICAgYnVmZmVyLnB1c2goYCR7aW5rTGlzdFtpXS54fSAke2lua0xpc3RbaV0ueX0gJHtpID09PSAwID8gIm0iIDogImwifWApOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGJ1ZmZlci5wdXNoKCJTIik7CiAgICAgICAgICB9CiAgICAgICAgICByZXR1cm4gW3BvaW50c1swXS54LCBwb2ludHNbMV0ueCwgcG9pbnRzWzNdLnksIHBvaW50c1sxXS55XTsKICAgICAgICB9CiAgICAgIH0pOwogICAgfQogIH0KICBzdGF0aWMgY3JlYXRlTmV3RGljdChhbm5vdGF0aW9uLCB4cmVmLCB7CiAgICBhcFJlZiwKICAgIGFwCiAgfSkgewogICAgY29uc3QgewogICAgICBjb2xvciwKICAgICAgb3BhY2l0eSwKICAgICAgcGF0aHMsCiAgICAgIHJlY3QsCiAgICAgIHJvdGF0aW9uLAogICAgICB0aGlja25lc3MKICAgIH0gPSBhbm5vdGF0aW9uOwogICAgY29uc3QgaW5rID0gbmV3IF9wcmltaXRpdmVzLkRpY3QoeHJlZik7CiAgICBpbmsuc2V0KCJUeXBlIiwgX3ByaW1pdGl2ZXMuTmFtZS5nZXQoIkFubm90IikpOwogICAgaW5rLnNldCgiU3VidHlwZSIsIF9wcmltaXRpdmVzLk5hbWUuZ2V0KCJJbmsiKSk7CiAgICBpbmsuc2V0KCJDcmVhdGlvbkRhdGUiLCBgRDokeygwLCBfdXRpbC5nZXRNb2RpZmljYXRpb25EYXRlKSgpfWApOwogICAgaW5rLnNldCgiUmVjdCIsIHJlY3QpOwogICAgaW5rLnNldCgiSW5rTGlzdCIsIHBhdGhzLm1hcChwID0+IHAucG9pbnRzKSk7CiAgICBpbmsuc2V0KCJGIiwgNCk7CiAgICBpbmsuc2V0KCJSb3RhdGUiLCByb3RhdGlvbik7CiAgICBjb25zdCBicyA9IG5ldyBfcHJpbWl0aXZlcy5EaWN0KHhyZWYpOwogICAgaW5rLnNldCgiQlMiLCBicyk7CiAgICBicy5zZXQoIlciLCB0aGlja25lc3MpOwogICAgaW5rLnNldCgiQyIsIEFycmF5LmZyb20oY29sb3IsIGMgPT4gYyAvIDI1NSkpOwogICAgaW5rLnNldCgiQ0EiLCBvcGFjaXR5KTsKICAgIGNvbnN0IG4gPSBuZXcgX3ByaW1pdGl2ZXMuRGljdCh4cmVmKTsKICAgIGluay5zZXQoIkFQIiwgbik7CiAgICBpZiAoYXBSZWYpIHsKICAgICAgbi5zZXQoIk4iLCBhcFJlZik7CiAgICB9IGVsc2UgewogICAgICBuLnNldCgiTiIsIGFwKTsKICAgIH0KICAgIHJldHVybiBpbms7CiAgfQogIHN0YXRpYyBhc3luYyBjcmVhdGVOZXdBcHBlYXJhbmNlU3RyZWFtKGFubm90YXRpb24sIHhyZWYsIHBhcmFtcykgewogICAgY29uc3QgewogICAgICBjb2xvciwKICAgICAgcmVjdCwKICAgICAgcGF0aHMsCiAgICAgIHRoaWNrbmVzcywKICAgICAgb3BhY2l0eQogICAgfSA9IGFubm90YXRpb247CiAgICBjb25zdCBhcHBlYXJhbmNlQnVmZmVyID0gW2Ake3RoaWNrbmVzc30gdyAxIEogMSBqYCwgYCR7KDAsIF9kZWZhdWx0X2FwcGVhcmFuY2UuZ2V0UGRmQ29sb3IpKGNvbG9yLCBmYWxzZSl9YF07CiAgICBpZiAob3BhY2l0eSAhPT0gMSkgewogICAgICBhcHBlYXJhbmNlQnVmZmVyLnB1c2goIi9SMCBncyIpOwogICAgfQogICAgY29uc3QgYnVmZmVyID0gW107CiAgICBmb3IgKGNvbnN0IHsKICAgICAgYmV6aWVyCiAgICB9IG9mIHBhdGhzKSB7CiAgICAgIGJ1ZmZlci5sZW5ndGggPSAwOwogICAgICBidWZmZXIucHVzaChgJHsoMCwgX2NvcmVfdXRpbHMubnVtYmVyVG9TdHJpbmcpKGJlemllclswXSl9ICR7KDAsIF9jb3JlX3V0aWxzLm51bWJlclRvU3RyaW5nKShiZXppZXJbMV0pfSBtYCk7CiAgICAgIGZvciAobGV0IGkgPSAyLCBpaSA9IGJlemllci5sZW5ndGg7IGkgPCBpaTsgaSArPSA2KSB7CiAgICAgICAgY29uc3QgY3VydmUgPSBiZXppZXIuc2xpY2UoaSwgaSArIDYpLm1hcChfY29yZV91dGlscy5udW1iZXJUb1N0cmluZykuam9pbigiICIpOwogICAgICAgIGJ1ZmZlci5wdXNoKGAke2N1cnZlfSBjYCk7CiAgICAgIH0KICAgICAgYnVmZmVyLnB1c2goIlMiKTsKICAgICAgYXBwZWFyYW5jZUJ1ZmZlci5wdXNoKGJ1ZmZlci5qb2luKCJcbiIpKTsKICAgIH0KICAgIGNvbnN0IGFwcGVhcmFuY2UgPSBhcHBlYXJhbmNlQnVmZmVyLmpvaW4oIlxuIik7CiAgICBjb25zdCBhcHBlYXJhbmNlU3RyZWFtRGljdCA9IG5ldyBfcHJpbWl0aXZlcy5EaWN0KHhyZWYpOwogICAgYXBwZWFyYW5jZVN0cmVhbURpY3Quc2V0KCJGb3JtVHlwZSIsIDEpOwogICAgYXBwZWFyYW5jZVN0cmVhbURpY3Quc2V0KCJTdWJ0eXBlIiwgX3ByaW1pdGl2ZXMuTmFtZS5nZXQoIkZvcm0iKSk7CiAgICBhcHBlYXJhbmNlU3RyZWFtRGljdC5zZXQoIlR5cGUiLCBfcHJpbWl0aXZlcy5OYW1lLmdldCgiWE9iamVjdCIpKTsKICAgIGFwcGVhcmFuY2VTdHJlYW1EaWN0LnNldCgiQkJveCIsIHJlY3QpOwogICAgYXBwZWFyYW5jZVN0cmVhbURpY3Quc2V0KCJMZW5ndGgiLCBhcHBlYXJhbmNlLmxlbmd0aCk7CiAgICBpZiAob3BhY2l0eSAhPT0gMSkgewogICAgICBjb25zdCByZXNvdXJjZXMgPSBuZXcgX3ByaW1pdGl2ZXMuRGljdCh4cmVmKTsKICAgICAgY29uc3QgZXh0R1N0YXRlID0gbmV3IF9wcmltaXRpdmVzLkRpY3QoeHJlZik7CiAgICAgIGNvbnN0IHIwID0gbmV3IF9wcmltaXRpdmVzLkRpY3QoeHJlZik7CiAgICAgIHIwLnNldCgiQ0EiLCBvcGFjaXR5KTsKICAgICAgcjAuc2V0KCJUeXBlIiwgX3ByaW1pdGl2ZXMuTmFtZS5nZXQoIkV4dEdTdGF0ZSIpKTsKICAgICAgZXh0R1N0YXRlLnNldCgiUjAiLCByMCk7CiAgICAgIHJlc291cmNlcy5zZXQoIkV4dEdTdGF0ZSIsIGV4dEdTdGF0ZSk7CiAgICAgIGFwcGVhcmFuY2VTdHJlYW1EaWN0LnNldCgiUmVzb3VyY2VzIiwgcmVzb3VyY2VzKTsKICAgIH0KICAgIGNvbnN0IGFwID0gbmV3IF9zdHJlYW0uU3RyaW5nU3RyZWFtKGFwcGVhcmFuY2UpOwogICAgYXAuZGljdCA9IGFwcGVhcmFuY2VTdHJlYW1EaWN0OwogICAgcmV0dXJuIGFwOwogIH0KfQpjbGFzcyBIaWdobGlnaHRBbm5vdGF0aW9uIGV4dGVuZHMgTWFya3VwQW5ub3RhdGlvbiB7CiAgY29uc3RydWN0b3IocGFyYW1zKSB7CiAgICBzdXBlcihwYXJhbXMpOwogICAgY29uc3QgewogICAgICBkaWN0LAogICAgICB4cmVmCiAgICB9ID0gcGFyYW1zOwogICAgdGhpcy5kYXRhLmFubm90YXRpb25UeXBlID0gX3V0aWwuQW5ub3RhdGlvblR5cGUuSElHSExJR0hUOwogICAgY29uc3QgcXVhZFBvaW50cyA9IHRoaXMuZGF0YS5xdWFkUG9pbnRzID0gZ2V0UXVhZFBvaW50cyhkaWN0LCBudWxsKTsKICAgIGlmIChxdWFkUG9pbnRzKSB7CiAgICAgIGNvbnN0IHJlc291cmNlcyA9IHRoaXMuYXBwZWFyYW5jZT8uZGljdC5nZXQoIlJlc291cmNlcyIpOwogICAgICBpZiAoIXRoaXMuYXBwZWFyYW5jZSB8fCAhcmVzb3VyY2VzPy5oYXMoIkV4dEdTdGF0ZSIpKSB7CiAgICAgICAgaWYgKHRoaXMuYXBwZWFyYW5jZSkgewogICAgICAgICAgKDAsIF91dGlsLndhcm4pKCJIaWdobGlnaHRBbm5vdGF0aW9uIC0gaWdub3JpbmcgYnVpbHQtaW4gYXBwZWFyYW5jZSBzdHJlYW0uIik7CiAgICAgICAgfQogICAgICAgIGNvbnN0IGZpbGxDb2xvciA9IHRoaXMuY29sb3IgPyBnZXRQZGZDb2xvckFycmF5KHRoaXMuY29sb3IpIDogWzEsIDEsIDBdOwogICAgICAgIGNvbnN0IGZpbGxBbHBoYSA9IGRpY3QuZ2V0KCJDQSIpOwogICAgICAgIHRoaXMuX3NldERlZmF1bHRBcHBlYXJhbmNlKHsKICAgICAgICAgIHhyZWYsCiAgICAgICAgICBmaWxsQ29sb3IsCiAgICAgICAgICBibGVuZE1vZGU6ICJNdWx0aXBseSIsCiAgICAgICAgICBmaWxsQWxwaGEsCiAgICAgICAgICBwb2ludHNDYWxsYmFjazogKGJ1ZmZlciwgcG9pbnRzKSA9PiB7CiAgICAgICAgICAgIGJ1ZmZlci5wdXNoKGAke3BvaW50c1swXS54fSAke3BvaW50c1swXS55fSBtYCwgYCR7cG9pbnRzWzFdLnh9ICR7cG9pbnRzWzFdLnl9IGxgLCBgJHtwb2ludHNbM10ueH0gJHtwb2ludHNbM10ueX0gbGAsIGAke3BvaW50c1syXS54fSAke3BvaW50c1syXS55fSBsYCwgImYiKTsKICAgICAgICAgICAgcmV0dXJuIFtwb2ludHNbMF0ueCwgcG9pbnRzWzFdLngsIHBvaW50c1szXS55LCBwb2ludHNbMV0ueV07CiAgICAgICAgICB9CiAgICAgICAgfSk7CiAgICAgIH0KICAgIH0gZWxzZSB7CiAgICAgIHRoaXMuZGF0YS5wb3B1cFJlZiA9IG51bGw7CiAgICB9CiAgfQp9CmNsYXNzIFVuZGVybGluZUFubm90YXRpb24gZXh0ZW5kcyBNYXJrdXBBbm5vdGF0aW9uIHsKICBjb25zdHJ1Y3RvcihwYXJhbXMpIHsKICAgIHN1cGVyKHBhcmFtcyk7CiAgICBjb25zdCB7CiAgICAgIGRpY3QsCiAgICAgIHhyZWYKICAgIH0gPSBwYXJhbXM7CiAgICB0aGlzLmRhdGEuYW5ub3RhdGlvblR5cGUgPSBfdXRpbC5Bbm5vdGF0aW9uVHlwZS5VTkRFUkxJTkU7CiAgICBjb25zdCBxdWFkUG9pbnRzID0gdGhpcy5kYXRhLnF1YWRQb2ludHMgPSBnZXRRdWFkUG9pbnRzKGRpY3QsIG51bGwpOwogICAgaWYgKHF1YWRQb2ludHMpIHsKICAgICAgaWYgKCF0aGlzLmFwcGVhcmFuY2UpIHsKICAgICAgICBjb25zdCBzdHJva2VDb2xvciA9IHRoaXMuY29sb3IgPyBnZXRQZGZDb2xvckFycmF5KHRoaXMuY29sb3IpIDogWzAsIDAsIDBdOwogICAgICAgIGNvbnN0IHN0cm9rZUFscGhhID0gZGljdC5nZXQoIkNBIik7CiAgICAgICAgdGhpcy5fc2V0RGVmYXVsdEFwcGVhcmFuY2UoewogICAgICAgICAgeHJlZiwKICAgICAgICAgIGV4dHJhOiAiW10gMCBkIDAuNTcxIHciLAogICAgICAgICAgc3Ryb2tlQ29sb3IsCiAgICAgICAgICBzdHJva2VBbHBoYSwKICAgICAgICAgIHBvaW50c0NhbGxiYWNrOiAoYnVmZmVyLCBwb2ludHMpID0+IHsKICAgICAgICAgICAgYnVmZmVyLnB1c2goYCR7cG9pbnRzWzJdLnh9ICR7cG9pbnRzWzJdLnkgKyAxLjN9IG1gLCBgJHtwb2ludHNbM10ueH0gJHtwb2ludHNbM10ueSArIDEuM30gbGAsICJTIik7CiAgICAgICAgICAgIHJldHVybiBbcG9pbnRzWzBdLngsIHBvaW50c1sxXS54LCBwb2ludHNbM10ueSwgcG9pbnRzWzFdLnldOwogICAgICAgICAgfQogICAgICAgIH0pOwogICAgICB9CiAgICB9IGVsc2UgewogICAgICB0aGlzLmRhdGEucG9wdXBSZWYgPSBudWxsOwogICAgfQogIH0KfQpjbGFzcyBTcXVpZ2dseUFubm90YXRpb24gZXh0ZW5kcyBNYXJrdXBBbm5vdGF0aW9uIHsKICBjb25zdHJ1Y3RvcihwYXJhbXMpIHsKICAgIHN1cGVyKHBhcmFtcyk7CiAgICBjb25zdCB7CiAgICAgIGRpY3QsCiAgICAgIHhyZWYKICAgIH0gPSBwYXJhbXM7CiAgICB0aGlzLmRhdGEuYW5ub3RhdGlvblR5cGUgPSBfdXRpbC5Bbm5vdGF0aW9uVHlwZS5TUVVJR0dMWTsKICAgIGNvbnN0IHF1YWRQb2ludHMgPSB0aGlzLmRhdGEucXVhZFBvaW50cyA9IGdldFF1YWRQb2ludHMoZGljdCwgbnVsbCk7CiAgICBpZiAocXVhZFBvaW50cykgewogICAgICBpZiAoIXRoaXMuYXBwZWFyYW5jZSkgewogICAgICAgIGNvbnN0IHN0cm9rZUNvbG9yID0gdGhpcy5jb2xvciA/IGdldFBkZkNvbG9yQXJyYXkodGhpcy5jb2xvcikgOiBbMCwgMCwgMF07CiAgICAgICAgY29uc3Qgc3Ryb2tlQWxwaGEgPSBkaWN0LmdldCgiQ0EiKTsKICAgICAgICB0aGlzLl9zZXREZWZhdWx0QXBwZWFyYW5jZSh7CiAgICAgICAgICB4cmVmLAogICAgICAgICAgZXh0cmE6ICJbXSAwIGQgMSB3IiwKICAgICAgICAgIHN0cm9rZUNvbG9yLAogICAgICAgICAgc3Ryb2tlQWxwaGEsCiAgICAgICAgICBwb2ludHNDYWxsYmFjazogKGJ1ZmZlciwgcG9pbnRzKSA9PiB7CiAgICAgICAgICAgIGNvbnN0IGR5ID0gKHBvaW50c1swXS55IC0gcG9pbnRzWzJdLnkpIC8gNjsKICAgICAgICAgICAgbGV0IHNoaWZ0ID0gZHk7CiAgICAgICAgICAgIGxldCB4ID0gcG9pbnRzWzJdLng7CiAgICAgICAgICAgIGNvbnN0IHkgPSBwb2ludHNbMl0ueTsKICAgICAgICAgICAgY29uc3QgeEVuZCA9IHBvaW50c1szXS54OwogICAgICAgICAgICBidWZmZXIucHVzaChgJHt4fSAke3kgKyBzaGlmdH0gbWApOwogICAgICAgICAgICBkbyB7CiAgICAgICAgICAgICAgeCArPSAyOwogICAgICAgICAgICAgIHNoaWZ0ID0gc2hpZnQgPT09IDAgPyBkeSA6IDA7CiAgICAgICAgICAgICAgYnVmZmVyLnB1c2goYCR7eH0gJHt5ICsgc2hpZnR9IGxgKTsKICAgICAgICAgICAgfSB3aGlsZSAoeCA8IHhFbmQpOwogICAgICAgICAgICBidWZmZXIucHVzaCgiUyIpOwogICAgICAgICAgICByZXR1cm4gW3BvaW50c1syXS54LCB4RW5kLCB5IC0gMiAqIGR5LCB5ICsgMiAqIGR5XTsKICAgICAgICAgIH0KICAgICAgICB9KTsKICAgICAgfQogICAgfSBlbHNlIHsKICAgICAgdGhpcy5kYXRhLnBvcHVwUmVmID0gbnVsbDsKICAgIH0KICB9Cn0KY2xhc3MgU3RyaWtlT3V0QW5ub3RhdGlvbiBleHRlbmRzIE1hcmt1cEFubm90YXRpb24gewogIGNvbnN0cnVjdG9yKHBhcmFtcykgewogICAgc3VwZXIocGFyYW1zKTsKICAgIGNvbnN0IHsKICAgICAgZGljdCwKICAgICAgeHJlZgogICAgfSA9IHBhcmFtczsKICAgIHRoaXMuZGF0YS5hbm5vdGF0aW9uVHlwZSA9IF91dGlsLkFubm90YXRpb25UeXBlLlNUUklLRU9VVDsKICAgIGNvbnN0IHF1YWRQb2ludHMgPSB0aGlzLmRhdGEucXVhZFBvaW50cyA9IGdldFF1YWRQb2ludHMoZGljdCwgbnVsbCk7CiAgICBpZiAocXVhZFBvaW50cykgewogICAgICBpZiAoIXRoaXMuYXBwZWFyYW5jZSkgewogICAgICAgIGNvbnN0IHN0cm9rZUNvbG9yID0gdGhpcy5jb2xvciA/IGdldFBkZkNvbG9yQXJyYXkodGhpcy5jb2xvcikgOiBbMCwgMCwgMF07CiAgICAgICAgY29uc3Qgc3Ryb2tlQWxwaGEgPSBkaWN0LmdldCgiQ0EiKTsKICAgICAgICB0aGlzLl9zZXREZWZhdWx0QXBwZWFyYW5jZSh7CiAgICAgICAgICB4cmVmLAogICAgICAgICAgZXh0cmE6ICJbXSAwIGQgMSB3IiwKICAgICAgICAgIHN0cm9rZUNvbG9yLAogICAgICAgICAgc3Ryb2tlQWxwaGEsCiAgICAgICAgICBwb2ludHNDYWxsYmFjazogKGJ1ZmZlciwgcG9pbnRzKSA9PiB7CiAgICAgICAgICAgIGJ1ZmZlci5wdXNoKGAkeyhwb2ludHNbMF0ueCArIHBvaW50c1syXS54KSAvIDJ9IGAgKyBgJHsocG9pbnRzWzBdLnkgKyBwb2ludHNbMl0ueSkgLyAyfSBtYCwgYCR7KHBvaW50c1sxXS54ICsgcG9pbnRzWzNdLngpIC8gMn0gYCArIGAkeyhwb2ludHNbMV0ueSArIHBvaW50c1szXS55KSAvIDJ9IGxgLCAiUyIpOwogICAgICAgICAgICByZXR1cm4gW3BvaW50c1swXS54LCBwb2ludHNbMV0ueCwgcG9pbnRzWzNdLnksIHBvaW50c1sxXS55XTsKICAgICAgICAgIH0KICAgICAgICB9KTsKICAgICAgfQogICAgfSBlbHNlIHsKICAgICAgdGhpcy5kYXRhLnBvcHVwUmVmID0gbnVsbDsKICAgIH0KICB9Cn0KY2xhc3MgU3RhbXBBbm5vdGF0aW9uIGV4dGVuZHMgTWFya3VwQW5ub3RhdGlvbiB7CiAgY29uc3RydWN0b3IocGFyYW1zKSB7CiAgICBzdXBlcihwYXJhbXMpOwogICAgdGhpcy5kYXRhLmFubm90YXRpb25UeXBlID0gX3V0aWwuQW5ub3RhdGlvblR5cGUuU1RBTVA7CiAgICB0aGlzLmRhdGEuaGFzT3duQ2FudmFzID0gdGhpcy5kYXRhLm5vUm90YXRlOwogIH0KICBzdGF0aWMgYXN5bmMgY3JlYXRlSW1hZ2UoYml0bWFwLCB4cmVmKSB7CiAgICBjb25zdCB7CiAgICAgIHdpZHRoLAogICAgICBoZWlnaHQKICAgIH0gPSBiaXRtYXA7CiAgICBjb25zdCBjYW52YXMgPSBuZXcgT2Zmc2NyZWVuQ2FudmFzKHdpZHRoLCBoZWlnaHQpOwogICAgY29uc3QgY3R4ID0gY2FudmFzLmdldENvbnRleHQoIjJkIiwgewogICAgICBhbHBoYTogdHJ1ZQogICAgfSk7CiAgICBjdHguZHJhd0ltYWdlKGJpdG1hcCwgMCwgMCk7CiAgICBjb25zdCBkYXRhID0gY3R4LmdldEltYWdlRGF0YSgwLCAwLCB3aWR0aCwgaGVpZ2h0KS5kYXRhOwogICAgY29uc3QgYnVmMzIgPSBuZXcgVWludDMyQXJyYXkoZGF0YS5idWZmZXIpOwogICAgY29uc3QgaGFzQWxwaGEgPSBidWYzMi5zb21lKF91dGlsLkZlYXR1cmVUZXN0LmlzTGl0dGxlRW5kaWFuID8geCA9PiB4ID4+PiAyNCAhPT0gMHhmZiA6IHggPT4gKHggJiAweGZmKSAhPT0gMHhmZik7CiAgICBpZiAoaGFzQWxwaGEpIHsKICAgICAgY3R4LmZpbGxTdHlsZSA9ICJ3aGl0ZSI7CiAgICAgIGN0eC5maWxsUmVjdCgwLCAwLCB3aWR0aCwgaGVpZ2h0KTsKICAgICAgY3R4LmRyYXdJbWFnZShiaXRtYXAsIDAsIDApOwogICAgfQogICAgY29uc3QganBlZ0J1ZmZlclByb21pc2UgPSBjYW52YXMuY29udmVydFRvQmxvYih7CiAgICAgIHR5cGU6ICJpbWFnZS9qcGVnIiwKICAgICAgcXVhbGl0eTogMQogICAgfSkudGhlbihibG9iID0+IHsKICAgICAgcmV0dXJuIGJsb2IuYXJyYXlCdWZmZXIoKTsKICAgIH0pOwogICAgY29uc3QgeG9iamVjdE5hbWUgPSBfcHJpbWl0aXZlcy5OYW1lLmdldCgiWE9iamVjdCIpOwogICAgY29uc3QgaW1hZ2VOYW1lID0gX3ByaW1pdGl2ZXMuTmFtZS5nZXQoIkltYWdlIik7CiAgICBjb25zdCBpbWFnZSA9IG5ldyBfcHJpbWl0aXZlcy5EaWN0KHhyZWYpOwogICAgaW1hZ2Uuc2V0KCJUeXBlIiwgeG9iamVjdE5hbWUpOwogICAgaW1hZ2Uuc2V0KCJTdWJ0eXBlIiwgaW1hZ2VOYW1lKTsKICAgIGltYWdlLnNldCgiQml0c1BlckNvbXBvbmVudCIsIDgpOwogICAgaW1hZ2Uuc2V0KCJDb2xvclNwYWNlIiwgX3ByaW1pdGl2ZXMuTmFtZS5nZXQoIkRldmljZVJHQiIpKTsKICAgIGltYWdlLnNldCgiRmlsdGVyIiwgX3ByaW1pdGl2ZXMuTmFtZS5nZXQoIkRDVERlY29kZSIpKTsKICAgIGltYWdlLnNldCgiQkJveCIsIFswLCAwLCB3aWR0aCwgaGVpZ2h0XSk7CiAgICBpbWFnZS5zZXQoIldpZHRoIiwgd2lkdGgpOwogICAgaW1hZ2Uuc2V0KCJIZWlnaHQiLCBoZWlnaHQpOwogICAgbGV0IHNtYXNrU3RyZWFtID0gbnVsbDsKICAgIGlmIChoYXNBbHBoYSkgewogICAgICBjb25zdCBhbHBoYUJ1ZmZlciA9IG5ldyBVaW50OEFycmF5KGJ1ZjMyLmxlbmd0aCk7CiAgICAgIGlmIChfdXRpbC5GZWF0dXJlVGVzdC5pc0xpdHRsZUVuZGlhbikgewogICAgICAgIGZvciAobGV0IGkgPSAwLCBpaSA9IGJ1ZjMyLmxlbmd0aDsgaSA8IGlpOyBpKyspIHsKICAgICAgICAgIGFscGhhQnVmZmVyW2ldID0gYnVmMzJbaV0gPj4+IDI0OwogICAgICAgIH0KICAgICAgfSBlbHNlIHsKICAgICAgICBmb3IgKGxldCBpID0gMCwgaWkgPSBidWYzMi5sZW5ndGg7IGkgPCBpaTsgaSsrKSB7CiAgICAgICAgICBhbHBoYUJ1ZmZlcltpXSA9IGJ1ZjMyW2ldICYgMHhmZjsKICAgICAgICB9CiAgICAgIH0KICAgICAgY29uc3Qgc21hc2sgPSBuZXcgX3ByaW1pdGl2ZXMuRGljdCh4cmVmKTsKICAgICAgc21hc2suc2V0KCJUeXBlIiwgeG9iamVjdE5hbWUpOwogICAgICBzbWFzay5zZXQoIlN1YnR5cGUiLCBpbWFnZU5hbWUpOwogICAgICBzbWFzay5zZXQoIkJpdHNQZXJDb21wb25lbnQiLCA4KTsKICAgICAgc21hc2suc2V0KCJDb2xvclNwYWNlIiwgX3ByaW1pdGl2ZXMuTmFtZS5nZXQoIkRldmljZUdyYXkiKSk7CiAgICAgIHNtYXNrLnNldCgiV2lkdGgiLCB3aWR0aCk7CiAgICAgIHNtYXNrLnNldCgiSGVpZ2h0IiwgaGVpZ2h0KTsKICAgICAgc21hc2tTdHJlYW0gPSBuZXcgX3N0cmVhbS5TdHJlYW0oYWxwaGFCdWZmZXIsIDAsIDAsIHNtYXNrKTsKICAgIH0KICAgIGNvbnN0IGltYWdlU3RyZWFtID0gbmV3IF9zdHJlYW0uU3RyZWFtKGF3YWl0IGpwZWdCdWZmZXJQcm9taXNlLCAwLCAwLCBpbWFnZSk7CiAgICByZXR1cm4gewogICAgICBpbWFnZVN0cmVhbSwKICAgICAgc21hc2tTdHJlYW0sCiAgICAgIHdpZHRoLAogICAgICBoZWlnaHQKICAgIH07CiAgfQogIHN0YXRpYyBjcmVhdGVOZXdEaWN0KGFubm90YXRpb24sIHhyZWYsIHsKICAgIGFwUmVmLAogICAgYXAKICB9KSB7CiAgICBjb25zdCB7CiAgICAgIHJlY3QsCiAgICAgIHJvdGF0aW9uLAogICAgICB1c2VyCiAgICB9ID0gYW5ub3RhdGlvbjsKICAgIGNvbnN0IHN0YW1wID0gbmV3IF9wcmltaXRpdmVzLkRpY3QoeHJlZik7CiAgICBzdGFtcC5zZXQoIlR5cGUiLCBfcHJpbWl0aXZlcy5OYW1lLmdldCgiQW5ub3QiKSk7CiAgICBzdGFtcC5zZXQoIlN1YnR5cGUiLCBfcHJpbWl0aXZlcy5OYW1lLmdldCgiU3RhbXAiKSk7CiAgICBzdGFtcC5zZXQoIkNyZWF0aW9uRGF0ZSIsIGBEOiR7KDAsIF91dGlsLmdldE1vZGlmaWNhdGlvbkRhdGUpKCl9YCk7CiAgICBzdGFtcC5zZXQoIlJlY3QiLCByZWN0KTsKICAgIHN0YW1wLnNldCgiRiIsIDQpOwogICAgc3RhbXAuc2V0KCJCb3JkZXIiLCBbMCwgMCwgMF0pOwogICAgc3RhbXAuc2V0KCJSb3RhdGUiLCByb3RhdGlvbik7CiAgICBpZiAodXNlcikgewogICAgICBzdGFtcC5zZXQoIlQiLCAoMCwgX2NvcmVfdXRpbHMuaXNBc2NpaSkodXNlcikgPyB1c2VyIDogKDAsIF9jb3JlX3V0aWxzLnN0cmluZ1RvVVRGMTZTdHJpbmcpKHVzZXIsIHRydWUpKTsKICAgIH0KICAgIGlmIChhcFJlZiB8fCBhcCkgewogICAgICBjb25zdCBuID0gbmV3IF9wcmltaXRpdmVzLkRpY3QoeHJlZik7CiAgICAgIHN0YW1wLnNldCgiQVAiLCBuKTsKICAgICAgaWYgKGFwUmVmKSB7CiAgICAgICAgbi5zZXQoIk4iLCBhcFJlZik7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgbi5zZXQoIk4iLCBhcCk7CiAgICAgIH0KICAgIH0KICAgIHJldHVybiBzdGFtcDsKICB9CiAgc3RhdGljIGFzeW5jIGNyZWF0ZU5ld0FwcGVhcmFuY2VTdHJlYW0oYW5ub3RhdGlvbiwgeHJlZiwgcGFyYW1zKSB7CiAgICBjb25zdCB7CiAgICAgIHJvdGF0aW9uCiAgICB9ID0gYW5ub3RhdGlvbjsKICAgIGNvbnN0IHsKICAgICAgaW1hZ2VSZWYsCiAgICAgIHdpZHRoLAogICAgICBoZWlnaHQKICAgIH0gPSBwYXJhbXMuaW1hZ2U7CiAgICBjb25zdCByZXNvdXJjZXMgPSBuZXcgX3ByaW1pdGl2ZXMuRGljdCh4cmVmKTsKICAgIGNvbnN0IHhvYmplY3QgPSBuZXcgX3ByaW1pdGl2ZXMuRGljdCh4cmVmKTsKICAgIHJlc291cmNlcy5zZXQoIlhPYmplY3QiLCB4b2JqZWN0KTsKICAgIHhvYmplY3Quc2V0KCJJbTAiLCBpbWFnZVJlZik7CiAgICBjb25zdCBhcHBlYXJhbmNlID0gYHEgJHt3aWR0aH0gMCAwICR7aGVpZ2h0fSAwIDAgY20gL0ltMCBEbyBRYDsKICAgIGNvbnN0IGFwcGVhcmFuY2VTdHJlYW1EaWN0ID0gbmV3IF9wcmltaXRpdmVzLkRpY3QoeHJlZik7CiAgICBhcHBlYXJhbmNlU3RyZWFtRGljdC5zZXQoIkZvcm1UeXBlIiwgMSk7CiAgICBhcHBlYXJhbmNlU3RyZWFtRGljdC5zZXQoIlN1YnR5cGUiLCBfcHJpbWl0aXZlcy5OYW1lLmdldCgiRm9ybSIpKTsKICAgIGFwcGVhcmFuY2VTdHJlYW1EaWN0LnNldCgiVHlwZSIsIF9wcmltaXRpdmVzLk5hbWUuZ2V0KCJYT2JqZWN0IikpOwogICAgYXBwZWFyYW5jZVN0cmVhbURpY3Quc2V0KCJCQm94IiwgWzAsIDAsIHdpZHRoLCBoZWlnaHRdKTsKICAgIGFwcGVhcmFuY2VTdHJlYW1EaWN0LnNldCgiUmVzb3VyY2VzIiwgcmVzb3VyY2VzKTsKICAgIGlmIChyb3RhdGlvbikgewogICAgICBjb25zdCBtYXRyaXggPSAoMCwgX2NvcmVfdXRpbHMuZ2V0Um90YXRpb25NYXRyaXgpKHJvdGF0aW9uLCB3aWR0aCwgaGVpZ2h0KTsKICAgICAgYXBwZWFyYW5jZVN0cmVhbURpY3Quc2V0KCJNYXRyaXgiLCBtYXRyaXgpOwogICAgfQogICAgY29uc3QgYXAgPSBuZXcgX3N0cmVhbS5TdHJpbmdTdHJlYW0oYXBwZWFyYW5jZSk7CiAgICBhcC5kaWN0ID0gYXBwZWFyYW5jZVN0cmVhbURpY3Q7CiAgICByZXR1cm4gYXA7CiAgfQp9CmNsYXNzIEZpbGVBdHRhY2htZW50QW5ub3RhdGlvbiBleHRlbmRzIE1hcmt1cEFubm90YXRpb24gewogIGNvbnN0cnVjdG9yKHBhcmFtcykgewogICAgc3VwZXIocGFyYW1zKTsKICAgIGNvbnN0IHsKICAgICAgZGljdCwKICAgICAgeHJlZgogICAgfSA9IHBhcmFtczsKICAgIGNvbnN0IGZpbGUgPSBuZXcgX2ZpbGVfc3BlYy5GaWxlU3BlYyhkaWN0LmdldCgiRlMiKSwgeHJlZik7CiAgICB0aGlzLmRhdGEuYW5ub3RhdGlvblR5cGUgPSBfdXRpbC5Bbm5vdGF0aW9uVHlwZS5GSUxFQVRUQUNITUVOVDsKICAgIHRoaXMuZGF0YS5oYXNPd25DYW52YXMgPSB0aGlzLmRhdGEubm9Sb3RhdGU7CiAgICB0aGlzLmRhdGEuZmlsZSA9IGZpbGUuc2VyaWFsaXphYmxlOwogICAgY29uc3QgbmFtZSA9IGRpY3QuZ2V0KCJOYW1lIik7CiAgICB0aGlzLmRhdGEubmFtZSA9IG5hbWUgaW5zdGFuY2VvZiBfcHJpbWl0aXZlcy5OYW1lID8gKDAsIF91dGlsLnN0cmluZ1RvUERGU3RyaW5nKShuYW1lLm5hbWUpIDogIlB1c2hQaW4iOwogICAgY29uc3QgZmlsbEFscGhhID0gZGljdC5nZXQoImNhIik7CiAgICB0aGlzLmRhdGEuZmlsbEFscGhhID0gdHlwZW9mIGZpbGxBbHBoYSA9PT0gIm51bWJlciIgJiYgZmlsbEFscGhhID49IDAgJiYgZmlsbEFscGhhIDw9IDEgPyBmaWxsQWxwaGEgOiBudWxsOwogIH0KfQoKLyoqKi8gfSksCi8qIDExICovCi8qKiovICgoX191bnVzZWRfd2VicGFja19tb2R1bGUsIGV4cG9ydHMsIF9fd19wZGZqc19yZXF1aXJlX18pID0+IHsKCgoKT2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsICJfX2VzTW9kdWxlIiwgKHsKICB2YWx1ZTogdHJ1ZQp9KSk7CmV4cG9ydHMuRmFrZVVuaWNvZGVGb250ID0gdm9pZCAwOwpleHBvcnRzLmNyZWF0ZURlZmF1bHRBcHBlYXJhbmNlID0gY3JlYXRlRGVmYXVsdEFwcGVhcmFuY2U7CmV4cG9ydHMuZ2V0UGRmQ29sb3IgPSBnZXRQZGZDb2xvcjsKZXhwb3J0cy5wYXJzZUFwcGVhcmFuY2VTdHJlYW0gPSBwYXJzZUFwcGVhcmFuY2VTdHJlYW07CmV4cG9ydHMucGFyc2VEZWZhdWx0QXBwZWFyYW5jZSA9IHBhcnNlRGVmYXVsdEFwcGVhcmFuY2U7CnZhciBfcHJpbWl0aXZlcyA9IF9fd19wZGZqc19yZXF1aXJlX18oNCk7CnZhciBfY29yZV91dGlscyA9IF9fd19wZGZqc19yZXF1aXJlX18oMyk7CnZhciBfdXRpbCA9IF9fd19wZGZqc19yZXF1aXJlX18oMik7CnZhciBfY29sb3JzcGFjZSA9IF9fd19wZGZqc19yZXF1aXJlX18oMTIpOwp2YXIgX2V2YWx1YXRvciA9IF9fd19wZGZqc19yZXF1aXJlX18oMTMpOwp2YXIgX2ltYWdlX3V0aWxzID0gX193X3BkZmpzX3JlcXVpcmVfXyg1OSk7CnZhciBfZnVuY3Rpb24gPSBfX3dfcGRmanNfcmVxdWlyZV9fKDU3KTsKdmFyIF9zdHJlYW0gPSBfX3dfcGRmanNfcmVxdWlyZV9fKDgpOwpjbGFzcyBEZWZhdWx0QXBwZWFyYW5jZUV2YWx1YXRvciBleHRlbmRzIF9ldmFsdWF0b3IuRXZhbHVhdG9yUHJlcHJvY2Vzc29yIHsKICBjb25zdHJ1Y3RvcihzdHIpIHsKICAgIHN1cGVyKG5ldyBfc3RyZWFtLlN0cmluZ1N0cmVhbShzdHIpKTsKICB9CiAgcGFyc2UoKSB7CiAgICBjb25zdCBvcGVyYXRpb24gPSB7CiAgICAgIGZuOiAwLAogICAgICBhcmdzOiBbXQogICAgfTsKICAgIGNvbnN0IHJlc3VsdCA9IHsKICAgICAgZm9udFNpemU6IDAsCiAgICAgIGZvbnROYW1lOiAiIiwKICAgICAgZm9udENvbG9yOiBuZXcgVWludDhDbGFtcGVkQXJyYXkoMykKICAgIH07CiAgICB0cnkgewogICAgICB3aGlsZSAodHJ1ZSkgewogICAgICAgIG9wZXJhdGlvbi5hcmdzLmxlbmd0aCA9IDA7CiAgICAgICAgaWYgKCF0aGlzLnJlYWQob3BlcmF0aW9uKSkgewogICAgICAgICAgYnJlYWs7CiAgICAgICAgfQogICAgICAgIGlmICh0aGlzLnNhdmVkU3RhdGVzRGVwdGggIT09IDApIHsKICAgICAgICAgIGNvbnRpbnVlOwogICAgICAgIH0KICAgICAgICBjb25zdCB7CiAgICAgICAgICBmbiwKICAgICAgICAgIGFyZ3MKICAgICAgICB9ID0gb3BlcmF0aW9uOwogICAgICAgIHN3aXRjaCAoZm4gfCAwKSB7CiAgICAgICAgICBjYXNlIF91dGlsLk9QUy5zZXRGb250OgogICAgICAgICAgICBjb25zdCBbZm9udE5hbWUsIGZvbnRTaXplXSA9IGFyZ3M7CiAgICAgICAgICAgIGlmIChmb250TmFtZSBpbnN0YW5jZW9mIF9wcmltaXRpdmVzLk5hbWUpIHsKICAgICAgICAgICAgICByZXN1bHQuZm9udE5hbWUgPSBmb250TmFtZS5uYW1lOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGlmICh0eXBlb2YgZm9udFNpemUgPT09ICJudW1iZXIiICYmIGZvbnRTaXplID4gMCkgewogICAgICAgICAgICAgIHJlc3VsdC5mb250U2l6ZSA9IGZvbnRTaXplOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgY2FzZSBfdXRpbC5PUFMuc2V0RmlsbFJHQkNvbG9yOgogICAgICAgICAgICBfY29sb3JzcGFjZS5Db2xvclNwYWNlLnNpbmdsZXRvbnMucmdiLmdldFJnYkl0ZW0oYXJncywgMCwgcmVzdWx0LmZvbnRDb2xvciwgMCk7CiAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgY2FzZSBfdXRpbC5PUFMuc2V0RmlsbEdyYXk6CiAgICAgICAgICAgIF9jb2xvcnNwYWNlLkNvbG9yU3BhY2Uuc2luZ2xldG9ucy5ncmF5LmdldFJnYkl0ZW0oYXJncywgMCwgcmVzdWx0LmZvbnRDb2xvciwgMCk7CiAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgY2FzZSBfdXRpbC5PUFMuc2V0RmlsbENNWUtDb2xvcjoKICAgICAgICAgICAgX2NvbG9yc3BhY2UuQ29sb3JTcGFjZS5zaW5nbGV0b25zLmNteWsuZ2V0UmdiSXRlbShhcmdzLCAwLCByZXN1bHQuZm9udENvbG9yLCAwKTsKICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgfQogICAgICB9CiAgICB9IGNhdGNoIChyZWFzb24pIHsKICAgICAgKDAsIF91dGlsLndhcm4pKGBwYXJzZURlZmF1bHRBcHBlYXJhbmNlIC0gaWdub3JpbmcgZXJyb3JzOiAiJHtyZWFzb259Ii5gKTsKICAgIH0KICAgIHJldHVybiByZXN1bHQ7CiAgfQp9CmZ1bmN0aW9uIHBhcnNlRGVmYXVsdEFwcGVhcmFuY2Uoc3RyKSB7CiAgcmV0dXJuIG5ldyBEZWZhdWx0QXBwZWFyYW5jZUV2YWx1YXRvcihzdHIpLnBhcnNlKCk7Cn0KY2xhc3MgQXBwZWFyYW5jZVN0cmVhbUV2YWx1YXRvciBleHRlbmRzIF9ldmFsdWF0b3IuRXZhbHVhdG9yUHJlcHJvY2Vzc29yIHsKICBjb25zdHJ1Y3RvcihzdHJlYW0sIGV2YWx1YXRvck9wdGlvbnMsIHhyZWYpIHsKICAgIHN1cGVyKHN0cmVhbSk7CiAgICB0aGlzLnN0cmVhbSA9IHN0cmVhbTsKICAgIHRoaXMuZXZhbHVhdG9yT3B0aW9ucyA9IGV2YWx1YXRvck9wdGlvbnM7CiAgICB0aGlzLnhyZWYgPSB4cmVmOwogICAgdGhpcy5yZXNvdXJjZXMgPSBzdHJlYW0uZGljdD8uZ2V0KCJSZXNvdXJjZXMiKTsKICB9CiAgcGFyc2UoKSB7CiAgICBjb25zdCBvcGVyYXRpb24gPSB7CiAgICAgIGZuOiAwLAogICAgICBhcmdzOiBbXQogICAgfTsKICAgIGxldCByZXN1bHQgPSB7CiAgICAgIHNjYWxlRmFjdG9yOiAxLAogICAgICBmb250U2l6ZTogMCwKICAgICAgZm9udE5hbWU6ICIiLAogICAgICBmb250Q29sb3I6IG5ldyBVaW50OENsYW1wZWRBcnJheSgzKSwKICAgICAgZmlsbENvbG9yU3BhY2U6IF9jb2xvcnNwYWNlLkNvbG9yU3BhY2Uuc2luZ2xldG9ucy5ncmF5CiAgICB9OwogICAgbGV0IGJyZWFrTG9vcCA9IGZhbHNlOwogICAgY29uc3Qgc3RhY2sgPSBbXTsKICAgIHRyeSB7CiAgICAgIHdoaWxlICh0cnVlKSB7CiAgICAgICAgb3BlcmF0aW9uLmFyZ3MubGVuZ3RoID0gMDsKICAgICAgICBpZiAoYnJlYWtMb29wIHx8ICF0aGlzLnJlYWQob3BlcmF0aW9uKSkgewogICAgICAgICAgYnJlYWs7CiAgICAgICAgfQogICAgICAgIGNvbnN0IHsKICAgICAgICAgIGZuLAogICAgICAgICAgYXJncwogICAgICAgIH0gPSBvcGVyYXRpb247CiAgICAgICAgc3dpdGNoIChmbiB8IDApIHsKICAgICAgICAgIGNhc2UgX3V0aWwuT1BTLnNhdmU6CiAgICAgICAgICAgIHN0YWNrLnB1c2goewogICAgICAgICAgICAgIHNjYWxlRmFjdG9yOiByZXN1bHQuc2NhbGVGYWN0b3IsCiAgICAgICAgICAgICAgZm9udFNpemU6IHJlc3VsdC5mb250U2l6ZSwKICAgICAgICAgICAgICBmb250TmFtZTogcmVzdWx0LmZvbnROYW1lLAogICAgICAgICAgICAgIGZvbnRDb2xvcjogcmVzdWx0LmZvbnRDb2xvci5zbGljZSgpLAogICAgICAgICAgICAgIGZpbGxDb2xvclNwYWNlOiByZXN1bHQuZmlsbENvbG9yU3BhY2UKICAgICAgICAgICAgfSk7CiAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgY2FzZSBfdXRpbC5PUFMucmVzdG9yZToKICAgICAgICAgICAgcmVzdWx0ID0gc3RhY2sucG9wKCkgfHwgcmVzdWx0OwogICAgICAgICAgICBicmVhazsKICAgICAgICAgIGNhc2UgX3V0aWwuT1BTLnNldFRleHRNYXRyaXg6CiAgICAgICAgICAgIHJlc3VsdC5zY2FsZUZhY3RvciAqPSBNYXRoLmh5cG90KGFyZ3NbMF0sIGFyZ3NbMV0pOwogICAgICAgICAgICBicmVhazsKICAgICAgICAgIGNhc2UgX3V0aWwuT1BTLnNldEZvbnQ6CiAgICAgICAgICAgIGNvbnN0IFtmb250TmFtZSwgZm9udFNpemVdID0gYXJnczsKICAgICAgICAgICAgaWYgKGZvbnROYW1lIGluc3RhbmNlb2YgX3ByaW1pdGl2ZXMuTmFtZSkgewogICAgICAgICAgICAgIHJlc3VsdC5mb250TmFtZSA9IGZvbnROYW1lLm5hbWU7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgaWYgKHR5cGVvZiBmb250U2l6ZSA9PT0gIm51bWJlciIgJiYgZm9udFNpemUgPiAwKSB7CiAgICAgICAgICAgICAgcmVzdWx0LmZvbnRTaXplID0gZm9udFNpemUgKiByZXN1bHQuc2NhbGVGYWN0b3I7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICBjYXNlIF91dGlsLk9QUy5zZXRGaWxsQ29sb3JTcGFjZToKICAgICAgICAgICAgcmVzdWx0LmZpbGxDb2xvclNwYWNlID0gX2NvbG9yc3BhY2UuQ29sb3JTcGFjZS5wYXJzZSh7CiAgICAgICAgICAgICAgY3M6IGFyZ3NbMF0sCiAgICAgICAgICAgICAgeHJlZjogdGhpcy54cmVmLAogICAgICAgICAgICAgIHJlc291cmNlczogdGhpcy5yZXNvdXJjZXMsCiAgICAgICAgICAgICAgcGRmRnVuY3Rpb25GYWN0b3J5OiB0aGlzLl9wZGZGdW5jdGlvbkZhY3RvcnksCiAgICAgICAgICAgICAgbG9jYWxDb2xvclNwYWNlQ2FjaGU6IHRoaXMuX2xvY2FsQ29sb3JTcGFjZUNhY2hlCiAgICAgICAgICAgIH0pOwogICAgICAgICAgICBicmVhazsKICAgICAgICAgIGNhc2UgX3V0aWwuT1BTLnNldEZpbGxDb2xvcjoKICAgICAgICAgICAgY29uc3QgY3MgPSByZXN1bHQuZmlsbENvbG9yU3BhY2U7CiAgICAgICAgICAgIGNzLmdldFJnYkl0ZW0oYXJncywgMCwgcmVzdWx0LmZvbnRDb2xvciwgMCk7CiAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgY2FzZSBfdXRpbC5PUFMuc2V0RmlsbFJHQkNvbG9yOgogICAgICAgICAgICBfY29sb3JzcGFjZS5Db2xvclNwYWNlLnNpbmdsZXRvbnMucmdiLmdldFJnYkl0ZW0oYXJncywgMCwgcmVzdWx0LmZvbnRDb2xvciwgMCk7CiAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgY2FzZSBfdXRpbC5PUFMuc2V0RmlsbEdyYXk6CiAgICAgICAgICAgIF9jb2xvcnNwYWNlLkNvbG9yU3BhY2Uuc2luZ2xldG9ucy5ncmF5LmdldFJnYkl0ZW0oYXJncywgMCwgcmVzdWx0LmZvbnRDb2xvciwgMCk7CiAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgY2FzZSBfdXRpbC5PUFMuc2V0RmlsbENNWUtDb2xvcjoKICAgICAgICAgICAgX2NvbG9yc3BhY2UuQ29sb3JTcGFjZS5zaW5nbGV0b25zLmNteWsuZ2V0UmdiSXRlbShhcmdzLCAwLCByZXN1bHQuZm9udENvbG9yLCAwKTsKICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICBjYXNlIF91dGlsLk9QUy5zaG93VGV4dDoKICAgICAgICAgIGNhc2UgX3V0aWwuT1BTLnNob3dTcGFjZWRUZXh0OgogICAgICAgICAgY2FzZSBfdXRpbC5PUFMubmV4dExpbmVTaG93VGV4dDoKICAgICAgICAgIGNhc2UgX3V0aWwuT1BTLm5leHRMaW5lU2V0U3BhY2luZ1Nob3dUZXh0OgogICAgICAgICAgICBicmVha0xvb3AgPSB0cnVlOwogICAgICAgICAgICBicmVhazsKICAgICAgICB9CiAgICAgIH0KICAgIH0gY2F0Y2ggKHJlYXNvbikgewogICAgICAoMCwgX3V0aWwud2FybikoYHBhcnNlQXBwZWFyYW5jZVN0cmVhbSAtIGlnbm9yaW5nIGVycm9yczogIiR7cmVhc29ufSIuYCk7CiAgICB9CiAgICB0aGlzLnN0cmVhbS5yZXNldCgpOwogICAgZGVsZXRlIHJlc3VsdC5zY2FsZUZhY3RvcjsKICAgIGRlbGV0ZSByZXN1bHQuZmlsbENvbG9yU3BhY2U7CiAgICByZXR1cm4gcmVzdWx0OwogIH0KICBnZXQgX2xvY2FsQ29sb3JTcGFjZUNhY2hlKCkgewogICAgcmV0dXJuICgwLCBfdXRpbC5zaGFkb3cpKHRoaXMsICJfbG9jYWxDb2xvclNwYWNlQ2FjaGUiLCBuZXcgX2ltYWdlX3V0aWxzLkxvY2FsQ29sb3JTcGFjZUNhY2hlKCkpOwogIH0KICBnZXQgX3BkZkZ1bmN0aW9uRmFjdG9yeSgpIHsKICAgIGNvbnN0IHBkZkZ1bmN0aW9uRmFjdG9yeSA9IG5ldyBfZnVuY3Rpb24uUERGRnVuY3Rpb25GYWN0b3J5KHsKICAgICAgeHJlZjogdGhpcy54cmVmLAogICAgICBpc0V2YWxTdXBwb3J0ZWQ6IHRoaXMuZXZhbHVhdG9yT3B0aW9ucy5pc0V2YWxTdXBwb3J0ZWQKICAgIH0pOwogICAgcmV0dXJuICgwLCBfdXRpbC5zaGFkb3cpKHRoaXMsICJfcGRmRnVuY3Rpb25GYWN0b3J5IiwgcGRmRnVuY3Rpb25GYWN0b3J5KTsKICB9Cn0KZnVuY3Rpb24gcGFyc2VBcHBlYXJhbmNlU3RyZWFtKHN0cmVhbSwgZXZhbHVhdG9yT3B0aW9ucywgeHJlZikgewogIHJldHVybiBuZXcgQXBwZWFyYW5jZVN0cmVhbUV2YWx1YXRvcihzdHJlYW0sIGV2YWx1YXRvck9wdGlvbnMsIHhyZWYpLnBhcnNlKCk7Cn0KZnVuY3Rpb24gZ2V0UGRmQ29sb3IoY29sb3IsIGlzRmlsbCkgewogIGlmIChjb2xvclswXSA9PT0gY29sb3JbMV0gJiYgY29sb3JbMV0gPT09IGNvbG9yWzJdKSB7CiAgICBjb25zdCBncmF5ID0gY29sb3JbMF0gLyAyNTU7CiAgICByZXR1cm4gYCR7KDAsIF9jb3JlX3V0aWxzLm51bWJlclRvU3RyaW5nKShncmF5KX0gJHtpc0ZpbGwgPyAiZyIgOiAiRyJ9YDsKICB9CiAgcmV0dXJuIEFycmF5LmZyb20oY29sb3IsIGMgPT4gKDAsIF9jb3JlX3V0aWxzLm51bWJlclRvU3RyaW5nKShjIC8gMjU1KSkuam9pbigiICIpICsgYCAke2lzRmlsbCA/ICJyZyIgOiAiUkcifWA7Cn0KZnVuY3Rpb24gY3JlYXRlRGVmYXVsdEFwcGVhcmFuY2UoewogIGZvbnRTaXplLAogIGZvbnROYW1lLAogIGZvbnRDb2xvcgp9KSB7CiAgcmV0dXJuIGAvJHsoMCwgX2NvcmVfdXRpbHMuZXNjYXBlUERGTmFtZSkoZm9udE5hbWUpfSAke2ZvbnRTaXplfSBUZiAke2dldFBkZkNvbG9yKGZvbnRDb2xvciwgdHJ1ZSl9YDsKfQpjbGFzcyBGYWtlVW5pY29kZUZvbnQgewogIGNvbnN0cnVjdG9yKHhyZWYsIGZvbnRGYW1pbHkpIHsKICAgIHRoaXMueHJlZiA9IHhyZWY7CiAgICB0aGlzLndpZHRocyA9IG51bGw7CiAgICB0aGlzLmZpcnN0Q2hhciA9IEluZmluaXR5OwogICAgdGhpcy5sYXN0Q2hhciA9IC1JbmZpbml0eTsKICAgIHRoaXMuZm9udEZhbWlseSA9IGZvbnRGYW1pbHk7CiAgICBjb25zdCBjYW52YXMgPSBuZXcgT2Zmc2NyZWVuQ2FudmFzKDEsIDEpOwogICAgdGhpcy5jdHhNZWFzdXJlID0gY2FudmFzLmdldENvbnRleHQoIjJkIik7CiAgICBpZiAoIUZha2VVbmljb2RlRm9udC5fZm9udE5hbWVJZCkgewogICAgICBGYWtlVW5pY29kZUZvbnQuX2ZvbnROYW1lSWQgPSAxOwogICAgfQogICAgdGhpcy5mb250TmFtZSA9IF9wcmltaXRpdmVzLk5hbWUuZ2V0KGBJbnZhbGlkUERGanNGb250XyR7Zm9udEZhbWlseX1fJHtGYWtlVW5pY29kZUZvbnQuX2ZvbnROYW1lSWQrK31gKTsKICB9CiAgZ2V0IHRvVW5pY29kZVJlZigpIHsKICAgIGlmICghRmFrZVVuaWNvZGVGb250Ll90b1VuaWNvZGVSZWYpIHsKICAgICAgY29uc3QgdG9Vbmljb2RlID0gYC9DSURJbml0IC9Qcm9jU2V0IGZpbmRyZXNvdXJjZSBiZWdpbgoxMiBkaWN0IGJlZ2luCmJlZ2luY21hcAovQ0lEU3lzdGVtSW5mbwo8PCAvUmVnaXN0cnkgKEFkb2JlKQovT3JkZXJpbmcgKFVDUykgL1N1cHBsZW1lbnQgMCA+PiBkZWYKL0NNYXBOYW1lIC9BZG9iZS1JZGVudGl0eS1VQ1MgZGVmCi9DTWFwVHlwZSAyIGRlZgoxIGJlZ2luY29kZXNwYWNlcmFuZ2UKPDAwMDA+IDxGRkZGPgplbmRjb2Rlc3BhY2VyYW5nZQoxIGJlZ2luYmZyYW5nZQo8MDAwMD4gPEZGRkY+IDwwMDAwPgplbmRiZnJhbmdlCmVuZGNtYXAgQ01hcE5hbWUgY3VycmVudGRpY3QgL0NNYXAgZGVmaW5lcmVzb3VyY2UgcG9wIGVuZCBlbmRgOwogICAgICBjb25zdCB0b1VuaWNvZGVTdHJlYW0gPSBGYWtlVW5pY29kZUZvbnQudG9Vbmljb2RlU3RyZWFtID0gbmV3IF9zdHJlYW0uU3RyaW5nU3RyZWFtKHRvVW5pY29kZSk7CiAgICAgIGNvbnN0IHRvVW5pY29kZURpY3QgPSBuZXcgX3ByaW1pdGl2ZXMuRGljdCh0aGlzLnhyZWYpOwogICAgICB0b1VuaWNvZGVTdHJlYW0uZGljdCA9IHRvVW5pY29kZURpY3Q7CiAgICAgIHRvVW5pY29kZURpY3Quc2V0KCJMZW5ndGgiLCB0b1VuaWNvZGUubGVuZ3RoKTsKICAgICAgRmFrZVVuaWNvZGVGb250Ll90b1VuaWNvZGVSZWYgPSB0aGlzLnhyZWYuZ2V0TmV3UGVyc2lzdGVudFJlZih0b1VuaWNvZGVTdHJlYW0pOwogICAgfQogICAgcmV0dXJuIEZha2VVbmljb2RlRm9udC5fdG9Vbmljb2RlUmVmOwogIH0KICBnZXQgZm9udERlc2NyaXB0b3JSZWYoKSB7CiAgICBpZiAoIUZha2VVbmljb2RlRm9udC5fZm9udERlc2NyaXB0b3JSZWYpIHsKICAgICAgY29uc3QgZm9udERlc2NyaXB0b3IgPSBuZXcgX3ByaW1pdGl2ZXMuRGljdCh0aGlzLnhyZWYpOwogICAgICBmb250RGVzY3JpcHRvci5zZXQoIlR5cGUiLCBfcHJpbWl0aXZlcy5OYW1lLmdldCgiRm9udERlc2NyaXB0b3IiKSk7CiAgICAgIGZvbnREZXNjcmlwdG9yLnNldCgiRm9udE5hbWUiLCB0aGlzLmZvbnROYW1lKTsKICAgICAgZm9udERlc2NyaXB0b3Iuc2V0KCJGb250RmFtaWx5IiwgIk15cmlhZFBybyBSZWd1bGFyIik7CiAgICAgIGZvbnREZXNjcmlwdG9yLnNldCgiRm9udEJCb3giLCBbMCwgMCwgMCwgMF0pOwogICAgICBmb250RGVzY3JpcHRvci5zZXQoIkZvbnRTdHJldGNoIiwgX3ByaW1pdGl2ZXMuTmFtZS5nZXQoIk5vcm1hbCIpKTsKICAgICAgZm9udERlc2NyaXB0b3Iuc2V0KCJGb250V2VpZ2h0IiwgNDAwKTsKICAgICAgZm9udERlc2NyaXB0b3Iuc2V0KCJJdGFsaWNBbmdsZSIsIDApOwogICAgICBGYWtlVW5pY29kZUZvbnQuX2ZvbnREZXNjcmlwdG9yUmVmID0gdGhpcy54cmVmLmdldE5ld1BlcnNpc3RlbnRSZWYoZm9udERlc2NyaXB0b3IpOwogICAgfQogICAgcmV0dXJuIEZha2VVbmljb2RlRm9udC5fZm9udERlc2NyaXB0b3JSZWY7CiAgfQogIGdldCBkZXNjZW5kYW50Rm9udFJlZigpIHsKICAgIGNvbnN0IGRlc2NlbmRhbnRGb250ID0gbmV3IF9wcmltaXRpdmVzLkRpY3QodGhpcy54cmVmKTsKICAgIGRlc2NlbmRhbnRGb250LnNldCgiQmFzZUZvbnQiLCB0aGlzLmZvbnROYW1lKTsKICAgIGRlc2NlbmRhbnRGb250LnNldCgiVHlwZSIsIF9wcmltaXRpdmVzLk5hbWUuZ2V0KCJGb250IikpOwogICAgZGVzY2VuZGFudEZvbnQuc2V0KCJTdWJ0eXBlIiwgX3ByaW1pdGl2ZXMuTmFtZS5nZXQoIkNJREZvbnRUeXBlMCIpKTsKICAgIGRlc2NlbmRhbnRGb250LnNldCgiQ0lEVG9HSURNYXAiLCBfcHJpbWl0aXZlcy5OYW1lLmdldCgiSWRlbnRpdHkiKSk7CiAgICBkZXNjZW5kYW50Rm9udC5zZXQoIkZpcnN0Q2hhciIsIHRoaXMuZmlyc3RDaGFyKTsKICAgIGRlc2NlbmRhbnRGb250LnNldCgiTGFzdENoYXIiLCB0aGlzLmxhc3RDaGFyKTsKICAgIGRlc2NlbmRhbnRGb250LnNldCgiRm9udERlc2NyaXB0b3IiLCB0aGlzLmZvbnREZXNjcmlwdG9yUmVmKTsKICAgIGRlc2NlbmRhbnRGb250LnNldCgiRFciLCAxMDAwKTsKICAgIGNvbnN0IHdpZHRocyA9IFtdOwogICAgY29uc3QgY2hhcnMgPSBbLi4udGhpcy53aWR0aHMuZW50cmllcygpXS5zb3J0KCk7CiAgICBsZXQgY3VycmVudENoYXIgPSBudWxsOwogICAgbGV0IGN1cnJlbnRXaWR0aHMgPSBudWxsOwogICAgZm9yIChjb25zdCBbY2hhciwgd2lkdGhdIG9mIGNoYXJzKSB7CiAgICAgIGlmICghY3VycmVudENoYXIpIHsKICAgICAgICBjdXJyZW50Q2hhciA9IGNoYXI7CiAgICAgICAgY3VycmVudFdpZHRocyA9IFt3aWR0aF07CiAgICAgICAgY29udGludWU7CiAgICAgIH0KICAgICAgaWYgKGNoYXIgPT09IGN1cnJlbnRDaGFyICsgY3VycmVudFdpZHRocy5sZW5ndGgpIHsKICAgICAgICBjdXJyZW50V2lkdGhzLnB1c2god2lkdGgpOwogICAgICB9IGVsc2UgewogICAgICAgIHdpZHRocy5wdXNoKGN1cnJlbnRDaGFyLCBjdXJyZW50V2lkdGhzKTsKICAgICAgICBjdXJyZW50Q2hhciA9IGNoYXI7CiAgICAgICAgY3VycmVudFdpZHRocyA9IFt3aWR0aF07CiAgICAgIH0KICAgIH0KICAgIGlmIChjdXJyZW50Q2hhcikgewogICAgICB3aWR0aHMucHVzaChjdXJyZW50Q2hhciwgY3VycmVudFdpZHRocyk7CiAgICB9CiAgICBkZXNjZW5kYW50Rm9udC5zZXQoIlciLCB3aWR0aHMpOwogICAgY29uc3QgY2lkU3lzdGVtSW5mbyA9IG5ldyBfcHJpbWl0aXZlcy5EaWN0KHRoaXMueHJlZik7CiAgICBjaWRTeXN0ZW1JbmZvLnNldCgiT3JkZXJpbmciLCAiSWRlbnRpdHkiKTsKICAgIGNpZFN5c3RlbUluZm8uc2V0KCJSZWdpc3RyeSIsICJBZG9iZSIpOwogICAgY2lkU3lzdGVtSW5mby5zZXQoIlN1cHBsZW1lbnQiLCAwKTsKICAgIGRlc2NlbmRhbnRGb250LnNldCgiQ0lEU3lzdGVtSW5mbyIsIGNpZFN5c3RlbUluZm8pOwogICAgcmV0dXJuIHRoaXMueHJlZi5nZXROZXdQZXJzaXN0ZW50UmVmKGRlc2NlbmRhbnRGb250KTsKICB9CiAgZ2V0IGJhc2VGb250UmVmKCkgewogICAgY29uc3QgYmFzZUZvbnQgPSBuZXcgX3ByaW1pdGl2ZXMuRGljdCh0aGlzLnhyZWYpOwogICAgYmFzZUZvbnQuc2V0KCJCYXNlRm9udCIsIHRoaXMuZm9udE5hbWUpOwogICAgYmFzZUZvbnQuc2V0KCJUeXBlIiwgX3ByaW1pdGl2ZXMuTmFtZS5nZXQoIkZvbnQiKSk7CiAgICBiYXNlRm9udC5zZXQoIlN1YnR5cGUiLCBfcHJpbWl0aXZlcy5OYW1lLmdldCgiVHlwZTAiKSk7CiAgICBiYXNlRm9udC5zZXQoIkVuY29kaW5nIiwgX3ByaW1pdGl2ZXMuTmFtZS5nZXQoIklkZW50aXR5LUgiKSk7CiAgICBiYXNlRm9udC5zZXQoIkRlc2NlbmRhbnRGb250cyIsIFt0aGlzLmRlc2NlbmRhbnRGb250UmVmXSk7CiAgICBiYXNlRm9udC5zZXQoIlRvVW5pY29kZSIsIHRoaXMudG9Vbmljb2RlUmVmKTsKICAgIHJldHVybiB0aGlzLnhyZWYuZ2V0TmV3UGVyc2lzdGVudFJlZihiYXNlRm9udCk7CiAgfQogIGdldCByZXNvdXJjZXMoKSB7CiAgICBjb25zdCByZXNvdXJjZXMgPSBuZXcgX3ByaW1pdGl2ZXMuRGljdCh0aGlzLnhyZWYpOwogICAgY29uc3QgZm9udCA9IG5ldyBfcHJpbWl0aXZlcy5EaWN0KHRoaXMueHJlZik7CiAgICBmb250LnNldCh0aGlzLmZvbnROYW1lLm5hbWUsIHRoaXMuYmFzZUZvbnRSZWYpOwogICAgcmVzb3VyY2VzLnNldCgiRm9udCIsIGZvbnQpOwogICAgcmV0dXJuIHJlc291cmNlczsKICB9CiAgX2NyZWF0ZUNvbnRleHQoKSB7CiAgICB0aGlzLndpZHRocyA9IG5ldyBNYXAoKTsKICAgIHRoaXMuY3R4TWVhc3VyZS5mb250ID0gYDEwMDBweCAke3RoaXMuZm9udEZhbWlseX1gOwogICAgcmV0dXJuIHRoaXMuY3R4TWVhc3VyZTsKICB9CiAgY3JlYXRlRm9udFJlc291cmNlcyh0ZXh0KSB7CiAgICBjb25zdCBjdHggPSB0aGlzLl9jcmVhdGVDb250ZXh0KCk7CiAgICBmb3IgKGNvbnN0IGxpbmUgb2YgdGV4dC5zcGxpdCgvXHJcbj98XG4vKSkgewogICAgICBmb3IgKGNvbnN0IGNoYXIgb2YgbGluZS5zcGxpdCgiIikpIHsKICAgICAgICBjb25zdCBjb2RlID0gY2hhci5jaGFyQ29kZUF0KDApOwogICAgICAgIGlmICh0aGlzLndpZHRocy5oYXMoY29kZSkpIHsKICAgICAgICAgIGNvbnRpbnVlOwogICAgICAgIH0KICAgICAgICBjb25zdCBtZXRyaWNzID0gY3R4Lm1lYXN1cmVUZXh0KGNoYXIpOwogICAgICAgIGNvbnN0IHdpZHRoID0gTWF0aC5jZWlsKG1ldHJpY3Mud2lkdGgpOwogICAgICAgIHRoaXMud2lkdGhzLnNldChjb2RlLCB3aWR0aCk7CiAgICAgICAgdGhpcy5maXJzdENoYXIgPSBNYXRoLm1pbihjb2RlLCB0aGlzLmZpcnN0Q2hhcik7CiAgICAgICAgdGhpcy5sYXN0Q2hhciA9IE1hdGgubWF4KGNvZGUsIHRoaXMubGFzdENoYXIpOwogICAgICB9CiAgICB9CiAgICByZXR1cm4gdGhpcy5yZXNvdXJjZXM7CiAgfQogIGNyZWF0ZUFwcGVhcmFuY2UodGV4dCwgcmVjdCwgcm90YXRpb24sIGZvbnRTaXplLCBiZ0NvbG9yLCBzdHJva2VBbHBoYSkgewogICAgY29uc3QgY3R4ID0gdGhpcy5fY3JlYXRlQ29udGV4dCgpOwogICAgY29uc3QgbGluZXMgPSBbXTsKICAgIGxldCBtYXhXaWR0aCA9IC1JbmZpbml0eTsKICAgIGZvciAoY29uc3QgbGluZSBvZiB0ZXh0LnNwbGl0KC9cclxuP3xcbi8pKSB7CiAgICAgIGxpbmVzLnB1c2gobGluZSk7CiAgICAgIGNvbnN0IGxpbmVXaWR0aCA9IGN0eC5tZWFzdXJlVGV4dChsaW5lKS53aWR0aDsKICAgICAgbWF4V2lkdGggPSBNYXRoLm1heChtYXhXaWR0aCwgbGluZVdpZHRoKTsKICAgICAgZm9yIChjb25zdCBjaGFyIG9mIGxpbmUuc3BsaXQoIiIpKSB7CiAgICAgICAgY29uc3QgY29kZSA9IGNoYXIuY2hhckNvZGVBdCgwKTsKICAgICAgICBsZXQgd2lkdGggPSB0aGlzLndpZHRocy5nZXQoY29kZSk7CiAgICAgICAgaWYgKHdpZHRoID09PSB1bmRlZmluZWQpIHsKICAgICAgICAgIGNvbnN0IG1ldHJpY3MgPSBjdHgubWVhc3VyZVRleHQoY2hhcik7CiAgICAgICAgICB3aWR0aCA9IE1hdGguY2VpbChtZXRyaWNzLndpZHRoKTsKICAgICAgICAgIHRoaXMud2lkdGhzLnNldChjb2RlLCB3aWR0aCk7CiAgICAgICAgICB0aGlzLmZpcnN0Q2hhciA9IE1hdGgubWluKGNvZGUsIHRoaXMuZmlyc3RDaGFyKTsKICAgICAgICAgIHRoaXMubGFzdENoYXIgPSBNYXRoLm1heChjb2RlLCB0aGlzLmxhc3RDaGFyKTsKICAgICAgICB9CiAgICAgIH0KICAgIH0KICAgIG1heFdpZHRoICo9IGZvbnRTaXplIC8gMTAwMDsKICAgIGNvbnN0IFt4MSwgeTEsIHgyLCB5Ml0gPSByZWN0OwogICAgbGV0IHcgPSB4MiAtIHgxOwogICAgbGV0IGggPSB5MiAtIHkxOwogICAgaWYgKHJvdGF0aW9uICUgMTgwICE9PSAwKSB7CiAgICAgIFt3LCBoXSA9IFtoLCB3XTsKICAgIH0KICAgIGxldCBoc2NhbGUgPSAxOwogICAgaWYgKG1heFdpZHRoID4gdykgewogICAgICBoc2NhbGUgPSB3IC8gbWF4V2lkdGg7CiAgICB9CiAgICBsZXQgdnNjYWxlID0gMTsKICAgIGNvbnN0IGxpbmVIZWlnaHQgPSBfdXRpbC5MSU5FX0ZBQ1RPUiAqIGZvbnRTaXplOwogICAgY29uc3QgbGluZURlc2NlbnQgPSBfdXRpbC5MSU5FX0RFU0NFTlRfRkFDVE9SICogZm9udFNpemU7CiAgICBjb25zdCBtYXhIZWlnaHQgPSBsaW5lSGVpZ2h0ICogbGluZXMubGVuZ3RoOwogICAgaWYgKG1heEhlaWdodCA+IGgpIHsKICAgICAgdnNjYWxlID0gaCAvIG1heEhlaWdodDsKICAgIH0KICAgIGNvbnN0IGZzY2FsZSA9IE1hdGgubWluKGhzY2FsZSwgdnNjYWxlKTsKICAgIGNvbnN0IG5ld0ZvbnRTaXplID0gZm9udFNpemUgKiBmc2NhbGU7CiAgICBjb25zdCBidWZmZXIgPSBbInEiLCBgMCAwICR7KDAsIF9jb3JlX3V0aWxzLm51bWJlclRvU3RyaW5nKSh3KX0gJHsoMCwgX2NvcmVfdXRpbHMubnVtYmVyVG9TdHJpbmcpKGgpfSByZSBXIG5gLCBgQlRgLCBgMSAwIDAgMSAwICR7KDAsIF9jb3JlX3V0aWxzLm51bWJlclRvU3RyaW5nKShoICsgbGluZURlc2NlbnQpfSBUbSAwIFRjICR7Z2V0UGRmQ29sb3IoYmdDb2xvciwgdHJ1ZSl9YCwgYC8ke3RoaXMuZm9udE5hbWUubmFtZX0gJHsoMCwgX2NvcmVfdXRpbHMubnVtYmVyVG9TdHJpbmcpKG5ld0ZvbnRTaXplKX0gVGZgXTsKICAgIGNvbnN0IHsKICAgICAgcmVzb3VyY2VzCiAgICB9ID0gdGhpczsKICAgIHN0cm9rZUFscGhhID0gdHlwZW9mIHN0cm9rZUFscGhhID09PSAibnVtYmVyIiAmJiBzdHJva2VBbHBoYSA+PSAwICYmIHN0cm9rZUFscGhhIDw9IDEgPyBzdHJva2VBbHBoYSA6IDE7CiAgICBpZiAoc3Ryb2tlQWxwaGEgIT09IDEpIHsKICAgICAgYnVmZmVyLnB1c2goIi9SMCBncyIpOwogICAgICBjb25zdCBleHRHU3RhdGUgPSBuZXcgX3ByaW1pdGl2ZXMuRGljdCh0aGlzLnhyZWYpOwogICAgICBjb25zdCByMCA9IG5ldyBfcHJpbWl0aXZlcy5EaWN0KHRoaXMueHJlZik7CiAgICAgIHIwLnNldCgiY2EiLCBzdHJva2VBbHBoYSk7CiAgICAgIHIwLnNldCgiQ0EiLCBzdHJva2VBbHBoYSk7CiAgICAgIHIwLnNldCgiVHlwZSIsIF9wcmltaXRpdmVzLk5hbWUuZ2V0KCJFeHRHU3RhdGUiKSk7CiAgICAgIGV4dEdTdGF0ZS5zZXQoIlIwIiwgcjApOwogICAgICByZXNvdXJjZXMuc2V0KCJFeHRHU3RhdGUiLCBleHRHU3RhdGUpOwogICAgfQogICAgY29uc3QgdlNoaWZ0ID0gKDAsIF9jb3JlX3V0aWxzLm51bWJlclRvU3RyaW5nKShsaW5lSGVpZ2h0KTsKICAgIGZvciAoY29uc3QgbGluZSBvZiBsaW5lcykgewogICAgICBidWZmZXIucHVzaChgMCAtJHt2U2hpZnR9IFRkIDwkeygwLCBfY29yZV91dGlscy5zdHJpbmdUb1VURjE2SGV4U3RyaW5nKShsaW5lKX0+IFRqYCk7CiAgICB9CiAgICBidWZmZXIucHVzaCgiRVQiLCAiUSIpOwogICAgY29uc3QgYXBwZWFyYW5jZSA9IGJ1ZmZlci5qb2luKCJcbiIpOwogICAgY29uc3QgYXBwZWFyYW5jZVN0cmVhbURpY3QgPSBuZXcgX3ByaW1pdGl2ZXMuRGljdCh0aGlzLnhyZWYpOwogICAgYXBwZWFyYW5jZVN0cmVhbURpY3Quc2V0KCJTdWJ0eXBlIiwgX3ByaW1pdGl2ZXMuTmFtZS5nZXQoIkZvcm0iKSk7CiAgICBhcHBlYXJhbmNlU3RyZWFtRGljdC5zZXQoIlR5cGUiLCBfcHJpbWl0aXZlcy5OYW1lLmdldCgiWE9iamVjdCIpKTsKICAgIGFwcGVhcmFuY2VTdHJlYW1EaWN0LnNldCgiQkJveCIsIFswLCAwLCB3LCBoXSk7CiAgICBhcHBlYXJhbmNlU3RyZWFtRGljdC5zZXQoIkxlbmd0aCIsIGFwcGVhcmFuY2UubGVuZ3RoKTsKICAgIGFwcGVhcmFuY2VTdHJlYW1EaWN0LnNldCgiUmVzb3VyY2VzIiwgcmVzb3VyY2VzKTsKICAgIGlmIChyb3RhdGlvbikgewogICAgICBjb25zdCBtYXRyaXggPSAoMCwgX2NvcmVfdXRpbHMuZ2V0Um90YXRpb25NYXRyaXgpKHJvdGF0aW9uLCB3LCBoKTsKICAgICAgYXBwZWFyYW5jZVN0cmVhbURpY3Quc2V0KCJNYXRyaXgiLCBtYXRyaXgpOwogICAgfQogICAgY29uc3QgYXAgPSBuZXcgX3N0cmVhbS5TdHJpbmdTdHJlYW0oYXBwZWFyYW5jZSk7CiAgICBhcC5kaWN0ID0gYXBwZWFyYW5jZVN0cmVhbURpY3Q7CiAgICByZXR1cm4gYXA7CiAgfQp9CmV4cG9ydHMuRmFrZVVuaWNvZGVGb250ID0gRmFrZVVuaWNvZGVGb250OwoKLyoqKi8gfSksCi8qIDEyICovCi8qKiovICgoX191bnVzZWRfd2VicGFja19tb2R1bGUsIGV4cG9ydHMsIF9fd19wZGZqc19yZXF1aXJlX18pID0+IHsKCgoKT2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsICJfX2VzTW9kdWxlIiwgKHsKICB2YWx1ZTogdHJ1ZQp9KSk7CmV4cG9ydHMuQ29sb3JTcGFjZSA9IHZvaWQgMDsKdmFyIF91dGlsID0gX193X3BkZmpzX3JlcXVpcmVfXygyKTsKdmFyIF9wcmltaXRpdmVzID0gX193X3BkZmpzX3JlcXVpcmVfXyg0KTsKdmFyIF9iYXNlX3N0cmVhbSA9IF9fd19wZGZqc19yZXF1aXJlX18oNSk7CnZhciBfY29yZV91dGlscyA9IF9fd19wZGZqc19yZXF1aXJlX18oMyk7CmZ1bmN0aW9uIHJlc2l6ZVJnYkltYWdlKHNyYywgZGVzdCwgdzEsIGgxLCB3MiwgaDIsIGFscGhhMDEpIHsKICBjb25zdCBDT01QT05FTlRTID0gMzsKICBhbHBoYTAxID0gYWxwaGEwMSAhPT0gMSA/IDAgOiBhbHBoYTAxOwogIGNvbnN0IHhSYXRpbyA9IHcxIC8gdzI7CiAgY29uc3QgeVJhdGlvID0gaDEgLyBoMjsKICBsZXQgbmV3SW5kZXggPSAwLAogICAgb2xkSW5kZXg7CiAgY29uc3QgeFNjYWxlZCA9IG5ldyBVaW50MTZBcnJheSh3Mik7CiAgY29uc3QgdzFTY2FubGluZSA9IHcxICogQ09NUE9ORU5UUzsKICBmb3IgKGxldCBpID0gMDsgaSA8IHcyOyBpKyspIHsKICAgIHhTY2FsZWRbaV0gPSBNYXRoLmZsb29yKGkgKiB4UmF0aW8pICogQ09NUE9ORU5UUzsKICB9CiAgZm9yIChsZXQgaSA9IDA7IGkgPCBoMjsgaSsrKSB7CiAgICBjb25zdCBweSA9IE1hdGguZmxvb3IoaSAqIHlSYXRpbykgKiB3MVNjYW5saW5lOwogICAgZm9yIChsZXQgaiA9IDA7IGogPCB3MjsgaisrKSB7CiAgICAgIG9sZEluZGV4ID0gcHkgKyB4U2NhbGVkW2pdOwogICAgICBkZXN0W25ld0luZGV4KytdID0gc3JjW29sZEluZGV4KytdOwogICAgICBkZXN0W25ld0luZGV4KytdID0gc3JjW29sZEluZGV4KytdOwogICAgICBkZXN0W25ld0luZGV4KytdID0gc3JjW29sZEluZGV4KytdOwogICAgICBuZXdJbmRleCArPSBhbHBoYTAxOwogICAgfQogIH0KfQpjbGFzcyBDb2xvclNwYWNlIHsKICBjb25zdHJ1Y3RvcihuYW1lLCBudW1Db21wcykgewogICAgaWYgKHRoaXMuY29uc3RydWN0b3IgPT09IENvbG9yU3BhY2UpIHsKICAgICAgKDAsIF91dGlsLnVucmVhY2hhYmxlKSgiQ2Fubm90IGluaXRpYWxpemUgQ29sb3JTcGFjZS4iKTsKICAgIH0KICAgIHRoaXMubmFtZSA9IG5hbWU7CiAgICB0aGlzLm51bUNvbXBzID0gbnVtQ29tcHM7CiAgfQogIGdldFJnYihzcmMsIHNyY09mZnNldCkgewogICAgY29uc3QgcmdiID0gbmV3IFVpbnQ4Q2xhbXBlZEFycmF5KDMpOwogICAgdGhpcy5nZXRSZ2JJdGVtKHNyYywgc3JjT2Zmc2V0LCByZ2IsIDApOwogICAgcmV0dXJuIHJnYjsKICB9CiAgZ2V0UmdiSXRlbShzcmMsIHNyY09mZnNldCwgZGVzdCwgZGVzdE9mZnNldCkgewogICAgKDAsIF91dGlsLnVucmVhY2hhYmxlKSgiU2hvdWxkIG5vdCBjYWxsIENvbG9yU3BhY2UuZ2V0UmdiSXRlbSIpOwogIH0KICBnZXRSZ2JCdWZmZXIoc3JjLCBzcmNPZmZzZXQsIGNvdW50LCBkZXN0LCBkZXN0T2Zmc2V0LCBiaXRzLCBhbHBoYTAxKSB7CiAgICAoMCwgX3V0aWwudW5yZWFjaGFibGUpKCJTaG91bGQgbm90IGNhbGwgQ29sb3JTcGFjZS5nZXRSZ2JCdWZmZXIiKTsKICB9CiAgZ2V0T3V0cHV0TGVuZ3RoKGlucHV0TGVuZ3RoLCBhbHBoYTAxKSB7CiAgICAoMCwgX3V0aWwudW5yZWFjaGFibGUpKCJTaG91bGQgbm90IGNhbGwgQ29sb3JTcGFjZS5nZXRPdXRwdXRMZW5ndGgiKTsKICB9CiAgaXNQYXNzdGhyb3VnaChiaXRzKSB7CiAgICByZXR1cm4gZmFsc2U7CiAgfQogIGlzRGVmYXVsdERlY29kZShkZWNvZGVNYXAsIGJwYykgewogICAgcmV0dXJuIENvbG9yU3BhY2UuaXNEZWZhdWx0RGVjb2RlKGRlY29kZU1hcCwgdGhpcy5udW1Db21wcyk7CiAgfQogIGZpbGxSZ2IoZGVzdCwgb3JpZ2luYWxXaWR0aCwgb3JpZ2luYWxIZWlnaHQsIHdpZHRoLCBoZWlnaHQsIGFjdHVhbEhlaWdodCwgYnBjLCBjb21wcywgYWxwaGEwMSkgewogICAgY29uc3QgY291bnQgPSBvcmlnaW5hbFdpZHRoICogb3JpZ2luYWxIZWlnaHQ7CiAgICBsZXQgcmdiQnVmID0gbnVsbDsKICAgIGNvbnN0IG51bUNvbXBvbmVudENvbG9ycyA9IDEgPDwgYnBjOwogICAgY29uc3QgbmVlZHNSZXNpemluZyA9IG9yaWdpbmFsSGVpZ2h0ICE9PSBoZWlnaHQgfHwgb3JpZ2luYWxXaWR0aCAhPT0gd2lkdGg7CiAgICBpZiAodGhpcy5pc1Bhc3N0aHJvdWdoKGJwYykpIHsKICAgICAgcmdiQnVmID0gY29tcHM7CiAgICB9IGVsc2UgaWYgKHRoaXMubnVtQ29tcHMgPT09IDEgJiYgY291bnQgPiBudW1Db21wb25lbnRDb2xvcnMgJiYgdGhpcy5uYW1lICE9PSAiRGV2aWNlR3JheSIgJiYgdGhpcy5uYW1lICE9PSAiRGV2aWNlUkdCIikgewogICAgICBjb25zdCBhbGxDb2xvcnMgPSBicGMgPD0gOCA/IG5ldyBVaW50OEFycmF5KG51bUNvbXBvbmVudENvbG9ycykgOiBuZXcgVWludDE2QXJyYXkobnVtQ29tcG9uZW50Q29sb3JzKTsKICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCBudW1Db21wb25lbnRDb2xvcnM7IGkrKykgewogICAgICAgIGFsbENvbG9yc1tpXSA9IGk7CiAgICAgIH0KICAgICAgY29uc3QgY29sb3JNYXAgPSBuZXcgVWludDhDbGFtcGVkQXJyYXkobnVtQ29tcG9uZW50Q29sb3JzICogMyk7CiAgICAgIHRoaXMuZ2V0UmdiQnVmZmVyKGFsbENvbG9ycywgMCwgbnVtQ29tcG9uZW50Q29sb3JzLCBjb2xvck1hcCwgMCwgYnBjLCAwKTsKICAgICAgaWYgKCFuZWVkc1Jlc2l6aW5nKSB7CiAgICAgICAgbGV0IGRlc3RQb3MgPSAwOwogICAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgY291bnQ7ICsraSkgewogICAgICAgICAgY29uc3Qga2V5ID0gY29tcHNbaV0gKiAzOwogICAgICAgICAgZGVzdFtkZXN0UG9zKytdID0gY29sb3JNYXBba2V5XTsKICAgICAgICAgIGRlc3RbZGVzdFBvcysrXSA9IGNvbG9yTWFwW2tleSArIDFdOwogICAgICAgICAgZGVzdFtkZXN0UG9zKytdID0gY29sb3JNYXBba2V5ICsgMl07CiAgICAgICAgICBkZXN0UG9zICs9IGFscGhhMDE7CiAgICAgICAgfQogICAgICB9IGVsc2UgewogICAgICAgIHJnYkJ1ZiA9IG5ldyBVaW50OEFycmF5KGNvdW50ICogMyk7CiAgICAgICAgbGV0IHJnYlBvcyA9IDA7CiAgICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCBjb3VudDsgKytpKSB7CiAgICAgICAgICBjb25zdCBrZXkgPSBjb21wc1tpXSAqIDM7CiAgICAgICAgICByZ2JCdWZbcmdiUG9zKytdID0gY29sb3JNYXBba2V5XTsKICAgICAgICAgIHJnYkJ1ZltyZ2JQb3MrK10gPSBjb2xvck1hcFtrZXkgKyAxXTsKICAgICAgICAgIHJnYkJ1ZltyZ2JQb3MrK10gPSBjb2xvck1hcFtrZXkgKyAyXTsKICAgICAgICB9CiAgICAgIH0KICAgIH0gZWxzZSBpZiAoIW5lZWRzUmVzaXppbmcpIHsKICAgICAgdGhpcy5nZXRSZ2JCdWZmZXIoY29tcHMsIDAsIHdpZHRoICogYWN0dWFsSGVpZ2h0LCBkZXN0LCAwLCBicGMsIGFscGhhMDEpOwogICAgfSBlbHNlIHsKICAgICAgcmdiQnVmID0gbmV3IFVpbnQ4Q2xhbXBlZEFycmF5KGNvdW50ICogMyk7CiAgICAgIHRoaXMuZ2V0UmdiQnVmZmVyKGNvbXBzLCAwLCBjb3VudCwgcmdiQnVmLCAwLCBicGMsIDApOwogICAgfQogICAgaWYgKHJnYkJ1ZikgewogICAgICBpZiAobmVlZHNSZXNpemluZykgewogICAgICAgIHJlc2l6ZVJnYkltYWdlKHJnYkJ1ZiwgZGVzdCwgb3JpZ2luYWxXaWR0aCwgb3JpZ2luYWxIZWlnaHQsIHdpZHRoLCBoZWlnaHQsIGFscGhhMDEpOwogICAgICB9IGVsc2UgewogICAgICAgIGxldCBkZXN0UG9zID0gMCwKICAgICAgICAgIHJnYlBvcyA9IDA7CiAgICAgICAgZm9yIChsZXQgaSA9IDAsIGlpID0gd2lkdGggKiBhY3R1YWxIZWlnaHQ7IGkgPCBpaTsgaSsrKSB7CiAgICAgICAgICBkZXN0W2Rlc3RQb3MrK10gPSByZ2JCdWZbcmdiUG9zKytdOwogICAgICAgICAgZGVzdFtkZXN0UG9zKytdID0gcmdiQnVmW3JnYlBvcysrXTsKICAgICAgICAgIGRlc3RbZGVzdFBvcysrXSA9IHJnYkJ1ZltyZ2JQb3MrK107CiAgICAgICAgICBkZXN0UG9zICs9IGFscGhhMDE7CiAgICAgICAgfQogICAgICB9CiAgICB9CiAgfQogIGdldCB1c2VzWmVyb1RvT25lUmFuZ2UoKSB7CiAgICByZXR1cm4gKDAsIF91dGlsLnNoYWRvdykodGhpcywgInVzZXNaZXJvVG9PbmVSYW5nZSIsIHRydWUpOwogIH0KICBzdGF0aWMgX2NhY2hlKGNhY2hlS2V5LCB4cmVmLCBsb2NhbENvbG9yU3BhY2VDYWNoZSwgcGFyc2VkQ29sb3JTcGFjZSkgewogICAgaWYgKCFsb2NhbENvbG9yU3BhY2VDYWNoZSkgewogICAgICB0aHJvdyBuZXcgRXJyb3IoJ0NvbG9yU3BhY2UuX2NhY2hlIC0gZXhwZWN0ZWQgImxvY2FsQ29sb3JTcGFjZUNhY2hlIiBhcmd1bWVudC4nKTsKICAgIH0KICAgIGlmICghcGFyc2VkQ29sb3JTcGFjZSkgewogICAgICB0aHJvdyBuZXcgRXJyb3IoJ0NvbG9yU3BhY2UuX2NhY2hlIC0gZXhwZWN0ZWQgInBhcnNlZENvbG9yU3BhY2UiIGFyZ3VtZW50LicpOwogICAgfQogICAgbGV0IGNzTmFtZSwgY3NSZWY7CiAgICBpZiAoY2FjaGVLZXkgaW5zdGFuY2VvZiBfcHJpbWl0aXZlcy5SZWYpIHsKICAgICAgY3NSZWYgPSBjYWNoZUtleTsKICAgICAgY2FjaGVLZXkgPSB4cmVmLmZldGNoKGNhY2hlS2V5KTsKICAgIH0KICAgIGlmIChjYWNoZUtleSBpbnN0YW5jZW9mIF9wcmltaXRpdmVzLk5hbWUpIHsKICAgICAgY3NOYW1lID0gY2FjaGVLZXkubmFtZTsKICAgIH0KICAgIGlmIChjc05hbWUgfHwgY3NSZWYpIHsKICAgICAgbG9jYWxDb2xvclNwYWNlQ2FjaGUuc2V0KGNzTmFtZSwgY3NSZWYsIHBhcnNlZENvbG9yU3BhY2UpOwogICAgfQogIH0KICBzdGF0aWMgZ2V0Q2FjaGVkKGNhY2hlS2V5LCB4cmVmLCBsb2NhbENvbG9yU3BhY2VDYWNoZSkgewogICAgaWYgKCFsb2NhbENvbG9yU3BhY2VDYWNoZSkgewogICAgICB0aHJvdyBuZXcgRXJyb3IoJ0NvbG9yU3BhY2UuZ2V0Q2FjaGVkIC0gZXhwZWN0ZWQgImxvY2FsQ29sb3JTcGFjZUNhY2hlIiBhcmd1bWVudC4nKTsKICAgIH0KICAgIGlmIChjYWNoZUtleSBpbnN0YW5jZW9mIF9wcmltaXRpdmVzLlJlZikgewogICAgICBjb25zdCBsb2NhbENvbG9yU3BhY2UgPSBsb2NhbENvbG9yU3BhY2VDYWNoZS5nZXRCeVJlZihjYWNoZUtleSk7CiAgICAgIGlmIChsb2NhbENvbG9yU3BhY2UpIHsKICAgICAgICByZXR1cm4gbG9jYWxDb2xvclNwYWNlOwogICAgICB9CiAgICAgIHRyeSB7CiAgICAgICAgY2FjaGVLZXkgPSB4cmVmLmZldGNoKGNhY2hlS2V5KTsKICAgICAgfSBjYXRjaCAoZXgpIHsKICAgICAgICBpZiAoZXggaW5zdGFuY2VvZiBfY29yZV91dGlscy5NaXNzaW5nRGF0YUV4Y2VwdGlvbikgewogICAgICAgICAgdGhyb3cgZXg7CiAgICAgICAgfQogICAgICB9CiAgICB9CiAgICBpZiAoY2FjaGVLZXkgaW5zdGFuY2VvZiBfcHJpbWl0aXZlcy5OYW1lKSB7CiAgICAgIGNvbnN0IGxvY2FsQ29sb3JTcGFjZSA9IGxvY2FsQ29sb3JTcGFjZUNhY2hlLmdldEJ5TmFtZShjYWNoZUtleS5uYW1lKTsKICAgICAgaWYgKGxvY2FsQ29sb3JTcGFjZSkgewogICAgICAgIHJldHVybiBsb2NhbENvbG9yU3BhY2U7CiAgICAgIH0KICAgIH0KICAgIHJldHVybiBudWxsOwogIH0KICBzdGF0aWMgYXN5bmMgcGFyc2VBc3luYyh7CiAgICBjcywKICAgIHhyZWYsCiAgICByZXNvdXJjZXMgPSBudWxsLAogICAgcGRmRnVuY3Rpb25GYWN0b3J5LAogICAgbG9jYWxDb2xvclNwYWNlQ2FjaGUKICB9KSB7CiAgICBjb25zdCBwYXJzZWRDb2xvclNwYWNlID0gdGhpcy5fcGFyc2UoY3MsIHhyZWYsIHJlc291cmNlcywgcGRmRnVuY3Rpb25GYWN0b3J5KTsKICAgIHRoaXMuX2NhY2hlKGNzLCB4cmVmLCBsb2NhbENvbG9yU3BhY2VDYWNoZSwgcGFyc2VkQ29sb3JTcGFjZSk7CiAgICByZXR1cm4gcGFyc2VkQ29sb3JTcGFjZTsKICB9CiAgc3RhdGljIHBhcnNlKHsKICAgIGNzLAogICAgeHJlZiwKICAgIHJlc291cmNlcyA9IG51bGwsCiAgICBwZGZGdW5jdGlvbkZhY3RvcnksCiAgICBsb2NhbENvbG9yU3BhY2VDYWNoZQogIH0pIHsKICAgIGNvbnN0IGNhY2hlZENvbG9yU3BhY2UgPSB0aGlzLmdldENhY2hlZChjcywgeHJlZiwgbG9jYWxDb2xvclNwYWNlQ2FjaGUpOwogICAgaWYgKGNhY2hlZENvbG9yU3BhY2UpIHsKICAgICAgcmV0dXJuIGNhY2hlZENvbG9yU3BhY2U7CiAgICB9CiAgICBjb25zdCBwYXJzZWRDb2xvclNwYWNlID0gdGhpcy5fcGFyc2UoY3MsIHhyZWYsIHJlc291cmNlcywgcGRmRnVuY3Rpb25GYWN0b3J5KTsKICAgIHRoaXMuX2NhY2hlKGNzLCB4cmVmLCBsb2NhbENvbG9yU3BhY2VDYWNoZSwgcGFyc2VkQ29sb3JTcGFjZSk7CiAgICByZXR1cm4gcGFyc2VkQ29sb3JTcGFjZTsKICB9CiAgc3RhdGljIF9wYXJzZShjcywgeHJlZiwgcmVzb3VyY2VzID0gbnVsbCwgcGRmRnVuY3Rpb25GYWN0b3J5KSB7CiAgICBjcyA9IHhyZWYuZmV0Y2hJZlJlZihjcyk7CiAgICBpZiAoY3MgaW5zdGFuY2VvZiBfcHJpbWl0aXZlcy5OYW1lKSB7CiAgICAgIHN3aXRjaCAoY3MubmFtZSkgewogICAgICAgIGNhc2UgIkciOgogICAgICAgIGNhc2UgIkRldmljZUdyYXkiOgogICAgICAgICAgcmV0dXJuIHRoaXMuc2luZ2xldG9ucy5ncmF5OwogICAgICAgIGNhc2UgIlJHQiI6CiAgICAgICAgY2FzZSAiRGV2aWNlUkdCIjoKICAgICAgICAgIHJldHVybiB0aGlzLnNpbmdsZXRvbnMucmdiOwogICAgICAgIGNhc2UgIkNNWUsiOgogICAgICAgIGNhc2UgIkRldmljZUNNWUsiOgogICAgICAgICAgcmV0dXJuIHRoaXMuc2luZ2xldG9ucy5jbXlrOwogICAgICAgIGNhc2UgIlBhdHRlcm4iOgogICAgICAgICAgcmV0dXJuIG5ldyBQYXR0ZXJuQ1MobnVsbCk7CiAgICAgICAgZGVmYXVsdDoKICAgICAgICAgIGlmIChyZXNvdXJjZXMgaW5zdGFuY2VvZiBfcHJpbWl0aXZlcy5EaWN0KSB7CiAgICAgICAgICAgIGNvbnN0IGNvbG9yU3BhY2VzID0gcmVzb3VyY2VzLmdldCgiQ29sb3JTcGFjZSIpOwogICAgICAgICAgICBpZiAoY29sb3JTcGFjZXMgaW5zdGFuY2VvZiBfcHJpbWl0aXZlcy5EaWN0KSB7CiAgICAgICAgICAgICAgY29uc3QgcmVzb3VyY2VzQ1MgPSBjb2xvclNwYWNlcy5nZXQoY3MubmFtZSk7CiAgICAgICAgICAgICAgaWYgKHJlc291cmNlc0NTKSB7CiAgICAgICAgICAgICAgICBpZiAocmVzb3VyY2VzQ1MgaW5zdGFuY2VvZiBfcHJpbWl0aXZlcy5OYW1lKSB7CiAgICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLl9wYXJzZShyZXNvdXJjZXNDUywgeHJlZiwgcmVzb3VyY2VzLCBwZGZGdW5jdGlvbkZhY3RvcnkpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgY3MgPSByZXNvdXJjZXNDUzsKICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgICAgdGhyb3cgbmV3IF91dGlsLkZvcm1hdEVycm9yKGBVbnJlY29nbml6ZWQgQ29sb3JTcGFjZTogJHtjcy5uYW1lfWApOwogICAgICB9CiAgICB9CiAgICBpZiAoQXJyYXkuaXNBcnJheShjcykpIHsKICAgICAgY29uc3QgbW9kZSA9IHhyZWYuZmV0Y2hJZlJlZihjc1swXSkubmFtZTsKICAgICAgbGV0IHBhcmFtcywgbnVtQ29tcHMsIGJhc2VDUywgd2hpdGVQb2ludCwgYmxhY2tQb2ludCwgZ2FtbWE7CiAgICAgIHN3aXRjaCAobW9kZSkgewogICAgICAgIGNhc2UgIkciOgogICAgICAgIGNhc2UgIkRldmljZUdyYXkiOgogICAgICAgICAgcmV0dXJuIHRoaXMuc2luZ2xldG9ucy5ncmF5OwogICAgICAgIGNhc2UgIlJHQiI6CiAgICAgICAgY2FzZSAiRGV2aWNlUkdCIjoKICAgICAgICAgIHJldHVybiB0aGlzLnNpbmdsZXRvbnMucmdiOwogICAgICAgIGNhc2UgIkNNWUsiOgogICAgICAgIGNhc2UgIkRldmljZUNNWUsiOgogICAgICAgICAgcmV0dXJuIHRoaXMuc2luZ2xldG9ucy5jbXlrOwogICAgICAgIGNhc2UgIkNhbEdyYXkiOgogICAgICAgICAgcGFyYW1zID0geHJlZi5mZXRjaElmUmVmKGNzWzFdKTsKICAgICAgICAgIHdoaXRlUG9pbnQgPSBwYXJhbXMuZ2V0QXJyYXkoIldoaXRlUG9pbnQiKTsKICAgICAgICAgIGJsYWNrUG9pbnQgPSBwYXJhbXMuZ2V0QXJyYXkoIkJsYWNrUG9pbnQiKTsKICAgICAgICAgIGdhbW1hID0gcGFyYW1zLmdldCgiR2FtbWEiKTsKICAgICAgICAgIHJldHVybiBuZXcgQ2FsR3JheUNTKHdoaXRlUG9pbnQsIGJsYWNrUG9pbnQsIGdhbW1hKTsKICAgICAgICBjYXNlICJDYWxSR0IiOgogICAgICAgICAgcGFyYW1zID0geHJlZi5mZXRjaElmUmVmKGNzWzFdKTsKICAgICAgICAgIHdoaXRlUG9pbnQgPSBwYXJhbXMuZ2V0QXJyYXkoIldoaXRlUG9pbnQiKTsKICAgICAgICAgIGJsYWNrUG9pbnQgPSBwYXJhbXMuZ2V0QXJyYXkoIkJsYWNrUG9pbnQiKTsKICAgICAgICAgIGdhbW1hID0gcGFyYW1zLmdldEFycmF5KCJHYW1tYSIpOwogICAgICAgICAgY29uc3QgbWF0cml4ID0gcGFyYW1zLmdldEFycmF5KCJNYXRyaXgiKTsKICAgICAgICAgIHJldHVybiBuZXcgQ2FsUkdCQ1Mod2hpdGVQb2ludCwgYmxhY2tQb2ludCwgZ2FtbWEsIG1hdHJpeCk7CiAgICAgICAgY2FzZSAiSUNDQmFzZWQiOgogICAgICAgICAgY29uc3Qgc3RyZWFtID0geHJlZi5mZXRjaElmUmVmKGNzWzFdKTsKICAgICAgICAgIGNvbnN0IGRpY3QgPSBzdHJlYW0uZGljdDsKICAgICAgICAgIG51bUNvbXBzID0gZGljdC5nZXQoIk4iKTsKICAgICAgICAgIGNvbnN0IGFsdCA9IGRpY3QuZ2V0KCJBbHRlcm5hdGUiKTsKICAgICAgICAgIGlmIChhbHQpIHsKICAgICAgICAgICAgY29uc3QgYWx0Q1MgPSB0aGlzLl9wYXJzZShhbHQsIHhyZWYsIHJlc291cmNlcywgcGRmRnVuY3Rpb25GYWN0b3J5KTsKICAgICAgICAgICAgaWYgKGFsdENTLm51bUNvbXBzID09PSBudW1Db21wcykgewogICAgICAgICAgICAgIHJldHVybiBhbHRDUzsKICAgICAgICAgICAgfQogICAgICAgICAgICAoMCwgX3V0aWwud2FybikoIklDQ0Jhc2VkIGNvbG9yIHNwYWNlOiBJZ25vcmluZyBpbmNvcnJlY3QgL0FsdGVybmF0ZSBlbnRyeS4iKTsKICAgICAgICAgIH0KICAgICAgICAgIGlmIChudW1Db21wcyA9PT0gMSkgewogICAgICAgICAgICByZXR1cm4gdGhpcy5zaW5nbGV0b25zLmdyYXk7CiAgICAgICAgICB9IGVsc2UgaWYgKG51bUNvbXBzID09PSAzKSB7CiAgICAgICAgICAgIHJldHVybiB0aGlzLnNpbmdsZXRvbnMucmdiOwogICAgICAgICAgfSBlbHNlIGlmIChudW1Db21wcyA9PT0gNCkgewogICAgICAgICAgICByZXR1cm4gdGhpcy5zaW5nbGV0b25zLmNteWs7CiAgICAgICAgICB9CiAgICAgICAgICBicmVhazsKICAgICAgICBjYXNlICJQYXR0ZXJuIjoKICAgICAgICAgIGJhc2VDUyA9IGNzWzFdIHx8IG51bGw7CiAgICAgICAgICBpZiAoYmFzZUNTKSB7CiAgICAgICAgICAgIGJhc2VDUyA9IHRoaXMuX3BhcnNlKGJhc2VDUywgeHJlZiwgcmVzb3VyY2VzLCBwZGZGdW5jdGlvbkZhY3RvcnkpOwogICAgICAgICAgfQogICAgICAgICAgcmV0dXJuIG5ldyBQYXR0ZXJuQ1MoYmFzZUNTKTsKICAgICAgICBjYXNlICJJIjoKICAgICAgICBjYXNlICJJbmRleGVkIjoKICAgICAgICAgIGJhc2VDUyA9IHRoaXMuX3BhcnNlKGNzWzFdLCB4cmVmLCByZXNvdXJjZXMsIHBkZkZ1bmN0aW9uRmFjdG9yeSk7CiAgICAgICAgICBjb25zdCBoaVZhbCA9IHhyZWYuZmV0Y2hJZlJlZihjc1syXSkgKyAxOwogICAgICAgICAgY29uc3QgbG9va3VwID0geHJlZi5mZXRjaElmUmVmKGNzWzNdKTsKICAgICAgICAgIHJldHVybiBuZXcgSW5kZXhlZENTKGJhc2VDUywgaGlWYWwsIGxvb2t1cCk7CiAgICAgICAgY2FzZSAiU2VwYXJhdGlvbiI6CiAgICAgICAgY2FzZSAiRGV2aWNlTiI6CiAgICAgICAgICBjb25zdCBuYW1lID0geHJlZi5mZXRjaElmUmVmKGNzWzFdKTsKICAgICAgICAgIG51bUNvbXBzID0gQXJyYXkuaXNBcnJheShuYW1lKSA/IG5hbWUubGVuZ3RoIDogMTsKICAgICAgICAgIGJhc2VDUyA9IHRoaXMuX3BhcnNlKGNzWzJdLCB4cmVmLCByZXNvdXJjZXMsIHBkZkZ1bmN0aW9uRmFjdG9yeSk7CiAgICAgICAgICBjb25zdCB0aW50Rm4gPSBwZGZGdW5jdGlvbkZhY3RvcnkuY3JlYXRlKGNzWzNdKTsKICAgICAgICAgIHJldHVybiBuZXcgQWx0ZXJuYXRlQ1MobnVtQ29tcHMsIGJhc2VDUywgdGludEZuKTsKICAgICAgICBjYXNlICJMYWIiOgogICAgICAgICAgcGFyYW1zID0geHJlZi5mZXRjaElmUmVmKGNzWzFdKTsKICAgICAgICAgIHdoaXRlUG9pbnQgPSBwYXJhbXMuZ2V0QXJyYXkoIldoaXRlUG9pbnQiKTsKICAgICAgICAgIGJsYWNrUG9pbnQgPSBwYXJhbXMuZ2V0QXJyYXkoIkJsYWNrUG9pbnQiKTsKICAgICAgICAgIGNvbnN0IHJhbmdlID0gcGFyYW1zLmdldEFycmF5KCJSYW5nZSIpOwogICAgICAgICAgcmV0dXJuIG5ldyBMYWJDUyh3aGl0ZVBvaW50LCBibGFja1BvaW50LCByYW5nZSk7CiAgICAgICAgZGVmYXVsdDoKICAgICAgICAgIHRocm93IG5ldyBfdXRpbC5Gb3JtYXRFcnJvcihgVW5pbXBsZW1lbnRlZCBDb2xvclNwYWNlIG9iamVjdDogJHttb2RlfWApOwogICAgICB9CiAgICB9CiAgICB0aHJvdyBuZXcgX3V0aWwuRm9ybWF0RXJyb3IoYFVucmVjb2duaXplZCBDb2xvclNwYWNlIG9iamVjdDogJHtjc31gKTsKICB9CiAgc3RhdGljIGlzRGVmYXVsdERlY29kZShkZWNvZGUsIG51bUNvbXBzKSB7CiAgICBpZiAoIUFycmF5LmlzQXJyYXkoZGVjb2RlKSkgewogICAgICByZXR1cm4gdHJ1ZTsKICAgIH0KICAgIGlmIChudW1Db21wcyAqIDIgIT09IGRlY29kZS5sZW5ndGgpIHsKICAgICAgKDAsIF91dGlsLndhcm4pKCJUaGUgZGVjb2RlIG1hcCBpcyBub3QgdGhlIGNvcnJlY3QgbGVuZ3RoIik7CiAgICAgIHJldHVybiB0cnVlOwogICAgfQogICAgZm9yIChsZXQgaSA9IDAsIGlpID0gZGVjb2RlLmxlbmd0aDsgaSA8IGlpOyBpICs9IDIpIHsKICAgICAgaWYgKGRlY29kZVtpXSAhPT0gMCB8fCBkZWNvZGVbaSArIDFdICE9PSAxKSB7CiAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICB9CiAgICB9CiAgICByZXR1cm4gdHJ1ZTsKICB9CiAgc3RhdGljIGdldCBzaW5nbGV0b25zKCkgewogICAgcmV0dXJuICgwLCBfdXRpbC5zaGFkb3cpKHRoaXMsICJzaW5nbGV0b25zIiwgewogICAgICBnZXQgZ3JheSgpIHsKICAgICAgICByZXR1cm4gKDAsIF91dGlsLnNoYWRvdykodGhpcywgImdyYXkiLCBuZXcgRGV2aWNlR3JheUNTKCkpOwogICAgICB9LAogICAgICBnZXQgcmdiKCkgewogICAgICAgIHJldHVybiAoMCwgX3V0aWwuc2hhZG93KSh0aGlzLCAicmdiIiwgbmV3IERldmljZVJnYkNTKCkpOwogICAgICB9LAogICAgICBnZXQgY215aygpIHsKICAgICAgICByZXR1cm4gKDAsIF91dGlsLnNoYWRvdykodGhpcywgImNteWsiLCBuZXcgRGV2aWNlQ215a0NTKCkpOwogICAgICB9CiAgICB9KTsKICB9Cn0KZXhwb3J0cy5Db2xvclNwYWNlID0gQ29sb3JTcGFjZTsKY2xhc3MgQWx0ZXJuYXRlQ1MgZXh0ZW5kcyBDb2xvclNwYWNlIHsKICBjb25zdHJ1Y3RvcihudW1Db21wcywgYmFzZSwgdGludEZuKSB7CiAgICBzdXBlcigiQWx0ZXJuYXRlIiwgbnVtQ29tcHMpOwogICAgdGhpcy5iYXNlID0gYmFzZTsKICAgIHRoaXMudGludEZuID0gdGludEZuOwogICAgdGhpcy50bXBCdWYgPSBuZXcgRmxvYXQzMkFycmF5KGJhc2UubnVtQ29tcHMpOwogIH0KICBnZXRSZ2JJdGVtKHNyYywgc3JjT2Zmc2V0LCBkZXN0LCBkZXN0T2Zmc2V0KSB7CiAgICBjb25zdCB0bXBCdWYgPSB0aGlzLnRtcEJ1ZjsKICAgIHRoaXMudGludEZuKHNyYywgc3JjT2Zmc2V0LCB0bXBCdWYsIDApOwogICAgdGhpcy5iYXNlLmdldFJnYkl0ZW0odG1wQnVmLCAwLCBkZXN0LCBkZXN0T2Zmc2V0KTsKICB9CiAgZ2V0UmdiQnVmZmVyKHNyYywgc3JjT2Zmc2V0LCBjb3VudCwgZGVzdCwgZGVzdE9mZnNldCwgYml0cywgYWxwaGEwMSkgewogICAgY29uc3QgdGludEZuID0gdGhpcy50aW50Rm47CiAgICBjb25zdCBiYXNlID0gdGhpcy5iYXNlOwogICAgY29uc3Qgc2NhbGUgPSAxIC8gKCgxIDw8IGJpdHMpIC0gMSk7CiAgICBjb25zdCBiYXNlTnVtQ29tcHMgPSBiYXNlLm51bUNvbXBzOwogICAgY29uc3QgdXNlc1plcm9Ub09uZVJhbmdlID0gYmFzZS51c2VzWmVyb1RvT25lUmFuZ2U7CiAgICBjb25zdCBpc1Bhc3N0aHJvdWdoID0gKGJhc2UuaXNQYXNzdGhyb3VnaCg4KSB8fCAhdXNlc1plcm9Ub09uZVJhbmdlKSAmJiBhbHBoYTAxID09PSAwOwogICAgbGV0IHBvcyA9IGlzUGFzc3Rocm91Z2ggPyBkZXN0T2Zmc2V0IDogMDsKICAgIGNvbnN0IGJhc2VCdWYgPSBpc1Bhc3N0aHJvdWdoID8gZGVzdCA6IG5ldyBVaW50OENsYW1wZWRBcnJheShiYXNlTnVtQ29tcHMgKiBjb3VudCk7CiAgICBjb25zdCBudW1Db21wcyA9IHRoaXMubnVtQ29tcHM7CiAgICBjb25zdCBzY2FsZWQgPSBuZXcgRmxvYXQzMkFycmF5KG51bUNvbXBzKTsKICAgIGNvbnN0IHRpbnRlZCA9IG5ldyBGbG9hdDMyQXJyYXkoYmFzZU51bUNvbXBzKTsKICAgIGxldCBpLCBqOwogICAgZm9yIChpID0gMDsgaSA8IGNvdW50OyBpKyspIHsKICAgICAgZm9yIChqID0gMDsgaiA8IG51bUNvbXBzOyBqKyspIHsKICAgICAgICBzY2FsZWRbal0gPSBzcmNbc3JjT2Zmc2V0KytdICogc2NhbGU7CiAgICAgIH0KICAgICAgdGludEZuKHNjYWxlZCwgMCwgdGludGVkLCAwKTsKICAgICAgaWYgKHVzZXNaZXJvVG9PbmVSYW5nZSkgewogICAgICAgIGZvciAoaiA9IDA7IGogPCBiYXNlTnVtQ29tcHM7IGorKykgewogICAgICAgICAgYmFzZUJ1Zltwb3MrK10gPSB0aW50ZWRbal0gKiAyNTU7CiAgICAgICAgfQogICAgICB9IGVsc2UgewogICAgICAgIGJhc2UuZ2V0UmdiSXRlbSh0aW50ZWQsIDAsIGJhc2VCdWYsIHBvcyk7CiAgICAgICAgcG9zICs9IGJhc2VOdW1Db21wczsKICAgICAgfQogICAgfQogICAgaWYgKCFpc1Bhc3N0aHJvdWdoKSB7CiAgICAgIGJhc2UuZ2V0UmdiQnVmZmVyKGJhc2VCdWYsIDAsIGNvdW50LCBkZXN0LCBkZXN0T2Zmc2V0LCA4LCBhbHBoYTAxKTsKICAgIH0KICB9CiAgZ2V0T3V0cHV0TGVuZ3RoKGlucHV0TGVuZ3RoLCBhbHBoYTAxKSB7CiAgICByZXR1cm4gdGhpcy5iYXNlLmdldE91dHB1dExlbmd0aChpbnB1dExlbmd0aCAqIHRoaXMuYmFzZS5udW1Db21wcyAvIHRoaXMubnVtQ29tcHMsIGFscGhhMDEpOwogIH0KfQpjbGFzcyBQYXR0ZXJuQ1MgZXh0ZW5kcyBDb2xvclNwYWNlIHsKICBjb25zdHJ1Y3RvcihiYXNlQ1MpIHsKICAgIHN1cGVyKCJQYXR0ZXJuIiwgbnVsbCk7CiAgICB0aGlzLmJhc2UgPSBiYXNlQ1M7CiAgfQogIGlzRGVmYXVsdERlY29kZShkZWNvZGVNYXAsIGJwYykgewogICAgKDAsIF91dGlsLnVucmVhY2hhYmxlKSgiU2hvdWxkIG5vdCBjYWxsIFBhdHRlcm5DUy5pc0RlZmF1bHREZWNvZGUiKTsKICB9Cn0KY2xhc3MgSW5kZXhlZENTIGV4dGVuZHMgQ29sb3JTcGFjZSB7CiAgY29uc3RydWN0b3IoYmFzZSwgaGlnaFZhbCwgbG9va3VwKSB7CiAgICBzdXBlcigiSW5kZXhlZCIsIDEpOwogICAgdGhpcy5iYXNlID0gYmFzZTsKICAgIHRoaXMuaGlnaFZhbCA9IGhpZ2hWYWw7CiAgICBjb25zdCBsZW5ndGggPSBiYXNlLm51bUNvbXBzICogaGlnaFZhbDsKICAgIHRoaXMubG9va3VwID0gbmV3IFVpbnQ4QXJyYXkobGVuZ3RoKTsKICAgIGlmIChsb29rdXAgaW5zdGFuY2VvZiBfYmFzZV9zdHJlYW0uQmFzZVN0cmVhbSkgewogICAgICBjb25zdCBieXRlcyA9IGxvb2t1cC5nZXRCeXRlcyhsZW5ndGgpOwogICAgICB0aGlzLmxvb2t1cC5zZXQoYnl0ZXMpOwogICAgfSBlbHNlIGlmICh0eXBlb2YgbG9va3VwID09PSAic3RyaW5nIikgewogICAgICBmb3IgKGxldCBpID0gMDsgaSA8IGxlbmd0aDsgKytpKSB7CiAgICAgICAgdGhpcy5sb29rdXBbaV0gPSBsb29rdXAuY2hhckNvZGVBdChpKSAmIDB4ZmY7CiAgICAgIH0KICAgIH0gZWxzZSB7CiAgICAgIHRocm93IG5ldyBfdXRpbC5Gb3JtYXRFcnJvcihgSW5kZXhlZENTIC0gdW5yZWNvZ25pemVkIGxvb2t1cCB0YWJsZTogJHtsb29rdXB9YCk7CiAgICB9CiAgfQogIGdldFJnYkl0ZW0oc3JjLCBzcmNPZmZzZXQsIGRlc3QsIGRlc3RPZmZzZXQpIHsKICAgIGNvbnN0IG51bUNvbXBzID0gdGhpcy5iYXNlLm51bUNvbXBzOwogICAgY29uc3Qgc3RhcnQgPSBzcmNbc3JjT2Zmc2V0XSAqIG51bUNvbXBzOwogICAgdGhpcy5iYXNlLmdldFJnYkJ1ZmZlcih0aGlzLmxvb2t1cCwgc3RhcnQsIDEsIGRlc3QsIGRlc3RPZmZzZXQsIDgsIDApOwogIH0KICBnZXRSZ2JCdWZmZXIoc3JjLCBzcmNPZmZzZXQsIGNvdW50LCBkZXN0LCBkZXN0T2Zmc2V0LCBiaXRzLCBhbHBoYTAxKSB7CiAgICBjb25zdCBiYXNlID0gdGhpcy5iYXNlOwogICAgY29uc3QgbnVtQ29tcHMgPSBiYXNlLm51bUNvbXBzOwogICAgY29uc3Qgb3V0cHV0RGVsdGEgPSBiYXNlLmdldE91dHB1dExlbmd0aChudW1Db21wcywgYWxwaGEwMSk7CiAgICBjb25zdCBsb29rdXAgPSB0aGlzLmxvb2t1cDsKICAgIGZvciAobGV0IGkgPSAwOyBpIDwgY291bnQ7ICsraSkgewogICAgICBjb25zdCBsb29rdXBQb3MgPSBzcmNbc3JjT2Zmc2V0KytdICogbnVtQ29tcHM7CiAgICAgIGJhc2UuZ2V0UmdiQnVmZmVyKGxvb2t1cCwgbG9va3VwUG9zLCAxLCBkZXN0LCBkZXN0T2Zmc2V0LCA4LCBhbHBoYTAxKTsKICAgICAgZGVzdE9mZnNldCArPSBvdXRwdXREZWx0YTsKICAgIH0KICB9CiAgZ2V0T3V0cHV0TGVuZ3RoKGlucHV0TGVuZ3RoLCBhbHBoYTAxKSB7CiAgICByZXR1cm4gdGhpcy5iYXNlLmdldE91dHB1dExlbmd0aChpbnB1dExlbmd0aCAqIHRoaXMuYmFzZS5udW1Db21wcywgYWxwaGEwMSk7CiAgfQogIGlzRGVmYXVsdERlY29kZShkZWNvZGVNYXAsIGJwYykgewogICAgaWYgKCFBcnJheS5pc0FycmF5KGRlY29kZU1hcCkpIHsKICAgICAgcmV0dXJuIHRydWU7CiAgICB9CiAgICBpZiAoZGVjb2RlTWFwLmxlbmd0aCAhPT0gMikgewogICAgICAoMCwgX3V0aWwud2FybikoIkRlY29kZSBtYXAgbGVuZ3RoIGlzIG5vdCBjb3JyZWN0Iik7CiAgICAgIHJldHVybiB0cnVlOwogICAgfQogICAgaWYgKCFOdW1iZXIuaXNJbnRlZ2VyKGJwYykgfHwgYnBjIDwgMSkgewogICAgICAoMCwgX3V0aWwud2FybikoIkJpdHMgcGVyIGNvbXBvbmVudCBpcyBub3QgY29ycmVjdCIpOwogICAgICByZXR1cm4gdHJ1ZTsKICAgIH0KICAgIHJldHVybiBkZWNvZGVNYXBbMF0gPT09IDAgJiYgZGVjb2RlTWFwWzFdID09PSAoMSA8PCBicGMpIC0gMTsKICB9Cn0KY2xhc3MgRGV2aWNlR3JheUNTIGV4dGVuZHMgQ29sb3JTcGFjZSB7CiAgY29uc3RydWN0b3IoKSB7CiAgICBzdXBlcigiRGV2aWNlR3JheSIsIDEpOwogIH0KICBnZXRSZ2JJdGVtKHNyYywgc3JjT2Zmc2V0LCBkZXN0LCBkZXN0T2Zmc2V0KSB7CiAgICBjb25zdCBjID0gc3JjW3NyY09mZnNldF0gKiAyNTU7CiAgICBkZXN0W2Rlc3RPZmZzZXRdID0gZGVzdFtkZXN0T2Zmc2V0ICsgMV0gPSBkZXN0W2Rlc3RPZmZzZXQgKyAyXSA9IGM7CiAgfQogIGdldFJnYkJ1ZmZlcihzcmMsIHNyY09mZnNldCwgY291bnQsIGRlc3QsIGRlc3RPZmZzZXQsIGJpdHMsIGFscGhhMDEpIHsKICAgIGNvbnN0IHNjYWxlID0gMjU1IC8gKCgxIDw8IGJpdHMpIC0gMSk7CiAgICBsZXQgaiA9IHNyY09mZnNldCwKICAgICAgcSA9IGRlc3RPZmZzZXQ7CiAgICBmb3IgKGxldCBpID0gMDsgaSA8IGNvdW50OyArK2kpIHsKICAgICAgY29uc3QgYyA9IHNjYWxlICogc3JjW2orK107CiAgICAgIGRlc3RbcSsrXSA9IGM7CiAgICAgIGRlc3RbcSsrXSA9IGM7CiAgICAgIGRlc3RbcSsrXSA9IGM7CiAgICAgIHEgKz0gYWxwaGEwMTsKICAgIH0KICB9CiAgZ2V0T3V0cHV0TGVuZ3RoKGlucHV0TGVuZ3RoLCBhbHBoYTAxKSB7CiAgICByZXR1cm4gaW5wdXRMZW5ndGggKiAoMyArIGFscGhhMDEpOwogIH0KfQpjbGFzcyBEZXZpY2VSZ2JDUyBleHRlbmRzIENvbG9yU3BhY2UgewogIGNvbnN0cnVjdG9yKCkgewogICAgc3VwZXIoIkRldmljZVJHQiIsIDMpOwogIH0KICBnZXRSZ2JJdGVtKHNyYywgc3JjT2Zmc2V0LCBkZXN0LCBkZXN0T2Zmc2V0KSB7CiAgICBkZXN0W2Rlc3RPZmZzZXRdID0gc3JjW3NyY09mZnNldF0gKiAyNTU7CiAgICBkZXN0W2Rlc3RPZmZzZXQgKyAxXSA9IHNyY1tzcmNPZmZzZXQgKyAxXSAqIDI1NTsKICAgIGRlc3RbZGVzdE9mZnNldCArIDJdID0gc3JjW3NyY09mZnNldCArIDJdICogMjU1OwogIH0KICBnZXRSZ2JCdWZmZXIoc3JjLCBzcmNPZmZzZXQsIGNvdW50LCBkZXN0LCBkZXN0T2Zmc2V0LCBiaXRzLCBhbHBoYTAxKSB7CiAgICBpZiAoYml0cyA9PT0gOCAmJiBhbHBoYTAxID09PSAwKSB7CiAgICAgIGRlc3Quc2V0KHNyYy5zdWJhcnJheShzcmNPZmZzZXQsIHNyY09mZnNldCArIGNvdW50ICogMyksIGRlc3RPZmZzZXQpOwogICAgICByZXR1cm47CiAgICB9CiAgICBjb25zdCBzY2FsZSA9IDI1NSAvICgoMSA8PCBiaXRzKSAtIDEpOwogICAgbGV0IGogPSBzcmNPZmZzZXQsCiAgICAgIHEgPSBkZXN0T2Zmc2V0OwogICAgZm9yIChsZXQgaSA9IDA7IGkgPCBjb3VudDsgKytpKSB7CiAgICAgIGRlc3RbcSsrXSA9IHNjYWxlICogc3JjW2orK107CiAgICAgIGRlc3RbcSsrXSA9IHNjYWxlICogc3JjW2orK107CiAgICAgIGRlc3RbcSsrXSA9IHNjYWxlICogc3JjW2orK107CiAgICAgIHEgKz0gYWxwaGEwMTsKICAgIH0KICB9CiAgZ2V0T3V0cHV0TGVuZ3RoKGlucHV0TGVuZ3RoLCBhbHBoYTAxKSB7CiAgICByZXR1cm4gaW5wdXRMZW5ndGggKiAoMyArIGFscGhhMDEpIC8gMyB8IDA7CiAgfQogIGlzUGFzc3Rocm91Z2goYml0cykgewogICAgcmV0dXJuIGJpdHMgPT09IDg7CiAgfQp9CmNsYXNzIERldmljZUNteWtDUyBleHRlbmRzIENvbG9yU3BhY2UgewogIGNvbnN0cnVjdG9yKCkgewogICAgc3VwZXIoIkRldmljZUNNWUsiLCA0KTsKICB9CiAgI3RvUmdiKHNyYywgc3JjT2Zmc2V0LCBzcmNTY2FsZSwgZGVzdCwgZGVzdE9mZnNldCkgewogICAgY29uc3QgYyA9IHNyY1tzcmNPZmZzZXRdICogc3JjU2NhbGU7CiAgICBjb25zdCBtID0gc3JjW3NyY09mZnNldCArIDFdICogc3JjU2NhbGU7CiAgICBjb25zdCB5ID0gc3JjW3NyY09mZnNldCArIDJdICogc3JjU2NhbGU7CiAgICBjb25zdCBrID0gc3JjW3NyY09mZnNldCArIDNdICogc3JjU2NhbGU7CiAgICBkZXN0W2Rlc3RPZmZzZXRdID0gMjU1ICsgYyAqICgtNC4zODczMzIzODQ2MDk5ODggKiBjICsgNTQuNDg2MTUxOTQxODkxNzYgKiBtICsgMTguODIyOTA1MDIxNjUzMDIgKiB5ICsgMjEyLjI1NjYyNDUxNjM5NTg1ICogayArIC0yODUuMjMzMTAyNjEzNzAwNCkgKyBtICogKDEuNzE0OTc2MzQ3NzM2MjEzNCAqIG0gLSA1LjYwOTY3MzY5MDQwNDczMTUgKiB5ICsgLTE3Ljg3Mzg3MDg2MTQxNTQ0NCAqIGsgLSA1LjQ5NzAwNjQyNzE5NjM2NikgKyB5ICogKC0yLjUyMTczNDAxMzE2ODMwMzMgKiB5IC0gMjEuMjQ4OTIzMzM3MzUzMDczICogayArIDE3LjUxMTkyNzA4NDE4MTMpICsgayAqICgtMjEuODYxMjIxNDc0NjM2MDUgKiBrIC0gMTg5LjQ4MTgwODM1OTIyNzQ3KTsKICAgIGRlc3RbZGVzdE9mZnNldCArIDFdID0gMjU1ICsgYyAqICg4Ljg0MTA0MTQyMjAzNjE0OSAqIGMgKyA2MC4xMTgwMjcwNDU1OTczNjYgKiBtICsgNi44NzE0MjU1OTIwNDkwMDcgKiB5ICsgMzEuMTU5MTAwMTMwMDU1OTIyICogayArIC03OS4yOTcwODQ0ODE2NTQ4KSArIG0gKiAoLTE1LjMxMDM2MTMwNjk2NzgxNyAqIG0gKyAxNy41NzUyNTEyNjExMDk0ODIgKiB5ICsgMTMxLjM1MjUwOTEyNDkzOTc2ICogayAtIDE5MC45NDUzMzAyNTg4OTUxKSArIHkgKiAoNC40NDQzMzkxMDI4NTI3MzkgKiB5ICsgOS44NjMyODYxNDkzNDA1ICogayAtIDI0Ljg2NzQxNTgyNTU1ODc4KSArIGsgKiAoLTIwLjczNzMyNTQ3MTE4MTAzNCAqIGsgLSAxODcuODA0NTM3MDk3MTk1NzgpOwogICAgZGVzdFtkZXN0T2Zmc2V0ICsgMl0gPSAyNTUgKyBjICogKDAuODg0MjUyMjQzMDAwMzI5NiAqIGMgKyA4LjA3ODY3NzUwMzExMjkyOCAqIG0gKyAzMC44OTk3ODMwOTcwMzcyOSAqIHkgLSAwLjIzODgzMjM4Njg5MTc4OTM0ICogayArIC0xNC4xODM1NzY3OTk2NzMyODYpICsgbSAqICgxMC40OTU5MzI3MzQzMjA3MiAqIG0gKyA2My4wMjM3ODQ5NDc1NDA1MiAqIHkgKyA1MC42MDY5NTc2NTYzNjA3MzQgKiBrIC0gMTEyLjIzODg0MjUzNzE5MjQ4KSArIHkgKiAoMC4wMzI5NjA0MTExNDg3MzIxNyAqIHkgKyAxMTUuNjAzODQ0NDk2NDY2NDEgKiBrICsgLTE5My41ODIwOTM1Njg2MTUwNSkgKyBrICogKC0yMi4zMzgxNjgwNzMwOTg4NiAqIGsgLSAxODAuMTI2MTM5NzQ3MDgzNjcpOwogIH0KICBnZXRSZ2JJdGVtKHNyYywgc3JjT2Zmc2V0LCBkZXN0LCBkZXN0T2Zmc2V0KSB7CiAgICB0aGlzLiN0b1JnYihzcmMsIHNyY09mZnNldCwgMSwgZGVzdCwgZGVzdE9mZnNldCk7CiAgfQogIGdldFJnYkJ1ZmZlcihzcmMsIHNyY09mZnNldCwgY291bnQsIGRlc3QsIGRlc3RPZmZzZXQsIGJpdHMsIGFscGhhMDEpIHsKICAgIGNvbnN0IHNjYWxlID0gMSAvICgoMSA8PCBiaXRzKSAtIDEpOwogICAgZm9yIChsZXQgaSA9IDA7IGkgPCBjb3VudDsgaSsrKSB7CiAgICAgIHRoaXMuI3RvUmdiKHNyYywgc3JjT2Zmc2V0LCBzY2FsZSwgZGVzdCwgZGVzdE9mZnNldCk7CiAgICAgIHNyY09mZnNldCArPSA0OwogICAgICBkZXN0T2Zmc2V0ICs9IDMgKyBhbHBoYTAxOwogICAgfQogIH0KICBnZXRPdXRwdXRMZW5ndGgoaW5wdXRMZW5ndGgsIGFscGhhMDEpIHsKICAgIHJldHVybiBpbnB1dExlbmd0aCAvIDQgKiAoMyArIGFscGhhMDEpIHwgMDsKICB9Cn0KY2xhc3MgQ2FsR3JheUNTIGV4dGVuZHMgQ29sb3JTcGFjZSB7CiAgY29uc3RydWN0b3Iod2hpdGVQb2ludCwgYmxhY2tQb2ludCwgZ2FtbWEpIHsKICAgIHN1cGVyKCJDYWxHcmF5IiwgMSk7CiAgICBpZiAoIXdoaXRlUG9pbnQpIHsKICAgICAgdGhyb3cgbmV3IF91dGlsLkZvcm1hdEVycm9yKCJXaGl0ZVBvaW50IG1pc3NpbmcgLSByZXF1aXJlZCBmb3IgY29sb3Igc3BhY2UgQ2FsR3JheSIpOwogICAgfQogICAgW3RoaXMuWFcsIHRoaXMuWVcsIHRoaXMuWlddID0gd2hpdGVQb2ludDsKICAgIFt0aGlzLlhCLCB0aGlzLllCLCB0aGlzLlpCXSA9IGJsYWNrUG9pbnQgfHwgWzAsIDAsIDBdOwogICAgdGhpcy5HID0gZ2FtbWEgfHwgMTsKICAgIGlmICh0aGlzLlhXIDwgMCB8fCB0aGlzLlpXIDwgMCB8fCB0aGlzLllXICE9PSAxKSB7CiAgICAgIHRocm93IG5ldyBfdXRpbC5Gb3JtYXRFcnJvcihgSW52YWxpZCBXaGl0ZVBvaW50IGNvbXBvbmVudHMgZm9yICR7dGhpcy5uYW1lfSwgbm8gZmFsbGJhY2sgYXZhaWxhYmxlYCk7CiAgICB9CiAgICBpZiAodGhpcy5YQiA8IDAgfHwgdGhpcy5ZQiA8IDAgfHwgdGhpcy5aQiA8IDApIHsKICAgICAgKDAsIF91dGlsLmluZm8pKGBJbnZhbGlkIEJsYWNrUG9pbnQgZm9yICR7dGhpcy5uYW1lfSwgZmFsbGluZyBiYWNrIHRvIGRlZmF1bHQuYCk7CiAgICAgIHRoaXMuWEIgPSB0aGlzLllCID0gdGhpcy5aQiA9IDA7CiAgICB9CiAgICBpZiAodGhpcy5YQiAhPT0gMCB8fCB0aGlzLllCICE9PSAwIHx8IHRoaXMuWkIgIT09IDApIHsKICAgICAgKDAsIF91dGlsLndhcm4pKGAke3RoaXMubmFtZX0sIEJsYWNrUG9pbnQ6IFhCOiAke3RoaXMuWEJ9LCBZQjogJHt0aGlzLllCfSwgYCArIGBaQjogJHt0aGlzLlpCfSwgb25seSBkZWZhdWx0IHZhbHVlcyBhcmUgc3VwcG9ydGVkLmApOwogICAgfQogICAgaWYgKHRoaXMuRyA8IDEpIHsKICAgICAgKDAsIF91dGlsLmluZm8pKGBJbnZhbGlkIEdhbW1hOiAke3RoaXMuR30gZm9yICR7dGhpcy5uYW1lfSwgZmFsbGluZyBiYWNrIHRvIGRlZmF1bHQuYCk7CiAgICAgIHRoaXMuRyA9IDE7CiAgICB9CiAgfQogICN0b1JnYihzcmMsIHNyY09mZnNldCwgZGVzdCwgZGVzdE9mZnNldCwgc2NhbGUpIHsKICAgIGNvbnN0IEEgPSBzcmNbc3JjT2Zmc2V0XSAqIHNjYWxlOwogICAgY29uc3QgQUcgPSBBICoqIHRoaXMuRzsKICAgIGNvbnN0IEwgPSB0aGlzLllXICogQUc7CiAgICBjb25zdCB2YWwgPSBNYXRoLm1heCgyOTUuOCAqIEwgKiogMC4zMzMzMzMzMzMzMzMzMzMzIC0gNDAuOCwgMCk7CiAgICBkZXN0W2Rlc3RPZmZzZXRdID0gdmFsOwogICAgZGVzdFtkZXN0T2Zmc2V0ICsgMV0gPSB2YWw7CiAgICBkZXN0W2Rlc3RPZmZzZXQgKyAyXSA9IHZhbDsKICB9CiAgZ2V0UmdiSXRlbShzcmMsIHNyY09mZnNldCwgZGVzdCwgZGVzdE9mZnNldCkgewogICAgdGhpcy4jdG9SZ2Ioc3JjLCBzcmNPZmZzZXQsIGRlc3QsIGRlc3RPZmZzZXQsIDEpOwogIH0KICBnZXRSZ2JCdWZmZXIoc3JjLCBzcmNPZmZzZXQsIGNvdW50LCBkZXN0LCBkZXN0T2Zmc2V0LCBiaXRzLCBhbHBoYTAxKSB7CiAgICBjb25zdCBzY2FsZSA9IDEgLyAoKDEgPDwgYml0cykgLSAxKTsKICAgIGZvciAobGV0IGkgPSAwOyBpIDwgY291bnQ7ICsraSkgewogICAgICB0aGlzLiN0b1JnYihzcmMsIHNyY09mZnNldCwgZGVzdCwgZGVzdE9mZnNldCwgc2NhbGUpOwogICAgICBzcmNPZmZzZXQgKz0gMTsKICAgICAgZGVzdE9mZnNldCArPSAzICsgYWxwaGEwMTsKICAgIH0KICB9CiAgZ2V0T3V0cHV0TGVuZ3RoKGlucHV0TGVuZ3RoLCBhbHBoYTAxKSB7CiAgICByZXR1cm4gaW5wdXRMZW5ndGggKiAoMyArIGFscGhhMDEpOwogIH0KfQpjbGFzcyBDYWxSR0JDUyBleHRlbmRzIENvbG9yU3BhY2UgewogIHN0YXRpYyAjQlJBREZPUkRfU0NBTEVfTUFUUklYID0gbmV3IEZsb2F0MzJBcnJheShbMC44OTUxLCAwLjI2NjQsIC0wLjE2MTQsIC0wLjc1MDIsIDEuNzEzNSwgMC4wMzY3LCAwLjAzODksIC0wLjA2ODUsIDEuMDI5Nl0pOwogIHN0YXRpYyAjQlJBREZPUkRfU0NBTEVfSU5WRVJTRV9NQVRSSVggPSBuZXcgRmxvYXQzMkFycmF5KFswLjk4Njk5MjksIC0wLjE0NzA1NDMsIDAuMTU5OTYyNywgMC40MzIzMDUzLCAwLjUxODM2MDMsIDAuMDQ5MjkxMiwgLTAuMDA4NTI4NywgMC4wNDAwNDI4LCAwLjk2ODQ4NjddKTsKICBzdGF0aWMgI1NSR0JfRDY1X1hZWl9UT19SR0JfTUFUUklYID0gbmV3IEZsb2F0MzJBcnJheShbMy4yNDA0NTQyLCAtMS41MzcxMzg1LCAtMC40OTg1MzE0LCAtMC45NjkyNjYwLCAxLjg3NjAxMDgsIDAuMDQxNTU2MCwgMC4wNTU2NDM0LCAtMC4yMDQwMjU5LCAxLjA1NzIyNTJdKTsKICBzdGF0aWMgI0ZMQVRfV0hJVEVQT0lOVF9NQVRSSVggPSBuZXcgRmxvYXQzMkFycmF5KFsxLCAxLCAxXSk7CiAgc3RhdGljICN0ZW1wTm9ybWFsaXplTWF0cml4ID0gbmV3IEZsb2F0MzJBcnJheSgzKTsKICBzdGF0aWMgI3RlbXBDb252ZXJ0TWF0cml4MSA9IG5ldyBGbG9hdDMyQXJyYXkoMyk7CiAgc3RhdGljICN0ZW1wQ29udmVydE1hdHJpeDIgPSBuZXcgRmxvYXQzMkFycmF5KDMpOwogIHN0YXRpYyAjREVDT0RFX0xfQ09OU1RBTlQgPSAoKDggKyAxNikgLyAxMTYpICoqIDMgLyA4LjA7CiAgY29uc3RydWN0b3Iod2hpdGVQb2ludCwgYmxhY2tQb2ludCwgZ2FtbWEsIG1hdHJpeCkgewogICAgc3VwZXIoIkNhbFJHQiIsIDMpOwogICAgaWYgKCF3aGl0ZVBvaW50KSB7CiAgICAgIHRocm93IG5ldyBfdXRpbC5Gb3JtYXRFcnJvcigiV2hpdGVQb2ludCBtaXNzaW5nIC0gcmVxdWlyZWQgZm9yIGNvbG9yIHNwYWNlIENhbFJHQiIpOwogICAgfQogICAgY29uc3QgW1hXLCBZVywgWlddID0gdGhpcy53aGl0ZVBvaW50ID0gd2hpdGVQb2ludDsKICAgIGNvbnN0IFtYQiwgWUIsIFpCXSA9IHRoaXMuYmxhY2tQb2ludCA9IGJsYWNrUG9pbnQgfHwgbmV3IEZsb2F0MzJBcnJheSgzKTsKICAgIFt0aGlzLkdSLCB0aGlzLkdHLCB0aGlzLkdCXSA9IGdhbW1hIHx8IG5ldyBGbG9hdDMyQXJyYXkoWzEsIDEsIDFdKTsKICAgIFt0aGlzLk1YQSwgdGhpcy5NWUEsIHRoaXMuTVpBLCB0aGlzLk1YQiwgdGhpcy5NWUIsIHRoaXMuTVpCLCB0aGlzLk1YQywgdGhpcy5NWUMsIHRoaXMuTVpDXSA9IG1hdHJpeCB8fCBuZXcgRmxvYXQzMkFycmF5KFsxLCAwLCAwLCAwLCAxLCAwLCAwLCAwLCAxXSk7CiAgICBpZiAoWFcgPCAwIHx8IFpXIDwgMCB8fCBZVyAhPT0gMSkgewogICAgICB0aHJvdyBuZXcgX3V0aWwuRm9ybWF0RXJyb3IoYEludmFsaWQgV2hpdGVQb2ludCBjb21wb25lbnRzIGZvciAke3RoaXMubmFtZX0sIG5vIGZhbGxiYWNrIGF2YWlsYWJsZWApOwogICAgfQogICAgaWYgKFhCIDwgMCB8fCBZQiA8IDAgfHwgWkIgPCAwKSB7CiAgICAgICgwLCBfdXRpbC5pbmZvKShgSW52YWxpZCBCbGFja1BvaW50IGZvciAke3RoaXMubmFtZX0gWyR7WEJ9LCAke1lCfSwgJHtaQn1dLCBgICsgImZhbGxpbmcgYmFjayB0byBkZWZhdWx0LiIpOwogICAgICB0aGlzLmJsYWNrUG9pbnQgPSBuZXcgRmxvYXQzMkFycmF5KDMpOwogICAgfQogICAgaWYgKHRoaXMuR1IgPCAwIHx8IHRoaXMuR0cgPCAwIHx8IHRoaXMuR0IgPCAwKSB7CiAgICAgICgwLCBfdXRpbC5pbmZvKShgSW52YWxpZCBHYW1tYSBbJHt0aGlzLkdSfSwgJHt0aGlzLkdHfSwgJHt0aGlzLkdCfV0gZm9yIGAgKyBgJHt0aGlzLm5hbWV9LCBmYWxsaW5nIGJhY2sgdG8gZGVmYXVsdC5gKTsKICAgICAgdGhpcy5HUiA9IHRoaXMuR0cgPSB0aGlzLkdCID0gMTsKICAgIH0KICB9CiAgI21hdHJpeFByb2R1Y3QoYSwgYiwgcmVzdWx0KSB7CiAgICByZXN1bHRbMF0gPSBhWzBdICogYlswXSArIGFbMV0gKiBiWzFdICsgYVsyXSAqIGJbMl07CiAgICByZXN1bHRbMV0gPSBhWzNdICogYlswXSArIGFbNF0gKiBiWzFdICsgYVs1XSAqIGJbMl07CiAgICByZXN1bHRbMl0gPSBhWzZdICogYlswXSArIGFbN10gKiBiWzFdICsgYVs4XSAqIGJbMl07CiAgfQogICN0b0ZsYXQoc291cmNlV2hpdGVQb2ludCwgTE1TLCByZXN1bHQpIHsKICAgIHJlc3VsdFswXSA9IExNU1swXSAqIDEgLyBzb3VyY2VXaGl0ZVBvaW50WzBdOwogICAgcmVzdWx0WzFdID0gTE1TWzFdICogMSAvIHNvdXJjZVdoaXRlUG9pbnRbMV07CiAgICByZXN1bHRbMl0gPSBMTVNbMl0gKiAxIC8gc291cmNlV2hpdGVQb2ludFsyXTsKICB9CiAgI3RvRDY1KHNvdXJjZVdoaXRlUG9pbnQsIExNUywgcmVzdWx0KSB7CiAgICBjb25zdCBENjVYID0gMC45NTA0NzsKICAgIGNvbnN0IEQ2NVkgPSAxOwogICAgY29uc3QgRDY1WiA9IDEuMDg4ODM7CiAgICByZXN1bHRbMF0gPSBMTVNbMF0gKiBENjVYIC8gc291cmNlV2hpdGVQb2ludFswXTsKICAgIHJlc3VsdFsxXSA9IExNU1sxXSAqIEQ2NVkgLyBzb3VyY2VXaGl0ZVBvaW50WzFdOwogICAgcmVzdWx0WzJdID0gTE1TWzJdICogRDY1WiAvIHNvdXJjZVdoaXRlUG9pbnRbMl07CiAgfQogICNzUkdCVHJhbnNmZXJGdW5jdGlvbihjb2xvcikgewogICAgaWYgKGNvbG9yIDw9IDAuMDAzMTMwOCkgewogICAgICByZXR1cm4gdGhpcy4jYWRqdXN0VG9SYW5nZSgwLCAxLCAxMi45MiAqIGNvbG9yKTsKICAgIH0KICAgIGlmIChjb2xvciA+PSAwLjk5NTU0NTI1KSB7CiAgICAgIHJldHVybiAxOwogICAgfQogICAgcmV0dXJuIHRoaXMuI2FkanVzdFRvUmFuZ2UoMCwgMSwgKDEgKyAwLjA1NSkgKiBjb2xvciAqKiAoMSAvIDIuNCkgLSAwLjA1NSk7CiAgfQogICNhZGp1c3RUb1JhbmdlKG1pbiwgbWF4LCB2YWx1ZSkgewogICAgcmV0dXJuIE1hdGgubWF4KG1pbiwgTWF0aC5taW4obWF4LCB2YWx1ZSkpOwogIH0KICAjZGVjb2RlTChMKSB7CiAgICBpZiAoTCA8IDApIHsKICAgICAgcmV0dXJuIC10aGlzLiNkZWNvZGVMKC1MKTsKICAgIH0KICAgIGlmIChMID4gOC4wKSB7CiAgICAgIHJldHVybiAoKEwgKyAxNikgLyAxMTYpICoqIDM7CiAgICB9CiAgICByZXR1cm4gTCAqIENhbFJHQkNTLiNERUNPREVfTF9DT05TVEFOVDsKICB9CiAgI2NvbXBlbnNhdGVCbGFja1BvaW50KHNvdXJjZUJsYWNrUG9pbnQsIFhZWl9GbGF0LCByZXN1bHQpIHsKICAgIGlmIChzb3VyY2VCbGFja1BvaW50WzBdID09PSAwICYmIHNvdXJjZUJsYWNrUG9pbnRbMV0gPT09IDAgJiYgc291cmNlQmxhY2tQb2ludFsyXSA9PT0gMCkgewogICAgICByZXN1bHRbMF0gPSBYWVpfRmxhdFswXTsKICAgICAgcmVzdWx0WzFdID0gWFlaX0ZsYXRbMV07CiAgICAgIHJlc3VsdFsyXSA9IFhZWl9GbGF0WzJdOwogICAgICByZXR1cm47CiAgICB9CiAgICBjb25zdCB6ZXJvRGVjb2RlTCA9IHRoaXMuI2RlY29kZUwoMCk7CiAgICBjb25zdCBYX0RTVCA9IHplcm9EZWNvZGVMOwogICAgY29uc3QgWF9TUkMgPSB0aGlzLiNkZWNvZGVMKHNvdXJjZUJsYWNrUG9pbnRbMF0pOwogICAgY29uc3QgWV9EU1QgPSB6ZXJvRGVjb2RlTDsKICAgIGNvbnN0IFlfU1JDID0gdGhpcy4jZGVjb2RlTChzb3VyY2VCbGFja1BvaW50WzFdKTsKICAgIGNvbnN0IFpfRFNUID0gemVyb0RlY29kZUw7CiAgICBjb25zdCBaX1NSQyA9IHRoaXMuI2RlY29kZUwoc291cmNlQmxhY2tQb2ludFsyXSk7CiAgICBjb25zdCBYX1NjYWxlID0gKDEgLSBYX0RTVCkgLyAoMSAtIFhfU1JDKTsKICAgIGNvbnN0IFhfT2Zmc2V0ID0gMSAtIFhfU2NhbGU7CiAgICBjb25zdCBZX1NjYWxlID0gKDEgLSBZX0RTVCkgLyAoMSAtIFlfU1JDKTsKICAgIGNvbnN0IFlfT2Zmc2V0ID0gMSAtIFlfU2NhbGU7CiAgICBjb25zdCBaX1NjYWxlID0gKDEgLSBaX0RTVCkgLyAoMSAtIFpfU1JDKTsKICAgIGNvbnN0IFpfT2Zmc2V0ID0gMSAtIFpfU2NhbGU7CiAgICByZXN1bHRbMF0gPSBYWVpfRmxhdFswXSAqIFhfU2NhbGUgKyBYX09mZnNldDsKICAgIHJlc3VsdFsxXSA9IFhZWl9GbGF0WzFdICogWV9TY2FsZSArIFlfT2Zmc2V0OwogICAgcmVzdWx0WzJdID0gWFlaX0ZsYXRbMl0gKiBaX1NjYWxlICsgWl9PZmZzZXQ7CiAgfQogICNub3JtYWxpemVXaGl0ZVBvaW50VG9GbGF0KHNvdXJjZVdoaXRlUG9pbnQsIFhZWl9JbiwgcmVzdWx0KSB7CiAgICBpZiAoc291cmNlV2hpdGVQb2ludFswXSA9PT0gMSAmJiBzb3VyY2VXaGl0ZVBvaW50WzJdID09PSAxKSB7CiAgICAgIHJlc3VsdFswXSA9IFhZWl9JblswXTsKICAgICAgcmVzdWx0WzFdID0gWFlaX0luWzFdOwogICAgICByZXN1bHRbMl0gPSBYWVpfSW5bMl07CiAgICAgIHJldHVybjsKICAgIH0KICAgIGNvbnN0IExNUyA9IHJlc3VsdDsKICAgIHRoaXMuI21hdHJpeFByb2R1Y3QoQ2FsUkdCQ1MuI0JSQURGT1JEX1NDQUxFX01BVFJJWCwgWFlaX0luLCBMTVMpOwogICAgY29uc3QgTE1TX0ZsYXQgPSBDYWxSR0JDUy4jdGVtcE5vcm1hbGl6ZU1hdHJpeDsKICAgIHRoaXMuI3RvRmxhdChzb3VyY2VXaGl0ZVBvaW50LCBMTVMsIExNU19GbGF0KTsKICAgIHRoaXMuI21hdHJpeFByb2R1Y3QoQ2FsUkdCQ1MuI0JSQURGT1JEX1NDQUxFX0lOVkVSU0VfTUFUUklYLCBMTVNfRmxhdCwgcmVzdWx0KTsKICB9CiAgI25vcm1hbGl6ZVdoaXRlUG9pbnRUb0Q2NShzb3VyY2VXaGl0ZVBvaW50LCBYWVpfSW4sIHJlc3VsdCkgewogICAgY29uc3QgTE1TID0gcmVzdWx0OwogICAgdGhpcy4jbWF0cml4UHJvZHVjdChDYWxSR0JDUy4jQlJBREZPUkRfU0NBTEVfTUFUUklYLCBYWVpfSW4sIExNUyk7CiAgICBjb25zdCBMTVNfRDY1ID0gQ2FsUkdCQ1MuI3RlbXBOb3JtYWxpemVNYXRyaXg7CiAgICB0aGlzLiN0b0Q2NShzb3VyY2VXaGl0ZVBvaW50LCBMTVMsIExNU19ENjUpOwogICAgdGhpcy4jbWF0cml4UHJvZHVjdChDYWxSR0JDUy4jQlJBREZPUkRfU0NBTEVfSU5WRVJTRV9NQVRSSVgsIExNU19ENjUsIHJlc3VsdCk7CiAgfQogICN0b1JnYihzcmMsIHNyY09mZnNldCwgZGVzdCwgZGVzdE9mZnNldCwgc2NhbGUpIHsKICAgIGNvbnN0IEEgPSB0aGlzLiNhZGp1c3RUb1JhbmdlKDAsIDEsIHNyY1tzcmNPZmZzZXRdICogc2NhbGUpOwogICAgY29uc3QgQiA9IHRoaXMuI2FkanVzdFRvUmFuZ2UoMCwgMSwgc3JjW3NyY09mZnNldCArIDFdICogc2NhbGUpOwogICAgY29uc3QgQyA9IHRoaXMuI2FkanVzdFRvUmFuZ2UoMCwgMSwgc3JjW3NyY09mZnNldCArIDJdICogc2NhbGUpOwogICAgY29uc3QgQUdSID0gQSA9PT0gMSA/IDEgOiBBICoqIHRoaXMuR1I7CiAgICBjb25zdCBCR0cgPSBCID09PSAxID8gMSA6IEIgKiogdGhpcy5HRzsKICAgIGNvbnN0IENHQiA9IEMgPT09IDEgPyAxIDogQyAqKiB0aGlzLkdCOwogICAgY29uc3QgWCA9IHRoaXMuTVhBICogQUdSICsgdGhpcy5NWEIgKiBCR0cgKyB0aGlzLk1YQyAqIENHQjsKICAgIGNvbnN0IFkgPSB0aGlzLk1ZQSAqIEFHUiArIHRoaXMuTVlCICogQkdHICsgdGhpcy5NWUMgKiBDR0I7CiAgICBjb25zdCBaID0gdGhpcy5NWkEgKiBBR1IgKyB0aGlzLk1aQiAqIEJHRyArIHRoaXMuTVpDICogQ0dCOwogICAgY29uc3QgWFlaID0gQ2FsUkdCQ1MuI3RlbXBDb252ZXJ0TWF0cml4MTsKICAgIFhZWlswXSA9IFg7CiAgICBYWVpbMV0gPSBZOwogICAgWFlaWzJdID0gWjsKICAgIGNvbnN0IFhZWl9GbGF0ID0gQ2FsUkdCQ1MuI3RlbXBDb252ZXJ0TWF0cml4MjsKICAgIHRoaXMuI25vcm1hbGl6ZVdoaXRlUG9pbnRUb0ZsYXQodGhpcy53aGl0ZVBvaW50LCBYWVosIFhZWl9GbGF0KTsKICAgIGNvbnN0IFhZWl9CbGFjayA9IENhbFJHQkNTLiN0ZW1wQ29udmVydE1hdHJpeDE7CiAgICB0aGlzLiNjb21wZW5zYXRlQmxhY2tQb2ludCh0aGlzLmJsYWNrUG9pbnQsIFhZWl9GbGF0LCBYWVpfQmxhY2spOwogICAgY29uc3QgWFlaX0Q2NSA9IENhbFJHQkNTLiN0ZW1wQ29udmVydE1hdHJpeDI7CiAgICB0aGlzLiNub3JtYWxpemVXaGl0ZVBvaW50VG9ENjUoQ2FsUkdCQ1MuI0ZMQVRfV0hJVEVQT0lOVF9NQVRSSVgsIFhZWl9CbGFjaywgWFlaX0Q2NSk7CiAgICBjb25zdCBTUkdCID0gQ2FsUkdCQ1MuI3RlbXBDb252ZXJ0TWF0cml4MTsKICAgIHRoaXMuI21hdHJpeFByb2R1Y3QoQ2FsUkdCQ1MuI1NSR0JfRDY1X1hZWl9UT19SR0JfTUFUUklYLCBYWVpfRDY1LCBTUkdCKTsKICAgIGRlc3RbZGVzdE9mZnNldF0gPSB0aGlzLiNzUkdCVHJhbnNmZXJGdW5jdGlvbihTUkdCWzBdKSAqIDI1NTsKICAgIGRlc3RbZGVzdE9mZnNldCArIDFdID0gdGhpcy4jc1JHQlRyYW5zZmVyRnVuY3Rpb24oU1JHQlsxXSkgKiAyNTU7CiAgICBkZXN0W2Rlc3RPZmZzZXQgKyAyXSA9IHRoaXMuI3NSR0JUcmFuc2ZlckZ1bmN0aW9uKFNSR0JbMl0pICogMjU1OwogIH0KICBnZXRSZ2JJdGVtKHNyYywgc3JjT2Zmc2V0LCBkZXN0LCBkZXN0T2Zmc2V0KSB7CiAgICB0aGlzLiN0b1JnYihzcmMsIHNyY09mZnNldCwgZGVzdCwgZGVzdE9mZnNldCwgMSk7CiAgfQogIGdldFJnYkJ1ZmZlcihzcmMsIHNyY09mZnNldCwgY291bnQsIGRlc3QsIGRlc3RPZmZzZXQsIGJpdHMsIGFscGhhMDEpIHsKICAgIGNvbnN0IHNjYWxlID0gMSAvICgoMSA8PCBiaXRzKSAtIDEpOwogICAgZm9yIChsZXQgaSA9IDA7IGkgPCBjb3VudDsgKytpKSB7CiAgICAgIHRoaXMuI3RvUmdiKHNyYywgc3JjT2Zmc2V0LCBkZXN0LCBkZXN0T2Zmc2V0LCBzY2FsZSk7CiAgICAgIHNyY09mZnNldCArPSAzOwogICAgICBkZXN0T2Zmc2V0ICs9IDMgKyBhbHBoYTAxOwogICAgfQogIH0KICBnZXRPdXRwdXRMZW5ndGgoaW5wdXRMZW5ndGgsIGFscGhhMDEpIHsKICAgIHJldHVybiBpbnB1dExlbmd0aCAqICgzICsgYWxwaGEwMSkgLyAzIHwgMDsKICB9Cn0KY2xhc3MgTGFiQ1MgZXh0ZW5kcyBDb2xvclNwYWNlIHsKICBjb25zdHJ1Y3Rvcih3aGl0ZVBvaW50LCBibGFja1BvaW50LCByYW5nZSkgewogICAgc3VwZXIoIkxhYiIsIDMpOwogICAgaWYgKCF3aGl0ZVBvaW50KSB7CiAgICAgIHRocm93IG5ldyBfdXRpbC5Gb3JtYXRFcnJvcigiV2hpdGVQb2ludCBtaXNzaW5nIC0gcmVxdWlyZWQgZm9yIGNvbG9yIHNwYWNlIExhYiIpOwogICAgfQogICAgW3RoaXMuWFcsIHRoaXMuWVcsIHRoaXMuWlddID0gd2hpdGVQb2ludDsKICAgIFt0aGlzLmFtaW4sIHRoaXMuYW1heCwgdGhpcy5ibWluLCB0aGlzLmJtYXhdID0gcmFuZ2UgfHwgWy0xMDAsIDEwMCwgLTEwMCwgMTAwXTsKICAgIFt0aGlzLlhCLCB0aGlzLllCLCB0aGlzLlpCXSA9IGJsYWNrUG9pbnQgfHwgWzAsIDAsIDBdOwogICAgaWYgKHRoaXMuWFcgPCAwIHx8IHRoaXMuWlcgPCAwIHx8IHRoaXMuWVcgIT09IDEpIHsKICAgICAgdGhyb3cgbmV3IF91dGlsLkZvcm1hdEVycm9yKCJJbnZhbGlkIFdoaXRlUG9pbnQgY29tcG9uZW50cywgbm8gZmFsbGJhY2sgYXZhaWxhYmxlIik7CiAgICB9CiAgICBpZiAodGhpcy5YQiA8IDAgfHwgdGhpcy5ZQiA8IDAgfHwgdGhpcy5aQiA8IDApIHsKICAgICAgKDAsIF91dGlsLmluZm8pKCJJbnZhbGlkIEJsYWNrUG9pbnQsIGZhbGxpbmcgYmFjayB0byBkZWZhdWx0Iik7CiAgICAgIHRoaXMuWEIgPSB0aGlzLllCID0gdGhpcy5aQiA9IDA7CiAgICB9CiAgICBpZiAodGhpcy5hbWluID4gdGhpcy5hbWF4IHx8IHRoaXMuYm1pbiA+IHRoaXMuYm1heCkgewogICAgICAoMCwgX3V0aWwuaW5mbykoIkludmFsaWQgUmFuZ2UsIGZhbGxpbmcgYmFjayB0byBkZWZhdWx0cyIpOwogICAgICB0aGlzLmFtaW4gPSAtMTAwOwogICAgICB0aGlzLmFtYXggPSAxMDA7CiAgICAgIHRoaXMuYm1pbiA9IC0xMDA7CiAgICAgIHRoaXMuYm1heCA9IDEwMDsKICAgIH0KICB9CiAgI2ZuX2coeCkgewogICAgcmV0dXJuIHggPj0gNiAvIDI5ID8geCAqKiAzIDogMTA4IC8gODQxICogKHggLSA0IC8gMjkpOwogIH0KICAjZGVjb2RlKHZhbHVlLCBoaWdoMSwgbG93MiwgaGlnaDIpIHsKICAgIHJldHVybiBsb3cyICsgdmFsdWUgKiAoaGlnaDIgLSBsb3cyKSAvIGhpZ2gxOwogIH0KICAjdG9SZ2Ioc3JjLCBzcmNPZmZzZXQsIG1heFZhbCwgZGVzdCwgZGVzdE9mZnNldCkgewogICAgbGV0IExzID0gc3JjW3NyY09mZnNldF07CiAgICBsZXQgYXMgPSBzcmNbc3JjT2Zmc2V0ICsgMV07CiAgICBsZXQgYnMgPSBzcmNbc3JjT2Zmc2V0ICsgMl07CiAgICBpZiAobWF4VmFsICE9PSBmYWxzZSkgewogICAgICBMcyA9IHRoaXMuI2RlY29kZShMcywgbWF4VmFsLCAwLCAxMDApOwogICAgICBhcyA9IHRoaXMuI2RlY29kZShhcywgbWF4VmFsLCB0aGlzLmFtaW4sIHRoaXMuYW1heCk7CiAgICAgIGJzID0gdGhpcy4jZGVjb2RlKGJzLCBtYXhWYWwsIHRoaXMuYm1pbiwgdGhpcy5ibWF4KTsKICAgIH0KICAgIGlmIChhcyA+IHRoaXMuYW1heCkgewogICAgICBhcyA9IHRoaXMuYW1heDsKICAgIH0gZWxzZSBpZiAoYXMgPCB0aGlzLmFtaW4pIHsKICAgICAgYXMgPSB0aGlzLmFtaW47CiAgICB9CiAgICBpZiAoYnMgPiB0aGlzLmJtYXgpIHsKICAgICAgYnMgPSB0aGlzLmJtYXg7CiAgICB9IGVsc2UgaWYgKGJzIDwgdGhpcy5ibWluKSB7CiAgICAgIGJzID0gdGhpcy5ibWluOwogICAgfQogICAgY29uc3QgTSA9IChMcyArIDE2KSAvIDExNjsKICAgIGNvbnN0IEwgPSBNICsgYXMgLyA1MDA7CiAgICBjb25zdCBOID0gTSAtIGJzIC8gMjAwOwogICAgY29uc3QgWCA9IHRoaXMuWFcgKiB0aGlzLiNmbl9nKEwpOwogICAgY29uc3QgWSA9IHRoaXMuWVcgKiB0aGlzLiNmbl9nKE0pOwogICAgY29uc3QgWiA9IHRoaXMuWlcgKiB0aGlzLiNmbl9nKE4pOwogICAgbGV0IHIsIGcsIGI7CiAgICBpZiAodGhpcy5aVyA8IDEpIHsKICAgICAgciA9IFggKiAzLjEzMzkgKyBZICogLTEuNjE3ICsgWiAqIC0wLjQ5MDY7CiAgICAgIGcgPSBYICogLTAuOTc4NSArIFkgKiAxLjkxNiArIFogKiAwLjAzMzM7CiAgICAgIGIgPSBYICogMC4wNzIgKyBZICogLTAuMjI5ICsgWiAqIDEuNDA1NzsKICAgIH0gZWxzZSB7CiAgICAgIHIgPSBYICogMy4yNDA2ICsgWSAqIC0xLjUzNzIgKyBaICogLTAuNDk4NjsKICAgICAgZyA9IFggKiAtMC45Njg5ICsgWSAqIDEuODc1OCArIFogKiAwLjA0MTU7CiAgICAgIGIgPSBYICogMC4wNTU3ICsgWSAqIC0wLjIwNCArIFogKiAxLjA1NzsKICAgIH0KICAgIGRlc3RbZGVzdE9mZnNldF0gPSBNYXRoLnNxcnQocikgKiAyNTU7CiAgICBkZXN0W2Rlc3RPZmZzZXQgKyAxXSA9IE1hdGguc3FydChnKSAqIDI1NTsKICAgIGRlc3RbZGVzdE9mZnNldCArIDJdID0gTWF0aC5zcXJ0KGIpICogMjU1OwogIH0KICBnZXRSZ2JJdGVtKHNyYywgc3JjT2Zmc2V0LCBkZXN0LCBkZXN0T2Zmc2V0KSB7CiAgICB0aGlzLiN0b1JnYihzcmMsIHNyY09mZnNldCwgZmFsc2UsIGRlc3QsIGRlc3RPZmZzZXQpOwogIH0KICBnZXRSZ2JCdWZmZXIoc3JjLCBzcmNPZmZzZXQsIGNvdW50LCBkZXN0LCBkZXN0T2Zmc2V0LCBiaXRzLCBhbHBoYTAxKSB7CiAgICBjb25zdCBtYXhWYWwgPSAoMSA8PCBiaXRzKSAtIDE7CiAgICBmb3IgKGxldCBpID0gMDsgaSA8IGNvdW50OyBpKyspIHsKICAgICAgdGhpcy4jdG9SZ2Ioc3JjLCBzcmNPZmZzZXQsIG1heFZhbCwgZGVzdCwgZGVzdE9mZnNldCk7CiAgICAgIHNyY09mZnNldCArPSAzOwogICAgICBkZXN0T2Zmc2V0ICs9IDMgKyBhbHBoYTAxOwogICAgfQogIH0KICBnZXRPdXRwdXRMZW5ndGgoaW5wdXRMZW5ndGgsIGFscGhhMDEpIHsKICAgIHJldHVybiBpbnB1dExlbmd0aCAqICgzICsgYWxwaGEwMSkgLyAzIHwgMDsKICB9CiAgaXNEZWZhdWx0RGVjb2RlKGRlY29kZU1hcCwgYnBjKSB7CiAgICByZXR1cm4gdHJ1ZTsKICB9CiAgZ2V0IHVzZXNaZXJvVG9PbmVSYW5nZSgpIHsKICAgIHJldHVybiAoMCwgX3V0aWwuc2hhZG93KSh0aGlzLCAidXNlc1plcm9Ub09uZVJhbmdlIiwgZmFsc2UpOwogIH0KfQoKLyoqKi8gfSksCi8qIDEzICovCi8qKiovICgoX191bnVzZWRfd2VicGFja19tb2R1bGUsIGV4cG9ydHMsIF9fd19wZGZqc19yZXF1aXJlX18pID0+IHsKCgoKT2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsICJfX2VzTW9kdWxlIiwgKHsKICB2YWx1ZTogdHJ1ZQp9KSk7CmV4cG9ydHMuUGFydGlhbEV2YWx1YXRvciA9IGV4cG9ydHMuRXZhbHVhdG9yUHJlcHJvY2Vzc29yID0gdm9pZCAwOwp2YXIgX3V0aWwgPSBfX3dfcGRmanNfcmVxdWlyZV9fKDIpOwp2YXIgX2NtYXAgPSBfX3dfcGRmanNfcmVxdWlyZV9fKDE0KTsKdmFyIF9wcmltaXRpdmVzID0gX193X3BkZmpzX3JlcXVpcmVfXyg0KTsKdmFyIF9mb250cyA9IF9fd19wZGZqc19yZXF1aXJlX18oMzQpOwp2YXIgX2VuY29kaW5ncyA9IF9fd19wZGZqc19yZXF1aXJlX18oMzcpOwp2YXIgX3N0YW5kYXJkX2ZvbnRzID0gX193X3BkZmpzX3JlcXVpcmVfXyg0MSk7CnZhciBfcGF0dGVybiA9IF9fd19wZGZqc19yZXF1aXJlX18oNTApOwp2YXIgX3hmYV9mb250cyA9IF9fd19wZGZqc19yZXF1aXJlX18oNTEpOwp2YXIgX3RvX3VuaWNvZGVfbWFwID0gX193X3BkZmpzX3JlcXVpcmVfXyg0Mik7CnZhciBfZnVuY3Rpb24gPSBfX3dfcGRmanNfcmVxdWlyZV9fKDU3KTsKdmFyIF9wYXJzZXIgPSBfX3dfcGRmanNfcmVxdWlyZV9fKDE2KTsKdmFyIF9pbWFnZV91dGlscyA9IF9fd19wZGZqc19yZXF1aXJlX18oNTkpOwp2YXIgX3N0cmVhbSA9IF9fd19wZGZqc19yZXF1aXJlX18oOCk7CnZhciBfYmFzZV9zdHJlYW0gPSBfX3dfcGRmanNfcmVxdWlyZV9fKDUpOwp2YXIgX2JpZGkgPSBfX3dfcGRmanNfcmVxdWlyZV9fKDYwKTsKdmFyIF9jb2xvcnNwYWNlID0gX193X3BkZmpzX3JlcXVpcmVfXygxMik7CnZhciBfZGVjb2RlX3N0cmVhbSA9IF9fd19wZGZqc19yZXF1aXJlX18oMTgpOwp2YXIgX2ZvbnRzX3V0aWxzID0gX193X3BkZmpzX3JlcXVpcmVfXygzOCk7CnZhciBfZm9udF9zdWJzdGl0dXRpb25zID0gX193X3BkZmpzX3JlcXVpcmVfXyg2MSk7CnZhciBfZ2x5cGhsaXN0ID0gX193X3BkZmpzX3JlcXVpcmVfXygzOSk7CnZhciBfbWV0cmljcyA9IF9fd19wZGZqc19yZXF1aXJlX18oNDUpOwp2YXIgX3VuaWNvZGUgPSBfX3dfcGRmanNfcmVxdWlyZV9fKDQwKTsKdmFyIF9pbWFnZV9yZXNpemVyID0gX193X3BkZmpzX3JlcXVpcmVfXyg2Mik7CnZhciBfbXVybXVyaGFzaCA9IF9fd19wZGZqc19yZXF1aXJlX18oNjMpOwp2YXIgX29wZXJhdG9yX2xpc3QgPSBfX3dfcGRmanNfcmVxdWlyZV9fKDY0KTsKdmFyIF9pbWFnZSA9IF9fd19wZGZqc19yZXF1aXJlX18oNjUpOwpjb25zdCBEZWZhdWx0UGFydGlhbEV2YWx1YXRvck9wdGlvbnMgPSBPYmplY3QuZnJlZXplKHsKICBtYXhJbWFnZVNpemU6IC0xLAogIGRpc2FibGVGb250RmFjZTogZmFsc2UsCiAgaWdub3JlRXJyb3JzOiBmYWxzZSwKICBpc0V2YWxTdXBwb3J0ZWQ6IHRydWUsCiAgaXNPZmZzY3JlZW5DYW52YXNTdXBwb3J0ZWQ6IGZhbHNlLAogIGNhbnZhc01heEFyZWFJbkJ5dGVzOiAtMSwKICBmb250RXh0cmFQcm9wZXJ0aWVzOiBmYWxzZSwKICB1c2VTeXN0ZW1Gb250czogdHJ1ZSwKICBjTWFwVXJsOiBudWxsLAogIHN0YW5kYXJkRm9udERhdGFVcmw6IG51bGwKfSk7CmNvbnN0IFBhdHRlcm5UeXBlID0gewogIFRJTElORzogMSwKICBTSEFESU5HOiAyCn07CmNvbnN0IFRFWFRfQ0hVTktfQkFUQ0hfU0laRSA9IDEwOwpjb25zdCBkZWZlcnJlZCA9IFByb21pc2UucmVzb2x2ZSgpOwpmdW5jdGlvbiBub3JtYWxpemVCbGVuZE1vZGUodmFsdWUsIHBhcnNpbmdBcnJheSA9IGZhbHNlKSB7CiAgaWYgKEFycmF5LmlzQXJyYXkodmFsdWUpKSB7CiAgICBmb3IgKGNvbnN0IHZhbCBvZiB2YWx1ZSkgewogICAgICBjb25zdCBtYXliZUJNID0gbm9ybWFsaXplQmxlbmRNb2RlKHZhbCwgdHJ1ZSk7CiAgICAgIGlmIChtYXliZUJNKSB7CiAgICAgICAgcmV0dXJuIG1heWJlQk07CiAgICAgIH0KICAgIH0KICAgICgwLCBfdXRpbC53YXJuKShgVW5zdXBwb3J0ZWQgYmxlbmQgbW9kZSBBcnJheTogJHt2YWx1ZX1gKTsKICAgIHJldHVybiAic291cmNlLW92ZXIiOwogIH0KICBpZiAoISh2YWx1ZSBpbnN0YW5jZW9mIF9wcmltaXRpdmVzLk5hbWUpKSB7CiAgICBpZiAocGFyc2luZ0FycmF5KSB7CiAgICAgIHJldHVybiBudWxsOwogICAgfQogICAgcmV0dXJuICJzb3VyY2Utb3ZlciI7CiAgfQogIHN3aXRjaCAodmFsdWUubmFtZSkgewogICAgY2FzZSAiTm9ybWFsIjoKICAgIGNhc2UgIkNvbXBhdGlibGUiOgogICAgICByZXR1cm4gInNvdXJjZS1vdmVyIjsKICAgIGNhc2UgIk11bHRpcGx5IjoKICAgICAgcmV0dXJuICJtdWx0aXBseSI7CiAgICBjYXNlICJTY3JlZW4iOgogICAgICByZXR1cm4gInNjcmVlbiI7CiAgICBjYXNlICJPdmVybGF5IjoKICAgICAgcmV0dXJuICJvdmVybGF5IjsKICAgIGNhc2UgIkRhcmtlbiI6CiAgICAgIHJldHVybiAiZGFya2VuIjsKICAgIGNhc2UgIkxpZ2h0ZW4iOgogICAgICByZXR1cm4gImxpZ2h0ZW4iOwogICAgY2FzZSAiQ29sb3JEb2RnZSI6CiAgICAgIHJldHVybiAiY29sb3ItZG9kZ2UiOwogICAgY2FzZSAiQ29sb3JCdXJuIjoKICAgICAgcmV0dXJuICJjb2xvci1idXJuIjsKICAgIGNhc2UgIkhhcmRMaWdodCI6CiAgICAgIHJldHVybiAiaGFyZC1saWdodCI7CiAgICBjYXNlICJTb2Z0TGlnaHQiOgogICAgICByZXR1cm4gInNvZnQtbGlnaHQiOwogICAgY2FzZSAiRGlmZmVyZW5jZSI6CiAgICAgIHJldHVybiAiZGlmZmVyZW5jZSI7CiAgICBjYXNlICJFeGNsdXNpb24iOgogICAgICByZXR1cm4gImV4Y2x1c2lvbiI7CiAgICBjYXNlICJIdWUiOgogICAgICByZXR1cm4gImh1ZSI7CiAgICBjYXNlICJTYXR1cmF0aW9uIjoKICAgICAgcmV0dXJuICJzYXR1cmF0aW9uIjsKICAgIGNhc2UgIkNvbG9yIjoKICAgICAgcmV0dXJuICJjb2xvciI7CiAgICBjYXNlICJMdW1pbm9zaXR5IjoKICAgICAgcmV0dXJuICJsdW1pbm9zaXR5IjsKICB9CiAgaWYgKHBhcnNpbmdBcnJheSkgewogICAgcmV0dXJuIG51bGw7CiAgfQogICgwLCBfdXRpbC53YXJuKShgVW5zdXBwb3J0ZWQgYmxlbmQgbW9kZTogJHt2YWx1ZS5uYW1lfWApOwogIHJldHVybiAic291cmNlLW92ZXIiOwp9CmZ1bmN0aW9uIGluY3JlbWVudENhY2hlZEltYWdlTWFza0NvdW50KGRhdGEpIHsKICBpZiAoZGF0YS5mbiA9PT0gX3V0aWwuT1BTLnBhaW50SW1hZ2VNYXNrWE9iamVjdCAmJiBkYXRhLmFyZ3NbMF0/LmNvdW50ID4gMCkgewogICAgZGF0YS5hcmdzWzBdLmNvdW50Kys7CiAgfQp9CmNsYXNzIFRpbWVTbG90TWFuYWdlciB7CiAgc3RhdGljIFRJTUVfU0xPVF9EVVJBVElPTl9NUyA9IDIwOwogIHN0YXRpYyBDSEVDS19USU1FX0VWRVJZID0gMTAwOwogIGNvbnN0cnVjdG9yKCkgewogICAgdGhpcy5yZXNldCgpOwogIH0KICBjaGVjaygpIHsKICAgIGlmICgrK3RoaXMuY2hlY2tlZCA8IFRpbWVTbG90TWFuYWdlci5DSEVDS19USU1FX0VWRVJZKSB7CiAgICAgIHJldHVybiBmYWxzZTsKICAgIH0KICAgIHRoaXMuY2hlY2tlZCA9IDA7CiAgICByZXR1cm4gdGhpcy5lbmRUaW1lIDw9IERhdGUubm93KCk7CiAgfQogIHJlc2V0KCkgewogICAgdGhpcy5lbmRUaW1lID0gRGF0ZS5ub3coKSArIFRpbWVTbG90TWFuYWdlci5USU1FX1NMT1RfRFVSQVRJT05fTVM7CiAgICB0aGlzLmNoZWNrZWQgPSAwOwogIH0KfQpjbGFzcyBQYXJ0aWFsRXZhbHVhdG9yIHsKICBjb25zdHJ1Y3Rvcih7CiAgICB4cmVmLAogICAgaGFuZGxlciwKICAgIHBhZ2VJbmRleCwKICAgIGlkRmFjdG9yeSwKICAgIGZvbnRDYWNoZSwKICAgIGJ1aWx0SW5DTWFwQ2FjaGUsCiAgICBzdGFuZGFyZEZvbnREYXRhQ2FjaGUsCiAgICBnbG9iYWxJbWFnZUNhY2hlLAogICAgc3lzdGVtRm9udENhY2hlLAogICAgb3B0aW9ucyA9IG51bGwKICB9KSB7CiAgICB0aGlzLnhyZWYgPSB4cmVmOwogICAgdGhpcy5oYW5kbGVyID0gaGFuZGxlcjsKICAgIHRoaXMucGFnZUluZGV4ID0gcGFnZUluZGV4OwogICAgdGhpcy5pZEZhY3RvcnkgPSBpZEZhY3Rvcnk7CiAgICB0aGlzLmZvbnRDYWNoZSA9IGZvbnRDYWNoZTsKICAgIHRoaXMuYnVpbHRJbkNNYXBDYWNoZSA9IGJ1aWx0SW5DTWFwQ2FjaGU7CiAgICB0aGlzLnN0YW5kYXJkRm9udERhdGFDYWNoZSA9IHN0YW5kYXJkRm9udERhdGFDYWNoZTsKICAgIHRoaXMuZ2xvYmFsSW1hZ2VDYWNoZSA9IGdsb2JhbEltYWdlQ2FjaGU7CiAgICB0aGlzLnN5c3RlbUZvbnRDYWNoZSA9IHN5c3RlbUZvbnRDYWNoZTsKICAgIHRoaXMub3B0aW9ucyA9IG9wdGlvbnMgfHwgRGVmYXVsdFBhcnRpYWxFdmFsdWF0b3JPcHRpb25zOwogICAgdGhpcy5wYXJzaW5nVHlwZTNGb250ID0gZmFsc2U7CiAgICB0aGlzLl9yZWdpb25hbEltYWdlQ2FjaGUgPSBuZXcgX2ltYWdlX3V0aWxzLlJlZ2lvbmFsSW1hZ2VDYWNoZSgpOwogICAgdGhpcy5fZmV0Y2hCdWlsdEluQ01hcEJvdW5kID0gdGhpcy5mZXRjaEJ1aWx0SW5DTWFwLmJpbmQodGhpcyk7CiAgICBfaW1hZ2VfcmVzaXplci5JbWFnZVJlc2l6ZXIuc2V0TWF4QXJlYSh0aGlzLm9wdGlvbnMuY2FudmFzTWF4QXJlYUluQnl0ZXMpOwogIH0KICBnZXQgX3BkZkZ1bmN0aW9uRmFjdG9yeSgpIHsKICAgIGNvbnN0IHBkZkZ1bmN0aW9uRmFjdG9yeSA9IG5ldyBfZnVuY3Rpb24uUERGRnVuY3Rpb25GYWN0b3J5KHsKICAgICAgeHJlZjogdGhpcy54cmVmLAogICAgICBpc0V2YWxTdXBwb3J0ZWQ6IHRoaXMub3B0aW9ucy5pc0V2YWxTdXBwb3J0ZWQKICAgIH0pOwogICAgcmV0dXJuICgwLCBfdXRpbC5zaGFkb3cpKHRoaXMsICJfcGRmRnVuY3Rpb25GYWN0b3J5IiwgcGRmRnVuY3Rpb25GYWN0b3J5KTsKICB9CiAgY2xvbmUobmV3T3B0aW9ucyA9IG51bGwpIHsKICAgIGNvbnN0IG5ld0V2YWx1YXRvciA9IE9iamVjdC5jcmVhdGUodGhpcyk7CiAgICBuZXdFdmFsdWF0b3Iub3B0aW9ucyA9IE9iamVjdC5hc3NpZ24oT2JqZWN0LmNyZWF0ZShudWxsKSwgdGhpcy5vcHRpb25zLCBuZXdPcHRpb25zKTsKICAgIHJldHVybiBuZXdFdmFsdWF0b3I7CiAgfQogIGhhc0JsZW5kTW9kZXMocmVzb3VyY2VzLCBub25CbGVuZE1vZGVzU2V0KSB7CiAgICBpZiAoIShyZXNvdXJjZXMgaW5zdGFuY2VvZiBfcHJpbWl0aXZlcy5EaWN0KSkgewogICAgICByZXR1cm4gZmFsc2U7CiAgICB9CiAgICBpZiAocmVzb3VyY2VzLm9iaklkICYmIG5vbkJsZW5kTW9kZXNTZXQuaGFzKHJlc291cmNlcy5vYmpJZCkpIHsKICAgICAgcmV0dXJuIGZhbHNlOwogICAgfQogICAgY29uc3QgcHJvY2Vzc2VkID0gbmV3IF9wcmltaXRpdmVzLlJlZlNldChub25CbGVuZE1vZGVzU2V0KTsKICAgIGlmIChyZXNvdXJjZXMub2JqSWQpIHsKICAgICAgcHJvY2Vzc2VkLnB1dChyZXNvdXJjZXMub2JqSWQpOwogICAgfQogICAgY29uc3Qgbm9kZXMgPSBbcmVzb3VyY2VzXSwKICAgICAgeHJlZiA9IHRoaXMueHJlZjsKICAgIHdoaWxlIChub2Rlcy5sZW5ndGgpIHsKICAgICAgY29uc3Qgbm9kZSA9IG5vZGVzLnNoaWZ0KCk7CiAgICAgIGNvbnN0IGdyYXBoaWNTdGF0ZXMgPSBub2RlLmdldCgiRXh0R1N0YXRlIik7CiAgICAgIGlmIChncmFwaGljU3RhdGVzIGluc3RhbmNlb2YgX3ByaW1pdGl2ZXMuRGljdCkgewogICAgICAgIGZvciAobGV0IGdyYXBoaWNTdGF0ZSBvZiBncmFwaGljU3RhdGVzLmdldFJhd1ZhbHVlcygpKSB7CiAgICAgICAgICBpZiAoZ3JhcGhpY1N0YXRlIGluc3RhbmNlb2YgX3ByaW1pdGl2ZXMuUmVmKSB7CiAgICAgICAgICAgIGlmIChwcm9jZXNzZWQuaGFzKGdyYXBoaWNTdGF0ZSkpIHsKICAgICAgICAgICAgICBjb250aW51ZTsKICAgICAgICAgICAgfQogICAgICAgICAgICB0cnkgewogICAgICAgICAgICAgIGdyYXBoaWNTdGF0ZSA9IHhyZWYuZmV0Y2goZ3JhcGhpY1N0YXRlKTsKICAgICAgICAgICAgfSBjYXRjaCAoZXgpIHsKICAgICAgICAgICAgICBwcm9jZXNzZWQucHV0KGdyYXBoaWNTdGF0ZSk7CiAgICAgICAgICAgICAgKDAsIF91dGlsLmluZm8pKGBoYXNCbGVuZE1vZGVzIC0gaWdub3JpbmcgRXh0R1N0YXRlOiAiJHtleH0iLmApOwogICAgICAgICAgICAgIGNvbnRpbnVlOwogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgICBpZiAoIShncmFwaGljU3RhdGUgaW5zdGFuY2VvZiBfcHJpbWl0aXZlcy5EaWN0KSkgewogICAgICAgICAgICBjb250aW51ZTsKICAgICAgICAgIH0KICAgICAgICAgIGlmIChncmFwaGljU3RhdGUub2JqSWQpIHsKICAgICAgICAgICAgcHJvY2Vzc2VkLnB1dChncmFwaGljU3RhdGUub2JqSWQpOwogICAgICAgICAgfQogICAgICAgICAgY29uc3QgYm0gPSBncmFwaGljU3RhdGUuZ2V0KCJCTSIpOwogICAgICAgICAgaWYgKGJtIGluc3RhbmNlb2YgX3ByaW1pdGl2ZXMuTmFtZSkgewogICAgICAgICAgICBpZiAoYm0ubmFtZSAhPT0gIk5vcm1hbCIpIHsKICAgICAgICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgICAgICAgfQogICAgICAgICAgICBjb250aW51ZTsKICAgICAgICAgIH0KICAgICAgICAgIGlmIChibSAhPT0gdW5kZWZpbmVkICYmIEFycmF5LmlzQXJyYXkoYm0pKSB7CiAgICAgICAgICAgIGZvciAoY29uc3QgZWxlbWVudCBvZiBibSkgewogICAgICAgICAgICAgIGlmIChlbGVtZW50IGluc3RhbmNlb2YgX3ByaW1pdGl2ZXMuTmFtZSAmJiBlbGVtZW50Lm5hbWUgIT09ICJOb3JtYWwiKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICB9CiAgICAgIH0KICAgICAgY29uc3QgeE9iamVjdHMgPSBub2RlLmdldCgiWE9iamVjdCIpOwogICAgICBpZiAoISh4T2JqZWN0cyBpbnN0YW5jZW9mIF9wcmltaXRpdmVzLkRpY3QpKSB7CiAgICAgICAgY29udGludWU7CiAgICAgIH0KICAgICAgZm9yIChsZXQgeE9iamVjdCBvZiB4T2JqZWN0cy5nZXRSYXdWYWx1ZXMoKSkgewogICAgICAgIGlmICh4T2JqZWN0IGluc3RhbmNlb2YgX3ByaW1pdGl2ZXMuUmVmKSB7CiAgICAgICAgICBpZiAocHJvY2Vzc2VkLmhhcyh4T2JqZWN0KSkgewogICAgICAgICAgICBjb250aW51ZTsKICAgICAgICAgIH0KICAgICAgICAgIHRyeSB7CiAgICAgICAgICAgIHhPYmplY3QgPSB4cmVmLmZldGNoKHhPYmplY3QpOwogICAgICAgICAgfSBjYXRjaCAoZXgpIHsKICAgICAgICAgICAgcHJvY2Vzc2VkLnB1dCh4T2JqZWN0KTsKICAgICAgICAgICAgKDAsIF91dGlsLmluZm8pKGBoYXNCbGVuZE1vZGVzIC0gaWdub3JpbmcgWE9iamVjdDogIiR7ZXh9Ii5gKTsKICAgICAgICAgICAgY29udGludWU7CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIGlmICghKHhPYmplY3QgaW5zdGFuY2VvZiBfYmFzZV9zdHJlYW0uQmFzZVN0cmVhbSkpIHsKICAgICAgICAgIGNvbnRpbnVlOwogICAgICAgIH0KICAgICAgICBpZiAoeE9iamVjdC5kaWN0Lm9iaklkKSB7CiAgICAgICAgICBwcm9jZXNzZWQucHV0KHhPYmplY3QuZGljdC5vYmpJZCk7CiAgICAgICAgfQogICAgICAgIGNvbnN0IHhSZXNvdXJjZXMgPSB4T2JqZWN0LmRpY3QuZ2V0KCJSZXNvdXJjZXMiKTsKICAgICAgICBpZiAoISh4UmVzb3VyY2VzIGluc3RhbmNlb2YgX3ByaW1pdGl2ZXMuRGljdCkpIHsKICAgICAgICAgIGNvbnRpbnVlOwogICAgICAgIH0KICAgICAgICBpZiAoeFJlc291cmNlcy5vYmpJZCAmJiBwcm9jZXNzZWQuaGFzKHhSZXNvdXJjZXMub2JqSWQpKSB7CiAgICAgICAgICBjb250aW51ZTsKICAgICAgICB9CiAgICAgICAgbm9kZXMucHVzaCh4UmVzb3VyY2VzKTsKICAgICAgICBpZiAoeFJlc291cmNlcy5vYmpJZCkgewogICAgICAgICAgcHJvY2Vzc2VkLnB1dCh4UmVzb3VyY2VzLm9iaklkKTsKICAgICAgICB9CiAgICAgIH0KICAgIH0KICAgIGZvciAoY29uc3QgcmVmIG9mIHByb2Nlc3NlZCkgewogICAgICBub25CbGVuZE1vZGVzU2V0LnB1dChyZWYpOwogICAgfQogICAgcmV0dXJuIGZhbHNlOwogIH0KICBhc3luYyBmZXRjaEJ1aWx0SW5DTWFwKG5hbWUpIHsKICAgIGNvbnN0IGNhY2hlZERhdGEgPSB0aGlzLmJ1aWx0SW5DTWFwQ2FjaGUuZ2V0KG5hbWUpOwogICAgaWYgKGNhY2hlZERhdGEpIHsKICAgICAgcmV0dXJuIGNhY2hlZERhdGE7CiAgICB9CiAgICBsZXQgZGF0YTsKICAgIGlmICh0aGlzLm9wdGlvbnMuY01hcFVybCAhPT0gbnVsbCkgewogICAgICBjb25zdCB1cmwgPSBgJHt0aGlzLm9wdGlvbnMuY01hcFVybH0ke25hbWV9LmJjbWFwYDsKICAgICAgY29uc3QgcmVzcG9uc2UgPSBhd2FpdCBmZXRjaCh1cmwpOwogICAgICBpZiAoIXJlc3BvbnNlLm9rKSB7CiAgICAgICAgdGhyb3cgbmV3IEVycm9yKGBmZXRjaEJ1aWx0SW5DTWFwOiBmYWlsZWQgdG8gZmV0Y2ggZmlsZSAiJHt1cmx9IiB3aXRoICIke3Jlc3BvbnNlLnN0YXR1c1RleHR9Ii5gKTsKICAgICAgfQogICAgICBkYXRhID0gewogICAgICAgIGNNYXBEYXRhOiBuZXcgVWludDhBcnJheShhd2FpdCByZXNwb25zZS5hcnJheUJ1ZmZlcigpKSwKICAgICAgICBjb21wcmVzc2lvblR5cGU6IF91dGlsLkNNYXBDb21wcmVzc2lvblR5cGUuQklOQVJZCiAgICAgIH07CiAgICB9IGVsc2UgewogICAgICBkYXRhID0gYXdhaXQgdGhpcy5oYW5kbGVyLnNlbmRXaXRoUHJvbWlzZSgiRmV0Y2hCdWlsdEluQ01hcCIsIHsKICAgICAgICBuYW1lCiAgICAgIH0pOwogICAgfQogICAgaWYgKGRhdGEuY29tcHJlc3Npb25UeXBlICE9PSBfdXRpbC5DTWFwQ29tcHJlc3Npb25UeXBlLk5PTkUpIHsKICAgICAgdGhpcy5idWlsdEluQ01hcENhY2hlLnNldChuYW1lLCBkYXRhKTsKICAgIH0KICAgIHJldHVybiBkYXRhOwogIH0KICBhc3luYyBmZXRjaFN0YW5kYXJkRm9udERhdGEobmFtZSkgewogICAgY29uc3QgY2FjaGVkRGF0YSA9IHRoaXMuc3RhbmRhcmRGb250RGF0YUNhY2hlLmdldChuYW1lKTsKICAgIGlmIChjYWNoZWREYXRhKSB7CiAgICAgIHJldHVybiBuZXcgX3N0cmVhbS5TdHJlYW0oY2FjaGVkRGF0YSk7CiAgICB9CiAgICBpZiAodGhpcy5vcHRpb25zLnVzZVN5c3RlbUZvbnRzICYmIG5hbWUgIT09ICJTeW1ib2wiICYmIG5hbWUgIT09ICJaYXBmRGluZ2JhdHMiKSB7CiAgICAgIHJldHVybiBudWxsOwogICAgfQogICAgY29uc3Qgc3RhbmRhcmRGb250TmFtZVRvRmlsZU5hbWUgPSAoMCwgX3N0YW5kYXJkX2ZvbnRzLmdldEZvbnROYW1lVG9GaWxlTWFwKSgpLAogICAgICBmaWxlbmFtZSA9IHN0YW5kYXJkRm9udE5hbWVUb0ZpbGVOYW1lW25hbWVdOwogICAgbGV0IGRhdGE7CiAgICBpZiAodGhpcy5vcHRpb25zLnN0YW5kYXJkRm9udERhdGFVcmwgIT09IG51bGwpIHsKICAgICAgY29uc3QgdXJsID0gYCR7dGhpcy5vcHRpb25zLnN0YW5kYXJkRm9udERhdGFVcmx9JHtmaWxlbmFtZX1gOwogICAgICBjb25zdCByZXNwb25zZSA9IGF3YWl0IGZldGNoKHVybCk7CiAgICAgIGlmICghcmVzcG9uc2Uub2spIHsKICAgICAgICAoMCwgX3V0aWwud2FybikoYGZldGNoU3RhbmRhcmRGb250RGF0YTogZmFpbGVkIHRvIGZldGNoIGZpbGUgIiR7dXJsfSIgd2l0aCAiJHtyZXNwb25zZS5zdGF0dXNUZXh0fSIuYCk7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgZGF0YSA9IGF3YWl0IHJlc3BvbnNlLmFycmF5QnVmZmVyKCk7CiAgICAgIH0KICAgIH0gZWxzZSB7CiAgICAgIHRyeSB7CiAgICAgICAgZGF0YSA9IGF3YWl0IHRoaXMuaGFuZGxlci5zZW5kV2l0aFByb21pc2UoIkZldGNoU3RhbmRhcmRGb250RGF0YSIsIHsKICAgICAgICAgIGZpbGVuYW1lCiAgICAgICAgfSk7CiAgICAgIH0gY2F0Y2ggKGUpIHsKICAgICAgICAoMCwgX3V0aWwud2FybikoYGZldGNoU3RhbmRhcmRGb250RGF0YTogZmFpbGVkIHRvIGZldGNoIGZpbGUgIiR7ZmlsZW5hbWV9IiB3aXRoICIke2V9Ii5gKTsKICAgICAgfQogICAgfQogICAgaWYgKCFkYXRhKSB7CiAgICAgIHJldHVybiBudWxsOwogICAgfQogICAgdGhpcy5zdGFuZGFyZEZvbnREYXRhQ2FjaGUuc2V0KG5hbWUsIGRhdGEpOwogICAgcmV0dXJuIG5ldyBfc3RyZWFtLlN0cmVhbShkYXRhKTsKICB9CiAgYXN5bmMgYnVpbGRGb3JtWE9iamVjdChyZXNvdXJjZXMsIHhvYmosIHNtYXNrLCBvcGVyYXRvckxpc3QsIHRhc2ssIGluaXRpYWxTdGF0ZSwgbG9jYWxDb2xvclNwYWNlQ2FjaGUpIHsKICAgIGNvbnN0IGRpY3QgPSB4b2JqLmRpY3Q7CiAgICBjb25zdCBtYXRyaXggPSBkaWN0LmdldEFycmF5KCJNYXRyaXgiKTsKICAgIGxldCBiYm94ID0gZGljdC5nZXRBcnJheSgiQkJveCIpOwogICAgYmJveCA9IEFycmF5LmlzQXJyYXkoYmJveCkgJiYgYmJveC5sZW5ndGggPT09IDQgPyBfdXRpbC5VdGlsLm5vcm1hbGl6ZVJlY3QoYmJveCkgOiBudWxsOwogICAgbGV0IG9wdGlvbmFsQ29udGVudCwgZ3JvdXBPcHRpb25zOwogICAgaWYgKGRpY3QuaGFzKCJPQyIpKSB7CiAgICAgIG9wdGlvbmFsQ29udGVudCA9IGF3YWl0IHRoaXMucGFyc2VNYXJrZWRDb250ZW50UHJvcHMoZGljdC5nZXQoIk9DIiksIHJlc291cmNlcyk7CiAgICB9CiAgICBpZiAob3B0aW9uYWxDb250ZW50ICE9PSB1bmRlZmluZWQpIHsKICAgICAgb3BlcmF0b3JMaXN0LmFkZE9wKF91dGlsLk9QUy5iZWdpbk1hcmtlZENvbnRlbnRQcm9wcywgWyJPQyIsIG9wdGlvbmFsQ29udGVudF0pOwogICAgfQogICAgY29uc3QgZ3JvdXAgPSBkaWN0LmdldCgiR3JvdXAiKTsKICAgIGlmIChncm91cCkgewogICAgICBncm91cE9wdGlvbnMgPSB7CiAgICAgICAgbWF0cml4LAogICAgICAgIGJib3gsCiAgICAgICAgc21hc2ssCiAgICAgICAgaXNvbGF0ZWQ6IGZhbHNlLAogICAgICAgIGtub2Nrb3V0OiBmYWxzZQogICAgICB9OwogICAgICBjb25zdCBncm91cFN1YnR5cGUgPSBncm91cC5nZXQoIlMiKTsKICAgICAgbGV0IGNvbG9yU3BhY2UgPSBudWxsOwogICAgICBpZiAoKDAsIF9wcmltaXRpdmVzLmlzTmFtZSkoZ3JvdXBTdWJ0eXBlLCAiVHJhbnNwYXJlbmN5IikpIHsKICAgICAgICBncm91cE9wdGlvbnMuaXNvbGF0ZWQgPSBncm91cC5nZXQoIkkiKSB8fCBmYWxzZTsKICAgICAgICBncm91cE9wdGlvbnMua25vY2tvdXQgPSBncm91cC5nZXQoIksiKSB8fCBmYWxzZTsKICAgICAgICBpZiAoZ3JvdXAuaGFzKCJDUyIpKSB7CiAgICAgICAgICBjb25zdCBjcyA9IGdyb3VwLmdldFJhdygiQ1MiKTsKICAgICAgICAgIGNvbnN0IGNhY2hlZENvbG9yU3BhY2UgPSBfY29sb3JzcGFjZS5Db2xvclNwYWNlLmdldENhY2hlZChjcywgdGhpcy54cmVmLCBsb2NhbENvbG9yU3BhY2VDYWNoZSk7CiAgICAgICAgICBpZiAoY2FjaGVkQ29sb3JTcGFjZSkgewogICAgICAgICAgICBjb2xvclNwYWNlID0gY2FjaGVkQ29sb3JTcGFjZTsKICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIGNvbG9yU3BhY2UgPSBhd2FpdCB0aGlzLnBhcnNlQ29sb3JTcGFjZSh7CiAgICAgICAgICAgICAgY3MsCiAgICAgICAgICAgICAgcmVzb3VyY2VzLAogICAgICAgICAgICAgIGxvY2FsQ29sb3JTcGFjZUNhY2hlCiAgICAgICAgICAgIH0pOwogICAgICAgICAgfQogICAgICAgIH0KICAgICAgfQogICAgICBpZiAoc21hc2s/LmJhY2tkcm9wKSB7CiAgICAgICAgY29sb3JTcGFjZSB8fD0gX2NvbG9yc3BhY2UuQ29sb3JTcGFjZS5zaW5nbGV0b25zLnJnYjsKICAgICAgICBzbWFzay5iYWNrZHJvcCA9IGNvbG9yU3BhY2UuZ2V0UmdiKHNtYXNrLmJhY2tkcm9wLCAwKTsKICAgICAgfQogICAgICBvcGVyYXRvckxpc3QuYWRkT3AoX3V0aWwuT1BTLmJlZ2luR3JvdXAsIFtncm91cE9wdGlvbnNdKTsKICAgIH0KICAgIGNvbnN0IGFyZ3MgPSBncm91cCA/IFttYXRyaXgsIG51bGxdIDogW21hdHJpeCwgYmJveF07CiAgICBvcGVyYXRvckxpc3QuYWRkT3AoX3V0aWwuT1BTLnBhaW50Rm9ybVhPYmplY3RCZWdpbiwgYXJncyk7CiAgICByZXR1cm4gdGhpcy5nZXRPcGVyYXRvckxpc3QoewogICAgICBzdHJlYW06IHhvYmosCiAgICAgIHRhc2ssCiAgICAgIHJlc291cmNlczogZGljdC5nZXQoIlJlc291cmNlcyIpIHx8IHJlc291cmNlcywKICAgICAgb3BlcmF0b3JMaXN0LAogICAgICBpbml0aWFsU3RhdGUKICAgIH0pLnRoZW4oZnVuY3Rpb24gKCkgewogICAgICBvcGVyYXRvckxpc3QuYWRkT3AoX3V0aWwuT1BTLnBhaW50Rm9ybVhPYmplY3RFbmQsIFtdKTsKICAgICAgaWYgKGdyb3VwKSB7CiAgICAgICAgb3BlcmF0b3JMaXN0LmFkZE9wKF91dGlsLk9QUy5lbmRHcm91cCwgW2dyb3VwT3B0aW9uc10pOwogICAgICB9CiAgICAgIGlmIChvcHRpb25hbENvbnRlbnQgIT09IHVuZGVmaW5lZCkgewogICAgICAgIG9wZXJhdG9yTGlzdC5hZGRPcChfdXRpbC5PUFMuZW5kTWFya2VkQ29udGVudCwgW10pOwogICAgICB9CiAgICB9KTsKICB9CiAgX3NlbmRJbWdEYXRhKG9iaklkLCBpbWdEYXRhLCBjYWNoZUdsb2JhbGx5ID0gZmFsc2UpIHsKICAgIGNvbnN0IHRyYW5zZmVycyA9IGltZ0RhdGEgPyBbaW1nRGF0YS5iaXRtYXAgfHwgaW1nRGF0YS5kYXRhLmJ1ZmZlcl0gOiBudWxsOwogICAgaWYgKHRoaXMucGFyc2luZ1R5cGUzRm9udCB8fCBjYWNoZUdsb2JhbGx5KSB7CiAgICAgIHJldHVybiB0aGlzLmhhbmRsZXIuc2VuZCgiY29tbW9ub2JqIiwgW29iaklkLCAiSW1hZ2UiLCBpbWdEYXRhXSwgdHJhbnNmZXJzKTsKICAgIH0KICAgIHJldHVybiB0aGlzLmhhbmRsZXIuc2VuZCgib2JqIiwgW29iaklkLCB0aGlzLnBhZ2VJbmRleCwgIkltYWdlIiwgaW1nRGF0YV0sIHRyYW5zZmVycyk7CiAgfQogIGFzeW5jIGJ1aWxkUGFpbnRJbWFnZVhPYmplY3QoewogICAgcmVzb3VyY2VzLAogICAgaW1hZ2UsCiAgICBpc0lubGluZSA9IGZhbHNlLAogICAgb3BlcmF0b3JMaXN0LAogICAgY2FjaGVLZXksCiAgICBsb2NhbEltYWdlQ2FjaGUsCiAgICBsb2NhbENvbG9yU3BhY2VDYWNoZQogIH0pIHsKICAgIGNvbnN0IGRpY3QgPSBpbWFnZS5kaWN0OwogICAgY29uc3QgaW1hZ2VSZWYgPSBkaWN0Lm9iaklkOwogICAgY29uc3QgdyA9IGRpY3QuZ2V0KCJXIiwgIldpZHRoIik7CiAgICBjb25zdCBoID0gZGljdC5nZXQoIkgiLCAiSGVpZ2h0Iik7CiAgICBpZiAoISh3ICYmIHR5cGVvZiB3ID09PSAibnVtYmVyIikgfHwgIShoICYmIHR5cGVvZiBoID09PSAibnVtYmVyIikpIHsKICAgICAgKDAsIF91dGlsLndhcm4pKCJJbWFnZSBkaW1lbnNpb25zIGFyZSBtaXNzaW5nLCBvciBub3QgbnVtYmVycy4iKTsKICAgICAgcmV0dXJuOwogICAgfQogICAgY29uc3QgbWF4SW1hZ2VTaXplID0gdGhpcy5vcHRpb25zLm1heEltYWdlU2l6ZTsKICAgIGlmIChtYXhJbWFnZVNpemUgIT09IC0xICYmIHcgKiBoID4gbWF4SW1hZ2VTaXplKSB7CiAgICAgIGNvbnN0IG1zZyA9ICJJbWFnZSBleGNlZWRlZCBtYXhpbXVtIGFsbG93ZWQgc2l6ZSBhbmQgd2FzIHJlbW92ZWQuIjsKICAgICAgaWYgKHRoaXMub3B0aW9ucy5pZ25vcmVFcnJvcnMpIHsKICAgICAgICAoMCwgX3V0aWwud2FybikobXNnKTsKICAgICAgICByZXR1cm47CiAgICAgIH0KICAgICAgdGhyb3cgbmV3IEVycm9yKG1zZyk7CiAgICB9CiAgICBsZXQgb3B0aW9uYWxDb250ZW50OwogICAgaWYgKGRpY3QuaGFzKCJPQyIpKSB7CiAgICAgIG9wdGlvbmFsQ29udGVudCA9IGF3YWl0IHRoaXMucGFyc2VNYXJrZWRDb250ZW50UHJvcHMoZGljdC5nZXQoIk9DIiksIHJlc291cmNlcyk7CiAgICB9CiAgICBjb25zdCBpbWFnZU1hc2sgPSBkaWN0LmdldCgiSU0iLCAiSW1hZ2VNYXNrIikgfHwgZmFsc2U7CiAgICBsZXQgaW1nRGF0YSwgYXJnczsKICAgIGlmIChpbWFnZU1hc2spIHsKICAgICAgY29uc3QgaW50ZXJwb2xhdGUgPSBkaWN0LmdldCgiSSIsICJJbnRlcnBvbGF0ZSIpOwogICAgICBjb25zdCBiaXRTdHJpZGVMZW5ndGggPSB3ICsgNyA+PiAzOwogICAgICBjb25zdCBpbWdBcnJheSA9IGltYWdlLmdldEJ5dGVzKGJpdFN0cmlkZUxlbmd0aCAqIGgpOwogICAgICBjb25zdCBkZWNvZGUgPSBkaWN0LmdldEFycmF5KCJEIiwgIkRlY29kZSIpOwogICAgICBpZiAodGhpcy5wYXJzaW5nVHlwZTNGb250KSB7CiAgICAgICAgaW1nRGF0YSA9IF9pbWFnZS5QREZJbWFnZS5jcmVhdGVSYXdNYXNrKHsKICAgICAgICAgIGltZ0FycmF5LAogICAgICAgICAgd2lkdGg6IHcsCiAgICAgICAgICBoZWlnaHQ6IGgsCiAgICAgICAgICBpbWFnZUlzRnJvbURlY29kZVN0cmVhbTogaW1hZ2UgaW5zdGFuY2VvZiBfZGVjb2RlX3N0cmVhbS5EZWNvZGVTdHJlYW0sCiAgICAgICAgICBpbnZlcnNlRGVjb2RlOiBkZWNvZGU/LlswXSA+IDAsCiAgICAgICAgICBpbnRlcnBvbGF0ZQogICAgICAgIH0pOwogICAgICAgIGltZ0RhdGEuY2FjaGVkID0gISFjYWNoZUtleTsKICAgICAgICBhcmdzID0gW2ltZ0RhdGFdOwogICAgICAgIG9wZXJhdG9yTGlzdC5hZGRJbWFnZU9wcyhfdXRpbC5PUFMucGFpbnRJbWFnZU1hc2tYT2JqZWN0LCBhcmdzLCBvcHRpb25hbENvbnRlbnQpOwogICAgICAgIGlmIChjYWNoZUtleSkgewogICAgICAgICAgY29uc3QgY2FjaGVEYXRhID0gewogICAgICAgICAgICBmbjogX3V0aWwuT1BTLnBhaW50SW1hZ2VNYXNrWE9iamVjdCwKICAgICAgICAgICAgYXJncywKICAgICAgICAgICAgb3B0aW9uYWxDb250ZW50CiAgICAgICAgICB9OwogICAgICAgICAgbG9jYWxJbWFnZUNhY2hlLnNldChjYWNoZUtleSwgaW1hZ2VSZWYsIGNhY2hlRGF0YSk7CiAgICAgICAgICBpZiAoaW1hZ2VSZWYpIHsKICAgICAgICAgICAgdGhpcy5fcmVnaW9uYWxJbWFnZUNhY2hlLnNldChudWxsLCBpbWFnZVJlZiwgY2FjaGVEYXRhKTsKICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgcmV0dXJuOwogICAgICB9CiAgICAgIGltZ0RhdGEgPSBhd2FpdCBfaW1hZ2UuUERGSW1hZ2UuY3JlYXRlTWFzayh7CiAgICAgICAgaW1nQXJyYXksCiAgICAgICAgd2lkdGg6IHcsCiAgICAgICAgaGVpZ2h0OiBoLAogICAgICAgIGltYWdlSXNGcm9tRGVjb2RlU3RyZWFtOiBpbWFnZSBpbnN0YW5jZW9mIF9kZWNvZGVfc3RyZWFtLkRlY29kZVN0cmVhbSwKICAgICAgICBpbnZlcnNlRGVjb2RlOiBkZWNvZGU/LlswXSA+IDAsCiAgICAgICAgaW50ZXJwb2xhdGUsCiAgICAgICAgaXNPZmZzY3JlZW5DYW52YXNTdXBwb3J0ZWQ6IHRoaXMub3B0aW9ucy5pc09mZnNjcmVlbkNhbnZhc1N1cHBvcnRlZAogICAgICB9KTsKICAgICAgaWYgKGltZ0RhdGEuaXNTaW5nbGVPcGFxdWVQaXhlbCkgewogICAgICAgIG9wZXJhdG9yTGlzdC5hZGRJbWFnZU9wcyhfdXRpbC5PUFMucGFpbnRTb2xpZENvbG9ySW1hZ2VNYXNrLCBbXSwgb3B0aW9uYWxDb250ZW50KTsKICAgICAgICBpZiAoY2FjaGVLZXkpIHsKICAgICAgICAgIGNvbnN0IGNhY2hlRGF0YSA9IHsKICAgICAgICAgICAgZm46IF91dGlsLk9QUy5wYWludFNvbGlkQ29sb3JJbWFnZU1hc2ssCiAgICAgICAgICAgIGFyZ3M6IFtdLAogICAgICAgICAgICBvcHRpb25hbENvbnRlbnQKICAgICAgICAgIH07CiAgICAgICAgICBsb2NhbEltYWdlQ2FjaGUuc2V0KGNhY2hlS2V5LCBpbWFnZVJlZiwgY2FjaGVEYXRhKTsKICAgICAgICAgIGlmIChpbWFnZVJlZikgewogICAgICAgICAgICB0aGlzLl9yZWdpb25hbEltYWdlQ2FjaGUuc2V0KG51bGwsIGltYWdlUmVmLCBjYWNoZURhdGEpOwogICAgICAgICAgfQogICAgICAgIH0KICAgICAgICByZXR1cm47CiAgICAgIH0KICAgICAgY29uc3Qgb2JqSWQgPSBgbWFza18ke3RoaXMuaWRGYWN0b3J5LmNyZWF0ZU9iaklkKCl9YDsKICAgICAgb3BlcmF0b3JMaXN0LmFkZERlcGVuZGVuY3kob2JqSWQpOwogICAgICB0aGlzLl9zZW5kSW1nRGF0YShvYmpJZCwgaW1nRGF0YSk7CiAgICAgIGFyZ3MgPSBbewogICAgICAgIGRhdGE6IG9iaklkLAogICAgICAgIHdpZHRoOiBpbWdEYXRhLndpZHRoLAogICAgICAgIGhlaWdodDogaW1nRGF0YS5oZWlnaHQsCiAgICAgICAgaW50ZXJwb2xhdGU6IGltZ0RhdGEuaW50ZXJwb2xhdGUsCiAgICAgICAgY291bnQ6IDEKICAgICAgfV07CiAgICAgIG9wZXJhdG9yTGlzdC5hZGRJbWFnZU9wcyhfdXRpbC5PUFMucGFpbnRJbWFnZU1hc2tYT2JqZWN0LCBhcmdzLCBvcHRpb25hbENvbnRlbnQpOwogICAgICBpZiAoY2FjaGVLZXkpIHsKICAgICAgICBjb25zdCBjYWNoZURhdGEgPSB7CiAgICAgICAgICBmbjogX3V0aWwuT1BTLnBhaW50SW1hZ2VNYXNrWE9iamVjdCwKICAgICAgICAgIGFyZ3MsCiAgICAgICAgICBvcHRpb25hbENvbnRlbnQKICAgICAgICB9OwogICAgICAgIGxvY2FsSW1hZ2VDYWNoZS5zZXQoY2FjaGVLZXksIGltYWdlUmVmLCBjYWNoZURhdGEpOwogICAgICAgIGlmIChpbWFnZVJlZikgewogICAgICAgICAgdGhpcy5fcmVnaW9uYWxJbWFnZUNhY2hlLnNldChudWxsLCBpbWFnZVJlZiwgY2FjaGVEYXRhKTsKICAgICAgICB9CiAgICAgIH0KICAgICAgcmV0dXJuOwogICAgfQogICAgY29uc3QgU01BTExfSU1BR0VfRElNRU5TSU9OUyA9IDIwMDsKICAgIGlmIChpc0lubGluZSAmJiAhZGljdC5oYXMoIlNNYXNrIikgJiYgIWRpY3QuaGFzKCJNYXNrIikgJiYgdyArIGggPCBTTUFMTF9JTUFHRV9ESU1FTlNJT05TKSB7CiAgICAgIGNvbnN0IGltYWdlT2JqID0gbmV3IF9pbWFnZS5QREZJbWFnZSh7CiAgICAgICAgeHJlZjogdGhpcy54cmVmLAogICAgICAgIHJlczogcmVzb3VyY2VzLAogICAgICAgIGltYWdlLAogICAgICAgIGlzSW5saW5lLAogICAgICAgIHBkZkZ1bmN0aW9uRmFjdG9yeTogdGhpcy5fcGRmRnVuY3Rpb25GYWN0b3J5LAogICAgICAgIGxvY2FsQ29sb3JTcGFjZUNhY2hlCiAgICAgIH0pOwogICAgICBpbWdEYXRhID0gYXdhaXQgaW1hZ2VPYmouY3JlYXRlSW1hZ2VEYXRhKHRydWUsIGZhbHNlKTsKICAgICAgb3BlcmF0b3JMaXN0LmlzT2Zmc2NyZWVuQ2FudmFzU3VwcG9ydGVkID0gdGhpcy5vcHRpb25zLmlzT2Zmc2NyZWVuQ2FudmFzU3VwcG9ydGVkOwogICAgICBvcGVyYXRvckxpc3QuYWRkSW1hZ2VPcHMoX3V0aWwuT1BTLnBhaW50SW5saW5lSW1hZ2VYT2JqZWN0LCBbaW1nRGF0YV0sIG9wdGlvbmFsQ29udGVudCk7CiAgICAgIHJldHVybjsKICAgIH0KICAgIGxldCBvYmpJZCA9IGBpbWdfJHt0aGlzLmlkRmFjdG9yeS5jcmVhdGVPYmpJZCgpfWAsCiAgICAgIGNhY2hlR2xvYmFsbHkgPSBmYWxzZTsKICAgIGlmICh0aGlzLnBhcnNpbmdUeXBlM0ZvbnQpIHsKICAgICAgb2JqSWQgPSBgJHt0aGlzLmlkRmFjdG9yeS5nZXREb2NJZCgpfV90eXBlM18ke29iaklkfWA7CiAgICB9IGVsc2UgaWYgKGltYWdlUmVmKSB7CiAgICAgIGNhY2hlR2xvYmFsbHkgPSB0aGlzLmdsb2JhbEltYWdlQ2FjaGUuc2hvdWxkQ2FjaGUoaW1hZ2VSZWYsIHRoaXMucGFnZUluZGV4KTsKICAgICAgaWYgKGNhY2hlR2xvYmFsbHkpIHsKICAgICAgICBvYmpJZCA9IGAke3RoaXMuaWRGYWN0b3J5LmdldERvY0lkKCl9XyR7b2JqSWR9YDsKICAgICAgfQogICAgfQogICAgb3BlcmF0b3JMaXN0LmFkZERlcGVuZGVuY3kob2JqSWQpOwogICAgYXJncyA9IFtvYmpJZCwgdywgaF07CiAgICBfaW1hZ2UuUERGSW1hZ2UuYnVpbGRJbWFnZSh7CiAgICAgIHhyZWY6IHRoaXMueHJlZiwKICAgICAgcmVzOiByZXNvdXJjZXMsCiAgICAgIGltYWdlLAogICAgICBpc0lubGluZSwKICAgICAgcGRmRnVuY3Rpb25GYWN0b3J5OiB0aGlzLl9wZGZGdW5jdGlvbkZhY3RvcnksCiAgICAgIGxvY2FsQ29sb3JTcGFjZUNhY2hlCiAgICB9KS50aGVuKGFzeW5jIGltYWdlT2JqID0+IHsKICAgICAgaW1nRGF0YSA9IGF3YWl0IGltYWdlT2JqLmNyZWF0ZUltYWdlRGF0YShmYWxzZSwgdGhpcy5vcHRpb25zLmlzT2Zmc2NyZWVuQ2FudmFzU3VwcG9ydGVkKTsKICAgICAgaWYgKGNhY2hlS2V5ICYmIGltYWdlUmVmICYmIGNhY2hlR2xvYmFsbHkpIHsKICAgICAgICBjb25zdCBsZW5ndGggPSBpbWdEYXRhLmJpdG1hcCA/IGltZ0RhdGEud2lkdGggKiBpbWdEYXRhLmhlaWdodCAqIDQgOiBpbWdEYXRhLmRhdGEubGVuZ3RoOwogICAgICAgIHRoaXMuZ2xvYmFsSW1hZ2VDYWNoZS5hZGRCeXRlU2l6ZShpbWFnZVJlZiwgbGVuZ3RoKTsKICAgICAgfQogICAgICByZXR1cm4gdGhpcy5fc2VuZEltZ0RhdGEob2JqSWQsIGltZ0RhdGEsIGNhY2hlR2xvYmFsbHkpOwogICAgfSkuY2F0Y2gocmVhc29uID0+IHsKICAgICAgKDAsIF91dGlsLndhcm4pKGBVbmFibGUgdG8gZGVjb2RlIGltYWdlICIke29iaklkfSI6ICIke3JlYXNvbn0iLmApOwogICAgICByZXR1cm4gdGhpcy5fc2VuZEltZ0RhdGEob2JqSWQsIG51bGwsIGNhY2hlR2xvYmFsbHkpOwogICAgfSk7CiAgICBvcGVyYXRvckxpc3QuYWRkSW1hZ2VPcHMoX3V0aWwuT1BTLnBhaW50SW1hZ2VYT2JqZWN0LCBhcmdzLCBvcHRpb25hbENvbnRlbnQpOwogICAgaWYgKGNhY2hlS2V5KSB7CiAgICAgIGNvbnN0IGNhY2hlRGF0YSA9IHsKICAgICAgICBmbjogX3V0aWwuT1BTLnBhaW50SW1hZ2VYT2JqZWN0LAogICAgICAgIGFyZ3MsCiAgICAgICAgb3B0aW9uYWxDb250ZW50CiAgICAgIH07CiAgICAgIGxvY2FsSW1hZ2VDYWNoZS5zZXQoY2FjaGVLZXksIGltYWdlUmVmLCBjYWNoZURhdGEpOwogICAgICBpZiAoaW1hZ2VSZWYpIHsKICAgICAgICB0aGlzLl9yZWdpb25hbEltYWdlQ2FjaGUuc2V0KG51bGwsIGltYWdlUmVmLCBjYWNoZURhdGEpOwogICAgICAgIGlmIChjYWNoZUdsb2JhbGx5KSB7CiAgICAgICAgICAoMCwgX3V0aWwuYXNzZXJ0KSghaXNJbmxpbmUsICJDYW5ub3QgY2FjaGUgYW4gaW5saW5lIGltYWdlIGdsb2JhbGx5LiIpOwogICAgICAgICAgdGhpcy5nbG9iYWxJbWFnZUNhY2hlLnNldERhdGEoaW1hZ2VSZWYsIHsKICAgICAgICAgICAgb2JqSWQsCiAgICAgICAgICAgIGZuOiBfdXRpbC5PUFMucGFpbnRJbWFnZVhPYmplY3QsCiAgICAgICAgICAgIGFyZ3MsCiAgICAgICAgICAgIG9wdGlvbmFsQ29udGVudCwKICAgICAgICAgICAgYnl0ZVNpemU6IDAKICAgICAgICAgIH0pOwogICAgICAgIH0KICAgICAgfQogICAgfQogIH0KICBoYW5kbGVTTWFzayhzbWFzaywgcmVzb3VyY2VzLCBvcGVyYXRvckxpc3QsIHRhc2ssIHN0YXRlTWFuYWdlciwgbG9jYWxDb2xvclNwYWNlQ2FjaGUpIHsKICAgIGNvbnN0IHNtYXNrQ29udGVudCA9IHNtYXNrLmdldCgiRyIpOwogICAgY29uc3Qgc21hc2tPcHRpb25zID0gewogICAgICBzdWJ0eXBlOiBzbWFzay5nZXQoIlMiKS5uYW1lLAogICAgICBiYWNrZHJvcDogc21hc2suZ2V0KCJCQyIpCiAgICB9OwogICAgY29uc3QgdHJhbnNmZXJPYmogPSBzbWFzay5nZXQoIlRSIik7CiAgICBpZiAoKDAsIF9mdW5jdGlvbi5pc1BERkZ1bmN0aW9uKSh0cmFuc2Zlck9iaikpIHsKICAgICAgY29uc3QgdHJhbnNmZXJGbiA9IHRoaXMuX3BkZkZ1bmN0aW9uRmFjdG9yeS5jcmVhdGUodHJhbnNmZXJPYmopOwogICAgICBjb25zdCB0cmFuc2Zlck1hcCA9IG5ldyBVaW50OEFycmF5KDI1Nik7CiAgICAgIGNvbnN0IHRtcCA9IG5ldyBGbG9hdDMyQXJyYXkoMSk7CiAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgMjU2OyBpKyspIHsKICAgICAgICB0bXBbMF0gPSBpIC8gMjU1OwogICAgICAgIHRyYW5zZmVyRm4odG1wLCAwLCB0bXAsIDApOwogICAgICAgIHRyYW5zZmVyTWFwW2ldID0gdG1wWzBdICogMjU1IHwgMDsKICAgICAgfQogICAgICBzbWFza09wdGlvbnMudHJhbnNmZXJNYXAgPSB0cmFuc2Zlck1hcDsKICAgIH0KICAgIHJldHVybiB0aGlzLmJ1aWxkRm9ybVhPYmplY3QocmVzb3VyY2VzLCBzbWFza0NvbnRlbnQsIHNtYXNrT3B0aW9ucywgb3BlcmF0b3JMaXN0LCB0YXNrLCBzdGF0ZU1hbmFnZXIuc3RhdGUuY2xvbmUoKSwgbG9jYWxDb2xvclNwYWNlQ2FjaGUpOwogIH0KICBoYW5kbGVUcmFuc2ZlckZ1bmN0aW9uKHRyKSB7CiAgICBsZXQgdHJhbnNmZXJBcnJheTsKICAgIGlmIChBcnJheS5pc0FycmF5KHRyKSkgewogICAgICB0cmFuc2ZlckFycmF5ID0gdHI7CiAgICB9IGVsc2UgaWYgKCgwLCBfZnVuY3Rpb24uaXNQREZGdW5jdGlvbikodHIpKSB7CiAgICAgIHRyYW5zZmVyQXJyYXkgPSBbdHJdOwogICAgfSBlbHNlIHsKICAgICAgcmV0dXJuIG51bGw7CiAgICB9CiAgICBjb25zdCB0cmFuc2Zlck1hcHMgPSBbXTsKICAgIGxldCBudW1GbnMgPSAwLAogICAgICBudW1FZmZlY3RmdWxGbnMgPSAwOwogICAgZm9yIChjb25zdCBlbnRyeSBvZiB0cmFuc2ZlckFycmF5KSB7CiAgICAgIGNvbnN0IHRyYW5zZmVyT2JqID0gdGhpcy54cmVmLmZldGNoSWZSZWYoZW50cnkpOwogICAgICBudW1GbnMrKzsKICAgICAgaWYgKCgwLCBfcHJpbWl0aXZlcy5pc05hbWUpKHRyYW5zZmVyT2JqLCAiSWRlbnRpdHkiKSkgewogICAgICAgIHRyYW5zZmVyTWFwcy5wdXNoKG51bGwpOwogICAgICAgIGNvbnRpbnVlOwogICAgICB9IGVsc2UgaWYgKCEoMCwgX2Z1bmN0aW9uLmlzUERGRnVuY3Rpb24pKHRyYW5zZmVyT2JqKSkgewogICAgICAgIHJldHVybiBudWxsOwogICAgICB9CiAgICAgIGNvbnN0IHRyYW5zZmVyRm4gPSB0aGlzLl9wZGZGdW5jdGlvbkZhY3RvcnkuY3JlYXRlKHRyYW5zZmVyT2JqKTsKICAgICAgY29uc3QgdHJhbnNmZXJNYXAgPSBuZXcgVWludDhBcnJheSgyNTYpLAogICAgICAgIHRtcCA9IG5ldyBGbG9hdDMyQXJyYXkoMSk7CiAgICAgIGZvciAobGV0IGogPSAwOyBqIDwgMjU2OyBqKyspIHsKICAgICAgICB0bXBbMF0gPSBqIC8gMjU1OwogICAgICAgIHRyYW5zZmVyRm4odG1wLCAwLCB0bXAsIDApOwogICAgICAgIHRyYW5zZmVyTWFwW2pdID0gdG1wWzBdICogMjU1IHwgMDsKICAgICAgfQogICAgICB0cmFuc2Zlck1hcHMucHVzaCh0cmFuc2Zlck1hcCk7CiAgICAgIG51bUVmZmVjdGZ1bEZucysrOwogICAgfQogICAgaWYgKCEobnVtRm5zID09PSAxIHx8IG51bUZucyA9PT0gNCkpIHsKICAgICAgcmV0dXJuIG51bGw7CiAgICB9CiAgICBpZiAobnVtRWZmZWN0ZnVsRm5zID09PSAwKSB7CiAgICAgIHJldHVybiBudWxsOwogICAgfQogICAgcmV0dXJuIHRyYW5zZmVyTWFwczsKICB9CiAgaGFuZGxlVGlsaW5nVHlwZShmbiwgY29sb3IsIHJlc291cmNlcywgcGF0dGVybiwgcGF0dGVybkRpY3QsIG9wZXJhdG9yTGlzdCwgdGFzaywgbG9jYWxUaWxpbmdQYXR0ZXJuQ2FjaGUpIHsKICAgIGNvbnN0IHRpbGluZ09wTGlzdCA9IG5ldyBfb3BlcmF0b3JfbGlzdC5PcGVyYXRvckxpc3QoKTsKICAgIGNvbnN0IHBhdHRlcm5SZXNvdXJjZXMgPSBfcHJpbWl0aXZlcy5EaWN0Lm1lcmdlKHsKICAgICAgeHJlZjogdGhpcy54cmVmLAogICAgICBkaWN0QXJyYXk6IFtwYXR0ZXJuRGljdC5nZXQoIlJlc291cmNlcyIpLCByZXNvdXJjZXNdCiAgICB9KTsKICAgIHJldHVybiB0aGlzLmdldE9wZXJhdG9yTGlzdCh7CiAgICAgIHN0cmVhbTogcGF0dGVybiwKICAgICAgdGFzaywKICAgICAgcmVzb3VyY2VzOiBwYXR0ZXJuUmVzb3VyY2VzLAogICAgICBvcGVyYXRvckxpc3Q6IHRpbGluZ09wTGlzdAogICAgfSkudGhlbihmdW5jdGlvbiAoKSB7CiAgICAgIGNvbnN0IG9wZXJhdG9yTGlzdElSID0gdGlsaW5nT3BMaXN0LmdldElSKCk7CiAgICAgIGNvbnN0IHRpbGluZ1BhdHRlcm5JUiA9ICgwLCBfcGF0dGVybi5nZXRUaWxpbmdQYXR0ZXJuSVIpKG9wZXJhdG9yTGlzdElSLCBwYXR0ZXJuRGljdCwgY29sb3IpOwogICAgICBvcGVyYXRvckxpc3QuYWRkRGVwZW5kZW5jaWVzKHRpbGluZ09wTGlzdC5kZXBlbmRlbmNpZXMpOwogICAgICBvcGVyYXRvckxpc3QuYWRkT3AoZm4sIHRpbGluZ1BhdHRlcm5JUik7CiAgICAgIGlmIChwYXR0ZXJuRGljdC5vYmpJZCkgewogICAgICAgIGxvY2FsVGlsaW5nUGF0dGVybkNhY2hlLnNldChudWxsLCBwYXR0ZXJuRGljdC5vYmpJZCwgewogICAgICAgICAgb3BlcmF0b3JMaXN0SVIsCiAgICAgICAgICBkaWN0OiBwYXR0ZXJuRGljdAogICAgICAgIH0pOwogICAgICB9CiAgICB9KS5jYXRjaChyZWFzb24gPT4gewogICAgICBpZiAocmVhc29uIGluc3RhbmNlb2YgX3V0aWwuQWJvcnRFeGNlcHRpb24pIHsKICAgICAgICByZXR1cm47CiAgICAgIH0KICAgICAgaWYgKHRoaXMub3B0aW9ucy5pZ25vcmVFcnJvcnMpIHsKICAgICAgICAoMCwgX3V0aWwud2FybikoYGhhbmRsZVRpbGluZ1R5cGUgLSBpZ25vcmluZyBwYXR0ZXJuOiAiJHtyZWFzb259Ii5gKTsKICAgICAgICByZXR1cm47CiAgICAgIH0KICAgICAgdGhyb3cgcmVhc29uOwogICAgfSk7CiAgfQogIGhhbmRsZVNldEZvbnQocmVzb3VyY2VzLCBmb250QXJncywgZm9udFJlZiwgb3BlcmF0b3JMaXN0LCB0YXNrLCBzdGF0ZSwgZmFsbGJhY2tGb250RGljdCA9IG51bGwsIGNzc0ZvbnRJbmZvID0gbnVsbCkgewogICAgY29uc3QgZm9udE5hbWUgPSBmb250QXJncz8uWzBdIGluc3RhbmNlb2YgX3ByaW1pdGl2ZXMuTmFtZSA/IGZvbnRBcmdzWzBdLm5hbWUgOiBudWxsOwogICAgcmV0dXJuIHRoaXMubG9hZEZvbnQoZm9udE5hbWUsIGZvbnRSZWYsIHJlc291cmNlcywgZmFsbGJhY2tGb250RGljdCwgY3NzRm9udEluZm8pLnRoZW4odHJhbnNsYXRlZCA9PiB7CiAgICAgIGlmICghdHJhbnNsYXRlZC5mb250LmlzVHlwZTNGb250KSB7CiAgICAgICAgcmV0dXJuIHRyYW5zbGF0ZWQ7CiAgICAgIH0KICAgICAgcmV0dXJuIHRyYW5zbGF0ZWQubG9hZFR5cGUzRGF0YSh0aGlzLCByZXNvdXJjZXMsIHRhc2spLnRoZW4oZnVuY3Rpb24gKCkgewogICAgICAgIG9wZXJhdG9yTGlzdC5hZGREZXBlbmRlbmNpZXModHJhbnNsYXRlZC50eXBlM0RlcGVuZGVuY2llcyk7CiAgICAgICAgcmV0dXJuIHRyYW5zbGF0ZWQ7CiAgICAgIH0pLmNhdGNoKHJlYXNvbiA9PiB7CiAgICAgICAgcmV0dXJuIG5ldyBUcmFuc2xhdGVkRm9udCh7CiAgICAgICAgICBsb2FkZWROYW1lOiAiZ19mb250X2Vycm9yIiwKICAgICAgICAgIGZvbnQ6IG5ldyBfZm9udHMuRXJyb3JGb250KGBUeXBlMyBmb250IGxvYWQgZXJyb3I6ICR7cmVhc29ufWApLAogICAgICAgICAgZGljdDogdHJhbnNsYXRlZC5mb250LAogICAgICAgICAgZXZhbHVhdG9yT3B0aW9uczogdGhpcy5vcHRpb25zCiAgICAgICAgfSk7CiAgICAgIH0pOwogICAgfSkudGhlbih0cmFuc2xhdGVkID0+IHsKICAgICAgc3RhdGUuZm9udCA9IHRyYW5zbGF0ZWQuZm9udDsKICAgICAgdHJhbnNsYXRlZC5zZW5kKHRoaXMuaGFuZGxlcik7CiAgICAgIHJldHVybiB0cmFuc2xhdGVkLmxvYWRlZE5hbWU7CiAgICB9KTsKICB9CiAgaGFuZGxlVGV4dChjaGFycywgc3RhdGUpIHsKICAgIGNvbnN0IGZvbnQgPSBzdGF0ZS5mb250OwogICAgY29uc3QgZ2x5cGhzID0gZm9udC5jaGFyc1RvR2x5cGhzKGNoYXJzKTsKICAgIGlmIChmb250LmRhdGEpIHsKICAgICAgY29uc3QgaXNBZGRUb1BhdGhTZXQgPSAhIShzdGF0ZS50ZXh0UmVuZGVyaW5nTW9kZSAmIF91dGlsLlRleHRSZW5kZXJpbmdNb2RlLkFERF9UT19QQVRIX0ZMQUcpOwogICAgICBpZiAoaXNBZGRUb1BhdGhTZXQgfHwgc3RhdGUuZmlsbENvbG9yU3BhY2UubmFtZSA9PT0gIlBhdHRlcm4iIHx8IGZvbnQuZGlzYWJsZUZvbnRGYWNlIHx8IHRoaXMub3B0aW9ucy5kaXNhYmxlRm9udEZhY2UpIHsKICAgICAgICBQYXJ0aWFsRXZhbHVhdG9yLmJ1aWxkRm9udFBhdGhzKGZvbnQsIGdseXBocywgdGhpcy5oYW5kbGVyLCB0aGlzLm9wdGlvbnMpOwogICAgICB9CiAgICB9CiAgICByZXR1cm4gZ2x5cGhzOwogIH0KICBlbnN1cmVTdGF0ZUZvbnQoc3RhdGUpIHsKICAgIGlmIChzdGF0ZS5mb250KSB7CiAgICAgIHJldHVybjsKICAgIH0KICAgIGNvbnN0IHJlYXNvbiA9IG5ldyBfdXRpbC5Gb3JtYXRFcnJvcigiTWlzc2luZyBzZXRGb250IChUZikgb3BlcmF0b3IgYmVmb3JlIHRleHQgcmVuZGVyaW5nIG9wZXJhdG9yLiIpOwogICAgaWYgKHRoaXMub3B0aW9ucy5pZ25vcmVFcnJvcnMpIHsKICAgICAgKDAsIF91dGlsLndhcm4pKGBlbnN1cmVTdGF0ZUZvbnQ6ICIke3JlYXNvbn0iLmApOwogICAgICByZXR1cm47CiAgICB9CiAgICB0aHJvdyByZWFzb247CiAgfQogIGFzeW5jIHNldEdTdGF0ZSh7CiAgICByZXNvdXJjZXMsCiAgICBnU3RhdGUsCiAgICBvcGVyYXRvckxpc3QsCiAgICBjYWNoZUtleSwKICAgIHRhc2ssCiAgICBzdGF0ZU1hbmFnZXIsCiAgICBsb2NhbEdTdGF0ZUNhY2hlLAogICAgbG9jYWxDb2xvclNwYWNlQ2FjaGUKICB9KSB7CiAgICBjb25zdCBnU3RhdGVSZWYgPSBnU3RhdGUub2JqSWQ7CiAgICBsZXQgaXNTaW1wbGVHU3RhdGUgPSB0cnVlOwogICAgY29uc3QgZ1N0YXRlT2JqID0gW107CiAgICBsZXQgcHJvbWlzZSA9IFByb21pc2UucmVzb2x2ZSgpOwogICAgZm9yIChjb25zdCBrZXkgb2YgZ1N0YXRlLmdldEtleXMoKSkgewogICAgICBjb25zdCB2YWx1ZSA9IGdTdGF0ZS5nZXQoa2V5KTsKICAgICAgc3dpdGNoIChrZXkpIHsKICAgICAgICBjYXNlICJUeXBlIjoKICAgICAgICAgIGJyZWFrOwogICAgICAgIGNhc2UgIkxXIjoKICAgICAgICBjYXNlICJMQyI6CiAgICAgICAgY2FzZSAiTEoiOgogICAgICAgIGNhc2UgIk1MIjoKICAgICAgICBjYXNlICJEIjoKICAgICAgICBjYXNlICJSSSI6CiAgICAgICAgY2FzZSAiRkwiOgogICAgICAgIGNhc2UgIkNBIjoKICAgICAgICBjYXNlICJjYSI6CiAgICAgICAgICBnU3RhdGVPYmoucHVzaChba2V5LCB2YWx1ZV0pOwogICAgICAgICAgYnJlYWs7CiAgICAgICAgY2FzZSAiRm9udCI6CiAgICAgICAgICBpc1NpbXBsZUdTdGF0ZSA9IGZhbHNlOwogICAgICAgICAgcHJvbWlzZSA9IHByb21pc2UudGhlbigoKSA9PiB7CiAgICAgICAgICAgIHJldHVybiB0aGlzLmhhbmRsZVNldEZvbnQocmVzb3VyY2VzLCBudWxsLCB2YWx1ZVswXSwgb3BlcmF0b3JMaXN0LCB0YXNrLCBzdGF0ZU1hbmFnZXIuc3RhdGUpLnRoZW4oZnVuY3Rpb24gKGxvYWRlZE5hbWUpIHsKICAgICAgICAgICAgICBvcGVyYXRvckxpc3QuYWRkRGVwZW5kZW5jeShsb2FkZWROYW1lKTsKICAgICAgICAgICAgICBnU3RhdGVPYmoucHVzaChba2V5LCBbbG9hZGVkTmFtZSwgdmFsdWVbMV1dXSk7CiAgICAgICAgICAgIH0pOwogICAgICAgICAgfSk7CiAgICAgICAgICBicmVhazsKICAgICAgICBjYXNlICJCTSI6CiAgICAgICAgICBnU3RhdGVPYmoucHVzaChba2V5LCBub3JtYWxpemVCbGVuZE1vZGUodmFsdWUpXSk7CiAgICAgICAgICBicmVhazsKICAgICAgICBjYXNlICJTTWFzayI6CiAgICAgICAgICBpZiAoKDAsIF9wcmltaXRpdmVzLmlzTmFtZSkodmFsdWUsICJOb25lIikpIHsKICAgICAgICAgICAgZ1N0YXRlT2JqLnB1c2goW2tleSwgZmFsc2VdKTsKICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICB9CiAgICAgICAgICBpZiAodmFsdWUgaW5zdGFuY2VvZiBfcHJpbWl0aXZlcy5EaWN0KSB7CiAgICAgICAgICAgIGlzU2ltcGxlR1N0YXRlID0gZmFsc2U7CiAgICAgICAgICAgIHByb21pc2UgPSBwcm9taXNlLnRoZW4oKCkgPT4gewogICAgICAgICAgICAgIHJldHVybiB0aGlzLmhhbmRsZVNNYXNrKHZhbHVlLCByZXNvdXJjZXMsIG9wZXJhdG9yTGlzdCwgdGFzaywgc3RhdGVNYW5hZ2VyLCBsb2NhbENvbG9yU3BhY2VDYWNoZSk7CiAgICAgICAgICAgIH0pOwogICAgICAgICAgICBnU3RhdGVPYmoucHVzaChba2V5LCB0cnVlXSk7CiAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAoMCwgX3V0aWwud2FybikoIlVuc3VwcG9ydGVkIFNNYXNrIHR5cGUiKTsKICAgICAgICAgIH0KICAgICAgICAgIGJyZWFrOwogICAgICAgIGNhc2UgIlRSIjoKICAgICAgICAgIGNvbnN0IHRyYW5zZmVyTWFwcyA9IHRoaXMuaGFuZGxlVHJhbnNmZXJGdW5jdGlvbih2YWx1ZSk7CiAgICAgICAgICBnU3RhdGVPYmoucHVzaChba2V5LCB0cmFuc2Zlck1hcHNdKTsKICAgICAgICAgIGJyZWFrOwogICAgICAgIGNhc2UgIk9QIjoKICAgICAgICBjYXNlICJvcCI6CiAgICAgICAgY2FzZSAiT1BNIjoKICAgICAgICBjYXNlICJCRyI6CiAgICAgICAgY2FzZSAiQkcyIjoKICAgICAgICBjYXNlICJVQ1IiOgogICAgICAgIGNhc2UgIlVDUjIiOgogICAgICAgIGNhc2UgIlRSMiI6CiAgICAgICAgY2FzZSAiSFQiOgogICAgICAgIGNhc2UgIlNNIjoKICAgICAgICBjYXNlICJTQSI6CiAgICAgICAgY2FzZSAiQUlTIjoKICAgICAgICBjYXNlICJUSyI6CiAgICAgICAgICAoMCwgX3V0aWwuaW5mbykoImdyYXBoaWMgc3RhdGUgb3BlcmF0b3IgIiArIGtleSk7CiAgICAgICAgICBicmVhazsKICAgICAgICBkZWZhdWx0OgogICAgICAgICAgKDAsIF91dGlsLmluZm8pKCJVbmtub3duIGdyYXBoaWMgc3RhdGUgb3BlcmF0b3IgIiArIGtleSk7CiAgICAgICAgICBicmVhazsKICAgICAgfQogICAgfQogICAgcmV0dXJuIHByb21pc2UudGhlbihmdW5jdGlvbiAoKSB7CiAgICAgIGlmIChnU3RhdGVPYmoubGVuZ3RoID4gMCkgewogICAgICAgIG9wZXJhdG9yTGlzdC5hZGRPcChfdXRpbC5PUFMuc2V0R1N0YXRlLCBbZ1N0YXRlT2JqXSk7CiAgICAgIH0KICAgICAgaWYgKGlzU2ltcGxlR1N0YXRlKSB7CiAgICAgICAgbG9jYWxHU3RhdGVDYWNoZS5zZXQoY2FjaGVLZXksIGdTdGF0ZVJlZiwgZ1N0YXRlT2JqKTsKICAgICAgfQogICAgfSk7CiAgfQogIGxvYWRGb250KGZvbnROYW1lLCBmb250LCByZXNvdXJjZXMsIGZhbGxiYWNrRm9udERpY3QgPSBudWxsLCBjc3NGb250SW5mbyA9IG51bGwpIHsKICAgIGNvbnN0IGVycm9yRm9udCA9IGFzeW5jICgpID0+IHsKICAgICAgcmV0dXJuIG5ldyBUcmFuc2xhdGVkRm9udCh7CiAgICAgICAgbG9hZGVkTmFtZTogImdfZm9udF9lcnJvciIsCiAgICAgICAgZm9udDogbmV3IF9mb250cy5FcnJvckZvbnQoYEZvbnQgIiR7Zm9udE5hbWV9IiBpcyBub3QgYXZhaWxhYmxlLmApLAogICAgICAgIGRpY3Q6IGZvbnQsCiAgICAgICAgZXZhbHVhdG9yT3B0aW9uczogdGhpcy5vcHRpb25zCiAgICAgIH0pOwogICAgfTsKICAgIGxldCBmb250UmVmOwogICAgaWYgKGZvbnQpIHsKICAgICAgaWYgKGZvbnQgaW5zdGFuY2VvZiBfcHJpbWl0aXZlcy5SZWYpIHsKICAgICAgICBmb250UmVmID0gZm9udDsKICAgICAgfQogICAgfSBlbHNlIHsKICAgICAgY29uc3QgZm9udFJlcyA9IHJlc291cmNlcy5nZXQoIkZvbnQiKTsKICAgICAgaWYgKGZvbnRSZXMpIHsKICAgICAgICBmb250UmVmID0gZm9udFJlcy5nZXRSYXcoZm9udE5hbWUpOwogICAgICB9CiAgICB9CiAgICBpZiAoZm9udFJlZikgewogICAgICBpZiAodGhpcy5wYXJzaW5nVHlwZTNGb250ICYmIHRoaXMudHlwZTNGb250UmVmcy5oYXMoZm9udFJlZikpIHsKICAgICAgICByZXR1cm4gZXJyb3JGb250KCk7CiAgICAgIH0KICAgICAgaWYgKHRoaXMuZm9udENhY2hlLmhhcyhmb250UmVmKSkgewogICAgICAgIHJldHVybiB0aGlzLmZvbnRDYWNoZS5nZXQoZm9udFJlZik7CiAgICAgIH0KICAgICAgZm9udCA9IHRoaXMueHJlZi5mZXRjaElmUmVmKGZvbnRSZWYpOwogICAgfQogICAgaWYgKCEoZm9udCBpbnN0YW5jZW9mIF9wcmltaXRpdmVzLkRpY3QpKSB7CiAgICAgIGlmICghdGhpcy5vcHRpb25zLmlnbm9yZUVycm9ycyAmJiAhdGhpcy5wYXJzaW5nVHlwZTNGb250KSB7CiAgICAgICAgKDAsIF91dGlsLndhcm4pKGBGb250ICIke2ZvbnROYW1lfSIgaXMgbm90IGF2YWlsYWJsZS5gKTsKICAgICAgICByZXR1cm4gZXJyb3JGb250KCk7CiAgICAgIH0KICAgICAgKDAsIF91dGlsLndhcm4pKGBGb250ICIke2ZvbnROYW1lfSIgaXMgbm90IGF2YWlsYWJsZSAtLSBhdHRlbXB0aW5nIHRvIGZhbGxiYWNrIHRvIGEgZGVmYXVsdCBmb250LmApOwogICAgICBmb250ID0gZmFsbGJhY2tGb250RGljdCB8fCBQYXJ0aWFsRXZhbHVhdG9yLmZhbGxiYWNrRm9udERpY3Q7CiAgICB9CiAgICBpZiAoZm9udC5jYWNoZUtleSAmJiB0aGlzLmZvbnRDYWNoZS5oYXMoZm9udC5jYWNoZUtleSkpIHsKICAgICAgcmV0dXJuIHRoaXMuZm9udENhY2hlLmdldChmb250LmNhY2hlS2V5KTsKICAgIH0KICAgIGNvbnN0IGZvbnRDYXBhYmlsaXR5ID0gbmV3IF91dGlsLlByb21pc2VDYXBhYmlsaXR5KCk7CiAgICBsZXQgcHJlRXZhbHVhdGVkRm9udDsKICAgIHRyeSB7CiAgICAgIHByZUV2YWx1YXRlZEZvbnQgPSB0aGlzLnByZUV2YWx1YXRlRm9udChmb250KTsKICAgICAgcHJlRXZhbHVhdGVkRm9udC5jc3NGb250SW5mbyA9IGNzc0ZvbnRJbmZvOwogICAgfSBjYXRjaCAocmVhc29uKSB7CiAgICAgICgwLCBfdXRpbC53YXJuKShgbG9hZEZvbnQgLSBwcmVFdmFsdWF0ZUZvbnQgZmFpbGVkOiAiJHtyZWFzb259Ii5gKTsKICAgICAgcmV0dXJuIGVycm9yRm9udCgpOwogICAgfQogICAgY29uc3QgewogICAgICBkZXNjcmlwdG9yLAogICAgICBoYXNoCiAgICB9ID0gcHJlRXZhbHVhdGVkRm9udDsKICAgIGNvbnN0IGZvbnRSZWZJc1JlZiA9IGZvbnRSZWYgaW5zdGFuY2VvZiBfcHJpbWl0aXZlcy5SZWY7CiAgICBsZXQgZm9udElEOwogICAgaWYgKGhhc2ggJiYgZGVzY3JpcHRvciBpbnN0YW5jZW9mIF9wcmltaXRpdmVzLkRpY3QpIHsKICAgICAgY29uc3QgZm9udEFsaWFzZXMgPSBkZXNjcmlwdG9yLmZvbnRBbGlhc2VzIHx8PSBPYmplY3QuY3JlYXRlKG51bGwpOwogICAgICBpZiAoZm9udEFsaWFzZXNbaGFzaF0pIHsKICAgICAgICBjb25zdCBhbGlhc0ZvbnRSZWYgPSBmb250QWxpYXNlc1toYXNoXS5hbGlhc1JlZjsKICAgICAgICBpZiAoZm9udFJlZklzUmVmICYmIGFsaWFzRm9udFJlZiAmJiB0aGlzLmZvbnRDYWNoZS5oYXMoYWxpYXNGb250UmVmKSkgewogICAgICAgICAgdGhpcy5mb250Q2FjaGUucHV0QWxpYXMoZm9udFJlZiwgYWxpYXNGb250UmVmKTsKICAgICAgICAgIHJldHVybiB0aGlzLmZvbnRDYWNoZS5nZXQoZm9udFJlZik7CiAgICAgICAgfQogICAgICB9IGVsc2UgewogICAgICAgIGZvbnRBbGlhc2VzW2hhc2hdID0gewogICAgICAgICAgZm9udElEOiB0aGlzLmlkRmFjdG9yeS5jcmVhdGVGb250SWQoKQogICAgICAgIH07CiAgICAgIH0KICAgICAgaWYgKGZvbnRSZWZJc1JlZikgewogICAgICAgIGZvbnRBbGlhc2VzW2hhc2hdLmFsaWFzUmVmID0gZm9udFJlZjsKICAgICAgfQogICAgICBmb250SUQgPSBmb250QWxpYXNlc1toYXNoXS5mb250SUQ7CiAgICB9IGVsc2UgewogICAgICBmb250SUQgPSB0aGlzLmlkRmFjdG9yeS5jcmVhdGVGb250SWQoKTsKICAgIH0KICAgICgwLCBfdXRpbC5hc3NlcnQpKGZvbnRJRD8uc3RhcnRzV2l0aCgiZiIpLCAnVGhlICJmb250SUQiIG11c3QgYmUgKGNvcnJlY3RseSkgZGVmaW5lZC4nKTsKICAgIGlmIChmb250UmVmSXNSZWYpIHsKICAgICAgdGhpcy5mb250Q2FjaGUucHV0KGZvbnRSZWYsIGZvbnRDYXBhYmlsaXR5LnByb21pc2UpOwogICAgfSBlbHNlIHsKICAgICAgZm9udC5jYWNoZUtleSA9IGBjYWNoZUtleV8ke2ZvbnRJRH1gOwogICAgICB0aGlzLmZvbnRDYWNoZS5wdXQoZm9udC5jYWNoZUtleSwgZm9udENhcGFiaWxpdHkucHJvbWlzZSk7CiAgICB9CiAgICBmb250LmxvYWRlZE5hbWUgPSBgJHt0aGlzLmlkRmFjdG9yeS5nZXREb2NJZCgpfV8ke2ZvbnRJRH1gOwogICAgdGhpcy50cmFuc2xhdGVGb250KHByZUV2YWx1YXRlZEZvbnQpLnRoZW4odHJhbnNsYXRlZEZvbnQgPT4gewogICAgICBmb250Q2FwYWJpbGl0eS5yZXNvbHZlKG5ldyBUcmFuc2xhdGVkRm9udCh7CiAgICAgICAgbG9hZGVkTmFtZTogZm9udC5sb2FkZWROYW1lLAogICAgICAgIGZvbnQ6IHRyYW5zbGF0ZWRGb250LAogICAgICAgIGRpY3Q6IGZvbnQsCiAgICAgICAgZXZhbHVhdG9yT3B0aW9uczogdGhpcy5vcHRpb25zCiAgICAgIH0pKTsKICAgIH0pLmNhdGNoKHJlYXNvbiA9PiB7CiAgICAgICgwLCBfdXRpbC53YXJuKShgbG9hZEZvbnQgLSB0cmFuc2xhdGVGb250IGZhaWxlZDogIiR7cmVhc29ufSIuYCk7CiAgICAgIGZvbnRDYXBhYmlsaXR5LnJlc29sdmUobmV3IFRyYW5zbGF0ZWRGb250KHsKICAgICAgICBsb2FkZWROYW1lOiBmb250LmxvYWRlZE5hbWUsCiAgICAgICAgZm9udDogbmV3IF9mb250cy5FcnJvckZvbnQocmVhc29uIGluc3RhbmNlb2YgRXJyb3IgPyByZWFzb24ubWVzc2FnZSA6IHJlYXNvbiksCiAgICAgICAgZGljdDogZm9udCwKICAgICAgICBldmFsdWF0b3JPcHRpb25zOiB0aGlzLm9wdGlvbnMKICAgICAgfSkpOwogICAgfSk7CiAgICByZXR1cm4gZm9udENhcGFiaWxpdHkucHJvbWlzZTsKICB9CiAgYnVpbGRQYXRoKG9wZXJhdG9yTGlzdCwgZm4sIGFyZ3MsIHBhcnNpbmdUZXh0ID0gZmFsc2UpIHsKICAgIGNvbnN0IGxhc3RJbmRleCA9IG9wZXJhdG9yTGlzdC5sZW5ndGggLSAxOwogICAgaWYgKCFhcmdzKSB7CiAgICAgIGFyZ3MgPSBbXTsKICAgIH0KICAgIGlmIChsYXN0SW5kZXggPCAwIHx8IG9wZXJhdG9yTGlzdC5mbkFycmF5W2xhc3RJbmRleF0gIT09IF91dGlsLk9QUy5jb25zdHJ1Y3RQYXRoKSB7CiAgICAgIGlmIChwYXJzaW5nVGV4dCkgewogICAgICAgICgwLCBfdXRpbC53YXJuKShgRW5jb3VudGVyZWQgcGF0aCBvcGVyYXRvciAiJHtmbn0iIGluc2lkZSBvZiBhIHRleHQgb2JqZWN0LmApOwogICAgICAgIG9wZXJhdG9yTGlzdC5hZGRPcChfdXRpbC5PUFMuc2F2ZSwgbnVsbCk7CiAgICAgIH0KICAgICAgbGV0IG1pbk1heDsKICAgICAgc3dpdGNoIChmbikgewogICAgICAgIGNhc2UgX3V0aWwuT1BTLnJlY3RhbmdsZToKICAgICAgICAgIGNvbnN0IHggPSBhcmdzWzBdICsgYXJnc1syXTsKICAgICAgICAgIGNvbnN0IHkgPSBhcmdzWzFdICsgYXJnc1szXTsKICAgICAgICAgIG1pbk1heCA9IFtNYXRoLm1pbihhcmdzWzBdLCB4KSwgTWF0aC5tYXgoYXJnc1swXSwgeCksIE1hdGgubWluKGFyZ3NbMV0sIHkpLCBNYXRoLm1heChhcmdzWzFdLCB5KV07CiAgICAgICAgICBicmVhazsKICAgICAgICBjYXNlIF91dGlsLk9QUy5tb3ZlVG86CiAgICAgICAgY2FzZSBfdXRpbC5PUFMubGluZVRvOgogICAgICAgICAgbWluTWF4ID0gW2FyZ3NbMF0sIGFyZ3NbMF0sIGFyZ3NbMV0sIGFyZ3NbMV1dOwogICAgICAgICAgYnJlYWs7CiAgICAgICAgZGVmYXVsdDoKICAgICAgICAgIG1pbk1heCA9IFtJbmZpbml0eSwgLUluZmluaXR5LCBJbmZpbml0eSwgLUluZmluaXR5XTsKICAgICAgICAgIGJyZWFrOwogICAgICB9CiAgICAgIG9wZXJhdG9yTGlzdC5hZGRPcChfdXRpbC5PUFMuY29uc3RydWN0UGF0aCwgW1tmbl0sIGFyZ3MsIG1pbk1heF0pOwogICAgICBpZiAocGFyc2luZ1RleHQpIHsKICAgICAgICBvcGVyYXRvckxpc3QuYWRkT3AoX3V0aWwuT1BTLnJlc3RvcmUsIG51bGwpOwogICAgICB9CiAgICB9IGVsc2UgewogICAgICBjb25zdCBvcEFyZ3MgPSBvcGVyYXRvckxpc3QuYXJnc0FycmF5W2xhc3RJbmRleF07CiAgICAgIG9wQXJnc1swXS5wdXNoKGZuKTsKICAgICAgb3BBcmdzWzFdLnB1c2goLi4uYXJncyk7CiAgICAgIGNvbnN0IG1pbk1heCA9IG9wQXJnc1syXTsKICAgICAgc3dpdGNoIChmbikgewogICAgICAgIGNhc2UgX3V0aWwuT1BTLnJlY3RhbmdsZToKICAgICAgICAgIGNvbnN0IHggPSBhcmdzWzBdICsgYXJnc1syXTsKICAgICAgICAgIGNvbnN0IHkgPSBhcmdzWzFdICsgYXJnc1szXTsKICAgICAgICAgIG1pbk1heFswXSA9IE1hdGgubWluKG1pbk1heFswXSwgYXJnc1swXSwgeCk7CiAgICAgICAgICBtaW5NYXhbMV0gPSBNYXRoLm1heChtaW5NYXhbMV0sIGFyZ3NbMF0sIHgpOwogICAgICAgICAgbWluTWF4WzJdID0gTWF0aC5taW4obWluTWF4WzJdLCBhcmdzWzFdLCB5KTsKICAgICAgICAgIG1pbk1heFszXSA9IE1hdGgubWF4KG1pbk1heFszXSwgYXJnc1sxXSwgeSk7CiAgICAgICAgICBicmVhazsKICAgICAgICBjYXNlIF91dGlsLk9QUy5tb3ZlVG86CiAgICAgICAgY2FzZSBfdXRpbC5PUFMubGluZVRvOgogICAgICAgICAgbWluTWF4WzBdID0gTWF0aC5taW4obWluTWF4WzBdLCBhcmdzWzBdKTsKICAgICAgICAgIG1pbk1heFsxXSA9IE1hdGgubWF4KG1pbk1heFsxXSwgYXJnc1swXSk7CiAgICAgICAgICBtaW5NYXhbMl0gPSBNYXRoLm1pbihtaW5NYXhbMl0sIGFyZ3NbMV0pOwogICAgICAgICAgbWluTWF4WzNdID0gTWF0aC5tYXgobWluTWF4WzNdLCBhcmdzWzFdKTsKICAgICAgICAgIGJyZWFrOwogICAgICB9CiAgICB9CiAgfQogIHBhcnNlQ29sb3JTcGFjZSh7CiAgICBjcywKICAgIHJlc291cmNlcywKICAgIGxvY2FsQ29sb3JTcGFjZUNhY2hlCiAgfSkgewogICAgcmV0dXJuIF9jb2xvcnNwYWNlLkNvbG9yU3BhY2UucGFyc2VBc3luYyh7CiAgICAgIGNzLAogICAgICB4cmVmOiB0aGlzLnhyZWYsCiAgICAgIHJlc291cmNlcywKICAgICAgcGRmRnVuY3Rpb25GYWN0b3J5OiB0aGlzLl9wZGZGdW5jdGlvbkZhY3RvcnksCiAgICAgIGxvY2FsQ29sb3JTcGFjZUNhY2hlCiAgICB9KS5jYXRjaChyZWFzb24gPT4gewogICAgICBpZiAocmVhc29uIGluc3RhbmNlb2YgX3V0aWwuQWJvcnRFeGNlcHRpb24pIHsKICAgICAgICByZXR1cm4gbnVsbDsKICAgICAgfQogICAgICBpZiAodGhpcy5vcHRpb25zLmlnbm9yZUVycm9ycykgewogICAgICAgICgwLCBfdXRpbC53YXJuKShgcGFyc2VDb2xvclNwYWNlIC0gaWdub3JpbmcgQ29sb3JTcGFjZTogIiR7cmVhc29ufSIuYCk7CiAgICAgICAgcmV0dXJuIG51bGw7CiAgICAgIH0KICAgICAgdGhyb3cgcmVhc29uOwogICAgfSk7CiAgfQogIHBhcnNlU2hhZGluZyh7CiAgICBzaGFkaW5nLAogICAgcmVzb3VyY2VzLAogICAgbG9jYWxDb2xvclNwYWNlQ2FjaGUsCiAgICBsb2NhbFNoYWRpbmdQYXR0ZXJuQ2FjaGUKICB9KSB7CiAgICBsZXQgaWQgPSBsb2NhbFNoYWRpbmdQYXR0ZXJuQ2FjaGUuZ2V0KHNoYWRpbmcpOwogICAgaWYgKCFpZCkgewogICAgICB2YXIgc2hhZGluZ0ZpbGwgPSBfcGF0dGVybi5QYXR0ZXJuLnBhcnNlU2hhZGluZyhzaGFkaW5nLCB0aGlzLnhyZWYsIHJlc291cmNlcywgdGhpcy5fcGRmRnVuY3Rpb25GYWN0b3J5LCBsb2NhbENvbG9yU3BhY2VDYWNoZSk7CiAgICAgIGNvbnN0IHBhdHRlcm5JUiA9IHNoYWRpbmdGaWxsLmdldElSKCk7CiAgICAgIGlkID0gYHBhdHRlcm5fJHt0aGlzLmlkRmFjdG9yeS5jcmVhdGVPYmpJZCgpfWA7CiAgICAgIGlmICh0aGlzLnBhcnNpbmdUeXBlM0ZvbnQpIHsKICAgICAgICBpZCA9IGAke3RoaXMuaWRGYWN0b3J5LmdldERvY0lkKCl9X3R5cGUzXyR7aWR9YDsKICAgICAgfQogICAgICBsb2NhbFNoYWRpbmdQYXR0ZXJuQ2FjaGUuc2V0KHNoYWRpbmcsIGlkKTsKICAgICAgaWYgKHRoaXMucGFyc2luZ1R5cGUzRm9udCkgewogICAgICAgIHRoaXMuaGFuZGxlci5zZW5kKCJjb21tb25vYmoiLCBbaWQsICJQYXR0ZXJuIiwgcGF0dGVybklSXSk7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgdGhpcy5oYW5kbGVyLnNlbmQoIm9iaiIsIFtpZCwgdGhpcy5wYWdlSW5kZXgsICJQYXR0ZXJuIiwgcGF0dGVybklSXSk7CiAgICAgIH0KICAgIH0KICAgIHJldHVybiBpZDsKICB9CiAgaGFuZGxlQ29sb3JOKG9wZXJhdG9yTGlzdCwgZm4sIGFyZ3MsIGNzLCBwYXR0ZXJucywgcmVzb3VyY2VzLCB0YXNrLCBsb2NhbENvbG9yU3BhY2VDYWNoZSwgbG9jYWxUaWxpbmdQYXR0ZXJuQ2FjaGUsIGxvY2FsU2hhZGluZ1BhdHRlcm5DYWNoZSkgewogICAgY29uc3QgcGF0dGVybk5hbWUgPSBhcmdzLnBvcCgpOwogICAgaWYgKHBhdHRlcm5OYW1lIGluc3RhbmNlb2YgX3ByaW1pdGl2ZXMuTmFtZSkgewogICAgICBjb25zdCByYXdQYXR0ZXJuID0gcGF0dGVybnMuZ2V0UmF3KHBhdHRlcm5OYW1lLm5hbWUpOwogICAgICBjb25zdCBsb2NhbFRpbGluZ1BhdHRlcm4gPSByYXdQYXR0ZXJuIGluc3RhbmNlb2YgX3ByaW1pdGl2ZXMuUmVmICYmIGxvY2FsVGlsaW5nUGF0dGVybkNhY2hlLmdldEJ5UmVmKHJhd1BhdHRlcm4pOwogICAgICBpZiAobG9jYWxUaWxpbmdQYXR0ZXJuKSB7CiAgICAgICAgdHJ5IHsKICAgICAgICAgIGNvbnN0IGNvbG9yID0gY3MuYmFzZSA/IGNzLmJhc2UuZ2V0UmdiKGFyZ3MsIDApIDogbnVsbDsKICAgICAgICAgIGNvbnN0IHRpbGluZ1BhdHRlcm5JUiA9ICgwLCBfcGF0dGVybi5nZXRUaWxpbmdQYXR0ZXJuSVIpKGxvY2FsVGlsaW5nUGF0dGVybi5vcGVyYXRvckxpc3RJUiwgbG9jYWxUaWxpbmdQYXR0ZXJuLmRpY3QsIGNvbG9yKTsKICAgICAgICAgIG9wZXJhdG9yTGlzdC5hZGRPcChmbiwgdGlsaW5nUGF0dGVybklSKTsKICAgICAgICAgIHJldHVybiB1bmRlZmluZWQ7CiAgICAgICAgfSBjYXRjaCB7fQogICAgICB9CiAgICAgIGNvbnN0IHBhdHRlcm4gPSB0aGlzLnhyZWYuZmV0Y2hJZlJlZihyYXdQYXR0ZXJuKTsKICAgICAgaWYgKHBhdHRlcm4pIHsKICAgICAgICBjb25zdCBkaWN0ID0gcGF0dGVybiBpbnN0YW5jZW9mIF9iYXNlX3N0cmVhbS5CYXNlU3RyZWFtID8gcGF0dGVybi5kaWN0IDogcGF0dGVybjsKICAgICAgICBjb25zdCB0eXBlTnVtID0gZGljdC5nZXQoIlBhdHRlcm5UeXBlIik7CiAgICAgICAgaWYgKHR5cGVOdW0gPT09IFBhdHRlcm5UeXBlLlRJTElORykgewogICAgICAgICAgY29uc3QgY29sb3IgPSBjcy5iYXNlID8gY3MuYmFzZS5nZXRSZ2IoYXJncywgMCkgOiBudWxsOwogICAgICAgICAgcmV0dXJuIHRoaXMuaGFuZGxlVGlsaW5nVHlwZShmbiwgY29sb3IsIHJlc291cmNlcywgcGF0dGVybiwgZGljdCwgb3BlcmF0b3JMaXN0LCB0YXNrLCBsb2NhbFRpbGluZ1BhdHRlcm5DYWNoZSk7CiAgICAgICAgfSBlbHNlIGlmICh0eXBlTnVtID09PSBQYXR0ZXJuVHlwZS5TSEFESU5HKSB7CiAgICAgICAgICBjb25zdCBzaGFkaW5nID0gZGljdC5nZXQoIlNoYWRpbmciKTsKICAgICAgICAgIGNvbnN0IG1hdHJpeCA9IGRpY3QuZ2V0QXJyYXkoIk1hdHJpeCIpOwogICAgICAgICAgY29uc3Qgb2JqSWQgPSB0aGlzLnBhcnNlU2hhZGluZyh7CiAgICAgICAgICAgIHNoYWRpbmcsCiAgICAgICAgICAgIHJlc291cmNlcywKICAgICAgICAgICAgbG9jYWxDb2xvclNwYWNlQ2FjaGUsCiAgICAgICAgICAgIGxvY2FsU2hhZGluZ1BhdHRlcm5DYWNoZQogICAgICAgICAgfSk7CiAgICAgICAgICBvcGVyYXRvckxpc3QuYWRkT3AoZm4sIFsiU2hhZGluZyIsIG9iaklkLCBtYXRyaXhdKTsKICAgICAgICAgIHJldHVybiB1bmRlZmluZWQ7CiAgICAgICAgfQogICAgICAgIHRocm93IG5ldyBfdXRpbC5Gb3JtYXRFcnJvcihgVW5rbm93biBQYXR0ZXJuVHlwZTogJHt0eXBlTnVtfWApOwogICAgICB9CiAgICB9CiAgICB0aHJvdyBuZXcgX3V0aWwuRm9ybWF0RXJyb3IoYFVua25vd24gUGF0dGVybk5hbWU6ICR7cGF0dGVybk5hbWV9YCk7CiAgfQogIF9wYXJzZVZpc2liaWxpdHlFeHByZXNzaW9uKGFycmF5LCBuZXN0aW5nQ291bnRlciwgY3VycmVudFJlc3VsdCkgewogICAgY29uc3QgTUFYX05FU1RJTkcgPSAxMDsKICAgIGlmICgrK25lc3RpbmdDb3VudGVyID4gTUFYX05FU1RJTkcpIHsKICAgICAgKDAsIF91dGlsLndhcm4pKCJWaXNpYmlsaXR5IGV4cHJlc3Npb24gaXMgdG9vIGRlZXBseSBuZXN0ZWQiKTsKICAgICAgcmV0dXJuOwogICAgfQogICAgY29uc3QgbGVuZ3RoID0gYXJyYXkubGVuZ3RoOwogICAgY29uc3Qgb3BlcmF0b3IgPSB0aGlzLnhyZWYuZmV0Y2hJZlJlZihhcnJheVswXSk7CiAgICBpZiAobGVuZ3RoIDwgMiB8fCAhKG9wZXJhdG9yIGluc3RhbmNlb2YgX3ByaW1pdGl2ZXMuTmFtZSkpIHsKICAgICAgKDAsIF91dGlsLndhcm4pKCJJbnZhbGlkIHZpc2liaWxpdHkgZXhwcmVzc2lvbiIpOwogICAgICByZXR1cm47CiAgICB9CiAgICBzd2l0Y2ggKG9wZXJhdG9yLm5hbWUpIHsKICAgICAgY2FzZSAiQW5kIjoKICAgICAgY2FzZSAiT3IiOgogICAgICBjYXNlICJOb3QiOgogICAgICAgIGN1cnJlbnRSZXN1bHQucHVzaChvcGVyYXRvci5uYW1lKTsKICAgICAgICBicmVhazsKICAgICAgZGVmYXVsdDoKICAgICAgICAoMCwgX3V0aWwud2FybikoYEludmFsaWQgb3BlcmF0b3IgJHtvcGVyYXRvci5uYW1lfSBpbiB2aXNpYmlsaXR5IGV4cHJlc3Npb25gKTsKICAgICAgICByZXR1cm47CiAgICB9CiAgICBmb3IgKGxldCBpID0gMTsgaSA8IGxlbmd0aDsgaSsrKSB7CiAgICAgIGNvbnN0IHJhdyA9IGFycmF5W2ldOwogICAgICBjb25zdCBvYmplY3QgPSB0aGlzLnhyZWYuZmV0Y2hJZlJlZihyYXcpOwogICAgICBpZiAoQXJyYXkuaXNBcnJheShvYmplY3QpKSB7CiAgICAgICAgY29uc3QgbmVzdGVkUmVzdWx0ID0gW107CiAgICAgICAgY3VycmVudFJlc3VsdC5wdXNoKG5lc3RlZFJlc3VsdCk7CiAgICAgICAgdGhpcy5fcGFyc2VWaXNpYmlsaXR5RXhwcmVzc2lvbihvYmplY3QsIG5lc3RpbmdDb3VudGVyLCBuZXN0ZWRSZXN1bHQpOwogICAgICB9IGVsc2UgaWYgKHJhdyBpbnN0YW5jZW9mIF9wcmltaXRpdmVzLlJlZikgewogICAgICAgIGN1cnJlbnRSZXN1bHQucHVzaChyYXcudG9TdHJpbmcoKSk7CiAgICAgIH0KICAgIH0KICB9CiAgYXN5bmMgcGFyc2VNYXJrZWRDb250ZW50UHJvcHMoY29udGVudFByb3BlcnRpZXMsIHJlc291cmNlcykgewogICAgbGV0IG9wdGlvbmFsQ29udGVudDsKICAgIGlmIChjb250ZW50UHJvcGVydGllcyBpbnN0YW5jZW9mIF9wcmltaXRpdmVzLk5hbWUpIHsKICAgICAgY29uc3QgcHJvcGVydGllcyA9IHJlc291cmNlcy5nZXQoIlByb3BlcnRpZXMiKTsKICAgICAgb3B0aW9uYWxDb250ZW50ID0gcHJvcGVydGllcy5nZXQoY29udGVudFByb3BlcnRpZXMubmFtZSk7CiAgICB9IGVsc2UgaWYgKGNvbnRlbnRQcm9wZXJ0aWVzIGluc3RhbmNlb2YgX3ByaW1pdGl2ZXMuRGljdCkgewogICAgICBvcHRpb25hbENvbnRlbnQgPSBjb250ZW50UHJvcGVydGllczsKICAgIH0gZWxzZSB7CiAgICAgIHRocm93IG5ldyBfdXRpbC5Gb3JtYXRFcnJvcigiT3B0aW9uYWwgY29udGVudCBwcm9wZXJ0aWVzIG1hbGZvcm1lZC4iKTsKICAgIH0KICAgIGNvbnN0IG9wdGlvbmFsQ29udGVudFR5cGUgPSBvcHRpb25hbENvbnRlbnQuZ2V0KCJUeXBlIik/Lm5hbWU7CiAgICBpZiAob3B0aW9uYWxDb250ZW50VHlwZSA9PT0gIk9DRyIpIHsKICAgICAgcmV0dXJuIHsKICAgICAgICB0eXBlOiBvcHRpb25hbENvbnRlbnRUeXBlLAogICAgICAgIGlkOiBvcHRpb25hbENvbnRlbnQub2JqSWQKICAgICAgfTsKICAgIH0gZWxzZSBpZiAob3B0aW9uYWxDb250ZW50VHlwZSA9PT0gIk9DTUQiKSB7CiAgICAgIGNvbnN0IGV4cHJlc3Npb24gPSBvcHRpb25hbENvbnRlbnQuZ2V0KCJWRSIpOwogICAgICBpZiAoQXJyYXkuaXNBcnJheShleHByZXNzaW9uKSkgewogICAgICAgIGNvbnN0IHJlc3VsdCA9IFtdOwogICAgICAgIHRoaXMuX3BhcnNlVmlzaWJpbGl0eUV4cHJlc3Npb24oZXhwcmVzc2lvbiwgMCwgcmVzdWx0KTsKICAgICAgICBpZiAocmVzdWx0Lmxlbmd0aCA+IDApIHsKICAgICAgICAgIHJldHVybiB7CiAgICAgICAgICAgIHR5cGU6ICJPQ01EIiwKICAgICAgICAgICAgZXhwcmVzc2lvbjogcmVzdWx0CiAgICAgICAgICB9OwogICAgICAgIH0KICAgICAgfQogICAgICBjb25zdCBvcHRpb25hbENvbnRlbnRHcm91cHMgPSBvcHRpb25hbENvbnRlbnQuZ2V0KCJPQ0dzIik7CiAgICAgIGlmIChBcnJheS5pc0FycmF5KG9wdGlvbmFsQ29udGVudEdyb3VwcykgfHwgb3B0aW9uYWxDb250ZW50R3JvdXBzIGluc3RhbmNlb2YgX3ByaW1pdGl2ZXMuRGljdCkgewogICAgICAgIGNvbnN0IGdyb3VwSWRzID0gW107CiAgICAgICAgaWYgKEFycmF5LmlzQXJyYXkob3B0aW9uYWxDb250ZW50R3JvdXBzKSkgewogICAgICAgICAgZm9yIChjb25zdCBvY2cgb2Ygb3B0aW9uYWxDb250ZW50R3JvdXBzKSB7CiAgICAgICAgICAgIGdyb3VwSWRzLnB1c2gob2NnLnRvU3RyaW5nKCkpOwogICAgICAgICAgfQogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICBncm91cElkcy5wdXNoKG9wdGlvbmFsQ29udGVudEdyb3Vwcy5vYmpJZCk7CiAgICAgICAgfQogICAgICAgIHJldHVybiB7CiAgICAgICAgICB0eXBlOiBvcHRpb25hbENvbnRlbnRUeXBlLAogICAgICAgICAgaWRzOiBncm91cElkcywKICAgICAgICAgIHBvbGljeTogb3B0aW9uYWxDb250ZW50LmdldCgiUCIpIGluc3RhbmNlb2YgX3ByaW1pdGl2ZXMuTmFtZSA/IG9wdGlvbmFsQ29udGVudC5nZXQoIlAiKS5uYW1lIDogbnVsbCwKICAgICAgICAgIGV4cHJlc3Npb246IG51bGwKICAgICAgICB9OwogICAgICB9IGVsc2UgaWYgKG9wdGlvbmFsQ29udGVudEdyb3VwcyBpbnN0YW5jZW9mIF9wcmltaXRpdmVzLlJlZikgewogICAgICAgIHJldHVybiB7CiAgICAgICAgICB0eXBlOiBvcHRpb25hbENvbnRlbnRUeXBlLAogICAgICAgICAgaWQ6IG9wdGlvbmFsQ29udGVudEdyb3Vwcy50b1N0cmluZygpCiAgICAgICAgfTsKICAgICAgfQogICAgfQogICAgcmV0dXJuIG51bGw7CiAgfQogIGdldE9wZXJhdG9yTGlzdCh7CiAgICBzdHJlYW0sCiAgICB0YXNrLAogICAgcmVzb3VyY2VzLAogICAgb3BlcmF0b3JMaXN0LAogICAgaW5pdGlhbFN0YXRlID0gbnVsbCwKICAgIGZhbGxiYWNrRm9udERpY3QgPSBudWxsCiAgfSkgewogICAgcmVzb3VyY2VzIHx8PSBfcHJpbWl0aXZlcy5EaWN0LmVtcHR5OwogICAgaW5pdGlhbFN0YXRlIHx8PSBuZXcgRXZhbFN0YXRlKCk7CiAgICBpZiAoIW9wZXJhdG9yTGlzdCkgewogICAgICB0aHJvdyBuZXcgRXJyb3IoJ2dldE9wZXJhdG9yTGlzdDogbWlzc2luZyAib3BlcmF0b3JMaXN0IiBwYXJhbWV0ZXInKTsKICAgIH0KICAgIGNvbnN0IHNlbGYgPSB0aGlzOwogICAgY29uc3QgeHJlZiA9IHRoaXMueHJlZjsKICAgIGxldCBwYXJzaW5nVGV4dCA9IGZhbHNlOwogICAgY29uc3QgbG9jYWxJbWFnZUNhY2hlID0gbmV3IF9pbWFnZV91dGlscy5Mb2NhbEltYWdlQ2FjaGUoKTsKICAgIGNvbnN0IGxvY2FsQ29sb3JTcGFjZUNhY2hlID0gbmV3IF9pbWFnZV91dGlscy5Mb2NhbENvbG9yU3BhY2VDYWNoZSgpOwogICAgY29uc3QgbG9jYWxHU3RhdGVDYWNoZSA9IG5ldyBfaW1hZ2VfdXRpbHMuTG9jYWxHU3RhdGVDYWNoZSgpOwogICAgY29uc3QgbG9jYWxUaWxpbmdQYXR0ZXJuQ2FjaGUgPSBuZXcgX2ltYWdlX3V0aWxzLkxvY2FsVGlsaW5nUGF0dGVybkNhY2hlKCk7CiAgICBjb25zdCBsb2NhbFNoYWRpbmdQYXR0ZXJuQ2FjaGUgPSBuZXcgTWFwKCk7CiAgICBjb25zdCB4b2JqcyA9IHJlc291cmNlcy5nZXQoIlhPYmplY3QiKSB8fCBfcHJpbWl0aXZlcy5EaWN0LmVtcHR5OwogICAgY29uc3QgcGF0dGVybnMgPSByZXNvdXJjZXMuZ2V0KCJQYXR0ZXJuIikgfHwgX3ByaW1pdGl2ZXMuRGljdC5lbXB0eTsKICAgIGNvbnN0IHN0YXRlTWFuYWdlciA9IG5ldyBTdGF0ZU1hbmFnZXIoaW5pdGlhbFN0YXRlKTsKICAgIGNvbnN0IHByZXByb2Nlc3NvciA9IG5ldyBFdmFsdWF0b3JQcmVwcm9jZXNzb3Ioc3RyZWFtLCB4cmVmLCBzdGF0ZU1hbmFnZXIpOwogICAgY29uc3QgdGltZVNsb3RNYW5hZ2VyID0gbmV3IFRpbWVTbG90TWFuYWdlcigpOwogICAgZnVuY3Rpb24gY2xvc2VQZW5kaW5nUmVzdG9yZU9QUyhhcmd1bWVudCkgewogICAgICBmb3IgKGxldCBpID0gMCwgaWkgPSBwcmVwcm9jZXNzb3Iuc2F2ZWRTdGF0ZXNEZXB0aDsgaSA8IGlpOyBpKyspIHsKICAgICAgICBvcGVyYXRvckxpc3QuYWRkT3AoX3V0aWwuT1BTLnJlc3RvcmUsIFtdKTsKICAgICAgfQogICAgfQogICAgcmV0dXJuIG5ldyBQcm9taXNlKGZ1bmN0aW9uIHByb21pc2VCb2R5KHJlc29sdmUsIHJlamVjdCkgewogICAgICBjb25zdCBuZXh0ID0gZnVuY3Rpb24gKHByb21pc2UpIHsKICAgICAgICBQcm9taXNlLmFsbChbcHJvbWlzZSwgb3BlcmF0b3JMaXN0LnJlYWR5XSkudGhlbihmdW5jdGlvbiAoKSB7CiAgICAgICAgICB0cnkgewogICAgICAgICAgICBwcm9taXNlQm9keShyZXNvbHZlLCByZWplY3QpOwogICAgICAgICAgfSBjYXRjaCAoZXgpIHsKICAgICAgICAgICAgcmVqZWN0KGV4KTsKICAgICAgICAgIH0KICAgICAgICB9LCByZWplY3QpOwogICAgICB9OwogICAgICB0YXNrLmVuc3VyZU5vdFRlcm1pbmF0ZWQoKTsKICAgICAgdGltZVNsb3RNYW5hZ2VyLnJlc2V0KCk7CiAgICAgIGNvbnN0IG9wZXJhdGlvbiA9IHt9OwogICAgICBsZXQgc3RvcCwgaSwgaWksIGNzLCBuYW1lLCBpc1ZhbGlkTmFtZTsKICAgICAgd2hpbGUgKCEoc3RvcCA9IHRpbWVTbG90TWFuYWdlci5jaGVjaygpKSkgewogICAgICAgIG9wZXJhdGlvbi5hcmdzID0gbnVsbDsKICAgICAgICBpZiAoIXByZXByb2Nlc3Nvci5yZWFkKG9wZXJhdGlvbikpIHsKICAgICAgICAgIGJyZWFrOwogICAgICAgIH0KICAgICAgICBsZXQgYXJncyA9IG9wZXJhdGlvbi5hcmdzOwogICAgICAgIGxldCBmbiA9IG9wZXJhdGlvbi5mbjsKICAgICAgICBzd2l0Y2ggKGZuIHwgMCkgewogICAgICAgICAgY2FzZSBfdXRpbC5PUFMucGFpbnRYT2JqZWN0OgogICAgICAgICAgICBpc1ZhbGlkTmFtZSA9IGFyZ3NbMF0gaW5zdGFuY2VvZiBfcHJpbWl0aXZlcy5OYW1lOwogICAgICAgICAgICBuYW1lID0gYXJnc1swXS5uYW1lOwogICAgICAgICAgICBpZiAoaXNWYWxpZE5hbWUpIHsKICAgICAgICAgICAgICBjb25zdCBsb2NhbEltYWdlID0gbG9jYWxJbWFnZUNhY2hlLmdldEJ5TmFtZShuYW1lKTsKICAgICAgICAgICAgICBpZiAobG9jYWxJbWFnZSkgewogICAgICAgICAgICAgICAgb3BlcmF0b3JMaXN0LmFkZEltYWdlT3BzKGxvY2FsSW1hZ2UuZm4sIGxvY2FsSW1hZ2UuYXJncywgbG9jYWxJbWFnZS5vcHRpb25hbENvbnRlbnQpOwogICAgICAgICAgICAgICAgaW5jcmVtZW50Q2FjaGVkSW1hZ2VNYXNrQ291bnQobG9jYWxJbWFnZSk7CiAgICAgICAgICAgICAgICBhcmdzID0gbnVsbDsKICAgICAgICAgICAgICAgIGNvbnRpbnVlOwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgICAgICBuZXh0KG5ldyBQcm9taXNlKGZ1bmN0aW9uIChyZXNvbHZlWE9iamVjdCwgcmVqZWN0WE9iamVjdCkgewogICAgICAgICAgICAgIGlmICghaXNWYWxpZE5hbWUpIHsKICAgICAgICAgICAgICAgIHRocm93IG5ldyBfdXRpbC5Gb3JtYXRFcnJvcigiWE9iamVjdCBtdXN0IGJlIHJlZmVycmVkIHRvIGJ5IG5hbWUuIik7CiAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIGxldCB4b2JqID0geG9ianMuZ2V0UmF3KG5hbWUpOwogICAgICAgICAgICAgIGlmICh4b2JqIGluc3RhbmNlb2YgX3ByaW1pdGl2ZXMuUmVmKSB7CiAgICAgICAgICAgICAgICBjb25zdCBsb2NhbEltYWdlID0gbG9jYWxJbWFnZUNhY2hlLmdldEJ5UmVmKHhvYmopIHx8IHNlbGYuX3JlZ2lvbmFsSW1hZ2VDYWNoZS5nZXRCeVJlZih4b2JqKTsKICAgICAgICAgICAgICAgIGlmIChsb2NhbEltYWdlKSB7CiAgICAgICAgICAgICAgICAgIG9wZXJhdG9yTGlzdC5hZGRJbWFnZU9wcyhsb2NhbEltYWdlLmZuLCBsb2NhbEltYWdlLmFyZ3MsIGxvY2FsSW1hZ2Uub3B0aW9uYWxDb250ZW50KTsKICAgICAgICAgICAgICAgICAgaW5jcmVtZW50Q2FjaGVkSW1hZ2VNYXNrQ291bnQobG9jYWxJbWFnZSk7CiAgICAgICAgICAgICAgICAgIHJlc29sdmVYT2JqZWN0KCk7CiAgICAgICAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIGNvbnN0IGdsb2JhbEltYWdlID0gc2VsZi5nbG9iYWxJbWFnZUNhY2hlLmdldERhdGEoeG9iaiwgc2VsZi5wYWdlSW5kZXgpOwogICAgICAgICAgICAgICAgaWYgKGdsb2JhbEltYWdlKSB7CiAgICAgICAgICAgICAgICAgIG9wZXJhdG9yTGlzdC5hZGREZXBlbmRlbmN5KGdsb2JhbEltYWdlLm9iaklkKTsKICAgICAgICAgICAgICAgICAgb3BlcmF0b3JMaXN0LmFkZEltYWdlT3BzKGdsb2JhbEltYWdlLmZuLCBnbG9iYWxJbWFnZS5hcmdzLCBnbG9iYWxJbWFnZS5vcHRpb25hbENvbnRlbnQpOwogICAgICAgICAgICAgICAgICByZXNvbHZlWE9iamVjdCgpOwogICAgICAgICAgICAgICAgICByZXR1cm47CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB4b2JqID0geHJlZi5mZXRjaCh4b2JqKTsKICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgaWYgKCEoeG9iaiBpbnN0YW5jZW9mIF9iYXNlX3N0cmVhbS5CYXNlU3RyZWFtKSkgewogICAgICAgICAgICAgICAgdGhyb3cgbmV3IF91dGlsLkZvcm1hdEVycm9yKCJYT2JqZWN0IHNob3VsZCBiZSBhIHN0cmVhbSIpOwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgICBjb25zdCB0eXBlID0geG9iai5kaWN0LmdldCgiU3VidHlwZSIpOwogICAgICAgICAgICAgIGlmICghKHR5cGUgaW5zdGFuY2VvZiBfcHJpbWl0aXZlcy5OYW1lKSkgewogICAgICAgICAgICAgICAgdGhyb3cgbmV3IF91dGlsLkZvcm1hdEVycm9yKCJYT2JqZWN0IHNob3VsZCBoYXZlIGEgTmFtZSBzdWJ0eXBlIik7CiAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIGlmICh0eXBlLm5hbWUgPT09ICJGb3JtIikgewogICAgICAgICAgICAgICAgc3RhdGVNYW5hZ2VyLnNhdmUoKTsKICAgICAgICAgICAgICAgIHNlbGYuYnVpbGRGb3JtWE9iamVjdChyZXNvdXJjZXMsIHhvYmosIG51bGwsIG9wZXJhdG9yTGlzdCwgdGFzaywgc3RhdGVNYW5hZ2VyLnN0YXRlLmNsb25lKCksIGxvY2FsQ29sb3JTcGFjZUNhY2hlKS50aGVuKGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgICAgICAgc3RhdGVNYW5hZ2VyLnJlc3RvcmUoKTsKICAgICAgICAgICAgICAgICAgcmVzb2x2ZVhPYmplY3QoKTsKICAgICAgICAgICAgICAgIH0sIHJlamVjdFhPYmplY3QpOwogICAgICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgICAgIH0gZWxzZSBpZiAodHlwZS5uYW1lID09PSAiSW1hZ2UiKSB7CiAgICAgICAgICAgICAgICBzZWxmLmJ1aWxkUGFpbnRJbWFnZVhPYmplY3QoewogICAgICAgICAgICAgICAgICByZXNvdXJjZXMsCiAgICAgICAgICAgICAgICAgIGltYWdlOiB4b2JqLAogICAgICAgICAgICAgICAgICBvcGVyYXRvckxpc3QsCiAgICAgICAgICAgICAgICAgIGNhY2hlS2V5OiBuYW1lLAogICAgICAgICAgICAgICAgICBsb2NhbEltYWdlQ2FjaGUsCiAgICAgICAgICAgICAgICAgIGxvY2FsQ29sb3JTcGFjZUNhY2hlCiAgICAgICAgICAgICAgICB9KS50aGVuKHJlc29sdmVYT2JqZWN0LCByZWplY3RYT2JqZWN0KTsKICAgICAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgICAgICB9IGVsc2UgaWYgKHR5cGUubmFtZSA9PT0gIlBTIikgewogICAgICAgICAgICAgICAgKDAsIF91dGlsLmluZm8pKCJJZ25vcmVkIFhPYmplY3Qgc3VidHlwZSBQUyIpOwogICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICB0aHJvdyBuZXcgX3V0aWwuRm9ybWF0RXJyb3IoYFVuaGFuZGxlZCBYT2JqZWN0IHN1YnR5cGUgJHt0eXBlLm5hbWV9YCk7CiAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIHJlc29sdmVYT2JqZWN0KCk7CiAgICAgICAgICAgIH0pLmNhdGNoKGZ1bmN0aW9uIChyZWFzb24pIHsKICAgICAgICAgICAgICBpZiAocmVhc29uIGluc3RhbmNlb2YgX3V0aWwuQWJvcnRFeGNlcHRpb24pIHsKICAgICAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgaWYgKHNlbGYub3B0aW9ucy5pZ25vcmVFcnJvcnMpIHsKICAgICAgICAgICAgICAgICgwLCBfdXRpbC53YXJuKShgZ2V0T3BlcmF0b3JMaXN0IC0gaWdub3JpbmcgWE9iamVjdDogIiR7cmVhc29ufSIuYCk7CiAgICAgICAgICAgICAgICByZXR1cm47CiAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIHRocm93IHJlYXNvbjsKICAgICAgICAgICAgfSkpOwogICAgICAgICAgICByZXR1cm47CiAgICAgICAgICBjYXNlIF91dGlsLk9QUy5zZXRGb250OgogICAgICAgICAgICB2YXIgZm9udFNpemUgPSBhcmdzWzFdOwogICAgICAgICAgICBuZXh0KHNlbGYuaGFuZGxlU2V0Rm9udChyZXNvdXJjZXMsIGFyZ3MsIG51bGwsIG9wZXJhdG9yTGlzdCwgdGFzaywgc3RhdGVNYW5hZ2VyLnN0YXRlLCBmYWxsYmFja0ZvbnREaWN0KS50aGVuKGZ1bmN0aW9uIChsb2FkZWROYW1lKSB7CiAgICAgICAgICAgICAgb3BlcmF0b3JMaXN0LmFkZERlcGVuZGVuY3kobG9hZGVkTmFtZSk7CiAgICAgICAgICAgICAgb3BlcmF0b3JMaXN0LmFkZE9wKF91dGlsLk9QUy5zZXRGb250LCBbbG9hZGVkTmFtZSwgZm9udFNpemVdKTsKICAgICAgICAgICAgfSkpOwogICAgICAgICAgICByZXR1cm47CiAgICAgICAgICBjYXNlIF91dGlsLk9QUy5iZWdpblRleHQ6CiAgICAgICAgICAgIHBhcnNpbmdUZXh0ID0gdHJ1ZTsKICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICBjYXNlIF91dGlsLk9QUy5lbmRUZXh0OgogICAgICAgICAgICBwYXJzaW5nVGV4dCA9IGZhbHNlOwogICAgICAgICAgICBicmVhazsKICAgICAgICAgIGNhc2UgX3V0aWwuT1BTLmVuZElubGluZUltYWdlOgogICAgICAgICAgICB2YXIgY2FjaGVLZXkgPSBhcmdzWzBdLmNhY2hlS2V5OwogICAgICAgICAgICBpZiAoY2FjaGVLZXkpIHsKICAgICAgICAgICAgICBjb25zdCBsb2NhbEltYWdlID0gbG9jYWxJbWFnZUNhY2hlLmdldEJ5TmFtZShjYWNoZUtleSk7CiAgICAgICAgICAgICAgaWYgKGxvY2FsSW1hZ2UpIHsKICAgICAgICAgICAgICAgIG9wZXJhdG9yTGlzdC5hZGRJbWFnZU9wcyhsb2NhbEltYWdlLmZuLCBsb2NhbEltYWdlLmFyZ3MsIGxvY2FsSW1hZ2Uub3B0aW9uYWxDb250ZW50KTsKICAgICAgICAgICAgICAgIGluY3JlbWVudENhY2hlZEltYWdlTWFza0NvdW50KGxvY2FsSW1hZ2UpOwogICAgICAgICAgICAgICAgYXJncyA9IG51bGw7CiAgICAgICAgICAgICAgICBjb250aW51ZTsKICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICAgICAgbmV4dChzZWxmLmJ1aWxkUGFpbnRJbWFnZVhPYmplY3QoewogICAgICAgICAgICAgIHJlc291cmNlcywKICAgICAgICAgICAgICBpbWFnZTogYXJnc1swXSwKICAgICAgICAgICAgICBpc0lubGluZTogdHJ1ZSwKICAgICAgICAgICAgICBvcGVyYXRvckxpc3QsCiAgICAgICAgICAgICAgY2FjaGVLZXksCiAgICAgICAgICAgICAgbG9jYWxJbWFnZUNhY2hlLAogICAgICAgICAgICAgIGxvY2FsQ29sb3JTcGFjZUNhY2hlCiAgICAgICAgICAgIH0pKTsKICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgY2FzZSBfdXRpbC5PUFMuc2hvd1RleHQ6CiAgICAgICAgICAgIGlmICghc3RhdGVNYW5hZ2VyLnN0YXRlLmZvbnQpIHsKICAgICAgICAgICAgICBzZWxmLmVuc3VyZVN0YXRlRm9udChzdGF0ZU1hbmFnZXIuc3RhdGUpOwogICAgICAgICAgICAgIGNvbnRpbnVlOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGFyZ3NbMF0gPSBzZWxmLmhhbmRsZVRleHQoYXJnc1swXSwgc3RhdGVNYW5hZ2VyLnN0YXRlKTsKICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICBjYXNlIF91dGlsLk9QUy5zaG93U3BhY2VkVGV4dDoKICAgICAgICAgICAgaWYgKCFzdGF0ZU1hbmFnZXIuc3RhdGUuZm9udCkgewogICAgICAgICAgICAgIHNlbGYuZW5zdXJlU3RhdGVGb250KHN0YXRlTWFuYWdlci5zdGF0ZSk7CiAgICAgICAgICAgICAgY29udGludWU7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgdmFyIGNvbWJpbmVkR2x5cGhzID0gW107CiAgICAgICAgICAgIHZhciBzdGF0ZSA9IHN0YXRlTWFuYWdlci5zdGF0ZTsKICAgICAgICAgICAgZm9yIChjb25zdCBhcnJJdGVtIG9mIGFyZ3NbMF0pIHsKICAgICAgICAgICAgICBpZiAodHlwZW9mIGFyckl0ZW0gPT09ICJzdHJpbmciKSB7CiAgICAgICAgICAgICAgICBjb21iaW5lZEdseXBocy5wdXNoKC4uLnNlbGYuaGFuZGxlVGV4dChhcnJJdGVtLCBzdGF0ZSkpOwogICAgICAgICAgICAgIH0gZWxzZSBpZiAodHlwZW9mIGFyckl0ZW0gPT09ICJudW1iZXIiKSB7CiAgICAgICAgICAgICAgICBjb21iaW5lZEdseXBocy5wdXNoKGFyckl0ZW0pOwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgICAgICBhcmdzWzBdID0gY29tYmluZWRHbHlwaHM7CiAgICAgICAgICAgIGZuID0gX3V0aWwuT1BTLnNob3dUZXh0OwogICAgICAgICAgICBicmVhazsKICAgICAgICAgIGNhc2UgX3V0aWwuT1BTLm5leHRMaW5lU2hvd1RleHQ6CiAgICAgICAgICAgIGlmICghc3RhdGVNYW5hZ2VyLnN0YXRlLmZvbnQpIHsKICAgICAgICAgICAgICBzZWxmLmVuc3VyZVN0YXRlRm9udChzdGF0ZU1hbmFnZXIuc3RhdGUpOwogICAgICAgICAgICAgIGNvbnRpbnVlOwogICAgICAgICAgICB9CiAgICAgICAgICAgIG9wZXJhdG9yTGlzdC5hZGRPcChfdXRpbC5PUFMubmV4dExpbmUpOwogICAgICAgICAgICBhcmdzWzBdID0gc2VsZi5oYW5kbGVUZXh0KGFyZ3NbMF0sIHN0YXRlTWFuYWdlci5zdGF0ZSk7CiAgICAgICAgICAgIGZuID0gX3V0aWwuT1BTLnNob3dUZXh0OwogICAgICAgICAgICBicmVhazsKICAgICAgICAgIGNhc2UgX3V0aWwuT1BTLm5leHRMaW5lU2V0U3BhY2luZ1Nob3dUZXh0OgogICAgICAgICAgICBpZiAoIXN0YXRlTWFuYWdlci5zdGF0ZS5mb250KSB7CiAgICAgICAgICAgICAgc2VsZi5lbnN1cmVTdGF0ZUZvbnQoc3RhdGVNYW5hZ2VyLnN0YXRlKTsKICAgICAgICAgICAgICBjb250aW51ZTsKICAgICAgICAgICAgfQogICAgICAgICAgICBvcGVyYXRvckxpc3QuYWRkT3AoX3V0aWwuT1BTLm5leHRMaW5lKTsKICAgICAgICAgICAgb3BlcmF0b3JMaXN0LmFkZE9wKF91dGlsLk9QUy5zZXRXb3JkU3BhY2luZywgW2FyZ3Muc2hpZnQoKV0pOwogICAgICAgICAgICBvcGVyYXRvckxpc3QuYWRkT3AoX3V0aWwuT1BTLnNldENoYXJTcGFjaW5nLCBbYXJncy5zaGlmdCgpXSk7CiAgICAgICAgICAgIGFyZ3NbMF0gPSBzZWxmLmhhbmRsZVRleHQoYXJnc1swXSwgc3RhdGVNYW5hZ2VyLnN0YXRlKTsKICAgICAgICAgICAgZm4gPSBfdXRpbC5PUFMuc2hvd1RleHQ7CiAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgY2FzZSBfdXRpbC5PUFMuc2V0VGV4dFJlbmRlcmluZ01vZGU6CiAgICAgICAgICAgIHN0YXRlTWFuYWdlci5zdGF0ZS50ZXh0UmVuZGVyaW5nTW9kZSA9IGFyZ3NbMF07CiAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgY2FzZSBfdXRpbC5PUFMuc2V0RmlsbENvbG9yU3BhY2U6CiAgICAgICAgICAgIHsKICAgICAgICAgICAgICBjb25zdCBjYWNoZWRDb2xvclNwYWNlID0gX2NvbG9yc3BhY2UuQ29sb3JTcGFjZS5nZXRDYWNoZWQoYXJnc1swXSwgeHJlZiwgbG9jYWxDb2xvclNwYWNlQ2FjaGUpOwogICAgICAgICAgICAgIGlmIChjYWNoZWRDb2xvclNwYWNlKSB7CiAgICAgICAgICAgICAgICBzdGF0ZU1hbmFnZXIuc3RhdGUuZmlsbENvbG9yU3BhY2UgPSBjYWNoZWRDb2xvclNwYWNlOwogICAgICAgICAgICAgICAgY29udGludWU7CiAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIG5leHQoc2VsZi5wYXJzZUNvbG9yU3BhY2UoewogICAgICAgICAgICAgICAgY3M6IGFyZ3NbMF0sCiAgICAgICAgICAgICAgICByZXNvdXJjZXMsCiAgICAgICAgICAgICAgICBsb2NhbENvbG9yU3BhY2VDYWNoZQogICAgICAgICAgICAgIH0pLnRoZW4oZnVuY3Rpb24gKGNvbG9yU3BhY2UpIHsKICAgICAgICAgICAgICAgIGlmIChjb2xvclNwYWNlKSB7CiAgICAgICAgICAgICAgICAgIHN0YXRlTWFuYWdlci5zdGF0ZS5maWxsQ29sb3JTcGFjZSA9IGNvbG9yU3BhY2U7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgfSkpOwogICAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgICAgfQogICAgICAgICAgY2FzZSBfdXRpbC5PUFMuc2V0U3Ryb2tlQ29sb3JTcGFjZToKICAgICAgICAgICAgewogICAgICAgICAgICAgIGNvbnN0IGNhY2hlZENvbG9yU3BhY2UgPSBfY29sb3JzcGFjZS5Db2xvclNwYWNlLmdldENhY2hlZChhcmdzWzBdLCB4cmVmLCBsb2NhbENvbG9yU3BhY2VDYWNoZSk7CiAgICAgICAgICAgICAgaWYgKGNhY2hlZENvbG9yU3BhY2UpIHsKICAgICAgICAgICAgICAgIHN0YXRlTWFuYWdlci5zdGF0ZS5zdHJva2VDb2xvclNwYWNlID0gY2FjaGVkQ29sb3JTcGFjZTsKICAgICAgICAgICAgICAgIGNvbnRpbnVlOwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgICBuZXh0KHNlbGYucGFyc2VDb2xvclNwYWNlKHsKICAgICAgICAgICAgICAgIGNzOiBhcmdzWzBdLAogICAgICAgICAgICAgICAgcmVzb3VyY2VzLAogICAgICAgICAgICAgICAgbG9jYWxDb2xvclNwYWNlQ2FjaGUKICAgICAgICAgICAgICB9KS50aGVuKGZ1bmN0aW9uIChjb2xvclNwYWNlKSB7CiAgICAgICAgICAgICAgICBpZiAoY29sb3JTcGFjZSkgewogICAgICAgICAgICAgICAgICBzdGF0ZU1hbmFnZXIuc3RhdGUuc3Ryb2tlQ29sb3JTcGFjZSA9IGNvbG9yU3BhY2U7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgfSkpOwogICAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgICAgfQogICAgICAgICAgY2FzZSBfdXRpbC5PUFMuc2V0RmlsbENvbG9yOgogICAgICAgICAgICBjcyA9IHN0YXRlTWFuYWdlci5zdGF0ZS5maWxsQ29sb3JTcGFjZTsKICAgICAgICAgICAgYXJncyA9IGNzLmdldFJnYihhcmdzLCAwKTsKICAgICAgICAgICAgZm4gPSBfdXRpbC5PUFMuc2V0RmlsbFJHQkNvbG9yOwogICAgICAgICAgICBicmVhazsKICAgICAgICAgIGNhc2UgX3V0aWwuT1BTLnNldFN0cm9rZUNvbG9yOgogICAgICAgICAgICBjcyA9IHN0YXRlTWFuYWdlci5zdGF0ZS5zdHJva2VDb2xvclNwYWNlOwogICAgICAgICAgICBhcmdzID0gY3MuZ2V0UmdiKGFyZ3MsIDApOwogICAgICAgICAgICBmbiA9IF91dGlsLk9QUy5zZXRTdHJva2VSR0JDb2xvcjsKICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICBjYXNlIF91dGlsLk9QUy5zZXRGaWxsR3JheToKICAgICAgICAgICAgc3RhdGVNYW5hZ2VyLnN0YXRlLmZpbGxDb2xvclNwYWNlID0gX2NvbG9yc3BhY2UuQ29sb3JTcGFjZS5zaW5nbGV0b25zLmdyYXk7CiAgICAgICAgICAgIGFyZ3MgPSBfY29sb3JzcGFjZS5Db2xvclNwYWNlLnNpbmdsZXRvbnMuZ3JheS5nZXRSZ2IoYXJncywgMCk7CiAgICAgICAgICAgIGZuID0gX3V0aWwuT1BTLnNldEZpbGxSR0JDb2xvcjsKICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICBjYXNlIF91dGlsLk9QUy5zZXRTdHJva2VHcmF5OgogICAgICAgICAgICBzdGF0ZU1hbmFnZXIuc3RhdGUuc3Ryb2tlQ29sb3JTcGFjZSA9IF9jb2xvcnNwYWNlLkNvbG9yU3BhY2Uuc2luZ2xldG9ucy5ncmF5OwogICAgICAgICAgICBhcmdzID0gX2NvbG9yc3BhY2UuQ29sb3JTcGFjZS5zaW5nbGV0b25zLmdyYXkuZ2V0UmdiKGFyZ3MsIDApOwogICAgICAgICAgICBmbiA9IF91dGlsLk9QUy5zZXRTdHJva2VSR0JDb2xvcjsKICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICBjYXNlIF91dGlsLk9QUy5zZXRGaWxsQ01ZS0NvbG9yOgogICAgICAgICAgICBzdGF0ZU1hbmFnZXIuc3RhdGUuZmlsbENvbG9yU3BhY2UgPSBfY29sb3JzcGFjZS5Db2xvclNwYWNlLnNpbmdsZXRvbnMuY215azsKICAgICAgICAgICAgYXJncyA9IF9jb2xvcnNwYWNlLkNvbG9yU3BhY2Uuc2luZ2xldG9ucy5jbXlrLmdldFJnYihhcmdzLCAwKTsKICAgICAgICAgICAgZm4gPSBfdXRpbC5PUFMuc2V0RmlsbFJHQkNvbG9yOwogICAgICAgICAgICBicmVhazsKICAgICAgICAgIGNhc2UgX3V0aWwuT1BTLnNldFN0cm9rZUNNWUtDb2xvcjoKICAgICAgICAgICAgc3RhdGVNYW5hZ2VyLnN0YXRlLnN0cm9rZUNvbG9yU3BhY2UgPSBfY29sb3JzcGFjZS5Db2xvclNwYWNlLnNpbmdsZXRvbnMuY215azsKICAgICAgICAgICAgYXJncyA9IF9jb2xvcnNwYWNlLkNvbG9yU3BhY2Uuc2luZ2xldG9ucy5jbXlrLmdldFJnYihhcmdzLCAwKTsKICAgICAgICAgICAgZm4gPSBfdXRpbC5PUFMuc2V0U3Ryb2tlUkdCQ29sb3I7CiAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgY2FzZSBfdXRpbC5PUFMuc2V0RmlsbFJHQkNvbG9yOgogICAgICAgICAgICBzdGF0ZU1hbmFnZXIuc3RhdGUuZmlsbENvbG9yU3BhY2UgPSBfY29sb3JzcGFjZS5Db2xvclNwYWNlLnNpbmdsZXRvbnMucmdiOwogICAgICAgICAgICBhcmdzID0gX2NvbG9yc3BhY2UuQ29sb3JTcGFjZS5zaW5nbGV0b25zLnJnYi5nZXRSZ2IoYXJncywgMCk7CiAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgY2FzZSBfdXRpbC5PUFMuc2V0U3Ryb2tlUkdCQ29sb3I6CiAgICAgICAgICAgIHN0YXRlTWFuYWdlci5zdGF0ZS5zdHJva2VDb2xvclNwYWNlID0gX2NvbG9yc3BhY2UuQ29sb3JTcGFjZS5zaW5nbGV0b25zLnJnYjsKICAgICAgICAgICAgYXJncyA9IF9jb2xvcnNwYWNlLkNvbG9yU3BhY2Uuc2luZ2xldG9ucy5yZ2IuZ2V0UmdiKGFyZ3MsIDApOwogICAgICAgICAgICBicmVhazsKICAgICAgICAgIGNhc2UgX3V0aWwuT1BTLnNldEZpbGxDb2xvck46CiAgICAgICAgICAgIGNzID0gc3RhdGVNYW5hZ2VyLnN0YXRlLmZpbGxDb2xvclNwYWNlOwogICAgICAgICAgICBpZiAoY3MubmFtZSA9PT0gIlBhdHRlcm4iKSB7CiAgICAgICAgICAgICAgbmV4dChzZWxmLmhhbmRsZUNvbG9yTihvcGVyYXRvckxpc3QsIF91dGlsLk9QUy5zZXRGaWxsQ29sb3JOLCBhcmdzLCBjcywgcGF0dGVybnMsIHJlc291cmNlcywgdGFzaywgbG9jYWxDb2xvclNwYWNlQ2FjaGUsIGxvY2FsVGlsaW5nUGF0dGVybkNhY2hlLCBsb2NhbFNoYWRpbmdQYXR0ZXJuQ2FjaGUpKTsKICAgICAgICAgICAgICByZXR1cm47CiAgICAgICAgICAgIH0KICAgICAgICAgICAgYXJncyA9IGNzLmdldFJnYihhcmdzLCAwKTsKICAgICAgICAgICAgZm4gPSBfdXRpbC5PUFMuc2V0RmlsbFJHQkNvbG9yOwogICAgICAgICAgICBicmVhazsKICAgICAgICAgIGNhc2UgX3V0aWwuT1BTLnNldFN0cm9rZUNvbG9yTjoKICAgICAgICAgICAgY3MgPSBzdGF0ZU1hbmFnZXIuc3RhdGUuc3Ryb2tlQ29sb3JTcGFjZTsKICAgICAgICAgICAgaWYgKGNzLm5hbWUgPT09ICJQYXR0ZXJuIikgewogICAgICAgICAgICAgIG5leHQoc2VsZi5oYW5kbGVDb2xvck4ob3BlcmF0b3JMaXN0LCBfdXRpbC5PUFMuc2V0U3Ryb2tlQ29sb3JOLCBhcmdzLCBjcywgcGF0dGVybnMsIHJlc291cmNlcywgdGFzaywgbG9jYWxDb2xvclNwYWNlQ2FjaGUsIGxvY2FsVGlsaW5nUGF0dGVybkNhY2hlLCBsb2NhbFNoYWRpbmdQYXR0ZXJuQ2FjaGUpKTsKICAgICAgICAgICAgICByZXR1cm47CiAgICAgICAgICAgIH0KICAgICAgICAgICAgYXJncyA9IGNzLmdldFJnYihhcmdzLCAwKTsKICAgICAgICAgICAgZm4gPSBfdXRpbC5PUFMuc2V0U3Ryb2tlUkdCQ29sb3I7CiAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgY2FzZSBfdXRpbC5PUFMuc2hhZGluZ0ZpbGw6CiAgICAgICAgICAgIHZhciBzaGFkaW5nUmVzID0gcmVzb3VyY2VzLmdldCgiU2hhZGluZyIpOwogICAgICAgICAgICBpZiAoIXNoYWRpbmdSZXMpIHsKICAgICAgICAgICAgICB0aHJvdyBuZXcgX3V0aWwuRm9ybWF0RXJyb3IoIk5vIHNoYWRpbmcgcmVzb3VyY2UgZm91bmQiKTsKICAgICAgICAgICAgfQogICAgICAgICAgICB2YXIgc2hhZGluZyA9IHNoYWRpbmdSZXMuZ2V0KGFyZ3NbMF0ubmFtZSk7CiAgICAgICAgICAgIGlmICghc2hhZGluZykgewogICAgICAgICAgICAgIHRocm93IG5ldyBfdXRpbC5Gb3JtYXRFcnJvcigiTm8gc2hhZGluZyBvYmplY3QgZm91bmQiKTsKICAgICAgICAgICAgfQogICAgICAgICAgICBjb25zdCBwYXR0ZXJuSWQgPSBzZWxmLnBhcnNlU2hhZGluZyh7CiAgICAgICAgICAgICAgc2hhZGluZywKICAgICAgICAgICAgICByZXNvdXJjZXMsCiAgICAgICAgICAgICAgbG9jYWxDb2xvclNwYWNlQ2FjaGUsCiAgICAgICAgICAgICAgbG9jYWxTaGFkaW5nUGF0dGVybkNhY2hlCiAgICAgICAgICAgIH0pOwogICAgICAgICAgICBhcmdzID0gW3BhdHRlcm5JZF07CiAgICAgICAgICAgIGZuID0gX3V0aWwuT1BTLnNoYWRpbmdGaWxsOwogICAgICAgICAgICBicmVhazsKICAgICAgICAgIGNhc2UgX3V0aWwuT1BTLnNldEdTdGF0ZToKICAgICAgICAgICAgaXNWYWxpZE5hbWUgPSBhcmdzWzBdIGluc3RhbmNlb2YgX3ByaW1pdGl2ZXMuTmFtZTsKICAgICAgICAgICAgbmFtZSA9IGFyZ3NbMF0ubmFtZTsKICAgICAgICAgICAgaWYgKGlzVmFsaWROYW1lKSB7CiAgICAgICAgICAgICAgY29uc3QgbG9jYWxHU3RhdGVPYmogPSBsb2NhbEdTdGF0ZUNhY2hlLmdldEJ5TmFtZShuYW1lKTsKICAgICAgICAgICAgICBpZiAobG9jYWxHU3RhdGVPYmopIHsKICAgICAgICAgICAgICAgIGlmIChsb2NhbEdTdGF0ZU9iai5sZW5ndGggPiAwKSB7CiAgICAgICAgICAgICAgICAgIG9wZXJhdG9yTGlzdC5hZGRPcChfdXRpbC5PUFMuc2V0R1N0YXRlLCBbbG9jYWxHU3RhdGVPYmpdKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIGFyZ3MgPSBudWxsOwogICAgICAgICAgICAgICAgY29udGludWU7CiAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgICAgIG5leHQobmV3IFByb21pc2UoZnVuY3Rpb24gKHJlc29sdmVHU3RhdGUsIHJlamVjdEdTdGF0ZSkgewogICAgICAgICAgICAgIGlmICghaXNWYWxpZE5hbWUpIHsKICAgICAgICAgICAgICAgIHRocm93IG5ldyBfdXRpbC5Gb3JtYXRFcnJvcigiR1N0YXRlIG11c3QgYmUgcmVmZXJyZWQgdG8gYnkgbmFtZS4iKTsKICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgY29uc3QgZXh0R1N0YXRlID0gcmVzb3VyY2VzLmdldCgiRXh0R1N0YXRlIik7CiAgICAgICAgICAgICAgaWYgKCEoZXh0R1N0YXRlIGluc3RhbmNlb2YgX3ByaW1pdGl2ZXMuRGljdCkpIHsKICAgICAgICAgICAgICAgIHRocm93IG5ldyBfdXRpbC5Gb3JtYXRFcnJvcigiRXh0R1N0YXRlIHNob3VsZCBiZSBhIGRpY3Rpb25hcnkuIik7CiAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIGNvbnN0IGdTdGF0ZSA9IGV4dEdTdGF0ZS5nZXQobmFtZSk7CiAgICAgICAgICAgICAgaWYgKCEoZ1N0YXRlIGluc3RhbmNlb2YgX3ByaW1pdGl2ZXMuRGljdCkpIHsKICAgICAgICAgICAgICAgIHRocm93IG5ldyBfdXRpbC5Gb3JtYXRFcnJvcigiR1N0YXRlIHNob3VsZCBiZSBhIGRpY3Rpb25hcnkuIik7CiAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIHNlbGYuc2V0R1N0YXRlKHsKICAgICAgICAgICAgICAgIHJlc291cmNlcywKICAgICAgICAgICAgICAgIGdTdGF0ZSwKICAgICAgICAgICAgICAgIG9wZXJhdG9yTGlzdCwKICAgICAgICAgICAgICAgIGNhY2hlS2V5OiBuYW1lLAogICAgICAgICAgICAgICAgdGFzaywKICAgICAgICAgICAgICAgIHN0YXRlTWFuYWdlciwKICAgICAgICAgICAgICAgIGxvY2FsR1N0YXRlQ2FjaGUsCiAgICAgICAgICAgICAgICBsb2NhbENvbG9yU3BhY2VDYWNoZQogICAgICAgICAgICAgIH0pLnRoZW4ocmVzb2x2ZUdTdGF0ZSwgcmVqZWN0R1N0YXRlKTsKICAgICAgICAgICAgfSkuY2F0Y2goZnVuY3Rpb24gKHJlYXNvbikgewogICAgICAgICAgICAgIGlmIChyZWFzb24gaW5zdGFuY2VvZiBfdXRpbC5BYm9ydEV4Y2VwdGlvbikgewogICAgICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgICBpZiAoc2VsZi5vcHRpb25zLmlnbm9yZUVycm9ycykgewogICAgICAgICAgICAgICAgKDAsIF91dGlsLndhcm4pKGBnZXRPcGVyYXRvckxpc3QgLSBpZ25vcmluZyBFeHRHU3RhdGU6ICIke3JlYXNvbn0iLmApOwogICAgICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgICB0aHJvdyByZWFzb247CiAgICAgICAgICAgIH0pKTsKICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgY2FzZSBfdXRpbC5PUFMubW92ZVRvOgogICAgICAgICAgY2FzZSBfdXRpbC5PUFMubGluZVRvOgogICAgICAgICAgY2FzZSBfdXRpbC5PUFMuY3VydmVUbzoKICAgICAgICAgIGNhc2UgX3V0aWwuT1BTLmN1cnZlVG8yOgogICAgICAgICAgY2FzZSBfdXRpbC5PUFMuY3VydmVUbzM6CiAgICAgICAgICBjYXNlIF91dGlsLk9QUy5jbG9zZVBhdGg6CiAgICAgICAgICBjYXNlIF91dGlsLk9QUy5yZWN0YW5nbGU6CiAgICAgICAgICAgIHNlbGYuYnVpbGRQYXRoKG9wZXJhdG9yTGlzdCwgZm4sIGFyZ3MsIHBhcnNpbmdUZXh0KTsKICAgICAgICAgICAgY29udGludWU7CiAgICAgICAgICBjYXNlIF91dGlsLk9QUy5tYXJrUG9pbnQ6CiAgICAgICAgICBjYXNlIF91dGlsLk9QUy5tYXJrUG9pbnRQcm9wczoKICAgICAgICAgIGNhc2UgX3V0aWwuT1BTLmJlZ2luQ29tcGF0OgogICAgICAgICAgY2FzZSBfdXRpbC5PUFMuZW5kQ29tcGF0OgogICAgICAgICAgICBjb250aW51ZTsKICAgICAgICAgIGNhc2UgX3V0aWwuT1BTLmJlZ2luTWFya2VkQ29udGVudFByb3BzOgogICAgICAgICAgICBpZiAoIShhcmdzWzBdIGluc3RhbmNlb2YgX3ByaW1pdGl2ZXMuTmFtZSkpIHsKICAgICAgICAgICAgICAoMCwgX3V0aWwud2FybikoYEV4cGVjdGVkIG5hbWUgZm9yIGJlZ2luTWFya2VkQ29udGVudFByb3BzIGFyZzA9JHthcmdzWzBdfWApOwogICAgICAgICAgICAgIGNvbnRpbnVlOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGlmIChhcmdzWzBdLm5hbWUgPT09ICJPQyIpIHsKICAgICAgICAgICAgICBuZXh0KHNlbGYucGFyc2VNYXJrZWRDb250ZW50UHJvcHMoYXJnc1sxXSwgcmVzb3VyY2VzKS50aGVuKGRhdGEgPT4gewogICAgICAgICAgICAgICAgb3BlcmF0b3JMaXN0LmFkZE9wKF91dGlsLk9QUy5iZWdpbk1hcmtlZENvbnRlbnRQcm9wcywgWyJPQyIsIGRhdGFdKTsKICAgICAgICAgICAgICB9KS5jYXRjaChyZWFzb24gPT4gewogICAgICAgICAgICAgICAgaWYgKHJlYXNvbiBpbnN0YW5jZW9mIF91dGlsLkFib3J0RXhjZXB0aW9uKSB7CiAgICAgICAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIGlmIChzZWxmLm9wdGlvbnMuaWdub3JlRXJyb3JzKSB7CiAgICAgICAgICAgICAgICAgICgwLCBfdXRpbC53YXJuKShgZ2V0T3BlcmF0b3JMaXN0IC0gaWdub3JpbmcgYmVnaW5NYXJrZWRDb250ZW50UHJvcHM6ICIke3JlYXNvbn0iLmApOwogICAgICAgICAgICAgICAgICByZXR1cm47CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB0aHJvdyByZWFzb247CiAgICAgICAgICAgICAgfSkpOwogICAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgICAgfQogICAgICAgICAgICBhcmdzID0gW2FyZ3NbMF0ubmFtZSwgYXJnc1sxXSBpbnN0YW5jZW9mIF9wcmltaXRpdmVzLkRpY3QgPyBhcmdzWzFdLmdldCgiTUNJRCIpIDogbnVsbF07CiAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgY2FzZSBfdXRpbC5PUFMuYmVnaW5NYXJrZWRDb250ZW50OgogICAgICAgICAgY2FzZSBfdXRpbC5PUFMuZW5kTWFya2VkQ29udGVudDoKICAgICAgICAgIGRlZmF1bHQ6CiAgICAgICAgICAgIGlmIChhcmdzICE9PSBudWxsKSB7CiAgICAgICAgICAgICAgZm9yIChpID0gMCwgaWkgPSBhcmdzLmxlbmd0aDsgaSA8IGlpOyBpKyspIHsKICAgICAgICAgICAgICAgIGlmIChhcmdzW2ldIGluc3RhbmNlb2YgX3ByaW1pdGl2ZXMuRGljdCkgewogICAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgaWYgKGkgPCBpaSkgewogICAgICAgICAgICAgICAgKDAsIF91dGlsLndhcm4pKCJnZXRPcGVyYXRvckxpc3QgLSBpZ25vcmluZyBvcGVyYXRvcjogIiArIGZuKTsKICAgICAgICAgICAgICAgIGNvbnRpbnVlOwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgIH0KICAgICAgICBvcGVyYXRvckxpc3QuYWRkT3AoZm4sIGFyZ3MpOwogICAgICB9CiAgICAgIGlmIChzdG9wKSB7CiAgICAgICAgbmV4dChkZWZlcnJlZCk7CiAgICAgICAgcmV0dXJuOwogICAgICB9CiAgICAgIGNsb3NlUGVuZGluZ1Jlc3RvcmVPUFMoKTsKICAgICAgcmVzb2x2ZSgpOwogICAgfSkuY2F0Y2gocmVhc29uID0+IHsKICAgICAgaWYgKHJlYXNvbiBpbnN0YW5jZW9mIF91dGlsLkFib3J0RXhjZXB0aW9uKSB7CiAgICAgICAgcmV0dXJuOwogICAgICB9CiAgICAgIGlmICh0aGlzLm9wdGlvbnMuaWdub3JlRXJyb3JzKSB7CiAgICAgICAgKDAsIF91dGlsLndhcm4pKGBnZXRPcGVyYXRvckxpc3QgLSBpZ25vcmluZyBlcnJvcnMgZHVyaW5nICIke3Rhc2submFtZX0iIGAgKyBgdGFzazogIiR7cmVhc29ufSIuYCk7CiAgICAgICAgY2xvc2VQZW5kaW5nUmVzdG9yZU9QUygpOwogICAgICAgIHJldHVybjsKICAgICAgfQogICAgICB0aHJvdyByZWFzb247CiAgICB9KTsKICB9CiAgZ2V0VGV4dENvbnRlbnQoewogICAgc3RyZWFtLAogICAgdGFzaywKICAgIHJlc291cmNlcywKICAgIHN0YXRlTWFuYWdlciA9IG51bGwsCiAgICBpbmNsdWRlTWFya2VkQ29udGVudCA9IGZhbHNlLAogICAgc2luaywKICAgIHNlZW5TdHlsZXMgPSBuZXcgU2V0KCksCiAgICB2aWV3Qm94LAogICAgbWFya2VkQ29udGVudERhdGEgPSBudWxsLAogICAgZGlzYWJsZU5vcm1hbGl6YXRpb24gPSBmYWxzZQogIH0pIHsKICAgIHJlc291cmNlcyB8fD0gX3ByaW1pdGl2ZXMuRGljdC5lbXB0eTsKICAgIHN0YXRlTWFuYWdlciB8fD0gbmV3IFN0YXRlTWFuYWdlcihuZXcgVGV4dFN0YXRlKCkpOwogICAgaWYgKGluY2x1ZGVNYXJrZWRDb250ZW50KSB7CiAgICAgIG1hcmtlZENvbnRlbnREYXRhIHx8PSB7CiAgICAgICAgbGV2ZWw6IDAKICAgICAgfTsKICAgIH0KICAgIGNvbnN0IHRleHRDb250ZW50ID0gewogICAgICBpdGVtczogW10sCiAgICAgIHN0eWxlczogT2JqZWN0LmNyZWF0ZShudWxsKQogICAgfTsKICAgIGNvbnN0IHRleHRDb250ZW50SXRlbSA9IHsKICAgICAgaW5pdGlhbGl6ZWQ6IGZhbHNlLAogICAgICBzdHI6IFtdLAogICAgICB0b3RhbFdpZHRoOiAwLAogICAgICB0b3RhbEhlaWdodDogMCwKICAgICAgd2lkdGg6IDAsCiAgICAgIGhlaWdodDogMCwKICAgICAgdmVydGljYWw6IGZhbHNlLAogICAgICBwcmV2VHJhbnNmb3JtOiBudWxsLAogICAgICB0ZXh0QWR2YW5jZVNjYWxlOiAwLAogICAgICBzcGFjZUluRmxvd01pbjogMCwKICAgICAgc3BhY2VJbkZsb3dNYXg6IDAsCiAgICAgIHRyYWNraW5nU3BhY2VNaW46IEluZmluaXR5LAogICAgICBuZWdhdGl2ZVNwYWNlTWF4OiAtSW5maW5pdHksCiAgICAgIG5vdEFTcGFjZTogLUluZmluaXR5LAogICAgICB0cmFuc2Zvcm06IG51bGwsCiAgICAgIGZvbnROYW1lOiBudWxsLAogICAgICBoYXNFT0w6IGZhbHNlCiAgICB9OwogICAgY29uc3QgdHdvTGFzdENoYXJzID0gWyIgIiwgIiAiXTsKICAgIGxldCB0d29MYXN0Q2hhcnNQb3MgPSAwOwogICAgZnVuY3Rpb24gc2F2ZUxhc3RDaGFyKGNoYXIpIHsKICAgICAgY29uc3QgbmV4dFBvcyA9ICh0d29MYXN0Q2hhcnNQb3MgKyAxKSAlIDI7CiAgICAgIGNvbnN0IHJldCA9IHR3b0xhc3RDaGFyc1t0d29MYXN0Q2hhcnNQb3NdICE9PSAiICIgJiYgdHdvTGFzdENoYXJzW25leHRQb3NdID09PSAiICI7CiAgICAgIHR3b0xhc3RDaGFyc1t0d29MYXN0Q2hhcnNQb3NdID0gY2hhcjsKICAgICAgdHdvTGFzdENoYXJzUG9zID0gbmV4dFBvczsKICAgICAgcmV0dXJuIHJldDsKICAgIH0KICAgIGZ1bmN0aW9uIHNob3VsZEFkZFdoaXRlcHNhY2UoKSB7CiAgICAgIHJldHVybiB0d29MYXN0Q2hhcnNbdHdvTGFzdENoYXJzUG9zXSAhPT0gIiAiICYmIHR3b0xhc3RDaGFyc1sodHdvTGFzdENoYXJzUG9zICsgMSkgJSAyXSA9PT0gIiAiOwogICAgfQogICAgZnVuY3Rpb24gcmVzZXRMYXN0Q2hhcnMoKSB7CiAgICAgIHR3b0xhc3RDaGFyc1swXSA9IHR3b0xhc3RDaGFyc1sxXSA9ICIgIjsKICAgICAgdHdvTGFzdENoYXJzUG9zID0gMDsKICAgIH0KICAgIGNvbnN0IFRSQUNLSU5HX1NQQUNFX0ZBQ1RPUiA9IDAuMTAyOwogICAgY29uc3QgTk9UX0FfU1BBQ0VfRkFDVE9SID0gMC4wMzsKICAgIGNvbnN0IE5FR0FUSVZFX1NQQUNFX0ZBQ1RPUiA9IC0wLjI7CiAgICBjb25zdCBTUEFDRV9JTl9GTE9XX01JTl9GQUNUT1IgPSAwLjEwMjsKICAgIGNvbnN0IFNQQUNFX0lOX0ZMT1dfTUFYX0ZBQ1RPUiA9IDAuNjsKICAgIGNvbnN0IFZFUlRJQ0FMX1NISUZUX1JBVElPID0gMC4yNTsKICAgIGNvbnN0IHNlbGYgPSB0aGlzOwogICAgY29uc3QgeHJlZiA9IHRoaXMueHJlZjsKICAgIGNvbnN0IHNob3dTcGFjZWRUZXh0QnVmZmVyID0gW107CiAgICBsZXQgeG9ianMgPSBudWxsOwogICAgY29uc3QgZW1wdHlYT2JqZWN0Q2FjaGUgPSBuZXcgX2ltYWdlX3V0aWxzLkxvY2FsSW1hZ2VDYWNoZSgpOwogICAgY29uc3QgZW1wdHlHU3RhdGVDYWNoZSA9IG5ldyBfaW1hZ2VfdXRpbHMuTG9jYWxHU3RhdGVDYWNoZSgpOwogICAgY29uc3QgcHJlcHJvY2Vzc29yID0gbmV3IEV2YWx1YXRvclByZXByb2Nlc3NvcihzdHJlYW0sIHhyZWYsIHN0YXRlTWFuYWdlcik7CiAgICBsZXQgdGV4dFN0YXRlOwogICAgZnVuY3Rpb24gcHVzaFdoaXRlc3BhY2UoewogICAgICB3aWR0aCA9IDAsCiAgICAgIGhlaWdodCA9IDAsCiAgICAgIHRyYW5zZm9ybSA9IHRleHRDb250ZW50SXRlbS5wcmV2VHJhbnNmb3JtLAogICAgICBmb250TmFtZSA9IHRleHRDb250ZW50SXRlbS5mb250TmFtZQogICAgfSkgewogICAgICB0ZXh0Q29udGVudC5pdGVtcy5wdXNoKHsKICAgICAgICBzdHI6ICIgIiwKICAgICAgICBkaXI6ICJsdHIiLAogICAgICAgIHdpZHRoLAogICAgICAgIGhlaWdodCwKICAgICAgICB0cmFuc2Zvcm0sCiAgICAgICAgZm9udE5hbWUsCiAgICAgICAgaGFzRU9MOiBmYWxzZQogICAgICB9KTsKICAgIH0KICAgIGZ1bmN0aW9uIGdldEN1cnJlbnRUZXh0VHJhbnNmb3JtKCkgewogICAgICBjb25zdCBmb250ID0gdGV4dFN0YXRlLmZvbnQ7CiAgICAgIGNvbnN0IHRzbSA9IFt0ZXh0U3RhdGUuZm9udFNpemUgKiB0ZXh0U3RhdGUudGV4dEhTY2FsZSwgMCwgMCwgdGV4dFN0YXRlLmZvbnRTaXplLCAwLCB0ZXh0U3RhdGUudGV4dFJpc2VdOwogICAgICBpZiAoZm9udC5pc1R5cGUzRm9udCAmJiAodGV4dFN0YXRlLmZvbnRTaXplIDw9IDEgfHwgZm9udC5pc0NoYXJCQm94KSAmJiAhKDAsIF91dGlsLmlzQXJyYXlFcXVhbCkodGV4dFN0YXRlLmZvbnRNYXRyaXgsIF91dGlsLkZPTlRfSURFTlRJVFlfTUFUUklYKSkgewogICAgICAgIGNvbnN0IGdseXBoSGVpZ2h0ID0gZm9udC5iYm94WzNdIC0gZm9udC5iYm94WzFdOwogICAgICAgIGlmIChnbHlwaEhlaWdodCA+IDApIHsKICAgICAgICAgIHRzbVszXSAqPSBnbHlwaEhlaWdodCAqIHRleHRTdGF0ZS5mb250TWF0cml4WzNdOwogICAgICAgIH0KICAgICAgfQogICAgICByZXR1cm4gX3V0aWwuVXRpbC50cmFuc2Zvcm0odGV4dFN0YXRlLmN0bSwgX3V0aWwuVXRpbC50cmFuc2Zvcm0odGV4dFN0YXRlLnRleHRNYXRyaXgsIHRzbSkpOwogICAgfQogICAgZnVuY3Rpb24gZW5zdXJlVGV4dENvbnRlbnRJdGVtKCkgewogICAgICBpZiAodGV4dENvbnRlbnRJdGVtLmluaXRpYWxpemVkKSB7CiAgICAgICAgcmV0dXJuIHRleHRDb250ZW50SXRlbTsKICAgICAgfQogICAgICBjb25zdCB7CiAgICAgICAgZm9udCwKICAgICAgICBsb2FkZWROYW1lCiAgICAgIH0gPSB0ZXh0U3RhdGU7CiAgICAgIGlmICghc2VlblN0eWxlcy5oYXMobG9hZGVkTmFtZSkpIHsKICAgICAgICBzZWVuU3R5bGVzLmFkZChsb2FkZWROYW1lKTsKICAgICAgICB0ZXh0Q29udGVudC5zdHlsZXNbbG9hZGVkTmFtZV0gPSB7CiAgICAgICAgICBmb250RmFtaWx5OiBmb250LmZhbGxiYWNrTmFtZSwKICAgICAgICAgIGFzY2VudDogZm9udC5hc2NlbnQsCiAgICAgICAgICBkZXNjZW50OiBmb250LmRlc2NlbnQsCiAgICAgICAgICB2ZXJ0aWNhbDogZm9udC52ZXJ0aWNhbAogICAgICAgIH07CiAgICAgIH0KICAgICAgdGV4dENvbnRlbnRJdGVtLmZvbnROYW1lID0gbG9hZGVkTmFtZTsKICAgICAgY29uc3QgdHJtID0gdGV4dENvbnRlbnRJdGVtLnRyYW5zZm9ybSA9IGdldEN1cnJlbnRUZXh0VHJhbnNmb3JtKCk7CiAgICAgIGlmICghZm9udC52ZXJ0aWNhbCkgewogICAgICAgIHRleHRDb250ZW50SXRlbS53aWR0aCA9IHRleHRDb250ZW50SXRlbS50b3RhbFdpZHRoID0gMDsKICAgICAgICB0ZXh0Q29udGVudEl0ZW0uaGVpZ2h0ID0gdGV4dENvbnRlbnRJdGVtLnRvdGFsSGVpZ2h0ID0gTWF0aC5oeXBvdCh0cm1bMl0sIHRybVszXSk7CiAgICAgICAgdGV4dENvbnRlbnRJdGVtLnZlcnRpY2FsID0gZmFsc2U7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgdGV4dENvbnRlbnRJdGVtLndpZHRoID0gdGV4dENvbnRlbnRJdGVtLnRvdGFsV2lkdGggPSBNYXRoLmh5cG90KHRybVswXSwgdHJtWzFdKTsKICAgICAgICB0ZXh0Q29udGVudEl0ZW0uaGVpZ2h0ID0gdGV4dENvbnRlbnRJdGVtLnRvdGFsSGVpZ2h0ID0gMDsKICAgICAgICB0ZXh0Q29udGVudEl0ZW0udmVydGljYWwgPSB0cnVlOwogICAgICB9CiAgICAgIGNvbnN0IHNjYWxlTGluZVggPSBNYXRoLmh5cG90KHRleHRTdGF0ZS50ZXh0TGluZU1hdHJpeFswXSwgdGV4dFN0YXRlLnRleHRMaW5lTWF0cml4WzFdKTsKICAgICAgY29uc3Qgc2NhbGVDdG1YID0gTWF0aC5oeXBvdCh0ZXh0U3RhdGUuY3RtWzBdLCB0ZXh0U3RhdGUuY3RtWzFdKTsKICAgICAgdGV4dENvbnRlbnRJdGVtLnRleHRBZHZhbmNlU2NhbGUgPSBzY2FsZUN0bVggKiBzY2FsZUxpbmVYOwogICAgICBjb25zdCB7CiAgICAgICAgZm9udFNpemUKICAgICAgfSA9IHRleHRTdGF0ZTsKICAgICAgdGV4dENvbnRlbnRJdGVtLnRyYWNraW5nU3BhY2VNaW4gPSBmb250U2l6ZSAqIFRSQUNLSU5HX1NQQUNFX0ZBQ1RPUjsKICAgICAgdGV4dENvbnRlbnRJdGVtLm5vdEFTcGFjZSA9IGZvbnRTaXplICogTk9UX0FfU1BBQ0VfRkFDVE9SOwogICAgICB0ZXh0Q29udGVudEl0ZW0ubmVnYXRpdmVTcGFjZU1heCA9IGZvbnRTaXplICogTkVHQVRJVkVfU1BBQ0VfRkFDVE9SOwogICAgICB0ZXh0Q29udGVudEl0ZW0uc3BhY2VJbkZsb3dNaW4gPSBmb250U2l6ZSAqIFNQQUNFX0lOX0ZMT1dfTUlOX0ZBQ1RPUjsKICAgICAgdGV4dENvbnRlbnRJdGVtLnNwYWNlSW5GbG93TWF4ID0gZm9udFNpemUgKiBTUEFDRV9JTl9GTE9XX01BWF9GQUNUT1I7CiAgICAgIHRleHRDb250ZW50SXRlbS5oYXNFT0wgPSBmYWxzZTsKICAgICAgdGV4dENvbnRlbnRJdGVtLmluaXRpYWxpemVkID0gdHJ1ZTsKICAgICAgcmV0dXJuIHRleHRDb250ZW50SXRlbTsKICAgIH0KICAgIGZ1bmN0aW9uIHVwZGF0ZUFkdmFuY2VTY2FsZSgpIHsKICAgICAgaWYgKCF0ZXh0Q29udGVudEl0ZW0uaW5pdGlhbGl6ZWQpIHsKICAgICAgICByZXR1cm47CiAgICAgIH0KICAgICAgY29uc3Qgc2NhbGVMaW5lWCA9IE1hdGguaHlwb3QodGV4dFN0YXRlLnRleHRMaW5lTWF0cml4WzBdLCB0ZXh0U3RhdGUudGV4dExpbmVNYXRyaXhbMV0pOwogICAgICBjb25zdCBzY2FsZUN0bVggPSBNYXRoLmh5cG90KHRleHRTdGF0ZS5jdG1bMF0sIHRleHRTdGF0ZS5jdG1bMV0pOwogICAgICBjb25zdCBzY2FsZUZhY3RvciA9IHNjYWxlQ3RtWCAqIHNjYWxlTGluZVg7CiAgICAgIGlmIChzY2FsZUZhY3RvciA9PT0gdGV4dENvbnRlbnRJdGVtLnRleHRBZHZhbmNlU2NhbGUpIHsKICAgICAgICByZXR1cm47CiAgICAgIH0KICAgICAgaWYgKCF0ZXh0Q29udGVudEl0ZW0udmVydGljYWwpIHsKICAgICAgICB0ZXh0Q29udGVudEl0ZW0udG90YWxXaWR0aCArPSB0ZXh0Q29udGVudEl0ZW0ud2lkdGggKiB0ZXh0Q29udGVudEl0ZW0udGV4dEFkdmFuY2VTY2FsZTsKICAgICAgICB0ZXh0Q29udGVudEl0ZW0ud2lkdGggPSAwOwogICAgICB9IGVsc2UgewogICAgICAgIHRleHRDb250ZW50SXRlbS50b3RhbEhlaWdodCArPSB0ZXh0Q29udGVudEl0ZW0uaGVpZ2h0ICogdGV4dENvbnRlbnRJdGVtLnRleHRBZHZhbmNlU2NhbGU7CiAgICAgICAgdGV4dENvbnRlbnRJdGVtLmhlaWdodCA9IDA7CiAgICAgIH0KICAgICAgdGV4dENvbnRlbnRJdGVtLnRleHRBZHZhbmNlU2NhbGUgPSBzY2FsZUZhY3RvcjsKICAgIH0KICAgIGZ1bmN0aW9uIHJ1bkJpZGlUcmFuc2Zvcm0odGV4dENodW5rKSB7CiAgICAgIGxldCB0ZXh0ID0gdGV4dENodW5rLnN0ci5qb2luKCIiKTsKICAgICAgaWYgKCFkaXNhYmxlTm9ybWFsaXphdGlvbikgewogICAgICAgIHRleHQgPSAoMCwgX3V0aWwubm9ybWFsaXplVW5pY29kZSkodGV4dCk7CiAgICAgIH0KICAgICAgY29uc3QgYmlkaVJlc3VsdCA9ICgwLCBfYmlkaS5iaWRpKSh0ZXh0LCAtMSwgdGV4dENodW5rLnZlcnRpY2FsKTsKICAgICAgcmV0dXJuIHsKICAgICAgICBzdHI6IGJpZGlSZXN1bHQuc3RyLAogICAgICAgIGRpcjogYmlkaVJlc3VsdC5kaXIsCiAgICAgICAgd2lkdGg6IE1hdGguYWJzKHRleHRDaHVuay50b3RhbFdpZHRoKSwKICAgICAgICBoZWlnaHQ6IE1hdGguYWJzKHRleHRDaHVuay50b3RhbEhlaWdodCksCiAgICAgICAgdHJhbnNmb3JtOiB0ZXh0Q2h1bmsudHJhbnNmb3JtLAogICAgICAgIGZvbnROYW1lOiB0ZXh0Q2h1bmsuZm9udE5hbWUsCiAgICAgICAgaGFzRU9MOiB0ZXh0Q2h1bmsuaGFzRU9MCiAgICAgIH07CiAgICB9CiAgICBmdW5jdGlvbiBoYW5kbGVTZXRGb250KGZvbnROYW1lLCBmb250UmVmKSB7CiAgICAgIHJldHVybiBzZWxmLmxvYWRGb250KGZvbnROYW1lLCBmb250UmVmLCByZXNvdXJjZXMpLnRoZW4oZnVuY3Rpb24gKHRyYW5zbGF0ZWQpIHsKICAgICAgICBpZiAoIXRyYW5zbGF0ZWQuZm9udC5pc1R5cGUzRm9udCkgewogICAgICAgICAgcmV0dXJuIHRyYW5zbGF0ZWQ7CiAgICAgICAgfQogICAgICAgIHJldHVybiB0cmFuc2xhdGVkLmxvYWRUeXBlM0RhdGEoc2VsZiwgcmVzb3VyY2VzLCB0YXNrKS5jYXRjaChmdW5jdGlvbiAoKSB7fSkudGhlbihmdW5jdGlvbiAoKSB7CiAgICAgICAgICByZXR1cm4gdHJhbnNsYXRlZDsKICAgICAgICB9KTsKICAgICAgfSkudGhlbihmdW5jdGlvbiAodHJhbnNsYXRlZCkgewogICAgICAgIHRleHRTdGF0ZS5sb2FkZWROYW1lID0gdHJhbnNsYXRlZC5sb2FkZWROYW1lOwogICAgICAgIHRleHRTdGF0ZS5mb250ID0gdHJhbnNsYXRlZC5mb250OwogICAgICAgIHRleHRTdGF0ZS5mb250TWF0cml4ID0gdHJhbnNsYXRlZC5mb250LmZvbnRNYXRyaXggfHwgX3V0aWwuRk9OVF9JREVOVElUWV9NQVRSSVg7CiAgICAgIH0pOwogICAgfQogICAgZnVuY3Rpb24gYXBwbHlJbnZlcnNlUm90YXRpb24oeCwgeSwgbWF0cml4KSB7CiAgICAgIGNvbnN0IHNjYWxlID0gTWF0aC5oeXBvdChtYXRyaXhbMF0sIG1hdHJpeFsxXSk7CiAgICAgIHJldHVybiBbKG1hdHJpeFswXSAqIHggKyBtYXRyaXhbMV0gKiB5KSAvIHNjYWxlLCAobWF0cml4WzJdICogeCArIG1hdHJpeFszXSAqIHkpIC8gc2NhbGVdOwogICAgfQogICAgZnVuY3Rpb24gY29tcGFyZVdpdGhMYXN0UG9zaXRpb24oZ2x5cGhXaWR0aCkgewogICAgICBjb25zdCBjdXJyZW50VHJhbnNmb3JtID0gZ2V0Q3VycmVudFRleHRUcmFuc2Zvcm0oKTsKICAgICAgbGV0IHBvc1ggPSBjdXJyZW50VHJhbnNmb3JtWzRdOwogICAgICBsZXQgcG9zWSA9IGN1cnJlbnRUcmFuc2Zvcm1bNV07CiAgICAgIGlmICh0ZXh0U3RhdGUuZm9udD8udmVydGljYWwpIHsKICAgICAgICBpZiAocG9zWCA8IHZpZXdCb3hbMF0gfHwgcG9zWCA+IHZpZXdCb3hbMl0gfHwgcG9zWSArIGdseXBoV2lkdGggPCB2aWV3Qm94WzFdIHx8IHBvc1kgPiB2aWV3Qm94WzNdKSB7CiAgICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgICAgfQogICAgICB9IGVsc2UgaWYgKHBvc1ggKyBnbHlwaFdpZHRoIDwgdmlld0JveFswXSB8fCBwb3NYID4gdmlld0JveFsyXSB8fCBwb3NZIDwgdmlld0JveFsxXSB8fCBwb3NZID4gdmlld0JveFszXSkgewogICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgfQogICAgICBpZiAoIXRleHRTdGF0ZS5mb250IHx8ICF0ZXh0Q29udGVudEl0ZW0ucHJldlRyYW5zZm9ybSkgewogICAgICAgIHJldHVybiB0cnVlOwogICAgICB9CiAgICAgIGxldCBsYXN0UG9zWCA9IHRleHRDb250ZW50SXRlbS5wcmV2VHJhbnNmb3JtWzRdOwogICAgICBsZXQgbGFzdFBvc1kgPSB0ZXh0Q29udGVudEl0ZW0ucHJldlRyYW5zZm9ybVs1XTsKICAgICAgaWYgKGxhc3RQb3NYID09PSBwb3NYICYmIGxhc3RQb3NZID09PSBwb3NZKSB7CiAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgIH0KICAgICAgbGV0IHJvdGF0ZSA9IC0xOwogICAgICBpZiAoY3VycmVudFRyYW5zZm9ybVswXSAmJiBjdXJyZW50VHJhbnNmb3JtWzFdID09PSAwICYmIGN1cnJlbnRUcmFuc2Zvcm1bMl0gPT09IDApIHsKICAgICAgICByb3RhdGUgPSBjdXJyZW50VHJhbnNmb3JtWzBdID4gMCA/IDAgOiAxODA7CiAgICAgIH0gZWxzZSBpZiAoY3VycmVudFRyYW5zZm9ybVsxXSAmJiBjdXJyZW50VHJhbnNmb3JtWzBdID09PSAwICYmIGN1cnJlbnRUcmFuc2Zvcm1bM10gPT09IDApIHsKICAgICAgICByb3RhdGUgPSBjdXJyZW50VHJhbnNmb3JtWzFdID4gMCA/IDkwIDogMjcwOwogICAgICB9CiAgICAgIHN3aXRjaCAocm90YXRlKSB7CiAgICAgICAgY2FzZSAwOgogICAgICAgICAgYnJlYWs7CiAgICAgICAgY2FzZSA5MDoKICAgICAgICAgIFtwb3NYLCBwb3NZXSA9IFtwb3NZLCBwb3NYXTsKICAgICAgICAgIFtsYXN0UG9zWCwgbGFzdFBvc1ldID0gW2xhc3RQb3NZLCBsYXN0UG9zWF07CiAgICAgICAgICBicmVhazsKICAgICAgICBjYXNlIDE4MDoKICAgICAgICAgIFtwb3NYLCBwb3NZLCBsYXN0UG9zWCwgbGFzdFBvc1ldID0gWy1wb3NYLCAtcG9zWSwgLWxhc3RQb3NYLCAtbGFzdFBvc1ldOwogICAgICAgICAgYnJlYWs7CiAgICAgICAgY2FzZSAyNzA6CiAgICAgICAgICBbcG9zWCwgcG9zWV0gPSBbLXBvc1ksIC1wb3NYXTsKICAgICAgICAgIFtsYXN0UG9zWCwgbGFzdFBvc1ldID0gWy1sYXN0UG9zWSwgLWxhc3RQb3NYXTsKICAgICAgICAgIGJyZWFrOwogICAgICAgIGRlZmF1bHQ6CiAgICAgICAgICBbcG9zWCwgcG9zWV0gPSBhcHBseUludmVyc2VSb3RhdGlvbihwb3NYLCBwb3NZLCBjdXJyZW50VHJhbnNmb3JtKTsKICAgICAgICAgIFtsYXN0UG9zWCwgbGFzdFBvc1ldID0gYXBwbHlJbnZlcnNlUm90YXRpb24obGFzdFBvc1gsIGxhc3RQb3NZLCB0ZXh0Q29udGVudEl0ZW0ucHJldlRyYW5zZm9ybSk7CiAgICAgIH0KICAgICAgaWYgKHRleHRTdGF0ZS5mb250LnZlcnRpY2FsKSB7CiAgICAgICAgY29uc3QgYWR2YW5jZVkgPSAobGFzdFBvc1kgLSBwb3NZKSAvIHRleHRDb250ZW50SXRlbS50ZXh0QWR2YW5jZVNjYWxlOwogICAgICAgIGNvbnN0IGFkdmFuY2VYID0gcG9zWCAtIGxhc3RQb3NYOwogICAgICAgIGNvbnN0IHRleHRPcmllbnRhdGlvbiA9IE1hdGguc2lnbih0ZXh0Q29udGVudEl0ZW0uaGVpZ2h0KTsKICAgICAgICBpZiAoYWR2YW5jZVkgPCB0ZXh0T3JpZW50YXRpb24gKiB0ZXh0Q29udGVudEl0ZW0ubmVnYXRpdmVTcGFjZU1heCkgewogICAgICAgICAgaWYgKE1hdGguYWJzKGFkdmFuY2VYKSA+IDAuNSAqIHRleHRDb250ZW50SXRlbS53aWR0aCkgewogICAgICAgICAgICBhcHBlbmRFT0woKTsKICAgICAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgICAgICB9CiAgICAgICAgICByZXNldExhc3RDaGFycygpOwogICAgICAgICAgZmx1c2hUZXh0Q29udGVudEl0ZW0oKTsKICAgICAgICAgIHJldHVybiB0cnVlOwogICAgICAgIH0KICAgICAgICBpZiAoTWF0aC5hYnMoYWR2YW5jZVgpID4gdGV4dENvbnRlbnRJdGVtLndpZHRoKSB7CiAgICAgICAgICBhcHBlbmRFT0woKTsKICAgICAgICAgIHJldHVybiB0cnVlOwogICAgICAgIH0KICAgICAgICBpZiAoYWR2YW5jZVkgPD0gdGV4dE9yaWVudGF0aW9uICogdGV4dENvbnRlbnRJdGVtLm5vdEFTcGFjZSkgewogICAgICAgICAgcmVzZXRMYXN0Q2hhcnMoKTsKICAgICAgICB9CiAgICAgICAgaWYgKGFkdmFuY2VZIDw9IHRleHRPcmllbnRhdGlvbiAqIHRleHRDb250ZW50SXRlbS50cmFja2luZ1NwYWNlTWluKSB7CiAgICAgICAgICBpZiAoc2hvdWxkQWRkV2hpdGVwc2FjZSgpKSB7CiAgICAgICAgICAgIHJlc2V0TGFzdENoYXJzKCk7CiAgICAgICAgICAgIGZsdXNoVGV4dENvbnRlbnRJdGVtKCk7CiAgICAgICAgICAgIHB1c2hXaGl0ZXNwYWNlKHsKICAgICAgICAgICAgICBoZWlnaHQ6IE1hdGguYWJzKGFkdmFuY2VZKQogICAgICAgICAgICB9KTsKICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIHRleHRDb250ZW50SXRlbS5oZWlnaHQgKz0gYWR2YW5jZVk7CiAgICAgICAgICB9CiAgICAgICAgfSBlbHNlIGlmICghYWRkRmFrZVNwYWNlcyhhZHZhbmNlWSwgdGV4dENvbnRlbnRJdGVtLnByZXZUcmFuc2Zvcm0sIHRleHRPcmllbnRhdGlvbikpIHsKICAgICAgICAgIGlmICh0ZXh0Q29udGVudEl0ZW0uc3RyLmxlbmd0aCA9PT0gMCkgewogICAgICAgICAgICByZXNldExhc3RDaGFycygpOwogICAgICAgICAgICBwdXNoV2hpdGVzcGFjZSh7CiAgICAgICAgICAgICAgaGVpZ2h0OiBNYXRoLmFicyhhZHZhbmNlWSkKICAgICAgICAgICAgfSk7CiAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICB0ZXh0Q29udGVudEl0ZW0uaGVpZ2h0ICs9IGFkdmFuY2VZOwogICAgICAgICAgfQogICAgICAgIH0KICAgICAgICBpZiAoTWF0aC5hYnMoYWR2YW5jZVgpID4gdGV4dENvbnRlbnRJdGVtLndpZHRoICogVkVSVElDQUxfU0hJRlRfUkFUSU8pIHsKICAgICAgICAgIGZsdXNoVGV4dENvbnRlbnRJdGVtKCk7CiAgICAgICAgfQogICAgICAgIHJldHVybiB0cnVlOwogICAgICB9CiAgICAgIGNvbnN0IGFkdmFuY2VYID0gKHBvc1ggLSBsYXN0UG9zWCkgLyB0ZXh0Q29udGVudEl0ZW0udGV4dEFkdmFuY2VTY2FsZTsKICAgICAgY29uc3QgYWR2YW5jZVkgPSBwb3NZIC0gbGFzdFBvc1k7CiAgICAgIGNvbnN0IHRleHRPcmllbnRhdGlvbiA9IE1hdGguc2lnbih0ZXh0Q29udGVudEl0ZW0ud2lkdGgpOwogICAgICBpZiAoYWR2YW5jZVggPCB0ZXh0T3JpZW50YXRpb24gKiB0ZXh0Q29udGVudEl0ZW0ubmVnYXRpdmVTcGFjZU1heCkgewogICAgICAgIGlmIChNYXRoLmFicyhhZHZhbmNlWSkgPiAwLjUgKiB0ZXh0Q29udGVudEl0ZW0uaGVpZ2h0KSB7CiAgICAgICAgICBhcHBlbmRFT0woKTsKICAgICAgICAgIHJldHVybiB0cnVlOwogICAgICAgIH0KICAgICAgICByZXNldExhc3RDaGFycygpOwogICAgICAgIGZsdXNoVGV4dENvbnRlbnRJdGVtKCk7CiAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgIH0KICAgICAgaWYgKE1hdGguYWJzKGFkdmFuY2VZKSA+IHRleHRDb250ZW50SXRlbS5oZWlnaHQpIHsKICAgICAgICBhcHBlbmRFT0woKTsKICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgfQogICAgICBpZiAoYWR2YW5jZVggPD0gdGV4dE9yaWVudGF0aW9uICogdGV4dENvbnRlbnRJdGVtLm5vdEFTcGFjZSkgewogICAgICAgIHJlc2V0TGFzdENoYXJzKCk7CiAgICAgIH0KICAgICAgaWYgKGFkdmFuY2VYIDw9IHRleHRPcmllbnRhdGlvbiAqIHRleHRDb250ZW50SXRlbS50cmFja2luZ1NwYWNlTWluKSB7CiAgICAgICAgaWYgKHNob3VsZEFkZFdoaXRlcHNhY2UoKSkgewogICAgICAgICAgcmVzZXRMYXN0Q2hhcnMoKTsKICAgICAgICAgIGZsdXNoVGV4dENvbnRlbnRJdGVtKCk7CiAgICAgICAgICBwdXNoV2hpdGVzcGFjZSh7CiAgICAgICAgICAgIHdpZHRoOiBNYXRoLmFicyhhZHZhbmNlWCkKICAgICAgICAgIH0pOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICB0ZXh0Q29udGVudEl0ZW0ud2lkdGggKz0gYWR2YW5jZVg7CiAgICAgICAgfQogICAgICB9IGVsc2UgaWYgKCFhZGRGYWtlU3BhY2VzKGFkdmFuY2VYLCB0ZXh0Q29udGVudEl0ZW0ucHJldlRyYW5zZm9ybSwgdGV4dE9yaWVudGF0aW9uKSkgewogICAgICAgIGlmICh0ZXh0Q29udGVudEl0ZW0uc3RyLmxlbmd0aCA9PT0gMCkgewogICAgICAgICAgcmVzZXRMYXN0Q2hhcnMoKTsKICAgICAgICAgIHB1c2hXaGl0ZXNwYWNlKHsKICAgICAgICAgICAgd2lkdGg6IE1hdGguYWJzKGFkdmFuY2VYKQogICAgICAgICAgfSk7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIHRleHRDb250ZW50SXRlbS53aWR0aCArPSBhZHZhbmNlWDsKICAgICAgICB9CiAgICAgIH0KICAgICAgaWYgKE1hdGguYWJzKGFkdmFuY2VZKSA+IHRleHRDb250ZW50SXRlbS5oZWlnaHQgKiBWRVJUSUNBTF9TSElGVF9SQVRJTykgewogICAgICAgIGZsdXNoVGV4dENvbnRlbnRJdGVtKCk7CiAgICAgIH0KICAgICAgcmV0dXJuIHRydWU7CiAgICB9CiAgICBmdW5jdGlvbiBidWlsZFRleHRDb250ZW50SXRlbSh7CiAgICAgIGNoYXJzLAogICAgICBleHRyYVNwYWNpbmcKICAgIH0pIHsKICAgICAgY29uc3QgZm9udCA9IHRleHRTdGF0ZS5mb250OwogICAgICBpZiAoIWNoYXJzKSB7CiAgICAgICAgY29uc3QgY2hhclNwYWNpbmcgPSB0ZXh0U3RhdGUuY2hhclNwYWNpbmcgKyBleHRyYVNwYWNpbmc7CiAgICAgICAgaWYgKGNoYXJTcGFjaW5nKSB7CiAgICAgICAgICBpZiAoIWZvbnQudmVydGljYWwpIHsKICAgICAgICAgICAgdGV4dFN0YXRlLnRyYW5zbGF0ZVRleHRNYXRyaXgoY2hhclNwYWNpbmcgKiB0ZXh0U3RhdGUudGV4dEhTY2FsZSwgMCk7CiAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICB0ZXh0U3RhdGUudHJhbnNsYXRlVGV4dE1hdHJpeCgwLCAtY2hhclNwYWNpbmcpOwogICAgICAgICAgfQogICAgICAgIH0KICAgICAgICByZXR1cm47CiAgICAgIH0KICAgICAgY29uc3QgZ2x5cGhzID0gZm9udC5jaGFyc1RvR2x5cGhzKGNoYXJzKTsKICAgICAgY29uc3Qgc2NhbGUgPSB0ZXh0U3RhdGUuZm9udE1hdHJpeFswXSAqIHRleHRTdGF0ZS5mb250U2l6ZTsKICAgICAgZm9yIChsZXQgaSA9IDAsIGlpID0gZ2x5cGhzLmxlbmd0aDsgaSA8IGlpOyBpKyspIHsKICAgICAgICBjb25zdCBnbHlwaCA9IGdseXBoc1tpXTsKICAgICAgICBjb25zdCB7CiAgICAgICAgICBjYXRlZ29yeQogICAgICAgIH0gPSBnbHlwaDsKICAgICAgICBpZiAoY2F0ZWdvcnkuaXNJbnZpc2libGVGb3JtYXRNYXJrKSB7CiAgICAgICAgICBjb250aW51ZTsKICAgICAgICB9CiAgICAgICAgbGV0IGNoYXJTcGFjaW5nID0gdGV4dFN0YXRlLmNoYXJTcGFjaW5nICsgKGkgKyAxID09PSBpaSA/IGV4dHJhU3BhY2luZyA6IDApOwogICAgICAgIGxldCBnbHlwaFdpZHRoID0gZ2x5cGgud2lkdGg7CiAgICAgICAgaWYgKGZvbnQudmVydGljYWwpIHsKICAgICAgICAgIGdseXBoV2lkdGggPSBnbHlwaC52bWV0cmljID8gZ2x5cGgudm1ldHJpY1swXSA6IC1nbHlwaFdpZHRoOwogICAgICAgIH0KICAgICAgICBsZXQgc2NhbGVkRGltID0gZ2x5cGhXaWR0aCAqIHNjYWxlOwogICAgICAgIGlmIChjYXRlZ29yeS5pc1doaXRlc3BhY2UpIHsKICAgICAgICAgIGlmICghZm9udC52ZXJ0aWNhbCkgewogICAgICAgICAgICBjaGFyU3BhY2luZyArPSBzY2FsZWREaW0gKyB0ZXh0U3RhdGUud29yZFNwYWNpbmc7CiAgICAgICAgICAgIHRleHRTdGF0ZS50cmFuc2xhdGVUZXh0TWF0cml4KGNoYXJTcGFjaW5nICogdGV4dFN0YXRlLnRleHRIU2NhbGUsIDApOwogICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgY2hhclNwYWNpbmcgKz0gLXNjYWxlZERpbSArIHRleHRTdGF0ZS53b3JkU3BhY2luZzsKICAgICAgICAgICAgdGV4dFN0YXRlLnRyYW5zbGF0ZVRleHRNYXRyaXgoMCwgLWNoYXJTcGFjaW5nKTsKICAgICAgICAgIH0KICAgICAgICAgIHNhdmVMYXN0Q2hhcigiICIpOwogICAgICAgICAgY29udGludWU7CiAgICAgICAgfQogICAgICAgIGlmICghY2F0ZWdvcnkuaXNaZXJvV2lkdGhEaWFjcml0aWMgJiYgIWNvbXBhcmVXaXRoTGFzdFBvc2l0aW9uKHNjYWxlZERpbSkpIHsKICAgICAgICAgIGlmICghZm9udC52ZXJ0aWNhbCkgewogICAgICAgICAgICB0ZXh0U3RhdGUudHJhbnNsYXRlVGV4dE1hdHJpeChzY2FsZWREaW0gKiB0ZXh0U3RhdGUudGV4dEhTY2FsZSwgMCk7CiAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICB0ZXh0U3RhdGUudHJhbnNsYXRlVGV4dE1hdHJpeCgwLCBzY2FsZWREaW0pOwogICAgICAgICAgfQogICAgICAgICAgY29udGludWU7CiAgICAgICAgfQogICAgICAgIGNvbnN0IHRleHRDaHVuayA9IGVuc3VyZVRleHRDb250ZW50SXRlbSgpOwogICAgICAgIGlmIChjYXRlZ29yeS5pc1plcm9XaWR0aERpYWNyaXRpYykgewogICAgICAgICAgc2NhbGVkRGltID0gMDsKICAgICAgICB9CiAgICAgICAgaWYgKCFmb250LnZlcnRpY2FsKSB7CiAgICAgICAgICBzY2FsZWREaW0gKj0gdGV4dFN0YXRlLnRleHRIU2NhbGU7CiAgICAgICAgICB0ZXh0U3RhdGUudHJhbnNsYXRlVGV4dE1hdHJpeChzY2FsZWREaW0sIDApOwogICAgICAgICAgdGV4dENodW5rLndpZHRoICs9IHNjYWxlZERpbTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgdGV4dFN0YXRlLnRyYW5zbGF0ZVRleHRNYXRyaXgoMCwgc2NhbGVkRGltKTsKICAgICAgICAgIHNjYWxlZERpbSA9IE1hdGguYWJzKHNjYWxlZERpbSk7CiAgICAgICAgICB0ZXh0Q2h1bmsuaGVpZ2h0ICs9IHNjYWxlZERpbTsKICAgICAgICB9CiAgICAgICAgaWYgKHNjYWxlZERpbSkgewogICAgICAgICAgdGV4dENodW5rLnByZXZUcmFuc2Zvcm0gPSBnZXRDdXJyZW50VGV4dFRyYW5zZm9ybSgpOwogICAgICAgIH0KICAgICAgICBjb25zdCBnbHlwaFVuaWNvZGUgPSBnbHlwaC51bmljb2RlOwogICAgICAgIGlmIChzYXZlTGFzdENoYXIoZ2x5cGhVbmljb2RlKSkgewogICAgICAgICAgdGV4dENodW5rLnN0ci5wdXNoKCIgIik7CiAgICAgICAgfQogICAgICAgIHRleHRDaHVuay5zdHIucHVzaChnbHlwaFVuaWNvZGUpOwogICAgICAgIGlmIChjaGFyU3BhY2luZykgewogICAgICAgICAgaWYgKCFmb250LnZlcnRpY2FsKSB7CiAgICAgICAgICAgIHRleHRTdGF0ZS50cmFuc2xhdGVUZXh0TWF0cml4KGNoYXJTcGFjaW5nICogdGV4dFN0YXRlLnRleHRIU2NhbGUsIDApOwogICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgdGV4dFN0YXRlLnRyYW5zbGF0ZVRleHRNYXRyaXgoMCwgLWNoYXJTcGFjaW5nKTsKICAgICAgICAgIH0KICAgICAgICB9CiAgICAgIH0KICAgIH0KICAgIGZ1bmN0aW9uIGFwcGVuZEVPTCgpIHsKICAgICAgcmVzZXRMYXN0Q2hhcnMoKTsKICAgICAgaWYgKHRleHRDb250ZW50SXRlbS5pbml0aWFsaXplZCkgewogICAgICAgIHRleHRDb250ZW50SXRlbS5oYXNFT0wgPSB0cnVlOwogICAgICAgIGZsdXNoVGV4dENvbnRlbnRJdGVtKCk7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgdGV4dENvbnRlbnQuaXRlbXMucHVzaCh7CiAgICAgICAgICBzdHI6ICIiLAogICAgICAgICAgZGlyOiAibHRyIiwKICAgICAgICAgIHdpZHRoOiAwLAogICAgICAgICAgaGVpZ2h0OiAwLAogICAgICAgICAgdHJhbnNmb3JtOiBnZXRDdXJyZW50VGV4dFRyYW5zZm9ybSgpLAogICAgICAgICAgZm9udE5hbWU6IHRleHRTdGF0ZS5sb2FkZWROYW1lLAogICAgICAgICAgaGFzRU9MOiB0cnVlCiAgICAgICAgfSk7CiAgICAgIH0KICAgIH0KICAgIGZ1bmN0aW9uIGFkZEZha2VTcGFjZXMod2lkdGgsIHRyYW5zZiwgdGV4dE9yaWVudGF0aW9uKSB7CiAgICAgIGlmICh0ZXh0T3JpZW50YXRpb24gKiB0ZXh0Q29udGVudEl0ZW0uc3BhY2VJbkZsb3dNaW4gPD0gd2lkdGggJiYgd2lkdGggPD0gdGV4dE9yaWVudGF0aW9uICogdGV4dENvbnRlbnRJdGVtLnNwYWNlSW5GbG93TWF4KSB7CiAgICAgICAgaWYgKHRleHRDb250ZW50SXRlbS5pbml0aWFsaXplZCkgewogICAgICAgICAgcmVzZXRMYXN0Q2hhcnMoKTsKICAgICAgICAgIHRleHRDb250ZW50SXRlbS5zdHIucHVzaCgiICIpOwogICAgICAgIH0KICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgIH0KICAgICAgY29uc3QgZm9udE5hbWUgPSB0ZXh0Q29udGVudEl0ZW0uZm9udE5hbWU7CiAgICAgIGxldCBoZWlnaHQgPSAwOwogICAgICBpZiAodGV4dENvbnRlbnRJdGVtLnZlcnRpY2FsKSB7CiAgICAgICAgaGVpZ2h0ID0gd2lkdGg7CiAgICAgICAgd2lkdGggPSAwOwogICAgICB9CiAgICAgIGZsdXNoVGV4dENvbnRlbnRJdGVtKCk7CiAgICAgIHJlc2V0TGFzdENoYXJzKCk7CiAgICAgIHB1c2hXaGl0ZXNwYWNlKHsKICAgICAgICB3aWR0aDogTWF0aC5hYnMod2lkdGgpLAogICAgICAgIGhlaWdodDogTWF0aC5hYnMoaGVpZ2h0KSwKICAgICAgICB0cmFuc2Zvcm06IHRyYW5zZiB8fCBnZXRDdXJyZW50VGV4dFRyYW5zZm9ybSgpLAogICAgICAgIGZvbnROYW1lCiAgICAgIH0pOwogICAgICByZXR1cm4gdHJ1ZTsKICAgIH0KICAgIGZ1bmN0aW9uIGZsdXNoVGV4dENvbnRlbnRJdGVtKCkgewogICAgICBpZiAoIXRleHRDb250ZW50SXRlbS5pbml0aWFsaXplZCB8fCAhdGV4dENvbnRlbnRJdGVtLnN0cikgewogICAgICAgIHJldHVybjsKICAgICAgfQogICAgICBpZiAoIXRleHRDb250ZW50SXRlbS52ZXJ0aWNhbCkgewogICAgICAgIHRleHRDb250ZW50SXRlbS50b3RhbFdpZHRoICs9IHRleHRDb250ZW50SXRlbS53aWR0aCAqIHRleHRDb250ZW50SXRlbS50ZXh0QWR2YW5jZVNjYWxlOwogICAgICB9IGVsc2UgewogICAgICAgIHRleHRDb250ZW50SXRlbS50b3RhbEhlaWdodCArPSB0ZXh0Q29udGVudEl0ZW0uaGVpZ2h0ICogdGV4dENvbnRlbnRJdGVtLnRleHRBZHZhbmNlU2NhbGU7CiAgICAgIH0KICAgICAgdGV4dENvbnRlbnQuaXRlbXMucHVzaChydW5CaWRpVHJhbnNmb3JtKHRleHRDb250ZW50SXRlbSkpOwogICAgICB0ZXh0Q29udGVudEl0ZW0uaW5pdGlhbGl6ZWQgPSBmYWxzZTsKICAgICAgdGV4dENvbnRlbnRJdGVtLnN0ci5sZW5ndGggPSAwOwogICAgfQogICAgZnVuY3Rpb24gZW5xdWV1ZUNodW5rKGJhdGNoID0gZmFsc2UpIHsKICAgICAgY29uc3QgbGVuZ3RoID0gdGV4dENvbnRlbnQuaXRlbXMubGVuZ3RoOwogICAgICBpZiAobGVuZ3RoID09PSAwKSB7CiAgICAgICAgcmV0dXJuOwogICAgICB9CiAgICAgIGlmIChiYXRjaCAmJiBsZW5ndGggPCBURVhUX0NIVU5LX0JBVENIX1NJWkUpIHsKICAgICAgICByZXR1cm47CiAgICAgIH0KICAgICAgc2luay5lbnF1ZXVlKHRleHRDb250ZW50LCBsZW5ndGgpOwogICAgICB0ZXh0Q29udGVudC5pdGVtcyA9IFtdOwogICAgICB0ZXh0Q29udGVudC5zdHlsZXMgPSBPYmplY3QuY3JlYXRlKG51bGwpOwogICAgfQogICAgY29uc3QgdGltZVNsb3RNYW5hZ2VyID0gbmV3IFRpbWVTbG90TWFuYWdlcigpOwogICAgcmV0dXJuIG5ldyBQcm9taXNlKGZ1bmN0aW9uIHByb21pc2VCb2R5KHJlc29sdmUsIHJlamVjdCkgewogICAgICBjb25zdCBuZXh0ID0gZnVuY3Rpb24gKHByb21pc2UpIHsKICAgICAgICBlbnF1ZXVlQ2h1bmsodHJ1ZSk7CiAgICAgICAgUHJvbWlzZS5hbGwoW3Byb21pc2UsIHNpbmsucmVhZHldKS50aGVuKGZ1bmN0aW9uICgpIHsKICAgICAgICAgIHRyeSB7CiAgICAgICAgICAgIHByb21pc2VCb2R5KHJlc29sdmUsIHJlamVjdCk7CiAgICAgICAgICB9IGNhdGNoIChleCkgewogICAgICAgICAgICByZWplY3QoZXgpOwogICAgICAgICAgfQogICAgICAgIH0sIHJlamVjdCk7CiAgICAgIH07CiAgICAgIHRhc2suZW5zdXJlTm90VGVybWluYXRlZCgpOwogICAgICB0aW1lU2xvdE1hbmFnZXIucmVzZXQoKTsKICAgICAgY29uc3Qgb3BlcmF0aW9uID0ge307CiAgICAgIGxldCBzdG9wLAogICAgICAgIGFyZ3MgPSBbXTsKICAgICAgd2hpbGUgKCEoc3RvcCA9IHRpbWVTbG90TWFuYWdlci5jaGVjaygpKSkgewogICAgICAgIGFyZ3MubGVuZ3RoID0gMDsKICAgICAgICBvcGVyYXRpb24uYXJncyA9IGFyZ3M7CiAgICAgICAgaWYgKCFwcmVwcm9jZXNzb3IucmVhZChvcGVyYXRpb24pKSB7CiAgICAgICAgICBicmVhazsKICAgICAgICB9CiAgICAgICAgY29uc3QgcHJldmlvdXNTdGF0ZSA9IHRleHRTdGF0ZTsKICAgICAgICB0ZXh0U3RhdGUgPSBzdGF0ZU1hbmFnZXIuc3RhdGU7CiAgICAgICAgY29uc3QgZm4gPSBvcGVyYXRpb24uZm47CiAgICAgICAgYXJncyA9IG9wZXJhdGlvbi5hcmdzOwogICAgICAgIHN3aXRjaCAoZm4gfCAwKSB7CiAgICAgICAgICBjYXNlIF91dGlsLk9QUy5zZXRGb250OgogICAgICAgICAgICB2YXIgZm9udE5hbWVBcmcgPSBhcmdzWzBdLm5hbWUsCiAgICAgICAgICAgICAgZm9udFNpemVBcmcgPSBhcmdzWzFdOwogICAgICAgICAgICBpZiAodGV4dFN0YXRlLmZvbnQgJiYgZm9udE5hbWVBcmcgPT09IHRleHRTdGF0ZS5mb250TmFtZSAmJiBmb250U2l6ZUFyZyA9PT0gdGV4dFN0YXRlLmZvbnRTaXplKSB7CiAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgZmx1c2hUZXh0Q29udGVudEl0ZW0oKTsKICAgICAgICAgICAgdGV4dFN0YXRlLmZvbnROYW1lID0gZm9udE5hbWVBcmc7CiAgICAgICAgICAgIHRleHRTdGF0ZS5mb250U2l6ZSA9IGZvbnRTaXplQXJnOwogICAgICAgICAgICBuZXh0KGhhbmRsZVNldEZvbnQoZm9udE5hbWVBcmcsIG51bGwpKTsKICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgY2FzZSBfdXRpbC5PUFMuc2V0VGV4dFJpc2U6CiAgICAgICAgICAgIHRleHRTdGF0ZS50ZXh0UmlzZSA9IGFyZ3NbMF07CiAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgY2FzZSBfdXRpbC5PUFMuc2V0SFNjYWxlOgogICAgICAgICAgICB0ZXh0U3RhdGUudGV4dEhTY2FsZSA9IGFyZ3NbMF0gLyAxMDA7CiAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgY2FzZSBfdXRpbC5PUFMuc2V0TGVhZGluZzoKICAgICAgICAgICAgdGV4dFN0YXRlLmxlYWRpbmcgPSBhcmdzWzBdOwogICAgICAgICAgICBicmVhazsKICAgICAgICAgIGNhc2UgX3V0aWwuT1BTLm1vdmVUZXh0OgogICAgICAgICAgICB0ZXh0U3RhdGUudHJhbnNsYXRlVGV4dExpbmVNYXRyaXgoYXJnc1swXSwgYXJnc1sxXSk7CiAgICAgICAgICAgIHRleHRTdGF0ZS50ZXh0TWF0cml4ID0gdGV4dFN0YXRlLnRleHRMaW5lTWF0cml4LnNsaWNlKCk7CiAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgY2FzZSBfdXRpbC5PUFMuc2V0TGVhZGluZ01vdmVUZXh0OgogICAgICAgICAgICB0ZXh0U3RhdGUubGVhZGluZyA9IC1hcmdzWzFdOwogICAgICAgICAgICB0ZXh0U3RhdGUudHJhbnNsYXRlVGV4dExpbmVNYXRyaXgoYXJnc1swXSwgYXJnc1sxXSk7CiAgICAgICAgICAgIHRleHRTdGF0ZS50ZXh0TWF0cml4ID0gdGV4dFN0YXRlLnRleHRMaW5lTWF0cml4LnNsaWNlKCk7CiAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgY2FzZSBfdXRpbC5PUFMubmV4dExpbmU6CiAgICAgICAgICAgIHRleHRTdGF0ZS5jYXJyaWFnZVJldHVybigpOwogICAgICAgICAgICBicmVhazsKICAgICAgICAgIGNhc2UgX3V0aWwuT1BTLnNldFRleHRNYXRyaXg6CiAgICAgICAgICAgIHRleHRTdGF0ZS5zZXRUZXh0TWF0cml4KGFyZ3NbMF0sIGFyZ3NbMV0sIGFyZ3NbMl0sIGFyZ3NbM10sIGFyZ3NbNF0sIGFyZ3NbNV0pOwogICAgICAgICAgICB0ZXh0U3RhdGUuc2V0VGV4dExpbmVNYXRyaXgoYXJnc1swXSwgYXJnc1sxXSwgYXJnc1syXSwgYXJnc1szXSwgYXJnc1s0XSwgYXJnc1s1XSk7CiAgICAgICAgICAgIHVwZGF0ZUFkdmFuY2VTY2FsZSgpOwogICAgICAgICAgICBicmVhazsKICAgICAgICAgIGNhc2UgX3V0aWwuT1BTLnNldENoYXJTcGFjaW5nOgogICAgICAgICAgICB0ZXh0U3RhdGUuY2hhclNwYWNpbmcgPSBhcmdzWzBdOwogICAgICAgICAgICBicmVhazsKICAgICAgICAgIGNhc2UgX3V0aWwuT1BTLnNldFdvcmRTcGFjaW5nOgogICAgICAgICAgICB0ZXh0U3RhdGUud29yZFNwYWNpbmcgPSBhcmdzWzBdOwogICAgICAgICAgICBicmVhazsKICAgICAgICAgIGNhc2UgX3V0aWwuT1BTLmJlZ2luVGV4dDoKICAgICAgICAgICAgdGV4dFN0YXRlLnRleHRNYXRyaXggPSBfdXRpbC5JREVOVElUWV9NQVRSSVguc2xpY2UoKTsKICAgICAgICAgICAgdGV4dFN0YXRlLnRleHRMaW5lTWF0cml4ID0gX3V0aWwuSURFTlRJVFlfTUFUUklYLnNsaWNlKCk7CiAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgY2FzZSBfdXRpbC5PUFMuc2hvd1NwYWNlZFRleHQ6CiAgICAgICAgICAgIGlmICghc3RhdGVNYW5hZ2VyLnN0YXRlLmZvbnQpIHsKICAgICAgICAgICAgICBzZWxmLmVuc3VyZVN0YXRlRm9udChzdGF0ZU1hbmFnZXIuc3RhdGUpOwogICAgICAgICAgICAgIGNvbnRpbnVlOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGNvbnN0IHNwYWNlRmFjdG9yID0gKHRleHRTdGF0ZS5mb250LnZlcnRpY2FsID8gMSA6IC0xKSAqIHRleHRTdGF0ZS5mb250U2l6ZSAvIDEwMDA7CiAgICAgICAgICAgIGNvbnN0IGVsZW1lbnRzID0gYXJnc1swXTsKICAgICAgICAgICAgZm9yIChsZXQgaSA9IDAsIGlpID0gZWxlbWVudHMubGVuZ3RoOyBpIDwgaWk7IGkrKykgewogICAgICAgICAgICAgIGNvbnN0IGl0ZW0gPSBlbGVtZW50c1tpXTsKICAgICAgICAgICAgICBpZiAodHlwZW9mIGl0ZW0gPT09ICJzdHJpbmciKSB7CiAgICAgICAgICAgICAgICBzaG93U3BhY2VkVGV4dEJ1ZmZlci5wdXNoKGl0ZW0pOwogICAgICAgICAgICAgIH0gZWxzZSBpZiAodHlwZW9mIGl0ZW0gPT09ICJudW1iZXIiICYmIGl0ZW0gIT09IDApIHsKICAgICAgICAgICAgICAgIGNvbnN0IHN0ciA9IHNob3dTcGFjZWRUZXh0QnVmZmVyLmpvaW4oIiIpOwogICAgICAgICAgICAgICAgc2hvd1NwYWNlZFRleHRCdWZmZXIubGVuZ3RoID0gMDsKICAgICAgICAgICAgICAgIGJ1aWxkVGV4dENvbnRlbnRJdGVtKHsKICAgICAgICAgICAgICAgICAgY2hhcnM6IHN0ciwKICAgICAgICAgICAgICAgICAgZXh0cmFTcGFjaW5nOiBpdGVtICogc3BhY2VGYWN0b3IKICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgICAgICBpZiAoc2hvd1NwYWNlZFRleHRCdWZmZXIubGVuZ3RoID4gMCkgewogICAgICAgICAgICAgIGNvbnN0IHN0ciA9IHNob3dTcGFjZWRUZXh0QnVmZmVyLmpvaW4oIiIpOwogICAgICAgICAgICAgIHNob3dTcGFjZWRUZXh0QnVmZmVyLmxlbmd0aCA9IDA7CiAgICAgICAgICAgICAgYnVpbGRUZXh0Q29udGVudEl0ZW0oewogICAgICAgICAgICAgICAgY2hhcnM6IHN0ciwKICAgICAgICAgICAgICAgIGV4dHJhU3BhY2luZzogMAogICAgICAgICAgICAgIH0pOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgY2FzZSBfdXRpbC5PUFMuc2hvd1RleHQ6CiAgICAgICAgICAgIGlmICghc3RhdGVNYW5hZ2VyLnN0YXRlLmZvbnQpIHsKICAgICAgICAgICAgICBzZWxmLmVuc3VyZVN0YXRlRm9udChzdGF0ZU1hbmFnZXIuc3RhdGUpOwogICAgICAgICAgICAgIGNvbnRpbnVlOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGJ1aWxkVGV4dENvbnRlbnRJdGVtKHsKICAgICAgICAgICAgICBjaGFyczogYXJnc1swXSwKICAgICAgICAgICAgICBleHRyYVNwYWNpbmc6IDAKICAgICAgICAgICAgfSk7CiAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgY2FzZSBfdXRpbC5PUFMubmV4dExpbmVTaG93VGV4dDoKICAgICAgICAgICAgaWYgKCFzdGF0ZU1hbmFnZXIuc3RhdGUuZm9udCkgewogICAgICAgICAgICAgIHNlbGYuZW5zdXJlU3RhdGVGb250KHN0YXRlTWFuYWdlci5zdGF0ZSk7CiAgICAgICAgICAgICAgY29udGludWU7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgdGV4dFN0YXRlLmNhcnJpYWdlUmV0dXJuKCk7CiAgICAgICAgICAgIGJ1aWxkVGV4dENvbnRlbnRJdGVtKHsKICAgICAgICAgICAgICBjaGFyczogYXJnc1swXSwKICAgICAgICAgICAgICBleHRyYVNwYWNpbmc6IDAKICAgICAgICAgICAgfSk7CiAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgY2FzZSBfdXRpbC5PUFMubmV4dExpbmVTZXRTcGFjaW5nU2hvd1RleHQ6CiAgICAgICAgICAgIGlmICghc3RhdGVNYW5hZ2VyLnN0YXRlLmZvbnQpIHsKICAgICAgICAgICAgICBzZWxmLmVuc3VyZVN0YXRlRm9udChzdGF0ZU1hbmFnZXIuc3RhdGUpOwogICAgICAgICAgICAgIGNvbnRpbnVlOwogICAgICAgICAgICB9CiAgICAgICAgICAgIHRleHRTdGF0ZS53b3JkU3BhY2luZyA9IGFyZ3NbMF07CiAgICAgICAgICAgIHRleHRTdGF0ZS5jaGFyU3BhY2luZyA9IGFyZ3NbMV07CiAgICAgICAgICAgIHRleHRTdGF0ZS5jYXJyaWFnZVJldHVybigpOwogICAgICAgICAgICBidWlsZFRleHRDb250ZW50SXRlbSh7CiAgICAgICAgICAgICAgY2hhcnM6IGFyZ3NbMl0sCiAgICAgICAgICAgICAgZXh0cmFTcGFjaW5nOiAwCiAgICAgICAgICAgIH0pOwogICAgICAgICAgICBicmVhazsKICAgICAgICAgIGNhc2UgX3V0aWwuT1BTLnBhaW50WE9iamVjdDoKICAgICAgICAgICAgZmx1c2hUZXh0Q29udGVudEl0ZW0oKTsKICAgICAgICAgICAgaWYgKCF4b2JqcykgewogICAgICAgICAgICAgIHhvYmpzID0gcmVzb3VyY2VzLmdldCgiWE9iamVjdCIpIHx8IF9wcmltaXRpdmVzLkRpY3QuZW1wdHk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgdmFyIGlzVmFsaWROYW1lID0gYXJnc1swXSBpbnN0YW5jZW9mIF9wcmltaXRpdmVzLk5hbWU7CiAgICAgICAgICAgIHZhciBuYW1lID0gYXJnc1swXS5uYW1lOwogICAgICAgICAgICBpZiAoaXNWYWxpZE5hbWUgJiYgZW1wdHlYT2JqZWN0Q2FjaGUuZ2V0QnlOYW1lKG5hbWUpKSB7CiAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgbmV4dChuZXcgUHJvbWlzZShmdW5jdGlvbiAocmVzb2x2ZVhPYmplY3QsIHJlamVjdFhPYmplY3QpIHsKICAgICAgICAgICAgICBpZiAoIWlzVmFsaWROYW1lKSB7CiAgICAgICAgICAgICAgICB0aHJvdyBuZXcgX3V0aWwuRm9ybWF0RXJyb3IoIlhPYmplY3QgbXVzdCBiZSByZWZlcnJlZCB0byBieSBuYW1lLiIpOwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgICBsZXQgeG9iaiA9IHhvYmpzLmdldFJhdyhuYW1lKTsKICAgICAgICAgICAgICBpZiAoeG9iaiBpbnN0YW5jZW9mIF9wcmltaXRpdmVzLlJlZikgewogICAgICAgICAgICAgICAgaWYgKGVtcHR5WE9iamVjdENhY2hlLmdldEJ5UmVmKHhvYmopKSB7CiAgICAgICAgICAgICAgICAgIHJlc29sdmVYT2JqZWN0KCk7CiAgICAgICAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIGNvbnN0IGdsb2JhbEltYWdlID0gc2VsZi5nbG9iYWxJbWFnZUNhY2hlLmdldERhdGEoeG9iaiwgc2VsZi5wYWdlSW5kZXgpOwogICAgICAgICAgICAgICAgaWYgKGdsb2JhbEltYWdlKSB7CiAgICAgICAgICAgICAgICAgIHJlc29sdmVYT2JqZWN0KCk7CiAgICAgICAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIHhvYmogPSB4cmVmLmZldGNoKHhvYmopOwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgICBpZiAoISh4b2JqIGluc3RhbmNlb2YgX2Jhc2Vfc3RyZWFtLkJhc2VTdHJlYW0pKSB7CiAgICAgICAgICAgICAgICB0aHJvdyBuZXcgX3V0aWwuRm9ybWF0RXJyb3IoIlhPYmplY3Qgc2hvdWxkIGJlIGEgc3RyZWFtIik7CiAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIGNvbnN0IHR5cGUgPSB4b2JqLmRpY3QuZ2V0KCJTdWJ0eXBlIik7CiAgICAgICAgICAgICAgaWYgKCEodHlwZSBpbnN0YW5jZW9mIF9wcmltaXRpdmVzLk5hbWUpKSB7CiAgICAgICAgICAgICAgICB0aHJvdyBuZXcgX3V0aWwuRm9ybWF0RXJyb3IoIlhPYmplY3Qgc2hvdWxkIGhhdmUgYSBOYW1lIHN1YnR5cGUiKTsKICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgaWYgKHR5cGUubmFtZSAhPT0gIkZvcm0iKSB7CiAgICAgICAgICAgICAgICBlbXB0eVhPYmplY3RDYWNoZS5zZXQobmFtZSwgeG9iai5kaWN0Lm9iaklkLCB0cnVlKTsKICAgICAgICAgICAgICAgIHJlc29sdmVYT2JqZWN0KCk7CiAgICAgICAgICAgICAgICByZXR1cm47CiAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIGNvbnN0IGN1cnJlbnRTdGF0ZSA9IHN0YXRlTWFuYWdlci5zdGF0ZS5jbG9uZSgpOwogICAgICAgICAgICAgIGNvbnN0IHhPYmpTdGF0ZU1hbmFnZXIgPSBuZXcgU3RhdGVNYW5hZ2VyKGN1cnJlbnRTdGF0ZSk7CiAgICAgICAgICAgICAgY29uc3QgbWF0cml4ID0geG9iai5kaWN0LmdldEFycmF5KCJNYXRyaXgiKTsKICAgICAgICAgICAgICBpZiAoQXJyYXkuaXNBcnJheShtYXRyaXgpICYmIG1hdHJpeC5sZW5ndGggPT09IDYpIHsKICAgICAgICAgICAgICAgIHhPYmpTdGF0ZU1hbmFnZXIudHJhbnNmb3JtKG1hdHJpeCk7CiAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIGVucXVldWVDaHVuaygpOwogICAgICAgICAgICAgIGNvbnN0IHNpbmtXcmFwcGVyID0gewogICAgICAgICAgICAgICAgZW5xdWV1ZUludm9rZWQ6IGZhbHNlLAogICAgICAgICAgICAgICAgZW5xdWV1ZShjaHVuaywgc2l6ZSkgewogICAgICAgICAgICAgICAgICB0aGlzLmVucXVldWVJbnZva2VkID0gdHJ1ZTsKICAgICAgICAgICAgICAgICAgc2luay5lbnF1ZXVlKGNodW5rLCBzaXplKTsKICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICBnZXQgZGVzaXJlZFNpemUoKSB7CiAgICAgICAgICAgICAgICAgIHJldHVybiBzaW5rLmRlc2lyZWRTaXplOwogICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgIGdldCByZWFkeSgpIHsKICAgICAgICAgICAgICAgICAgcmV0dXJuIHNpbmsucmVhZHk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgfTsKICAgICAgICAgICAgICBzZWxmLmdldFRleHRDb250ZW50KHsKICAgICAgICAgICAgICAgIHN0cmVhbTogeG9iaiwKICAgICAgICAgICAgICAgIHRhc2ssCiAgICAgICAgICAgICAgICByZXNvdXJjZXM6IHhvYmouZGljdC5nZXQoIlJlc291cmNlcyIpIHx8IHJlc291cmNlcywKICAgICAgICAgICAgICAgIHN0YXRlTWFuYWdlcjogeE9ialN0YXRlTWFuYWdlciwKICAgICAgICAgICAgICAgIGluY2x1ZGVNYXJrZWRDb250ZW50LAogICAgICAgICAgICAgICAgc2luazogc2lua1dyYXBwZXIsCiAgICAgICAgICAgICAgICBzZWVuU3R5bGVzLAogICAgICAgICAgICAgICAgdmlld0JveCwKICAgICAgICAgICAgICAgIG1hcmtlZENvbnRlbnREYXRhLAogICAgICAgICAgICAgICAgZGlzYWJsZU5vcm1hbGl6YXRpb24KICAgICAgICAgICAgICB9KS50aGVuKGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgICAgIGlmICghc2lua1dyYXBwZXIuZW5xdWV1ZUludm9rZWQpIHsKICAgICAgICAgICAgICAgICAgZW1wdHlYT2JqZWN0Q2FjaGUuc2V0KG5hbWUsIHhvYmouZGljdC5vYmpJZCwgdHJ1ZSk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICByZXNvbHZlWE9iamVjdCgpOwogICAgICAgICAgICAgIH0sIHJlamVjdFhPYmplY3QpOwogICAgICAgICAgICB9KS5jYXRjaChmdW5jdGlvbiAocmVhc29uKSB7CiAgICAgICAgICAgICAgaWYgKHJlYXNvbiBpbnN0YW5jZW9mIF91dGlsLkFib3J0RXhjZXB0aW9uKSB7CiAgICAgICAgICAgICAgICByZXR1cm47CiAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIGlmIChzZWxmLm9wdGlvbnMuaWdub3JlRXJyb3JzKSB7CiAgICAgICAgICAgICAgICAoMCwgX3V0aWwud2FybikoYGdldFRleHRDb250ZW50IC0gaWdub3JpbmcgWE9iamVjdDogIiR7cmVhc29ufSIuYCk7CiAgICAgICAgICAgICAgICByZXR1cm47CiAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIHRocm93IHJlYXNvbjsKICAgICAgICAgICAgfSkpOwogICAgICAgICAgICByZXR1cm47CiAgICAgICAgICBjYXNlIF91dGlsLk9QUy5zZXRHU3RhdGU6CiAgICAgICAgICAgIGlzVmFsaWROYW1lID0gYXJnc1swXSBpbnN0YW5jZW9mIF9wcmltaXRpdmVzLk5hbWU7CiAgICAgICAgICAgIG5hbWUgPSBhcmdzWzBdLm5hbWU7CiAgICAgICAgICAgIGlmIChpc1ZhbGlkTmFtZSAmJiBlbXB0eUdTdGF0ZUNhY2hlLmdldEJ5TmFtZShuYW1lKSkgewogICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICB9CiAgICAgICAgICAgIG5leHQobmV3IFByb21pc2UoZnVuY3Rpb24gKHJlc29sdmVHU3RhdGUsIHJlamVjdEdTdGF0ZSkgewogICAgICAgICAgICAgIGlmICghaXNWYWxpZE5hbWUpIHsKICAgICAgICAgICAgICAgIHRocm93IG5ldyBfdXRpbC5Gb3JtYXRFcnJvcigiR1N0YXRlIG11c3QgYmUgcmVmZXJyZWQgdG8gYnkgbmFtZS4iKTsKICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgY29uc3QgZXh0R1N0YXRlID0gcmVzb3VyY2VzLmdldCgiRXh0R1N0YXRlIik7CiAgICAgICAgICAgICAgaWYgKCEoZXh0R1N0YXRlIGluc3RhbmNlb2YgX3ByaW1pdGl2ZXMuRGljdCkpIHsKICAgICAgICAgICAgICAgIHRocm93IG5ldyBfdXRpbC5Gb3JtYXRFcnJvcigiRXh0R1N0YXRlIHNob3VsZCBiZSBhIGRpY3Rpb25hcnkuIik7CiAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIGNvbnN0IGdTdGF0ZSA9IGV4dEdTdGF0ZS5nZXQobmFtZSk7CiAgICAgICAgICAgICAgaWYgKCEoZ1N0YXRlIGluc3RhbmNlb2YgX3ByaW1pdGl2ZXMuRGljdCkpIHsKICAgICAgICAgICAgICAgIHRocm93IG5ldyBfdXRpbC5Gb3JtYXRFcnJvcigiR1N0YXRlIHNob3VsZCBiZSBhIGRpY3Rpb25hcnkuIik7CiAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIGNvbnN0IGdTdGF0ZUZvbnQgPSBnU3RhdGUuZ2V0KCJGb250Iik7CiAgICAgICAgICAgICAgaWYgKCFnU3RhdGVGb250KSB7CiAgICAgICAgICAgICAgICBlbXB0eUdTdGF0ZUNhY2hlLnNldChuYW1lLCBnU3RhdGUub2JqSWQsIHRydWUpOwogICAgICAgICAgICAgICAgcmVzb2x2ZUdTdGF0ZSgpOwogICAgICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgICBmbHVzaFRleHRDb250ZW50SXRlbSgpOwogICAgICAgICAgICAgIHRleHRTdGF0ZS5mb250TmFtZSA9IG51bGw7CiAgICAgICAgICAgICAgdGV4dFN0YXRlLmZvbnRTaXplID0gZ1N0YXRlRm9udFsxXTsKICAgICAgICAgICAgICBoYW5kbGVTZXRGb250KG51bGwsIGdTdGF0ZUZvbnRbMF0pLnRoZW4ocmVzb2x2ZUdTdGF0ZSwgcmVqZWN0R1N0YXRlKTsKICAgICAgICAgICAgfSkuY2F0Y2goZnVuY3Rpb24gKHJlYXNvbikgewogICAgICAgICAgICAgIGlmIChyZWFzb24gaW5zdGFuY2VvZiBfdXRpbC5BYm9ydEV4Y2VwdGlvbikgewogICAgICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgICBpZiAoc2VsZi5vcHRpb25zLmlnbm9yZUVycm9ycykgewogICAgICAgICAgICAgICAgKDAsIF91dGlsLndhcm4pKGBnZXRUZXh0Q29udGVudCAtIGlnbm9yaW5nIEV4dEdTdGF0ZTogIiR7cmVhc29ufSIuYCk7CiAgICAgICAgICAgICAgICByZXR1cm47CiAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIHRocm93IHJlYXNvbjsKICAgICAgICAgICAgfSkpOwogICAgICAgICAgICByZXR1cm47CiAgICAgICAgICBjYXNlIF91dGlsLk9QUy5iZWdpbk1hcmtlZENvbnRlbnQ6CiAgICAgICAgICAgIGZsdXNoVGV4dENvbnRlbnRJdGVtKCk7CiAgICAgICAgICAgIGlmIChpbmNsdWRlTWFya2VkQ29udGVudCkgewogICAgICAgICAgICAgIG1hcmtlZENvbnRlbnREYXRhLmxldmVsKys7CiAgICAgICAgICAgICAgdGV4dENvbnRlbnQuaXRlbXMucHVzaCh7CiAgICAgICAgICAgICAgICB0eXBlOiAiYmVnaW5NYXJrZWRDb250ZW50IiwKICAgICAgICAgICAgICAgIHRhZzogYXJnc1swXSBpbnN0YW5jZW9mIF9wcmltaXRpdmVzLk5hbWUgPyBhcmdzWzBdLm5hbWUgOiBudWxsCiAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICBjYXNlIF91dGlsLk9QUy5iZWdpbk1hcmtlZENvbnRlbnRQcm9wczoKICAgICAgICAgICAgZmx1c2hUZXh0Q29udGVudEl0ZW0oKTsKICAgICAgICAgICAgaWYgKGluY2x1ZGVNYXJrZWRDb250ZW50KSB7CiAgICAgICAgICAgICAgbWFya2VkQ29udGVudERhdGEubGV2ZWwrKzsKICAgICAgICAgICAgICBsZXQgbWNpZCA9IG51bGw7CiAgICAgICAgICAgICAgaWYgKGFyZ3NbMV0gaW5zdGFuY2VvZiBfcHJpbWl0aXZlcy5EaWN0KSB7CiAgICAgICAgICAgICAgICBtY2lkID0gYXJnc1sxXS5nZXQoIk1DSUQiKTsKICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgdGV4dENvbnRlbnQuaXRlbXMucHVzaCh7CiAgICAgICAgICAgICAgICB0eXBlOiAiYmVnaW5NYXJrZWRDb250ZW50UHJvcHMiLAogICAgICAgICAgICAgICAgaWQ6IE51bWJlci5pc0ludGVnZXIobWNpZCkgPyBgJHtzZWxmLmlkRmFjdG9yeS5nZXRQYWdlT2JqSWQoKX1fbWMke21jaWR9YCA6IG51bGwsCiAgICAgICAgICAgICAgICB0YWc6IGFyZ3NbMF0gaW5zdGFuY2VvZiBfcHJpbWl0aXZlcy5OYW1lID8gYXJnc1swXS5uYW1lIDogbnVsbAogICAgICAgICAgICAgIH0pOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgY2FzZSBfdXRpbC5PUFMuZW5kTWFya2VkQ29udGVudDoKICAgICAgICAgICAgZmx1c2hUZXh0Q29udGVudEl0ZW0oKTsKICAgICAgICAgICAgaWYgKGluY2x1ZGVNYXJrZWRDb250ZW50KSB7CiAgICAgICAgICAgICAgaWYgKG1hcmtlZENvbnRlbnREYXRhLmxldmVsID09PSAwKSB7CiAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgbWFya2VkQ29udGVudERhdGEubGV2ZWwtLTsKICAgICAgICAgICAgICB0ZXh0Q29udGVudC5pdGVtcy5wdXNoKHsKICAgICAgICAgICAgICAgIHR5cGU6ICJlbmRNYXJrZWRDb250ZW50IgogICAgICAgICAgICAgIH0pOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgY2FzZSBfdXRpbC5PUFMucmVzdG9yZToKICAgICAgICAgICAgaWYgKHByZXZpb3VzU3RhdGUgJiYgKHByZXZpb3VzU3RhdGUuZm9udCAhPT0gdGV4dFN0YXRlLmZvbnQgfHwgcHJldmlvdXNTdGF0ZS5mb250U2l6ZSAhPT0gdGV4dFN0YXRlLmZvbnRTaXplIHx8IHByZXZpb3VzU3RhdGUuZm9udE5hbWUgIT09IHRleHRTdGF0ZS5mb250TmFtZSkpIHsKICAgICAgICAgICAgICBmbHVzaFRleHRDb250ZW50SXRlbSgpOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGJyZWFrOwogICAgICAgIH0KICAgICAgICBpZiAodGV4dENvbnRlbnQuaXRlbXMubGVuZ3RoID49IHNpbmsuZGVzaXJlZFNpemUpIHsKICAgICAgICAgIHN0b3AgPSB0cnVlOwogICAgICAgICAgYnJlYWs7CiAgICAgICAgfQogICAgICB9CiAgICAgIGlmIChzdG9wKSB7CiAgICAgICAgbmV4dChkZWZlcnJlZCk7CiAgICAgICAgcmV0dXJuOwogICAgICB9CiAgICAgIGZsdXNoVGV4dENvbnRlbnRJdGVtKCk7CiAgICAgIGVucXVldWVDaHVuaygpOwogICAgICByZXNvbHZlKCk7CiAgICB9KS5jYXRjaChyZWFzb24gPT4gewogICAgICBpZiAocmVhc29uIGluc3RhbmNlb2YgX3V0aWwuQWJvcnRFeGNlcHRpb24pIHsKICAgICAgICByZXR1cm47CiAgICAgIH0KICAgICAgaWYgKHRoaXMub3B0aW9ucy5pZ25vcmVFcnJvcnMpIHsKICAgICAgICAoMCwgX3V0aWwud2FybikoYGdldFRleHRDb250ZW50IC0gaWdub3JpbmcgZXJyb3JzIGR1cmluZyAiJHt0YXNrLm5hbWV9IiBgICsgYHRhc2s6ICIke3JlYXNvbn0iLmApOwogICAgICAgIGZsdXNoVGV4dENvbnRlbnRJdGVtKCk7CiAgICAgICAgZW5xdWV1ZUNodW5rKCk7CiAgICAgICAgcmV0dXJuOwogICAgICB9CiAgICAgIHRocm93IHJlYXNvbjsKICAgIH0pOwogIH0KICBleHRyYWN0RGF0YVN0cnVjdHVyZXMoZGljdCwgYmFzZURpY3QsIHByb3BlcnRpZXMpIHsKICAgIGNvbnN0IHhyZWYgPSB0aGlzLnhyZWY7CiAgICBsZXQgY2lkVG9HaWRCeXRlczsKICAgIGNvbnN0IHRvVW5pY29kZVByb21pc2UgPSB0aGlzLnJlYWRUb1VuaWNvZGUocHJvcGVydGllcy50b1VuaWNvZGUgfHwgZGljdC5nZXQoIlRvVW5pY29kZSIpIHx8IGJhc2VEaWN0LmdldCgiVG9Vbmljb2RlIikpOwogICAgaWYgKHByb3BlcnRpZXMuY29tcG9zaXRlKSB7CiAgICAgIGNvbnN0IGNpZFN5c3RlbUluZm8gPSBkaWN0LmdldCgiQ0lEU3lzdGVtSW5mbyIpOwogICAgICBpZiAoY2lkU3lzdGVtSW5mbyBpbnN0YW5jZW9mIF9wcmltaXRpdmVzLkRpY3QpIHsKICAgICAgICBwcm9wZXJ0aWVzLmNpZFN5c3RlbUluZm8gPSB7CiAgICAgICAgICByZWdpc3RyeTogKDAsIF91dGlsLnN0cmluZ1RvUERGU3RyaW5nKShjaWRTeXN0ZW1JbmZvLmdldCgiUmVnaXN0cnkiKSksCiAgICAgICAgICBvcmRlcmluZzogKDAsIF91dGlsLnN0cmluZ1RvUERGU3RyaW5nKShjaWRTeXN0ZW1JbmZvLmdldCgiT3JkZXJpbmciKSksCiAgICAgICAgICBzdXBwbGVtZW50OiBjaWRTeXN0ZW1JbmZvLmdldCgiU3VwcGxlbWVudCIpCiAgICAgICAgfTsKICAgICAgfQogICAgICB0cnkgewogICAgICAgIGNvbnN0IGNpZFRvR2lkTWFwID0gZGljdC5nZXQoIkNJRFRvR0lETWFwIik7CiAgICAgICAgaWYgKGNpZFRvR2lkTWFwIGluc3RhbmNlb2YgX2Jhc2Vfc3RyZWFtLkJhc2VTdHJlYW0pIHsKICAgICAgICAgIGNpZFRvR2lkQnl0ZXMgPSBjaWRUb0dpZE1hcC5nZXRCeXRlcygpOwogICAgICAgIH0KICAgICAgfSBjYXRjaCAoZXgpIHsKICAgICAgICBpZiAoIXRoaXMub3B0aW9ucy5pZ25vcmVFcnJvcnMpIHsKICAgICAgICAgIHRocm93IGV4OwogICAgICAgIH0KICAgICAgICAoMCwgX3V0aWwud2FybikoYGV4dHJhY3REYXRhU3RydWN0dXJlcyAtIGlnbm9yaW5nIENJRFRvR0lETWFwIGRhdGE6ICIke2V4fSIuYCk7CiAgICAgIH0KICAgIH0KICAgIGNvbnN0IGRpZmZlcmVuY2VzID0gW107CiAgICBsZXQgYmFzZUVuY29kaW5nTmFtZSA9IG51bGw7CiAgICBsZXQgZW5jb2Rpbmc7CiAgICBpZiAoZGljdC5oYXMoIkVuY29kaW5nIikpIHsKICAgICAgZW5jb2RpbmcgPSBkaWN0LmdldCgiRW5jb2RpbmciKTsKICAgICAgaWYgKGVuY29kaW5nIGluc3RhbmNlb2YgX3ByaW1pdGl2ZXMuRGljdCkgewogICAgICAgIGJhc2VFbmNvZGluZ05hbWUgPSBlbmNvZGluZy5nZXQoIkJhc2VFbmNvZGluZyIpOwogICAgICAgIGJhc2VFbmNvZGluZ05hbWUgPSBiYXNlRW5jb2RpbmdOYW1lIGluc3RhbmNlb2YgX3ByaW1pdGl2ZXMuTmFtZSA/IGJhc2VFbmNvZGluZ05hbWUubmFtZSA6IG51bGw7CiAgICAgICAgaWYgKGVuY29kaW5nLmhhcygiRGlmZmVyZW5jZXMiKSkgewogICAgICAgICAgY29uc3QgZGlmZkVuY29kaW5nID0gZW5jb2RpbmcuZ2V0KCJEaWZmZXJlbmNlcyIpOwogICAgICAgICAgbGV0IGluZGV4ID0gMDsKICAgICAgICAgIGZvciAoY29uc3QgZW50cnkgb2YgZGlmZkVuY29kaW5nKSB7CiAgICAgICAgICAgIGNvbnN0IGRhdGEgPSB4cmVmLmZldGNoSWZSZWYoZW50cnkpOwogICAgICAgICAgICBpZiAodHlwZW9mIGRhdGEgPT09ICJudW1iZXIiKSB7CiAgICAgICAgICAgICAgaW5kZXggPSBkYXRhOwogICAgICAgICAgICB9IGVsc2UgaWYgKGRhdGEgaW5zdGFuY2VvZiBfcHJpbWl0aXZlcy5OYW1lKSB7CiAgICAgICAgICAgICAgZGlmZmVyZW5jZXNbaW5kZXgrK10gPSBkYXRhLm5hbWU7CiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgdGhyb3cgbmV3IF91dGlsLkZvcm1hdEVycm9yKGBJbnZhbGlkIGVudHJ5IGluICdEaWZmZXJlbmNlcycgYXJyYXk6ICR7ZGF0YX1gKTsKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgIH0KICAgICAgfSBlbHNlIGlmIChlbmNvZGluZyBpbnN0YW5jZW9mIF9wcmltaXRpdmVzLk5hbWUpIHsKICAgICAgICBiYXNlRW5jb2RpbmdOYW1lID0gZW5jb2RpbmcubmFtZTsKICAgICAgfSBlbHNlIHsKICAgICAgICBjb25zdCBtc2cgPSAiRW5jb2RpbmcgaXMgbm90IGEgTmFtZSBub3IgYSBEaWN0IjsKICAgICAgICBpZiAoIXRoaXMub3B0aW9ucy5pZ25vcmVFcnJvcnMpIHsKICAgICAgICAgIHRocm93IG5ldyBfdXRpbC5Gb3JtYXRFcnJvcihtc2cpOwogICAgICAgIH0KICAgICAgICAoMCwgX3V0aWwud2FybikobXNnKTsKICAgICAgfQogICAgICBpZiAoYmFzZUVuY29kaW5nTmFtZSAhPT0gIk1hY1JvbWFuRW5jb2RpbmciICYmIGJhc2VFbmNvZGluZ05hbWUgIT09ICJNYWNFeHBlcnRFbmNvZGluZyIgJiYgYmFzZUVuY29kaW5nTmFtZSAhPT0gIldpbkFuc2lFbmNvZGluZyIpIHsKICAgICAgICBiYXNlRW5jb2RpbmdOYW1lID0gbnVsbDsKICAgICAgfQogICAgfQogICAgY29uc3Qgbm9uRW1iZWRkZWRGb250ID0gIXByb3BlcnRpZXMuZmlsZSB8fCBwcm9wZXJ0aWVzLmlzSW50ZXJuYWxGb250LAogICAgICBpc1N5bWJvbHNGb250TmFtZSA9ICgwLCBfc3RhbmRhcmRfZm9udHMuZ2V0U3ltYm9sc0ZvbnRzKSgpW3Byb3BlcnRpZXMubmFtZV07CiAgICBpZiAoYmFzZUVuY29kaW5nTmFtZSAmJiBub25FbWJlZGRlZEZvbnQgJiYgaXNTeW1ib2xzRm9udE5hbWUpIHsKICAgICAgYmFzZUVuY29kaW5nTmFtZSA9IG51bGw7CiAgICB9CiAgICBpZiAoYmFzZUVuY29kaW5nTmFtZSkgewogICAgICBwcm9wZXJ0aWVzLmRlZmF1bHRFbmNvZGluZyA9ICgwLCBfZW5jb2RpbmdzLmdldEVuY29kaW5nKShiYXNlRW5jb2RpbmdOYW1lKTsKICAgIH0gZWxzZSB7CiAgICAgIGNvbnN0IGlzU3ltYm9saWNGb250ID0gISEocHJvcGVydGllcy5mbGFncyAmIF9mb250c191dGlscy5Gb250RmxhZ3MuU3ltYm9saWMpOwogICAgICBjb25zdCBpc05vbnN5bWJvbGljRm9udCA9ICEhKHByb3BlcnRpZXMuZmxhZ3MgJiBfZm9udHNfdXRpbHMuRm9udEZsYWdzLk5vbnN5bWJvbGljKTsKICAgICAgZW5jb2RpbmcgPSBfZW5jb2RpbmdzLlN0YW5kYXJkRW5jb2Rpbmc7CiAgICAgIGlmIChwcm9wZXJ0aWVzLnR5cGUgPT09ICJUcnVlVHlwZSIgJiYgIWlzTm9uc3ltYm9saWNGb250KSB7CiAgICAgICAgZW5jb2RpbmcgPSBfZW5jb2RpbmdzLldpbkFuc2lFbmNvZGluZzsKICAgICAgfQogICAgICBpZiAoaXNTeW1ib2xpY0ZvbnQgfHwgaXNTeW1ib2xzRm9udE5hbWUpIHsKICAgICAgICBlbmNvZGluZyA9IF9lbmNvZGluZ3MuTWFjUm9tYW5FbmNvZGluZzsKICAgICAgICBpZiAobm9uRW1iZWRkZWRGb250KSB7CiAgICAgICAgICBpZiAoL1N5bWJvbC9pLnRlc3QocHJvcGVydGllcy5uYW1lKSkgewogICAgICAgICAgICBlbmNvZGluZyA9IF9lbmNvZGluZ3MuU3ltYm9sU2V0RW5jb2Rpbmc7CiAgICAgICAgICB9IGVsc2UgaWYgKC9EaW5nYmF0cy9pLnRlc3QocHJvcGVydGllcy5uYW1lKSkgewogICAgICAgICAgICBlbmNvZGluZyA9IF9lbmNvZGluZ3MuWmFwZkRpbmdiYXRzRW5jb2Rpbmc7CiAgICAgICAgICB9IGVsc2UgaWYgKC9XaW5nZGluZ3MvaS50ZXN0KHByb3BlcnRpZXMubmFtZSkpIHsKICAgICAgICAgICAgZW5jb2RpbmcgPSBfZW5jb2RpbmdzLldpbkFuc2lFbmNvZGluZzsKICAgICAgICAgIH0KICAgICAgICB9CiAgICAgIH0KICAgICAgcHJvcGVydGllcy5kZWZhdWx0RW5jb2RpbmcgPSBlbmNvZGluZzsKICAgIH0KICAgIHByb3BlcnRpZXMuZGlmZmVyZW5jZXMgPSBkaWZmZXJlbmNlczsKICAgIHByb3BlcnRpZXMuYmFzZUVuY29kaW5nTmFtZSA9IGJhc2VFbmNvZGluZ05hbWU7CiAgICBwcm9wZXJ0aWVzLmhhc0VuY29kaW5nID0gISFiYXNlRW5jb2RpbmdOYW1lIHx8IGRpZmZlcmVuY2VzLmxlbmd0aCA+IDA7CiAgICBwcm9wZXJ0aWVzLmRpY3QgPSBkaWN0OwogICAgcmV0dXJuIHRvVW5pY29kZVByb21pc2UudGhlbihyZWFkVG9Vbmljb2RlID0+IHsKICAgICAgcHJvcGVydGllcy50b1VuaWNvZGUgPSByZWFkVG9Vbmljb2RlOwogICAgICByZXR1cm4gdGhpcy5idWlsZFRvVW5pY29kZShwcm9wZXJ0aWVzKTsKICAgIH0pLnRoZW4oYnVpbHRUb1VuaWNvZGUgPT4gewogICAgICBwcm9wZXJ0aWVzLnRvVW5pY29kZSA9IGJ1aWx0VG9Vbmljb2RlOwogICAgICBpZiAoY2lkVG9HaWRCeXRlcykgewogICAgICAgIHByb3BlcnRpZXMuY2lkVG9HaWRNYXAgPSB0aGlzLnJlYWRDaWRUb0dpZE1hcChjaWRUb0dpZEJ5dGVzLCBidWlsdFRvVW5pY29kZSk7CiAgICAgIH0KICAgICAgcmV0dXJuIHByb3BlcnRpZXM7CiAgICB9KTsKICB9CiAgX3NpbXBsZUZvbnRUb1VuaWNvZGUocHJvcGVydGllcywgZm9yY2VHbHlwaHMgPSBmYWxzZSkgewogICAgKDAsIF91dGlsLmFzc2VydCkoIXByb3BlcnRpZXMuY29tcG9zaXRlLCAiTXVzdCBiZSBhIHNpbXBsZSBmb250LiIpOwogICAgY29uc3QgdG9Vbmljb2RlID0gW107CiAgICBjb25zdCBlbmNvZGluZyA9IHByb3BlcnRpZXMuZGVmYXVsdEVuY29kaW5nLnNsaWNlKCk7CiAgICBjb25zdCBiYXNlRW5jb2RpbmdOYW1lID0gcHJvcGVydGllcy5iYXNlRW5jb2RpbmdOYW1lOwogICAgY29uc3QgZGlmZmVyZW5jZXMgPSBwcm9wZXJ0aWVzLmRpZmZlcmVuY2VzOwogICAgZm9yIChjb25zdCBjaGFyY29kZSBpbiBkaWZmZXJlbmNlcykgewogICAgICBjb25zdCBnbHlwaE5hbWUgPSBkaWZmZXJlbmNlc1tjaGFyY29kZV07CiAgICAgIGlmIChnbHlwaE5hbWUgPT09ICIubm90ZGVmIikgewogICAgICAgIGNvbnRpbnVlOwogICAgICB9CiAgICAgIGVuY29kaW5nW2NoYXJjb2RlXSA9IGdseXBoTmFtZTsKICAgIH0KICAgIGNvbnN0IGdseXBoc1VuaWNvZGVNYXAgPSAoMCwgX2dseXBobGlzdC5nZXRHbHlwaHNVbmljb2RlKSgpOwogICAgZm9yIChjb25zdCBjaGFyY29kZSBpbiBlbmNvZGluZykgewogICAgICBsZXQgZ2x5cGhOYW1lID0gZW5jb2RpbmdbY2hhcmNvZGVdOwogICAgICBpZiAoZ2x5cGhOYW1lID09PSAiIikgewogICAgICAgIGNvbnRpbnVlOwogICAgICB9CiAgICAgIGxldCB1bmljb2RlID0gZ2x5cGhzVW5pY29kZU1hcFtnbHlwaE5hbWVdOwogICAgICBpZiAodW5pY29kZSAhPT0gdW5kZWZpbmVkKSB7CiAgICAgICAgdG9Vbmljb2RlW2NoYXJjb2RlXSA9IFN0cmluZy5mcm9tQ2hhckNvZGUodW5pY29kZSk7CiAgICAgICAgY29udGludWU7CiAgICAgIH0KICAgICAgbGV0IGNvZGUgPSAwOwogICAgICBzd2l0Y2ggKGdseXBoTmFtZVswXSkgewogICAgICAgIGNhc2UgIkciOgogICAgICAgICAgaWYgKGdseXBoTmFtZS5sZW5ndGggPT09IDMpIHsKICAgICAgICAgICAgY29kZSA9IHBhcnNlSW50KGdseXBoTmFtZS5zdWJzdHJpbmcoMSksIDE2KTsKICAgICAgICAgIH0KICAgICAgICAgIGJyZWFrOwogICAgICAgIGNhc2UgImciOgogICAgICAgICAgaWYgKGdseXBoTmFtZS5sZW5ndGggPT09IDUpIHsKICAgICAgICAgICAgY29kZSA9IHBhcnNlSW50KGdseXBoTmFtZS5zdWJzdHJpbmcoMSksIDE2KTsKICAgICAgICAgIH0KICAgICAgICAgIGJyZWFrOwogICAgICAgIGNhc2UgIkMiOgogICAgICAgIGNhc2UgImMiOgogICAgICAgICAgaWYgKGdseXBoTmFtZS5sZW5ndGggPj0gMyAmJiBnbHlwaE5hbWUubGVuZ3RoIDw9IDQpIHsKICAgICAgICAgICAgY29uc3QgY29kZVN0ciA9IGdseXBoTmFtZS5zdWJzdHJpbmcoMSk7CiAgICAgICAgICAgIGlmIChmb3JjZUdseXBocykgewogICAgICAgICAgICAgIGNvZGUgPSBwYXJzZUludChjb2RlU3RyLCAxNik7CiAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgY29kZSA9ICtjb2RlU3RyOwogICAgICAgICAgICBpZiAoTnVtYmVyLmlzTmFOKGNvZGUpICYmIE51bWJlci5pc0ludGVnZXIocGFyc2VJbnQoY29kZVN0ciwgMTYpKSkgewogICAgICAgICAgICAgIHJldHVybiB0aGlzLl9zaW1wbGVGb250VG9Vbmljb2RlKHByb3BlcnRpZXMsIHRydWUpOwogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgICBicmVhazsKICAgICAgICBjYXNlICJ1IjoKICAgICAgICAgIHVuaWNvZGUgPSAoMCwgX3VuaWNvZGUuZ2V0VW5pY29kZUZvckdseXBoKShnbHlwaE5hbWUsIGdseXBoc1VuaWNvZGVNYXApOwogICAgICAgICAgaWYgKHVuaWNvZGUgIT09IC0xKSB7CiAgICAgICAgICAgIGNvZGUgPSB1bmljb2RlOwogICAgICAgICAgfQogICAgICAgICAgYnJlYWs7CiAgICAgICAgZGVmYXVsdDoKICAgICAgICAgIHN3aXRjaCAoZ2x5cGhOYW1lKSB7CiAgICAgICAgICAgIGNhc2UgImZfaCI6CiAgICAgICAgICAgIGNhc2UgImZfdCI6CiAgICAgICAgICAgIGNhc2UgIlRfaCI6CiAgICAgICAgICAgICAgdG9Vbmljb2RlW2NoYXJjb2RlXSA9IGdseXBoTmFtZS5yZXBsYWNlQWxsKCJfIiwgIiIpOwogICAgICAgICAgICAgIGNvbnRpbnVlOwogICAgICAgICAgfQogICAgICAgICAgYnJlYWs7CiAgICAgIH0KICAgICAgaWYgKGNvZGUgPiAwICYmIGNvZGUgPD0gMHgxMGZmZmYgJiYgTnVtYmVyLmlzSW50ZWdlcihjb2RlKSkgewogICAgICAgIGlmIChiYXNlRW5jb2RpbmdOYW1lICYmIGNvZGUgPT09ICtjaGFyY29kZSkgewogICAgICAgICAgY29uc3QgYmFzZUVuY29kaW5nID0gKDAsIF9lbmNvZGluZ3MuZ2V0RW5jb2RpbmcpKGJhc2VFbmNvZGluZ05hbWUpOwogICAgICAgICAgaWYgKGJhc2VFbmNvZGluZyAmJiAoZ2x5cGhOYW1lID0gYmFzZUVuY29kaW5nW2NoYXJjb2RlXSkpIHsKICAgICAgICAgICAgdG9Vbmljb2RlW2NoYXJjb2RlXSA9IFN0cmluZy5mcm9tQ2hhckNvZGUoZ2x5cGhzVW5pY29kZU1hcFtnbHlwaE5hbWVdKTsKICAgICAgICAgICAgY29udGludWU7CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIHRvVW5pY29kZVtjaGFyY29kZV0gPSBTdHJpbmcuZnJvbUNvZGVQb2ludChjb2RlKTsKICAgICAgfQogICAgfQogICAgcmV0dXJuIHRvVW5pY29kZTsKICB9CiAgYXN5bmMgYnVpbGRUb1VuaWNvZGUocHJvcGVydGllcykgewogICAgcHJvcGVydGllcy5oYXNJbmNsdWRlZFRvVW5pY29kZU1hcCA9IHByb3BlcnRpZXMudG9Vbmljb2RlPy5sZW5ndGggPiAwOwogICAgaWYgKHByb3BlcnRpZXMuaGFzSW5jbHVkZWRUb1VuaWNvZGVNYXApIHsKICAgICAgaWYgKCFwcm9wZXJ0aWVzLmNvbXBvc2l0ZSAmJiBwcm9wZXJ0aWVzLmhhc0VuY29kaW5nKSB7CiAgICAgICAgcHJvcGVydGllcy5mYWxsYmFja1RvVW5pY29kZSA9IHRoaXMuX3NpbXBsZUZvbnRUb1VuaWNvZGUocHJvcGVydGllcyk7CiAgICAgIH0KICAgICAgcmV0dXJuIHByb3BlcnRpZXMudG9Vbmljb2RlOwogICAgfQogICAgaWYgKCFwcm9wZXJ0aWVzLmNvbXBvc2l0ZSkgewogICAgICByZXR1cm4gbmV3IF90b191bmljb2RlX21hcC5Ub1VuaWNvZGVNYXAodGhpcy5fc2ltcGxlRm9udFRvVW5pY29kZShwcm9wZXJ0aWVzKSk7CiAgICB9CiAgICBpZiAocHJvcGVydGllcy5jb21wb3NpdGUgJiYgKHByb3BlcnRpZXMuY01hcC5idWlsdEluQ01hcCAmJiAhKHByb3BlcnRpZXMuY01hcCBpbnN0YW5jZW9mIF9jbWFwLklkZW50aXR5Q01hcCkgfHwgcHJvcGVydGllcy5jaWRTeXN0ZW1JbmZvLnJlZ2lzdHJ5ID09PSAiQWRvYmUiICYmIChwcm9wZXJ0aWVzLmNpZFN5c3RlbUluZm8ub3JkZXJpbmcgPT09ICJHQjEiIHx8IHByb3BlcnRpZXMuY2lkU3lzdGVtSW5mby5vcmRlcmluZyA9PT0gIkNOUzEiIHx8IHByb3BlcnRpZXMuY2lkU3lzdGVtSW5mby5vcmRlcmluZyA9PT0gIkphcGFuMSIgfHwgcHJvcGVydGllcy5jaWRTeXN0ZW1JbmZvLm9yZGVyaW5nID09PSAiS29yZWExIikpKSB7CiAgICAgIGNvbnN0IHsKICAgICAgICByZWdpc3RyeSwKICAgICAgICBvcmRlcmluZwogICAgICB9ID0gcHJvcGVydGllcy5jaWRTeXN0ZW1JbmZvOwogICAgICBjb25zdCB1Y3MyQ01hcE5hbWUgPSBfcHJpbWl0aXZlcy5OYW1lLmdldChgJHtyZWdpc3RyeX0tJHtvcmRlcmluZ30tVUNTMmApOwogICAgICBjb25zdCB1Y3MyQ01hcCA9IGF3YWl0IF9jbWFwLkNNYXBGYWN0b3J5LmNyZWF0ZSh7CiAgICAgICAgZW5jb2Rpbmc6IHVjczJDTWFwTmFtZSwKICAgICAgICBmZXRjaEJ1aWx0SW5DTWFwOiB0aGlzLl9mZXRjaEJ1aWx0SW5DTWFwQm91bmQsCiAgICAgICAgdXNlQ01hcDogbnVsbAogICAgICB9KTsKICAgICAgY29uc3QgdG9Vbmljb2RlID0gW10sCiAgICAgICAgYnVmID0gW107CiAgICAgIHByb3BlcnRpZXMuY01hcC5mb3JFYWNoKGZ1bmN0aW9uIChjaGFyY29kZSwgY2lkKSB7CiAgICAgICAgaWYgKGNpZCA+IDB4ZmZmZikgewogICAgICAgICAgdGhyb3cgbmV3IF91dGlsLkZvcm1hdEVycm9yKCJNYXggc2l6ZSBvZiBDSUQgaXMgNjUsNTM1Iik7CiAgICAgICAgfQogICAgICAgIGNvbnN0IHVjczIgPSB1Y3MyQ01hcC5sb29rdXAoY2lkKTsKICAgICAgICBpZiAodWNzMikgewogICAgICAgICAgYnVmLmxlbmd0aCA9IDA7CiAgICAgICAgICBmb3IgKGxldCBpID0gMCwgaWkgPSB1Y3MyLmxlbmd0aDsgaSA8IGlpOyBpICs9IDIpIHsKICAgICAgICAgICAgYnVmLnB1c2goKHVjczIuY2hhckNvZGVBdChpKSA8PCA4KSArIHVjczIuY2hhckNvZGVBdChpICsgMSkpOwogICAgICAgICAgfQogICAgICAgICAgdG9Vbmljb2RlW2NoYXJjb2RlXSA9IFN0cmluZy5mcm9tQ2hhckNvZGUoLi4uYnVmKTsKICAgICAgICB9CiAgICAgIH0pOwogICAgICByZXR1cm4gbmV3IF90b191bmljb2RlX21hcC5Ub1VuaWNvZGVNYXAodG9Vbmljb2RlKTsKICAgIH0KICAgIHJldHVybiBuZXcgX3RvX3VuaWNvZGVfbWFwLklkZW50aXR5VG9Vbmljb2RlTWFwKHByb3BlcnRpZXMuZmlyc3RDaGFyLCBwcm9wZXJ0aWVzLmxhc3RDaGFyKTsKICB9CiAgcmVhZFRvVW5pY29kZShjbWFwT2JqKSB7CiAgICBpZiAoIWNtYXBPYmopIHsKICAgICAgcmV0dXJuIFByb21pc2UucmVzb2x2ZShudWxsKTsKICAgIH0KICAgIGlmIChjbWFwT2JqIGluc3RhbmNlb2YgX3ByaW1pdGl2ZXMuTmFtZSkgewogICAgICByZXR1cm4gX2NtYXAuQ01hcEZhY3RvcnkuY3JlYXRlKHsKICAgICAgICBlbmNvZGluZzogY21hcE9iaiwKICAgICAgICBmZXRjaEJ1aWx0SW5DTWFwOiB0aGlzLl9mZXRjaEJ1aWx0SW5DTWFwQm91bmQsCiAgICAgICAgdXNlQ01hcDogbnVsbAogICAgICB9KS50aGVuKGZ1bmN0aW9uIChjbWFwKSB7CiAgICAgICAgaWYgKGNtYXAgaW5zdGFuY2VvZiBfY21hcC5JZGVudGl0eUNNYXApIHsKICAgICAgICAgIHJldHVybiBuZXcgX3RvX3VuaWNvZGVfbWFwLklkZW50aXR5VG9Vbmljb2RlTWFwKDAsIDB4ZmZmZik7CiAgICAgICAgfQogICAgICAgIHJldHVybiBuZXcgX3RvX3VuaWNvZGVfbWFwLlRvVW5pY29kZU1hcChjbWFwLmdldE1hcCgpKTsKICAgICAgfSk7CiAgICB9IGVsc2UgaWYgKGNtYXBPYmogaW5zdGFuY2VvZiBfYmFzZV9zdHJlYW0uQmFzZVN0cmVhbSkgewogICAgICByZXR1cm4gX2NtYXAuQ01hcEZhY3RvcnkuY3JlYXRlKHsKICAgICAgICBlbmNvZGluZzogY21hcE9iaiwKICAgICAgICBmZXRjaEJ1aWx0SW5DTWFwOiB0aGlzLl9mZXRjaEJ1aWx0SW5DTWFwQm91bmQsCiAgICAgICAgdXNlQ01hcDogbnVsbAogICAgICB9KS50aGVuKGZ1bmN0aW9uIChjbWFwKSB7CiAgICAgICAgaWYgKGNtYXAgaW5zdGFuY2VvZiBfY21hcC5JZGVudGl0eUNNYXApIHsKICAgICAgICAgIHJldHVybiBuZXcgX3RvX3VuaWNvZGVfbWFwLklkZW50aXR5VG9Vbmljb2RlTWFwKDAsIDB4ZmZmZik7CiAgICAgICAgfQogICAgICAgIGNvbnN0IG1hcCA9IG5ldyBBcnJheShjbWFwLmxlbmd0aCk7CiAgICAgICAgY21hcC5mb3JFYWNoKGZ1bmN0aW9uIChjaGFyQ29kZSwgdG9rZW4pIHsKICAgICAgICAgIGlmICh0eXBlb2YgdG9rZW4gPT09ICJudW1iZXIiKSB7CiAgICAgICAgICAgIG1hcFtjaGFyQ29kZV0gPSBTdHJpbmcuZnJvbUNvZGVQb2ludCh0b2tlbik7CiAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgIH0KICAgICAgICAgIGNvbnN0IHN0ciA9IFtdOwogICAgICAgICAgZm9yIChsZXQgayA9IDA7IGsgPCB0b2tlbi5sZW5ndGg7IGsgKz0gMikgewogICAgICAgICAgICBjb25zdCB3MSA9IHRva2VuLmNoYXJDb2RlQXQoaykgPDwgOCB8IHRva2VuLmNoYXJDb2RlQXQoayArIDEpOwogICAgICAgICAgICBpZiAoKHcxICYgMHhmODAwKSAhPT0gMHhkODAwKSB7CiAgICAgICAgICAgICAgc3RyLnB1c2godzEpOwogICAgICAgICAgICAgIGNvbnRpbnVlOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGsgKz0gMjsKICAgICAgICAgICAgY29uc3QgdzIgPSB0b2tlbi5jaGFyQ29kZUF0KGspIDw8IDggfCB0b2tlbi5jaGFyQ29kZUF0KGsgKyAxKTsKICAgICAgICAgICAgc3RyLnB1c2goKCh3MSAmIDB4M2ZmKSA8PCAxMCkgKyAodzIgJiAweDNmZikgKyAweDEwMDAwKTsKICAgICAgICAgIH0KICAgICAgICAgIG1hcFtjaGFyQ29kZV0gPSBTdHJpbmcuZnJvbUNvZGVQb2ludCguLi5zdHIpOwogICAgICAgIH0pOwogICAgICAgIHJldHVybiBuZXcgX3RvX3VuaWNvZGVfbWFwLlRvVW5pY29kZU1hcChtYXApOwogICAgICB9LCByZWFzb24gPT4gewogICAgICAgIGlmIChyZWFzb24gaW5zdGFuY2VvZiBfdXRpbC5BYm9ydEV4Y2VwdGlvbikgewogICAgICAgICAgcmV0dXJuIG51bGw7CiAgICAgICAgfQogICAgICAgIGlmICh0aGlzLm9wdGlvbnMuaWdub3JlRXJyb3JzKSB7CiAgICAgICAgICAoMCwgX3V0aWwud2FybikoYHJlYWRUb1VuaWNvZGUgLSBpZ25vcmluZyBUb1VuaWNvZGUgZGF0YTogIiR7cmVhc29ufSIuYCk7CiAgICAgICAgICByZXR1cm4gbnVsbDsKICAgICAgICB9CiAgICAgICAgdGhyb3cgcmVhc29uOwogICAgICB9KTsKICAgIH0KICAgIHJldHVybiBQcm9taXNlLnJlc29sdmUobnVsbCk7CiAgfQogIHJlYWRDaWRUb0dpZE1hcChnbHlwaHNEYXRhLCB0b1VuaWNvZGUpIHsKICAgIGNvbnN0IHJlc3VsdCA9IFtdOwogICAgZm9yIChsZXQgaiA9IDAsIGpqID0gZ2x5cGhzRGF0YS5sZW5ndGg7IGogPCBqajsgaisrKSB7CiAgICAgIGNvbnN0IGdseXBoSUQgPSBnbHlwaHNEYXRhW2orK10gPDwgOCB8IGdseXBoc0RhdGFbal07CiAgICAgIGNvbnN0IGNvZGUgPSBqID4+IDE7CiAgICAgIGlmIChnbHlwaElEID09PSAwICYmICF0b1VuaWNvZGUuaGFzKGNvZGUpKSB7CiAgICAgICAgY29udGludWU7CiAgICAgIH0KICAgICAgcmVzdWx0W2NvZGVdID0gZ2x5cGhJRDsKICAgIH0KICAgIHJldHVybiByZXN1bHQ7CiAgfQogIGV4dHJhY3RXaWR0aHMoZGljdCwgZGVzY3JpcHRvciwgcHJvcGVydGllcykgewogICAgY29uc3QgeHJlZiA9IHRoaXMueHJlZjsKICAgIGxldCBnbHlwaHNXaWR0aHMgPSBbXTsKICAgIGxldCBkZWZhdWx0V2lkdGggPSAwOwogICAgY29uc3QgZ2x5cGhzVk1ldHJpY3MgPSBbXTsKICAgIGxldCBkZWZhdWx0Vk1ldHJpY3M7CiAgICBsZXQgaSwgaWksIGosIGpqLCBzdGFydCwgY29kZSwgd2lkdGhzOwogICAgaWYgKHByb3BlcnRpZXMuY29tcG9zaXRlKSB7CiAgICAgIGRlZmF1bHRXaWR0aCA9IGRpY3QuaGFzKCJEVyIpID8gZGljdC5nZXQoIkRXIikgOiAxMDAwOwogICAgICB3aWR0aHMgPSBkaWN0LmdldCgiVyIpOwogICAgICBpZiAod2lkdGhzKSB7CiAgICAgICAgZm9yIChpID0gMCwgaWkgPSB3aWR0aHMubGVuZ3RoOyBpIDwgaWk7IGkrKykgewogICAgICAgICAgc3RhcnQgPSB4cmVmLmZldGNoSWZSZWYod2lkdGhzW2krK10pOwogICAgICAgICAgY29kZSA9IHhyZWYuZmV0Y2hJZlJlZih3aWR0aHNbaV0pOwogICAgICAgICAgaWYgKEFycmF5LmlzQXJyYXkoY29kZSkpIHsKICAgICAgICAgICAgZm9yIChqID0gMCwgamogPSBjb2RlLmxlbmd0aDsgaiA8IGpqOyBqKyspIHsKICAgICAgICAgICAgICBnbHlwaHNXaWR0aHNbc3RhcnQrK10gPSB4cmVmLmZldGNoSWZSZWYoY29kZVtqXSk7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIGNvbnN0IHdpZHRoID0geHJlZi5mZXRjaElmUmVmKHdpZHRoc1srK2ldKTsKICAgICAgICAgICAgZm9yIChqID0gc3RhcnQ7IGogPD0gY29kZTsgaisrKSB7CiAgICAgICAgICAgICAgZ2x5cGhzV2lkdGhzW2pdID0gd2lkdGg7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICB9CiAgICAgIH0KICAgICAgaWYgKHByb3BlcnRpZXMudmVydGljYWwpIHsKICAgICAgICBsZXQgdm1ldHJpY3MgPSBkaWN0LmdldEFycmF5KCJEVzIiKSB8fCBbODgwLCAtMTAwMF07CiAgICAgICAgZGVmYXVsdFZNZXRyaWNzID0gW3ZtZXRyaWNzWzFdLCBkZWZhdWx0V2lkdGggKiAwLjUsIHZtZXRyaWNzWzBdXTsKICAgICAgICB2bWV0cmljcyA9IGRpY3QuZ2V0KCJXMiIpOwogICAgICAgIGlmICh2bWV0cmljcykgewogICAgICAgICAgZm9yIChpID0gMCwgaWkgPSB2bWV0cmljcy5sZW5ndGg7IGkgPCBpaTsgaSsrKSB7CiAgICAgICAgICAgIHN0YXJ0ID0geHJlZi5mZXRjaElmUmVmKHZtZXRyaWNzW2krK10pOwogICAgICAgICAgICBjb2RlID0geHJlZi5mZXRjaElmUmVmKHZtZXRyaWNzW2ldKTsKICAgICAgICAgICAgaWYgKEFycmF5LmlzQXJyYXkoY29kZSkpIHsKICAgICAgICAgICAgICBmb3IgKGogPSAwLCBqaiA9IGNvZGUubGVuZ3RoOyBqIDwgamo7IGorKykgewogICAgICAgICAgICAgICAgZ2x5cGhzVk1ldHJpY3Nbc3RhcnQrK10gPSBbeHJlZi5mZXRjaElmUmVmKGNvZGVbaisrXSksIHhyZWYuZmV0Y2hJZlJlZihjb2RlW2orK10pLCB4cmVmLmZldGNoSWZSZWYoY29kZVtqXSldOwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICBjb25zdCB2bWV0cmljID0gW3hyZWYuZmV0Y2hJZlJlZih2bWV0cmljc1srK2ldKSwgeHJlZi5mZXRjaElmUmVmKHZtZXRyaWNzWysraV0pLCB4cmVmLmZldGNoSWZSZWYodm1ldHJpY3NbKytpXSldOwogICAgICAgICAgICAgIGZvciAoaiA9IHN0YXJ0OyBqIDw9IGNvZGU7IGorKykgewogICAgICAgICAgICAgICAgZ2x5cGhzVk1ldHJpY3Nbal0gPSB2bWV0cmljOwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgIH0KICAgICAgfQogICAgfSBlbHNlIHsKICAgICAgY29uc3QgZmlyc3RDaGFyID0gcHJvcGVydGllcy5maXJzdENoYXI7CiAgICAgIHdpZHRocyA9IGRpY3QuZ2V0KCJXaWR0aHMiKTsKICAgICAgaWYgKHdpZHRocykgewogICAgICAgIGogPSBmaXJzdENoYXI7CiAgICAgICAgZm9yIChpID0gMCwgaWkgPSB3aWR0aHMubGVuZ3RoOyBpIDwgaWk7IGkrKykgewogICAgICAgICAgZ2x5cGhzV2lkdGhzW2orK10gPSB4cmVmLmZldGNoSWZSZWYod2lkdGhzW2ldKTsKICAgICAgICB9CiAgICAgICAgZGVmYXVsdFdpZHRoID0gcGFyc2VGbG9hdChkZXNjcmlwdG9yLmdldCgiTWlzc2luZ1dpZHRoIikpIHx8IDA7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgY29uc3QgYmFzZUZvbnROYW1lID0gZGljdC5nZXQoIkJhc2VGb250Iik7CiAgICAgICAgaWYgKGJhc2VGb250TmFtZSBpbnN0YW5jZW9mIF9wcmltaXRpdmVzLk5hbWUpIHsKICAgICAgICAgIGNvbnN0IG1ldHJpY3MgPSB0aGlzLmdldEJhc2VGb250TWV0cmljcyhiYXNlRm9udE5hbWUubmFtZSk7CiAgICAgICAgICBnbHlwaHNXaWR0aHMgPSB0aGlzLmJ1aWxkQ2hhckNvZGVUb1dpZHRoKG1ldHJpY3Mud2lkdGhzLCBwcm9wZXJ0aWVzKTsKICAgICAgICAgIGRlZmF1bHRXaWR0aCA9IG1ldHJpY3MuZGVmYXVsdFdpZHRoOwogICAgICAgIH0KICAgICAgfQogICAgfQogICAgbGV0IGlzTW9ub3NwYWNlID0gdHJ1ZTsKICAgIGxldCBmaXJzdFdpZHRoID0gZGVmYXVsdFdpZHRoOwogICAgZm9yIChjb25zdCBnbHlwaCBpbiBnbHlwaHNXaWR0aHMpIHsKICAgICAgY29uc3QgZ2x5cGhXaWR0aCA9IGdseXBoc1dpZHRoc1tnbHlwaF07CiAgICAgIGlmICghZ2x5cGhXaWR0aCkgewogICAgICAgIGNvbnRpbnVlOwogICAgICB9CiAgICAgIGlmICghZmlyc3RXaWR0aCkgewogICAgICAgIGZpcnN0V2lkdGggPSBnbHlwaFdpZHRoOwogICAgICAgIGNvbnRpbnVlOwogICAgICB9CiAgICAgIGlmIChmaXJzdFdpZHRoICE9PSBnbHlwaFdpZHRoKSB7CiAgICAgICAgaXNNb25vc3BhY2UgPSBmYWxzZTsKICAgICAgICBicmVhazsKICAgICAgfQogICAgfQogICAgaWYgKGlzTW9ub3NwYWNlKSB7CiAgICAgIHByb3BlcnRpZXMuZmxhZ3MgfD0gX2ZvbnRzX3V0aWxzLkZvbnRGbGFncy5GaXhlZFBpdGNoOwogICAgfSBlbHNlIHsKICAgICAgcHJvcGVydGllcy5mbGFncyAmPSB+X2ZvbnRzX3V0aWxzLkZvbnRGbGFncy5GaXhlZFBpdGNoOwogICAgfQogICAgcHJvcGVydGllcy5kZWZhdWx0V2lkdGggPSBkZWZhdWx0V2lkdGg7CiAgICBwcm9wZXJ0aWVzLndpZHRocyA9IGdseXBoc1dpZHRoczsKICAgIHByb3BlcnRpZXMuZGVmYXVsdFZNZXRyaWNzID0gZGVmYXVsdFZNZXRyaWNzOwogICAgcHJvcGVydGllcy52bWV0cmljcyA9IGdseXBoc1ZNZXRyaWNzOwogIH0KICBpc1NlcmlmRm9udChiYXNlRm9udE5hbWUpIHsKICAgIGNvbnN0IGZvbnROYW1lV29TdHlsZSA9IGJhc2VGb250TmFtZS5zcGxpdCgiLSIpWzBdOwogICAgcmV0dXJuIGZvbnROYW1lV29TdHlsZSBpbiAoMCwgX3N0YW5kYXJkX2ZvbnRzLmdldFNlcmlmRm9udHMpKCkgfHwgL3NlcmlmL2dpLnRlc3QoZm9udE5hbWVXb1N0eWxlKTsKICB9CiAgZ2V0QmFzZUZvbnRNZXRyaWNzKG5hbWUpIHsKICAgIGxldCBkZWZhdWx0V2lkdGggPSAwOwogICAgbGV0IHdpZHRocyA9IE9iamVjdC5jcmVhdGUobnVsbCk7CiAgICBsZXQgbW9ub3NwYWNlID0gZmFsc2U7CiAgICBjb25zdCBzdGRGb250TWFwID0gKDAsIF9zdGFuZGFyZF9mb250cy5nZXRTdGRGb250TWFwKSgpOwogICAgbGV0IGxvb2t1cE5hbWUgPSBzdGRGb250TWFwW25hbWVdIHx8IG5hbWU7CiAgICBjb25zdCBNZXRyaWNzID0gKDAsIF9tZXRyaWNzLmdldE1ldHJpY3MpKCk7CiAgICBpZiAoIShsb29rdXBOYW1lIGluIE1ldHJpY3MpKSB7CiAgICAgIGxvb2t1cE5hbWUgPSB0aGlzLmlzU2VyaWZGb250KG5hbWUpID8gIlRpbWVzLVJvbWFuIiA6ICJIZWx2ZXRpY2EiOwogICAgfQogICAgY29uc3QgZ2x5cGhXaWR0aHMgPSBNZXRyaWNzW2xvb2t1cE5hbWVdOwogICAgaWYgKHR5cGVvZiBnbHlwaFdpZHRocyA9PT0gIm51bWJlciIpIHsKICAgICAgZGVmYXVsdFdpZHRoID0gZ2x5cGhXaWR0aHM7CiAgICAgIG1vbm9zcGFjZSA9IHRydWU7CiAgICB9IGVsc2UgewogICAgICB3aWR0aHMgPSBnbHlwaFdpZHRocygpOwogICAgfQogICAgcmV0dXJuIHsKICAgICAgZGVmYXVsdFdpZHRoLAogICAgICBtb25vc3BhY2UsCiAgICAgIHdpZHRocwogICAgfTsKICB9CiAgYnVpbGRDaGFyQ29kZVRvV2lkdGgod2lkdGhzQnlHbHlwaE5hbWUsIHByb3BlcnRpZXMpIHsKICAgIGNvbnN0IHdpZHRocyA9IE9iamVjdC5jcmVhdGUobnVsbCk7CiAgICBjb25zdCBkaWZmZXJlbmNlcyA9IHByb3BlcnRpZXMuZGlmZmVyZW5jZXM7CiAgICBjb25zdCBlbmNvZGluZyA9IHByb3BlcnRpZXMuZGVmYXVsdEVuY29kaW5nOwogICAgZm9yIChsZXQgY2hhckNvZGUgPSAwOyBjaGFyQ29kZSA8IDI1NjsgY2hhckNvZGUrKykgewogICAgICBpZiAoY2hhckNvZGUgaW4gZGlmZmVyZW5jZXMgJiYgd2lkdGhzQnlHbHlwaE5hbWVbZGlmZmVyZW5jZXNbY2hhckNvZGVdXSkgewogICAgICAgIHdpZHRoc1tjaGFyQ29kZV0gPSB3aWR0aHNCeUdseXBoTmFtZVtkaWZmZXJlbmNlc1tjaGFyQ29kZV1dOwogICAgICAgIGNvbnRpbnVlOwogICAgICB9CiAgICAgIGlmIChjaGFyQ29kZSBpbiBlbmNvZGluZyAmJiB3aWR0aHNCeUdseXBoTmFtZVtlbmNvZGluZ1tjaGFyQ29kZV1dKSB7CiAgICAgICAgd2lkdGhzW2NoYXJDb2RlXSA9IHdpZHRoc0J5R2x5cGhOYW1lW2VuY29kaW5nW2NoYXJDb2RlXV07CiAgICAgICAgY29udGludWU7CiAgICAgIH0KICAgIH0KICAgIHJldHVybiB3aWR0aHM7CiAgfQogIHByZUV2YWx1YXRlRm9udChkaWN0KSB7CiAgICBjb25zdCBiYXNlRGljdCA9IGRpY3Q7CiAgICBsZXQgdHlwZSA9IGRpY3QuZ2V0KCJTdWJ0eXBlIik7CiAgICBpZiAoISh0eXBlIGluc3RhbmNlb2YgX3ByaW1pdGl2ZXMuTmFtZSkpIHsKICAgICAgdGhyb3cgbmV3IF91dGlsLkZvcm1hdEVycm9yKCJpbnZhbGlkIGZvbnQgU3VidHlwZSIpOwogICAgfQogICAgbGV0IGNvbXBvc2l0ZSA9IGZhbHNlOwogICAgbGV0IGhhc2gsIHRvVW5pY29kZTsKICAgIGlmICh0eXBlLm5hbWUgPT09ICJUeXBlMCIpIHsKICAgICAgY29uc3QgZGYgPSBkaWN0LmdldCgiRGVzY2VuZGFudEZvbnRzIik7CiAgICAgIGlmICghZGYpIHsKICAgICAgICB0aHJvdyBuZXcgX3V0aWwuRm9ybWF0RXJyb3IoIkRlc2NlbmRhbnQgZm9udHMgYXJlIG5vdCBzcGVjaWZpZWQiKTsKICAgICAgfQogICAgICBkaWN0ID0gQXJyYXkuaXNBcnJheShkZikgPyB0aGlzLnhyZWYuZmV0Y2hJZlJlZihkZlswXSkgOiBkZjsKICAgICAgaWYgKCEoZGljdCBpbnN0YW5jZW9mIF9wcmltaXRpdmVzLkRpY3QpKSB7CiAgICAgICAgdGhyb3cgbmV3IF91dGlsLkZvcm1hdEVycm9yKCJEZXNjZW5kYW50IGZvbnQgaXMgbm90IGEgZGljdGlvbmFyeS4iKTsKICAgICAgfQogICAgICB0eXBlID0gZGljdC5nZXQoIlN1YnR5cGUiKTsKICAgICAgaWYgKCEodHlwZSBpbnN0YW5jZW9mIF9wcmltaXRpdmVzLk5hbWUpKSB7CiAgICAgICAgdGhyb3cgbmV3IF91dGlsLkZvcm1hdEVycm9yKCJpbnZhbGlkIGZvbnQgU3VidHlwZSIpOwogICAgICB9CiAgICAgIGNvbXBvc2l0ZSA9IHRydWU7CiAgICB9CiAgICBjb25zdCBmaXJzdENoYXIgPSBkaWN0LmdldCgiRmlyc3RDaGFyIikgfHwgMCwKICAgICAgbGFzdENoYXIgPSBkaWN0LmdldCgiTGFzdENoYXIiKSB8fCAoY29tcG9zaXRlID8gMHhmZmZmIDogMHhmZik7CiAgICBjb25zdCBkZXNjcmlwdG9yID0gZGljdC5nZXQoIkZvbnREZXNjcmlwdG9yIik7CiAgICBpZiAoZGVzY3JpcHRvcikgewogICAgICBoYXNoID0gbmV3IF9tdXJtdXJoYXNoLk11cm11ckhhc2gzXzY0KCk7CiAgICAgIGNvbnN0IGVuY29kaW5nID0gYmFzZURpY3QuZ2V0UmF3KCJFbmNvZGluZyIpOwogICAgICBpZiAoZW5jb2RpbmcgaW5zdGFuY2VvZiBfcHJpbWl0aXZlcy5OYW1lKSB7CiAgICAgICAgaGFzaC51cGRhdGUoZW5jb2RpbmcubmFtZSk7CiAgICAgIH0gZWxzZSBpZiAoZW5jb2RpbmcgaW5zdGFuY2VvZiBfcHJpbWl0aXZlcy5SZWYpIHsKICAgICAgICBoYXNoLnVwZGF0ZShlbmNvZGluZy50b1N0cmluZygpKTsKICAgICAgfSBlbHNlIGlmIChlbmNvZGluZyBpbnN0YW5jZW9mIF9wcmltaXRpdmVzLkRpY3QpIHsKICAgICAgICBmb3IgKGNvbnN0IGVudHJ5IG9mIGVuY29kaW5nLmdldFJhd1ZhbHVlcygpKSB7CiAgICAgICAgICBpZiAoZW50cnkgaW5zdGFuY2VvZiBfcHJpbWl0aXZlcy5OYW1lKSB7CiAgICAgICAgICAgIGhhc2gudXBkYXRlKGVudHJ5Lm5hbWUpOwogICAgICAgICAgfSBlbHNlIGlmIChlbnRyeSBpbnN0YW5jZW9mIF9wcmltaXRpdmVzLlJlZikgewogICAgICAgICAgICBoYXNoLnVwZGF0ZShlbnRyeS50b1N0cmluZygpKTsKICAgICAgICAgIH0gZWxzZSBpZiAoQXJyYXkuaXNBcnJheShlbnRyeSkpIHsKICAgICAgICAgICAgY29uc3QgZGlmZkxlbmd0aCA9IGVudHJ5Lmxlbmd0aCwKICAgICAgICAgICAgICBkaWZmQnVmID0gbmV3IEFycmF5KGRpZmZMZW5ndGgpOwogICAgICAgICAgICBmb3IgKGxldCBqID0gMDsgaiA8IGRpZmZMZW5ndGg7IGorKykgewogICAgICAgICAgICAgIGNvbnN0IGRpZmZFbnRyeSA9IGVudHJ5W2pdOwogICAgICAgICAgICAgIGlmIChkaWZmRW50cnkgaW5zdGFuY2VvZiBfcHJpbWl0aXZlcy5OYW1lKSB7CiAgICAgICAgICAgICAgICBkaWZmQnVmW2pdID0gZGlmZkVudHJ5Lm5hbWU7CiAgICAgICAgICAgICAgfSBlbHNlIGlmICh0eXBlb2YgZGlmZkVudHJ5ID09PSAibnVtYmVyIiB8fCBkaWZmRW50cnkgaW5zdGFuY2VvZiBfcHJpbWl0aXZlcy5SZWYpIHsKICAgICAgICAgICAgICAgIGRpZmZCdWZbal0gPSBkaWZmRW50cnkudG9TdHJpbmcoKTsKICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICAgICAgaGFzaC51cGRhdGUoZGlmZkJ1Zi5qb2luKCkpOwogICAgICAgICAgfQogICAgICAgIH0KICAgICAgfQogICAgICBoYXNoLnVwZGF0ZShgJHtmaXJzdENoYXJ9LSR7bGFzdENoYXJ9YCk7CiAgICAgIHRvVW5pY29kZSA9IGRpY3QuZ2V0KCJUb1VuaWNvZGUiKSB8fCBiYXNlRGljdC5nZXQoIlRvVW5pY29kZSIpOwogICAgICBpZiAodG9Vbmljb2RlIGluc3RhbmNlb2YgX2Jhc2Vfc3RyZWFtLkJhc2VTdHJlYW0pIHsKICAgICAgICBjb25zdCBzdHJlYW0gPSB0b1VuaWNvZGUuc3RyIHx8IHRvVW5pY29kZTsKICAgICAgICBjb25zdCB1aW50OGFycmF5ID0gc3RyZWFtLmJ1ZmZlciA/IG5ldyBVaW50OEFycmF5KHN0cmVhbS5idWZmZXIuYnVmZmVyLCAwLCBzdHJlYW0uYnVmZmVyTGVuZ3RoKSA6IG5ldyBVaW50OEFycmF5KHN0cmVhbS5ieXRlcy5idWZmZXIsIHN0cmVhbS5zdGFydCwgc3RyZWFtLmVuZCAtIHN0cmVhbS5zdGFydCk7CiAgICAgICAgaGFzaC51cGRhdGUodWludDhhcnJheSk7CiAgICAgIH0gZWxzZSBpZiAodG9Vbmljb2RlIGluc3RhbmNlb2YgX3ByaW1pdGl2ZXMuTmFtZSkgewogICAgICAgIGhhc2gudXBkYXRlKHRvVW5pY29kZS5uYW1lKTsKICAgICAgfQogICAgICBjb25zdCB3aWR0aHMgPSBkaWN0LmdldCgiV2lkdGhzIikgfHwgYmFzZURpY3QuZ2V0KCJXaWR0aHMiKTsKICAgICAgaWYgKEFycmF5LmlzQXJyYXkod2lkdGhzKSkgewogICAgICAgIGNvbnN0IHdpZHRoc0J1ZiA9IFtdOwogICAgICAgIGZvciAoY29uc3QgZW50cnkgb2Ygd2lkdGhzKSB7CiAgICAgICAgICBpZiAodHlwZW9mIGVudHJ5ID09PSAibnVtYmVyIiB8fCBlbnRyeSBpbnN0YW5jZW9mIF9wcmltaXRpdmVzLlJlZikgewogICAgICAgICAgICB3aWR0aHNCdWYucHVzaChlbnRyeS50b1N0cmluZygpKTsKICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgaGFzaC51cGRhdGUod2lkdGhzQnVmLmpvaW4oKSk7CiAgICAgIH0KICAgICAgaWYgKGNvbXBvc2l0ZSkgewogICAgICAgIGhhc2gudXBkYXRlKCJjb21wb3NpdGVGb250Iik7CiAgICAgICAgY29uc3QgY29tcG9zaXRlV2lkdGhzID0gZGljdC5nZXQoIlciKSB8fCBiYXNlRGljdC5nZXQoIlciKTsKICAgICAgICBpZiAoQXJyYXkuaXNBcnJheShjb21wb3NpdGVXaWR0aHMpKSB7CiAgICAgICAgICBjb25zdCB3aWR0aHNCdWYgPSBbXTsKICAgICAgICAgIGZvciAoY29uc3QgZW50cnkgb2YgY29tcG9zaXRlV2lkdGhzKSB7CiAgICAgICAgICAgIGlmICh0eXBlb2YgZW50cnkgPT09ICJudW1iZXIiIHx8IGVudHJ5IGluc3RhbmNlb2YgX3ByaW1pdGl2ZXMuUmVmKSB7CiAgICAgICAgICAgICAgd2lkdGhzQnVmLnB1c2goZW50cnkudG9TdHJpbmcoKSk7CiAgICAgICAgICAgIH0gZWxzZSBpZiAoQXJyYXkuaXNBcnJheShlbnRyeSkpIHsKICAgICAgICAgICAgICBjb25zdCBzdWJXaWR0aHNCdWYgPSBbXTsKICAgICAgICAgICAgICBmb3IgKGNvbnN0IGVsZW1lbnQgb2YgZW50cnkpIHsKICAgICAgICAgICAgICAgIGlmICh0eXBlb2YgZWxlbWVudCA9PT0gIm51bWJlciIgfHwgZWxlbWVudCBpbnN0YW5jZW9mIF9wcmltaXRpdmVzLlJlZikgewogICAgICAgICAgICAgICAgICBzdWJXaWR0aHNCdWYucHVzaChlbGVtZW50LnRvU3RyaW5nKCkpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIH0KICAgICAgICAgICAgICB3aWR0aHNCdWYucHVzaChgWyR7c3ViV2lkdGhzQnVmLmpvaW4oKX1dYCk7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICAgIGhhc2gudXBkYXRlKHdpZHRoc0J1Zi5qb2luKCkpOwogICAgICAgIH0KICAgICAgICBjb25zdCBjaWRUb0dpZE1hcCA9IGRpY3QuZ2V0UmF3KCJDSURUb0dJRE1hcCIpIHx8IGJhc2VEaWN0LmdldFJhdygiQ0lEVG9HSURNYXAiKTsKICAgICAgICBpZiAoY2lkVG9HaWRNYXAgaW5zdGFuY2VvZiBfcHJpbWl0aXZlcy5OYW1lKSB7CiAgICAgICAgICBoYXNoLnVwZGF0ZShjaWRUb0dpZE1hcC5uYW1lKTsKICAgICAgICB9IGVsc2UgaWYgKGNpZFRvR2lkTWFwIGluc3RhbmNlb2YgX3ByaW1pdGl2ZXMuUmVmKSB7CiAgICAgICAgICBoYXNoLnVwZGF0ZShjaWRUb0dpZE1hcC50b1N0cmluZygpKTsKICAgICAgICB9IGVsc2UgaWYgKGNpZFRvR2lkTWFwIGluc3RhbmNlb2YgX2Jhc2Vfc3RyZWFtLkJhc2VTdHJlYW0pIHsKICAgICAgICAgIGhhc2gudXBkYXRlKGNpZFRvR2lkTWFwLnBlZWtCeXRlcygpKTsKICAgICAgICB9CiAgICAgIH0KICAgIH0KICAgIHJldHVybiB7CiAgICAgIGRlc2NyaXB0b3IsCiAgICAgIGRpY3QsCiAgICAgIGJhc2VEaWN0LAogICAgICBjb21wb3NpdGUsCiAgICAgIHR5cGU6IHR5cGUubmFtZSwKICAgICAgZmlyc3RDaGFyLAogICAgICBsYXN0Q2hhciwKICAgICAgdG9Vbmljb2RlLAogICAgICBoYXNoOiBoYXNoID8gaGFzaC5oZXhkaWdlc3QoKSA6ICIiCiAgICB9OwogIH0KICBhc3luYyB0cmFuc2xhdGVGb250KHsKICAgIGRlc2NyaXB0b3IsCiAgICBkaWN0LAogICAgYmFzZURpY3QsCiAgICBjb21wb3NpdGUsCiAgICB0eXBlLAogICAgZmlyc3RDaGFyLAogICAgbGFzdENoYXIsCiAgICB0b1VuaWNvZGUsCiAgICBjc3NGb250SW5mbwogIH0pIHsKICAgIGNvbnN0IGlzVHlwZTNGb250ID0gdHlwZSA9PT0gIlR5cGUzIjsKICAgIGxldCBwcm9wZXJ0aWVzOwogICAgaWYgKCFkZXNjcmlwdG9yKSB7CiAgICAgIGlmIChpc1R5cGUzRm9udCkgewogICAgICAgIGRlc2NyaXB0b3IgPSBuZXcgX3ByaW1pdGl2ZXMuRGljdChudWxsKTsKICAgICAgICBkZXNjcmlwdG9yLnNldCgiRm9udE5hbWUiLCBfcHJpbWl0aXZlcy5OYW1lLmdldCh0eXBlKSk7CiAgICAgICAgZGVzY3JpcHRvci5zZXQoIkZvbnRCQm94IiwgZGljdC5nZXRBcnJheSgiRm9udEJCb3giKSB8fCBbMCwgMCwgMCwgMF0pOwogICAgICB9IGVsc2UgewogICAgICAgIGxldCBiYXNlRm9udE5hbWUgPSBkaWN0LmdldCgiQmFzZUZvbnQiKTsKICAgICAgICBpZiAoIShiYXNlRm9udE5hbWUgaW5zdGFuY2VvZiBfcHJpbWl0aXZlcy5OYW1lKSkgewogICAgICAgICAgdGhyb3cgbmV3IF91dGlsLkZvcm1hdEVycm9yKCJCYXNlIGZvbnQgaXMgbm90IHNwZWNpZmllZCIpOwogICAgICAgIH0KICAgICAgICBiYXNlRm9udE5hbWUgPSBiYXNlRm9udE5hbWUubmFtZS5yZXBsYWNlQWxsKC9bLF9dL2csICItIik7CiAgICAgICAgY29uc3QgbWV0cmljcyA9IHRoaXMuZ2V0QmFzZUZvbnRNZXRyaWNzKGJhc2VGb250TmFtZSk7CiAgICAgICAgY29uc3QgZm9udE5hbWVXb1N0eWxlID0gYmFzZUZvbnROYW1lLnNwbGl0KCItIilbMF07CiAgICAgICAgY29uc3QgZmxhZ3MgPSAodGhpcy5pc1NlcmlmRm9udChmb250TmFtZVdvU3R5bGUpID8gX2ZvbnRzX3V0aWxzLkZvbnRGbGFncy5TZXJpZiA6IDApIHwgKG1ldHJpY3MubW9ub3NwYWNlID8gX2ZvbnRzX3V0aWxzLkZvbnRGbGFncy5GaXhlZFBpdGNoIDogMCkgfCAoKDAsIF9zdGFuZGFyZF9mb250cy5nZXRTeW1ib2xzRm9udHMpKClbZm9udE5hbWVXb1N0eWxlXSA/IF9mb250c191dGlscy5Gb250RmxhZ3MuU3ltYm9saWMgOiBfZm9udHNfdXRpbHMuRm9udEZsYWdzLk5vbnN5bWJvbGljKTsKICAgICAgICBwcm9wZXJ0aWVzID0gewogICAgICAgICAgdHlwZSwKICAgICAgICAgIG5hbWU6IGJhc2VGb250TmFtZSwKICAgICAgICAgIGxvYWRlZE5hbWU6IGJhc2VEaWN0LmxvYWRlZE5hbWUsCiAgICAgICAgICBzeXN0ZW1Gb250SW5mbzogbnVsbCwKICAgICAgICAgIHdpZHRoczogbWV0cmljcy53aWR0aHMsCiAgICAgICAgICBkZWZhdWx0V2lkdGg6IG1ldHJpY3MuZGVmYXVsdFdpZHRoLAogICAgICAgICAgaXNTaW11bGF0ZWRGbGFnczogdHJ1ZSwKICAgICAgICAgIGZsYWdzLAogICAgICAgICAgZmlyc3RDaGFyLAogICAgICAgICAgbGFzdENoYXIsCiAgICAgICAgICB0b1VuaWNvZGUsCiAgICAgICAgICB4SGVpZ2h0OiAwLAogICAgICAgICAgY2FwSGVpZ2h0OiAwLAogICAgICAgICAgaXRhbGljQW5nbGU6IDAsCiAgICAgICAgICBpc1R5cGUzRm9udAogICAgICAgIH07CiAgICAgICAgY29uc3Qgd2lkdGhzID0gZGljdC5nZXQoIldpZHRocyIpOwogICAgICAgIGNvbnN0IHN0YW5kYXJkRm9udE5hbWUgPSAoMCwgX3N0YW5kYXJkX2ZvbnRzLmdldFN0YW5kYXJkRm9udE5hbWUpKGJhc2VGb250TmFtZSk7CiAgICAgICAgbGV0IGZpbGUgPSBudWxsOwogICAgICAgIGlmIChzdGFuZGFyZEZvbnROYW1lKSB7CiAgICAgICAgICBmaWxlID0gYXdhaXQgdGhpcy5mZXRjaFN0YW5kYXJkRm9udERhdGEoc3RhbmRhcmRGb250TmFtZSk7CiAgICAgICAgICBwcm9wZXJ0aWVzLmlzSW50ZXJuYWxGb250ID0gISFmaWxlOwogICAgICAgIH0KICAgICAgICBpZiAoIXByb3BlcnRpZXMuaXNJbnRlcm5hbEZvbnQgJiYgdGhpcy5vcHRpb25zLnVzZVN5c3RlbUZvbnRzKSB7CiAgICAgICAgICBwcm9wZXJ0aWVzLnN5c3RlbUZvbnRJbmZvID0gKDAsIF9mb250X3N1YnN0aXR1dGlvbnMuZ2V0Rm9udFN1YnN0aXR1dGlvbikodGhpcy5zeXN0ZW1Gb250Q2FjaGUsIHRoaXMuaWRGYWN0b3J5LCB0aGlzLm9wdGlvbnMuc3RhbmRhcmRGb250RGF0YVVybCwgYmFzZUZvbnROYW1lLCBzdGFuZGFyZEZvbnROYW1lKTsKICAgICAgICB9CiAgICAgICAgcmV0dXJuIHRoaXMuZXh0cmFjdERhdGFTdHJ1Y3R1cmVzKGRpY3QsIGRpY3QsIHByb3BlcnRpZXMpLnRoZW4obmV3UHJvcGVydGllcyA9PiB7CiAgICAgICAgICBpZiAod2lkdGhzKSB7CiAgICAgICAgICAgIGNvbnN0IGdseXBoV2lkdGhzID0gW107CiAgICAgICAgICAgIGxldCBqID0gZmlyc3RDaGFyOwogICAgICAgICAgICBmb3IgKGNvbnN0IHdpZHRoIG9mIHdpZHRocykgewogICAgICAgICAgICAgIGdseXBoV2lkdGhzW2orK10gPSB0aGlzLnhyZWYuZmV0Y2hJZlJlZih3aWR0aCk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgbmV3UHJvcGVydGllcy53aWR0aHMgPSBnbHlwaFdpZHRoczsKICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIG5ld1Byb3BlcnRpZXMud2lkdGhzID0gdGhpcy5idWlsZENoYXJDb2RlVG9XaWR0aChtZXRyaWNzLndpZHRocywgbmV3UHJvcGVydGllcyk7CiAgICAgICAgICB9CiAgICAgICAgICByZXR1cm4gbmV3IF9mb250cy5Gb250KGJhc2VGb250TmFtZSwgZmlsZSwgbmV3UHJvcGVydGllcyk7CiAgICAgICAgfSk7CiAgICAgIH0KICAgIH0KICAgIGxldCBmb250TmFtZSA9IGRlc2NyaXB0b3IuZ2V0KCJGb250TmFtZSIpOwogICAgbGV0IGJhc2VGb250ID0gZGljdC5nZXQoIkJhc2VGb250Iik7CiAgICBpZiAodHlwZW9mIGZvbnROYW1lID09PSAic3RyaW5nIikgewogICAgICBmb250TmFtZSA9IF9wcmltaXRpdmVzLk5hbWUuZ2V0KGZvbnROYW1lKTsKICAgIH0KICAgIGlmICh0eXBlb2YgYmFzZUZvbnQgPT09ICJzdHJpbmciKSB7CiAgICAgIGJhc2VGb250ID0gX3ByaW1pdGl2ZXMuTmFtZS5nZXQoYmFzZUZvbnQpOwogICAgfQogICAgY29uc3QgZm9udE5hbWVTdHIgPSBmb250TmFtZT8ubmFtZTsKICAgIGNvbnN0IGJhc2VGb250U3RyID0gYmFzZUZvbnQ/Lm5hbWU7CiAgICBpZiAoIWlzVHlwZTNGb250ICYmIGZvbnROYW1lU3RyICE9PSBiYXNlRm9udFN0cikgewogICAgICAoMCwgX3V0aWwuaW5mbykoYFRoZSBGb250RGVzY3JpcHRvcidzIEZvbnROYW1lIGlzICIke2ZvbnROYW1lU3RyfSIgYnV0IGAgKyBgc2hvdWxkIGJlIHRoZSBzYW1lIGFzIHRoZSBGb250J3MgQmFzZUZvbnQgIiR7YmFzZUZvbnRTdHJ9Ii5gKTsKICAgICAgaWYgKGZvbnROYW1lU3RyICYmIGJhc2VGb250U3RyICYmIChiYXNlRm9udFN0ci5zdGFydHNXaXRoKGZvbnROYW1lU3RyKSB8fCAhKDAsIF9zdGFuZGFyZF9mb250cy5pc0tub3duRm9udE5hbWUpKGZvbnROYW1lU3RyKSAmJiAoMCwgX3N0YW5kYXJkX2ZvbnRzLmlzS25vd25Gb250TmFtZSkoYmFzZUZvbnRTdHIpKSkgewogICAgICAgIGZvbnROYW1lID0gbnVsbDsKICAgICAgfQogICAgfQogICAgZm9udE5hbWUgfHw9IGJhc2VGb250OwogICAgaWYgKCEoZm9udE5hbWUgaW5zdGFuY2VvZiBfcHJpbWl0aXZlcy5OYW1lKSkgewogICAgICB0aHJvdyBuZXcgX3V0aWwuRm9ybWF0RXJyb3IoImludmFsaWQgZm9udCBuYW1lIik7CiAgICB9CiAgICBsZXQgZm9udEZpbGUsIHN1YnR5cGUsIGxlbmd0aDEsIGxlbmd0aDIsIGxlbmd0aDM7CiAgICB0cnkgewogICAgICBmb250RmlsZSA9IGRlc2NyaXB0b3IuZ2V0KCJGb250RmlsZSIsICJGb250RmlsZTIiLCAiRm9udEZpbGUzIik7CiAgICB9IGNhdGNoIChleCkgewogICAgICBpZiAoIXRoaXMub3B0aW9ucy5pZ25vcmVFcnJvcnMpIHsKICAgICAgICB0aHJvdyBleDsKICAgICAgfQogICAgICAoMCwgX3V0aWwud2FybikoYHRyYW5zbGF0ZUZvbnQgLSBmZXRjaGluZyAiJHtmb250TmFtZS5uYW1lfSIgZm9udCBmaWxlOiAiJHtleH0iLmApOwogICAgICBmb250RmlsZSA9IG5ldyBfc3RyZWFtLk51bGxTdHJlYW0oKTsKICAgIH0KICAgIGxldCBpc0ludGVybmFsRm9udCA9IGZhbHNlOwogICAgbGV0IGdseXBoU2NhbGVGYWN0b3JzID0gbnVsbDsKICAgIGxldCBzeXN0ZW1Gb250SW5mbyA9IG51bGw7CiAgICBpZiAoZm9udEZpbGUpIHsKICAgICAgaWYgKGZvbnRGaWxlLmRpY3QpIHsKICAgICAgICBjb25zdCBzdWJ0eXBlRW50cnkgPSBmb250RmlsZS5kaWN0LmdldCgiU3VidHlwZSIpOwogICAgICAgIGlmIChzdWJ0eXBlRW50cnkgaW5zdGFuY2VvZiBfcHJpbWl0aXZlcy5OYW1lKSB7CiAgICAgICAgICBzdWJ0eXBlID0gc3VidHlwZUVudHJ5Lm5hbWU7CiAgICAgICAgfQogICAgICAgIGxlbmd0aDEgPSBmb250RmlsZS5kaWN0LmdldCgiTGVuZ3RoMSIpOwogICAgICAgIGxlbmd0aDIgPSBmb250RmlsZS5kaWN0LmdldCgiTGVuZ3RoMiIpOwogICAgICAgIGxlbmd0aDMgPSBmb250RmlsZS5kaWN0LmdldCgiTGVuZ3RoMyIpOwogICAgICB9CiAgICB9IGVsc2UgaWYgKGNzc0ZvbnRJbmZvKSB7CiAgICAgIGNvbnN0IHN0YW5kYXJkRm9udE5hbWUgPSAoMCwgX3hmYV9mb250cy5nZXRYZmFGb250TmFtZSkoZm9udE5hbWUubmFtZSk7CiAgICAgIGlmIChzdGFuZGFyZEZvbnROYW1lKSB7CiAgICAgICAgY3NzRm9udEluZm8uZm9udEZhbWlseSA9IGAke2Nzc0ZvbnRJbmZvLmZvbnRGYW1pbHl9LVBkZkpTLVhGQWA7CiAgICAgICAgY3NzRm9udEluZm8ubWV0cmljcyA9IHN0YW5kYXJkRm9udE5hbWUubWV0cmljcyB8fCBudWxsOwogICAgICAgIGdseXBoU2NhbGVGYWN0b3JzID0gc3RhbmRhcmRGb250TmFtZS5mYWN0b3JzIHx8IG51bGw7CiAgICAgICAgZm9udEZpbGUgPSBhd2FpdCB0aGlzLmZldGNoU3RhbmRhcmRGb250RGF0YShzdGFuZGFyZEZvbnROYW1lLm5hbWUpOwogICAgICAgIGlzSW50ZXJuYWxGb250ID0gISFmb250RmlsZTsKICAgICAgICBiYXNlRGljdCA9IGRpY3QgPSAoMCwgX3hmYV9mb250cy5nZXRYZmFGb250RGljdCkoZm9udE5hbWUubmFtZSk7CiAgICAgICAgY29tcG9zaXRlID0gdHJ1ZTsKICAgICAgfQogICAgfSBlbHNlIGlmICghaXNUeXBlM0ZvbnQpIHsKICAgICAgY29uc3Qgc3RhbmRhcmRGb250TmFtZSA9ICgwLCBfc3RhbmRhcmRfZm9udHMuZ2V0U3RhbmRhcmRGb250TmFtZSkoZm9udE5hbWUubmFtZSk7CiAgICAgIGlmIChzdGFuZGFyZEZvbnROYW1lKSB7CiAgICAgICAgZm9udEZpbGUgPSBhd2FpdCB0aGlzLmZldGNoU3RhbmRhcmRGb250RGF0YShzdGFuZGFyZEZvbnROYW1lKTsKICAgICAgICBpc0ludGVybmFsRm9udCA9ICEhZm9udEZpbGU7CiAgICAgIH0KICAgICAgaWYgKCFpc0ludGVybmFsRm9udCAmJiB0aGlzLm9wdGlvbnMudXNlU3lzdGVtRm9udHMpIHsKICAgICAgICBzeXN0ZW1Gb250SW5mbyA9ICgwLCBfZm9udF9zdWJzdGl0dXRpb25zLmdldEZvbnRTdWJzdGl0dXRpb24pKHRoaXMuc3lzdGVtRm9udENhY2hlLCB0aGlzLmlkRmFjdG9yeSwgdGhpcy5vcHRpb25zLnN0YW5kYXJkRm9udERhdGFVcmwsIGZvbnROYW1lLm5hbWUsIHN0YW5kYXJkRm9udE5hbWUpOwogICAgICB9CiAgICB9CiAgICBwcm9wZXJ0aWVzID0gewogICAgICB0eXBlLAogICAgICBuYW1lOiBmb250TmFtZS5uYW1lLAogICAgICBzdWJ0eXBlLAogICAgICBmaWxlOiBmb250RmlsZSwKICAgICAgbGVuZ3RoMSwKICAgICAgbGVuZ3RoMiwKICAgICAgbGVuZ3RoMywKICAgICAgaXNJbnRlcm5hbEZvbnQsCiAgICAgIGxvYWRlZE5hbWU6IGJhc2VEaWN0LmxvYWRlZE5hbWUsCiAgICAgIGNvbXBvc2l0ZSwKICAgICAgZml4ZWRQaXRjaDogZmFsc2UsCiAgICAgIGZvbnRNYXRyaXg6IGRpY3QuZ2V0QXJyYXkoIkZvbnRNYXRyaXgiKSB8fCBfdXRpbC5GT05UX0lERU5USVRZX01BVFJJWCwKICAgICAgZmlyc3RDaGFyLAogICAgICBsYXN0Q2hhciwKICAgICAgdG9Vbmljb2RlLAogICAgICBiYm94OiBkZXNjcmlwdG9yLmdldEFycmF5KCJGb250QkJveCIpIHx8IGRpY3QuZ2V0QXJyYXkoIkZvbnRCQm94IiksCiAgICAgIGFzY2VudDogZGVzY3JpcHRvci5nZXQoIkFzY2VudCIpLAogICAgICBkZXNjZW50OiBkZXNjcmlwdG9yLmdldCgiRGVzY2VudCIpLAogICAgICB4SGVpZ2h0OiBkZXNjcmlwdG9yLmdldCgiWEhlaWdodCIpIHx8IDAsCiAgICAgIGNhcEhlaWdodDogZGVzY3JpcHRvci5nZXQoIkNhcEhlaWdodCIpIHx8IDAsCiAgICAgIGZsYWdzOiBkZXNjcmlwdG9yLmdldCgiRmxhZ3MiKSwKICAgICAgaXRhbGljQW5nbGU6IGRlc2NyaXB0b3IuZ2V0KCJJdGFsaWNBbmdsZSIpIHx8IDAsCiAgICAgIGlzVHlwZTNGb250LAogICAgICBjc3NGb250SW5mbywKICAgICAgc2NhbGVGYWN0b3JzOiBnbHlwaFNjYWxlRmFjdG9ycywKICAgICAgc3lzdGVtRm9udEluZm8KICAgIH07CiAgICBpZiAoY29tcG9zaXRlKSB7CiAgICAgIGNvbnN0IGNpZEVuY29kaW5nID0gYmFzZURpY3QuZ2V0KCJFbmNvZGluZyIpOwogICAgICBpZiAoY2lkRW5jb2RpbmcgaW5zdGFuY2VvZiBfcHJpbWl0aXZlcy5OYW1lKSB7CiAgICAgICAgcHJvcGVydGllcy5jaWRFbmNvZGluZyA9IGNpZEVuY29kaW5nLm5hbWU7CiAgICAgIH0KICAgICAgY29uc3QgY01hcCA9IGF3YWl0IF9jbWFwLkNNYXBGYWN0b3J5LmNyZWF0ZSh7CiAgICAgICAgZW5jb2Rpbmc6IGNpZEVuY29kaW5nLAogICAgICAgIGZldGNoQnVpbHRJbkNNYXA6IHRoaXMuX2ZldGNoQnVpbHRJbkNNYXBCb3VuZCwKICAgICAgICB1c2VDTWFwOiBudWxsCiAgICAgIH0pOwogICAgICBwcm9wZXJ0aWVzLmNNYXAgPSBjTWFwOwogICAgICBwcm9wZXJ0aWVzLnZlcnRpY2FsID0gcHJvcGVydGllcy5jTWFwLnZlcnRpY2FsOwogICAgfQogICAgcmV0dXJuIHRoaXMuZXh0cmFjdERhdGFTdHJ1Y3R1cmVzKGRpY3QsIGJhc2VEaWN0LCBwcm9wZXJ0aWVzKS50aGVuKG5ld1Byb3BlcnRpZXMgPT4gewogICAgICB0aGlzLmV4dHJhY3RXaWR0aHMoZGljdCwgZGVzY3JpcHRvciwgbmV3UHJvcGVydGllcyk7CiAgICAgIHJldHVybiBuZXcgX2ZvbnRzLkZvbnQoZm9udE5hbWUubmFtZSwgZm9udEZpbGUsIG5ld1Byb3BlcnRpZXMpOwogICAgfSk7CiAgfQogIHN0YXRpYyBidWlsZEZvbnRQYXRocyhmb250LCBnbHlwaHMsIGhhbmRsZXIsIGV2YWx1YXRvck9wdGlvbnMpIHsKICAgIGZ1bmN0aW9uIGJ1aWxkUGF0aChmb250Q2hhcikgewogICAgICBjb25zdCBnbHlwaE5hbWUgPSBgJHtmb250LmxvYWRlZE5hbWV9X3BhdGhfJHtmb250Q2hhcn1gOwogICAgICB0cnkgewogICAgICAgIGlmIChmb250LnJlbmRlcmVyLmhhc0J1aWx0UGF0aChmb250Q2hhcikpIHsKICAgICAgICAgIHJldHVybjsKICAgICAgICB9CiAgICAgICAgaGFuZGxlci5zZW5kKCJjb21tb25vYmoiLCBbZ2x5cGhOYW1lLCAiRm9udFBhdGgiLCBmb250LnJlbmRlcmVyLmdldFBhdGhKcyhmb250Q2hhcildKTsKICAgICAgfSBjYXRjaCAocmVhc29uKSB7CiAgICAgICAgaWYgKGV2YWx1YXRvck9wdGlvbnMuaWdub3JlRXJyb3JzKSB7CiAgICAgICAgICAoMCwgX3V0aWwud2FybikoYGJ1aWxkRm9udFBhdGhzIC0gaWdub3JpbmcgJHtnbHlwaE5hbWV9IGdseXBoOiAiJHtyZWFzb259Ii5gKTsKICAgICAgICAgIHJldHVybjsKICAgICAgICB9CiAgICAgICAgdGhyb3cgcmVhc29uOwogICAgICB9CiAgICB9CiAgICBmb3IgKGNvbnN0IGdseXBoIG9mIGdseXBocykgewogICAgICBidWlsZFBhdGgoZ2x5cGguZm9udENoYXIpOwogICAgICBjb25zdCBhY2NlbnQgPSBnbHlwaC5hY2NlbnQ7CiAgICAgIGlmIChhY2NlbnQ/LmZvbnRDaGFyKSB7CiAgICAgICAgYnVpbGRQYXRoKGFjY2VudC5mb250Q2hhcik7CiAgICAgIH0KICAgIH0KICB9CiAgc3RhdGljIGdldCBmYWxsYmFja0ZvbnREaWN0KCkgewogICAgY29uc3QgZGljdCA9IG5ldyBfcHJpbWl0aXZlcy5EaWN0KCk7CiAgICBkaWN0LnNldCgiQmFzZUZvbnQiLCBfcHJpbWl0aXZlcy5OYW1lLmdldCgiSGVsdmV0aWNhIikpOwogICAgZGljdC5zZXQoIlR5cGUiLCBfcHJpbWl0aXZlcy5OYW1lLmdldCgiRmFsbGJhY2tUeXBlIikpOwogICAgZGljdC5zZXQoIlN1YnR5cGUiLCBfcHJpbWl0aXZlcy5OYW1lLmdldCgiRmFsbGJhY2tUeXBlIikpOwogICAgZGljdC5zZXQoIkVuY29kaW5nIiwgX3ByaW1pdGl2ZXMuTmFtZS5nZXQoIldpbkFuc2lFbmNvZGluZyIpKTsKICAgIHJldHVybiAoMCwgX3V0aWwuc2hhZG93KSh0aGlzLCAiZmFsbGJhY2tGb250RGljdCIsIGRpY3QpOwogIH0KfQpleHBvcnRzLlBhcnRpYWxFdmFsdWF0b3IgPSBQYXJ0aWFsRXZhbHVhdG9yOwpjbGFzcyBUcmFuc2xhdGVkRm9udCB7CiAgY29uc3RydWN0b3IoewogICAgbG9hZGVkTmFtZSwKICAgIGZvbnQsCiAgICBkaWN0LAogICAgZXZhbHVhdG9yT3B0aW9ucwogIH0pIHsKICAgIHRoaXMubG9hZGVkTmFtZSA9IGxvYWRlZE5hbWU7CiAgICB0aGlzLmZvbnQgPSBmb250OwogICAgdGhpcy5kaWN0ID0gZGljdDsKICAgIHRoaXMuX2V2YWx1YXRvck9wdGlvbnMgPSBldmFsdWF0b3JPcHRpb25zIHx8IERlZmF1bHRQYXJ0aWFsRXZhbHVhdG9yT3B0aW9uczsKICAgIHRoaXMudHlwZTNMb2FkZWQgPSBudWxsOwogICAgdGhpcy50eXBlM0RlcGVuZGVuY2llcyA9IGZvbnQuaXNUeXBlM0ZvbnQgPyBuZXcgU2V0KCkgOiBudWxsOwogICAgdGhpcy5zZW50ID0gZmFsc2U7CiAgfQogIHNlbmQoaGFuZGxlcikgewogICAgaWYgKHRoaXMuc2VudCkgewogICAgICByZXR1cm47CiAgICB9CiAgICB0aGlzLnNlbnQgPSB0cnVlOwogICAgaGFuZGxlci5zZW5kKCJjb21tb25vYmoiLCBbdGhpcy5sb2FkZWROYW1lLCAiRm9udCIsIHRoaXMuZm9udC5leHBvcnREYXRhKHRoaXMuX2V2YWx1YXRvck9wdGlvbnMuZm9udEV4dHJhUHJvcGVydGllcyldKTsKICB9CiAgZmFsbGJhY2soaGFuZGxlcikgewogICAgaWYgKCF0aGlzLmZvbnQuZGF0YSkgewogICAgICByZXR1cm47CiAgICB9CiAgICB0aGlzLmZvbnQuZGlzYWJsZUZvbnRGYWNlID0gdHJ1ZTsKICAgIFBhcnRpYWxFdmFsdWF0b3IuYnVpbGRGb250UGF0aHModGhpcy5mb250LCB0aGlzLmZvbnQuZ2x5cGhDYWNoZVZhbHVlcywgaGFuZGxlciwgdGhpcy5fZXZhbHVhdG9yT3B0aW9ucyk7CiAgfQogIGxvYWRUeXBlM0RhdGEoZXZhbHVhdG9yLCByZXNvdXJjZXMsIHRhc2spIHsKICAgIGlmICh0aGlzLnR5cGUzTG9hZGVkKSB7CiAgICAgIHJldHVybiB0aGlzLnR5cGUzTG9hZGVkOwogICAgfQogICAgaWYgKCF0aGlzLmZvbnQuaXNUeXBlM0ZvbnQpIHsKICAgICAgdGhyb3cgbmV3IEVycm9yKCJNdXN0IGJlIGEgVHlwZTMgZm9udC4iKTsKICAgIH0KICAgIGNvbnN0IHR5cGUzRXZhbHVhdG9yID0gZXZhbHVhdG9yLmNsb25lKHsKICAgICAgaWdub3JlRXJyb3JzOiBmYWxzZQogICAgfSk7CiAgICB0eXBlM0V2YWx1YXRvci5wYXJzaW5nVHlwZTNGb250ID0gdHJ1ZTsKICAgIGNvbnN0IHR5cGUzRm9udFJlZnMgPSBuZXcgX3ByaW1pdGl2ZXMuUmVmU2V0KGV2YWx1YXRvci50eXBlM0ZvbnRSZWZzKTsKICAgIGlmICh0aGlzLmRpY3Qub2JqSWQgJiYgIXR5cGUzRm9udFJlZnMuaGFzKHRoaXMuZGljdC5vYmpJZCkpIHsKICAgICAgdHlwZTNGb250UmVmcy5wdXQodGhpcy5kaWN0Lm9iaklkKTsKICAgIH0KICAgIHR5cGUzRXZhbHVhdG9yLnR5cGUzRm9udFJlZnMgPSB0eXBlM0ZvbnRSZWZzOwogICAgY29uc3QgdHJhbnNsYXRlZEZvbnQgPSB0aGlzLmZvbnQsCiAgICAgIHR5cGUzRGVwZW5kZW5jaWVzID0gdGhpcy50eXBlM0RlcGVuZGVuY2llczsKICAgIGxldCBsb2FkQ2hhclByb2NzUHJvbWlzZSA9IFByb21pc2UucmVzb2x2ZSgpOwogICAgY29uc3QgY2hhclByb2NzID0gdGhpcy5kaWN0LmdldCgiQ2hhclByb2NzIik7CiAgICBjb25zdCBmb250UmVzb3VyY2VzID0gdGhpcy5kaWN0LmdldCgiUmVzb3VyY2VzIikgfHwgcmVzb3VyY2VzOwogICAgY29uc3QgY2hhclByb2NPcGVyYXRvckxpc3QgPSBPYmplY3QuY3JlYXRlKG51bGwpOwogICAgY29uc3QgZm9udEJCb3ggPSBfdXRpbC5VdGlsLm5vcm1hbGl6ZVJlY3QodHJhbnNsYXRlZEZvbnQuYmJveCB8fCBbMCwgMCwgMCwgMF0pLAogICAgICB3aWR0aCA9IGZvbnRCQm94WzJdIC0gZm9udEJCb3hbMF0sCiAgICAgIGhlaWdodCA9IGZvbnRCQm94WzNdIC0gZm9udEJCb3hbMV07CiAgICBjb25zdCBmb250QkJveFNpemUgPSBNYXRoLmh5cG90KHdpZHRoLCBoZWlnaHQpOwogICAgZm9yIChjb25zdCBrZXkgb2YgY2hhclByb2NzLmdldEtleXMoKSkgewogICAgICBsb2FkQ2hhclByb2NzUHJvbWlzZSA9IGxvYWRDaGFyUHJvY3NQcm9taXNlLnRoZW4oKCkgPT4gewogICAgICAgIGNvbnN0IGdseXBoU3RyZWFtID0gY2hhclByb2NzLmdldChrZXkpOwogICAgICAgIGNvbnN0IG9wZXJhdG9yTGlzdCA9IG5ldyBfb3BlcmF0b3JfbGlzdC5PcGVyYXRvckxpc3QoKTsKICAgICAgICByZXR1cm4gdHlwZTNFdmFsdWF0b3IuZ2V0T3BlcmF0b3JMaXN0KHsKICAgICAgICAgIHN0cmVhbTogZ2x5cGhTdHJlYW0sCiAgICAgICAgICB0YXNrLAogICAgICAgICAgcmVzb3VyY2VzOiBmb250UmVzb3VyY2VzLAogICAgICAgICAgb3BlcmF0b3JMaXN0CiAgICAgICAgfSkudGhlbigoKSA9PiB7CiAgICAgICAgICBpZiAob3BlcmF0b3JMaXN0LmZuQXJyYXlbMF0gPT09IF91dGlsLk9QUy5zZXRDaGFyV2lkdGhBbmRCb3VuZHMpIHsKICAgICAgICAgICAgdGhpcy5fcmVtb3ZlVHlwZTNDb2xvck9wZXJhdG9ycyhvcGVyYXRvckxpc3QsIGZvbnRCQm94U2l6ZSk7CiAgICAgICAgICB9CiAgICAgICAgICBjaGFyUHJvY09wZXJhdG9yTGlzdFtrZXldID0gb3BlcmF0b3JMaXN0LmdldElSKCk7CiAgICAgICAgICBmb3IgKGNvbnN0IGRlcGVuZGVuY3kgb2Ygb3BlcmF0b3JMaXN0LmRlcGVuZGVuY2llcykgewogICAgICAgICAgICB0eXBlM0RlcGVuZGVuY2llcy5hZGQoZGVwZW5kZW5jeSk7CiAgICAgICAgICB9CiAgICAgICAgfSkuY2F0Y2goZnVuY3Rpb24gKHJlYXNvbikgewogICAgICAgICAgKDAsIF91dGlsLndhcm4pKGBUeXBlMyBmb250IHJlc291cmNlICIke2tleX0iIGlzIG5vdCBhdmFpbGFibGUuYCk7CiAgICAgICAgICBjb25zdCBkdW1teU9wZXJhdG9yTGlzdCA9IG5ldyBfb3BlcmF0b3JfbGlzdC5PcGVyYXRvckxpc3QoKTsKICAgICAgICAgIGNoYXJQcm9jT3BlcmF0b3JMaXN0W2tleV0gPSBkdW1teU9wZXJhdG9yTGlzdC5nZXRJUigpOwogICAgICAgIH0pOwogICAgICB9KTsKICAgIH0KICAgIHRoaXMudHlwZTNMb2FkZWQgPSBsb2FkQ2hhclByb2NzUHJvbWlzZS50aGVuKCgpID0+IHsKICAgICAgdHJhbnNsYXRlZEZvbnQuY2hhclByb2NPcGVyYXRvckxpc3QgPSBjaGFyUHJvY09wZXJhdG9yTGlzdDsKICAgICAgaWYgKHRoaXMuX2Jib3gpIHsKICAgICAgICB0cmFuc2xhdGVkRm9udC5pc0NoYXJCQm94ID0gdHJ1ZTsKICAgICAgICB0cmFuc2xhdGVkRm9udC5iYm94ID0gdGhpcy5fYmJveDsKICAgICAgfQogICAgfSk7CiAgICByZXR1cm4gdGhpcy50eXBlM0xvYWRlZDsKICB9CiAgX3JlbW92ZVR5cGUzQ29sb3JPcGVyYXRvcnMob3BlcmF0b3JMaXN0LCBmb250QkJveFNpemUgPSBOYU4pIHsKICAgIGNvbnN0IGNoYXJCQm94ID0gX3V0aWwuVXRpbC5ub3JtYWxpemVSZWN0KG9wZXJhdG9yTGlzdC5hcmdzQXJyYXlbMF0uc2xpY2UoMikpLAogICAgICB3aWR0aCA9IGNoYXJCQm94WzJdIC0gY2hhckJCb3hbMF0sCiAgICAgIGhlaWdodCA9IGNoYXJCQm94WzNdIC0gY2hhckJCb3hbMV07CiAgICBjb25zdCBjaGFyQkJveFNpemUgPSBNYXRoLmh5cG90KHdpZHRoLCBoZWlnaHQpOwogICAgaWYgKHdpZHRoID09PSAwIHx8IGhlaWdodCA9PT0gMCkgewogICAgICBvcGVyYXRvckxpc3QuZm5BcnJheS5zcGxpY2UoMCwgMSk7CiAgICAgIG9wZXJhdG9yTGlzdC5hcmdzQXJyYXkuc3BsaWNlKDAsIDEpOwogICAgfSBlbHNlIGlmIChmb250QkJveFNpemUgPT09IDAgfHwgTWF0aC5yb3VuZChjaGFyQkJveFNpemUgLyBmb250QkJveFNpemUpID49IDEwKSB7CiAgICAgIGlmICghdGhpcy5fYmJveCkgewogICAgICAgIHRoaXMuX2Jib3ggPSBbSW5maW5pdHksIEluZmluaXR5LCAtSW5maW5pdHksIC1JbmZpbml0eV07CiAgICAgIH0KICAgICAgdGhpcy5fYmJveFswXSA9IE1hdGgubWluKHRoaXMuX2Jib3hbMF0sIGNoYXJCQm94WzBdKTsKICAgICAgdGhpcy5fYmJveFsxXSA9IE1hdGgubWluKHRoaXMuX2Jib3hbMV0sIGNoYXJCQm94WzFdKTsKICAgICAgdGhpcy5fYmJveFsyXSA9IE1hdGgubWF4KHRoaXMuX2Jib3hbMl0sIGNoYXJCQm94WzJdKTsKICAgICAgdGhpcy5fYmJveFszXSA9IE1hdGgubWF4KHRoaXMuX2Jib3hbM10sIGNoYXJCQm94WzNdKTsKICAgIH0KICAgIGxldCBpID0gMCwKICAgICAgaWkgPSBvcGVyYXRvckxpc3QubGVuZ3RoOwogICAgd2hpbGUgKGkgPCBpaSkgewogICAgICBzd2l0Y2ggKG9wZXJhdG9yTGlzdC5mbkFycmF5W2ldKSB7CiAgICAgICAgY2FzZSBfdXRpbC5PUFMuc2V0Q2hhcldpZHRoQW5kQm91bmRzOgogICAgICAgICAgYnJlYWs7CiAgICAgICAgY2FzZSBfdXRpbC5PUFMuc2V0U3Ryb2tlQ29sb3JTcGFjZToKICAgICAgICBjYXNlIF91dGlsLk9QUy5zZXRGaWxsQ29sb3JTcGFjZToKICAgICAgICBjYXNlIF91dGlsLk9QUy5zZXRTdHJva2VDb2xvcjoKICAgICAgICBjYXNlIF91dGlsLk9QUy5zZXRTdHJva2VDb2xvck46CiAgICAgICAgY2FzZSBfdXRpbC5PUFMuc2V0RmlsbENvbG9yOgogICAgICAgIGNhc2UgX3V0aWwuT1BTLnNldEZpbGxDb2xvck46CiAgICAgICAgY2FzZSBfdXRpbC5PUFMuc2V0U3Ryb2tlR3JheToKICAgICAgICBjYXNlIF91dGlsLk9QUy5zZXRGaWxsR3JheToKICAgICAgICBjYXNlIF91dGlsLk9QUy5zZXRTdHJva2VSR0JDb2xvcjoKICAgICAgICBjYXNlIF91dGlsLk9QUy5zZXRGaWxsUkdCQ29sb3I6CiAgICAgICAgY2FzZSBfdXRpbC5PUFMuc2V0U3Ryb2tlQ01ZS0NvbG9yOgogICAgICAgIGNhc2UgX3V0aWwuT1BTLnNldEZpbGxDTVlLQ29sb3I6CiAgICAgICAgY2FzZSBfdXRpbC5PUFMuc2hhZGluZ0ZpbGw6CiAgICAgICAgY2FzZSBfdXRpbC5PUFMuc2V0UmVuZGVyaW5nSW50ZW50OgogICAgICAgICAgb3BlcmF0b3JMaXN0LmZuQXJyYXkuc3BsaWNlKGksIDEpOwogICAgICAgICAgb3BlcmF0b3JMaXN0LmFyZ3NBcnJheS5zcGxpY2UoaSwgMSk7CiAgICAgICAgICBpaS0tOwogICAgICAgICAgY29udGludWU7CiAgICAgICAgY2FzZSBfdXRpbC5PUFMuc2V0R1N0YXRlOgogICAgICAgICAgY29uc3QgW2dTdGF0ZU9ial0gPSBvcGVyYXRvckxpc3QuYXJnc0FycmF5W2ldOwogICAgICAgICAgbGV0IGogPSAwLAogICAgICAgICAgICBqaiA9IGdTdGF0ZU9iai5sZW5ndGg7CiAgICAgICAgICB3aGlsZSAoaiA8IGpqKSB7CiAgICAgICAgICAgIGNvbnN0IFtnU3RhdGVLZXldID0gZ1N0YXRlT2JqW2pdOwogICAgICAgICAgICBzd2l0Y2ggKGdTdGF0ZUtleSkgewogICAgICAgICAgICAgIGNhc2UgIlRSIjoKICAgICAgICAgICAgICBjYXNlICJUUjIiOgogICAgICAgICAgICAgIGNhc2UgIkhUIjoKICAgICAgICAgICAgICBjYXNlICJCRyI6CiAgICAgICAgICAgICAgY2FzZSAiQkcyIjoKICAgICAgICAgICAgICBjYXNlICJVQ1IiOgogICAgICAgICAgICAgIGNhc2UgIlVDUjIiOgogICAgICAgICAgICAgICAgZ1N0YXRlT2JqLnNwbGljZShqLCAxKTsKICAgICAgICAgICAgICAgIGpqLS07CiAgICAgICAgICAgICAgICBjb250aW51ZTsKICAgICAgICAgICAgfQogICAgICAgICAgICBqKys7CiAgICAgICAgICB9CiAgICAgICAgICBicmVhazsKICAgICAgfQogICAgICBpKys7CiAgICB9CiAgfQp9CmNsYXNzIFN0YXRlTWFuYWdlciB7CiAgY29uc3RydWN0b3IoaW5pdGlhbFN0YXRlID0gbmV3IEV2YWxTdGF0ZSgpKSB7CiAgICB0aGlzLnN0YXRlID0gaW5pdGlhbFN0YXRlOwogICAgdGhpcy5zdGF0ZVN0YWNrID0gW107CiAgfQogIHNhdmUoKSB7CiAgICBjb25zdCBvbGQgPSB0aGlzLnN0YXRlOwogICAgdGhpcy5zdGF0ZVN0YWNrLnB1c2godGhpcy5zdGF0ZSk7CiAgICB0aGlzLnN0YXRlID0gb2xkLmNsb25lKCk7CiAgfQogIHJlc3RvcmUoKSB7CiAgICBjb25zdCBwcmV2ID0gdGhpcy5zdGF0ZVN0YWNrLnBvcCgpOwogICAgaWYgKHByZXYpIHsKICAgICAgdGhpcy5zdGF0ZSA9IHByZXY7CiAgICB9CiAgfQogIHRyYW5zZm9ybShhcmdzKSB7CiAgICB0aGlzLnN0YXRlLmN0bSA9IF91dGlsLlV0aWwudHJhbnNmb3JtKHRoaXMuc3RhdGUuY3RtLCBhcmdzKTsKICB9Cn0KY2xhc3MgVGV4dFN0YXRlIHsKICBjb25zdHJ1Y3RvcigpIHsKICAgIHRoaXMuY3RtID0gbmV3IEZsb2F0MzJBcnJheShfdXRpbC5JREVOVElUWV9NQVRSSVgpOwogICAgdGhpcy5mb250TmFtZSA9IG51bGw7CiAgICB0aGlzLmZvbnRTaXplID0gMDsKICAgIHRoaXMubG9hZGVkTmFtZSA9IG51bGw7CiAgICB0aGlzLmZvbnQgPSBudWxsOwogICAgdGhpcy5mb250TWF0cml4ID0gX3V0aWwuRk9OVF9JREVOVElUWV9NQVRSSVg7CiAgICB0aGlzLnRleHRNYXRyaXggPSBfdXRpbC5JREVOVElUWV9NQVRSSVguc2xpY2UoKTsKICAgIHRoaXMudGV4dExpbmVNYXRyaXggPSBfdXRpbC5JREVOVElUWV9NQVRSSVguc2xpY2UoKTsKICAgIHRoaXMuY2hhclNwYWNpbmcgPSAwOwogICAgdGhpcy53b3JkU3BhY2luZyA9IDA7CiAgICB0aGlzLmxlYWRpbmcgPSAwOwogICAgdGhpcy50ZXh0SFNjYWxlID0gMTsKICAgIHRoaXMudGV4dFJpc2UgPSAwOwogIH0KICBzZXRUZXh0TWF0cml4KGEsIGIsIGMsIGQsIGUsIGYpIHsKICAgIGNvbnN0IG0gPSB0aGlzLnRleHRNYXRyaXg7CiAgICBtWzBdID0gYTsKICAgIG1bMV0gPSBiOwogICAgbVsyXSA9IGM7CiAgICBtWzNdID0gZDsKICAgIG1bNF0gPSBlOwogICAgbVs1XSA9IGY7CiAgfQogIHNldFRleHRMaW5lTWF0cml4KGEsIGIsIGMsIGQsIGUsIGYpIHsKICAgIGNvbnN0IG0gPSB0aGlzLnRleHRMaW5lTWF0cml4OwogICAgbVswXSA9IGE7CiAgICBtWzFdID0gYjsKICAgIG1bMl0gPSBjOwogICAgbVszXSA9IGQ7CiAgICBtWzRdID0gZTsKICAgIG1bNV0gPSBmOwogIH0KICB0cmFuc2xhdGVUZXh0TWF0cml4KHgsIHkpIHsKICAgIGNvbnN0IG0gPSB0aGlzLnRleHRNYXRyaXg7CiAgICBtWzRdID0gbVswXSAqIHggKyBtWzJdICogeSArIG1bNF07CiAgICBtWzVdID0gbVsxXSAqIHggKyBtWzNdICogeSArIG1bNV07CiAgfQogIHRyYW5zbGF0ZVRleHRMaW5lTWF0cml4KHgsIHkpIHsKICAgIGNvbnN0IG0gPSB0aGlzLnRleHRMaW5lTWF0cml4OwogICAgbVs0XSA9IG1bMF0gKiB4ICsgbVsyXSAqIHkgKyBtWzRdOwogICAgbVs1XSA9IG1bMV0gKiB4ICsgbVszXSAqIHkgKyBtWzVdOwogIH0KICBjYXJyaWFnZVJldHVybigpIHsKICAgIHRoaXMudHJhbnNsYXRlVGV4dExpbmVNYXRyaXgoMCwgLXRoaXMubGVhZGluZyk7CiAgICB0aGlzLnRleHRNYXRyaXggPSB0aGlzLnRleHRMaW5lTWF0cml4LnNsaWNlKCk7CiAgfQogIGNsb25lKCkgewogICAgY29uc3QgY2xvbmUgPSBPYmplY3QuY3JlYXRlKHRoaXMpOwogICAgY2xvbmUudGV4dE1hdHJpeCA9IHRoaXMudGV4dE1hdHJpeC5zbGljZSgpOwogICAgY2xvbmUudGV4dExpbmVNYXRyaXggPSB0aGlzLnRleHRMaW5lTWF0cml4LnNsaWNlKCk7CiAgICBjbG9uZS5mb250TWF0cml4ID0gdGhpcy5mb250TWF0cml4LnNsaWNlKCk7CiAgICByZXR1cm4gY2xvbmU7CiAgfQp9CmNsYXNzIEV2YWxTdGF0ZSB7CiAgY29uc3RydWN0b3IoKSB7CiAgICB0aGlzLmN0bSA9IG5ldyBGbG9hdDMyQXJyYXkoX3V0aWwuSURFTlRJVFlfTUFUUklYKTsKICAgIHRoaXMuZm9udCA9IG51bGw7CiAgICB0aGlzLnRleHRSZW5kZXJpbmdNb2RlID0gX3V0aWwuVGV4dFJlbmRlcmluZ01vZGUuRklMTDsKICAgIHRoaXMuZmlsbENvbG9yU3BhY2UgPSBfY29sb3JzcGFjZS5Db2xvclNwYWNlLnNpbmdsZXRvbnMuZ3JheTsKICAgIHRoaXMuc3Ryb2tlQ29sb3JTcGFjZSA9IF9jb2xvcnNwYWNlLkNvbG9yU3BhY2Uuc2luZ2xldG9ucy5ncmF5OwogIH0KICBjbG9uZSgpIHsKICAgIHJldHVybiBPYmplY3QuY3JlYXRlKHRoaXMpOwogIH0KfQpjbGFzcyBFdmFsdWF0b3JQcmVwcm9jZXNzb3IgewogIHN0YXRpYyBnZXQgb3BNYXAoKSB7CiAgICByZXR1cm4gKDAsIF91dGlsLnNoYWRvdykodGhpcywgIm9wTWFwIiwgewogICAgICB3OiB7CiAgICAgICAgaWQ6IF91dGlsLk9QUy5zZXRMaW5lV2lkdGgsCiAgICAgICAgbnVtQXJnczogMSwKICAgICAgICB2YXJpYWJsZUFyZ3M6IGZhbHNlCiAgICAgIH0sCiAgICAgIEo6IHsKICAgICAgICBpZDogX3V0aWwuT1BTLnNldExpbmVDYXAsCiAgICAgICAgbnVtQXJnczogMSwKICAgICAgICB2YXJpYWJsZUFyZ3M6IGZhbHNlCiAgICAgIH0sCiAgICAgIGo6IHsKICAgICAgICBpZDogX3V0aWwuT1BTLnNldExpbmVKb2luLAogICAgICAgIG51bUFyZ3M6IDEsCiAgICAgICAgdmFyaWFibGVBcmdzOiBmYWxzZQogICAgICB9LAogICAgICBNOiB7CiAgICAgICAgaWQ6IF91dGlsLk9QUy5zZXRNaXRlckxpbWl0LAogICAgICAgIG51bUFyZ3M6IDEsCiAgICAgICAgdmFyaWFibGVBcmdzOiBmYWxzZQogICAgICB9LAogICAgICBkOiB7CiAgICAgICAgaWQ6IF91dGlsLk9QUy5zZXREYXNoLAogICAgICAgIG51bUFyZ3M6IDIsCiAgICAgICAgdmFyaWFibGVBcmdzOiBmYWxzZQogICAgICB9LAogICAgICByaTogewogICAgICAgIGlkOiBfdXRpbC5PUFMuc2V0UmVuZGVyaW5nSW50ZW50LAogICAgICAgIG51bUFyZ3M6IDEsCiAgICAgICAgdmFyaWFibGVBcmdzOiBmYWxzZQogICAgICB9LAogICAgICBpOiB7CiAgICAgICAgaWQ6IF91dGlsLk9QUy5zZXRGbGF0bmVzcywKICAgICAgICBudW1BcmdzOiAxLAogICAgICAgIHZhcmlhYmxlQXJnczogZmFsc2UKICAgICAgfSwKICAgICAgZ3M6IHsKICAgICAgICBpZDogX3V0aWwuT1BTLnNldEdTdGF0ZSwKICAgICAgICBudW1BcmdzOiAxLAogICAgICAgIHZhcmlhYmxlQXJnczogZmFsc2UKICAgICAgfSwKICAgICAgcTogewogICAgICAgIGlkOiBfdXRpbC5PUFMuc2F2ZSwKICAgICAgICBudW1BcmdzOiAwLAogICAgICAgIHZhcmlhYmxlQXJnczogZmFsc2UKICAgICAgfSwKICAgICAgUTogewogICAgICAgIGlkOiBfdXRpbC5PUFMucmVzdG9yZSwKICAgICAgICBudW1BcmdzOiAwLAogICAgICAgIHZhcmlhYmxlQXJnczogZmFsc2UKICAgICAgfSwKICAgICAgY206IHsKICAgICAgICBpZDogX3V0aWwuT1BTLnRyYW5zZm9ybSwKICAgICAgICBudW1BcmdzOiA2LAogICAgICAgIHZhcmlhYmxlQXJnczogZmFsc2UKICAgICAgfSwKICAgICAgbTogewogICAgICAgIGlkOiBfdXRpbC5PUFMubW92ZVRvLAogICAgICAgIG51bUFyZ3M6IDIsCiAgICAgICAgdmFyaWFibGVBcmdzOiBmYWxzZQogICAgICB9LAogICAgICBsOiB7CiAgICAgICAgaWQ6IF91dGlsLk9QUy5saW5lVG8sCiAgICAgICAgbnVtQXJnczogMiwKICAgICAgICB2YXJpYWJsZUFyZ3M6IGZhbHNlCiAgICAgIH0sCiAgICAgIGM6IHsKICAgICAgICBpZDogX3V0aWwuT1BTLmN1cnZlVG8sCiAgICAgICAgbnVtQXJnczogNiwKICAgICAgICB2YXJpYWJsZUFyZ3M6IGZhbHNlCiAgICAgIH0sCiAgICAgIHY6IHsKICAgICAgICBpZDogX3V0aWwuT1BTLmN1cnZlVG8yLAogICAgICAgIG51bUFyZ3M6IDQsCiAgICAgICAgdmFyaWFibGVBcmdzOiBmYWxzZQogICAgICB9LAogICAgICB5OiB7CiAgICAgICAgaWQ6IF91dGlsLk9QUy5jdXJ2ZVRvMywKICAgICAgICBudW1BcmdzOiA0LAogICAgICAgIHZhcmlhYmxlQXJnczogZmFsc2UKICAgICAgfSwKICAgICAgaDogewogICAgICAgIGlkOiBfdXRpbC5PUFMuY2xvc2VQYXRoLAogICAgICAgIG51bUFyZ3M6IDAsCiAgICAgICAgdmFyaWFibGVBcmdzOiBmYWxzZQogICAgICB9LAogICAgICByZTogewogICAgICAgIGlkOiBfdXRpbC5PUFMucmVjdGFuZ2xlLAogICAgICAgIG51bUFyZ3M6IDQsCiAgICAgICAgdmFyaWFibGVBcmdzOiBmYWxzZQogICAgICB9LAogICAgICBTOiB7CiAgICAgICAgaWQ6IF91dGlsLk9QUy5zdHJva2UsCiAgICAgICAgbnVtQXJnczogMCwKICAgICAgICB2YXJpYWJsZUFyZ3M6IGZhbHNlCiAgICAgIH0sCiAgICAgIHM6IHsKICAgICAgICBpZDogX3V0aWwuT1BTLmNsb3NlU3Ryb2tlLAogICAgICAgIG51bUFyZ3M6IDAsCiAgICAgICAgdmFyaWFibGVBcmdzOiBmYWxzZQogICAgICB9LAogICAgICBmOiB7CiAgICAgICAgaWQ6IF91dGlsLk9QUy5maWxsLAogICAgICAgIG51bUFyZ3M6IDAsCiAgICAgICAgdmFyaWFibGVBcmdzOiBmYWxzZQogICAgICB9LAogICAgICBGOiB7CiAgICAgICAgaWQ6IF91dGlsLk9QUy5maWxsLAogICAgICAgIG51bUFyZ3M6IDAsCiAgICAgICAgdmFyaWFibGVBcmdzOiBmYWxzZQogICAgICB9LAogICAgICAiZioiOiB7CiAgICAgICAgaWQ6IF91dGlsLk9QUy5lb0ZpbGwsCiAgICAgICAgbnVtQXJnczogMCwKICAgICAgICB2YXJpYWJsZUFyZ3M6IGZhbHNlCiAgICAgIH0sCiAgICAgIEI6IHsKICAgICAgICBpZDogX3V0aWwuT1BTLmZpbGxTdHJva2UsCiAgICAgICAgbnVtQXJnczogMCwKICAgICAgICB2YXJpYWJsZUFyZ3M6IGZhbHNlCiAgICAgIH0sCiAgICAgICJCKiI6IHsKICAgICAgICBpZDogX3V0aWwuT1BTLmVvRmlsbFN0cm9rZSwKICAgICAgICBudW1BcmdzOiAwLAogICAgICAgIHZhcmlhYmxlQXJnczogZmFsc2UKICAgICAgfSwKICAgICAgYjogewogICAgICAgIGlkOiBfdXRpbC5PUFMuY2xvc2VGaWxsU3Ryb2tlLAogICAgICAgIG51bUFyZ3M6IDAsCiAgICAgICAgdmFyaWFibGVBcmdzOiBmYWxzZQogICAgICB9LAogICAgICAiYioiOiB7CiAgICAgICAgaWQ6IF91dGlsLk9QUy5jbG9zZUVPRmlsbFN0cm9rZSwKICAgICAgICBudW1BcmdzOiAwLAogICAgICAgIHZhcmlhYmxlQXJnczogZmFsc2UKICAgICAgfSwKICAgICAgbjogewogICAgICAgIGlkOiBfdXRpbC5PUFMuZW5kUGF0aCwKICAgICAgICBudW1BcmdzOiAwLAogICAgICAgIHZhcmlhYmxlQXJnczogZmFsc2UKICAgICAgfSwKICAgICAgVzogewogICAgICAgIGlkOiBfdXRpbC5PUFMuY2xpcCwKICAgICAgICBudW1BcmdzOiAwLAogICAgICAgIHZhcmlhYmxlQXJnczogZmFsc2UKICAgICAgfSwKICAgICAgIlcqIjogewogICAgICAgIGlkOiBfdXRpbC5PUFMuZW9DbGlwLAogICAgICAgIG51bUFyZ3M6IDAsCiAgICAgICAgdmFyaWFibGVBcmdzOiBmYWxzZQogICAgICB9LAogICAgICBCVDogewogICAgICAgIGlkOiBfdXRpbC5PUFMuYmVnaW5UZXh0LAogICAgICAgIG51bUFyZ3M6IDAsCiAgICAgICAgdmFyaWFibGVBcmdzOiBmYWxzZQogICAgICB9LAogICAgICBFVDogewogICAgICAgIGlkOiBfdXRpbC5PUFMuZW5kVGV4dCwKICAgICAgICBudW1BcmdzOiAwLAogICAgICAgIHZhcmlhYmxlQXJnczogZmFsc2UKICAgICAgfSwKICAgICAgVGM6IHsKICAgICAgICBpZDogX3V0aWwuT1BTLnNldENoYXJTcGFjaW5nLAogICAgICAgIG51bUFyZ3M6IDEsCiAgICAgICAgdmFyaWFibGVBcmdzOiBmYWxzZQogICAgICB9LAogICAgICBUdzogewogICAgICAgIGlkOiBfdXRpbC5PUFMuc2V0V29yZFNwYWNpbmcsCiAgICAgICAgbnVtQXJnczogMSwKICAgICAgICB2YXJpYWJsZUFyZ3M6IGZhbHNlCiAgICAgIH0sCiAgICAgIFR6OiB7CiAgICAgICAgaWQ6IF91dGlsLk9QUy5zZXRIU2NhbGUsCiAgICAgICAgbnVtQXJnczogMSwKICAgICAgICB2YXJpYWJsZUFyZ3M6IGZhbHNlCiAgICAgIH0sCiAgICAgIFRMOiB7CiAgICAgICAgaWQ6IF91dGlsLk9QUy5zZXRMZWFkaW5nLAogICAgICAgIG51bUFyZ3M6IDEsCiAgICAgICAgdmFyaWFibGVBcmdzOiBmYWxzZQogICAgICB9LAogICAgICBUZjogewogICAgICAgIGlkOiBfdXRpbC5PUFMuc2V0Rm9udCwKICAgICAgICBudW1BcmdzOiAyLAogICAgICAgIHZhcmlhYmxlQXJnczogZmFsc2UKICAgICAgfSwKICAgICAgVHI6IHsKICAgICAgICBpZDogX3V0aWwuT1BTLnNldFRleHRSZW5kZXJpbmdNb2RlLAogICAgICAgIG51bUFyZ3M6IDEsCiAgICAgICAgdmFyaWFibGVBcmdzOiBmYWxzZQogICAgICB9LAogICAgICBUczogewogICAgICAgIGlkOiBfdXRpbC5PUFMuc2V0VGV4dFJpc2UsCiAgICAgICAgbnVtQXJnczogMSwKICAgICAgICB2YXJpYWJsZUFyZ3M6IGZhbHNlCiAgICAgIH0sCiAgICAgIFRkOiB7CiAgICAgICAgaWQ6IF91dGlsLk9QUy5tb3ZlVGV4dCwKICAgICAgICBudW1BcmdzOiAyLAogICAgICAgIHZhcmlhYmxlQXJnczogZmFsc2UKICAgICAgfSwKICAgICAgVEQ6IHsKICAgICAgICBpZDogX3V0aWwuT1BTLnNldExlYWRpbmdNb3ZlVGV4dCwKICAgICAgICBudW1BcmdzOiAyLAogICAgICAgIHZhcmlhYmxlQXJnczogZmFsc2UKICAgICAgfSwKICAgICAgVG06IHsKICAgICAgICBpZDogX3V0aWwuT1BTLnNldFRleHRNYXRyaXgsCiAgICAgICAgbnVtQXJnczogNiwKICAgICAgICB2YXJpYWJsZUFyZ3M6IGZhbHNlCiAgICAgIH0sCiAgICAgICJUKiI6IHsKICAgICAgICBpZDogX3V0aWwuT1BTLm5leHRMaW5lLAogICAgICAgIG51bUFyZ3M6IDAsCiAgICAgICAgdmFyaWFibGVBcmdzOiBmYWxzZQogICAgICB9LAogICAgICBUajogewogICAgICAgIGlkOiBfdXRpbC5PUFMuc2hvd1RleHQsCiAgICAgICAgbnVtQXJnczogMSwKICAgICAgICB2YXJpYWJsZUFyZ3M6IGZhbHNlCiAgICAgIH0sCiAgICAgIFRKOiB7CiAgICAgICAgaWQ6IF91dGlsLk9QUy5zaG93U3BhY2VkVGV4dCwKICAgICAgICBudW1BcmdzOiAxLAogICAgICAgIHZhcmlhYmxlQXJnczogZmFsc2UKICAgICAgfSwKICAgICAgIiciOiB7CiAgICAgICAgaWQ6IF91dGlsLk9QUy5uZXh0TGluZVNob3dUZXh0LAogICAgICAgIG51bUFyZ3M6IDEsCiAgICAgICAgdmFyaWFibGVBcmdzOiBmYWxzZQogICAgICB9LAogICAgICAnIic6IHsKICAgICAgICBpZDogX3V0aWwuT1BTLm5leHRMaW5lU2V0U3BhY2luZ1Nob3dUZXh0LAogICAgICAgIG51bUFyZ3M6IDMsCiAgICAgICAgdmFyaWFibGVBcmdzOiBmYWxzZQogICAgICB9LAogICAgICBkMDogewogICAgICAgIGlkOiBfdXRpbC5PUFMuc2V0Q2hhcldpZHRoLAogICAgICAgIG51bUFyZ3M6IDIsCiAgICAgICAgdmFyaWFibGVBcmdzOiBmYWxzZQogICAgICB9LAogICAgICBkMTogewogICAgICAgIGlkOiBfdXRpbC5PUFMuc2V0Q2hhcldpZHRoQW5kQm91bmRzLAogICAgICAgIG51bUFyZ3M6IDYsCiAgICAgICAgdmFyaWFibGVBcmdzOiBmYWxzZQogICAgICB9LAogICAgICBDUzogewogICAgICAgIGlkOiBfdXRpbC5PUFMuc2V0U3Ryb2tlQ29sb3JTcGFjZSwKICAgICAgICBudW1BcmdzOiAxLAogICAgICAgIHZhcmlhYmxlQXJnczogZmFsc2UKICAgICAgfSwKICAgICAgY3M6IHsKICAgICAgICBpZDogX3V0aWwuT1BTLnNldEZpbGxDb2xvclNwYWNlLAogICAgICAgIG51bUFyZ3M6IDEsCiAgICAgICAgdmFyaWFibGVBcmdzOiBmYWxzZQogICAgICB9LAogICAgICBTQzogewogICAgICAgIGlkOiBfdXRpbC5PUFMuc2V0U3Ryb2tlQ29sb3IsCiAgICAgICAgbnVtQXJnczogNCwKICAgICAgICB2YXJpYWJsZUFyZ3M6IHRydWUKICAgICAgfSwKICAgICAgU0NOOiB7CiAgICAgICAgaWQ6IF91dGlsLk9QUy5zZXRTdHJva2VDb2xvck4sCiAgICAgICAgbnVtQXJnczogMzMsCiAgICAgICAgdmFyaWFibGVBcmdzOiB0cnVlCiAgICAgIH0sCiAgICAgIHNjOiB7CiAgICAgICAgaWQ6IF91dGlsLk9QUy5zZXRGaWxsQ29sb3IsCiAgICAgICAgbnVtQXJnczogNCwKICAgICAgICB2YXJpYWJsZUFyZ3M6IHRydWUKICAgICAgfSwKICAgICAgc2NuOiB7CiAgICAgICAgaWQ6IF91dGlsLk9QUy5zZXRGaWxsQ29sb3JOLAogICAgICAgIG51bUFyZ3M6IDMzLAogICAgICAgIHZhcmlhYmxlQXJnczogdHJ1ZQogICAgICB9LAogICAgICBHOiB7CiAgICAgICAgaWQ6IF91dGlsLk9QUy5zZXRTdHJva2VHcmF5LAogICAgICAgIG51bUFyZ3M6IDEsCiAgICAgICAgdmFyaWFibGVBcmdzOiBmYWxzZQogICAgICB9LAogICAgICBnOiB7CiAgICAgICAgaWQ6IF91dGlsLk9QUy5zZXRGaWxsR3JheSwKICAgICAgICBudW1BcmdzOiAxLAogICAgICAgIHZhcmlhYmxlQXJnczogZmFsc2UKICAgICAgfSwKICAgICAgUkc6IHsKICAgICAgICBpZDogX3V0aWwuT1BTLnNldFN0cm9rZVJHQkNvbG9yLAogICAgICAgIG51bUFyZ3M6IDMsCiAgICAgICAgdmFyaWFibGVBcmdzOiBmYWxzZQogICAgICB9LAogICAgICByZzogewogICAgICAgIGlkOiBfdXRpbC5PUFMuc2V0RmlsbFJHQkNvbG9yLAogICAgICAgIG51bUFyZ3M6IDMsCiAgICAgICAgdmFyaWFibGVBcmdzOiBmYWxzZQogICAgICB9LAogICAgICBLOiB7CiAgICAgICAgaWQ6IF91dGlsLk9QUy5zZXRTdHJva2VDTVlLQ29sb3IsCiAgICAgICAgbnVtQXJnczogNCwKICAgICAgICB2YXJpYWJsZUFyZ3M6IGZhbHNlCiAgICAgIH0sCiAgICAgIGs6IHsKICAgICAgICBpZDogX3V0aWwuT1BTLnNldEZpbGxDTVlLQ29sb3IsCiAgICAgICAgbnVtQXJnczogNCwKICAgICAgICB2YXJpYWJsZUFyZ3M6IGZhbHNlCiAgICAgIH0sCiAgICAgIHNoOiB7CiAgICAgICAgaWQ6IF91dGlsLk9QUy5zaGFkaW5nRmlsbCwKICAgICAgICBudW1BcmdzOiAxLAogICAgICAgIHZhcmlhYmxlQXJnczogZmFsc2UKICAgICAgfSwKICAgICAgQkk6IHsKICAgICAgICBpZDogX3V0aWwuT1BTLmJlZ2luSW5saW5lSW1hZ2UsCiAgICAgICAgbnVtQXJnczogMCwKICAgICAgICB2YXJpYWJsZUFyZ3M6IGZhbHNlCiAgICAgIH0sCiAgICAgIElEOiB7CiAgICAgICAgaWQ6IF91dGlsLk9QUy5iZWdpbkltYWdlRGF0YSwKICAgICAgICBudW1BcmdzOiAwLAogICAgICAgIHZhcmlhYmxlQXJnczogZmFsc2UKICAgICAgfSwKICAgICAgRUk6IHsKICAgICAgICBpZDogX3V0aWwuT1BTLmVuZElubGluZUltYWdlLAogICAgICAgIG51bUFyZ3M6IDEsCiAgICAgICAgdmFyaWFibGVBcmdzOiBmYWxzZQogICAgICB9LAogICAgICBEbzogewogICAgICAgIGlkOiBfdXRpbC5PUFMucGFpbnRYT2JqZWN0LAogICAgICAgIG51bUFyZ3M6IDEsCiAgICAgICAgdmFyaWFibGVBcmdzOiBmYWxzZQogICAgICB9LAogICAgICBNUDogewogICAgICAgIGlkOiBfdXRpbC5PUFMubWFya1BvaW50LAogICAgICAgIG51bUFyZ3M6IDEsCiAgICAgICAgdmFyaWFibGVBcmdzOiBmYWxzZQogICAgICB9LAogICAgICBEUDogewogICAgICAgIGlkOiBfdXRpbC5PUFMubWFya1BvaW50UHJvcHMsCiAgICAgICAgbnVtQXJnczogMiwKICAgICAgICB2YXJpYWJsZUFyZ3M6IGZhbHNlCiAgICAgIH0sCiAgICAgIEJNQzogewogICAgICAgIGlkOiBfdXRpbC5PUFMuYmVnaW5NYXJrZWRDb250ZW50LAogICAgICAgIG51bUFyZ3M6IDEsCiAgICAgICAgdmFyaWFibGVBcmdzOiBmYWxzZQogICAgICB9LAogICAgICBCREM6IHsKICAgICAgICBpZDogX3V0aWwuT1BTLmJlZ2luTWFya2VkQ29udGVudFByb3BzLAogICAgICAgIG51bUFyZ3M6IDIsCiAgICAgICAgdmFyaWFibGVBcmdzOiBmYWxzZQogICAgICB9LAogICAgICBFTUM6IHsKICAgICAgICBpZDogX3V0aWwuT1BTLmVuZE1hcmtlZENvbnRlbnQsCiAgICAgICAgbnVtQXJnczogMCwKICAgICAgICB2YXJpYWJsZUFyZ3M6IGZhbHNlCiAgICAgIH0sCiAgICAgIEJYOiB7CiAgICAgICAgaWQ6IF91dGlsLk9QUy5iZWdpbkNvbXBhdCwKICAgICAgICBudW1BcmdzOiAwLAogICAgICAgIHZhcmlhYmxlQXJnczogZmFsc2UKICAgICAgfSwKICAgICAgRVg6IHsKICAgICAgICBpZDogX3V0aWwuT1BTLmVuZENvbXBhdCwKICAgICAgICBudW1BcmdzOiAwLAogICAgICAgIHZhcmlhYmxlQXJnczogZmFsc2UKICAgICAgfSwKICAgICAgQk06IG51bGwsCiAgICAgIEJEOiBudWxsLAogICAgICB0cnVlOiBudWxsLAogICAgICBmYTogbnVsbCwKICAgICAgZmFsOiBudWxsLAogICAgICBmYWxzOiBudWxsLAogICAgICBmYWxzZTogbnVsbCwKICAgICAgbnU6IG51bGwsCiAgICAgIG51bDogbnVsbCwKICAgICAgbnVsbDogbnVsbAogICAgfSk7CiAgfQogIHN0YXRpYyBNQVhfSU5WQUxJRF9QQVRIX09QUyA9IDEwOwogIGNvbnN0cnVjdG9yKHN0cmVhbSwgeHJlZiwgc3RhdGVNYW5hZ2VyID0gbmV3IFN0YXRlTWFuYWdlcigpKSB7CiAgICB0aGlzLnBhcnNlciA9IG5ldyBfcGFyc2VyLlBhcnNlcih7CiAgICAgIGxleGVyOiBuZXcgX3BhcnNlci5MZXhlcihzdHJlYW0sIEV2YWx1YXRvclByZXByb2Nlc3Nvci5vcE1hcCksCiAgICAgIHhyZWYKICAgIH0pOwogICAgdGhpcy5zdGF0ZU1hbmFnZXIgPSBzdGF0ZU1hbmFnZXI7CiAgICB0aGlzLm5vblByb2Nlc3NlZEFyZ3MgPSBbXTsKICAgIHRoaXMuX2lzUGF0aE9wID0gZmFsc2U7CiAgICB0aGlzLl9udW1JbnZhbGlkUGF0aE9QUyA9IDA7CiAgfQogIGdldCBzYXZlZFN0YXRlc0RlcHRoKCkgewogICAgcmV0dXJuIHRoaXMuc3RhdGVNYW5hZ2VyLnN0YXRlU3RhY2subGVuZ3RoOwogIH0KICByZWFkKG9wZXJhdGlvbikgewogICAgbGV0IGFyZ3MgPSBvcGVyYXRpb24uYXJnczsKICAgIHdoaWxlICh0cnVlKSB7CiAgICAgIGNvbnN0IG9iaiA9IHRoaXMucGFyc2VyLmdldE9iaigpOwogICAgICBpZiAob2JqIGluc3RhbmNlb2YgX3ByaW1pdGl2ZXMuQ21kKSB7CiAgICAgICAgY29uc3QgY21kID0gb2JqLmNtZDsKICAgICAgICBjb25zdCBvcFNwZWMgPSBFdmFsdWF0b3JQcmVwcm9jZXNzb3Iub3BNYXBbY21kXTsKICAgICAgICBpZiAoIW9wU3BlYykgewogICAgICAgICAgKDAsIF91dGlsLndhcm4pKGBVbmtub3duIGNvbW1hbmQgIiR7Y21kfSIuYCk7CiAgICAgICAgICBjb250aW51ZTsKICAgICAgICB9CiAgICAgICAgY29uc3QgZm4gPSBvcFNwZWMuaWQ7CiAgICAgICAgY29uc3QgbnVtQXJncyA9IG9wU3BlYy5udW1BcmdzOwogICAgICAgIGxldCBhcmdzTGVuZ3RoID0gYXJncyAhPT0gbnVsbCA/IGFyZ3MubGVuZ3RoIDogMDsKICAgICAgICBpZiAoIXRoaXMuX2lzUGF0aE9wKSB7CiAgICAgICAgICB0aGlzLl9udW1JbnZhbGlkUGF0aE9QUyA9IDA7CiAgICAgICAgfQogICAgICAgIHRoaXMuX2lzUGF0aE9wID0gZm4gPj0gX3V0aWwuT1BTLm1vdmVUbyAmJiBmbiA8PSBfdXRpbC5PUFMuZW5kUGF0aDsKICAgICAgICBpZiAoIW9wU3BlYy52YXJpYWJsZUFyZ3MpIHsKICAgICAgICAgIGlmIChhcmdzTGVuZ3RoICE9PSBudW1BcmdzKSB7CiAgICAgICAgICAgIGNvbnN0IG5vblByb2Nlc3NlZEFyZ3MgPSB0aGlzLm5vblByb2Nlc3NlZEFyZ3M7CiAgICAgICAgICAgIHdoaWxlIChhcmdzTGVuZ3RoID4gbnVtQXJncykgewogICAgICAgICAgICAgIG5vblByb2Nlc3NlZEFyZ3MucHVzaChhcmdzLnNoaWZ0KCkpOwogICAgICAgICAgICAgIGFyZ3NMZW5ndGgtLTsKICAgICAgICAgICAgfQogICAgICAgICAgICB3aGlsZSAoYXJnc0xlbmd0aCA8IG51bUFyZ3MgJiYgbm9uUHJvY2Vzc2VkQXJncy5sZW5ndGggIT09IDApIHsKICAgICAgICAgICAgICBpZiAoYXJncyA9PT0gbnVsbCkgewogICAgICAgICAgICAgICAgYXJncyA9IFtdOwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgICBhcmdzLnVuc2hpZnQobm9uUHJvY2Vzc2VkQXJncy5wb3AoKSk7CiAgICAgICAgICAgICAgYXJnc0xlbmd0aCsrOwogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgICBpZiAoYXJnc0xlbmd0aCA8IG51bUFyZ3MpIHsKICAgICAgICAgICAgY29uc3QgcGFydGlhbE1zZyA9IGBjb21tYW5kICR7Y21kfTogZXhwZWN0ZWQgJHtudW1BcmdzfSBhcmdzLCBgICsgYGJ1dCByZWNlaXZlZCAke2FyZ3NMZW5ndGh9IGFyZ3MuYDsKICAgICAgICAgICAgaWYgKHRoaXMuX2lzUGF0aE9wICYmICsrdGhpcy5fbnVtSW52YWxpZFBhdGhPUFMgPiBFdmFsdWF0b3JQcmVwcm9jZXNzb3IuTUFYX0lOVkFMSURfUEFUSF9PUFMpIHsKICAgICAgICAgICAgICB0aHJvdyBuZXcgX3V0aWwuRm9ybWF0RXJyb3IoYEludmFsaWQgJHtwYXJ0aWFsTXNnfWApOwogICAgICAgICAgICB9CiAgICAgICAgICAgICgwLCBfdXRpbC53YXJuKShgU2tpcHBpbmcgJHtwYXJ0aWFsTXNnfWApOwogICAgICAgICAgICBpZiAoYXJncyAhPT0gbnVsbCkgewogICAgICAgICAgICAgIGFyZ3MubGVuZ3RoID0gMDsKICAgICAgICAgICAgfQogICAgICAgICAgICBjb250aW51ZTsKICAgICAgICAgIH0KICAgICAgICB9IGVsc2UgaWYgKGFyZ3NMZW5ndGggPiBudW1BcmdzKSB7CiAgICAgICAgICAoMCwgX3V0aWwuaW5mbykoYENvbW1hbmQgJHtjbWR9OiBleHBlY3RlZCBbMCwgJHtudW1BcmdzfV0gYXJncywgYCArIGBidXQgcmVjZWl2ZWQgJHthcmdzTGVuZ3RofSBhcmdzLmApOwogICAgICAgIH0KICAgICAgICB0aGlzLnByZXByb2Nlc3NDb21tYW5kKGZuLCBhcmdzKTsKICAgICAgICBvcGVyYXRpb24uZm4gPSBmbjsKICAgICAgICBvcGVyYXRpb24uYXJncyA9IGFyZ3M7CiAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgIH0KICAgICAgaWYgKG9iaiA9PT0gX3ByaW1pdGl2ZXMuRU9GKSB7CiAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICB9CiAgICAgIGlmIChvYmogIT09IG51bGwpIHsKICAgICAgICBpZiAoYXJncyA9PT0gbnVsbCkgewogICAgICAgICAgYXJncyA9IFtdOwogICAgICAgIH0KICAgICAgICBhcmdzLnB1c2gob2JqKTsKICAgICAgICBpZiAoYXJncy5sZW5ndGggPiAzMykgewogICAgICAgICAgdGhyb3cgbmV3IF91dGlsLkZvcm1hdEVycm9yKCJUb28gbWFueSBhcmd1bWVudHMiKTsKICAgICAgICB9CiAgICAgIH0KICAgIH0KICB9CiAgcHJlcHJvY2Vzc0NvbW1hbmQoZm4sIGFyZ3MpIHsKICAgIHN3aXRjaCAoZm4gfCAwKSB7CiAgICAgIGNhc2UgX3V0aWwuT1BTLnNhdmU6CiAgICAgICAgdGhpcy5zdGF0ZU1hbmFnZXIuc2F2ZSgpOwogICAgICAgIGJyZWFrOwogICAgICBjYXNlIF91dGlsLk9QUy5yZXN0b3JlOgogICAgICAgIHRoaXMuc3RhdGVNYW5hZ2VyLnJlc3RvcmUoKTsKICAgICAgICBicmVhazsKICAgICAgY2FzZSBfdXRpbC5PUFMudHJhbnNmb3JtOgogICAgICAgIHRoaXMuc3RhdGVNYW5hZ2VyLnRyYW5zZm9ybShhcmdzKTsKICAgICAgICBicmVhazsKICAgIH0KICB9Cn0KZXhwb3J0cy5FdmFsdWF0b3JQcmVwcm9jZXNzb3IgPSBFdmFsdWF0b3JQcmVwcm9jZXNzb3I7CgovKioqLyB9KSwKLyogMTQgKi8KLyoqKi8gKChfX3VudXNlZF93ZWJwYWNrX21vZHVsZSwgZXhwb3J0cywgX193X3BkZmpzX3JlcXVpcmVfXykgPT4gewoKCgpPYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgIl9fZXNNb2R1bGUiLCAoewogIHZhbHVlOiB0cnVlCn0pKTsKZXhwb3J0cy5JZGVudGl0eUNNYXAgPSBleHBvcnRzLkNNYXBGYWN0b3J5ID0gZXhwb3J0cy5DTWFwID0gdm9pZCAwOwp2YXIgX3V0aWwgPSBfX3dfcGRmanNfcmVxdWlyZV9fKDIpOwp2YXIgX3ByaW1pdGl2ZXMgPSBfX3dfcGRmanNfcmVxdWlyZV9fKDQpOwp2YXIgX2Jhc2Vfc3RyZWFtID0gX193X3BkZmpzX3JlcXVpcmVfXyg1KTsKdmFyIF9iaW5hcnlfY21hcCA9IF9fd19wZGZqc19yZXF1aXJlX18oMTUpOwp2YXIgX3BhcnNlciA9IF9fd19wZGZqc19yZXF1aXJlX18oMTYpOwp2YXIgX2NvcmVfdXRpbHMgPSBfX3dfcGRmanNfcmVxdWlyZV9fKDMpOwp2YXIgX3N0cmVhbSA9IF9fd19wZGZqc19yZXF1aXJlX18oOCk7CmNvbnN0IEJVSUxUX0lOX0NNQVBTID0gWyJBZG9iZS1HQjEtVUNTMiIsICJBZG9iZS1DTlMxLVVDUzIiLCAiQWRvYmUtSmFwYW4xLVVDUzIiLCAiQWRvYmUtS29yZWExLVVDUzIiLCAiNzgtRVVDLUgiLCAiNzgtRVVDLVYiLCAiNzgtSCIsICI3OC1SS1NKLUgiLCAiNzgtUktTSi1WIiwgIjc4LVYiLCAiNzhtcy1SS1NKLUgiLCAiNzhtcy1SS1NKLVYiLCAiODNwdi1SS1NKLUgiLCAiOTBtcy1SS1NKLUgiLCAiOTBtcy1SS1NKLVYiLCAiOTBtc3AtUktTSi1IIiwgIjkwbXNwLVJLU0otViIsICI5MHB2LVJLU0otSCIsICI5MHB2LVJLU0otViIsICJBZGQtSCIsICJBZGQtUktTSi1IIiwgIkFkZC1SS1NKLVYiLCAiQWRkLVYiLCAiQWRvYmUtQ05TMS0wIiwgIkFkb2JlLUNOUzEtMSIsICJBZG9iZS1DTlMxLTIiLCAiQWRvYmUtQ05TMS0zIiwgIkFkb2JlLUNOUzEtNCIsICJBZG9iZS1DTlMxLTUiLCAiQWRvYmUtQ05TMS02IiwgIkFkb2JlLUdCMS0wIiwgIkFkb2JlLUdCMS0xIiwgIkFkb2JlLUdCMS0yIiwgIkFkb2JlLUdCMS0zIiwgIkFkb2JlLUdCMS00IiwgIkFkb2JlLUdCMS01IiwgIkFkb2JlLUphcGFuMS0wIiwgIkFkb2JlLUphcGFuMS0xIiwgIkFkb2JlLUphcGFuMS0yIiwgIkFkb2JlLUphcGFuMS0zIiwgIkFkb2JlLUphcGFuMS00IiwgIkFkb2JlLUphcGFuMS01IiwgIkFkb2JlLUphcGFuMS02IiwgIkFkb2JlLUtvcmVhMS0wIiwgIkFkb2JlLUtvcmVhMS0xIiwgIkFkb2JlLUtvcmVhMS0yIiwgIkI1LUgiLCAiQjUtViIsICJCNXBjLUgiLCAiQjVwYy1WIiwgIkNOUy1FVUMtSCIsICJDTlMtRVVDLVYiLCAiQ05TMS1IIiwgIkNOUzEtViIsICJDTlMyLUgiLCAiQ05TMi1WIiwgIkVUSEstQjUtSCIsICJFVEhLLUI1LVYiLCAiRVRlbi1CNS1IIiwgIkVUZW4tQjUtViIsICJFVGVubXMtQjUtSCIsICJFVGVubXMtQjUtViIsICJFVUMtSCIsICJFVUMtViIsICJFeHQtSCIsICJFeHQtUktTSi1IIiwgIkV4dC1SS1NKLVYiLCAiRXh0LVYiLCAiR0ItRVVDLUgiLCAiR0ItRVVDLVYiLCAiR0ItSCIsICJHQi1WIiwgIkdCSy1FVUMtSCIsICJHQkstRVVDLVYiLCAiR0JLMkstSCIsICJHQksySy1WIiwgIkdCS3AtRVVDLUgiLCAiR0JLcC1FVUMtViIsICJHQlQtRVVDLUgiLCAiR0JULUVVQy1WIiwgIkdCVC1IIiwgIkdCVC1WIiwgIkdCVHBjLUVVQy1IIiwgIkdCVHBjLUVVQy1WIiwgIkdCcGMtRVVDLUgiLCAiR0JwYy1FVUMtViIsICJIIiwgIkhLZGxhLUI1LUgiLCAiSEtkbGEtQjUtViIsICJIS2RsYi1CNS1IIiwgIkhLZGxiLUI1LVYiLCAiSEtnY2NzLUI1LUgiLCAiSEtnY2NzLUI1LVYiLCAiSEttMzE0LUI1LUgiLCAiSEttMzE0LUI1LVYiLCAiSEttNDcxLUI1LUgiLCAiSEttNDcxLUI1LVYiLCAiSEtzY3MtQjUtSCIsICJIS3Njcy1CNS1WIiwgIkhhbmtha3UiLCAiSGlyYWdhbmEiLCAiS1NDLUVVQy1IIiwgIktTQy1FVUMtViIsICJLU0MtSCIsICJLU0MtSm9oYWItSCIsICJLU0MtSm9oYWItViIsICJLU0MtViIsICJLU0Ntcy1VSEMtSCIsICJLU0Ntcy1VSEMtSFctSCIsICJLU0Ntcy1VSEMtSFctViIsICJLU0Ntcy1VSEMtViIsICJLU0NwYy1FVUMtSCIsICJLU0NwYy1FVUMtViIsICJLYXRha2FuYSIsICJOV1AtSCIsICJOV1AtViIsICJSS1NKLUgiLCAiUktTSi1WIiwgIlJvbWFuIiwgIlVuaUNOUy1VQ1MyLUgiLCAiVW5pQ05TLVVDUzItViIsICJVbmlDTlMtVVRGMTYtSCIsICJVbmlDTlMtVVRGMTYtViIsICJVbmlDTlMtVVRGMzItSCIsICJVbmlDTlMtVVRGMzItViIsICJVbmlDTlMtVVRGOC1IIiwgIlVuaUNOUy1VVEY4LVYiLCAiVW5pR0ItVUNTMi1IIiwgIlVuaUdCLVVDUzItViIsICJVbmlHQi1VVEYxNi1IIiwgIlVuaUdCLVVURjE2LVYiLCAiVW5pR0ItVVRGMzItSCIsICJVbmlHQi1VVEYzMi1WIiwgIlVuaUdCLVVURjgtSCIsICJVbmlHQi1VVEY4LVYiLCAiVW5pSklTLVVDUzItSCIsICJVbmlKSVMtVUNTMi1IVy1IIiwgIlVuaUpJUy1VQ1MyLUhXLVYiLCAiVW5pSklTLVVDUzItViIsICJVbmlKSVMtVVRGMTYtSCIsICJVbmlKSVMtVVRGMTYtViIsICJVbmlKSVMtVVRGMzItSCIsICJVbmlKSVMtVVRGMzItViIsICJVbmlKSVMtVVRGOC1IIiwgIlVuaUpJUy1VVEY4LVYiLCAiVW5pSklTMjAwNC1VVEYxNi1IIiwgIlVuaUpJUzIwMDQtVVRGMTYtViIsICJVbmlKSVMyMDA0LVVURjMyLUgiLCAiVW5pSklTMjAwNC1VVEYzMi1WIiwgIlVuaUpJUzIwMDQtVVRGOC1IIiwgIlVuaUpJUzIwMDQtVVRGOC1WIiwgIlVuaUpJU1Byby1VQ1MyLUhXLVYiLCAiVW5pSklTUHJvLVVDUzItViIsICJVbmlKSVNQcm8tVVRGOC1WIiwgIlVuaUpJU1gwMjEzLVVURjMyLUgiLCAiVW5pSklTWDAyMTMtVVRGMzItViIsICJVbmlKSVNYMDIxMzIwMDQtVVRGMzItSCIsICJVbmlKSVNYMDIxMzIwMDQtVVRGMzItViIsICJVbmlLUy1VQ1MyLUgiLCAiVW5pS1MtVUNTMi1WIiwgIlVuaUtTLVVURjE2LUgiLCAiVW5pS1MtVVRGMTYtViIsICJVbmlLUy1VVEYzMi1IIiwgIlVuaUtTLVVURjMyLVYiLCAiVW5pS1MtVVRGOC1IIiwgIlVuaUtTLVVURjgtViIsICJWIiwgIldQLVN5bWJvbCJdOwpjb25zdCBNQVhfTUFQX1JBTkdFID0gMiAqKiAyNCAtIDE7CmNsYXNzIENNYXAgewogIGNvbnN0cnVjdG9yKGJ1aWx0SW5DTWFwID0gZmFsc2UpIHsKICAgIHRoaXMuY29kZXNwYWNlUmFuZ2VzID0gW1tdLCBbXSwgW10sIFtdXTsKICAgIHRoaXMubnVtQ29kZXNwYWNlUmFuZ2VzID0gMDsKICAgIHRoaXMuX21hcCA9IFtdOwogICAgdGhpcy5uYW1lID0gIiI7CiAgICB0aGlzLnZlcnRpY2FsID0gZmFsc2U7CiAgICB0aGlzLnVzZUNNYXAgPSBudWxsOwogICAgdGhpcy5idWlsdEluQ01hcCA9IGJ1aWx0SW5DTWFwOwogIH0KICBhZGRDb2Rlc3BhY2VSYW5nZShuLCBsb3csIGhpZ2gpIHsKICAgIHRoaXMuY29kZXNwYWNlUmFuZ2VzW24gLSAxXS5wdXNoKGxvdywgaGlnaCk7CiAgICB0aGlzLm51bUNvZGVzcGFjZVJhbmdlcysrOwogIH0KICBtYXBDaWRSYW5nZShsb3csIGhpZ2gsIGRzdExvdykgewogICAgaWYgKGhpZ2ggLSBsb3cgPiBNQVhfTUFQX1JBTkdFKSB7CiAgICAgIHRocm93IG5ldyBFcnJvcigibWFwQ2lkUmFuZ2UgLSBpZ25vcmluZyBkYXRhIGFib3ZlIE1BWF9NQVBfUkFOR0UuIik7CiAgICB9CiAgICB3aGlsZSAobG93IDw9IGhpZ2gpIHsKICAgICAgdGhpcy5fbWFwW2xvdysrXSA9IGRzdExvdysrOwogICAgfQogIH0KICBtYXBCZlJhbmdlKGxvdywgaGlnaCwgZHN0TG93KSB7CiAgICBpZiAoaGlnaCAtIGxvdyA+IE1BWF9NQVBfUkFOR0UpIHsKICAgICAgdGhyb3cgbmV3IEVycm9yKCJtYXBCZlJhbmdlIC0gaWdub3JpbmcgZGF0YSBhYm92ZSBNQVhfTUFQX1JBTkdFLiIpOwogICAgfQogICAgY29uc3QgbGFzdEJ5dGUgPSBkc3RMb3cubGVuZ3RoIC0gMTsKICAgIHdoaWxlIChsb3cgPD0gaGlnaCkgewogICAgICB0aGlzLl9tYXBbbG93KytdID0gZHN0TG93OwogICAgICBjb25zdCBuZXh0Q2hhckNvZGUgPSBkc3RMb3cuY2hhckNvZGVBdChsYXN0Qnl0ZSkgKyAxOwogICAgICBpZiAobmV4dENoYXJDb2RlID4gMHhmZikgewogICAgICAgIGRzdExvdyA9IGRzdExvdy5zdWJzdHJpbmcoMCwgbGFzdEJ5dGUgLSAxKSArIFN0cmluZy5mcm9tQ2hhckNvZGUoZHN0TG93LmNoYXJDb2RlQXQobGFzdEJ5dGUgLSAxKSArIDEpICsgIlx4MDAiOwogICAgICAgIGNvbnRpbnVlOwogICAgICB9CiAgICAgIGRzdExvdyA9IGRzdExvdy5zdWJzdHJpbmcoMCwgbGFzdEJ5dGUpICsgU3RyaW5nLmZyb21DaGFyQ29kZShuZXh0Q2hhckNvZGUpOwogICAgfQogIH0KICBtYXBCZlJhbmdlVG9BcnJheShsb3csIGhpZ2gsIGFycmF5KSB7CiAgICBpZiAoaGlnaCAtIGxvdyA+IE1BWF9NQVBfUkFOR0UpIHsKICAgICAgdGhyb3cgbmV3IEVycm9yKCJtYXBCZlJhbmdlVG9BcnJheSAtIGlnbm9yaW5nIGRhdGEgYWJvdmUgTUFYX01BUF9SQU5HRS4iKTsKICAgIH0KICAgIGNvbnN0IGlpID0gYXJyYXkubGVuZ3RoOwogICAgbGV0IGkgPSAwOwogICAgd2hpbGUgKGxvdyA8PSBoaWdoICYmIGkgPCBpaSkgewogICAgICB0aGlzLl9tYXBbbG93XSA9IGFycmF5W2krK107CiAgICAgICsrbG93OwogICAgfQogIH0KICBtYXBPbmUoc3JjLCBkc3QpIHsKICAgIHRoaXMuX21hcFtzcmNdID0gZHN0OwogIH0KICBsb29rdXAoY29kZSkgewogICAgcmV0dXJuIHRoaXMuX21hcFtjb2RlXTsKICB9CiAgY29udGFpbnMoY29kZSkgewogICAgcmV0dXJuIHRoaXMuX21hcFtjb2RlXSAhPT0gdW5kZWZpbmVkOwogIH0KICBmb3JFYWNoKGNhbGxiYWNrKSB7CiAgICBjb25zdCBtYXAgPSB0aGlzLl9tYXA7CiAgICBjb25zdCBsZW5ndGggPSBtYXAubGVuZ3RoOwogICAgaWYgKGxlbmd0aCA8PSAweDEwMDAwKSB7CiAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgbGVuZ3RoOyBpKyspIHsKICAgICAgICBpZiAobWFwW2ldICE9PSB1bmRlZmluZWQpIHsKICAgICAgICAgIGNhbGxiYWNrKGksIG1hcFtpXSk7CiAgICAgICAgfQogICAgICB9CiAgICB9IGVsc2UgewogICAgICBmb3IgKGNvbnN0IGkgaW4gbWFwKSB7CiAgICAgICAgY2FsbGJhY2soaSwgbWFwW2ldKTsKICAgICAgfQogICAgfQogIH0KICBjaGFyQ29kZU9mKHZhbHVlKSB7CiAgICBjb25zdCBtYXAgPSB0aGlzLl9tYXA7CiAgICBpZiAobWFwLmxlbmd0aCA8PSAweDEwMDAwKSB7CiAgICAgIHJldHVybiBtYXAuaW5kZXhPZih2YWx1ZSk7CiAgICB9CiAgICBmb3IgKGNvbnN0IGNoYXJDb2RlIGluIG1hcCkgewogICAgICBpZiAobWFwW2NoYXJDb2RlXSA9PT0gdmFsdWUpIHsKICAgICAgICByZXR1cm4gY2hhckNvZGUgfCAwOwogICAgICB9CiAgICB9CiAgICByZXR1cm4gLTE7CiAgfQogIGdldE1hcCgpIHsKICAgIHJldHVybiB0aGlzLl9tYXA7CiAgfQogIHJlYWRDaGFyQ29kZShzdHIsIG9mZnNldCwgb3V0KSB7CiAgICBsZXQgYyA9IDA7CiAgICBjb25zdCBjb2Rlc3BhY2VSYW5nZXMgPSB0aGlzLmNvZGVzcGFjZVJhbmdlczsKICAgIGZvciAobGV0IG4gPSAwLCBubiA9IGNvZGVzcGFjZVJhbmdlcy5sZW5ndGg7IG4gPCBubjsgbisrKSB7CiAgICAgIGMgPSAoYyA8PCA4IHwgc3RyLmNoYXJDb2RlQXQob2Zmc2V0ICsgbikpID4+PiAwOwogICAgICBjb25zdCBjb2Rlc3BhY2VSYW5nZSA9IGNvZGVzcGFjZVJhbmdlc1tuXTsKICAgICAgZm9yIChsZXQgayA9IDAsIGtrID0gY29kZXNwYWNlUmFuZ2UubGVuZ3RoOyBrIDwga2s7KSB7CiAgICAgICAgY29uc3QgbG93ID0gY29kZXNwYWNlUmFuZ2VbaysrXTsKICAgICAgICBjb25zdCBoaWdoID0gY29kZXNwYWNlUmFuZ2VbaysrXTsKICAgICAgICBpZiAoYyA+PSBsb3cgJiYgYyA8PSBoaWdoKSB7CiAgICAgICAgICBvdXQuY2hhcmNvZGUgPSBjOwogICAgICAgICAgb3V0Lmxlbmd0aCA9IG4gKyAxOwogICAgICAgICAgcmV0dXJuOwogICAgICAgIH0KICAgICAgfQogICAgfQogICAgb3V0LmNoYXJjb2RlID0gMDsKICAgIG91dC5sZW5ndGggPSAxOwogIH0KICBnZXRDaGFyQ29kZUxlbmd0aChjaGFyQ29kZSkgewogICAgY29uc3QgY29kZXNwYWNlUmFuZ2VzID0gdGhpcy5jb2Rlc3BhY2VSYW5nZXM7CiAgICBmb3IgKGxldCBuID0gMCwgbm4gPSBjb2Rlc3BhY2VSYW5nZXMubGVuZ3RoOyBuIDwgbm47IG4rKykgewogICAgICBjb25zdCBjb2Rlc3BhY2VSYW5nZSA9IGNvZGVzcGFjZVJhbmdlc1tuXTsKICAgICAgZm9yIChsZXQgayA9IDAsIGtrID0gY29kZXNwYWNlUmFuZ2UubGVuZ3RoOyBrIDwga2s7KSB7CiAgICAgICAgY29uc3QgbG93ID0gY29kZXNwYWNlUmFuZ2VbaysrXTsKICAgICAgICBjb25zdCBoaWdoID0gY29kZXNwYWNlUmFuZ2VbaysrXTsKICAgICAgICBpZiAoY2hhckNvZGUgPj0gbG93ICYmIGNoYXJDb2RlIDw9IGhpZ2gpIHsKICAgICAgICAgIHJldHVybiBuICsgMTsKICAgICAgICB9CiAgICAgIH0KICAgIH0KICAgIHJldHVybiAxOwogIH0KICBnZXQgbGVuZ3RoKCkgewogICAgcmV0dXJuIHRoaXMuX21hcC5sZW5ndGg7CiAgfQogIGdldCBpc0lkZW50aXR5Q01hcCgpIHsKICAgIGlmICghKHRoaXMubmFtZSA9PT0gIklkZW50aXR5LUgiIHx8IHRoaXMubmFtZSA9PT0gIklkZW50aXR5LVYiKSkgewogICAgICByZXR1cm4gZmFsc2U7CiAgICB9CiAgICBpZiAodGhpcy5fbWFwLmxlbmd0aCAhPT0gMHgxMDAwMCkgewogICAgICByZXR1cm4gZmFsc2U7CiAgICB9CiAgICBmb3IgKGxldCBpID0gMDsgaSA8IDB4MTAwMDA7IGkrKykgewogICAgICBpZiAodGhpcy5fbWFwW2ldICE9PSBpKSB7CiAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICB9CiAgICB9CiAgICByZXR1cm4gdHJ1ZTsKICB9Cn0KZXhwb3J0cy5DTWFwID0gQ01hcDsKY2xhc3MgSWRlbnRpdHlDTWFwIGV4dGVuZHMgQ01hcCB7CiAgY29uc3RydWN0b3IodmVydGljYWwsIG4pIHsKICAgIHN1cGVyKCk7CiAgICB0aGlzLnZlcnRpY2FsID0gdmVydGljYWw7CiAgICB0aGlzLmFkZENvZGVzcGFjZVJhbmdlKG4sIDAsIDB4ZmZmZik7CiAgfQogIG1hcENpZFJhbmdlKGxvdywgaGlnaCwgZHN0TG93KSB7CiAgICAoMCwgX3V0aWwudW5yZWFjaGFibGUpKCJzaG91bGQgbm90IGNhbGwgbWFwQ2lkUmFuZ2UiKTsKICB9CiAgbWFwQmZSYW5nZShsb3csIGhpZ2gsIGRzdExvdykgewogICAgKDAsIF91dGlsLnVucmVhY2hhYmxlKSgic2hvdWxkIG5vdCBjYWxsIG1hcEJmUmFuZ2UiKTsKICB9CiAgbWFwQmZSYW5nZVRvQXJyYXkobG93LCBoaWdoLCBhcnJheSkgewogICAgKDAsIF91dGlsLnVucmVhY2hhYmxlKSgic2hvdWxkIG5vdCBjYWxsIG1hcEJmUmFuZ2VUb0FycmF5Iik7CiAgfQogIG1hcE9uZShzcmMsIGRzdCkgewogICAgKDAsIF91dGlsLnVucmVhY2hhYmxlKSgic2hvdWxkIG5vdCBjYWxsIG1hcENpZE9uZSIpOwogIH0KICBsb29rdXAoY29kZSkgewogICAgcmV0dXJuIE51bWJlci5pc0ludGVnZXIoY29kZSkgJiYgY29kZSA8PSAweGZmZmYgPyBjb2RlIDogdW5kZWZpbmVkOwogIH0KICBjb250YWlucyhjb2RlKSB7CiAgICByZXR1cm4gTnVtYmVyLmlzSW50ZWdlcihjb2RlKSAmJiBjb2RlIDw9IDB4ZmZmZjsKICB9CiAgZm9yRWFjaChjYWxsYmFjaykgewogICAgZm9yIChsZXQgaSA9IDA7IGkgPD0gMHhmZmZmOyBpKyspIHsKICAgICAgY2FsbGJhY2soaSwgaSk7CiAgICB9CiAgfQogIGNoYXJDb2RlT2YodmFsdWUpIHsKICAgIHJldHVybiBOdW1iZXIuaXNJbnRlZ2VyKHZhbHVlKSAmJiB2YWx1ZSA8PSAweGZmZmYgPyB2YWx1ZSA6IC0xOwogIH0KICBnZXRNYXAoKSB7CiAgICBjb25zdCBtYXAgPSBuZXcgQXJyYXkoMHgxMDAwMCk7CiAgICBmb3IgKGxldCBpID0gMDsgaSA8PSAweGZmZmY7IGkrKykgewogICAgICBtYXBbaV0gPSBpOwogICAgfQogICAgcmV0dXJuIG1hcDsKICB9CiAgZ2V0IGxlbmd0aCgpIHsKICAgIHJldHVybiAweDEwMDAwOwogIH0KICBnZXQgaXNJZGVudGl0eUNNYXAoKSB7CiAgICAoMCwgX3V0aWwudW5yZWFjaGFibGUpKCJzaG91bGQgbm90IGFjY2VzcyAuaXNJZGVudGl0eUNNYXAiKTsKICB9Cn0KZXhwb3J0cy5JZGVudGl0eUNNYXAgPSBJZGVudGl0eUNNYXA7CmZ1bmN0aW9uIHN0clRvSW50KHN0cikgewogIGxldCBhID0gMDsKICBmb3IgKGxldCBpID0gMDsgaSA8IHN0ci5sZW5ndGg7IGkrKykgewogICAgYSA9IGEgPDwgOCB8IHN0ci5jaGFyQ29kZUF0KGkpOwogIH0KICByZXR1cm4gYSA+Pj4gMDsKfQpmdW5jdGlvbiBleHBlY3RTdHJpbmcob2JqKSB7CiAgaWYgKHR5cGVvZiBvYmogIT09ICJzdHJpbmciKSB7CiAgICB0aHJvdyBuZXcgX3V0aWwuRm9ybWF0RXJyb3IoIk1hbGZvcm1lZCBDTWFwOiBleHBlY3RlZCBzdHJpbmcuIik7CiAgfQp9CmZ1bmN0aW9uIGV4cGVjdEludChvYmopIHsKICBpZiAoIU51bWJlci5pc0ludGVnZXIob2JqKSkgewogICAgdGhyb3cgbmV3IF91dGlsLkZvcm1hdEVycm9yKCJNYWxmb3JtZWQgQ01hcDogZXhwZWN0ZWQgaW50LiIpOwogIH0KfQpmdW5jdGlvbiBwYXJzZUJmQ2hhcihjTWFwLCBsZXhlcikgewogIHdoaWxlICh0cnVlKSB7CiAgICBsZXQgb2JqID0gbGV4ZXIuZ2V0T2JqKCk7CiAgICBpZiAob2JqID09PSBfcHJpbWl0aXZlcy5FT0YpIHsKICAgICAgYnJlYWs7CiAgICB9CiAgICBpZiAoKDAsIF9wcmltaXRpdmVzLmlzQ21kKShvYmosICJlbmRiZmNoYXIiKSkgewogICAgICByZXR1cm47CiAgICB9CiAgICBleHBlY3RTdHJpbmcob2JqKTsKICAgIGNvbnN0IHNyYyA9IHN0clRvSW50KG9iaik7CiAgICBvYmogPSBsZXhlci5nZXRPYmooKTsKICAgIGV4cGVjdFN0cmluZyhvYmopOwogICAgY29uc3QgZHN0ID0gb2JqOwogICAgY01hcC5tYXBPbmUoc3JjLCBkc3QpOwogIH0KfQpmdW5jdGlvbiBwYXJzZUJmUmFuZ2UoY01hcCwgbGV4ZXIpIHsKICB3aGlsZSAodHJ1ZSkgewogICAgbGV0IG9iaiA9IGxleGVyLmdldE9iaigpOwogICAgaWYgKG9iaiA9PT0gX3ByaW1pdGl2ZXMuRU9GKSB7CiAgICAgIGJyZWFrOwogICAgfQogICAgaWYgKCgwLCBfcHJpbWl0aXZlcy5pc0NtZCkob2JqLCAiZW5kYmZyYW5nZSIpKSB7CiAgICAgIHJldHVybjsKICAgIH0KICAgIGV4cGVjdFN0cmluZyhvYmopOwogICAgY29uc3QgbG93ID0gc3RyVG9JbnQob2JqKTsKICAgIG9iaiA9IGxleGVyLmdldE9iaigpOwogICAgZXhwZWN0U3RyaW5nKG9iaik7CiAgICBjb25zdCBoaWdoID0gc3RyVG9JbnQob2JqKTsKICAgIG9iaiA9IGxleGVyLmdldE9iaigpOwogICAgaWYgKE51bWJlci5pc0ludGVnZXIob2JqKSB8fCB0eXBlb2Ygb2JqID09PSAic3RyaW5nIikgewogICAgICBjb25zdCBkc3RMb3cgPSBOdW1iZXIuaXNJbnRlZ2VyKG9iaikgPyBTdHJpbmcuZnJvbUNoYXJDb2RlKG9iaikgOiBvYmo7CiAgICAgIGNNYXAubWFwQmZSYW5nZShsb3csIGhpZ2gsIGRzdExvdyk7CiAgICB9IGVsc2UgaWYgKCgwLCBfcHJpbWl0aXZlcy5pc0NtZCkob2JqLCAiWyIpKSB7CiAgICAgIG9iaiA9IGxleGVyLmdldE9iaigpOwogICAgICBjb25zdCBhcnJheSA9IFtdOwogICAgICB3aGlsZSAoISgwLCBfcHJpbWl0aXZlcy5pc0NtZCkob2JqLCAiXSIpICYmIG9iaiAhPT0gX3ByaW1pdGl2ZXMuRU9GKSB7CiAgICAgICAgYXJyYXkucHVzaChvYmopOwogICAgICAgIG9iaiA9IGxleGVyLmdldE9iaigpOwogICAgICB9CiAgICAgIGNNYXAubWFwQmZSYW5nZVRvQXJyYXkobG93LCBoaWdoLCBhcnJheSk7CiAgICB9IGVsc2UgewogICAgICBicmVhazsKICAgIH0KICB9CiAgdGhyb3cgbmV3IF91dGlsLkZvcm1hdEVycm9yKCJJbnZhbGlkIGJmIHJhbmdlLiIpOwp9CmZ1bmN0aW9uIHBhcnNlQ2lkQ2hhcihjTWFwLCBsZXhlcikgewogIHdoaWxlICh0cnVlKSB7CiAgICBsZXQgb2JqID0gbGV4ZXIuZ2V0T2JqKCk7CiAgICBpZiAob2JqID09PSBfcHJpbWl0aXZlcy5FT0YpIHsKICAgICAgYnJlYWs7CiAgICB9CiAgICBpZiAoKDAsIF9wcmltaXRpdmVzLmlzQ21kKShvYmosICJlbmRjaWRjaGFyIikpIHsKICAgICAgcmV0dXJuOwogICAgfQogICAgZXhwZWN0U3RyaW5nKG9iaik7CiAgICBjb25zdCBzcmMgPSBzdHJUb0ludChvYmopOwogICAgb2JqID0gbGV4ZXIuZ2V0T2JqKCk7CiAgICBleHBlY3RJbnQob2JqKTsKICAgIGNvbnN0IGRzdCA9IG9iajsKICAgIGNNYXAubWFwT25lKHNyYywgZHN0KTsKICB9Cn0KZnVuY3Rpb24gcGFyc2VDaWRSYW5nZShjTWFwLCBsZXhlcikgewogIHdoaWxlICh0cnVlKSB7CiAgICBsZXQgb2JqID0gbGV4ZXIuZ2V0T2JqKCk7CiAgICBpZiAob2JqID09PSBfcHJpbWl0aXZlcy5FT0YpIHsKICAgICAgYnJlYWs7CiAgICB9CiAgICBpZiAoKDAsIF9wcmltaXRpdmVzLmlzQ21kKShvYmosICJlbmRjaWRyYW5nZSIpKSB7CiAgICAgIHJldHVybjsKICAgIH0KICAgIGV4cGVjdFN0cmluZyhvYmopOwogICAgY29uc3QgbG93ID0gc3RyVG9JbnQob2JqKTsKICAgIG9iaiA9IGxleGVyLmdldE9iaigpOwogICAgZXhwZWN0U3RyaW5nKG9iaik7CiAgICBjb25zdCBoaWdoID0gc3RyVG9JbnQob2JqKTsKICAgIG9iaiA9IGxleGVyLmdldE9iaigpOwogICAgZXhwZWN0SW50KG9iaik7CiAgICBjb25zdCBkc3RMb3cgPSBvYmo7CiAgICBjTWFwLm1hcENpZFJhbmdlKGxvdywgaGlnaCwgZHN0TG93KTsKICB9Cn0KZnVuY3Rpb24gcGFyc2VDb2Rlc3BhY2VSYW5nZShjTWFwLCBsZXhlcikgewogIHdoaWxlICh0cnVlKSB7CiAgICBsZXQgb2JqID0gbGV4ZXIuZ2V0T2JqKCk7CiAgICBpZiAob2JqID09PSBfcHJpbWl0aXZlcy5FT0YpIHsKICAgICAgYnJlYWs7CiAgICB9CiAgICBpZiAoKDAsIF9wcmltaXRpdmVzLmlzQ21kKShvYmosICJlbmRjb2Rlc3BhY2VyYW5nZSIpKSB7CiAgICAgIHJldHVybjsKICAgIH0KICAgIGlmICh0eXBlb2Ygb2JqICE9PSAic3RyaW5nIikgewogICAgICBicmVhazsKICAgIH0KICAgIGNvbnN0IGxvdyA9IHN0clRvSW50KG9iaik7CiAgICBvYmogPSBsZXhlci5nZXRPYmooKTsKICAgIGlmICh0eXBlb2Ygb2JqICE9PSAic3RyaW5nIikgewogICAgICBicmVhazsKICAgIH0KICAgIGNvbnN0IGhpZ2ggPSBzdHJUb0ludChvYmopOwogICAgY01hcC5hZGRDb2Rlc3BhY2VSYW5nZShvYmoubGVuZ3RoLCBsb3csIGhpZ2gpOwogIH0KICB0aHJvdyBuZXcgX3V0aWwuRm9ybWF0RXJyb3IoIkludmFsaWQgY29kZXNwYWNlIHJhbmdlLiIpOwp9CmZ1bmN0aW9uIHBhcnNlV01vZGUoY01hcCwgbGV4ZXIpIHsKICBjb25zdCBvYmogPSBsZXhlci5nZXRPYmooKTsKICBpZiAoTnVtYmVyLmlzSW50ZWdlcihvYmopKSB7CiAgICBjTWFwLnZlcnRpY2FsID0gISFvYmo7CiAgfQp9CmZ1bmN0aW9uIHBhcnNlQ01hcE5hbWUoY01hcCwgbGV4ZXIpIHsKICBjb25zdCBvYmogPSBsZXhlci5nZXRPYmooKTsKICBpZiAob2JqIGluc3RhbmNlb2YgX3ByaW1pdGl2ZXMuTmFtZSkgewogICAgY01hcC5uYW1lID0gb2JqLm5hbWU7CiAgfQp9CmFzeW5jIGZ1bmN0aW9uIHBhcnNlQ01hcChjTWFwLCBsZXhlciwgZmV0Y2hCdWlsdEluQ01hcCwgdXNlQ01hcCkgewogIGxldCBwcmV2aW91cywgZW1iZWRkZWRVc2VDTWFwOwogIG9iakxvb3A6IHdoaWxlICh0cnVlKSB7CiAgICB0cnkgewogICAgICBjb25zdCBvYmogPSBsZXhlci5nZXRPYmooKTsKICAgICAgaWYgKG9iaiA9PT0gX3ByaW1pdGl2ZXMuRU9GKSB7CiAgICAgICAgYnJlYWs7CiAgICAgIH0gZWxzZSBpZiAob2JqIGluc3RhbmNlb2YgX3ByaW1pdGl2ZXMuTmFtZSkgewogICAgICAgIGlmIChvYmoubmFtZSA9PT0gIldNb2RlIikgewogICAgICAgICAgcGFyc2VXTW9kZShjTWFwLCBsZXhlcik7CiAgICAgICAgfSBlbHNlIGlmIChvYmoubmFtZSA9PT0gIkNNYXBOYW1lIikgewogICAgICAgICAgcGFyc2VDTWFwTmFtZShjTWFwLCBsZXhlcik7CiAgICAgICAgfQogICAgICAgIHByZXZpb3VzID0gb2JqOwogICAgICB9IGVsc2UgaWYgKG9iaiBpbnN0YW5jZW9mIF9wcmltaXRpdmVzLkNtZCkgewogICAgICAgIHN3aXRjaCAob2JqLmNtZCkgewogICAgICAgICAgY2FzZSAiZW5kY21hcCI6CiAgICAgICAgICAgIGJyZWFrIG9iakxvb3A7CiAgICAgICAgICBjYXNlICJ1c2VjbWFwIjoKICAgICAgICAgICAgaWYgKHByZXZpb3VzIGluc3RhbmNlb2YgX3ByaW1pdGl2ZXMuTmFtZSkgewogICAgICAgICAgICAgIGVtYmVkZGVkVXNlQ01hcCA9IHByZXZpb3VzLm5hbWU7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICBjYXNlICJiZWdpbmNvZGVzcGFjZXJhbmdlIjoKICAgICAgICAgICAgcGFyc2VDb2Rlc3BhY2VSYW5nZShjTWFwLCBsZXhlcik7CiAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgY2FzZSAiYmVnaW5iZmNoYXIiOgogICAgICAgICAgICBwYXJzZUJmQ2hhcihjTWFwLCBsZXhlcik7CiAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgY2FzZSAiYmVnaW5jaWRjaGFyIjoKICAgICAgICAgICAgcGFyc2VDaWRDaGFyKGNNYXAsIGxleGVyKTsKICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICBjYXNlICJiZWdpbmJmcmFuZ2UiOgogICAgICAgICAgICBwYXJzZUJmUmFuZ2UoY01hcCwgbGV4ZXIpOwogICAgICAgICAgICBicmVhazsKICAgICAgICAgIGNhc2UgImJlZ2luY2lkcmFuZ2UiOgogICAgICAgICAgICBwYXJzZUNpZFJhbmdlKGNNYXAsIGxleGVyKTsKICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgfQogICAgICB9CiAgICB9IGNhdGNoIChleCkgewogICAgICBpZiAoZXggaW5zdGFuY2VvZiBfY29yZV91dGlscy5NaXNzaW5nRGF0YUV4Y2VwdGlvbikgewogICAgICAgIHRocm93IGV4OwogICAgICB9CiAgICAgICgwLCBfdXRpbC53YXJuKSgiSW52YWxpZCBjTWFwIGRhdGE6ICIgKyBleCk7CiAgICAgIGNvbnRpbnVlOwogICAgfQogIH0KICBpZiAoIXVzZUNNYXAgJiYgZW1iZWRkZWRVc2VDTWFwKSB7CiAgICB1c2VDTWFwID0gZW1iZWRkZWRVc2VDTWFwOwogIH0KICBpZiAodXNlQ01hcCkgewogICAgcmV0dXJuIGV4dGVuZENNYXAoY01hcCwgZmV0Y2hCdWlsdEluQ01hcCwgdXNlQ01hcCk7CiAgfQogIHJldHVybiBjTWFwOwp9CmFzeW5jIGZ1bmN0aW9uIGV4dGVuZENNYXAoY01hcCwgZmV0Y2hCdWlsdEluQ01hcCwgdXNlQ01hcCkgewogIGNNYXAudXNlQ01hcCA9IGF3YWl0IGNyZWF0ZUJ1aWx0SW5DTWFwKHVzZUNNYXAsIGZldGNoQnVpbHRJbkNNYXApOwogIGlmIChjTWFwLm51bUNvZGVzcGFjZVJhbmdlcyA9PT0gMCkgewogICAgY29uc3QgdXNlQ29kZXNwYWNlUmFuZ2VzID0gY01hcC51c2VDTWFwLmNvZGVzcGFjZVJhbmdlczsKICAgIGZvciAobGV0IGkgPSAwOyBpIDwgdXNlQ29kZXNwYWNlUmFuZ2VzLmxlbmd0aDsgaSsrKSB7CiAgICAgIGNNYXAuY29kZXNwYWNlUmFuZ2VzW2ldID0gdXNlQ29kZXNwYWNlUmFuZ2VzW2ldLnNsaWNlKCk7CiAgICB9CiAgICBjTWFwLm51bUNvZGVzcGFjZVJhbmdlcyA9IGNNYXAudXNlQ01hcC5udW1Db2Rlc3BhY2VSYW5nZXM7CiAgfQogIGNNYXAudXNlQ01hcC5mb3JFYWNoKGZ1bmN0aW9uIChrZXksIHZhbHVlKSB7CiAgICBpZiAoIWNNYXAuY29udGFpbnMoa2V5KSkgewogICAgICBjTWFwLm1hcE9uZShrZXksIGNNYXAudXNlQ01hcC5sb29rdXAoa2V5KSk7CiAgICB9CiAgfSk7CiAgcmV0dXJuIGNNYXA7Cn0KYXN5bmMgZnVuY3Rpb24gY3JlYXRlQnVpbHRJbkNNYXAobmFtZSwgZmV0Y2hCdWlsdEluQ01hcCkgewogIGlmIChuYW1lID09PSAiSWRlbnRpdHktSCIpIHsKICAgIHJldHVybiBuZXcgSWRlbnRpdHlDTWFwKGZhbHNlLCAyKTsKICB9IGVsc2UgaWYgKG5hbWUgPT09ICJJZGVudGl0eS1WIikgewogICAgcmV0dXJuIG5ldyBJZGVudGl0eUNNYXAodHJ1ZSwgMik7CiAgfQogIGlmICghQlVJTFRfSU5fQ01BUFMuaW5jbHVkZXMobmFtZSkpIHsKICAgIHRocm93IG5ldyBFcnJvcigiVW5rbm93biBDTWFwIG5hbWU6ICIgKyBuYW1lKTsKICB9CiAgaWYgKCFmZXRjaEJ1aWx0SW5DTWFwKSB7CiAgICB0aHJvdyBuZXcgRXJyb3IoIkJ1aWx0LWluIENNYXAgcGFyYW1ldGVycyBhcmUgbm90IHByb3ZpZGVkLiIpOwogIH0KICBjb25zdCB7CiAgICBjTWFwRGF0YSwKICAgIGNvbXByZXNzaW9uVHlwZQogIH0gPSBhd2FpdCBmZXRjaEJ1aWx0SW5DTWFwKG5hbWUpOwogIGNvbnN0IGNNYXAgPSBuZXcgQ01hcCh0cnVlKTsKICBpZiAoY29tcHJlc3Npb25UeXBlID09PSBfdXRpbC5DTWFwQ29tcHJlc3Npb25UeXBlLkJJTkFSWSkgewogICAgcmV0dXJuIG5ldyBfYmluYXJ5X2NtYXAuQmluYXJ5Q01hcFJlYWRlcigpLnByb2Nlc3MoY01hcERhdGEsIGNNYXAsIHVzZUNNYXAgPT4gewogICAgICByZXR1cm4gZXh0ZW5kQ01hcChjTWFwLCBmZXRjaEJ1aWx0SW5DTWFwLCB1c2VDTWFwKTsKICAgIH0pOwogIH0KICBpZiAoY29tcHJlc3Npb25UeXBlID09PSBfdXRpbC5DTWFwQ29tcHJlc3Npb25UeXBlLk5PTkUpIHsKICAgIGNvbnN0IGxleGVyID0gbmV3IF9wYXJzZXIuTGV4ZXIobmV3IF9zdHJlYW0uU3RyZWFtKGNNYXBEYXRhKSk7CiAgICByZXR1cm4gcGFyc2VDTWFwKGNNYXAsIGxleGVyLCBmZXRjaEJ1aWx0SW5DTWFwLCBudWxsKTsKICB9CiAgdGhyb3cgbmV3IEVycm9yKGBJbnZhbGlkIENNYXAgImNvbXByZXNzaW9uVHlwZSIgdmFsdWU6ICR7Y29tcHJlc3Npb25UeXBlfWApOwp9CmNsYXNzIENNYXBGYWN0b3J5IHsKICBzdGF0aWMgYXN5bmMgY3JlYXRlKHsKICAgIGVuY29kaW5nLAogICAgZmV0Y2hCdWlsdEluQ01hcCwKICAgIHVzZUNNYXAKICB9KSB7CiAgICBpZiAoZW5jb2RpbmcgaW5zdGFuY2VvZiBfcHJpbWl0aXZlcy5OYW1lKSB7CiAgICAgIHJldHVybiBjcmVhdGVCdWlsdEluQ01hcChlbmNvZGluZy5uYW1lLCBmZXRjaEJ1aWx0SW5DTWFwKTsKICAgIH0gZWxzZSBpZiAoZW5jb2RpbmcgaW5zdGFuY2VvZiBfYmFzZV9zdHJlYW0uQmFzZVN0cmVhbSkgewogICAgICBjb25zdCBwYXJzZWRDTWFwID0gYXdhaXQgcGFyc2VDTWFwKG5ldyBDTWFwKCksIG5ldyBfcGFyc2VyLkxleGVyKGVuY29kaW5nKSwgZmV0Y2hCdWlsdEluQ01hcCwgdXNlQ01hcCk7CiAgICAgIGlmIChwYXJzZWRDTWFwLmlzSWRlbnRpdHlDTWFwKSB7CiAgICAgICAgcmV0dXJuIGNyZWF0ZUJ1aWx0SW5DTWFwKHBhcnNlZENNYXAubmFtZSwgZmV0Y2hCdWlsdEluQ01hcCk7CiAgICAgIH0KICAgICAgcmV0dXJuIHBhcnNlZENNYXA7CiAgICB9CiAgICB0aHJvdyBuZXcgRXJyb3IoIkVuY29kaW5nIHJlcXVpcmVkLiIpOwogIH0KfQpleHBvcnRzLkNNYXBGYWN0b3J5ID0gQ01hcEZhY3Rvcnk7CgovKioqLyB9KSwKLyogMTUgKi8KLyoqKi8gKChfX3VudXNlZF93ZWJwYWNrX21vZHVsZSwgZXhwb3J0cywgX193X3BkZmpzX3JlcXVpcmVfXykgPT4gewoKCgpPYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgIl9fZXNNb2R1bGUiLCAoewogIHZhbHVlOiB0cnVlCn0pKTsKZXhwb3J0cy5CaW5hcnlDTWFwUmVhZGVyID0gdm9pZCAwOwp2YXIgX3V0aWwgPSBfX3dfcGRmanNfcmVxdWlyZV9fKDIpOwpmdW5jdGlvbiBoZXhUb0ludChhLCBzaXplKSB7CiAgbGV0IG4gPSAwOwogIGZvciAobGV0IGkgPSAwOyBpIDw9IHNpemU7IGkrKykgewogICAgbiA9IG4gPDwgOCB8IGFbaV07CiAgfQogIHJldHVybiBuID4+PiAwOwp9CmZ1bmN0aW9uIGhleFRvU3RyKGEsIHNpemUpIHsKICBpZiAoc2l6ZSA9PT0gMSkgewogICAgcmV0dXJuIFN0cmluZy5mcm9tQ2hhckNvZGUoYVswXSwgYVsxXSk7CiAgfQogIGlmIChzaXplID09PSAzKSB7CiAgICByZXR1cm4gU3RyaW5nLmZyb21DaGFyQ29kZShhWzBdLCBhWzFdLCBhWzJdLCBhWzNdKTsKICB9CiAgcmV0dXJuIFN0cmluZy5mcm9tQ2hhckNvZGUoLi4uYS5zdWJhcnJheSgwLCBzaXplICsgMSkpOwp9CmZ1bmN0aW9uIGFkZEhleChhLCBiLCBzaXplKSB7CiAgbGV0IGMgPSAwOwogIGZvciAobGV0IGkgPSBzaXplOyBpID49IDA7IGktLSkgewogICAgYyArPSBhW2ldICsgYltpXTsKICAgIGFbaV0gPSBjICYgMjU1OwogICAgYyA+Pj0gODsKICB9Cn0KZnVuY3Rpb24gaW5jSGV4KGEsIHNpemUpIHsKICBsZXQgYyA9IDE7CiAgZm9yIChsZXQgaSA9IHNpemU7IGkgPj0gMCAmJiBjID4gMDsgaS0tKSB7CiAgICBjICs9IGFbaV07CiAgICBhW2ldID0gYyAmIDI1NTsKICAgIGMgPj49IDg7CiAgfQp9CmNvbnN0IE1BWF9OVU1fU0laRSA9IDE2Owpjb25zdCBNQVhfRU5DT0RFRF9OVU1fU0laRSA9IDE5OwpjbGFzcyBCaW5hcnlDTWFwU3RyZWFtIHsKICBjb25zdHJ1Y3RvcihkYXRhKSB7CiAgICB0aGlzLmJ1ZmZlciA9IGRhdGE7CiAgICB0aGlzLnBvcyA9IDA7CiAgICB0aGlzLmVuZCA9IGRhdGEubGVuZ3RoOwogICAgdGhpcy50bXBCdWYgPSBuZXcgVWludDhBcnJheShNQVhfRU5DT0RFRF9OVU1fU0laRSk7CiAgfQogIHJlYWRCeXRlKCkgewogICAgaWYgKHRoaXMucG9zID49IHRoaXMuZW5kKSB7CiAgICAgIHJldHVybiAtMTsKICAgIH0KICAgIHJldHVybiB0aGlzLmJ1ZmZlclt0aGlzLnBvcysrXTsKICB9CiAgcmVhZE51bWJlcigpIHsKICAgIGxldCBuID0gMDsKICAgIGxldCBsYXN0OwogICAgZG8gewogICAgICBjb25zdCBiID0gdGhpcy5yZWFkQnl0ZSgpOwogICAgICBpZiAoYiA8IDApIHsKICAgICAgICB0aHJvdyBuZXcgX3V0aWwuRm9ybWF0RXJyb3IoInVuZXhwZWN0ZWQgRU9GIGluIGJjbWFwIik7CiAgICAgIH0KICAgICAgbGFzdCA9ICEoYiAmIDB4ODApOwogICAgICBuID0gbiA8PCA3IHwgYiAmIDB4N2Y7CiAgICB9IHdoaWxlICghbGFzdCk7CiAgICByZXR1cm4gbjsKICB9CiAgcmVhZFNpZ25lZCgpIHsKICAgIGNvbnN0IG4gPSB0aGlzLnJlYWROdW1iZXIoKTsKICAgIHJldHVybiBuICYgMSA/IH4obiA+Pj4gMSkgOiBuID4+PiAxOwogIH0KICByZWFkSGV4KG51bSwgc2l6ZSkgewogICAgbnVtLnNldCh0aGlzLmJ1ZmZlci5zdWJhcnJheSh0aGlzLnBvcywgdGhpcy5wb3MgKyBzaXplICsgMSkpOwogICAgdGhpcy5wb3MgKz0gc2l6ZSArIDE7CiAgfQogIHJlYWRIZXhOdW1iZXIobnVtLCBzaXplKSB7CiAgICBsZXQgbGFzdDsKICAgIGNvbnN0IHN0YWNrID0gdGhpcy50bXBCdWY7CiAgICBsZXQgc3AgPSAwOwogICAgZG8gewogICAgICBjb25zdCBiID0gdGhpcy5yZWFkQnl0ZSgpOwogICAgICBpZiAoYiA8IDApIHsKICAgICAgICB0aHJvdyBuZXcgX3V0aWwuRm9ybWF0RXJyb3IoInVuZXhwZWN0ZWQgRU9GIGluIGJjbWFwIik7CiAgICAgIH0KICAgICAgbGFzdCA9ICEoYiAmIDB4ODApOwogICAgICBzdGFja1tzcCsrXSA9IGIgJiAweDdmOwogICAgfSB3aGlsZSAoIWxhc3QpOwogICAgbGV0IGkgPSBzaXplLAogICAgICBidWZmZXIgPSAwLAogICAgICBidWZmZXJTaXplID0gMDsKICAgIHdoaWxlIChpID49IDApIHsKICAgICAgd2hpbGUgKGJ1ZmZlclNpemUgPCA4ICYmIHN0YWNrLmxlbmd0aCA+IDApIHsKICAgICAgICBidWZmZXIgfD0gc3RhY2tbLS1zcF0gPDwgYnVmZmVyU2l6ZTsKICAgICAgICBidWZmZXJTaXplICs9IDc7CiAgICAgIH0KICAgICAgbnVtW2ldID0gYnVmZmVyICYgMjU1OwogICAgICBpLS07CiAgICAgIGJ1ZmZlciA+Pj0gODsKICAgICAgYnVmZmVyU2l6ZSAtPSA4OwogICAgfQogIH0KICByZWFkSGV4U2lnbmVkKG51bSwgc2l6ZSkgewogICAgdGhpcy5yZWFkSGV4TnVtYmVyKG51bSwgc2l6ZSk7CiAgICBjb25zdCBzaWduID0gbnVtW3NpemVdICYgMSA/IDI1NSA6IDA7CiAgICBsZXQgYyA9IDA7CiAgICBmb3IgKGxldCBpID0gMDsgaSA8PSBzaXplOyBpKyspIHsKICAgICAgYyA9IChjICYgMSkgPDwgOCB8IG51bVtpXTsKICAgICAgbnVtW2ldID0gYyA+PiAxIF4gc2lnbjsKICAgIH0KICB9CiAgcmVhZFN0cmluZygpIHsKICAgIGNvbnN0IGxlbiA9IHRoaXMucmVhZE51bWJlcigpLAogICAgICBidWYgPSBuZXcgQXJyYXkobGVuKTsKICAgIGZvciAobGV0IGkgPSAwOyBpIDwgbGVuOyBpKyspIHsKICAgICAgYnVmW2ldID0gdGhpcy5yZWFkTnVtYmVyKCk7CiAgICB9CiAgICByZXR1cm4gU3RyaW5nLmZyb21DaGFyQ29kZSguLi5idWYpOwogIH0KfQpjbGFzcyBCaW5hcnlDTWFwUmVhZGVyIHsKICBhc3luYyBwcm9jZXNzKGRhdGEsIGNNYXAsIGV4dGVuZCkgewogICAgY29uc3Qgc3RyZWFtID0gbmV3IEJpbmFyeUNNYXBTdHJlYW0oZGF0YSk7CiAgICBjb25zdCBoZWFkZXIgPSBzdHJlYW0ucmVhZEJ5dGUoKTsKICAgIGNNYXAudmVydGljYWwgPSAhIShoZWFkZXIgJiAxKTsKICAgIGxldCB1c2VDTWFwID0gbnVsbDsKICAgIGNvbnN0IHN0YXJ0ID0gbmV3IFVpbnQ4QXJyYXkoTUFYX05VTV9TSVpFKTsKICAgIGNvbnN0IGVuZCA9IG5ldyBVaW50OEFycmF5KE1BWF9OVU1fU0laRSk7CiAgICBjb25zdCBjaGFyID0gbmV3IFVpbnQ4QXJyYXkoTUFYX05VTV9TSVpFKTsKICAgIGNvbnN0IGNoYXJDb2RlID0gbmV3IFVpbnQ4QXJyYXkoTUFYX05VTV9TSVpFKTsKICAgIGNvbnN0IHRtcCA9IG5ldyBVaW50OEFycmF5KE1BWF9OVU1fU0laRSk7CiAgICBsZXQgY29kZTsKICAgIGxldCBiOwogICAgd2hpbGUgKChiID0gc3RyZWFtLnJlYWRCeXRlKCkpID49IDApIHsKICAgICAgY29uc3QgdHlwZSA9IGIgPj4gNTsKICAgICAgaWYgKHR5cGUgPT09IDcpIHsKICAgICAgICBzd2l0Y2ggKGIgJiAweDFmKSB7CiAgICAgICAgICBjYXNlIDA6CiAgICAgICAgICAgIHN0cmVhbS5yZWFkU3RyaW5nKCk7CiAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgY2FzZSAxOgogICAgICAgICAgICB1c2VDTWFwID0gc3RyZWFtLnJlYWRTdHJpbmcoKTsKICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgfQogICAgICAgIGNvbnRpbnVlOwogICAgICB9CiAgICAgIGNvbnN0IHNlcXVlbmNlID0gISEoYiAmIDB4MTApOwogICAgICBjb25zdCBkYXRhU2l6ZSA9IGIgJiAxNTsKICAgICAgaWYgKGRhdGFTaXplICsgMSA+IE1BWF9OVU1fU0laRSkgewogICAgICAgIHRocm93IG5ldyBFcnJvcigiQmluYXJ5Q01hcFJlYWRlci5wcm9jZXNzOiBJbnZhbGlkIGRhdGFTaXplLiIpOwogICAgICB9CiAgICAgIGNvbnN0IHVjczJEYXRhU2l6ZSA9IDE7CiAgICAgIGNvbnN0IHN1Yml0ZW1zQ291bnQgPSBzdHJlYW0ucmVhZE51bWJlcigpOwogICAgICBzd2l0Y2ggKHR5cGUpIHsKICAgICAgICBjYXNlIDA6CiAgICAgICAgICBzdHJlYW0ucmVhZEhleChzdGFydCwgZGF0YVNpemUpOwogICAgICAgICAgc3RyZWFtLnJlYWRIZXhOdW1iZXIoZW5kLCBkYXRhU2l6ZSk7CiAgICAgICAgICBhZGRIZXgoZW5kLCBzdGFydCwgZGF0YVNpemUpOwogICAgICAgICAgY01hcC5hZGRDb2Rlc3BhY2VSYW5nZShkYXRhU2l6ZSArIDEsIGhleFRvSW50KHN0YXJ0LCBkYXRhU2l6ZSksIGhleFRvSW50KGVuZCwgZGF0YVNpemUpKTsKICAgICAgICAgIGZvciAobGV0IGkgPSAxOyBpIDwgc3ViaXRlbXNDb3VudDsgaSsrKSB7CiAgICAgICAgICAgIGluY0hleChlbmQsIGRhdGFTaXplKTsKICAgICAgICAgICAgc3RyZWFtLnJlYWRIZXhOdW1iZXIoc3RhcnQsIGRhdGFTaXplKTsKICAgICAgICAgICAgYWRkSGV4KHN0YXJ0LCBlbmQsIGRhdGFTaXplKTsKICAgICAgICAgICAgc3RyZWFtLnJlYWRIZXhOdW1iZXIoZW5kLCBkYXRhU2l6ZSk7CiAgICAgICAgICAgIGFkZEhleChlbmQsIHN0YXJ0LCBkYXRhU2l6ZSk7CiAgICAgICAgICAgIGNNYXAuYWRkQ29kZXNwYWNlUmFuZ2UoZGF0YVNpemUgKyAxLCBoZXhUb0ludChzdGFydCwgZGF0YVNpemUpLCBoZXhUb0ludChlbmQsIGRhdGFTaXplKSk7CiAgICAgICAgICB9CiAgICAgICAgICBicmVhazsKICAgICAgICBjYXNlIDE6CiAgICAgICAgICBzdHJlYW0ucmVhZEhleChzdGFydCwgZGF0YVNpemUpOwogICAgICAgICAgc3RyZWFtLnJlYWRIZXhOdW1iZXIoZW5kLCBkYXRhU2l6ZSk7CiAgICAgICAgICBhZGRIZXgoZW5kLCBzdGFydCwgZGF0YVNpemUpOwogICAgICAgICAgc3RyZWFtLnJlYWROdW1iZXIoKTsKICAgICAgICAgIGZvciAobGV0IGkgPSAxOyBpIDwgc3ViaXRlbXNDb3VudDsgaSsrKSB7CiAgICAgICAgICAgIGluY0hleChlbmQsIGRhdGFTaXplKTsKICAgICAgICAgICAgc3RyZWFtLnJlYWRIZXhOdW1iZXIoc3RhcnQsIGRhdGFTaXplKTsKICAgICAgICAgICAgYWRkSGV4KHN0YXJ0LCBlbmQsIGRhdGFTaXplKTsKICAgICAgICAgICAgc3RyZWFtLnJlYWRIZXhOdW1iZXIoZW5kLCBkYXRhU2l6ZSk7CiAgICAgICAgICAgIGFkZEhleChlbmQsIHN0YXJ0LCBkYXRhU2l6ZSk7CiAgICAgICAgICAgIHN0cmVhbS5yZWFkTnVtYmVyKCk7CiAgICAgICAgICB9CiAgICAgICAgICBicmVhazsKICAgICAgICBjYXNlIDI6CiAgICAgICAgICBzdHJlYW0ucmVhZEhleChjaGFyLCBkYXRhU2l6ZSk7CiAgICAgICAgICBjb2RlID0gc3RyZWFtLnJlYWROdW1iZXIoKTsKICAgICAgICAgIGNNYXAubWFwT25lKGhleFRvSW50KGNoYXIsIGRhdGFTaXplKSwgY29kZSk7CiAgICAgICAgICBmb3IgKGxldCBpID0gMTsgaSA8IHN1Yml0ZW1zQ291bnQ7IGkrKykgewogICAgICAgICAgICBpbmNIZXgoY2hhciwgZGF0YVNpemUpOwogICAgICAgICAgICBpZiAoIXNlcXVlbmNlKSB7CiAgICAgICAgICAgICAgc3RyZWFtLnJlYWRIZXhOdW1iZXIodG1wLCBkYXRhU2l6ZSk7CiAgICAgICAgICAgICAgYWRkSGV4KGNoYXIsIHRtcCwgZGF0YVNpemUpOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGNvZGUgPSBzdHJlYW0ucmVhZFNpZ25lZCgpICsgKGNvZGUgKyAxKTsKICAgICAgICAgICAgY01hcC5tYXBPbmUoaGV4VG9JbnQoY2hhciwgZGF0YVNpemUpLCBjb2RlKTsKICAgICAgICAgIH0KICAgICAgICAgIGJyZWFrOwogICAgICAgIGNhc2UgMzoKICAgICAgICAgIHN0cmVhbS5yZWFkSGV4KHN0YXJ0LCBkYXRhU2l6ZSk7CiAgICAgICAgICBzdHJlYW0ucmVhZEhleE51bWJlcihlbmQsIGRhdGFTaXplKTsKICAgICAgICAgIGFkZEhleChlbmQsIHN0YXJ0LCBkYXRhU2l6ZSk7CiAgICAgICAgICBjb2RlID0gc3RyZWFtLnJlYWROdW1iZXIoKTsKICAgICAgICAgIGNNYXAubWFwQ2lkUmFuZ2UoaGV4VG9JbnQoc3RhcnQsIGRhdGFTaXplKSwgaGV4VG9JbnQoZW5kLCBkYXRhU2l6ZSksIGNvZGUpOwogICAgICAgICAgZm9yIChsZXQgaSA9IDE7IGkgPCBzdWJpdGVtc0NvdW50OyBpKyspIHsKICAgICAgICAgICAgaW5jSGV4KGVuZCwgZGF0YVNpemUpOwogICAgICAgICAgICBpZiAoIXNlcXVlbmNlKSB7CiAgICAgICAgICAgICAgc3RyZWFtLnJlYWRIZXhOdW1iZXIoc3RhcnQsIGRhdGFTaXplKTsKICAgICAgICAgICAgICBhZGRIZXgoc3RhcnQsIGVuZCwgZGF0YVNpemUpOwogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgIHN0YXJ0LnNldChlbmQpOwogICAgICAgICAgICB9CiAgICAgICAgICAgIHN0cmVhbS5yZWFkSGV4TnVtYmVyKGVuZCwgZGF0YVNpemUpOwogICAgICAgICAgICBhZGRIZXgoZW5kLCBzdGFydCwgZGF0YVNpemUpOwogICAgICAgICAgICBjb2RlID0gc3RyZWFtLnJlYWROdW1iZXIoKTsKICAgICAgICAgICAgY01hcC5tYXBDaWRSYW5nZShoZXhUb0ludChzdGFydCwgZGF0YVNpemUpLCBoZXhUb0ludChlbmQsIGRhdGFTaXplKSwgY29kZSk7CiAgICAgICAgICB9CiAgICAgICAgICBicmVhazsKICAgICAgICBjYXNlIDQ6CiAgICAgICAgICBzdHJlYW0ucmVhZEhleChjaGFyLCB1Y3MyRGF0YVNpemUpOwogICAgICAgICAgc3RyZWFtLnJlYWRIZXgoY2hhckNvZGUsIGRhdGFTaXplKTsKICAgICAgICAgIGNNYXAubWFwT25lKGhleFRvSW50KGNoYXIsIHVjczJEYXRhU2l6ZSksIGhleFRvU3RyKGNoYXJDb2RlLCBkYXRhU2l6ZSkpOwogICAgICAgICAgZm9yIChsZXQgaSA9IDE7IGkgPCBzdWJpdGVtc0NvdW50OyBpKyspIHsKICAgICAgICAgICAgaW5jSGV4KGNoYXIsIHVjczJEYXRhU2l6ZSk7CiAgICAgICAgICAgIGlmICghc2VxdWVuY2UpIHsKICAgICAgICAgICAgICBzdHJlYW0ucmVhZEhleE51bWJlcih0bXAsIHVjczJEYXRhU2l6ZSk7CiAgICAgICAgICAgICAgYWRkSGV4KGNoYXIsIHRtcCwgdWNzMkRhdGFTaXplKTsKICAgICAgICAgICAgfQogICAgICAgICAgICBpbmNIZXgoY2hhckNvZGUsIGRhdGFTaXplKTsKICAgICAgICAgICAgc3RyZWFtLnJlYWRIZXhTaWduZWQodG1wLCBkYXRhU2l6ZSk7CiAgICAgICAgICAgIGFkZEhleChjaGFyQ29kZSwgdG1wLCBkYXRhU2l6ZSk7CiAgICAgICAgICAgIGNNYXAubWFwT25lKGhleFRvSW50KGNoYXIsIHVjczJEYXRhU2l6ZSksIGhleFRvU3RyKGNoYXJDb2RlLCBkYXRhU2l6ZSkpOwogICAgICAgICAgfQogICAgICAgICAgYnJlYWs7CiAgICAgICAgY2FzZSA1OgogICAgICAgICAgc3RyZWFtLnJlYWRIZXgoc3RhcnQsIHVjczJEYXRhU2l6ZSk7CiAgICAgICAgICBzdHJlYW0ucmVhZEhleE51bWJlcihlbmQsIHVjczJEYXRhU2l6ZSk7CiAgICAgICAgICBhZGRIZXgoZW5kLCBzdGFydCwgdWNzMkRhdGFTaXplKTsKICAgICAgICAgIHN0cmVhbS5yZWFkSGV4KGNoYXJDb2RlLCBkYXRhU2l6ZSk7CiAgICAgICAgICBjTWFwLm1hcEJmUmFuZ2UoaGV4VG9JbnQoc3RhcnQsIHVjczJEYXRhU2l6ZSksIGhleFRvSW50KGVuZCwgdWNzMkRhdGFTaXplKSwgaGV4VG9TdHIoY2hhckNvZGUsIGRhdGFTaXplKSk7CiAgICAgICAgICBmb3IgKGxldCBpID0gMTsgaSA8IHN1Yml0ZW1zQ291bnQ7IGkrKykgewogICAgICAgICAgICBpbmNIZXgoZW5kLCB1Y3MyRGF0YVNpemUpOwogICAgICAgICAgICBpZiAoIXNlcXVlbmNlKSB7CiAgICAgICAgICAgICAgc3RyZWFtLnJlYWRIZXhOdW1iZXIoc3RhcnQsIHVjczJEYXRhU2l6ZSk7CiAgICAgICAgICAgICAgYWRkSGV4KHN0YXJ0LCBlbmQsIHVjczJEYXRhU2l6ZSk7CiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgc3RhcnQuc2V0KGVuZCk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgc3RyZWFtLnJlYWRIZXhOdW1iZXIoZW5kLCB1Y3MyRGF0YVNpemUpOwogICAgICAgICAgICBhZGRIZXgoZW5kLCBzdGFydCwgdWNzMkRhdGFTaXplKTsKICAgICAgICAgICAgc3RyZWFtLnJlYWRIZXgoY2hhckNvZGUsIGRhdGFTaXplKTsKICAgICAgICAgICAgY01hcC5tYXBCZlJhbmdlKGhleFRvSW50KHN0YXJ0LCB1Y3MyRGF0YVNpemUpLCBoZXhUb0ludChlbmQsIHVjczJEYXRhU2l6ZSksIGhleFRvU3RyKGNoYXJDb2RlLCBkYXRhU2l6ZSkpOwogICAgICAgICAgfQogICAgICAgICAgYnJlYWs7CiAgICAgICAgZGVmYXVsdDoKICAgICAgICAgIHRocm93IG5ldyBFcnJvcihgQmluYXJ5Q01hcFJlYWRlci5wcm9jZXNzIC0gdW5rbm93biB0eXBlOiAke3R5cGV9YCk7CiAgICAgIH0KICAgIH0KICAgIGlmICh1c2VDTWFwKSB7CiAgICAgIHJldHVybiBleHRlbmQodXNlQ01hcCk7CiAgICB9CiAgICByZXR1cm4gY01hcDsKICB9Cn0KZXhwb3J0cy5CaW5hcnlDTWFwUmVhZGVyID0gQmluYXJ5Q01hcFJlYWRlcjsKCi8qKiovIH0pLAovKiAxNiAqLwovKioqLyAoKF9fdW51c2VkX3dlYnBhY2tfbW9kdWxlLCBleHBvcnRzLCBfX3dfcGRmanNfcmVxdWlyZV9fKSA9PiB7CgoKCk9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCAiX19lc01vZHVsZSIsICh7CiAgdmFsdWU6IHRydWUKfSkpOwpleHBvcnRzLlBhcnNlciA9IGV4cG9ydHMuTGluZWFyaXphdGlvbiA9IGV4cG9ydHMuTGV4ZXIgPSB2b2lkIDA7CnZhciBfdXRpbCA9IF9fd19wZGZqc19yZXF1aXJlX18oMik7CnZhciBfcHJpbWl0aXZlcyA9IF9fd19wZGZqc19yZXF1aXJlX18oNCk7CnZhciBfY29yZV91dGlscyA9IF9fd19wZGZqc19yZXF1aXJlX18oMyk7CnZhciBfc3RyZWFtID0gX193X3BkZmpzX3JlcXVpcmVfXyg4KTsKdmFyIF9hc2NpaV84NV9zdHJlYW0gPSBfX3dfcGRmanNfcmVxdWlyZV9fKDE3KTsKdmFyIF9hc2NpaV9oZXhfc3RyZWFtID0gX193X3BkZmpzX3JlcXVpcmVfXygxOSk7CnZhciBfY2NpdHRfc3RyZWFtID0gX193X3BkZmpzX3JlcXVpcmVfXygyMCk7CnZhciBfZmxhdGVfc3RyZWFtID0gX193X3BkZmpzX3JlcXVpcmVfXygyMik7CnZhciBfamJpZzJfc3RyZWFtID0gX193X3BkZmpzX3JlcXVpcmVfXygyMyk7CnZhciBfanBlZ19zdHJlYW0gPSBfX3dfcGRmanNfcmVxdWlyZV9fKDI2KTsKdmFyIF9qcHhfc3RyZWFtID0gX193X3BkZmpzX3JlcXVpcmVfXygyOSk7CnZhciBfbHp3X3N0cmVhbSA9IF9fd19wZGZqc19yZXF1aXJlX18oMzEpOwp2YXIgX3ByZWRpY3Rvcl9zdHJlYW0gPSBfX3dfcGRmanNfcmVxdWlyZV9fKDMyKTsKdmFyIF9ydW5fbGVuZ3RoX3N0cmVhbSA9IF9fd19wZGZqc19yZXF1aXJlX18oMzMpOwpjb25zdCBNQVhfTEVOR1RIX1RPX0NBQ0hFID0gMTAwMDsKZnVuY3Rpb24gZ2V0SW5saW5lSW1hZ2VDYWNoZUtleShieXRlcykgewogIGNvbnN0IHN0ckJ1ZiA9IFtdLAogICAgaWkgPSBieXRlcy5sZW5ndGg7CiAgbGV0IGkgPSAwOwogIHdoaWxlIChpIDwgaWkgLSAxKSB7CiAgICBzdHJCdWYucHVzaChieXRlc1tpKytdIDw8IDggfCBieXRlc1tpKytdKTsKICB9CiAgaWYgKGkgPCBpaSkgewogICAgc3RyQnVmLnB1c2goYnl0ZXNbaV0pOwogIH0KICByZXR1cm4gaWkgKyAiXyIgKyBTdHJpbmcuZnJvbUNoYXJDb2RlLmFwcGx5KG51bGwsIHN0ckJ1Zik7Cn0KY2xhc3MgUGFyc2VyIHsKICBjb25zdHJ1Y3Rvcih7CiAgICBsZXhlciwKICAgIHhyZWYsCiAgICBhbGxvd1N0cmVhbXMgPSBmYWxzZSwKICAgIHJlY292ZXJ5TW9kZSA9IGZhbHNlCiAgfSkgewogICAgdGhpcy5sZXhlciA9IGxleGVyOwogICAgdGhpcy54cmVmID0geHJlZjsKICAgIHRoaXMuYWxsb3dTdHJlYW1zID0gYWxsb3dTdHJlYW1zOwogICAgdGhpcy5yZWNvdmVyeU1vZGUgPSByZWNvdmVyeU1vZGU7CiAgICB0aGlzLmltYWdlQ2FjaGUgPSBPYmplY3QuY3JlYXRlKG51bGwpOwogICAgdGhpcy5faW1hZ2VJZCA9IDA7CiAgICB0aGlzLnJlZmlsbCgpOwogIH0KICByZWZpbGwoKSB7CiAgICB0aGlzLmJ1ZjEgPSB0aGlzLmxleGVyLmdldE9iaigpOwogICAgdGhpcy5idWYyID0gdGhpcy5sZXhlci5nZXRPYmooKTsKICB9CiAgc2hpZnQoKSB7CiAgICBpZiAodGhpcy5idWYyIGluc3RhbmNlb2YgX3ByaW1pdGl2ZXMuQ21kICYmIHRoaXMuYnVmMi5jbWQgPT09ICJJRCIpIHsKICAgICAgdGhpcy5idWYxID0gdGhpcy5idWYyOwogICAgICB0aGlzLmJ1ZjIgPSBudWxsOwogICAgfSBlbHNlIHsKICAgICAgdGhpcy5idWYxID0gdGhpcy5idWYyOwogICAgICB0aGlzLmJ1ZjIgPSB0aGlzLmxleGVyLmdldE9iaigpOwogICAgfQogIH0KICB0cnlTaGlmdCgpIHsKICAgIHRyeSB7CiAgICAgIHRoaXMuc2hpZnQoKTsKICAgICAgcmV0dXJuIHRydWU7CiAgICB9IGNhdGNoIChlKSB7CiAgICAgIGlmIChlIGluc3RhbmNlb2YgX2NvcmVfdXRpbHMuTWlzc2luZ0RhdGFFeGNlcHRpb24pIHsKICAgICAgICB0aHJvdyBlOwogICAgICB9CiAgICAgIHJldHVybiBmYWxzZTsKICAgIH0KICB9CiAgZ2V0T2JqKGNpcGhlclRyYW5zZm9ybSA9IG51bGwpIHsKICAgIGNvbnN0IGJ1ZjEgPSB0aGlzLmJ1ZjE7CiAgICB0aGlzLnNoaWZ0KCk7CiAgICBpZiAoYnVmMSBpbnN0YW5jZW9mIF9wcmltaXRpdmVzLkNtZCkgewogICAgICBzd2l0Y2ggKGJ1ZjEuY21kKSB7CiAgICAgICAgY2FzZSAiQkkiOgogICAgICAgICAgcmV0dXJuIHRoaXMubWFrZUlubGluZUltYWdlKGNpcGhlclRyYW5zZm9ybSk7CiAgICAgICAgY2FzZSAiWyI6CiAgICAgICAgICBjb25zdCBhcnJheSA9IFtdOwogICAgICAgICAgd2hpbGUgKCEoMCwgX3ByaW1pdGl2ZXMuaXNDbWQpKHRoaXMuYnVmMSwgIl0iKSAmJiB0aGlzLmJ1ZjEgIT09IF9wcmltaXRpdmVzLkVPRikgewogICAgICAgICAgICBhcnJheS5wdXNoKHRoaXMuZ2V0T2JqKGNpcGhlclRyYW5zZm9ybSkpOwogICAgICAgICAgfQogICAgICAgICAgaWYgKHRoaXMuYnVmMSA9PT0gX3ByaW1pdGl2ZXMuRU9GKSB7CiAgICAgICAgICAgIGlmICh0aGlzLnJlY292ZXJ5TW9kZSkgewogICAgICAgICAgICAgIHJldHVybiBhcnJheTsKICAgICAgICAgICAgfQogICAgICAgICAgICB0aHJvdyBuZXcgX2NvcmVfdXRpbHMuUGFyc2VyRU9GRXhjZXB0aW9uKCJFbmQgb2YgZmlsZSBpbnNpZGUgYXJyYXkuIik7CiAgICAgICAgICB9CiAgICAgICAgICB0aGlzLnNoaWZ0KCk7CiAgICAgICAgICByZXR1cm4gYXJyYXk7CiAgICAgICAgY2FzZSAiPDwiOgogICAgICAgICAgY29uc3QgZGljdCA9IG5ldyBfcHJpbWl0aXZlcy5EaWN0KHRoaXMueHJlZik7CiAgICAgICAgICB3aGlsZSAoISgwLCBfcHJpbWl0aXZlcy5pc0NtZCkodGhpcy5idWYxLCAiPj4iKSAmJiB0aGlzLmJ1ZjEgIT09IF9wcmltaXRpdmVzLkVPRikgewogICAgICAgICAgICBpZiAoISh0aGlzLmJ1ZjEgaW5zdGFuY2VvZiBfcHJpbWl0aXZlcy5OYW1lKSkgewogICAgICAgICAgICAgICgwLCBfdXRpbC5pbmZvKSgiTWFsZm9ybWVkIGRpY3Rpb25hcnk6IGtleSBtdXN0IGJlIGEgbmFtZSBvYmplY3QiKTsKICAgICAgICAgICAgICB0aGlzLnNoaWZ0KCk7CiAgICAgICAgICAgICAgY29udGludWU7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgY29uc3Qga2V5ID0gdGhpcy5idWYxLm5hbWU7CiAgICAgICAgICAgIHRoaXMuc2hpZnQoKTsKICAgICAgICAgICAgaWYgKHRoaXMuYnVmMSA9PT0gX3ByaW1pdGl2ZXMuRU9GKSB7CiAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgZGljdC5zZXQoa2V5LCB0aGlzLmdldE9iaihjaXBoZXJUcmFuc2Zvcm0pKTsKICAgICAgICAgIH0KICAgICAgICAgIGlmICh0aGlzLmJ1ZjEgPT09IF9wcmltaXRpdmVzLkVPRikgewogICAgICAgICAgICBpZiAodGhpcy5yZWNvdmVyeU1vZGUpIHsKICAgICAgICAgICAgICByZXR1cm4gZGljdDsKICAgICAgICAgICAgfQogICAgICAgICAgICB0aHJvdyBuZXcgX2NvcmVfdXRpbHMuUGFyc2VyRU9GRXhjZXB0aW9uKCJFbmQgb2YgZmlsZSBpbnNpZGUgZGljdGlvbmFyeS4iKTsKICAgICAgICAgIH0KICAgICAgICAgIGlmICgoMCwgX3ByaW1pdGl2ZXMuaXNDbWQpKHRoaXMuYnVmMiwgInN0cmVhbSIpKSB7CiAgICAgICAgICAgIHJldHVybiB0aGlzLmFsbG93U3RyZWFtcyA/IHRoaXMubWFrZVN0cmVhbShkaWN0LCBjaXBoZXJUcmFuc2Zvcm0pIDogZGljdDsKICAgICAgICAgIH0KICAgICAgICAgIHRoaXMuc2hpZnQoKTsKICAgICAgICAgIHJldHVybiBkaWN0OwogICAgICAgIGRlZmF1bHQ6CiAgICAgICAgICByZXR1cm4gYnVmMTsKICAgICAgfQogICAgfQogICAgaWYgKE51bWJlci5pc0ludGVnZXIoYnVmMSkpIHsKICAgICAgaWYgKE51bWJlci5pc0ludGVnZXIodGhpcy5idWYxKSAmJiAoMCwgX3ByaW1pdGl2ZXMuaXNDbWQpKHRoaXMuYnVmMiwgIlIiKSkgewogICAgICAgIGNvbnN0IHJlZiA9IF9wcmltaXRpdmVzLlJlZi5nZXQoYnVmMSwgdGhpcy5idWYxKTsKICAgICAgICB0aGlzLnNoaWZ0KCk7CiAgICAgICAgdGhpcy5zaGlmdCgpOwogICAgICAgIHJldHVybiByZWY7CiAgICAgIH0KICAgICAgcmV0dXJuIGJ1ZjE7CiAgICB9CiAgICBpZiAodHlwZW9mIGJ1ZjEgPT09ICJzdHJpbmciKSB7CiAgICAgIGlmIChjaXBoZXJUcmFuc2Zvcm0pIHsKICAgICAgICByZXR1cm4gY2lwaGVyVHJhbnNmb3JtLmRlY3J5cHRTdHJpbmcoYnVmMSk7CiAgICAgIH0KICAgICAgcmV0dXJuIGJ1ZjE7CiAgICB9CiAgICByZXR1cm4gYnVmMTsKICB9CiAgZmluZERlZmF1bHRJbmxpbmVTdHJlYW1FbmQoc3RyZWFtKSB7CiAgICBjb25zdCBFID0gMHg0NSwKICAgICAgSSA9IDB4NDksCiAgICAgIFNQQUNFID0gMHgyMCwKICAgICAgTEYgPSAweGEsCiAgICAgIENSID0gMHhkLAogICAgICBOVUwgPSAweDA7CiAgICBjb25zdCB7CiAgICAgICAga25vd25Db21tYW5kcwogICAgICB9ID0gdGhpcy5sZXhlciwKICAgICAgc3RhcnRQb3MgPSBzdHJlYW0ucG9zLAogICAgICBuID0gMTU7CiAgICBsZXQgc3RhdGUgPSAwLAogICAgICBjaCwKICAgICAgbWF5YmVFSVBvczsKICAgIHdoaWxlICgoY2ggPSBzdHJlYW0uZ2V0Qnl0ZSgpKSAhPT0gLTEpIHsKICAgICAgaWYgKHN0YXRlID09PSAwKSB7CiAgICAgICAgc3RhdGUgPSBjaCA9PT0gRSA/IDEgOiAwOwogICAgICB9IGVsc2UgaWYgKHN0YXRlID09PSAxKSB7CiAgICAgICAgc3RhdGUgPSBjaCA9PT0gSSA/IDIgOiAwOwogICAgICB9IGVsc2UgewogICAgICAgIGlmIChjaCA9PT0gU1BBQ0UgfHwgY2ggPT09IExGIHx8IGNoID09PSBDUikgewogICAgICAgICAgbWF5YmVFSVBvcyA9IHN0cmVhbS5wb3M7CiAgICAgICAgICBjb25zdCBmb2xsb3dpbmdCeXRlcyA9IHN0cmVhbS5wZWVrQnl0ZXMobik7CiAgICAgICAgICBjb25zdCBpaSA9IGZvbGxvd2luZ0J5dGVzLmxlbmd0aDsKICAgICAgICAgIGlmIChpaSA9PT0gMCkgewogICAgICAgICAgICBicmVhazsKICAgICAgICAgIH0KICAgICAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgaWk7IGkrKykgewogICAgICAgICAgICBjaCA9IGZvbGxvd2luZ0J5dGVzW2ldOwogICAgICAgICAgICBpZiAoY2ggPT09IE5VTCAmJiBmb2xsb3dpbmdCeXRlc1tpICsgMV0gIT09IE5VTCkgewogICAgICAgICAgICAgIGNvbnRpbnVlOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGlmIChjaCAhPT0gTEYgJiYgY2ggIT09IENSICYmIChjaCA8IFNQQUNFIHx8IGNoID4gMHg3ZikpIHsKICAgICAgICAgICAgICBzdGF0ZSA9IDA7CiAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICAgIGlmIChzdGF0ZSAhPT0gMikgewogICAgICAgICAgICBjb250aW51ZTsKICAgICAgICAgIH0KICAgICAgICAgIGlmICgha25vd25Db21tYW5kcykgewogICAgICAgICAgICAoMCwgX3V0aWwud2FybikoImZpbmREZWZhdWx0SW5saW5lU3RyZWFtRW5kIC0gYGxleGVyLmtub3duQ29tbWFuZHNgIGlzIHVuZGVmaW5lZC4iKTsKICAgICAgICAgICAgY29udGludWU7CiAgICAgICAgICB9CiAgICAgICAgICBjb25zdCB0bXBMZXhlciA9IG5ldyBMZXhlcihuZXcgX3N0cmVhbS5TdHJlYW0oZm9sbG93aW5nQnl0ZXMuc2xpY2UoKSksIGtub3duQ29tbWFuZHMpOwogICAgICAgICAgdG1wTGV4ZXIuX2hleFN0cmluZ1dhcm4gPSAoKSA9PiB7fTsKICAgICAgICAgIGxldCBudW1BcmdzID0gMDsKICAgICAgICAgIHdoaWxlICh0cnVlKSB7CiAgICAgICAgICAgIGNvbnN0IG5leHRPYmogPSB0bXBMZXhlci5nZXRPYmooKTsKICAgICAgICAgICAgaWYgKG5leHRPYmogPT09IF9wcmltaXRpdmVzLkVPRikgewogICAgICAgICAgICAgIHN0YXRlID0gMDsKICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgfQogICAgICAgICAgICBpZiAobmV4dE9iaiBpbnN0YW5jZW9mIF9wcmltaXRpdmVzLkNtZCkgewogICAgICAgICAgICAgIGNvbnN0IGtub3duQ29tbWFuZCA9IGtub3duQ29tbWFuZHNbbmV4dE9iai5jbWRdOwogICAgICAgICAgICAgIGlmICgha25vd25Db21tYW5kKSB7CiAgICAgICAgICAgICAgICBzdGF0ZSA9IDA7CiAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICB9IGVsc2UgaWYgKGtub3duQ29tbWFuZC52YXJpYWJsZUFyZ3MgPyBudW1BcmdzIDw9IGtub3duQ29tbWFuZC5udW1BcmdzIDogbnVtQXJncyA9PT0ga25vd25Db21tYW5kLm51bUFyZ3MpIHsKICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgICBudW1BcmdzID0gMDsKICAgICAgICAgICAgICBjb250aW51ZTsKICAgICAgICAgICAgfQogICAgICAgICAgICBudW1BcmdzKys7CiAgICAgICAgICB9CiAgICAgICAgICBpZiAoc3RhdGUgPT09IDIpIHsKICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICB9CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIHN0YXRlID0gMDsKICAgICAgICB9CiAgICAgIH0KICAgIH0KICAgIGlmIChjaCA9PT0gLTEpIHsKICAgICAgKDAsIF91dGlsLndhcm4pKCJmaW5kRGVmYXVsdElubGluZVN0cmVhbUVuZDogIiArICJSZWFjaGVkIHRoZSBlbmQgb2YgdGhlIHN0cmVhbSB3aXRob3V0IGZpbmRpbmcgYSB2YWxpZCBFSSBtYXJrZXIiKTsKICAgICAgaWYgKG1heWJlRUlQb3MpIHsKICAgICAgICAoMCwgX3V0aWwud2FybikoJy4uLiB0cnlpbmcgdG8gcmVjb3ZlciBieSB1c2luZyB0aGUgbGFzdCAiRUkiIG9jY3VycmVuY2UuJyk7CiAgICAgICAgc3RyZWFtLnNraXAoLShzdHJlYW0ucG9zIC0gbWF5YmVFSVBvcykpOwogICAgICB9CiAgICB9CiAgICBsZXQgZW5kT2Zmc2V0ID0gNDsKICAgIHN0cmVhbS5za2lwKC1lbmRPZmZzZXQpOwogICAgY2ggPSBzdHJlYW0ucGVla0J5dGUoKTsKICAgIHN0cmVhbS5za2lwKGVuZE9mZnNldCk7CiAgICBpZiAoISgwLCBfY29yZV91dGlscy5pc1doaXRlU3BhY2UpKGNoKSkgewogICAgICBlbmRPZmZzZXQtLTsKICAgIH0KICAgIHJldHVybiBzdHJlYW0ucG9zIC0gZW5kT2Zmc2V0IC0gc3RhcnRQb3M7CiAgfQogIGZpbmREQ1REZWNvZGVJbmxpbmVTdHJlYW1FbmQoc3RyZWFtKSB7CiAgICBjb25zdCBzdGFydFBvcyA9IHN0cmVhbS5wb3M7CiAgICBsZXQgZm91bmRFT0kgPSBmYWxzZSwKICAgICAgYiwKICAgICAgbWFya2VyTGVuZ3RoOwogICAgd2hpbGUgKChiID0gc3RyZWFtLmdldEJ5dGUoKSkgIT09IC0xKSB7CiAgICAgIGlmIChiICE9PSAweGZmKSB7CiAgICAgICAgY29udGludWU7CiAgICAgIH0KICAgICAgc3dpdGNoIChzdHJlYW0uZ2V0Qnl0ZSgpKSB7CiAgICAgICAgY2FzZSAweDAwOgogICAgICAgICAgYnJlYWs7CiAgICAgICAgY2FzZSAweGZmOgogICAgICAgICAgc3RyZWFtLnNraXAoLTEpOwogICAgICAgICAgYnJlYWs7CiAgICAgICAgY2FzZSAweGQ5OgogICAgICAgICAgZm91bmRFT0kgPSB0cnVlOwogICAgICAgICAgYnJlYWs7CiAgICAgICAgY2FzZSAweGMwOgogICAgICAgIGNhc2UgMHhjMToKICAgICAgICBjYXNlIDB4YzI6CiAgICAgICAgY2FzZSAweGMzOgogICAgICAgIGNhc2UgMHhjNToKICAgICAgICBjYXNlIDB4YzY6CiAgICAgICAgY2FzZSAweGM3OgogICAgICAgIGNhc2UgMHhjOToKICAgICAgICBjYXNlIDB4Y2E6CiAgICAgICAgY2FzZSAweGNiOgogICAgICAgIGNhc2UgMHhjZDoKICAgICAgICBjYXNlIDB4Y2U6CiAgICAgICAgY2FzZSAweGNmOgogICAgICAgIGNhc2UgMHhjNDoKICAgICAgICBjYXNlIDB4Y2M6CiAgICAgICAgY2FzZSAweGRhOgogICAgICAgIGNhc2UgMHhkYjoKICAgICAgICBjYXNlIDB4ZGM6CiAgICAgICAgY2FzZSAweGRkOgogICAgICAgIGNhc2UgMHhkZToKICAgICAgICBjYXNlIDB4ZGY6CiAgICAgICAgY2FzZSAweGUwOgogICAgICAgIGNhc2UgMHhlMToKICAgICAgICBjYXNlIDB4ZTI6CiAgICAgICAgY2FzZSAweGUzOgogICAgICAgIGNhc2UgMHhlNDoKICAgICAgICBjYXNlIDB4ZTU6CiAgICAgICAgY2FzZSAweGU2OgogICAgICAgIGNhc2UgMHhlNzoKICAgICAgICBjYXNlIDB4ZTg6CiAgICAgICAgY2FzZSAweGU5OgogICAgICAgIGNhc2UgMHhlYToKICAgICAgICBjYXNlIDB4ZWI6CiAgICAgICAgY2FzZSAweGVjOgogICAgICAgIGNhc2UgMHhlZDoKICAgICAgICBjYXNlIDB4ZWU6CiAgICAgICAgY2FzZSAweGVmOgogICAgICAgIGNhc2UgMHhmZToKICAgICAgICAgIG1hcmtlckxlbmd0aCA9IHN0cmVhbS5nZXRVaW50MTYoKTsKICAgICAgICAgIGlmIChtYXJrZXJMZW5ndGggPiAyKSB7CiAgICAgICAgICAgIHN0cmVhbS5za2lwKG1hcmtlckxlbmd0aCAtIDIpOwogICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgc3RyZWFtLnNraXAoLTIpOwogICAgICAgICAgfQogICAgICAgICAgYnJlYWs7CiAgICAgIH0KICAgICAgaWYgKGZvdW5kRU9JKSB7CiAgICAgICAgYnJlYWs7CiAgICAgIH0KICAgIH0KICAgIGNvbnN0IGxlbmd0aCA9IHN0cmVhbS5wb3MgLSBzdGFydFBvczsKICAgIGlmIChiID09PSAtMSkgewogICAgICAoMCwgX3V0aWwud2FybikoIklubGluZSBEQ1REZWNvZGUgaW1hZ2Ugc3RyZWFtOiAiICsgIkVPSSBtYXJrZXIgbm90IGZvdW5kLCBzZWFyY2hpbmcgZm9yIC9FSS8gaW5zdGVhZC4iKTsKICAgICAgc3RyZWFtLnNraXAoLWxlbmd0aCk7CiAgICAgIHJldHVybiB0aGlzLmZpbmREZWZhdWx0SW5saW5lU3RyZWFtRW5kKHN0cmVhbSk7CiAgICB9CiAgICB0aGlzLmlubGluZVN0cmVhbVNraXBFSShzdHJlYW0pOwogICAgcmV0dXJuIGxlbmd0aDsKICB9CiAgZmluZEFTQ0lJODVEZWNvZGVJbmxpbmVTdHJlYW1FbmQoc3RyZWFtKSB7CiAgICBjb25zdCBUSUxERSA9IDB4N2UsCiAgICAgIEdUID0gMHgzZTsKICAgIGNvbnN0IHN0YXJ0UG9zID0gc3RyZWFtLnBvczsKICAgIGxldCBjaDsKICAgIHdoaWxlICgoY2ggPSBzdHJlYW0uZ2V0Qnl0ZSgpKSAhPT0gLTEpIHsKICAgICAgaWYgKGNoID09PSBUSUxERSkgewogICAgICAgIGNvbnN0IHRpbGRlUG9zID0gc3RyZWFtLnBvczsKICAgICAgICBjaCA9IHN0cmVhbS5wZWVrQnl0ZSgpOwogICAgICAgIHdoaWxlICgoMCwgX2NvcmVfdXRpbHMuaXNXaGl0ZVNwYWNlKShjaCkpIHsKICAgICAgICAgIHN0cmVhbS5za2lwKCk7CiAgICAgICAgICBjaCA9IHN0cmVhbS5wZWVrQnl0ZSgpOwogICAgICAgIH0KICAgICAgICBpZiAoY2ggPT09IEdUKSB7CiAgICAgICAgICBzdHJlYW0uc2tpcCgpOwogICAgICAgICAgYnJlYWs7CiAgICAgICAgfQogICAgICAgIGlmIChzdHJlYW0ucG9zID4gdGlsZGVQb3MpIHsKICAgICAgICAgIGNvbnN0IG1heWJlRUkgPSBzdHJlYW0ucGVla0J5dGVzKDIpOwogICAgICAgICAgaWYgKG1heWJlRUlbMF0gPT09IDB4NDUgJiYgbWF5YmVFSVsxXSA9PT0gMHg0OSkgewogICAgICAgICAgICBicmVhazsKICAgICAgICAgIH0KICAgICAgICB9CiAgICAgIH0KICAgIH0KICAgIGNvbnN0IGxlbmd0aCA9IHN0cmVhbS5wb3MgLSBzdGFydFBvczsKICAgIGlmIChjaCA9PT0gLTEpIHsKICAgICAgKDAsIF91dGlsLndhcm4pKCJJbmxpbmUgQVNDSUk4NURlY29kZSBpbWFnZSBzdHJlYW06ICIgKyAiRU9EIG1hcmtlciBub3QgZm91bmQsIHNlYXJjaGluZyBmb3IgL0VJLyBpbnN0ZWFkLiIpOwogICAgICBzdHJlYW0uc2tpcCgtbGVuZ3RoKTsKICAgICAgcmV0dXJuIHRoaXMuZmluZERlZmF1bHRJbmxpbmVTdHJlYW1FbmQoc3RyZWFtKTsKICAgIH0KICAgIHRoaXMuaW5saW5lU3RyZWFtU2tpcEVJKHN0cmVhbSk7CiAgICByZXR1cm4gbGVuZ3RoOwogIH0KICBmaW5kQVNDSUlIZXhEZWNvZGVJbmxpbmVTdHJlYW1FbmQoc3RyZWFtKSB7CiAgICBjb25zdCBHVCA9IDB4M2U7CiAgICBjb25zdCBzdGFydFBvcyA9IHN0cmVhbS5wb3M7CiAgICBsZXQgY2g7CiAgICB3aGlsZSAoKGNoID0gc3RyZWFtLmdldEJ5dGUoKSkgIT09IC0xKSB7CiAgICAgIGlmIChjaCA9PT0gR1QpIHsKICAgICAgICBicmVhazsKICAgICAgfQogICAgfQogICAgY29uc3QgbGVuZ3RoID0gc3RyZWFtLnBvcyAtIHN0YXJ0UG9zOwogICAgaWYgKGNoID09PSAtMSkgewogICAgICAoMCwgX3V0aWwud2FybikoIklubGluZSBBU0NJSUhleERlY29kZSBpbWFnZSBzdHJlYW06ICIgKyAiRU9EIG1hcmtlciBub3QgZm91bmQsIHNlYXJjaGluZyBmb3IgL0VJLyBpbnN0ZWFkLiIpOwogICAgICBzdHJlYW0uc2tpcCgtbGVuZ3RoKTsKICAgICAgcmV0dXJuIHRoaXMuZmluZERlZmF1bHRJbmxpbmVTdHJlYW1FbmQoc3RyZWFtKTsKICAgIH0KICAgIHRoaXMuaW5saW5lU3RyZWFtU2tpcEVJKHN0cmVhbSk7CiAgICByZXR1cm4gbGVuZ3RoOwogIH0KICBpbmxpbmVTdHJlYW1Ta2lwRUkoc3RyZWFtKSB7CiAgICBjb25zdCBFID0gMHg0NSwKICAgICAgSSA9IDB4NDk7CiAgICBsZXQgc3RhdGUgPSAwLAogICAgICBjaDsKICAgIHdoaWxlICgoY2ggPSBzdHJlYW0uZ2V0Qnl0ZSgpKSAhPT0gLTEpIHsKICAgICAgaWYgKHN0YXRlID09PSAwKSB7CiAgICAgICAgc3RhdGUgPSBjaCA9PT0gRSA/IDEgOiAwOwogICAgICB9IGVsc2UgaWYgKHN0YXRlID09PSAxKSB7CiAgICAgICAgc3RhdGUgPSBjaCA9PT0gSSA/IDIgOiAwOwogICAgICB9IGVsc2UgaWYgKHN0YXRlID09PSAyKSB7CiAgICAgICAgYnJlYWs7CiAgICAgIH0KICAgIH0KICB9CiAgbWFrZUlubGluZUltYWdlKGNpcGhlclRyYW5zZm9ybSkgewogICAgY29uc3QgbGV4ZXIgPSB0aGlzLmxleGVyOwogICAgY29uc3Qgc3RyZWFtID0gbGV4ZXIuc3RyZWFtOwogICAgY29uc3QgZGljdE1hcCA9IE9iamVjdC5jcmVhdGUobnVsbCk7CiAgICBsZXQgZGljdExlbmd0aDsKICAgIHdoaWxlICghKDAsIF9wcmltaXRpdmVzLmlzQ21kKSh0aGlzLmJ1ZjEsICJJRCIpICYmIHRoaXMuYnVmMSAhPT0gX3ByaW1pdGl2ZXMuRU9GKSB7CiAgICAgIGlmICghKHRoaXMuYnVmMSBpbnN0YW5jZW9mIF9wcmltaXRpdmVzLk5hbWUpKSB7CiAgICAgICAgdGhyb3cgbmV3IF91dGlsLkZvcm1hdEVycm9yKCJEaWN0aW9uYXJ5IGtleSBtdXN0IGJlIGEgbmFtZSBvYmplY3QiKTsKICAgICAgfQogICAgICBjb25zdCBrZXkgPSB0aGlzLmJ1ZjEubmFtZTsKICAgICAgdGhpcy5zaGlmdCgpOwogICAgICBpZiAodGhpcy5idWYxID09PSBfcHJpbWl0aXZlcy5FT0YpIHsKICAgICAgICBicmVhazsKICAgICAgfQogICAgICBkaWN0TWFwW2tleV0gPSB0aGlzLmdldE9iaihjaXBoZXJUcmFuc2Zvcm0pOwogICAgfQogICAgaWYgKGxleGVyLmJlZ2luSW5saW5lSW1hZ2VQb3MgIT09IC0xKSB7CiAgICAgIGRpY3RMZW5ndGggPSBzdHJlYW0ucG9zIC0gbGV4ZXIuYmVnaW5JbmxpbmVJbWFnZVBvczsKICAgIH0KICAgIGNvbnN0IGZpbHRlciA9IHRoaXMueHJlZi5mZXRjaElmUmVmKGRpY3RNYXAuRiB8fCBkaWN0TWFwLkZpbHRlcik7CiAgICBsZXQgZmlsdGVyTmFtZTsKICAgIGlmIChmaWx0ZXIgaW5zdGFuY2VvZiBfcHJpbWl0aXZlcy5OYW1lKSB7CiAgICAgIGZpbHRlck5hbWUgPSBmaWx0ZXIubmFtZTsKICAgIH0gZWxzZSBpZiAoQXJyYXkuaXNBcnJheShmaWx0ZXIpKSB7CiAgICAgIGNvbnN0IGZpbHRlclplcm8gPSB0aGlzLnhyZWYuZmV0Y2hJZlJlZihmaWx0ZXJbMF0pOwogICAgICBpZiAoZmlsdGVyWmVybyBpbnN0YW5jZW9mIF9wcmltaXRpdmVzLk5hbWUpIHsKICAgICAgICBmaWx0ZXJOYW1lID0gZmlsdGVyWmVyby5uYW1lOwogICAgICB9CiAgICB9CiAgICBjb25zdCBzdGFydFBvcyA9IHN0cmVhbS5wb3M7CiAgICBsZXQgbGVuZ3RoOwogICAgc3dpdGNoIChmaWx0ZXJOYW1lKSB7CiAgICAgIGNhc2UgIkRDVCI6CiAgICAgIGNhc2UgIkRDVERlY29kZSI6CiAgICAgICAgbGVuZ3RoID0gdGhpcy5maW5kRENURGVjb2RlSW5saW5lU3RyZWFtRW5kKHN0cmVhbSk7CiAgICAgICAgYnJlYWs7CiAgICAgIGNhc2UgIkE4NSI6CiAgICAgIGNhc2UgIkFTQ0lJODVEZWNvZGUiOgogICAgICAgIGxlbmd0aCA9IHRoaXMuZmluZEFTQ0lJODVEZWNvZGVJbmxpbmVTdHJlYW1FbmQoc3RyZWFtKTsKICAgICAgICBicmVhazsKICAgICAgY2FzZSAiQUh4IjoKICAgICAgY2FzZSAiQVNDSUlIZXhEZWNvZGUiOgogICAgICAgIGxlbmd0aCA9IHRoaXMuZmluZEFTQ0lJSGV4RGVjb2RlSW5saW5lU3RyZWFtRW5kKHN0cmVhbSk7CiAgICAgICAgYnJlYWs7CiAgICAgIGRlZmF1bHQ6CiAgICAgICAgbGVuZ3RoID0gdGhpcy5maW5kRGVmYXVsdElubGluZVN0cmVhbUVuZChzdHJlYW0pOwogICAgfQogICAgbGV0IGNhY2hlS2V5OwogICAgaWYgKGxlbmd0aCA8IE1BWF9MRU5HVEhfVE9fQ0FDSEUgJiYgZGljdExlbmd0aCA+IDApIHsKICAgICAgY29uc3QgaW5pdGlhbFN0cmVhbVBvcyA9IHN0cmVhbS5wb3M7CiAgICAgIHN0cmVhbS5wb3MgPSBsZXhlci5iZWdpbklubGluZUltYWdlUG9zOwogICAgICBjYWNoZUtleSA9IGdldElubGluZUltYWdlQ2FjaGVLZXkoc3RyZWFtLmdldEJ5dGVzKGRpY3RMZW5ndGggKyBsZW5ndGgpKTsKICAgICAgc3RyZWFtLnBvcyA9IGluaXRpYWxTdHJlYW1Qb3M7CiAgICAgIGNvbnN0IGNhY2hlRW50cnkgPSB0aGlzLmltYWdlQ2FjaGVbY2FjaGVLZXldOwogICAgICBpZiAoY2FjaGVFbnRyeSAhPT0gdW5kZWZpbmVkKSB7CiAgICAgICAgdGhpcy5idWYyID0gX3ByaW1pdGl2ZXMuQ21kLmdldCgiRUkiKTsKICAgICAgICB0aGlzLnNoaWZ0KCk7CiAgICAgICAgY2FjaGVFbnRyeS5yZXNldCgpOwogICAgICAgIHJldHVybiBjYWNoZUVudHJ5OwogICAgICB9CiAgICB9CiAgICBjb25zdCBkaWN0ID0gbmV3IF9wcmltaXRpdmVzLkRpY3QodGhpcy54cmVmKTsKICAgIGZvciAoY29uc3Qga2V5IGluIGRpY3RNYXApIHsKICAgICAgZGljdC5zZXQoa2V5LCBkaWN0TWFwW2tleV0pOwogICAgfQogICAgbGV0IGltYWdlU3RyZWFtID0gc3RyZWFtLm1ha2VTdWJTdHJlYW0oc3RhcnRQb3MsIGxlbmd0aCwgZGljdCk7CiAgICBpZiAoY2lwaGVyVHJhbnNmb3JtKSB7CiAgICAgIGltYWdlU3RyZWFtID0gY2lwaGVyVHJhbnNmb3JtLmNyZWF0ZVN0cmVhbShpbWFnZVN0cmVhbSwgbGVuZ3RoKTsKICAgIH0KICAgIGltYWdlU3RyZWFtID0gdGhpcy5maWx0ZXIoaW1hZ2VTdHJlYW0sIGRpY3QsIGxlbmd0aCk7CiAgICBpbWFnZVN0cmVhbS5kaWN0ID0gZGljdDsKICAgIGlmIChjYWNoZUtleSAhPT0gdW5kZWZpbmVkKSB7CiAgICAgIGltYWdlU3RyZWFtLmNhY2hlS2V5ID0gYGlubGluZV9pbWdfJHsrK3RoaXMuX2ltYWdlSWR9YDsKICAgICAgdGhpcy5pbWFnZUNhY2hlW2NhY2hlS2V5XSA9IGltYWdlU3RyZWFtOwogICAgfQogICAgdGhpcy5idWYyID0gX3ByaW1pdGl2ZXMuQ21kLmdldCgiRUkiKTsKICAgIHRoaXMuc2hpZnQoKTsKICAgIHJldHVybiBpbWFnZVN0cmVhbTsKICB9CiAgX2ZpbmRTdHJlYW1MZW5ndGgoc3RhcnRQb3MsIHNpZ25hdHVyZSkgewogICAgY29uc3QgewogICAgICBzdHJlYW0KICAgIH0gPSB0aGlzLmxleGVyOwogICAgc3RyZWFtLnBvcyA9IHN0YXJ0UG9zOwogICAgY29uc3QgU0NBTl9CTE9DS19MRU5HVEggPSAyMDQ4OwogICAgY29uc3Qgc2lnbmF0dXJlTGVuZ3RoID0gc2lnbmF0dXJlLmxlbmd0aDsKICAgIHdoaWxlIChzdHJlYW0ucG9zIDwgc3RyZWFtLmVuZCkgewogICAgICBjb25zdCBzY2FuQnl0ZXMgPSBzdHJlYW0ucGVla0J5dGVzKFNDQU5fQkxPQ0tfTEVOR1RIKTsKICAgICAgY29uc3Qgc2Nhbkxlbmd0aCA9IHNjYW5CeXRlcy5sZW5ndGggLSBzaWduYXR1cmVMZW5ndGg7CiAgICAgIGlmIChzY2FuTGVuZ3RoIDw9IDApIHsKICAgICAgICBicmVhazsKICAgICAgfQogICAgICBsZXQgcG9zID0gMDsKICAgICAgd2hpbGUgKHBvcyA8IHNjYW5MZW5ndGgpIHsKICAgICAgICBsZXQgaiA9IDA7CiAgICAgICAgd2hpbGUgKGogPCBzaWduYXR1cmVMZW5ndGggJiYgc2NhbkJ5dGVzW3BvcyArIGpdID09PSBzaWduYXR1cmVbal0pIHsKICAgICAgICAgIGorKzsKICAgICAgICB9CiAgICAgICAgaWYgKGogPj0gc2lnbmF0dXJlTGVuZ3RoKSB7CiAgICAgICAgICBzdHJlYW0ucG9zICs9IHBvczsKICAgICAgICAgIHJldHVybiBzdHJlYW0ucG9zIC0gc3RhcnRQb3M7CiAgICAgICAgfQogICAgICAgIHBvcysrOwogICAgICB9CiAgICAgIHN0cmVhbS5wb3MgKz0gc2Nhbkxlbmd0aDsKICAgIH0KICAgIHJldHVybiAtMTsKICB9CiAgbWFrZVN0cmVhbShkaWN0LCBjaXBoZXJUcmFuc2Zvcm0pIHsKICAgIGNvbnN0IGxleGVyID0gdGhpcy5sZXhlcjsKICAgIGxldCBzdHJlYW0gPSBsZXhlci5zdHJlYW07CiAgICBsZXhlci5za2lwVG9OZXh0TGluZSgpOwogICAgY29uc3Qgc3RhcnRQb3MgPSBzdHJlYW0ucG9zIC0gMTsKICAgIGxldCBsZW5ndGggPSBkaWN0LmdldCgiTGVuZ3RoIik7CiAgICBpZiAoIU51bWJlci5pc0ludGVnZXIobGVuZ3RoKSkgewogICAgICAoMCwgX3V0aWwuaW5mbykoYEJhZCBsZW5ndGggIiR7bGVuZ3RoICYmIGxlbmd0aC50b1N0cmluZygpfSIgaW4gc3RyZWFtLmApOwogICAgICBsZW5ndGggPSAwOwogICAgfQogICAgc3RyZWFtLnBvcyA9IHN0YXJ0UG9zICsgbGVuZ3RoOwogICAgbGV4ZXIubmV4dENoYXIoKTsKICAgIGlmICh0aGlzLnRyeVNoaWZ0KCkgJiYgKDAsIF9wcmltaXRpdmVzLmlzQ21kKSh0aGlzLmJ1ZjIsICJlbmRzdHJlYW0iKSkgewogICAgICB0aGlzLnNoaWZ0KCk7CiAgICB9IGVsc2UgewogICAgICBjb25zdCBFTkRTVFJFQU1fU0lHTkFUVVJFID0gbmV3IFVpbnQ4QXJyYXkoWzB4NjUsIDB4NmUsIDB4NjQsIDB4NzMsIDB4NzQsIDB4NzIsIDB4NjUsIDB4NjEsIDB4NmRdKTsKICAgICAgbGV0IGFjdHVhbExlbmd0aCA9IHRoaXMuX2ZpbmRTdHJlYW1MZW5ndGgoc3RhcnRQb3MsIEVORFNUUkVBTV9TSUdOQVRVUkUpOwogICAgICBpZiAoYWN0dWFsTGVuZ3RoIDwgMCkgewogICAgICAgIGNvbnN0IE1BWF9UUlVOQ0FUSU9OID0gMTsKICAgICAgICBmb3IgKGxldCBpID0gMTsgaSA8PSBNQVhfVFJVTkNBVElPTjsgaSsrKSB7CiAgICAgICAgICBjb25zdCBlbmQgPSBFTkRTVFJFQU1fU0lHTkFUVVJFLmxlbmd0aCAtIGk7CiAgICAgICAgICBjb25zdCBUUlVOQ0FURURfU0lHTkFUVVJFID0gRU5EU1RSRUFNX1NJR05BVFVSRS5zbGljZSgwLCBlbmQpOwogICAgICAgICAgY29uc3QgbWF5YmVMZW5ndGggPSB0aGlzLl9maW5kU3RyZWFtTGVuZ3RoKHN0YXJ0UG9zLCBUUlVOQ0FURURfU0lHTkFUVVJFKTsKICAgICAgICAgIGlmIChtYXliZUxlbmd0aCA+PSAwKSB7CiAgICAgICAgICAgIGNvbnN0IGxhc3RCeXRlID0gc3RyZWFtLnBlZWtCeXRlcyhlbmQgKyAxKVtlbmRdOwogICAgICAgICAgICBpZiAoISgwLCBfY29yZV91dGlscy5pc1doaXRlU3BhY2UpKGxhc3RCeXRlKSkgewogICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICB9CiAgICAgICAgICAgICgwLCBfdXRpbC5pbmZvKShgRm91bmQgIiR7KDAsIF91dGlsLmJ5dGVzVG9TdHJpbmcpKFRSVU5DQVRFRF9TSUdOQVRVUkUpfSIgd2hlbiBgICsgInNlYXJjaGluZyBmb3IgZW5kc3RyZWFtIGNvbW1hbmQuIik7CiAgICAgICAgICAgIGFjdHVhbExlbmd0aCA9IG1heWJlTGVuZ3RoOwogICAgICAgICAgICBicmVhazsKICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgaWYgKGFjdHVhbExlbmd0aCA8IDApIHsKICAgICAgICAgIHRocm93IG5ldyBfdXRpbC5Gb3JtYXRFcnJvcigiTWlzc2luZyBlbmRzdHJlYW0gY29tbWFuZC4iKTsKICAgICAgICB9CiAgICAgIH0KICAgICAgbGVuZ3RoID0gYWN0dWFsTGVuZ3RoOwogICAgICBsZXhlci5uZXh0Q2hhcigpOwogICAgICB0aGlzLnNoaWZ0KCk7CiAgICAgIHRoaXMuc2hpZnQoKTsKICAgIH0KICAgIHRoaXMuc2hpZnQoKTsKICAgIHN0cmVhbSA9IHN0cmVhbS5tYWtlU3ViU3RyZWFtKHN0YXJ0UG9zLCBsZW5ndGgsIGRpY3QpOwogICAgaWYgKGNpcGhlclRyYW5zZm9ybSkgewogICAgICBzdHJlYW0gPSBjaXBoZXJUcmFuc2Zvcm0uY3JlYXRlU3RyZWFtKHN0cmVhbSwgbGVuZ3RoKTsKICAgIH0KICAgIHN0cmVhbSA9IHRoaXMuZmlsdGVyKHN0cmVhbSwgZGljdCwgbGVuZ3RoKTsKICAgIHN0cmVhbS5kaWN0ID0gZGljdDsKICAgIHJldHVybiBzdHJlYW07CiAgfQogIGZpbHRlcihzdHJlYW0sIGRpY3QsIGxlbmd0aCkgewogICAgbGV0IGZpbHRlciA9IGRpY3QuZ2V0KCJGIiwgIkZpbHRlciIpOwogICAgbGV0IHBhcmFtcyA9IGRpY3QuZ2V0KCJEUCIsICJEZWNvZGVQYXJtcyIpOwogICAgaWYgKGZpbHRlciBpbnN0YW5jZW9mIF9wcmltaXRpdmVzLk5hbWUpIHsKICAgICAgaWYgKEFycmF5LmlzQXJyYXkocGFyYW1zKSkgewogICAgICAgICgwLCBfdXRpbC53YXJuKSgiL0RlY29kZVBhcm1zIHNob3VsZCBub3QgYmUgYW4gQXJyYXksIHdoZW4gL0ZpbHRlciBpcyBhIE5hbWUuIik7CiAgICAgIH0KICAgICAgcmV0dXJuIHRoaXMubWFrZUZpbHRlcihzdHJlYW0sIGZpbHRlci5uYW1lLCBsZW5ndGgsIHBhcmFtcyk7CiAgICB9CiAgICBsZXQgbWF5YmVMZW5ndGggPSBsZW5ndGg7CiAgICBpZiAoQXJyYXkuaXNBcnJheShmaWx0ZXIpKSB7CiAgICAgIGNvbnN0IGZpbHRlckFycmF5ID0gZmlsdGVyOwogICAgICBjb25zdCBwYXJhbXNBcnJheSA9IHBhcmFtczsKICAgICAgZm9yIChsZXQgaSA9IDAsIGlpID0gZmlsdGVyQXJyYXkubGVuZ3RoOyBpIDwgaWk7ICsraSkgewogICAgICAgIGZpbHRlciA9IHRoaXMueHJlZi5mZXRjaElmUmVmKGZpbHRlckFycmF5W2ldKTsKICAgICAgICBpZiAoIShmaWx0ZXIgaW5zdGFuY2VvZiBfcHJpbWl0aXZlcy5OYW1lKSkgewogICAgICAgICAgdGhyb3cgbmV3IF91dGlsLkZvcm1hdEVycm9yKGBCYWQgZmlsdGVyIG5hbWUgIiR7ZmlsdGVyfSJgKTsKICAgICAgICB9CiAgICAgICAgcGFyYW1zID0gbnVsbDsKICAgICAgICBpZiAoQXJyYXkuaXNBcnJheShwYXJhbXNBcnJheSkgJiYgaSBpbiBwYXJhbXNBcnJheSkgewogICAgICAgICAgcGFyYW1zID0gdGhpcy54cmVmLmZldGNoSWZSZWYocGFyYW1zQXJyYXlbaV0pOwogICAgICAgIH0KICAgICAgICBzdHJlYW0gPSB0aGlzLm1ha2VGaWx0ZXIoc3RyZWFtLCBmaWx0ZXIubmFtZSwgbWF5YmVMZW5ndGgsIHBhcmFtcyk7CiAgICAgICAgbWF5YmVMZW5ndGggPSBudWxsOwogICAgICB9CiAgICB9CiAgICByZXR1cm4gc3RyZWFtOwogIH0KICBtYWtlRmlsdGVyKHN0cmVhbSwgbmFtZSwgbWF5YmVMZW5ndGgsIHBhcmFtcykgewogICAgaWYgKG1heWJlTGVuZ3RoID09PSAwKSB7CiAgICAgICgwLCBfdXRpbC53YXJuKShgRW1wdHkgIiR7bmFtZX0iIHN0cmVhbS5gKTsKICAgICAgcmV0dXJuIG5ldyBfc3RyZWFtLk51bGxTdHJlYW0oKTsKICAgIH0KICAgIHRyeSB7CiAgICAgIHN3aXRjaCAobmFtZSkgewogICAgICAgIGNhc2UgIkZsIjoKICAgICAgICBjYXNlICJGbGF0ZURlY29kZSI6CiAgICAgICAgICBpZiAocGFyYW1zKSB7CiAgICAgICAgICAgIHJldHVybiBuZXcgX3ByZWRpY3Rvcl9zdHJlYW0uUHJlZGljdG9yU3RyZWFtKG5ldyBfZmxhdGVfc3RyZWFtLkZsYXRlU3RyZWFtKHN0cmVhbSwgbWF5YmVMZW5ndGgpLCBtYXliZUxlbmd0aCwgcGFyYW1zKTsKICAgICAgICAgIH0KICAgICAgICAgIHJldHVybiBuZXcgX2ZsYXRlX3N0cmVhbS5GbGF0ZVN0cmVhbShzdHJlYW0sIG1heWJlTGVuZ3RoKTsKICAgICAgICBjYXNlICJMWlciOgogICAgICAgIGNhc2UgIkxaV0RlY29kZSI6CiAgICAgICAgICBsZXQgZWFybHlDaGFuZ2UgPSAxOwogICAgICAgICAgaWYgKHBhcmFtcykgewogICAgICAgICAgICBpZiAocGFyYW1zLmhhcygiRWFybHlDaGFuZ2UiKSkgewogICAgICAgICAgICAgIGVhcmx5Q2hhbmdlID0gcGFyYW1zLmdldCgiRWFybHlDaGFuZ2UiKTsKICAgICAgICAgICAgfQogICAgICAgICAgICByZXR1cm4gbmV3IF9wcmVkaWN0b3Jfc3RyZWFtLlByZWRpY3RvclN0cmVhbShuZXcgX2x6d19zdHJlYW0uTFpXU3RyZWFtKHN0cmVhbSwgbWF5YmVMZW5ndGgsIGVhcmx5Q2hhbmdlKSwgbWF5YmVMZW5ndGgsIHBhcmFtcyk7CiAgICAgICAgICB9CiAgICAgICAgICByZXR1cm4gbmV3IF9sendfc3RyZWFtLkxaV1N0cmVhbShzdHJlYW0sIG1heWJlTGVuZ3RoLCBlYXJseUNoYW5nZSk7CiAgICAgICAgY2FzZSAiRENUIjoKICAgICAgICBjYXNlICJEQ1REZWNvZGUiOgogICAgICAgICAgcmV0dXJuIG5ldyBfanBlZ19zdHJlYW0uSnBlZ1N0cmVhbShzdHJlYW0sIG1heWJlTGVuZ3RoLCBwYXJhbXMpOwogICAgICAgIGNhc2UgIkpQWCI6CiAgICAgICAgY2FzZSAiSlBYRGVjb2RlIjoKICAgICAgICAgIHJldHVybiBuZXcgX2pweF9zdHJlYW0uSnB4U3RyZWFtKHN0cmVhbSwgbWF5YmVMZW5ndGgsIHBhcmFtcyk7CiAgICAgICAgY2FzZSAiQTg1IjoKICAgICAgICBjYXNlICJBU0NJSTg1RGVjb2RlIjoKICAgICAgICAgIHJldHVybiBuZXcgX2FzY2lpXzg1X3N0cmVhbS5Bc2NpaTg1U3RyZWFtKHN0cmVhbSwgbWF5YmVMZW5ndGgpOwogICAgICAgIGNhc2UgIkFIeCI6CiAgICAgICAgY2FzZSAiQVNDSUlIZXhEZWNvZGUiOgogICAgICAgICAgcmV0dXJuIG5ldyBfYXNjaWlfaGV4X3N0cmVhbS5Bc2NpaUhleFN0cmVhbShzdHJlYW0sIG1heWJlTGVuZ3RoKTsKICAgICAgICBjYXNlICJDQ0YiOgogICAgICAgIGNhc2UgIkNDSVRURmF4RGVjb2RlIjoKICAgICAgICAgIHJldHVybiBuZXcgX2NjaXR0X3N0cmVhbS5DQ0lUVEZheFN0cmVhbShzdHJlYW0sIG1heWJlTGVuZ3RoLCBwYXJhbXMpOwogICAgICAgIGNhc2UgIlJMIjoKICAgICAgICBjYXNlICJSdW5MZW5ndGhEZWNvZGUiOgogICAgICAgICAgcmV0dXJuIG5ldyBfcnVuX2xlbmd0aF9zdHJlYW0uUnVuTGVuZ3RoU3RyZWFtKHN0cmVhbSwgbWF5YmVMZW5ndGgpOwogICAgICAgIGNhc2UgIkpCSUcyRGVjb2RlIjoKICAgICAgICAgIHJldHVybiBuZXcgX2piaWcyX3N0cmVhbS5KYmlnMlN0cmVhbShzdHJlYW0sIG1heWJlTGVuZ3RoLCBwYXJhbXMpOwogICAgICB9CiAgICAgICgwLCBfdXRpbC53YXJuKShgRmlsdGVyICIke25hbWV9IiBpcyBub3Qgc3VwcG9ydGVkLmApOwogICAgICByZXR1cm4gc3RyZWFtOwogICAgfSBjYXRjaCAoZXgpIHsKICAgICAgaWYgKGV4IGluc3RhbmNlb2YgX2NvcmVfdXRpbHMuTWlzc2luZ0RhdGFFeGNlcHRpb24pIHsKICAgICAgICB0aHJvdyBleDsKICAgICAgfQogICAgICAoMCwgX3V0aWwud2FybikoYEludmFsaWQgc3RyZWFtOiAiJHtleH0iYCk7CiAgICAgIHJldHVybiBuZXcgX3N0cmVhbS5OdWxsU3RyZWFtKCk7CiAgICB9CiAgfQp9CmV4cG9ydHMuUGFyc2VyID0gUGFyc2VyOwpjb25zdCBzcGVjaWFsQ2hhcnMgPSBbMSwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMSwgMSwgMCwgMSwgMSwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMSwgMCwgMCwgMCwgMCwgMiwgMCwgMCwgMiwgMiwgMCwgMCwgMCwgMCwgMCwgMiwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMiwgMCwgMiwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMiwgMCwgMiwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMiwgMCwgMiwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMF07CmZ1bmN0aW9uIHRvSGV4RGlnaXQoY2gpIHsKICBpZiAoY2ggPj0gMHgzMCAmJiBjaCA8PSAweDM5KSB7CiAgICByZXR1cm4gY2ggJiAweDBmOwogIH0KICBpZiAoY2ggPj0gMHg0MSAmJiBjaCA8PSAweDQ2IHx8IGNoID49IDB4NjEgJiYgY2ggPD0gMHg2NikgewogICAgcmV0dXJuIChjaCAmIDB4MGYpICsgOTsKICB9CiAgcmV0dXJuIC0xOwp9CmNsYXNzIExleGVyIHsKICBjb25zdHJ1Y3RvcihzdHJlYW0sIGtub3duQ29tbWFuZHMgPSBudWxsKSB7CiAgICB0aGlzLnN0cmVhbSA9IHN0cmVhbTsKICAgIHRoaXMubmV4dENoYXIoKTsKICAgIHRoaXMuc3RyQnVmID0gW107CiAgICB0aGlzLmtub3duQ29tbWFuZHMgPSBrbm93bkNvbW1hbmRzOwogICAgdGhpcy5faGV4U3RyaW5nTnVtV2FybiA9IDA7CiAgICB0aGlzLmJlZ2luSW5saW5lSW1hZ2VQb3MgPSAtMTsKICB9CiAgbmV4dENoYXIoKSB7CiAgICByZXR1cm4gdGhpcy5jdXJyZW50Q2hhciA9IHRoaXMuc3RyZWFtLmdldEJ5dGUoKTsKICB9CiAgcGVla0NoYXIoKSB7CiAgICByZXR1cm4gdGhpcy5zdHJlYW0ucGVla0J5dGUoKTsKICB9CiAgZ2V0TnVtYmVyKCkgewogICAgbGV0IGNoID0gdGhpcy5jdXJyZW50Q2hhcjsKICAgIGxldCBlTm90YXRpb24gPSBmYWxzZTsKICAgIGxldCBkaXZpZGVCeSA9IDA7CiAgICBsZXQgc2lnbiA9IDE7CiAgICBpZiAoY2ggPT09IDB4MmQpIHsKICAgICAgc2lnbiA9IC0xOwogICAgICBjaCA9IHRoaXMubmV4dENoYXIoKTsKICAgICAgaWYgKGNoID09PSAweDJkKSB7CiAgICAgICAgY2ggPSB0aGlzLm5leHRDaGFyKCk7CiAgICAgIH0KICAgIH0gZWxzZSBpZiAoY2ggPT09IDB4MmIpIHsKICAgICAgY2ggPSB0aGlzLm5leHRDaGFyKCk7CiAgICB9CiAgICBpZiAoY2ggPT09IDB4MGEgfHwgY2ggPT09IDB4MGQpIHsKICAgICAgZG8gewogICAgICAgIGNoID0gdGhpcy5uZXh0Q2hhcigpOwogICAgICB9IHdoaWxlIChjaCA9PT0gMHgwYSB8fCBjaCA9PT0gMHgwZCk7CiAgICB9CiAgICBpZiAoY2ggPT09IDB4MmUpIHsKICAgICAgZGl2aWRlQnkgPSAxMDsKICAgICAgY2ggPSB0aGlzLm5leHRDaGFyKCk7CiAgICB9CiAgICBpZiAoY2ggPCAweDMwIHx8IGNoID4gMHgzOSkgewogICAgICBjb25zdCBtc2cgPSBgSW52YWxpZCBudW1iZXI6ICR7U3RyaW5nLmZyb21DaGFyQ29kZShjaCl9IChjaGFyQ29kZSAke2NofSlgOwogICAgICBpZiAoKDAsIF9jb3JlX3V0aWxzLmlzV2hpdGVTcGFjZSkoY2gpIHx8IGNoID09PSAtMSkgewogICAgICAgICgwLCBfdXRpbC5pbmZvKShgTGV4ZXIuZ2V0TnVtYmVyIC0gIiR7bXNnfSIuYCk7CiAgICAgICAgcmV0dXJuIDA7CiAgICAgIH0KICAgICAgdGhyb3cgbmV3IF91dGlsLkZvcm1hdEVycm9yKG1zZyk7CiAgICB9CiAgICBsZXQgYmFzZVZhbHVlID0gY2ggLSAweDMwOwogICAgbGV0IHBvd2VyVmFsdWUgPSAwOwogICAgbGV0IHBvd2VyVmFsdWVTaWduID0gMTsKICAgIHdoaWxlICgoY2ggPSB0aGlzLm5leHRDaGFyKCkpID49IDApIHsKICAgICAgaWYgKGNoID49IDB4MzAgJiYgY2ggPD0gMHgzOSkgewogICAgICAgIGNvbnN0IGN1cnJlbnREaWdpdCA9IGNoIC0gMHgzMDsKICAgICAgICBpZiAoZU5vdGF0aW9uKSB7CiAgICAgICAgICBwb3dlclZhbHVlID0gcG93ZXJWYWx1ZSAqIDEwICsgY3VycmVudERpZ2l0OwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICBpZiAoZGl2aWRlQnkgIT09IDApIHsKICAgICAgICAgICAgZGl2aWRlQnkgKj0gMTA7CiAgICAgICAgICB9CiAgICAgICAgICBiYXNlVmFsdWUgPSBiYXNlVmFsdWUgKiAxMCArIGN1cnJlbnREaWdpdDsKICAgICAgICB9CiAgICAgIH0gZWxzZSBpZiAoY2ggPT09IDB4MmUpIHsKICAgICAgICBpZiAoZGl2aWRlQnkgPT09IDApIHsKICAgICAgICAgIGRpdmlkZUJ5ID0gMTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgYnJlYWs7CiAgICAgICAgfQogICAgICB9IGVsc2UgaWYgKGNoID09PSAweDJkKSB7CiAgICAgICAgKDAsIF91dGlsLndhcm4pKCJCYWRseSBmb3JtYXR0ZWQgbnVtYmVyOiBtaW51cyBzaWduIGluIHRoZSBtaWRkbGUiKTsKICAgICAgfSBlbHNlIGlmIChjaCA9PT0gMHg0NSB8fCBjaCA9PT0gMHg2NSkgewogICAgICAgIGNoID0gdGhpcy5wZWVrQ2hhcigpOwogICAgICAgIGlmIChjaCA9PT0gMHgyYiB8fCBjaCA9PT0gMHgyZCkgewogICAgICAgICAgcG93ZXJWYWx1ZVNpZ24gPSBjaCA9PT0gMHgyZCA/IC0xIDogMTsKICAgICAgICAgIHRoaXMubmV4dENoYXIoKTsKICAgICAgICB9IGVsc2UgaWYgKGNoIDwgMHgzMCB8fCBjaCA+IDB4MzkpIHsKICAgICAgICAgIGJyZWFrOwogICAgICAgIH0KICAgICAgICBlTm90YXRpb24gPSB0cnVlOwogICAgICB9IGVsc2UgewogICAgICAgIGJyZWFrOwogICAgICB9CiAgICB9CiAgICBpZiAoZGl2aWRlQnkgIT09IDApIHsKICAgICAgYmFzZVZhbHVlIC89IGRpdmlkZUJ5OwogICAgfQogICAgaWYgKGVOb3RhdGlvbikgewogICAgICBiYXNlVmFsdWUgKj0gMTAgKiogKHBvd2VyVmFsdWVTaWduICogcG93ZXJWYWx1ZSk7CiAgICB9CiAgICByZXR1cm4gc2lnbiAqIGJhc2VWYWx1ZTsKICB9CiAgZ2V0U3RyaW5nKCkgewogICAgbGV0IG51bVBhcmVuID0gMTsKICAgIGxldCBkb25lID0gZmFsc2U7CiAgICBjb25zdCBzdHJCdWYgPSB0aGlzLnN0ckJ1ZjsKICAgIHN0ckJ1Zi5sZW5ndGggPSAwOwogICAgbGV0IGNoID0gdGhpcy5uZXh0Q2hhcigpOwogICAgd2hpbGUgKHRydWUpIHsKICAgICAgbGV0IGNoYXJCdWZmZXJlZCA9IGZhbHNlOwogICAgICBzd2l0Y2ggKGNoIHwgMCkgewogICAgICAgIGNhc2UgLTE6CiAgICAgICAgICAoMCwgX3V0aWwud2FybikoIlVudGVybWluYXRlZCBzdHJpbmciKTsKICAgICAgICAgIGRvbmUgPSB0cnVlOwogICAgICAgICAgYnJlYWs7CiAgICAgICAgY2FzZSAweDI4OgogICAgICAgICAgKytudW1QYXJlbjsKICAgICAgICAgIHN0ckJ1Zi5wdXNoKCIoIik7CiAgICAgICAgICBicmVhazsKICAgICAgICBjYXNlIDB4Mjk6CiAgICAgICAgICBpZiAoLS1udW1QYXJlbiA9PT0gMCkgewogICAgICAgICAgICB0aGlzLm5leHRDaGFyKCk7CiAgICAgICAgICAgIGRvbmUgPSB0cnVlOwogICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgc3RyQnVmLnB1c2goIikiKTsKICAgICAgICAgIH0KICAgICAgICAgIGJyZWFrOwogICAgICAgIGNhc2UgMHg1YzoKICAgICAgICAgIGNoID0gdGhpcy5uZXh0Q2hhcigpOwogICAgICAgICAgc3dpdGNoIChjaCkgewogICAgICAgICAgICBjYXNlIC0xOgogICAgICAgICAgICAgICgwLCBfdXRpbC53YXJuKSgiVW50ZXJtaW5hdGVkIHN0cmluZyIpOwogICAgICAgICAgICAgIGRvbmUgPSB0cnVlOwogICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICBjYXNlIDB4NmU6CiAgICAgICAgICAgICAgc3RyQnVmLnB1c2goIlxuIik7CiAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgIGNhc2UgMHg3MjoKICAgICAgICAgICAgICBzdHJCdWYucHVzaCgiXHIiKTsKICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgY2FzZSAweDc0OgogICAgICAgICAgICAgIHN0ckJ1Zi5wdXNoKCJcdCIpOwogICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICBjYXNlIDB4NjI6CiAgICAgICAgICAgICAgc3RyQnVmLnB1c2goIlxiIik7CiAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgIGNhc2UgMHg2NjoKICAgICAgICAgICAgICBzdHJCdWYucHVzaCgiXGYiKTsKICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgY2FzZSAweDVjOgogICAgICAgICAgICBjYXNlIDB4Mjg6CiAgICAgICAgICAgIGNhc2UgMHgyOToKICAgICAgICAgICAgICBzdHJCdWYucHVzaChTdHJpbmcuZnJvbUNoYXJDb2RlKGNoKSk7CiAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgIGNhc2UgMHgzMDoKICAgICAgICAgICAgY2FzZSAweDMxOgogICAgICAgICAgICBjYXNlIDB4MzI6CiAgICAgICAgICAgIGNhc2UgMHgzMzoKICAgICAgICAgICAgY2FzZSAweDM0OgogICAgICAgICAgICBjYXNlIDB4MzU6CiAgICAgICAgICAgIGNhc2UgMHgzNjoKICAgICAgICAgICAgY2FzZSAweDM3OgogICAgICAgICAgICAgIGxldCB4ID0gY2ggJiAweDBmOwogICAgICAgICAgICAgIGNoID0gdGhpcy5uZXh0Q2hhcigpOwogICAgICAgICAgICAgIGNoYXJCdWZmZXJlZCA9IHRydWU7CiAgICAgICAgICAgICAgaWYgKGNoID49IDB4MzAgJiYgY2ggPD0gMHgzNykgewogICAgICAgICAgICAgICAgeCA9ICh4IDw8IDMpICsgKGNoICYgMHgwZik7CiAgICAgICAgICAgICAgICBjaCA9IHRoaXMubmV4dENoYXIoKTsKICAgICAgICAgICAgICAgIGlmIChjaCA+PSAweDMwICYmIGNoIDw9IDB4MzcpIHsKICAgICAgICAgICAgICAgICAgY2hhckJ1ZmZlcmVkID0gZmFsc2U7CiAgICAgICAgICAgICAgICAgIHggPSAoeCA8PCAzKSArIChjaCAmIDB4MGYpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIH0KICAgICAgICAgICAgICBzdHJCdWYucHVzaChTdHJpbmcuZnJvbUNoYXJDb2RlKHgpKTsKICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgY2FzZSAweDBkOgogICAgICAgICAgICAgIGlmICh0aGlzLnBlZWtDaGFyKCkgPT09IDB4MGEpIHsKICAgICAgICAgICAgICAgIHRoaXMubmV4dENoYXIoKTsKICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgIGNhc2UgMHgwYToKICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgZGVmYXVsdDoKICAgICAgICAgICAgICBzdHJCdWYucHVzaChTdHJpbmcuZnJvbUNoYXJDb2RlKGNoKSk7CiAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICB9CiAgICAgICAgICBicmVhazsKICAgICAgICBkZWZhdWx0OgogICAgICAgICAgc3RyQnVmLnB1c2goU3RyaW5nLmZyb21DaGFyQ29kZShjaCkpOwogICAgICAgICAgYnJlYWs7CiAgICAgIH0KICAgICAgaWYgKGRvbmUpIHsKICAgICAgICBicmVhazsKICAgICAgfQogICAgICBpZiAoIWNoYXJCdWZmZXJlZCkgewogICAgICAgIGNoID0gdGhpcy5uZXh0Q2hhcigpOwogICAgICB9CiAgICB9CiAgICByZXR1cm4gc3RyQnVmLmpvaW4oIiIpOwogIH0KICBnZXROYW1lKCkgewogICAgbGV0IGNoLCBwcmV2aW91c0NoOwogICAgY29uc3Qgc3RyQnVmID0gdGhpcy5zdHJCdWY7CiAgICBzdHJCdWYubGVuZ3RoID0gMDsKICAgIHdoaWxlICgoY2ggPSB0aGlzLm5leHRDaGFyKCkpID49IDAgJiYgIXNwZWNpYWxDaGFyc1tjaF0pIHsKICAgICAgaWYgKGNoID09PSAweDIzKSB7CiAgICAgICAgY2ggPSB0aGlzLm5leHRDaGFyKCk7CiAgICAgICAgaWYgKHNwZWNpYWxDaGFyc1tjaF0pIHsKICAgICAgICAgICgwLCBfdXRpbC53YXJuKSgiTGV4ZXJfZ2V0TmFtZTogIiArICJOVU1CRVIgU0lHTiAoIykgc2hvdWxkIGJlIGZvbGxvd2VkIGJ5IGEgaGV4YWRlY2ltYWwgbnVtYmVyLiIpOwogICAgICAgICAgc3RyQnVmLnB1c2goIiMiKTsKICAgICAgICAgIGJyZWFrOwogICAgICAgIH0KICAgICAgICBjb25zdCB4ID0gdG9IZXhEaWdpdChjaCk7CiAgICAgICAgaWYgKHggIT09IC0xKSB7CiAgICAgICAgICBwcmV2aW91c0NoID0gY2g7CiAgICAgICAgICBjaCA9IHRoaXMubmV4dENoYXIoKTsKICAgICAgICAgIGNvbnN0IHgyID0gdG9IZXhEaWdpdChjaCk7CiAgICAgICAgICBpZiAoeDIgPT09IC0xKSB7CiAgICAgICAgICAgICgwLCBfdXRpbC53YXJuKShgTGV4ZXJfZ2V0TmFtZTogSWxsZWdhbCBkaWdpdCAoJHtTdHJpbmcuZnJvbUNoYXJDb2RlKGNoKX0pIGAgKyAiaW4gaGV4YWRlY2ltYWwgbnVtYmVyLiIpOwogICAgICAgICAgICBzdHJCdWYucHVzaCgiIyIsIFN0cmluZy5mcm9tQ2hhckNvZGUocHJldmlvdXNDaCkpOwogICAgICAgICAgICBpZiAoc3BlY2lhbENoYXJzW2NoXSkgewogICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICB9CiAgICAgICAgICAgIHN0ckJ1Zi5wdXNoKFN0cmluZy5mcm9tQ2hhckNvZGUoY2gpKTsKICAgICAgICAgICAgY29udGludWU7CiAgICAgICAgICB9CiAgICAgICAgICBzdHJCdWYucHVzaChTdHJpbmcuZnJvbUNoYXJDb2RlKHggPDwgNCB8IHgyKSk7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIHN0ckJ1Zi5wdXNoKCIjIiwgU3RyaW5nLmZyb21DaGFyQ29kZShjaCkpOwogICAgICAgIH0KICAgICAgfSBlbHNlIHsKICAgICAgICBzdHJCdWYucHVzaChTdHJpbmcuZnJvbUNoYXJDb2RlKGNoKSk7CiAgICAgIH0KICAgIH0KICAgIGlmIChzdHJCdWYubGVuZ3RoID4gMTI3KSB7CiAgICAgICgwLCBfdXRpbC53YXJuKShgTmFtZSB0b2tlbiBpcyBsb25nZXIgdGhhbiBhbGxvd2VkIGJ5IHRoZSBzcGVjOiAke3N0ckJ1Zi5sZW5ndGh9YCk7CiAgICB9CiAgICByZXR1cm4gX3ByaW1pdGl2ZXMuTmFtZS5nZXQoc3RyQnVmLmpvaW4oIiIpKTsKICB9CiAgX2hleFN0cmluZ1dhcm4oY2gpIHsKICAgIGNvbnN0IE1BWF9IRVhfU1RSSU5HX05VTV9XQVJOID0gNTsKICAgIGlmICh0aGlzLl9oZXhTdHJpbmdOdW1XYXJuKysgPT09IE1BWF9IRVhfU1RSSU5HX05VTV9XQVJOKSB7CiAgICAgICgwLCBfdXRpbC53YXJuKSgiZ2V0SGV4U3RyaW5nIC0gaWdub3JpbmcgYWRkaXRpb25hbCBpbnZhbGlkIGNoYXJhY3RlcnMuIik7CiAgICAgIHJldHVybjsKICAgIH0KICAgIGlmICh0aGlzLl9oZXhTdHJpbmdOdW1XYXJuID4gTUFYX0hFWF9TVFJJTkdfTlVNX1dBUk4pIHsKICAgICAgcmV0dXJuOwogICAgfQogICAgKDAsIF91dGlsLndhcm4pKGBnZXRIZXhTdHJpbmcgLSBpZ25vcmluZyBpbnZhbGlkIGNoYXJhY3RlcjogJHtjaH1gKTsKICB9CiAgZ2V0SGV4U3RyaW5nKCkgewogICAgY29uc3Qgc3RyQnVmID0gdGhpcy5zdHJCdWY7CiAgICBzdHJCdWYubGVuZ3RoID0gMDsKICAgIGxldCBjaCA9IHRoaXMuY3VycmVudENoYXI7CiAgICBsZXQgaXNGaXJzdEhleCA9IHRydWU7CiAgICBsZXQgZmlyc3REaWdpdCwgc2Vjb25kRGlnaXQ7CiAgICB0aGlzLl9oZXhTdHJpbmdOdW1XYXJuID0gMDsKICAgIHdoaWxlICh0cnVlKSB7CiAgICAgIGlmIChjaCA8IDApIHsKICAgICAgICAoMCwgX3V0aWwud2FybikoIlVudGVybWluYXRlZCBoZXggc3RyaW5nIik7CiAgICAgICAgYnJlYWs7CiAgICAgIH0gZWxzZSBpZiAoY2ggPT09IDB4M2UpIHsKICAgICAgICB0aGlzLm5leHRDaGFyKCk7CiAgICAgICAgYnJlYWs7CiAgICAgIH0gZWxzZSBpZiAoc3BlY2lhbENoYXJzW2NoXSA9PT0gMSkgewogICAgICAgIGNoID0gdGhpcy5uZXh0Q2hhcigpOwogICAgICAgIGNvbnRpbnVlOwogICAgICB9IGVsc2UgewogICAgICAgIGlmIChpc0ZpcnN0SGV4KSB7CiAgICAgICAgICBmaXJzdERpZ2l0ID0gdG9IZXhEaWdpdChjaCk7CiAgICAgICAgICBpZiAoZmlyc3REaWdpdCA9PT0gLTEpIHsKICAgICAgICAgICAgdGhpcy5faGV4U3RyaW5nV2FybihjaCk7CiAgICAgICAgICAgIGNoID0gdGhpcy5uZXh0Q2hhcigpOwogICAgICAgICAgICBjb250aW51ZTsKICAgICAgICAgIH0KICAgICAgICB9IGVsc2UgewogICAgICAgICAgc2Vjb25kRGlnaXQgPSB0b0hleERpZ2l0KGNoKTsKICAgICAgICAgIGlmIChzZWNvbmREaWdpdCA9PT0gLTEpIHsKICAgICAgICAgICAgdGhpcy5faGV4U3RyaW5nV2FybihjaCk7CiAgICAgICAgICAgIGNoID0gdGhpcy5uZXh0Q2hhcigpOwogICAgICAgICAgICBjb250aW51ZTsKICAgICAgICAgIH0KICAgICAgICAgIHN0ckJ1Zi5wdXNoKFN0cmluZy5mcm9tQ2hhckNvZGUoZmlyc3REaWdpdCA8PCA0IHwgc2Vjb25kRGlnaXQpKTsKICAgICAgICB9CiAgICAgICAgaXNGaXJzdEhleCA9ICFpc0ZpcnN0SGV4OwogICAgICAgIGNoID0gdGhpcy5uZXh0Q2hhcigpOwogICAgICB9CiAgICB9CiAgICByZXR1cm4gc3RyQnVmLmpvaW4oIiIpOwogIH0KICBnZXRPYmooKSB7CiAgICBsZXQgY29tbWVudCA9IGZhbHNlOwogICAgbGV0IGNoID0gdGhpcy5jdXJyZW50Q2hhcjsKICAgIHdoaWxlICh0cnVlKSB7CiAgICAgIGlmIChjaCA8IDApIHsKICAgICAgICByZXR1cm4gX3ByaW1pdGl2ZXMuRU9GOwogICAgICB9CiAgICAgIGlmIChjb21tZW50KSB7CiAgICAgICAgaWYgKGNoID09PSAweDBhIHx8IGNoID09PSAweDBkKSB7CiAgICAgICAgICBjb21tZW50ID0gZmFsc2U7CiAgICAgICAgfQogICAgICB9IGVsc2UgaWYgKGNoID09PSAweDI1KSB7CiAgICAgICAgY29tbWVudCA9IHRydWU7CiAgICAgIH0gZWxzZSBpZiAoc3BlY2lhbENoYXJzW2NoXSAhPT0gMSkgewogICAgICAgIGJyZWFrOwogICAgICB9CiAgICAgIGNoID0gdGhpcy5uZXh0Q2hhcigpOwogICAgfQogICAgc3dpdGNoIChjaCB8IDApIHsKICAgICAgY2FzZSAweDMwOgogICAgICBjYXNlIDB4MzE6CiAgICAgIGNhc2UgMHgzMjoKICAgICAgY2FzZSAweDMzOgogICAgICBjYXNlIDB4MzQ6CiAgICAgIGNhc2UgMHgzNToKICAgICAgY2FzZSAweDM2OgogICAgICBjYXNlIDB4Mzc6CiAgICAgIGNhc2UgMHgzODoKICAgICAgY2FzZSAweDM5OgogICAgICBjYXNlIDB4MmI6CiAgICAgIGNhc2UgMHgyZDoKICAgICAgY2FzZSAweDJlOgogICAgICAgIHJldHVybiB0aGlzLmdldE51bWJlcigpOwogICAgICBjYXNlIDB4Mjg6CiAgICAgICAgcmV0dXJuIHRoaXMuZ2V0U3RyaW5nKCk7CiAgICAgIGNhc2UgMHgyZjoKICAgICAgICByZXR1cm4gdGhpcy5nZXROYW1lKCk7CiAgICAgIGNhc2UgMHg1YjoKICAgICAgICB0aGlzLm5leHRDaGFyKCk7CiAgICAgICAgcmV0dXJuIF9wcmltaXRpdmVzLkNtZC5nZXQoIlsiKTsKICAgICAgY2FzZSAweDVkOgogICAgICAgIHRoaXMubmV4dENoYXIoKTsKICAgICAgICByZXR1cm4gX3ByaW1pdGl2ZXMuQ21kLmdldCgiXSIpOwogICAgICBjYXNlIDB4M2M6CiAgICAgICAgY2ggPSB0aGlzLm5leHRDaGFyKCk7CiAgICAgICAgaWYgKGNoID09PSAweDNjKSB7CiAgICAgICAgICB0aGlzLm5leHRDaGFyKCk7CiAgICAgICAgICByZXR1cm4gX3ByaW1pdGl2ZXMuQ21kLmdldCgiPDwiKTsKICAgICAgICB9CiAgICAgICAgcmV0dXJuIHRoaXMuZ2V0SGV4U3RyaW5nKCk7CiAgICAgIGNhc2UgMHgzZToKICAgICAgICBjaCA9IHRoaXMubmV4dENoYXIoKTsKICAgICAgICBpZiAoY2ggPT09IDB4M2UpIHsKICAgICAgICAgIHRoaXMubmV4dENoYXIoKTsKICAgICAgICAgIHJldHVybiBfcHJpbWl0aXZlcy5DbWQuZ2V0KCI+PiIpOwogICAgICAgIH0KICAgICAgICByZXR1cm4gX3ByaW1pdGl2ZXMuQ21kLmdldCgiPiIpOwogICAgICBjYXNlIDB4N2I6CiAgICAgICAgdGhpcy5uZXh0Q2hhcigpOwogICAgICAgIHJldHVybiBfcHJpbWl0aXZlcy5DbWQuZ2V0KCJ7Iik7CiAgICAgIGNhc2UgMHg3ZDoKICAgICAgICB0aGlzLm5leHRDaGFyKCk7CiAgICAgICAgcmV0dXJuIF9wcmltaXRpdmVzLkNtZC5nZXQoIn0iKTsKICAgICAgY2FzZSAweDI5OgogICAgICAgIHRoaXMubmV4dENoYXIoKTsKICAgICAgICB0aHJvdyBuZXcgX3V0aWwuRm9ybWF0RXJyb3IoYElsbGVnYWwgY2hhcmFjdGVyOiAke2NofWApOwogICAgfQogICAgbGV0IHN0ciA9IFN0cmluZy5mcm9tQ2hhckNvZGUoY2gpOwogICAgaWYgKGNoIDwgMHgyMCB8fCBjaCA+IDB4N2YpIHsKICAgICAgY29uc3QgbmV4dENoID0gdGhpcy5wZWVrQ2hhcigpOwogICAgICBpZiAobmV4dENoID49IDB4MjAgJiYgbmV4dENoIDw9IDB4N2YpIHsKICAgICAgICB0aGlzLm5leHRDaGFyKCk7CiAgICAgICAgcmV0dXJuIF9wcmltaXRpdmVzLkNtZC5nZXQoc3RyKTsKICAgICAgfQogICAgfQogICAgY29uc3Qga25vd25Db21tYW5kcyA9IHRoaXMua25vd25Db21tYW5kczsKICAgIGxldCBrbm93bkNvbW1hbmRGb3VuZCA9IGtub3duQ29tbWFuZHM/LltzdHJdICE9PSB1bmRlZmluZWQ7CiAgICB3aGlsZSAoKGNoID0gdGhpcy5uZXh0Q2hhcigpKSA+PSAwICYmICFzcGVjaWFsQ2hhcnNbY2hdKSB7CiAgICAgIGNvbnN0IHBvc3NpYmxlQ29tbWFuZCA9IHN0ciArIFN0cmluZy5mcm9tQ2hhckNvZGUoY2gpOwogICAgICBpZiAoa25vd25Db21tYW5kRm91bmQgJiYga25vd25Db21tYW5kc1twb3NzaWJsZUNvbW1hbmRdID09PSB1bmRlZmluZWQpIHsKICAgICAgICBicmVhazsKICAgICAgfQogICAgICBpZiAoc3RyLmxlbmd0aCA9PT0gMTI4KSB7CiAgICAgICAgdGhyb3cgbmV3IF91dGlsLkZvcm1hdEVycm9yKGBDb21tYW5kIHRva2VuIHRvbyBsb25nOiAke3N0ci5sZW5ndGh9YCk7CiAgICAgIH0KICAgICAgc3RyID0gcG9zc2libGVDb21tYW5kOwogICAgICBrbm93bkNvbW1hbmRGb3VuZCA9IGtub3duQ29tbWFuZHM/LltzdHJdICE9PSB1bmRlZmluZWQ7CiAgICB9CiAgICBpZiAoc3RyID09PSAidHJ1ZSIpIHsKICAgICAgcmV0dXJuIHRydWU7CiAgICB9CiAgICBpZiAoc3RyID09PSAiZmFsc2UiKSB7CiAgICAgIHJldHVybiBmYWxzZTsKICAgIH0KICAgIGlmIChzdHIgPT09ICJudWxsIikgewogICAgICByZXR1cm4gbnVsbDsKICAgIH0KICAgIGlmIChzdHIgPT09ICJCSSIpIHsKICAgICAgdGhpcy5iZWdpbklubGluZUltYWdlUG9zID0gdGhpcy5zdHJlYW0ucG9zOwogICAgfQogICAgcmV0dXJuIF9wcmltaXRpdmVzLkNtZC5nZXQoc3RyKTsKICB9CiAgc2tpcFRvTmV4dExpbmUoKSB7CiAgICBsZXQgY2ggPSB0aGlzLmN1cnJlbnRDaGFyOwogICAgd2hpbGUgKGNoID49IDApIHsKICAgICAgaWYgKGNoID09PSAweDBkKSB7CiAgICAgICAgY2ggPSB0aGlzLm5leHRDaGFyKCk7CiAgICAgICAgaWYgKGNoID09PSAweDBhKSB7CiAgICAgICAgICB0aGlzLm5leHRDaGFyKCk7CiAgICAgICAgfQogICAgICAgIGJyZWFrOwogICAgICB9IGVsc2UgaWYgKGNoID09PSAweDBhKSB7CiAgICAgICAgdGhpcy5uZXh0Q2hhcigpOwogICAgICAgIGJyZWFrOwogICAgICB9CiAgICAgIGNoID0gdGhpcy5uZXh0Q2hhcigpOwogICAgfQogIH0KfQpleHBvcnRzLkxleGVyID0gTGV4ZXI7CmNsYXNzIExpbmVhcml6YXRpb24gewogIHN0YXRpYyBjcmVhdGUoc3RyZWFtKSB7CiAgICBmdW5jdGlvbiBnZXRJbnQobGluRGljdCwgbmFtZSwgYWxsb3daZXJvVmFsdWUgPSBmYWxzZSkgewogICAgICBjb25zdCBvYmogPSBsaW5EaWN0LmdldChuYW1lKTsKICAgICAgaWYgKE51bWJlci5pc0ludGVnZXIob2JqKSAmJiAoYWxsb3daZXJvVmFsdWUgPyBvYmogPj0gMCA6IG9iaiA+IDApKSB7CiAgICAgICAgcmV0dXJuIG9iajsKICAgICAgfQogICAgICB0aHJvdyBuZXcgRXJyb3IoYFRoZSAiJHtuYW1lfSIgcGFyYW1ldGVyIGluIHRoZSBsaW5lYXJpemF0aW9uIGAgKyAiZGljdGlvbmFyeSBpcyBpbnZhbGlkLiIpOwogICAgfQogICAgZnVuY3Rpb24gZ2V0SGludHMobGluRGljdCkgewogICAgICBjb25zdCBoaW50cyA9IGxpbkRpY3QuZ2V0KCJIIik7CiAgICAgIGxldCBoaW50c0xlbmd0aDsKICAgICAgaWYgKEFycmF5LmlzQXJyYXkoaGludHMpICYmICgoaGludHNMZW5ndGggPSBoaW50cy5sZW5ndGgpID09PSAyIHx8IGhpbnRzTGVuZ3RoID09PSA0KSkgewogICAgICAgIGZvciAobGV0IGluZGV4ID0gMDsgaW5kZXggPCBoaW50c0xlbmd0aDsgaW5kZXgrKykgewogICAgICAgICAgY29uc3QgaGludCA9IGhpbnRzW2luZGV4XTsKICAgICAgICAgIGlmICghKE51bWJlci5pc0ludGVnZXIoaGludCkgJiYgaGludCA+IDApKSB7CiAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcihgSGludCAoJHtpbmRleH0pIGluIHRoZSBsaW5lYXJpemF0aW9uIGRpY3Rpb25hcnkgaXMgaW52YWxpZC5gKTsKICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgcmV0dXJuIGhpbnRzOwogICAgICB9CiAgICAgIHRocm93IG5ldyBFcnJvcigiSGludCBhcnJheSBpbiB0aGUgbGluZWFyaXphdGlvbiBkaWN0aW9uYXJ5IGlzIGludmFsaWQuIik7CiAgICB9CiAgICBjb25zdCBwYXJzZXIgPSBuZXcgUGFyc2VyKHsKICAgICAgbGV4ZXI6IG5ldyBMZXhlcihzdHJlYW0pLAogICAgICB4cmVmOiBudWxsCiAgICB9KTsKICAgIGNvbnN0IG9iajEgPSBwYXJzZXIuZ2V0T2JqKCk7CiAgICBjb25zdCBvYmoyID0gcGFyc2VyLmdldE9iaigpOwogICAgY29uc3Qgb2JqMyA9IHBhcnNlci5nZXRPYmooKTsKICAgIGNvbnN0IGxpbkRpY3QgPSBwYXJzZXIuZ2V0T2JqKCk7CiAgICBsZXQgb2JqLCBsZW5ndGg7CiAgICBpZiAoIShOdW1iZXIuaXNJbnRlZ2VyKG9iajEpICYmIE51bWJlci5pc0ludGVnZXIob2JqMikgJiYgKDAsIF9wcmltaXRpdmVzLmlzQ21kKShvYmozLCAib2JqIikgJiYgbGluRGljdCBpbnN0YW5jZW9mIF9wcmltaXRpdmVzLkRpY3QgJiYgdHlwZW9mIChvYmogPSBsaW5EaWN0LmdldCgiTGluZWFyaXplZCIpKSA9PT0gIm51bWJlciIgJiYgb2JqID4gMCkpIHsKICAgICAgcmV0dXJuIG51bGw7CiAgICB9IGVsc2UgaWYgKChsZW5ndGggPSBnZXRJbnQobGluRGljdCwgIkwiKSkgIT09IHN0cmVhbS5sZW5ndGgpIHsKICAgICAgdGhyb3cgbmV3IEVycm9yKCdUaGUgIkwiIHBhcmFtZXRlciBpbiB0aGUgbGluZWFyaXphdGlvbiBkaWN0aW9uYXJ5ICcgKyAiZG9lcyBub3QgZXF1YWwgdGhlIHN0cmVhbSBsZW5ndGguIik7CiAgICB9CiAgICByZXR1cm4gewogICAgICBsZW5ndGgsCiAgICAgIGhpbnRzOiBnZXRIaW50cyhsaW5EaWN0KSwKICAgICAgb2JqZWN0TnVtYmVyRmlyc3Q6IGdldEludChsaW5EaWN0LCAiTyIpLAogICAgICBlbmRGaXJzdDogZ2V0SW50KGxpbkRpY3QsICJFIiksCiAgICAgIG51bVBhZ2VzOiBnZXRJbnQobGluRGljdCwgIk4iKSwKICAgICAgbWFpblhSZWZFbnRyaWVzT2Zmc2V0OiBnZXRJbnQobGluRGljdCwgIlQiKSwKICAgICAgcGFnZUZpcnN0OiBsaW5EaWN0LmhhcygiUCIpID8gZ2V0SW50KGxpbkRpY3QsICJQIiwgdHJ1ZSkgOiAwCiAgICB9OwogIH0KfQpleHBvcnRzLkxpbmVhcml6YXRpb24gPSBMaW5lYXJpemF0aW9uOwoKLyoqKi8gfSksCi8qIDE3ICovCi8qKiovICgoX191bnVzZWRfd2VicGFja19tb2R1bGUsIGV4cG9ydHMsIF9fd19wZGZqc19yZXF1aXJlX18pID0+IHsKCgoKT2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsICJfX2VzTW9kdWxlIiwgKHsKICB2YWx1ZTogdHJ1ZQp9KSk7CmV4cG9ydHMuQXNjaWk4NVN0cmVhbSA9IHZvaWQgMDsKdmFyIF9kZWNvZGVfc3RyZWFtID0gX193X3BkZmpzX3JlcXVpcmVfXygxOCk7CnZhciBfY29yZV91dGlscyA9IF9fd19wZGZqc19yZXF1aXJlX18oMyk7CmNsYXNzIEFzY2lpODVTdHJlYW0gZXh0ZW5kcyBfZGVjb2RlX3N0cmVhbS5EZWNvZGVTdHJlYW0gewogIGNvbnN0cnVjdG9yKHN0ciwgbWF5YmVMZW5ndGgpIHsKICAgIGlmIChtYXliZUxlbmd0aCkgewogICAgICBtYXliZUxlbmd0aCAqPSAwLjg7CiAgICB9CiAgICBzdXBlcihtYXliZUxlbmd0aCk7CiAgICB0aGlzLnN0ciA9IHN0cjsKICAgIHRoaXMuZGljdCA9IHN0ci5kaWN0OwogICAgdGhpcy5pbnB1dCA9IG5ldyBVaW50OEFycmF5KDUpOwogIH0KICByZWFkQmxvY2soKSB7CiAgICBjb25zdCBUSUxEQV9DSEFSID0gMHg3ZTsKICAgIGNvbnN0IFpfTE9XRVJfQ0hBUiA9IDB4N2E7CiAgICBjb25zdCBFT0YgPSAtMTsKICAgIGNvbnN0IHN0ciA9IHRoaXMuc3RyOwogICAgbGV0IGMgPSBzdHIuZ2V0Qnl0ZSgpOwogICAgd2hpbGUgKCgwLCBfY29yZV91dGlscy5pc1doaXRlU3BhY2UpKGMpKSB7CiAgICAgIGMgPSBzdHIuZ2V0Qnl0ZSgpOwogICAgfQogICAgaWYgKGMgPT09IEVPRiB8fCBjID09PSBUSUxEQV9DSEFSKSB7CiAgICAgIHRoaXMuZW9mID0gdHJ1ZTsKICAgICAgcmV0dXJuOwogICAgfQogICAgY29uc3QgYnVmZmVyTGVuZ3RoID0gdGhpcy5idWZmZXJMZW5ndGg7CiAgICBsZXQgYnVmZmVyLCBpOwogICAgaWYgKGMgPT09IFpfTE9XRVJfQ0hBUikgewogICAgICBidWZmZXIgPSB0aGlzLmVuc3VyZUJ1ZmZlcihidWZmZXJMZW5ndGggKyA0KTsKICAgICAgZm9yIChpID0gMDsgaSA8IDQ7ICsraSkgewogICAgICAgIGJ1ZmZlcltidWZmZXJMZW5ndGggKyBpXSA9IDA7CiAgICAgIH0KICAgICAgdGhpcy5idWZmZXJMZW5ndGggKz0gNDsKICAgIH0gZWxzZSB7CiAgICAgIGNvbnN0IGlucHV0ID0gdGhpcy5pbnB1dDsKICAgICAgaW5wdXRbMF0gPSBjOwogICAgICBmb3IgKGkgPSAxOyBpIDwgNTsgKytpKSB7CiAgICAgICAgYyA9IHN0ci5nZXRCeXRlKCk7CiAgICAgICAgd2hpbGUgKCgwLCBfY29yZV91dGlscy5pc1doaXRlU3BhY2UpKGMpKSB7CiAgICAgICAgICBjID0gc3RyLmdldEJ5dGUoKTsKICAgICAgICB9CiAgICAgICAgaW5wdXRbaV0gPSBjOwogICAgICAgIGlmIChjID09PSBFT0YgfHwgYyA9PT0gVElMREFfQ0hBUikgewogICAgICAgICAgYnJlYWs7CiAgICAgICAgfQogICAgICB9CiAgICAgIGJ1ZmZlciA9IHRoaXMuZW5zdXJlQnVmZmVyKGJ1ZmZlckxlbmd0aCArIGkgLSAxKTsKICAgICAgdGhpcy5idWZmZXJMZW5ndGggKz0gaSAtIDE7CiAgICAgIGlmIChpIDwgNSkgewogICAgICAgIGZvciAoOyBpIDwgNTsgKytpKSB7CiAgICAgICAgICBpbnB1dFtpXSA9IDB4MjEgKyA4NDsKICAgICAgICB9CiAgICAgICAgdGhpcy5lb2YgPSB0cnVlOwogICAgICB9CiAgICAgIGxldCB0ID0gMDsKICAgICAgZm9yIChpID0gMDsgaSA8IDU7ICsraSkgewogICAgICAgIHQgPSB0ICogODUgKyAoaW5wdXRbaV0gLSAweDIxKTsKICAgICAgfQogICAgICBmb3IgKGkgPSAzOyBpID49IDA7IC0taSkgewogICAgICAgIGJ1ZmZlcltidWZmZXJMZW5ndGggKyBpXSA9IHQgJiAweGZmOwogICAgICAgIHQgPj49IDg7CiAgICAgIH0KICAgIH0KICB9Cn0KZXhwb3J0cy5Bc2NpaTg1U3RyZWFtID0gQXNjaWk4NVN0cmVhbTsKCi8qKiovIH0pLAovKiAxOCAqLwovKioqLyAoKF9fdW51c2VkX3dlYnBhY2tfbW9kdWxlLCBleHBvcnRzLCBfX3dfcGRmanNfcmVxdWlyZV9fKSA9PiB7CgoKCk9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCAiX19lc01vZHVsZSIsICh7CiAgdmFsdWU6IHRydWUKfSkpOwpleHBvcnRzLlN0cmVhbXNTZXF1ZW5jZVN0cmVhbSA9IGV4cG9ydHMuRGVjb2RlU3RyZWFtID0gdm9pZCAwOwp2YXIgX2Jhc2Vfc3RyZWFtID0gX193X3BkZmpzX3JlcXVpcmVfXyg1KTsKdmFyIF9zdHJlYW0gPSBfX3dfcGRmanNfcmVxdWlyZV9fKDgpOwpjb25zdCBlbXB0eUJ1ZmZlciA9IG5ldyBVaW50OEFycmF5KDApOwpjbGFzcyBEZWNvZGVTdHJlYW0gZXh0ZW5kcyBfYmFzZV9zdHJlYW0uQmFzZVN0cmVhbSB7CiAgY29uc3RydWN0b3IobWF5YmVNaW5CdWZmZXJMZW5ndGgpIHsKICAgIHN1cGVyKCk7CiAgICB0aGlzLl9yYXdNaW5CdWZmZXJMZW5ndGggPSBtYXliZU1pbkJ1ZmZlckxlbmd0aCB8fCAwOwogICAgdGhpcy5wb3MgPSAwOwogICAgdGhpcy5idWZmZXJMZW5ndGggPSAwOwogICAgdGhpcy5lb2YgPSBmYWxzZTsKICAgIHRoaXMuYnVmZmVyID0gZW1wdHlCdWZmZXI7CiAgICB0aGlzLm1pbkJ1ZmZlckxlbmd0aCA9IDUxMjsKICAgIGlmIChtYXliZU1pbkJ1ZmZlckxlbmd0aCkgewogICAgICB3aGlsZSAodGhpcy5taW5CdWZmZXJMZW5ndGggPCBtYXliZU1pbkJ1ZmZlckxlbmd0aCkgewogICAgICAgIHRoaXMubWluQnVmZmVyTGVuZ3RoICo9IDI7CiAgICAgIH0KICAgIH0KICB9CiAgZ2V0IGlzRW1wdHkoKSB7CiAgICB3aGlsZSAoIXRoaXMuZW9mICYmIHRoaXMuYnVmZmVyTGVuZ3RoID09PSAwKSB7CiAgICAgIHRoaXMucmVhZEJsb2NrKCk7CiAgICB9CiAgICByZXR1cm4gdGhpcy5idWZmZXJMZW5ndGggPT09IDA7CiAgfQogIGVuc3VyZUJ1ZmZlcihyZXF1ZXN0ZWQpIHsKICAgIGNvbnN0IGJ1ZmZlciA9IHRoaXMuYnVmZmVyOwogICAgaWYgKHJlcXVlc3RlZCA8PSBidWZmZXIuYnl0ZUxlbmd0aCkgewogICAgICByZXR1cm4gYnVmZmVyOwogICAgfQogICAgbGV0IHNpemUgPSB0aGlzLm1pbkJ1ZmZlckxlbmd0aDsKICAgIHdoaWxlIChzaXplIDwgcmVxdWVzdGVkKSB7CiAgICAgIHNpemUgKj0gMjsKICAgIH0KICAgIGNvbnN0IGJ1ZmZlcjIgPSBuZXcgVWludDhBcnJheShzaXplKTsKICAgIGJ1ZmZlcjIuc2V0KGJ1ZmZlcik7CiAgICByZXR1cm4gdGhpcy5idWZmZXIgPSBidWZmZXIyOwogIH0KICBnZXRCeXRlKCkgewogICAgY29uc3QgcG9zID0gdGhpcy5wb3M7CiAgICB3aGlsZSAodGhpcy5idWZmZXJMZW5ndGggPD0gcG9zKSB7CiAgICAgIGlmICh0aGlzLmVvZikgewogICAgICAgIHJldHVybiAtMTsKICAgICAgfQogICAgICB0aGlzLnJlYWRCbG9jaygpOwogICAgfQogICAgcmV0dXJuIHRoaXMuYnVmZmVyW3RoaXMucG9zKytdOwogIH0KICBnZXRCeXRlcyhsZW5ndGgpIHsKICAgIGNvbnN0IHBvcyA9IHRoaXMucG9zOwogICAgbGV0IGVuZDsKICAgIGlmIChsZW5ndGgpIHsKICAgICAgdGhpcy5lbnN1cmVCdWZmZXIocG9zICsgbGVuZ3RoKTsKICAgICAgZW5kID0gcG9zICsgbGVuZ3RoOwogICAgICB3aGlsZSAoIXRoaXMuZW9mICYmIHRoaXMuYnVmZmVyTGVuZ3RoIDwgZW5kKSB7CiAgICAgICAgdGhpcy5yZWFkQmxvY2soKTsKICAgICAgfQogICAgICBjb25zdCBidWZFbmQgPSB0aGlzLmJ1ZmZlckxlbmd0aDsKICAgICAgaWYgKGVuZCA+IGJ1ZkVuZCkgewogICAgICAgIGVuZCA9IGJ1ZkVuZDsKICAgICAgfQogICAgfSBlbHNlIHsKICAgICAgd2hpbGUgKCF0aGlzLmVvZikgewogICAgICAgIHRoaXMucmVhZEJsb2NrKCk7CiAgICAgIH0KICAgICAgZW5kID0gdGhpcy5idWZmZXJMZW5ndGg7CiAgICB9CiAgICB0aGlzLnBvcyA9IGVuZDsKICAgIHJldHVybiB0aGlzLmJ1ZmZlci5zdWJhcnJheShwb3MsIGVuZCk7CiAgfQogIHJlc2V0KCkgewogICAgdGhpcy5wb3MgPSAwOwogIH0KICBtYWtlU3ViU3RyZWFtKHN0YXJ0LCBsZW5ndGgsIGRpY3QgPSBudWxsKSB7CiAgICBpZiAobGVuZ3RoID09PSB1bmRlZmluZWQpIHsKICAgICAgd2hpbGUgKCF0aGlzLmVvZikgewogICAgICAgIHRoaXMucmVhZEJsb2NrKCk7CiAgICAgIH0KICAgIH0gZWxzZSB7CiAgICAgIGNvbnN0IGVuZCA9IHN0YXJ0ICsgbGVuZ3RoOwogICAgICB3aGlsZSAodGhpcy5idWZmZXJMZW5ndGggPD0gZW5kICYmICF0aGlzLmVvZikgewogICAgICAgIHRoaXMucmVhZEJsb2NrKCk7CiAgICAgIH0KICAgIH0KICAgIHJldHVybiBuZXcgX3N0cmVhbS5TdHJlYW0odGhpcy5idWZmZXIsIHN0YXJ0LCBsZW5ndGgsIGRpY3QpOwogIH0KICBnZXRCYXNlU3RyZWFtcygpIHsKICAgIHJldHVybiB0aGlzLnN0ciA/IHRoaXMuc3RyLmdldEJhc2VTdHJlYW1zKCkgOiBudWxsOwogIH0KfQpleHBvcnRzLkRlY29kZVN0cmVhbSA9IERlY29kZVN0cmVhbTsKY2xhc3MgU3RyZWFtc1NlcXVlbmNlU3RyZWFtIGV4dGVuZHMgRGVjb2RlU3RyZWFtIHsKICBjb25zdHJ1Y3RvcihzdHJlYW1zLCBvbkVycm9yID0gbnVsbCkgewogICAgbGV0IG1heWJlTGVuZ3RoID0gMDsKICAgIGZvciAoY29uc3Qgc3RyZWFtIG9mIHN0cmVhbXMpIHsKICAgICAgbWF5YmVMZW5ndGggKz0gc3RyZWFtIGluc3RhbmNlb2YgRGVjb2RlU3RyZWFtID8gc3RyZWFtLl9yYXdNaW5CdWZmZXJMZW5ndGggOiBzdHJlYW0ubGVuZ3RoOwogICAgfQogICAgc3VwZXIobWF5YmVMZW5ndGgpOwogICAgdGhpcy5zdHJlYW1zID0gc3RyZWFtczsKICAgIHRoaXMuX29uRXJyb3IgPSBvbkVycm9yOwogIH0KICByZWFkQmxvY2soKSB7CiAgICBjb25zdCBzdHJlYW1zID0gdGhpcy5zdHJlYW1zOwogICAgaWYgKHN0cmVhbXMubGVuZ3RoID09PSAwKSB7CiAgICAgIHRoaXMuZW9mID0gdHJ1ZTsKICAgICAgcmV0dXJuOwogICAgfQogICAgY29uc3Qgc3RyZWFtID0gc3RyZWFtcy5zaGlmdCgpOwogICAgbGV0IGNodW5rOwogICAgdHJ5IHsKICAgICAgY2h1bmsgPSBzdHJlYW0uZ2V0Qnl0ZXMoKTsKICAgIH0gY2F0Y2ggKHJlYXNvbikgewogICAgICBpZiAodGhpcy5fb25FcnJvcikgewogICAgICAgIHRoaXMuX29uRXJyb3IocmVhc29uLCBzdHJlYW0uZGljdD8ub2JqSWQpOwogICAgICAgIHJldHVybjsKICAgICAgfQogICAgICB0aHJvdyByZWFzb247CiAgICB9CiAgICBjb25zdCBidWZmZXJMZW5ndGggPSB0aGlzLmJ1ZmZlckxlbmd0aDsKICAgIGNvbnN0IG5ld0xlbmd0aCA9IGJ1ZmZlckxlbmd0aCArIGNodW5rLmxlbmd0aDsKICAgIGNvbnN0IGJ1ZmZlciA9IHRoaXMuZW5zdXJlQnVmZmVyKG5ld0xlbmd0aCk7CiAgICBidWZmZXIuc2V0KGNodW5rLCBidWZmZXJMZW5ndGgpOwogICAgdGhpcy5idWZmZXJMZW5ndGggPSBuZXdMZW5ndGg7CiAgfQogIGdldEJhc2VTdHJlYW1zKCkgewogICAgY29uc3QgYmFzZVN0cmVhbXNCdWYgPSBbXTsKICAgIGZvciAoY29uc3Qgc3RyZWFtIG9mIHRoaXMuc3RyZWFtcykgewogICAgICBjb25zdCBiYXNlU3RyZWFtcyA9IHN0cmVhbS5nZXRCYXNlU3RyZWFtcygpOwogICAgICBpZiAoYmFzZVN0cmVhbXMpIHsKICAgICAgICBiYXNlU3RyZWFtc0J1Zi5wdXNoKC4uLmJhc2VTdHJlYW1zKTsKICAgICAgfQogICAgfQogICAgcmV0dXJuIGJhc2VTdHJlYW1zQnVmLmxlbmd0aCA+IDAgPyBiYXNlU3RyZWFtc0J1ZiA6IG51bGw7CiAgfQp9CmV4cG9ydHMuU3RyZWFtc1NlcXVlbmNlU3RyZWFtID0gU3RyZWFtc1NlcXVlbmNlU3RyZWFtOwoKLyoqKi8gfSksCi8qIDE5ICovCi8qKiovICgoX191bnVzZWRfd2VicGFja19tb2R1bGUsIGV4cG9ydHMsIF9fd19wZGZqc19yZXF1aXJlX18pID0+IHsKCgoKT2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsICJfX2VzTW9kdWxlIiwgKHsKICB2YWx1ZTogdHJ1ZQp9KSk7CmV4cG9ydHMuQXNjaWlIZXhTdHJlYW0gPSB2b2lkIDA7CnZhciBfZGVjb2RlX3N0cmVhbSA9IF9fd19wZGZqc19yZXF1aXJlX18oMTgpOwpjbGFzcyBBc2NpaUhleFN0cmVhbSBleHRlbmRzIF9kZWNvZGVfc3RyZWFtLkRlY29kZVN0cmVhbSB7CiAgY29uc3RydWN0b3Ioc3RyLCBtYXliZUxlbmd0aCkgewogICAgaWYgKG1heWJlTGVuZ3RoKSB7CiAgICAgIG1heWJlTGVuZ3RoICo9IDAuNTsKICAgIH0KICAgIHN1cGVyKG1heWJlTGVuZ3RoKTsKICAgIHRoaXMuc3RyID0gc3RyOwogICAgdGhpcy5kaWN0ID0gc3RyLmRpY3Q7CiAgICB0aGlzLmZpcnN0RGlnaXQgPSAtMTsKICB9CiAgcmVhZEJsb2NrKCkgewogICAgY29uc3QgVVBTVFJFQU1fQkxPQ0tfU0laRSA9IDgwMDA7CiAgICBjb25zdCBieXRlcyA9IHRoaXMuc3RyLmdldEJ5dGVzKFVQU1RSRUFNX0JMT0NLX1NJWkUpOwogICAgaWYgKCFieXRlcy5sZW5ndGgpIHsKICAgICAgdGhpcy5lb2YgPSB0cnVlOwogICAgICByZXR1cm47CiAgICB9CiAgICBjb25zdCBtYXhEZWNvZGVMZW5ndGggPSBieXRlcy5sZW5ndGggKyAxID4+IDE7CiAgICBjb25zdCBidWZmZXIgPSB0aGlzLmVuc3VyZUJ1ZmZlcih0aGlzLmJ1ZmZlckxlbmd0aCArIG1heERlY29kZUxlbmd0aCk7CiAgICBsZXQgYnVmZmVyTGVuZ3RoID0gdGhpcy5idWZmZXJMZW5ndGg7CiAgICBsZXQgZmlyc3REaWdpdCA9IHRoaXMuZmlyc3REaWdpdDsKICAgIGZvciAoY29uc3QgY2ggb2YgYnl0ZXMpIHsKICAgICAgbGV0IGRpZ2l0OwogICAgICBpZiAoY2ggPj0gMHgzMCAmJiBjaCA8PSAweDM5KSB7CiAgICAgICAgZGlnaXQgPSBjaCAmIDB4MGY7CiAgICAgIH0gZWxzZSBpZiAoY2ggPj0gMHg0MSAmJiBjaCA8PSAweDQ2IHx8IGNoID49IDB4NjEgJiYgY2ggPD0gMHg2NikgewogICAgICAgIGRpZ2l0ID0gKGNoICYgMHgwZikgKyA5OwogICAgICB9IGVsc2UgaWYgKGNoID09PSAweDNlKSB7CiAgICAgICAgdGhpcy5lb2YgPSB0cnVlOwogICAgICAgIGJyZWFrOwogICAgICB9IGVsc2UgewogICAgICAgIGNvbnRpbnVlOwogICAgICB9CiAgICAgIGlmIChmaXJzdERpZ2l0IDwgMCkgewogICAgICAgIGZpcnN0RGlnaXQgPSBkaWdpdDsKICAgICAgfSBlbHNlIHsKICAgICAgICBidWZmZXJbYnVmZmVyTGVuZ3RoKytdID0gZmlyc3REaWdpdCA8PCA0IHwgZGlnaXQ7CiAgICAgICAgZmlyc3REaWdpdCA9IC0xOwogICAgICB9CiAgICB9CiAgICBpZiAoZmlyc3REaWdpdCA+PSAwICYmIHRoaXMuZW9mKSB7CiAgICAgIGJ1ZmZlcltidWZmZXJMZW5ndGgrK10gPSBmaXJzdERpZ2l0IDw8IDQ7CiAgICAgIGZpcnN0RGlnaXQgPSAtMTsKICAgIH0KICAgIHRoaXMuZmlyc3REaWdpdCA9IGZpcnN0RGlnaXQ7CiAgICB0aGlzLmJ1ZmZlckxlbmd0aCA9IGJ1ZmZlckxlbmd0aDsKICB9Cn0KZXhwb3J0cy5Bc2NpaUhleFN0cmVhbSA9IEFzY2lpSGV4U3RyZWFtOwoKLyoqKi8gfSksCi8qIDIwICovCi8qKiovICgoX191bnVzZWRfd2VicGFja19tb2R1bGUsIGV4cG9ydHMsIF9fd19wZGZqc19yZXF1aXJlX18pID0+IHsKCgoKT2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsICJfX2VzTW9kdWxlIiwgKHsKICB2YWx1ZTogdHJ1ZQp9KSk7CmV4cG9ydHMuQ0NJVFRGYXhTdHJlYW0gPSB2b2lkIDA7CnZhciBfY2NpdHQgPSBfX3dfcGRmanNfcmVxdWlyZV9fKDIxKTsKdmFyIF9kZWNvZGVfc3RyZWFtID0gX193X3BkZmpzX3JlcXVpcmVfXygxOCk7CnZhciBfcHJpbWl0aXZlcyA9IF9fd19wZGZqc19yZXF1aXJlX18oNCk7CmNsYXNzIENDSVRURmF4U3RyZWFtIGV4dGVuZHMgX2RlY29kZV9zdHJlYW0uRGVjb2RlU3RyZWFtIHsKICBjb25zdHJ1Y3RvcihzdHIsIG1heWJlTGVuZ3RoLCBwYXJhbXMpIHsKICAgIHN1cGVyKG1heWJlTGVuZ3RoKTsKICAgIHRoaXMuc3RyID0gc3RyOwogICAgdGhpcy5kaWN0ID0gc3RyLmRpY3Q7CiAgICBpZiAoIShwYXJhbXMgaW5zdGFuY2VvZiBfcHJpbWl0aXZlcy5EaWN0KSkgewogICAgICBwYXJhbXMgPSBfcHJpbWl0aXZlcy5EaWN0LmVtcHR5OwogICAgfQogICAgY29uc3Qgc291cmNlID0gewogICAgICBuZXh0KCkgewogICAgICAgIHJldHVybiBzdHIuZ2V0Qnl0ZSgpOwogICAgICB9CiAgICB9OwogICAgdGhpcy5jY2l0dEZheERlY29kZXIgPSBuZXcgX2NjaXR0LkNDSVRURmF4RGVjb2Rlcihzb3VyY2UsIHsKICAgICAgSzogcGFyYW1zLmdldCgiSyIpLAogICAgICBFbmRPZkxpbmU6IHBhcmFtcy5nZXQoIkVuZE9mTGluZSIpLAogICAgICBFbmNvZGVkQnl0ZUFsaWduOiBwYXJhbXMuZ2V0KCJFbmNvZGVkQnl0ZUFsaWduIiksCiAgICAgIENvbHVtbnM6IHBhcmFtcy5nZXQoIkNvbHVtbnMiKSwKICAgICAgUm93czogcGFyYW1zLmdldCgiUm93cyIpLAogICAgICBFbmRPZkJsb2NrOiBwYXJhbXMuZ2V0KCJFbmRPZkJsb2NrIiksCiAgICAgIEJsYWNrSXMxOiBwYXJhbXMuZ2V0KCJCbGFja0lzMSIpCiAgICB9KTsKICB9CiAgcmVhZEJsb2NrKCkgewogICAgd2hpbGUgKCF0aGlzLmVvZikgewogICAgICBjb25zdCBjID0gdGhpcy5jY2l0dEZheERlY29kZXIucmVhZE5leHRDaGFyKCk7CiAgICAgIGlmIChjID09PSAtMSkgewogICAgICAgIHRoaXMuZW9mID0gdHJ1ZTsKICAgICAgICByZXR1cm47CiAgICAgIH0KICAgICAgdGhpcy5lbnN1cmVCdWZmZXIodGhpcy5idWZmZXJMZW5ndGggKyAxKTsKICAgICAgdGhpcy5idWZmZXJbdGhpcy5idWZmZXJMZW5ndGgrK10gPSBjOwogICAgfQogIH0KfQpleHBvcnRzLkNDSVRURmF4U3RyZWFtID0gQ0NJVFRGYXhTdHJlYW07CgovKioqLyB9KSwKLyogMjEgKi8KLyoqKi8gKChfX3VudXNlZF93ZWJwYWNrX21vZHVsZSwgZXhwb3J0cywgX193X3BkZmpzX3JlcXVpcmVfXykgPT4gewoKCgpPYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgIl9fZXNNb2R1bGUiLCAoewogIHZhbHVlOiB0cnVlCn0pKTsKZXhwb3J0cy5DQ0lUVEZheERlY29kZXIgPSB2b2lkIDA7CnZhciBfdXRpbCA9IF9fd19wZGZqc19yZXF1aXJlX18oMik7CmNvbnN0IGNjaXR0RU9MID0gLTI7CmNvbnN0IGNjaXR0RU9GID0gLTE7CmNvbnN0IHR3b0RpbVBhc3MgPSAwOwpjb25zdCB0d29EaW1Ib3JpeiA9IDE7CmNvbnN0IHR3b0RpbVZlcnQwID0gMjsKY29uc3QgdHdvRGltVmVydFIxID0gMzsKY29uc3QgdHdvRGltVmVydEwxID0gNDsKY29uc3QgdHdvRGltVmVydFIyID0gNTsKY29uc3QgdHdvRGltVmVydEwyID0gNjsKY29uc3QgdHdvRGltVmVydFIzID0gNzsKY29uc3QgdHdvRGltVmVydEwzID0gODsKY29uc3QgdHdvRGltVGFibGUgPSBbWy0xLCAtMV0sIFstMSwgLTFdLCBbNywgdHdvRGltVmVydEwzXSwgWzcsIHR3b0RpbVZlcnRSM10sIFs2LCB0d29EaW1WZXJ0TDJdLCBbNiwgdHdvRGltVmVydEwyXSwgWzYsIHR3b0RpbVZlcnRSMl0sIFs2LCB0d29EaW1WZXJ0UjJdLCBbNCwgdHdvRGltUGFzc10sIFs0LCB0d29EaW1QYXNzXSwgWzQsIHR3b0RpbVBhc3NdLCBbNCwgdHdvRGltUGFzc10sIFs0LCB0d29EaW1QYXNzXSwgWzQsIHR3b0RpbVBhc3NdLCBbNCwgdHdvRGltUGFzc10sIFs0LCB0d29EaW1QYXNzXSwgWzMsIHR3b0RpbUhvcml6XSwgWzMsIHR3b0RpbUhvcml6XSwgWzMsIHR3b0RpbUhvcml6XSwgWzMsIHR3b0RpbUhvcml6XSwgWzMsIHR3b0RpbUhvcml6XSwgWzMsIHR3b0RpbUhvcml6XSwgWzMsIHR3b0RpbUhvcml6XSwgWzMsIHR3b0RpbUhvcml6XSwgWzMsIHR3b0RpbUhvcml6XSwgWzMsIHR3b0RpbUhvcml6XSwgWzMsIHR3b0RpbUhvcml6XSwgWzMsIHR3b0RpbUhvcml6XSwgWzMsIHR3b0RpbUhvcml6XSwgWzMsIHR3b0RpbUhvcml6XSwgWzMsIHR3b0RpbUhvcml6XSwgWzMsIHR3b0RpbUhvcml6XSwgWzMsIHR3b0RpbVZlcnRMMV0sIFszLCB0d29EaW1WZXJ0TDFdLCBbMywgdHdvRGltVmVydEwxXSwgWzMsIHR3b0RpbVZlcnRMMV0sIFszLCB0d29EaW1WZXJ0TDFdLCBbMywgdHdvRGltVmVydEwxXSwgWzMsIHR3b0RpbVZlcnRMMV0sIFszLCB0d29EaW1WZXJ0TDFdLCBbMywgdHdvRGltVmVydEwxXSwgWzMsIHR3b0RpbVZlcnRMMV0sIFszLCB0d29EaW1WZXJ0TDFdLCBbMywgdHdvRGltVmVydEwxXSwgWzMsIHR3b0RpbVZlcnRMMV0sIFszLCB0d29EaW1WZXJ0TDFdLCBbMywgdHdvRGltVmVydEwxXSwgWzMsIHR3b0RpbVZlcnRMMV0sIFszLCB0d29EaW1WZXJ0UjFdLCBbMywgdHdvRGltVmVydFIxXSwgWzMsIHR3b0RpbVZlcnRSMV0sIFszLCB0d29EaW1WZXJ0UjFdLCBbMywgdHdvRGltVmVydFIxXSwgWzMsIHR3b0RpbVZlcnRSMV0sIFszLCB0d29EaW1WZXJ0UjFdLCBbMywgdHdvRGltVmVydFIxXSwgWzMsIHR3b0RpbVZlcnRSMV0sIFszLCB0d29EaW1WZXJ0UjFdLCBbMywgdHdvRGltVmVydFIxXSwgWzMsIHR3b0RpbVZlcnRSMV0sIFszLCB0d29EaW1WZXJ0UjFdLCBbMywgdHdvRGltVmVydFIxXSwgWzMsIHR3b0RpbVZlcnRSMV0sIFszLCB0d29EaW1WZXJ0UjFdLCBbMSwgdHdvRGltVmVydDBdLCBbMSwgdHdvRGltVmVydDBdLCBbMSwgdHdvRGltVmVydDBdLCBbMSwgdHdvRGltVmVydDBdLCBbMSwgdHdvRGltVmVydDBdLCBbMSwgdHdvRGltVmVydDBdLCBbMSwgdHdvRGltVmVydDBdLCBbMSwgdHdvRGltVmVydDBdLCBbMSwgdHdvRGltVmVydDBdLCBbMSwgdHdvRGltVmVydDBdLCBbMSwgdHdvRGltVmVydDBdLCBbMSwgdHdvRGltVmVydDBdLCBbMSwgdHdvRGltVmVydDBdLCBbMSwgdHdvRGltVmVydDBdLCBbMSwgdHdvRGltVmVydDBdLCBbMSwgdHdvRGltVmVydDBdLCBbMSwgdHdvRGltVmVydDBdLCBbMSwgdHdvRGltVmVydDBdLCBbMSwgdHdvRGltVmVydDBdLCBbMSwgdHdvRGltVmVydDBdLCBbMSwgdHdvRGltVmVydDBdLCBbMSwgdHdvRGltVmVydDBdLCBbMSwgdHdvRGltVmVydDBdLCBbMSwgdHdvRGltVmVydDBdLCBbMSwgdHdvRGltVmVydDBdLCBbMSwgdHdvRGltVmVydDBdLCBbMSwgdHdvRGltVmVydDBdLCBbMSwgdHdvRGltVmVydDBdLCBbMSwgdHdvRGltVmVydDBdLCBbMSwgdHdvRGltVmVydDBdLCBbMSwgdHdvRGltVmVydDBdLCBbMSwgdHdvRGltVmVydDBdLCBbMSwgdHdvRGltVmVydDBdLCBbMSwgdHdvRGltVmVydDBdLCBbMSwgdHdvRGltVmVydDBdLCBbMSwgdHdvRGltVmVydDBdLCBbMSwgdHdvRGltVmVydDBdLCBbMSwgdHdvRGltVmVydDBdLCBbMSwgdHdvRGltVmVydDBdLCBbMSwgdHdvRGltVmVydDBdLCBbMSwgdHdvRGltVmVydDBdLCBbMSwgdHdvRGltVmVydDBdLCBbMSwgdHdvRGltVmVydDBdLCBbMSwgdHdvRGltVmVydDBdLCBbMSwgdHdvRGltVmVydDBdLCBbMSwgdHdvRGltVmVydDBdLCBbMSwgdHdvRGltVmVydDBdLCBbMSwgdHdvRGltVmVydDBdLCBbMSwgdHdvRGltVmVydDBdLCBbMSwgdHdvRGltVmVydDBdLCBbMSwgdHdvRGltVmVydDBdLCBbMSwgdHdvRGltVmVydDBdLCBbMSwgdHdvRGltVmVydDBdLCBbMSwgdHdvRGltVmVydDBdLCBbMSwgdHdvRGltVmVydDBdLCBbMSwgdHdvRGltVmVydDBdLCBbMSwgdHdvRGltVmVydDBdLCBbMSwgdHdvRGltVmVydDBdLCBbMSwgdHdvRGltVmVydDBdLCBbMSwgdHdvRGltVmVydDBdLCBbMSwgdHdvRGltVmVydDBdLCBbMSwgdHdvRGltVmVydDBdLCBbMSwgdHdvRGltVmVydDBdLCBbMSwgdHdvRGltVmVydDBdXTsKY29uc3Qgd2hpdGVUYWJsZTEgPSBbWy0xLCAtMV0sIFsxMiwgY2NpdHRFT0xdLCBbLTEsIC0xXSwgWy0xLCAtMV0sIFstMSwgLTFdLCBbLTEsIC0xXSwgWy0xLCAtMV0sIFstMSwgLTFdLCBbLTEsIC0xXSwgWy0xLCAtMV0sIFstMSwgLTFdLCBbLTEsIC0xXSwgWy0xLCAtMV0sIFstMSwgLTFdLCBbLTEsIC0xXSwgWy0xLCAtMV0sIFsxMSwgMTc5Ml0sIFsxMSwgMTc5Ml0sIFsxMiwgMTk4NF0sIFsxMiwgMjA0OF0sIFsxMiwgMjExMl0sIFsxMiwgMjE3Nl0sIFsxMiwgMjI0MF0sIFsxMiwgMjMwNF0sIFsxMSwgMTg1Nl0sIFsxMSwgMTg1Nl0sIFsxMSwgMTkyMF0sIFsxMSwgMTkyMF0sIFsxMiwgMjM2OF0sIFsxMiwgMjQzMl0sIFsxMiwgMjQ5Nl0sIFsxMiwgMjU2MF1dOwpjb25zdCB3aGl0ZVRhYmxlMiA9IFtbLTEsIC0xXSwgWy0xLCAtMV0sIFstMSwgLTFdLCBbLTEsIC0xXSwgWzgsIDI5XSwgWzgsIDI5XSwgWzgsIDMwXSwgWzgsIDMwXSwgWzgsIDQ1XSwgWzgsIDQ1XSwgWzgsIDQ2XSwgWzgsIDQ2XSwgWzcsIDIyXSwgWzcsIDIyXSwgWzcsIDIyXSwgWzcsIDIyXSwgWzcsIDIzXSwgWzcsIDIzXSwgWzcsIDIzXSwgWzcsIDIzXSwgWzgsIDQ3XSwgWzgsIDQ3XSwgWzgsIDQ4XSwgWzgsIDQ4XSwgWzYsIDEzXSwgWzYsIDEzXSwgWzYsIDEzXSwgWzYsIDEzXSwgWzYsIDEzXSwgWzYsIDEzXSwgWzYsIDEzXSwgWzYsIDEzXSwgWzcsIDIwXSwgWzcsIDIwXSwgWzcsIDIwXSwgWzcsIDIwXSwgWzgsIDMzXSwgWzgsIDMzXSwgWzgsIDM0XSwgWzgsIDM0XSwgWzgsIDM1XSwgWzgsIDM1XSwgWzgsIDM2XSwgWzgsIDM2XSwgWzgsIDM3XSwgWzgsIDM3XSwgWzgsIDM4XSwgWzgsIDM4XSwgWzcsIDE5XSwgWzcsIDE5XSwgWzcsIDE5XSwgWzcsIDE5XSwgWzgsIDMxXSwgWzgsIDMxXSwgWzgsIDMyXSwgWzgsIDMyXSwgWzYsIDFdLCBbNiwgMV0sIFs2LCAxXSwgWzYsIDFdLCBbNiwgMV0sIFs2LCAxXSwgWzYsIDFdLCBbNiwgMV0sIFs2LCAxMl0sIFs2LCAxMl0sIFs2LCAxMl0sIFs2LCAxMl0sIFs2LCAxMl0sIFs2LCAxMl0sIFs2LCAxMl0sIFs2LCAxMl0sIFs4LCA1M10sIFs4LCA1M10sIFs4LCA1NF0sIFs4LCA1NF0sIFs3LCAyNl0sIFs3LCAyNl0sIFs3LCAyNl0sIFs3LCAyNl0sIFs4LCAzOV0sIFs4LCAzOV0sIFs4LCA0MF0sIFs4LCA0MF0sIFs4LCA0MV0sIFs4LCA0MV0sIFs4LCA0Ml0sIFs4LCA0Ml0sIFs4LCA0M10sIFs4LCA0M10sIFs4LCA0NF0sIFs4LCA0NF0sIFs3LCAyMV0sIFs3LCAyMV0sIFs3LCAyMV0sIFs3LCAyMV0sIFs3LCAyOF0sIFs3LCAyOF0sIFs3LCAyOF0sIFs3LCAyOF0sIFs4LCA2MV0sIFs4LCA2MV0sIFs4LCA2Ml0sIFs4LCA2Ml0sIFs4LCA2M10sIFs4LCA2M10sIFs4LCAwXSwgWzgsIDBdLCBbOCwgMzIwXSwgWzgsIDMyMF0sIFs4LCAzODRdLCBbOCwgMzg0XSwgWzUsIDEwXSwgWzUsIDEwXSwgWzUsIDEwXSwgWzUsIDEwXSwgWzUsIDEwXSwgWzUsIDEwXSwgWzUsIDEwXSwgWzUsIDEwXSwgWzUsIDEwXSwgWzUsIDEwXSwgWzUsIDEwXSwgWzUsIDEwXSwgWzUsIDEwXSwgWzUsIDEwXSwgWzUsIDEwXSwgWzUsIDEwXSwgWzUsIDExXSwgWzUsIDExXSwgWzUsIDExXSwgWzUsIDExXSwgWzUsIDExXSwgWzUsIDExXSwgWzUsIDExXSwgWzUsIDExXSwgWzUsIDExXSwgWzUsIDExXSwgWzUsIDExXSwgWzUsIDExXSwgWzUsIDExXSwgWzUsIDExXSwgWzUsIDExXSwgWzUsIDExXSwgWzcsIDI3XSwgWzcsIDI3XSwgWzcsIDI3XSwgWzcsIDI3XSwgWzgsIDU5XSwgWzgsIDU5XSwgWzgsIDYwXSwgWzgsIDYwXSwgWzksIDE0NzJdLCBbOSwgMTUzNl0sIFs5LCAxNjAwXSwgWzksIDE3MjhdLCBbNywgMThdLCBbNywgMThdLCBbNywgMThdLCBbNywgMThdLCBbNywgMjRdLCBbNywgMjRdLCBbNywgMjRdLCBbNywgMjRdLCBbOCwgNDldLCBbOCwgNDldLCBbOCwgNTBdLCBbOCwgNTBdLCBbOCwgNTFdLCBbOCwgNTFdLCBbOCwgNTJdLCBbOCwgNTJdLCBbNywgMjVdLCBbNywgMjVdLCBbNywgMjVdLCBbNywgMjVdLCBbOCwgNTVdLCBbOCwgNTVdLCBbOCwgNTZdLCBbOCwgNTZdLCBbOCwgNTddLCBbOCwgNTddLCBbOCwgNThdLCBbOCwgNThdLCBbNiwgMTkyXSwgWzYsIDE5Ml0sIFs2LCAxOTJdLCBbNiwgMTkyXSwgWzYsIDE5Ml0sIFs2LCAxOTJdLCBbNiwgMTkyXSwgWzYsIDE5Ml0sIFs2LCAxNjY0XSwgWzYsIDE2NjRdLCBbNiwgMTY2NF0sIFs2LCAxNjY0XSwgWzYsIDE2NjRdLCBbNiwgMTY2NF0sIFs2LCAxNjY0XSwgWzYsIDE2NjRdLCBbOCwgNDQ4XSwgWzgsIDQ0OF0sIFs4LCA1MTJdLCBbOCwgNTEyXSwgWzksIDcwNF0sIFs5LCA3NjhdLCBbOCwgNjQwXSwgWzgsIDY0MF0sIFs4LCA1NzZdLCBbOCwgNTc2XSwgWzksIDgzMl0sIFs5LCA4OTZdLCBbOSwgOTYwXSwgWzksIDEwMjRdLCBbOSwgMTA4OF0sIFs5LCAxMTUyXSwgWzksIDEyMTZdLCBbOSwgMTI4MF0sIFs5LCAxMzQ0XSwgWzksIDE0MDhdLCBbNywgMjU2XSwgWzcsIDI1Nl0sIFs3LCAyNTZdLCBbNywgMjU2XSwgWzQsIDJdLCBbNCwgMl0sIFs0LCAyXSwgWzQsIDJdLCBbNCwgMl0sIFs0LCAyXSwgWzQsIDJdLCBbNCwgMl0sIFs0LCAyXSwgWzQsIDJdLCBbNCwgMl0sIFs0LCAyXSwgWzQsIDJdLCBbNCwgMl0sIFs0LCAyXSwgWzQsIDJdLCBbNCwgMl0sIFs0LCAyXSwgWzQsIDJdLCBbNCwgMl0sIFs0LCAyXSwgWzQsIDJdLCBbNCwgMl0sIFs0LCAyXSwgWzQsIDJdLCBbNCwgMl0sIFs0LCAyXSwgWzQsIDJdLCBbNCwgMl0sIFs0LCAyXSwgWzQsIDJdLCBbNCwgMl0sIFs0LCAzXSwgWzQsIDNdLCBbNCwgM10sIFs0LCAzXSwgWzQsIDNdLCBbNCwgM10sIFs0LCAzXSwgWzQsIDNdLCBbNCwgM10sIFs0LCAzXSwgWzQsIDNdLCBbNCwgM10sIFs0LCAzXSwgWzQsIDNdLCBbNCwgM10sIFs0LCAzXSwgWzQsIDNdLCBbNCwgM10sIFs0LCAzXSwgWzQsIDNdLCBbNCwgM10sIFs0LCAzXSwgWzQsIDNdLCBbNCwgM10sIFs0LCAzXSwgWzQsIDNdLCBbNCwgM10sIFs0LCAzXSwgWzQsIDNdLCBbNCwgM10sIFs0LCAzXSwgWzQsIDNdLCBbNSwgMTI4XSwgWzUsIDEyOF0sIFs1LCAxMjhdLCBbNSwgMTI4XSwgWzUsIDEyOF0sIFs1LCAxMjhdLCBbNSwgMTI4XSwgWzUsIDEyOF0sIFs1LCAxMjhdLCBbNSwgMTI4XSwgWzUsIDEyOF0sIFs1LCAxMjhdLCBbNSwgMTI4XSwgWzUsIDEyOF0sIFs1LCAxMjhdLCBbNSwgMTI4XSwgWzUsIDhdLCBbNSwgOF0sIFs1LCA4XSwgWzUsIDhdLCBbNSwgOF0sIFs1LCA4XSwgWzUsIDhdLCBbNSwgOF0sIFs1LCA4XSwgWzUsIDhdLCBbNSwgOF0sIFs1LCA4XSwgWzUsIDhdLCBbNSwgOF0sIFs1LCA4XSwgWzUsIDhdLCBbNSwgOV0sIFs1LCA5XSwgWzUsIDldLCBbNSwgOV0sIFs1LCA5XSwgWzUsIDldLCBbNSwgOV0sIFs1LCA5XSwgWzUsIDldLCBbNSwgOV0sIFs1LCA5XSwgWzUsIDldLCBbNSwgOV0sIFs1LCA5XSwgWzUsIDldLCBbNSwgOV0sIFs2LCAxNl0sIFs2LCAxNl0sIFs2LCAxNl0sIFs2LCAxNl0sIFs2LCAxNl0sIFs2LCAxNl0sIFs2LCAxNl0sIFs2LCAxNl0sIFs2LCAxN10sIFs2LCAxN10sIFs2LCAxN10sIFs2LCAxN10sIFs2LCAxN10sIFs2LCAxN10sIFs2LCAxN10sIFs2LCAxN10sIFs0LCA0XSwgWzQsIDRdLCBbNCwgNF0sIFs0LCA0XSwgWzQsIDRdLCBbNCwgNF0sIFs0LCA0XSwgWzQsIDRdLCBbNCwgNF0sIFs0LCA0XSwgWzQsIDRdLCBbNCwgNF0sIFs0LCA0XSwgWzQsIDRdLCBbNCwgNF0sIFs0LCA0XSwgWzQsIDRdLCBbNCwgNF0sIFs0LCA0XSwgWzQsIDRdLCBbNCwgNF0sIFs0LCA0XSwgWzQsIDRdLCBbNCwgNF0sIFs0LCA0XSwgWzQsIDRdLCBbNCwgNF0sIFs0LCA0XSwgWzQsIDRdLCBbNCwgNF0sIFs0LCA0XSwgWzQsIDRdLCBbNCwgNV0sIFs0LCA1XSwgWzQsIDVdLCBbNCwgNV0sIFs0LCA1XSwgWzQsIDVdLCBbNCwgNV0sIFs0LCA1XSwgWzQsIDVdLCBbNCwgNV0sIFs0LCA1XSwgWzQsIDVdLCBbNCwgNV0sIFs0LCA1XSwgWzQsIDVdLCBbNCwgNV0sIFs0LCA1XSwgWzQsIDVdLCBbNCwgNV0sIFs0LCA1XSwgWzQsIDVdLCBbNCwgNV0sIFs0LCA1XSwgWzQsIDVdLCBbNCwgNV0sIFs0LCA1XSwgWzQsIDVdLCBbNCwgNV0sIFs0LCA1XSwgWzQsIDVdLCBbNCwgNV0sIFs0LCA1XSwgWzYsIDE0XSwgWzYsIDE0XSwgWzYsIDE0XSwgWzYsIDE0XSwgWzYsIDE0XSwgWzYsIDE0XSwgWzYsIDE0XSwgWzYsIDE0XSwgWzYsIDE1XSwgWzYsIDE1XSwgWzYsIDE1XSwgWzYsIDE1XSwgWzYsIDE1XSwgWzYsIDE1XSwgWzYsIDE1XSwgWzYsIDE1XSwgWzUsIDY0XSwgWzUsIDY0XSwgWzUsIDY0XSwgWzUsIDY0XSwgWzUsIDY0XSwgWzUsIDY0XSwgWzUsIDY0XSwgWzUsIDY0XSwgWzUsIDY0XSwgWzUsIDY0XSwgWzUsIDY0XSwgWzUsIDY0XSwgWzUsIDY0XSwgWzUsIDY0XSwgWzUsIDY0XSwgWzUsIDY0XSwgWzQsIDZdLCBbNCwgNl0sIFs0LCA2XSwgWzQsIDZdLCBbNCwgNl0sIFs0LCA2XSwgWzQsIDZdLCBbNCwgNl0sIFs0LCA2XSwgWzQsIDZdLCBbNCwgNl0sIFs0LCA2XSwgWzQsIDZdLCBbNCwgNl0sIFs0LCA2XSwgWzQsIDZdLCBbNCwgNl0sIFs0LCA2XSwgWzQsIDZdLCBbNCwgNl0sIFs0LCA2XSwgWzQsIDZdLCBbNCwgNl0sIFs0LCA2XSwgWzQsIDZdLCBbNCwgNl0sIFs0LCA2XSwgWzQsIDZdLCBbNCwgNl0sIFs0LCA2XSwgWzQsIDZdLCBbNCwgNl0sIFs0LCA3XSwgWzQsIDddLCBbNCwgN10sIFs0LCA3XSwgWzQsIDddLCBbNCwgN10sIFs0LCA3XSwgWzQsIDddLCBbNCwgN10sIFs0LCA3XSwgWzQsIDddLCBbNCwgN10sIFs0LCA3XSwgWzQsIDddLCBbNCwgN10sIFs0LCA3XSwgWzQsIDddLCBbNCwgN10sIFs0LCA3XSwgWzQsIDddLCBbNCwgN10sIFs0LCA3XSwgWzQsIDddLCBbNCwgN10sIFs0LCA3XSwgWzQsIDddLCBbNCwgN10sIFs0LCA3XSwgWzQsIDddLCBbNCwgN10sIFs0LCA3XSwgWzQsIDddXTsKY29uc3QgYmxhY2tUYWJsZTEgPSBbWy0xLCAtMV0sIFstMSwgLTFdLCBbMTIsIGNjaXR0RU9MXSwgWzEyLCBjY2l0dEVPTF0sIFstMSwgLTFdLCBbLTEsIC0xXSwgWy0xLCAtMV0sIFstMSwgLTFdLCBbLTEsIC0xXSwgWy0xLCAtMV0sIFstMSwgLTFdLCBbLTEsIC0xXSwgWy0xLCAtMV0sIFstMSwgLTFdLCBbLTEsIC0xXSwgWy0xLCAtMV0sIFstMSwgLTFdLCBbLTEsIC0xXSwgWy0xLCAtMV0sIFstMSwgLTFdLCBbLTEsIC0xXSwgWy0xLCAtMV0sIFstMSwgLTFdLCBbLTEsIC0xXSwgWy0xLCAtMV0sIFstMSwgLTFdLCBbLTEsIC0xXSwgWy0xLCAtMV0sIFstMSwgLTFdLCBbLTEsIC0xXSwgWy0xLCAtMV0sIFstMSwgLTFdLCBbMTEsIDE3OTJdLCBbMTEsIDE3OTJdLCBbMTEsIDE3OTJdLCBbMTEsIDE3OTJdLCBbMTIsIDE5ODRdLCBbMTIsIDE5ODRdLCBbMTIsIDIwNDhdLCBbMTIsIDIwNDhdLCBbMTIsIDIxMTJdLCBbMTIsIDIxMTJdLCBbMTIsIDIxNzZdLCBbMTIsIDIxNzZdLCBbMTIsIDIyNDBdLCBbMTIsIDIyNDBdLCBbMTIsIDIzMDRdLCBbMTIsIDIzMDRdLCBbMTEsIDE4NTZdLCBbMTEsIDE4NTZdLCBbMTEsIDE4NTZdLCBbMTEsIDE4NTZdLCBbMTEsIDE5MjBdLCBbMTEsIDE5MjBdLCBbMTEsIDE5MjBdLCBbMTEsIDE5MjBdLCBbMTIsIDIzNjhdLCBbMTIsIDIzNjhdLCBbMTIsIDI0MzJdLCBbMTIsIDI0MzJdLCBbMTIsIDI0OTZdLCBbMTIsIDI0OTZdLCBbMTIsIDI1NjBdLCBbMTIsIDI1NjBdLCBbMTAsIDE4XSwgWzEwLCAxOF0sIFsxMCwgMThdLCBbMTAsIDE4XSwgWzEwLCAxOF0sIFsxMCwgMThdLCBbMTAsIDE4XSwgWzEwLCAxOF0sIFsxMiwgNTJdLCBbMTIsIDUyXSwgWzEzLCA2NDBdLCBbMTMsIDcwNF0sIFsxMywgNzY4XSwgWzEzLCA4MzJdLCBbMTIsIDU1XSwgWzEyLCA1NV0sIFsxMiwgNTZdLCBbMTIsIDU2XSwgWzEzLCAxMjgwXSwgWzEzLCAxMzQ0XSwgWzEzLCAxNDA4XSwgWzEzLCAxNDcyXSwgWzEyLCA1OV0sIFsxMiwgNTldLCBbMTIsIDYwXSwgWzEyLCA2MF0sIFsxMywgMTUzNl0sIFsxMywgMTYwMF0sIFsxMSwgMjRdLCBbMTEsIDI0XSwgWzExLCAyNF0sIFsxMSwgMjRdLCBbMTEsIDI1XSwgWzExLCAyNV0sIFsxMSwgMjVdLCBbMTEsIDI1XSwgWzEzLCAxNjY0XSwgWzEzLCAxNzI4XSwgWzEyLCAzMjBdLCBbMTIsIDMyMF0sIFsxMiwgMzg0XSwgWzEyLCAzODRdLCBbMTIsIDQ0OF0sIFsxMiwgNDQ4XSwgWzEzLCA1MTJdLCBbMTMsIDU3Nl0sIFsxMiwgNTNdLCBbMTIsIDUzXSwgWzEyLCA1NF0sIFsxMiwgNTRdLCBbMTMsIDg5Nl0sIFsxMywgOTYwXSwgWzEzLCAxMDI0XSwgWzEzLCAxMDg4XSwgWzEzLCAxMTUyXSwgWzEzLCAxMjE2XSwgWzEwLCA2NF0sIFsxMCwgNjRdLCBbMTAsIDY0XSwgWzEwLCA2NF0sIFsxMCwgNjRdLCBbMTAsIDY0XSwgWzEwLCA2NF0sIFsxMCwgNjRdXTsKY29uc3QgYmxhY2tUYWJsZTIgPSBbWzgsIDEzXSwgWzgsIDEzXSwgWzgsIDEzXSwgWzgsIDEzXSwgWzgsIDEzXSwgWzgsIDEzXSwgWzgsIDEzXSwgWzgsIDEzXSwgWzgsIDEzXSwgWzgsIDEzXSwgWzgsIDEzXSwgWzgsIDEzXSwgWzgsIDEzXSwgWzgsIDEzXSwgWzgsIDEzXSwgWzgsIDEzXSwgWzExLCAyM10sIFsxMSwgMjNdLCBbMTIsIDUwXSwgWzEyLCA1MV0sIFsxMiwgNDRdLCBbMTIsIDQ1XSwgWzEyLCA0Nl0sIFsxMiwgNDddLCBbMTIsIDU3XSwgWzEyLCA1OF0sIFsxMiwgNjFdLCBbMTIsIDI1Nl0sIFsxMCwgMTZdLCBbMTAsIDE2XSwgWzEwLCAxNl0sIFsxMCwgMTZdLCBbMTAsIDE3XSwgWzEwLCAxN10sIFsxMCwgMTddLCBbMTAsIDE3XSwgWzEyLCA0OF0sIFsxMiwgNDldLCBbMTIsIDYyXSwgWzEyLCA2M10sIFsxMiwgMzBdLCBbMTIsIDMxXSwgWzEyLCAzMl0sIFsxMiwgMzNdLCBbMTIsIDQwXSwgWzEyLCA0MV0sIFsxMSwgMjJdLCBbMTEsIDIyXSwgWzgsIDE0XSwgWzgsIDE0XSwgWzgsIDE0XSwgWzgsIDE0XSwgWzgsIDE0XSwgWzgsIDE0XSwgWzgsIDE0XSwgWzgsIDE0XSwgWzgsIDE0XSwgWzgsIDE0XSwgWzgsIDE0XSwgWzgsIDE0XSwgWzgsIDE0XSwgWzgsIDE0XSwgWzgsIDE0XSwgWzgsIDE0XSwgWzcsIDEwXSwgWzcsIDEwXSwgWzcsIDEwXSwgWzcsIDEwXSwgWzcsIDEwXSwgWzcsIDEwXSwgWzcsIDEwXSwgWzcsIDEwXSwgWzcsIDEwXSwgWzcsIDEwXSwgWzcsIDEwXSwgWzcsIDEwXSwgWzcsIDEwXSwgWzcsIDEwXSwgWzcsIDEwXSwgWzcsIDEwXSwgWzcsIDEwXSwgWzcsIDEwXSwgWzcsIDEwXSwgWzcsIDEwXSwgWzcsIDEwXSwgWzcsIDEwXSwgWzcsIDEwXSwgWzcsIDEwXSwgWzcsIDEwXSwgWzcsIDEwXSwgWzcsIDEwXSwgWzcsIDEwXSwgWzcsIDEwXSwgWzcsIDEwXSwgWzcsIDEwXSwgWzcsIDEwXSwgWzcsIDExXSwgWzcsIDExXSwgWzcsIDExXSwgWzcsIDExXSwgWzcsIDExXSwgWzcsIDExXSwgWzcsIDExXSwgWzcsIDExXSwgWzcsIDExXSwgWzcsIDExXSwgWzcsIDExXSwgWzcsIDExXSwgWzcsIDExXSwgWzcsIDExXSwgWzcsIDExXSwgWzcsIDExXSwgWzcsIDExXSwgWzcsIDExXSwgWzcsIDExXSwgWzcsIDExXSwgWzcsIDExXSwgWzcsIDExXSwgWzcsIDExXSwgWzcsIDExXSwgWzcsIDExXSwgWzcsIDExXSwgWzcsIDExXSwgWzcsIDExXSwgWzcsIDExXSwgWzcsIDExXSwgWzcsIDExXSwgWzcsIDExXSwgWzksIDE1XSwgWzksIDE1XSwgWzksIDE1XSwgWzksIDE1XSwgWzksIDE1XSwgWzksIDE1XSwgWzksIDE1XSwgWzksIDE1XSwgWzEyLCAxMjhdLCBbMTIsIDE5Ml0sIFsxMiwgMjZdLCBbMTIsIDI3XSwgWzEyLCAyOF0sIFsxMiwgMjldLCBbMTEsIDE5XSwgWzExLCAxOV0sIFsxMSwgMjBdLCBbMTEsIDIwXSwgWzEyLCAzNF0sIFsxMiwgMzVdLCBbMTIsIDM2XSwgWzEyLCAzN10sIFsxMiwgMzhdLCBbMTIsIDM5XSwgWzExLCAyMV0sIFsxMSwgMjFdLCBbMTIsIDQyXSwgWzEyLCA0M10sIFsxMCwgMF0sIFsxMCwgMF0sIFsxMCwgMF0sIFsxMCwgMF0sIFs3LCAxMl0sIFs3LCAxMl0sIFs3LCAxMl0sIFs3LCAxMl0sIFs3LCAxMl0sIFs3LCAxMl0sIFs3LCAxMl0sIFs3LCAxMl0sIFs3LCAxMl0sIFs3LCAxMl0sIFs3LCAxMl0sIFs3LCAxMl0sIFs3LCAxMl0sIFs3LCAxMl0sIFs3LCAxMl0sIFs3LCAxMl0sIFs3LCAxMl0sIFs3LCAxMl0sIFs3LCAxMl0sIFs3LCAxMl0sIFs3LCAxMl0sIFs3LCAxMl0sIFs3LCAxMl0sIFs3LCAxMl0sIFs3LCAxMl0sIFs3LCAxMl0sIFs3LCAxMl0sIFs3LCAxMl0sIFs3LCAxMl0sIFs3LCAxMl0sIFs3LCAxMl0sIFs3LCAxMl1dOwpjb25zdCBibGFja1RhYmxlMyA9IFtbLTEsIC0xXSwgWy0xLCAtMV0sIFstMSwgLTFdLCBbLTEsIC0xXSwgWzYsIDldLCBbNiwgOF0sIFs1LCA3XSwgWzUsIDddLCBbNCwgNl0sIFs0LCA2XSwgWzQsIDZdLCBbNCwgNl0sIFs0LCA1XSwgWzQsIDVdLCBbNCwgNV0sIFs0LCA1XSwgWzMsIDFdLCBbMywgMV0sIFszLCAxXSwgWzMsIDFdLCBbMywgMV0sIFszLCAxXSwgWzMsIDFdLCBbMywgMV0sIFszLCA0XSwgWzMsIDRdLCBbMywgNF0sIFszLCA0XSwgWzMsIDRdLCBbMywgNF0sIFszLCA0XSwgWzMsIDRdLCBbMiwgM10sIFsyLCAzXSwgWzIsIDNdLCBbMiwgM10sIFsyLCAzXSwgWzIsIDNdLCBbMiwgM10sIFsyLCAzXSwgWzIsIDNdLCBbMiwgM10sIFsyLCAzXSwgWzIsIDNdLCBbMiwgM10sIFsyLCAzXSwgWzIsIDNdLCBbMiwgM10sIFsyLCAyXSwgWzIsIDJdLCBbMiwgMl0sIFsyLCAyXSwgWzIsIDJdLCBbMiwgMl0sIFsyLCAyXSwgWzIsIDJdLCBbMiwgMl0sIFsyLCAyXSwgWzIsIDJdLCBbMiwgMl0sIFsyLCAyXSwgWzIsIDJdLCBbMiwgMl0sIFsyLCAyXV07CmNsYXNzIENDSVRURmF4RGVjb2RlciB7CiAgY29uc3RydWN0b3Ioc291cmNlLCBvcHRpb25zID0ge30pIHsKICAgIGlmICghc291cmNlIHx8IHR5cGVvZiBzb3VyY2UubmV4dCAhPT0gImZ1bmN0aW9uIikgewogICAgICB0aHJvdyBuZXcgRXJyb3IoJ0NDSVRURmF4RGVjb2RlciAtIGludmFsaWQgInNvdXJjZSIgcGFyYW1ldGVyLicpOwogICAgfQogICAgdGhpcy5zb3VyY2UgPSBzb3VyY2U7CiAgICB0aGlzLmVvZiA9IGZhbHNlOwogICAgdGhpcy5lbmNvZGluZyA9IG9wdGlvbnMuSyB8fCAwOwogICAgdGhpcy5lb2xpbmUgPSBvcHRpb25zLkVuZE9mTGluZSB8fCBmYWxzZTsKICAgIHRoaXMuYnl0ZUFsaWduID0gb3B0aW9ucy5FbmNvZGVkQnl0ZUFsaWduIHx8IGZhbHNlOwogICAgdGhpcy5jb2x1bW5zID0gb3B0aW9ucy5Db2x1bW5zIHx8IDE3Mjg7CiAgICB0aGlzLnJvd3MgPSBvcHRpb25zLlJvd3MgfHwgMDsKICAgIHRoaXMuZW9ibG9jayA9IG9wdGlvbnMuRW5kT2ZCbG9jayA/PyB0cnVlOwogICAgdGhpcy5ibGFjayA9IG9wdGlvbnMuQmxhY2tJczEgfHwgZmFsc2U7CiAgICB0aGlzLmNvZGluZ0xpbmUgPSBuZXcgVWludDMyQXJyYXkodGhpcy5jb2x1bW5zICsgMSk7CiAgICB0aGlzLnJlZkxpbmUgPSBuZXcgVWludDMyQXJyYXkodGhpcy5jb2x1bW5zICsgMik7CiAgICB0aGlzLmNvZGluZ0xpbmVbMF0gPSB0aGlzLmNvbHVtbnM7CiAgICB0aGlzLmNvZGluZ1BvcyA9IDA7CiAgICB0aGlzLnJvdyA9IDA7CiAgICB0aGlzLm5leHRMaW5lMkQgPSB0aGlzLmVuY29kaW5nIDwgMDsKICAgIHRoaXMuaW5wdXRCaXRzID0gMDsKICAgIHRoaXMuaW5wdXRCdWYgPSAwOwogICAgdGhpcy5vdXRwdXRCaXRzID0gMDsKICAgIHRoaXMucm93c0RvbmUgPSBmYWxzZTsKICAgIGxldCBjb2RlMTsKICAgIHdoaWxlICgoY29kZTEgPSB0aGlzLl9sb29rQml0cygxMikpID09PSAwKSB7CiAgICAgIHRoaXMuX2VhdEJpdHMoMSk7CiAgICB9CiAgICBpZiAoY29kZTEgPT09IDEpIHsKICAgICAgdGhpcy5fZWF0Qml0cygxMik7CiAgICB9CiAgICBpZiAodGhpcy5lbmNvZGluZyA+IDApIHsKICAgICAgdGhpcy5uZXh0TGluZTJEID0gIXRoaXMuX2xvb2tCaXRzKDEpOwogICAgICB0aGlzLl9lYXRCaXRzKDEpOwogICAgfQogIH0KICByZWFkTmV4dENoYXIoKSB7CiAgICBpZiAodGhpcy5lb2YpIHsKICAgICAgcmV0dXJuIC0xOwogICAgfQogICAgY29uc3QgcmVmTGluZSA9IHRoaXMucmVmTGluZTsKICAgIGNvbnN0IGNvZGluZ0xpbmUgPSB0aGlzLmNvZGluZ0xpbmU7CiAgICBjb25zdCBjb2x1bW5zID0gdGhpcy5jb2x1bW5zOwogICAgbGV0IHJlZlBvcywgYmxhY2tQaXhlbHMsIGJpdHMsIGk7CiAgICBpZiAodGhpcy5vdXRwdXRCaXRzID09PSAwKSB7CiAgICAgIGlmICh0aGlzLnJvd3NEb25lKSB7CiAgICAgICAgdGhpcy5lb2YgPSB0cnVlOwogICAgICB9CiAgICAgIGlmICh0aGlzLmVvZikgewogICAgICAgIHJldHVybiAtMTsKICAgICAgfQogICAgICB0aGlzLmVyciA9IGZhbHNlOwogICAgICBsZXQgY29kZTEsIGNvZGUyLCBjb2RlMzsKICAgICAgaWYgKHRoaXMubmV4dExpbmUyRCkgewogICAgICAgIGZvciAoaSA9IDA7IGNvZGluZ0xpbmVbaV0gPCBjb2x1bW5zOyArK2kpIHsKICAgICAgICAgIHJlZkxpbmVbaV0gPSBjb2RpbmdMaW5lW2ldOwogICAgICAgIH0KICAgICAgICByZWZMaW5lW2krK10gPSBjb2x1bW5zOwogICAgICAgIHJlZkxpbmVbaV0gPSBjb2x1bW5zOwogICAgICAgIGNvZGluZ0xpbmVbMF0gPSAwOwogICAgICAgIHRoaXMuY29kaW5nUG9zID0gMDsKICAgICAgICByZWZQb3MgPSAwOwogICAgICAgIGJsYWNrUGl4ZWxzID0gMDsKICAgICAgICB3aGlsZSAoY29kaW5nTGluZVt0aGlzLmNvZGluZ1Bvc10gPCBjb2x1bW5zKSB7CiAgICAgICAgICBjb2RlMSA9IHRoaXMuX2dldFR3b0RpbUNvZGUoKTsKICAgICAgICAgIHN3aXRjaCAoY29kZTEpIHsKICAgICAgICAgICAgY2FzZSB0d29EaW1QYXNzOgogICAgICAgICAgICAgIHRoaXMuX2FkZFBpeGVscyhyZWZMaW5lW3JlZlBvcyArIDFdLCBibGFja1BpeGVscyk7CiAgICAgICAgICAgICAgaWYgKHJlZkxpbmVbcmVmUG9zICsgMV0gPCBjb2x1bW5zKSB7CiAgICAgICAgICAgICAgICByZWZQb3MgKz0gMjsKICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgIGNhc2UgdHdvRGltSG9yaXo6CiAgICAgICAgICAgICAgY29kZTEgPSBjb2RlMiA9IDA7CiAgICAgICAgICAgICAgaWYgKGJsYWNrUGl4ZWxzKSB7CiAgICAgICAgICAgICAgICBkbyB7CiAgICAgICAgICAgICAgICAgIGNvZGUxICs9IGNvZGUzID0gdGhpcy5fZ2V0QmxhY2tDb2RlKCk7CiAgICAgICAgICAgICAgICB9IHdoaWxlIChjb2RlMyA+PSA2NCk7CiAgICAgICAgICAgICAgICBkbyB7CiAgICAgICAgICAgICAgICAgIGNvZGUyICs9IGNvZGUzID0gdGhpcy5fZ2V0V2hpdGVDb2RlKCk7CiAgICAgICAgICAgICAgICB9IHdoaWxlIChjb2RlMyA+PSA2NCk7CiAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgIGRvIHsKICAgICAgICAgICAgICAgICAgY29kZTEgKz0gY29kZTMgPSB0aGlzLl9nZXRXaGl0ZUNvZGUoKTsKICAgICAgICAgICAgICAgIH0gd2hpbGUgKGNvZGUzID49IDY0KTsKICAgICAgICAgICAgICAgIGRvIHsKICAgICAgICAgICAgICAgICAgY29kZTIgKz0gY29kZTMgPSB0aGlzLl9nZXRCbGFja0NvZGUoKTsKICAgICAgICAgICAgICAgIH0gd2hpbGUgKGNvZGUzID49IDY0KTsKICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgdGhpcy5fYWRkUGl4ZWxzKGNvZGluZ0xpbmVbdGhpcy5jb2RpbmdQb3NdICsgY29kZTEsIGJsYWNrUGl4ZWxzKTsKICAgICAgICAgICAgICBpZiAoY29kaW5nTGluZVt0aGlzLmNvZGluZ1Bvc10gPCBjb2x1bW5zKSB7CiAgICAgICAgICAgICAgICB0aGlzLl9hZGRQaXhlbHMoY29kaW5nTGluZVt0aGlzLmNvZGluZ1Bvc10gKyBjb2RlMiwgYmxhY2tQaXhlbHMgXiAxKTsKICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgd2hpbGUgKHJlZkxpbmVbcmVmUG9zXSA8PSBjb2RpbmdMaW5lW3RoaXMuY29kaW5nUG9zXSAmJiByZWZMaW5lW3JlZlBvc10gPCBjb2x1bW5zKSB7CiAgICAgICAgICAgICAgICByZWZQb3MgKz0gMjsKICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgIGNhc2UgdHdvRGltVmVydFIzOgogICAgICAgICAgICAgIHRoaXMuX2FkZFBpeGVscyhyZWZMaW5lW3JlZlBvc10gKyAzLCBibGFja1BpeGVscyk7CiAgICAgICAgICAgICAgYmxhY2tQaXhlbHMgXj0gMTsKICAgICAgICAgICAgICBpZiAoY29kaW5nTGluZVt0aGlzLmNvZGluZ1Bvc10gPCBjb2x1bW5zKSB7CiAgICAgICAgICAgICAgICArK3JlZlBvczsKICAgICAgICAgICAgICAgIHdoaWxlIChyZWZMaW5lW3JlZlBvc10gPD0gY29kaW5nTGluZVt0aGlzLmNvZGluZ1Bvc10gJiYgcmVmTGluZVtyZWZQb3NdIDwgY29sdW1ucykgewogICAgICAgICAgICAgICAgICByZWZQb3MgKz0gMjsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgIGNhc2UgdHdvRGltVmVydFIyOgogICAgICAgICAgICAgIHRoaXMuX2FkZFBpeGVscyhyZWZMaW5lW3JlZlBvc10gKyAyLCBibGFja1BpeGVscyk7CiAgICAgICAgICAgICAgYmxhY2tQaXhlbHMgXj0gMTsKICAgICAgICAgICAgICBpZiAoY29kaW5nTGluZVt0aGlzLmNvZGluZ1Bvc10gPCBjb2x1bW5zKSB7CiAgICAgICAgICAgICAgICArK3JlZlBvczsKICAgICAgICAgICAgICAgIHdoaWxlIChyZWZMaW5lW3JlZlBvc10gPD0gY29kaW5nTGluZVt0aGlzLmNvZGluZ1Bvc10gJiYgcmVmTGluZVtyZWZQb3NdIDwgY29sdW1ucykgewogICAgICAgICAgICAgICAgICByZWZQb3MgKz0gMjsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgIGNhc2UgdHdvRGltVmVydFIxOgogICAgICAgICAgICAgIHRoaXMuX2FkZFBpeGVscyhyZWZMaW5lW3JlZlBvc10gKyAxLCBibGFja1BpeGVscyk7CiAgICAgICAgICAgICAgYmxhY2tQaXhlbHMgXj0gMTsKICAgICAgICAgICAgICBpZiAoY29kaW5nTGluZVt0aGlzLmNvZGluZ1Bvc10gPCBjb2x1bW5zKSB7CiAgICAgICAgICAgICAgICArK3JlZlBvczsKICAgICAgICAgICAgICAgIHdoaWxlIChyZWZMaW5lW3JlZlBvc10gPD0gY29kaW5nTGluZVt0aGlzLmNvZGluZ1Bvc10gJiYgcmVmTGluZVtyZWZQb3NdIDwgY29sdW1ucykgewogICAgICAgICAgICAgICAgICByZWZQb3MgKz0gMjsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgIGNhc2UgdHdvRGltVmVydDA6CiAgICAgICAgICAgICAgdGhpcy5fYWRkUGl4ZWxzKHJlZkxpbmVbcmVmUG9zXSwgYmxhY2tQaXhlbHMpOwogICAgICAgICAgICAgIGJsYWNrUGl4ZWxzIF49IDE7CiAgICAgICAgICAgICAgaWYgKGNvZGluZ0xpbmVbdGhpcy5jb2RpbmdQb3NdIDwgY29sdW1ucykgewogICAgICAgICAgICAgICAgKytyZWZQb3M7CiAgICAgICAgICAgICAgICB3aGlsZSAocmVmTGluZVtyZWZQb3NdIDw9IGNvZGluZ0xpbmVbdGhpcy5jb2RpbmdQb3NdICYmIHJlZkxpbmVbcmVmUG9zXSA8IGNvbHVtbnMpIHsKICAgICAgICAgICAgICAgICAgcmVmUG9zICs9IDI7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICBjYXNlIHR3b0RpbVZlcnRMMzoKICAgICAgICAgICAgICB0aGlzLl9hZGRQaXhlbHNOZWcocmVmTGluZVtyZWZQb3NdIC0gMywgYmxhY2tQaXhlbHMpOwogICAgICAgICAgICAgIGJsYWNrUGl4ZWxzIF49IDE7CiAgICAgICAgICAgICAgaWYgKGNvZGluZ0xpbmVbdGhpcy5jb2RpbmdQb3NdIDwgY29sdW1ucykgewogICAgICAgICAgICAgICAgaWYgKHJlZlBvcyA+IDApIHsKICAgICAgICAgICAgICAgICAgLS1yZWZQb3M7CiAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICArK3JlZlBvczsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIHdoaWxlIChyZWZMaW5lW3JlZlBvc10gPD0gY29kaW5nTGluZVt0aGlzLmNvZGluZ1Bvc10gJiYgcmVmTGluZVtyZWZQb3NdIDwgY29sdW1ucykgewogICAgICAgICAgICAgICAgICByZWZQb3MgKz0gMjsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgIGNhc2UgdHdvRGltVmVydEwyOgogICAgICAgICAgICAgIHRoaXMuX2FkZFBpeGVsc05lZyhyZWZMaW5lW3JlZlBvc10gLSAyLCBibGFja1BpeGVscyk7CiAgICAgICAgICAgICAgYmxhY2tQaXhlbHMgXj0gMTsKICAgICAgICAgICAgICBpZiAoY29kaW5nTGluZVt0aGlzLmNvZGluZ1Bvc10gPCBjb2x1bW5zKSB7CiAgICAgICAgICAgICAgICBpZiAocmVmUG9zID4gMCkgewogICAgICAgICAgICAgICAgICAtLXJlZlBvczsKICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICsrcmVmUG9zOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgd2hpbGUgKHJlZkxpbmVbcmVmUG9zXSA8PSBjb2RpbmdMaW5lW3RoaXMuY29kaW5nUG9zXSAmJiByZWZMaW5lW3JlZlBvc10gPCBjb2x1bW5zKSB7CiAgICAgICAgICAgICAgICAgIHJlZlBvcyArPSAyOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIH0KICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgY2FzZSB0d29EaW1WZXJ0TDE6CiAgICAgICAgICAgICAgdGhpcy5fYWRkUGl4ZWxzTmVnKHJlZkxpbmVbcmVmUG9zXSAtIDEsIGJsYWNrUGl4ZWxzKTsKICAgICAgICAgICAgICBibGFja1BpeGVscyBePSAxOwogICAgICAgICAgICAgIGlmIChjb2RpbmdMaW5lW3RoaXMuY29kaW5nUG9zXSA8IGNvbHVtbnMpIHsKICAgICAgICAgICAgICAgIGlmIChyZWZQb3MgPiAwKSB7CiAgICAgICAgICAgICAgICAgIC0tcmVmUG9zOwogICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgKytyZWZQb3M7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB3aGlsZSAocmVmTGluZVtyZWZQb3NdIDw9IGNvZGluZ0xpbmVbdGhpcy5jb2RpbmdQb3NdICYmIHJlZkxpbmVbcmVmUG9zXSA8IGNvbHVtbnMpIHsKICAgICAgICAgICAgICAgICAgcmVmUG9zICs9IDI7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICBjYXNlIGNjaXR0RU9GOgogICAgICAgICAgICAgIHRoaXMuX2FkZFBpeGVscyhjb2x1bW5zLCAwKTsKICAgICAgICAgICAgICB0aGlzLmVvZiA9IHRydWU7CiAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgIGRlZmF1bHQ6CiAgICAgICAgICAgICAgKDAsIF91dGlsLmluZm8pKCJiYWQgMmQgY29kZSIpOwogICAgICAgICAgICAgIHRoaXMuX2FkZFBpeGVscyhjb2x1bW5zLCAwKTsKICAgICAgICAgICAgICB0aGlzLmVyciA9IHRydWU7CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICB9IGVsc2UgewogICAgICAgIGNvZGluZ0xpbmVbMF0gPSAwOwogICAgICAgIHRoaXMuY29kaW5nUG9zID0gMDsKICAgICAgICBibGFja1BpeGVscyA9IDA7CiAgICAgICAgd2hpbGUgKGNvZGluZ0xpbmVbdGhpcy5jb2RpbmdQb3NdIDwgY29sdW1ucykgewogICAgICAgICAgY29kZTEgPSAwOwogICAgICAgICAgaWYgKGJsYWNrUGl4ZWxzKSB7CiAgICAgICAgICAgIGRvIHsKICAgICAgICAgICAgICBjb2RlMSArPSBjb2RlMyA9IHRoaXMuX2dldEJsYWNrQ29kZSgpOwogICAgICAgICAgICB9IHdoaWxlIChjb2RlMyA+PSA2NCk7CiAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICBkbyB7CiAgICAgICAgICAgICAgY29kZTEgKz0gY29kZTMgPSB0aGlzLl9nZXRXaGl0ZUNvZGUoKTsKICAgICAgICAgICAgfSB3aGlsZSAoY29kZTMgPj0gNjQpOwogICAgICAgICAgfQogICAgICAgICAgdGhpcy5fYWRkUGl4ZWxzKGNvZGluZ0xpbmVbdGhpcy5jb2RpbmdQb3NdICsgY29kZTEsIGJsYWNrUGl4ZWxzKTsKICAgICAgICAgIGJsYWNrUGl4ZWxzIF49IDE7CiAgICAgICAgfQogICAgICB9CiAgICAgIGxldCBnb3RFT0wgPSBmYWxzZTsKICAgICAgaWYgKHRoaXMuYnl0ZUFsaWduKSB7CiAgICAgICAgdGhpcy5pbnB1dEJpdHMgJj0gfjc7CiAgICAgIH0KICAgICAgaWYgKCF0aGlzLmVvYmxvY2sgJiYgdGhpcy5yb3cgPT09IHRoaXMucm93cyAtIDEpIHsKICAgICAgICB0aGlzLnJvd3NEb25lID0gdHJ1ZTsKICAgICAgfSBlbHNlIHsKICAgICAgICBjb2RlMSA9IHRoaXMuX2xvb2tCaXRzKDEyKTsKICAgICAgICBpZiAodGhpcy5lb2xpbmUpIHsKICAgICAgICAgIHdoaWxlIChjb2RlMSAhPT0gY2NpdHRFT0YgJiYgY29kZTEgIT09IDEpIHsKICAgICAgICAgICAgdGhpcy5fZWF0Qml0cygxKTsKICAgICAgICAgICAgY29kZTEgPSB0aGlzLl9sb29rQml0cygxMik7CiAgICAgICAgICB9CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIHdoaWxlIChjb2RlMSA9PT0gMCkgewogICAgICAgICAgICB0aGlzLl9lYXRCaXRzKDEpOwogICAgICAgICAgICBjb2RlMSA9IHRoaXMuX2xvb2tCaXRzKDEyKTsKICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgaWYgKGNvZGUxID09PSAxKSB7CiAgICAgICAgICB0aGlzLl9lYXRCaXRzKDEyKTsKICAgICAgICAgIGdvdEVPTCA9IHRydWU7CiAgICAgICAgfSBlbHNlIGlmIChjb2RlMSA9PT0gY2NpdHRFT0YpIHsKICAgICAgICAgIHRoaXMuZW9mID0gdHJ1ZTsKICAgICAgICB9CiAgICAgIH0KICAgICAgaWYgKCF0aGlzLmVvZiAmJiB0aGlzLmVuY29kaW5nID4gMCAmJiAhdGhpcy5yb3dzRG9uZSkgewogICAgICAgIHRoaXMubmV4dExpbmUyRCA9ICF0aGlzLl9sb29rQml0cygxKTsKICAgICAgICB0aGlzLl9lYXRCaXRzKDEpOwogICAgICB9CiAgICAgIGlmICh0aGlzLmVvYmxvY2sgJiYgZ290RU9MICYmIHRoaXMuYnl0ZUFsaWduKSB7CiAgICAgICAgY29kZTEgPSB0aGlzLl9sb29rQml0cygxMik7CiAgICAgICAgaWYgKGNvZGUxID09PSAxKSB7CiAgICAgICAgICB0aGlzLl9lYXRCaXRzKDEyKTsKICAgICAgICAgIGlmICh0aGlzLmVuY29kaW5nID4gMCkgewogICAgICAgICAgICB0aGlzLl9sb29rQml0cygxKTsKICAgICAgICAgICAgdGhpcy5fZWF0Qml0cygxKTsKICAgICAgICAgIH0KICAgICAgICAgIGlmICh0aGlzLmVuY29kaW5nID49IDApIHsKICAgICAgICAgICAgZm9yIChpID0gMDsgaSA8IDQ7ICsraSkgewogICAgICAgICAgICAgIGNvZGUxID0gdGhpcy5fbG9va0JpdHMoMTIpOwogICAgICAgICAgICAgIGlmIChjb2RlMSAhPT0gMSkgewogICAgICAgICAgICAgICAgKDAsIF91dGlsLmluZm8pKCJiYWQgcnRjIGNvZGU6ICIgKyBjb2RlMSk7CiAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIHRoaXMuX2VhdEJpdHMoMTIpOwogICAgICAgICAgICAgIGlmICh0aGlzLmVuY29kaW5nID4gMCkgewogICAgICAgICAgICAgICAgdGhpcy5fbG9va0JpdHMoMSk7CiAgICAgICAgICAgICAgICB0aGlzLl9lYXRCaXRzKDEpOwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgICAgdGhpcy5lb2YgPSB0cnVlOwogICAgICAgIH0KICAgICAgfSBlbHNlIGlmICh0aGlzLmVyciAmJiB0aGlzLmVvbGluZSkgewogICAgICAgIHdoaWxlICh0cnVlKSB7CiAgICAgICAgICBjb2RlMSA9IHRoaXMuX2xvb2tCaXRzKDEzKTsKICAgICAgICAgIGlmIChjb2RlMSA9PT0gY2NpdHRFT0YpIHsKICAgICAgICAgICAgdGhpcy5lb2YgPSB0cnVlOwogICAgICAgICAgICByZXR1cm4gLTE7CiAgICAgICAgICB9CiAgICAgICAgICBpZiAoY29kZTEgPj4gMSA9PT0gMSkgewogICAgICAgICAgICBicmVhazsKICAgICAgICAgIH0KICAgICAgICAgIHRoaXMuX2VhdEJpdHMoMSk7CiAgICAgICAgfQogICAgICAgIHRoaXMuX2VhdEJpdHMoMTIpOwogICAgICAgIGlmICh0aGlzLmVuY29kaW5nID4gMCkgewogICAgICAgICAgdGhpcy5fZWF0Qml0cygxKTsKICAgICAgICAgIHRoaXMubmV4dExpbmUyRCA9ICEoY29kZTEgJiAxKTsKICAgICAgICB9CiAgICAgIH0KICAgICAgdGhpcy5vdXRwdXRCaXRzID0gY29kaW5nTGluZVswXSA+IDAgPyBjb2RpbmdMaW5lW3RoaXMuY29kaW5nUG9zID0gMF0gOiBjb2RpbmdMaW5lW3RoaXMuY29kaW5nUG9zID0gMV07CiAgICAgIHRoaXMucm93Kys7CiAgICB9CiAgICBsZXQgYzsKICAgIGlmICh0aGlzLm91dHB1dEJpdHMgPj0gOCkgewogICAgICBjID0gdGhpcy5jb2RpbmdQb3MgJiAxID8gMCA6IDB4ZmY7CiAgICAgIHRoaXMub3V0cHV0Qml0cyAtPSA4OwogICAgICBpZiAodGhpcy5vdXRwdXRCaXRzID09PSAwICYmIGNvZGluZ0xpbmVbdGhpcy5jb2RpbmdQb3NdIDwgY29sdW1ucykgewogICAgICAgIHRoaXMuY29kaW5nUG9zKys7CiAgICAgICAgdGhpcy5vdXRwdXRCaXRzID0gY29kaW5nTGluZVt0aGlzLmNvZGluZ1Bvc10gLSBjb2RpbmdMaW5lW3RoaXMuY29kaW5nUG9zIC0gMV07CiAgICAgIH0KICAgIH0gZWxzZSB7CiAgICAgIGJpdHMgPSA4OwogICAgICBjID0gMDsKICAgICAgZG8gewogICAgICAgIGlmICh0eXBlb2YgdGhpcy5vdXRwdXRCaXRzICE9PSAibnVtYmVyIikgewogICAgICAgICAgdGhyb3cgbmV3IF91dGlsLkZvcm1hdEVycm9yKCdJbnZhbGlkIC9DQ0lUVEZheERlY29kZSBkYXRhLCAib3V0cHV0Qml0cyIgbXVzdCBiZSBhIG51bWJlci4nKTsKICAgICAgICB9CiAgICAgICAgaWYgKHRoaXMub3V0cHV0Qml0cyA+IGJpdHMpIHsKICAgICAgICAgIGMgPDw9IGJpdHM7CiAgICAgICAgICBpZiAoISh0aGlzLmNvZGluZ1BvcyAmIDEpKSB7CiAgICAgICAgICAgIGMgfD0gMHhmZiA+PiA4IC0gYml0czsKICAgICAgICAgIH0KICAgICAgICAgIHRoaXMub3V0cHV0Qml0cyAtPSBiaXRzOwogICAgICAgICAgYml0cyA9IDA7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIGMgPDw9IHRoaXMub3V0cHV0Qml0czsKICAgICAgICAgIGlmICghKHRoaXMuY29kaW5nUG9zICYgMSkpIHsKICAgICAgICAgICAgYyB8PSAweGZmID4+IDggLSB0aGlzLm91dHB1dEJpdHM7CiAgICAgICAgICB9CiAgICAgICAgICBiaXRzIC09IHRoaXMub3V0cHV0Qml0czsKICAgICAgICAgIHRoaXMub3V0cHV0Qml0cyA9IDA7CiAgICAgICAgICBpZiAoY29kaW5nTGluZVt0aGlzLmNvZGluZ1Bvc10gPCBjb2x1bW5zKSB7CiAgICAgICAgICAgIHRoaXMuY29kaW5nUG9zKys7CiAgICAgICAgICAgIHRoaXMub3V0cHV0Qml0cyA9IGNvZGluZ0xpbmVbdGhpcy5jb2RpbmdQb3NdIC0gY29kaW5nTGluZVt0aGlzLmNvZGluZ1BvcyAtIDFdOwogICAgICAgICAgfSBlbHNlIGlmIChiaXRzID4gMCkgewogICAgICAgICAgICBjIDw8PSBiaXRzOwogICAgICAgICAgICBiaXRzID0gMDsKICAgICAgICAgIH0KICAgICAgICB9CiAgICAgIH0gd2hpbGUgKGJpdHMpOwogICAgfQogICAgaWYgKHRoaXMuYmxhY2spIHsKICAgICAgYyBePSAweGZmOwogICAgfQogICAgcmV0dXJuIGM7CiAgfQogIF9hZGRQaXhlbHMoYTEsIGJsYWNrUGl4ZWxzKSB7CiAgICBjb25zdCBjb2RpbmdMaW5lID0gdGhpcy5jb2RpbmdMaW5lOwogICAgbGV0IGNvZGluZ1BvcyA9IHRoaXMuY29kaW5nUG9zOwogICAgaWYgKGExID4gY29kaW5nTGluZVtjb2RpbmdQb3NdKSB7CiAgICAgIGlmIChhMSA+IHRoaXMuY29sdW1ucykgewogICAgICAgICgwLCBfdXRpbC5pbmZvKSgicm93IGlzIHdyb25nIGxlbmd0aCIpOwogICAgICAgIHRoaXMuZXJyID0gdHJ1ZTsKICAgICAgICBhMSA9IHRoaXMuY29sdW1uczsKICAgICAgfQogICAgICBpZiAoY29kaW5nUG9zICYgMSBeIGJsYWNrUGl4ZWxzKSB7CiAgICAgICAgKytjb2RpbmdQb3M7CiAgICAgIH0KICAgICAgY29kaW5nTGluZVtjb2RpbmdQb3NdID0gYTE7CiAgICB9CiAgICB0aGlzLmNvZGluZ1BvcyA9IGNvZGluZ1BvczsKICB9CiAgX2FkZFBpeGVsc05lZyhhMSwgYmxhY2tQaXhlbHMpIHsKICAgIGNvbnN0IGNvZGluZ0xpbmUgPSB0aGlzLmNvZGluZ0xpbmU7CiAgICBsZXQgY29kaW5nUG9zID0gdGhpcy5jb2RpbmdQb3M7CiAgICBpZiAoYTEgPiBjb2RpbmdMaW5lW2NvZGluZ1Bvc10pIHsKICAgICAgaWYgKGExID4gdGhpcy5jb2x1bW5zKSB7CiAgICAgICAgKDAsIF91dGlsLmluZm8pKCJyb3cgaXMgd3JvbmcgbGVuZ3RoIik7CiAgICAgICAgdGhpcy5lcnIgPSB0cnVlOwogICAgICAgIGExID0gdGhpcy5jb2x1bW5zOwogICAgICB9CiAgICAgIGlmIChjb2RpbmdQb3MgJiAxIF4gYmxhY2tQaXhlbHMpIHsKICAgICAgICArK2NvZGluZ1BvczsKICAgICAgfQogICAgICBjb2RpbmdMaW5lW2NvZGluZ1Bvc10gPSBhMTsKICAgIH0gZWxzZSBpZiAoYTEgPCBjb2RpbmdMaW5lW2NvZGluZ1Bvc10pIHsKICAgICAgaWYgKGExIDwgMCkgewogICAgICAgICgwLCBfdXRpbC5pbmZvKSgiaW52YWxpZCBjb2RlIik7CiAgICAgICAgdGhpcy5lcnIgPSB0cnVlOwogICAgICAgIGExID0gMDsKICAgICAgfQogICAgICB3aGlsZSAoY29kaW5nUG9zID4gMCAmJiBhMSA8IGNvZGluZ0xpbmVbY29kaW5nUG9zIC0gMV0pIHsKICAgICAgICAtLWNvZGluZ1BvczsKICAgICAgfQogICAgICBjb2RpbmdMaW5lW2NvZGluZ1Bvc10gPSBhMTsKICAgIH0KICAgIHRoaXMuY29kaW5nUG9zID0gY29kaW5nUG9zOwogIH0KICBfZmluZFRhYmxlQ29kZShzdGFydCwgZW5kLCB0YWJsZSwgbGltaXQpIHsKICAgIGNvbnN0IGxpbWl0VmFsdWUgPSBsaW1pdCB8fCAwOwogICAgZm9yIChsZXQgaSA9IHN0YXJ0OyBpIDw9IGVuZDsgKytpKSB7CiAgICAgIGxldCBjb2RlID0gdGhpcy5fbG9va0JpdHMoaSk7CiAgICAgIGlmIChjb2RlID09PSBjY2l0dEVPRikgewogICAgICAgIHJldHVybiBbdHJ1ZSwgMSwgZmFsc2VdOwogICAgICB9CiAgICAgIGlmIChpIDwgZW5kKSB7CiAgICAgICAgY29kZSA8PD0gZW5kIC0gaTsKICAgICAgfQogICAgICBpZiAoIWxpbWl0VmFsdWUgfHwgY29kZSA+PSBsaW1pdFZhbHVlKSB7CiAgICAgICAgY29uc3QgcCA9IHRhYmxlW2NvZGUgLSBsaW1pdFZhbHVlXTsKICAgICAgICBpZiAocFswXSA9PT0gaSkgewogICAgICAgICAgdGhpcy5fZWF0Qml0cyhpKTsKICAgICAgICAgIHJldHVybiBbdHJ1ZSwgcFsxXSwgdHJ1ZV07CiAgICAgICAgfQogICAgICB9CiAgICB9CiAgICByZXR1cm4gW2ZhbHNlLCAwLCBmYWxzZV07CiAgfQogIF9nZXRUd29EaW1Db2RlKCkgewogICAgbGV0IGNvZGUgPSAwOwogICAgbGV0IHA7CiAgICBpZiAodGhpcy5lb2Jsb2NrKSB7CiAgICAgIGNvZGUgPSB0aGlzLl9sb29rQml0cyg3KTsKICAgICAgcCA9IHR3b0RpbVRhYmxlW2NvZGVdOwogICAgICBpZiAocD8uWzBdID4gMCkgewogICAgICAgIHRoaXMuX2VhdEJpdHMocFswXSk7CiAgICAgICAgcmV0dXJuIHBbMV07CiAgICAgIH0KICAgIH0gZWxzZSB7CiAgICAgIGNvbnN0IHJlc3VsdCA9IHRoaXMuX2ZpbmRUYWJsZUNvZGUoMSwgNywgdHdvRGltVGFibGUpOwogICAgICBpZiAocmVzdWx0WzBdICYmIHJlc3VsdFsyXSkgewogICAgICAgIHJldHVybiByZXN1bHRbMV07CiAgICAgIH0KICAgIH0KICAgICgwLCBfdXRpbC5pbmZvKSgiQmFkIHR3byBkaW0gY29kZSIpOwogICAgcmV0dXJuIGNjaXR0RU9GOwogIH0KICBfZ2V0V2hpdGVDb2RlKCkgewogICAgbGV0IGNvZGUgPSAwOwogICAgbGV0IHA7CiAgICBpZiAodGhpcy5lb2Jsb2NrKSB7CiAgICAgIGNvZGUgPSB0aGlzLl9sb29rQml0cygxMik7CiAgICAgIGlmIChjb2RlID09PSBjY2l0dEVPRikgewogICAgICAgIHJldHVybiAxOwogICAgICB9CiAgICAgIHAgPSBjb2RlID4+IDUgPT09IDAgPyB3aGl0ZVRhYmxlMVtjb2RlXSA6IHdoaXRlVGFibGUyW2NvZGUgPj4gM107CiAgICAgIGlmIChwWzBdID4gMCkgewogICAgICAgIHRoaXMuX2VhdEJpdHMocFswXSk7CiAgICAgICAgcmV0dXJuIHBbMV07CiAgICAgIH0KICAgIH0gZWxzZSB7CiAgICAgIGxldCByZXN1bHQgPSB0aGlzLl9maW5kVGFibGVDb2RlKDEsIDksIHdoaXRlVGFibGUyKTsKICAgICAgaWYgKHJlc3VsdFswXSkgewogICAgICAgIHJldHVybiByZXN1bHRbMV07CiAgICAgIH0KICAgICAgcmVzdWx0ID0gdGhpcy5fZmluZFRhYmxlQ29kZSgxMSwgMTIsIHdoaXRlVGFibGUxKTsKICAgICAgaWYgKHJlc3VsdFswXSkgewogICAgICAgIHJldHVybiByZXN1bHRbMV07CiAgICAgIH0KICAgIH0KICAgICgwLCBfdXRpbC5pbmZvKSgiYmFkIHdoaXRlIGNvZGUiKTsKICAgIHRoaXMuX2VhdEJpdHMoMSk7CiAgICByZXR1cm4gMTsKICB9CiAgX2dldEJsYWNrQ29kZSgpIHsKICAgIGxldCBjb2RlLCBwOwogICAgaWYgKHRoaXMuZW9ibG9jaykgewogICAgICBjb2RlID0gdGhpcy5fbG9va0JpdHMoMTMpOwogICAgICBpZiAoY29kZSA9PT0gY2NpdHRFT0YpIHsKICAgICAgICByZXR1cm4gMTsKICAgICAgfQogICAgICBpZiAoY29kZSA+PiA3ID09PSAwKSB7CiAgICAgICAgcCA9IGJsYWNrVGFibGUxW2NvZGVdOwogICAgICB9IGVsc2UgaWYgKGNvZGUgPj4gOSA9PT0gMCAmJiBjb2RlID4+IDcgIT09IDApIHsKICAgICAgICBwID0gYmxhY2tUYWJsZTJbKGNvZGUgPj4gMSkgLSA2NF07CiAgICAgIH0gZWxzZSB7CiAgICAgICAgcCA9IGJsYWNrVGFibGUzW2NvZGUgPj4gN107CiAgICAgIH0KICAgICAgaWYgKHBbMF0gPiAwKSB7CiAgICAgICAgdGhpcy5fZWF0Qml0cyhwWzBdKTsKICAgICAgICByZXR1cm4gcFsxXTsKICAgICAgfQogICAgfSBlbHNlIHsKICAgICAgbGV0IHJlc3VsdCA9IHRoaXMuX2ZpbmRUYWJsZUNvZGUoMiwgNiwgYmxhY2tUYWJsZTMpOwogICAgICBpZiAocmVzdWx0WzBdKSB7CiAgICAgICAgcmV0dXJuIHJlc3VsdFsxXTsKICAgICAgfQogICAgICByZXN1bHQgPSB0aGlzLl9maW5kVGFibGVDb2RlKDcsIDEyLCBibGFja1RhYmxlMiwgNjQpOwogICAgICBpZiAocmVzdWx0WzBdKSB7CiAgICAgICAgcmV0dXJuIHJlc3VsdFsxXTsKICAgICAgfQogICAgICByZXN1bHQgPSB0aGlzLl9maW5kVGFibGVDb2RlKDEwLCAxMywgYmxhY2tUYWJsZTEpOwogICAgICBpZiAocmVzdWx0WzBdKSB7CiAgICAgICAgcmV0dXJuIHJlc3VsdFsxXTsKICAgICAgfQogICAgfQogICAgKDAsIF91dGlsLmluZm8pKCJiYWQgYmxhY2sgY29kZSIpOwogICAgdGhpcy5fZWF0Qml0cygxKTsKICAgIHJldHVybiAxOwogIH0KICBfbG9va0JpdHMobikgewogICAgbGV0IGM7CiAgICB3aGlsZSAodGhpcy5pbnB1dEJpdHMgPCBuKSB7CiAgICAgIGlmICgoYyA9IHRoaXMuc291cmNlLm5leHQoKSkgPT09IC0xKSB7CiAgICAgICAgaWYgKHRoaXMuaW5wdXRCaXRzID09PSAwKSB7CiAgICAgICAgICByZXR1cm4gY2NpdHRFT0Y7CiAgICAgICAgfQogICAgICAgIHJldHVybiB0aGlzLmlucHV0QnVmIDw8IG4gLSB0aGlzLmlucHV0Qml0cyAmIDB4ZmZmZiA+PiAxNiAtIG47CiAgICAgIH0KICAgICAgdGhpcy5pbnB1dEJ1ZiA9IHRoaXMuaW5wdXRCdWYgPDwgOCB8IGM7CiAgICAgIHRoaXMuaW5wdXRCaXRzICs9IDg7CiAgICB9CiAgICByZXR1cm4gdGhpcy5pbnB1dEJ1ZiA+PiB0aGlzLmlucHV0Qml0cyAtIG4gJiAweGZmZmYgPj4gMTYgLSBuOwogIH0KICBfZWF0Qml0cyhuKSB7CiAgICBpZiAoKHRoaXMuaW5wdXRCaXRzIC09IG4pIDwgMCkgewogICAgICB0aGlzLmlucHV0Qml0cyA9IDA7CiAgICB9CiAgfQp9CmV4cG9ydHMuQ0NJVFRGYXhEZWNvZGVyID0gQ0NJVFRGYXhEZWNvZGVyOwoKLyoqKi8gfSksCi8qIDIyICovCi8qKiovICgoX191bnVzZWRfd2VicGFja19tb2R1bGUsIGV4cG9ydHMsIF9fd19wZGZqc19yZXF1aXJlX18pID0+IHsKCgoKT2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsICJfX2VzTW9kdWxlIiwgKHsKICB2YWx1ZTogdHJ1ZQp9KSk7CmV4cG9ydHMuRmxhdGVTdHJlYW0gPSB2b2lkIDA7CnZhciBfZGVjb2RlX3N0cmVhbSA9IF9fd19wZGZqc19yZXF1aXJlX18oMTgpOwp2YXIgX3V0aWwgPSBfX3dfcGRmanNfcmVxdWlyZV9fKDIpOwpjb25zdCBjb2RlTGVuQ29kZU1hcCA9IG5ldyBJbnQzMkFycmF5KFsxNiwgMTcsIDE4LCAwLCA4LCA3LCA5LCA2LCAxMCwgNSwgMTEsIDQsIDEyLCAzLCAxMywgMiwgMTQsIDEsIDE1XSk7CmNvbnN0IGxlbmd0aERlY29kZSA9IG5ldyBJbnQzMkFycmF5KFsweDAwMDAzLCAweDAwMDA0LCAweDAwMDA1LCAweDAwMDA2LCAweDAwMDA3LCAweDAwMDA4LCAweDAwMDA5LCAweDAwMDBhLCAweDEwMDBiLCAweDEwMDBkLCAweDEwMDBmLCAweDEwMDExLCAweDIwMDEzLCAweDIwMDE3LCAweDIwMDFiLCAweDIwMDFmLCAweDMwMDIzLCAweDMwMDJiLCAweDMwMDMzLCAweDMwMDNiLCAweDQwMDQzLCAweDQwMDUzLCAweDQwMDYzLCAweDQwMDczLCAweDUwMDgzLCAweDUwMGEzLCAweDUwMGMzLCAweDUwMGUzLCAweDAwMTAyLCAweDAwMTAyLCAweDAwMTAyXSk7CmNvbnN0IGRpc3REZWNvZGUgPSBuZXcgSW50MzJBcnJheShbMHgwMDAwMSwgMHgwMDAwMiwgMHgwMDAwMywgMHgwMDAwNCwgMHgxMDAwNSwgMHgxMDAwNywgMHgyMDAwOSwgMHgyMDAwZCwgMHgzMDAxMSwgMHgzMDAxOSwgMHg0MDAyMSwgMHg0MDAzMSwgMHg1MDA0MSwgMHg1MDA2MSwgMHg2MDA4MSwgMHg2MDBjMSwgMHg3MDEwMSwgMHg3MDE4MSwgMHg4MDIwMSwgMHg4MDMwMSwgMHg5MDQwMSwgMHg5MDYwMSwgMHhhMDgwMSwgMHhhMGMwMSwgMHhiMTAwMSwgMHhiMTgwMSwgMHhjMjAwMSwgMHhjMzAwMSwgMHhkNDAwMSwgMHhkNjAwMV0pOwpjb25zdCBmaXhlZExpdENvZGVUYWIgPSBbbmV3IEludDMyQXJyYXkoWzB4NzAxMDAsIDB4ODAwNTAsIDB4ODAwMTAsIDB4ODAxMTgsIDB4NzAxMTAsIDB4ODAwNzAsIDB4ODAwMzAsIDB4OTAwYzAsIDB4NzAxMDgsIDB4ODAwNjAsIDB4ODAwMjAsIDB4OTAwYTAsIDB4ODAwMDAsIDB4ODAwODAsIDB4ODAwNDAsIDB4OTAwZTAsIDB4NzAxMDQsIDB4ODAwNTgsIDB4ODAwMTgsIDB4OTAwOTAsIDB4NzAxMTQsIDB4ODAwNzgsIDB4ODAwMzgsIDB4OTAwZDAsIDB4NzAxMGMsIDB4ODAwNjgsIDB4ODAwMjgsIDB4OTAwYjAsIDB4ODAwMDgsIDB4ODAwODgsIDB4ODAwNDgsIDB4OTAwZjAsIDB4NzAxMDIsIDB4ODAwNTQsIDB4ODAwMTQsIDB4ODAxMWMsIDB4NzAxMTIsIDB4ODAwNzQsIDB4ODAwMzQsIDB4OTAwYzgsIDB4NzAxMGEsIDB4ODAwNjQsIDB4ODAwMjQsIDB4OTAwYTgsIDB4ODAwMDQsIDB4ODAwODQsIDB4ODAwNDQsIDB4OTAwZTgsIDB4NzAxMDYsIDB4ODAwNWMsIDB4ODAwMWMsIDB4OTAwOTgsIDB4NzAxMTYsIDB4ODAwN2MsIDB4ODAwM2MsIDB4OTAwZDgsIDB4NzAxMGUsIDB4ODAwNmMsIDB4ODAwMmMsIDB4OTAwYjgsIDB4ODAwMGMsIDB4ODAwOGMsIDB4ODAwNGMsIDB4OTAwZjgsIDB4NzAxMDEsIDB4ODAwNTIsIDB4ODAwMTIsIDB4ODAxMWEsIDB4NzAxMTEsIDB4ODAwNzIsIDB4ODAwMzIsIDB4OTAwYzQsIDB4NzAxMDksIDB4ODAwNjIsIDB4ODAwMjIsIDB4OTAwYTQsIDB4ODAwMDIsIDB4ODAwODIsIDB4ODAwNDIsIDB4OTAwZTQsIDB4NzAxMDUsIDB4ODAwNWEsIDB4ODAwMWEsIDB4OTAwOTQsIDB4NzAxMTUsIDB4ODAwN2EsIDB4ODAwM2EsIDB4OTAwZDQsIDB4NzAxMGQsIDB4ODAwNmEsIDB4ODAwMmEsIDB4OTAwYjQsIDB4ODAwMGEsIDB4ODAwOGEsIDB4ODAwNGEsIDB4OTAwZjQsIDB4NzAxMDMsIDB4ODAwNTYsIDB4ODAwMTYsIDB4ODAxMWUsIDB4NzAxMTMsIDB4ODAwNzYsIDB4ODAwMzYsIDB4OTAwY2MsIDB4NzAxMGIsIDB4ODAwNjYsIDB4ODAwMjYsIDB4OTAwYWMsIDB4ODAwMDYsIDB4ODAwODYsIDB4ODAwNDYsIDB4OTAwZWMsIDB4NzAxMDcsIDB4ODAwNWUsIDB4ODAwMWUsIDB4OTAwOWMsIDB4NzAxMTcsIDB4ODAwN2UsIDB4ODAwM2UsIDB4OTAwZGMsIDB4NzAxMGYsIDB4ODAwNmUsIDB4ODAwMmUsIDB4OTAwYmMsIDB4ODAwMGUsIDB4ODAwOGUsIDB4ODAwNGUsIDB4OTAwZmMsIDB4NzAxMDAsIDB4ODAwNTEsIDB4ODAwMTEsIDB4ODAxMTksIDB4NzAxMTAsIDB4ODAwNzEsIDB4ODAwMzEsIDB4OTAwYzIsIDB4NzAxMDgsIDB4ODAwNjEsIDB4ODAwMjEsIDB4OTAwYTIsIDB4ODAwMDEsIDB4ODAwODEsIDB4ODAwNDEsIDB4OTAwZTIsIDB4NzAxMDQsIDB4ODAwNTksIDB4ODAwMTksIDB4OTAwOTIsIDB4NzAxMTQsIDB4ODAwNzksIDB4ODAwMzksIDB4OTAwZDIsIDB4NzAxMGMsIDB4ODAwNjksIDB4ODAwMjksIDB4OTAwYjIsIDB4ODAwMDksIDB4ODAwODksIDB4ODAwNDksIDB4OTAwZjIsIDB4NzAxMDIsIDB4ODAwNTUsIDB4ODAwMTUsIDB4ODAxMWQsIDB4NzAxMTIsIDB4ODAwNzUsIDB4ODAwMzUsIDB4OTAwY2EsIDB4NzAxMGEsIDB4ODAwNjUsIDB4ODAwMjUsIDB4OTAwYWEsIDB4ODAwMDUsIDB4ODAwODUsIDB4ODAwNDUsIDB4OTAwZWEsIDB4NzAxMDYsIDB4ODAwNWQsIDB4ODAwMWQsIDB4OTAwOWEsIDB4NzAxMTYsIDB4ODAwN2QsIDB4ODAwM2QsIDB4OTAwZGEsIDB4NzAxMGUsIDB4ODAwNmQsIDB4ODAwMmQsIDB4OTAwYmEsIDB4ODAwMGQsIDB4ODAwOGQsIDB4ODAwNGQsIDB4OTAwZmEsIDB4NzAxMDEsIDB4ODAwNTMsIDB4ODAwMTMsIDB4ODAxMWIsIDB4NzAxMTEsIDB4ODAwNzMsIDB4ODAwMzMsIDB4OTAwYzYsIDB4NzAxMDksIDB4ODAwNjMsIDB4ODAwMjMsIDB4OTAwYTYsIDB4ODAwMDMsIDB4ODAwODMsIDB4ODAwNDMsIDB4OTAwZTYsIDB4NzAxMDUsIDB4ODAwNWIsIDB4ODAwMWIsIDB4OTAwOTYsIDB4NzAxMTUsIDB4ODAwN2IsIDB4ODAwM2IsIDB4OTAwZDYsIDB4NzAxMGQsIDB4ODAwNmIsIDB4ODAwMmIsIDB4OTAwYjYsIDB4ODAwMGIsIDB4ODAwOGIsIDB4ODAwNGIsIDB4OTAwZjYsIDB4NzAxMDMsIDB4ODAwNTcsIDB4ODAwMTcsIDB4ODAxMWYsIDB4NzAxMTMsIDB4ODAwNzcsIDB4ODAwMzcsIDB4OTAwY2UsIDB4NzAxMGIsIDB4ODAwNjcsIDB4ODAwMjcsIDB4OTAwYWUsIDB4ODAwMDcsIDB4ODAwODcsIDB4ODAwNDcsIDB4OTAwZWUsIDB4NzAxMDcsIDB4ODAwNWYsIDB4ODAwMWYsIDB4OTAwOWUsIDB4NzAxMTcsIDB4ODAwN2YsIDB4ODAwM2YsIDB4OTAwZGUsIDB4NzAxMGYsIDB4ODAwNmYsIDB4ODAwMmYsIDB4OTAwYmUsIDB4ODAwMGYsIDB4ODAwOGYsIDB4ODAwNGYsIDB4OTAwZmUsIDB4NzAxMDAsIDB4ODAwNTAsIDB4ODAwMTAsIDB4ODAxMTgsIDB4NzAxMTAsIDB4ODAwNzAsIDB4ODAwMzAsIDB4OTAwYzEsIDB4NzAxMDgsIDB4ODAwNjAsIDB4ODAwMjAsIDB4OTAwYTEsIDB4ODAwMDAsIDB4ODAwODAsIDB4ODAwNDAsIDB4OTAwZTEsIDB4NzAxMDQsIDB4ODAwNTgsIDB4ODAwMTgsIDB4OTAwOTEsIDB4NzAxMTQsIDB4ODAwNzgsIDB4ODAwMzgsIDB4OTAwZDEsIDB4NzAxMGMsIDB4ODAwNjgsIDB4ODAwMjgsIDB4OTAwYjEsIDB4ODAwMDgsIDB4ODAwODgsIDB4ODAwNDgsIDB4OTAwZjEsIDB4NzAxMDIsIDB4ODAwNTQsIDB4ODAwMTQsIDB4ODAxMWMsIDB4NzAxMTIsIDB4ODAwNzQsIDB4ODAwMzQsIDB4OTAwYzksIDB4NzAxMGEsIDB4ODAwNjQsIDB4ODAwMjQsIDB4OTAwYTksIDB4ODAwMDQsIDB4ODAwODQsIDB4ODAwNDQsIDB4OTAwZTksIDB4NzAxMDYsIDB4ODAwNWMsIDB4ODAwMWMsIDB4OTAwOTksIDB4NzAxMTYsIDB4ODAwN2MsIDB4ODAwM2MsIDB4OTAwZDksIDB4NzAxMGUsIDB4ODAwNmMsIDB4ODAwMmMsIDB4OTAwYjksIDB4ODAwMGMsIDB4ODAwOGMsIDB4ODAwNGMsIDB4OTAwZjksIDB4NzAxMDEsIDB4ODAwNTIsIDB4ODAwMTIsIDB4ODAxMWEsIDB4NzAxMTEsIDB4ODAwNzIsIDB4ODAwMzIsIDB4OTAwYzUsIDB4NzAxMDksIDB4ODAwNjIsIDB4ODAwMjIsIDB4OTAwYTUsIDB4ODAwMDIsIDB4ODAwODIsIDB4ODAwNDIsIDB4OTAwZTUsIDB4NzAxMDUsIDB4ODAwNWEsIDB4ODAwMWEsIDB4OTAwOTUsIDB4NzAxMTUsIDB4ODAwN2EsIDB4ODAwM2EsIDB4OTAwZDUsIDB4NzAxMGQsIDB4ODAwNmEsIDB4ODAwMmEsIDB4OTAwYjUsIDB4ODAwMGEsIDB4ODAwOGEsIDB4ODAwNGEsIDB4OTAwZjUsIDB4NzAxMDMsIDB4ODAwNTYsIDB4ODAwMTYsIDB4ODAxMWUsIDB4NzAxMTMsIDB4ODAwNzYsIDB4ODAwMzYsIDB4OTAwY2QsIDB4NzAxMGIsIDB4ODAwNjYsIDB4ODAwMjYsIDB4OTAwYWQsIDB4ODAwMDYsIDB4ODAwODYsIDB4ODAwNDYsIDB4OTAwZWQsIDB4NzAxMDcsIDB4ODAwNWUsIDB4ODAwMWUsIDB4OTAwOWQsIDB4NzAxMTcsIDB4ODAwN2UsIDB4ODAwM2UsIDB4OTAwZGQsIDB4NzAxMGYsIDB4ODAwNmUsIDB4ODAwMmUsIDB4OTAwYmQsIDB4ODAwMGUsIDB4ODAwOGUsIDB4ODAwNGUsIDB4OTAwZmQsIDB4NzAxMDAsIDB4ODAwNTEsIDB4ODAwMTEsIDB4ODAxMTksIDB4NzAxMTAsIDB4ODAwNzEsIDB4ODAwMzEsIDB4OTAwYzMsIDB4NzAxMDgsIDB4ODAwNjEsIDB4ODAwMjEsIDB4OTAwYTMsIDB4ODAwMDEsIDB4ODAwODEsIDB4ODAwNDEsIDB4OTAwZTMsIDB4NzAxMDQsIDB4ODAwNTksIDB4ODAwMTksIDB4OTAwOTMsIDB4NzAxMTQsIDB4ODAwNzksIDB4ODAwMzksIDB4OTAwZDMsIDB4NzAxMGMsIDB4ODAwNjksIDB4ODAwMjksIDB4OTAwYjMsIDB4ODAwMDksIDB4ODAwODksIDB4ODAwNDksIDB4OTAwZjMsIDB4NzAxMDIsIDB4ODAwNTUsIDB4ODAwMTUsIDB4ODAxMWQsIDB4NzAxMTIsIDB4ODAwNzUsIDB4ODAwMzUsIDB4OTAwY2IsIDB4NzAxMGEsIDB4ODAwNjUsIDB4ODAwMjUsIDB4OTAwYWIsIDB4ODAwMDUsIDB4ODAwODUsIDB4ODAwNDUsIDB4OTAwZWIsIDB4NzAxMDYsIDB4ODAwNWQsIDB4ODAwMWQsIDB4OTAwOWIsIDB4NzAxMTYsIDB4ODAwN2QsIDB4ODAwM2QsIDB4OTAwZGIsIDB4NzAxMGUsIDB4ODAwNmQsIDB4ODAwMmQsIDB4OTAwYmIsIDB4ODAwMGQsIDB4ODAwOGQsIDB4ODAwNGQsIDB4OTAwZmIsIDB4NzAxMDEsIDB4ODAwNTMsIDB4ODAwMTMsIDB4ODAxMWIsIDB4NzAxMTEsIDB4ODAwNzMsIDB4ODAwMzMsIDB4OTAwYzcsIDB4NzAxMDksIDB4ODAwNjMsIDB4ODAwMjMsIDB4OTAwYTcsIDB4ODAwMDMsIDB4ODAwODMsIDB4ODAwNDMsIDB4OTAwZTcsIDB4NzAxMDUsIDB4ODAwNWIsIDB4ODAwMWIsIDB4OTAwOTcsIDB4NzAxMTUsIDB4ODAwN2IsIDB4ODAwM2IsIDB4OTAwZDcsIDB4NzAxMGQsIDB4ODAwNmIsIDB4ODAwMmIsIDB4OTAwYjcsIDB4ODAwMGIsIDB4ODAwOGIsIDB4ODAwNGIsIDB4OTAwZjcsIDB4NzAxMDMsIDB4ODAwNTcsIDB4ODAwMTcsIDB4ODAxMWYsIDB4NzAxMTMsIDB4ODAwNzcsIDB4ODAwMzcsIDB4OTAwY2YsIDB4NzAxMGIsIDB4ODAwNjcsIDB4ODAwMjcsIDB4OTAwYWYsIDB4ODAwMDcsIDB4ODAwODcsIDB4ODAwNDcsIDB4OTAwZWYsIDB4NzAxMDcsIDB4ODAwNWYsIDB4ODAwMWYsIDB4OTAwOWYsIDB4NzAxMTcsIDB4ODAwN2YsIDB4ODAwM2YsIDB4OTAwZGYsIDB4NzAxMGYsIDB4ODAwNmYsIDB4ODAwMmYsIDB4OTAwYmYsIDB4ODAwMGYsIDB4ODAwOGYsIDB4ODAwNGYsIDB4OTAwZmZdKSwgOV07CmNvbnN0IGZpeGVkRGlzdENvZGVUYWIgPSBbbmV3IEludDMyQXJyYXkoWzB4NTAwMDAsIDB4NTAwMTAsIDB4NTAwMDgsIDB4NTAwMTgsIDB4NTAwMDQsIDB4NTAwMTQsIDB4NTAwMGMsIDB4NTAwMWMsIDB4NTAwMDIsIDB4NTAwMTIsIDB4NTAwMGEsIDB4NTAwMWEsIDB4NTAwMDYsIDB4NTAwMTYsIDB4NTAwMGUsIDB4MDAwMDAsIDB4NTAwMDEsIDB4NTAwMTEsIDB4NTAwMDksIDB4NTAwMTksIDB4NTAwMDUsIDB4NTAwMTUsIDB4NTAwMGQsIDB4NTAwMWQsIDB4NTAwMDMsIDB4NTAwMTMsIDB4NTAwMGIsIDB4NTAwMWIsIDB4NTAwMDcsIDB4NTAwMTcsIDB4NTAwMGYsIDB4MDAwMDBdKSwgNV07CmNsYXNzIEZsYXRlU3RyZWFtIGV4dGVuZHMgX2RlY29kZV9zdHJlYW0uRGVjb2RlU3RyZWFtIHsKICBjb25zdHJ1Y3RvcihzdHIsIG1heWJlTGVuZ3RoKSB7CiAgICBzdXBlcihtYXliZUxlbmd0aCk7CiAgICB0aGlzLnN0ciA9IHN0cjsKICAgIHRoaXMuZGljdCA9IHN0ci5kaWN0OwogICAgY29uc3QgY21mID0gc3RyLmdldEJ5dGUoKTsKICAgIGNvbnN0IGZsZyA9IHN0ci5nZXRCeXRlKCk7CiAgICBpZiAoY21mID09PSAtMSB8fCBmbGcgPT09IC0xKSB7CiAgICAgIHRocm93IG5ldyBfdXRpbC5Gb3JtYXRFcnJvcihgSW52YWxpZCBoZWFkZXIgaW4gZmxhdGUgc3RyZWFtOiAke2NtZn0sICR7ZmxnfWApOwogICAgfQogICAgaWYgKChjbWYgJiAweDBmKSAhPT0gMHgwOCkgewogICAgICB0aHJvdyBuZXcgX3V0aWwuRm9ybWF0RXJyb3IoYFVua25vd24gY29tcHJlc3Npb24gbWV0aG9kIGluIGZsYXRlIHN0cmVhbTogJHtjbWZ9LCAke2ZsZ31gKTsKICAgIH0KICAgIGlmICgoKGNtZiA8PCA4KSArIGZsZykgJSAzMSAhPT0gMCkgewogICAgICB0aHJvdyBuZXcgX3V0aWwuRm9ybWF0RXJyb3IoYEJhZCBGQ0hFQ0sgaW4gZmxhdGUgc3RyZWFtOiAke2NtZn0sICR7ZmxnfWApOwogICAgfQogICAgaWYgKGZsZyAmIDB4MjApIHsKICAgICAgdGhyb3cgbmV3IF91dGlsLkZvcm1hdEVycm9yKGBGRElDVCBiaXQgc2V0IGluIGZsYXRlIHN0cmVhbTogJHtjbWZ9LCAke2ZsZ31gKTsKICAgIH0KICAgIHRoaXMuY29kZVNpemUgPSAwOwogICAgdGhpcy5jb2RlQnVmID0gMDsKICB9CiAgZ2V0Qml0cyhiaXRzKSB7CiAgICBjb25zdCBzdHIgPSB0aGlzLnN0cjsKICAgIGxldCBjb2RlU2l6ZSA9IHRoaXMuY29kZVNpemU7CiAgICBsZXQgY29kZUJ1ZiA9IHRoaXMuY29kZUJ1ZjsKICAgIGxldCBiOwogICAgd2hpbGUgKGNvZGVTaXplIDwgYml0cykgewogICAgICBpZiAoKGIgPSBzdHIuZ2V0Qnl0ZSgpKSA9PT0gLTEpIHsKICAgICAgICB0aHJvdyBuZXcgX3V0aWwuRm9ybWF0RXJyb3IoIkJhZCBlbmNvZGluZyBpbiBmbGF0ZSBzdHJlYW0iKTsKICAgICAgfQogICAgICBjb2RlQnVmIHw9IGIgPDwgY29kZVNpemU7CiAgICAgIGNvZGVTaXplICs9IDg7CiAgICB9CiAgICBiID0gY29kZUJ1ZiAmICgxIDw8IGJpdHMpIC0gMTsKICAgIHRoaXMuY29kZUJ1ZiA9IGNvZGVCdWYgPj4gYml0czsKICAgIHRoaXMuY29kZVNpemUgPSBjb2RlU2l6ZSAtPSBiaXRzOwogICAgcmV0dXJuIGI7CiAgfQogIGdldENvZGUodGFibGUpIHsKICAgIGNvbnN0IHN0ciA9IHRoaXMuc3RyOwogICAgY29uc3QgY29kZXMgPSB0YWJsZVswXTsKICAgIGNvbnN0IG1heExlbiA9IHRhYmxlWzFdOwogICAgbGV0IGNvZGVTaXplID0gdGhpcy5jb2RlU2l6ZTsKICAgIGxldCBjb2RlQnVmID0gdGhpcy5jb2RlQnVmOwogICAgbGV0IGI7CiAgICB3aGlsZSAoY29kZVNpemUgPCBtYXhMZW4pIHsKICAgICAgaWYgKChiID0gc3RyLmdldEJ5dGUoKSkgPT09IC0xKSB7CiAgICAgICAgYnJlYWs7CiAgICAgIH0KICAgICAgY29kZUJ1ZiB8PSBiIDw8IGNvZGVTaXplOwogICAgICBjb2RlU2l6ZSArPSA4OwogICAgfQogICAgY29uc3QgY29kZSA9IGNvZGVzW2NvZGVCdWYgJiAoMSA8PCBtYXhMZW4pIC0gMV07CiAgICBjb25zdCBjb2RlTGVuID0gY29kZSA+PiAxNjsKICAgIGNvbnN0IGNvZGVWYWwgPSBjb2RlICYgMHhmZmZmOwogICAgaWYgKGNvZGVMZW4gPCAxIHx8IGNvZGVTaXplIDwgY29kZUxlbikgewogICAgICB0aHJvdyBuZXcgX3V0aWwuRm9ybWF0RXJyb3IoIkJhZCBlbmNvZGluZyBpbiBmbGF0ZSBzdHJlYW0iKTsKICAgIH0KICAgIHRoaXMuY29kZUJ1ZiA9IGNvZGVCdWYgPj4gY29kZUxlbjsKICAgIHRoaXMuY29kZVNpemUgPSBjb2RlU2l6ZSAtIGNvZGVMZW47CiAgICByZXR1cm4gY29kZVZhbDsKICB9CiAgZ2VuZXJhdGVIdWZmbWFuVGFibGUobGVuZ3RocykgewogICAgY29uc3QgbiA9IGxlbmd0aHMubGVuZ3RoOwogICAgbGV0IG1heExlbiA9IDA7CiAgICBsZXQgaTsKICAgIGZvciAoaSA9IDA7IGkgPCBuOyArK2kpIHsKICAgICAgaWYgKGxlbmd0aHNbaV0gPiBtYXhMZW4pIHsKICAgICAgICBtYXhMZW4gPSBsZW5ndGhzW2ldOwogICAgICB9CiAgICB9CiAgICBjb25zdCBzaXplID0gMSA8PCBtYXhMZW47CiAgICBjb25zdCBjb2RlcyA9IG5ldyBJbnQzMkFycmF5KHNpemUpOwogICAgZm9yIChsZXQgbGVuID0gMSwgY29kZSA9IDAsIHNraXAgPSAyOyBsZW4gPD0gbWF4TGVuOyArK2xlbiwgY29kZSA8PD0gMSwgc2tpcCA8PD0gMSkgewogICAgICBmb3IgKGxldCB2YWwgPSAwOyB2YWwgPCBuOyArK3ZhbCkgewogICAgICAgIGlmIChsZW5ndGhzW3ZhbF0gPT09IGxlbikgewogICAgICAgICAgbGV0IGNvZGUyID0gMDsKICAgICAgICAgIGxldCB0ID0gY29kZTsKICAgICAgICAgIGZvciAoaSA9IDA7IGkgPCBsZW47ICsraSkgewogICAgICAgICAgICBjb2RlMiA9IGNvZGUyIDw8IDEgfCB0ICYgMTsKICAgICAgICAgICAgdCA+Pj0gMTsKICAgICAgICAgIH0KICAgICAgICAgIGZvciAoaSA9IGNvZGUyOyBpIDwgc2l6ZTsgaSArPSBza2lwKSB7CiAgICAgICAgICAgIGNvZGVzW2ldID0gbGVuIDw8IDE2IHwgdmFsOwogICAgICAgICAgfQogICAgICAgICAgKytjb2RlOwogICAgICAgIH0KICAgICAgfQogICAgfQogICAgcmV0dXJuIFtjb2RlcywgbWF4TGVuXTsKICB9CiAgcmVhZEJsb2NrKCkgewogICAgbGV0IGJ1ZmZlciwgbGVuOwogICAgY29uc3Qgc3RyID0gdGhpcy5zdHI7CiAgICBsZXQgaGRyID0gdGhpcy5nZXRCaXRzKDMpOwogICAgaWYgKGhkciAmIDEpIHsKICAgICAgdGhpcy5lb2YgPSB0cnVlOwogICAgfQogICAgaGRyID4+PSAxOwogICAgaWYgKGhkciA9PT0gMCkgewogICAgICBsZXQgYjsKICAgICAgaWYgKChiID0gc3RyLmdldEJ5dGUoKSkgPT09IC0xKSB7CiAgICAgICAgdGhyb3cgbmV3IF91dGlsLkZvcm1hdEVycm9yKCJCYWQgYmxvY2sgaGVhZGVyIGluIGZsYXRlIHN0cmVhbSIpOwogICAgICB9CiAgICAgIGxldCBibG9ja0xlbiA9IGI7CiAgICAgIGlmICgoYiA9IHN0ci5nZXRCeXRlKCkpID09PSAtMSkgewogICAgICAgIHRocm93IG5ldyBfdXRpbC5Gb3JtYXRFcnJvcigiQmFkIGJsb2NrIGhlYWRlciBpbiBmbGF0ZSBzdHJlYW0iKTsKICAgICAgfQogICAgICBibG9ja0xlbiB8PSBiIDw8IDg7CiAgICAgIGlmICgoYiA9IHN0ci5nZXRCeXRlKCkpID09PSAtMSkgewogICAgICAgIHRocm93IG5ldyBfdXRpbC5Gb3JtYXRFcnJvcigiQmFkIGJsb2NrIGhlYWRlciBpbiBmbGF0ZSBzdHJlYW0iKTsKICAgICAgfQogICAgICBsZXQgY2hlY2sgPSBiOwogICAgICBpZiAoKGIgPSBzdHIuZ2V0Qnl0ZSgpKSA9PT0gLTEpIHsKICAgICAgICB0aHJvdyBuZXcgX3V0aWwuRm9ybWF0RXJyb3IoIkJhZCBibG9jayBoZWFkZXIgaW4gZmxhdGUgc3RyZWFtIik7CiAgICAgIH0KICAgICAgY2hlY2sgfD0gYiA8PCA4OwogICAgICBpZiAoY2hlY2sgIT09ICh+YmxvY2tMZW4gJiAweGZmZmYpICYmIChibG9ja0xlbiAhPT0gMCB8fCBjaGVjayAhPT0gMCkpIHsKICAgICAgICB0aHJvdyBuZXcgX3V0aWwuRm9ybWF0RXJyb3IoIkJhZCB1bmNvbXByZXNzZWQgYmxvY2sgbGVuZ3RoIGluIGZsYXRlIHN0cmVhbSIpOwogICAgICB9CiAgICAgIHRoaXMuY29kZUJ1ZiA9IDA7CiAgICAgIHRoaXMuY29kZVNpemUgPSAwOwogICAgICBjb25zdCBidWZmZXJMZW5ndGggPSB0aGlzLmJ1ZmZlckxlbmd0aCwKICAgICAgICBlbmQgPSBidWZmZXJMZW5ndGggKyBibG9ja0xlbjsKICAgICAgYnVmZmVyID0gdGhpcy5lbnN1cmVCdWZmZXIoZW5kKTsKICAgICAgdGhpcy5idWZmZXJMZW5ndGggPSBlbmQ7CiAgICAgIGlmIChibG9ja0xlbiA9PT0gMCkgewogICAgICAgIGlmIChzdHIucGVla0J5dGUoKSA9PT0gLTEpIHsKICAgICAgICAgIHRoaXMuZW9mID0gdHJ1ZTsKICAgICAgICB9CiAgICAgIH0gZWxzZSB7CiAgICAgICAgY29uc3QgYmxvY2sgPSBzdHIuZ2V0Qnl0ZXMoYmxvY2tMZW4pOwogICAgICAgIGJ1ZmZlci5zZXQoYmxvY2ssIGJ1ZmZlckxlbmd0aCk7CiAgICAgICAgaWYgKGJsb2NrLmxlbmd0aCA8IGJsb2NrTGVuKSB7CiAgICAgICAgICB0aGlzLmVvZiA9IHRydWU7CiAgICAgICAgfQogICAgICB9CiAgICAgIHJldHVybjsKICAgIH0KICAgIGxldCBsaXRDb2RlVGFibGU7CiAgICBsZXQgZGlzdENvZGVUYWJsZTsKICAgIGlmIChoZHIgPT09IDEpIHsKICAgICAgbGl0Q29kZVRhYmxlID0gZml4ZWRMaXRDb2RlVGFiOwogICAgICBkaXN0Q29kZVRhYmxlID0gZml4ZWREaXN0Q29kZVRhYjsKICAgIH0gZWxzZSBpZiAoaGRyID09PSAyKSB7CiAgICAgIGNvbnN0IG51bUxpdENvZGVzID0gdGhpcy5nZXRCaXRzKDUpICsgMjU3OwogICAgICBjb25zdCBudW1EaXN0Q29kZXMgPSB0aGlzLmdldEJpdHMoNSkgKyAxOwogICAgICBjb25zdCBudW1Db2RlTGVuQ29kZXMgPSB0aGlzLmdldEJpdHMoNCkgKyA0OwogICAgICBjb25zdCBjb2RlTGVuQ29kZUxlbmd0aHMgPSBuZXcgVWludDhBcnJheShjb2RlTGVuQ29kZU1hcC5sZW5ndGgpOwogICAgICBsZXQgaTsKICAgICAgZm9yIChpID0gMDsgaSA8IG51bUNvZGVMZW5Db2RlczsgKytpKSB7CiAgICAgICAgY29kZUxlbkNvZGVMZW5ndGhzW2NvZGVMZW5Db2RlTWFwW2ldXSA9IHRoaXMuZ2V0Qml0cygzKTsKICAgICAgfQogICAgICBjb25zdCBjb2RlTGVuQ29kZVRhYiA9IHRoaXMuZ2VuZXJhdGVIdWZmbWFuVGFibGUoY29kZUxlbkNvZGVMZW5ndGhzKTsKICAgICAgbGVuID0gMDsKICAgICAgaSA9IDA7CiAgICAgIGNvbnN0IGNvZGVzID0gbnVtTGl0Q29kZXMgKyBudW1EaXN0Q29kZXM7CiAgICAgIGNvbnN0IGNvZGVMZW5ndGhzID0gbmV3IFVpbnQ4QXJyYXkoY29kZXMpOwogICAgICBsZXQgYml0c0xlbmd0aCwgYml0c09mZnNldCwgd2hhdDsKICAgICAgd2hpbGUgKGkgPCBjb2RlcykgewogICAgICAgIGNvbnN0IGNvZGUgPSB0aGlzLmdldENvZGUoY29kZUxlbkNvZGVUYWIpOwogICAgICAgIGlmIChjb2RlID09PSAxNikgewogICAgICAgICAgYml0c0xlbmd0aCA9IDI7CiAgICAgICAgICBiaXRzT2Zmc2V0ID0gMzsKICAgICAgICAgIHdoYXQgPSBsZW47CiAgICAgICAgfSBlbHNlIGlmIChjb2RlID09PSAxNykgewogICAgICAgICAgYml0c0xlbmd0aCA9IDM7CiAgICAgICAgICBiaXRzT2Zmc2V0ID0gMzsKICAgICAgICAgIHdoYXQgPSBsZW4gPSAwOwogICAgICAgIH0gZWxzZSBpZiAoY29kZSA9PT0gMTgpIHsKICAgICAgICAgIGJpdHNMZW5ndGggPSA3OwogICAgICAgICAgYml0c09mZnNldCA9IDExOwogICAgICAgICAgd2hhdCA9IGxlbiA9IDA7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIGNvZGVMZW5ndGhzW2krK10gPSBsZW4gPSBjb2RlOwogICAgICAgICAgY29udGludWU7CiAgICAgICAgfQogICAgICAgIGxldCByZXBlYXRMZW5ndGggPSB0aGlzLmdldEJpdHMoYml0c0xlbmd0aCkgKyBiaXRzT2Zmc2V0OwogICAgICAgIHdoaWxlIChyZXBlYXRMZW5ndGgtLSA+IDApIHsKICAgICAgICAgIGNvZGVMZW5ndGhzW2krK10gPSB3aGF0OwogICAgICAgIH0KICAgICAgfQogICAgICBsaXRDb2RlVGFibGUgPSB0aGlzLmdlbmVyYXRlSHVmZm1hblRhYmxlKGNvZGVMZW5ndGhzLnN1YmFycmF5KDAsIG51bUxpdENvZGVzKSk7CiAgICAgIGRpc3RDb2RlVGFibGUgPSB0aGlzLmdlbmVyYXRlSHVmZm1hblRhYmxlKGNvZGVMZW5ndGhzLnN1YmFycmF5KG51bUxpdENvZGVzLCBjb2RlcykpOwogICAgfSBlbHNlIHsKICAgICAgdGhyb3cgbmV3IF91dGlsLkZvcm1hdEVycm9yKCJVbmtub3duIGJsb2NrIHR5cGUgaW4gZmxhdGUgc3RyZWFtIik7CiAgICB9CiAgICBidWZmZXIgPSB0aGlzLmJ1ZmZlcjsKICAgIGxldCBsaW1pdCA9IGJ1ZmZlciA/IGJ1ZmZlci5sZW5ndGggOiAwOwogICAgbGV0IHBvcyA9IHRoaXMuYnVmZmVyTGVuZ3RoOwogICAgd2hpbGUgKHRydWUpIHsKICAgICAgbGV0IGNvZGUxID0gdGhpcy5nZXRDb2RlKGxpdENvZGVUYWJsZSk7CiAgICAgIGlmIChjb2RlMSA8IDI1NikgewogICAgICAgIGlmIChwb3MgKyAxID49IGxpbWl0KSB7CiAgICAgICAgICBidWZmZXIgPSB0aGlzLmVuc3VyZUJ1ZmZlcihwb3MgKyAxKTsKICAgICAgICAgIGxpbWl0ID0gYnVmZmVyLmxlbmd0aDsKICAgICAgICB9CiAgICAgICAgYnVmZmVyW3BvcysrXSA9IGNvZGUxOwogICAgICAgIGNvbnRpbnVlOwogICAgICB9CiAgICAgIGlmIChjb2RlMSA9PT0gMjU2KSB7CiAgICAgICAgdGhpcy5idWZmZXJMZW5ndGggPSBwb3M7CiAgICAgICAgcmV0dXJuOwogICAgICB9CiAgICAgIGNvZGUxIC09IDI1NzsKICAgICAgY29kZTEgPSBsZW5ndGhEZWNvZGVbY29kZTFdOwogICAgICBsZXQgY29kZTIgPSBjb2RlMSA+PiAxNjsKICAgICAgaWYgKGNvZGUyID4gMCkgewogICAgICAgIGNvZGUyID0gdGhpcy5nZXRCaXRzKGNvZGUyKTsKICAgICAgfQogICAgICBsZW4gPSAoY29kZTEgJiAweGZmZmYpICsgY29kZTI7CiAgICAgIGNvZGUxID0gdGhpcy5nZXRDb2RlKGRpc3RDb2RlVGFibGUpOwogICAgICBjb2RlMSA9IGRpc3REZWNvZGVbY29kZTFdOwogICAgICBjb2RlMiA9IGNvZGUxID4+IDE2OwogICAgICBpZiAoY29kZTIgPiAwKSB7CiAgICAgICAgY29kZTIgPSB0aGlzLmdldEJpdHMoY29kZTIpOwogICAgICB9CiAgICAgIGNvbnN0IGRpc3QgPSAoY29kZTEgJiAweGZmZmYpICsgY29kZTI7CiAgICAgIGlmIChwb3MgKyBsZW4gPj0gbGltaXQpIHsKICAgICAgICBidWZmZXIgPSB0aGlzLmVuc3VyZUJ1ZmZlcihwb3MgKyBsZW4pOwogICAgICAgIGxpbWl0ID0gYnVmZmVyLmxlbmd0aDsKICAgICAgfQogICAgICBmb3IgKGxldCBrID0gMDsgayA8IGxlbjsgKytrLCArK3BvcykgewogICAgICAgIGJ1ZmZlcltwb3NdID0gYnVmZmVyW3BvcyAtIGRpc3RdOwogICAgICB9CiAgICB9CiAgfQp9CmV4cG9ydHMuRmxhdGVTdHJlYW0gPSBGbGF0ZVN0cmVhbTsKCi8qKiovIH0pLAovKiAyMyAqLwovKioqLyAoKF9fdW51c2VkX3dlYnBhY2tfbW9kdWxlLCBleHBvcnRzLCBfX3dfcGRmanNfcmVxdWlyZV9fKSA9PiB7CgoKCk9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCAiX19lc01vZHVsZSIsICh7CiAgdmFsdWU6IHRydWUKfSkpOwpleHBvcnRzLkpiaWcyU3RyZWFtID0gdm9pZCAwOwp2YXIgX2Jhc2Vfc3RyZWFtID0gX193X3BkZmpzX3JlcXVpcmVfXyg1KTsKdmFyIF9kZWNvZGVfc3RyZWFtID0gX193X3BkZmpzX3JlcXVpcmVfXygxOCk7CnZhciBfcHJpbWl0aXZlcyA9IF9fd19wZGZqc19yZXF1aXJlX18oNCk7CnZhciBfamJpZyA9IF9fd19wZGZqc19yZXF1aXJlX18oMjQpOwp2YXIgX3V0aWwgPSBfX3dfcGRmanNfcmVxdWlyZV9fKDIpOwpjbGFzcyBKYmlnMlN0cmVhbSBleHRlbmRzIF9kZWNvZGVfc3RyZWFtLkRlY29kZVN0cmVhbSB7CiAgY29uc3RydWN0b3Ioc3RyZWFtLCBtYXliZUxlbmd0aCwgcGFyYW1zKSB7CiAgICBzdXBlcihtYXliZUxlbmd0aCk7CiAgICB0aGlzLnN0cmVhbSA9IHN0cmVhbTsKICAgIHRoaXMuZGljdCA9IHN0cmVhbS5kaWN0OwogICAgdGhpcy5tYXliZUxlbmd0aCA9IG1heWJlTGVuZ3RoOwogICAgdGhpcy5wYXJhbXMgPSBwYXJhbXM7CiAgfQogIGdldCBieXRlcygpIHsKICAgIHJldHVybiAoMCwgX3V0aWwuc2hhZG93KSh0aGlzLCAiYnl0ZXMiLCB0aGlzLnN0cmVhbS5nZXRCeXRlcyh0aGlzLm1heWJlTGVuZ3RoKSk7CiAgfQogIGVuc3VyZUJ1ZmZlcihyZXF1ZXN0ZWQpIHt9CiAgcmVhZEJsb2NrKCkgewogICAgaWYgKHRoaXMuZW9mKSB7CiAgICAgIHJldHVybjsKICAgIH0KICAgIGNvbnN0IGpiaWcySW1hZ2UgPSBuZXcgX2piaWcuSmJpZzJJbWFnZSgpOwogICAgY29uc3QgY2h1bmtzID0gW107CiAgICBpZiAodGhpcy5wYXJhbXMgaW5zdGFuY2VvZiBfcHJpbWl0aXZlcy5EaWN0KSB7CiAgICAgIGNvbnN0IGdsb2JhbHNTdHJlYW0gPSB0aGlzLnBhcmFtcy5nZXQoIkpCSUcyR2xvYmFscyIpOwogICAgICBpZiAoZ2xvYmFsc1N0cmVhbSBpbnN0YW5jZW9mIF9iYXNlX3N0cmVhbS5CYXNlU3RyZWFtKSB7CiAgICAgICAgY29uc3QgZ2xvYmFscyA9IGdsb2JhbHNTdHJlYW0uZ2V0Qnl0ZXMoKTsKICAgICAgICBjaHVua3MucHVzaCh7CiAgICAgICAgICBkYXRhOiBnbG9iYWxzLAogICAgICAgICAgc3RhcnQ6IDAsCiAgICAgICAgICBlbmQ6IGdsb2JhbHMubGVuZ3RoCiAgICAgICAgfSk7CiAgICAgIH0KICAgIH0KICAgIGNodW5rcy5wdXNoKHsKICAgICAgZGF0YTogdGhpcy5ieXRlcywKICAgICAgc3RhcnQ6IDAsCiAgICAgIGVuZDogdGhpcy5ieXRlcy5sZW5ndGgKICAgIH0pOwogICAgY29uc3QgZGF0YSA9IGpiaWcySW1hZ2UucGFyc2VDaHVua3MoY2h1bmtzKTsKICAgIGNvbnN0IGRhdGFMZW5ndGggPSBkYXRhLmxlbmd0aDsKICAgIGZvciAobGV0IGkgPSAwOyBpIDwgZGF0YUxlbmd0aDsgaSsrKSB7CiAgICAgIGRhdGFbaV0gXj0gMHhmZjsKICAgIH0KICAgIHRoaXMuYnVmZmVyID0gZGF0YTsKICAgIHRoaXMuYnVmZmVyTGVuZ3RoID0gZGF0YUxlbmd0aDsKICAgIHRoaXMuZW9mID0gdHJ1ZTsKICB9Cn0KZXhwb3J0cy5KYmlnMlN0cmVhbSA9IEpiaWcyU3RyZWFtOwoKLyoqKi8gfSksCi8qIDI0ICovCi8qKiovICgoX191bnVzZWRfd2VicGFja19tb2R1bGUsIGV4cG9ydHMsIF9fd19wZGZqc19yZXF1aXJlX18pID0+IHsKCgoKT2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsICJfX2VzTW9kdWxlIiwgKHsKICB2YWx1ZTogdHJ1ZQp9KSk7CmV4cG9ydHMuSmJpZzJJbWFnZSA9IHZvaWQgMDsKdmFyIF91dGlsID0gX193X3BkZmpzX3JlcXVpcmVfXygyKTsKdmFyIF9jb3JlX3V0aWxzID0gX193X3BkZmpzX3JlcXVpcmVfXygzKTsKdmFyIF9hcml0aG1ldGljX2RlY29kZXIgPSBfX3dfcGRmanNfcmVxdWlyZV9fKDI1KTsKdmFyIF9jY2l0dCA9IF9fd19wZGZqc19yZXF1aXJlX18oMjEpOwpjbGFzcyBKYmlnMkVycm9yIGV4dGVuZHMgX3V0aWwuQmFzZUV4Y2VwdGlvbiB7CiAgY29uc3RydWN0b3IobXNnKSB7CiAgICBzdXBlcihgSkJJRzIgZXJyb3I6ICR7bXNnfWAsICJKYmlnMkVycm9yIik7CiAgfQp9CmNsYXNzIENvbnRleHRDYWNoZSB7CiAgZ2V0Q29udGV4dHMoaWQpIHsKICAgIGlmIChpZCBpbiB0aGlzKSB7CiAgICAgIHJldHVybiB0aGlzW2lkXTsKICAgIH0KICAgIHJldHVybiB0aGlzW2lkXSA9IG5ldyBJbnQ4QXJyYXkoMSA8PCAxNik7CiAgfQp9CmNsYXNzIERlY29kaW5nQ29udGV4dCB7CiAgY29uc3RydWN0b3IoZGF0YSwgc3RhcnQsIGVuZCkgewogICAgdGhpcy5kYXRhID0gZGF0YTsKICAgIHRoaXMuc3RhcnQgPSBzdGFydDsKICAgIHRoaXMuZW5kID0gZW5kOwogIH0KICBnZXQgZGVjb2RlcigpIHsKICAgIGNvbnN0IGRlY29kZXIgPSBuZXcgX2FyaXRobWV0aWNfZGVjb2Rlci5Bcml0aG1ldGljRGVjb2Rlcih0aGlzLmRhdGEsIHRoaXMuc3RhcnQsIHRoaXMuZW5kKTsKICAgIHJldHVybiAoMCwgX3V0aWwuc2hhZG93KSh0aGlzLCAiZGVjb2RlciIsIGRlY29kZXIpOwogIH0KICBnZXQgY29udGV4dENhY2hlKCkgewogICAgY29uc3QgY2FjaGUgPSBuZXcgQ29udGV4dENhY2hlKCk7CiAgICByZXR1cm4gKDAsIF91dGlsLnNoYWRvdykodGhpcywgImNvbnRleHRDYWNoZSIsIGNhY2hlKTsKICB9Cn0KY29uc3QgTUFYX0lOVF8zMiA9IDIgKiogMzEgLSAxOwpjb25zdCBNSU5fSU5UXzMyID0gLSgyICoqIDMxKTsKZnVuY3Rpb24gZGVjb2RlSW50ZWdlcihjb250ZXh0Q2FjaGUsIHByb2NlZHVyZSwgZGVjb2RlcikgewogIGNvbnN0IGNvbnRleHRzID0gY29udGV4dENhY2hlLmdldENvbnRleHRzKHByb2NlZHVyZSk7CiAgbGV0IHByZXYgPSAxOwogIGZ1bmN0aW9uIHJlYWRCaXRzKGxlbmd0aCkgewogICAgbGV0IHYgPSAwOwogICAgZm9yIChsZXQgaSA9IDA7IGkgPCBsZW5ndGg7IGkrKykgewogICAgICBjb25zdCBiaXQgPSBkZWNvZGVyLnJlYWRCaXQoY29udGV4dHMsIHByZXYpOwogICAgICBwcmV2ID0gcHJldiA8IDI1NiA/IHByZXYgPDwgMSB8IGJpdCA6IChwcmV2IDw8IDEgfCBiaXQpICYgNTExIHwgMjU2OwogICAgICB2ID0gdiA8PCAxIHwgYml0OwogICAgfQogICAgcmV0dXJuIHYgPj4+IDA7CiAgfQogIGNvbnN0IHNpZ24gPSByZWFkQml0cygxKTsKICBjb25zdCB2YWx1ZSA9IHJlYWRCaXRzKDEpID8gcmVhZEJpdHMoMSkgPyByZWFkQml0cygxKSA/IHJlYWRCaXRzKDEpID8gcmVhZEJpdHMoMSkgPyByZWFkQml0cygzMikgKyA0NDM2IDogcmVhZEJpdHMoMTIpICsgMzQwIDogcmVhZEJpdHMoOCkgKyA4NCA6IHJlYWRCaXRzKDYpICsgMjAgOiByZWFkQml0cyg0KSArIDQgOiByZWFkQml0cygyKTsKICBsZXQgc2lnbmVkVmFsdWU7CiAgaWYgKHNpZ24gPT09IDApIHsKICAgIHNpZ25lZFZhbHVlID0gdmFsdWU7CiAgfSBlbHNlIGlmICh2YWx1ZSA+IDApIHsKICAgIHNpZ25lZFZhbHVlID0gLXZhbHVlOwogIH0KICBpZiAoc2lnbmVkVmFsdWUgPj0gTUlOX0lOVF8zMiAmJiBzaWduZWRWYWx1ZSA8PSBNQVhfSU5UXzMyKSB7CiAgICByZXR1cm4gc2lnbmVkVmFsdWU7CiAgfQogIHJldHVybiBudWxsOwp9CmZ1bmN0aW9uIGRlY29kZUlBSUQoY29udGV4dENhY2hlLCBkZWNvZGVyLCBjb2RlTGVuZ3RoKSB7CiAgY29uc3QgY29udGV4dHMgPSBjb250ZXh0Q2FjaGUuZ2V0Q29udGV4dHMoIklBSUQiKTsKICBsZXQgcHJldiA9IDE7CiAgZm9yIChsZXQgaSA9IDA7IGkgPCBjb2RlTGVuZ3RoOyBpKyspIHsKICAgIGNvbnN0IGJpdCA9IGRlY29kZXIucmVhZEJpdChjb250ZXh0cywgcHJldik7CiAgICBwcmV2ID0gcHJldiA8PCAxIHwgYml0OwogIH0KICBpZiAoY29kZUxlbmd0aCA8IDMxKSB7CiAgICByZXR1cm4gcHJldiAmICgxIDw8IGNvZGVMZW5ndGgpIC0gMTsKICB9CiAgcmV0dXJuIHByZXYgJiAweDdmZmZmZmZmOwp9CmNvbnN0IFNlZ21lbnRUeXBlcyA9IFsiU3ltYm9sRGljdGlvbmFyeSIsIG51bGwsIG51bGwsIG51bGwsICJJbnRlcm1lZGlhdGVUZXh0UmVnaW9uIiwgbnVsbCwgIkltbWVkaWF0ZVRleHRSZWdpb24iLCAiSW1tZWRpYXRlTG9zc2xlc3NUZXh0UmVnaW9uIiwgbnVsbCwgbnVsbCwgbnVsbCwgbnVsbCwgbnVsbCwgbnVsbCwgbnVsbCwgbnVsbCwgIlBhdHRlcm5EaWN0aW9uYXJ5IiwgbnVsbCwgbnVsbCwgbnVsbCwgIkludGVybWVkaWF0ZUhhbGZ0b25lUmVnaW9uIiwgbnVsbCwgIkltbWVkaWF0ZUhhbGZ0b25lUmVnaW9uIiwgIkltbWVkaWF0ZUxvc3NsZXNzSGFsZnRvbmVSZWdpb24iLCBudWxsLCBudWxsLCBudWxsLCBudWxsLCBudWxsLCBudWxsLCBudWxsLCBudWxsLCBudWxsLCBudWxsLCBudWxsLCBudWxsLCAiSW50ZXJtZWRpYXRlR2VuZXJpY1JlZ2lvbiIsIG51bGwsICJJbW1lZGlhdGVHZW5lcmljUmVnaW9uIiwgIkltbWVkaWF0ZUxvc3NsZXNzR2VuZXJpY1JlZ2lvbiIsICJJbnRlcm1lZGlhdGVHZW5lcmljUmVmaW5lbWVudFJlZ2lvbiIsIG51bGwsICJJbW1lZGlhdGVHZW5lcmljUmVmaW5lbWVudFJlZ2lvbiIsICJJbW1lZGlhdGVMb3NzbGVzc0dlbmVyaWNSZWZpbmVtZW50UmVnaW9uIiwgbnVsbCwgbnVsbCwgbnVsbCwgbnVsbCwgIlBhZ2VJbmZvcm1hdGlvbiIsICJFbmRPZlBhZ2UiLCAiRW5kT2ZTdHJpcGUiLCAiRW5kT2ZGaWxlIiwgIlByb2ZpbGVzIiwgIlRhYmxlcyIsIG51bGwsIG51bGwsIG51bGwsIG51bGwsIG51bGwsIG51bGwsIG51bGwsIG51bGwsICJFeHRlbnNpb24iXTsKY29uc3QgQ29kaW5nVGVtcGxhdGVzID0gW1t7CiAgeDogLTEsCiAgeTogLTIKfSwgewogIHg6IDAsCiAgeTogLTIKfSwgewogIHg6IDEsCiAgeTogLTIKfSwgewogIHg6IC0yLAogIHk6IC0xCn0sIHsKICB4OiAtMSwKICB5OiAtMQp9LCB7CiAgeDogMCwKICB5OiAtMQp9LCB7CiAgeDogMSwKICB5OiAtMQp9LCB7CiAgeDogMiwKICB5OiAtMQp9LCB7CiAgeDogLTQsCiAgeTogMAp9LCB7CiAgeDogLTMsCiAgeTogMAp9LCB7CiAgeDogLTIsCiAgeTogMAp9LCB7CiAgeDogLTEsCiAgeTogMAp9XSwgW3sKICB4OiAtMSwKICB5OiAtMgp9LCB7CiAgeDogMCwKICB5OiAtMgp9LCB7CiAgeDogMSwKICB5OiAtMgp9LCB7CiAgeDogMiwKICB5OiAtMgp9LCB7CiAgeDogLTIsCiAgeTogLTEKfSwgewogIHg6IC0xLAogIHk6IC0xCn0sIHsKICB4OiAwLAogIHk6IC0xCn0sIHsKICB4OiAxLAogIHk6IC0xCn0sIHsKICB4OiAyLAogIHk6IC0xCn0sIHsKICB4OiAtMywKICB5OiAwCn0sIHsKICB4OiAtMiwKICB5OiAwCn0sIHsKICB4OiAtMSwKICB5OiAwCn1dLCBbewogIHg6IC0xLAogIHk6IC0yCn0sIHsKICB4OiAwLAogIHk6IC0yCn0sIHsKICB4OiAxLAogIHk6IC0yCn0sIHsKICB4OiAtMiwKICB5OiAtMQp9LCB7CiAgeDogLTEsCiAgeTogLTEKfSwgewogIHg6IDAsCiAgeTogLTEKfSwgewogIHg6IDEsCiAgeTogLTEKfSwgewogIHg6IC0yLAogIHk6IDAKfSwgewogIHg6IC0xLAogIHk6IDAKfV0sIFt7CiAgeDogLTMsCiAgeTogLTEKfSwgewogIHg6IC0yLAogIHk6IC0xCn0sIHsKICB4OiAtMSwKICB5OiAtMQp9LCB7CiAgeDogMCwKICB5OiAtMQp9LCB7CiAgeDogMSwKICB5OiAtMQp9LCB7CiAgeDogLTQsCiAgeTogMAp9LCB7CiAgeDogLTMsCiAgeTogMAp9LCB7CiAgeDogLTIsCiAgeTogMAp9LCB7CiAgeDogLTEsCiAgeTogMAp9XV07CmNvbnN0IFJlZmluZW1lbnRUZW1wbGF0ZXMgPSBbewogIGNvZGluZzogW3sKICAgIHg6IDAsCiAgICB5OiAtMQogIH0sIHsKICAgIHg6IDEsCiAgICB5OiAtMQogIH0sIHsKICAgIHg6IC0xLAogICAgeTogMAogIH1dLAogIHJlZmVyZW5jZTogW3sKICAgIHg6IDAsCiAgICB5OiAtMQogIH0sIHsKICAgIHg6IDEsCiAgICB5OiAtMQogIH0sIHsKICAgIHg6IC0xLAogICAgeTogMAogIH0sIHsKICAgIHg6IDAsCiAgICB5OiAwCiAgfSwgewogICAgeDogMSwKICAgIHk6IDAKICB9LCB7CiAgICB4OiAtMSwKICAgIHk6IDEKICB9LCB7CiAgICB4OiAwLAogICAgeTogMQogIH0sIHsKICAgIHg6IDEsCiAgICB5OiAxCiAgfV0KfSwgewogIGNvZGluZzogW3sKICAgIHg6IC0xLAogICAgeTogLTEKICB9LCB7CiAgICB4OiAwLAogICAgeTogLTEKICB9LCB7CiAgICB4OiAxLAogICAgeTogLTEKICB9LCB7CiAgICB4OiAtMSwKICAgIHk6IDAKICB9XSwKICByZWZlcmVuY2U6IFt7CiAgICB4OiAwLAogICAgeTogLTEKICB9LCB7CiAgICB4OiAtMSwKICAgIHk6IDAKICB9LCB7CiAgICB4OiAwLAogICAgeTogMAogIH0sIHsKICAgIHg6IDEsCiAgICB5OiAwCiAgfSwgewogICAgeDogMCwKICAgIHk6IDEKICB9LCB7CiAgICB4OiAxLAogICAgeTogMQogIH1dCn1dOwpjb25zdCBSZXVzZWRDb250ZXh0cyA9IFsweDliMjUsIDB4MDc5NSwgMHgwMGU1LCAweDAxOTVdOwpjb25zdCBSZWZpbmVtZW50UmV1c2VkQ29udGV4dHMgPSBbMHgwMDIwLCAweDAwMDhdOwpmdW5jdGlvbiBkZWNvZGVCaXRtYXBUZW1wbGF0ZTAod2lkdGgsIGhlaWdodCwgZGVjb2RpbmdDb250ZXh0KSB7CiAgY29uc3QgZGVjb2RlciA9IGRlY29kaW5nQ29udGV4dC5kZWNvZGVyOwogIGNvbnN0IGNvbnRleHRzID0gZGVjb2RpbmdDb250ZXh0LmNvbnRleHRDYWNoZS5nZXRDb250ZXh0cygiR0IiKTsKICBjb25zdCBiaXRtYXAgPSBbXTsKICBsZXQgY29udGV4dExhYmVsLCBpLCBqLCBwaXhlbCwgcm93LCByb3cxLCByb3cyOwogIGNvbnN0IE9MRF9QSVhFTF9NQVNLID0gMHg3YmY3OwogIGZvciAoaSA9IDA7IGkgPCBoZWlnaHQ7IGkrKykgewogICAgcm93ID0gYml0bWFwW2ldID0gbmV3IFVpbnQ4QXJyYXkod2lkdGgpOwogICAgcm93MSA9IGkgPCAxID8gcm93IDogYml0bWFwW2kgLSAxXTsKICAgIHJvdzIgPSBpIDwgMiA/IHJvdyA6IGJpdG1hcFtpIC0gMl07CiAgICBjb250ZXh0TGFiZWwgPSByb3cyWzBdIDw8IDEzIHwgcm93MlsxXSA8PCAxMiB8IHJvdzJbMl0gPDwgMTEgfCByb3cxWzBdIDw8IDcgfCByb3cxWzFdIDw8IDYgfCByb3cxWzJdIDw8IDUgfCByb3cxWzNdIDw8IDQ7CiAgICBmb3IgKGogPSAwOyBqIDwgd2lkdGg7IGorKykgewogICAgICByb3dbal0gPSBwaXhlbCA9IGRlY29kZXIucmVhZEJpdChjb250ZXh0cywgY29udGV4dExhYmVsKTsKICAgICAgY29udGV4dExhYmVsID0gKGNvbnRleHRMYWJlbCAmIE9MRF9QSVhFTF9NQVNLKSA8PCAxIHwgKGogKyAzIDwgd2lkdGggPyByb3cyW2ogKyAzXSA8PCAxMSA6IDApIHwgKGogKyA0IDwgd2lkdGggPyByb3cxW2ogKyA0XSA8PCA0IDogMCkgfCBwaXhlbDsKICAgIH0KICB9CiAgcmV0dXJuIGJpdG1hcDsKfQpmdW5jdGlvbiBkZWNvZGVCaXRtYXAobW1yLCB3aWR0aCwgaGVpZ2h0LCB0ZW1wbGF0ZUluZGV4LCBwcmVkaWN0aW9uLCBza2lwLCBhdCwgZGVjb2RpbmdDb250ZXh0KSB7CiAgaWYgKG1tcikgewogICAgY29uc3QgaW5wdXQgPSBuZXcgUmVhZGVyKGRlY29kaW5nQ29udGV4dC5kYXRhLCBkZWNvZGluZ0NvbnRleHQuc3RhcnQsIGRlY29kaW5nQ29udGV4dC5lbmQpOwogICAgcmV0dXJuIGRlY29kZU1NUkJpdG1hcChpbnB1dCwgd2lkdGgsIGhlaWdodCwgZmFsc2UpOwogIH0KICBpZiAodGVtcGxhdGVJbmRleCA9PT0gMCAmJiAhc2tpcCAmJiAhcHJlZGljdGlvbiAmJiBhdC5sZW5ndGggPT09IDQgJiYgYXRbMF0ueCA9PT0gMyAmJiBhdFswXS55ID09PSAtMSAmJiBhdFsxXS54ID09PSAtMyAmJiBhdFsxXS55ID09PSAtMSAmJiBhdFsyXS54ID09PSAyICYmIGF0WzJdLnkgPT09IC0yICYmIGF0WzNdLnggPT09IC0yICYmIGF0WzNdLnkgPT09IC0yKSB7CiAgICByZXR1cm4gZGVjb2RlQml0bWFwVGVtcGxhdGUwKHdpZHRoLCBoZWlnaHQsIGRlY29kaW5nQ29udGV4dCk7CiAgfQogIGNvbnN0IHVzZXNraXAgPSAhIXNraXA7CiAgY29uc3QgdGVtcGxhdGUgPSBDb2RpbmdUZW1wbGF0ZXNbdGVtcGxhdGVJbmRleF0uY29uY2F0KGF0KTsKICB0ZW1wbGF0ZS5zb3J0KGZ1bmN0aW9uIChhLCBiKSB7CiAgICByZXR1cm4gYS55IC0gYi55IHx8IGEueCAtIGIueDsKICB9KTsKICBjb25zdCB0ZW1wbGF0ZUxlbmd0aCA9IHRlbXBsYXRlLmxlbmd0aDsKICBjb25zdCB0ZW1wbGF0ZVggPSBuZXcgSW50OEFycmF5KHRlbXBsYXRlTGVuZ3RoKTsKICBjb25zdCB0ZW1wbGF0ZVkgPSBuZXcgSW50OEFycmF5KHRlbXBsYXRlTGVuZ3RoKTsKICBjb25zdCBjaGFuZ2luZ1RlbXBsYXRlRW50cmllcyA9IFtdOwogIGxldCByZXVzZU1hc2sgPSAwLAogICAgbWluWCA9IDAsCiAgICBtYXhYID0gMCwKICAgIG1pblkgPSAwOwogIGxldCBjLCBrOwogIGZvciAoayA9IDA7IGsgPCB0ZW1wbGF0ZUxlbmd0aDsgaysrKSB7CiAgICB0ZW1wbGF0ZVhba10gPSB0ZW1wbGF0ZVtrXS54OwogICAgdGVtcGxhdGVZW2tdID0gdGVtcGxhdGVba10ueTsKICAgIG1pblggPSBNYXRoLm1pbihtaW5YLCB0ZW1wbGF0ZVtrXS54KTsKICAgIG1heFggPSBNYXRoLm1heChtYXhYLCB0ZW1wbGF0ZVtrXS54KTsKICAgIG1pblkgPSBNYXRoLm1pbihtaW5ZLCB0ZW1wbGF0ZVtrXS55KTsKICAgIGlmIChrIDwgdGVtcGxhdGVMZW5ndGggLSAxICYmIHRlbXBsYXRlW2tdLnkgPT09IHRlbXBsYXRlW2sgKyAxXS55ICYmIHRlbXBsYXRlW2tdLnggPT09IHRlbXBsYXRlW2sgKyAxXS54IC0gMSkgewogICAgICByZXVzZU1hc2sgfD0gMSA8PCB0ZW1wbGF0ZUxlbmd0aCAtIDEgLSBrOwogICAgfSBlbHNlIHsKICAgICAgY2hhbmdpbmdUZW1wbGF0ZUVudHJpZXMucHVzaChrKTsKICAgIH0KICB9CiAgY29uc3QgY2hhbmdpbmdFbnRyaWVzTGVuZ3RoID0gY2hhbmdpbmdUZW1wbGF0ZUVudHJpZXMubGVuZ3RoOwogIGNvbnN0IGNoYW5naW5nVGVtcGxhdGVYID0gbmV3IEludDhBcnJheShjaGFuZ2luZ0VudHJpZXNMZW5ndGgpOwogIGNvbnN0IGNoYW5naW5nVGVtcGxhdGVZID0gbmV3IEludDhBcnJheShjaGFuZ2luZ0VudHJpZXNMZW5ndGgpOwogIGNvbnN0IGNoYW5naW5nVGVtcGxhdGVCaXQgPSBuZXcgVWludDE2QXJyYXkoY2hhbmdpbmdFbnRyaWVzTGVuZ3RoKTsKICBmb3IgKGMgPSAwOyBjIDwgY2hhbmdpbmdFbnRyaWVzTGVuZ3RoOyBjKyspIHsKICAgIGsgPSBjaGFuZ2luZ1RlbXBsYXRlRW50cmllc1tjXTsKICAgIGNoYW5naW5nVGVtcGxhdGVYW2NdID0gdGVtcGxhdGVba10ueDsKICAgIGNoYW5naW5nVGVtcGxhdGVZW2NdID0gdGVtcGxhdGVba10ueTsKICAgIGNoYW5naW5nVGVtcGxhdGVCaXRbY10gPSAxIDw8IHRlbXBsYXRlTGVuZ3RoIC0gMSAtIGs7CiAgfQogIGNvbnN0IHNiYl9sZWZ0ID0gLW1pblg7CiAgY29uc3Qgc2JiX3RvcCA9IC1taW5ZOwogIGNvbnN0IHNiYl9yaWdodCA9IHdpZHRoIC0gbWF4WDsKICBjb25zdCBwc2V1ZG9QaXhlbENvbnRleHQgPSBSZXVzZWRDb250ZXh0c1t0ZW1wbGF0ZUluZGV4XTsKICBsZXQgcm93ID0gbmV3IFVpbnQ4QXJyYXkod2lkdGgpOwogIGNvbnN0IGJpdG1hcCA9IFtdOwogIGNvbnN0IGRlY29kZXIgPSBkZWNvZGluZ0NvbnRleHQuZGVjb2RlcjsKICBjb25zdCBjb250ZXh0cyA9IGRlY29kaW5nQ29udGV4dC5jb250ZXh0Q2FjaGUuZ2V0Q29udGV4dHMoIkdCIik7CiAgbGV0IGx0cCA9IDAsCiAgICBqLAogICAgaTAsCiAgICBqMCwKICAgIGNvbnRleHRMYWJlbCA9IDAsCiAgICBiaXQsCiAgICBzaGlmdDsKICBmb3IgKGxldCBpID0gMDsgaSA8IGhlaWdodDsgaSsrKSB7CiAgICBpZiAocHJlZGljdGlvbikgewogICAgICBjb25zdCBzbHRwID0gZGVjb2Rlci5yZWFkQml0KGNvbnRleHRzLCBwc2V1ZG9QaXhlbENvbnRleHQpOwogICAgICBsdHAgXj0gc2x0cDsKICAgICAgaWYgKGx0cCkgewogICAgICAgIGJpdG1hcC5wdXNoKHJvdyk7CiAgICAgICAgY29udGludWU7CiAgICAgIH0KICAgIH0KICAgIHJvdyA9IG5ldyBVaW50OEFycmF5KHJvdyk7CiAgICBiaXRtYXAucHVzaChyb3cpOwogICAgZm9yIChqID0gMDsgaiA8IHdpZHRoOyBqKyspIHsKICAgICAgaWYgKHVzZXNraXAgJiYgc2tpcFtpXVtqXSkgewogICAgICAgIHJvd1tqXSA9IDA7CiAgICAgICAgY29udGludWU7CiAgICAgIH0KICAgICAgaWYgKGogPj0gc2JiX2xlZnQgJiYgaiA8IHNiYl9yaWdodCAmJiBpID49IHNiYl90b3ApIHsKICAgICAgICBjb250ZXh0TGFiZWwgPSBjb250ZXh0TGFiZWwgPDwgMSAmIHJldXNlTWFzazsKICAgICAgICBmb3IgKGsgPSAwOyBrIDwgY2hhbmdpbmdFbnRyaWVzTGVuZ3RoOyBrKyspIHsKICAgICAgICAgIGkwID0gaSArIGNoYW5naW5nVGVtcGxhdGVZW2tdOwogICAgICAgICAgajAgPSBqICsgY2hhbmdpbmdUZW1wbGF0ZVhba107CiAgICAgICAgICBiaXQgPSBiaXRtYXBbaTBdW2owXTsKICAgICAgICAgIGlmIChiaXQpIHsKICAgICAgICAgICAgYml0ID0gY2hhbmdpbmdUZW1wbGF0ZUJpdFtrXTsKICAgICAgICAgICAgY29udGV4dExhYmVsIHw9IGJpdDsKICAgICAgICAgIH0KICAgICAgICB9CiAgICAgIH0gZWxzZSB7CiAgICAgICAgY29udGV4dExhYmVsID0gMDsKICAgICAgICBzaGlmdCA9IHRlbXBsYXRlTGVuZ3RoIC0gMTsKICAgICAgICBmb3IgKGsgPSAwOyBrIDwgdGVtcGxhdGVMZW5ndGg7IGsrKywgc2hpZnQtLSkgewogICAgICAgICAgajAgPSBqICsgdGVtcGxhdGVYW2tdOwogICAgICAgICAgaWYgKGowID49IDAgJiYgajAgPCB3aWR0aCkgewogICAgICAgICAgICBpMCA9IGkgKyB0ZW1wbGF0ZVlba107CiAgICAgICAgICAgIGlmIChpMCA+PSAwKSB7CiAgICAgICAgICAgICAgYml0ID0gYml0bWFwW2kwXVtqMF07CiAgICAgICAgICAgICAgaWYgKGJpdCkgewogICAgICAgICAgICAgICAgY29udGV4dExhYmVsIHw9IGJpdCA8PCBzaGlmdDsKICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICB9CiAgICAgIH0KICAgICAgY29uc3QgcGl4ZWwgPSBkZWNvZGVyLnJlYWRCaXQoY29udGV4dHMsIGNvbnRleHRMYWJlbCk7CiAgICAgIHJvd1tqXSA9IHBpeGVsOwogICAgfQogIH0KICByZXR1cm4gYml0bWFwOwp9CmZ1bmN0aW9uIGRlY29kZVJlZmluZW1lbnQod2lkdGgsIGhlaWdodCwgdGVtcGxhdGVJbmRleCwgcmVmZXJlbmNlQml0bWFwLCBvZmZzZXRYLCBvZmZzZXRZLCBwcmVkaWN0aW9uLCBhdCwgZGVjb2RpbmdDb250ZXh0KSB7CiAgbGV0IGNvZGluZ1RlbXBsYXRlID0gUmVmaW5lbWVudFRlbXBsYXRlc1t0ZW1wbGF0ZUluZGV4XS5jb2Rpbmc7CiAgaWYgKHRlbXBsYXRlSW5kZXggPT09IDApIHsKICAgIGNvZGluZ1RlbXBsYXRlID0gY29kaW5nVGVtcGxhdGUuY29uY2F0KFthdFswXV0pOwogIH0KICBjb25zdCBjb2RpbmdUZW1wbGF0ZUxlbmd0aCA9IGNvZGluZ1RlbXBsYXRlLmxlbmd0aDsKICBjb25zdCBjb2RpbmdUZW1wbGF0ZVggPSBuZXcgSW50MzJBcnJheShjb2RpbmdUZW1wbGF0ZUxlbmd0aCk7CiAgY29uc3QgY29kaW5nVGVtcGxhdGVZID0gbmV3IEludDMyQXJyYXkoY29kaW5nVGVtcGxhdGVMZW5ndGgpOwogIGxldCBrOwogIGZvciAoayA9IDA7IGsgPCBjb2RpbmdUZW1wbGF0ZUxlbmd0aDsgaysrKSB7CiAgICBjb2RpbmdUZW1wbGF0ZVhba10gPSBjb2RpbmdUZW1wbGF0ZVtrXS54OwogICAgY29kaW5nVGVtcGxhdGVZW2tdID0gY29kaW5nVGVtcGxhdGVba10ueTsKICB9CiAgbGV0IHJlZmVyZW5jZVRlbXBsYXRlID0gUmVmaW5lbWVudFRlbXBsYXRlc1t0ZW1wbGF0ZUluZGV4XS5yZWZlcmVuY2U7CiAgaWYgKHRlbXBsYXRlSW5kZXggPT09IDApIHsKICAgIHJlZmVyZW5jZVRlbXBsYXRlID0gcmVmZXJlbmNlVGVtcGxhdGUuY29uY2F0KFthdFsxXV0pOwogIH0KICBjb25zdCByZWZlcmVuY2VUZW1wbGF0ZUxlbmd0aCA9IHJlZmVyZW5jZVRlbXBsYXRlLmxlbmd0aDsKICBjb25zdCByZWZlcmVuY2VUZW1wbGF0ZVggPSBuZXcgSW50MzJBcnJheShyZWZlcmVuY2VUZW1wbGF0ZUxlbmd0aCk7CiAgY29uc3QgcmVmZXJlbmNlVGVtcGxhdGVZID0gbmV3IEludDMyQXJyYXkocmVmZXJlbmNlVGVtcGxhdGVMZW5ndGgpOwogIGZvciAoayA9IDA7IGsgPCByZWZlcmVuY2VUZW1wbGF0ZUxlbmd0aDsgaysrKSB7CiAgICByZWZlcmVuY2VUZW1wbGF0ZVhba10gPSByZWZlcmVuY2VUZW1wbGF0ZVtrXS54OwogICAgcmVmZXJlbmNlVGVtcGxhdGVZW2tdID0gcmVmZXJlbmNlVGVtcGxhdGVba10ueTsKICB9CiAgY29uc3QgcmVmZXJlbmNlV2lkdGggPSByZWZlcmVuY2VCaXRtYXBbMF0ubGVuZ3RoOwogIGNvbnN0IHJlZmVyZW5jZUhlaWdodCA9IHJlZmVyZW5jZUJpdG1hcC5sZW5ndGg7CiAgY29uc3QgcHNldWRvUGl4ZWxDb250ZXh0ID0gUmVmaW5lbWVudFJldXNlZENvbnRleHRzW3RlbXBsYXRlSW5kZXhdOwogIGNvbnN0IGJpdG1hcCA9IFtdOwogIGNvbnN0IGRlY29kZXIgPSBkZWNvZGluZ0NvbnRleHQuZGVjb2RlcjsKICBjb25zdCBjb250ZXh0cyA9IGRlY29kaW5nQ29udGV4dC5jb250ZXh0Q2FjaGUuZ2V0Q29udGV4dHMoIkdSIik7CiAgbGV0IGx0cCA9IDA7CiAgZm9yIChsZXQgaSA9IDA7IGkgPCBoZWlnaHQ7IGkrKykgewogICAgaWYgKHByZWRpY3Rpb24pIHsKICAgICAgY29uc3Qgc2x0cCA9IGRlY29kZXIucmVhZEJpdChjb250ZXh0cywgcHNldWRvUGl4ZWxDb250ZXh0KTsKICAgICAgbHRwIF49IHNsdHA7CiAgICAgIGlmIChsdHApIHsKICAgICAgICB0aHJvdyBuZXcgSmJpZzJFcnJvcigicHJlZGljdGlvbiBpcyBub3Qgc3VwcG9ydGVkIik7CiAgICAgIH0KICAgIH0KICAgIGNvbnN0IHJvdyA9IG5ldyBVaW50OEFycmF5KHdpZHRoKTsKICAgIGJpdG1hcC5wdXNoKHJvdyk7CiAgICBmb3IgKGxldCBqID0gMDsgaiA8IHdpZHRoOyBqKyspIHsKICAgICAgbGV0IGkwLCBqMDsKICAgICAgbGV0IGNvbnRleHRMYWJlbCA9IDA7CiAgICAgIGZvciAoayA9IDA7IGsgPCBjb2RpbmdUZW1wbGF0ZUxlbmd0aDsgaysrKSB7CiAgICAgICAgaTAgPSBpICsgY29kaW5nVGVtcGxhdGVZW2tdOwogICAgICAgIGowID0gaiArIGNvZGluZ1RlbXBsYXRlWFtrXTsKICAgICAgICBpZiAoaTAgPCAwIHx8IGowIDwgMCB8fCBqMCA+PSB3aWR0aCkgewogICAgICAgICAgY29udGV4dExhYmVsIDw8PSAxOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICBjb250ZXh0TGFiZWwgPSBjb250ZXh0TGFiZWwgPDwgMSB8IGJpdG1hcFtpMF1bajBdOwogICAgICAgIH0KICAgICAgfQogICAgICBmb3IgKGsgPSAwOyBrIDwgcmVmZXJlbmNlVGVtcGxhdGVMZW5ndGg7IGsrKykgewogICAgICAgIGkwID0gaSArIHJlZmVyZW5jZVRlbXBsYXRlWVtrXSAtIG9mZnNldFk7CiAgICAgICAgajAgPSBqICsgcmVmZXJlbmNlVGVtcGxhdGVYW2tdIC0gb2Zmc2V0WDsKICAgICAgICBpZiAoaTAgPCAwIHx8IGkwID49IHJlZmVyZW5jZUhlaWdodCB8fCBqMCA8IDAgfHwgajAgPj0gcmVmZXJlbmNlV2lkdGgpIHsKICAgICAgICAgIGNvbnRleHRMYWJlbCA8PD0gMTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgY29udGV4dExhYmVsID0gY29udGV4dExhYmVsIDw8IDEgfCByZWZlcmVuY2VCaXRtYXBbaTBdW2owXTsKICAgICAgICB9CiAgICAgIH0KICAgICAgY29uc3QgcGl4ZWwgPSBkZWNvZGVyLnJlYWRCaXQoY29udGV4dHMsIGNvbnRleHRMYWJlbCk7CiAgICAgIHJvd1tqXSA9IHBpeGVsOwogICAgfQogIH0KICByZXR1cm4gYml0bWFwOwp9CmZ1bmN0aW9uIGRlY29kZVN5bWJvbERpY3Rpb25hcnkoaHVmZm1hbiwgcmVmaW5lbWVudCwgc3ltYm9scywgbnVtYmVyT2ZOZXdTeW1ib2xzLCBudW1iZXJPZkV4cG9ydGVkU3ltYm9scywgaHVmZm1hblRhYmxlcywgdGVtcGxhdGVJbmRleCwgYXQsIHJlZmluZW1lbnRUZW1wbGF0ZUluZGV4LCByZWZpbmVtZW50QXQsIGRlY29kaW5nQ29udGV4dCwgaHVmZm1hbklucHV0KSB7CiAgaWYgKGh1ZmZtYW4gJiYgcmVmaW5lbWVudCkgewogICAgdGhyb3cgbmV3IEpiaWcyRXJyb3IoInN5bWJvbCByZWZpbmVtZW50IHdpdGggSHVmZm1hbiBpcyBub3Qgc3VwcG9ydGVkIik7CiAgfQogIGNvbnN0IG5ld1N5bWJvbHMgPSBbXTsKICBsZXQgY3VycmVudEhlaWdodCA9IDA7CiAgbGV0IHN5bWJvbENvZGVMZW5ndGggPSAoMCwgX2NvcmVfdXRpbHMubG9nMikoc3ltYm9scy5sZW5ndGggKyBudW1iZXJPZk5ld1N5bWJvbHMpOwogIGNvbnN0IGRlY29kZXIgPSBkZWNvZGluZ0NvbnRleHQuZGVjb2RlcjsKICBjb25zdCBjb250ZXh0Q2FjaGUgPSBkZWNvZGluZ0NvbnRleHQuY29udGV4dENhY2hlOwogIGxldCB0YWJsZUIxLCBzeW1ib2xXaWR0aHM7CiAgaWYgKGh1ZmZtYW4pIHsKICAgIHRhYmxlQjEgPSBnZXRTdGFuZGFyZFRhYmxlKDEpOwogICAgc3ltYm9sV2lkdGhzID0gW107CiAgICBzeW1ib2xDb2RlTGVuZ3RoID0gTWF0aC5tYXgoc3ltYm9sQ29kZUxlbmd0aCwgMSk7CiAgfQogIHdoaWxlIChuZXdTeW1ib2xzLmxlbmd0aCA8IG51bWJlck9mTmV3U3ltYm9scykgewogICAgY29uc3QgZGVsdGFIZWlnaHQgPSBodWZmbWFuID8gaHVmZm1hblRhYmxlcy50YWJsZURlbHRhSGVpZ2h0LmRlY29kZShodWZmbWFuSW5wdXQpIDogZGVjb2RlSW50ZWdlcihjb250ZXh0Q2FjaGUsICJJQURIIiwgZGVjb2Rlcik7CiAgICBjdXJyZW50SGVpZ2h0ICs9IGRlbHRhSGVpZ2h0OwogICAgbGV0IGN1cnJlbnRXaWR0aCA9IDAsCiAgICAgIHRvdGFsV2lkdGggPSAwOwogICAgY29uc3QgZmlyc3RTeW1ib2wgPSBodWZmbWFuID8gc3ltYm9sV2lkdGhzLmxlbmd0aCA6IDA7CiAgICB3aGlsZSAodHJ1ZSkgewogICAgICBjb25zdCBkZWx0YVdpZHRoID0gaHVmZm1hbiA/IGh1ZmZtYW5UYWJsZXMudGFibGVEZWx0YVdpZHRoLmRlY29kZShodWZmbWFuSW5wdXQpIDogZGVjb2RlSW50ZWdlcihjb250ZXh0Q2FjaGUsICJJQURXIiwgZGVjb2Rlcik7CiAgICAgIGlmIChkZWx0YVdpZHRoID09PSBudWxsKSB7CiAgICAgICAgYnJlYWs7CiAgICAgIH0KICAgICAgY3VycmVudFdpZHRoICs9IGRlbHRhV2lkdGg7CiAgICAgIHRvdGFsV2lkdGggKz0gY3VycmVudFdpZHRoOwogICAgICBsZXQgYml0bWFwOwogICAgICBpZiAocmVmaW5lbWVudCkgewogICAgICAgIGNvbnN0IG51bWJlck9mSW5zdGFuY2VzID0gZGVjb2RlSW50ZWdlcihjb250ZXh0Q2FjaGUsICJJQUFJIiwgZGVjb2Rlcik7CiAgICAgICAgaWYgKG51bWJlck9mSW5zdGFuY2VzID4gMSkgewogICAgICAgICAgYml0bWFwID0gZGVjb2RlVGV4dFJlZ2lvbihodWZmbWFuLCByZWZpbmVtZW50LCBjdXJyZW50V2lkdGgsIGN1cnJlbnRIZWlnaHQsIDAsIG51bWJlck9mSW5zdGFuY2VzLCAxLCBzeW1ib2xzLmNvbmNhdChuZXdTeW1ib2xzKSwgc3ltYm9sQ29kZUxlbmd0aCwgMCwgMCwgMSwgMCwgaHVmZm1hblRhYmxlcywgcmVmaW5lbWVudFRlbXBsYXRlSW5kZXgsIHJlZmluZW1lbnRBdCwgZGVjb2RpbmdDb250ZXh0LCAwLCBodWZmbWFuSW5wdXQpOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICBjb25zdCBzeW1ib2xJZCA9IGRlY29kZUlBSUQoY29udGV4dENhY2hlLCBkZWNvZGVyLCBzeW1ib2xDb2RlTGVuZ3RoKTsKICAgICAgICAgIGNvbnN0IHJkeCA9IGRlY29kZUludGVnZXIoY29udGV4dENhY2hlLCAiSUFSRFgiLCBkZWNvZGVyKTsKICAgICAgICAgIGNvbnN0IHJkeSA9IGRlY29kZUludGVnZXIoY29udGV4dENhY2hlLCAiSUFSRFkiLCBkZWNvZGVyKTsKICAgICAgICAgIGNvbnN0IHN5bWJvbCA9IHN5bWJvbElkIDwgc3ltYm9scy5sZW5ndGggPyBzeW1ib2xzW3N5bWJvbElkXSA6IG5ld1N5bWJvbHNbc3ltYm9sSWQgLSBzeW1ib2xzLmxlbmd0aF07CiAgICAgICAgICBiaXRtYXAgPSBkZWNvZGVSZWZpbmVtZW50KGN1cnJlbnRXaWR0aCwgY3VycmVudEhlaWdodCwgcmVmaW5lbWVudFRlbXBsYXRlSW5kZXgsIHN5bWJvbCwgcmR4LCByZHksIGZhbHNlLCByZWZpbmVtZW50QXQsIGRlY29kaW5nQ29udGV4dCk7CiAgICAgICAgfQogICAgICAgIG5ld1N5bWJvbHMucHVzaChiaXRtYXApOwogICAgICB9IGVsc2UgaWYgKGh1ZmZtYW4pIHsKICAgICAgICBzeW1ib2xXaWR0aHMucHVzaChjdXJyZW50V2lkdGgpOwogICAgICB9IGVsc2UgewogICAgICAgIGJpdG1hcCA9IGRlY29kZUJpdG1hcChmYWxzZSwgY3VycmVudFdpZHRoLCBjdXJyZW50SGVpZ2h0LCB0ZW1wbGF0ZUluZGV4LCBmYWxzZSwgbnVsbCwgYXQsIGRlY29kaW5nQ29udGV4dCk7CiAgICAgICAgbmV3U3ltYm9scy5wdXNoKGJpdG1hcCk7CiAgICAgIH0KICAgIH0KICAgIGlmIChodWZmbWFuICYmICFyZWZpbmVtZW50KSB7CiAgICAgIGNvbnN0IGJpdG1hcFNpemUgPSBodWZmbWFuVGFibGVzLnRhYmxlQml0bWFwU2l6ZS5kZWNvZGUoaHVmZm1hbklucHV0KTsKICAgICAgaHVmZm1hbklucHV0LmJ5dGVBbGlnbigpOwogICAgICBsZXQgY29sbGVjdGl2ZUJpdG1hcDsKICAgICAgaWYgKGJpdG1hcFNpemUgPT09IDApIHsKICAgICAgICBjb2xsZWN0aXZlQml0bWFwID0gcmVhZFVuY29tcHJlc3NlZEJpdG1hcChodWZmbWFuSW5wdXQsIHRvdGFsV2lkdGgsIGN1cnJlbnRIZWlnaHQpOwogICAgICB9IGVsc2UgewogICAgICAgIGNvbnN0IG9yaWdpbmFsRW5kID0gaHVmZm1hbklucHV0LmVuZDsKICAgICAgICBjb25zdCBiaXRtYXBFbmQgPSBodWZmbWFuSW5wdXQucG9zaXRpb24gKyBiaXRtYXBTaXplOwogICAgICAgIGh1ZmZtYW5JbnB1dC5lbmQgPSBiaXRtYXBFbmQ7CiAgICAgICAgY29sbGVjdGl2ZUJpdG1hcCA9IGRlY29kZU1NUkJpdG1hcChodWZmbWFuSW5wdXQsIHRvdGFsV2lkdGgsIGN1cnJlbnRIZWlnaHQsIGZhbHNlKTsKICAgICAgICBodWZmbWFuSW5wdXQuZW5kID0gb3JpZ2luYWxFbmQ7CiAgICAgICAgaHVmZm1hbklucHV0LnBvc2l0aW9uID0gYml0bWFwRW5kOwogICAgICB9CiAgICAgIGNvbnN0IG51bWJlck9mU3ltYm9sc0RlY29kZWQgPSBzeW1ib2xXaWR0aHMubGVuZ3RoOwogICAgICBpZiAoZmlyc3RTeW1ib2wgPT09IG51bWJlck9mU3ltYm9sc0RlY29kZWQgLSAxKSB7CiAgICAgICAgbmV3U3ltYm9scy5wdXNoKGNvbGxlY3RpdmVCaXRtYXApOwogICAgICB9IGVsc2UgewogICAgICAgIGxldCBpLAogICAgICAgICAgeSwKICAgICAgICAgIHhNaW4gPSAwLAogICAgICAgICAgeE1heCwKICAgICAgICAgIGJpdG1hcFdpZHRoLAogICAgICAgICAgc3ltYm9sQml0bWFwOwogICAgICAgIGZvciAoaSA9IGZpcnN0U3ltYm9sOyBpIDwgbnVtYmVyT2ZTeW1ib2xzRGVjb2RlZDsgaSsrKSB7CiAgICAgICAgICBiaXRtYXBXaWR0aCA9IHN5bWJvbFdpZHRoc1tpXTsKICAgICAgICAgIHhNYXggPSB4TWluICsgYml0bWFwV2lkdGg7CiAgICAgICAgICBzeW1ib2xCaXRtYXAgPSBbXTsKICAgICAgICAgIGZvciAoeSA9IDA7IHkgPCBjdXJyZW50SGVpZ2h0OyB5KyspIHsKICAgICAgICAgICAgc3ltYm9sQml0bWFwLnB1c2goY29sbGVjdGl2ZUJpdG1hcFt5XS5zdWJhcnJheSh4TWluLCB4TWF4KSk7CiAgICAgICAgICB9CiAgICAgICAgICBuZXdTeW1ib2xzLnB1c2goc3ltYm9sQml0bWFwKTsKICAgICAgICAgIHhNaW4gPSB4TWF4OwogICAgICAgIH0KICAgICAgfQogICAgfQogIH0KICBjb25zdCBleHBvcnRlZFN5bWJvbHMgPSBbXSwKICAgIGZsYWdzID0gW107CiAgbGV0IGN1cnJlbnRGbGFnID0gZmFsc2UsCiAgICBpLAogICAgaWk7CiAgY29uc3QgdG90YWxTeW1ib2xzTGVuZ3RoID0gc3ltYm9scy5sZW5ndGggKyBudW1iZXJPZk5ld1N5bWJvbHM7CiAgd2hpbGUgKGZsYWdzLmxlbmd0aCA8IHRvdGFsU3ltYm9sc0xlbmd0aCkgewogICAgbGV0IHJ1bkxlbmd0aCA9IGh1ZmZtYW4gPyB0YWJsZUIxLmRlY29kZShodWZmbWFuSW5wdXQpIDogZGVjb2RlSW50ZWdlcihjb250ZXh0Q2FjaGUsICJJQUVYIiwgZGVjb2Rlcik7CiAgICB3aGlsZSAocnVuTGVuZ3RoLS0pIHsKICAgICAgZmxhZ3MucHVzaChjdXJyZW50RmxhZyk7CiAgICB9CiAgICBjdXJyZW50RmxhZyA9ICFjdXJyZW50RmxhZzsKICB9CiAgZm9yIChpID0gMCwgaWkgPSBzeW1ib2xzLmxlbmd0aDsgaSA8IGlpOyBpKyspIHsKICAgIGlmIChmbGFnc1tpXSkgewogICAgICBleHBvcnRlZFN5bWJvbHMucHVzaChzeW1ib2xzW2ldKTsKICAgIH0KICB9CiAgZm9yIChsZXQgaiA9IDA7IGogPCBudW1iZXJPZk5ld1N5bWJvbHM7IGkrKywgaisrKSB7CiAgICBpZiAoZmxhZ3NbaV0pIHsKICAgICAgZXhwb3J0ZWRTeW1ib2xzLnB1c2gobmV3U3ltYm9sc1tqXSk7CiAgICB9CiAgfQogIHJldHVybiBleHBvcnRlZFN5bWJvbHM7Cn0KZnVuY3Rpb24gZGVjb2RlVGV4dFJlZ2lvbihodWZmbWFuLCByZWZpbmVtZW50LCB3aWR0aCwgaGVpZ2h0LCBkZWZhdWx0UGl4ZWxWYWx1ZSwgbnVtYmVyT2ZTeW1ib2xJbnN0YW5jZXMsIHN0cmlwU2l6ZSwgaW5wdXRTeW1ib2xzLCBzeW1ib2xDb2RlTGVuZ3RoLCB0cmFuc3Bvc2VkLCBkc09mZnNldCwgcmVmZXJlbmNlQ29ybmVyLCBjb21iaW5hdGlvbk9wZXJhdG9yLCBodWZmbWFuVGFibGVzLCByZWZpbmVtZW50VGVtcGxhdGVJbmRleCwgcmVmaW5lbWVudEF0LCBkZWNvZGluZ0NvbnRleHQsIGxvZ1N0cmlwU2l6ZSwgaHVmZm1hbklucHV0KSB7CiAgaWYgKGh1ZmZtYW4gJiYgcmVmaW5lbWVudCkgewogICAgdGhyb3cgbmV3IEpiaWcyRXJyb3IoInJlZmluZW1lbnQgd2l0aCBIdWZmbWFuIGlzIG5vdCBzdXBwb3J0ZWQiKTsKICB9CiAgY29uc3QgYml0bWFwID0gW107CiAgbGV0IGksIHJvdzsKICBmb3IgKGkgPSAwOyBpIDwgaGVpZ2h0OyBpKyspIHsKICAgIHJvdyA9IG5ldyBVaW50OEFycmF5KHdpZHRoKTsKICAgIGlmIChkZWZhdWx0UGl4ZWxWYWx1ZSkgewogICAgICBmb3IgKGxldCBqID0gMDsgaiA8IHdpZHRoOyBqKyspIHsKICAgICAgICByb3dbal0gPSBkZWZhdWx0UGl4ZWxWYWx1ZTsKICAgICAgfQogICAgfQogICAgYml0bWFwLnB1c2gocm93KTsKICB9CiAgY29uc3QgZGVjb2RlciA9IGRlY29kaW5nQ29udGV4dC5kZWNvZGVyOwogIGNvbnN0IGNvbnRleHRDYWNoZSA9IGRlY29kaW5nQ29udGV4dC5jb250ZXh0Q2FjaGU7CiAgbGV0IHN0cmlwVCA9IGh1ZmZtYW4gPyAtaHVmZm1hblRhYmxlcy50YWJsZURlbHRhVC5kZWNvZGUoaHVmZm1hbklucHV0KSA6IC1kZWNvZGVJbnRlZ2VyKGNvbnRleHRDYWNoZSwgIklBRFQiLCBkZWNvZGVyKTsKICBsZXQgZmlyc3RTID0gMDsKICBpID0gMDsKICB3aGlsZSAoaSA8IG51bWJlck9mU3ltYm9sSW5zdGFuY2VzKSB7CiAgICBjb25zdCBkZWx0YVQgPSBodWZmbWFuID8gaHVmZm1hblRhYmxlcy50YWJsZURlbHRhVC5kZWNvZGUoaHVmZm1hbklucHV0KSA6IGRlY29kZUludGVnZXIoY29udGV4dENhY2hlLCAiSUFEVCIsIGRlY29kZXIpOwogICAgc3RyaXBUICs9IGRlbHRhVDsKICAgIGNvbnN0IGRlbHRhRmlyc3RTID0gaHVmZm1hbiA/IGh1ZmZtYW5UYWJsZXMudGFibGVGaXJzdFMuZGVjb2RlKGh1ZmZtYW5JbnB1dCkgOiBkZWNvZGVJbnRlZ2VyKGNvbnRleHRDYWNoZSwgIklBRlMiLCBkZWNvZGVyKTsKICAgIGZpcnN0UyArPSBkZWx0YUZpcnN0UzsKICAgIGxldCBjdXJyZW50UyA9IGZpcnN0UzsKICAgIGRvIHsKICAgICAgbGV0IGN1cnJlbnRUID0gMDsKICAgICAgaWYgKHN0cmlwU2l6ZSA+IDEpIHsKICAgICAgICBjdXJyZW50VCA9IGh1ZmZtYW4gPyBodWZmbWFuSW5wdXQucmVhZEJpdHMobG9nU3RyaXBTaXplKSA6IGRlY29kZUludGVnZXIoY29udGV4dENhY2hlLCAiSUFJVCIsIGRlY29kZXIpOwogICAgICB9CiAgICAgIGNvbnN0IHQgPSBzdHJpcFNpemUgKiBzdHJpcFQgKyBjdXJyZW50VDsKICAgICAgY29uc3Qgc3ltYm9sSWQgPSBodWZmbWFuID8gaHVmZm1hblRhYmxlcy5zeW1ib2xJRFRhYmxlLmRlY29kZShodWZmbWFuSW5wdXQpIDogZGVjb2RlSUFJRChjb250ZXh0Q2FjaGUsIGRlY29kZXIsIHN5bWJvbENvZGVMZW5ndGgpOwogICAgICBjb25zdCBhcHBseVJlZmluZW1lbnQgPSByZWZpbmVtZW50ICYmIChodWZmbWFuID8gaHVmZm1hbklucHV0LnJlYWRCaXQoKSA6IGRlY29kZUludGVnZXIoY29udGV4dENhY2hlLCAiSUFSSSIsIGRlY29kZXIpKTsKICAgICAgbGV0IHN5bWJvbEJpdG1hcCA9IGlucHV0U3ltYm9sc1tzeW1ib2xJZF07CiAgICAgIGxldCBzeW1ib2xXaWR0aCA9IHN5bWJvbEJpdG1hcFswXS5sZW5ndGg7CiAgICAgIGxldCBzeW1ib2xIZWlnaHQgPSBzeW1ib2xCaXRtYXAubGVuZ3RoOwogICAgICBpZiAoYXBwbHlSZWZpbmVtZW50KSB7CiAgICAgICAgY29uc3QgcmR3ID0gZGVjb2RlSW50ZWdlcihjb250ZXh0Q2FjaGUsICJJQVJEVyIsIGRlY29kZXIpOwogICAgICAgIGNvbnN0IHJkaCA9IGRlY29kZUludGVnZXIoY29udGV4dENhY2hlLCAiSUFSREgiLCBkZWNvZGVyKTsKICAgICAgICBjb25zdCByZHggPSBkZWNvZGVJbnRlZ2VyKGNvbnRleHRDYWNoZSwgIklBUkRYIiwgZGVjb2Rlcik7CiAgICAgICAgY29uc3QgcmR5ID0gZGVjb2RlSW50ZWdlcihjb250ZXh0Q2FjaGUsICJJQVJEWSIsIGRlY29kZXIpOwogICAgICAgIHN5bWJvbFdpZHRoICs9IHJkdzsKICAgICAgICBzeW1ib2xIZWlnaHQgKz0gcmRoOwogICAgICAgIHN5bWJvbEJpdG1hcCA9IGRlY29kZVJlZmluZW1lbnQoc3ltYm9sV2lkdGgsIHN5bWJvbEhlaWdodCwgcmVmaW5lbWVudFRlbXBsYXRlSW5kZXgsIHN5bWJvbEJpdG1hcCwgKHJkdyA+PiAxKSArIHJkeCwgKHJkaCA+PiAxKSArIHJkeSwgZmFsc2UsIHJlZmluZW1lbnRBdCwgZGVjb2RpbmdDb250ZXh0KTsKICAgICAgfQogICAgICBjb25zdCBvZmZzZXRUID0gdCAtIChyZWZlcmVuY2VDb3JuZXIgJiAxID8gMCA6IHN5bWJvbEhlaWdodCAtIDEpOwogICAgICBjb25zdCBvZmZzZXRTID0gY3VycmVudFMgLSAocmVmZXJlbmNlQ29ybmVyICYgMiA/IHN5bWJvbFdpZHRoIC0gMSA6IDApOwogICAgICBsZXQgczIsIHQyLCBzeW1ib2xSb3c7CiAgICAgIGlmICh0cmFuc3Bvc2VkKSB7CiAgICAgICAgZm9yIChzMiA9IDA7IHMyIDwgc3ltYm9sSGVpZ2h0OyBzMisrKSB7CiAgICAgICAgICByb3cgPSBiaXRtYXBbb2Zmc2V0UyArIHMyXTsKICAgICAgICAgIGlmICghcm93KSB7CiAgICAgICAgICAgIGNvbnRpbnVlOwogICAgICAgICAgfQogICAgICAgICAgc3ltYm9sUm93ID0gc3ltYm9sQml0bWFwW3MyXTsKICAgICAgICAgIGNvbnN0IG1heFdpZHRoID0gTWF0aC5taW4od2lkdGggLSBvZmZzZXRULCBzeW1ib2xXaWR0aCk7CiAgICAgICAgICBzd2l0Y2ggKGNvbWJpbmF0aW9uT3BlcmF0b3IpIHsKICAgICAgICAgICAgY2FzZSAwOgogICAgICAgICAgICAgIGZvciAodDIgPSAwOyB0MiA8IG1heFdpZHRoOyB0MisrKSB7CiAgICAgICAgICAgICAgICByb3dbb2Zmc2V0VCArIHQyXSB8PSBzeW1ib2xSb3dbdDJdOwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgY2FzZSAyOgogICAgICAgICAgICAgIGZvciAodDIgPSAwOyB0MiA8IG1heFdpZHRoOyB0MisrKSB7CiAgICAgICAgICAgICAgICByb3dbb2Zmc2V0VCArIHQyXSBePSBzeW1ib2xSb3dbdDJdOwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgZGVmYXVsdDoKICAgICAgICAgICAgICB0aHJvdyBuZXcgSmJpZzJFcnJvcihgb3BlcmF0b3IgJHtjb21iaW5hdGlvbk9wZXJhdG9yfSBpcyBub3Qgc3VwcG9ydGVkYCk7CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIGN1cnJlbnRTICs9IHN5bWJvbEhlaWdodCAtIDE7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgZm9yICh0MiA9IDA7IHQyIDwgc3ltYm9sSGVpZ2h0OyB0MisrKSB7CiAgICAgICAgICByb3cgPSBiaXRtYXBbb2Zmc2V0VCArIHQyXTsKICAgICAgICAgIGlmICghcm93KSB7CiAgICAgICAgICAgIGNvbnRpbnVlOwogICAgICAgICAgfQogICAgICAgICAgc3ltYm9sUm93ID0gc3ltYm9sQml0bWFwW3QyXTsKICAgICAgICAgIHN3aXRjaCAoY29tYmluYXRpb25PcGVyYXRvcikgewogICAgICAgICAgICBjYXNlIDA6CiAgICAgICAgICAgICAgZm9yIChzMiA9IDA7IHMyIDwgc3ltYm9sV2lkdGg7IHMyKyspIHsKICAgICAgICAgICAgICAgIHJvd1tvZmZzZXRTICsgczJdIHw9IHN5bWJvbFJvd1tzMl07CiAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICBjYXNlIDI6CiAgICAgICAgICAgICAgZm9yIChzMiA9IDA7IHMyIDwgc3ltYm9sV2lkdGg7IHMyKyspIHsKICAgICAgICAgICAgICAgIHJvd1tvZmZzZXRTICsgczJdIF49IHN5bWJvbFJvd1tzMl07CiAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICBkZWZhdWx0OgogICAgICAgICAgICAgIHRocm93IG5ldyBKYmlnMkVycm9yKGBvcGVyYXRvciAke2NvbWJpbmF0aW9uT3BlcmF0b3J9IGlzIG5vdCBzdXBwb3J0ZWRgKTsKICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgY3VycmVudFMgKz0gc3ltYm9sV2lkdGggLSAxOwogICAgICB9CiAgICAgIGkrKzsKICAgICAgY29uc3QgZGVsdGFTID0gaHVmZm1hbiA/IGh1ZmZtYW5UYWJsZXMudGFibGVEZWx0YVMuZGVjb2RlKGh1ZmZtYW5JbnB1dCkgOiBkZWNvZGVJbnRlZ2VyKGNvbnRleHRDYWNoZSwgIklBRFMiLCBkZWNvZGVyKTsKICAgICAgaWYgKGRlbHRhUyA9PT0gbnVsbCkgewogICAgICAgIGJyZWFrOwogICAgICB9CiAgICAgIGN1cnJlbnRTICs9IGRlbHRhUyArIGRzT2Zmc2V0OwogICAgfSB3aGlsZSAodHJ1ZSk7CiAgfQogIHJldHVybiBiaXRtYXA7Cn0KZnVuY3Rpb24gZGVjb2RlUGF0dGVybkRpY3Rpb25hcnkobW1yLCBwYXR0ZXJuV2lkdGgsIHBhdHRlcm5IZWlnaHQsIG1heFBhdHRlcm5JbmRleCwgdGVtcGxhdGUsIGRlY29kaW5nQ29udGV4dCkgewogIGNvbnN0IGF0ID0gW107CiAgaWYgKCFtbXIpIHsKICAgIGF0LnB1c2goewogICAgICB4OiAtcGF0dGVybldpZHRoLAogICAgICB5OiAwCiAgICB9KTsKICAgIGlmICh0ZW1wbGF0ZSA9PT0gMCkgewogICAgICBhdC5wdXNoKHsKICAgICAgICB4OiAtMywKICAgICAgICB5OiAtMQogICAgICB9LCB7CiAgICAgICAgeDogMiwKICAgICAgICB5OiAtMgogICAgICB9LCB7CiAgICAgICAgeDogLTIsCiAgICAgICAgeTogLTIKICAgICAgfSk7CiAgICB9CiAgfQogIGNvbnN0IGNvbGxlY3RpdmVXaWR0aCA9IChtYXhQYXR0ZXJuSW5kZXggKyAxKSAqIHBhdHRlcm5XaWR0aDsKICBjb25zdCBjb2xsZWN0aXZlQml0bWFwID0gZGVjb2RlQml0bWFwKG1tciwgY29sbGVjdGl2ZVdpZHRoLCBwYXR0ZXJuSGVpZ2h0LCB0ZW1wbGF0ZSwgZmFsc2UsIG51bGwsIGF0LCBkZWNvZGluZ0NvbnRleHQpOwogIGNvbnN0IHBhdHRlcm5zID0gW107CiAgZm9yIChsZXQgaSA9IDA7IGkgPD0gbWF4UGF0dGVybkluZGV4OyBpKyspIHsKICAgIGNvbnN0IHBhdHRlcm5CaXRtYXAgPSBbXTsKICAgIGNvbnN0IHhNaW4gPSBwYXR0ZXJuV2lkdGggKiBpOwogICAgY29uc3QgeE1heCA9IHhNaW4gKyBwYXR0ZXJuV2lkdGg7CiAgICBmb3IgKGxldCB5ID0gMDsgeSA8IHBhdHRlcm5IZWlnaHQ7IHkrKykgewogICAgICBwYXR0ZXJuQml0bWFwLnB1c2goY29sbGVjdGl2ZUJpdG1hcFt5XS5zdWJhcnJheSh4TWluLCB4TWF4KSk7CiAgICB9CiAgICBwYXR0ZXJucy5wdXNoKHBhdHRlcm5CaXRtYXApOwogIH0KICByZXR1cm4gcGF0dGVybnM7Cn0KZnVuY3Rpb24gZGVjb2RlSGFsZnRvbmVSZWdpb24obW1yLCBwYXR0ZXJucywgdGVtcGxhdGUsIHJlZ2lvbldpZHRoLCByZWdpb25IZWlnaHQsIGRlZmF1bHRQaXhlbFZhbHVlLCBlbmFibGVTa2lwLCBjb21iaW5hdGlvbk9wZXJhdG9yLCBncmlkV2lkdGgsIGdyaWRIZWlnaHQsIGdyaWRPZmZzZXRYLCBncmlkT2Zmc2V0WSwgZ3JpZFZlY3RvclgsIGdyaWRWZWN0b3JZLCBkZWNvZGluZ0NvbnRleHQpIHsKICBjb25zdCBza2lwID0gbnVsbDsKICBpZiAoZW5hYmxlU2tpcCkgewogICAgdGhyb3cgbmV3IEpiaWcyRXJyb3IoInNraXAgaXMgbm90IHN1cHBvcnRlZCIpOwogIH0KICBpZiAoY29tYmluYXRpb25PcGVyYXRvciAhPT0gMCkgewogICAgdGhyb3cgbmV3IEpiaWcyRXJyb3IoYG9wZXJhdG9yICIke2NvbWJpbmF0aW9uT3BlcmF0b3J9IiBpcyBub3Qgc3VwcG9ydGVkIGluIGhhbGZ0b25lIHJlZ2lvbmApOwogIH0KICBjb25zdCByZWdpb25CaXRtYXAgPSBbXTsKICBsZXQgaSwgaiwgcm93OwogIGZvciAoaSA9IDA7IGkgPCByZWdpb25IZWlnaHQ7IGkrKykgewogICAgcm93ID0gbmV3IFVpbnQ4QXJyYXkocmVnaW9uV2lkdGgpOwogICAgaWYgKGRlZmF1bHRQaXhlbFZhbHVlKSB7CiAgICAgIGZvciAoaiA9IDA7IGogPCByZWdpb25XaWR0aDsgaisrKSB7CiAgICAgICAgcm93W2pdID0gZGVmYXVsdFBpeGVsVmFsdWU7CiAgICAgIH0KICAgIH0KICAgIHJlZ2lvbkJpdG1hcC5wdXNoKHJvdyk7CiAgfQogIGNvbnN0IG51bWJlck9mUGF0dGVybnMgPSBwYXR0ZXJucy5sZW5ndGg7CiAgY29uc3QgcGF0dGVybjAgPSBwYXR0ZXJuc1swXTsKICBjb25zdCBwYXR0ZXJuV2lkdGggPSBwYXR0ZXJuMFswXS5sZW5ndGgsCiAgICBwYXR0ZXJuSGVpZ2h0ID0gcGF0dGVybjAubGVuZ3RoOwogIGNvbnN0IGJpdHNQZXJWYWx1ZSA9ICgwLCBfY29yZV91dGlscy5sb2cyKShudW1iZXJPZlBhdHRlcm5zKTsKICBjb25zdCBhdCA9IFtdOwogIGlmICghbW1yKSB7CiAgICBhdC5wdXNoKHsKICAgICAgeDogdGVtcGxhdGUgPD0gMSA/IDMgOiAyLAogICAgICB5OiAtMQogICAgfSk7CiAgICBpZiAodGVtcGxhdGUgPT09IDApIHsKICAgICAgYXQucHVzaCh7CiAgICAgICAgeDogLTMsCiAgICAgICAgeTogLTEKICAgICAgfSwgewogICAgICAgIHg6IDIsCiAgICAgICAgeTogLTIKICAgICAgfSwgewogICAgICAgIHg6IC0yLAogICAgICAgIHk6IC0yCiAgICAgIH0pOwogICAgfQogIH0KICBjb25zdCBncmF5U2NhbGVCaXRQbGFuZXMgPSBbXTsKICBsZXQgbW1ySW5wdXQsIGJpdG1hcDsKICBpZiAobW1yKSB7CiAgICBtbXJJbnB1dCA9IG5ldyBSZWFkZXIoZGVjb2RpbmdDb250ZXh0LmRhdGEsIGRlY29kaW5nQ29udGV4dC5zdGFydCwgZGVjb2RpbmdDb250ZXh0LmVuZCk7CiAgfQogIGZvciAoaSA9IGJpdHNQZXJWYWx1ZSAtIDE7IGkgPj0gMDsgaS0tKSB7CiAgICBpZiAobW1yKSB7CiAgICAgIGJpdG1hcCA9IGRlY29kZU1NUkJpdG1hcChtbXJJbnB1dCwgZ3JpZFdpZHRoLCBncmlkSGVpZ2h0LCB0cnVlKTsKICAgIH0gZWxzZSB7CiAgICAgIGJpdG1hcCA9IGRlY29kZUJpdG1hcChmYWxzZSwgZ3JpZFdpZHRoLCBncmlkSGVpZ2h0LCB0ZW1wbGF0ZSwgZmFsc2UsIHNraXAsIGF0LCBkZWNvZGluZ0NvbnRleHQpOwogICAgfQogICAgZ3JheVNjYWxlQml0UGxhbmVzW2ldID0gYml0bWFwOwogIH0KICBsZXQgbWcsIG5nLCBiaXQsIHBhdHRlcm5JbmRleCwgcGF0dGVybkJpdG1hcCwgeCwgeSwgcGF0dGVyblJvdywgcmVnaW9uUm93OwogIGZvciAobWcgPSAwOyBtZyA8IGdyaWRIZWlnaHQ7IG1nKyspIHsKICAgIGZvciAobmcgPSAwOyBuZyA8IGdyaWRXaWR0aDsgbmcrKykgewogICAgICBiaXQgPSAwOwogICAgICBwYXR0ZXJuSW5kZXggPSAwOwogICAgICBmb3IgKGogPSBiaXRzUGVyVmFsdWUgLSAxOyBqID49IDA7IGotLSkgewogICAgICAgIGJpdCBePSBncmF5U2NhbGVCaXRQbGFuZXNbal1bbWddW25nXTsKICAgICAgICBwYXR0ZXJuSW5kZXggfD0gYml0IDw8IGo7CiAgICAgIH0KICAgICAgcGF0dGVybkJpdG1hcCA9IHBhdHRlcm5zW3BhdHRlcm5JbmRleF07CiAgICAgIHggPSBncmlkT2Zmc2V0WCArIG1nICogZ3JpZFZlY3RvclkgKyBuZyAqIGdyaWRWZWN0b3JYID4+IDg7CiAgICAgIHkgPSBncmlkT2Zmc2V0WSArIG1nICogZ3JpZFZlY3RvclggLSBuZyAqIGdyaWRWZWN0b3JZID4+IDg7CiAgICAgIGlmICh4ID49IDAgJiYgeCArIHBhdHRlcm5XaWR0aCA8PSByZWdpb25XaWR0aCAmJiB5ID49IDAgJiYgeSArIHBhdHRlcm5IZWlnaHQgPD0gcmVnaW9uSGVpZ2h0KSB7CiAgICAgICAgZm9yIChpID0gMDsgaSA8IHBhdHRlcm5IZWlnaHQ7IGkrKykgewogICAgICAgICAgcmVnaW9uUm93ID0gcmVnaW9uQml0bWFwW3kgKyBpXTsKICAgICAgICAgIHBhdHRlcm5Sb3cgPSBwYXR0ZXJuQml0bWFwW2ldOwogICAgICAgICAgZm9yIChqID0gMDsgaiA8IHBhdHRlcm5XaWR0aDsgaisrKSB7CiAgICAgICAgICAgIHJlZ2lvblJvd1t4ICsgal0gfD0gcGF0dGVyblJvd1tqXTsKICAgICAgICAgIH0KICAgICAgICB9CiAgICAgIH0gZWxzZSB7CiAgICAgICAgbGV0IHJlZ2lvblgsIHJlZ2lvblk7CiAgICAgICAgZm9yIChpID0gMDsgaSA8IHBhdHRlcm5IZWlnaHQ7IGkrKykgewogICAgICAgICAgcmVnaW9uWSA9IHkgKyBpOwogICAgICAgICAgaWYgKHJlZ2lvblkgPCAwIHx8IHJlZ2lvblkgPj0gcmVnaW9uSGVpZ2h0KSB7CiAgICAgICAgICAgIGNvbnRpbnVlOwogICAgICAgICAgfQogICAgICAgICAgcmVnaW9uUm93ID0gcmVnaW9uQml0bWFwW3JlZ2lvblldOwogICAgICAgICAgcGF0dGVyblJvdyA9IHBhdHRlcm5CaXRtYXBbaV07CiAgICAgICAgICBmb3IgKGogPSAwOyBqIDwgcGF0dGVybldpZHRoOyBqKyspIHsKICAgICAgICAgICAgcmVnaW9uWCA9IHggKyBqOwogICAgICAgICAgICBpZiAocmVnaW9uWCA+PSAwICYmIHJlZ2lvblggPCByZWdpb25XaWR0aCkgewogICAgICAgICAgICAgIHJlZ2lvblJvd1tyZWdpb25YXSB8PSBwYXR0ZXJuUm93W2pdOwogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICB9CiAgICB9CiAgfQogIHJldHVybiByZWdpb25CaXRtYXA7Cn0KZnVuY3Rpb24gcmVhZFNlZ21lbnRIZWFkZXIoZGF0YSwgc3RhcnQpIHsKICBjb25zdCBzZWdtZW50SGVhZGVyID0ge307CiAgc2VnbWVudEhlYWRlci5udW1iZXIgPSAoMCwgX2NvcmVfdXRpbHMucmVhZFVpbnQzMikoZGF0YSwgc3RhcnQpOwogIGNvbnN0IGZsYWdzID0gZGF0YVtzdGFydCArIDRdOwogIGNvbnN0IHNlZ21lbnRUeXBlID0gZmxhZ3MgJiAweDNmOwogIGlmICghU2VnbWVudFR5cGVzW3NlZ21lbnRUeXBlXSkgewogICAgdGhyb3cgbmV3IEpiaWcyRXJyb3IoImludmFsaWQgc2VnbWVudCB0eXBlOiAiICsgc2VnbWVudFR5cGUpOwogIH0KICBzZWdtZW50SGVhZGVyLnR5cGUgPSBzZWdtZW50VHlwZTsKICBzZWdtZW50SGVhZGVyLnR5cGVOYW1lID0gU2VnbWVudFR5cGVzW3NlZ21lbnRUeXBlXTsKICBzZWdtZW50SGVhZGVyLmRlZmVycmVkTm9uUmV0YWluID0gISEoZmxhZ3MgJiAweDgwKTsKICBjb25zdCBwYWdlQXNzb2NpYXRpb25GaWVsZFNpemUgPSAhIShmbGFncyAmIDB4NDApOwogIGNvbnN0IHJlZmVycmVkRmxhZ3MgPSBkYXRhW3N0YXJ0ICsgNV07CiAgbGV0IHJlZmVycmVkVG9Db3VudCA9IHJlZmVycmVkRmxhZ3MgPj4gNSAmIDc7CiAgY29uc3QgcmV0YWluQml0cyA9IFtyZWZlcnJlZEZsYWdzICYgMzFdOwogIGxldCBwb3NpdGlvbiA9IHN0YXJ0ICsgNjsKICBpZiAocmVmZXJyZWRGbGFncyA9PT0gNykgewogICAgcmVmZXJyZWRUb0NvdW50ID0gKDAsIF9jb3JlX3V0aWxzLnJlYWRVaW50MzIpKGRhdGEsIHBvc2l0aW9uIC0gMSkgJiAweDFmZmZmZmZmOwogICAgcG9zaXRpb24gKz0gMzsKICAgIGxldCBieXRlcyA9IHJlZmVycmVkVG9Db3VudCArIDcgPj4gMzsKICAgIHJldGFpbkJpdHNbMF0gPSBkYXRhW3Bvc2l0aW9uKytdOwogICAgd2hpbGUgKC0tYnl0ZXMgPiAwKSB7CiAgICAgIHJldGFpbkJpdHMucHVzaChkYXRhW3Bvc2l0aW9uKytdKTsKICAgIH0KICB9IGVsc2UgaWYgKHJlZmVycmVkRmxhZ3MgPT09IDUgfHwgcmVmZXJyZWRGbGFncyA9PT0gNikgewogICAgdGhyb3cgbmV3IEpiaWcyRXJyb3IoImludmFsaWQgcmVmZXJyZWQtdG8gZmxhZ3MiKTsKICB9CiAgc2VnbWVudEhlYWRlci5yZXRhaW5CaXRzID0gcmV0YWluQml0czsKICBsZXQgcmVmZXJyZWRUb1NlZ21lbnROdW1iZXJTaXplID0gNDsKICBpZiAoc2VnbWVudEhlYWRlci5udW1iZXIgPD0gMjU2KSB7CiAgICByZWZlcnJlZFRvU2VnbWVudE51bWJlclNpemUgPSAxOwogIH0gZWxzZSBpZiAoc2VnbWVudEhlYWRlci5udW1iZXIgPD0gNjU1MzYpIHsKICAgIHJlZmVycmVkVG9TZWdtZW50TnVtYmVyU2l6ZSA9IDI7CiAgfQogIGNvbnN0IHJlZmVycmVkVG8gPSBbXTsKICBsZXQgaSwgaWk7CiAgZm9yIChpID0gMDsgaSA8IHJlZmVycmVkVG9Db3VudDsgaSsrKSB7CiAgICBsZXQgbnVtYmVyOwogICAgaWYgKHJlZmVycmVkVG9TZWdtZW50TnVtYmVyU2l6ZSA9PT0gMSkgewogICAgICBudW1iZXIgPSBkYXRhW3Bvc2l0aW9uXTsKICAgIH0gZWxzZSBpZiAocmVmZXJyZWRUb1NlZ21lbnROdW1iZXJTaXplID09PSAyKSB7CiAgICAgIG51bWJlciA9ICgwLCBfY29yZV91dGlscy5yZWFkVWludDE2KShkYXRhLCBwb3NpdGlvbik7CiAgICB9IGVsc2UgewogICAgICBudW1iZXIgPSAoMCwgX2NvcmVfdXRpbHMucmVhZFVpbnQzMikoZGF0YSwgcG9zaXRpb24pOwogICAgfQogICAgcmVmZXJyZWRUby5wdXNoKG51bWJlcik7CiAgICBwb3NpdGlvbiArPSByZWZlcnJlZFRvU2VnbWVudE51bWJlclNpemU7CiAgfQogIHNlZ21lbnRIZWFkZXIucmVmZXJyZWRUbyA9IHJlZmVycmVkVG87CiAgaWYgKCFwYWdlQXNzb2NpYXRpb25GaWVsZFNpemUpIHsKICAgIHNlZ21lbnRIZWFkZXIucGFnZUFzc29jaWF0aW9uID0gZGF0YVtwb3NpdGlvbisrXTsKICB9IGVsc2UgewogICAgc2VnbWVudEhlYWRlci5wYWdlQXNzb2NpYXRpb24gPSAoMCwgX2NvcmVfdXRpbHMucmVhZFVpbnQzMikoZGF0YSwgcG9zaXRpb24pOwogICAgcG9zaXRpb24gKz0gNDsKICB9CiAgc2VnbWVudEhlYWRlci5sZW5ndGggPSAoMCwgX2NvcmVfdXRpbHMucmVhZFVpbnQzMikoZGF0YSwgcG9zaXRpb24pOwogIHBvc2l0aW9uICs9IDQ7CiAgaWYgKHNlZ21lbnRIZWFkZXIubGVuZ3RoID09PSAweGZmZmZmZmZmKSB7CiAgICBpZiAoc2VnbWVudFR5cGUgPT09IDM4KSB7CiAgICAgIGNvbnN0IGdlbmVyaWNSZWdpb25JbmZvID0gcmVhZFJlZ2lvblNlZ21lbnRJbmZvcm1hdGlvbihkYXRhLCBwb3NpdGlvbik7CiAgICAgIGNvbnN0IGdlbmVyaWNSZWdpb25TZWdtZW50RmxhZ3MgPSBkYXRhW3Bvc2l0aW9uICsgUmVnaW9uU2VnbWVudEluZm9ybWF0aW9uRmllbGRMZW5ndGhdOwogICAgICBjb25zdCBnZW5lcmljUmVnaW9uTW1yID0gISEoZ2VuZXJpY1JlZ2lvblNlZ21lbnRGbGFncyAmIDEpOwogICAgICBjb25zdCBzZWFyY2hQYXR0ZXJuTGVuZ3RoID0gNjsKICAgICAgY29uc3Qgc2VhcmNoUGF0dGVybiA9IG5ldyBVaW50OEFycmF5KHNlYXJjaFBhdHRlcm5MZW5ndGgpOwogICAgICBpZiAoIWdlbmVyaWNSZWdpb25NbXIpIHsKICAgICAgICBzZWFyY2hQYXR0ZXJuWzBdID0gMHhmZjsKICAgICAgICBzZWFyY2hQYXR0ZXJuWzFdID0gMHhhYzsKICAgICAgfQogICAgICBzZWFyY2hQYXR0ZXJuWzJdID0gZ2VuZXJpY1JlZ2lvbkluZm8uaGVpZ2h0ID4+PiAyNCAmIDB4ZmY7CiAgICAgIHNlYXJjaFBhdHRlcm5bM10gPSBnZW5lcmljUmVnaW9uSW5mby5oZWlnaHQgPj4gMTYgJiAweGZmOwogICAgICBzZWFyY2hQYXR0ZXJuWzRdID0gZ2VuZXJpY1JlZ2lvbkluZm8uaGVpZ2h0ID4+IDggJiAweGZmOwogICAgICBzZWFyY2hQYXR0ZXJuWzVdID0gZ2VuZXJpY1JlZ2lvbkluZm8uaGVpZ2h0ICYgMHhmZjsKICAgICAgZm9yIChpID0gcG9zaXRpb24sIGlpID0gZGF0YS5sZW5ndGg7IGkgPCBpaTsgaSsrKSB7CiAgICAgICAgbGV0IGogPSAwOwogICAgICAgIHdoaWxlIChqIDwgc2VhcmNoUGF0dGVybkxlbmd0aCAmJiBzZWFyY2hQYXR0ZXJuW2pdID09PSBkYXRhW2kgKyBqXSkgewogICAgICAgICAgaisrOwogICAgICAgIH0KICAgICAgICBpZiAoaiA9PT0gc2VhcmNoUGF0dGVybkxlbmd0aCkgewogICAgICAgICAgc2VnbWVudEhlYWRlci5sZW5ndGggPSBpICsgc2VhcmNoUGF0dGVybkxlbmd0aDsKICAgICAgICAgIGJyZWFrOwogICAgICAgIH0KICAgICAgfQogICAgICBpZiAoc2VnbWVudEhlYWRlci5sZW5ndGggPT09IDB4ZmZmZmZmZmYpIHsKICAgICAgICB0aHJvdyBuZXcgSmJpZzJFcnJvcigic2VnbWVudCBlbmQgd2FzIG5vdCBmb3VuZCIpOwogICAgICB9CiAgICB9IGVsc2UgewogICAgICB0aHJvdyBuZXcgSmJpZzJFcnJvcigiaW52YWxpZCB1bmtub3duIHNlZ21lbnQgbGVuZ3RoIik7CiAgICB9CiAgfQogIHNlZ21lbnRIZWFkZXIuaGVhZGVyRW5kID0gcG9zaXRpb247CiAgcmV0dXJuIHNlZ21lbnRIZWFkZXI7Cn0KZnVuY3Rpb24gcmVhZFNlZ21lbnRzKGhlYWRlciwgZGF0YSwgc3RhcnQsIGVuZCkgewogIGNvbnN0IHNlZ21lbnRzID0gW107CiAgbGV0IHBvc2l0aW9uID0gc3RhcnQ7CiAgd2hpbGUgKHBvc2l0aW9uIDwgZW5kKSB7CiAgICBjb25zdCBzZWdtZW50SGVhZGVyID0gcmVhZFNlZ21lbnRIZWFkZXIoZGF0YSwgcG9zaXRpb24pOwogICAgcG9zaXRpb24gPSBzZWdtZW50SGVhZGVyLmhlYWRlckVuZDsKICAgIGNvbnN0IHNlZ21lbnQgPSB7CiAgICAgIGhlYWRlcjogc2VnbWVudEhlYWRlciwKICAgICAgZGF0YQogICAgfTsKICAgIGlmICghaGVhZGVyLnJhbmRvbUFjY2VzcykgewogICAgICBzZWdtZW50LnN0YXJ0ID0gcG9zaXRpb247CiAgICAgIHBvc2l0aW9uICs9IHNlZ21lbnRIZWFkZXIubGVuZ3RoOwogICAgICBzZWdtZW50LmVuZCA9IHBvc2l0aW9uOwogICAgfQogICAgc2VnbWVudHMucHVzaChzZWdtZW50KTsKICAgIGlmIChzZWdtZW50SGVhZGVyLnR5cGUgPT09IDUxKSB7CiAgICAgIGJyZWFrOwogICAgfQogIH0KICBpZiAoaGVhZGVyLnJhbmRvbUFjY2VzcykgewogICAgZm9yIChsZXQgaSA9IDAsIGlpID0gc2VnbWVudHMubGVuZ3RoOyBpIDwgaWk7IGkrKykgewogICAgICBzZWdtZW50c1tpXS5zdGFydCA9IHBvc2l0aW9uOwogICAgICBwb3NpdGlvbiArPSBzZWdtZW50c1tpXS5oZWFkZXIubGVuZ3RoOwogICAgICBzZWdtZW50c1tpXS5lbmQgPSBwb3NpdGlvbjsKICAgIH0KICB9CiAgcmV0dXJuIHNlZ21lbnRzOwp9CmZ1bmN0aW9uIHJlYWRSZWdpb25TZWdtZW50SW5mb3JtYXRpb24oZGF0YSwgc3RhcnQpIHsKICByZXR1cm4gewogICAgd2lkdGg6ICgwLCBfY29yZV91dGlscy5yZWFkVWludDMyKShkYXRhLCBzdGFydCksCiAgICBoZWlnaHQ6ICgwLCBfY29yZV91dGlscy5yZWFkVWludDMyKShkYXRhLCBzdGFydCArIDQpLAogICAgeDogKDAsIF9jb3JlX3V0aWxzLnJlYWRVaW50MzIpKGRhdGEsIHN0YXJ0ICsgOCksCiAgICB5OiAoMCwgX2NvcmVfdXRpbHMucmVhZFVpbnQzMikoZGF0YSwgc3RhcnQgKyAxMiksCiAgICBjb21iaW5hdGlvbk9wZXJhdG9yOiBkYXRhW3N0YXJ0ICsgMTZdICYgNwogIH07Cn0KY29uc3QgUmVnaW9uU2VnbWVudEluZm9ybWF0aW9uRmllbGRMZW5ndGggPSAxNzsKZnVuY3Rpb24gcHJvY2Vzc1NlZ21lbnQoc2VnbWVudCwgdmlzaXRvcikgewogIGNvbnN0IGhlYWRlciA9IHNlZ21lbnQuaGVhZGVyOwogIGNvbnN0IGRhdGEgPSBzZWdtZW50LmRhdGEsCiAgICBlbmQgPSBzZWdtZW50LmVuZDsKICBsZXQgcG9zaXRpb24gPSBzZWdtZW50LnN0YXJ0OwogIGxldCBhcmdzLCBhdCwgaSwgYXRMZW5ndGg7CiAgc3dpdGNoIChoZWFkZXIudHlwZSkgewogICAgY2FzZSAwOgogICAgICBjb25zdCBkaWN0aW9uYXJ5ID0ge307CiAgICAgIGNvbnN0IGRpY3Rpb25hcnlGbGFncyA9ICgwLCBfY29yZV91dGlscy5yZWFkVWludDE2KShkYXRhLCBwb3NpdGlvbik7CiAgICAgIGRpY3Rpb25hcnkuaHVmZm1hbiA9ICEhKGRpY3Rpb25hcnlGbGFncyAmIDEpOwogICAgICBkaWN0aW9uYXJ5LnJlZmluZW1lbnQgPSAhIShkaWN0aW9uYXJ5RmxhZ3MgJiAyKTsKICAgICAgZGljdGlvbmFyeS5odWZmbWFuREhTZWxlY3RvciA9IGRpY3Rpb25hcnlGbGFncyA+PiAyICYgMzsKICAgICAgZGljdGlvbmFyeS5odWZmbWFuRFdTZWxlY3RvciA9IGRpY3Rpb25hcnlGbGFncyA+PiA0ICYgMzsKICAgICAgZGljdGlvbmFyeS5iaXRtYXBTaXplU2VsZWN0b3IgPSBkaWN0aW9uYXJ5RmxhZ3MgPj4gNiAmIDE7CiAgICAgIGRpY3Rpb25hcnkuYWdncmVnYXRpb25JbnN0YW5jZXNTZWxlY3RvciA9IGRpY3Rpb25hcnlGbGFncyA+PiA3ICYgMTsKICAgICAgZGljdGlvbmFyeS5iaXRtYXBDb2RpbmdDb250ZXh0VXNlZCA9ICEhKGRpY3Rpb25hcnlGbGFncyAmIDI1Nik7CiAgICAgIGRpY3Rpb25hcnkuYml0bWFwQ29kaW5nQ29udGV4dFJldGFpbmVkID0gISEoZGljdGlvbmFyeUZsYWdzICYgNTEyKTsKICAgICAgZGljdGlvbmFyeS50ZW1wbGF0ZSA9IGRpY3Rpb25hcnlGbGFncyA+PiAxMCAmIDM7CiAgICAgIGRpY3Rpb25hcnkucmVmaW5lbWVudFRlbXBsYXRlID0gZGljdGlvbmFyeUZsYWdzID4+IDEyICYgMTsKICAgICAgcG9zaXRpb24gKz0gMjsKICAgICAgaWYgKCFkaWN0aW9uYXJ5Lmh1ZmZtYW4pIHsKICAgICAgICBhdExlbmd0aCA9IGRpY3Rpb25hcnkudGVtcGxhdGUgPT09IDAgPyA0IDogMTsKICAgICAgICBhdCA9IFtdOwogICAgICAgIGZvciAoaSA9IDA7IGkgPCBhdExlbmd0aDsgaSsrKSB7CiAgICAgICAgICBhdC5wdXNoKHsKICAgICAgICAgICAgeDogKDAsIF9jb3JlX3V0aWxzLnJlYWRJbnQ4KShkYXRhLCBwb3NpdGlvbiksCiAgICAgICAgICAgIHk6ICgwLCBfY29yZV91dGlscy5yZWFkSW50OCkoZGF0YSwgcG9zaXRpb24gKyAxKQogICAgICAgICAgfSk7CiAgICAgICAgICBwb3NpdGlvbiArPSAyOwogICAgICAgIH0KICAgICAgICBkaWN0aW9uYXJ5LmF0ID0gYXQ7CiAgICAgIH0KICAgICAgaWYgKGRpY3Rpb25hcnkucmVmaW5lbWVudCAmJiAhZGljdGlvbmFyeS5yZWZpbmVtZW50VGVtcGxhdGUpIHsKICAgICAgICBhdCA9IFtdOwogICAgICAgIGZvciAoaSA9IDA7IGkgPCAyOyBpKyspIHsKICAgICAgICAgIGF0LnB1c2goewogICAgICAgICAgICB4OiAoMCwgX2NvcmVfdXRpbHMucmVhZEludDgpKGRhdGEsIHBvc2l0aW9uKSwKICAgICAgICAgICAgeTogKDAsIF9jb3JlX3V0aWxzLnJlYWRJbnQ4KShkYXRhLCBwb3NpdGlvbiArIDEpCiAgICAgICAgICB9KTsKICAgICAgICAgIHBvc2l0aW9uICs9IDI7CiAgICAgICAgfQogICAgICAgIGRpY3Rpb25hcnkucmVmaW5lbWVudEF0ID0gYXQ7CiAgICAgIH0KICAgICAgZGljdGlvbmFyeS5udW1iZXJPZkV4cG9ydGVkU3ltYm9scyA9ICgwLCBfY29yZV91dGlscy5yZWFkVWludDMyKShkYXRhLCBwb3NpdGlvbik7CiAgICAgIHBvc2l0aW9uICs9IDQ7CiAgICAgIGRpY3Rpb25hcnkubnVtYmVyT2ZOZXdTeW1ib2xzID0gKDAsIF9jb3JlX3V0aWxzLnJlYWRVaW50MzIpKGRhdGEsIHBvc2l0aW9uKTsKICAgICAgcG9zaXRpb24gKz0gNDsKICAgICAgYXJncyA9IFtkaWN0aW9uYXJ5LCBoZWFkZXIubnVtYmVyLCBoZWFkZXIucmVmZXJyZWRUbywgZGF0YSwgcG9zaXRpb24sIGVuZF07CiAgICAgIGJyZWFrOwogICAgY2FzZSA2OgogICAgY2FzZSA3OgogICAgICBjb25zdCB0ZXh0UmVnaW9uID0ge307CiAgICAgIHRleHRSZWdpb24uaW5mbyA9IHJlYWRSZWdpb25TZWdtZW50SW5mb3JtYXRpb24oZGF0YSwgcG9zaXRpb24pOwogICAgICBwb3NpdGlvbiArPSBSZWdpb25TZWdtZW50SW5mb3JtYXRpb25GaWVsZExlbmd0aDsKICAgICAgY29uc3QgdGV4dFJlZ2lvblNlZ21lbnRGbGFncyA9ICgwLCBfY29yZV91dGlscy5yZWFkVWludDE2KShkYXRhLCBwb3NpdGlvbik7CiAgICAgIHBvc2l0aW9uICs9IDI7CiAgICAgIHRleHRSZWdpb24uaHVmZm1hbiA9ICEhKHRleHRSZWdpb25TZWdtZW50RmxhZ3MgJiAxKTsKICAgICAgdGV4dFJlZ2lvbi5yZWZpbmVtZW50ID0gISEodGV4dFJlZ2lvblNlZ21lbnRGbGFncyAmIDIpOwogICAgICB0ZXh0UmVnaW9uLmxvZ1N0cmlwU2l6ZSA9IHRleHRSZWdpb25TZWdtZW50RmxhZ3MgPj4gMiAmIDM7CiAgICAgIHRleHRSZWdpb24uc3RyaXBTaXplID0gMSA8PCB0ZXh0UmVnaW9uLmxvZ1N0cmlwU2l6ZTsKICAgICAgdGV4dFJlZ2lvbi5yZWZlcmVuY2VDb3JuZXIgPSB0ZXh0UmVnaW9uU2VnbWVudEZsYWdzID4+IDQgJiAzOwogICAgICB0ZXh0UmVnaW9uLnRyYW5zcG9zZWQgPSAhISh0ZXh0UmVnaW9uU2VnbWVudEZsYWdzICYgNjQpOwogICAgICB0ZXh0UmVnaW9uLmNvbWJpbmF0aW9uT3BlcmF0b3IgPSB0ZXh0UmVnaW9uU2VnbWVudEZsYWdzID4+IDcgJiAzOwogICAgICB0ZXh0UmVnaW9uLmRlZmF1bHRQaXhlbFZhbHVlID0gdGV4dFJlZ2lvblNlZ21lbnRGbGFncyA+PiA5ICYgMTsKICAgICAgdGV4dFJlZ2lvbi5kc09mZnNldCA9IHRleHRSZWdpb25TZWdtZW50RmxhZ3MgPDwgMTcgPj4gMjc7CiAgICAgIHRleHRSZWdpb24ucmVmaW5lbWVudFRlbXBsYXRlID0gdGV4dFJlZ2lvblNlZ21lbnRGbGFncyA+PiAxNSAmIDE7CiAgICAgIGlmICh0ZXh0UmVnaW9uLmh1ZmZtYW4pIHsKICAgICAgICBjb25zdCB0ZXh0UmVnaW9uSHVmZm1hbkZsYWdzID0gKDAsIF9jb3JlX3V0aWxzLnJlYWRVaW50MTYpKGRhdGEsIHBvc2l0aW9uKTsKICAgICAgICBwb3NpdGlvbiArPSAyOwogICAgICAgIHRleHRSZWdpb24uaHVmZm1hbkZTID0gdGV4dFJlZ2lvbkh1ZmZtYW5GbGFncyAmIDM7CiAgICAgICAgdGV4dFJlZ2lvbi5odWZmbWFuRFMgPSB0ZXh0UmVnaW9uSHVmZm1hbkZsYWdzID4+IDIgJiAzOwogICAgICAgIHRleHRSZWdpb24uaHVmZm1hbkRUID0gdGV4dFJlZ2lvbkh1ZmZtYW5GbGFncyA+PiA0ICYgMzsKICAgICAgICB0ZXh0UmVnaW9uLmh1ZmZtYW5SZWZpbmVtZW50RFcgPSB0ZXh0UmVnaW9uSHVmZm1hbkZsYWdzID4+IDYgJiAzOwogICAgICAgIHRleHRSZWdpb24uaHVmZm1hblJlZmluZW1lbnRESCA9IHRleHRSZWdpb25IdWZmbWFuRmxhZ3MgPj4gOCAmIDM7CiAgICAgICAgdGV4dFJlZ2lvbi5odWZmbWFuUmVmaW5lbWVudERYID0gdGV4dFJlZ2lvbkh1ZmZtYW5GbGFncyA+PiAxMCAmIDM7CiAgICAgICAgdGV4dFJlZ2lvbi5odWZmbWFuUmVmaW5lbWVudERZID0gdGV4dFJlZ2lvbkh1ZmZtYW5GbGFncyA+PiAxMiAmIDM7CiAgICAgICAgdGV4dFJlZ2lvbi5odWZmbWFuUmVmaW5lbWVudFNpemVTZWxlY3RvciA9ICEhKHRleHRSZWdpb25IdWZmbWFuRmxhZ3MgJiAweDQwMDApOwogICAgICB9CiAgICAgIGlmICh0ZXh0UmVnaW9uLnJlZmluZW1lbnQgJiYgIXRleHRSZWdpb24ucmVmaW5lbWVudFRlbXBsYXRlKSB7CiAgICAgICAgYXQgPSBbXTsKICAgICAgICBmb3IgKGkgPSAwOyBpIDwgMjsgaSsrKSB7CiAgICAgICAgICBhdC5wdXNoKHsKICAgICAgICAgICAgeDogKDAsIF9jb3JlX3V0aWxzLnJlYWRJbnQ4KShkYXRhLCBwb3NpdGlvbiksCiAgICAgICAgICAgIHk6ICgwLCBfY29yZV91dGlscy5yZWFkSW50OCkoZGF0YSwgcG9zaXRpb24gKyAxKQogICAgICAgICAgfSk7CiAgICAgICAgICBwb3NpdGlvbiArPSAyOwogICAgICAgIH0KICAgICAgICB0ZXh0UmVnaW9uLnJlZmluZW1lbnRBdCA9IGF0OwogICAgICB9CiAgICAgIHRleHRSZWdpb24ubnVtYmVyT2ZTeW1ib2xJbnN0YW5jZXMgPSAoMCwgX2NvcmVfdXRpbHMucmVhZFVpbnQzMikoZGF0YSwgcG9zaXRpb24pOwogICAgICBwb3NpdGlvbiArPSA0OwogICAgICBhcmdzID0gW3RleHRSZWdpb24sIGhlYWRlci5yZWZlcnJlZFRvLCBkYXRhLCBwb3NpdGlvbiwgZW5kXTsKICAgICAgYnJlYWs7CiAgICBjYXNlIDE2OgogICAgICBjb25zdCBwYXR0ZXJuRGljdGlvbmFyeSA9IHt9OwogICAgICBjb25zdCBwYXR0ZXJuRGljdGlvbmFyeUZsYWdzID0gZGF0YVtwb3NpdGlvbisrXTsKICAgICAgcGF0dGVybkRpY3Rpb25hcnkubW1yID0gISEocGF0dGVybkRpY3Rpb25hcnlGbGFncyAmIDEpOwogICAgICBwYXR0ZXJuRGljdGlvbmFyeS50ZW1wbGF0ZSA9IHBhdHRlcm5EaWN0aW9uYXJ5RmxhZ3MgPj4gMSAmIDM7CiAgICAgIHBhdHRlcm5EaWN0aW9uYXJ5LnBhdHRlcm5XaWR0aCA9IGRhdGFbcG9zaXRpb24rK107CiAgICAgIHBhdHRlcm5EaWN0aW9uYXJ5LnBhdHRlcm5IZWlnaHQgPSBkYXRhW3Bvc2l0aW9uKytdOwogICAgICBwYXR0ZXJuRGljdGlvbmFyeS5tYXhQYXR0ZXJuSW5kZXggPSAoMCwgX2NvcmVfdXRpbHMucmVhZFVpbnQzMikoZGF0YSwgcG9zaXRpb24pOwogICAgICBwb3NpdGlvbiArPSA0OwogICAgICBhcmdzID0gW3BhdHRlcm5EaWN0aW9uYXJ5LCBoZWFkZXIubnVtYmVyLCBkYXRhLCBwb3NpdGlvbiwgZW5kXTsKICAgICAgYnJlYWs7CiAgICBjYXNlIDIyOgogICAgY2FzZSAyMzoKICAgICAgY29uc3QgaGFsZnRvbmVSZWdpb24gPSB7fTsKICAgICAgaGFsZnRvbmVSZWdpb24uaW5mbyA9IHJlYWRSZWdpb25TZWdtZW50SW5mb3JtYXRpb24oZGF0YSwgcG9zaXRpb24pOwogICAgICBwb3NpdGlvbiArPSBSZWdpb25TZWdtZW50SW5mb3JtYXRpb25GaWVsZExlbmd0aDsKICAgICAgY29uc3QgaGFsZnRvbmVSZWdpb25GbGFncyA9IGRhdGFbcG9zaXRpb24rK107CiAgICAgIGhhbGZ0b25lUmVnaW9uLm1tciA9ICEhKGhhbGZ0b25lUmVnaW9uRmxhZ3MgJiAxKTsKICAgICAgaGFsZnRvbmVSZWdpb24udGVtcGxhdGUgPSBoYWxmdG9uZVJlZ2lvbkZsYWdzID4+IDEgJiAzOwogICAgICBoYWxmdG9uZVJlZ2lvbi5lbmFibGVTa2lwID0gISEoaGFsZnRvbmVSZWdpb25GbGFncyAmIDgpOwogICAgICBoYWxmdG9uZVJlZ2lvbi5jb21iaW5hdGlvbk9wZXJhdG9yID0gaGFsZnRvbmVSZWdpb25GbGFncyA+PiA0ICYgNzsKICAgICAgaGFsZnRvbmVSZWdpb24uZGVmYXVsdFBpeGVsVmFsdWUgPSBoYWxmdG9uZVJlZ2lvbkZsYWdzID4+IDcgJiAxOwogICAgICBoYWxmdG9uZVJlZ2lvbi5ncmlkV2lkdGggPSAoMCwgX2NvcmVfdXRpbHMucmVhZFVpbnQzMikoZGF0YSwgcG9zaXRpb24pOwogICAgICBwb3NpdGlvbiArPSA0OwogICAgICBoYWxmdG9uZVJlZ2lvbi5ncmlkSGVpZ2h0ID0gKDAsIF9jb3JlX3V0aWxzLnJlYWRVaW50MzIpKGRhdGEsIHBvc2l0aW9uKTsKICAgICAgcG9zaXRpb24gKz0gNDsKICAgICAgaGFsZnRvbmVSZWdpb24uZ3JpZE9mZnNldFggPSAoMCwgX2NvcmVfdXRpbHMucmVhZFVpbnQzMikoZGF0YSwgcG9zaXRpb24pICYgMHhmZmZmZmZmZjsKICAgICAgcG9zaXRpb24gKz0gNDsKICAgICAgaGFsZnRvbmVSZWdpb24uZ3JpZE9mZnNldFkgPSAoMCwgX2NvcmVfdXRpbHMucmVhZFVpbnQzMikoZGF0YSwgcG9zaXRpb24pICYgMHhmZmZmZmZmZjsKICAgICAgcG9zaXRpb24gKz0gNDsKICAgICAgaGFsZnRvbmVSZWdpb24uZ3JpZFZlY3RvclggPSAoMCwgX2NvcmVfdXRpbHMucmVhZFVpbnQxNikoZGF0YSwgcG9zaXRpb24pOwogICAgICBwb3NpdGlvbiArPSAyOwogICAgICBoYWxmdG9uZVJlZ2lvbi5ncmlkVmVjdG9yWSA9ICgwLCBfY29yZV91dGlscy5yZWFkVWludDE2KShkYXRhLCBwb3NpdGlvbik7CiAgICAgIHBvc2l0aW9uICs9IDI7CiAgICAgIGFyZ3MgPSBbaGFsZnRvbmVSZWdpb24sIGhlYWRlci5yZWZlcnJlZFRvLCBkYXRhLCBwb3NpdGlvbiwgZW5kXTsKICAgICAgYnJlYWs7CiAgICBjYXNlIDM4OgogICAgY2FzZSAzOToKICAgICAgY29uc3QgZ2VuZXJpY1JlZ2lvbiA9IHt9OwogICAgICBnZW5lcmljUmVnaW9uLmluZm8gPSByZWFkUmVnaW9uU2VnbWVudEluZm9ybWF0aW9uKGRhdGEsIHBvc2l0aW9uKTsKICAgICAgcG9zaXRpb24gKz0gUmVnaW9uU2VnbWVudEluZm9ybWF0aW9uRmllbGRMZW5ndGg7CiAgICAgIGNvbnN0IGdlbmVyaWNSZWdpb25TZWdtZW50RmxhZ3MgPSBkYXRhW3Bvc2l0aW9uKytdOwogICAgICBnZW5lcmljUmVnaW9uLm1tciA9ICEhKGdlbmVyaWNSZWdpb25TZWdtZW50RmxhZ3MgJiAxKTsKICAgICAgZ2VuZXJpY1JlZ2lvbi50ZW1wbGF0ZSA9IGdlbmVyaWNSZWdpb25TZWdtZW50RmxhZ3MgPj4gMSAmIDM7CiAgICAgIGdlbmVyaWNSZWdpb24ucHJlZGljdGlvbiA9ICEhKGdlbmVyaWNSZWdpb25TZWdtZW50RmxhZ3MgJiA4KTsKICAgICAgaWYgKCFnZW5lcmljUmVnaW9uLm1tcikgewogICAgICAgIGF0TGVuZ3RoID0gZ2VuZXJpY1JlZ2lvbi50ZW1wbGF0ZSA9PT0gMCA/IDQgOiAxOwogICAgICAgIGF0ID0gW107CiAgICAgICAgZm9yIChpID0gMDsgaSA8IGF0TGVuZ3RoOyBpKyspIHsKICAgICAgICAgIGF0LnB1c2goewogICAgICAgICAgICB4OiAoMCwgX2NvcmVfdXRpbHMucmVhZEludDgpKGRhdGEsIHBvc2l0aW9uKSwKICAgICAgICAgICAgeTogKDAsIF9jb3JlX3V0aWxzLnJlYWRJbnQ4KShkYXRhLCBwb3NpdGlvbiArIDEpCiAgICAgICAgICB9KTsKICAgICAgICAgIHBvc2l0aW9uICs9IDI7CiAgICAgICAgfQogICAgICAgIGdlbmVyaWNSZWdpb24uYXQgPSBhdDsKICAgICAgfQogICAgICBhcmdzID0gW2dlbmVyaWNSZWdpb24sIGRhdGEsIHBvc2l0aW9uLCBlbmRdOwogICAgICBicmVhazsKICAgIGNhc2UgNDg6CiAgICAgIGNvbnN0IHBhZ2VJbmZvID0gewogICAgICAgIHdpZHRoOiAoMCwgX2NvcmVfdXRpbHMucmVhZFVpbnQzMikoZGF0YSwgcG9zaXRpb24pLAogICAgICAgIGhlaWdodDogKDAsIF9jb3JlX3V0aWxzLnJlYWRVaW50MzIpKGRhdGEsIHBvc2l0aW9uICsgNCksCiAgICAgICAgcmVzb2x1dGlvblg6ICgwLCBfY29yZV91dGlscy5yZWFkVWludDMyKShkYXRhLCBwb3NpdGlvbiArIDgpLAogICAgICAgIHJlc29sdXRpb25ZOiAoMCwgX2NvcmVfdXRpbHMucmVhZFVpbnQzMikoZGF0YSwgcG9zaXRpb24gKyAxMikKICAgICAgfTsKICAgICAgaWYgKHBhZ2VJbmZvLmhlaWdodCA9PT0gMHhmZmZmZmZmZikgewogICAgICAgIGRlbGV0ZSBwYWdlSW5mby5oZWlnaHQ7CiAgICAgIH0KICAgICAgY29uc3QgcGFnZVNlZ21lbnRGbGFncyA9IGRhdGFbcG9zaXRpb24gKyAxNl07CiAgICAgICgwLCBfY29yZV91dGlscy5yZWFkVWludDE2KShkYXRhLCBwb3NpdGlvbiArIDE3KTsKICAgICAgcGFnZUluZm8ubG9zc2xlc3MgPSAhIShwYWdlU2VnbWVudEZsYWdzICYgMSk7CiAgICAgIHBhZ2VJbmZvLnJlZmluZW1lbnQgPSAhIShwYWdlU2VnbWVudEZsYWdzICYgMik7CiAgICAgIHBhZ2VJbmZvLmRlZmF1bHRQaXhlbFZhbHVlID0gcGFnZVNlZ21lbnRGbGFncyA+PiAyICYgMTsKICAgICAgcGFnZUluZm8uY29tYmluYXRpb25PcGVyYXRvciA9IHBhZ2VTZWdtZW50RmxhZ3MgPj4gMyAmIDM7CiAgICAgIHBhZ2VJbmZvLnJlcXVpcmVzQnVmZmVyID0gISEocGFnZVNlZ21lbnRGbGFncyAmIDMyKTsKICAgICAgcGFnZUluZm8uY29tYmluYXRpb25PcGVyYXRvck92ZXJyaWRlID0gISEocGFnZVNlZ21lbnRGbGFncyAmIDY0KTsKICAgICAgYXJncyA9IFtwYWdlSW5mb107CiAgICAgIGJyZWFrOwogICAgY2FzZSA0OToKICAgICAgYnJlYWs7CiAgICBjYXNlIDUwOgogICAgICBicmVhazsKICAgIGNhc2UgNTE6CiAgICAgIGJyZWFrOwogICAgY2FzZSA1MzoKICAgICAgYXJncyA9IFtoZWFkZXIubnVtYmVyLCBkYXRhLCBwb3NpdGlvbiwgZW5kXTsKICAgICAgYnJlYWs7CiAgICBjYXNlIDYyOgogICAgICBicmVhazsKICAgIGRlZmF1bHQ6CiAgICAgIHRocm93IG5ldyBKYmlnMkVycm9yKGBzZWdtZW50IHR5cGUgJHtoZWFkZXIudHlwZU5hbWV9KCR7aGVhZGVyLnR5cGV9KSBpcyBub3QgaW1wbGVtZW50ZWRgKTsKICB9CiAgY29uc3QgY2FsbGJhY2tOYW1lID0gIm9uIiArIGhlYWRlci50eXBlTmFtZTsKICBpZiAoY2FsbGJhY2tOYW1lIGluIHZpc2l0b3IpIHsKICAgIHZpc2l0b3JbY2FsbGJhY2tOYW1lXS5hcHBseSh2aXNpdG9yLCBhcmdzKTsKICB9Cn0KZnVuY3Rpb24gcHJvY2Vzc1NlZ21lbnRzKHNlZ21lbnRzLCB2aXNpdG9yKSB7CiAgZm9yIChsZXQgaSA9IDAsIGlpID0gc2VnbWVudHMubGVuZ3RoOyBpIDwgaWk7IGkrKykgewogICAgcHJvY2Vzc1NlZ21lbnQoc2VnbWVudHNbaV0sIHZpc2l0b3IpOwogIH0KfQpmdW5jdGlvbiBwYXJzZUpiaWcyQ2h1bmtzKGNodW5rcykgewogIGNvbnN0IHZpc2l0b3IgPSBuZXcgU2ltcGxlU2VnbWVudFZpc2l0b3IoKTsKICBmb3IgKGxldCBpID0gMCwgaWkgPSBjaHVua3MubGVuZ3RoOyBpIDwgaWk7IGkrKykgewogICAgY29uc3QgY2h1bmsgPSBjaHVua3NbaV07CiAgICBjb25zdCBzZWdtZW50cyA9IHJlYWRTZWdtZW50cyh7fSwgY2h1bmsuZGF0YSwgY2h1bmsuc3RhcnQsIGNodW5rLmVuZCk7CiAgICBwcm9jZXNzU2VnbWVudHMoc2VnbWVudHMsIHZpc2l0b3IpOwogIH0KICByZXR1cm4gdmlzaXRvci5idWZmZXI7Cn0KZnVuY3Rpb24gcGFyc2VKYmlnMihkYXRhKSB7CiAgdGhyb3cgbmV3IEVycm9yKCJOb3QgaW1wbGVtZW50ZWQ6IHBhcnNlSmJpZzIiKTsKfQpjbGFzcyBTaW1wbGVTZWdtZW50VmlzaXRvciB7CiAgb25QYWdlSW5mb3JtYXRpb24oaW5mbykgewogICAgdGhpcy5jdXJyZW50UGFnZUluZm8gPSBpbmZvOwogICAgY29uc3Qgcm93U2l6ZSA9IGluZm8ud2lkdGggKyA3ID4+IDM7CiAgICBjb25zdCBidWZmZXIgPSBuZXcgVWludDhDbGFtcGVkQXJyYXkocm93U2l6ZSAqIGluZm8uaGVpZ2h0KTsKICAgIGlmIChpbmZvLmRlZmF1bHRQaXhlbFZhbHVlKSB7CiAgICAgIGJ1ZmZlci5maWxsKDB4ZmYpOwogICAgfQogICAgdGhpcy5idWZmZXIgPSBidWZmZXI7CiAgfQogIGRyYXdCaXRtYXAocmVnaW9uSW5mbywgYml0bWFwKSB7CiAgICBjb25zdCBwYWdlSW5mbyA9IHRoaXMuY3VycmVudFBhZ2VJbmZvOwogICAgY29uc3Qgd2lkdGggPSByZWdpb25JbmZvLndpZHRoLAogICAgICBoZWlnaHQgPSByZWdpb25JbmZvLmhlaWdodDsKICAgIGNvbnN0IHJvd1NpemUgPSBwYWdlSW5mby53aWR0aCArIDcgPj4gMzsKICAgIGNvbnN0IGNvbWJpbmF0aW9uT3BlcmF0b3IgPSBwYWdlSW5mby5jb21iaW5hdGlvbk9wZXJhdG9yT3ZlcnJpZGUgPyByZWdpb25JbmZvLmNvbWJpbmF0aW9uT3BlcmF0b3IgOiBwYWdlSW5mby5jb21iaW5hdGlvbk9wZXJhdG9yOwogICAgY29uc3QgYnVmZmVyID0gdGhpcy5idWZmZXI7CiAgICBjb25zdCBtYXNrMCA9IDEyOCA+PiAocmVnaW9uSW5mby54ICYgNyk7CiAgICBsZXQgb2Zmc2V0MCA9IHJlZ2lvbkluZm8ueSAqIHJvd1NpemUgKyAocmVnaW9uSW5mby54ID4+IDMpOwogICAgbGV0IGksIGosIG1hc2ssIG9mZnNldDsKICAgIHN3aXRjaCAoY29tYmluYXRpb25PcGVyYXRvcikgewogICAgICBjYXNlIDA6CiAgICAgICAgZm9yIChpID0gMDsgaSA8IGhlaWdodDsgaSsrKSB7CiAgICAgICAgICBtYXNrID0gbWFzazA7CiAgICAgICAgICBvZmZzZXQgPSBvZmZzZXQwOwogICAgICAgICAgZm9yIChqID0gMDsgaiA8IHdpZHRoOyBqKyspIHsKICAgICAgICAgICAgaWYgKGJpdG1hcFtpXVtqXSkgewogICAgICAgICAgICAgIGJ1ZmZlcltvZmZzZXRdIHw9IG1hc2s7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgbWFzayA+Pj0gMTsKICAgICAgICAgICAgaWYgKCFtYXNrKSB7CiAgICAgICAgICAgICAgbWFzayA9IDEyODsKICAgICAgICAgICAgICBvZmZzZXQrKzsKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgICAgb2Zmc2V0MCArPSByb3dTaXplOwogICAgICAgIH0KICAgICAgICBicmVhazsKICAgICAgY2FzZSAyOgogICAgICAgIGZvciAoaSA9IDA7IGkgPCBoZWlnaHQ7IGkrKykgewogICAgICAgICAgbWFzayA9IG1hc2swOwogICAgICAgICAgb2Zmc2V0ID0gb2Zmc2V0MDsKICAgICAgICAgIGZvciAoaiA9IDA7IGogPCB3aWR0aDsgaisrKSB7CiAgICAgICAgICAgIGlmIChiaXRtYXBbaV1bal0pIHsKICAgICAgICAgICAgICBidWZmZXJbb2Zmc2V0XSBePSBtYXNrOwogICAgICAgICAgICB9CiAgICAgICAgICAgIG1hc2sgPj49IDE7CiAgICAgICAgICAgIGlmICghbWFzaykgewogICAgICAgICAgICAgIG1hc2sgPSAxMjg7CiAgICAgICAgICAgICAgb2Zmc2V0Kys7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICAgIG9mZnNldDAgKz0gcm93U2l6ZTsKICAgICAgICB9CiAgICAgICAgYnJlYWs7CiAgICAgIGRlZmF1bHQ6CiAgICAgICAgdGhyb3cgbmV3IEpiaWcyRXJyb3IoYG9wZXJhdG9yICR7Y29tYmluYXRpb25PcGVyYXRvcn0gaXMgbm90IHN1cHBvcnRlZGApOwogICAgfQogIH0KICBvbkltbWVkaWF0ZUdlbmVyaWNSZWdpb24ocmVnaW9uLCBkYXRhLCBzdGFydCwgZW5kKSB7CiAgICBjb25zdCByZWdpb25JbmZvID0gcmVnaW9uLmluZm87CiAgICBjb25zdCBkZWNvZGluZ0NvbnRleHQgPSBuZXcgRGVjb2RpbmdDb250ZXh0KGRhdGEsIHN0YXJ0LCBlbmQpOwogICAgY29uc3QgYml0bWFwID0gZGVjb2RlQml0bWFwKHJlZ2lvbi5tbXIsIHJlZ2lvbkluZm8ud2lkdGgsIHJlZ2lvbkluZm8uaGVpZ2h0LCByZWdpb24udGVtcGxhdGUsIHJlZ2lvbi5wcmVkaWN0aW9uLCBudWxsLCByZWdpb24uYXQsIGRlY29kaW5nQ29udGV4dCk7CiAgICB0aGlzLmRyYXdCaXRtYXAocmVnaW9uSW5mbywgYml0bWFwKTsKICB9CiAgb25JbW1lZGlhdGVMb3NzbGVzc0dlbmVyaWNSZWdpb24oKSB7CiAgICB0aGlzLm9uSW1tZWRpYXRlR2VuZXJpY1JlZ2lvbiguLi5hcmd1bWVudHMpOwogIH0KICBvblN5bWJvbERpY3Rpb25hcnkoZGljdGlvbmFyeSwgY3VycmVudFNlZ21lbnQsIHJlZmVycmVkU2VnbWVudHMsIGRhdGEsIHN0YXJ0LCBlbmQpIHsKICAgIGxldCBodWZmbWFuVGFibGVzLCBodWZmbWFuSW5wdXQ7CiAgICBpZiAoZGljdGlvbmFyeS5odWZmbWFuKSB7CiAgICAgIGh1ZmZtYW5UYWJsZXMgPSBnZXRTeW1ib2xEaWN0aW9uYXJ5SHVmZm1hblRhYmxlcyhkaWN0aW9uYXJ5LCByZWZlcnJlZFNlZ21lbnRzLCB0aGlzLmN1c3RvbVRhYmxlcyk7CiAgICAgIGh1ZmZtYW5JbnB1dCA9IG5ldyBSZWFkZXIoZGF0YSwgc3RhcnQsIGVuZCk7CiAgICB9CiAgICBsZXQgc3ltYm9scyA9IHRoaXMuc3ltYm9sczsKICAgIGlmICghc3ltYm9scykgewogICAgICB0aGlzLnN5bWJvbHMgPSBzeW1ib2xzID0ge307CiAgICB9CiAgICBjb25zdCBpbnB1dFN5bWJvbHMgPSBbXTsKICAgIGZvciAoY29uc3QgcmVmZXJyZWRTZWdtZW50IG9mIHJlZmVycmVkU2VnbWVudHMpIHsKICAgICAgY29uc3QgcmVmZXJyZWRTeW1ib2xzID0gc3ltYm9sc1tyZWZlcnJlZFNlZ21lbnRdOwogICAgICBpZiAocmVmZXJyZWRTeW1ib2xzKSB7CiAgICAgICAgaW5wdXRTeW1ib2xzLnB1c2goLi4ucmVmZXJyZWRTeW1ib2xzKTsKICAgICAgfQogICAgfQogICAgY29uc3QgZGVjb2RpbmdDb250ZXh0ID0gbmV3IERlY29kaW5nQ29udGV4dChkYXRhLCBzdGFydCwgZW5kKTsKICAgIHN5bWJvbHNbY3VycmVudFNlZ21lbnRdID0gZGVjb2RlU3ltYm9sRGljdGlvbmFyeShkaWN0aW9uYXJ5Lmh1ZmZtYW4sIGRpY3Rpb25hcnkucmVmaW5lbWVudCwgaW5wdXRTeW1ib2xzLCBkaWN0aW9uYXJ5Lm51bWJlck9mTmV3U3ltYm9scywgZGljdGlvbmFyeS5udW1iZXJPZkV4cG9ydGVkU3ltYm9scywgaHVmZm1hblRhYmxlcywgZGljdGlvbmFyeS50ZW1wbGF0ZSwgZGljdGlvbmFyeS5hdCwgZGljdGlvbmFyeS5yZWZpbmVtZW50VGVtcGxhdGUsIGRpY3Rpb25hcnkucmVmaW5lbWVudEF0LCBkZWNvZGluZ0NvbnRleHQsIGh1ZmZtYW5JbnB1dCk7CiAgfQogIG9uSW1tZWRpYXRlVGV4dFJlZ2lvbihyZWdpb24sIHJlZmVycmVkU2VnbWVudHMsIGRhdGEsIHN0YXJ0LCBlbmQpIHsKICAgIGNvbnN0IHJlZ2lvbkluZm8gPSByZWdpb24uaW5mbzsKICAgIGxldCBodWZmbWFuVGFibGVzLCBodWZmbWFuSW5wdXQ7CiAgICBjb25zdCBzeW1ib2xzID0gdGhpcy5zeW1ib2xzOwogICAgY29uc3QgaW5wdXRTeW1ib2xzID0gW107CiAgICBmb3IgKGNvbnN0IHJlZmVycmVkU2VnbWVudCBvZiByZWZlcnJlZFNlZ21lbnRzKSB7CiAgICAgIGNvbnN0IHJlZmVycmVkU3ltYm9scyA9IHN5bWJvbHNbcmVmZXJyZWRTZWdtZW50XTsKICAgICAgaWYgKHJlZmVycmVkU3ltYm9scykgewogICAgICAgIGlucHV0U3ltYm9scy5wdXNoKC4uLnJlZmVycmVkU3ltYm9scyk7CiAgICAgIH0KICAgIH0KICAgIGNvbnN0IHN5bWJvbENvZGVMZW5ndGggPSAoMCwgX2NvcmVfdXRpbHMubG9nMikoaW5wdXRTeW1ib2xzLmxlbmd0aCk7CiAgICBpZiAocmVnaW9uLmh1ZmZtYW4pIHsKICAgICAgaHVmZm1hbklucHV0ID0gbmV3IFJlYWRlcihkYXRhLCBzdGFydCwgZW5kKTsKICAgICAgaHVmZm1hblRhYmxlcyA9IGdldFRleHRSZWdpb25IdWZmbWFuVGFibGVzKHJlZ2lvbiwgcmVmZXJyZWRTZWdtZW50cywgdGhpcy5jdXN0b21UYWJsZXMsIGlucHV0U3ltYm9scy5sZW5ndGgsIGh1ZmZtYW5JbnB1dCk7CiAgICB9CiAgICBjb25zdCBkZWNvZGluZ0NvbnRleHQgPSBuZXcgRGVjb2RpbmdDb250ZXh0KGRhdGEsIHN0YXJ0LCBlbmQpOwogICAgY29uc3QgYml0bWFwID0gZGVjb2RlVGV4dFJlZ2lvbihyZWdpb24uaHVmZm1hbiwgcmVnaW9uLnJlZmluZW1lbnQsIHJlZ2lvbkluZm8ud2lkdGgsIHJlZ2lvbkluZm8uaGVpZ2h0LCByZWdpb24uZGVmYXVsdFBpeGVsVmFsdWUsIHJlZ2lvbi5udW1iZXJPZlN5bWJvbEluc3RhbmNlcywgcmVnaW9uLnN0cmlwU2l6ZSwgaW5wdXRTeW1ib2xzLCBzeW1ib2xDb2RlTGVuZ3RoLCByZWdpb24udHJhbnNwb3NlZCwgcmVnaW9uLmRzT2Zmc2V0LCByZWdpb24ucmVmZXJlbmNlQ29ybmVyLCByZWdpb24uY29tYmluYXRpb25PcGVyYXRvciwgaHVmZm1hblRhYmxlcywgcmVnaW9uLnJlZmluZW1lbnRUZW1wbGF0ZSwgcmVnaW9uLnJlZmluZW1lbnRBdCwgZGVjb2RpbmdDb250ZXh0LCByZWdpb24ubG9nU3RyaXBTaXplLCBodWZmbWFuSW5wdXQpOwogICAgdGhpcy5kcmF3Qml0bWFwKHJlZ2lvbkluZm8sIGJpdG1hcCk7CiAgfQogIG9uSW1tZWRpYXRlTG9zc2xlc3NUZXh0UmVnaW9uKCkgewogICAgdGhpcy5vbkltbWVkaWF0ZVRleHRSZWdpb24oLi4uYXJndW1lbnRzKTsKICB9CiAgb25QYXR0ZXJuRGljdGlvbmFyeShkaWN0aW9uYXJ5LCBjdXJyZW50U2VnbWVudCwgZGF0YSwgc3RhcnQsIGVuZCkgewogICAgbGV0IHBhdHRlcm5zID0gdGhpcy5wYXR0ZXJuczsKICAgIGlmICghcGF0dGVybnMpIHsKICAgICAgdGhpcy5wYXR0ZXJucyA9IHBhdHRlcm5zID0ge307CiAgICB9CiAgICBjb25zdCBkZWNvZGluZ0NvbnRleHQgPSBuZXcgRGVjb2RpbmdDb250ZXh0KGRhdGEsIHN0YXJ0LCBlbmQpOwogICAgcGF0dGVybnNbY3VycmVudFNlZ21lbnRdID0gZGVjb2RlUGF0dGVybkRpY3Rpb25hcnkoZGljdGlvbmFyeS5tbXIsIGRpY3Rpb25hcnkucGF0dGVybldpZHRoLCBkaWN0aW9uYXJ5LnBhdHRlcm5IZWlnaHQsIGRpY3Rpb25hcnkubWF4UGF0dGVybkluZGV4LCBkaWN0aW9uYXJ5LnRlbXBsYXRlLCBkZWNvZGluZ0NvbnRleHQpOwogIH0KICBvbkltbWVkaWF0ZUhhbGZ0b25lUmVnaW9uKHJlZ2lvbiwgcmVmZXJyZWRTZWdtZW50cywgZGF0YSwgc3RhcnQsIGVuZCkgewogICAgY29uc3QgcGF0dGVybnMgPSB0aGlzLnBhdHRlcm5zW3JlZmVycmVkU2VnbWVudHNbMF1dOwogICAgY29uc3QgcmVnaW9uSW5mbyA9IHJlZ2lvbi5pbmZvOwogICAgY29uc3QgZGVjb2RpbmdDb250ZXh0ID0gbmV3IERlY29kaW5nQ29udGV4dChkYXRhLCBzdGFydCwgZW5kKTsKICAgIGNvbnN0IGJpdG1hcCA9IGRlY29kZUhhbGZ0b25lUmVnaW9uKHJlZ2lvbi5tbXIsIHBhdHRlcm5zLCByZWdpb24udGVtcGxhdGUsIHJlZ2lvbkluZm8ud2lkdGgsIHJlZ2lvbkluZm8uaGVpZ2h0LCByZWdpb24uZGVmYXVsdFBpeGVsVmFsdWUsIHJlZ2lvbi5lbmFibGVTa2lwLCByZWdpb24uY29tYmluYXRpb25PcGVyYXRvciwgcmVnaW9uLmdyaWRXaWR0aCwgcmVnaW9uLmdyaWRIZWlnaHQsIHJlZ2lvbi5ncmlkT2Zmc2V0WCwgcmVnaW9uLmdyaWRPZmZzZXRZLCByZWdpb24uZ3JpZFZlY3RvclgsIHJlZ2lvbi5ncmlkVmVjdG9yWSwgZGVjb2RpbmdDb250ZXh0KTsKICAgIHRoaXMuZHJhd0JpdG1hcChyZWdpb25JbmZvLCBiaXRtYXApOwogIH0KICBvbkltbWVkaWF0ZUxvc3NsZXNzSGFsZnRvbmVSZWdpb24oKSB7CiAgICB0aGlzLm9uSW1tZWRpYXRlSGFsZnRvbmVSZWdpb24oLi4uYXJndW1lbnRzKTsKICB9CiAgb25UYWJsZXMoY3VycmVudFNlZ21lbnQsIGRhdGEsIHN0YXJ0LCBlbmQpIHsKICAgIGxldCBjdXN0b21UYWJsZXMgPSB0aGlzLmN1c3RvbVRhYmxlczsKICAgIGlmICghY3VzdG9tVGFibGVzKSB7CiAgICAgIHRoaXMuY3VzdG9tVGFibGVzID0gY3VzdG9tVGFibGVzID0ge307CiAgICB9CiAgICBjdXN0b21UYWJsZXNbY3VycmVudFNlZ21lbnRdID0gZGVjb2RlVGFibGVzU2VnbWVudChkYXRhLCBzdGFydCwgZW5kKTsKICB9Cn0KY2xhc3MgSHVmZm1hbkxpbmUgewogIGNvbnN0cnVjdG9yKGxpbmVEYXRhKSB7CiAgICBpZiAobGluZURhdGEubGVuZ3RoID09PSAyKSB7CiAgICAgIHRoaXMuaXNPT0IgPSB0cnVlOwogICAgICB0aGlzLnJhbmdlTG93ID0gMDsKICAgICAgdGhpcy5wcmVmaXhMZW5ndGggPSBsaW5lRGF0YVswXTsKICAgICAgdGhpcy5yYW5nZUxlbmd0aCA9IDA7CiAgICAgIHRoaXMucHJlZml4Q29kZSA9IGxpbmVEYXRhWzFdOwogICAgICB0aGlzLmlzTG93ZXJSYW5nZSA9IGZhbHNlOwogICAgfSBlbHNlIHsKICAgICAgdGhpcy5pc09PQiA9IGZhbHNlOwogICAgICB0aGlzLnJhbmdlTG93ID0gbGluZURhdGFbMF07CiAgICAgIHRoaXMucHJlZml4TGVuZ3RoID0gbGluZURhdGFbMV07CiAgICAgIHRoaXMucmFuZ2VMZW5ndGggPSBsaW5lRGF0YVsyXTsKICAgICAgdGhpcy5wcmVmaXhDb2RlID0gbGluZURhdGFbM107CiAgICAgIHRoaXMuaXNMb3dlclJhbmdlID0gbGluZURhdGFbNF0gPT09ICJsb3dlciI7CiAgICB9CiAgfQp9CmNsYXNzIEh1ZmZtYW5UcmVlTm9kZSB7CiAgY29uc3RydWN0b3IobGluZSkgewogICAgdGhpcy5jaGlsZHJlbiA9IFtdOwogICAgaWYgKGxpbmUpIHsKICAgICAgdGhpcy5pc0xlYWYgPSB0cnVlOwogICAgICB0aGlzLnJhbmdlTGVuZ3RoID0gbGluZS5yYW5nZUxlbmd0aDsKICAgICAgdGhpcy5yYW5nZUxvdyA9IGxpbmUucmFuZ2VMb3c7CiAgICAgIHRoaXMuaXNMb3dlclJhbmdlID0gbGluZS5pc0xvd2VyUmFuZ2U7CiAgICAgIHRoaXMuaXNPT0IgPSBsaW5lLmlzT09COwogICAgfSBlbHNlIHsKICAgICAgdGhpcy5pc0xlYWYgPSBmYWxzZTsKICAgIH0KICB9CiAgYnVpbGRUcmVlKGxpbmUsIHNoaWZ0KSB7CiAgICBjb25zdCBiaXQgPSBsaW5lLnByZWZpeENvZGUgPj4gc2hpZnQgJiAxOwogICAgaWYgKHNoaWZ0IDw9IDApIHsKICAgICAgdGhpcy5jaGlsZHJlbltiaXRdID0gbmV3IEh1ZmZtYW5UcmVlTm9kZShsaW5lKTsKICAgIH0gZWxzZSB7CiAgICAgIGxldCBub2RlID0gdGhpcy5jaGlsZHJlbltiaXRdOwogICAgICBpZiAoIW5vZGUpIHsKICAgICAgICB0aGlzLmNoaWxkcmVuW2JpdF0gPSBub2RlID0gbmV3IEh1ZmZtYW5UcmVlTm9kZShudWxsKTsKICAgICAgfQogICAgICBub2RlLmJ1aWxkVHJlZShsaW5lLCBzaGlmdCAtIDEpOwogICAgfQogIH0KICBkZWNvZGVOb2RlKHJlYWRlcikgewogICAgaWYgKHRoaXMuaXNMZWFmKSB7CiAgICAgIGlmICh0aGlzLmlzT09CKSB7CiAgICAgICAgcmV0dXJuIG51bGw7CiAgICAgIH0KICAgICAgY29uc3QgaHRPZmZzZXQgPSByZWFkZXIucmVhZEJpdHModGhpcy5yYW5nZUxlbmd0aCk7CiAgICAgIHJldHVybiB0aGlzLnJhbmdlTG93ICsgKHRoaXMuaXNMb3dlclJhbmdlID8gLWh0T2Zmc2V0IDogaHRPZmZzZXQpOwogICAgfQogICAgY29uc3Qgbm9kZSA9IHRoaXMuY2hpbGRyZW5bcmVhZGVyLnJlYWRCaXQoKV07CiAgICBpZiAoIW5vZGUpIHsKICAgICAgdGhyb3cgbmV3IEpiaWcyRXJyb3IoImludmFsaWQgSHVmZm1hbiBkYXRhIik7CiAgICB9CiAgICByZXR1cm4gbm9kZS5kZWNvZGVOb2RlKHJlYWRlcik7CiAgfQp9CmNsYXNzIEh1ZmZtYW5UYWJsZSB7CiAgY29uc3RydWN0b3IobGluZXMsIHByZWZpeENvZGVzRG9uZSkgewogICAgaWYgKCFwcmVmaXhDb2Rlc0RvbmUpIHsKICAgICAgdGhpcy5hc3NpZ25QcmVmaXhDb2RlcyhsaW5lcyk7CiAgICB9CiAgICB0aGlzLnJvb3ROb2RlID0gbmV3IEh1ZmZtYW5UcmVlTm9kZShudWxsKTsKICAgIGZvciAobGV0IGkgPSAwLCBpaSA9IGxpbmVzLmxlbmd0aDsgaSA8IGlpOyBpKyspIHsKICAgICAgY29uc3QgbGluZSA9IGxpbmVzW2ldOwogICAgICBpZiAobGluZS5wcmVmaXhMZW5ndGggPiAwKSB7CiAgICAgICAgdGhpcy5yb290Tm9kZS5idWlsZFRyZWUobGluZSwgbGluZS5wcmVmaXhMZW5ndGggLSAxKTsKICAgICAgfQogICAgfQogIH0KICBkZWNvZGUocmVhZGVyKSB7CiAgICByZXR1cm4gdGhpcy5yb290Tm9kZS5kZWNvZGVOb2RlKHJlYWRlcik7CiAgfQogIGFzc2lnblByZWZpeENvZGVzKGxpbmVzKSB7CiAgICBjb25zdCBsaW5lc0xlbmd0aCA9IGxpbmVzLmxlbmd0aDsKICAgIGxldCBwcmVmaXhMZW5ndGhNYXggPSAwOwogICAgZm9yIChsZXQgaSA9IDA7IGkgPCBsaW5lc0xlbmd0aDsgaSsrKSB7CiAgICAgIHByZWZpeExlbmd0aE1heCA9IE1hdGgubWF4KHByZWZpeExlbmd0aE1heCwgbGluZXNbaV0ucHJlZml4TGVuZ3RoKTsKICAgIH0KICAgIGNvbnN0IGhpc3RvZ3JhbSA9IG5ldyBVaW50MzJBcnJheShwcmVmaXhMZW5ndGhNYXggKyAxKTsKICAgIGZvciAobGV0IGkgPSAwOyBpIDwgbGluZXNMZW5ndGg7IGkrKykgewogICAgICBoaXN0b2dyYW1bbGluZXNbaV0ucHJlZml4TGVuZ3RoXSsrOwogICAgfQogICAgbGV0IGN1cnJlbnRMZW5ndGggPSAxLAogICAgICBmaXJzdENvZGUgPSAwLAogICAgICBjdXJyZW50Q29kZSwKICAgICAgY3VycmVudFRlbXAsCiAgICAgIGxpbmU7CiAgICBoaXN0b2dyYW1bMF0gPSAwOwogICAgd2hpbGUgKGN1cnJlbnRMZW5ndGggPD0gcHJlZml4TGVuZ3RoTWF4KSB7CiAgICAgIGZpcnN0Q29kZSA9IGZpcnN0Q29kZSArIGhpc3RvZ3JhbVtjdXJyZW50TGVuZ3RoIC0gMV0gPDwgMTsKICAgICAgY3VycmVudENvZGUgPSBmaXJzdENvZGU7CiAgICAgIGN1cnJlbnRUZW1wID0gMDsKICAgICAgd2hpbGUgKGN1cnJlbnRUZW1wIDwgbGluZXNMZW5ndGgpIHsKICAgICAgICBsaW5lID0gbGluZXNbY3VycmVudFRlbXBdOwogICAgICAgIGlmIChsaW5lLnByZWZpeExlbmd0aCA9PT0gY3VycmVudExlbmd0aCkgewogICAgICAgICAgbGluZS5wcmVmaXhDb2RlID0gY3VycmVudENvZGU7CiAgICAgICAgICBjdXJyZW50Q29kZSsrOwogICAgICAgIH0KICAgICAgICBjdXJyZW50VGVtcCsrOwogICAgICB9CiAgICAgIGN1cnJlbnRMZW5ndGgrKzsKICAgIH0KICB9Cn0KZnVuY3Rpb24gZGVjb2RlVGFibGVzU2VnbWVudChkYXRhLCBzdGFydCwgZW5kKSB7CiAgY29uc3QgZmxhZ3MgPSBkYXRhW3N0YXJ0XTsKICBjb25zdCBsb3dlc3RWYWx1ZSA9ICgwLCBfY29yZV91dGlscy5yZWFkVWludDMyKShkYXRhLCBzdGFydCArIDEpICYgMHhmZmZmZmZmZjsKICBjb25zdCBoaWdoZXN0VmFsdWUgPSAoMCwgX2NvcmVfdXRpbHMucmVhZFVpbnQzMikoZGF0YSwgc3RhcnQgKyA1KSAmIDB4ZmZmZmZmZmY7CiAgY29uc3QgcmVhZGVyID0gbmV3IFJlYWRlcihkYXRhLCBzdGFydCArIDksIGVuZCk7CiAgY29uc3QgcHJlZml4U2l6ZUJpdHMgPSAoZmxhZ3MgPj4gMSAmIDcpICsgMTsKICBjb25zdCByYW5nZVNpemVCaXRzID0gKGZsYWdzID4+IDQgJiA3KSArIDE7CiAgY29uc3QgbGluZXMgPSBbXTsKICBsZXQgcHJlZml4TGVuZ3RoLAogICAgcmFuZ2VMZW5ndGgsCiAgICBjdXJyZW50UmFuZ2VMb3cgPSBsb3dlc3RWYWx1ZTsKICBkbyB7CiAgICBwcmVmaXhMZW5ndGggPSByZWFkZXIucmVhZEJpdHMocHJlZml4U2l6ZUJpdHMpOwogICAgcmFuZ2VMZW5ndGggPSByZWFkZXIucmVhZEJpdHMocmFuZ2VTaXplQml0cyk7CiAgICBsaW5lcy5wdXNoKG5ldyBIdWZmbWFuTGluZShbY3VycmVudFJhbmdlTG93LCBwcmVmaXhMZW5ndGgsIHJhbmdlTGVuZ3RoLCAwXSkpOwogICAgY3VycmVudFJhbmdlTG93ICs9IDEgPDwgcmFuZ2VMZW5ndGg7CiAgfSB3aGlsZSAoY3VycmVudFJhbmdlTG93IDwgaGlnaGVzdFZhbHVlKTsKICBwcmVmaXhMZW5ndGggPSByZWFkZXIucmVhZEJpdHMocHJlZml4U2l6ZUJpdHMpOwogIGxpbmVzLnB1c2gobmV3IEh1ZmZtYW5MaW5lKFtsb3dlc3RWYWx1ZSAtIDEsIHByZWZpeExlbmd0aCwgMzIsIDAsICJsb3dlciJdKSk7CiAgcHJlZml4TGVuZ3RoID0gcmVhZGVyLnJlYWRCaXRzKHByZWZpeFNpemVCaXRzKTsKICBsaW5lcy5wdXNoKG5ldyBIdWZmbWFuTGluZShbaGlnaGVzdFZhbHVlLCBwcmVmaXhMZW5ndGgsIDMyLCAwXSkpOwogIGlmIChmbGFncyAmIDEpIHsKICAgIHByZWZpeExlbmd0aCA9IHJlYWRlci5yZWFkQml0cyhwcmVmaXhTaXplQml0cyk7CiAgICBsaW5lcy5wdXNoKG5ldyBIdWZmbWFuTGluZShbcHJlZml4TGVuZ3RoLCAwXSkpOwogIH0KICByZXR1cm4gbmV3IEh1ZmZtYW5UYWJsZShsaW5lcywgZmFsc2UpOwp9CmNvbnN0IHN0YW5kYXJkVGFibGVzQ2FjaGUgPSB7fTsKZnVuY3Rpb24gZ2V0U3RhbmRhcmRUYWJsZShudW1iZXIpIHsKICBsZXQgdGFibGUgPSBzdGFuZGFyZFRhYmxlc0NhY2hlW251bWJlcl07CiAgaWYgKHRhYmxlKSB7CiAgICByZXR1cm4gdGFibGU7CiAgfQogIGxldCBsaW5lczsKICBzd2l0Y2ggKG51bWJlcikgewogICAgY2FzZSAxOgogICAgICBsaW5lcyA9IFtbMCwgMSwgNCwgMHgwXSwgWzE2LCAyLCA4LCAweDJdLCBbMjcyLCAzLCAxNiwgMHg2XSwgWzY1ODA4LCAzLCAzMiwgMHg3XV07CiAgICAgIGJyZWFrOwogICAgY2FzZSAyOgogICAgICBsaW5lcyA9IFtbMCwgMSwgMCwgMHgwXSwgWzEsIDIsIDAsIDB4Ml0sIFsyLCAzLCAwLCAweDZdLCBbMywgNCwgMywgMHhlXSwgWzExLCA1LCA2LCAweDFlXSwgWzc1LCA2LCAzMiwgMHgzZV0sIFs2LCAweDNmXV07CiAgICAgIGJyZWFrOwogICAgY2FzZSAzOgogICAgICBsaW5lcyA9IFtbLTI1NiwgOCwgOCwgMHhmZV0sIFswLCAxLCAwLCAweDBdLCBbMSwgMiwgMCwgMHgyXSwgWzIsIDMsIDAsIDB4Nl0sIFszLCA0LCAzLCAweGVdLCBbMTEsIDUsIDYsIDB4MWVdLCBbLTI1NywgOCwgMzIsIDB4ZmYsICJsb3dlciJdLCBbNzUsIDcsIDMyLCAweDdlXSwgWzYsIDB4M2VdXTsKICAgICAgYnJlYWs7CiAgICBjYXNlIDQ6CiAgICAgIGxpbmVzID0gW1sxLCAxLCAwLCAweDBdLCBbMiwgMiwgMCwgMHgyXSwgWzMsIDMsIDAsIDB4Nl0sIFs0LCA0LCAzLCAweGVdLCBbMTIsIDUsIDYsIDB4MWVdLCBbNzYsIDUsIDMyLCAweDFmXV07CiAgICAgIGJyZWFrOwogICAgY2FzZSA1OgogICAgICBsaW5lcyA9IFtbLTI1NSwgNywgOCwgMHg3ZV0sIFsxLCAxLCAwLCAweDBdLCBbMiwgMiwgMCwgMHgyXSwgWzMsIDMsIDAsIDB4Nl0sIFs0LCA0LCAzLCAweGVdLCBbMTIsIDUsIDYsIDB4MWVdLCBbLTI1NiwgNywgMzIsIDB4N2YsICJsb3dlciJdLCBbNzYsIDYsIDMyLCAweDNlXV07CiAgICAgIGJyZWFrOwogICAgY2FzZSA2OgogICAgICBsaW5lcyA9IFtbLTIwNDgsIDUsIDEwLCAweDFjXSwgWy0xMDI0LCA0LCA5LCAweDhdLCBbLTUxMiwgNCwgOCwgMHg5XSwgWy0yNTYsIDQsIDcsIDB4YV0sIFstMTI4LCA1LCA2LCAweDFkXSwgWy02NCwgNSwgNSwgMHgxZV0sIFstMzIsIDQsIDUsIDB4Yl0sIFswLCAyLCA3LCAweDBdLCBbMTI4LCAzLCA3LCAweDJdLCBbMjU2LCAzLCA4LCAweDNdLCBbNTEyLCA0LCA5LCAweGNdLCBbMTAyNCwgNCwgMTAsIDB4ZF0sIFstMjA0OSwgNiwgMzIsIDB4M2UsICJsb3dlciJdLCBbMjA0OCwgNiwgMzIsIDB4M2ZdXTsKICAgICAgYnJlYWs7CiAgICBjYXNlIDc6CiAgICAgIGxpbmVzID0gW1stMTAyNCwgNCwgOSwgMHg4XSwgWy01MTIsIDMsIDgsIDB4MF0sIFstMjU2LCA0LCA3LCAweDldLCBbLTEyOCwgNSwgNiwgMHgxYV0sIFstNjQsIDUsIDUsIDB4MWJdLCBbLTMyLCA0LCA1LCAweGFdLCBbMCwgNCwgNSwgMHhiXSwgWzMyLCA1LCA1LCAweDFjXSwgWzY0LCA1LCA2LCAweDFkXSwgWzEyOCwgNCwgNywgMHhjXSwgWzI1NiwgMywgOCwgMHgxXSwgWzUxMiwgMywgOSwgMHgyXSwgWzEwMjQsIDMsIDEwLCAweDNdLCBbLTEwMjUsIDUsIDMyLCAweDFlLCAibG93ZXIiXSwgWzIwNDgsIDUsIDMyLCAweDFmXV07CiAgICAgIGJyZWFrOwogICAgY2FzZSA4OgogICAgICBsaW5lcyA9IFtbLTE1LCA4LCAzLCAweGZjXSwgWy03LCA5LCAxLCAweDFmY10sIFstNSwgOCwgMSwgMHhmZF0sIFstMywgOSwgMCwgMHgxZmRdLCBbLTIsIDcsIDAsIDB4N2NdLCBbLTEsIDQsIDAsIDB4YV0sIFswLCAyLCAxLCAweDBdLCBbMiwgNSwgMCwgMHgxYV0sIFszLCA2LCAwLCAweDNhXSwgWzQsIDMsIDQsIDB4NF0sIFsyMCwgNiwgMSwgMHgzYl0sIFsyMiwgNCwgNCwgMHhiXSwgWzM4LCA0LCA1LCAweGNdLCBbNzAsIDUsIDYsIDB4MWJdLCBbMTM0LCA1LCA3LCAweDFjXSwgWzI2MiwgNiwgNywgMHgzY10sIFszOTAsIDcsIDgsIDB4N2RdLCBbNjQ2LCA2LCAxMCwgMHgzZF0sIFstMTYsIDksIDMyLCAweDFmZSwgImxvd2VyIl0sIFsxNjcwLCA5LCAzMiwgMHgxZmZdLCBbMiwgMHgxXV07CiAgICAgIGJyZWFrOwogICAgY2FzZSA5OgogICAgICBsaW5lcyA9IFtbLTMxLCA4LCA0LCAweGZjXSwgWy0xNSwgOSwgMiwgMHgxZmNdLCBbLTExLCA4LCAyLCAweGZkXSwgWy03LCA5LCAxLCAweDFmZF0sIFstNSwgNywgMSwgMHg3Y10sIFstMywgNCwgMSwgMHhhXSwgWy0xLCAzLCAxLCAweDJdLCBbMSwgMywgMSwgMHgzXSwgWzMsIDUsIDEsIDB4MWFdLCBbNSwgNiwgMSwgMHgzYV0sIFs3LCAzLCA1LCAweDRdLCBbMzksIDYsIDIsIDB4M2JdLCBbNDMsIDQsIDUsIDB4Yl0sIFs3NSwgNCwgNiwgMHhjXSwgWzEzOSwgNSwgNywgMHgxYl0sIFsyNjcsIDUsIDgsIDB4MWNdLCBbNTIzLCA2LCA4LCAweDNjXSwgWzc3OSwgNywgOSwgMHg3ZF0sIFsxMjkxLCA2LCAxMSwgMHgzZF0sIFstMzIsIDksIDMyLCAweDFmZSwgImxvd2VyIl0sIFszMzM5LCA5LCAzMiwgMHgxZmZdLCBbMiwgMHgwXV07CiAgICAgIGJyZWFrOwogICAgY2FzZSAxMDoKICAgICAgbGluZXMgPSBbWy0yMSwgNywgNCwgMHg3YV0sIFstNSwgOCwgMCwgMHhmY10sIFstNCwgNywgMCwgMHg3Yl0sIFstMywgNSwgMCwgMHgxOF0sIFstMiwgMiwgMiwgMHgwXSwgWzIsIDUsIDAsIDB4MTldLCBbMywgNiwgMCwgMHgzNl0sIFs0LCA3LCAwLCAweDdjXSwgWzUsIDgsIDAsIDB4ZmRdLCBbNiwgMiwgNiwgMHgxXSwgWzcwLCA1LCA1LCAweDFhXSwgWzEwMiwgNiwgNSwgMHgzN10sIFsxMzQsIDYsIDYsIDB4MzhdLCBbMTk4LCA2LCA3LCAweDM5XSwgWzMyNiwgNiwgOCwgMHgzYV0sIFs1ODIsIDYsIDksIDB4M2JdLCBbMTA5NCwgNiwgMTAsIDB4M2NdLCBbMjExOCwgNywgMTEsIDB4N2RdLCBbLTIyLCA4LCAzMiwgMHhmZSwgImxvd2VyIl0sIFs0MTY2LCA4LCAzMiwgMHhmZl0sIFsyLCAweDJdXTsKICAgICAgYnJlYWs7CiAgICBjYXNlIDExOgogICAgICBsaW5lcyA9IFtbMSwgMSwgMCwgMHgwXSwgWzIsIDIsIDEsIDB4Ml0sIFs0LCA0LCAwLCAweGNdLCBbNSwgNCwgMSwgMHhkXSwgWzcsIDUsIDEsIDB4MWNdLCBbOSwgNSwgMiwgMHgxZF0sIFsxMywgNiwgMiwgMHgzY10sIFsxNywgNywgMiwgMHg3YV0sIFsyMSwgNywgMywgMHg3Yl0sIFsyOSwgNywgNCwgMHg3Y10sIFs0NSwgNywgNSwgMHg3ZF0sIFs3NywgNywgNiwgMHg3ZV0sIFsxNDEsIDcsIDMyLCAweDdmXV07CiAgICAgIGJyZWFrOwogICAgY2FzZSAxMjoKICAgICAgbGluZXMgPSBbWzEsIDEsIDAsIDB4MF0sIFsyLCAyLCAwLCAweDJdLCBbMywgMywgMSwgMHg2XSwgWzUsIDUsIDAsIDB4MWNdLCBbNiwgNSwgMSwgMHgxZF0sIFs4LCA2LCAxLCAweDNjXSwgWzEwLCA3LCAwLCAweDdhXSwgWzExLCA3LCAxLCAweDdiXSwgWzEzLCA3LCAyLCAweDdjXSwgWzE3LCA3LCAzLCAweDdkXSwgWzI1LCA3LCA0LCAweDdlXSwgWzQxLCA4LCA1LCAweGZlXSwgWzczLCA4LCAzMiwgMHhmZl1dOwogICAgICBicmVhazsKICAgIGNhc2UgMTM6CiAgICAgIGxpbmVzID0gW1sxLCAxLCAwLCAweDBdLCBbMiwgMywgMCwgMHg0XSwgWzMsIDQsIDAsIDB4Y10sIFs0LCA1LCAwLCAweDFjXSwgWzUsIDQsIDEsIDB4ZF0sIFs3LCAzLCAzLCAweDVdLCBbMTUsIDYsIDEsIDB4M2FdLCBbMTcsIDYsIDIsIDB4M2JdLCBbMjEsIDYsIDMsIDB4M2NdLCBbMjksIDYsIDQsIDB4M2RdLCBbNDUsIDYsIDUsIDB4M2VdLCBbNzcsIDcsIDYsIDB4N2VdLCBbMTQxLCA3LCAzMiwgMHg3Zl1dOwogICAgICBicmVhazsKICAgIGNhc2UgMTQ6CiAgICAgIGxpbmVzID0gW1stMiwgMywgMCwgMHg0XSwgWy0xLCAzLCAwLCAweDVdLCBbMCwgMSwgMCwgMHgwXSwgWzEsIDMsIDAsIDB4Nl0sIFsyLCAzLCAwLCAweDddXTsKICAgICAgYnJlYWs7CiAgICBjYXNlIDE1OgogICAgICBsaW5lcyA9IFtbLTI0LCA3LCA0LCAweDdjXSwgWy04LCA2LCAyLCAweDNjXSwgWy00LCA1LCAxLCAweDFjXSwgWy0yLCA0LCAwLCAweGNdLCBbLTEsIDMsIDAsIDB4NF0sIFswLCAxLCAwLCAweDBdLCBbMSwgMywgMCwgMHg1XSwgWzIsIDQsIDAsIDB4ZF0sIFszLCA1LCAxLCAweDFkXSwgWzUsIDYsIDIsIDB4M2RdLCBbOSwgNywgNCwgMHg3ZF0sIFstMjUsIDcsIDMyLCAweDdlLCAibG93ZXIiXSwgWzI1LCA3LCAzMiwgMHg3Zl1dOwogICAgICBicmVhazsKICAgIGRlZmF1bHQ6CiAgICAgIHRocm93IG5ldyBKYmlnMkVycm9yKGBzdGFuZGFyZCB0YWJsZSBCLiR7bnVtYmVyfSBkb2VzIG5vdCBleGlzdGApOwogIH0KICBmb3IgKGxldCBpID0gMCwgaWkgPSBsaW5lcy5sZW5ndGg7IGkgPCBpaTsgaSsrKSB7CiAgICBsaW5lc1tpXSA9IG5ldyBIdWZmbWFuTGluZShsaW5lc1tpXSk7CiAgfQogIHRhYmxlID0gbmV3IEh1ZmZtYW5UYWJsZShsaW5lcywgdHJ1ZSk7CiAgc3RhbmRhcmRUYWJsZXNDYWNoZVtudW1iZXJdID0gdGFibGU7CiAgcmV0dXJuIHRhYmxlOwp9CmNsYXNzIFJlYWRlciB7CiAgY29uc3RydWN0b3IoZGF0YSwgc3RhcnQsIGVuZCkgewogICAgdGhpcy5kYXRhID0gZGF0YTsKICAgIHRoaXMuc3RhcnQgPSBzdGFydDsKICAgIHRoaXMuZW5kID0gZW5kOwogICAgdGhpcy5wb3NpdGlvbiA9IHN0YXJ0OwogICAgdGhpcy5zaGlmdCA9IC0xOwogICAgdGhpcy5jdXJyZW50Qnl0ZSA9IDA7CiAgfQogIHJlYWRCaXQoKSB7CiAgICBpZiAodGhpcy5zaGlmdCA8IDApIHsKICAgICAgaWYgKHRoaXMucG9zaXRpb24gPj0gdGhpcy5lbmQpIHsKICAgICAgICB0aHJvdyBuZXcgSmJpZzJFcnJvcigiZW5kIG9mIGRhdGEgd2hpbGUgcmVhZGluZyBiaXQiKTsKICAgICAgfQogICAgICB0aGlzLmN1cnJlbnRCeXRlID0gdGhpcy5kYXRhW3RoaXMucG9zaXRpb24rK107CiAgICAgIHRoaXMuc2hpZnQgPSA3OwogICAgfQogICAgY29uc3QgYml0ID0gdGhpcy5jdXJyZW50Qnl0ZSA+PiB0aGlzLnNoaWZ0ICYgMTsKICAgIHRoaXMuc2hpZnQtLTsKICAgIHJldHVybiBiaXQ7CiAgfQogIHJlYWRCaXRzKG51bUJpdHMpIHsKICAgIGxldCByZXN1bHQgPSAwLAogICAgICBpOwogICAgZm9yIChpID0gbnVtQml0cyAtIDE7IGkgPj0gMDsgaS0tKSB7CiAgICAgIHJlc3VsdCB8PSB0aGlzLnJlYWRCaXQoKSA8PCBpOwogICAgfQogICAgcmV0dXJuIHJlc3VsdDsKICB9CiAgYnl0ZUFsaWduKCkgewogICAgdGhpcy5zaGlmdCA9IC0xOwogIH0KICBuZXh0KCkgewogICAgaWYgKHRoaXMucG9zaXRpb24gPj0gdGhpcy5lbmQpIHsKICAgICAgcmV0dXJuIC0xOwogICAgfQogICAgcmV0dXJuIHRoaXMuZGF0YVt0aGlzLnBvc2l0aW9uKytdOwogIH0KfQpmdW5jdGlvbiBnZXRDdXN0b21IdWZmbWFuVGFibGUoaW5kZXgsIHJlZmVycmVkVG8sIGN1c3RvbVRhYmxlcykgewogIGxldCBjdXJyZW50SW5kZXggPSAwOwogIGZvciAobGV0IGkgPSAwLCBpaSA9IHJlZmVycmVkVG8ubGVuZ3RoOyBpIDwgaWk7IGkrKykgewogICAgY29uc3QgdGFibGUgPSBjdXN0b21UYWJsZXNbcmVmZXJyZWRUb1tpXV07CiAgICBpZiAodGFibGUpIHsKICAgICAgaWYgKGluZGV4ID09PSBjdXJyZW50SW5kZXgpIHsKICAgICAgICByZXR1cm4gdGFibGU7CiAgICAgIH0KICAgICAgY3VycmVudEluZGV4Kys7CiAgICB9CiAgfQogIHRocm93IG5ldyBKYmlnMkVycm9yKCJjYW4ndCBmaW5kIGN1c3RvbSBIdWZmbWFuIHRhYmxlIik7Cn0KZnVuY3Rpb24gZ2V0VGV4dFJlZ2lvbkh1ZmZtYW5UYWJsZXModGV4dFJlZ2lvbiwgcmVmZXJyZWRUbywgY3VzdG9tVGFibGVzLCBudW1iZXJPZlN5bWJvbHMsIHJlYWRlcikgewogIGNvbnN0IGNvZGVzID0gW107CiAgZm9yIChsZXQgaSA9IDA7IGkgPD0gMzQ7IGkrKykgewogICAgY29uc3QgY29kZUxlbmd0aCA9IHJlYWRlci5yZWFkQml0cyg0KTsKICAgIGNvZGVzLnB1c2gobmV3IEh1ZmZtYW5MaW5lKFtpLCBjb2RlTGVuZ3RoLCAwLCAwXSkpOwogIH0KICBjb25zdCBydW5Db2Rlc1RhYmxlID0gbmV3IEh1ZmZtYW5UYWJsZShjb2RlcywgZmFsc2UpOwogIGNvZGVzLmxlbmd0aCA9IDA7CiAgZm9yIChsZXQgaSA9IDA7IGkgPCBudW1iZXJPZlN5bWJvbHM7KSB7CiAgICBjb25zdCBjb2RlTGVuZ3RoID0gcnVuQ29kZXNUYWJsZS5kZWNvZGUocmVhZGVyKTsKICAgIGlmIChjb2RlTGVuZ3RoID49IDMyKSB7CiAgICAgIGxldCByZXBlYXRlZExlbmd0aCwgbnVtYmVyT2ZSZXBlYXRzLCBqOwogICAgICBzd2l0Y2ggKGNvZGVMZW5ndGgpIHsKICAgICAgICBjYXNlIDMyOgogICAgICAgICAgaWYgKGkgPT09IDApIHsKICAgICAgICAgICAgdGhyb3cgbmV3IEpiaWcyRXJyb3IoIm5vIHByZXZpb3VzIHZhbHVlIGluIHN5bWJvbCBJRCB0YWJsZSIpOwogICAgICAgICAgfQogICAgICAgICAgbnVtYmVyT2ZSZXBlYXRzID0gcmVhZGVyLnJlYWRCaXRzKDIpICsgMzsKICAgICAgICAgIHJlcGVhdGVkTGVuZ3RoID0gY29kZXNbaSAtIDFdLnByZWZpeExlbmd0aDsKICAgICAgICAgIGJyZWFrOwogICAgICAgIGNhc2UgMzM6CiAgICAgICAgICBudW1iZXJPZlJlcGVhdHMgPSByZWFkZXIucmVhZEJpdHMoMykgKyAzOwogICAgICAgICAgcmVwZWF0ZWRMZW5ndGggPSAwOwogICAgICAgICAgYnJlYWs7CiAgICAgICAgY2FzZSAzNDoKICAgICAgICAgIG51bWJlck9mUmVwZWF0cyA9IHJlYWRlci5yZWFkQml0cyg3KSArIDExOwogICAgICAgICAgcmVwZWF0ZWRMZW5ndGggPSAwOwogICAgICAgICAgYnJlYWs7CiAgICAgICAgZGVmYXVsdDoKICAgICAgICAgIHRocm93IG5ldyBKYmlnMkVycm9yKCJpbnZhbGlkIGNvZGUgbGVuZ3RoIGluIHN5bWJvbCBJRCB0YWJsZSIpOwogICAgICB9CiAgICAgIGZvciAoaiA9IDA7IGogPCBudW1iZXJPZlJlcGVhdHM7IGorKykgewogICAgICAgIGNvZGVzLnB1c2gobmV3IEh1ZmZtYW5MaW5lKFtpLCByZXBlYXRlZExlbmd0aCwgMCwgMF0pKTsKICAgICAgICBpKys7CiAgICAgIH0KICAgIH0gZWxzZSB7CiAgICAgIGNvZGVzLnB1c2gobmV3IEh1ZmZtYW5MaW5lKFtpLCBjb2RlTGVuZ3RoLCAwLCAwXSkpOwogICAgICBpKys7CiAgICB9CiAgfQogIHJlYWRlci5ieXRlQWxpZ24oKTsKICBjb25zdCBzeW1ib2xJRFRhYmxlID0gbmV3IEh1ZmZtYW5UYWJsZShjb2RlcywgZmFsc2UpOwogIGxldCBjdXN0b21JbmRleCA9IDAsCiAgICB0YWJsZUZpcnN0UywKICAgIHRhYmxlRGVsdGFTLAogICAgdGFibGVEZWx0YVQ7CiAgc3dpdGNoICh0ZXh0UmVnaW9uLmh1ZmZtYW5GUykgewogICAgY2FzZSAwOgogICAgY2FzZSAxOgogICAgICB0YWJsZUZpcnN0UyA9IGdldFN0YW5kYXJkVGFibGUodGV4dFJlZ2lvbi5odWZmbWFuRlMgKyA2KTsKICAgICAgYnJlYWs7CiAgICBjYXNlIDM6CiAgICAgIHRhYmxlRmlyc3RTID0gZ2V0Q3VzdG9tSHVmZm1hblRhYmxlKGN1c3RvbUluZGV4LCByZWZlcnJlZFRvLCBjdXN0b21UYWJsZXMpOwogICAgICBjdXN0b21JbmRleCsrOwogICAgICBicmVhazsKICAgIGRlZmF1bHQ6CiAgICAgIHRocm93IG5ldyBKYmlnMkVycm9yKCJpbnZhbGlkIEh1ZmZtYW4gRlMgc2VsZWN0b3IiKTsKICB9CiAgc3dpdGNoICh0ZXh0UmVnaW9uLmh1ZmZtYW5EUykgewogICAgY2FzZSAwOgogICAgY2FzZSAxOgogICAgY2FzZSAyOgogICAgICB0YWJsZURlbHRhUyA9IGdldFN0YW5kYXJkVGFibGUodGV4dFJlZ2lvbi5odWZmbWFuRFMgKyA4KTsKICAgICAgYnJlYWs7CiAgICBjYXNlIDM6CiAgICAgIHRhYmxlRGVsdGFTID0gZ2V0Q3VzdG9tSHVmZm1hblRhYmxlKGN1c3RvbUluZGV4LCByZWZlcnJlZFRvLCBjdXN0b21UYWJsZXMpOwogICAgICBjdXN0b21JbmRleCsrOwogICAgICBicmVhazsKICAgIGRlZmF1bHQ6CiAgICAgIHRocm93IG5ldyBKYmlnMkVycm9yKCJpbnZhbGlkIEh1ZmZtYW4gRFMgc2VsZWN0b3IiKTsKICB9CiAgc3dpdGNoICh0ZXh0UmVnaW9uLmh1ZmZtYW5EVCkgewogICAgY2FzZSAwOgogICAgY2FzZSAxOgogICAgY2FzZSAyOgogICAgICB0YWJsZURlbHRhVCA9IGdldFN0YW5kYXJkVGFibGUodGV4dFJlZ2lvbi5odWZmbWFuRFQgKyAxMSk7CiAgICAgIGJyZWFrOwogICAgY2FzZSAzOgogICAgICB0YWJsZURlbHRhVCA9IGdldEN1c3RvbUh1ZmZtYW5UYWJsZShjdXN0b21JbmRleCwgcmVmZXJyZWRUbywgY3VzdG9tVGFibGVzKTsKICAgICAgY3VzdG9tSW5kZXgrKzsKICAgICAgYnJlYWs7CiAgICBkZWZhdWx0OgogICAgICB0aHJvdyBuZXcgSmJpZzJFcnJvcigiaW52YWxpZCBIdWZmbWFuIERUIHNlbGVjdG9yIik7CiAgfQogIGlmICh0ZXh0UmVnaW9uLnJlZmluZW1lbnQpIHsKICAgIHRocm93IG5ldyBKYmlnMkVycm9yKCJyZWZpbmVtZW50IHdpdGggSHVmZm1hbiBpcyBub3Qgc3VwcG9ydGVkIik7CiAgfQogIHJldHVybiB7CiAgICBzeW1ib2xJRFRhYmxlLAogICAgdGFibGVGaXJzdFMsCiAgICB0YWJsZURlbHRhUywKICAgIHRhYmxlRGVsdGFUCiAgfTsKfQpmdW5jdGlvbiBnZXRTeW1ib2xEaWN0aW9uYXJ5SHVmZm1hblRhYmxlcyhkaWN0aW9uYXJ5LCByZWZlcnJlZFRvLCBjdXN0b21UYWJsZXMpIHsKICBsZXQgY3VzdG9tSW5kZXggPSAwLAogICAgdGFibGVEZWx0YUhlaWdodCwKICAgIHRhYmxlRGVsdGFXaWR0aDsKICBzd2l0Y2ggKGRpY3Rpb25hcnkuaHVmZm1hbkRIU2VsZWN0b3IpIHsKICAgIGNhc2UgMDoKICAgIGNhc2UgMToKICAgICAgdGFibGVEZWx0YUhlaWdodCA9IGdldFN0YW5kYXJkVGFibGUoZGljdGlvbmFyeS5odWZmbWFuREhTZWxlY3RvciArIDQpOwogICAgICBicmVhazsKICAgIGNhc2UgMzoKICAgICAgdGFibGVEZWx0YUhlaWdodCA9IGdldEN1c3RvbUh1ZmZtYW5UYWJsZShjdXN0b21JbmRleCwgcmVmZXJyZWRUbywgY3VzdG9tVGFibGVzKTsKICAgICAgY3VzdG9tSW5kZXgrKzsKICAgICAgYnJlYWs7CiAgICBkZWZhdWx0OgogICAgICB0aHJvdyBuZXcgSmJpZzJFcnJvcigiaW52YWxpZCBIdWZmbWFuIERIIHNlbGVjdG9yIik7CiAgfQogIHN3aXRjaCAoZGljdGlvbmFyeS5odWZmbWFuRFdTZWxlY3RvcikgewogICAgY2FzZSAwOgogICAgY2FzZSAxOgogICAgICB0YWJsZURlbHRhV2lkdGggPSBnZXRTdGFuZGFyZFRhYmxlKGRpY3Rpb25hcnkuaHVmZm1hbkRXU2VsZWN0b3IgKyAyKTsKICAgICAgYnJlYWs7CiAgICBjYXNlIDM6CiAgICAgIHRhYmxlRGVsdGFXaWR0aCA9IGdldEN1c3RvbUh1ZmZtYW5UYWJsZShjdXN0b21JbmRleCwgcmVmZXJyZWRUbywgY3VzdG9tVGFibGVzKTsKICAgICAgY3VzdG9tSW5kZXgrKzsKICAgICAgYnJlYWs7CiAgICBkZWZhdWx0OgogICAgICB0aHJvdyBuZXcgSmJpZzJFcnJvcigiaW52YWxpZCBIdWZmbWFuIERXIHNlbGVjdG9yIik7CiAgfQogIGxldCB0YWJsZUJpdG1hcFNpemUsIHRhYmxlQWdncmVnYXRlSW5zdGFuY2VzOwogIGlmIChkaWN0aW9uYXJ5LmJpdG1hcFNpemVTZWxlY3RvcikgewogICAgdGFibGVCaXRtYXBTaXplID0gZ2V0Q3VzdG9tSHVmZm1hblRhYmxlKGN1c3RvbUluZGV4LCByZWZlcnJlZFRvLCBjdXN0b21UYWJsZXMpOwogICAgY3VzdG9tSW5kZXgrKzsKICB9IGVsc2UgewogICAgdGFibGVCaXRtYXBTaXplID0gZ2V0U3RhbmRhcmRUYWJsZSgxKTsKICB9CiAgaWYgKGRpY3Rpb25hcnkuYWdncmVnYXRpb25JbnN0YW5jZXNTZWxlY3RvcikgewogICAgdGFibGVBZ2dyZWdhdGVJbnN0YW5jZXMgPSBnZXRDdXN0b21IdWZmbWFuVGFibGUoY3VzdG9tSW5kZXgsIHJlZmVycmVkVG8sIGN1c3RvbVRhYmxlcyk7CiAgfSBlbHNlIHsKICAgIHRhYmxlQWdncmVnYXRlSW5zdGFuY2VzID0gZ2V0U3RhbmRhcmRUYWJsZSgxKTsKICB9CiAgcmV0dXJuIHsKICAgIHRhYmxlRGVsdGFIZWlnaHQsCiAgICB0YWJsZURlbHRhV2lkdGgsCiAgICB0YWJsZUJpdG1hcFNpemUsCiAgICB0YWJsZUFnZ3JlZ2F0ZUluc3RhbmNlcwogIH07Cn0KZnVuY3Rpb24gcmVhZFVuY29tcHJlc3NlZEJpdG1hcChyZWFkZXIsIHdpZHRoLCBoZWlnaHQpIHsKICBjb25zdCBiaXRtYXAgPSBbXTsKICBmb3IgKGxldCB5ID0gMDsgeSA8IGhlaWdodDsgeSsrKSB7CiAgICBjb25zdCByb3cgPSBuZXcgVWludDhBcnJheSh3aWR0aCk7CiAgICBiaXRtYXAucHVzaChyb3cpOwogICAgZm9yIChsZXQgeCA9IDA7IHggPCB3aWR0aDsgeCsrKSB7CiAgICAgIHJvd1t4XSA9IHJlYWRlci5yZWFkQml0KCk7CiAgICB9CiAgICByZWFkZXIuYnl0ZUFsaWduKCk7CiAgfQogIHJldHVybiBiaXRtYXA7Cn0KZnVuY3Rpb24gZGVjb2RlTU1SQml0bWFwKGlucHV0LCB3aWR0aCwgaGVpZ2h0LCBlbmRPZkJsb2NrKSB7CiAgY29uc3QgcGFyYW1zID0gewogICAgSzogLTEsCiAgICBDb2x1bW5zOiB3aWR0aCwKICAgIFJvd3M6IGhlaWdodCwKICAgIEJsYWNrSXMxOiB0cnVlLAogICAgRW5kT2ZCbG9jazogZW5kT2ZCbG9jawogIH07CiAgY29uc3QgZGVjb2RlciA9IG5ldyBfY2NpdHQuQ0NJVFRGYXhEZWNvZGVyKGlucHV0LCBwYXJhbXMpOwogIGNvbnN0IGJpdG1hcCA9IFtdOwogIGxldCBjdXJyZW50Qnl0ZSwKICAgIGVvZiA9IGZhbHNlOwogIGZvciAobGV0IHkgPSAwOyB5IDwgaGVpZ2h0OyB5KyspIHsKICAgIGNvbnN0IHJvdyA9IG5ldyBVaW50OEFycmF5KHdpZHRoKTsKICAgIGJpdG1hcC5wdXNoKHJvdyk7CiAgICBsZXQgc2hpZnQgPSAtMTsKICAgIGZvciAobGV0IHggPSAwOyB4IDwgd2lkdGg7IHgrKykgewogICAgICBpZiAoc2hpZnQgPCAwKSB7CiAgICAgICAgY3VycmVudEJ5dGUgPSBkZWNvZGVyLnJlYWROZXh0Q2hhcigpOwogICAgICAgIGlmIChjdXJyZW50Qnl0ZSA9PT0gLTEpIHsKICAgICAgICAgIGN1cnJlbnRCeXRlID0gMDsKICAgICAgICAgIGVvZiA9IHRydWU7CiAgICAgICAgfQogICAgICAgIHNoaWZ0ID0gNzsKICAgICAgfQogICAgICByb3dbeF0gPSBjdXJyZW50Qnl0ZSA+PiBzaGlmdCAmIDE7CiAgICAgIHNoaWZ0LS07CiAgICB9CiAgfQogIGlmIChlbmRPZkJsb2NrICYmICFlb2YpIHsKICAgIGNvbnN0IGxvb2tGb3JFT0ZMaW1pdCA9IDU7CiAgICBmb3IgKGxldCBpID0gMDsgaSA8IGxvb2tGb3JFT0ZMaW1pdDsgaSsrKSB7CiAgICAgIGlmIChkZWNvZGVyLnJlYWROZXh0Q2hhcigpID09PSAtMSkgewogICAgICAgIGJyZWFrOwogICAgICB9CiAgICB9CiAgfQogIHJldHVybiBiaXRtYXA7Cn0KY2xhc3MgSmJpZzJJbWFnZSB7CiAgcGFyc2VDaHVua3MoY2h1bmtzKSB7CiAgICByZXR1cm4gcGFyc2VKYmlnMkNodW5rcyhjaHVua3MpOwogIH0KICBwYXJzZShkYXRhKSB7CiAgICB0aHJvdyBuZXcgRXJyb3IoIk5vdCBpbXBsZW1lbnRlZDogSmJpZzJJbWFnZS5wYXJzZSIpOwogIH0KfQpleHBvcnRzLkpiaWcySW1hZ2UgPSBKYmlnMkltYWdlOwoKLyoqKi8gfSksCi8qIDI1ICovCi8qKiovICgoX191bnVzZWRfd2VicGFja19tb2R1bGUsIGV4cG9ydHMpID0+IHsKCgoKT2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsICJfX2VzTW9kdWxlIiwgKHsKICB2YWx1ZTogdHJ1ZQp9KSk7CmV4cG9ydHMuQXJpdGhtZXRpY0RlY29kZXIgPSB2b2lkIDA7CmNvbnN0IFFlVGFibGUgPSBbewogIHFlOiAweDU2MDEsCiAgbm1wczogMSwKICBubHBzOiAxLAogIHN3aXRjaEZsYWc6IDEKfSwgewogIHFlOiAweDM0MDEsCiAgbm1wczogMiwKICBubHBzOiA2LAogIHN3aXRjaEZsYWc6IDAKfSwgewogIHFlOiAweDE4MDEsCiAgbm1wczogMywKICBubHBzOiA5LAogIHN3aXRjaEZsYWc6IDAKfSwgewogIHFlOiAweDBhYzEsCiAgbm1wczogNCwKICBubHBzOiAxMiwKICBzd2l0Y2hGbGFnOiAwCn0sIHsKICBxZTogMHgwNTIxLAogIG5tcHM6IDUsCiAgbmxwczogMjksCiAgc3dpdGNoRmxhZzogMAp9LCB7CiAgcWU6IDB4MDIyMSwKICBubXBzOiAzOCwKICBubHBzOiAzMywKICBzd2l0Y2hGbGFnOiAwCn0sIHsKICBxZTogMHg1NjAxLAogIG5tcHM6IDcsCiAgbmxwczogNiwKICBzd2l0Y2hGbGFnOiAxCn0sIHsKICBxZTogMHg1NDAxLAogIG5tcHM6IDgsCiAgbmxwczogMTQsCiAgc3dpdGNoRmxhZzogMAp9LCB7CiAgcWU6IDB4NDgwMSwKICBubXBzOiA5LAogIG5scHM6IDE0LAogIHN3aXRjaEZsYWc6IDAKfSwgewogIHFlOiAweDM4MDEsCiAgbm1wczogMTAsCiAgbmxwczogMTQsCiAgc3dpdGNoRmxhZzogMAp9LCB7CiAgcWU6IDB4MzAwMSwKICBubXBzOiAxMSwKICBubHBzOiAxNywKICBzd2l0Y2hGbGFnOiAwCn0sIHsKICBxZTogMHgyNDAxLAogIG5tcHM6IDEyLAogIG5scHM6IDE4LAogIHN3aXRjaEZsYWc6IDAKfSwgewogIHFlOiAweDFjMDEsCiAgbm1wczogMTMsCiAgbmxwczogMjAsCiAgc3dpdGNoRmxhZzogMAp9LCB7CiAgcWU6IDB4MTYwMSwKICBubXBzOiAyOSwKICBubHBzOiAyMSwKICBzd2l0Y2hGbGFnOiAwCn0sIHsKICBxZTogMHg1NjAxLAogIG5tcHM6IDE1LAogIG5scHM6IDE0LAogIHN3aXRjaEZsYWc6IDEKfSwgewogIHFlOiAweDU0MDEsCiAgbm1wczogMTYsCiAgbmxwczogMTQsCiAgc3dpdGNoRmxhZzogMAp9LCB7CiAgcWU6IDB4NTEwMSwKICBubXBzOiAxNywKICBubHBzOiAxNSwKICBzd2l0Y2hGbGFnOiAwCn0sIHsKICBxZTogMHg0ODAxLAogIG5tcHM6IDE4LAogIG5scHM6IDE2LAogIHN3aXRjaEZsYWc6IDAKfSwgewogIHFlOiAweDM4MDEsCiAgbm1wczogMTksCiAgbmxwczogMTcsCiAgc3dpdGNoRmxhZzogMAp9LCB7CiAgcWU6IDB4MzQwMSwKICBubXBzOiAyMCwKICBubHBzOiAxOCwKICBzd2l0Y2hGbGFnOiAwCn0sIHsKICBxZTogMHgzMDAxLAogIG5tcHM6IDIxLAogIG5scHM6IDE5LAogIHN3aXRjaEZsYWc6IDAKfSwgewogIHFlOiAweDI4MDEsCiAgbm1wczogMjIsCiAgbmxwczogMTksCiAgc3dpdGNoRmxhZzogMAp9LCB7CiAgcWU6IDB4MjQwMSwKICBubXBzOiAyMywKICBubHBzOiAyMCwKICBzd2l0Y2hGbGFnOiAwCn0sIHsKICBxZTogMHgyMjAxLAogIG5tcHM6IDI0LAogIG5scHM6IDIxLAogIHN3aXRjaEZsYWc6IDAKfSwgewogIHFlOiAweDFjMDEsCiAgbm1wczogMjUsCiAgbmxwczogMjIsCiAgc3dpdGNoRmxhZzogMAp9LCB7CiAgcWU6IDB4MTgwMSwKICBubXBzOiAyNiwKICBubHBzOiAyMywKICBzd2l0Y2hGbGFnOiAwCn0sIHsKICBxZTogMHgxNjAxLAogIG5tcHM6IDI3LAogIG5scHM6IDI0LAogIHN3aXRjaEZsYWc6IDAKfSwgewogIHFlOiAweDE0MDEsCiAgbm1wczogMjgsCiAgbmxwczogMjUsCiAgc3dpdGNoRmxhZzogMAp9LCB7CiAgcWU6IDB4MTIwMSwKICBubXBzOiAyOSwKICBubHBzOiAyNiwKICBzd2l0Y2hGbGFnOiAwCn0sIHsKICBxZTogMHgxMTAxLAogIG5tcHM6IDMwLAogIG5scHM6IDI3LAogIHN3aXRjaEZsYWc6IDAKfSwgewogIHFlOiAweDBhYzEsCiAgbm1wczogMzEsCiAgbmxwczogMjgsCiAgc3dpdGNoRmxhZzogMAp9LCB7CiAgcWU6IDB4MDljMSwKICBubXBzOiAzMiwKICBubHBzOiAyOSwKICBzd2l0Y2hGbGFnOiAwCn0sIHsKICBxZTogMHgwOGExLAogIG5tcHM6IDMzLAogIG5scHM6IDMwLAogIHN3aXRjaEZsYWc6IDAKfSwgewogIHFlOiAweDA1MjEsCiAgbm1wczogMzQsCiAgbmxwczogMzEsCiAgc3dpdGNoRmxhZzogMAp9LCB7CiAgcWU6IDB4MDQ0MSwKICBubXBzOiAzNSwKICBubHBzOiAzMiwKICBzd2l0Y2hGbGFnOiAwCn0sIHsKICBxZTogMHgwMmExLAogIG5tcHM6IDM2LAogIG5scHM6IDMzLAogIHN3aXRjaEZsYWc6IDAKfSwgewogIHFlOiAweDAyMjEsCiAgbm1wczogMzcsCiAgbmxwczogMzQsCiAgc3dpdGNoRmxhZzogMAp9LCB7CiAgcWU6IDB4MDE0MSwKICBubXBzOiAzOCwKICBubHBzOiAzNSwKICBzd2l0Y2hGbGFnOiAwCn0sIHsKICBxZTogMHgwMTExLAogIG5tcHM6IDM5LAogIG5scHM6IDM2LAogIHN3aXRjaEZsYWc6IDAKfSwgewogIHFlOiAweDAwODUsCiAgbm1wczogNDAsCiAgbmxwczogMzcsCiAgc3dpdGNoRmxhZzogMAp9LCB7CiAgcWU6IDB4MDA0OSwKICBubXBzOiA0MSwKICBubHBzOiAzOCwKICBzd2l0Y2hGbGFnOiAwCn0sIHsKICBxZTogMHgwMDI1LAogIG5tcHM6IDQyLAogIG5scHM6IDM5LAogIHN3aXRjaEZsYWc6IDAKfSwgewogIHFlOiAweDAwMTUsCiAgbm1wczogNDMsCiAgbmxwczogNDAsCiAgc3dpdGNoRmxhZzogMAp9LCB7CiAgcWU6IDB4MDAwOSwKICBubXBzOiA0NCwKICBubHBzOiA0MSwKICBzd2l0Y2hGbGFnOiAwCn0sIHsKICBxZTogMHgwMDA1LAogIG5tcHM6IDQ1LAogIG5scHM6IDQyLAogIHN3aXRjaEZsYWc6IDAKfSwgewogIHFlOiAweDAwMDEsCiAgbm1wczogNDUsCiAgbmxwczogNDMsCiAgc3dpdGNoRmxhZzogMAp9LCB7CiAgcWU6IDB4NTYwMSwKICBubXBzOiA0NiwKICBubHBzOiA0NiwKICBzd2l0Y2hGbGFnOiAwCn1dOwpjbGFzcyBBcml0aG1ldGljRGVjb2RlciB7CiAgY29uc3RydWN0b3IoZGF0YSwgc3RhcnQsIGVuZCkgewogICAgdGhpcy5kYXRhID0gZGF0YTsKICAgIHRoaXMuYnAgPSBzdGFydDsKICAgIHRoaXMuZGF0YUVuZCA9IGVuZDsKICAgIHRoaXMuY2hpZ2ggPSBkYXRhW3N0YXJ0XTsKICAgIHRoaXMuY2xvdyA9IDA7CiAgICB0aGlzLmJ5dGVJbigpOwogICAgdGhpcy5jaGlnaCA9IHRoaXMuY2hpZ2ggPDwgNyAmIDB4ZmZmZiB8IHRoaXMuY2xvdyA+PiA5ICYgMHg3ZjsKICAgIHRoaXMuY2xvdyA9IHRoaXMuY2xvdyA8PCA3ICYgMHhmZmZmOwogICAgdGhpcy5jdCAtPSA3OwogICAgdGhpcy5hID0gMHg4MDAwOwogIH0KICBieXRlSW4oKSB7CiAgICBjb25zdCBkYXRhID0gdGhpcy5kYXRhOwogICAgbGV0IGJwID0gdGhpcy5icDsKICAgIGlmIChkYXRhW2JwXSA9PT0gMHhmZikgewogICAgICBpZiAoZGF0YVticCArIDFdID4gMHg4ZikgewogICAgICAgIHRoaXMuY2xvdyArPSAweGZmMDA7CiAgICAgICAgdGhpcy5jdCA9IDg7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgYnArKzsKICAgICAgICB0aGlzLmNsb3cgKz0gZGF0YVticF0gPDwgOTsKICAgICAgICB0aGlzLmN0ID0gNzsKICAgICAgICB0aGlzLmJwID0gYnA7CiAgICAgIH0KICAgIH0gZWxzZSB7CiAgICAgIGJwKys7CiAgICAgIHRoaXMuY2xvdyArPSBicCA8IHRoaXMuZGF0YUVuZCA/IGRhdGFbYnBdIDw8IDggOiAweGZmMDA7CiAgICAgIHRoaXMuY3QgPSA4OwogICAgICB0aGlzLmJwID0gYnA7CiAgICB9CiAgICBpZiAodGhpcy5jbG93ID4gMHhmZmZmKSB7CiAgICAgIHRoaXMuY2hpZ2ggKz0gdGhpcy5jbG93ID4+IDE2OwogICAgICB0aGlzLmNsb3cgJj0gMHhmZmZmOwogICAgfQogIH0KICByZWFkQml0KGNvbnRleHRzLCBwb3MpIHsKICAgIGxldCBjeF9pbmRleCA9IGNvbnRleHRzW3Bvc10gPj4gMSwKICAgICAgY3hfbXBzID0gY29udGV4dHNbcG9zXSAmIDE7CiAgICBjb25zdCBxZVRhYmxlSWN4ID0gUWVUYWJsZVtjeF9pbmRleF07CiAgICBjb25zdCBxZUljeCA9IHFlVGFibGVJY3gucWU7CiAgICBsZXQgZDsKICAgIGxldCBhID0gdGhpcy5hIC0gcWVJY3g7CiAgICBpZiAodGhpcy5jaGlnaCA8IHFlSWN4KSB7CiAgICAgIGlmIChhIDwgcWVJY3gpIHsKICAgICAgICBhID0gcWVJY3g7CiAgICAgICAgZCA9IGN4X21wczsKICAgICAgICBjeF9pbmRleCA9IHFlVGFibGVJY3gubm1wczsKICAgICAgfSBlbHNlIHsKICAgICAgICBhID0gcWVJY3g7CiAgICAgICAgZCA9IDEgXiBjeF9tcHM7CiAgICAgICAgaWYgKHFlVGFibGVJY3guc3dpdGNoRmxhZyA9PT0gMSkgewogICAgICAgICAgY3hfbXBzID0gZDsKICAgICAgICB9CiAgICAgICAgY3hfaW5kZXggPSBxZVRhYmxlSWN4Lm5scHM7CiAgICAgIH0KICAgIH0gZWxzZSB7CiAgICAgIHRoaXMuY2hpZ2ggLT0gcWVJY3g7CiAgICAgIGlmICgoYSAmIDB4ODAwMCkgIT09IDApIHsKICAgICAgICB0aGlzLmEgPSBhOwogICAgICAgIHJldHVybiBjeF9tcHM7CiAgICAgIH0KICAgICAgaWYgKGEgPCBxZUljeCkgewogICAgICAgIGQgPSAxIF4gY3hfbXBzOwogICAgICAgIGlmIChxZVRhYmxlSWN4LnN3aXRjaEZsYWcgPT09IDEpIHsKICAgICAgICAgIGN4X21wcyA9IGQ7CiAgICAgICAgfQogICAgICAgIGN4X2luZGV4ID0gcWVUYWJsZUljeC5ubHBzOwogICAgICB9IGVsc2UgewogICAgICAgIGQgPSBjeF9tcHM7CiAgICAgICAgY3hfaW5kZXggPSBxZVRhYmxlSWN4Lm5tcHM7CiAgICAgIH0KICAgIH0KICAgIGRvIHsKICAgICAgaWYgKHRoaXMuY3QgPT09IDApIHsKICAgICAgICB0aGlzLmJ5dGVJbigpOwogICAgICB9CiAgICAgIGEgPDw9IDE7CiAgICAgIHRoaXMuY2hpZ2ggPSB0aGlzLmNoaWdoIDw8IDEgJiAweGZmZmYgfCB0aGlzLmNsb3cgPj4gMTUgJiAxOwogICAgICB0aGlzLmNsb3cgPSB0aGlzLmNsb3cgPDwgMSAmIDB4ZmZmZjsKICAgICAgdGhpcy5jdC0tOwogICAgfSB3aGlsZSAoKGEgJiAweDgwMDApID09PSAwKTsKICAgIHRoaXMuYSA9IGE7CiAgICBjb250ZXh0c1twb3NdID0gY3hfaW5kZXggPDwgMSB8IGN4X21wczsKICAgIHJldHVybiBkOwogIH0KfQpleHBvcnRzLkFyaXRobWV0aWNEZWNvZGVyID0gQXJpdGhtZXRpY0RlY29kZXI7CgovKioqLyB9KSwKLyogMjYgKi8KLyoqKi8gKChfX3VudXNlZF93ZWJwYWNrX21vZHVsZSwgZXhwb3J0cywgX193X3BkZmpzX3JlcXVpcmVfXykgPT4gewoKCgpPYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgIl9fZXNNb2R1bGUiLCAoewogIHZhbHVlOiB0cnVlCn0pKTsKZXhwb3J0cy5KcGVnU3RyZWFtID0gdm9pZCAwOwp2YXIgX2RlY29kZV9zdHJlYW0gPSBfX3dfcGRmanNfcmVxdWlyZV9fKDE4KTsKdmFyIF9wcmltaXRpdmVzID0gX193X3BkZmpzX3JlcXVpcmVfXyg0KTsKdmFyIF9qcGcgPSBfX3dfcGRmanNfcmVxdWlyZV9fKDI3KTsKdmFyIF91dGlsID0gX193X3BkZmpzX3JlcXVpcmVfXygyKTsKY2xhc3MgSnBlZ1N0cmVhbSBleHRlbmRzIF9kZWNvZGVfc3RyZWFtLkRlY29kZVN0cmVhbSB7CiAgY29uc3RydWN0b3Ioc3RyZWFtLCBtYXliZUxlbmd0aCwgcGFyYW1zKSB7CiAgICBsZXQgY2g7CiAgICB3aGlsZSAoKGNoID0gc3RyZWFtLmdldEJ5dGUoKSkgIT09IC0xKSB7CiAgICAgIGlmIChjaCA9PT0gMHhmZikgewogICAgICAgIHN0cmVhbS5za2lwKC0xKTsKICAgICAgICBicmVhazsKICAgICAgfQogICAgfQogICAgc3VwZXIobWF5YmVMZW5ndGgpOwogICAgdGhpcy5zdHJlYW0gPSBzdHJlYW07CiAgICB0aGlzLmRpY3QgPSBzdHJlYW0uZGljdDsKICAgIHRoaXMubWF5YmVMZW5ndGggPSBtYXliZUxlbmd0aDsKICAgIHRoaXMucGFyYW1zID0gcGFyYW1zOwogIH0KICBnZXQgYnl0ZXMoKSB7CiAgICByZXR1cm4gKDAsIF91dGlsLnNoYWRvdykodGhpcywgImJ5dGVzIiwgdGhpcy5zdHJlYW0uZ2V0Qnl0ZXModGhpcy5tYXliZUxlbmd0aCkpOwogIH0KICBlbnN1cmVCdWZmZXIocmVxdWVzdGVkKSB7fQogIHJlYWRCbG9jaygpIHsKICAgIGlmICh0aGlzLmVvZikgewogICAgICByZXR1cm47CiAgICB9CiAgICBjb25zdCBqcGVnT3B0aW9ucyA9IHsKICAgICAgZGVjb2RlVHJhbnNmb3JtOiB1bmRlZmluZWQsCiAgICAgIGNvbG9yVHJhbnNmb3JtOiB1bmRlZmluZWQKICAgIH07CiAgICBjb25zdCBkZWNvZGVBcnIgPSB0aGlzLmRpY3QuZ2V0QXJyYXkoIkQiLCAiRGVjb2RlIik7CiAgICBpZiAoKHRoaXMuZm9yY2VSR0JBIHx8IHRoaXMuZm9yY2VSR0IpICYmIEFycmF5LmlzQXJyYXkoZGVjb2RlQXJyKSkgewogICAgICBjb25zdCBiaXRzUGVyQ29tcG9uZW50ID0gdGhpcy5kaWN0LmdldCgiQlBDIiwgIkJpdHNQZXJDb21wb25lbnQiKSB8fCA4OwogICAgICBjb25zdCBkZWNvZGVBcnJMZW5ndGggPSBkZWNvZGVBcnIubGVuZ3RoOwogICAgICBjb25zdCB0cmFuc2Zvcm0gPSBuZXcgSW50MzJBcnJheShkZWNvZGVBcnJMZW5ndGgpOwogICAgICBsZXQgdHJhbnNmb3JtTmVlZGVkID0gZmFsc2U7CiAgICAgIGNvbnN0IG1heFZhbHVlID0gKDEgPDwgYml0c1BlckNvbXBvbmVudCkgLSAxOwogICAgICBmb3IgKGxldCBpID0gMDsgaSA8IGRlY29kZUFyckxlbmd0aDsgaSArPSAyKSB7CiAgICAgICAgdHJhbnNmb3JtW2ldID0gKGRlY29kZUFycltpICsgMV0gLSBkZWNvZGVBcnJbaV0pICogMjU2IHwgMDsKICAgICAgICB0cmFuc2Zvcm1baSArIDFdID0gZGVjb2RlQXJyW2ldICogbWF4VmFsdWUgfCAwOwogICAgICAgIGlmICh0cmFuc2Zvcm1baV0gIT09IDI1NiB8fCB0cmFuc2Zvcm1baSArIDFdICE9PSAwKSB7CiAgICAgICAgICB0cmFuc2Zvcm1OZWVkZWQgPSB0cnVlOwogICAgICAgIH0KICAgICAgfQogICAgICBpZiAodHJhbnNmb3JtTmVlZGVkKSB7CiAgICAgICAganBlZ09wdGlvbnMuZGVjb2RlVHJhbnNmb3JtID0gdHJhbnNmb3JtOwogICAgICB9CiAgICB9CiAgICBpZiAodGhpcy5wYXJhbXMgaW5zdGFuY2VvZiBfcHJpbWl0aXZlcy5EaWN0KSB7CiAgICAgIGNvbnN0IGNvbG9yVHJhbnNmb3JtID0gdGhpcy5wYXJhbXMuZ2V0KCJDb2xvclRyYW5zZm9ybSIpOwogICAgICBpZiAoTnVtYmVyLmlzSW50ZWdlcihjb2xvclRyYW5zZm9ybSkpIHsKICAgICAgICBqcGVnT3B0aW9ucy5jb2xvclRyYW5zZm9ybSA9IGNvbG9yVHJhbnNmb3JtOwogICAgICB9CiAgICB9CiAgICBjb25zdCBqcGVnSW1hZ2UgPSBuZXcgX2pwZy5KcGVnSW1hZ2UoanBlZ09wdGlvbnMpOwogICAganBlZ0ltYWdlLnBhcnNlKHRoaXMuYnl0ZXMpOwogICAgY29uc3QgZGF0YSA9IGpwZWdJbWFnZS5nZXREYXRhKHsKICAgICAgd2lkdGg6IHRoaXMuZHJhd1dpZHRoLAogICAgICBoZWlnaHQ6IHRoaXMuZHJhd0hlaWdodCwKICAgICAgZm9yY2VSR0JBOiB0aGlzLmZvcmNlUkdCQSwKICAgICAgZm9yY2VSR0I6IHRoaXMuZm9yY2VSR0IsCiAgICAgIGlzU291cmNlUERGOiB0cnVlCiAgICB9KTsKICAgIHRoaXMuYnVmZmVyID0gZGF0YTsKICAgIHRoaXMuYnVmZmVyTGVuZ3RoID0gZGF0YS5sZW5ndGg7CiAgICB0aGlzLmVvZiA9IHRydWU7CiAgfQp9CmV4cG9ydHMuSnBlZ1N0cmVhbSA9IEpwZWdTdHJlYW07CgovKioqLyB9KSwKLyogMjcgKi8KLyoqKi8gKChfX3VudXNlZF93ZWJwYWNrX21vZHVsZSwgZXhwb3J0cywgX193X3BkZmpzX3JlcXVpcmVfXykgPT4gewoKCgpPYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgIl9fZXNNb2R1bGUiLCAoewogIHZhbHVlOiB0cnVlCn0pKTsKZXhwb3J0cy5KcGVnSW1hZ2UgPSB2b2lkIDA7CnZhciBfdXRpbCA9IF9fd19wZGZqc19yZXF1aXJlX18oMik7CnZhciBfaW1hZ2VfdXRpbHMgPSBfX3dfcGRmanNfcmVxdWlyZV9fKDI4KTsKdmFyIF9jb3JlX3V0aWxzID0gX193X3BkZmpzX3JlcXVpcmVfXygzKTsKY2xhc3MgSnBlZ0Vycm9yIGV4dGVuZHMgX3V0aWwuQmFzZUV4Y2VwdGlvbiB7CiAgY29uc3RydWN0b3IobXNnKSB7CiAgICBzdXBlcihgSlBFRyBlcnJvcjogJHttc2d9YCwgIkpwZWdFcnJvciIpOwogIH0KfQpjbGFzcyBETkxNYXJrZXJFcnJvciBleHRlbmRzIF91dGlsLkJhc2VFeGNlcHRpb24gewogIGNvbnN0cnVjdG9yKG1lc3NhZ2UsIHNjYW5MaW5lcykgewogICAgc3VwZXIobWVzc2FnZSwgIkROTE1hcmtlckVycm9yIik7CiAgICB0aGlzLnNjYW5MaW5lcyA9IHNjYW5MaW5lczsKICB9Cn0KY2xhc3MgRU9JTWFya2VyRXJyb3IgZXh0ZW5kcyBfdXRpbC5CYXNlRXhjZXB0aW9uIHsKICBjb25zdHJ1Y3Rvcihtc2cpIHsKICAgIHN1cGVyKG1zZywgIkVPSU1hcmtlckVycm9yIik7CiAgfQp9CmNvbnN0IGRjdFppZ1phZyA9IG5ldyBVaW50OEFycmF5KFswLCAxLCA4LCAxNiwgOSwgMiwgMywgMTAsIDE3LCAyNCwgMzIsIDI1LCAxOCwgMTEsIDQsIDUsIDEyLCAxOSwgMjYsIDMzLCA0MCwgNDgsIDQxLCAzNCwgMjcsIDIwLCAxMywgNiwgNywgMTQsIDIxLCAyOCwgMzUsIDQyLCA0OSwgNTYsIDU3LCA1MCwgNDMsIDM2LCAyOSwgMjIsIDE1LCAyMywgMzAsIDM3LCA0NCwgNTEsIDU4LCA1OSwgNTIsIDQ1LCAzOCwgMzEsIDM5LCA0NiwgNTMsIDYwLCA2MSwgNTQsIDQ3LCA1NSwgNjIsIDYzXSk7CmNvbnN0IGRjdENvczEgPSA0MDE3Owpjb25zdCBkY3RTaW4xID0gNzk5Owpjb25zdCBkY3RDb3MzID0gMzQwNjsKY29uc3QgZGN0U2luMyA9IDIyNzY7CmNvbnN0IGRjdENvczYgPSAxNTY3Owpjb25zdCBkY3RTaW42ID0gMzc4NDsKY29uc3QgZGN0U3FydDIgPSA1NzkzOwpjb25zdCBkY3RTcXJ0MWQyID0gMjg5NjsKZnVuY3Rpb24gYnVpbGRIdWZmbWFuVGFibGUoY29kZUxlbmd0aHMsIHZhbHVlcykgewogIGxldCBrID0gMCwKICAgIGksCiAgICBqLAogICAgbGVuZ3RoID0gMTY7CiAgd2hpbGUgKGxlbmd0aCA+IDAgJiYgIWNvZGVMZW5ndGhzW2xlbmd0aCAtIDFdKSB7CiAgICBsZW5ndGgtLTsKICB9CiAgY29uc3QgY29kZSA9IFt7CiAgICBjaGlsZHJlbjogW10sCiAgICBpbmRleDogMAogIH1dOwogIGxldCBwID0gY29kZVswXSwKICAgIHE7CiAgZm9yIChpID0gMDsgaSA8IGxlbmd0aDsgaSsrKSB7CiAgICBmb3IgKGogPSAwOyBqIDwgY29kZUxlbmd0aHNbaV07IGorKykgewogICAgICBwID0gY29kZS5wb3AoKTsKICAgICAgcC5jaGlsZHJlbltwLmluZGV4XSA9IHZhbHVlc1trXTsKICAgICAgd2hpbGUgKHAuaW5kZXggPiAwKSB7CiAgICAgICAgcCA9IGNvZGUucG9wKCk7CiAgICAgIH0KICAgICAgcC5pbmRleCsrOwogICAgICBjb2RlLnB1c2gocCk7CiAgICAgIHdoaWxlIChjb2RlLmxlbmd0aCA8PSBpKSB7CiAgICAgICAgY29kZS5wdXNoKHEgPSB7CiAgICAgICAgICBjaGlsZHJlbjogW10sCiAgICAgICAgICBpbmRleDogMAogICAgICAgIH0pOwogICAgICAgIHAuY2hpbGRyZW5bcC5pbmRleF0gPSBxLmNoaWxkcmVuOwogICAgICAgIHAgPSBxOwogICAgICB9CiAgICAgIGsrKzsKICAgIH0KICAgIGlmIChpICsgMSA8IGxlbmd0aCkgewogICAgICBjb2RlLnB1c2gocSA9IHsKICAgICAgICBjaGlsZHJlbjogW10sCiAgICAgICAgaW5kZXg6IDAKICAgICAgfSk7CiAgICAgIHAuY2hpbGRyZW5bcC5pbmRleF0gPSBxLmNoaWxkcmVuOwogICAgICBwID0gcTsKICAgIH0KICB9CiAgcmV0dXJuIGNvZGVbMF0uY2hpbGRyZW47Cn0KZnVuY3Rpb24gZ2V0QmxvY2tCdWZmZXJPZmZzZXQoY29tcG9uZW50LCByb3csIGNvbCkgewogIHJldHVybiA2NCAqICgoY29tcG9uZW50LmJsb2Nrc1BlckxpbmUgKyAxKSAqIHJvdyArIGNvbCk7Cn0KZnVuY3Rpb24gZGVjb2RlU2NhbihkYXRhLCBvZmZzZXQsIGZyYW1lLCBjb21wb25lbnRzLCByZXNldEludGVydmFsLCBzcGVjdHJhbFN0YXJ0LCBzcGVjdHJhbEVuZCwgc3VjY2Vzc2l2ZVByZXYsIHN1Y2Nlc3NpdmUsIHBhcnNlRE5MTWFya2VyID0gZmFsc2UpIHsKICBjb25zdCBtY3VzUGVyTGluZSA9IGZyYW1lLm1jdXNQZXJMaW5lOwogIGNvbnN0IHByb2dyZXNzaXZlID0gZnJhbWUucHJvZ3Jlc3NpdmU7CiAgY29uc3Qgc3RhcnRPZmZzZXQgPSBvZmZzZXQ7CiAgbGV0IGJpdHNEYXRhID0gMCwKICAgIGJpdHNDb3VudCA9IDA7CiAgZnVuY3Rpb24gcmVhZEJpdCgpIHsKICAgIGlmIChiaXRzQ291bnQgPiAwKSB7CiAgICAgIGJpdHNDb3VudC0tOwogICAgICByZXR1cm4gYml0c0RhdGEgPj4gYml0c0NvdW50ICYgMTsKICAgIH0KICAgIGJpdHNEYXRhID0gZGF0YVtvZmZzZXQrK107CiAgICBpZiAoYml0c0RhdGEgPT09IDB4ZmYpIHsKICAgICAgY29uc3QgbmV4dEJ5dGUgPSBkYXRhW29mZnNldCsrXTsKICAgICAgaWYgKG5leHRCeXRlKSB7CiAgICAgICAgaWYgKG5leHRCeXRlID09PSAweGRjICYmIHBhcnNlRE5MTWFya2VyKSB7CiAgICAgICAgICBvZmZzZXQgKz0gMjsKICAgICAgICAgIGNvbnN0IHNjYW5MaW5lcyA9ICgwLCBfY29yZV91dGlscy5yZWFkVWludDE2KShkYXRhLCBvZmZzZXQpOwogICAgICAgICAgb2Zmc2V0ICs9IDI7CiAgICAgICAgICBpZiAoc2NhbkxpbmVzID4gMCAmJiBzY2FuTGluZXMgIT09IGZyYW1lLnNjYW5MaW5lcykgewogICAgICAgICAgICB0aHJvdyBuZXcgRE5MTWFya2VyRXJyb3IoIkZvdW5kIEROTCBtYXJrZXIgKDB4RkZEQykgd2hpbGUgcGFyc2luZyBzY2FuIGRhdGEiLCBzY2FuTGluZXMpOwogICAgICAgICAgfQogICAgICAgIH0gZWxzZSBpZiAobmV4dEJ5dGUgPT09IDB4ZDkpIHsKICAgICAgICAgIGlmIChwYXJzZUROTE1hcmtlcikgewogICAgICAgICAgICBjb25zdCBtYXliZVNjYW5MaW5lcyA9IGJsb2NrUm93ICogKGZyYW1lLnByZWNpc2lvbiA9PT0gOCA/IDggOiAwKTsKICAgICAgICAgICAgaWYgKG1heWJlU2NhbkxpbmVzID4gMCAmJiBNYXRoLnJvdW5kKGZyYW1lLnNjYW5MaW5lcyAvIG1heWJlU2NhbkxpbmVzKSA+PSA1KSB7CiAgICAgICAgICAgICAgdGhyb3cgbmV3IEROTE1hcmtlckVycm9yKCJGb3VuZCBFT0kgbWFya2VyICgweEZGRDkpIHdoaWxlIHBhcnNpbmcgc2NhbiBkYXRhLCAiICsgInBvc3NpYmx5IGNhdXNlZCBieSBpbmNvcnJlY3QgYHNjYW5MaW5lc2AgcGFyYW1ldGVyIiwgbWF5YmVTY2FuTGluZXMpOwogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgICB0aHJvdyBuZXcgRU9JTWFya2VyRXJyb3IoIkZvdW5kIEVPSSBtYXJrZXIgKDB4RkZEOSkgd2hpbGUgcGFyc2luZyBzY2FuIGRhdGEiKTsKICAgICAgICB9CiAgICAgICAgdGhyb3cgbmV3IEpwZWdFcnJvcihgdW5leHBlY3RlZCBtYXJrZXIgJHsoYml0c0RhdGEgPDwgOCB8IG5leHRCeXRlKS50b1N0cmluZygxNil9YCk7CiAgICAgIH0KICAgIH0KICAgIGJpdHNDb3VudCA9IDc7CiAgICByZXR1cm4gYml0c0RhdGEgPj4+IDc7CiAgfQogIGZ1bmN0aW9uIGRlY29kZUh1ZmZtYW4odHJlZSkgewogICAgbGV0IG5vZGUgPSB0cmVlOwogICAgd2hpbGUgKHRydWUpIHsKICAgICAgbm9kZSA9IG5vZGVbcmVhZEJpdCgpXTsKICAgICAgc3dpdGNoICh0eXBlb2Ygbm9kZSkgewogICAgICAgIGNhc2UgIm51bWJlciI6CiAgICAgICAgICByZXR1cm4gbm9kZTsKICAgICAgICBjYXNlICJvYmplY3QiOgogICAgICAgICAgY29udGludWU7CiAgICAgIH0KICAgICAgdGhyb3cgbmV3IEpwZWdFcnJvcigiaW52YWxpZCBodWZmbWFuIHNlcXVlbmNlIik7CiAgICB9CiAgfQogIGZ1bmN0aW9uIHJlY2VpdmUobGVuZ3RoKSB7CiAgICBsZXQgbiA9IDA7CiAgICB3aGlsZSAobGVuZ3RoID4gMCkgewogICAgICBuID0gbiA8PCAxIHwgcmVhZEJpdCgpOwogICAgICBsZW5ndGgtLTsKICAgIH0KICAgIHJldHVybiBuOwogIH0KICBmdW5jdGlvbiByZWNlaXZlQW5kRXh0ZW5kKGxlbmd0aCkgewogICAgaWYgKGxlbmd0aCA9PT0gMSkgewogICAgICByZXR1cm4gcmVhZEJpdCgpID09PSAxID8gMSA6IC0xOwogICAgfQogICAgY29uc3QgbiA9IHJlY2VpdmUobGVuZ3RoKTsKICAgIGlmIChuID49IDEgPDwgbGVuZ3RoIC0gMSkgewogICAgICByZXR1cm4gbjsKICAgIH0KICAgIHJldHVybiBuICsgKC0xIDw8IGxlbmd0aCkgKyAxOwogIH0KICBmdW5jdGlvbiBkZWNvZGVCYXNlbGluZShjb21wb25lbnQsIGJsb2NrT2Zmc2V0KSB7CiAgICBjb25zdCB0ID0gZGVjb2RlSHVmZm1hbihjb21wb25lbnQuaHVmZm1hblRhYmxlREMpOwogICAgY29uc3QgZGlmZiA9IHQgPT09IDAgPyAwIDogcmVjZWl2ZUFuZEV4dGVuZCh0KTsKICAgIGNvbXBvbmVudC5ibG9ja0RhdGFbYmxvY2tPZmZzZXRdID0gY29tcG9uZW50LnByZWQgKz0gZGlmZjsKICAgIGxldCBrID0gMTsKICAgIHdoaWxlIChrIDwgNjQpIHsKICAgICAgY29uc3QgcnMgPSBkZWNvZGVIdWZmbWFuKGNvbXBvbmVudC5odWZmbWFuVGFibGVBQyk7CiAgICAgIGNvbnN0IHMgPSBycyAmIDE1LAogICAgICAgIHIgPSBycyA+PiA0OwogICAgICBpZiAocyA9PT0gMCkgewogICAgICAgIGlmIChyIDwgMTUpIHsKICAgICAgICAgIGJyZWFrOwogICAgICAgIH0KICAgICAgICBrICs9IDE2OwogICAgICAgIGNvbnRpbnVlOwogICAgICB9CiAgICAgIGsgKz0gcjsKICAgICAgY29uc3QgeiA9IGRjdFppZ1phZ1trXTsKICAgICAgY29tcG9uZW50LmJsb2NrRGF0YVtibG9ja09mZnNldCArIHpdID0gcmVjZWl2ZUFuZEV4dGVuZChzKTsKICAgICAgaysrOwogICAgfQogIH0KICBmdW5jdGlvbiBkZWNvZGVEQ0ZpcnN0KGNvbXBvbmVudCwgYmxvY2tPZmZzZXQpIHsKICAgIGNvbnN0IHQgPSBkZWNvZGVIdWZmbWFuKGNvbXBvbmVudC5odWZmbWFuVGFibGVEQyk7CiAgICBjb25zdCBkaWZmID0gdCA9PT0gMCA/IDAgOiByZWNlaXZlQW5kRXh0ZW5kKHQpIDw8IHN1Y2Nlc3NpdmU7CiAgICBjb21wb25lbnQuYmxvY2tEYXRhW2Jsb2NrT2Zmc2V0XSA9IGNvbXBvbmVudC5wcmVkICs9IGRpZmY7CiAgfQogIGZ1bmN0aW9uIGRlY29kZURDU3VjY2Vzc2l2ZShjb21wb25lbnQsIGJsb2NrT2Zmc2V0KSB7CiAgICBjb21wb25lbnQuYmxvY2tEYXRhW2Jsb2NrT2Zmc2V0XSB8PSByZWFkQml0KCkgPDwgc3VjY2Vzc2l2ZTsKICB9CiAgbGV0IGVvYnJ1biA9IDA7CiAgZnVuY3Rpb24gZGVjb2RlQUNGaXJzdChjb21wb25lbnQsIGJsb2NrT2Zmc2V0KSB7CiAgICBpZiAoZW9icnVuID4gMCkgewogICAgICBlb2JydW4tLTsKICAgICAgcmV0dXJuOwogICAgfQogICAgbGV0IGsgPSBzcGVjdHJhbFN0YXJ0OwogICAgY29uc3QgZSA9IHNwZWN0cmFsRW5kOwogICAgd2hpbGUgKGsgPD0gZSkgewogICAgICBjb25zdCBycyA9IGRlY29kZUh1ZmZtYW4oY29tcG9uZW50Lmh1ZmZtYW5UYWJsZUFDKTsKICAgICAgY29uc3QgcyA9IHJzICYgMTUsCiAgICAgICAgciA9IHJzID4+IDQ7CiAgICAgIGlmIChzID09PSAwKSB7CiAgICAgICAgaWYgKHIgPCAxNSkgewogICAgICAgICAgZW9icnVuID0gcmVjZWl2ZShyKSArICgxIDw8IHIpIC0gMTsKICAgICAgICAgIGJyZWFrOwogICAgICAgIH0KICAgICAgICBrICs9IDE2OwogICAgICAgIGNvbnRpbnVlOwogICAgICB9CiAgICAgIGsgKz0gcjsKICAgICAgY29uc3QgeiA9IGRjdFppZ1phZ1trXTsKICAgICAgY29tcG9uZW50LmJsb2NrRGF0YVtibG9ja09mZnNldCArIHpdID0gcmVjZWl2ZUFuZEV4dGVuZChzKSAqICgxIDw8IHN1Y2Nlc3NpdmUpOwogICAgICBrKys7CiAgICB9CiAgfQogIGxldCBzdWNjZXNzaXZlQUNTdGF0ZSA9IDAsCiAgICBzdWNjZXNzaXZlQUNOZXh0VmFsdWU7CiAgZnVuY3Rpb24gZGVjb2RlQUNTdWNjZXNzaXZlKGNvbXBvbmVudCwgYmxvY2tPZmZzZXQpIHsKICAgIGxldCBrID0gc3BlY3RyYWxTdGFydDsKICAgIGNvbnN0IGUgPSBzcGVjdHJhbEVuZDsKICAgIGxldCByID0gMDsKICAgIGxldCBzOwogICAgbGV0IHJzOwogICAgd2hpbGUgKGsgPD0gZSkgewogICAgICBjb25zdCBvZmZzZXRaID0gYmxvY2tPZmZzZXQgKyBkY3RaaWdaYWdba107CiAgICAgIGNvbnN0IHNpZ24gPSBjb21wb25lbnQuYmxvY2tEYXRhW29mZnNldFpdIDwgMCA/IC0xIDogMTsKICAgICAgc3dpdGNoIChzdWNjZXNzaXZlQUNTdGF0ZSkgewogICAgICAgIGNhc2UgMDoKICAgICAgICAgIHJzID0gZGVjb2RlSHVmZm1hbihjb21wb25lbnQuaHVmZm1hblRhYmxlQUMpOwogICAgICAgICAgcyA9IHJzICYgMTU7CiAgICAgICAgICByID0gcnMgPj4gNDsKICAgICAgICAgIGlmIChzID09PSAwKSB7CiAgICAgICAgICAgIGlmIChyIDwgMTUpIHsKICAgICAgICAgICAgICBlb2JydW4gPSByZWNlaXZlKHIpICsgKDEgPDwgcik7CiAgICAgICAgICAgICAgc3VjY2Vzc2l2ZUFDU3RhdGUgPSA0OwogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgIHIgPSAxNjsKICAgICAgICAgICAgICBzdWNjZXNzaXZlQUNTdGF0ZSA9IDE7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIGlmIChzICE9PSAxKSB7CiAgICAgICAgICAgICAgdGhyb3cgbmV3IEpwZWdFcnJvcigiaW52YWxpZCBBQ24gZW5jb2RpbmciKTsKICAgICAgICAgICAgfQogICAgICAgICAgICBzdWNjZXNzaXZlQUNOZXh0VmFsdWUgPSByZWNlaXZlQW5kRXh0ZW5kKHMpOwogICAgICAgICAgICBzdWNjZXNzaXZlQUNTdGF0ZSA9IHIgPyAyIDogMzsKICAgICAgICAgIH0KICAgICAgICAgIGNvbnRpbnVlOwogICAgICAgIGNhc2UgMToKICAgICAgICBjYXNlIDI6CiAgICAgICAgICBpZiAoY29tcG9uZW50LmJsb2NrRGF0YVtvZmZzZXRaXSkgewogICAgICAgICAgICBjb21wb25lbnQuYmxvY2tEYXRhW29mZnNldFpdICs9IHNpZ24gKiAocmVhZEJpdCgpIDw8IHN1Y2Nlc3NpdmUpOwogICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgci0tOwogICAgICAgICAgICBpZiAociA9PT0gMCkgewogICAgICAgICAgICAgIHN1Y2Nlc3NpdmVBQ1N0YXRlID0gc3VjY2Vzc2l2ZUFDU3RhdGUgPT09IDIgPyAzIDogMDsKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgICAgYnJlYWs7CiAgICAgICAgY2FzZSAzOgogICAgICAgICAgaWYgKGNvbXBvbmVudC5ibG9ja0RhdGFbb2Zmc2V0Wl0pIHsKICAgICAgICAgICAgY29tcG9uZW50LmJsb2NrRGF0YVtvZmZzZXRaXSArPSBzaWduICogKHJlYWRCaXQoKSA8PCBzdWNjZXNzaXZlKTsKICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIGNvbXBvbmVudC5ibG9ja0RhdGFbb2Zmc2V0Wl0gPSBzdWNjZXNzaXZlQUNOZXh0VmFsdWUgPDwgc3VjY2Vzc2l2ZTsKICAgICAgICAgICAgc3VjY2Vzc2l2ZUFDU3RhdGUgPSAwOwogICAgICAgICAgfQogICAgICAgICAgYnJlYWs7CiAgICAgICAgY2FzZSA0OgogICAgICAgICAgaWYgKGNvbXBvbmVudC5ibG9ja0RhdGFbb2Zmc2V0Wl0pIHsKICAgICAgICAgICAgY29tcG9uZW50LmJsb2NrRGF0YVtvZmZzZXRaXSArPSBzaWduICogKHJlYWRCaXQoKSA8PCBzdWNjZXNzaXZlKTsKICAgICAgICAgIH0KICAgICAgICAgIGJyZWFrOwogICAgICB9CiAgICAgIGsrKzsKICAgIH0KICAgIGlmIChzdWNjZXNzaXZlQUNTdGF0ZSA9PT0gNCkgewogICAgICBlb2JydW4tLTsKICAgICAgaWYgKGVvYnJ1biA9PT0gMCkgewogICAgICAgIHN1Y2Nlc3NpdmVBQ1N0YXRlID0gMDsKICAgICAgfQogICAgfQogIH0KICBsZXQgYmxvY2tSb3cgPSAwOwogIGZ1bmN0aW9uIGRlY29kZU1jdShjb21wb25lbnQsIGRlY29kZSwgbWN1LCByb3csIGNvbCkgewogICAgY29uc3QgbWN1Um93ID0gbWN1IC8gbWN1c1BlckxpbmUgfCAwOwogICAgY29uc3QgbWN1Q29sID0gbWN1ICUgbWN1c1BlckxpbmU7CiAgICBibG9ja1JvdyA9IG1jdVJvdyAqIGNvbXBvbmVudC52ICsgcm93OwogICAgY29uc3QgYmxvY2tDb2wgPSBtY3VDb2wgKiBjb21wb25lbnQuaCArIGNvbDsKICAgIGNvbnN0IGJsb2NrT2Zmc2V0ID0gZ2V0QmxvY2tCdWZmZXJPZmZzZXQoY29tcG9uZW50LCBibG9ja1JvdywgYmxvY2tDb2wpOwogICAgZGVjb2RlKGNvbXBvbmVudCwgYmxvY2tPZmZzZXQpOwogIH0KICBmdW5jdGlvbiBkZWNvZGVCbG9jayhjb21wb25lbnQsIGRlY29kZSwgbWN1KSB7CiAgICBibG9ja1JvdyA9IG1jdSAvIGNvbXBvbmVudC5ibG9ja3NQZXJMaW5lIHwgMDsKICAgIGNvbnN0IGJsb2NrQ29sID0gbWN1ICUgY29tcG9uZW50LmJsb2Nrc1BlckxpbmU7CiAgICBjb25zdCBibG9ja09mZnNldCA9IGdldEJsb2NrQnVmZmVyT2Zmc2V0KGNvbXBvbmVudCwgYmxvY2tSb3csIGJsb2NrQ29sKTsKICAgIGRlY29kZShjb21wb25lbnQsIGJsb2NrT2Zmc2V0KTsKICB9CiAgY29uc3QgY29tcG9uZW50c0xlbmd0aCA9IGNvbXBvbmVudHMubGVuZ3RoOwogIGxldCBjb21wb25lbnQsIGksIGosIGssIG47CiAgbGV0IGRlY29kZUZuOwogIGlmIChwcm9ncmVzc2l2ZSkgewogICAgaWYgKHNwZWN0cmFsU3RhcnQgPT09IDApIHsKICAgICAgZGVjb2RlRm4gPSBzdWNjZXNzaXZlUHJldiA9PT0gMCA/IGRlY29kZURDRmlyc3QgOiBkZWNvZGVEQ1N1Y2Nlc3NpdmU7CiAgICB9IGVsc2UgewogICAgICBkZWNvZGVGbiA9IHN1Y2Nlc3NpdmVQcmV2ID09PSAwID8gZGVjb2RlQUNGaXJzdCA6IGRlY29kZUFDU3VjY2Vzc2l2ZTsKICAgIH0KICB9IGVsc2UgewogICAgZGVjb2RlRm4gPSBkZWNvZGVCYXNlbGluZTsKICB9CiAgbGV0IG1jdSA9IDAsCiAgICBmaWxlTWFya2VyOwogIGNvbnN0IG1jdUV4cGVjdGVkID0gY29tcG9uZW50c0xlbmd0aCA9PT0gMSA/IGNvbXBvbmVudHNbMF0uYmxvY2tzUGVyTGluZSAqIGNvbXBvbmVudHNbMF0uYmxvY2tzUGVyQ29sdW1uIDogbWN1c1BlckxpbmUgKiBmcmFtZS5tY3VzUGVyQ29sdW1uOwogIGxldCBoLCB2OwogIHdoaWxlIChtY3UgPD0gbWN1RXhwZWN0ZWQpIHsKICAgIGNvbnN0IG1jdVRvUmVhZCA9IHJlc2V0SW50ZXJ2YWwgPyBNYXRoLm1pbihtY3VFeHBlY3RlZCAtIG1jdSwgcmVzZXRJbnRlcnZhbCkgOiBtY3VFeHBlY3RlZDsKICAgIGlmIChtY3VUb1JlYWQgPiAwKSB7CiAgICAgIGZvciAoaSA9IDA7IGkgPCBjb21wb25lbnRzTGVuZ3RoOyBpKyspIHsKICAgICAgICBjb21wb25lbnRzW2ldLnByZWQgPSAwOwogICAgICB9CiAgICAgIGVvYnJ1biA9IDA7CiAgICAgIGlmIChjb21wb25lbnRzTGVuZ3RoID09PSAxKSB7CiAgICAgICAgY29tcG9uZW50ID0gY29tcG9uZW50c1swXTsKICAgICAgICBmb3IgKG4gPSAwOyBuIDwgbWN1VG9SZWFkOyBuKyspIHsKICAgICAgICAgIGRlY29kZUJsb2NrKGNvbXBvbmVudCwgZGVjb2RlRm4sIG1jdSk7CiAgICAgICAgICBtY3UrKzsKICAgICAgICB9CiAgICAgIH0gZWxzZSB7CiAgICAgICAgZm9yIChuID0gMDsgbiA8IG1jdVRvUmVhZDsgbisrKSB7CiAgICAgICAgICBmb3IgKGkgPSAwOyBpIDwgY29tcG9uZW50c0xlbmd0aDsgaSsrKSB7CiAgICAgICAgICAgIGNvbXBvbmVudCA9IGNvbXBvbmVudHNbaV07CiAgICAgICAgICAgIGggPSBjb21wb25lbnQuaDsKICAgICAgICAgICAgdiA9IGNvbXBvbmVudC52OwogICAgICAgICAgICBmb3IgKGogPSAwOyBqIDwgdjsgaisrKSB7CiAgICAgICAgICAgICAgZm9yIChrID0gMDsgayA8IGg7IGsrKykgewogICAgICAgICAgICAgICAgZGVjb2RlTWN1KGNvbXBvbmVudCwgZGVjb2RlRm4sIG1jdSwgaiwgayk7CiAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgICBtY3UrKzsKICAgICAgICB9CiAgICAgIH0KICAgIH0KICAgIGJpdHNDb3VudCA9IDA7CiAgICBmaWxlTWFya2VyID0gZmluZE5leHRGaWxlTWFya2VyKGRhdGEsIG9mZnNldCk7CiAgICBpZiAoIWZpbGVNYXJrZXIpIHsKICAgICAgYnJlYWs7CiAgICB9CiAgICBpZiAoZmlsZU1hcmtlci5pbnZhbGlkKSB7CiAgICAgIGNvbnN0IHBhcnRpYWxNc2cgPSBtY3VUb1JlYWQgPiAwID8gInVuZXhwZWN0ZWQiIDogImV4Y2Vzc2l2ZSI7CiAgICAgICgwLCBfdXRpbC53YXJuKShgZGVjb2RlU2NhbiAtICR7cGFydGlhbE1zZ30gTUNVIGRhdGEsIGN1cnJlbnQgbWFya2VyIGlzOiAke2ZpbGVNYXJrZXIuaW52YWxpZH1gKTsKICAgICAgb2Zmc2V0ID0gZmlsZU1hcmtlci5vZmZzZXQ7CiAgICB9CiAgICBpZiAoZmlsZU1hcmtlci5tYXJrZXIgPj0gMHhmZmQwICYmIGZpbGVNYXJrZXIubWFya2VyIDw9IDB4ZmZkNykgewogICAgICBvZmZzZXQgKz0gMjsKICAgIH0gZWxzZSB7CiAgICAgIGJyZWFrOwogICAgfQogIH0KICByZXR1cm4gb2Zmc2V0IC0gc3RhcnRPZmZzZXQ7Cn0KZnVuY3Rpb24gcXVhbnRpemVBbmRJbnZlcnNlKGNvbXBvbmVudCwgYmxvY2tCdWZmZXJPZmZzZXQsIHApIHsKICBjb25zdCBxdCA9IGNvbXBvbmVudC5xdWFudGl6YXRpb25UYWJsZSwKICAgIGJsb2NrRGF0YSA9IGNvbXBvbmVudC5ibG9ja0RhdGE7CiAgbGV0IHYwLCB2MSwgdjIsIHYzLCB2NCwgdjUsIHY2LCB2NzsKICBsZXQgcDAsIHAxLCBwMiwgcDMsIHA0LCBwNSwgcDYsIHA3OwogIGxldCB0OwogIGlmICghcXQpIHsKICAgIHRocm93IG5ldyBKcGVnRXJyb3IoIm1pc3NpbmcgcmVxdWlyZWQgUXVhbnRpemF0aW9uIFRhYmxlLiIpOwogIH0KICBmb3IgKGxldCByb3cgPSAwOyByb3cgPCA2NDsgcm93ICs9IDgpIHsKICAgIHAwID0gYmxvY2tEYXRhW2Jsb2NrQnVmZmVyT2Zmc2V0ICsgcm93XTsKICAgIHAxID0gYmxvY2tEYXRhW2Jsb2NrQnVmZmVyT2Zmc2V0ICsgcm93ICsgMV07CiAgICBwMiA9IGJsb2NrRGF0YVtibG9ja0J1ZmZlck9mZnNldCArIHJvdyArIDJdOwogICAgcDMgPSBibG9ja0RhdGFbYmxvY2tCdWZmZXJPZmZzZXQgKyByb3cgKyAzXTsKICAgIHA0ID0gYmxvY2tEYXRhW2Jsb2NrQnVmZmVyT2Zmc2V0ICsgcm93ICsgNF07CiAgICBwNSA9IGJsb2NrRGF0YVtibG9ja0J1ZmZlck9mZnNldCArIHJvdyArIDVdOwogICAgcDYgPSBibG9ja0RhdGFbYmxvY2tCdWZmZXJPZmZzZXQgKyByb3cgKyA2XTsKICAgIHA3ID0gYmxvY2tEYXRhW2Jsb2NrQnVmZmVyT2Zmc2V0ICsgcm93ICsgN107CiAgICBwMCAqPSBxdFtyb3ddOwogICAgaWYgKChwMSB8IHAyIHwgcDMgfCBwNCB8IHA1IHwgcDYgfCBwNykgPT09IDApIHsKICAgICAgdCA9IGRjdFNxcnQyICogcDAgKyA1MTIgPj4gMTA7CiAgICAgIHBbcm93XSA9IHQ7CiAgICAgIHBbcm93ICsgMV0gPSB0OwogICAgICBwW3JvdyArIDJdID0gdDsKICAgICAgcFtyb3cgKyAzXSA9IHQ7CiAgICAgIHBbcm93ICsgNF0gPSB0OwogICAgICBwW3JvdyArIDVdID0gdDsKICAgICAgcFtyb3cgKyA2XSA9IHQ7CiAgICAgIHBbcm93ICsgN10gPSB0OwogICAgICBjb250aW51ZTsKICAgIH0KICAgIHAxICo9IHF0W3JvdyArIDFdOwogICAgcDIgKj0gcXRbcm93ICsgMl07CiAgICBwMyAqPSBxdFtyb3cgKyAzXTsKICAgIHA0ICo9IHF0W3JvdyArIDRdOwogICAgcDUgKj0gcXRbcm93ICsgNV07CiAgICBwNiAqPSBxdFtyb3cgKyA2XTsKICAgIHA3ICo9IHF0W3JvdyArIDddOwogICAgdjAgPSBkY3RTcXJ0MiAqIHAwICsgMTI4ID4+IDg7CiAgICB2MSA9IGRjdFNxcnQyICogcDQgKyAxMjggPj4gODsKICAgIHYyID0gcDI7CiAgICB2MyA9IHA2OwogICAgdjQgPSBkY3RTcXJ0MWQyICogKHAxIC0gcDcpICsgMTI4ID4+IDg7CiAgICB2NyA9IGRjdFNxcnQxZDIgKiAocDEgKyBwNykgKyAxMjggPj4gODsKICAgIHY1ID0gcDMgPDwgNDsKICAgIHY2ID0gcDUgPDwgNDsKICAgIHYwID0gdjAgKyB2MSArIDEgPj4gMTsKICAgIHYxID0gdjAgLSB2MTsKICAgIHQgPSB2MiAqIGRjdFNpbjYgKyB2MyAqIGRjdENvczYgKyAxMjggPj4gODsKICAgIHYyID0gdjIgKiBkY3RDb3M2IC0gdjMgKiBkY3RTaW42ICsgMTI4ID4+IDg7CiAgICB2MyA9IHQ7CiAgICB2NCA9IHY0ICsgdjYgKyAxID4+IDE7CiAgICB2NiA9IHY0IC0gdjY7CiAgICB2NyA9IHY3ICsgdjUgKyAxID4+IDE7CiAgICB2NSA9IHY3IC0gdjU7CiAgICB2MCA9IHYwICsgdjMgKyAxID4+IDE7CiAgICB2MyA9IHYwIC0gdjM7CiAgICB2MSA9IHYxICsgdjIgKyAxID4+IDE7CiAgICB2MiA9IHYxIC0gdjI7CiAgICB0ID0gdjQgKiBkY3RTaW4zICsgdjcgKiBkY3RDb3MzICsgMjA0OCA+PiAxMjsKICAgIHY0ID0gdjQgKiBkY3RDb3MzIC0gdjcgKiBkY3RTaW4zICsgMjA0OCA+PiAxMjsKICAgIHY3ID0gdDsKICAgIHQgPSB2NSAqIGRjdFNpbjEgKyB2NiAqIGRjdENvczEgKyAyMDQ4ID4+IDEyOwogICAgdjUgPSB2NSAqIGRjdENvczEgLSB2NiAqIGRjdFNpbjEgKyAyMDQ4ID4+IDEyOwogICAgdjYgPSB0OwogICAgcFtyb3ddID0gdjAgKyB2NzsKICAgIHBbcm93ICsgN10gPSB2MCAtIHY3OwogICAgcFtyb3cgKyAxXSA9IHYxICsgdjY7CiAgICBwW3JvdyArIDZdID0gdjEgLSB2NjsKICAgIHBbcm93ICsgMl0gPSB2MiArIHY1OwogICAgcFtyb3cgKyA1XSA9IHYyIC0gdjU7CiAgICBwW3JvdyArIDNdID0gdjMgKyB2NDsKICAgIHBbcm93ICsgNF0gPSB2MyAtIHY0OwogIH0KICBmb3IgKGxldCBjb2wgPSAwOyBjb2wgPCA4OyArK2NvbCkgewogICAgcDAgPSBwW2NvbF07CiAgICBwMSA9IHBbY29sICsgOF07CiAgICBwMiA9IHBbY29sICsgMTZdOwogICAgcDMgPSBwW2NvbCArIDI0XTsKICAgIHA0ID0gcFtjb2wgKyAzMl07CiAgICBwNSA9IHBbY29sICsgNDBdOwogICAgcDYgPSBwW2NvbCArIDQ4XTsKICAgIHA3ID0gcFtjb2wgKyA1Nl07CiAgICBpZiAoKHAxIHwgcDIgfCBwMyB8IHA0IHwgcDUgfCBwNiB8IHA3KSA9PT0gMCkgewogICAgICB0ID0gZGN0U3FydDIgKiBwMCArIDgxOTIgPj4gMTQ7CiAgICAgIGlmICh0IDwgLTIwNDApIHsKICAgICAgICB0ID0gMDsKICAgICAgfSBlbHNlIGlmICh0ID49IDIwMjQpIHsKICAgICAgICB0ID0gMjU1OwogICAgICB9IGVsc2UgewogICAgICAgIHQgPSB0ICsgMjA1NiA+PiA0OwogICAgICB9CiAgICAgIGJsb2NrRGF0YVtibG9ja0J1ZmZlck9mZnNldCArIGNvbF0gPSB0OwogICAgICBibG9ja0RhdGFbYmxvY2tCdWZmZXJPZmZzZXQgKyBjb2wgKyA4XSA9IHQ7CiAgICAgIGJsb2NrRGF0YVtibG9ja0J1ZmZlck9mZnNldCArIGNvbCArIDE2XSA9IHQ7CiAgICAgIGJsb2NrRGF0YVtibG9ja0J1ZmZlck9mZnNldCArIGNvbCArIDI0XSA9IHQ7CiAgICAgIGJsb2NrRGF0YVtibG9ja0J1ZmZlck9mZnNldCArIGNvbCArIDMyXSA9IHQ7CiAgICAgIGJsb2NrRGF0YVtibG9ja0J1ZmZlck9mZnNldCArIGNvbCArIDQwXSA9IHQ7CiAgICAgIGJsb2NrRGF0YVtibG9ja0J1ZmZlck9mZnNldCArIGNvbCArIDQ4XSA9IHQ7CiAgICAgIGJsb2NrRGF0YVtibG9ja0J1ZmZlck9mZnNldCArIGNvbCArIDU2XSA9IHQ7CiAgICAgIGNvbnRpbnVlOwogICAgfQogICAgdjAgPSBkY3RTcXJ0MiAqIHAwICsgMjA0OCA+PiAxMjsKICAgIHYxID0gZGN0U3FydDIgKiBwNCArIDIwNDggPj4gMTI7CiAgICB2MiA9IHAyOwogICAgdjMgPSBwNjsKICAgIHY0ID0gZGN0U3FydDFkMiAqIChwMSAtIHA3KSArIDIwNDggPj4gMTI7CiAgICB2NyA9IGRjdFNxcnQxZDIgKiAocDEgKyBwNykgKyAyMDQ4ID4+IDEyOwogICAgdjUgPSBwMzsKICAgIHY2ID0gcDU7CiAgICB2MCA9ICh2MCArIHYxICsgMSA+PiAxKSArIDQxMTI7CiAgICB2MSA9IHYwIC0gdjE7CiAgICB0ID0gdjIgKiBkY3RTaW42ICsgdjMgKiBkY3RDb3M2ICsgMjA0OCA+PiAxMjsKICAgIHYyID0gdjIgKiBkY3RDb3M2IC0gdjMgKiBkY3RTaW42ICsgMjA0OCA+PiAxMjsKICAgIHYzID0gdDsKICAgIHY0ID0gdjQgKyB2NiArIDEgPj4gMTsKICAgIHY2ID0gdjQgLSB2NjsKICAgIHY3ID0gdjcgKyB2NSArIDEgPj4gMTsKICAgIHY1ID0gdjcgLSB2NTsKICAgIHYwID0gdjAgKyB2MyArIDEgPj4gMTsKICAgIHYzID0gdjAgLSB2MzsKICAgIHYxID0gdjEgKyB2MiArIDEgPj4gMTsKICAgIHYyID0gdjEgLSB2MjsKICAgIHQgPSB2NCAqIGRjdFNpbjMgKyB2NyAqIGRjdENvczMgKyAyMDQ4ID4+IDEyOwogICAgdjQgPSB2NCAqIGRjdENvczMgLSB2NyAqIGRjdFNpbjMgKyAyMDQ4ID4+IDEyOwogICAgdjcgPSB0OwogICAgdCA9IHY1ICogZGN0U2luMSArIHY2ICogZGN0Q29zMSArIDIwNDggPj4gMTI7CiAgICB2NSA9IHY1ICogZGN0Q29zMSAtIHY2ICogZGN0U2luMSArIDIwNDggPj4gMTI7CiAgICB2NiA9IHQ7CiAgICBwMCA9IHYwICsgdjc7CiAgICBwNyA9IHYwIC0gdjc7CiAgICBwMSA9IHYxICsgdjY7CiAgICBwNiA9IHYxIC0gdjY7CiAgICBwMiA9IHYyICsgdjU7CiAgICBwNSA9IHYyIC0gdjU7CiAgICBwMyA9IHYzICsgdjQ7CiAgICBwNCA9IHYzIC0gdjQ7CiAgICBpZiAocDAgPCAxNikgewogICAgICBwMCA9IDA7CiAgICB9IGVsc2UgaWYgKHAwID49IDQwODApIHsKICAgICAgcDAgPSAyNTU7CiAgICB9IGVsc2UgewogICAgICBwMCA+Pj0gNDsKICAgIH0KICAgIGlmIChwMSA8IDE2KSB7CiAgICAgIHAxID0gMDsKICAgIH0gZWxzZSBpZiAocDEgPj0gNDA4MCkgewogICAgICBwMSA9IDI1NTsKICAgIH0gZWxzZSB7CiAgICAgIHAxID4+PSA0OwogICAgfQogICAgaWYgKHAyIDwgMTYpIHsKICAgICAgcDIgPSAwOwogICAgfSBlbHNlIGlmIChwMiA+PSA0MDgwKSB7CiAgICAgIHAyID0gMjU1OwogICAgfSBlbHNlIHsKICAgICAgcDIgPj49IDQ7CiAgICB9CiAgICBpZiAocDMgPCAxNikgewogICAgICBwMyA9IDA7CiAgICB9IGVsc2UgaWYgKHAzID49IDQwODApIHsKICAgICAgcDMgPSAyNTU7CiAgICB9IGVsc2UgewogICAgICBwMyA+Pj0gNDsKICAgIH0KICAgIGlmIChwNCA8IDE2KSB7CiAgICAgIHA0ID0gMDsKICAgIH0gZWxzZSBpZiAocDQgPj0gNDA4MCkgewogICAgICBwNCA9IDI1NTsKICAgIH0gZWxzZSB7CiAgICAgIHA0ID4+PSA0OwogICAgfQogICAgaWYgKHA1IDwgMTYpIHsKICAgICAgcDUgPSAwOwogICAgfSBlbHNlIGlmIChwNSA+PSA0MDgwKSB7CiAgICAgIHA1ID0gMjU1OwogICAgfSBlbHNlIHsKICAgICAgcDUgPj49IDQ7CiAgICB9CiAgICBpZiAocDYgPCAxNikgewogICAgICBwNiA9IDA7CiAgICB9IGVsc2UgaWYgKHA2ID49IDQwODApIHsKICAgICAgcDYgPSAyNTU7CiAgICB9IGVsc2UgewogICAgICBwNiA+Pj0gNDsKICAgIH0KICAgIGlmIChwNyA8IDE2KSB7CiAgICAgIHA3ID0gMDsKICAgIH0gZWxzZSBpZiAocDcgPj0gNDA4MCkgewogICAgICBwNyA9IDI1NTsKICAgIH0gZWxzZSB7CiAgICAgIHA3ID4+PSA0OwogICAgfQogICAgYmxvY2tEYXRhW2Jsb2NrQnVmZmVyT2Zmc2V0ICsgY29sXSA9IHAwOwogICAgYmxvY2tEYXRhW2Jsb2NrQnVmZmVyT2Zmc2V0ICsgY29sICsgOF0gPSBwMTsKICAgIGJsb2NrRGF0YVtibG9ja0J1ZmZlck9mZnNldCArIGNvbCArIDE2XSA9IHAyOwogICAgYmxvY2tEYXRhW2Jsb2NrQnVmZmVyT2Zmc2V0ICsgY29sICsgMjRdID0gcDM7CiAgICBibG9ja0RhdGFbYmxvY2tCdWZmZXJPZmZzZXQgKyBjb2wgKyAzMl0gPSBwNDsKICAgIGJsb2NrRGF0YVtibG9ja0J1ZmZlck9mZnNldCArIGNvbCArIDQwXSA9IHA1OwogICAgYmxvY2tEYXRhW2Jsb2NrQnVmZmVyT2Zmc2V0ICsgY29sICsgNDhdID0gcDY7CiAgICBibG9ja0RhdGFbYmxvY2tCdWZmZXJPZmZzZXQgKyBjb2wgKyA1Nl0gPSBwNzsKICB9Cn0KZnVuY3Rpb24gYnVpbGRDb21wb25lbnREYXRhKGZyYW1lLCBjb21wb25lbnQpIHsKICBjb25zdCBibG9ja3NQZXJMaW5lID0gY29tcG9uZW50LmJsb2Nrc1BlckxpbmU7CiAgY29uc3QgYmxvY2tzUGVyQ29sdW1uID0gY29tcG9uZW50LmJsb2Nrc1BlckNvbHVtbjsKICBjb25zdCBjb21wdXRhdGlvbkJ1ZmZlciA9IG5ldyBJbnQxNkFycmF5KDY0KTsKICBmb3IgKGxldCBibG9ja1JvdyA9IDA7IGJsb2NrUm93IDwgYmxvY2tzUGVyQ29sdW1uOyBibG9ja1JvdysrKSB7CiAgICBmb3IgKGxldCBibG9ja0NvbCA9IDA7IGJsb2NrQ29sIDwgYmxvY2tzUGVyTGluZTsgYmxvY2tDb2wrKykgewogICAgICBjb25zdCBvZmZzZXQgPSBnZXRCbG9ja0J1ZmZlck9mZnNldChjb21wb25lbnQsIGJsb2NrUm93LCBibG9ja0NvbCk7CiAgICAgIHF1YW50aXplQW5kSW52ZXJzZShjb21wb25lbnQsIG9mZnNldCwgY29tcHV0YXRpb25CdWZmZXIpOwogICAgfQogIH0KICByZXR1cm4gY29tcG9uZW50LmJsb2NrRGF0YTsKfQpmdW5jdGlvbiBmaW5kTmV4dEZpbGVNYXJrZXIoZGF0YSwgY3VycmVudFBvcywgc3RhcnRQb3MgPSBjdXJyZW50UG9zKSB7CiAgY29uc3QgbWF4UG9zID0gZGF0YS5sZW5ndGggLSAxOwogIGxldCBuZXdQb3MgPSBzdGFydFBvcyA8IGN1cnJlbnRQb3MgPyBzdGFydFBvcyA6IGN1cnJlbnRQb3M7CiAgaWYgKGN1cnJlbnRQb3MgPj0gbWF4UG9zKSB7CiAgICByZXR1cm4gbnVsbDsKICB9CiAgY29uc3QgY3VycmVudE1hcmtlciA9ICgwLCBfY29yZV91dGlscy5yZWFkVWludDE2KShkYXRhLCBjdXJyZW50UG9zKTsKICBpZiAoY3VycmVudE1hcmtlciA+PSAweGZmYzAgJiYgY3VycmVudE1hcmtlciA8PSAweGZmZmUpIHsKICAgIHJldHVybiB7CiAgICAgIGludmFsaWQ6IG51bGwsCiAgICAgIG1hcmtlcjogY3VycmVudE1hcmtlciwKICAgICAgb2Zmc2V0OiBjdXJyZW50UG9zCiAgICB9OwogIH0KICBsZXQgbmV3TWFya2VyID0gKDAsIF9jb3JlX3V0aWxzLnJlYWRVaW50MTYpKGRhdGEsIG5ld1Bvcyk7CiAgd2hpbGUgKCEobmV3TWFya2VyID49IDB4ZmZjMCAmJiBuZXdNYXJrZXIgPD0gMHhmZmZlKSkgewogICAgaWYgKCsrbmV3UG9zID49IG1heFBvcykgewogICAgICByZXR1cm4gbnVsbDsKICAgIH0KICAgIG5ld01hcmtlciA9ICgwLCBfY29yZV91dGlscy5yZWFkVWludDE2KShkYXRhLCBuZXdQb3MpOwogIH0KICByZXR1cm4gewogICAgaW52YWxpZDogY3VycmVudE1hcmtlci50b1N0cmluZygxNiksCiAgICBtYXJrZXI6IG5ld01hcmtlciwKICAgIG9mZnNldDogbmV3UG9zCiAgfTsKfQpjbGFzcyBKcGVnSW1hZ2UgewogIGNvbnN0cnVjdG9yKHsKICAgIGRlY29kZVRyYW5zZm9ybSA9IG51bGwsCiAgICBjb2xvclRyYW5zZm9ybSA9IC0xCiAgfSA9IHt9KSB7CiAgICB0aGlzLl9kZWNvZGVUcmFuc2Zvcm0gPSBkZWNvZGVUcmFuc2Zvcm07CiAgICB0aGlzLl9jb2xvclRyYW5zZm9ybSA9IGNvbG9yVHJhbnNmb3JtOwogIH0KICBwYXJzZShkYXRhLCB7CiAgICBkbmxTY2FuTGluZXMgPSBudWxsCiAgfSA9IHt9KSB7CiAgICBmdW5jdGlvbiByZWFkRGF0YUJsb2NrKCkgewogICAgICBjb25zdCBsZW5ndGggPSAoMCwgX2NvcmVfdXRpbHMucmVhZFVpbnQxNikoZGF0YSwgb2Zmc2V0KTsKICAgICAgb2Zmc2V0ICs9IDI7CiAgICAgIGxldCBlbmRPZmZzZXQgPSBvZmZzZXQgKyBsZW5ndGggLSAyOwogICAgICBjb25zdCBmaWxlTWFya2VyID0gZmluZE5leHRGaWxlTWFya2VyKGRhdGEsIGVuZE9mZnNldCwgb2Zmc2V0KTsKICAgICAgaWYgKGZpbGVNYXJrZXI/LmludmFsaWQpIHsKICAgICAgICAoMCwgX3V0aWwud2FybikoInJlYWREYXRhQmxvY2sgLSBpbmNvcnJlY3QgbGVuZ3RoLCBjdXJyZW50IG1hcmtlciBpczogIiArIGZpbGVNYXJrZXIuaW52YWxpZCk7CiAgICAgICAgZW5kT2Zmc2V0ID0gZmlsZU1hcmtlci5vZmZzZXQ7CiAgICAgIH0KICAgICAgY29uc3QgYXJyYXkgPSBkYXRhLnN1YmFycmF5KG9mZnNldCwgZW5kT2Zmc2V0KTsKICAgICAgb2Zmc2V0ICs9IGFycmF5Lmxlbmd0aDsKICAgICAgcmV0dXJuIGFycmF5OwogICAgfQogICAgZnVuY3Rpb24gcHJlcGFyZUNvbXBvbmVudHMoZnJhbWUpIHsKICAgICAgY29uc3QgbWN1c1BlckxpbmUgPSBNYXRoLmNlaWwoZnJhbWUuc2FtcGxlc1BlckxpbmUgLyA4IC8gZnJhbWUubWF4SCk7CiAgICAgIGNvbnN0IG1jdXNQZXJDb2x1bW4gPSBNYXRoLmNlaWwoZnJhbWUuc2NhbkxpbmVzIC8gOCAvIGZyYW1lLm1heFYpOwogICAgICBmb3IgKGNvbnN0IGNvbXBvbmVudCBvZiBmcmFtZS5jb21wb25lbnRzKSB7CiAgICAgICAgY29uc3QgYmxvY2tzUGVyTGluZSA9IE1hdGguY2VpbChNYXRoLmNlaWwoZnJhbWUuc2FtcGxlc1BlckxpbmUgLyA4KSAqIGNvbXBvbmVudC5oIC8gZnJhbWUubWF4SCk7CiAgICAgICAgY29uc3QgYmxvY2tzUGVyQ29sdW1uID0gTWF0aC5jZWlsKE1hdGguY2VpbChmcmFtZS5zY2FuTGluZXMgLyA4KSAqIGNvbXBvbmVudC52IC8gZnJhbWUubWF4Vik7CiAgICAgICAgY29uc3QgYmxvY2tzUGVyTGluZUZvck1jdSA9IG1jdXNQZXJMaW5lICogY29tcG9uZW50Lmg7CiAgICAgICAgY29uc3QgYmxvY2tzUGVyQ29sdW1uRm9yTWN1ID0gbWN1c1BlckNvbHVtbiAqIGNvbXBvbmVudC52OwogICAgICAgIGNvbnN0IGJsb2Nrc0J1ZmZlclNpemUgPSA2NCAqIGJsb2Nrc1BlckNvbHVtbkZvck1jdSAqIChibG9ja3NQZXJMaW5lRm9yTWN1ICsgMSk7CiAgICAgICAgY29tcG9uZW50LmJsb2NrRGF0YSA9IG5ldyBJbnQxNkFycmF5KGJsb2Nrc0J1ZmZlclNpemUpOwogICAgICAgIGNvbXBvbmVudC5ibG9ja3NQZXJMaW5lID0gYmxvY2tzUGVyTGluZTsKICAgICAgICBjb21wb25lbnQuYmxvY2tzUGVyQ29sdW1uID0gYmxvY2tzUGVyQ29sdW1uOwogICAgICB9CiAgICAgIGZyYW1lLm1jdXNQZXJMaW5lID0gbWN1c1BlckxpbmU7CiAgICAgIGZyYW1lLm1jdXNQZXJDb2x1bW4gPSBtY3VzUGVyQ29sdW1uOwogICAgfQogICAgbGV0IG9mZnNldCA9IDA7CiAgICBsZXQgamZpZiA9IG51bGw7CiAgICBsZXQgYWRvYmUgPSBudWxsOwogICAgbGV0IGZyYW1lLCByZXNldEludGVydmFsOwogICAgbGV0IG51bVNPU01hcmtlcnMgPSAwOwogICAgY29uc3QgcXVhbnRpemF0aW9uVGFibGVzID0gW107CiAgICBjb25zdCBodWZmbWFuVGFibGVzQUMgPSBbXSwKICAgICAgaHVmZm1hblRhYmxlc0RDID0gW107CiAgICBsZXQgZmlsZU1hcmtlciA9ICgwLCBfY29yZV91dGlscy5yZWFkVWludDE2KShkYXRhLCBvZmZzZXQpOwogICAgb2Zmc2V0ICs9IDI7CiAgICBpZiAoZmlsZU1hcmtlciAhPT0gMHhmZmQ4KSB7CiAgICAgIHRocm93IG5ldyBKcGVnRXJyb3IoIlNPSSBub3QgZm91bmQiKTsKICAgIH0KICAgIGZpbGVNYXJrZXIgPSAoMCwgX2NvcmVfdXRpbHMucmVhZFVpbnQxNikoZGF0YSwgb2Zmc2V0KTsKICAgIG9mZnNldCArPSAyOwogICAgbWFya2VyTG9vcDogd2hpbGUgKGZpbGVNYXJrZXIgIT09IDB4ZmZkOSkgewogICAgICBsZXQgaSwgaiwgbDsKICAgICAgc3dpdGNoIChmaWxlTWFya2VyKSB7CiAgICAgICAgY2FzZSAweGZmZTA6CiAgICAgICAgY2FzZSAweGZmZTE6CiAgICAgICAgY2FzZSAweGZmZTI6CiAgICAgICAgY2FzZSAweGZmZTM6CiAgICAgICAgY2FzZSAweGZmZTQ6CiAgICAgICAgY2FzZSAweGZmZTU6CiAgICAgICAgY2FzZSAweGZmZTY6CiAgICAgICAgY2FzZSAweGZmZTc6CiAgICAgICAgY2FzZSAweGZmZTg6CiAgICAgICAgY2FzZSAweGZmZTk6CiAgICAgICAgY2FzZSAweGZmZWE6CiAgICAgICAgY2FzZSAweGZmZWI6CiAgICAgICAgY2FzZSAweGZmZWM6CiAgICAgICAgY2FzZSAweGZmZWQ6CiAgICAgICAgY2FzZSAweGZmZWU6CiAgICAgICAgY2FzZSAweGZmZWY6CiAgICAgICAgY2FzZSAweGZmZmU6CiAgICAgICAgICBjb25zdCBhcHBEYXRhID0gcmVhZERhdGFCbG9jaygpOwogICAgICAgICAgaWYgKGZpbGVNYXJrZXIgPT09IDB4ZmZlMCkgewogICAgICAgICAgICBpZiAoYXBwRGF0YVswXSA9PT0gMHg0YSAmJiBhcHBEYXRhWzFdID09PSAweDQ2ICYmIGFwcERhdGFbMl0gPT09IDB4NDkgJiYgYXBwRGF0YVszXSA9PT0gMHg0NiAmJiBhcHBEYXRhWzRdID09PSAwKSB7CiAgICAgICAgICAgICAgamZpZiA9IHsKICAgICAgICAgICAgICAgIHZlcnNpb246IHsKICAgICAgICAgICAgICAgICAgbWFqb3I6IGFwcERhdGFbNV0sCiAgICAgICAgICAgICAgICAgIG1pbm9yOiBhcHBEYXRhWzZdCiAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgZGVuc2l0eVVuaXRzOiBhcHBEYXRhWzddLAogICAgICAgICAgICAgICAgeERlbnNpdHk6IGFwcERhdGFbOF0gPDwgOCB8IGFwcERhdGFbOV0sCiAgICAgICAgICAgICAgICB5RGVuc2l0eTogYXBwRGF0YVsxMF0gPDwgOCB8IGFwcERhdGFbMTFdLAogICAgICAgICAgICAgICAgdGh1bWJXaWR0aDogYXBwRGF0YVsxMl0sCiAgICAgICAgICAgICAgICB0aHVtYkhlaWdodDogYXBwRGF0YVsxM10sCiAgICAgICAgICAgICAgICB0aHVtYkRhdGE6IGFwcERhdGEuc3ViYXJyYXkoMTQsIDE0ICsgMyAqIGFwcERhdGFbMTJdICogYXBwRGF0YVsxM10pCiAgICAgICAgICAgICAgfTsKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgICAgaWYgKGZpbGVNYXJrZXIgPT09IDB4ZmZlZSkgewogICAgICAgICAgICBpZiAoYXBwRGF0YVswXSA9PT0gMHg0MSAmJiBhcHBEYXRhWzFdID09PSAweDY0ICYmIGFwcERhdGFbMl0gPT09IDB4NmYgJiYgYXBwRGF0YVszXSA9PT0gMHg2MiAmJiBhcHBEYXRhWzRdID09PSAweDY1KSB7CiAgICAgICAgICAgICAgYWRvYmUgPSB7CiAgICAgICAgICAgICAgICB2ZXJzaW9uOiBhcHBEYXRhWzVdIDw8IDggfCBhcHBEYXRhWzZdLAogICAgICAgICAgICAgICAgZmxhZ3MwOiBhcHBEYXRhWzddIDw8IDggfCBhcHBEYXRhWzhdLAogICAgICAgICAgICAgICAgZmxhZ3MxOiBhcHBEYXRhWzldIDw8IDggfCBhcHBEYXRhWzEwXSwKICAgICAgICAgICAgICAgIHRyYW5zZm9ybUNvZGU6IGFwcERhdGFbMTFdCiAgICAgICAgICAgICAgfTsKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgICAgYnJlYWs7CiAgICAgICAgY2FzZSAweGZmZGI6CiAgICAgICAgICBjb25zdCBxdWFudGl6YXRpb25UYWJsZXNMZW5ndGggPSAoMCwgX2NvcmVfdXRpbHMucmVhZFVpbnQxNikoZGF0YSwgb2Zmc2V0KTsKICAgICAgICAgIG9mZnNldCArPSAyOwogICAgICAgICAgY29uc3QgcXVhbnRpemF0aW9uVGFibGVzRW5kID0gcXVhbnRpemF0aW9uVGFibGVzTGVuZ3RoICsgb2Zmc2V0IC0gMjsKICAgICAgICAgIGxldCB6OwogICAgICAgICAgd2hpbGUgKG9mZnNldCA8IHF1YW50aXphdGlvblRhYmxlc0VuZCkgewogICAgICAgICAgICBjb25zdCBxdWFudGl6YXRpb25UYWJsZVNwZWMgPSBkYXRhW29mZnNldCsrXTsKICAgICAgICAgICAgY29uc3QgdGFibGVEYXRhID0gbmV3IFVpbnQxNkFycmF5KDY0KTsKICAgICAgICAgICAgaWYgKHF1YW50aXphdGlvblRhYmxlU3BlYyA+PiA0ID09PSAwKSB7CiAgICAgICAgICAgICAgZm9yIChqID0gMDsgaiA8IDY0OyBqKyspIHsKICAgICAgICAgICAgICAgIHogPSBkY3RaaWdaYWdbal07CiAgICAgICAgICAgICAgICB0YWJsZURhdGFbel0gPSBkYXRhW29mZnNldCsrXTsKICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0gZWxzZSBpZiAocXVhbnRpemF0aW9uVGFibGVTcGVjID4+IDQgPT09IDEpIHsKICAgICAgICAgICAgICBmb3IgKGogPSAwOyBqIDwgNjQ7IGorKykgewogICAgICAgICAgICAgICAgeiA9IGRjdFppZ1phZ1tqXTsKICAgICAgICAgICAgICAgIHRhYmxlRGF0YVt6XSA9ICgwLCBfY29yZV91dGlscy5yZWFkVWludDE2KShkYXRhLCBvZmZzZXQpOwogICAgICAgICAgICAgICAgb2Zmc2V0ICs9IDI7CiAgICAgICAgICAgICAgfQogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgIHRocm93IG5ldyBKcGVnRXJyb3IoIkRRVCAtIGludmFsaWQgdGFibGUgc3BlYyIpOwogICAgICAgICAgICB9CiAgICAgICAgICAgIHF1YW50aXphdGlvblRhYmxlc1txdWFudGl6YXRpb25UYWJsZVNwZWMgJiAxNV0gPSB0YWJsZURhdGE7CiAgICAgICAgICB9CiAgICAgICAgICBicmVhazsKICAgICAgICBjYXNlIDB4ZmZjMDoKICAgICAgICBjYXNlIDB4ZmZjMToKICAgICAgICBjYXNlIDB4ZmZjMjoKICAgICAgICAgIGlmIChmcmFtZSkgewogICAgICAgICAgICB0aHJvdyBuZXcgSnBlZ0Vycm9yKCJPbmx5IHNpbmdsZSBmcmFtZSBKUEVHcyBzdXBwb3J0ZWQiKTsKICAgICAgICAgIH0KICAgICAgICAgIG9mZnNldCArPSAyOwogICAgICAgICAgZnJhbWUgPSB7fTsKICAgICAgICAgIGZyYW1lLmV4dGVuZGVkID0gZmlsZU1hcmtlciA9PT0gMHhmZmMxOwogICAgICAgICAgZnJhbWUucHJvZ3Jlc3NpdmUgPSBmaWxlTWFya2VyID09PSAweGZmYzI7CiAgICAgICAgICBmcmFtZS5wcmVjaXNpb24gPSBkYXRhW29mZnNldCsrXTsKICAgICAgICAgIGNvbnN0IHNvZlNjYW5MaW5lcyA9ICgwLCBfY29yZV91dGlscy5yZWFkVWludDE2KShkYXRhLCBvZmZzZXQpOwogICAgICAgICAgb2Zmc2V0ICs9IDI7CiAgICAgICAgICBmcmFtZS5zY2FuTGluZXMgPSBkbmxTY2FuTGluZXMgfHwgc29mU2NhbkxpbmVzOwogICAgICAgICAgZnJhbWUuc2FtcGxlc1BlckxpbmUgPSAoMCwgX2NvcmVfdXRpbHMucmVhZFVpbnQxNikoZGF0YSwgb2Zmc2V0KTsKICAgICAgICAgIG9mZnNldCArPSAyOwogICAgICAgICAgZnJhbWUuY29tcG9uZW50cyA9IFtdOwogICAgICAgICAgZnJhbWUuY29tcG9uZW50SWRzID0ge307CiAgICAgICAgICBjb25zdCBjb21wb25lbnRzQ291bnQgPSBkYXRhW29mZnNldCsrXTsKICAgICAgICAgIGxldCBtYXhIID0gMCwKICAgICAgICAgICAgbWF4ViA9IDA7CiAgICAgICAgICBmb3IgKGkgPSAwOyBpIDwgY29tcG9uZW50c0NvdW50OyBpKyspIHsKICAgICAgICAgICAgY29uc3QgY29tcG9uZW50SWQgPSBkYXRhW29mZnNldF07CiAgICAgICAgICAgIGNvbnN0IGggPSBkYXRhW29mZnNldCArIDFdID4+IDQ7CiAgICAgICAgICAgIGNvbnN0IHYgPSBkYXRhW29mZnNldCArIDFdICYgMTU7CiAgICAgICAgICAgIGlmIChtYXhIIDwgaCkgewogICAgICAgICAgICAgIG1heEggPSBoOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGlmIChtYXhWIDwgdikgewogICAgICAgICAgICAgIG1heFYgPSB2OwogICAgICAgICAgICB9CiAgICAgICAgICAgIGNvbnN0IHFJZCA9IGRhdGFbb2Zmc2V0ICsgMl07CiAgICAgICAgICAgIGwgPSBmcmFtZS5jb21wb25lbnRzLnB1c2goewogICAgICAgICAgICAgIGgsCiAgICAgICAgICAgICAgdiwKICAgICAgICAgICAgICBxdWFudGl6YXRpb25JZDogcUlkLAogICAgICAgICAgICAgIHF1YW50aXphdGlvblRhYmxlOiBudWxsCiAgICAgICAgICAgIH0pOwogICAgICAgICAgICBmcmFtZS5jb21wb25lbnRJZHNbY29tcG9uZW50SWRdID0gbCAtIDE7CiAgICAgICAgICAgIG9mZnNldCArPSAzOwogICAgICAgICAgfQogICAgICAgICAgZnJhbWUubWF4SCA9IG1heEg7CiAgICAgICAgICBmcmFtZS5tYXhWID0gbWF4VjsKICAgICAgICAgIHByZXBhcmVDb21wb25lbnRzKGZyYW1lKTsKICAgICAgICAgIGJyZWFrOwogICAgICAgIGNhc2UgMHhmZmM0OgogICAgICAgICAgY29uc3QgaHVmZm1hbkxlbmd0aCA9ICgwLCBfY29yZV91dGlscy5yZWFkVWludDE2KShkYXRhLCBvZmZzZXQpOwogICAgICAgICAgb2Zmc2V0ICs9IDI7CiAgICAgICAgICBmb3IgKGkgPSAyOyBpIDwgaHVmZm1hbkxlbmd0aDspIHsKICAgICAgICAgICAgY29uc3QgaHVmZm1hblRhYmxlU3BlYyA9IGRhdGFbb2Zmc2V0KytdOwogICAgICAgICAgICBjb25zdCBjb2RlTGVuZ3RocyA9IG5ldyBVaW50OEFycmF5KDE2KTsKICAgICAgICAgICAgbGV0IGNvZGVMZW5ndGhTdW0gPSAwOwogICAgICAgICAgICBmb3IgKGogPSAwOyBqIDwgMTY7IGorKywgb2Zmc2V0KyspIHsKICAgICAgICAgICAgICBjb2RlTGVuZ3RoU3VtICs9IGNvZGVMZW5ndGhzW2pdID0gZGF0YVtvZmZzZXRdOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGNvbnN0IGh1ZmZtYW5WYWx1ZXMgPSBuZXcgVWludDhBcnJheShjb2RlTGVuZ3RoU3VtKTsKICAgICAgICAgICAgZm9yIChqID0gMDsgaiA8IGNvZGVMZW5ndGhTdW07IGorKywgb2Zmc2V0KyspIHsKICAgICAgICAgICAgICBodWZmbWFuVmFsdWVzW2pdID0gZGF0YVtvZmZzZXRdOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGkgKz0gMTcgKyBjb2RlTGVuZ3RoU3VtOwogICAgICAgICAgICAoaHVmZm1hblRhYmxlU3BlYyA+PiA0ID09PSAwID8gaHVmZm1hblRhYmxlc0RDIDogaHVmZm1hblRhYmxlc0FDKVtodWZmbWFuVGFibGVTcGVjICYgMTVdID0gYnVpbGRIdWZmbWFuVGFibGUoY29kZUxlbmd0aHMsIGh1ZmZtYW5WYWx1ZXMpOwogICAgICAgICAgfQogICAgICAgICAgYnJlYWs7CiAgICAgICAgY2FzZSAweGZmZGQ6CiAgICAgICAgICBvZmZzZXQgKz0gMjsKICAgICAgICAgIHJlc2V0SW50ZXJ2YWwgPSAoMCwgX2NvcmVfdXRpbHMucmVhZFVpbnQxNikoZGF0YSwgb2Zmc2V0KTsKICAgICAgICAgIG9mZnNldCArPSAyOwogICAgICAgICAgYnJlYWs7CiAgICAgICAgY2FzZSAweGZmZGE6CiAgICAgICAgICBjb25zdCBwYXJzZUROTE1hcmtlciA9ICsrbnVtU09TTWFya2VycyA9PT0gMSAmJiAhZG5sU2NhbkxpbmVzOwogICAgICAgICAgb2Zmc2V0ICs9IDI7CiAgICAgICAgICBjb25zdCBzZWxlY3RvcnNDb3VudCA9IGRhdGFbb2Zmc2V0KytdLAogICAgICAgICAgICBjb21wb25lbnRzID0gW107CiAgICAgICAgICBmb3IgKGkgPSAwOyBpIDwgc2VsZWN0b3JzQ291bnQ7IGkrKykgewogICAgICAgICAgICBjb25zdCBpbmRleCA9IGRhdGFbb2Zmc2V0KytdOwogICAgICAgICAgICBjb25zdCBjb21wb25lbnRJbmRleCA9IGZyYW1lLmNvbXBvbmVudElkc1tpbmRleF07CiAgICAgICAgICAgIGNvbnN0IGNvbXBvbmVudCA9IGZyYW1lLmNvbXBvbmVudHNbY29tcG9uZW50SW5kZXhdOwogICAgICAgICAgICBjb21wb25lbnQuaW5kZXggPSBpbmRleDsKICAgICAgICAgICAgY29uc3QgdGFibGVTcGVjID0gZGF0YVtvZmZzZXQrK107CiAgICAgICAgICAgIGNvbXBvbmVudC5odWZmbWFuVGFibGVEQyA9IGh1ZmZtYW5UYWJsZXNEQ1t0YWJsZVNwZWMgPj4gNF07CiAgICAgICAgICAgIGNvbXBvbmVudC5odWZmbWFuVGFibGVBQyA9IGh1ZmZtYW5UYWJsZXNBQ1t0YWJsZVNwZWMgJiAxNV07CiAgICAgICAgICAgIGNvbXBvbmVudHMucHVzaChjb21wb25lbnQpOwogICAgICAgICAgfQogICAgICAgICAgY29uc3Qgc3BlY3RyYWxTdGFydCA9IGRhdGFbb2Zmc2V0KytdLAogICAgICAgICAgICBzcGVjdHJhbEVuZCA9IGRhdGFbb2Zmc2V0KytdLAogICAgICAgICAgICBzdWNjZXNzaXZlQXBwcm94aW1hdGlvbiA9IGRhdGFbb2Zmc2V0KytdOwogICAgICAgICAgdHJ5IHsKICAgICAgICAgICAgY29uc3QgcHJvY2Vzc2VkID0gZGVjb2RlU2NhbihkYXRhLCBvZmZzZXQsIGZyYW1lLCBjb21wb25lbnRzLCByZXNldEludGVydmFsLCBzcGVjdHJhbFN0YXJ0LCBzcGVjdHJhbEVuZCwgc3VjY2Vzc2l2ZUFwcHJveGltYXRpb24gPj4gNCwgc3VjY2Vzc2l2ZUFwcHJveGltYXRpb24gJiAxNSwgcGFyc2VETkxNYXJrZXIpOwogICAgICAgICAgICBvZmZzZXQgKz0gcHJvY2Vzc2VkOwogICAgICAgICAgfSBjYXRjaCAoZXgpIHsKICAgICAgICAgICAgaWYgKGV4IGluc3RhbmNlb2YgRE5MTWFya2VyRXJyb3IpIHsKICAgICAgICAgICAgICAoMCwgX3V0aWwud2FybikoYCR7ZXgubWVzc2FnZX0gLS0gYXR0ZW1wdGluZyB0byByZS1wYXJzZSB0aGUgSlBFRyBpbWFnZS5gKTsKICAgICAgICAgICAgICByZXR1cm4gdGhpcy5wYXJzZShkYXRhLCB7CiAgICAgICAgICAgICAgICBkbmxTY2FuTGluZXM6IGV4LnNjYW5MaW5lcwogICAgICAgICAgICAgIH0pOwogICAgICAgICAgICB9IGVsc2UgaWYgKGV4IGluc3RhbmNlb2YgRU9JTWFya2VyRXJyb3IpIHsKICAgICAgICAgICAgICAoMCwgX3V0aWwud2FybikoYCR7ZXgubWVzc2FnZX0gLS0gaWdub3JpbmcgdGhlIHJlc3Qgb2YgdGhlIGltYWdlIGRhdGEuYCk7CiAgICAgICAgICAgICAgYnJlYWsgbWFya2VyTG9vcDsKICAgICAgICAgICAgfQogICAgICAgICAgICB0aHJvdyBleDsKICAgICAgICAgIH0KICAgICAgICAgIGJyZWFrOwogICAgICAgIGNhc2UgMHhmZmRjOgogICAgICAgICAgb2Zmc2V0ICs9IDQ7CiAgICAgICAgICBicmVhazsKICAgICAgICBjYXNlIDB4ZmZmZjoKICAgICAgICAgIGlmIChkYXRhW29mZnNldF0gIT09IDB4ZmYpIHsKICAgICAgICAgICAgb2Zmc2V0LS07CiAgICAgICAgICB9CiAgICAgICAgICBicmVhazsKICAgICAgICBkZWZhdWx0OgogICAgICAgICAgY29uc3QgbmV4dEZpbGVNYXJrZXIgPSBmaW5kTmV4dEZpbGVNYXJrZXIoZGF0YSwgb2Zmc2V0IC0gMiwgb2Zmc2V0IC0gMyk7CiAgICAgICAgICBpZiAobmV4dEZpbGVNYXJrZXI/LmludmFsaWQpIHsKICAgICAgICAgICAgKDAsIF91dGlsLndhcm4pKCJKcGVnSW1hZ2UucGFyc2UgLSB1bmV4cGVjdGVkIGRhdGEsIGN1cnJlbnQgbWFya2VyIGlzOiAiICsgbmV4dEZpbGVNYXJrZXIuaW52YWxpZCk7CiAgICAgICAgICAgIG9mZnNldCA9IG5leHRGaWxlTWFya2VyLm9mZnNldDsKICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICB9CiAgICAgICAgICBpZiAoIW5leHRGaWxlTWFya2VyIHx8IG9mZnNldCA+PSBkYXRhLmxlbmd0aCAtIDEpIHsKICAgICAgICAgICAgKDAsIF91dGlsLndhcm4pKCJKcGVnSW1hZ2UucGFyc2UgLSByZWFjaGVkIHRoZSBlbmQgb2YgdGhlIGltYWdlIGRhdGEgIiArICJ3aXRob3V0IGZpbmRpbmcgYW4gRU9JIG1hcmtlciAoMHhGRkQ5KS4iKTsKICAgICAgICAgICAgYnJlYWsgbWFya2VyTG9vcDsKICAgICAgICAgIH0KICAgICAgICAgIHRocm93IG5ldyBKcGVnRXJyb3IoIkpwZWdJbWFnZS5wYXJzZSAtIHVua25vd24gbWFya2VyOiAiICsgZmlsZU1hcmtlci50b1N0cmluZygxNikpOwogICAgICB9CiAgICAgIGZpbGVNYXJrZXIgPSAoMCwgX2NvcmVfdXRpbHMucmVhZFVpbnQxNikoZGF0YSwgb2Zmc2V0KTsKICAgICAgb2Zmc2V0ICs9IDI7CiAgICB9CiAgICB0aGlzLndpZHRoID0gZnJhbWUuc2FtcGxlc1BlckxpbmU7CiAgICB0aGlzLmhlaWdodCA9IGZyYW1lLnNjYW5MaW5lczsKICAgIHRoaXMuamZpZiA9IGpmaWY7CiAgICB0aGlzLmFkb2JlID0gYWRvYmU7CiAgICB0aGlzLmNvbXBvbmVudHMgPSBbXTsKICAgIGZvciAoY29uc3QgY29tcG9uZW50IG9mIGZyYW1lLmNvbXBvbmVudHMpIHsKICAgICAgY29uc3QgcXVhbnRpemF0aW9uVGFibGUgPSBxdWFudGl6YXRpb25UYWJsZXNbY29tcG9uZW50LnF1YW50aXphdGlvbklkXTsKICAgICAgaWYgKHF1YW50aXphdGlvblRhYmxlKSB7CiAgICAgICAgY29tcG9uZW50LnF1YW50aXphdGlvblRhYmxlID0gcXVhbnRpemF0aW9uVGFibGU7CiAgICAgIH0KICAgICAgdGhpcy5jb21wb25lbnRzLnB1c2goewogICAgICAgIGluZGV4OiBjb21wb25lbnQuaW5kZXgsCiAgICAgICAgb3V0cHV0OiBidWlsZENvbXBvbmVudERhdGEoZnJhbWUsIGNvbXBvbmVudCksCiAgICAgICAgc2NhbGVYOiBjb21wb25lbnQuaCAvIGZyYW1lLm1heEgsCiAgICAgICAgc2NhbGVZOiBjb21wb25lbnQudiAvIGZyYW1lLm1heFYsCiAgICAgICAgYmxvY2tzUGVyTGluZTogY29tcG9uZW50LmJsb2Nrc1BlckxpbmUsCiAgICAgICAgYmxvY2tzUGVyQ29sdW1uOiBjb21wb25lbnQuYmxvY2tzUGVyQ29sdW1uCiAgICAgIH0pOwogICAgfQogICAgdGhpcy5udW1Db21wb25lbnRzID0gdGhpcy5jb21wb25lbnRzLmxlbmd0aDsKICAgIHJldHVybiB1bmRlZmluZWQ7CiAgfQogIF9nZXRMaW5lYXJpemVkQmxvY2tEYXRhKHdpZHRoLCBoZWlnaHQsIGlzU291cmNlUERGID0gZmFsc2UpIHsKICAgIGNvbnN0IHNjYWxlWCA9IHRoaXMud2lkdGggLyB3aWR0aCwKICAgICAgc2NhbGVZID0gdGhpcy5oZWlnaHQgLyBoZWlnaHQ7CiAgICBsZXQgY29tcG9uZW50LCBjb21wb25lbnRTY2FsZVgsIGNvbXBvbmVudFNjYWxlWSwgYmxvY2tzUGVyU2NhbmxpbmU7CiAgICBsZXQgeCwgeSwgaSwgaiwgazsKICAgIGxldCBpbmRleDsKICAgIGxldCBvZmZzZXQgPSAwOwogICAgbGV0IG91dHB1dDsKICAgIGNvbnN0IG51bUNvbXBvbmVudHMgPSB0aGlzLmNvbXBvbmVudHMubGVuZ3RoOwogICAgY29uc3QgZGF0YUxlbmd0aCA9IHdpZHRoICogaGVpZ2h0ICogbnVtQ29tcG9uZW50czsKICAgIGNvbnN0IGRhdGEgPSBuZXcgVWludDhDbGFtcGVkQXJyYXkoZGF0YUxlbmd0aCk7CiAgICBjb25zdCB4U2NhbGVCbG9ja09mZnNldCA9IG5ldyBVaW50MzJBcnJheSh3aWR0aCk7CiAgICBjb25zdCBtYXNrM0xTQiA9IDB4ZmZmZmZmZjg7CiAgICBsZXQgbGFzdENvbXBvbmVudFNjYWxlWDsKICAgIGZvciAoaSA9IDA7IGkgPCBudW1Db21wb25lbnRzOyBpKyspIHsKICAgICAgY29tcG9uZW50ID0gdGhpcy5jb21wb25lbnRzW2ldOwogICAgICBjb21wb25lbnRTY2FsZVggPSBjb21wb25lbnQuc2NhbGVYICogc2NhbGVYOwogICAgICBjb21wb25lbnRTY2FsZVkgPSBjb21wb25lbnQuc2NhbGVZICogc2NhbGVZOwogICAgICBvZmZzZXQgPSBpOwogICAgICBvdXRwdXQgPSBjb21wb25lbnQub3V0cHV0OwogICAgICBibG9ja3NQZXJTY2FubGluZSA9IGNvbXBvbmVudC5ibG9ja3NQZXJMaW5lICsgMSA8PCAzOwogICAgICBpZiAoY29tcG9uZW50U2NhbGVYICE9PSBsYXN0Q29tcG9uZW50U2NhbGVYKSB7CiAgICAgICAgZm9yICh4ID0gMDsgeCA8IHdpZHRoOyB4KyspIHsKICAgICAgICAgIGogPSAwIHwgeCAqIGNvbXBvbmVudFNjYWxlWDsKICAgICAgICAgIHhTY2FsZUJsb2NrT2Zmc2V0W3hdID0gKGogJiBtYXNrM0xTQikgPDwgMyB8IGogJiA3OwogICAgICAgIH0KICAgICAgICBsYXN0Q29tcG9uZW50U2NhbGVYID0gY29tcG9uZW50U2NhbGVYOwogICAgICB9CiAgICAgIGZvciAoeSA9IDA7IHkgPCBoZWlnaHQ7IHkrKykgewogICAgICAgIGogPSAwIHwgeSAqIGNvbXBvbmVudFNjYWxlWTsKICAgICAgICBpbmRleCA9IGJsb2Nrc1BlclNjYW5saW5lICogKGogJiBtYXNrM0xTQikgfCAoaiAmIDcpIDw8IDM7CiAgICAgICAgZm9yICh4ID0gMDsgeCA8IHdpZHRoOyB4KyspIHsKICAgICAgICAgIGRhdGFbb2Zmc2V0XSA9IG91dHB1dFtpbmRleCArIHhTY2FsZUJsb2NrT2Zmc2V0W3hdXTsKICAgICAgICAgIG9mZnNldCArPSBudW1Db21wb25lbnRzOwogICAgICAgIH0KICAgICAgfQogICAgfQogICAgbGV0IHRyYW5zZm9ybSA9IHRoaXMuX2RlY29kZVRyYW5zZm9ybTsKICAgIGlmICghaXNTb3VyY2VQREYgJiYgbnVtQ29tcG9uZW50cyA9PT0gNCAmJiAhdHJhbnNmb3JtKSB7CiAgICAgIHRyYW5zZm9ybSA9IG5ldyBJbnQzMkFycmF5KFstMjU2LCAyNTUsIC0yNTYsIDI1NSwgLTI1NiwgMjU1LCAtMjU2LCAyNTVdKTsKICAgIH0KICAgIGlmICh0cmFuc2Zvcm0pIHsKICAgICAgZm9yIChpID0gMDsgaSA8IGRhdGFMZW5ndGg7KSB7CiAgICAgICAgZm9yIChqID0gMCwgayA9IDA7IGogPCBudW1Db21wb25lbnRzOyBqKyssIGkrKywgayArPSAyKSB7CiAgICAgICAgICBkYXRhW2ldID0gKGRhdGFbaV0gKiB0cmFuc2Zvcm1ba10gPj4gOCkgKyB0cmFuc2Zvcm1bayArIDFdOwogICAgICAgIH0KICAgICAgfQogICAgfQogICAgcmV0dXJuIGRhdGE7CiAgfQogIGdldCBfaXNDb2xvckNvbnZlcnNpb25OZWVkZWQoKSB7CiAgICBpZiAodGhpcy5hZG9iZSkgewogICAgICByZXR1cm4gISF0aGlzLmFkb2JlLnRyYW5zZm9ybUNvZGU7CiAgICB9CiAgICBpZiAodGhpcy5udW1Db21wb25lbnRzID09PSAzKSB7CiAgICAgIGlmICh0aGlzLl9jb2xvclRyYW5zZm9ybSA9PT0gMCkgewogICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgfSBlbHNlIGlmICh0aGlzLmNvbXBvbmVudHNbMF0uaW5kZXggPT09IDB4NTIgJiYgdGhpcy5jb21wb25lbnRzWzFdLmluZGV4ID09PSAweDQ3ICYmIHRoaXMuY29tcG9uZW50c1syXS5pbmRleCA9PT0gMHg0MikgewogICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgfQogICAgICByZXR1cm4gdHJ1ZTsKICAgIH0KICAgIGlmICh0aGlzLl9jb2xvclRyYW5zZm9ybSA9PT0gMSkgewogICAgICByZXR1cm4gdHJ1ZTsKICAgIH0KICAgIHJldHVybiBmYWxzZTsKICB9CiAgX2NvbnZlcnRZY2NUb1JnYihkYXRhKSB7CiAgICBsZXQgWSwgQ2IsIENyOwogICAgZm9yIChsZXQgaSA9IDAsIGxlbmd0aCA9IGRhdGEubGVuZ3RoOyBpIDwgbGVuZ3RoOyBpICs9IDMpIHsKICAgICAgWSA9IGRhdGFbaV07CiAgICAgIENiID0gZGF0YVtpICsgMV07CiAgICAgIENyID0gZGF0YVtpICsgMl07CiAgICAgIGRhdGFbaV0gPSBZIC0gMTc5LjQ1NiArIDEuNDAyICogQ3I7CiAgICAgIGRhdGFbaSArIDFdID0gWSArIDEzNS40NTkgLSAwLjM0NCAqIENiIC0gMC43MTQgKiBDcjsKICAgICAgZGF0YVtpICsgMl0gPSBZIC0gMjI2LjgxNiArIDEuNzcyICogQ2I7CiAgICB9CiAgICByZXR1cm4gZGF0YTsKICB9CiAgX2NvbnZlcnRZY2NUb1JnYmEoZGF0YSwgb3V0KSB7CiAgICBmb3IgKGxldCBpID0gMCwgaiA9IDAsIGxlbmd0aCA9IGRhdGEubGVuZ3RoOyBpIDwgbGVuZ3RoOyBpICs9IDMsIGogKz0gNCkgewogICAgICBjb25zdCBZID0gZGF0YVtpXTsKICAgICAgY29uc3QgQ2IgPSBkYXRhW2kgKyAxXTsKICAgICAgY29uc3QgQ3IgPSBkYXRhW2kgKyAyXTsKICAgICAgb3V0W2pdID0gWSAtIDE3OS40NTYgKyAxLjQwMiAqIENyOwogICAgICBvdXRbaiArIDFdID0gWSArIDEzNS40NTkgLSAwLjM0NCAqIENiIC0gMC43MTQgKiBDcjsKICAgICAgb3V0W2ogKyAyXSA9IFkgLSAyMjYuODE2ICsgMS43NzIgKiBDYjsKICAgICAgb3V0W2ogKyAzXSA9IDI1NTsKICAgIH0KICAgIHJldHVybiBvdXQ7CiAgfQogIF9jb252ZXJ0WWNja1RvUmdiKGRhdGEpIHsKICAgIGxldCBZLCBDYiwgQ3IsIGs7CiAgICBsZXQgb2Zmc2V0ID0gMDsKICAgIGZvciAobGV0IGkgPSAwLCBsZW5ndGggPSBkYXRhLmxlbmd0aDsgaSA8IGxlbmd0aDsgaSArPSA0KSB7CiAgICAgIFkgPSBkYXRhW2ldOwogICAgICBDYiA9IGRhdGFbaSArIDFdOwogICAgICBDciA9IGRhdGFbaSArIDJdOwogICAgICBrID0gZGF0YVtpICsgM107CiAgICAgIGRhdGFbb2Zmc2V0KytdID0gLTEyMi42NzE5NTQwNjg5NCArIENiICogKC02LjYwNjM1NjY5NDIwMzY0ZS01ICogQ2IgKyAwLjAwMDQzNzEzMDQ3NTkyNjIzMiAqIENyIC0gNS40MDgwNjEwMDY0NTk5ZS01ICogWSArIDAuMDAwNDg0NDk3OTcxMjAyODEgKiBrIC0gMC4xNTQzNjIxNTE4NzExMjYpICsgQ3IgKiAoLTAuMDAwOTU3OTY0Mzc4NDQ1NzczICogQ3IgKyAwLjAwMDgxNzA3NjkxMTM0NjYyNSAqIFkgLSAwLjAwNDc3MjcxNDA1NDA4NzQ3ICogayArIDEuNTMzODAyNTMyMjE3MzQpICsgWSAqICgwLjAwMDk2MTI1MDE4NDEzMDY4OCAqIFkgLSAwLjAwMjY2MjU3MzMyMjgzOTMzICogayArIDAuNDgzNTcwODg0NTEyNjUpICsgayAqICgtMC4wMDAzMzYxOTcxNzc2MTgzOTQgKiBrICsgMC40ODQ3OTE1NjE0OTA3NzYpOwogICAgICBkYXRhW29mZnNldCsrXSA9IDEwNy4yNjgwMzkzOTc3MjQgKyBDYiAqICgyLjE5OTI3MTA0NTI1NzQxZS01ICogQ2IgLSAwLjAwMDY0MDk5MjAxODI5Nzk0NSAqIENyICsgMC4wMDA2NTkzOTcwMDEyNDU1NzcgKiBZICsgMC4wMDA0MjYxMDU2NTI5Mzg4MzcgKiBrIC0gMC4xNzY0OTE3OTI0NjI4NzUpICsgQ3IgKiAoLTAuMDAwNzc4MjY5OTQxNTEzNjgzICogQ3IgKyAwLjAwMTMwODcyMjYxNDA4Mjc1ICogWSArIDAuMDAwNzcwNDgyNjMxODAxMTMyICogayAtIDAuMTUxMDUxNDkyNzc1NTYyKSArIFkgKiAoMC4wMDEyNjkzNTM2ODExNDg0MyAqIFkgLSAwLjAwMjY1MDkwMTg5MDEwODk4ICogayArIDAuMjU4MDI5MTAyMDY4NDUpICsgayAqICgtMC4wMDAzMTg5MTMxMTc1ODgzMjggKiBrIC0gMC4yMTM3NDI0MDAzMjM2NjUpOwogICAgICBkYXRhW29mZnNldCsrXSA9IC0yMC44MTAwMTI1NDY5NDcgKyBDYiAqICgtMC4wMDA1NzAxMTUxOTY5NzM2NzcgKiBDYiAtIDIuNjM0MDkwNTEwMDQ1ODllLTUgKiBDciArIDAuMDAyMDc0MTA4ODExNTAxMiAqIFkgLSAwLjAwMjg4MjYwMjM2ODUzNDQyICogayArIDAuODE0MjcyOTY4MzU5Mjk1KSArIENyICogKC0xLjUzNDk2MDU3NDQwOTc1ZS01ICogQ3IgLSAwLjAwMDEzMjY4OTA0Mzk2MTQ0NiAqIFkgKyAwLjAwMDU2MDgzMzY5MTI0MjgxMiAqIGsgLSAwLjE5NTE1MjAyNzUzNDA0OSkgKyBZICogKDAuMDAxNzQ0MTgxMzI5Mjc1ODIgKiBZIC0gMC4wMDI1NTI0MzMyMTQzOTM0NyAqIGsgKyAwLjExNjkzNTAyMDQ2NTE0NSkgKyBrICogKC0wLjAwMDM0MzUzMTk5NjUxMDU1NSAqIGsgKyAwLjI0MTY1MjYwMjMyNDA3KTsKICAgIH0KICAgIHJldHVybiBkYXRhLnN1YmFycmF5KDAsIG9mZnNldCk7CiAgfQogIF9jb252ZXJ0WWNja1RvUmdiYShkYXRhKSB7CiAgICBmb3IgKGxldCBpID0gMCwgbGVuZ3RoID0gZGF0YS5sZW5ndGg7IGkgPCBsZW5ndGg7IGkgKz0gNCkgewogICAgICBjb25zdCBZID0gZGF0YVtpXTsKICAgICAgY29uc3QgQ2IgPSBkYXRhW2kgKyAxXTsKICAgICAgY29uc3QgQ3IgPSBkYXRhW2kgKyAyXTsKICAgICAgY29uc3QgayA9IGRhdGFbaSArIDNdOwogICAgICBkYXRhW2ldID0gLTEyMi42NzE5NTQwNjg5NCArIENiICogKC02LjYwNjM1NjY5NDIwMzY0ZS01ICogQ2IgKyAwLjAwMDQzNzEzMDQ3NTkyNjIzMiAqIENyIC0gNS40MDgwNjEwMDY0NTk5ZS01ICogWSArIDAuMDAwNDg0NDk3OTcxMjAyODEgKiBrIC0gMC4xNTQzNjIxNTE4NzExMjYpICsgQ3IgKiAoLTAuMDAwOTU3OTY0Mzc4NDQ1NzczICogQ3IgKyAwLjAwMDgxNzA3NjkxMTM0NjYyNSAqIFkgLSAwLjAwNDc3MjcxNDA1NDA4NzQ3ICogayArIDEuNTMzODAyNTMyMjE3MzQpICsgWSAqICgwLjAwMDk2MTI1MDE4NDEzMDY4OCAqIFkgLSAwLjAwMjY2MjU3MzMyMjgzOTMzICogayArIDAuNDgzNTcwODg0NTEyNjUpICsgayAqICgtMC4wMDAzMzYxOTcxNzc2MTgzOTQgKiBrICsgMC40ODQ3OTE1NjE0OTA3NzYpOwogICAgICBkYXRhW2kgKyAxXSA9IDEwNy4yNjgwMzkzOTc3MjQgKyBDYiAqICgyLjE5OTI3MTA0NTI1NzQxZS01ICogQ2IgLSAwLjAwMDY0MDk5MjAxODI5Nzk0NSAqIENyICsgMC4wMDA2NTkzOTcwMDEyNDU1NzcgKiBZICsgMC4wMDA0MjYxMDU2NTI5Mzg4MzcgKiBrIC0gMC4xNzY0OTE3OTI0NjI4NzUpICsgQ3IgKiAoLTAuMDAwNzc4MjY5OTQxNTEzNjgzICogQ3IgKyAwLjAwMTMwODcyMjYxNDA4Mjc1ICogWSArIDAuMDAwNzcwNDgyNjMxODAxMTMyICogayAtIDAuMTUxMDUxNDkyNzc1NTYyKSArIFkgKiAoMC4wMDEyNjkzNTM2ODExNDg0MyAqIFkgLSAwLjAwMjY1MDkwMTg5MDEwODk4ICogayArIDAuMjU4MDI5MTAyMDY4NDUpICsgayAqICgtMC4wMDAzMTg5MTMxMTc1ODgzMjggKiBrIC0gMC4yMTM3NDI0MDAzMjM2NjUpOwogICAgICBkYXRhW2kgKyAyXSA9IC0yMC44MTAwMTI1NDY5NDcgKyBDYiAqICgtMC4wMDA1NzAxMTUxOTY5NzM2NzcgKiBDYiAtIDIuNjM0MDkwNTEwMDQ1ODllLTUgKiBDciArIDAuMDAyMDc0MTA4ODExNTAxMiAqIFkgLSAwLjAwMjg4MjYwMjM2ODUzNDQyICogayArIDAuODE0MjcyOTY4MzU5Mjk1KSArIENyICogKC0xLjUzNDk2MDU3NDQwOTc1ZS01ICogQ3IgLSAwLjAwMDEzMjY4OTA0Mzk2MTQ0NiAqIFkgKyAwLjAwMDU2MDgzMzY5MTI0MjgxMiAqIGsgLSAwLjE5NTE1MjAyNzUzNDA0OSkgKyBZICogKDAuMDAxNzQ0MTgxMzI5Mjc1ODIgKiBZIC0gMC4wMDI1NTI0MzMyMTQzOTM0NyAqIGsgKyAwLjExNjkzNTAyMDQ2NTE0NSkgKyBrICogKC0wLjAwMDM0MzUzMTk5NjUxMDU1NSAqIGsgKyAwLjI0MTY1MjYwMjMyNDA3KTsKICAgICAgZGF0YVtpICsgM10gPSAyNTU7CiAgICB9CiAgICByZXR1cm4gZGF0YTsKICB9CiAgX2NvbnZlcnRZY2NrVG9DbXlrKGRhdGEpIHsKICAgIGxldCBZLCBDYiwgQ3I7CiAgICBmb3IgKGxldCBpID0gMCwgbGVuZ3RoID0gZGF0YS5sZW5ndGg7IGkgPCBsZW5ndGg7IGkgKz0gNCkgewogICAgICBZID0gZGF0YVtpXTsKICAgICAgQ2IgPSBkYXRhW2kgKyAxXTsKICAgICAgQ3IgPSBkYXRhW2kgKyAyXTsKICAgICAgZGF0YVtpXSA9IDQzNC40NTYgLSBZIC0gMS40MDIgKiBDcjsKICAgICAgZGF0YVtpICsgMV0gPSAxMTkuNTQxIC0gWSArIDAuMzQ0ICogQ2IgKyAwLjcxNCAqIENyOwogICAgICBkYXRhW2kgKyAyXSA9IDQ4MS44MTYgLSBZIC0gMS43NzIgKiBDYjsKICAgIH0KICAgIHJldHVybiBkYXRhOwogIH0KICBfY29udmVydENteWtUb1JnYihkYXRhKSB7CiAgICBsZXQgYywgbSwgeSwgazsKICAgIGxldCBvZmZzZXQgPSAwOwogICAgZm9yIChsZXQgaSA9IDAsIGxlbmd0aCA9IGRhdGEubGVuZ3RoOyBpIDwgbGVuZ3RoOyBpICs9IDQpIHsKICAgICAgYyA9IGRhdGFbaV07CiAgICAgIG0gPSBkYXRhW2kgKyAxXTsKICAgICAgeSA9IGRhdGFbaSArIDJdOwogICAgICBrID0gZGF0YVtpICsgM107CiAgICAgIGRhdGFbb2Zmc2V0KytdID0gMjU1ICsgYyAqICgtMC4wMDAwNjc0NzE0NzA3MzYwMjQ0MSAqIGMgKyAwLjAwMDgzNzkyNjIxMjEwMTM3MjcgKiBtICsgMC4wMDAyODk0NzE4MTg4NjQzMjk0ICogeSArIDAuMDAzMjY0MjMxMDU3NTM3ODA2ICogayAtIDEuMTE4NTYxMTg2NzIwMzkzNykgKyBtICogKDAuMDAwMDI2Mzc0MTA3NjE2MDg5NDA1ICogbSAtIDAuMDAwMDg2MjY5NDkxNTg2Mzg1NzIgKiB5IC0gMC4wMDAyNzQ4NzY5MDY3NDk5NDkxICogayAtIDAuMDIxNTU2ODg3OTQ5Nzg5NjcpICsgeSAqICgtMC4wMDAwMzg3ODA5OTIxMjg2OTM2MyAqIHkgLSAwLjAwMDMyNjc4MDgyNzk0ODUyODYgKiBrICsgMC4wNjg2NzQyMjM4NTk1MzQ1KSAtIGsgKiAoMC4wMDAzMzYxOTcxNzc2MTgzOTM3ICogayArIDAuNzQzMDY1OTE1MTM0MjI1NCk7CiAgICAgIGRhdGFbb2Zmc2V0KytdID0gMjU1ICsgYyAqICgwLjAwMDEzNTk2MzcyODEzNTg4ODQ4ICogYyArIDAuMDAwOTI0NTM3MTMyNTczNTg1ICogbSArIDAuMDAwMTA1NjczNTk2MTg2ODM1OTMgKiB5ICsgMC4wMDA0NzkxODY0Njg3NDM2NTEyICogayAtIDAuMzEwOTY4OTU4NzUxNTg3NSkgKyBtICogKC0wLjAwMDIzNTQ1MzQ2MTA4MzcwMzQ0ICogbSArIDAuMDAwMjcwMjg0NTI1MzUzNDcxNCAqIHkgKyAwLjAwMjAyMDAzMDg5NzczMDcxNTYgKiBrIC0gMC43NDg4MDUyMTY3MDE1NDk0KSArIHkgKiAoMC4wMDAwNjgzNDgxNTk5ODIzNTY2MiAqIHkgKyAwLjAwMDE1MTY4NDUyMzYzNDYwOTczICogayAtIDAuMDk3NTE5Mjc3NzQ3Mjg5MzMpIC0gayAqICgwLjAwMDMxODkxMzExNzU4ODMyODEgKiBrICsgMC43MzY0ODgzODA3NzMzMTY4KTsKICAgICAgZGF0YVtvZmZzZXQrK10gPSAyNTUgKyBjICogKDAuMDAwMDEzNTk4NjUwNDExMzg1MzA3ICogYyArIDAuMDAwMTI0MjM5NTYxNzU0OTA4NTEgKiBtICsgMC4wMDA0NzUxOTg1MDk3NTgzNTg5ICogeSAtIDAuMDAwMDAzNjcyOTMxNzQ3NjYzMDQyMiAqIGsgLSAwLjA1NTYyMTg2OTgwMjY0MDM0KSArIG0gKiAoMC4wMDAxNjE0MTM4MDU5ODcyNDY3NiAqIG0gKyAwLjAwMDk2OTIyMzkxMzA3MjUxODYgKiB5ICsgMC4wMDA3NzgyNjkyNDUwMDM2MjUzICogayAtIDAuNDQwMTUyMzIzNjc1MjY0NjMpICsgeSAqICg1LjA2ODg4MjkxNDA2ODc2OWUtNyAqIHkgKyAwLjAwMTc3NzgzNjkwMTEzNzUwNzEgKiBrIC0gMC43NTkxNDU0NjQ5NzQ5NjA5KSAtIGsgKiAoMC4wMDAzNDM1MzE5OTY1MTA1NTUzICogayArIDAuNzA2Mzc3MDE4NjE2MDE0NCk7CiAgICB9CiAgICByZXR1cm4gZGF0YS5zdWJhcnJheSgwLCBvZmZzZXQpOwogIH0KICBfY29udmVydENteWtUb1JnYmEoZGF0YSkgewogICAgZm9yIChsZXQgaSA9IDAsIGxlbmd0aCA9IGRhdGEubGVuZ3RoOyBpIDwgbGVuZ3RoOyBpICs9IDQpIHsKICAgICAgY29uc3QgYyA9IGRhdGFbaV07CiAgICAgIGNvbnN0IG0gPSBkYXRhW2kgKyAxXTsKICAgICAgY29uc3QgeSA9IGRhdGFbaSArIDJdOwogICAgICBjb25zdCBrID0gZGF0YVtpICsgM107CiAgICAgIGRhdGFbaV0gPSAyNTUgKyBjICogKC0wLjAwMDA2NzQ3MTQ3MDczNjAyNDQxICogYyArIDAuMDAwODM3OTI2MjEyMTAxMzcyNyAqIG0gKyAwLjAwMDI4OTQ3MTgxODg2NDMyOTQgKiB5ICsgMC4wMDMyNjQyMzEwNTc1Mzc4MDYgKiBrIC0gMS4xMTg1NjExODY3MjAzOTM3KSArIG0gKiAoMC4wMDAwMjYzNzQxMDc2MTYwODk0MDUgKiBtIC0gMC4wMDAwODYyNjk0OTE1ODYzODU3MiAqIHkgLSAwLjAwMDI3NDg3NjkwNjc0OTk0OTEgKiBrIC0gMC4wMjE1NTY4ODc5NDk3ODk2NykgKyB5ICogKC0wLjAwMDAzODc4MDk5MjEyODY5MzYzICogeSAtIDAuMDAwMzI2NzgwODI3OTQ4NTI4NiAqIGsgKyAwLjA2ODY3NDIyMzg1OTUzNDUpIC0gayAqICgwLjAwMDMzNjE5NzE3NzYxODM5MzcgKiBrICsgMC43NDMwNjU5MTUxMzQyMjU0KTsKICAgICAgZGF0YVtpICsgMV0gPSAyNTUgKyBjICogKDAuMDAwMTM1OTYzNzI4MTM1ODg4NDggKiBjICsgMC4wMDA5MjQ1MzcxMzI1NzM1ODUgKiBtICsgMC4wMDAxMDU2NzM1OTYxODY4MzU5MyAqIHkgKyAwLjAwMDQ3OTE4NjQ2ODc0MzY1MTIgKiBrIC0gMC4zMTA5Njg5NTg3NTE1ODc1KSArIG0gKiAoLTAuMDAwMjM1NDUzNDYxMDgzNzAzNDQgKiBtICsgMC4wMDAyNzAyODQ1MjUzNTM0NzE0ICogeSArIDAuMDAyMDIwMDMwODk3NzMwNzE1NiAqIGsgLSAwLjc0ODgwNTIxNjcwMTU0OTQpICsgeSAqICgwLjAwMDA2ODM0ODE1OTk4MjM1NjYyICogeSArIDAuMDAwMTUxNjg0NTIzNjM0NjA5NzMgKiBrIC0gMC4wOTc1MTkyNzc3NDcyODkzMykgLSBrICogKDAuMDAwMzE4OTEzMTE3NTg4MzI4MSAqIGsgKyAwLjczNjQ4ODM4MDc3MzMxNjgpOwogICAgICBkYXRhW2kgKyAyXSA9IDI1NSArIGMgKiAoMC4wMDAwMTM1OTg2NTA0MTEzODUzMDcgKiBjICsgMC4wMDAxMjQyMzk1NjE3NTQ5MDg1MSAqIG0gKyAwLjAwMDQ3NTE5ODUwOTc1ODM1ODkgKiB5IC0gMC4wMDAwMDM2NzI5MzE3NDc2NjMwNDIyICogayAtIDAuMDU1NjIxODY5ODAyNjQwMzQpICsgbSAqICgwLjAwMDE2MTQxMzgwNTk4NzI0Njc2ICogbSArIDAuMDAwOTY5MjIzOTEzMDcyNTE4NiAqIHkgKyAwLjAwMDc3ODI2OTI0NTAwMzYyNTMgKiBrIC0gMC40NDAxNTIzMjM2NzUyNjQ2MykgKyB5ICogKDUuMDY4ODgyOTE0MDY4NzY5ZS03ICogeSArIDAuMDAxNzc3ODM2OTAxMTM3NTA3MSAqIGsgLSAwLjc1OTE0NTQ2NDk3NDk2MDkpIC0gayAqICgwLjAwMDM0MzUzMTk5NjUxMDU1NTMgKiBrICsgMC43MDYzNzcwMTg2MTYwMTQ0KTsKICAgICAgZGF0YVtpICsgM10gPSAyNTU7CiAgICB9CiAgICByZXR1cm4gZGF0YTsKICB9CiAgZ2V0RGF0YSh7CiAgICB3aWR0aCwKICAgIGhlaWdodCwKICAgIGZvcmNlUkdCQSA9IGZhbHNlLAogICAgZm9yY2VSR0IgPSBmYWxzZSwKICAgIGlzU291cmNlUERGID0gZmFsc2UKICB9KSB7CiAgICBpZiAodGhpcy5udW1Db21wb25lbnRzID4gNCkgewogICAgICB0aHJvdyBuZXcgSnBlZ0Vycm9yKCJVbnN1cHBvcnRlZCBjb2xvciBtb2RlIik7CiAgICB9CiAgICBjb25zdCBkYXRhID0gdGhpcy5fZ2V0TGluZWFyaXplZEJsb2NrRGF0YSh3aWR0aCwgaGVpZ2h0LCBpc1NvdXJjZVBERik7CiAgICBpZiAodGhpcy5udW1Db21wb25lbnRzID09PSAxICYmIChmb3JjZVJHQkEgfHwgZm9yY2VSR0IpKSB7CiAgICAgIGNvbnN0IGxlbiA9IGRhdGEubGVuZ3RoICogKGZvcmNlUkdCQSA/IDQgOiAzKTsKICAgICAgY29uc3QgcmdiYURhdGEgPSBuZXcgVWludDhDbGFtcGVkQXJyYXkobGVuKTsKICAgICAgbGV0IG9mZnNldCA9IDA7CiAgICAgIGlmIChmb3JjZVJHQkEpIHsKICAgICAgICAoMCwgX2ltYWdlX3V0aWxzLmdyYXlUb1JHQkEpKGRhdGEsIG5ldyBVaW50MzJBcnJheShyZ2JhRGF0YS5idWZmZXIpKTsKICAgICAgfSBlbHNlIHsKICAgICAgICBmb3IgKGNvbnN0IGdyYXlDb2xvciBvZiBkYXRhKSB7CiAgICAgICAgICByZ2JhRGF0YVtvZmZzZXQrK10gPSBncmF5Q29sb3I7CiAgICAgICAgICByZ2JhRGF0YVtvZmZzZXQrK10gPSBncmF5Q29sb3I7CiAgICAgICAgICByZ2JhRGF0YVtvZmZzZXQrK10gPSBncmF5Q29sb3I7CiAgICAgICAgfQogICAgICB9CiAgICAgIHJldHVybiByZ2JhRGF0YTsKICAgIH0gZWxzZSBpZiAodGhpcy5udW1Db21wb25lbnRzID09PSAzICYmIHRoaXMuX2lzQ29sb3JDb252ZXJzaW9uTmVlZGVkKSB7CiAgICAgIGlmIChmb3JjZVJHQkEpIHsKICAgICAgICBjb25zdCByZ2JhRGF0YSA9IG5ldyBVaW50OENsYW1wZWRBcnJheShkYXRhLmxlbmd0aCAvIDMgKiA0KTsKICAgICAgICByZXR1cm4gdGhpcy5fY29udmVydFljY1RvUmdiYShkYXRhLCByZ2JhRGF0YSk7CiAgICAgIH0KICAgICAgcmV0dXJuIHRoaXMuX2NvbnZlcnRZY2NUb1JnYihkYXRhKTsKICAgIH0gZWxzZSBpZiAodGhpcy5udW1Db21wb25lbnRzID09PSA0KSB7CiAgICAgIGlmICh0aGlzLl9pc0NvbG9yQ29udmVyc2lvbk5lZWRlZCkgewogICAgICAgIGlmIChmb3JjZVJHQkEpIHsKICAgICAgICAgIHJldHVybiB0aGlzLl9jb252ZXJ0WWNja1RvUmdiYShkYXRhKTsKICAgICAgICB9CiAgICAgICAgaWYgKGZvcmNlUkdCKSB7CiAgICAgICAgICByZXR1cm4gdGhpcy5fY29udmVydFljY2tUb1JnYihkYXRhKTsKICAgICAgICB9CiAgICAgICAgcmV0dXJuIHRoaXMuX2NvbnZlcnRZY2NrVG9DbXlrKGRhdGEpOwogICAgICB9IGVsc2UgaWYgKGZvcmNlUkdCQSkgewogICAgICAgIHJldHVybiB0aGlzLl9jb252ZXJ0Q215a1RvUmdiYShkYXRhKTsKICAgICAgfSBlbHNlIGlmIChmb3JjZVJHQikgewogICAgICAgIHJldHVybiB0aGlzLl9jb252ZXJ0Q215a1RvUmdiKGRhdGEpOwogICAgICB9CiAgICB9CiAgICByZXR1cm4gZGF0YTsKICB9Cn0KZXhwb3J0cy5KcGVnSW1hZ2UgPSBKcGVnSW1hZ2U7CgovKioqLyB9KSwKLyogMjggKi8KLyoqKi8gKChfX3VudXNlZF93ZWJwYWNrX21vZHVsZSwgZXhwb3J0cywgX193X3BkZmpzX3JlcXVpcmVfXykgPT4gewoKCgpPYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgIl9fZXNNb2R1bGUiLCAoewogIHZhbHVlOiB0cnVlCn0pKTsKZXhwb3J0cy5jb252ZXJ0QmxhY2tBbmRXaGl0ZVRvUkdCQSA9IGNvbnZlcnRCbGFja0FuZFdoaXRlVG9SR0JBOwpleHBvcnRzLmNvbnZlcnRUb1JHQkEgPSBjb252ZXJ0VG9SR0JBOwpleHBvcnRzLmdyYXlUb1JHQkEgPSBncmF5VG9SR0JBOwp2YXIgX3V0aWwgPSBfX3dfcGRmanNfcmVxdWlyZV9fKDIpOwpmdW5jdGlvbiBjb252ZXJ0VG9SR0JBKHBhcmFtcykgewogIHN3aXRjaCAocGFyYW1zLmtpbmQpIHsKICAgIGNhc2UgX3V0aWwuSW1hZ2VLaW5kLkdSQVlTQ0FMRV8xQlBQOgogICAgICByZXR1cm4gY29udmVydEJsYWNrQW5kV2hpdGVUb1JHQkEocGFyYW1zKTsKICAgIGNhc2UgX3V0aWwuSW1hZ2VLaW5kLlJHQl8yNEJQUDoKICAgICAgcmV0dXJuIGNvbnZlcnRSR0JUb1JHQkEocGFyYW1zKTsKICB9CiAgcmV0dXJuIG51bGw7Cn0KZnVuY3Rpb24gY29udmVydEJsYWNrQW5kV2hpdGVUb1JHQkEoewogIHNyYywKICBzcmNQb3MgPSAwLAogIGRlc3QsCiAgd2lkdGgsCiAgaGVpZ2h0LAogIG5vbkJsYWNrQ29sb3IgPSAweGZmZmZmZmZmLAogIGludmVyc2VEZWNvZGUgPSBmYWxzZQp9KSB7CiAgY29uc3QgYmxhY2sgPSBfdXRpbC5GZWF0dXJlVGVzdC5pc0xpdHRsZUVuZGlhbiA/IDB4ZmYwMDAwMDAgOiAweDAwMDAwMGZmOwogIGNvbnN0IFt6ZXJvTWFwcGluZywgb25lTWFwcGluZ10gPSBpbnZlcnNlRGVjb2RlID8gW25vbkJsYWNrQ29sb3IsIGJsYWNrXSA6IFtibGFjaywgbm9uQmxhY2tDb2xvcl07CiAgY29uc3Qgd2lkdGhJblNvdXJjZSA9IHdpZHRoID4+IDM7CiAgY29uc3Qgd2lkdGhSZW1haW5kZXIgPSB3aWR0aCAmIDc7CiAgY29uc3Qgc3JjTGVuZ3RoID0gc3JjLmxlbmd0aDsKICBkZXN0ID0gbmV3IFVpbnQzMkFycmF5KGRlc3QuYnVmZmVyKTsKICBsZXQgZGVzdFBvcyA9IDA7CiAgZm9yIChsZXQgaSA9IDA7IGkgPCBoZWlnaHQ7IGkrKykgewogICAgZm9yIChjb25zdCBtYXggPSBzcmNQb3MgKyB3aWR0aEluU291cmNlOyBzcmNQb3MgPCBtYXg7IHNyY1BvcysrKSB7CiAgICAgIGNvbnN0IGVsZW0gPSBzcmNQb3MgPCBzcmNMZW5ndGggPyBzcmNbc3JjUG9zXSA6IDI1NTsKICAgICAgZGVzdFtkZXN0UG9zKytdID0gZWxlbSAmIDBiMTAwMDAwMDAgPyBvbmVNYXBwaW5nIDogemVyb01hcHBpbmc7CiAgICAgIGRlc3RbZGVzdFBvcysrXSA9IGVsZW0gJiAwYjEwMDAwMDAgPyBvbmVNYXBwaW5nIDogemVyb01hcHBpbmc7CiAgICAgIGRlc3RbZGVzdFBvcysrXSA9IGVsZW0gJiAwYjEwMDAwMCA/IG9uZU1hcHBpbmcgOiB6ZXJvTWFwcGluZzsKICAgICAgZGVzdFtkZXN0UG9zKytdID0gZWxlbSAmIDBiMTAwMDAgPyBvbmVNYXBwaW5nIDogemVyb01hcHBpbmc7CiAgICAgIGRlc3RbZGVzdFBvcysrXSA9IGVsZW0gJiAwYjEwMDAgPyBvbmVNYXBwaW5nIDogemVyb01hcHBpbmc7CiAgICAgIGRlc3RbZGVzdFBvcysrXSA9IGVsZW0gJiAwYjEwMCA/IG9uZU1hcHBpbmcgOiB6ZXJvTWFwcGluZzsKICAgICAgZGVzdFtkZXN0UG9zKytdID0gZWxlbSAmIDBiMTAgPyBvbmVNYXBwaW5nIDogemVyb01hcHBpbmc7CiAgICAgIGRlc3RbZGVzdFBvcysrXSA9IGVsZW0gJiAwYjEgPyBvbmVNYXBwaW5nIDogemVyb01hcHBpbmc7CiAgICB9CiAgICBpZiAod2lkdGhSZW1haW5kZXIgPT09IDApIHsKICAgICAgY29udGludWU7CiAgICB9CiAgICBjb25zdCBlbGVtID0gc3JjUG9zIDwgc3JjTGVuZ3RoID8gc3JjW3NyY1BvcysrXSA6IDI1NTsKICAgIGZvciAobGV0IGogPSAwOyBqIDwgd2lkdGhSZW1haW5kZXI7IGorKykgewogICAgICBkZXN0W2Rlc3RQb3MrK10gPSBlbGVtICYgMSA8PCA3IC0gaiA/IG9uZU1hcHBpbmcgOiB6ZXJvTWFwcGluZzsKICAgIH0KICB9CiAgcmV0dXJuIHsKICAgIHNyY1BvcywKICAgIGRlc3RQb3MKICB9Owp9CmZ1bmN0aW9uIGNvbnZlcnRSR0JUb1JHQkEoewogIHNyYywKICBzcmNQb3MgPSAwLAogIGRlc3QsCiAgZGVzdFBvcyA9IDAsCiAgd2lkdGgsCiAgaGVpZ2h0Cn0pIHsKICBsZXQgaSA9IDA7CiAgY29uc3QgbGVuMzIgPSBzcmMubGVuZ3RoID4+IDI7CiAgY29uc3Qgc3JjMzIgPSBuZXcgVWludDMyQXJyYXkoc3JjLmJ1ZmZlciwgc3JjUG9zLCBsZW4zMik7CiAgaWYgKF91dGlsLkZlYXR1cmVUZXN0LmlzTGl0dGxlRW5kaWFuKSB7CiAgICBmb3IgKDsgaSA8IGxlbjMyIC0gMjsgaSArPSAzLCBkZXN0UG9zICs9IDQpIHsKICAgICAgY29uc3QgczEgPSBzcmMzMltpXTsKICAgICAgY29uc3QgczIgPSBzcmMzMltpICsgMV07CiAgICAgIGNvbnN0IHMzID0gc3JjMzJbaSArIDJdOwogICAgICBkZXN0W2Rlc3RQb3NdID0gczEgfCAweGZmMDAwMDAwOwogICAgICBkZXN0W2Rlc3RQb3MgKyAxXSA9IHMxID4+PiAyNCB8IHMyIDw8IDggfCAweGZmMDAwMDAwOwogICAgICBkZXN0W2Rlc3RQb3MgKyAyXSA9IHMyID4+PiAxNiB8IHMzIDw8IDE2IHwgMHhmZjAwMDAwMDsKICAgICAgZGVzdFtkZXN0UG9zICsgM10gPSBzMyA+Pj4gOCB8IDB4ZmYwMDAwMDA7CiAgICB9CiAgICBmb3IgKGxldCBqID0gaSAqIDQsIGpqID0gc3JjLmxlbmd0aDsgaiA8IGpqOyBqICs9IDMpIHsKICAgICAgZGVzdFtkZXN0UG9zKytdID0gc3JjW2pdIHwgc3JjW2ogKyAxXSA8PCA4IHwgc3JjW2ogKyAyXSA8PCAxNiB8IDB4ZmYwMDAwMDA7CiAgICB9CiAgfSBlbHNlIHsKICAgIGZvciAoOyBpIDwgbGVuMzIgLSAyOyBpICs9IDMsIGRlc3RQb3MgKz0gNCkgewogICAgICBjb25zdCBzMSA9IHNyYzMyW2ldOwogICAgICBjb25zdCBzMiA9IHNyYzMyW2kgKyAxXTsKICAgICAgY29uc3QgczMgPSBzcmMzMltpICsgMl07CiAgICAgIGRlc3RbZGVzdFBvc10gPSBzMSB8IDB4ZmY7CiAgICAgIGRlc3RbZGVzdFBvcyArIDFdID0gczEgPDwgMjQgfCBzMiA+Pj4gOCB8IDB4ZmY7CiAgICAgIGRlc3RbZGVzdFBvcyArIDJdID0gczIgPDwgMTYgfCBzMyA+Pj4gMTYgfCAweGZmOwogICAgICBkZXN0W2Rlc3RQb3MgKyAzXSA9IHMzIDw8IDggfCAweGZmOwogICAgfQogICAgZm9yIChsZXQgaiA9IGkgKiA0LCBqaiA9IHNyYy5sZW5ndGg7IGogPCBqajsgaiArPSAzKSB7CiAgICAgIGRlc3RbZGVzdFBvcysrXSA9IHNyY1tqXSA8PCAyNCB8IHNyY1tqICsgMV0gPDwgMTYgfCBzcmNbaiArIDJdIDw8IDggfCAweGZmOwogICAgfQogIH0KICByZXR1cm4gewogICAgc3JjUG9zLAogICAgZGVzdFBvcwogIH07Cn0KZnVuY3Rpb24gZ3JheVRvUkdCQShzcmMsIGRlc3QpIHsKICBpZiAoX3V0aWwuRmVhdHVyZVRlc3QuaXNMaXR0bGVFbmRpYW4pIHsKICAgIGZvciAobGV0IGkgPSAwLCBpaSA9IHNyYy5sZW5ndGg7IGkgPCBpaTsgaSsrKSB7CiAgICAgIGRlc3RbaV0gPSBzcmNbaV0gKiAweDEwMTAxIHwgMHhmZjAwMDAwMDsKICAgIH0KICB9IGVsc2UgewogICAgZm9yIChsZXQgaSA9IDAsIGlpID0gc3JjLmxlbmd0aDsgaSA8IGlpOyBpKyspIHsKICAgICAgZGVzdFtpXSA9IHNyY1tpXSAqIDB4MTAxMDEwMCB8IDB4MDAwMDAwZmY7CiAgICB9CiAgfQp9CgovKioqLyB9KSwKLyogMjkgKi8KLyoqKi8gKChfX3VudXNlZF93ZWJwYWNrX21vZHVsZSwgZXhwb3J0cywgX193X3BkZmpzX3JlcXVpcmVfXykgPT4gewoKCgpPYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgIl9fZXNNb2R1bGUiLCAoewogIHZhbHVlOiB0cnVlCn0pKTsKZXhwb3J0cy5KcHhTdHJlYW0gPSB2b2lkIDA7CnZhciBfZGVjb2RlX3N0cmVhbSA9IF9fd19wZGZqc19yZXF1aXJlX18oMTgpOwp2YXIgX2pweCA9IF9fd19wZGZqc19yZXF1aXJlX18oMzApOwp2YXIgX3V0aWwgPSBfX3dfcGRmanNfcmVxdWlyZV9fKDIpOwpjbGFzcyBKcHhTdHJlYW0gZXh0ZW5kcyBfZGVjb2RlX3N0cmVhbS5EZWNvZGVTdHJlYW0gewogIGNvbnN0cnVjdG9yKHN0cmVhbSwgbWF5YmVMZW5ndGgsIHBhcmFtcykgewogICAgc3VwZXIobWF5YmVMZW5ndGgpOwogICAgdGhpcy5zdHJlYW0gPSBzdHJlYW07CiAgICB0aGlzLmRpY3QgPSBzdHJlYW0uZGljdDsKICAgIHRoaXMubWF5YmVMZW5ndGggPSBtYXliZUxlbmd0aDsKICAgIHRoaXMucGFyYW1zID0gcGFyYW1zOwogIH0KICBnZXQgYnl0ZXMoKSB7CiAgICByZXR1cm4gKDAsIF91dGlsLnNoYWRvdykodGhpcywgImJ5dGVzIiwgdGhpcy5zdHJlYW0uZ2V0Qnl0ZXModGhpcy5tYXliZUxlbmd0aCkpOwogIH0KICBlbnN1cmVCdWZmZXIocmVxdWVzdGVkKSB7fQogIHJlYWRCbG9jaygpIHsKICAgIGlmICh0aGlzLmVvZikgewogICAgICByZXR1cm47CiAgICB9CiAgICBjb25zdCBqcHhJbWFnZSA9IG5ldyBfanB4LkpweEltYWdlKCk7CiAgICBqcHhJbWFnZS5wYXJzZSh0aGlzLmJ5dGVzKTsKICAgIGNvbnN0IHdpZHRoID0ganB4SW1hZ2Uud2lkdGg7CiAgICBjb25zdCBoZWlnaHQgPSBqcHhJbWFnZS5oZWlnaHQ7CiAgICBjb25zdCBjb21wb25lbnRzQ291bnQgPSBqcHhJbWFnZS5jb21wb25lbnRzQ291bnQ7CiAgICBjb25zdCB0aWxlQ291bnQgPSBqcHhJbWFnZS50aWxlcy5sZW5ndGg7CiAgICBpZiAodGlsZUNvdW50ID09PSAxKSB7CiAgICAgIHRoaXMuYnVmZmVyID0ganB4SW1hZ2UudGlsZXNbMF0uaXRlbXM7CiAgICB9IGVsc2UgewogICAgICBjb25zdCBkYXRhID0gbmV3IFVpbnQ4Q2xhbXBlZEFycmF5KHdpZHRoICogaGVpZ2h0ICogY29tcG9uZW50c0NvdW50KTsKICAgICAgZm9yIChsZXQgayA9IDA7IGsgPCB0aWxlQ291bnQ7IGsrKykgewogICAgICAgIGNvbnN0IHRpbGVDb21wb25lbnRzID0ganB4SW1hZ2UudGlsZXNba107CiAgICAgICAgY29uc3QgdGlsZVdpZHRoID0gdGlsZUNvbXBvbmVudHMud2lkdGg7CiAgICAgICAgY29uc3QgdGlsZUhlaWdodCA9IHRpbGVDb21wb25lbnRzLmhlaWdodDsKICAgICAgICBjb25zdCB0aWxlTGVmdCA9IHRpbGVDb21wb25lbnRzLmxlZnQ7CiAgICAgICAgY29uc3QgdGlsZVRvcCA9IHRpbGVDb21wb25lbnRzLnRvcDsKICAgICAgICBjb25zdCBzcmMgPSB0aWxlQ29tcG9uZW50cy5pdGVtczsKICAgICAgICBsZXQgc3JjUG9zaXRpb24gPSAwOwogICAgICAgIGxldCBkYXRhUG9zaXRpb24gPSAod2lkdGggKiB0aWxlVG9wICsgdGlsZUxlZnQpICogY29tcG9uZW50c0NvdW50OwogICAgICAgIGNvbnN0IGltZ1Jvd1NpemUgPSB3aWR0aCAqIGNvbXBvbmVudHNDb3VudDsKICAgICAgICBjb25zdCB0aWxlUm93U2l6ZSA9IHRpbGVXaWR0aCAqIGNvbXBvbmVudHNDb3VudDsKICAgICAgICBmb3IgKGxldCBqID0gMDsgaiA8IHRpbGVIZWlnaHQ7IGorKykgewogICAgICAgICAgY29uc3Qgcm93Qnl0ZXMgPSBzcmMuc3ViYXJyYXkoc3JjUG9zaXRpb24sIHNyY1Bvc2l0aW9uICsgdGlsZVJvd1NpemUpOwogICAgICAgICAgZGF0YS5zZXQocm93Qnl0ZXMsIGRhdGFQb3NpdGlvbik7CiAgICAgICAgICBzcmNQb3NpdGlvbiArPSB0aWxlUm93U2l6ZTsKICAgICAgICAgIGRhdGFQb3NpdGlvbiArPSBpbWdSb3dTaXplOwogICAgICAgIH0KICAgICAgfQogICAgICB0aGlzLmJ1ZmZlciA9IGRhdGE7CiAgICB9CiAgICB0aGlzLmJ1ZmZlckxlbmd0aCA9IHRoaXMuYnVmZmVyLmxlbmd0aDsKICAgIHRoaXMuZW9mID0gdHJ1ZTsKICB9Cn0KZXhwb3J0cy5KcHhTdHJlYW0gPSBKcHhTdHJlYW07CgovKioqLyB9KSwKLyogMzAgKi8KLyoqKi8gKChfX3VudXNlZF93ZWJwYWNrX21vZHVsZSwgZXhwb3J0cywgX193X3BkZmpzX3JlcXVpcmVfXykgPT4gewoKCgpPYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgIl9fZXNNb2R1bGUiLCAoewogIHZhbHVlOiB0cnVlCn0pKTsKZXhwb3J0cy5KcHhJbWFnZSA9IHZvaWQgMDsKdmFyIF91dGlsID0gX193X3BkZmpzX3JlcXVpcmVfXygyKTsKdmFyIF9jb3JlX3V0aWxzID0gX193X3BkZmpzX3JlcXVpcmVfXygzKTsKdmFyIF9hcml0aG1ldGljX2RlY29kZXIgPSBfX3dfcGRmanNfcmVxdWlyZV9fKDI1KTsKY2xhc3MgSnB4RXJyb3IgZXh0ZW5kcyBfdXRpbC5CYXNlRXhjZXB0aW9uIHsKICBjb25zdHJ1Y3Rvcihtc2cpIHsKICAgIHN1cGVyKGBKUFggZXJyb3I6ICR7bXNnfWAsICJKcHhFcnJvciIpOwogIH0KfQpjb25zdCBTdWJiYW5kc0dhaW5Mb2cyID0gewogIExMOiAwLAogIExIOiAxLAogIEhMOiAxLAogIEhIOiAyCn07CmNsYXNzIEpweEltYWdlIHsKICBjb25zdHJ1Y3RvcigpIHsKICAgIHRoaXMuZmFpbE9uQ29ycnVwdGVkSW1hZ2UgPSBmYWxzZTsKICB9CiAgcGFyc2UoZGF0YSkgewogICAgY29uc3QgaGVhZCA9ICgwLCBfY29yZV91dGlscy5yZWFkVWludDE2KShkYXRhLCAwKTsKICAgIGlmIChoZWFkID09PSAweGZmNGYpIHsKICAgICAgdGhpcy5wYXJzZUNvZGVzdHJlYW0oZGF0YSwgMCwgZGF0YS5sZW5ndGgpOwogICAgICByZXR1cm47CiAgICB9CiAgICBjb25zdCBsZW5ndGggPSBkYXRhLmxlbmd0aDsKICAgIGxldCBwb3NpdGlvbiA9IDA7CiAgICB3aGlsZSAocG9zaXRpb24gPCBsZW5ndGgpIHsKICAgICAgbGV0IGhlYWRlclNpemUgPSA4OwogICAgICBsZXQgbGJveCA9ICgwLCBfY29yZV91dGlscy5yZWFkVWludDMyKShkYXRhLCBwb3NpdGlvbik7CiAgICAgIGNvbnN0IHRib3ggPSAoMCwgX2NvcmVfdXRpbHMucmVhZFVpbnQzMikoZGF0YSwgcG9zaXRpb24gKyA0KTsKICAgICAgcG9zaXRpb24gKz0gaGVhZGVyU2l6ZTsKICAgICAgaWYgKGxib3ggPT09IDEpIHsKICAgICAgICBsYm94ID0gKDAsIF9jb3JlX3V0aWxzLnJlYWRVaW50MzIpKGRhdGEsIHBvc2l0aW9uKSAqIDQyOTQ5NjcyOTYgKyAoMCwgX2NvcmVfdXRpbHMucmVhZFVpbnQzMikoZGF0YSwgcG9zaXRpb24gKyA0KTsKICAgICAgICBwb3NpdGlvbiArPSA4OwogICAgICAgIGhlYWRlclNpemUgKz0gODsKICAgICAgfQogICAgICBpZiAobGJveCA9PT0gMCkgewogICAgICAgIGxib3ggPSBsZW5ndGggLSBwb3NpdGlvbiArIGhlYWRlclNpemU7CiAgICAgIH0KICAgICAgaWYgKGxib3ggPCBoZWFkZXJTaXplKSB7CiAgICAgICAgdGhyb3cgbmV3IEpweEVycm9yKCJJbnZhbGlkIGJveCBmaWVsZCBzaXplIik7CiAgICAgIH0KICAgICAgY29uc3QgZGF0YUxlbmd0aCA9IGxib3ggLSBoZWFkZXJTaXplOwogICAgICBsZXQganVtcERhdGFMZW5ndGggPSB0cnVlOwogICAgICBzd2l0Y2ggKHRib3gpIHsKICAgICAgICBjYXNlIDB4NmE3MDMyNjg6CiAgICAgICAgICBqdW1wRGF0YUxlbmd0aCA9IGZhbHNlOwogICAgICAgICAgYnJlYWs7CiAgICAgICAgY2FzZSAweDYzNmY2YzcyOgogICAgICAgICAgY29uc3QgbWV0aG9kID0gZGF0YVtwb3NpdGlvbl07CiAgICAgICAgICBpZiAobWV0aG9kID09PSAxKSB7CiAgICAgICAgICAgIGNvbnN0IGNvbG9yc3BhY2UgPSAoMCwgX2NvcmVfdXRpbHMucmVhZFVpbnQzMikoZGF0YSwgcG9zaXRpb24gKyAzKTsKICAgICAgICAgICAgc3dpdGNoIChjb2xvcnNwYWNlKSB7CiAgICAgICAgICAgICAgY2FzZSAxNjoKICAgICAgICAgICAgICBjYXNlIDE3OgogICAgICAgICAgICAgIGNhc2UgMTg6CiAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICBkZWZhdWx0OgogICAgICAgICAgICAgICAgKDAsIF91dGlsLndhcm4pKCJVbmtub3duIGNvbG9yc3BhY2UgIiArIGNvbG9yc3BhY2UpOwogICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0gZWxzZSBpZiAobWV0aG9kID09PSAyKSB7CiAgICAgICAgICAgICgwLCBfdXRpbC5pbmZvKSgiSUNDIHByb2ZpbGUgbm90IHN1cHBvcnRlZCIpOwogICAgICAgICAgfQogICAgICAgICAgYnJlYWs7CiAgICAgICAgY2FzZSAweDZhNzAzMjYzOgogICAgICAgICAgdGhpcy5wYXJzZUNvZGVzdHJlYW0oZGF0YSwgcG9zaXRpb24sIHBvc2l0aW9uICsgZGF0YUxlbmd0aCk7CiAgICAgICAgICBicmVhazsKICAgICAgICBjYXNlIDB4NmE1MDIwMjA6CiAgICAgICAgICBpZiAoKDAsIF9jb3JlX3V0aWxzLnJlYWRVaW50MzIpKGRhdGEsIHBvc2l0aW9uKSAhPT0gMHgwZDBhODcwYSkgewogICAgICAgICAgICAoMCwgX3V0aWwud2FybikoIkludmFsaWQgSlAyIHNpZ25hdHVyZSIpOwogICAgICAgICAgfQogICAgICAgICAgYnJlYWs7CiAgICAgICAgY2FzZSAweDZhNTAxYTFhOgogICAgICAgIGNhc2UgMHg2Njc0Nzk3MDoKICAgICAgICBjYXNlIDB4NzI3MjY1NzE6CiAgICAgICAgY2FzZSAweDcyNjU3MzIwOgogICAgICAgIGNhc2UgMHg2OTY4NjQ3MjoKICAgICAgICAgIGJyZWFrOwogICAgICAgIGRlZmF1bHQ6CiAgICAgICAgICBjb25zdCBoZWFkZXJUeXBlID0gU3RyaW5nLmZyb21DaGFyQ29kZSh0Ym94ID4+IDI0ICYgMHhmZiwgdGJveCA+PiAxNiAmIDB4ZmYsIHRib3ggPj4gOCAmIDB4ZmYsIHRib3ggJiAweGZmKTsKICAgICAgICAgICgwLCBfdXRpbC53YXJuKShgVW5zdXBwb3J0ZWQgaGVhZGVyIHR5cGUgJHt0Ym94fSAoJHtoZWFkZXJUeXBlfSkuYCk7CiAgICAgICAgICBicmVhazsKICAgICAgfQogICAgICBpZiAoanVtcERhdGFMZW5ndGgpIHsKICAgICAgICBwb3NpdGlvbiArPSBkYXRhTGVuZ3RoOwogICAgICB9CiAgICB9CiAgfQogIHBhcnNlSW1hZ2VQcm9wZXJ0aWVzKHN0cmVhbSkgewogICAgbGV0IG5ld0J5dGUgPSBzdHJlYW0uZ2V0Qnl0ZSgpOwogICAgd2hpbGUgKG5ld0J5dGUgPj0gMCkgewogICAgICBjb25zdCBvbGRCeXRlID0gbmV3Qnl0ZTsKICAgICAgbmV3Qnl0ZSA9IHN0cmVhbS5nZXRCeXRlKCk7CiAgICAgIGNvbnN0IGNvZGUgPSBvbGRCeXRlIDw8IDggfCBuZXdCeXRlOwogICAgICBpZiAoY29kZSA9PT0gMHhmZjUxKSB7CiAgICAgICAgc3RyZWFtLnNraXAoNCk7CiAgICAgICAgY29uc3QgWHNpeiA9IHN0cmVhbS5nZXRJbnQzMigpID4+PiAwOwogICAgICAgIGNvbnN0IFlzaXogPSBzdHJlYW0uZ2V0SW50MzIoKSA+Pj4gMDsKICAgICAgICBjb25zdCBYT3NpeiA9IHN0cmVhbS5nZXRJbnQzMigpID4+PiAwOwogICAgICAgIGNvbnN0IFlPc2l6ID0gc3RyZWFtLmdldEludDMyKCkgPj4+IDA7CiAgICAgICAgc3RyZWFtLnNraXAoMTYpOwogICAgICAgIGNvbnN0IENzaXogPSBzdHJlYW0uZ2V0VWludDE2KCk7CiAgICAgICAgdGhpcy53aWR0aCA9IFhzaXogLSBYT3NpejsKICAgICAgICB0aGlzLmhlaWdodCA9IFlzaXogLSBZT3NpejsKICAgICAgICB0aGlzLmNvbXBvbmVudHNDb3VudCA9IENzaXo7CiAgICAgICAgdGhpcy5iaXRzUGVyQ29tcG9uZW50ID0gODsKICAgICAgICByZXR1cm47CiAgICAgIH0KICAgIH0KICAgIHRocm93IG5ldyBKcHhFcnJvcigiTm8gc2l6ZSBtYXJrZXIgZm91bmQgaW4gSlBYIHN0cmVhbSIpOwogIH0KICBwYXJzZUNvZGVzdHJlYW0oZGF0YSwgc3RhcnQsIGVuZCkgewogICAgY29uc3QgY29udGV4dCA9IHt9OwogICAgbGV0IGRvTm90UmVjb3ZlciA9IGZhbHNlOwogICAgdHJ5IHsKICAgICAgbGV0IHBvc2l0aW9uID0gc3RhcnQ7CiAgICAgIHdoaWxlIChwb3NpdGlvbiArIDEgPCBlbmQpIHsKICAgICAgICBjb25zdCBjb2RlID0gKDAsIF9jb3JlX3V0aWxzLnJlYWRVaW50MTYpKGRhdGEsIHBvc2l0aW9uKTsKICAgICAgICBwb3NpdGlvbiArPSAyOwogICAgICAgIGxldCBsZW5ndGggPSAwLAogICAgICAgICAgaiwKICAgICAgICAgIHNxY2QsCiAgICAgICAgICBzcHFjZHMsCiAgICAgICAgICBzcHFjZFNpemUsCiAgICAgICAgICBzY2FsYXJFeHBvdW5kZWQsCiAgICAgICAgICB0aWxlOwogICAgICAgIHN3aXRjaCAoY29kZSkgewogICAgICAgICAgY2FzZSAweGZmNGY6CiAgICAgICAgICAgIGNvbnRleHQubWFpbkhlYWRlciA9IHRydWU7CiAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgY2FzZSAweGZmZDk6CiAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgY2FzZSAweGZmNTE6CiAgICAgICAgICAgIGxlbmd0aCA9ICgwLCBfY29yZV91dGlscy5yZWFkVWludDE2KShkYXRhLCBwb3NpdGlvbik7CiAgICAgICAgICAgIGNvbnN0IHNpeiA9IHt9OwogICAgICAgICAgICBzaXouWHNpeiA9ICgwLCBfY29yZV91dGlscy5yZWFkVWludDMyKShkYXRhLCBwb3NpdGlvbiArIDQpOwogICAgICAgICAgICBzaXouWXNpeiA9ICgwLCBfY29yZV91dGlscy5yZWFkVWludDMyKShkYXRhLCBwb3NpdGlvbiArIDgpOwogICAgICAgICAgICBzaXouWE9zaXogPSAoMCwgX2NvcmVfdXRpbHMucmVhZFVpbnQzMikoZGF0YSwgcG9zaXRpb24gKyAxMik7CiAgICAgICAgICAgIHNpei5ZT3NpeiA9ICgwLCBfY29yZV91dGlscy5yZWFkVWludDMyKShkYXRhLCBwb3NpdGlvbiArIDE2KTsKICAgICAgICAgICAgc2l6LlhUc2l6ID0gKDAsIF9jb3JlX3V0aWxzLnJlYWRVaW50MzIpKGRhdGEsIHBvc2l0aW9uICsgMjApOwogICAgICAgICAgICBzaXouWVRzaXogPSAoMCwgX2NvcmVfdXRpbHMucmVhZFVpbnQzMikoZGF0YSwgcG9zaXRpb24gKyAyNCk7CiAgICAgICAgICAgIHNpei5YVE9zaXogPSAoMCwgX2NvcmVfdXRpbHMucmVhZFVpbnQzMikoZGF0YSwgcG9zaXRpb24gKyAyOCk7CiAgICAgICAgICAgIHNpei5ZVE9zaXogPSAoMCwgX2NvcmVfdXRpbHMucmVhZFVpbnQzMikoZGF0YSwgcG9zaXRpb24gKyAzMik7CiAgICAgICAgICAgIGNvbnN0IGNvbXBvbmVudHNDb3VudCA9ICgwLCBfY29yZV91dGlscy5yZWFkVWludDE2KShkYXRhLCBwb3NpdGlvbiArIDM2KTsKICAgICAgICAgICAgc2l6LkNzaXogPSBjb21wb25lbnRzQ291bnQ7CiAgICAgICAgICAgIGNvbnN0IGNvbXBvbmVudHMgPSBbXTsKICAgICAgICAgICAgaiA9IHBvc2l0aW9uICsgMzg7CiAgICAgICAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgY29tcG9uZW50c0NvdW50OyBpKyspIHsKICAgICAgICAgICAgICBjb25zdCBjb21wb25lbnQgPSB7CiAgICAgICAgICAgICAgICBwcmVjaXNpb246IChkYXRhW2pdICYgMHg3ZikgKyAxLAogICAgICAgICAgICAgICAgaXNTaWduZWQ6ICEhKGRhdGFbal0gJiAweDgwKSwKICAgICAgICAgICAgICAgIFhSc2l6OiBkYXRhW2ogKyAxXSwKICAgICAgICAgICAgICAgIFlSc2l6OiBkYXRhW2ogKyAyXQogICAgICAgICAgICAgIH07CiAgICAgICAgICAgICAgaiArPSAzOwogICAgICAgICAgICAgIGNhbGN1bGF0ZUNvbXBvbmVudERpbWVuc2lvbnMoY29tcG9uZW50LCBzaXopOwogICAgICAgICAgICAgIGNvbXBvbmVudHMucHVzaChjb21wb25lbnQpOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGNvbnRleHQuU0laID0gc2l6OwogICAgICAgICAgICBjb250ZXh0LmNvbXBvbmVudHMgPSBjb21wb25lbnRzOwogICAgICAgICAgICBjYWxjdWxhdGVUaWxlR3JpZHMoY29udGV4dCwgY29tcG9uZW50cyk7CiAgICAgICAgICAgIGNvbnRleHQuUUNDID0gW107CiAgICAgICAgICAgIGNvbnRleHQuQ09DID0gW107CiAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgY2FzZSAweGZmNWM6CiAgICAgICAgICAgIGxlbmd0aCA9ICgwLCBfY29yZV91dGlscy5yZWFkVWludDE2KShkYXRhLCBwb3NpdGlvbik7CiAgICAgICAgICAgIGNvbnN0IHFjZCA9IHt9OwogICAgICAgICAgICBqID0gcG9zaXRpb24gKyAyOwogICAgICAgICAgICBzcWNkID0gZGF0YVtqKytdOwogICAgICAgICAgICBzd2l0Y2ggKHNxY2QgJiAweDFmKSB7CiAgICAgICAgICAgICAgY2FzZSAwOgogICAgICAgICAgICAgICAgc3BxY2RTaXplID0gODsKICAgICAgICAgICAgICAgIHNjYWxhckV4cG91bmRlZCA9IHRydWU7CiAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICBjYXNlIDE6CiAgICAgICAgICAgICAgICBzcHFjZFNpemUgPSAxNjsKICAgICAgICAgICAgICAgIHNjYWxhckV4cG91bmRlZCA9IGZhbHNlOwogICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgY2FzZSAyOgogICAgICAgICAgICAgICAgc3BxY2RTaXplID0gMTY7CiAgICAgICAgICAgICAgICBzY2FsYXJFeHBvdW5kZWQgPSB0cnVlOwogICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgZGVmYXVsdDoKICAgICAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcigiSW52YWxpZCBTUWNkIHZhbHVlICIgKyBzcWNkKTsKICAgICAgICAgICAgfQogICAgICAgICAgICBxY2Qubm9RdWFudGl6YXRpb24gPSBzcHFjZFNpemUgPT09IDg7CiAgICAgICAgICAgIHFjZC5zY2FsYXJFeHBvdW5kZWQgPSBzY2FsYXJFeHBvdW5kZWQ7CiAgICAgICAgICAgIHFjZC5ndWFyZEJpdHMgPSBzcWNkID4+IDU7CiAgICAgICAgICAgIHNwcWNkcyA9IFtdOwogICAgICAgICAgICB3aGlsZSAoaiA8IGxlbmd0aCArIHBvc2l0aW9uKSB7CiAgICAgICAgICAgICAgY29uc3Qgc3BxY2QgPSB7fTsKICAgICAgICAgICAgICBpZiAoc3BxY2RTaXplID09PSA4KSB7CiAgICAgICAgICAgICAgICBzcHFjZC5lcHNpbG9uID0gZGF0YVtqKytdID4+IDM7CiAgICAgICAgICAgICAgICBzcHFjZC5tdSA9IDA7CiAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgIHNwcWNkLmVwc2lsb24gPSBkYXRhW2pdID4+IDM7CiAgICAgICAgICAgICAgICBzcHFjZC5tdSA9IChkYXRhW2pdICYgMHg3KSA8PCA4IHwgZGF0YVtqICsgMV07CiAgICAgICAgICAgICAgICBqICs9IDI7CiAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIHNwcWNkcy5wdXNoKHNwcWNkKTsKICAgICAgICAgICAgfQogICAgICAgICAgICBxY2QuU1BxY2RzID0gc3BxY2RzOwogICAgICAgICAgICBpZiAoY29udGV4dC5tYWluSGVhZGVyKSB7CiAgICAgICAgICAgICAgY29udGV4dC5RQ0QgPSBxY2Q7CiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgY29udGV4dC5jdXJyZW50VGlsZS5RQ0QgPSBxY2Q7CiAgICAgICAgICAgICAgY29udGV4dC5jdXJyZW50VGlsZS5RQ0MgPSBbXTsKICAgICAgICAgICAgfQogICAgICAgICAgICBicmVhazsKICAgICAgICAgIGNhc2UgMHhmZjVkOgogICAgICAgICAgICBsZW5ndGggPSAoMCwgX2NvcmVfdXRpbHMucmVhZFVpbnQxNikoZGF0YSwgcG9zaXRpb24pOwogICAgICAgICAgICBjb25zdCBxY2MgPSB7fTsKICAgICAgICAgICAgaiA9IHBvc2l0aW9uICsgMjsKICAgICAgICAgICAgbGV0IGNxY2M7CiAgICAgICAgICAgIGlmIChjb250ZXh0LlNJWi5Dc2l6IDwgMjU3KSB7CiAgICAgICAgICAgICAgY3FjYyA9IGRhdGFbaisrXTsKICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICBjcWNjID0gKDAsIF9jb3JlX3V0aWxzLnJlYWRVaW50MTYpKGRhdGEsIGopOwogICAgICAgICAgICAgIGogKz0gMjsKICAgICAgICAgICAgfQogICAgICAgICAgICBzcWNkID0gZGF0YVtqKytdOwogICAgICAgICAgICBzd2l0Y2ggKHNxY2QgJiAweDFmKSB7CiAgICAgICAgICAgICAgY2FzZSAwOgogICAgICAgICAgICAgICAgc3BxY2RTaXplID0gODsKICAgICAgICAgICAgICAgIHNjYWxhckV4cG91bmRlZCA9IHRydWU7CiAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICBjYXNlIDE6CiAgICAgICAgICAgICAgICBzcHFjZFNpemUgPSAxNjsKICAgICAgICAgICAgICAgIHNjYWxhckV4cG91bmRlZCA9IGZhbHNlOwogICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgY2FzZSAyOgogICAgICAgICAgICAgICAgc3BxY2RTaXplID0gMTY7CiAgICAgICAgICAgICAgICBzY2FsYXJFeHBvdW5kZWQgPSB0cnVlOwogICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgZGVmYXVsdDoKICAgICAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcigiSW52YWxpZCBTUWNkIHZhbHVlICIgKyBzcWNkKTsKICAgICAgICAgICAgfQogICAgICAgICAgICBxY2Mubm9RdWFudGl6YXRpb24gPSBzcHFjZFNpemUgPT09IDg7CiAgICAgICAgICAgIHFjYy5zY2FsYXJFeHBvdW5kZWQgPSBzY2FsYXJFeHBvdW5kZWQ7CiAgICAgICAgICAgIHFjYy5ndWFyZEJpdHMgPSBzcWNkID4+IDU7CiAgICAgICAgICAgIHNwcWNkcyA9IFtdOwogICAgICAgICAgICB3aGlsZSAoaiA8IGxlbmd0aCArIHBvc2l0aW9uKSB7CiAgICAgICAgICAgICAgY29uc3Qgc3BxY2QgPSB7fTsKICAgICAgICAgICAgICBpZiAoc3BxY2RTaXplID09PSA4KSB7CiAgICAgICAgICAgICAgICBzcHFjZC5lcHNpbG9uID0gZGF0YVtqKytdID4+IDM7CiAgICAgICAgICAgICAgICBzcHFjZC5tdSA9IDA7CiAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgIHNwcWNkLmVwc2lsb24gPSBkYXRhW2pdID4+IDM7CiAgICAgICAgICAgICAgICBzcHFjZC5tdSA9IChkYXRhW2pdICYgMHg3KSA8PCA4IHwgZGF0YVtqICsgMV07CiAgICAgICAgICAgICAgICBqICs9IDI7CiAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIHNwcWNkcy5wdXNoKHNwcWNkKTsKICAgICAgICAgICAgfQogICAgICAgICAgICBxY2MuU1BxY2RzID0gc3BxY2RzOwogICAgICAgICAgICBpZiAoY29udGV4dC5tYWluSGVhZGVyKSB7CiAgICAgICAgICAgICAgY29udGV4dC5RQ0NbY3FjY10gPSBxY2M7CiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgY29udGV4dC5jdXJyZW50VGlsZS5RQ0NbY3FjY10gPSBxY2M7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICBjYXNlIDB4ZmY1MjoKICAgICAgICAgICAgbGVuZ3RoID0gKDAsIF9jb3JlX3V0aWxzLnJlYWRVaW50MTYpKGRhdGEsIHBvc2l0aW9uKTsKICAgICAgICAgICAgY29uc3QgY29kID0ge307CiAgICAgICAgICAgIGogPSBwb3NpdGlvbiArIDI7CiAgICAgICAgICAgIGNvbnN0IHNjb2QgPSBkYXRhW2orK107CiAgICAgICAgICAgIGNvZC5lbnRyb3B5Q29kZXJXaXRoQ3VzdG9tUHJlY2luY3RzID0gISEoc2NvZCAmIDEpOwogICAgICAgICAgICBjb2Quc29wTWFya2VyVXNlZCA9ICEhKHNjb2QgJiAyKTsKICAgICAgICAgICAgY29kLmVwaE1hcmtlclVzZWQgPSAhIShzY29kICYgNCk7CiAgICAgICAgICAgIGNvZC5wcm9ncmVzc2lvbk9yZGVyID0gZGF0YVtqKytdOwogICAgICAgICAgICBjb2QubGF5ZXJzQ291bnQgPSAoMCwgX2NvcmVfdXRpbHMucmVhZFVpbnQxNikoZGF0YSwgaik7CiAgICAgICAgICAgIGogKz0gMjsKICAgICAgICAgICAgY29kLm11bHRpcGxlQ29tcG9uZW50VHJhbnNmb3JtID0gZGF0YVtqKytdOwogICAgICAgICAgICBjb2QuZGVjb21wb3NpdGlvbkxldmVsc0NvdW50ID0gZGF0YVtqKytdOwogICAgICAgICAgICBjb2QueGNiID0gKGRhdGFbaisrXSAmIDB4ZikgKyAyOwogICAgICAgICAgICBjb2QueWNiID0gKGRhdGFbaisrXSAmIDB4ZikgKyAyOwogICAgICAgICAgICBjb25zdCBibG9ja1N0eWxlID0gZGF0YVtqKytdOwogICAgICAgICAgICBjb2Quc2VsZWN0aXZlQXJpdGhtZXRpY0NvZGluZ0J5cGFzcyA9ICEhKGJsb2NrU3R5bGUgJiAxKTsKICAgICAgICAgICAgY29kLnJlc2V0Q29udGV4dFByb2JhYmlsaXRpZXMgPSAhIShibG9ja1N0eWxlICYgMik7CiAgICAgICAgICAgIGNvZC50ZXJtaW5hdGlvbk9uRWFjaENvZGluZ1Bhc3MgPSAhIShibG9ja1N0eWxlICYgNCk7CiAgICAgICAgICAgIGNvZC52ZXJ0aWNhbGx5U3RyaXBlID0gISEoYmxvY2tTdHlsZSAmIDgpOwogICAgICAgICAgICBjb2QucHJlZGljdGFibGVUZXJtaW5hdGlvbiA9ICEhKGJsb2NrU3R5bGUgJiAxNik7CiAgICAgICAgICAgIGNvZC5zZWdtZW50YXRpb25TeW1ib2xVc2VkID0gISEoYmxvY2tTdHlsZSAmIDMyKTsKICAgICAgICAgICAgY29kLnJldmVyc2libGVUcmFuc2Zvcm1hdGlvbiA9IGRhdGFbaisrXTsKICAgICAgICAgICAgaWYgKGNvZC5lbnRyb3B5Q29kZXJXaXRoQ3VzdG9tUHJlY2luY3RzKSB7CiAgICAgICAgICAgICAgY29uc3QgcHJlY2luY3RzU2l6ZXMgPSBbXTsKICAgICAgICAgICAgICB3aGlsZSAoaiA8IGxlbmd0aCArIHBvc2l0aW9uKSB7CiAgICAgICAgICAgICAgICBjb25zdCBwcmVjaW5jdHNTaXplID0gZGF0YVtqKytdOwogICAgICAgICAgICAgICAgcHJlY2luY3RzU2l6ZXMucHVzaCh7CiAgICAgICAgICAgICAgICAgIFBQeDogcHJlY2luY3RzU2l6ZSAmIDB4ZiwKICAgICAgICAgICAgICAgICAgUFB5OiBwcmVjaW5jdHNTaXplID4+IDQKICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgICBjb2QucHJlY2luY3RzU2l6ZXMgPSBwcmVjaW5jdHNTaXplczsKICAgICAgICAgICAgfQogICAgICAgICAgICBjb25zdCB1bnN1cHBvcnRlZCA9IFtdOwogICAgICAgICAgICBpZiAoY29kLnNlbGVjdGl2ZUFyaXRobWV0aWNDb2RpbmdCeXBhc3MpIHsKICAgICAgICAgICAgICB1bnN1cHBvcnRlZC5wdXNoKCJzZWxlY3RpdmVBcml0aG1ldGljQ29kaW5nQnlwYXNzIik7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgaWYgKGNvZC50ZXJtaW5hdGlvbk9uRWFjaENvZGluZ1Bhc3MpIHsKICAgICAgICAgICAgICB1bnN1cHBvcnRlZC5wdXNoKCJ0ZXJtaW5hdGlvbk9uRWFjaENvZGluZ1Bhc3MiKTsKICAgICAgICAgICAgfQogICAgICAgICAgICBpZiAoY29kLnZlcnRpY2FsbHlTdHJpcGUpIHsKICAgICAgICAgICAgICB1bnN1cHBvcnRlZC5wdXNoKCJ2ZXJ0aWNhbGx5U3RyaXBlIik7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgaWYgKGNvZC5wcmVkaWN0YWJsZVRlcm1pbmF0aW9uKSB7CiAgICAgICAgICAgICAgdW5zdXBwb3J0ZWQucHVzaCgicHJlZGljdGFibGVUZXJtaW5hdGlvbiIpOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGlmICh1bnN1cHBvcnRlZC5sZW5ndGggPiAwKSB7CiAgICAgICAgICAgICAgZG9Ob3RSZWNvdmVyID0gdHJ1ZTsKICAgICAgICAgICAgICAoMCwgX3V0aWwud2FybikoYEpQWDogVW5zdXBwb3J0ZWQgQ09EIG9wdGlvbnMgKCR7dW5zdXBwb3J0ZWQuam9pbigiLCAiKX0pLmApOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGlmIChjb250ZXh0Lm1haW5IZWFkZXIpIHsKICAgICAgICAgICAgICBjb250ZXh0LkNPRCA9IGNvZDsKICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICBjb250ZXh0LmN1cnJlbnRUaWxlLkNPRCA9IGNvZDsKICAgICAgICAgICAgICBjb250ZXh0LmN1cnJlbnRUaWxlLkNPQyA9IFtdOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgY2FzZSAweGZmOTA6CiAgICAgICAgICAgIGxlbmd0aCA9ICgwLCBfY29yZV91dGlscy5yZWFkVWludDE2KShkYXRhLCBwb3NpdGlvbik7CiAgICAgICAgICAgIHRpbGUgPSB7fTsKICAgICAgICAgICAgdGlsZS5pbmRleCA9ICgwLCBfY29yZV91dGlscy5yZWFkVWludDE2KShkYXRhLCBwb3NpdGlvbiArIDIpOwogICAgICAgICAgICB0aWxlLmxlbmd0aCA9ICgwLCBfY29yZV91dGlscy5yZWFkVWludDMyKShkYXRhLCBwb3NpdGlvbiArIDQpOwogICAgICAgICAgICB0aWxlLmRhdGFFbmQgPSB0aWxlLmxlbmd0aCArIHBvc2l0aW9uIC0gMjsKICAgICAgICAgICAgdGlsZS5wYXJ0SW5kZXggPSBkYXRhW3Bvc2l0aW9uICsgOF07CiAgICAgICAgICAgIHRpbGUucGFydHNDb3VudCA9IGRhdGFbcG9zaXRpb24gKyA5XTsKICAgICAgICAgICAgY29udGV4dC5tYWluSGVhZGVyID0gZmFsc2U7CiAgICAgICAgICAgIGlmICh0aWxlLnBhcnRJbmRleCA9PT0gMCkgewogICAgICAgICAgICAgIHRpbGUuQ09EID0gY29udGV4dC5DT0Q7CiAgICAgICAgICAgICAgdGlsZS5DT0MgPSBjb250ZXh0LkNPQy5zbGljZSgwKTsKICAgICAgICAgICAgICB0aWxlLlFDRCA9IGNvbnRleHQuUUNEOwogICAgICAgICAgICAgIHRpbGUuUUNDID0gY29udGV4dC5RQ0Muc2xpY2UoMCk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgY29udGV4dC5jdXJyZW50VGlsZSA9IHRpbGU7CiAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgY2FzZSAweGZmOTM6CiAgICAgICAgICAgIHRpbGUgPSBjb250ZXh0LmN1cnJlbnRUaWxlOwogICAgICAgICAgICBpZiAodGlsZS5wYXJ0SW5kZXggPT09IDApIHsKICAgICAgICAgICAgICBpbml0aWFsaXplVGlsZShjb250ZXh0LCB0aWxlLmluZGV4KTsKICAgICAgICAgICAgICBidWlsZFBhY2tldHMoY29udGV4dCk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgbGVuZ3RoID0gdGlsZS5kYXRhRW5kIC0gcG9zaXRpb247CiAgICAgICAgICAgIHBhcnNlVGlsZVBhY2tldHMoY29udGV4dCwgZGF0YSwgcG9zaXRpb24sIGxlbmd0aCk7CiAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgY2FzZSAweGZmNTM6CiAgICAgICAgICAgICgwLCBfdXRpbC53YXJuKSgiSlBYOiBDb2Rlc3RyZWFtIGNvZGUgMHhGRjUzIChDT0MpIGlzIG5vdCBpbXBsZW1lbnRlZC4iKTsKICAgICAgICAgIGNhc2UgMHhmZjU1OgogICAgICAgICAgY2FzZSAweGZmNTc6CiAgICAgICAgICBjYXNlIDB4ZmY1ODoKICAgICAgICAgIGNhc2UgMHhmZjY0OgogICAgICAgICAgICBsZW5ndGggPSAoMCwgX2NvcmVfdXRpbHMucmVhZFVpbnQxNikoZGF0YSwgcG9zaXRpb24pOwogICAgICAgICAgICBicmVhazsKICAgICAgICAgIGRlZmF1bHQ6CiAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcigiVW5rbm93biBjb2Rlc3RyZWFtIGNvZGU6ICIgKyBjb2RlLnRvU3RyaW5nKDE2KSk7CiAgICAgICAgfQogICAgICAgIHBvc2l0aW9uICs9IGxlbmd0aDsKICAgICAgfQogICAgfSBjYXRjaCAoZSkgewogICAgICBpZiAoZG9Ob3RSZWNvdmVyIHx8IHRoaXMuZmFpbE9uQ29ycnVwdGVkSW1hZ2UpIHsKICAgICAgICB0aHJvdyBuZXcgSnB4RXJyb3IoZS5tZXNzYWdlKTsKICAgICAgfSBlbHNlIHsKICAgICAgICAoMCwgX3V0aWwud2FybikoYEpQWDogVHJ5aW5nIHRvIHJlY292ZXIgZnJvbTogIiR7ZS5tZXNzYWdlfSIuYCk7CiAgICAgIH0KICAgIH0KICAgIHRoaXMudGlsZXMgPSB0cmFuc2Zvcm1Db21wb25lbnRzKGNvbnRleHQpOwogICAgdGhpcy53aWR0aCA9IGNvbnRleHQuU0laLlhzaXogLSBjb250ZXh0LlNJWi5YT3NpejsKICAgIHRoaXMuaGVpZ2h0ID0gY29udGV4dC5TSVouWXNpeiAtIGNvbnRleHQuU0laLllPc2l6OwogICAgdGhpcy5jb21wb25lbnRzQ291bnQgPSBjb250ZXh0LlNJWi5Dc2l6OwogIH0KfQpleHBvcnRzLkpweEltYWdlID0gSnB4SW1hZ2U7CmZ1bmN0aW9uIGNhbGN1bGF0ZUNvbXBvbmVudERpbWVuc2lvbnMoY29tcG9uZW50LCBzaXopIHsKICBjb21wb25lbnQueDAgPSBNYXRoLmNlaWwoc2l6LlhPc2l6IC8gY29tcG9uZW50LlhSc2l6KTsKICBjb21wb25lbnQueDEgPSBNYXRoLmNlaWwoc2l6LlhzaXogLyBjb21wb25lbnQuWFJzaXopOwogIGNvbXBvbmVudC55MCA9IE1hdGguY2VpbChzaXouWU9zaXogLyBjb21wb25lbnQuWVJzaXopOwogIGNvbXBvbmVudC55MSA9IE1hdGguY2VpbChzaXouWXNpeiAvIGNvbXBvbmVudC5ZUnNpeik7CiAgY29tcG9uZW50LndpZHRoID0gY29tcG9uZW50LngxIC0gY29tcG9uZW50LngwOwogIGNvbXBvbmVudC5oZWlnaHQgPSBjb21wb25lbnQueTEgLSBjb21wb25lbnQueTA7Cn0KZnVuY3Rpb24gY2FsY3VsYXRlVGlsZUdyaWRzKGNvbnRleHQsIGNvbXBvbmVudHMpIHsKICBjb25zdCBzaXogPSBjb250ZXh0LlNJWjsKICBjb25zdCB0aWxlcyA9IFtdOwogIGxldCB0aWxlOwogIGNvbnN0IG51bVh0aWxlcyA9IE1hdGguY2VpbCgoc2l6LlhzaXogLSBzaXouWFRPc2l6KSAvIHNpei5YVHNpeik7CiAgY29uc3QgbnVtWXRpbGVzID0gTWF0aC5jZWlsKChzaXouWXNpeiAtIHNpei5ZVE9zaXopIC8gc2l6LllUc2l6KTsKICBmb3IgKGxldCBxID0gMDsgcSA8IG51bVl0aWxlczsgcSsrKSB7CiAgICBmb3IgKGxldCBwID0gMDsgcCA8IG51bVh0aWxlczsgcCsrKSB7CiAgICAgIHRpbGUgPSB7fTsKICAgICAgdGlsZS50eDAgPSBNYXRoLm1heChzaXouWFRPc2l6ICsgcCAqIHNpei5YVHNpeiwgc2l6LlhPc2l6KTsKICAgICAgdGlsZS50eTAgPSBNYXRoLm1heChzaXouWVRPc2l6ICsgcSAqIHNpei5ZVHNpeiwgc2l6LllPc2l6KTsKICAgICAgdGlsZS50eDEgPSBNYXRoLm1pbihzaXouWFRPc2l6ICsgKHAgKyAxKSAqIHNpei5YVHNpeiwgc2l6LlhzaXopOwogICAgICB0aWxlLnR5MSA9IE1hdGgubWluKHNpei5ZVE9zaXogKyAocSArIDEpICogc2l6LllUc2l6LCBzaXouWXNpeik7CiAgICAgIHRpbGUud2lkdGggPSB0aWxlLnR4MSAtIHRpbGUudHgwOwogICAgICB0aWxlLmhlaWdodCA9IHRpbGUudHkxIC0gdGlsZS50eTA7CiAgICAgIHRpbGUuY29tcG9uZW50cyA9IFtdOwogICAgICB0aWxlcy5wdXNoKHRpbGUpOwogICAgfQogIH0KICBjb250ZXh0LnRpbGVzID0gdGlsZXM7CiAgY29uc3QgY29tcG9uZW50c0NvdW50ID0gc2l6LkNzaXo7CiAgZm9yIChsZXQgaSA9IDAsIGlpID0gY29tcG9uZW50c0NvdW50OyBpIDwgaWk7IGkrKykgewogICAgY29uc3QgY29tcG9uZW50ID0gY29tcG9uZW50c1tpXTsKICAgIGZvciAobGV0IGogPSAwLCBqaiA9IHRpbGVzLmxlbmd0aDsgaiA8IGpqOyBqKyspIHsKICAgICAgY29uc3QgdGlsZUNvbXBvbmVudCA9IHt9OwogICAgICB0aWxlID0gdGlsZXNbal07CiAgICAgIHRpbGVDb21wb25lbnQudGN4MCA9IE1hdGguY2VpbCh0aWxlLnR4MCAvIGNvbXBvbmVudC5YUnNpeik7CiAgICAgIHRpbGVDb21wb25lbnQudGN5MCA9IE1hdGguY2VpbCh0aWxlLnR5MCAvIGNvbXBvbmVudC5ZUnNpeik7CiAgICAgIHRpbGVDb21wb25lbnQudGN4MSA9IE1hdGguY2VpbCh0aWxlLnR4MSAvIGNvbXBvbmVudC5YUnNpeik7CiAgICAgIHRpbGVDb21wb25lbnQudGN5MSA9IE1hdGguY2VpbCh0aWxlLnR5MSAvIGNvbXBvbmVudC5ZUnNpeik7CiAgICAgIHRpbGVDb21wb25lbnQud2lkdGggPSB0aWxlQ29tcG9uZW50LnRjeDEgLSB0aWxlQ29tcG9uZW50LnRjeDA7CiAgICAgIHRpbGVDb21wb25lbnQuaGVpZ2h0ID0gdGlsZUNvbXBvbmVudC50Y3kxIC0gdGlsZUNvbXBvbmVudC50Y3kwOwogICAgICB0aWxlLmNvbXBvbmVudHNbaV0gPSB0aWxlQ29tcG9uZW50OwogICAgfQogIH0KfQpmdW5jdGlvbiBnZXRCbG9ja3NEaW1lbnNpb25zKGNvbnRleHQsIGNvbXBvbmVudCwgcikgewogIGNvbnN0IGNvZE9yQ29jID0gY29tcG9uZW50LmNvZGluZ1N0eWxlUGFyYW1ldGVyczsKICBjb25zdCByZXN1bHQgPSB7fTsKICBpZiAoIWNvZE9yQ29jLmVudHJvcHlDb2RlcldpdGhDdXN0b21QcmVjaW5jdHMpIHsKICAgIHJlc3VsdC5QUHggPSAxNTsKICAgIHJlc3VsdC5QUHkgPSAxNTsKICB9IGVsc2UgewogICAgcmVzdWx0LlBQeCA9IGNvZE9yQ29jLnByZWNpbmN0c1NpemVzW3JdLlBQeDsKICAgIHJlc3VsdC5QUHkgPSBjb2RPckNvYy5wcmVjaW5jdHNTaXplc1tyXS5QUHk7CiAgfQogIHJlc3VsdC54Y2JfID0gciA+IDAgPyBNYXRoLm1pbihjb2RPckNvYy54Y2IsIHJlc3VsdC5QUHggLSAxKSA6IE1hdGgubWluKGNvZE9yQ29jLnhjYiwgcmVzdWx0LlBQeCk7CiAgcmVzdWx0LnljYl8gPSByID4gMCA/IE1hdGgubWluKGNvZE9yQ29jLnljYiwgcmVzdWx0LlBQeSAtIDEpIDogTWF0aC5taW4oY29kT3JDb2MueWNiLCByZXN1bHQuUFB5KTsKICByZXR1cm4gcmVzdWx0Owp9CmZ1bmN0aW9uIGJ1aWxkUHJlY2luY3RzKGNvbnRleHQsIHJlc29sdXRpb24sIGRpbWVuc2lvbnMpIHsKICBjb25zdCBwcmVjaW5jdFdpZHRoID0gMSA8PCBkaW1lbnNpb25zLlBQeDsKICBjb25zdCBwcmVjaW5jdEhlaWdodCA9IDEgPDwgZGltZW5zaW9ucy5QUHk7CiAgY29uc3QgaXNaZXJvUmVzID0gcmVzb2x1dGlvbi5yZXNMZXZlbCA9PT0gMDsKICBjb25zdCBwcmVjaW5jdFdpZHRoSW5TdWJiYW5kID0gMSA8PCBkaW1lbnNpb25zLlBQeCArIChpc1plcm9SZXMgPyAwIDogLTEpOwogIGNvbnN0IHByZWNpbmN0SGVpZ2h0SW5TdWJiYW5kID0gMSA8PCBkaW1lbnNpb25zLlBQeSArIChpc1plcm9SZXMgPyAwIDogLTEpOwogIGNvbnN0IG51bXByZWNpbmN0c3dpZGUgPSByZXNvbHV0aW9uLnRyeDEgPiByZXNvbHV0aW9uLnRyeDAgPyBNYXRoLmNlaWwocmVzb2x1dGlvbi50cngxIC8gcHJlY2luY3RXaWR0aCkgLSBNYXRoLmZsb29yKHJlc29sdXRpb24udHJ4MCAvIHByZWNpbmN0V2lkdGgpIDogMDsKICBjb25zdCBudW1wcmVjaW5jdHNoaWdoID0gcmVzb2x1dGlvbi50cnkxID4gcmVzb2x1dGlvbi50cnkwID8gTWF0aC5jZWlsKHJlc29sdXRpb24udHJ5MSAvIHByZWNpbmN0SGVpZ2h0KSAtIE1hdGguZmxvb3IocmVzb2x1dGlvbi50cnkwIC8gcHJlY2luY3RIZWlnaHQpIDogMDsKICBjb25zdCBudW1wcmVjaW5jdHMgPSBudW1wcmVjaW5jdHN3aWRlICogbnVtcHJlY2luY3RzaGlnaDsKICByZXNvbHV0aW9uLnByZWNpbmN0UGFyYW1ldGVycyA9IHsKICAgIHByZWNpbmN0V2lkdGgsCiAgICBwcmVjaW5jdEhlaWdodCwKICAgIG51bXByZWNpbmN0c3dpZGUsCiAgICBudW1wcmVjaW5jdHNoaWdoLAogICAgbnVtcHJlY2luY3RzLAogICAgcHJlY2luY3RXaWR0aEluU3ViYmFuZCwKICAgIHByZWNpbmN0SGVpZ2h0SW5TdWJiYW5kCiAgfTsKfQpmdW5jdGlvbiBidWlsZENvZGVibG9ja3MoY29udGV4dCwgc3ViYmFuZCwgZGltZW5zaW9ucykgewogIGNvbnN0IHhjYl8gPSBkaW1lbnNpb25zLnhjYl87CiAgY29uc3QgeWNiXyA9IGRpbWVuc2lvbnMueWNiXzsKICBjb25zdCBjb2RlYmxvY2tXaWR0aCA9IDEgPDwgeGNiXzsKICBjb25zdCBjb2RlYmxvY2tIZWlnaHQgPSAxIDw8IHljYl87CiAgY29uc3QgY2J4MCA9IHN1YmJhbmQudGJ4MCA+PiB4Y2JfOwogIGNvbnN0IGNieTAgPSBzdWJiYW5kLnRieTAgPj4geWNiXzsKICBjb25zdCBjYngxID0gc3ViYmFuZC50YngxICsgY29kZWJsb2NrV2lkdGggLSAxID4+IHhjYl87CiAgY29uc3QgY2J5MSA9IHN1YmJhbmQudGJ5MSArIGNvZGVibG9ja0hlaWdodCAtIDEgPj4geWNiXzsKICBjb25zdCBwcmVjaW5jdFBhcmFtZXRlcnMgPSBzdWJiYW5kLnJlc29sdXRpb24ucHJlY2luY3RQYXJhbWV0ZXJzOwogIGNvbnN0IGNvZGVibG9ja3MgPSBbXTsKICBjb25zdCBwcmVjaW5jdHMgPSBbXTsKICBsZXQgaSwgaiwgY29kZWJsb2NrLCBwcmVjaW5jdE51bWJlcjsKICBmb3IgKGogPSBjYnkwOyBqIDwgY2J5MTsgaisrKSB7CiAgICBmb3IgKGkgPSBjYngwOyBpIDwgY2J4MTsgaSsrKSB7CiAgICAgIGNvZGVibG9jayA9IHsKICAgICAgICBjYng6IGksCiAgICAgICAgY2J5OiBqLAogICAgICAgIHRieDA6IGNvZGVibG9ja1dpZHRoICogaSwKICAgICAgICB0YnkwOiBjb2RlYmxvY2tIZWlnaHQgKiBqLAogICAgICAgIHRieDE6IGNvZGVibG9ja1dpZHRoICogKGkgKyAxKSwKICAgICAgICB0YnkxOiBjb2RlYmxvY2tIZWlnaHQgKiAoaiArIDEpCiAgICAgIH07CiAgICAgIGNvZGVibG9jay50YngwXyA9IE1hdGgubWF4KHN1YmJhbmQudGJ4MCwgY29kZWJsb2NrLnRieDApOwogICAgICBjb2RlYmxvY2sudGJ5MF8gPSBNYXRoLm1heChzdWJiYW5kLnRieTAsIGNvZGVibG9jay50YnkwKTsKICAgICAgY29kZWJsb2NrLnRieDFfID0gTWF0aC5taW4oc3ViYmFuZC50YngxLCBjb2RlYmxvY2sudGJ4MSk7CiAgICAgIGNvZGVibG9jay50YnkxXyA9IE1hdGgubWluKHN1YmJhbmQudGJ5MSwgY29kZWJsb2NrLnRieTEpOwogICAgICBjb25zdCBwaSA9IE1hdGguZmxvb3IoKGNvZGVibG9jay50YngwXyAtIHN1YmJhbmQudGJ4MCkgLyBwcmVjaW5jdFBhcmFtZXRlcnMucHJlY2luY3RXaWR0aEluU3ViYmFuZCk7CiAgICAgIGNvbnN0IHBqID0gTWF0aC5mbG9vcigoY29kZWJsb2NrLnRieTBfIC0gc3ViYmFuZC50YnkwKSAvIHByZWNpbmN0UGFyYW1ldGVycy5wcmVjaW5jdEhlaWdodEluU3ViYmFuZCk7CiAgICAgIHByZWNpbmN0TnVtYmVyID0gcGkgKyBwaiAqIHByZWNpbmN0UGFyYW1ldGVycy5udW1wcmVjaW5jdHN3aWRlOwogICAgICBjb2RlYmxvY2sucHJlY2luY3ROdW1iZXIgPSBwcmVjaW5jdE51bWJlcjsKICAgICAgY29kZWJsb2NrLnN1YmJhbmRUeXBlID0gc3ViYmFuZC50eXBlOwogICAgICBjb2RlYmxvY2suTGJsb2NrID0gMzsKICAgICAgaWYgKGNvZGVibG9jay50YngxXyA8PSBjb2RlYmxvY2sudGJ4MF8gfHwgY29kZWJsb2NrLnRieTFfIDw9IGNvZGVibG9jay50YnkwXykgewogICAgICAgIGNvbnRpbnVlOwogICAgICB9CiAgICAgIGNvZGVibG9ja3MucHVzaChjb2RlYmxvY2spOwogICAgICBsZXQgcHJlY2luY3QgPSBwcmVjaW5jdHNbcHJlY2luY3ROdW1iZXJdOwogICAgICBpZiAocHJlY2luY3QgIT09IHVuZGVmaW5lZCkgewogICAgICAgIGlmIChpIDwgcHJlY2luY3QuY2J4TWluKSB7CiAgICAgICAgICBwcmVjaW5jdC5jYnhNaW4gPSBpOwogICAgICAgIH0gZWxzZSBpZiAoaSA+IHByZWNpbmN0LmNieE1heCkgewogICAgICAgICAgcHJlY2luY3QuY2J4TWF4ID0gaTsKICAgICAgICB9CiAgICAgICAgaWYgKGogPCBwcmVjaW5jdC5jYnlNaW4pIHsKICAgICAgICAgIHByZWNpbmN0LmNieE1pbiA9IGo7CiAgICAgICAgfSBlbHNlIGlmIChqID4gcHJlY2luY3QuY2J5TWF4KSB7CiAgICAgICAgICBwcmVjaW5jdC5jYnlNYXggPSBqOwogICAgICAgIH0KICAgICAgfSBlbHNlIHsKICAgICAgICBwcmVjaW5jdHNbcHJlY2luY3ROdW1iZXJdID0gcHJlY2luY3QgPSB7CiAgICAgICAgICBjYnhNaW46IGksCiAgICAgICAgICBjYnlNaW46IGosCiAgICAgICAgICBjYnhNYXg6IGksCiAgICAgICAgICBjYnlNYXg6IGoKICAgICAgICB9OwogICAgICB9CiAgICAgIGNvZGVibG9jay5wcmVjaW5jdCA9IHByZWNpbmN0OwogICAgfQogIH0KICBzdWJiYW5kLmNvZGVibG9ja1BhcmFtZXRlcnMgPSB7CiAgICBjb2RlYmxvY2tXaWR0aDogeGNiXywKICAgIGNvZGVibG9ja0hlaWdodDogeWNiXywKICAgIG51bWNvZGVibG9ja3dpZGU6IGNieDEgLSBjYngwICsgMSwKICAgIG51bWNvZGVibG9ja2hpZ2g6IGNieTEgLSBjYnkwICsgMQogIH07CiAgc3ViYmFuZC5jb2RlYmxvY2tzID0gY29kZWJsb2NrczsKICBzdWJiYW5kLnByZWNpbmN0cyA9IHByZWNpbmN0czsKfQpmdW5jdGlvbiBjcmVhdGVQYWNrZXQocmVzb2x1dGlvbiwgcHJlY2luY3ROdW1iZXIsIGxheWVyTnVtYmVyKSB7CiAgY29uc3QgcHJlY2luY3RDb2RlYmxvY2tzID0gW107CiAgY29uc3Qgc3ViYmFuZHMgPSByZXNvbHV0aW9uLnN1YmJhbmRzOwogIGZvciAobGV0IGkgPSAwLCBpaSA9IHN1YmJhbmRzLmxlbmd0aDsgaSA8IGlpOyBpKyspIHsKICAgIGNvbnN0IHN1YmJhbmQgPSBzdWJiYW5kc1tpXTsKICAgIGNvbnN0IGNvZGVibG9ja3MgPSBzdWJiYW5kLmNvZGVibG9ja3M7CiAgICBmb3IgKGxldCBqID0gMCwgamogPSBjb2RlYmxvY2tzLmxlbmd0aDsgaiA8IGpqOyBqKyspIHsKICAgICAgY29uc3QgY29kZWJsb2NrID0gY29kZWJsb2Nrc1tqXTsKICAgICAgaWYgKGNvZGVibG9jay5wcmVjaW5jdE51bWJlciAhPT0gcHJlY2luY3ROdW1iZXIpIHsKICAgICAgICBjb250aW51ZTsKICAgICAgfQogICAgICBwcmVjaW5jdENvZGVibG9ja3MucHVzaChjb2RlYmxvY2spOwogICAgfQogIH0KICByZXR1cm4gewogICAgbGF5ZXJOdW1iZXIsCiAgICBjb2RlYmxvY2tzOiBwcmVjaW5jdENvZGVibG9ja3MKICB9Owp9CmZ1bmN0aW9uIExheWVyUmVzb2x1dGlvbkNvbXBvbmVudFBvc2l0aW9uSXRlcmF0b3IoY29udGV4dCkgewogIGNvbnN0IHNpeiA9IGNvbnRleHQuU0laOwogIGNvbnN0IHRpbGVJbmRleCA9IGNvbnRleHQuY3VycmVudFRpbGUuaW5kZXg7CiAgY29uc3QgdGlsZSA9IGNvbnRleHQudGlsZXNbdGlsZUluZGV4XTsKICBjb25zdCBsYXllcnNDb3VudCA9IHRpbGUuY29kaW5nU3R5bGVEZWZhdWx0UGFyYW1ldGVycy5sYXllcnNDb3VudDsKICBjb25zdCBjb21wb25lbnRzQ291bnQgPSBzaXouQ3NpejsKICBsZXQgbWF4RGVjb21wb3NpdGlvbkxldmVsc0NvdW50ID0gMDsKICBmb3IgKGxldCBxID0gMDsgcSA8IGNvbXBvbmVudHNDb3VudDsgcSsrKSB7CiAgICBtYXhEZWNvbXBvc2l0aW9uTGV2ZWxzQ291bnQgPSBNYXRoLm1heChtYXhEZWNvbXBvc2l0aW9uTGV2ZWxzQ291bnQsIHRpbGUuY29tcG9uZW50c1txXS5jb2RpbmdTdHlsZVBhcmFtZXRlcnMuZGVjb21wb3NpdGlvbkxldmVsc0NvdW50KTsKICB9CiAgbGV0IGwgPSAwLAogICAgciA9IDAsCiAgICBpID0gMCwKICAgIGsgPSAwOwogIHRoaXMubmV4dFBhY2tldCA9IGZ1bmN0aW9uIEpweEltYWdlX25leHRQYWNrZXQoKSB7CiAgICBmb3IgKDsgbCA8IGxheWVyc0NvdW50OyBsKyspIHsKICAgICAgZm9yICg7IHIgPD0gbWF4RGVjb21wb3NpdGlvbkxldmVsc0NvdW50OyByKyspIHsKICAgICAgICBmb3IgKDsgaSA8IGNvbXBvbmVudHNDb3VudDsgaSsrKSB7CiAgICAgICAgICBjb25zdCBjb21wb25lbnQgPSB0aWxlLmNvbXBvbmVudHNbaV07CiAgICAgICAgICBpZiAociA+IGNvbXBvbmVudC5jb2RpbmdTdHlsZVBhcmFtZXRlcnMuZGVjb21wb3NpdGlvbkxldmVsc0NvdW50KSB7CiAgICAgICAgICAgIGNvbnRpbnVlOwogICAgICAgICAgfQogICAgICAgICAgY29uc3QgcmVzb2x1dGlvbiA9IGNvbXBvbmVudC5yZXNvbHV0aW9uc1tyXTsKICAgICAgICAgIGNvbnN0IG51bXByZWNpbmN0cyA9IHJlc29sdXRpb24ucHJlY2luY3RQYXJhbWV0ZXJzLm51bXByZWNpbmN0czsKICAgICAgICAgIGZvciAoOyBrIDwgbnVtcHJlY2luY3RzOykgewogICAgICAgICAgICBjb25zdCBwYWNrZXQgPSBjcmVhdGVQYWNrZXQocmVzb2x1dGlvbiwgaywgbCk7CiAgICAgICAgICAgIGsrKzsKICAgICAgICAgICAgcmV0dXJuIHBhY2tldDsKICAgICAgICAgIH0KICAgICAgICAgIGsgPSAwOwogICAgICAgIH0KICAgICAgICBpID0gMDsKICAgICAgfQogICAgICByID0gMDsKICAgIH0KICAgIHRocm93IG5ldyBKcHhFcnJvcigiT3V0IG9mIHBhY2tldHMiKTsKICB9Owp9CmZ1bmN0aW9uIFJlc29sdXRpb25MYXllckNvbXBvbmVudFBvc2l0aW9uSXRlcmF0b3IoY29udGV4dCkgewogIGNvbnN0IHNpeiA9IGNvbnRleHQuU0laOwogIGNvbnN0IHRpbGVJbmRleCA9IGNvbnRleHQuY3VycmVudFRpbGUuaW5kZXg7CiAgY29uc3QgdGlsZSA9IGNvbnRleHQudGlsZXNbdGlsZUluZGV4XTsKICBjb25zdCBsYXllcnNDb3VudCA9IHRpbGUuY29kaW5nU3R5bGVEZWZhdWx0UGFyYW1ldGVycy5sYXllcnNDb3VudDsKICBjb25zdCBjb21wb25lbnRzQ291bnQgPSBzaXouQ3NpejsKICBsZXQgbWF4RGVjb21wb3NpdGlvbkxldmVsc0NvdW50ID0gMDsKICBmb3IgKGxldCBxID0gMDsgcSA8IGNvbXBvbmVudHNDb3VudDsgcSsrKSB7CiAgICBtYXhEZWNvbXBvc2l0aW9uTGV2ZWxzQ291bnQgPSBNYXRoLm1heChtYXhEZWNvbXBvc2l0aW9uTGV2ZWxzQ291bnQsIHRpbGUuY29tcG9uZW50c1txXS5jb2RpbmdTdHlsZVBhcmFtZXRlcnMuZGVjb21wb3NpdGlvbkxldmVsc0NvdW50KTsKICB9CiAgbGV0IHIgPSAwLAogICAgbCA9IDAsCiAgICBpID0gMCwKICAgIGsgPSAwOwogIHRoaXMubmV4dFBhY2tldCA9IGZ1bmN0aW9uIEpweEltYWdlX25leHRQYWNrZXQoKSB7CiAgICBmb3IgKDsgciA8PSBtYXhEZWNvbXBvc2l0aW9uTGV2ZWxzQ291bnQ7IHIrKykgewogICAgICBmb3IgKDsgbCA8IGxheWVyc0NvdW50OyBsKyspIHsKICAgICAgICBmb3IgKDsgaSA8IGNvbXBvbmVudHNDb3VudDsgaSsrKSB7CiAgICAgICAgICBjb25zdCBjb21wb25lbnQgPSB0aWxlLmNvbXBvbmVudHNbaV07CiAgICAgICAgICBpZiAociA+IGNvbXBvbmVudC5jb2RpbmdTdHlsZVBhcmFtZXRlcnMuZGVjb21wb3NpdGlvbkxldmVsc0NvdW50KSB7CiAgICAgICAgICAgIGNvbnRpbnVlOwogICAgICAgICAgfQogICAgICAgICAgY29uc3QgcmVzb2x1dGlvbiA9IGNvbXBvbmVudC5yZXNvbHV0aW9uc1tyXTsKICAgICAgICAgIGNvbnN0IG51bXByZWNpbmN0cyA9IHJlc29sdXRpb24ucHJlY2luY3RQYXJhbWV0ZXJzLm51bXByZWNpbmN0czsKICAgICAgICAgIGZvciAoOyBrIDwgbnVtcHJlY2luY3RzOykgewogICAgICAgICAgICBjb25zdCBwYWNrZXQgPSBjcmVhdGVQYWNrZXQocmVzb2x1dGlvbiwgaywgbCk7CiAgICAgICAgICAgIGsrKzsKICAgICAgICAgICAgcmV0dXJuIHBhY2tldDsKICAgICAgICAgIH0KICAgICAgICAgIGsgPSAwOwogICAgICAgIH0KICAgICAgICBpID0gMDsKICAgICAgfQogICAgICBsID0gMDsKICAgIH0KICAgIHRocm93IG5ldyBKcHhFcnJvcigiT3V0IG9mIHBhY2tldHMiKTsKICB9Owp9CmZ1bmN0aW9uIFJlc29sdXRpb25Qb3NpdGlvbkNvbXBvbmVudExheWVySXRlcmF0b3IoY29udGV4dCkgewogIGNvbnN0IHNpeiA9IGNvbnRleHQuU0laOwogIGNvbnN0IHRpbGVJbmRleCA9IGNvbnRleHQuY3VycmVudFRpbGUuaW5kZXg7CiAgY29uc3QgdGlsZSA9IGNvbnRleHQudGlsZXNbdGlsZUluZGV4XTsKICBjb25zdCBsYXllcnNDb3VudCA9IHRpbGUuY29kaW5nU3R5bGVEZWZhdWx0UGFyYW1ldGVycy5sYXllcnNDb3VudDsKICBjb25zdCBjb21wb25lbnRzQ291bnQgPSBzaXouQ3NpejsKICBsZXQgbCwgciwgYywgcDsKICBsZXQgbWF4RGVjb21wb3NpdGlvbkxldmVsc0NvdW50ID0gMDsKICBmb3IgKGMgPSAwOyBjIDwgY29tcG9uZW50c0NvdW50OyBjKyspIHsKICAgIGNvbnN0IGNvbXBvbmVudCA9IHRpbGUuY29tcG9uZW50c1tjXTsKICAgIG1heERlY29tcG9zaXRpb25MZXZlbHNDb3VudCA9IE1hdGgubWF4KG1heERlY29tcG9zaXRpb25MZXZlbHNDb3VudCwgY29tcG9uZW50LmNvZGluZ1N0eWxlUGFyYW1ldGVycy5kZWNvbXBvc2l0aW9uTGV2ZWxzQ291bnQpOwogIH0KICBjb25zdCBtYXhOdW1QcmVjaW5jdHNJbkxldmVsID0gbmV3IEludDMyQXJyYXkobWF4RGVjb21wb3NpdGlvbkxldmVsc0NvdW50ICsgMSk7CiAgZm9yIChyID0gMDsgciA8PSBtYXhEZWNvbXBvc2l0aW9uTGV2ZWxzQ291bnQ7ICsrcikgewogICAgbGV0IG1heE51bVByZWNpbmN0cyA9IDA7CiAgICBmb3IgKGMgPSAwOyBjIDwgY29tcG9uZW50c0NvdW50OyArK2MpIHsKICAgICAgY29uc3QgcmVzb2x1dGlvbnMgPSB0aWxlLmNvbXBvbmVudHNbY10ucmVzb2x1dGlvbnM7CiAgICAgIGlmIChyIDwgcmVzb2x1dGlvbnMubGVuZ3RoKSB7CiAgICAgICAgbWF4TnVtUHJlY2luY3RzID0gTWF0aC5tYXgobWF4TnVtUHJlY2luY3RzLCByZXNvbHV0aW9uc1tyXS5wcmVjaW5jdFBhcmFtZXRlcnMubnVtcHJlY2luY3RzKTsKICAgICAgfQogICAgfQogICAgbWF4TnVtUHJlY2luY3RzSW5MZXZlbFtyXSA9IG1heE51bVByZWNpbmN0czsKICB9CiAgbCA9IDA7CiAgciA9IDA7CiAgYyA9IDA7CiAgcCA9IDA7CiAgdGhpcy5uZXh0UGFja2V0ID0gZnVuY3Rpb24gSnB4SW1hZ2VfbmV4dFBhY2tldCgpIHsKICAgIGZvciAoOyByIDw9IG1heERlY29tcG9zaXRpb25MZXZlbHNDb3VudDsgcisrKSB7CiAgICAgIGZvciAoOyBwIDwgbWF4TnVtUHJlY2luY3RzSW5MZXZlbFtyXTsgcCsrKSB7CiAgICAgICAgZm9yICg7IGMgPCBjb21wb25lbnRzQ291bnQ7IGMrKykgewogICAgICAgICAgY29uc3QgY29tcG9uZW50ID0gdGlsZS5jb21wb25lbnRzW2NdOwogICAgICAgICAgaWYgKHIgPiBjb21wb25lbnQuY29kaW5nU3R5bGVQYXJhbWV0ZXJzLmRlY29tcG9zaXRpb25MZXZlbHNDb3VudCkgewogICAgICAgICAgICBjb250aW51ZTsKICAgICAgICAgIH0KICAgICAgICAgIGNvbnN0IHJlc29sdXRpb24gPSBjb21wb25lbnQucmVzb2x1dGlvbnNbcl07CiAgICAgICAgICBjb25zdCBudW1wcmVjaW5jdHMgPSByZXNvbHV0aW9uLnByZWNpbmN0UGFyYW1ldGVycy5udW1wcmVjaW5jdHM7CiAgICAgICAgICBpZiAocCA+PSBudW1wcmVjaW5jdHMpIHsKICAgICAgICAgICAgY29udGludWU7CiAgICAgICAgICB9CiAgICAgICAgICBmb3IgKDsgbCA8IGxheWVyc0NvdW50OykgewogICAgICAgICAgICBjb25zdCBwYWNrZXQgPSBjcmVhdGVQYWNrZXQocmVzb2x1dGlvbiwgcCwgbCk7CiAgICAgICAgICAgIGwrKzsKICAgICAgICAgICAgcmV0dXJuIHBhY2tldDsKICAgICAgICAgIH0KICAgICAgICAgIGwgPSAwOwogICAgICAgIH0KICAgICAgICBjID0gMDsKICAgICAgfQogICAgICBwID0gMDsKICAgIH0KICAgIHRocm93IG5ldyBKcHhFcnJvcigiT3V0IG9mIHBhY2tldHMiKTsKICB9Owp9CmZ1bmN0aW9uIFBvc2l0aW9uQ29tcG9uZW50UmVzb2x1dGlvbkxheWVySXRlcmF0b3IoY29udGV4dCkgewogIGNvbnN0IHNpeiA9IGNvbnRleHQuU0laOwogIGNvbnN0IHRpbGVJbmRleCA9IGNvbnRleHQuY3VycmVudFRpbGUuaW5kZXg7CiAgY29uc3QgdGlsZSA9IGNvbnRleHQudGlsZXNbdGlsZUluZGV4XTsKICBjb25zdCBsYXllcnNDb3VudCA9IHRpbGUuY29kaW5nU3R5bGVEZWZhdWx0UGFyYW1ldGVycy5sYXllcnNDb3VudDsKICBjb25zdCBjb21wb25lbnRzQ291bnQgPSBzaXouQ3NpejsKICBjb25zdCBwcmVjaW5jdHNTaXplcyA9IGdldFByZWNpbmN0U2l6ZXNJbkltYWdlU2NhbGUodGlsZSk7CiAgY29uc3QgcHJlY2luY3RzSXRlcmF0aW9uU2l6ZXMgPSBwcmVjaW5jdHNTaXplczsKICBsZXQgbCA9IDAsCiAgICByID0gMCwKICAgIGMgPSAwLAogICAgcHggPSAwLAogICAgcHkgPSAwOwogIHRoaXMubmV4dFBhY2tldCA9IGZ1bmN0aW9uIEpweEltYWdlX25leHRQYWNrZXQoKSB7CiAgICBmb3IgKDsgcHkgPCBwcmVjaW5jdHNJdGVyYXRpb25TaXplcy5tYXhOdW1IaWdoOyBweSsrKSB7CiAgICAgIGZvciAoOyBweCA8IHByZWNpbmN0c0l0ZXJhdGlvblNpemVzLm1heE51bVdpZGU7IHB4KyspIHsKICAgICAgICBmb3IgKDsgYyA8IGNvbXBvbmVudHNDb3VudDsgYysrKSB7CiAgICAgICAgICBjb25zdCBjb21wb25lbnQgPSB0aWxlLmNvbXBvbmVudHNbY107CiAgICAgICAgICBjb25zdCBkZWNvbXBvc2l0aW9uTGV2ZWxzQ291bnQgPSBjb21wb25lbnQuY29kaW5nU3R5bGVQYXJhbWV0ZXJzLmRlY29tcG9zaXRpb25MZXZlbHNDb3VudDsKICAgICAgICAgIGZvciAoOyByIDw9IGRlY29tcG9zaXRpb25MZXZlbHNDb3VudDsgcisrKSB7CiAgICAgICAgICAgIGNvbnN0IHJlc29sdXRpb24gPSBjb21wb25lbnQucmVzb2x1dGlvbnNbcl07CiAgICAgICAgICAgIGNvbnN0IHNpemVJbkltYWdlU2NhbGUgPSBwcmVjaW5jdHNTaXplcy5jb21wb25lbnRzW2NdLnJlc29sdXRpb25zW3JdOwogICAgICAgICAgICBjb25zdCBrID0gZ2V0UHJlY2luY3RJbmRleElmRXhpc3QocHgsIHB5LCBzaXplSW5JbWFnZVNjYWxlLCBwcmVjaW5jdHNJdGVyYXRpb25TaXplcywgcmVzb2x1dGlvbik7CiAgICAgICAgICAgIGlmIChrID09PSBudWxsKSB7CiAgICAgICAgICAgICAgY29udGludWU7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgZm9yICg7IGwgPCBsYXllcnNDb3VudDspIHsKICAgICAgICAgICAgICBjb25zdCBwYWNrZXQgPSBjcmVhdGVQYWNrZXQocmVzb2x1dGlvbiwgaywgbCk7CiAgICAgICAgICAgICAgbCsrOwogICAgICAgICAgICAgIHJldHVybiBwYWNrZXQ7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgbCA9IDA7CiAgICAgICAgICB9CiAgICAgICAgICByID0gMDsKICAgICAgICB9CiAgICAgICAgYyA9IDA7CiAgICAgIH0KICAgICAgcHggPSAwOwogICAgfQogICAgdGhyb3cgbmV3IEpweEVycm9yKCJPdXQgb2YgcGFja2V0cyIpOwogIH07Cn0KZnVuY3Rpb24gQ29tcG9uZW50UG9zaXRpb25SZXNvbHV0aW9uTGF5ZXJJdGVyYXRvcihjb250ZXh0KSB7CiAgY29uc3Qgc2l6ID0gY29udGV4dC5TSVo7CiAgY29uc3QgdGlsZUluZGV4ID0gY29udGV4dC5jdXJyZW50VGlsZS5pbmRleDsKICBjb25zdCB0aWxlID0gY29udGV4dC50aWxlc1t0aWxlSW5kZXhdOwogIGNvbnN0IGxheWVyc0NvdW50ID0gdGlsZS5jb2RpbmdTdHlsZURlZmF1bHRQYXJhbWV0ZXJzLmxheWVyc0NvdW50OwogIGNvbnN0IGNvbXBvbmVudHNDb3VudCA9IHNpei5Dc2l6OwogIGNvbnN0IHByZWNpbmN0c1NpemVzID0gZ2V0UHJlY2luY3RTaXplc0luSW1hZ2VTY2FsZSh0aWxlKTsKICBsZXQgbCA9IDAsCiAgICByID0gMCwKICAgIGMgPSAwLAogICAgcHggPSAwLAogICAgcHkgPSAwOwogIHRoaXMubmV4dFBhY2tldCA9IGZ1bmN0aW9uIEpweEltYWdlX25leHRQYWNrZXQoKSB7CiAgICBmb3IgKDsgYyA8IGNvbXBvbmVudHNDb3VudDsgKytjKSB7CiAgICAgIGNvbnN0IGNvbXBvbmVudCA9IHRpbGUuY29tcG9uZW50c1tjXTsKICAgICAgY29uc3QgcHJlY2luY3RzSXRlcmF0aW9uU2l6ZXMgPSBwcmVjaW5jdHNTaXplcy5jb21wb25lbnRzW2NdOwogICAgICBjb25zdCBkZWNvbXBvc2l0aW9uTGV2ZWxzQ291bnQgPSBjb21wb25lbnQuY29kaW5nU3R5bGVQYXJhbWV0ZXJzLmRlY29tcG9zaXRpb25MZXZlbHNDb3VudDsKICAgICAgZm9yICg7IHB5IDwgcHJlY2luY3RzSXRlcmF0aW9uU2l6ZXMubWF4TnVtSGlnaDsgcHkrKykgewogICAgICAgIGZvciAoOyBweCA8IHByZWNpbmN0c0l0ZXJhdGlvblNpemVzLm1heE51bVdpZGU7IHB4KyspIHsKICAgICAgICAgIGZvciAoOyByIDw9IGRlY29tcG9zaXRpb25MZXZlbHNDb3VudDsgcisrKSB7CiAgICAgICAgICAgIGNvbnN0IHJlc29sdXRpb24gPSBjb21wb25lbnQucmVzb2x1dGlvbnNbcl07CiAgICAgICAgICAgIGNvbnN0IHNpemVJbkltYWdlU2NhbGUgPSBwcmVjaW5jdHNJdGVyYXRpb25TaXplcy5yZXNvbHV0aW9uc1tyXTsKICAgICAgICAgICAgY29uc3QgayA9IGdldFByZWNpbmN0SW5kZXhJZkV4aXN0KHB4LCBweSwgc2l6ZUluSW1hZ2VTY2FsZSwgcHJlY2luY3RzSXRlcmF0aW9uU2l6ZXMsIHJlc29sdXRpb24pOwogICAgICAgICAgICBpZiAoayA9PT0gbnVsbCkgewogICAgICAgICAgICAgIGNvbnRpbnVlOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGZvciAoOyBsIDwgbGF5ZXJzQ291bnQ7KSB7CiAgICAgICAgICAgICAgY29uc3QgcGFja2V0ID0gY3JlYXRlUGFja2V0KHJlc29sdXRpb24sIGssIGwpOwogICAgICAgICAgICAgIGwrKzsKICAgICAgICAgICAgICByZXR1cm4gcGFja2V0OwogICAgICAgICAgICB9CiAgICAgICAgICAgIGwgPSAwOwogICAgICAgICAgfQogICAgICAgICAgciA9IDA7CiAgICAgICAgfQogICAgICAgIHB4ID0gMDsKICAgICAgfQogICAgICBweSA9IDA7CiAgICB9CiAgICB0aHJvdyBuZXcgSnB4RXJyb3IoIk91dCBvZiBwYWNrZXRzIik7CiAgfTsKfQpmdW5jdGlvbiBnZXRQcmVjaW5jdEluZGV4SWZFeGlzdChweEluZGV4LCBweUluZGV4LCBzaXplSW5JbWFnZVNjYWxlLCBwcmVjaW5jdEl0ZXJhdGlvblNpemVzLCByZXNvbHV0aW9uKSB7CiAgY29uc3QgcG9zWCA9IHB4SW5kZXggKiBwcmVjaW5jdEl0ZXJhdGlvblNpemVzLm1pbldpZHRoOwogIGNvbnN0IHBvc1kgPSBweUluZGV4ICogcHJlY2luY3RJdGVyYXRpb25TaXplcy5taW5IZWlnaHQ7CiAgaWYgKHBvc1ggJSBzaXplSW5JbWFnZVNjYWxlLndpZHRoICE9PSAwIHx8IHBvc1kgJSBzaXplSW5JbWFnZVNjYWxlLmhlaWdodCAhPT0gMCkgewogICAgcmV0dXJuIG51bGw7CiAgfQogIGNvbnN0IHN0YXJ0UHJlY2luY3RSb3dJbmRleCA9IHBvc1kgLyBzaXplSW5JbWFnZVNjYWxlLndpZHRoICogcmVzb2x1dGlvbi5wcmVjaW5jdFBhcmFtZXRlcnMubnVtcHJlY2luY3Rzd2lkZTsKICByZXR1cm4gcG9zWCAvIHNpemVJbkltYWdlU2NhbGUuaGVpZ2h0ICsgc3RhcnRQcmVjaW5jdFJvd0luZGV4Owp9CmZ1bmN0aW9uIGdldFByZWNpbmN0U2l6ZXNJbkltYWdlU2NhbGUodGlsZSkgewogIGNvbnN0IGNvbXBvbmVudHNDb3VudCA9IHRpbGUuY29tcG9uZW50cy5sZW5ndGg7CiAgbGV0IG1pbldpZHRoID0gTnVtYmVyLk1BWF9WQUxVRTsKICBsZXQgbWluSGVpZ2h0ID0gTnVtYmVyLk1BWF9WQUxVRTsKICBsZXQgbWF4TnVtV2lkZSA9IDA7CiAgbGV0IG1heE51bUhpZ2ggPSAwOwogIGNvbnN0IHNpemVQZXJDb21wb25lbnQgPSBuZXcgQXJyYXkoY29tcG9uZW50c0NvdW50KTsKICBmb3IgKGxldCBjID0gMDsgYyA8IGNvbXBvbmVudHNDb3VudDsgYysrKSB7CiAgICBjb25zdCBjb21wb25lbnQgPSB0aWxlLmNvbXBvbmVudHNbY107CiAgICBjb25zdCBkZWNvbXBvc2l0aW9uTGV2ZWxzQ291bnQgPSBjb21wb25lbnQuY29kaW5nU3R5bGVQYXJhbWV0ZXJzLmRlY29tcG9zaXRpb25MZXZlbHNDb3VudDsKICAgIGNvbnN0IHNpemVQZXJSZXNvbHV0aW9uID0gbmV3IEFycmF5KGRlY29tcG9zaXRpb25MZXZlbHNDb3VudCArIDEpOwogICAgbGV0IG1pbldpZHRoQ3VycmVudENvbXBvbmVudCA9IE51bWJlci5NQVhfVkFMVUU7CiAgICBsZXQgbWluSGVpZ2h0Q3VycmVudENvbXBvbmVudCA9IE51bWJlci5NQVhfVkFMVUU7CiAgICBsZXQgbWF4TnVtV2lkZUN1cnJlbnRDb21wb25lbnQgPSAwOwogICAgbGV0IG1heE51bUhpZ2hDdXJyZW50Q29tcG9uZW50ID0gMDsKICAgIGxldCBzY2FsZSA9IDE7CiAgICBmb3IgKGxldCByID0gZGVjb21wb3NpdGlvbkxldmVsc0NvdW50OyByID49IDA7IC0tcikgewogICAgICBjb25zdCByZXNvbHV0aW9uID0gY29tcG9uZW50LnJlc29sdXRpb25zW3JdOwogICAgICBjb25zdCB3aWR0aEN1cnJlbnRSZXNvbHV0aW9uID0gc2NhbGUgKiByZXNvbHV0aW9uLnByZWNpbmN0UGFyYW1ldGVycy5wcmVjaW5jdFdpZHRoOwogICAgICBjb25zdCBoZWlnaHRDdXJyZW50UmVzb2x1dGlvbiA9IHNjYWxlICogcmVzb2x1dGlvbi5wcmVjaW5jdFBhcmFtZXRlcnMucHJlY2luY3RIZWlnaHQ7CiAgICAgIG1pbldpZHRoQ3VycmVudENvbXBvbmVudCA9IE1hdGgubWluKG1pbldpZHRoQ3VycmVudENvbXBvbmVudCwgd2lkdGhDdXJyZW50UmVzb2x1dGlvbik7CiAgICAgIG1pbkhlaWdodEN1cnJlbnRDb21wb25lbnQgPSBNYXRoLm1pbihtaW5IZWlnaHRDdXJyZW50Q29tcG9uZW50LCBoZWlnaHRDdXJyZW50UmVzb2x1dGlvbik7CiAgICAgIG1heE51bVdpZGVDdXJyZW50Q29tcG9uZW50ID0gTWF0aC5tYXgobWF4TnVtV2lkZUN1cnJlbnRDb21wb25lbnQsIHJlc29sdXRpb24ucHJlY2luY3RQYXJhbWV0ZXJzLm51bXByZWNpbmN0c3dpZGUpOwogICAgICBtYXhOdW1IaWdoQ3VycmVudENvbXBvbmVudCA9IE1hdGgubWF4KG1heE51bUhpZ2hDdXJyZW50Q29tcG9uZW50LCByZXNvbHV0aW9uLnByZWNpbmN0UGFyYW1ldGVycy5udW1wcmVjaW5jdHNoaWdoKTsKICAgICAgc2l6ZVBlclJlc29sdXRpb25bcl0gPSB7CiAgICAgICAgd2lkdGg6IHdpZHRoQ3VycmVudFJlc29sdXRpb24sCiAgICAgICAgaGVpZ2h0OiBoZWlnaHRDdXJyZW50UmVzb2x1dGlvbgogICAgICB9OwogICAgICBzY2FsZSA8PD0gMTsKICAgIH0KICAgIG1pbldpZHRoID0gTWF0aC5taW4obWluV2lkdGgsIG1pbldpZHRoQ3VycmVudENvbXBvbmVudCk7CiAgICBtaW5IZWlnaHQgPSBNYXRoLm1pbihtaW5IZWlnaHQsIG1pbkhlaWdodEN1cnJlbnRDb21wb25lbnQpOwogICAgbWF4TnVtV2lkZSA9IE1hdGgubWF4KG1heE51bVdpZGUsIG1heE51bVdpZGVDdXJyZW50Q29tcG9uZW50KTsKICAgIG1heE51bUhpZ2ggPSBNYXRoLm1heChtYXhOdW1IaWdoLCBtYXhOdW1IaWdoQ3VycmVudENvbXBvbmVudCk7CiAgICBzaXplUGVyQ29tcG9uZW50W2NdID0gewogICAgICByZXNvbHV0aW9uczogc2l6ZVBlclJlc29sdXRpb24sCiAgICAgIG1pbldpZHRoOiBtaW5XaWR0aEN1cnJlbnRDb21wb25lbnQsCiAgICAgIG1pbkhlaWdodDogbWluSGVpZ2h0Q3VycmVudENvbXBvbmVudCwKICAgICAgbWF4TnVtV2lkZTogbWF4TnVtV2lkZUN1cnJlbnRDb21wb25lbnQsCiAgICAgIG1heE51bUhpZ2g6IG1heE51bUhpZ2hDdXJyZW50Q29tcG9uZW50CiAgICB9OwogIH0KICByZXR1cm4gewogICAgY29tcG9uZW50czogc2l6ZVBlckNvbXBvbmVudCwKICAgIG1pbldpZHRoLAogICAgbWluSGVpZ2h0LAogICAgbWF4TnVtV2lkZSwKICAgIG1heE51bUhpZ2gKICB9Owp9CmZ1bmN0aW9uIGJ1aWxkUGFja2V0cyhjb250ZXh0KSB7CiAgY29uc3Qgc2l6ID0gY29udGV4dC5TSVo7CiAgY29uc3QgdGlsZUluZGV4ID0gY29udGV4dC5jdXJyZW50VGlsZS5pbmRleDsKICBjb25zdCB0aWxlID0gY29udGV4dC50aWxlc1t0aWxlSW5kZXhdOwogIGNvbnN0IGNvbXBvbmVudHNDb3VudCA9IHNpei5Dc2l6OwogIGZvciAobGV0IGMgPSAwOyBjIDwgY29tcG9uZW50c0NvdW50OyBjKyspIHsKICAgIGNvbnN0IGNvbXBvbmVudCA9IHRpbGUuY29tcG9uZW50c1tjXTsKICAgIGNvbnN0IGRlY29tcG9zaXRpb25MZXZlbHNDb3VudCA9IGNvbXBvbmVudC5jb2RpbmdTdHlsZVBhcmFtZXRlcnMuZGVjb21wb3NpdGlvbkxldmVsc0NvdW50OwogICAgY29uc3QgcmVzb2x1dGlvbnMgPSBbXTsKICAgIGNvbnN0IHN1YmJhbmRzID0gW107CiAgICBmb3IgKGxldCByID0gMDsgciA8PSBkZWNvbXBvc2l0aW9uTGV2ZWxzQ291bnQ7IHIrKykgewogICAgICBjb25zdCBibG9ja3NEaW1lbnNpb25zID0gZ2V0QmxvY2tzRGltZW5zaW9ucyhjb250ZXh0LCBjb21wb25lbnQsIHIpOwogICAgICBjb25zdCByZXNvbHV0aW9uID0ge307CiAgICAgIGNvbnN0IHNjYWxlID0gMSA8PCBkZWNvbXBvc2l0aW9uTGV2ZWxzQ291bnQgLSByOwogICAgICByZXNvbHV0aW9uLnRyeDAgPSBNYXRoLmNlaWwoY29tcG9uZW50LnRjeDAgLyBzY2FsZSk7CiAgICAgIHJlc29sdXRpb24udHJ5MCA9IE1hdGguY2VpbChjb21wb25lbnQudGN5MCAvIHNjYWxlKTsKICAgICAgcmVzb2x1dGlvbi50cngxID0gTWF0aC5jZWlsKGNvbXBvbmVudC50Y3gxIC8gc2NhbGUpOwogICAgICByZXNvbHV0aW9uLnRyeTEgPSBNYXRoLmNlaWwoY29tcG9uZW50LnRjeTEgLyBzY2FsZSk7CiAgICAgIHJlc29sdXRpb24ucmVzTGV2ZWwgPSByOwogICAgICBidWlsZFByZWNpbmN0cyhjb250ZXh0LCByZXNvbHV0aW9uLCBibG9ja3NEaW1lbnNpb25zKTsKICAgICAgcmVzb2x1dGlvbnMucHVzaChyZXNvbHV0aW9uKTsKICAgICAgbGV0IHN1YmJhbmQ7CiAgICAgIGlmIChyID09PSAwKSB7CiAgICAgICAgc3ViYmFuZCA9IHt9OwogICAgICAgIHN1YmJhbmQudHlwZSA9ICJMTCI7CiAgICAgICAgc3ViYmFuZC50YngwID0gTWF0aC5jZWlsKGNvbXBvbmVudC50Y3gwIC8gc2NhbGUpOwogICAgICAgIHN1YmJhbmQudGJ5MCA9IE1hdGguY2VpbChjb21wb25lbnQudGN5MCAvIHNjYWxlKTsKICAgICAgICBzdWJiYW5kLnRieDEgPSBNYXRoLmNlaWwoY29tcG9uZW50LnRjeDEgLyBzY2FsZSk7CiAgICAgICAgc3ViYmFuZC50YnkxID0gTWF0aC5jZWlsKGNvbXBvbmVudC50Y3kxIC8gc2NhbGUpOwogICAgICAgIHN1YmJhbmQucmVzb2x1dGlvbiA9IHJlc29sdXRpb247CiAgICAgICAgYnVpbGRDb2RlYmxvY2tzKGNvbnRleHQsIHN1YmJhbmQsIGJsb2Nrc0RpbWVuc2lvbnMpOwogICAgICAgIHN1YmJhbmRzLnB1c2goc3ViYmFuZCk7CiAgICAgICAgcmVzb2x1dGlvbi5zdWJiYW5kcyA9IFtzdWJiYW5kXTsKICAgICAgfSBlbHNlIHsKICAgICAgICBjb25zdCBic2NhbGUgPSAxIDw8IGRlY29tcG9zaXRpb25MZXZlbHNDb3VudCAtIHIgKyAxOwogICAgICAgIGNvbnN0IHJlc29sdXRpb25TdWJiYW5kcyA9IFtdOwogICAgICAgIHN1YmJhbmQgPSB7fTsKICAgICAgICBzdWJiYW5kLnR5cGUgPSAiSEwiOwogICAgICAgIHN1YmJhbmQudGJ4MCA9IE1hdGguY2VpbChjb21wb25lbnQudGN4MCAvIGJzY2FsZSAtIDAuNSk7CiAgICAgICAgc3ViYmFuZC50YnkwID0gTWF0aC5jZWlsKGNvbXBvbmVudC50Y3kwIC8gYnNjYWxlKTsKICAgICAgICBzdWJiYW5kLnRieDEgPSBNYXRoLmNlaWwoY29tcG9uZW50LnRjeDEgLyBic2NhbGUgLSAwLjUpOwogICAgICAgIHN1YmJhbmQudGJ5MSA9IE1hdGguY2VpbChjb21wb25lbnQudGN5MSAvIGJzY2FsZSk7CiAgICAgICAgc3ViYmFuZC5yZXNvbHV0aW9uID0gcmVzb2x1dGlvbjsKICAgICAgICBidWlsZENvZGVibG9ja3MoY29udGV4dCwgc3ViYmFuZCwgYmxvY2tzRGltZW5zaW9ucyk7CiAgICAgICAgc3ViYmFuZHMucHVzaChzdWJiYW5kKTsKICAgICAgICByZXNvbHV0aW9uU3ViYmFuZHMucHVzaChzdWJiYW5kKTsKICAgICAgICBzdWJiYW5kID0ge307CiAgICAgICAgc3ViYmFuZC50eXBlID0gIkxIIjsKICAgICAgICBzdWJiYW5kLnRieDAgPSBNYXRoLmNlaWwoY29tcG9uZW50LnRjeDAgLyBic2NhbGUpOwogICAgICAgIHN1YmJhbmQudGJ5MCA9IE1hdGguY2VpbChjb21wb25lbnQudGN5MCAvIGJzY2FsZSAtIDAuNSk7CiAgICAgICAgc3ViYmFuZC50YngxID0gTWF0aC5jZWlsKGNvbXBvbmVudC50Y3gxIC8gYnNjYWxlKTsKICAgICAgICBzdWJiYW5kLnRieTEgPSBNYXRoLmNlaWwoY29tcG9uZW50LnRjeTEgLyBic2NhbGUgLSAwLjUpOwogICAgICAgIHN1YmJhbmQucmVzb2x1dGlvbiA9IHJlc29sdXRpb247CiAgICAgICAgYnVpbGRDb2RlYmxvY2tzKGNvbnRleHQsIHN1YmJhbmQsIGJsb2Nrc0RpbWVuc2lvbnMpOwogICAgICAgIHN1YmJhbmRzLnB1c2goc3ViYmFuZCk7CiAgICAgICAgcmVzb2x1dGlvblN1YmJhbmRzLnB1c2goc3ViYmFuZCk7CiAgICAgICAgc3ViYmFuZCA9IHt9OwogICAgICAgIHN1YmJhbmQudHlwZSA9ICJISCI7CiAgICAgICAgc3ViYmFuZC50YngwID0gTWF0aC5jZWlsKGNvbXBvbmVudC50Y3gwIC8gYnNjYWxlIC0gMC41KTsKICAgICAgICBzdWJiYW5kLnRieTAgPSBNYXRoLmNlaWwoY29tcG9uZW50LnRjeTAgLyBic2NhbGUgLSAwLjUpOwogICAgICAgIHN1YmJhbmQudGJ4MSA9IE1hdGguY2VpbChjb21wb25lbnQudGN4MSAvIGJzY2FsZSAtIDAuNSk7CiAgICAgICAgc3ViYmFuZC50YnkxID0gTWF0aC5jZWlsKGNvbXBvbmVudC50Y3kxIC8gYnNjYWxlIC0gMC41KTsKICAgICAgICBzdWJiYW5kLnJlc29sdXRpb24gPSByZXNvbHV0aW9uOwogICAgICAgIGJ1aWxkQ29kZWJsb2Nrcyhjb250ZXh0LCBzdWJiYW5kLCBibG9ja3NEaW1lbnNpb25zKTsKICAgICAgICBzdWJiYW5kcy5wdXNoKHN1YmJhbmQpOwogICAgICAgIHJlc29sdXRpb25TdWJiYW5kcy5wdXNoKHN1YmJhbmQpOwogICAgICAgIHJlc29sdXRpb24uc3ViYmFuZHMgPSByZXNvbHV0aW9uU3ViYmFuZHM7CiAgICAgIH0KICAgIH0KICAgIGNvbXBvbmVudC5yZXNvbHV0aW9ucyA9IHJlc29sdXRpb25zOwogICAgY29tcG9uZW50LnN1YmJhbmRzID0gc3ViYmFuZHM7CiAgfQogIGNvbnN0IHByb2dyZXNzaW9uT3JkZXIgPSB0aWxlLmNvZGluZ1N0eWxlRGVmYXVsdFBhcmFtZXRlcnMucHJvZ3Jlc3Npb25PcmRlcjsKICBzd2l0Y2ggKHByb2dyZXNzaW9uT3JkZXIpIHsKICAgIGNhc2UgMDoKICAgICAgdGlsZS5wYWNrZXRzSXRlcmF0b3IgPSBuZXcgTGF5ZXJSZXNvbHV0aW9uQ29tcG9uZW50UG9zaXRpb25JdGVyYXRvcihjb250ZXh0KTsKICAgICAgYnJlYWs7CiAgICBjYXNlIDE6CiAgICAgIHRpbGUucGFja2V0c0l0ZXJhdG9yID0gbmV3IFJlc29sdXRpb25MYXllckNvbXBvbmVudFBvc2l0aW9uSXRlcmF0b3IoY29udGV4dCk7CiAgICAgIGJyZWFrOwogICAgY2FzZSAyOgogICAgICB0aWxlLnBhY2tldHNJdGVyYXRvciA9IG5ldyBSZXNvbHV0aW9uUG9zaXRpb25Db21wb25lbnRMYXllckl0ZXJhdG9yKGNvbnRleHQpOwogICAgICBicmVhazsKICAgIGNhc2UgMzoKICAgICAgdGlsZS5wYWNrZXRzSXRlcmF0b3IgPSBuZXcgUG9zaXRpb25Db21wb25lbnRSZXNvbHV0aW9uTGF5ZXJJdGVyYXRvcihjb250ZXh0KTsKICAgICAgYnJlYWs7CiAgICBjYXNlIDQ6CiAgICAgIHRpbGUucGFja2V0c0l0ZXJhdG9yID0gbmV3IENvbXBvbmVudFBvc2l0aW9uUmVzb2x1dGlvbkxheWVySXRlcmF0b3IoY29udGV4dCk7CiAgICAgIGJyZWFrOwogICAgZGVmYXVsdDoKICAgICAgdGhyb3cgbmV3IEpweEVycm9yKGBVbnN1cHBvcnRlZCBwcm9ncmVzc2lvbiBvcmRlciAke3Byb2dyZXNzaW9uT3JkZXJ9YCk7CiAgfQp9CmZ1bmN0aW9uIHBhcnNlVGlsZVBhY2tldHMoY29udGV4dCwgZGF0YSwgb2Zmc2V0LCBkYXRhTGVuZ3RoKSB7CiAgbGV0IHBvc2l0aW9uID0gMDsKICBsZXQgYnVmZmVyLAogICAgYnVmZmVyU2l6ZSA9IDAsCiAgICBza2lwTmV4dEJpdCA9IGZhbHNlOwogIGZ1bmN0aW9uIHJlYWRCaXRzKGNvdW50KSB7CiAgICB3aGlsZSAoYnVmZmVyU2l6ZSA8IGNvdW50KSB7CiAgICAgIGNvbnN0IGIgPSBkYXRhW29mZnNldCArIHBvc2l0aW9uXTsKICAgICAgcG9zaXRpb24rKzsKICAgICAgaWYgKHNraXBOZXh0Qml0KSB7CiAgICAgICAgYnVmZmVyID0gYnVmZmVyIDw8IDcgfCBiOwogICAgICAgIGJ1ZmZlclNpemUgKz0gNzsKICAgICAgICBza2lwTmV4dEJpdCA9IGZhbHNlOwogICAgICB9IGVsc2UgewogICAgICAgIGJ1ZmZlciA9IGJ1ZmZlciA8PCA4IHwgYjsKICAgICAgICBidWZmZXJTaXplICs9IDg7CiAgICAgIH0KICAgICAgaWYgKGIgPT09IDB4ZmYpIHsKICAgICAgICBza2lwTmV4dEJpdCA9IHRydWU7CiAgICAgIH0KICAgIH0KICAgIGJ1ZmZlclNpemUgLT0gY291bnQ7CiAgICByZXR1cm4gYnVmZmVyID4+PiBidWZmZXJTaXplICYgKDEgPDwgY291bnQpIC0gMTsKICB9CiAgZnVuY3Rpb24gc2tpcE1hcmtlcklmRXF1YWwodmFsdWUpIHsKICAgIGlmIChkYXRhW29mZnNldCArIHBvc2l0aW9uIC0gMV0gPT09IDB4ZmYgJiYgZGF0YVtvZmZzZXQgKyBwb3NpdGlvbl0gPT09IHZhbHVlKSB7CiAgICAgIHNraXBCeXRlcygxKTsKICAgICAgcmV0dXJuIHRydWU7CiAgICB9IGVsc2UgaWYgKGRhdGFbb2Zmc2V0ICsgcG9zaXRpb25dID09PSAweGZmICYmIGRhdGFbb2Zmc2V0ICsgcG9zaXRpb24gKyAxXSA9PT0gdmFsdWUpIHsKICAgICAgc2tpcEJ5dGVzKDIpOwogICAgICByZXR1cm4gdHJ1ZTsKICAgIH0KICAgIHJldHVybiBmYWxzZTsKICB9CiAgZnVuY3Rpb24gc2tpcEJ5dGVzKGNvdW50KSB7CiAgICBwb3NpdGlvbiArPSBjb3VudDsKICB9CiAgZnVuY3Rpb24gYWxpZ25Ub0J5dGUoKSB7CiAgICBidWZmZXJTaXplID0gMDsKICAgIGlmIChza2lwTmV4dEJpdCkgewogICAgICBwb3NpdGlvbisrOwogICAgICBza2lwTmV4dEJpdCA9IGZhbHNlOwogICAgfQogIH0KICBmdW5jdGlvbiByZWFkQ29kaW5ncGFzc2VzKCkgewogICAgaWYgKHJlYWRCaXRzKDEpID09PSAwKSB7CiAgICAgIHJldHVybiAxOwogICAgfQogICAgaWYgKHJlYWRCaXRzKDEpID09PSAwKSB7CiAgICAgIHJldHVybiAyOwogICAgfQogICAgbGV0IHZhbHVlID0gcmVhZEJpdHMoMik7CiAgICBpZiAodmFsdWUgPCAzKSB7CiAgICAgIHJldHVybiB2YWx1ZSArIDM7CiAgICB9CiAgICB2YWx1ZSA9IHJlYWRCaXRzKDUpOwogICAgaWYgKHZhbHVlIDwgMzEpIHsKICAgICAgcmV0dXJuIHZhbHVlICsgNjsKICAgIH0KICAgIHZhbHVlID0gcmVhZEJpdHMoNyk7CiAgICByZXR1cm4gdmFsdWUgKyAzNzsKICB9CiAgY29uc3QgdGlsZUluZGV4ID0gY29udGV4dC5jdXJyZW50VGlsZS5pbmRleDsKICBjb25zdCB0aWxlID0gY29udGV4dC50aWxlc1t0aWxlSW5kZXhdOwogIGNvbnN0IHNvcE1hcmtlclVzZWQgPSBjb250ZXh0LkNPRC5zb3BNYXJrZXJVc2VkOwogIGNvbnN0IGVwaE1hcmtlclVzZWQgPSBjb250ZXh0LkNPRC5lcGhNYXJrZXJVc2VkOwogIGNvbnN0IHBhY2tldHNJdGVyYXRvciA9IHRpbGUucGFja2V0c0l0ZXJhdG9yOwogIHdoaWxlIChwb3NpdGlvbiA8IGRhdGFMZW5ndGgpIHsKICAgIGFsaWduVG9CeXRlKCk7CiAgICBpZiAoc29wTWFya2VyVXNlZCAmJiBza2lwTWFya2VySWZFcXVhbCgweDkxKSkgewogICAgICBza2lwQnl0ZXMoNCk7CiAgICB9CiAgICBjb25zdCBwYWNrZXQgPSBwYWNrZXRzSXRlcmF0b3IubmV4dFBhY2tldCgpOwogICAgaWYgKCFyZWFkQml0cygxKSkgewogICAgICBjb250aW51ZTsKICAgIH0KICAgIGNvbnN0IGxheWVyTnVtYmVyID0gcGFja2V0LmxheWVyTnVtYmVyLAogICAgICBxdWV1ZSA9IFtdOwogICAgbGV0IGNvZGVibG9jazsKICAgIGZvciAobGV0IGkgPSAwLCBpaSA9IHBhY2tldC5jb2RlYmxvY2tzLmxlbmd0aDsgaSA8IGlpOyBpKyspIHsKICAgICAgY29kZWJsb2NrID0gcGFja2V0LmNvZGVibG9ja3NbaV07CiAgICAgIGxldCBwcmVjaW5jdCA9IGNvZGVibG9jay5wcmVjaW5jdDsKICAgICAgY29uc3QgY29kZWJsb2NrQ29sdW1uID0gY29kZWJsb2NrLmNieCAtIHByZWNpbmN0LmNieE1pbjsKICAgICAgY29uc3QgY29kZWJsb2NrUm93ID0gY29kZWJsb2NrLmNieSAtIHByZWNpbmN0LmNieU1pbjsKICAgICAgbGV0IGNvZGVibG9ja0luY2x1ZGVkID0gZmFsc2U7CiAgICAgIGxldCBmaXJzdFRpbWVJbmNsdXNpb24gPSBmYWxzZTsKICAgICAgbGV0IHZhbHVlUmVhZHksIHplcm9CaXRQbGFuZXNUcmVlOwogICAgICBpZiAoY29kZWJsb2NrLmluY2x1ZGVkICE9PSB1bmRlZmluZWQpIHsKICAgICAgICBjb2RlYmxvY2tJbmNsdWRlZCA9ICEhcmVhZEJpdHMoMSk7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgcHJlY2luY3QgPSBjb2RlYmxvY2sucHJlY2luY3Q7CiAgICAgICAgbGV0IGluY2x1c2lvblRyZWU7CiAgICAgICAgaWYgKHByZWNpbmN0LmluY2x1c2lvblRyZWUgIT09IHVuZGVmaW5lZCkgewogICAgICAgICAgaW5jbHVzaW9uVHJlZSA9IHByZWNpbmN0LmluY2x1c2lvblRyZWU7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIGNvbnN0IHdpZHRoID0gcHJlY2luY3QuY2J4TWF4IC0gcHJlY2luY3QuY2J4TWluICsgMTsKICAgICAgICAgIGNvbnN0IGhlaWdodCA9IHByZWNpbmN0LmNieU1heCAtIHByZWNpbmN0LmNieU1pbiArIDE7CiAgICAgICAgICBpbmNsdXNpb25UcmVlID0gbmV3IEluY2x1c2lvblRyZWUod2lkdGgsIGhlaWdodCwgbGF5ZXJOdW1iZXIpOwogICAgICAgICAgemVyb0JpdFBsYW5lc1RyZWUgPSBuZXcgVGFnVHJlZSh3aWR0aCwgaGVpZ2h0KTsKICAgICAgICAgIHByZWNpbmN0LmluY2x1c2lvblRyZWUgPSBpbmNsdXNpb25UcmVlOwogICAgICAgICAgcHJlY2luY3QuemVyb0JpdFBsYW5lc1RyZWUgPSB6ZXJvQml0UGxhbmVzVHJlZTsKICAgICAgICAgIGZvciAobGV0IGwgPSAwOyBsIDwgbGF5ZXJOdW1iZXI7IGwrKykgewogICAgICAgICAgICBpZiAocmVhZEJpdHMoMSkgIT09IDApIHsKICAgICAgICAgICAgICB0aHJvdyBuZXcgSnB4RXJyb3IoIkludmFsaWQgdGFnIHRyZWUiKTsKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgIH0KICAgICAgICBpZiAoaW5jbHVzaW9uVHJlZS5yZXNldChjb2RlYmxvY2tDb2x1bW4sIGNvZGVibG9ja1JvdywgbGF5ZXJOdW1iZXIpKSB7CiAgICAgICAgICB3aGlsZSAodHJ1ZSkgewogICAgICAgICAgICBpZiAocmVhZEJpdHMoMSkpIHsKICAgICAgICAgICAgICB2YWx1ZVJlYWR5ID0gIWluY2x1c2lvblRyZWUubmV4dExldmVsKCk7CiAgICAgICAgICAgICAgaWYgKHZhbHVlUmVhZHkpIHsKICAgICAgICAgICAgICAgIGNvZGVibG9jay5pbmNsdWRlZCA9IHRydWU7CiAgICAgICAgICAgICAgICBjb2RlYmxvY2tJbmNsdWRlZCA9IGZpcnN0VGltZUluY2x1c2lvbiA9IHRydWU7CiAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgaW5jbHVzaW9uVHJlZS5pbmNyZW1lbnRWYWx1ZShsYXllck51bWJlcik7CiAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICB9CiAgICAgIH0KICAgICAgaWYgKCFjb2RlYmxvY2tJbmNsdWRlZCkgewogICAgICAgIGNvbnRpbnVlOwogICAgICB9CiAgICAgIGlmIChmaXJzdFRpbWVJbmNsdXNpb24pIHsKICAgICAgICB6ZXJvQml0UGxhbmVzVHJlZSA9IHByZWNpbmN0Lnplcm9CaXRQbGFuZXNUcmVlOwogICAgICAgIHplcm9CaXRQbGFuZXNUcmVlLnJlc2V0KGNvZGVibG9ja0NvbHVtbiwgY29kZWJsb2NrUm93KTsKICAgICAgICB3aGlsZSAodHJ1ZSkgewogICAgICAgICAgaWYgKHJlYWRCaXRzKDEpKSB7CiAgICAgICAgICAgIHZhbHVlUmVhZHkgPSAhemVyb0JpdFBsYW5lc1RyZWUubmV4dExldmVsKCk7CiAgICAgICAgICAgIGlmICh2YWx1ZVJlYWR5KSB7CiAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIHplcm9CaXRQbGFuZXNUcmVlLmluY3JlbWVudFZhbHVlKCk7CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIGNvZGVibG9jay56ZXJvQml0UGxhbmVzID0gemVyb0JpdFBsYW5lc1RyZWUudmFsdWU7CiAgICAgIH0KICAgICAgY29uc3QgY29kaW5ncGFzc2VzID0gcmVhZENvZGluZ3Bhc3NlcygpOwogICAgICB3aGlsZSAocmVhZEJpdHMoMSkpIHsKICAgICAgICBjb2RlYmxvY2suTGJsb2NrKys7CiAgICAgIH0KICAgICAgY29uc3QgY29kaW5ncGFzc2VzTG9nMiA9ICgwLCBfY29yZV91dGlscy5sb2cyKShjb2RpbmdwYXNzZXMpOwogICAgICBjb25zdCBiaXRzID0gKGNvZGluZ3Bhc3NlcyA8IDEgPDwgY29kaW5ncGFzc2VzTG9nMiA/IGNvZGluZ3Bhc3Nlc0xvZzIgLSAxIDogY29kaW5ncGFzc2VzTG9nMikgKyBjb2RlYmxvY2suTGJsb2NrOwogICAgICBjb25zdCBjb2RlZERhdGFMZW5ndGggPSByZWFkQml0cyhiaXRzKTsKICAgICAgcXVldWUucHVzaCh7CiAgICAgICAgY29kZWJsb2NrLAogICAgICAgIGNvZGluZ3Bhc3NlcywKICAgICAgICBkYXRhTGVuZ3RoOiBjb2RlZERhdGFMZW5ndGgKICAgICAgfSk7CiAgICB9CiAgICBhbGlnblRvQnl0ZSgpOwogICAgaWYgKGVwaE1hcmtlclVzZWQpIHsKICAgICAgc2tpcE1hcmtlcklmRXF1YWwoMHg5Mik7CiAgICB9CiAgICB3aGlsZSAocXVldWUubGVuZ3RoID4gMCkgewogICAgICBjb25zdCBwYWNrZXRJdGVtID0gcXVldWUuc2hpZnQoKTsKICAgICAgY29kZWJsb2NrID0gcGFja2V0SXRlbS5jb2RlYmxvY2s7CiAgICAgIGlmIChjb2RlYmxvY2suZGF0YSA9PT0gdW5kZWZpbmVkKSB7CiAgICAgICAgY29kZWJsb2NrLmRhdGEgPSBbXTsKICAgICAgfQogICAgICBjb2RlYmxvY2suZGF0YS5wdXNoKHsKICAgICAgICBkYXRhLAogICAgICAgIHN0YXJ0OiBvZmZzZXQgKyBwb3NpdGlvbiwKICAgICAgICBlbmQ6IG9mZnNldCArIHBvc2l0aW9uICsgcGFja2V0SXRlbS5kYXRhTGVuZ3RoLAogICAgICAgIGNvZGluZ3Bhc3NlczogcGFja2V0SXRlbS5jb2RpbmdwYXNzZXMKICAgICAgfSk7CiAgICAgIHBvc2l0aW9uICs9IHBhY2tldEl0ZW0uZGF0YUxlbmd0aDsKICAgIH0KICB9CiAgcmV0dXJuIHBvc2l0aW9uOwp9CmZ1bmN0aW9uIGNvcHlDb2VmZmljaWVudHMoY29lZmZpY2llbnRzLCBsZXZlbFdpZHRoLCBsZXZlbEhlaWdodCwgc3ViYmFuZCwgZGVsdGEsIG1iLCByZXZlcnNpYmxlLCBzZWdtZW50YXRpb25TeW1ib2xVc2VkLCByZXNldENvbnRleHRQcm9iYWJpbGl0aWVzKSB7CiAgY29uc3QgeDAgPSBzdWJiYW5kLnRieDA7CiAgY29uc3QgeTAgPSBzdWJiYW5kLnRieTA7CiAgY29uc3Qgd2lkdGggPSBzdWJiYW5kLnRieDEgLSBzdWJiYW5kLnRieDA7CiAgY29uc3QgY29kZWJsb2NrcyA9IHN1YmJhbmQuY29kZWJsb2NrczsKICBjb25zdCByaWdodCA9IHN1YmJhbmQudHlwZS5jaGFyQXQoMCkgPT09ICJIIiA/IDEgOiAwOwogIGNvbnN0IGJvdHRvbSA9IHN1YmJhbmQudHlwZS5jaGFyQXQoMSkgPT09ICJIIiA/IGxldmVsV2lkdGggOiAwOwogIGZvciAobGV0IGkgPSAwLCBpaSA9IGNvZGVibG9ja3MubGVuZ3RoOyBpIDwgaWk7ICsraSkgewogICAgY29uc3QgY29kZWJsb2NrID0gY29kZWJsb2Nrc1tpXTsKICAgIGNvbnN0IGJsb2NrV2lkdGggPSBjb2RlYmxvY2sudGJ4MV8gLSBjb2RlYmxvY2sudGJ4MF87CiAgICBjb25zdCBibG9ja0hlaWdodCA9IGNvZGVibG9jay50YnkxXyAtIGNvZGVibG9jay50YnkwXzsKICAgIGlmIChibG9ja1dpZHRoID09PSAwIHx8IGJsb2NrSGVpZ2h0ID09PSAwKSB7CiAgICAgIGNvbnRpbnVlOwogICAgfQogICAgaWYgKGNvZGVibG9jay5kYXRhID09PSB1bmRlZmluZWQpIHsKICAgICAgY29udGludWU7CiAgICB9CiAgICBjb25zdCBiaXRNb2RlbCA9IG5ldyBCaXRNb2RlbChibG9ja1dpZHRoLCBibG9ja0hlaWdodCwgY29kZWJsb2NrLnN1YmJhbmRUeXBlLCBjb2RlYmxvY2suemVyb0JpdFBsYW5lcywgbWIpOwogICAgbGV0IGN1cnJlbnRDb2RpbmdwYXNzVHlwZSA9IDI7CiAgICBjb25zdCBkYXRhID0gY29kZWJsb2NrLmRhdGE7CiAgICBsZXQgdG90YWxMZW5ndGggPSAwLAogICAgICBjb2RpbmdwYXNzZXMgPSAwOwogICAgbGV0IGosIGpqLCBkYXRhSXRlbTsKICAgIGZvciAoaiA9IDAsIGpqID0gZGF0YS5sZW5ndGg7IGogPCBqajsgaisrKSB7CiAgICAgIGRhdGFJdGVtID0gZGF0YVtqXTsKICAgICAgdG90YWxMZW5ndGggKz0gZGF0YUl0ZW0uZW5kIC0gZGF0YUl0ZW0uc3RhcnQ7CiAgICAgIGNvZGluZ3Bhc3NlcyArPSBkYXRhSXRlbS5jb2RpbmdwYXNzZXM7CiAgICB9CiAgICBjb25zdCBlbmNvZGVkRGF0YSA9IG5ldyBVaW50OEFycmF5KHRvdGFsTGVuZ3RoKTsKICAgIGxldCBwb3NpdGlvbiA9IDA7CiAgICBmb3IgKGogPSAwLCBqaiA9IGRhdGEubGVuZ3RoOyBqIDwgamo7IGorKykgewogICAgICBkYXRhSXRlbSA9IGRhdGFbal07CiAgICAgIGNvbnN0IGNodW5rID0gZGF0YUl0ZW0uZGF0YS5zdWJhcnJheShkYXRhSXRlbS5zdGFydCwgZGF0YUl0ZW0uZW5kKTsKICAgICAgZW5jb2RlZERhdGEuc2V0KGNodW5rLCBwb3NpdGlvbik7CiAgICAgIHBvc2l0aW9uICs9IGNodW5rLmxlbmd0aDsKICAgIH0KICAgIGNvbnN0IGRlY29kZXIgPSBuZXcgX2FyaXRobWV0aWNfZGVjb2Rlci5Bcml0aG1ldGljRGVjb2RlcihlbmNvZGVkRGF0YSwgMCwgdG90YWxMZW5ndGgpOwogICAgYml0TW9kZWwuc2V0RGVjb2RlcihkZWNvZGVyKTsKICAgIGZvciAoaiA9IDA7IGogPCBjb2RpbmdwYXNzZXM7IGorKykgewogICAgICBzd2l0Y2ggKGN1cnJlbnRDb2RpbmdwYXNzVHlwZSkgewogICAgICAgIGNhc2UgMDoKICAgICAgICAgIGJpdE1vZGVsLnJ1blNpZ25pZmljYW5jZVByb3BhZ2F0aW9uUGFzcygpOwogICAgICAgICAgYnJlYWs7CiAgICAgICAgY2FzZSAxOgogICAgICAgICAgYml0TW9kZWwucnVuTWFnbml0dWRlUmVmaW5lbWVudFBhc3MoKTsKICAgICAgICAgIGJyZWFrOwogICAgICAgIGNhc2UgMjoKICAgICAgICAgIGJpdE1vZGVsLnJ1bkNsZWFudXBQYXNzKCk7CiAgICAgICAgICBpZiAoc2VnbWVudGF0aW9uU3ltYm9sVXNlZCkgewogICAgICAgICAgICBiaXRNb2RlbC5jaGVja1NlZ21lbnRhdGlvblN5bWJvbCgpOwogICAgICAgICAgfQogICAgICAgICAgYnJlYWs7CiAgICAgIH0KICAgICAgaWYgKHJlc2V0Q29udGV4dFByb2JhYmlsaXRpZXMpIHsKICAgICAgICBiaXRNb2RlbC5yZXNldCgpOwogICAgICB9CiAgICAgIGN1cnJlbnRDb2RpbmdwYXNzVHlwZSA9IChjdXJyZW50Q29kaW5ncGFzc1R5cGUgKyAxKSAlIDM7CiAgICB9CiAgICBsZXQgb2Zmc2V0ID0gY29kZWJsb2NrLnRieDBfIC0geDAgKyAoY29kZWJsb2NrLnRieTBfIC0geTApICogd2lkdGg7CiAgICBjb25zdCBzaWduID0gYml0TW9kZWwuY29lZmZpY2VudHNTaWduOwogICAgY29uc3QgbWFnbml0dWRlID0gYml0TW9kZWwuY29lZmZpY2VudHNNYWduaXR1ZGU7CiAgICBjb25zdCBiaXRzRGVjb2RlZCA9IGJpdE1vZGVsLmJpdHNEZWNvZGVkOwogICAgY29uc3QgbWFnbml0dWRlQ29ycmVjdGlvbiA9IHJldmVyc2libGUgPyAwIDogMC41OwogICAgbGV0IGssIG4sIG5iOwogICAgcG9zaXRpb24gPSAwOwogICAgY29uc3QgaW50ZXJsZWF2ZSA9IHN1YmJhbmQudHlwZSAhPT0gIkxMIjsKICAgIGZvciAoaiA9IDA7IGogPCBibG9ja0hlaWdodDsgaisrKSB7CiAgICAgIGNvbnN0IHJvdyA9IG9mZnNldCAvIHdpZHRoIHwgMDsKICAgICAgY29uc3QgbGV2ZWxPZmZzZXQgPSAyICogcm93ICogKGxldmVsV2lkdGggLSB3aWR0aCkgKyByaWdodCArIGJvdHRvbTsKICAgICAgZm9yIChrID0gMDsgayA8IGJsb2NrV2lkdGg7IGsrKykgewogICAgICAgIG4gPSBtYWduaXR1ZGVbcG9zaXRpb25dOwogICAgICAgIGlmIChuICE9PSAwKSB7CiAgICAgICAgICBuID0gKG4gKyBtYWduaXR1ZGVDb3JyZWN0aW9uKSAqIGRlbHRhOwogICAgICAgICAgaWYgKHNpZ25bcG9zaXRpb25dICE9PSAwKSB7CiAgICAgICAgICAgIG4gPSAtbjsKICAgICAgICAgIH0KICAgICAgICAgIG5iID0gYml0c0RlY29kZWRbcG9zaXRpb25dOwogICAgICAgICAgY29uc3QgcG9zID0gaW50ZXJsZWF2ZSA/IGxldmVsT2Zmc2V0ICsgKG9mZnNldCA8PCAxKSA6IG9mZnNldDsKICAgICAgICAgIGNvZWZmaWNpZW50c1twb3NdID0gcmV2ZXJzaWJsZSAmJiBuYiA+PSBtYiA/IG4gOiBuICogKDEgPDwgbWIgLSBuYik7CiAgICAgICAgfQogICAgICAgIG9mZnNldCsrOwogICAgICAgIHBvc2l0aW9uKys7CiAgICAgIH0KICAgICAgb2Zmc2V0ICs9IHdpZHRoIC0gYmxvY2tXaWR0aDsKICAgIH0KICB9Cn0KZnVuY3Rpb24gdHJhbnNmb3JtVGlsZShjb250ZXh0LCB0aWxlLCBjKSB7CiAgY29uc3QgY29tcG9uZW50ID0gdGlsZS5jb21wb25lbnRzW2NdOwogIGNvbnN0IGNvZGluZ1N0eWxlUGFyYW1ldGVycyA9IGNvbXBvbmVudC5jb2RpbmdTdHlsZVBhcmFtZXRlcnM7CiAgY29uc3QgcXVhbnRpemF0aW9uUGFyYW1ldGVycyA9IGNvbXBvbmVudC5xdWFudGl6YXRpb25QYXJhbWV0ZXJzOwogIGNvbnN0IGRlY29tcG9zaXRpb25MZXZlbHNDb3VudCA9IGNvZGluZ1N0eWxlUGFyYW1ldGVycy5kZWNvbXBvc2l0aW9uTGV2ZWxzQ291bnQ7CiAgY29uc3Qgc3BxY2RzID0gcXVhbnRpemF0aW9uUGFyYW1ldGVycy5TUHFjZHM7CiAgY29uc3Qgc2NhbGFyRXhwb3VuZGVkID0gcXVhbnRpemF0aW9uUGFyYW1ldGVycy5zY2FsYXJFeHBvdW5kZWQ7CiAgY29uc3QgZ3VhcmRCaXRzID0gcXVhbnRpemF0aW9uUGFyYW1ldGVycy5ndWFyZEJpdHM7CiAgY29uc3Qgc2VnbWVudGF0aW9uU3ltYm9sVXNlZCA9IGNvZGluZ1N0eWxlUGFyYW1ldGVycy5zZWdtZW50YXRpb25TeW1ib2xVc2VkOwogIGNvbnN0IHJlc2V0Q29udGV4dFByb2JhYmlsaXRpZXMgPSBjb2RpbmdTdHlsZVBhcmFtZXRlcnMucmVzZXRDb250ZXh0UHJvYmFiaWxpdGllczsKICBjb25zdCBwcmVjaXNpb24gPSBjb250ZXh0LmNvbXBvbmVudHNbY10ucHJlY2lzaW9uOwogIGNvbnN0IHJldmVyc2libGUgPSBjb2RpbmdTdHlsZVBhcmFtZXRlcnMucmV2ZXJzaWJsZVRyYW5zZm9ybWF0aW9uOwogIGNvbnN0IHRyYW5zZm9ybSA9IHJldmVyc2libGUgPyBuZXcgUmV2ZXJzaWJsZVRyYW5zZm9ybSgpIDogbmV3IElycmV2ZXJzaWJsZVRyYW5zZm9ybSgpOwogIGNvbnN0IHN1YmJhbmRDb2VmZmljaWVudHMgPSBbXTsKICBsZXQgYiA9IDA7CiAgZm9yIChsZXQgaSA9IDA7IGkgPD0gZGVjb21wb3NpdGlvbkxldmVsc0NvdW50OyBpKyspIHsKICAgIGNvbnN0IHJlc29sdXRpb24gPSBjb21wb25lbnQucmVzb2x1dGlvbnNbaV07CiAgICBjb25zdCB3aWR0aCA9IHJlc29sdXRpb24udHJ4MSAtIHJlc29sdXRpb24udHJ4MDsKICAgIGNvbnN0IGhlaWdodCA9IHJlc29sdXRpb24udHJ5MSAtIHJlc29sdXRpb24udHJ5MDsKICAgIGNvbnN0IGNvZWZmaWNpZW50cyA9IG5ldyBGbG9hdDMyQXJyYXkod2lkdGggKiBoZWlnaHQpOwogICAgZm9yIChsZXQgaiA9IDAsIGpqID0gcmVzb2x1dGlvbi5zdWJiYW5kcy5sZW5ndGg7IGogPCBqajsgaisrKSB7CiAgICAgIGxldCBtdSwgZXBzaWxvbjsKICAgICAgaWYgKCFzY2FsYXJFeHBvdW5kZWQpIHsKICAgICAgICBtdSA9IHNwcWNkc1swXS5tdTsKICAgICAgICBlcHNpbG9uID0gc3BxY2RzWzBdLmVwc2lsb24gKyAoaSA+IDAgPyAxIC0gaSA6IDApOwogICAgICB9IGVsc2UgewogICAgICAgIG11ID0gc3BxY2RzW2JdLm11OwogICAgICAgIGVwc2lsb24gPSBzcHFjZHNbYl0uZXBzaWxvbjsKICAgICAgICBiKys7CiAgICAgIH0KICAgICAgY29uc3Qgc3ViYmFuZCA9IHJlc29sdXRpb24uc3ViYmFuZHNbal07CiAgICAgIGNvbnN0IGdhaW5Mb2cyID0gU3ViYmFuZHNHYWluTG9nMltzdWJiYW5kLnR5cGVdOwogICAgICBjb25zdCBkZWx0YSA9IHJldmVyc2libGUgPyAxIDogMiAqKiAocHJlY2lzaW9uICsgZ2FpbkxvZzIgLSBlcHNpbG9uKSAqICgxICsgbXUgLyAyMDQ4KTsKICAgICAgY29uc3QgbWIgPSBndWFyZEJpdHMgKyBlcHNpbG9uIC0gMTsKICAgICAgY29weUNvZWZmaWNpZW50cyhjb2VmZmljaWVudHMsIHdpZHRoLCBoZWlnaHQsIHN1YmJhbmQsIGRlbHRhLCBtYiwgcmV2ZXJzaWJsZSwgc2VnbWVudGF0aW9uU3ltYm9sVXNlZCwgcmVzZXRDb250ZXh0UHJvYmFiaWxpdGllcyk7CiAgICB9CiAgICBzdWJiYW5kQ29lZmZpY2llbnRzLnB1c2goewogICAgICB3aWR0aCwKICAgICAgaGVpZ2h0LAogICAgICBpdGVtczogY29lZmZpY2llbnRzCiAgICB9KTsKICB9CiAgY29uc3QgcmVzdWx0ID0gdHJhbnNmb3JtLmNhbGN1bGF0ZShzdWJiYW5kQ29lZmZpY2llbnRzLCBjb21wb25lbnQudGN4MCwgY29tcG9uZW50LnRjeTApOwogIHJldHVybiB7CiAgICBsZWZ0OiBjb21wb25lbnQudGN4MCwKICAgIHRvcDogY29tcG9uZW50LnRjeTAsCiAgICB3aWR0aDogcmVzdWx0LndpZHRoLAogICAgaGVpZ2h0OiByZXN1bHQuaGVpZ2h0LAogICAgaXRlbXM6IHJlc3VsdC5pdGVtcwogIH07Cn0KZnVuY3Rpb24gdHJhbnNmb3JtQ29tcG9uZW50cyhjb250ZXh0KSB7CiAgY29uc3Qgc2l6ID0gY29udGV4dC5TSVo7CiAgY29uc3QgY29tcG9uZW50cyA9IGNvbnRleHQuY29tcG9uZW50czsKICBjb25zdCBjb21wb25lbnRzQ291bnQgPSBzaXouQ3NpejsKICBjb25zdCByZXN1bHRJbWFnZXMgPSBbXTsKICBmb3IgKGxldCBpID0gMCwgaWkgPSBjb250ZXh0LnRpbGVzLmxlbmd0aDsgaSA8IGlpOyBpKyspIHsKICAgIGNvbnN0IHRpbGUgPSBjb250ZXh0LnRpbGVzW2ldOwogICAgY29uc3QgdHJhbnNmb3JtZWRUaWxlcyA9IFtdOwogICAgZm9yIChsZXQgYyA9IDA7IGMgPCBjb21wb25lbnRzQ291bnQ7IGMrKykgewogICAgICB0cmFuc2Zvcm1lZFRpbGVzW2NdID0gdHJhbnNmb3JtVGlsZShjb250ZXh0LCB0aWxlLCBjKTsKICAgIH0KICAgIGNvbnN0IHRpbGUwID0gdHJhbnNmb3JtZWRUaWxlc1swXTsKICAgIGNvbnN0IG91dCA9IG5ldyBVaW50OENsYW1wZWRBcnJheSh0aWxlMC5pdGVtcy5sZW5ndGggKiBjb21wb25lbnRzQ291bnQpOwogICAgY29uc3QgcmVzdWx0ID0gewogICAgICBsZWZ0OiB0aWxlMC5sZWZ0LAogICAgICB0b3A6IHRpbGUwLnRvcCwKICAgICAgd2lkdGg6IHRpbGUwLndpZHRoLAogICAgICBoZWlnaHQ6IHRpbGUwLmhlaWdodCwKICAgICAgaXRlbXM6IG91dAogICAgfTsKICAgIGxldCBzaGlmdCwgb2Zmc2V0OwogICAgbGV0IHBvcyA9IDAsCiAgICAgIGosCiAgICAgIGpqLAogICAgICB5MCwKICAgICAgeTEsCiAgICAgIHkyOwogICAgaWYgKHRpbGUuY29kaW5nU3R5bGVEZWZhdWx0UGFyYW1ldGVycy5tdWx0aXBsZUNvbXBvbmVudFRyYW5zZm9ybSkgewogICAgICBjb25zdCBmb3VyQ29tcG9uZW50cyA9IGNvbXBvbmVudHNDb3VudCA9PT0gNDsKICAgICAgY29uc3QgeTBpdGVtcyA9IHRyYW5zZm9ybWVkVGlsZXNbMF0uaXRlbXM7CiAgICAgIGNvbnN0IHkxaXRlbXMgPSB0cmFuc2Zvcm1lZFRpbGVzWzFdLml0ZW1zOwogICAgICBjb25zdCB5Mml0ZW1zID0gdHJhbnNmb3JtZWRUaWxlc1syXS5pdGVtczsKICAgICAgY29uc3QgeTNpdGVtcyA9IGZvdXJDb21wb25lbnRzID8gdHJhbnNmb3JtZWRUaWxlc1szXS5pdGVtcyA6IG51bGw7CiAgICAgIHNoaWZ0ID0gY29tcG9uZW50c1swXS5wcmVjaXNpb24gLSA4OwogICAgICBvZmZzZXQgPSAoMTI4IDw8IHNoaWZ0KSArIDAuNTsKICAgICAgY29uc3QgY29tcG9uZW50MCA9IHRpbGUuY29tcG9uZW50c1swXTsKICAgICAgY29uc3QgYWxwaGEwMSA9IGNvbXBvbmVudHNDb3VudCAtIDM7CiAgICAgIGpqID0geTBpdGVtcy5sZW5ndGg7CiAgICAgIGlmICghY29tcG9uZW50MC5jb2RpbmdTdHlsZVBhcmFtZXRlcnMucmV2ZXJzaWJsZVRyYW5zZm9ybWF0aW9uKSB7CiAgICAgICAgZm9yIChqID0gMDsgaiA8IGpqOyBqKyssIHBvcyArPSBhbHBoYTAxKSB7CiAgICAgICAgICB5MCA9IHkwaXRlbXNbal0gKyBvZmZzZXQ7CiAgICAgICAgICB5MSA9IHkxaXRlbXNbal07CiAgICAgICAgICB5MiA9IHkyaXRlbXNbal07CiAgICAgICAgICBvdXRbcG9zKytdID0geTAgKyAxLjQwMiAqIHkyID4+IHNoaWZ0OwogICAgICAgICAgb3V0W3BvcysrXSA9IHkwIC0gMC4zNDQxMyAqIHkxIC0gMC43MTQxNCAqIHkyID4+IHNoaWZ0OwogICAgICAgICAgb3V0W3BvcysrXSA9IHkwICsgMS43NzIgKiB5MSA+PiBzaGlmdDsKICAgICAgICB9CiAgICAgIH0gZWxzZSB7CiAgICAgICAgZm9yIChqID0gMDsgaiA8IGpqOyBqKyssIHBvcyArPSBhbHBoYTAxKSB7CiAgICAgICAgICB5MCA9IHkwaXRlbXNbal0gKyBvZmZzZXQ7CiAgICAgICAgICB5MSA9IHkxaXRlbXNbal07CiAgICAgICAgICB5MiA9IHkyaXRlbXNbal07CiAgICAgICAgICBjb25zdCBnID0geTAgLSAoeTIgKyB5MSA+PiAyKTsKICAgICAgICAgIG91dFtwb3MrK10gPSBnICsgeTIgPj4gc2hpZnQ7CiAgICAgICAgICBvdXRbcG9zKytdID0gZyA+PiBzaGlmdDsKICAgICAgICAgIG91dFtwb3MrK10gPSBnICsgeTEgPj4gc2hpZnQ7CiAgICAgICAgfQogICAgICB9CiAgICAgIGlmIChmb3VyQ29tcG9uZW50cykgewogICAgICAgIGZvciAoaiA9IDAsIHBvcyA9IDM7IGogPCBqajsgaisrLCBwb3MgKz0gNCkgewogICAgICAgICAgb3V0W3Bvc10gPSB5M2l0ZW1zW2pdICsgb2Zmc2V0ID4+IHNoaWZ0OwogICAgICAgIH0KICAgICAgfQogICAgfSBlbHNlIHsKICAgICAgZm9yIChsZXQgYyA9IDA7IGMgPCBjb21wb25lbnRzQ291bnQ7IGMrKykgewogICAgICAgIGNvbnN0IGl0ZW1zID0gdHJhbnNmb3JtZWRUaWxlc1tjXS5pdGVtczsKICAgICAgICBzaGlmdCA9IGNvbXBvbmVudHNbY10ucHJlY2lzaW9uIC0gODsKICAgICAgICBvZmZzZXQgPSAoMTI4IDw8IHNoaWZ0KSArIDAuNTsKICAgICAgICBmb3IgKHBvcyA9IGMsIGogPSAwLCBqaiA9IGl0ZW1zLmxlbmd0aDsgaiA8IGpqOyBqKyspIHsKICAgICAgICAgIG91dFtwb3NdID0gaXRlbXNbal0gKyBvZmZzZXQgPj4gc2hpZnQ7CiAgICAgICAgICBwb3MgKz0gY29tcG9uZW50c0NvdW50OwogICAgICAgIH0KICAgICAgfQogICAgfQogICAgcmVzdWx0SW1hZ2VzLnB1c2gocmVzdWx0KTsKICB9CiAgcmV0dXJuIHJlc3VsdEltYWdlczsKfQpmdW5jdGlvbiBpbml0aWFsaXplVGlsZShjb250ZXh0LCB0aWxlSW5kZXgpIHsKICBjb25zdCBzaXogPSBjb250ZXh0LlNJWjsKICBjb25zdCBjb21wb25lbnRzQ291bnQgPSBzaXouQ3NpejsKICBjb25zdCB0aWxlID0gY29udGV4dC50aWxlc1t0aWxlSW5kZXhdOwogIGZvciAobGV0IGMgPSAwOyBjIDwgY29tcG9uZW50c0NvdW50OyBjKyspIHsKICAgIGNvbnN0IGNvbXBvbmVudCA9IHRpbGUuY29tcG9uZW50c1tjXTsKICAgIGNvbnN0IHFjZE9yUWNjID0gY29udGV4dC5jdXJyZW50VGlsZS5RQ0NbY10gIT09IHVuZGVmaW5lZCA/IGNvbnRleHQuY3VycmVudFRpbGUuUUNDW2NdIDogY29udGV4dC5jdXJyZW50VGlsZS5RQ0Q7CiAgICBjb21wb25lbnQucXVhbnRpemF0aW9uUGFyYW1ldGVycyA9IHFjZE9yUWNjOwogICAgY29uc3QgY29kT3JDb2MgPSBjb250ZXh0LmN1cnJlbnRUaWxlLkNPQ1tjXSAhPT0gdW5kZWZpbmVkID8gY29udGV4dC5jdXJyZW50VGlsZS5DT0NbY10gOiBjb250ZXh0LmN1cnJlbnRUaWxlLkNPRDsKICAgIGNvbXBvbmVudC5jb2RpbmdTdHlsZVBhcmFtZXRlcnMgPSBjb2RPckNvYzsKICB9CiAgdGlsZS5jb2RpbmdTdHlsZURlZmF1bHRQYXJhbWV0ZXJzID0gY29udGV4dC5jdXJyZW50VGlsZS5DT0Q7Cn0KY2xhc3MgVGFnVHJlZSB7CiAgY29uc3RydWN0b3Iod2lkdGgsIGhlaWdodCkgewogICAgY29uc3QgbGV2ZWxzTGVuZ3RoID0gKDAsIF9jb3JlX3V0aWxzLmxvZzIpKE1hdGgubWF4KHdpZHRoLCBoZWlnaHQpKSArIDE7CiAgICB0aGlzLmxldmVscyA9IFtdOwogICAgZm9yIChsZXQgaSA9IDA7IGkgPCBsZXZlbHNMZW5ndGg7IGkrKykgewogICAgICBjb25zdCBsZXZlbCA9IHsKICAgICAgICB3aWR0aCwKICAgICAgICBoZWlnaHQsCiAgICAgICAgaXRlbXM6IFtdCiAgICAgIH07CiAgICAgIHRoaXMubGV2ZWxzLnB1c2gobGV2ZWwpOwogICAgICB3aWR0aCA9IE1hdGguY2VpbCh3aWR0aCAvIDIpOwogICAgICBoZWlnaHQgPSBNYXRoLmNlaWwoaGVpZ2h0IC8gMik7CiAgICB9CiAgfQogIHJlc2V0KGksIGopIHsKICAgIGxldCBjdXJyZW50TGV2ZWwgPSAwLAogICAgICB2YWx1ZSA9IDAsCiAgICAgIGxldmVsOwogICAgd2hpbGUgKGN1cnJlbnRMZXZlbCA8IHRoaXMubGV2ZWxzLmxlbmd0aCkgewogICAgICBsZXZlbCA9IHRoaXMubGV2ZWxzW2N1cnJlbnRMZXZlbF07CiAgICAgIGNvbnN0IGluZGV4ID0gaSArIGogKiBsZXZlbC53aWR0aDsKICAgICAgaWYgKGxldmVsLml0ZW1zW2luZGV4XSAhPT0gdW5kZWZpbmVkKSB7CiAgICAgICAgdmFsdWUgPSBsZXZlbC5pdGVtc1tpbmRleF07CiAgICAgICAgYnJlYWs7CiAgICAgIH0KICAgICAgbGV2ZWwuaW5kZXggPSBpbmRleDsKICAgICAgaSA+Pj0gMTsKICAgICAgaiA+Pj0gMTsKICAgICAgY3VycmVudExldmVsKys7CiAgICB9CiAgICBjdXJyZW50TGV2ZWwtLTsKICAgIGxldmVsID0gdGhpcy5sZXZlbHNbY3VycmVudExldmVsXTsKICAgIGxldmVsLml0ZW1zW2xldmVsLmluZGV4XSA9IHZhbHVlOwogICAgdGhpcy5jdXJyZW50TGV2ZWwgPSBjdXJyZW50TGV2ZWw7CiAgICBkZWxldGUgdGhpcy52YWx1ZTsKICB9CiAgaW5jcmVtZW50VmFsdWUoKSB7CiAgICBjb25zdCBsZXZlbCA9IHRoaXMubGV2ZWxzW3RoaXMuY3VycmVudExldmVsXTsKICAgIGxldmVsLml0ZW1zW2xldmVsLmluZGV4XSsrOwogIH0KICBuZXh0TGV2ZWwoKSB7CiAgICBsZXQgY3VycmVudExldmVsID0gdGhpcy5jdXJyZW50TGV2ZWw7CiAgICBsZXQgbGV2ZWwgPSB0aGlzLmxldmVsc1tjdXJyZW50TGV2ZWxdOwogICAgY29uc3QgdmFsdWUgPSBsZXZlbC5pdGVtc1tsZXZlbC5pbmRleF07CiAgICBjdXJyZW50TGV2ZWwtLTsKICAgIGlmIChjdXJyZW50TGV2ZWwgPCAwKSB7CiAgICAgIHRoaXMudmFsdWUgPSB2YWx1ZTsKICAgICAgcmV0dXJuIGZhbHNlOwogICAgfQogICAgdGhpcy5jdXJyZW50TGV2ZWwgPSBjdXJyZW50TGV2ZWw7CiAgICBsZXZlbCA9IHRoaXMubGV2ZWxzW2N1cnJlbnRMZXZlbF07CiAgICBsZXZlbC5pdGVtc1tsZXZlbC5pbmRleF0gPSB2YWx1ZTsKICAgIHJldHVybiB0cnVlOwogIH0KfQpjbGFzcyBJbmNsdXNpb25UcmVlIHsKICBjb25zdHJ1Y3Rvcih3aWR0aCwgaGVpZ2h0LCBkZWZhdWx0VmFsdWUpIHsKICAgIGNvbnN0IGxldmVsc0xlbmd0aCA9ICgwLCBfY29yZV91dGlscy5sb2cyKShNYXRoLm1heCh3aWR0aCwgaGVpZ2h0KSkgKyAxOwogICAgdGhpcy5sZXZlbHMgPSBbXTsKICAgIGZvciAobGV0IGkgPSAwOyBpIDwgbGV2ZWxzTGVuZ3RoOyBpKyspIHsKICAgICAgY29uc3QgaXRlbXMgPSBuZXcgVWludDhBcnJheSh3aWR0aCAqIGhlaWdodCk7CiAgICAgIGZvciAobGV0IGogPSAwLCBqaiA9IGl0ZW1zLmxlbmd0aDsgaiA8IGpqOyBqKyspIHsKICAgICAgICBpdGVtc1tqXSA9IGRlZmF1bHRWYWx1ZTsKICAgICAgfQogICAgICBjb25zdCBsZXZlbCA9IHsKICAgICAgICB3aWR0aCwKICAgICAgICBoZWlnaHQsCiAgICAgICAgaXRlbXMKICAgICAgfTsKICAgICAgdGhpcy5sZXZlbHMucHVzaChsZXZlbCk7CiAgICAgIHdpZHRoID0gTWF0aC5jZWlsKHdpZHRoIC8gMik7CiAgICAgIGhlaWdodCA9IE1hdGguY2VpbChoZWlnaHQgLyAyKTsKICAgIH0KICB9CiAgcmVzZXQoaSwgaiwgc3RvcFZhbHVlKSB7CiAgICBsZXQgY3VycmVudExldmVsID0gMDsKICAgIHdoaWxlIChjdXJyZW50TGV2ZWwgPCB0aGlzLmxldmVscy5sZW5ndGgpIHsKICAgICAgY29uc3QgbGV2ZWwgPSB0aGlzLmxldmVsc1tjdXJyZW50TGV2ZWxdOwogICAgICBjb25zdCBpbmRleCA9IGkgKyBqICogbGV2ZWwud2lkdGg7CiAgICAgIGxldmVsLmluZGV4ID0gaW5kZXg7CiAgICAgIGNvbnN0IHZhbHVlID0gbGV2ZWwuaXRlbXNbaW5kZXhdOwogICAgICBpZiAodmFsdWUgPT09IDB4ZmYpIHsKICAgICAgICBicmVhazsKICAgICAgfQogICAgICBpZiAodmFsdWUgPiBzdG9wVmFsdWUpIHsKICAgICAgICB0aGlzLmN1cnJlbnRMZXZlbCA9IGN1cnJlbnRMZXZlbDsKICAgICAgICB0aGlzLnByb3BhZ2F0ZVZhbHVlcygpOwogICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgfQogICAgICBpID4+PSAxOwogICAgICBqID4+PSAxOwogICAgICBjdXJyZW50TGV2ZWwrKzsKICAgIH0KICAgIHRoaXMuY3VycmVudExldmVsID0gY3VycmVudExldmVsIC0gMTsKICAgIHJldHVybiB0cnVlOwogIH0KICBpbmNyZW1lbnRWYWx1ZShzdG9wVmFsdWUpIHsKICAgIGNvbnN0IGxldmVsID0gdGhpcy5sZXZlbHNbdGhpcy5jdXJyZW50TGV2ZWxdOwogICAgbGV2ZWwuaXRlbXNbbGV2ZWwuaW5kZXhdID0gc3RvcFZhbHVlICsgMTsKICAgIHRoaXMucHJvcGFnYXRlVmFsdWVzKCk7CiAgfQogIHByb3BhZ2F0ZVZhbHVlcygpIHsKICAgIGxldCBsZXZlbEluZGV4ID0gdGhpcy5jdXJyZW50TGV2ZWw7CiAgICBsZXQgbGV2ZWwgPSB0aGlzLmxldmVsc1tsZXZlbEluZGV4XTsKICAgIGNvbnN0IGN1cnJlbnRWYWx1ZSA9IGxldmVsLml0ZW1zW2xldmVsLmluZGV4XTsKICAgIHdoaWxlICgtLWxldmVsSW5kZXggPj0gMCkgewogICAgICBsZXZlbCA9IHRoaXMubGV2ZWxzW2xldmVsSW5kZXhdOwogICAgICBsZXZlbC5pdGVtc1tsZXZlbC5pbmRleF0gPSBjdXJyZW50VmFsdWU7CiAgICB9CiAgfQogIG5leHRMZXZlbCgpIHsKICAgIGxldCBjdXJyZW50TGV2ZWwgPSB0aGlzLmN1cnJlbnRMZXZlbDsKICAgIGxldCBsZXZlbCA9IHRoaXMubGV2ZWxzW2N1cnJlbnRMZXZlbF07CiAgICBjb25zdCB2YWx1ZSA9IGxldmVsLml0ZW1zW2xldmVsLmluZGV4XTsKICAgIGxldmVsLml0ZW1zW2xldmVsLmluZGV4XSA9IDB4ZmY7CiAgICBjdXJyZW50TGV2ZWwtLTsKICAgIGlmIChjdXJyZW50TGV2ZWwgPCAwKSB7CiAgICAgIHJldHVybiBmYWxzZTsKICAgIH0KICAgIHRoaXMuY3VycmVudExldmVsID0gY3VycmVudExldmVsOwogICAgbGV2ZWwgPSB0aGlzLmxldmVsc1tjdXJyZW50TGV2ZWxdOwogICAgbGV2ZWwuaXRlbXNbbGV2ZWwuaW5kZXhdID0gdmFsdWU7CiAgICByZXR1cm4gdHJ1ZTsKICB9Cn0KY2xhc3MgQml0TW9kZWwgewogIHN0YXRpYyBVTklGT1JNX0NPTlRFWFQgPSAxNzsKICBzdGF0aWMgUlVOTEVOR1RIX0NPTlRFWFQgPSAxODsKICBzdGF0aWMgTExBbmRMSENvbnRleHRzTGFiZWwgPSBuZXcgVWludDhBcnJheShbMCwgNSwgOCwgMCwgMywgNywgOCwgMCwgNCwgNywgOCwgMCwgMCwgMCwgMCwgMCwgMSwgNiwgOCwgMCwgMywgNywgOCwgMCwgNCwgNywgOCwgMCwgMCwgMCwgMCwgMCwgMiwgNiwgOCwgMCwgMywgNywgOCwgMCwgNCwgNywgOCwgMCwgMCwgMCwgMCwgMCwgMiwgNiwgOCwgMCwgMywgNywgOCwgMCwgNCwgNywgOCwgMCwgMCwgMCwgMCwgMCwgMiwgNiwgOCwgMCwgMywgNywgOCwgMCwgNCwgNywgOF0pOwogIHN0YXRpYyBITENvbnRleHRMYWJlbCA9IG5ldyBVaW50OEFycmF5KFswLCAzLCA0LCAwLCA1LCA3LCA3LCAwLCA4LCA4LCA4LCAwLCAwLCAwLCAwLCAwLCAxLCAzLCA0LCAwLCA2LCA3LCA3LCAwLCA4LCA4LCA4LCAwLCAwLCAwLCAwLCAwLCAyLCAzLCA0LCAwLCA2LCA3LCA3LCAwLCA4LCA4LCA4LCAwLCAwLCAwLCAwLCAwLCAyLCAzLCA0LCAwLCA2LCA3LCA3LCAwLCA4LCA4LCA4LCAwLCAwLCAwLCAwLCAwLCAyLCAzLCA0LCAwLCA2LCA3LCA3LCAwLCA4LCA4LCA4XSk7CiAgc3RhdGljIEhIQ29udGV4dExhYmVsID0gbmV3IFVpbnQ4QXJyYXkoWzAsIDEsIDIsIDAsIDEsIDIsIDIsIDAsIDIsIDIsIDIsIDAsIDAsIDAsIDAsIDAsIDMsIDQsIDUsIDAsIDQsIDUsIDUsIDAsIDUsIDUsIDUsIDAsIDAsIDAsIDAsIDAsIDYsIDcsIDcsIDAsIDcsIDcsIDcsIDAsIDcsIDcsIDcsIDAsIDAsIDAsIDAsIDAsIDgsIDgsIDgsIDAsIDgsIDgsIDgsIDAsIDgsIDgsIDgsIDAsIDAsIDAsIDAsIDAsIDgsIDgsIDgsIDAsIDgsIDgsIDgsIDAsIDgsIDgsIDhdKTsKICBjb25zdHJ1Y3Rvcih3aWR0aCwgaGVpZ2h0LCBzdWJiYW5kLCB6ZXJvQml0UGxhbmVzLCBtYikgewogICAgdGhpcy53aWR0aCA9IHdpZHRoOwogICAgdGhpcy5oZWlnaHQgPSBoZWlnaHQ7CiAgICBsZXQgY29udGV4dExhYmVsVGFibGU7CiAgICBpZiAoc3ViYmFuZCA9PT0gIkhIIikgewogICAgICBjb250ZXh0TGFiZWxUYWJsZSA9IEJpdE1vZGVsLkhIQ29udGV4dExhYmVsOwogICAgfSBlbHNlIGlmIChzdWJiYW5kID09PSAiSEwiKSB7CiAgICAgIGNvbnRleHRMYWJlbFRhYmxlID0gQml0TW9kZWwuSExDb250ZXh0TGFiZWw7CiAgICB9IGVsc2UgewogICAgICBjb250ZXh0TGFiZWxUYWJsZSA9IEJpdE1vZGVsLkxMQW5kTEhDb250ZXh0c0xhYmVsOwogICAgfQogICAgdGhpcy5jb250ZXh0TGFiZWxUYWJsZSA9IGNvbnRleHRMYWJlbFRhYmxlOwogICAgY29uc3QgY29lZmZpY2llbnRDb3VudCA9IHdpZHRoICogaGVpZ2h0OwogICAgdGhpcy5uZWlnaGJvcnNTaWduaWZpY2FuY2UgPSBuZXcgVWludDhBcnJheShjb2VmZmljaWVudENvdW50KTsKICAgIHRoaXMuY29lZmZpY2VudHNTaWduID0gbmV3IFVpbnQ4QXJyYXkoY29lZmZpY2llbnRDb3VudCk7CiAgICBsZXQgY29lZmZpY2VudHNNYWduaXR1ZGU7CiAgICBpZiAobWIgPiAxNCkgewogICAgICBjb2VmZmljZW50c01hZ25pdHVkZSA9IG5ldyBVaW50MzJBcnJheShjb2VmZmljaWVudENvdW50KTsKICAgIH0gZWxzZSBpZiAobWIgPiA2KSB7CiAgICAgIGNvZWZmaWNlbnRzTWFnbml0dWRlID0gbmV3IFVpbnQxNkFycmF5KGNvZWZmaWNpZW50Q291bnQpOwogICAgfSBlbHNlIHsKICAgICAgY29lZmZpY2VudHNNYWduaXR1ZGUgPSBuZXcgVWludDhBcnJheShjb2VmZmljaWVudENvdW50KTsKICAgIH0KICAgIHRoaXMuY29lZmZpY2VudHNNYWduaXR1ZGUgPSBjb2VmZmljZW50c01hZ25pdHVkZTsKICAgIHRoaXMucHJvY2Vzc2luZ0ZsYWdzID0gbmV3IFVpbnQ4QXJyYXkoY29lZmZpY2llbnRDb3VudCk7CiAgICBjb25zdCBiaXRzRGVjb2RlZCA9IG5ldyBVaW50OEFycmF5KGNvZWZmaWNpZW50Q291bnQpOwogICAgaWYgKHplcm9CaXRQbGFuZXMgIT09IDApIHsKICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCBjb2VmZmljaWVudENvdW50OyBpKyspIHsKICAgICAgICBiaXRzRGVjb2RlZFtpXSA9IHplcm9CaXRQbGFuZXM7CiAgICAgIH0KICAgIH0KICAgIHRoaXMuYml0c0RlY29kZWQgPSBiaXRzRGVjb2RlZDsKICAgIHRoaXMucmVzZXQoKTsKICB9CiAgc2V0RGVjb2RlcihkZWNvZGVyKSB7CiAgICB0aGlzLmRlY29kZXIgPSBkZWNvZGVyOwogIH0KICByZXNldCgpIHsKICAgIHRoaXMuY29udGV4dHMgPSBuZXcgSW50OEFycmF5KDE5KTsKICAgIHRoaXMuY29udGV4dHNbMF0gPSA0IDw8IDEgfCAwOwogICAgdGhpcy5jb250ZXh0c1tCaXRNb2RlbC5VTklGT1JNX0NPTlRFWFRdID0gNDYgPDwgMSB8IDA7CiAgICB0aGlzLmNvbnRleHRzW0JpdE1vZGVsLlJVTkxFTkdUSF9DT05URVhUXSA9IDMgPDwgMSB8IDA7CiAgfQogIHNldE5laWdoYm9yc1NpZ25pZmljYW5jZShyb3csIGNvbHVtbiwgaW5kZXgpIHsKICAgIGNvbnN0IG5laWdoYm9yc1NpZ25pZmljYW5jZSA9IHRoaXMubmVpZ2hib3JzU2lnbmlmaWNhbmNlOwogICAgY29uc3Qgd2lkdGggPSB0aGlzLndpZHRoLAogICAgICBoZWlnaHQgPSB0aGlzLmhlaWdodDsKICAgIGNvbnN0IGxlZnQgPSBjb2x1bW4gPiAwOwogICAgY29uc3QgcmlnaHQgPSBjb2x1bW4gKyAxIDwgd2lkdGg7CiAgICBsZXQgaTsKICAgIGlmIChyb3cgPiAwKSB7CiAgICAgIGkgPSBpbmRleCAtIHdpZHRoOwogICAgICBpZiAobGVmdCkgewogICAgICAgIG5laWdoYm9yc1NpZ25pZmljYW5jZVtpIC0gMV0gKz0gMHgxMDsKICAgICAgfQogICAgICBpZiAocmlnaHQpIHsKICAgICAgICBuZWlnaGJvcnNTaWduaWZpY2FuY2VbaSArIDFdICs9IDB4MTA7CiAgICAgIH0KICAgICAgbmVpZ2hib3JzU2lnbmlmaWNhbmNlW2ldICs9IDB4MDQ7CiAgICB9CiAgICBpZiAocm93ICsgMSA8IGhlaWdodCkgewogICAgICBpID0gaW5kZXggKyB3aWR0aDsKICAgICAgaWYgKGxlZnQpIHsKICAgICAgICBuZWlnaGJvcnNTaWduaWZpY2FuY2VbaSAtIDFdICs9IDB4MTA7CiAgICAgIH0KICAgICAgaWYgKHJpZ2h0KSB7CiAgICAgICAgbmVpZ2hib3JzU2lnbmlmaWNhbmNlW2kgKyAxXSArPSAweDEwOwogICAgICB9CiAgICAgIG5laWdoYm9yc1NpZ25pZmljYW5jZVtpXSArPSAweDA0OwogICAgfQogICAgaWYgKGxlZnQpIHsKICAgICAgbmVpZ2hib3JzU2lnbmlmaWNhbmNlW2luZGV4IC0gMV0gKz0gMHgwMTsKICAgIH0KICAgIGlmIChyaWdodCkgewogICAgICBuZWlnaGJvcnNTaWduaWZpY2FuY2VbaW5kZXggKyAxXSArPSAweDAxOwogICAgfQogICAgbmVpZ2hib3JzU2lnbmlmaWNhbmNlW2luZGV4XSB8PSAweDgwOwogIH0KICBydW5TaWduaWZpY2FuY2VQcm9wYWdhdGlvblBhc3MoKSB7CiAgICBjb25zdCBkZWNvZGVyID0gdGhpcy5kZWNvZGVyOwogICAgY29uc3Qgd2lkdGggPSB0aGlzLndpZHRoLAogICAgICBoZWlnaHQgPSB0aGlzLmhlaWdodDsKICAgIGNvbnN0IGNvZWZmaWNlbnRzTWFnbml0dWRlID0gdGhpcy5jb2VmZmljZW50c01hZ25pdHVkZTsKICAgIGNvbnN0IGNvZWZmaWNlbnRzU2lnbiA9IHRoaXMuY29lZmZpY2VudHNTaWduOwogICAgY29uc3QgbmVpZ2hib3JzU2lnbmlmaWNhbmNlID0gdGhpcy5uZWlnaGJvcnNTaWduaWZpY2FuY2U7CiAgICBjb25zdCBwcm9jZXNzaW5nRmxhZ3MgPSB0aGlzLnByb2Nlc3NpbmdGbGFnczsKICAgIGNvbnN0IGNvbnRleHRzID0gdGhpcy5jb250ZXh0czsKICAgIGNvbnN0IGxhYmVscyA9IHRoaXMuY29udGV4dExhYmVsVGFibGU7CiAgICBjb25zdCBiaXRzRGVjb2RlZCA9IHRoaXMuYml0c0RlY29kZWQ7CiAgICBjb25zdCBwcm9jZXNzZWRJbnZlcnNlTWFzayA9IH4xOwogICAgY29uc3QgcHJvY2Vzc2VkTWFzayA9IDE7CiAgICBjb25zdCBmaXJzdE1hZ25pdHVkZUJpdE1hc2sgPSAyOwogICAgZm9yIChsZXQgaTAgPSAwOyBpMCA8IGhlaWdodDsgaTAgKz0gNCkgewogICAgICBmb3IgKGxldCBqID0gMDsgaiA8IHdpZHRoOyBqKyspIHsKICAgICAgICBsZXQgaW5kZXggPSBpMCAqIHdpZHRoICsgajsKICAgICAgICBmb3IgKGxldCBpMSA9IDA7IGkxIDwgNDsgaTErKywgaW5kZXggKz0gd2lkdGgpIHsKICAgICAgICAgIGNvbnN0IGkgPSBpMCArIGkxOwogICAgICAgICAgaWYgKGkgPj0gaGVpZ2h0KSB7CiAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgfQogICAgICAgICAgcHJvY2Vzc2luZ0ZsYWdzW2luZGV4XSAmPSBwcm9jZXNzZWRJbnZlcnNlTWFzazsKICAgICAgICAgIGlmIChjb2VmZmljZW50c01hZ25pdHVkZVtpbmRleF0gfHwgIW5laWdoYm9yc1NpZ25pZmljYW5jZVtpbmRleF0pIHsKICAgICAgICAgICAgY29udGludWU7CiAgICAgICAgICB9CiAgICAgICAgICBjb25zdCBjb250ZXh0TGFiZWwgPSBsYWJlbHNbbmVpZ2hib3JzU2lnbmlmaWNhbmNlW2luZGV4XV07CiAgICAgICAgICBjb25zdCBkZWNpc2lvbiA9IGRlY29kZXIucmVhZEJpdChjb250ZXh0cywgY29udGV4dExhYmVsKTsKICAgICAgICAgIGlmIChkZWNpc2lvbikgewogICAgICAgICAgICBjb25zdCBzaWduID0gdGhpcy5kZWNvZGVTaWduQml0KGksIGosIGluZGV4KTsKICAgICAgICAgICAgY29lZmZpY2VudHNTaWduW2luZGV4XSA9IHNpZ247CiAgICAgICAgICAgIGNvZWZmaWNlbnRzTWFnbml0dWRlW2luZGV4XSA9IDE7CiAgICAgICAgICAgIHRoaXMuc2V0TmVpZ2hib3JzU2lnbmlmaWNhbmNlKGksIGosIGluZGV4KTsKICAgICAgICAgICAgcHJvY2Vzc2luZ0ZsYWdzW2luZGV4XSB8PSBmaXJzdE1hZ25pdHVkZUJpdE1hc2s7CiAgICAgICAgICB9CiAgICAgICAgICBiaXRzRGVjb2RlZFtpbmRleF0rKzsKICAgICAgICAgIHByb2Nlc3NpbmdGbGFnc1tpbmRleF0gfD0gcHJvY2Vzc2VkTWFzazsKICAgICAgICB9CiAgICAgIH0KICAgIH0KICB9CiAgZGVjb2RlU2lnbkJpdChyb3csIGNvbHVtbiwgaW5kZXgpIHsKICAgIGNvbnN0IHdpZHRoID0gdGhpcy53aWR0aCwKICAgICAgaGVpZ2h0ID0gdGhpcy5oZWlnaHQ7CiAgICBjb25zdCBjb2VmZmljZW50c01hZ25pdHVkZSA9IHRoaXMuY29lZmZpY2VudHNNYWduaXR1ZGU7CiAgICBjb25zdCBjb2VmZmljZW50c1NpZ24gPSB0aGlzLmNvZWZmaWNlbnRzU2lnbjsKICAgIGxldCBjb250cmlidXRpb24sIHNpZ24wLCBzaWduMSwgc2lnbmlmaWNhbmNlMTsKICAgIGxldCBjb250ZXh0TGFiZWwsIGRlY29kZWQ7CiAgICBzaWduaWZpY2FuY2UxID0gY29sdW1uID4gMCAmJiBjb2VmZmljZW50c01hZ25pdHVkZVtpbmRleCAtIDFdICE9PSAwOwogICAgaWYgKGNvbHVtbiArIDEgPCB3aWR0aCAmJiBjb2VmZmljZW50c01hZ25pdHVkZVtpbmRleCArIDFdICE9PSAwKSB7CiAgICAgIHNpZ24xID0gY29lZmZpY2VudHNTaWduW2luZGV4ICsgMV07CiAgICAgIGlmIChzaWduaWZpY2FuY2UxKSB7CiAgICAgICAgc2lnbjAgPSBjb2VmZmljZW50c1NpZ25baW5kZXggLSAxXTsKICAgICAgICBjb250cmlidXRpb24gPSAxIC0gc2lnbjEgLSBzaWduMDsKICAgICAgfSBlbHNlIHsKICAgICAgICBjb250cmlidXRpb24gPSAxIC0gc2lnbjEgLSBzaWduMTsKICAgICAgfQogICAgfSBlbHNlIGlmIChzaWduaWZpY2FuY2UxKSB7CiAgICAgIHNpZ24wID0gY29lZmZpY2VudHNTaWduW2luZGV4IC0gMV07CiAgICAgIGNvbnRyaWJ1dGlvbiA9IDEgLSBzaWduMCAtIHNpZ24wOwogICAgfSBlbHNlIHsKICAgICAgY29udHJpYnV0aW9uID0gMDsKICAgIH0KICAgIGNvbnN0IGhvcml6b250YWxDb250cmlidXRpb24gPSAzICogY29udHJpYnV0aW9uOwogICAgc2lnbmlmaWNhbmNlMSA9IHJvdyA+IDAgJiYgY29lZmZpY2VudHNNYWduaXR1ZGVbaW5kZXggLSB3aWR0aF0gIT09IDA7CiAgICBpZiAocm93ICsgMSA8IGhlaWdodCAmJiBjb2VmZmljZW50c01hZ25pdHVkZVtpbmRleCArIHdpZHRoXSAhPT0gMCkgewogICAgICBzaWduMSA9IGNvZWZmaWNlbnRzU2lnbltpbmRleCArIHdpZHRoXTsKICAgICAgaWYgKHNpZ25pZmljYW5jZTEpIHsKICAgICAgICBzaWduMCA9IGNvZWZmaWNlbnRzU2lnbltpbmRleCAtIHdpZHRoXTsKICAgICAgICBjb250cmlidXRpb24gPSAxIC0gc2lnbjEgLSBzaWduMCArIGhvcml6b250YWxDb250cmlidXRpb247CiAgICAgIH0gZWxzZSB7CiAgICAgICAgY29udHJpYnV0aW9uID0gMSAtIHNpZ24xIC0gc2lnbjEgKyBob3Jpem9udGFsQ29udHJpYnV0aW9uOwogICAgICB9CiAgICB9IGVsc2UgaWYgKHNpZ25pZmljYW5jZTEpIHsKICAgICAgc2lnbjAgPSBjb2VmZmljZW50c1NpZ25baW5kZXggLSB3aWR0aF07CiAgICAgIGNvbnRyaWJ1dGlvbiA9IDEgLSBzaWduMCAtIHNpZ24wICsgaG9yaXpvbnRhbENvbnRyaWJ1dGlvbjsKICAgIH0gZWxzZSB7CiAgICAgIGNvbnRyaWJ1dGlvbiA9IGhvcml6b250YWxDb250cmlidXRpb247CiAgICB9CiAgICBpZiAoY29udHJpYnV0aW9uID49IDApIHsKICAgICAgY29udGV4dExhYmVsID0gOSArIGNvbnRyaWJ1dGlvbjsKICAgICAgZGVjb2RlZCA9IHRoaXMuZGVjb2Rlci5yZWFkQml0KHRoaXMuY29udGV4dHMsIGNvbnRleHRMYWJlbCk7CiAgICB9IGVsc2UgewogICAgICBjb250ZXh0TGFiZWwgPSA5IC0gY29udHJpYnV0aW9uOwogICAgICBkZWNvZGVkID0gdGhpcy5kZWNvZGVyLnJlYWRCaXQodGhpcy5jb250ZXh0cywgY29udGV4dExhYmVsKSBeIDE7CiAgICB9CiAgICByZXR1cm4gZGVjb2RlZDsKICB9CiAgcnVuTWFnbml0dWRlUmVmaW5lbWVudFBhc3MoKSB7CiAgICBjb25zdCBkZWNvZGVyID0gdGhpcy5kZWNvZGVyOwogICAgY29uc3Qgd2lkdGggPSB0aGlzLndpZHRoLAogICAgICBoZWlnaHQgPSB0aGlzLmhlaWdodDsKICAgIGNvbnN0IGNvZWZmaWNlbnRzTWFnbml0dWRlID0gdGhpcy5jb2VmZmljZW50c01hZ25pdHVkZTsKICAgIGNvbnN0IG5laWdoYm9yc1NpZ25pZmljYW5jZSA9IHRoaXMubmVpZ2hib3JzU2lnbmlmaWNhbmNlOwogICAgY29uc3QgY29udGV4dHMgPSB0aGlzLmNvbnRleHRzOwogICAgY29uc3QgYml0c0RlY29kZWQgPSB0aGlzLmJpdHNEZWNvZGVkOwogICAgY29uc3QgcHJvY2Vzc2luZ0ZsYWdzID0gdGhpcy5wcm9jZXNzaW5nRmxhZ3M7CiAgICBjb25zdCBwcm9jZXNzZWRNYXNrID0gMTsKICAgIGNvbnN0IGZpcnN0TWFnbml0dWRlQml0TWFzayA9IDI7CiAgICBjb25zdCBsZW5ndGggPSB3aWR0aCAqIGhlaWdodDsKICAgIGNvbnN0IHdpZHRoNCA9IHdpZHRoICogNDsKICAgIGZvciAobGV0IGluZGV4MCA9IDAsIGluZGV4TmV4dDsgaW5kZXgwIDwgbGVuZ3RoOyBpbmRleDAgPSBpbmRleE5leHQpIHsKICAgICAgaW5kZXhOZXh0ID0gTWF0aC5taW4obGVuZ3RoLCBpbmRleDAgKyB3aWR0aDQpOwogICAgICBmb3IgKGxldCBqID0gMDsgaiA8IHdpZHRoOyBqKyspIHsKICAgICAgICBmb3IgKGxldCBpbmRleCA9IGluZGV4MCArIGo7IGluZGV4IDwgaW5kZXhOZXh0OyBpbmRleCArPSB3aWR0aCkgewogICAgICAgICAgaWYgKCFjb2VmZmljZW50c01hZ25pdHVkZVtpbmRleF0gfHwgKHByb2Nlc3NpbmdGbGFnc1tpbmRleF0gJiBwcm9jZXNzZWRNYXNrKSAhPT0gMCkgewogICAgICAgICAgICBjb250aW51ZTsKICAgICAgICAgIH0KICAgICAgICAgIGxldCBjb250ZXh0TGFiZWwgPSAxNjsKICAgICAgICAgIGlmICgocHJvY2Vzc2luZ0ZsYWdzW2luZGV4XSAmIGZpcnN0TWFnbml0dWRlQml0TWFzaykgIT09IDApIHsKICAgICAgICAgICAgcHJvY2Vzc2luZ0ZsYWdzW2luZGV4XSBePSBmaXJzdE1hZ25pdHVkZUJpdE1hc2s7CiAgICAgICAgICAgIGNvbnN0IHNpZ25pZmljYW5jZSA9IG5laWdoYm9yc1NpZ25pZmljYW5jZVtpbmRleF0gJiAxMjc7CiAgICAgICAgICAgIGNvbnRleHRMYWJlbCA9IHNpZ25pZmljYW5jZSA9PT0gMCA/IDE1IDogMTQ7CiAgICAgICAgICB9CiAgICAgICAgICBjb25zdCBiaXQgPSBkZWNvZGVyLnJlYWRCaXQoY29udGV4dHMsIGNvbnRleHRMYWJlbCk7CiAgICAgICAgICBjb2VmZmljZW50c01hZ25pdHVkZVtpbmRleF0gPSBjb2VmZmljZW50c01hZ25pdHVkZVtpbmRleF0gPDwgMSB8IGJpdDsKICAgICAgICAgIGJpdHNEZWNvZGVkW2luZGV4XSsrOwogICAgICAgICAgcHJvY2Vzc2luZ0ZsYWdzW2luZGV4XSB8PSBwcm9jZXNzZWRNYXNrOwogICAgICAgIH0KICAgICAgfQogICAgfQogIH0KICBydW5DbGVhbnVwUGFzcygpIHsKICAgIGNvbnN0IGRlY29kZXIgPSB0aGlzLmRlY29kZXI7CiAgICBjb25zdCB3aWR0aCA9IHRoaXMud2lkdGgsCiAgICAgIGhlaWdodCA9IHRoaXMuaGVpZ2h0OwogICAgY29uc3QgbmVpZ2hib3JzU2lnbmlmaWNhbmNlID0gdGhpcy5uZWlnaGJvcnNTaWduaWZpY2FuY2U7CiAgICBjb25zdCBjb2VmZmljZW50c01hZ25pdHVkZSA9IHRoaXMuY29lZmZpY2VudHNNYWduaXR1ZGU7CiAgICBjb25zdCBjb2VmZmljZW50c1NpZ24gPSB0aGlzLmNvZWZmaWNlbnRzU2lnbjsKICAgIGNvbnN0IGNvbnRleHRzID0gdGhpcy5jb250ZXh0czsKICAgIGNvbnN0IGxhYmVscyA9IHRoaXMuY29udGV4dExhYmVsVGFibGU7CiAgICBjb25zdCBiaXRzRGVjb2RlZCA9IHRoaXMuYml0c0RlY29kZWQ7CiAgICBjb25zdCBwcm9jZXNzaW5nRmxhZ3MgPSB0aGlzLnByb2Nlc3NpbmdGbGFnczsKICAgIGNvbnN0IHByb2Nlc3NlZE1hc2sgPSAxOwogICAgY29uc3QgZmlyc3RNYWduaXR1ZGVCaXRNYXNrID0gMjsKICAgIGNvbnN0IG9uZVJvd0Rvd24gPSB3aWR0aDsKICAgIGNvbnN0IHR3b1Jvd3NEb3duID0gd2lkdGggKiAyOwogICAgY29uc3QgdGhyZWVSb3dzRG93biA9IHdpZHRoICogMzsKICAgIGxldCBpTmV4dDsKICAgIGZvciAobGV0IGkwID0gMDsgaTAgPCBoZWlnaHQ7IGkwID0gaU5leHQpIHsKICAgICAgaU5leHQgPSBNYXRoLm1pbihpMCArIDQsIGhlaWdodCk7CiAgICAgIGNvbnN0IGluZGV4QmFzZSA9IGkwICogd2lkdGg7CiAgICAgIGNvbnN0IGNoZWNrQWxsRW1wdHkgPSBpMCArIDMgPCBoZWlnaHQ7CiAgICAgIGZvciAobGV0IGogPSAwOyBqIDwgd2lkdGg7IGorKykgewogICAgICAgIGNvbnN0IGluZGV4MCA9IGluZGV4QmFzZSArIGo7CiAgICAgICAgY29uc3QgYWxsRW1wdHkgPSBjaGVja0FsbEVtcHR5ICYmIHByb2Nlc3NpbmdGbGFnc1tpbmRleDBdID09PSAwICYmIHByb2Nlc3NpbmdGbGFnc1tpbmRleDAgKyBvbmVSb3dEb3duXSA9PT0gMCAmJiBwcm9jZXNzaW5nRmxhZ3NbaW5kZXgwICsgdHdvUm93c0Rvd25dID09PSAwICYmIHByb2Nlc3NpbmdGbGFnc1tpbmRleDAgKyB0aHJlZVJvd3NEb3duXSA9PT0gMCAmJiBuZWlnaGJvcnNTaWduaWZpY2FuY2VbaW5kZXgwXSA9PT0gMCAmJiBuZWlnaGJvcnNTaWduaWZpY2FuY2VbaW5kZXgwICsgb25lUm93RG93bl0gPT09IDAgJiYgbmVpZ2hib3JzU2lnbmlmaWNhbmNlW2luZGV4MCArIHR3b1Jvd3NEb3duXSA9PT0gMCAmJiBuZWlnaGJvcnNTaWduaWZpY2FuY2VbaW5kZXgwICsgdGhyZWVSb3dzRG93bl0gPT09IDA7CiAgICAgICAgbGV0IGkxID0gMCwKICAgICAgICAgIGluZGV4ID0gaW5kZXgwOwogICAgICAgIGxldCBpID0gaTAsCiAgICAgICAgICBzaWduOwogICAgICAgIGlmIChhbGxFbXB0eSkgewogICAgICAgICAgY29uc3QgaGFzU2lnbmlmaWNhbnRDb2VmZmljZW50ID0gZGVjb2Rlci5yZWFkQml0KGNvbnRleHRzLCBCaXRNb2RlbC5SVU5MRU5HVEhfQ09OVEVYVCk7CiAgICAgICAgICBpZiAoIWhhc1NpZ25pZmljYW50Q29lZmZpY2VudCkgewogICAgICAgICAgICBiaXRzRGVjb2RlZFtpbmRleDBdKys7CiAgICAgICAgICAgIGJpdHNEZWNvZGVkW2luZGV4MCArIG9uZVJvd0Rvd25dKys7CiAgICAgICAgICAgIGJpdHNEZWNvZGVkW2luZGV4MCArIHR3b1Jvd3NEb3duXSsrOwogICAgICAgICAgICBiaXRzRGVjb2RlZFtpbmRleDAgKyB0aHJlZVJvd3NEb3duXSsrOwogICAgICAgICAgICBjb250aW51ZTsKICAgICAgICAgIH0KICAgICAgICAgIGkxID0gZGVjb2Rlci5yZWFkQml0KGNvbnRleHRzLCBCaXRNb2RlbC5VTklGT1JNX0NPTlRFWFQpIDw8IDEgfCBkZWNvZGVyLnJlYWRCaXQoY29udGV4dHMsIEJpdE1vZGVsLlVOSUZPUk1fQ09OVEVYVCk7CiAgICAgICAgICBpZiAoaTEgIT09IDApIHsKICAgICAgICAgICAgaSA9IGkwICsgaTE7CiAgICAgICAgICAgIGluZGV4ICs9IGkxICogd2lkdGg7CiAgICAgICAgICB9CiAgICAgICAgICBzaWduID0gdGhpcy5kZWNvZGVTaWduQml0KGksIGosIGluZGV4KTsKICAgICAgICAgIGNvZWZmaWNlbnRzU2lnbltpbmRleF0gPSBzaWduOwogICAgICAgICAgY29lZmZpY2VudHNNYWduaXR1ZGVbaW5kZXhdID0gMTsKICAgICAgICAgIHRoaXMuc2V0TmVpZ2hib3JzU2lnbmlmaWNhbmNlKGksIGosIGluZGV4KTsKICAgICAgICAgIHByb2Nlc3NpbmdGbGFnc1tpbmRleF0gfD0gZmlyc3RNYWduaXR1ZGVCaXRNYXNrOwogICAgICAgICAgaW5kZXggPSBpbmRleDA7CiAgICAgICAgICBmb3IgKGxldCBpMiA9IGkwOyBpMiA8PSBpOyBpMisrLCBpbmRleCArPSB3aWR0aCkgewogICAgICAgICAgICBiaXRzRGVjb2RlZFtpbmRleF0rKzsKICAgICAgICAgIH0KICAgICAgICAgIGkxKys7CiAgICAgICAgfQogICAgICAgIGZvciAoaSA9IGkwICsgaTE7IGkgPCBpTmV4dDsgaSsrLCBpbmRleCArPSB3aWR0aCkgewogICAgICAgICAgaWYgKGNvZWZmaWNlbnRzTWFnbml0dWRlW2luZGV4XSB8fCAocHJvY2Vzc2luZ0ZsYWdzW2luZGV4XSAmIHByb2Nlc3NlZE1hc2spICE9PSAwKSB7CiAgICAgICAgICAgIGNvbnRpbnVlOwogICAgICAgICAgfQogICAgICAgICAgY29uc3QgY29udGV4dExhYmVsID0gbGFiZWxzW25laWdoYm9yc1NpZ25pZmljYW5jZVtpbmRleF1dOwogICAgICAgICAgY29uc3QgZGVjaXNpb24gPSBkZWNvZGVyLnJlYWRCaXQoY29udGV4dHMsIGNvbnRleHRMYWJlbCk7CiAgICAgICAgICBpZiAoZGVjaXNpb24gPT09IDEpIHsKICAgICAgICAgICAgc2lnbiA9IHRoaXMuZGVjb2RlU2lnbkJpdChpLCBqLCBpbmRleCk7CiAgICAgICAgICAgIGNvZWZmaWNlbnRzU2lnbltpbmRleF0gPSBzaWduOwogICAgICAgICAgICBjb2VmZmljZW50c01hZ25pdHVkZVtpbmRleF0gPSAxOwogICAgICAgICAgICB0aGlzLnNldE5laWdoYm9yc1NpZ25pZmljYW5jZShpLCBqLCBpbmRleCk7CiAgICAgICAgICAgIHByb2Nlc3NpbmdGbGFnc1tpbmRleF0gfD0gZmlyc3RNYWduaXR1ZGVCaXRNYXNrOwogICAgICAgICAgfQogICAgICAgICAgYml0c0RlY29kZWRbaW5kZXhdKys7CiAgICAgICAgfQogICAgICB9CiAgICB9CiAgfQogIGNoZWNrU2VnbWVudGF0aW9uU3ltYm9sKCkgewogICAgY29uc3QgZGVjb2RlciA9IHRoaXMuZGVjb2RlcjsKICAgIGNvbnN0IGNvbnRleHRzID0gdGhpcy5jb250ZXh0czsKICAgIGNvbnN0IHN5bWJvbCA9IGRlY29kZXIucmVhZEJpdChjb250ZXh0cywgQml0TW9kZWwuVU5JRk9STV9DT05URVhUKSA8PCAzIHwgZGVjb2Rlci5yZWFkQml0KGNvbnRleHRzLCBCaXRNb2RlbC5VTklGT1JNX0NPTlRFWFQpIDw8IDIgfCBkZWNvZGVyLnJlYWRCaXQoY29udGV4dHMsIEJpdE1vZGVsLlVOSUZPUk1fQ09OVEVYVCkgPDwgMSB8IGRlY29kZXIucmVhZEJpdChjb250ZXh0cywgQml0TW9kZWwuVU5JRk9STV9DT05URVhUKTsKICAgIGlmIChzeW1ib2wgIT09IDB4YSkgewogICAgICB0aHJvdyBuZXcgSnB4RXJyb3IoIkludmFsaWQgc2VnbWVudGF0aW9uIHN5bWJvbCIpOwogICAgfQogIH0KfQpjbGFzcyBUcmFuc2Zvcm0gewogIGNvbnN0cnVjdG9yKCkgewogICAgaWYgKHRoaXMuY29uc3RydWN0b3IgPT09IFRyYW5zZm9ybSkgewogICAgICAoMCwgX3V0aWwudW5yZWFjaGFibGUpKCJDYW5ub3QgaW5pdGlhbGl6ZSBUcmFuc2Zvcm0uIik7CiAgICB9CiAgfQogIGNhbGN1bGF0ZShzdWJiYW5kcywgdTAsIHYwKSB7CiAgICBsZXQgbGwgPSBzdWJiYW5kc1swXTsKICAgIGZvciAobGV0IGkgPSAxLCBpaSA9IHN1YmJhbmRzLmxlbmd0aDsgaSA8IGlpOyBpKyspIHsKICAgICAgbGwgPSB0aGlzLml0ZXJhdGUobGwsIHN1YmJhbmRzW2ldLCB1MCwgdjApOwogICAgfQogICAgcmV0dXJuIGxsOwogIH0KICBleHRlbmQoYnVmZmVyLCBvZmZzZXQsIHNpemUpIHsKICAgIGxldCBpMSA9IG9mZnNldCAtIDEsCiAgICAgIGoxID0gb2Zmc2V0ICsgMTsKICAgIGxldCBpMiA9IG9mZnNldCArIHNpemUgLSAyLAogICAgICBqMiA9IG9mZnNldCArIHNpemU7CiAgICBidWZmZXJbaTEtLV0gPSBidWZmZXJbajErK107CiAgICBidWZmZXJbajIrK10gPSBidWZmZXJbaTItLV07CiAgICBidWZmZXJbaTEtLV0gPSBidWZmZXJbajErK107CiAgICBidWZmZXJbajIrK10gPSBidWZmZXJbaTItLV07CiAgICBidWZmZXJbaTEtLV0gPSBidWZmZXJbajErK107CiAgICBidWZmZXJbajIrK10gPSBidWZmZXJbaTItLV07CiAgICBidWZmZXJbaTFdID0gYnVmZmVyW2oxXTsKICAgIGJ1ZmZlcltqMl0gPSBidWZmZXJbaTJdOwogIH0KICBmaWx0ZXIoeCwgb2Zmc2V0LCBsZW5ndGgpIHsKICAgICgwLCBfdXRpbC51bnJlYWNoYWJsZSkoIkFic3RyYWN0IG1ldGhvZCBgZmlsdGVyYCBjYWxsZWQiKTsKICB9CiAgaXRlcmF0ZShsbCwgaGxfbGhfaGgsIHUwLCB2MCkgewogICAgY29uc3QgbGxXaWR0aCA9IGxsLndpZHRoLAogICAgICBsbEhlaWdodCA9IGxsLmhlaWdodDsKICAgIGxldCBsbEl0ZW1zID0gbGwuaXRlbXM7CiAgICBjb25zdCB3aWR0aCA9IGhsX2xoX2hoLndpZHRoOwogICAgY29uc3QgaGVpZ2h0ID0gaGxfbGhfaGguaGVpZ2h0OwogICAgY29uc3QgaXRlbXMgPSBobF9saF9oaC5pdGVtczsKICAgIGxldCBpLCBqLCBrLCBsLCB1LCB2OwogICAgZm9yIChrID0gMCwgaSA9IDA7IGkgPCBsbEhlaWdodDsgaSsrKSB7CiAgICAgIGwgPSBpICogMiAqIHdpZHRoOwogICAgICBmb3IgKGogPSAwOyBqIDwgbGxXaWR0aDsgaisrLCBrKyssIGwgKz0gMikgewogICAgICAgIGl0ZW1zW2xdID0gbGxJdGVtc1trXTsKICAgICAgfQogICAgfQogICAgbGxJdGVtcyA9IGxsLml0ZW1zID0gbnVsbDsKICAgIGNvbnN0IGJ1ZmZlclBhZGRpbmcgPSA0OwogICAgY29uc3Qgcm93QnVmZmVyID0gbmV3IEZsb2F0MzJBcnJheSh3aWR0aCArIDIgKiBidWZmZXJQYWRkaW5nKTsKICAgIGlmICh3aWR0aCA9PT0gMSkgewogICAgICBpZiAoKHUwICYgMSkgIT09IDApIHsKICAgICAgICBmb3IgKHYgPSAwLCBrID0gMDsgdiA8IGhlaWdodDsgdisrLCBrICs9IHdpZHRoKSB7CiAgICAgICAgICBpdGVtc1trXSAqPSAwLjU7CiAgICAgICAgfQogICAgICB9CiAgICB9IGVsc2UgewogICAgICBmb3IgKHYgPSAwLCBrID0gMDsgdiA8IGhlaWdodDsgdisrLCBrICs9IHdpZHRoKSB7CiAgICAgICAgcm93QnVmZmVyLnNldChpdGVtcy5zdWJhcnJheShrLCBrICsgd2lkdGgpLCBidWZmZXJQYWRkaW5nKTsKICAgICAgICB0aGlzLmV4dGVuZChyb3dCdWZmZXIsIGJ1ZmZlclBhZGRpbmcsIHdpZHRoKTsKICAgICAgICB0aGlzLmZpbHRlcihyb3dCdWZmZXIsIGJ1ZmZlclBhZGRpbmcsIHdpZHRoKTsKICAgICAgICBpdGVtcy5zZXQocm93QnVmZmVyLnN1YmFycmF5KGJ1ZmZlclBhZGRpbmcsIGJ1ZmZlclBhZGRpbmcgKyB3aWR0aCksIGspOwogICAgICB9CiAgICB9CiAgICBsZXQgbnVtQnVmZmVycyA9IDE2OwogICAgY29uc3QgY29sQnVmZmVycyA9IFtdOwogICAgZm9yIChpID0gMDsgaSA8IG51bUJ1ZmZlcnM7IGkrKykgewogICAgICBjb2xCdWZmZXJzLnB1c2gobmV3IEZsb2F0MzJBcnJheShoZWlnaHQgKyAyICogYnVmZmVyUGFkZGluZykpOwogICAgfQogICAgbGV0IGIsCiAgICAgIGN1cnJlbnRCdWZmZXIgPSAwOwogICAgbGwgPSBidWZmZXJQYWRkaW5nICsgaGVpZ2h0OwogICAgaWYgKGhlaWdodCA9PT0gMSkgewogICAgICBpZiAoKHYwICYgMSkgIT09IDApIHsKICAgICAgICBmb3IgKHUgPSAwOyB1IDwgd2lkdGg7IHUrKykgewogICAgICAgICAgaXRlbXNbdV0gKj0gMC41OwogICAgICAgIH0KICAgICAgfQogICAgfSBlbHNlIHsKICAgICAgZm9yICh1ID0gMDsgdSA8IHdpZHRoOyB1KyspIHsKICAgICAgICBpZiAoY3VycmVudEJ1ZmZlciA9PT0gMCkgewogICAgICAgICAgbnVtQnVmZmVycyA9IE1hdGgubWluKHdpZHRoIC0gdSwgbnVtQnVmZmVycyk7CiAgICAgICAgICBmb3IgKGsgPSB1LCBsID0gYnVmZmVyUGFkZGluZzsgbCA8IGxsOyBrICs9IHdpZHRoLCBsKyspIHsKICAgICAgICAgICAgZm9yIChiID0gMDsgYiA8IG51bUJ1ZmZlcnM7IGIrKykgewogICAgICAgICAgICAgIGNvbEJ1ZmZlcnNbYl1bbF0gPSBpdGVtc1trICsgYl07CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICAgIGN1cnJlbnRCdWZmZXIgPSBudW1CdWZmZXJzOwogICAgICAgIH0KICAgICAgICBjdXJyZW50QnVmZmVyLS07CiAgICAgICAgY29uc3QgYnVmZmVyID0gY29sQnVmZmVyc1tjdXJyZW50QnVmZmVyXTsKICAgICAgICB0aGlzLmV4dGVuZChidWZmZXIsIGJ1ZmZlclBhZGRpbmcsIGhlaWdodCk7CiAgICAgICAgdGhpcy5maWx0ZXIoYnVmZmVyLCBidWZmZXJQYWRkaW5nLCBoZWlnaHQpOwogICAgICAgIGlmIChjdXJyZW50QnVmZmVyID09PSAwKSB7CiAgICAgICAgICBrID0gdSAtIG51bUJ1ZmZlcnMgKyAxOwogICAgICAgICAgZm9yIChsID0gYnVmZmVyUGFkZGluZzsgbCA8IGxsOyBrICs9IHdpZHRoLCBsKyspIHsKICAgICAgICAgICAgZm9yIChiID0gMDsgYiA8IG51bUJ1ZmZlcnM7IGIrKykgewogICAgICAgICAgICAgIGl0ZW1zW2sgKyBiXSA9IGNvbEJ1ZmZlcnNbYl1bbF07CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICB9CiAgICAgIH0KICAgIH0KICAgIHJldHVybiB7CiAgICAgIHdpZHRoLAogICAgICBoZWlnaHQsCiAgICAgIGl0ZW1zCiAgICB9OwogIH0KfQpjbGFzcyBJcnJldmVyc2libGVUcmFuc2Zvcm0gZXh0ZW5kcyBUcmFuc2Zvcm0gewogIGZpbHRlcih4LCBvZmZzZXQsIGxlbmd0aCkgewogICAgY29uc3QgbGVuID0gbGVuZ3RoID4+IDE7CiAgICBvZmZzZXQgfD0gMDsKICAgIGxldCBqLCBuLCBjdXJyZW50LCBuZXh0OwogICAgY29uc3QgYWxwaGEgPSAtMS41ODYxMzQzNDIwNTk5MjQ7CiAgICBjb25zdCBiZXRhID0gLTAuMDUyOTgwMTE4NTcyOTYxOwogICAgY29uc3QgZ2FtbWEgPSAwLjg4MjkxMTA3NTUzMDkzNDsKICAgIGNvbnN0IGRlbHRhID0gMC40NDM1MDY4NTIwNDM5NzE7CiAgICBjb25zdCBLID0gMS4yMzAxNzQxMDQ5MTQwMDE7CiAgICBjb25zdCBLXyA9IDEgLyBLOwogICAgaiA9IG9mZnNldCAtIDM7CiAgICBmb3IgKG4gPSBsZW4gKyA0OyBuLS07IGogKz0gMikgewogICAgICB4W2pdICo9IEtfOwogICAgfQogICAgaiA9IG9mZnNldCAtIDI7CiAgICBjdXJyZW50ID0gZGVsdGEgKiB4W2ogLSAxXTsKICAgIGZvciAobiA9IGxlbiArIDM7IG4tLTsgaiArPSAyKSB7CiAgICAgIG5leHQgPSBkZWx0YSAqIHhbaiArIDFdOwogICAgICB4W2pdID0gSyAqIHhbal0gLSBjdXJyZW50IC0gbmV4dDsKICAgICAgaWYgKG4tLSkgewogICAgICAgIGogKz0gMjsKICAgICAgICBjdXJyZW50ID0gZGVsdGEgKiB4W2ogKyAxXTsKICAgICAgICB4W2pdID0gSyAqIHhbal0gLSBjdXJyZW50IC0gbmV4dDsKICAgICAgfSBlbHNlIHsKICAgICAgICBicmVhazsKICAgICAgfQogICAgfQogICAgaiA9IG9mZnNldCAtIDE7CiAgICBjdXJyZW50ID0gZ2FtbWEgKiB4W2ogLSAxXTsKICAgIGZvciAobiA9IGxlbiArIDI7IG4tLTsgaiArPSAyKSB7CiAgICAgIG5leHQgPSBnYW1tYSAqIHhbaiArIDFdOwogICAgICB4W2pdIC09IGN1cnJlbnQgKyBuZXh0OwogICAgICBpZiAobi0tKSB7CiAgICAgICAgaiArPSAyOwogICAgICAgIGN1cnJlbnQgPSBnYW1tYSAqIHhbaiArIDFdOwogICAgICAgIHhbal0gLT0gY3VycmVudCArIG5leHQ7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgYnJlYWs7CiAgICAgIH0KICAgIH0KICAgIGogPSBvZmZzZXQ7CiAgICBjdXJyZW50ID0gYmV0YSAqIHhbaiAtIDFdOwogICAgZm9yIChuID0gbGVuICsgMTsgbi0tOyBqICs9IDIpIHsKICAgICAgbmV4dCA9IGJldGEgKiB4W2ogKyAxXTsKICAgICAgeFtqXSAtPSBjdXJyZW50ICsgbmV4dDsKICAgICAgaWYgKG4tLSkgewogICAgICAgIGogKz0gMjsKICAgICAgICBjdXJyZW50ID0gYmV0YSAqIHhbaiArIDFdOwogICAgICAgIHhbal0gLT0gY3VycmVudCArIG5leHQ7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgYnJlYWs7CiAgICAgIH0KICAgIH0KICAgIGlmIChsZW4gIT09IDApIHsKICAgICAgaiA9IG9mZnNldCArIDE7CiAgICAgIGN1cnJlbnQgPSBhbHBoYSAqIHhbaiAtIDFdOwogICAgICBmb3IgKG4gPSBsZW47IG4tLTsgaiArPSAyKSB7CiAgICAgICAgbmV4dCA9IGFscGhhICogeFtqICsgMV07CiAgICAgICAgeFtqXSAtPSBjdXJyZW50ICsgbmV4dDsKICAgICAgICBpZiAobi0tKSB7CiAgICAgICAgICBqICs9IDI7CiAgICAgICAgICBjdXJyZW50ID0gYWxwaGEgKiB4W2ogKyAxXTsKICAgICAgICAgIHhbal0gLT0gY3VycmVudCArIG5leHQ7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIGJyZWFrOwogICAgICAgIH0KICAgICAgfQogICAgfQogIH0KfQpjbGFzcyBSZXZlcnNpYmxlVHJhbnNmb3JtIGV4dGVuZHMgVHJhbnNmb3JtIHsKICBmaWx0ZXIoeCwgb2Zmc2V0LCBsZW5ndGgpIHsKICAgIGNvbnN0IGxlbiA9IGxlbmd0aCA+PiAxOwogICAgb2Zmc2V0IHw9IDA7CiAgICBsZXQgaiwgbjsKICAgIGZvciAoaiA9IG9mZnNldCwgbiA9IGxlbiArIDE7IG4tLTsgaiArPSAyKSB7CiAgICAgIHhbal0gLT0geFtqIC0gMV0gKyB4W2ogKyAxXSArIDIgPj4gMjsKICAgIH0KICAgIGZvciAoaiA9IG9mZnNldCArIDEsIG4gPSBsZW47IG4tLTsgaiArPSAyKSB7CiAgICAgIHhbal0gKz0geFtqIC0gMV0gKyB4W2ogKyAxXSA+PiAxOwogICAgfQogIH0KfQoKLyoqKi8gfSksCi8qIDMxICovCi8qKiovICgoX191bnVzZWRfd2VicGFja19tb2R1bGUsIGV4cG9ydHMsIF9fd19wZGZqc19yZXF1aXJlX18pID0+IHsKCgoKT2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsICJfX2VzTW9kdWxlIiwgKHsKICB2YWx1ZTogdHJ1ZQp9KSk7CmV4cG9ydHMuTFpXU3RyZWFtID0gdm9pZCAwOwp2YXIgX2RlY29kZV9zdHJlYW0gPSBfX3dfcGRmanNfcmVxdWlyZV9fKDE4KTsKY2xhc3MgTFpXU3RyZWFtIGV4dGVuZHMgX2RlY29kZV9zdHJlYW0uRGVjb2RlU3RyZWFtIHsKICBjb25zdHJ1Y3RvcihzdHIsIG1heWJlTGVuZ3RoLCBlYXJseUNoYW5nZSkgewogICAgc3VwZXIobWF5YmVMZW5ndGgpOwogICAgdGhpcy5zdHIgPSBzdHI7CiAgICB0aGlzLmRpY3QgPSBzdHIuZGljdDsKICAgIHRoaXMuY2FjaGVkRGF0YSA9IDA7CiAgICB0aGlzLmJpdHNDYWNoZWQgPSAwOwogICAgY29uc3QgbWF4THp3RGljdGlvbmFyeVNpemUgPSA0MDk2OwogICAgY29uc3QgbHp3U3RhdGUgPSB7CiAgICAgIGVhcmx5Q2hhbmdlLAogICAgICBjb2RlTGVuZ3RoOiA5LAogICAgICBuZXh0Q29kZTogMjU4LAogICAgICBkaWN0aW9uYXJ5VmFsdWVzOiBuZXcgVWludDhBcnJheShtYXhMendEaWN0aW9uYXJ5U2l6ZSksCiAgICAgIGRpY3Rpb25hcnlMZW5ndGhzOiBuZXcgVWludDE2QXJyYXkobWF4THp3RGljdGlvbmFyeVNpemUpLAogICAgICBkaWN0aW9uYXJ5UHJldkNvZGVzOiBuZXcgVWludDE2QXJyYXkobWF4THp3RGljdGlvbmFyeVNpemUpLAogICAgICBjdXJyZW50U2VxdWVuY2U6IG5ldyBVaW50OEFycmF5KG1heEx6d0RpY3Rpb25hcnlTaXplKSwKICAgICAgY3VycmVudFNlcXVlbmNlTGVuZ3RoOiAwCiAgICB9OwogICAgZm9yIChsZXQgaSA9IDA7IGkgPCAyNTY7ICsraSkgewogICAgICBsendTdGF0ZS5kaWN0aW9uYXJ5VmFsdWVzW2ldID0gaTsKICAgICAgbHp3U3RhdGUuZGljdGlvbmFyeUxlbmd0aHNbaV0gPSAxOwogICAgfQogICAgdGhpcy5sendTdGF0ZSA9IGx6d1N0YXRlOwogIH0KICByZWFkQml0cyhuKSB7CiAgICBsZXQgYml0c0NhY2hlZCA9IHRoaXMuYml0c0NhY2hlZDsKICAgIGxldCBjYWNoZWREYXRhID0gdGhpcy5jYWNoZWREYXRhOwogICAgd2hpbGUgKGJpdHNDYWNoZWQgPCBuKSB7CiAgICAgIGNvbnN0IGMgPSB0aGlzLnN0ci5nZXRCeXRlKCk7CiAgICAgIGlmIChjID09PSAtMSkgewogICAgICAgIHRoaXMuZW9mID0gdHJ1ZTsKICAgICAgICByZXR1cm4gbnVsbDsKICAgICAgfQogICAgICBjYWNoZWREYXRhID0gY2FjaGVkRGF0YSA8PCA4IHwgYzsKICAgICAgYml0c0NhY2hlZCArPSA4OwogICAgfQogICAgdGhpcy5iaXRzQ2FjaGVkID0gYml0c0NhY2hlZCAtPSBuOwogICAgdGhpcy5jYWNoZWREYXRhID0gY2FjaGVkRGF0YTsKICAgIHRoaXMubGFzdENvZGUgPSBudWxsOwogICAgcmV0dXJuIGNhY2hlZERhdGEgPj4+IGJpdHNDYWNoZWQgJiAoMSA8PCBuKSAtIDE7CiAgfQogIHJlYWRCbG9jaygpIHsKICAgIGNvbnN0IGJsb2NrU2l6ZSA9IDUxMiwKICAgICAgZGVjb2RlZFNpemVEZWx0YSA9IGJsb2NrU2l6ZTsKICAgIGxldCBlc3RpbWF0ZWREZWNvZGVkU2l6ZSA9IGJsb2NrU2l6ZSAqIDI7CiAgICBsZXQgaSwgaiwgcTsKICAgIGNvbnN0IGx6d1N0YXRlID0gdGhpcy5sendTdGF0ZTsKICAgIGlmICghbHp3U3RhdGUpIHsKICAgICAgcmV0dXJuOwogICAgfQogICAgY29uc3QgZWFybHlDaGFuZ2UgPSBsendTdGF0ZS5lYXJseUNoYW5nZTsKICAgIGxldCBuZXh0Q29kZSA9IGx6d1N0YXRlLm5leHRDb2RlOwogICAgY29uc3QgZGljdGlvbmFyeVZhbHVlcyA9IGx6d1N0YXRlLmRpY3Rpb25hcnlWYWx1ZXM7CiAgICBjb25zdCBkaWN0aW9uYXJ5TGVuZ3RocyA9IGx6d1N0YXRlLmRpY3Rpb25hcnlMZW5ndGhzOwogICAgY29uc3QgZGljdGlvbmFyeVByZXZDb2RlcyA9IGx6d1N0YXRlLmRpY3Rpb25hcnlQcmV2Q29kZXM7CiAgICBsZXQgY29kZUxlbmd0aCA9IGx6d1N0YXRlLmNvZGVMZW5ndGg7CiAgICBsZXQgcHJldkNvZGUgPSBsendTdGF0ZS5wcmV2Q29kZTsKICAgIGNvbnN0IGN1cnJlbnRTZXF1ZW5jZSA9IGx6d1N0YXRlLmN1cnJlbnRTZXF1ZW5jZTsKICAgIGxldCBjdXJyZW50U2VxdWVuY2VMZW5ndGggPSBsendTdGF0ZS5jdXJyZW50U2VxdWVuY2VMZW5ndGg7CiAgICBsZXQgZGVjb2RlZExlbmd0aCA9IDA7CiAgICBsZXQgY3VycmVudEJ1ZmZlckxlbmd0aCA9IHRoaXMuYnVmZmVyTGVuZ3RoOwogICAgbGV0IGJ1ZmZlciA9IHRoaXMuZW5zdXJlQnVmZmVyKHRoaXMuYnVmZmVyTGVuZ3RoICsgZXN0aW1hdGVkRGVjb2RlZFNpemUpOwogICAgZm9yIChpID0gMDsgaSA8IGJsb2NrU2l6ZTsgaSsrKSB7CiAgICAgIGNvbnN0IGNvZGUgPSB0aGlzLnJlYWRCaXRzKGNvZGVMZW5ndGgpOwogICAgICBjb25zdCBoYXNQcmV2ID0gY3VycmVudFNlcXVlbmNlTGVuZ3RoID4gMDsKICAgICAgaWYgKGNvZGUgPCAyNTYpIHsKICAgICAgICBjdXJyZW50U2VxdWVuY2VbMF0gPSBjb2RlOwogICAgICAgIGN1cnJlbnRTZXF1ZW5jZUxlbmd0aCA9IDE7CiAgICAgIH0gZWxzZSBpZiAoY29kZSA+PSAyNTgpIHsKICAgICAgICBpZiAoY29kZSA8IG5leHRDb2RlKSB7CiAgICAgICAgICBjdXJyZW50U2VxdWVuY2VMZW5ndGggPSBkaWN0aW9uYXJ5TGVuZ3Roc1tjb2RlXTsKICAgICAgICAgIGZvciAoaiA9IGN1cnJlbnRTZXF1ZW5jZUxlbmd0aCAtIDEsIHEgPSBjb2RlOyBqID49IDA7IGotLSkgewogICAgICAgICAgICBjdXJyZW50U2VxdWVuY2Vbal0gPSBkaWN0aW9uYXJ5VmFsdWVzW3FdOwogICAgICAgICAgICBxID0gZGljdGlvbmFyeVByZXZDb2Rlc1txXTsKICAgICAgICAgIH0KICAgICAgICB9IGVsc2UgewogICAgICAgICAgY3VycmVudFNlcXVlbmNlW2N1cnJlbnRTZXF1ZW5jZUxlbmd0aCsrXSA9IGN1cnJlbnRTZXF1ZW5jZVswXTsKICAgICAgICB9CiAgICAgIH0gZWxzZSBpZiAoY29kZSA9PT0gMjU2KSB7CiAgICAgICAgY29kZUxlbmd0aCA9IDk7CiAgICAgICAgbmV4dENvZGUgPSAyNTg7CiAgICAgICAgY3VycmVudFNlcXVlbmNlTGVuZ3RoID0gMDsKICAgICAgICBjb250aW51ZTsKICAgICAgfSBlbHNlIHsKICAgICAgICB0aGlzLmVvZiA9IHRydWU7CiAgICAgICAgZGVsZXRlIHRoaXMubHp3U3RhdGU7CiAgICAgICAgYnJlYWs7CiAgICAgIH0KICAgICAgaWYgKGhhc1ByZXYpIHsKICAgICAgICBkaWN0aW9uYXJ5UHJldkNvZGVzW25leHRDb2RlXSA9IHByZXZDb2RlOwogICAgICAgIGRpY3Rpb25hcnlMZW5ndGhzW25leHRDb2RlXSA9IGRpY3Rpb25hcnlMZW5ndGhzW3ByZXZDb2RlXSArIDE7CiAgICAgICAgZGljdGlvbmFyeVZhbHVlc1tuZXh0Q29kZV0gPSBjdXJyZW50U2VxdWVuY2VbMF07CiAgICAgICAgbmV4dENvZGUrKzsKICAgICAgICBjb2RlTGVuZ3RoID0gbmV4dENvZGUgKyBlYXJseUNoYW5nZSAmIG5leHRDb2RlICsgZWFybHlDaGFuZ2UgLSAxID8gY29kZUxlbmd0aCA6IE1hdGgubWluKE1hdGgubG9nKG5leHRDb2RlICsgZWFybHlDaGFuZ2UpIC8gMC42OTMxNDcxODA1NTk5NDUzICsgMSwgMTIpIHwgMDsKICAgICAgfQogICAgICBwcmV2Q29kZSA9IGNvZGU7CiAgICAgIGRlY29kZWRMZW5ndGggKz0gY3VycmVudFNlcXVlbmNlTGVuZ3RoOwogICAgICBpZiAoZXN0aW1hdGVkRGVjb2RlZFNpemUgPCBkZWNvZGVkTGVuZ3RoKSB7CiAgICAgICAgZG8gewogICAgICAgICAgZXN0aW1hdGVkRGVjb2RlZFNpemUgKz0gZGVjb2RlZFNpemVEZWx0YTsKICAgICAgICB9IHdoaWxlIChlc3RpbWF0ZWREZWNvZGVkU2l6ZSA8IGRlY29kZWRMZW5ndGgpOwogICAgICAgIGJ1ZmZlciA9IHRoaXMuZW5zdXJlQnVmZmVyKHRoaXMuYnVmZmVyTGVuZ3RoICsgZXN0aW1hdGVkRGVjb2RlZFNpemUpOwogICAgICB9CiAgICAgIGZvciAoaiA9IDA7IGogPCBjdXJyZW50U2VxdWVuY2VMZW5ndGg7IGorKykgewogICAgICAgIGJ1ZmZlcltjdXJyZW50QnVmZmVyTGVuZ3RoKytdID0gY3VycmVudFNlcXVlbmNlW2pdOwogICAgICB9CiAgICB9CiAgICBsendTdGF0ZS5uZXh0Q29kZSA9IG5leHRDb2RlOwogICAgbHp3U3RhdGUuY29kZUxlbmd0aCA9IGNvZGVMZW5ndGg7CiAgICBsendTdGF0ZS5wcmV2Q29kZSA9IHByZXZDb2RlOwogICAgbHp3U3RhdGUuY3VycmVudFNlcXVlbmNlTGVuZ3RoID0gY3VycmVudFNlcXVlbmNlTGVuZ3RoOwogICAgdGhpcy5idWZmZXJMZW5ndGggPSBjdXJyZW50QnVmZmVyTGVuZ3RoOwogIH0KfQpleHBvcnRzLkxaV1N0cmVhbSA9IExaV1N0cmVhbTsKCi8qKiovIH0pLAovKiAzMiAqLwovKioqLyAoKF9fdW51c2VkX3dlYnBhY2tfbW9kdWxlLCBleHBvcnRzLCBfX3dfcGRmanNfcmVxdWlyZV9fKSA9PiB7CgoKCk9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCAiX19lc01vZHVsZSIsICh7CiAgdmFsdWU6IHRydWUKfSkpOwpleHBvcnRzLlByZWRpY3RvclN0cmVhbSA9IHZvaWQgMDsKdmFyIF9kZWNvZGVfc3RyZWFtID0gX193X3BkZmpzX3JlcXVpcmVfXygxOCk7CnZhciBfcHJpbWl0aXZlcyA9IF9fd19wZGZqc19yZXF1aXJlX18oNCk7CnZhciBfdXRpbCA9IF9fd19wZGZqc19yZXF1aXJlX18oMik7CmNsYXNzIFByZWRpY3RvclN0cmVhbSBleHRlbmRzIF9kZWNvZGVfc3RyZWFtLkRlY29kZVN0cmVhbSB7CiAgY29uc3RydWN0b3Ioc3RyLCBtYXliZUxlbmd0aCwgcGFyYW1zKSB7CiAgICBzdXBlcihtYXliZUxlbmd0aCk7CiAgICBpZiAoIShwYXJhbXMgaW5zdGFuY2VvZiBfcHJpbWl0aXZlcy5EaWN0KSkgewogICAgICByZXR1cm4gc3RyOwogICAgfQogICAgY29uc3QgcHJlZGljdG9yID0gdGhpcy5wcmVkaWN0b3IgPSBwYXJhbXMuZ2V0KCJQcmVkaWN0b3IiKSB8fCAxOwogICAgaWYgKHByZWRpY3RvciA8PSAxKSB7CiAgICAgIHJldHVybiBzdHI7CiAgICB9CiAgICBpZiAocHJlZGljdG9yICE9PSAyICYmIChwcmVkaWN0b3IgPCAxMCB8fCBwcmVkaWN0b3IgPiAxNSkpIHsKICAgICAgdGhyb3cgbmV3IF91dGlsLkZvcm1hdEVycm9yKGBVbnN1cHBvcnRlZCBwcmVkaWN0b3I6ICR7cHJlZGljdG9yfWApOwogICAgfQogICAgdGhpcy5yZWFkQmxvY2sgPSBwcmVkaWN0b3IgPT09IDIgPyB0aGlzLnJlYWRCbG9ja1RpZmYgOiB0aGlzLnJlYWRCbG9ja1BuZzsKICAgIHRoaXMuc3RyID0gc3RyOwogICAgdGhpcy5kaWN0ID0gc3RyLmRpY3Q7CiAgICBjb25zdCBjb2xvcnMgPSB0aGlzLmNvbG9ycyA9IHBhcmFtcy5nZXQoIkNvbG9ycyIpIHx8IDE7CiAgICBjb25zdCBiaXRzID0gdGhpcy5iaXRzID0gcGFyYW1zLmdldCgiQlBDIiwgIkJpdHNQZXJDb21wb25lbnQiKSB8fCA4OwogICAgY29uc3QgY29sdW1ucyA9IHRoaXMuY29sdW1ucyA9IHBhcmFtcy5nZXQoIkNvbHVtbnMiKSB8fCAxOwogICAgdGhpcy5waXhCeXRlcyA9IGNvbG9ycyAqIGJpdHMgKyA3ID4+IDM7CiAgICB0aGlzLnJvd0J5dGVzID0gY29sdW1ucyAqIGNvbG9ycyAqIGJpdHMgKyA3ID4+IDM7CiAgICByZXR1cm4gdGhpczsKICB9CiAgcmVhZEJsb2NrVGlmZigpIHsKICAgIGNvbnN0IHJvd0J5dGVzID0gdGhpcy5yb3dCeXRlczsKICAgIGNvbnN0IGJ1ZmZlckxlbmd0aCA9IHRoaXMuYnVmZmVyTGVuZ3RoOwogICAgY29uc3QgYnVmZmVyID0gdGhpcy5lbnN1cmVCdWZmZXIoYnVmZmVyTGVuZ3RoICsgcm93Qnl0ZXMpOwogICAgY29uc3QgYml0cyA9IHRoaXMuYml0czsKICAgIGNvbnN0IGNvbG9ycyA9IHRoaXMuY29sb3JzOwogICAgY29uc3QgcmF3Qnl0ZXMgPSB0aGlzLnN0ci5nZXRCeXRlcyhyb3dCeXRlcyk7CiAgICB0aGlzLmVvZiA9ICFyYXdCeXRlcy5sZW5ndGg7CiAgICBpZiAodGhpcy5lb2YpIHsKICAgICAgcmV0dXJuOwogICAgfQogICAgbGV0IGluYnVmID0gMCwKICAgICAgb3V0YnVmID0gMDsKICAgIGxldCBpbmJpdHMgPSAwLAogICAgICBvdXRiaXRzID0gMDsKICAgIGxldCBwb3MgPSBidWZmZXJMZW5ndGg7CiAgICBsZXQgaTsKICAgIGlmIChiaXRzID09PSAxICYmIGNvbG9ycyA9PT0gMSkgewogICAgICBmb3IgKGkgPSAwOyBpIDwgcm93Qnl0ZXM7ICsraSkgewogICAgICAgIGxldCBjID0gcmF3Qnl0ZXNbaV0gXiBpbmJ1ZjsKICAgICAgICBjIF49IGMgPj4gMTsKICAgICAgICBjIF49IGMgPj4gMjsKICAgICAgICBjIF49IGMgPj4gNDsKICAgICAgICBpbmJ1ZiA9IChjICYgMSkgPDwgNzsKICAgICAgICBidWZmZXJbcG9zKytdID0gYzsKICAgICAgfQogICAgfSBlbHNlIGlmIChiaXRzID09PSA4KSB7CiAgICAgIGZvciAoaSA9IDA7IGkgPCBjb2xvcnM7ICsraSkgewogICAgICAgIGJ1ZmZlcltwb3MrK10gPSByYXdCeXRlc1tpXTsKICAgICAgfQogICAgICBmb3IgKDsgaSA8IHJvd0J5dGVzOyArK2kpIHsKICAgICAgICBidWZmZXJbcG9zXSA9IGJ1ZmZlcltwb3MgLSBjb2xvcnNdICsgcmF3Qnl0ZXNbaV07CiAgICAgICAgcG9zKys7CiAgICAgIH0KICAgIH0gZWxzZSBpZiAoYml0cyA9PT0gMTYpIHsKICAgICAgY29uc3QgYnl0ZXNQZXJQaXhlbCA9IGNvbG9ycyAqIDI7CiAgICAgIGZvciAoaSA9IDA7IGkgPCBieXRlc1BlclBpeGVsOyArK2kpIHsKICAgICAgICBidWZmZXJbcG9zKytdID0gcmF3Qnl0ZXNbaV07CiAgICAgIH0KICAgICAgZm9yICg7IGkgPCByb3dCeXRlczsgaSArPSAyKSB7CiAgICAgICAgY29uc3Qgc3VtID0gKChyYXdCeXRlc1tpXSAmIDB4ZmYpIDw8IDgpICsgKHJhd0J5dGVzW2kgKyAxXSAmIDB4ZmYpICsgKChidWZmZXJbcG9zIC0gYnl0ZXNQZXJQaXhlbF0gJiAweGZmKSA8PCA4KSArIChidWZmZXJbcG9zIC0gYnl0ZXNQZXJQaXhlbCArIDFdICYgMHhmZik7CiAgICAgICAgYnVmZmVyW3BvcysrXSA9IHN1bSA+PiA4ICYgMHhmZjsKICAgICAgICBidWZmZXJbcG9zKytdID0gc3VtICYgMHhmZjsKICAgICAgfQogICAgfSBlbHNlIHsKICAgICAgY29uc3QgY29tcEFycmF5ID0gbmV3IFVpbnQ4QXJyYXkoY29sb3JzICsgMSk7CiAgICAgIGNvbnN0IGJpdE1hc2sgPSAoMSA8PCBiaXRzKSAtIDE7CiAgICAgIGxldCBqID0gMCwKICAgICAgICBrID0gYnVmZmVyTGVuZ3RoOwogICAgICBjb25zdCBjb2x1bW5zID0gdGhpcy5jb2x1bW5zOwogICAgICBmb3IgKGkgPSAwOyBpIDwgY29sdW1uczsgKytpKSB7CiAgICAgICAgZm9yIChsZXQga2sgPSAwOyBrayA8IGNvbG9yczsgKytraykgewogICAgICAgICAgaWYgKGluYml0cyA8IGJpdHMpIHsKICAgICAgICAgICAgaW5idWYgPSBpbmJ1ZiA8PCA4IHwgcmF3Qnl0ZXNbaisrXSAmIDB4ZmY7CiAgICAgICAgICAgIGluYml0cyArPSA4OwogICAgICAgICAgfQogICAgICAgICAgY29tcEFycmF5W2trXSA9IGNvbXBBcnJheVtra10gKyAoaW5idWYgPj4gaW5iaXRzIC0gYml0cykgJiBiaXRNYXNrOwogICAgICAgICAgaW5iaXRzIC09IGJpdHM7CiAgICAgICAgICBvdXRidWYgPSBvdXRidWYgPDwgYml0cyB8IGNvbXBBcnJheVtra107CiAgICAgICAgICBvdXRiaXRzICs9IGJpdHM7CiAgICAgICAgICBpZiAob3V0Yml0cyA+PSA4KSB7CiAgICAgICAgICAgIGJ1ZmZlcltrKytdID0gb3V0YnVmID4+IG91dGJpdHMgLSA4ICYgMHhmZjsKICAgICAgICAgICAgb3V0Yml0cyAtPSA4OwogICAgICAgICAgfQogICAgICAgIH0KICAgICAgfQogICAgICBpZiAob3V0Yml0cyA+IDApIHsKICAgICAgICBidWZmZXJbaysrXSA9IChvdXRidWYgPDwgOCAtIG91dGJpdHMpICsgKGluYnVmICYgKDEgPDwgOCAtIG91dGJpdHMpIC0gMSk7CiAgICAgIH0KICAgIH0KICAgIHRoaXMuYnVmZmVyTGVuZ3RoICs9IHJvd0J5dGVzOwogIH0KICByZWFkQmxvY2tQbmcoKSB7CiAgICBjb25zdCByb3dCeXRlcyA9IHRoaXMucm93Qnl0ZXM7CiAgICBjb25zdCBwaXhCeXRlcyA9IHRoaXMucGl4Qnl0ZXM7CiAgICBjb25zdCBwcmVkaWN0b3IgPSB0aGlzLnN0ci5nZXRCeXRlKCk7CiAgICBjb25zdCByYXdCeXRlcyA9IHRoaXMuc3RyLmdldEJ5dGVzKHJvd0J5dGVzKTsKICAgIHRoaXMuZW9mID0gIXJhd0J5dGVzLmxlbmd0aDsKICAgIGlmICh0aGlzLmVvZikgewogICAgICByZXR1cm47CiAgICB9CiAgICBjb25zdCBidWZmZXJMZW5ndGggPSB0aGlzLmJ1ZmZlckxlbmd0aDsKICAgIGNvbnN0IGJ1ZmZlciA9IHRoaXMuZW5zdXJlQnVmZmVyKGJ1ZmZlckxlbmd0aCArIHJvd0J5dGVzKTsKICAgIGxldCBwcmV2Um93ID0gYnVmZmVyLnN1YmFycmF5KGJ1ZmZlckxlbmd0aCAtIHJvd0J5dGVzLCBidWZmZXJMZW5ndGgpOwogICAgaWYgKHByZXZSb3cubGVuZ3RoID09PSAwKSB7CiAgICAgIHByZXZSb3cgPSBuZXcgVWludDhBcnJheShyb3dCeXRlcyk7CiAgICB9CiAgICBsZXQgaSwKICAgICAgaiA9IGJ1ZmZlckxlbmd0aCwKICAgICAgdXAsCiAgICAgIGM7CiAgICBzd2l0Y2ggKHByZWRpY3RvcikgewogICAgICBjYXNlIDA6CiAgICAgICAgZm9yIChpID0gMDsgaSA8IHJvd0J5dGVzOyArK2kpIHsKICAgICAgICAgIGJ1ZmZlcltqKytdID0gcmF3Qnl0ZXNbaV07CiAgICAgICAgfQogICAgICAgIGJyZWFrOwogICAgICBjYXNlIDE6CiAgICAgICAgZm9yIChpID0gMDsgaSA8IHBpeEJ5dGVzOyArK2kpIHsKICAgICAgICAgIGJ1ZmZlcltqKytdID0gcmF3Qnl0ZXNbaV07CiAgICAgICAgfQogICAgICAgIGZvciAoOyBpIDwgcm93Qnl0ZXM7ICsraSkgewogICAgICAgICAgYnVmZmVyW2pdID0gYnVmZmVyW2ogLSBwaXhCeXRlc10gKyByYXdCeXRlc1tpXSAmIDB4ZmY7CiAgICAgICAgICBqKys7CiAgICAgICAgfQogICAgICAgIGJyZWFrOwogICAgICBjYXNlIDI6CiAgICAgICAgZm9yIChpID0gMDsgaSA8IHJvd0J5dGVzOyArK2kpIHsKICAgICAgICAgIGJ1ZmZlcltqKytdID0gcHJldlJvd1tpXSArIHJhd0J5dGVzW2ldICYgMHhmZjsKICAgICAgICB9CiAgICAgICAgYnJlYWs7CiAgICAgIGNhc2UgMzoKICAgICAgICBmb3IgKGkgPSAwOyBpIDwgcGl4Qnl0ZXM7ICsraSkgewogICAgICAgICAgYnVmZmVyW2orK10gPSAocHJldlJvd1tpXSA+PiAxKSArIHJhd0J5dGVzW2ldOwogICAgICAgIH0KICAgICAgICBmb3IgKDsgaSA8IHJvd0J5dGVzOyArK2kpIHsKICAgICAgICAgIGJ1ZmZlcltqXSA9IChwcmV2Um93W2ldICsgYnVmZmVyW2ogLSBwaXhCeXRlc10gPj4gMSkgKyByYXdCeXRlc1tpXSAmIDB4ZmY7CiAgICAgICAgICBqKys7CiAgICAgICAgfQogICAgICAgIGJyZWFrOwogICAgICBjYXNlIDQ6CiAgICAgICAgZm9yIChpID0gMDsgaSA8IHBpeEJ5dGVzOyArK2kpIHsKICAgICAgICAgIHVwID0gcHJldlJvd1tpXTsKICAgICAgICAgIGMgPSByYXdCeXRlc1tpXTsKICAgICAgICAgIGJ1ZmZlcltqKytdID0gdXAgKyBjOwogICAgICAgIH0KICAgICAgICBmb3IgKDsgaSA8IHJvd0J5dGVzOyArK2kpIHsKICAgICAgICAgIHVwID0gcHJldlJvd1tpXTsKICAgICAgICAgIGNvbnN0IHVwTGVmdCA9IHByZXZSb3dbaSAtIHBpeEJ5dGVzXTsKICAgICAgICAgIGNvbnN0IGxlZnQgPSBidWZmZXJbaiAtIHBpeEJ5dGVzXTsKICAgICAgICAgIGNvbnN0IHAgPSBsZWZ0ICsgdXAgLSB1cExlZnQ7CiAgICAgICAgICBsZXQgcGEgPSBwIC0gbGVmdDsKICAgICAgICAgIGlmIChwYSA8IDApIHsKICAgICAgICAgICAgcGEgPSAtcGE7CiAgICAgICAgICB9CiAgICAgICAgICBsZXQgcGIgPSBwIC0gdXA7CiAgICAgICAgICBpZiAocGIgPCAwKSB7CiAgICAgICAgICAgIHBiID0gLXBiOwogICAgICAgICAgfQogICAgICAgICAgbGV0IHBjID0gcCAtIHVwTGVmdDsKICAgICAgICAgIGlmIChwYyA8IDApIHsKICAgICAgICAgICAgcGMgPSAtcGM7CiAgICAgICAgICB9CiAgICAgICAgICBjID0gcmF3Qnl0ZXNbaV07CiAgICAgICAgICBpZiAocGEgPD0gcGIgJiYgcGEgPD0gcGMpIHsKICAgICAgICAgICAgYnVmZmVyW2orK10gPSBsZWZ0ICsgYzsKICAgICAgICAgIH0gZWxzZSBpZiAocGIgPD0gcGMpIHsKICAgICAgICAgICAgYnVmZmVyW2orK10gPSB1cCArIGM7CiAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICBidWZmZXJbaisrXSA9IHVwTGVmdCArIGM7CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIGJyZWFrOwogICAgICBkZWZhdWx0OgogICAgICAgIHRocm93IG5ldyBfdXRpbC5Gb3JtYXRFcnJvcihgVW5zdXBwb3J0ZWQgcHJlZGljdG9yOiAke3ByZWRpY3Rvcn1gKTsKICAgIH0KICAgIHRoaXMuYnVmZmVyTGVuZ3RoICs9IHJvd0J5dGVzOwogIH0KfQpleHBvcnRzLlByZWRpY3RvclN0cmVhbSA9IFByZWRpY3RvclN0cmVhbTsKCi8qKiovIH0pLAovKiAzMyAqLwovKioqLyAoKF9fdW51c2VkX3dlYnBhY2tfbW9kdWxlLCBleHBvcnRzLCBfX3dfcGRmanNfcmVxdWlyZV9fKSA9PiB7CgoKCk9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCAiX19lc01vZHVsZSIsICh7CiAgdmFsdWU6IHRydWUKfSkpOwpleHBvcnRzLlJ1bkxlbmd0aFN0cmVhbSA9IHZvaWQgMDsKdmFyIF9kZWNvZGVfc3RyZWFtID0gX193X3BkZmpzX3JlcXVpcmVfXygxOCk7CmNsYXNzIFJ1bkxlbmd0aFN0cmVhbSBleHRlbmRzIF9kZWNvZGVfc3RyZWFtLkRlY29kZVN0cmVhbSB7CiAgY29uc3RydWN0b3Ioc3RyLCBtYXliZUxlbmd0aCkgewogICAgc3VwZXIobWF5YmVMZW5ndGgpOwogICAgdGhpcy5zdHIgPSBzdHI7CiAgICB0aGlzLmRpY3QgPSBzdHIuZGljdDsKICB9CiAgcmVhZEJsb2NrKCkgewogICAgY29uc3QgcmVwZWF0SGVhZGVyID0gdGhpcy5zdHIuZ2V0Qnl0ZXMoMik7CiAgICBpZiAoIXJlcGVhdEhlYWRlciB8fCByZXBlYXRIZWFkZXIubGVuZ3RoIDwgMiB8fCByZXBlYXRIZWFkZXJbMF0gPT09IDEyOCkgewogICAgICB0aGlzLmVvZiA9IHRydWU7CiAgICAgIHJldHVybjsKICAgIH0KICAgIGxldCBidWZmZXI7CiAgICBsZXQgYnVmZmVyTGVuZ3RoID0gdGhpcy5idWZmZXJMZW5ndGg7CiAgICBsZXQgbiA9IHJlcGVhdEhlYWRlclswXTsKICAgIGlmIChuIDwgMTI4KSB7CiAgICAgIGJ1ZmZlciA9IHRoaXMuZW5zdXJlQnVmZmVyKGJ1ZmZlckxlbmd0aCArIG4gKyAxKTsKICAgICAgYnVmZmVyW2J1ZmZlckxlbmd0aCsrXSA9IHJlcGVhdEhlYWRlclsxXTsKICAgICAgaWYgKG4gPiAwKSB7CiAgICAgICAgY29uc3Qgc291cmNlID0gdGhpcy5zdHIuZ2V0Qnl0ZXMobik7CiAgICAgICAgYnVmZmVyLnNldChzb3VyY2UsIGJ1ZmZlckxlbmd0aCk7CiAgICAgICAgYnVmZmVyTGVuZ3RoICs9IG47CiAgICAgIH0KICAgIH0gZWxzZSB7CiAgICAgIG4gPSAyNTcgLSBuOwogICAgICBjb25zdCBiID0gcmVwZWF0SGVhZGVyWzFdOwogICAgICBidWZmZXIgPSB0aGlzLmVuc3VyZUJ1ZmZlcihidWZmZXJMZW5ndGggKyBuICsgMSk7CiAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgbjsgaSsrKSB7CiAgICAgICAgYnVmZmVyW2J1ZmZlckxlbmd0aCsrXSA9IGI7CiAgICAgIH0KICAgIH0KICAgIHRoaXMuYnVmZmVyTGVuZ3RoID0gYnVmZmVyTGVuZ3RoOwogIH0KfQpleHBvcnRzLlJ1bkxlbmd0aFN0cmVhbSA9IFJ1bkxlbmd0aFN0cmVhbTsKCi8qKiovIH0pLAovKiAzNCAqLwovKioqLyAoKF9fdW51c2VkX3dlYnBhY2tfbW9kdWxlLCBleHBvcnRzLCBfX3dfcGRmanNfcmVxdWlyZV9fKSA9PiB7CgoKCk9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCAiX19lc01vZHVsZSIsICh7CiAgdmFsdWU6IHRydWUKfSkpOwpleHBvcnRzLkZvbnQgPSBleHBvcnRzLkVycm9yRm9udCA9IHZvaWQgMDsKdmFyIF91dGlsID0gX193X3BkZmpzX3JlcXVpcmVfXygyKTsKdmFyIF9jZmZfcGFyc2VyID0gX193X3BkZmpzX3JlcXVpcmVfXygzNSk7CnZhciBfZm9udHNfdXRpbHMgPSBfX3dfcGRmanNfcmVxdWlyZV9fKDM4KTsKdmFyIF91bmljb2RlID0gX193X3BkZmpzX3JlcXVpcmVfXyg0MCk7CnZhciBfZ2x5cGhsaXN0ID0gX193X3BkZmpzX3JlcXVpcmVfXygzOSk7CnZhciBfZW5jb2RpbmdzID0gX193X3BkZmpzX3JlcXVpcmVfXygzNyk7CnZhciBfc3RhbmRhcmRfZm9udHMgPSBfX3dfcGRmanNfcmVxdWlyZV9fKDQxKTsKdmFyIF90b191bmljb2RlX21hcCA9IF9fd19wZGZqc19yZXF1aXJlX18oNDIpOwp2YXIgX2NmZl9mb250ID0gX193X3BkZmpzX3JlcXVpcmVfXyg0Myk7CnZhciBfZm9udF9yZW5kZXJlciA9IF9fd19wZGZqc19yZXF1aXJlX18oNDQpOwp2YXIgX21ldHJpY3MgPSBfX3dfcGRmanNfcmVxdWlyZV9fKDQ1KTsKdmFyIF9nbHlmID0gX193X3BkZmpzX3JlcXVpcmVfXyg0Nik7CnZhciBfY21hcCA9IF9fd19wZGZqc19yZXF1aXJlX18oMTQpOwp2YXIgX29wZW50eXBlX2ZpbGVfYnVpbGRlciA9IF9fd19wZGZqc19yZXF1aXJlX18oNDcpOwp2YXIgX2NvcmVfdXRpbHMgPSBfX3dfcGRmanNfcmVxdWlyZV9fKDMpOwp2YXIgX3N0cmVhbSA9IF9fd19wZGZqc19yZXF1aXJlX18oOCk7CnZhciBfdHlwZTFfZm9udCA9IF9fd19wZGZqc19yZXF1aXJlX18oNDgpOwpjb25zdCBQUklWQVRFX1VTRV9BUkVBUyA9IFtbMHhlMDAwLCAweGY4ZmZdLCBbMHgxMDAwMDAsIDB4MTBmZmZkXV07CmNvbnN0IFBERl9HTFlQSF9TUEFDRV9VTklUUyA9IDEwMDA7CmNvbnN0IEVYUE9SVF9EQVRBX1BST1BFUlRJRVMgPSBbImFzY2VudCIsICJiYm94IiwgImJsYWNrIiwgImJvbGQiLCAiY2hhclByb2NPcGVyYXRvckxpc3QiLCAiY29tcG9zaXRlIiwgImNzc0ZvbnRJbmZvIiwgImRhdGEiLCAiZGVmYXVsdFZNZXRyaWNzIiwgImRlZmF1bHRXaWR0aCIsICJkZXNjZW50IiwgImZhbGxiYWNrTmFtZSIsICJmb250TWF0cml4IiwgImlzSW52YWxpZFBERmpzRm9udCIsICJpc1R5cGUzRm9udCIsICJpdGFsaWMiLCAibG9hZGVkTmFtZSIsICJtaW1ldHlwZSIsICJtaXNzaW5nRmlsZSIsICJuYW1lIiwgInJlbWVhc3VyZSIsICJzdWJ0eXBlIiwgInN5c3RlbUZvbnRJbmZvIiwgInR5cGUiLCAidmVydGljYWwiXTsKY29uc3QgRVhQT1JUX0RBVEFfRVhUUkFfUFJPUEVSVElFUyA9IFsiY01hcCIsICJkZWZhdWx0RW5jb2RpbmciLCAiZGlmZmVyZW5jZXMiLCAiaXNNb25vc3BhY2UiLCAiaXNTZXJpZkZvbnQiLCAiaXNTeW1ib2xpY0ZvbnQiLCAic2VhY01hcCIsICJ0b0ZvbnRDaGFyIiwgInRvVW5pY29kZSIsICJ2bWV0cmljcyIsICJ3aWR0aHMiXTsKZnVuY3Rpb24gYWRqdXN0V2lkdGhzKHByb3BlcnRpZXMpIHsKICBpZiAoIXByb3BlcnRpZXMuZm9udE1hdHJpeCkgewogICAgcmV0dXJuOwogIH0KICBpZiAocHJvcGVydGllcy5mb250TWF0cml4WzBdID09PSBfdXRpbC5GT05UX0lERU5USVRZX01BVFJJWFswXSkgewogICAgcmV0dXJuOwogIH0KICBjb25zdCBzY2FsZSA9IDAuMDAxIC8gcHJvcGVydGllcy5mb250TWF0cml4WzBdOwogIGNvbnN0IGdseXBoc1dpZHRocyA9IHByb3BlcnRpZXMud2lkdGhzOwogIGZvciAoY29uc3QgZ2x5cGggaW4gZ2x5cGhzV2lkdGhzKSB7CiAgICBnbHlwaHNXaWR0aHNbZ2x5cGhdICo9IHNjYWxlOwogIH0KICBwcm9wZXJ0aWVzLmRlZmF1bHRXaWR0aCAqPSBzY2FsZTsKfQpmdW5jdGlvbiBhZGp1c3RUcnVlVHlwZVRvVW5pY29kZShwcm9wZXJ0aWVzLCBpc1N5bWJvbGljRm9udCwgbmFtZVJlY29yZHMpIHsKICBpZiAocHJvcGVydGllcy5pc0ludGVybmFsRm9udCkgewogICAgcmV0dXJuOwogIH0KICBpZiAocHJvcGVydGllcy5oYXNJbmNsdWRlZFRvVW5pY29kZU1hcCkgewogICAgcmV0dXJuOwogIH0KICBpZiAocHJvcGVydGllcy5oYXNFbmNvZGluZykgewogICAgcmV0dXJuOwogIH0KICBpZiAocHJvcGVydGllcy50b1VuaWNvZGUgaW5zdGFuY2VvZiBfdG9fdW5pY29kZV9tYXAuSWRlbnRpdHlUb1VuaWNvZGVNYXApIHsKICAgIHJldHVybjsKICB9CiAgaWYgKCFpc1N5bWJvbGljRm9udCkgewogICAgcmV0dXJuOwogIH0KICBpZiAobmFtZVJlY29yZHMubGVuZ3RoID09PSAwKSB7CiAgICByZXR1cm47CiAgfQogIGlmIChwcm9wZXJ0aWVzLmRlZmF1bHRFbmNvZGluZyA9PT0gX2VuY29kaW5ncy5XaW5BbnNpRW5jb2RpbmcpIHsKICAgIHJldHVybjsKICB9CiAgZm9yIChjb25zdCByIG9mIG5hbWVSZWNvcmRzKSB7CiAgICBpZiAoIWlzV2luTmFtZVJlY29yZChyKSkgewogICAgICByZXR1cm47CiAgICB9CiAgfQogIGNvbnN0IGVuY29kaW5nID0gX2VuY29kaW5ncy5XaW5BbnNpRW5jb2Rpbmc7CiAgY29uc3QgdG9Vbmljb2RlID0gW10sCiAgICBnbHlwaHNVbmljb2RlTWFwID0gKDAsIF9nbHlwaGxpc3QuZ2V0R2x5cGhzVW5pY29kZSkoKTsKICBmb3IgKGNvbnN0IGNoYXJDb2RlIGluIGVuY29kaW5nKSB7CiAgICBjb25zdCBnbHlwaE5hbWUgPSBlbmNvZGluZ1tjaGFyQ29kZV07CiAgICBpZiAoZ2x5cGhOYW1lID09PSAiIikgewogICAgICBjb250aW51ZTsKICAgIH0KICAgIGNvbnN0IHVuaWNvZGUgPSBnbHlwaHNVbmljb2RlTWFwW2dseXBoTmFtZV07CiAgICBpZiAodW5pY29kZSA9PT0gdW5kZWZpbmVkKSB7CiAgICAgIGNvbnRpbnVlOwogICAgfQogICAgdG9Vbmljb2RlW2NoYXJDb2RlXSA9IFN0cmluZy5mcm9tQ2hhckNvZGUodW5pY29kZSk7CiAgfQogIGlmICh0b1VuaWNvZGUubGVuZ3RoID4gMCkgewogICAgcHJvcGVydGllcy50b1VuaWNvZGUuYW1lbmQodG9Vbmljb2RlKTsKICB9Cn0KZnVuY3Rpb24gYWRqdXN0VHlwZTFUb1VuaWNvZGUocHJvcGVydGllcywgYnVpbHRJbkVuY29kaW5nKSB7CiAgaWYgKHByb3BlcnRpZXMuaXNJbnRlcm5hbEZvbnQpIHsKICAgIHJldHVybjsKICB9CiAgaWYgKHByb3BlcnRpZXMuaGFzSW5jbHVkZWRUb1VuaWNvZGVNYXApIHsKICAgIHJldHVybjsKICB9CiAgaWYgKGJ1aWx0SW5FbmNvZGluZyA9PT0gcHJvcGVydGllcy5kZWZhdWx0RW5jb2RpbmcpIHsKICAgIHJldHVybjsKICB9CiAgaWYgKHByb3BlcnRpZXMudG9Vbmljb2RlIGluc3RhbmNlb2YgX3RvX3VuaWNvZGVfbWFwLklkZW50aXR5VG9Vbmljb2RlTWFwKSB7CiAgICByZXR1cm47CiAgfQogIGNvbnN0IHRvVW5pY29kZSA9IFtdLAogICAgZ2x5cGhzVW5pY29kZU1hcCA9ICgwLCBfZ2x5cGhsaXN0LmdldEdseXBoc1VuaWNvZGUpKCk7CiAgZm9yIChjb25zdCBjaGFyQ29kZSBpbiBidWlsdEluRW5jb2RpbmcpIHsKICAgIGlmIChwcm9wZXJ0aWVzLmhhc0VuY29kaW5nKSB7CiAgICAgIGlmIChwcm9wZXJ0aWVzLmJhc2VFbmNvZGluZ05hbWUgfHwgcHJvcGVydGllcy5kaWZmZXJlbmNlc1tjaGFyQ29kZV0gIT09IHVuZGVmaW5lZCkgewogICAgICAgIGNvbnRpbnVlOwogICAgICB9CiAgICB9CiAgICBjb25zdCBnbHlwaE5hbWUgPSBidWlsdEluRW5jb2RpbmdbY2hhckNvZGVdOwogICAgY29uc3QgdW5pY29kZSA9ICgwLCBfdW5pY29kZS5nZXRVbmljb2RlRm9yR2x5cGgpKGdseXBoTmFtZSwgZ2x5cGhzVW5pY29kZU1hcCk7CiAgICBpZiAodW5pY29kZSAhPT0gLTEpIHsKICAgICAgdG9Vbmljb2RlW2NoYXJDb2RlXSA9IFN0cmluZy5mcm9tQ2hhckNvZGUodW5pY29kZSk7CiAgICB9CiAgfQogIGlmICh0b1VuaWNvZGUubGVuZ3RoID4gMCkgewogICAgcHJvcGVydGllcy50b1VuaWNvZGUuYW1lbmQodG9Vbmljb2RlKTsKICB9Cn0KZnVuY3Rpb24gYW1lbmRGYWxsYmFja1RvVW5pY29kZShwcm9wZXJ0aWVzKSB7CiAgaWYgKCFwcm9wZXJ0aWVzLmZhbGxiYWNrVG9Vbmljb2RlKSB7CiAgICByZXR1cm47CiAgfQogIGlmIChwcm9wZXJ0aWVzLnRvVW5pY29kZSBpbnN0YW5jZW9mIF90b191bmljb2RlX21hcC5JZGVudGl0eVRvVW5pY29kZU1hcCkgewogICAgcmV0dXJuOwogIH0KICBjb25zdCB0b1VuaWNvZGUgPSBbXTsKICBmb3IgKGNvbnN0IGNoYXJDb2RlIGluIHByb3BlcnRpZXMuZmFsbGJhY2tUb1VuaWNvZGUpIHsKICAgIGlmIChwcm9wZXJ0aWVzLnRvVW5pY29kZS5oYXMoY2hhckNvZGUpKSB7CiAgICAgIGNvbnRpbnVlOwogICAgfQogICAgdG9Vbmljb2RlW2NoYXJDb2RlXSA9IHByb3BlcnRpZXMuZmFsbGJhY2tUb1VuaWNvZGVbY2hhckNvZGVdOwogIH0KICBpZiAodG9Vbmljb2RlLmxlbmd0aCA+IDApIHsKICAgIHByb3BlcnRpZXMudG9Vbmljb2RlLmFtZW5kKHRvVW5pY29kZSk7CiAgfQp9CmNsYXNzIEdseXBoIHsKICBjb25zdHJ1Y3RvcihvcmlnaW5hbENoYXJDb2RlLCBmb250Q2hhciwgdW5pY29kZSwgYWNjZW50LCB3aWR0aCwgdm1ldHJpYywgb3BlcmF0b3JMaXN0SWQsIGlzU3BhY2UsIGlzSW5Gb250KSB7CiAgICB0aGlzLm9yaWdpbmFsQ2hhckNvZGUgPSBvcmlnaW5hbENoYXJDb2RlOwogICAgdGhpcy5mb250Q2hhciA9IGZvbnRDaGFyOwogICAgdGhpcy51bmljb2RlID0gdW5pY29kZTsKICAgIHRoaXMuYWNjZW50ID0gYWNjZW50OwogICAgdGhpcy53aWR0aCA9IHdpZHRoOwogICAgdGhpcy52bWV0cmljID0gdm1ldHJpYzsKICAgIHRoaXMub3BlcmF0b3JMaXN0SWQgPSBvcGVyYXRvckxpc3RJZDsKICAgIHRoaXMuaXNTcGFjZSA9IGlzU3BhY2U7CiAgICB0aGlzLmlzSW5Gb250ID0gaXNJbkZvbnQ7CiAgfQogIGdldCBjYXRlZ29yeSgpIHsKICAgIHJldHVybiAoMCwgX3V0aWwuc2hhZG93KSh0aGlzLCAiY2F0ZWdvcnkiLCAoMCwgX3VuaWNvZGUuZ2V0Q2hhclVuaWNvZGVDYXRlZ29yeSkodGhpcy51bmljb2RlKSwgdHJ1ZSk7CiAgfQp9CmZ1bmN0aW9uIGludDE2KGIwLCBiMSkgewogIHJldHVybiAoYjAgPDwgOCkgKyBiMTsKfQpmdW5jdGlvbiB3cml0ZVNpZ25lZEludDE2KGJ5dGVzLCBpbmRleCwgdmFsdWUpIHsKICBieXRlc1tpbmRleCArIDFdID0gdmFsdWU7CiAgYnl0ZXNbaW5kZXhdID0gdmFsdWUgPj4+IDg7Cn0KZnVuY3Rpb24gc2lnbmVkSW50MTYoYjAsIGIxKSB7CiAgY29uc3QgdmFsdWUgPSAoYjAgPDwgOCkgKyBiMTsKICByZXR1cm4gdmFsdWUgJiAxIDw8IDE1ID8gdmFsdWUgLSAweDEwMDAwIDogdmFsdWU7Cn0KZnVuY3Rpb24gaW50MzIoYjAsIGIxLCBiMiwgYjMpIHsKICByZXR1cm4gKGIwIDw8IDI0KSArIChiMSA8PCAxNikgKyAoYjIgPDwgOCkgKyBiMzsKfQpmdW5jdGlvbiBzdHJpbmcxNih2YWx1ZSkgewogIHJldHVybiBTdHJpbmcuZnJvbUNoYXJDb2RlKHZhbHVlID4+IDggJiAweGZmLCB2YWx1ZSAmIDB4ZmYpOwp9CmZ1bmN0aW9uIHNhZmVTdHJpbmcxNih2YWx1ZSkgewogIGlmICh2YWx1ZSA+IDB4N2ZmZikgewogICAgdmFsdWUgPSAweDdmZmY7CiAgfSBlbHNlIGlmICh2YWx1ZSA8IC0weDgwMDApIHsKICAgIHZhbHVlID0gLTB4ODAwMDsKICB9CiAgcmV0dXJuIFN0cmluZy5mcm9tQ2hhckNvZGUodmFsdWUgPj4gOCAmIDB4ZmYsIHZhbHVlICYgMHhmZik7Cn0KZnVuY3Rpb24gaXNUcnVlVHlwZUZpbGUoZmlsZSkgewogIGNvbnN0IGhlYWRlciA9IGZpbGUucGVla0J5dGVzKDQpOwogIHJldHVybiAoMCwgX2NvcmVfdXRpbHMucmVhZFVpbnQzMikoaGVhZGVyLCAwKSA9PT0gMHgwMDAxMDAwMCB8fCAoMCwgX3V0aWwuYnl0ZXNUb1N0cmluZykoaGVhZGVyKSA9PT0gInRydWUiOwp9CmZ1bmN0aW9uIGlzVHJ1ZVR5cGVDb2xsZWN0aW9uRmlsZShmaWxlKSB7CiAgY29uc3QgaGVhZGVyID0gZmlsZS5wZWVrQnl0ZXMoNCk7CiAgcmV0dXJuICgwLCBfdXRpbC5ieXRlc1RvU3RyaW5nKShoZWFkZXIpID09PSAidHRjZiI7Cn0KZnVuY3Rpb24gaXNPcGVuVHlwZUZpbGUoZmlsZSkgewogIGNvbnN0IGhlYWRlciA9IGZpbGUucGVla0J5dGVzKDQpOwogIHJldHVybiAoMCwgX3V0aWwuYnl0ZXNUb1N0cmluZykoaGVhZGVyKSA9PT0gIk9UVE8iOwp9CmZ1bmN0aW9uIGlzVHlwZTFGaWxlKGZpbGUpIHsKICBjb25zdCBoZWFkZXIgPSBmaWxlLnBlZWtCeXRlcygyKTsKICBpZiAoaGVhZGVyWzBdID09PSAweDI1ICYmIGhlYWRlclsxXSA9PT0gMHgyMSkgewogICAgcmV0dXJuIHRydWU7CiAgfQogIGlmIChoZWFkZXJbMF0gPT09IDB4ODAgJiYgaGVhZGVyWzFdID09PSAweDAxKSB7CiAgICByZXR1cm4gdHJ1ZTsKICB9CiAgcmV0dXJuIGZhbHNlOwp9CmZ1bmN0aW9uIGlzQ0ZGRmlsZShmaWxlKSB7CiAgY29uc3QgaGVhZGVyID0gZmlsZS5wZWVrQnl0ZXMoNCk7CiAgaWYgKGhlYWRlclswXSA+PSAxICYmIGhlYWRlclszXSA+PSAxICYmIGhlYWRlclszXSA8PSA0KSB7CiAgICByZXR1cm4gdHJ1ZTsKICB9CiAgcmV0dXJuIGZhbHNlOwp9CmZ1bmN0aW9uIGdldEZvbnRGaWxlVHlwZShmaWxlLCB7CiAgdHlwZSwKICBzdWJ0eXBlLAogIGNvbXBvc2l0ZQp9KSB7CiAgbGV0IGZpbGVUeXBlLCBmaWxlU3VidHlwZTsKICBpZiAoaXNUcnVlVHlwZUZpbGUoZmlsZSkgfHwgaXNUcnVlVHlwZUNvbGxlY3Rpb25GaWxlKGZpbGUpKSB7CiAgICBmaWxlVHlwZSA9IGNvbXBvc2l0ZSA/ICJDSURGb250VHlwZTIiIDogIlRydWVUeXBlIjsKICB9IGVsc2UgaWYgKGlzT3BlblR5cGVGaWxlKGZpbGUpKSB7CiAgICBmaWxlVHlwZSA9IGNvbXBvc2l0ZSA/ICJDSURGb250VHlwZTIiIDogIk9wZW5UeXBlIjsKICB9IGVsc2UgaWYgKGlzVHlwZTFGaWxlKGZpbGUpKSB7CiAgICBpZiAoY29tcG9zaXRlKSB7CiAgICAgIGZpbGVUeXBlID0gIkNJREZvbnRUeXBlMCI7CiAgICB9IGVsc2UgewogICAgICBmaWxlVHlwZSA9IHR5cGUgPT09ICJNTVR5cGUxIiA/ICJNTVR5cGUxIiA6ICJUeXBlMSI7CiAgICB9CiAgfSBlbHNlIGlmIChpc0NGRkZpbGUoZmlsZSkpIHsKICAgIGlmIChjb21wb3NpdGUpIHsKICAgICAgZmlsZVR5cGUgPSAiQ0lERm9udFR5cGUwIjsKICAgICAgZmlsZVN1YnR5cGUgPSAiQ0lERm9udFR5cGUwQyI7CiAgICB9IGVsc2UgewogICAgICBmaWxlVHlwZSA9IHR5cGUgPT09ICJNTVR5cGUxIiA/ICJNTVR5cGUxIiA6ICJUeXBlMSI7CiAgICAgIGZpbGVTdWJ0eXBlID0gIlR5cGUxQyI7CiAgICB9CiAgfSBlbHNlIHsKICAgICgwLCBfdXRpbC53YXJuKSgiZ2V0Rm9udEZpbGVUeXBlOiBVbmFibGUgdG8gZGV0ZWN0IGNvcnJlY3QgZm9udCBmaWxlIFR5cGUvU3VidHlwZS4iKTsKICAgIGZpbGVUeXBlID0gdHlwZTsKICAgIGZpbGVTdWJ0eXBlID0gc3VidHlwZTsKICB9CiAgcmV0dXJuIFtmaWxlVHlwZSwgZmlsZVN1YnR5cGVdOwp9CmZ1bmN0aW9uIGFwcGx5U3RhbmRhcmRGb250R2x5cGhNYXAobWFwLCBnbHlwaE1hcCkgewogIGZvciAoY29uc3QgY2hhckNvZGUgaW4gZ2x5cGhNYXApIHsKICAgIG1hcFsrY2hhckNvZGVdID0gZ2x5cGhNYXBbY2hhckNvZGVdOwogIH0KfQpmdW5jdGlvbiBidWlsZFRvRm9udENoYXIoZW5jb2RpbmcsIGdseXBoc1VuaWNvZGVNYXAsIGRpZmZlcmVuY2VzKSB7CiAgY29uc3QgdG9Gb250Q2hhciA9IFtdOwogIGxldCB1bmljb2RlOwogIGZvciAobGV0IGkgPSAwLCBpaSA9IGVuY29kaW5nLmxlbmd0aDsgaSA8IGlpOyBpKyspIHsKICAgIHVuaWNvZGUgPSAoMCwgX3VuaWNvZGUuZ2V0VW5pY29kZUZvckdseXBoKShlbmNvZGluZ1tpXSwgZ2x5cGhzVW5pY29kZU1hcCk7CiAgICBpZiAodW5pY29kZSAhPT0gLTEpIHsKICAgICAgdG9Gb250Q2hhcltpXSA9IHVuaWNvZGU7CiAgICB9CiAgfQogIGZvciAoY29uc3QgY2hhckNvZGUgaW4gZGlmZmVyZW5jZXMpIHsKICAgIHVuaWNvZGUgPSAoMCwgX3VuaWNvZGUuZ2V0VW5pY29kZUZvckdseXBoKShkaWZmZXJlbmNlc1tjaGFyQ29kZV0sIGdseXBoc1VuaWNvZGVNYXApOwogICAgaWYgKHVuaWNvZGUgIT09IC0xKSB7CiAgICAgIHRvRm9udENoYXJbK2NoYXJDb2RlXSA9IHVuaWNvZGU7CiAgICB9CiAgfQogIHJldHVybiB0b0ZvbnRDaGFyOwp9CmZ1bmN0aW9uIGlzTWFjTmFtZVJlY29yZChyKSB7CiAgcmV0dXJuIHIucGxhdGZvcm0gPT09IDEgJiYgci5lbmNvZGluZyA9PT0gMCAmJiByLmxhbmd1YWdlID09PSAwOwp9CmZ1bmN0aW9uIGlzV2luTmFtZVJlY29yZChyKSB7CiAgcmV0dXJuIHIucGxhdGZvcm0gPT09IDMgJiYgci5lbmNvZGluZyA9PT0gMSAmJiByLmxhbmd1YWdlID09PSAweDQwOTsKfQpmdW5jdGlvbiBjb252ZXJ0Q2lkU3RyaW5nKGNoYXJDb2RlLCBjaWQsIHNob3VsZFRocm93ID0gZmFsc2UpIHsKICBzd2l0Y2ggKGNpZC5sZW5ndGgpIHsKICAgIGNhc2UgMToKICAgICAgcmV0dXJuIGNpZC5jaGFyQ29kZUF0KDApOwogICAgY2FzZSAyOgogICAgICByZXR1cm4gY2lkLmNoYXJDb2RlQXQoMCkgPDwgOCB8IGNpZC5jaGFyQ29kZUF0KDEpOwogIH0KICBjb25zdCBtc2cgPSBgVW5zdXBwb3J0ZWQgQ0lEIHN0cmluZyAoY2hhckNvZGUgJHtjaGFyQ29kZX0pOiAiJHtjaWR9Ii5gOwogIGlmIChzaG91bGRUaHJvdykgewogICAgdGhyb3cgbmV3IF91dGlsLkZvcm1hdEVycm9yKG1zZyk7CiAgfQogICgwLCBfdXRpbC53YXJuKShtc2cpOwogIHJldHVybiBjaWQ7Cn0KZnVuY3Rpb24gYWRqdXN0TWFwcGluZyhjaGFyQ29kZVRvR2x5cGhJZCwgaGFzR2x5cGgsIG5ld0dseXBoWmVyb0lkLCB0b1VuaWNvZGUpIHsKICBjb25zdCBuZXdNYXAgPSBPYmplY3QuY3JlYXRlKG51bGwpOwogIGNvbnN0IHRvVW5pY29kZUV4dHJhTWFwID0gbmV3IE1hcCgpOwogIGNvbnN0IHRvRm9udENoYXIgPSBbXTsKICBjb25zdCB1c2VkR2x5cGhJZHMgPSBuZXcgU2V0KCk7CiAgbGV0IHByaXZhdGVVc2VBcmVhSW5kZXggPSAwOwogIGNvbnN0IHByaXZhdGVVc2VPZmZldFN0YXJ0ID0gUFJJVkFURV9VU0VfQVJFQVNbcHJpdmF0ZVVzZUFyZWFJbmRleF1bMF07CiAgbGV0IG5leHRBdmFpbGFibGVGb250Q2hhckNvZGUgPSBwcml2YXRlVXNlT2ZmZXRTdGFydDsKICBsZXQgcHJpdmF0ZVVzZU9mZmV0RW5kID0gUFJJVkFURV9VU0VfQVJFQVNbcHJpdmF0ZVVzZUFyZWFJbmRleF1bMV07CiAgY29uc3QgaXNJblByaXZhdGVBcmVhID0gY29kZSA9PiBQUklWQVRFX1VTRV9BUkVBU1swXVswXSA8PSBjb2RlICYmIGNvZGUgPD0gUFJJVkFURV9VU0VfQVJFQVNbMF1bMV0gfHwgUFJJVkFURV9VU0VfQVJFQVNbMV1bMF0gPD0gY29kZSAmJiBjb2RlIDw9IFBSSVZBVEVfVVNFX0FSRUFTWzFdWzFdOwogIGZvciAobGV0IG9yaWdpbmFsQ2hhckNvZGUgaW4gY2hhckNvZGVUb0dseXBoSWQpIHsKICAgIG9yaWdpbmFsQ2hhckNvZGUgfD0gMDsKICAgIGxldCBnbHlwaElkID0gY2hhckNvZGVUb0dseXBoSWRbb3JpZ2luYWxDaGFyQ29kZV07CiAgICBpZiAoIWhhc0dseXBoKGdseXBoSWQpKSB7CiAgICAgIGNvbnRpbnVlOwogICAgfQogICAgaWYgKG5leHRBdmFpbGFibGVGb250Q2hhckNvZGUgPiBwcml2YXRlVXNlT2ZmZXRFbmQpIHsKICAgICAgcHJpdmF0ZVVzZUFyZWFJbmRleCsrOwogICAgICBpZiAocHJpdmF0ZVVzZUFyZWFJbmRleCA+PSBQUklWQVRFX1VTRV9BUkVBUy5sZW5ndGgpIHsKICAgICAgICAoMCwgX3V0aWwud2FybikoIlJhbiBvdXQgb2Ygc3BhY2UgaW4gZm9udCBwcml2YXRlIHVzZSBhcmVhLiIpOwogICAgICAgIGJyZWFrOwogICAgICB9CiAgICAgIG5leHRBdmFpbGFibGVGb250Q2hhckNvZGUgPSBQUklWQVRFX1VTRV9BUkVBU1twcml2YXRlVXNlQXJlYUluZGV4XVswXTsKICAgICAgcHJpdmF0ZVVzZU9mZmV0RW5kID0gUFJJVkFURV9VU0VfQVJFQVNbcHJpdmF0ZVVzZUFyZWFJbmRleF1bMV07CiAgICB9CiAgICBjb25zdCBmb250Q2hhckNvZGUgPSBuZXh0QXZhaWxhYmxlRm9udENoYXJDb2RlKys7CiAgICBpZiAoZ2x5cGhJZCA9PT0gMCkgewogICAgICBnbHlwaElkID0gbmV3R2x5cGhaZXJvSWQ7CiAgICB9CiAgICBsZXQgdW5pY29kZSA9IHRvVW5pY29kZS5nZXQob3JpZ2luYWxDaGFyQ29kZSk7CiAgICBpZiAodHlwZW9mIHVuaWNvZGUgPT09ICJzdHJpbmciKSB7CiAgICAgIHVuaWNvZGUgPSB1bmljb2RlLmNvZGVQb2ludEF0KDApOwogICAgfQogICAgaWYgKHVuaWNvZGUgJiYgIWlzSW5Qcml2YXRlQXJlYSh1bmljb2RlKSAmJiAhdXNlZEdseXBoSWRzLmhhcyhnbHlwaElkKSkgewogICAgICB0b1VuaWNvZGVFeHRyYU1hcC5zZXQodW5pY29kZSwgZ2x5cGhJZCk7CiAgICAgIHVzZWRHbHlwaElkcy5hZGQoZ2x5cGhJZCk7CiAgICB9CiAgICBuZXdNYXBbZm9udENoYXJDb2RlXSA9IGdseXBoSWQ7CiAgICB0b0ZvbnRDaGFyW29yaWdpbmFsQ2hhckNvZGVdID0gZm9udENoYXJDb2RlOwogIH0KICByZXR1cm4gewogICAgdG9Gb250Q2hhciwKICAgIGNoYXJDb2RlVG9HbHlwaElkOiBuZXdNYXAsCiAgICB0b1VuaWNvZGVFeHRyYU1hcCwKICAgIG5leHRBdmFpbGFibGVGb250Q2hhckNvZGUKICB9Owp9CmZ1bmN0aW9uIGdldFJhbmdlcyhnbHlwaHMsIHRvVW5pY29kZUV4dHJhTWFwLCBudW1HbHlwaHMpIHsKICBjb25zdCBjb2RlcyA9IFtdOwogIGZvciAoY29uc3QgY2hhckNvZGUgaW4gZ2x5cGhzKSB7CiAgICBpZiAoZ2x5cGhzW2NoYXJDb2RlXSA+PSBudW1HbHlwaHMpIHsKICAgICAgY29udGludWU7CiAgICB9CiAgICBjb2Rlcy5wdXNoKHsKICAgICAgZm9udENoYXJDb2RlOiBjaGFyQ29kZSB8IDAsCiAgICAgIGdseXBoSWQ6IGdseXBoc1tjaGFyQ29kZV0KICAgIH0pOwogIH0KICBpZiAodG9Vbmljb2RlRXh0cmFNYXApIHsKICAgIGZvciAoY29uc3QgW3VuaWNvZGUsIGdseXBoSWRdIG9mIHRvVW5pY29kZUV4dHJhTWFwKSB7CiAgICAgIGlmIChnbHlwaElkID49IG51bUdseXBocykgewogICAgICAgIGNvbnRpbnVlOwogICAgICB9CiAgICAgIGNvZGVzLnB1c2goewogICAgICAgIGZvbnRDaGFyQ29kZTogdW5pY29kZSwKICAgICAgICBnbHlwaElkCiAgICAgIH0pOwogICAgfQogIH0KICBpZiAoY29kZXMubGVuZ3RoID09PSAwKSB7CiAgICBjb2Rlcy5wdXNoKHsKICAgICAgZm9udENoYXJDb2RlOiAwLAogICAgICBnbHlwaElkOiAwCiAgICB9KTsKICB9CiAgY29kZXMuc29ydChmdW5jdGlvbiBmb250R2V0UmFuZ2VzU29ydChhLCBiKSB7CiAgICByZXR1cm4gYS5mb250Q2hhckNvZGUgLSBiLmZvbnRDaGFyQ29kZTsKICB9KTsKICBjb25zdCByYW5nZXMgPSBbXTsKICBjb25zdCBsZW5ndGggPSBjb2Rlcy5sZW5ndGg7CiAgZm9yIChsZXQgbiA9IDA7IG4gPCBsZW5ndGg7KSB7CiAgICBjb25zdCBzdGFydCA9IGNvZGVzW25dLmZvbnRDaGFyQ29kZTsKICAgIGNvbnN0IGNvZGVJbmRpY2VzID0gW2NvZGVzW25dLmdseXBoSWRdOwogICAgKytuOwogICAgbGV0IGVuZCA9IHN0YXJ0OwogICAgd2hpbGUgKG4gPCBsZW5ndGggJiYgZW5kICsgMSA9PT0gY29kZXNbbl0uZm9udENoYXJDb2RlKSB7CiAgICAgIGNvZGVJbmRpY2VzLnB1c2goY29kZXNbbl0uZ2x5cGhJZCk7CiAgICAgICsrZW5kOwogICAgICArK247CiAgICAgIGlmIChlbmQgPT09IDB4ZmZmZikgewogICAgICAgIGJyZWFrOwogICAgICB9CiAgICB9CiAgICByYW5nZXMucHVzaChbc3RhcnQsIGVuZCwgY29kZUluZGljZXNdKTsKICB9CiAgcmV0dXJuIHJhbmdlczsKfQpmdW5jdGlvbiBjcmVhdGVDbWFwVGFibGUoZ2x5cGhzLCB0b1VuaWNvZGVFeHRyYU1hcCwgbnVtR2x5cGhzKSB7CiAgY29uc3QgcmFuZ2VzID0gZ2V0UmFuZ2VzKGdseXBocywgdG9Vbmljb2RlRXh0cmFNYXAsIG51bUdseXBocyk7CiAgY29uc3QgbnVtVGFibGVzID0gcmFuZ2VzLmF0KC0xKVsxXSA+IDB4ZmZmZiA/IDIgOiAxOwogIGxldCBjbWFwID0gIlx4MDBceDAwIiArIHN0cmluZzE2KG51bVRhYmxlcykgKyAiXHgwMFx4MDMiICsgIlx4MDBceDAxIiArICgwLCBfdXRpbC5zdHJpbmczMikoNCArIG51bVRhYmxlcyAqIDgpOwogIGxldCBpLCBpaSwgaiwgamo7CiAgZm9yIChpID0gcmFuZ2VzLmxlbmd0aCAtIDE7IGkgPj0gMDsgLS1pKSB7CiAgICBpZiAocmFuZ2VzW2ldWzBdIDw9IDB4ZmZmZikgewogICAgICBicmVhazsKICAgIH0KICB9CiAgY29uc3QgYm1wTGVuZ3RoID0gaSArIDE7CiAgaWYgKHJhbmdlc1tpXVswXSA8IDB4ZmZmZiAmJiByYW5nZXNbaV1bMV0gPT09IDB4ZmZmZikgewogICAgcmFuZ2VzW2ldWzFdID0gMHhmZmZlOwogIH0KICBjb25zdCB0cmFpbGluZ1Jhbmdlc0NvdW50ID0gcmFuZ2VzW2ldWzFdIDwgMHhmZmZmID8gMSA6IDA7CiAgY29uc3Qgc2VnQ291bnQgPSBibXBMZW5ndGggKyB0cmFpbGluZ1Jhbmdlc0NvdW50OwogIGNvbnN0IHNlYXJjaFBhcmFtcyA9IF9vcGVudHlwZV9maWxlX2J1aWxkZXIuT3BlblR5cGVGaWxlQnVpbGRlci5nZXRTZWFyY2hQYXJhbXMoc2VnQ291bnQsIDIpOwogIGxldCBzdGFydENvdW50ID0gIiI7CiAgbGV0IGVuZENvdW50ID0gIiI7CiAgbGV0IGlkRGVsdGFzID0gIiI7CiAgbGV0IGlkUmFuZ2VPZmZzZXRzID0gIiI7CiAgbGV0IGdseXBoc0lkcyA9ICIiOwogIGxldCBiaWFzID0gMDsKICBsZXQgcmFuZ2UsIHN0YXJ0LCBlbmQsIGNvZGVzOwogIGZvciAoaSA9IDAsIGlpID0gYm1wTGVuZ3RoOyBpIDwgaWk7IGkrKykgewogICAgcmFuZ2UgPSByYW5nZXNbaV07CiAgICBzdGFydCA9IHJhbmdlWzBdOwogICAgZW5kID0gcmFuZ2VbMV07CiAgICBzdGFydENvdW50ICs9IHN0cmluZzE2KHN0YXJ0KTsKICAgIGVuZENvdW50ICs9IHN0cmluZzE2KGVuZCk7CiAgICBjb2RlcyA9IHJhbmdlWzJdOwogICAgbGV0IGNvbnRpZ3VvdXMgPSB0cnVlOwogICAgZm9yIChqID0gMSwgamogPSBjb2Rlcy5sZW5ndGg7IGogPCBqajsgKytqKSB7CiAgICAgIGlmIChjb2Rlc1tqXSAhPT0gY29kZXNbaiAtIDFdICsgMSkgewogICAgICAgIGNvbnRpZ3VvdXMgPSBmYWxzZTsKICAgICAgICBicmVhazsKICAgICAgfQogICAgfQogICAgaWYgKCFjb250aWd1b3VzKSB7CiAgICAgIGNvbnN0IG9mZnNldCA9IChzZWdDb3VudCAtIGkpICogMiArIGJpYXMgKiAyOwogICAgICBiaWFzICs9IGVuZCAtIHN0YXJ0ICsgMTsKICAgICAgaWREZWx0YXMgKz0gc3RyaW5nMTYoMCk7CiAgICAgIGlkUmFuZ2VPZmZzZXRzICs9IHN0cmluZzE2KG9mZnNldCk7CiAgICAgIGZvciAoaiA9IDAsIGpqID0gY29kZXMubGVuZ3RoOyBqIDwgamo7ICsraikgewogICAgICAgIGdseXBoc0lkcyArPSBzdHJpbmcxNihjb2Rlc1tqXSk7CiAgICAgIH0KICAgIH0gZWxzZSB7CiAgICAgIGNvbnN0IHN0YXJ0Q29kZSA9IGNvZGVzWzBdOwogICAgICBpZERlbHRhcyArPSBzdHJpbmcxNihzdGFydENvZGUgLSBzdGFydCAmIDB4ZmZmZik7CiAgICAgIGlkUmFuZ2VPZmZzZXRzICs9IHN0cmluZzE2KDApOwogICAgfQogIH0KICBpZiAodHJhaWxpbmdSYW5nZXNDb3VudCA+IDApIHsKICAgIGVuZENvdW50ICs9ICJceEZGXHhGRiI7CiAgICBzdGFydENvdW50ICs9ICJceEZGXHhGRiI7CiAgICBpZERlbHRhcyArPSAiXHgwMFx4MDEiOwogICAgaWRSYW5nZU9mZnNldHMgKz0gIlx4MDBceDAwIjsKICB9CiAgY29uc3QgZm9ybWF0MzE0ID0gIlx4MDBceDAwIiArIHN0cmluZzE2KDIgKiBzZWdDb3VudCkgKyBzdHJpbmcxNihzZWFyY2hQYXJhbXMucmFuZ2UpICsgc3RyaW5nMTYoc2VhcmNoUGFyYW1zLmVudHJ5KSArIHN0cmluZzE2KHNlYXJjaFBhcmFtcy5yYW5nZVNoaWZ0KSArIGVuZENvdW50ICsgIlx4MDBceDAwIiArIHN0YXJ0Q291bnQgKyBpZERlbHRhcyArIGlkUmFuZ2VPZmZzZXRzICsgZ2x5cGhzSWRzOwogIGxldCBmb3JtYXQzMTAxMiA9ICIiOwogIGxldCBoZWFkZXIzMTAxMiA9ICIiOwogIGlmIChudW1UYWJsZXMgPiAxKSB7CiAgICBjbWFwICs9ICJceDAwXHgwMyIgKyAiXHgwMFx4MEEiICsgKDAsIF91dGlsLnN0cmluZzMyKSg0ICsgbnVtVGFibGVzICogOCArIDQgKyBmb3JtYXQzMTQubGVuZ3RoKTsKICAgIGZvcm1hdDMxMDEyID0gIiI7CiAgICBmb3IgKGkgPSAwLCBpaSA9IHJhbmdlcy5sZW5ndGg7IGkgPCBpaTsgaSsrKSB7CiAgICAgIHJhbmdlID0gcmFuZ2VzW2ldOwogICAgICBzdGFydCA9IHJhbmdlWzBdOwogICAgICBjb2RlcyA9IHJhbmdlWzJdOwogICAgICBsZXQgY29kZSA9IGNvZGVzWzBdOwogICAgICBmb3IgKGogPSAxLCBqaiA9IGNvZGVzLmxlbmd0aDsgaiA8IGpqOyArK2opIHsKICAgICAgICBpZiAoY29kZXNbal0gIT09IGNvZGVzW2ogLSAxXSArIDEpIHsKICAgICAgICAgIGVuZCA9IHJhbmdlWzBdICsgaiAtIDE7CiAgICAgICAgICBmb3JtYXQzMTAxMiArPSAoMCwgX3V0aWwuc3RyaW5nMzIpKHN0YXJ0KSArICgwLCBfdXRpbC5zdHJpbmczMikoZW5kKSArICgwLCBfdXRpbC5zdHJpbmczMikoY29kZSk7CiAgICAgICAgICBzdGFydCA9IGVuZCArIDE7CiAgICAgICAgICBjb2RlID0gY29kZXNbal07CiAgICAgICAgfQogICAgICB9CiAgICAgIGZvcm1hdDMxMDEyICs9ICgwLCBfdXRpbC5zdHJpbmczMikoc3RhcnQpICsgKDAsIF91dGlsLnN0cmluZzMyKShyYW5nZVsxXSkgKyAoMCwgX3V0aWwuc3RyaW5nMzIpKGNvZGUpOwogICAgfQogICAgaGVhZGVyMzEwMTIgPSAiXHgwMFx4MEMiICsgIlx4MDBceDAwIiArICgwLCBfdXRpbC5zdHJpbmczMikoZm9ybWF0MzEwMTIubGVuZ3RoICsgMTYpICsgIlx4MDBceDAwXHgwMFx4MDAiICsgKDAsIF91dGlsLnN0cmluZzMyKShmb3JtYXQzMTAxMi5sZW5ndGggLyAxMik7CiAgfQogIHJldHVybiBjbWFwICsgIlx4MDBceDA0IiArIHN0cmluZzE2KGZvcm1hdDMxNC5sZW5ndGggKyA0KSArIGZvcm1hdDMxNCArIGhlYWRlcjMxMDEyICsgZm9ybWF0MzEwMTI7Cn0KZnVuY3Rpb24gdmFsaWRhdGVPUzJUYWJsZShvczIsIGZpbGUpIHsKICBmaWxlLnBvcyA9IChmaWxlLnN0YXJ0IHx8IDApICsgb3MyLm9mZnNldDsKICBjb25zdCB2ZXJzaW9uID0gZmlsZS5nZXRVaW50MTYoKTsKICBmaWxlLnNraXAoNjApOwogIGNvbnN0IHNlbGVjdGlvbiA9IGZpbGUuZ2V0VWludDE2KCk7CiAgaWYgKHZlcnNpb24gPCA0ICYmIHNlbGVjdGlvbiAmIDB4MDMwMCkgewogICAgcmV0dXJuIGZhbHNlOwogIH0KICBjb25zdCBmaXJzdENoYXIgPSBmaWxlLmdldFVpbnQxNigpOwogIGNvbnN0IGxhc3RDaGFyID0gZmlsZS5nZXRVaW50MTYoKTsKICBpZiAoZmlyc3RDaGFyID4gbGFzdENoYXIpIHsKICAgIHJldHVybiBmYWxzZTsKICB9CiAgZmlsZS5za2lwKDYpOwogIGNvbnN0IHVzV2luQXNjZW50ID0gZmlsZS5nZXRVaW50MTYoKTsKICBpZiAodXNXaW5Bc2NlbnQgPT09IDApIHsKICAgIHJldHVybiBmYWxzZTsKICB9CiAgb3MyLmRhdGFbOF0gPSBvczIuZGF0YVs5XSA9IDA7CiAgcmV0dXJuIHRydWU7Cn0KZnVuY3Rpb24gY3JlYXRlT1MyVGFibGUocHJvcGVydGllcywgY2hhcnN0cmluZ3MsIG92ZXJyaWRlKSB7CiAgb3ZlcnJpZGUgfHw9IHsKICAgIHVuaXRzUGVyRW06IDAsCiAgICB5TWF4OiAwLAogICAgeU1pbjogMCwKICAgIGFzY2VudDogMCwKICAgIGRlc2NlbnQ6IDAKICB9OwogIGxldCB1bFVuaWNvZGVSYW5nZTEgPSAwOwogIGxldCB1bFVuaWNvZGVSYW5nZTIgPSAwOwogIGxldCB1bFVuaWNvZGVSYW5nZTMgPSAwOwogIGxldCB1bFVuaWNvZGVSYW5nZTQgPSAwOwogIGxldCBmaXJzdENoYXJJbmRleCA9IG51bGw7CiAgbGV0IGxhc3RDaGFySW5kZXggPSAwOwogIGxldCBwb3NpdGlvbiA9IC0xOwogIGlmIChjaGFyc3RyaW5ncykgewogICAgZm9yIChsZXQgY29kZSBpbiBjaGFyc3RyaW5ncykgewogICAgICBjb2RlIHw9IDA7CiAgICAgIGlmIChmaXJzdENoYXJJbmRleCA+IGNvZGUgfHwgIWZpcnN0Q2hhckluZGV4KSB7CiAgICAgICAgZmlyc3RDaGFySW5kZXggPSBjb2RlOwogICAgICB9CiAgICAgIGlmIChsYXN0Q2hhckluZGV4IDwgY29kZSkgewogICAgICAgIGxhc3RDaGFySW5kZXggPSBjb2RlOwogICAgICB9CiAgICAgIHBvc2l0aW9uID0gKDAsIF91bmljb2RlLmdldFVuaWNvZGVSYW5nZUZvcikoY29kZSwgcG9zaXRpb24pOwogICAgICBpZiAocG9zaXRpb24gPCAzMikgewogICAgICAgIHVsVW5pY29kZVJhbmdlMSB8PSAxIDw8IHBvc2l0aW9uOwogICAgICB9IGVsc2UgaWYgKHBvc2l0aW9uIDwgNjQpIHsKICAgICAgICB1bFVuaWNvZGVSYW5nZTIgfD0gMSA8PCBwb3NpdGlvbiAtIDMyOwogICAgICB9IGVsc2UgaWYgKHBvc2l0aW9uIDwgOTYpIHsKICAgICAgICB1bFVuaWNvZGVSYW5nZTMgfD0gMSA8PCBwb3NpdGlvbiAtIDY0OwogICAgICB9IGVsc2UgaWYgKHBvc2l0aW9uIDwgMTIzKSB7CiAgICAgICAgdWxVbmljb2RlUmFuZ2U0IHw9IDEgPDwgcG9zaXRpb24gLSA5NjsKICAgICAgfSBlbHNlIHsKICAgICAgICB0aHJvdyBuZXcgX3V0aWwuRm9ybWF0RXJyb3IoIlVuaWNvZGUgcmFuZ2VzIEJpdHMgPiAxMjMgYXJlIHJlc2VydmVkIGZvciBpbnRlcm5hbCB1c2FnZSIpOwogICAgICB9CiAgICB9CiAgICBpZiAobGFzdENoYXJJbmRleCA+IDB4ZmZmZikgewogICAgICBsYXN0Q2hhckluZGV4ID0gMHhmZmZmOwogICAgfQogIH0gZWxzZSB7CiAgICBmaXJzdENoYXJJbmRleCA9IDA7CiAgICBsYXN0Q2hhckluZGV4ID0gMjU1OwogIH0KICBjb25zdCBiYm94ID0gcHJvcGVydGllcy5iYm94IHx8IFswLCAwLCAwLCAwXTsKICBjb25zdCB1bml0c1BlckVtID0gb3ZlcnJpZGUudW5pdHNQZXJFbSB8fCAxIC8gKHByb3BlcnRpZXMuZm9udE1hdHJpeCB8fCBfdXRpbC5GT05UX0lERU5USVRZX01BVFJJWClbMF07CiAgY29uc3Qgc2NhbGUgPSBwcm9wZXJ0aWVzLmFzY2VudFNjYWxlZCA/IDEuMCA6IHVuaXRzUGVyRW0gLyBQREZfR0xZUEhfU1BBQ0VfVU5JVFM7CiAgY29uc3QgdHlwb0FzY2VudCA9IG92ZXJyaWRlLmFzY2VudCB8fCBNYXRoLnJvdW5kKHNjYWxlICogKHByb3BlcnRpZXMuYXNjZW50IHx8IGJib3hbM10pKTsKICBsZXQgdHlwb0Rlc2NlbnQgPSBvdmVycmlkZS5kZXNjZW50IHx8IE1hdGgucm91bmQoc2NhbGUgKiAocHJvcGVydGllcy5kZXNjZW50IHx8IGJib3hbMV0pKTsKICBpZiAodHlwb0Rlc2NlbnQgPiAwICYmIHByb3BlcnRpZXMuZGVzY2VudCA+IDAgJiYgYmJveFsxXSA8IDApIHsKICAgIHR5cG9EZXNjZW50ID0gLXR5cG9EZXNjZW50OwogIH0KICBjb25zdCB3aW5Bc2NlbnQgPSBvdmVycmlkZS55TWF4IHx8IHR5cG9Bc2NlbnQ7CiAgY29uc3Qgd2luRGVzY2VudCA9IC1vdmVycmlkZS55TWluIHx8IC10eXBvRGVzY2VudDsKICByZXR1cm4gIlx4MDBceDAzIiArICJceDAyXHgyNCIgKyAiXHgwMVx4RjQiICsgIlx4MDBceDA1IiArICJceDAwXHgwMCIgKyAiXHgwMlx4OEEiICsgIlx4MDJceEJCIiArICJceDAwXHgwMCIgKyAiXHgwMFx4OEMiICsgIlx4MDJceDhBIiArICJceDAyXHhCQiIgKyAiXHgwMFx4MDAiICsgIlx4MDFceERGIiArICJceDAwXHgzMSIgKyAiXHgwMVx4MDIiICsgIlx4MDBceDAwIiArICJceDAwXHgwMFx4MDYiICsgU3RyaW5nLmZyb21DaGFyQ29kZShwcm9wZXJ0aWVzLmZpeGVkUGl0Y2ggPyAweDA5IDogMHgwMCkgKyAiXHgwMFx4MDBceDAwXHgwMFx4MDBceDAwIiArICgwLCBfdXRpbC5zdHJpbmczMikodWxVbmljb2RlUmFuZ2UxKSArICgwLCBfdXRpbC5zdHJpbmczMikodWxVbmljb2RlUmFuZ2UyKSArICgwLCBfdXRpbC5zdHJpbmczMikodWxVbmljb2RlUmFuZ2UzKSArICgwLCBfdXRpbC5zdHJpbmczMikodWxVbmljb2RlUmFuZ2U0KSArICJceDJBXHgzMlx4MzFceDJBIiArIHN0cmluZzE2KHByb3BlcnRpZXMuaXRhbGljQW5nbGUgPyAxIDogMCkgKyBzdHJpbmcxNihmaXJzdENoYXJJbmRleCB8fCBwcm9wZXJ0aWVzLmZpcnN0Q2hhcikgKyBzdHJpbmcxNihsYXN0Q2hhckluZGV4IHx8IHByb3BlcnRpZXMubGFzdENoYXIpICsgc3RyaW5nMTYodHlwb0FzY2VudCkgKyBzdHJpbmcxNih0eXBvRGVzY2VudCkgKyAiXHgwMFx4NjQiICsgc3RyaW5nMTYod2luQXNjZW50KSArIHN0cmluZzE2KHdpbkRlc2NlbnQpICsgIlx4MDBceDAwXHgwMFx4MDAiICsgIlx4MDBceDAwXHgwMFx4MDAiICsgc3RyaW5nMTYocHJvcGVydGllcy54SGVpZ2h0KSArIHN0cmluZzE2KHByb3BlcnRpZXMuY2FwSGVpZ2h0KSArIHN0cmluZzE2KDApICsgc3RyaW5nMTYoZmlyc3RDaGFySW5kZXggfHwgcHJvcGVydGllcy5maXJzdENoYXIpICsgIlx4MDBceDAzIjsKfQpmdW5jdGlvbiBjcmVhdGVQb3N0VGFibGUocHJvcGVydGllcykgewogIGNvbnN0IGFuZ2xlID0gTWF0aC5mbG9vcihwcm9wZXJ0aWVzLml0YWxpY0FuZ2xlICogMiAqKiAxNik7CiAgcmV0dXJuICJceDAwXHgwM1x4MDBceDAwIiArICgwLCBfdXRpbC5zdHJpbmczMikoYW5nbGUpICsgIlx4MDBceDAwIiArICJceDAwXHgwMCIgKyAoMCwgX3V0aWwuc3RyaW5nMzIpKHByb3BlcnRpZXMuZml4ZWRQaXRjaCA/IDEgOiAwKSArICJceDAwXHgwMFx4MDBceDAwIiArICJceDAwXHgwMFx4MDBceDAwIiArICJceDAwXHgwMFx4MDBceDAwIiArICJceDAwXHgwMFx4MDBceDAwIjsKfQpmdW5jdGlvbiBjcmVhdGVQb3N0c2NyaXB0TmFtZShuYW1lKSB7CiAgcmV0dXJuIG5hbWUucmVwbGFjZUFsbCgvW15ceDIxLVx4N0VdfFtbXF0oKXt9PD4vJV0vZywgIiIpLnNsaWNlKDAsIDYzKTsKfQpmdW5jdGlvbiBjcmVhdGVOYW1lVGFibGUobmFtZSwgcHJvdG8pIHsKICBpZiAoIXByb3RvKSB7CiAgICBwcm90byA9IFtbXSwgW11dOwogIH0KICBjb25zdCBzdHJpbmdzID0gW3Byb3RvWzBdWzBdIHx8ICJPcmlnaW5hbCBsaWNlbmNlIiwgcHJvdG9bMF1bMV0gfHwgbmFtZSwgcHJvdG9bMF1bMl0gfHwgIlVua25vd24iLCBwcm90b1swXVszXSB8fCAidW5pcXVlSUQiLCBwcm90b1swXVs0XSB8fCBuYW1lLCBwcm90b1swXVs1XSB8fCAiVmVyc2lvbiAwLjExIiwgcHJvdG9bMF1bNl0gfHwgY3JlYXRlUG9zdHNjcmlwdE5hbWUobmFtZSksIHByb3RvWzBdWzddIHx8ICJVbmtub3duIiwgcHJvdG9bMF1bOF0gfHwgIlVua25vd24iLCBwcm90b1swXVs5XSB8fCAiVW5rbm93biJdOwogIGNvbnN0IHN0cmluZ3NVbmljb2RlID0gW107CiAgbGV0IGksIGlpLCBqLCBqaiwgc3RyOwogIGZvciAoaSA9IDAsIGlpID0gc3RyaW5ncy5sZW5ndGg7IGkgPCBpaTsgaSsrKSB7CiAgICBzdHIgPSBwcm90b1sxXVtpXSB8fCBzdHJpbmdzW2ldOwogICAgY29uc3Qgc3RyQnVmVW5pY29kZSA9IFtdOwogICAgZm9yIChqID0gMCwgamogPSBzdHIubGVuZ3RoOyBqIDwgamo7IGorKykgewogICAgICBzdHJCdWZVbmljb2RlLnB1c2goc3RyaW5nMTYoc3RyLmNoYXJDb2RlQXQoaikpKTsKICAgIH0KICAgIHN0cmluZ3NVbmljb2RlLnB1c2goc3RyQnVmVW5pY29kZS5qb2luKCIiKSk7CiAgfQogIGNvbnN0IG5hbWVzID0gW3N0cmluZ3MsIHN0cmluZ3NVbmljb2RlXTsKICBjb25zdCBwbGF0Zm9ybXMgPSBbIlx4MDBceDAxIiwgIlx4MDBceDAzIl07CiAgY29uc3QgZW5jb2RpbmdzID0gWyJceDAwXHgwMCIsICJceDAwXHgwMSJdOwogIGNvbnN0IGxhbmd1YWdlcyA9IFsiXHgwMFx4MDAiLCAiXHgwNFx4MDkiXTsKICBjb25zdCBuYW1lc1JlY29yZENvdW50ID0gc3RyaW5ncy5sZW5ndGggKiBwbGF0Zm9ybXMubGVuZ3RoOwogIGxldCBuYW1lVGFibGUgPSAiXHgwMFx4MDAiICsgc3RyaW5nMTYobmFtZXNSZWNvcmRDb3VudCkgKyBzdHJpbmcxNihuYW1lc1JlY29yZENvdW50ICogMTIgKyA2KTsKICBsZXQgc3RyT2Zmc2V0ID0gMDsKICBmb3IgKGkgPSAwLCBpaSA9IHBsYXRmb3Jtcy5sZW5ndGg7IGkgPCBpaTsgaSsrKSB7CiAgICBjb25zdCBzdHJzID0gbmFtZXNbaV07CiAgICBmb3IgKGogPSAwLCBqaiA9IHN0cnMubGVuZ3RoOyBqIDwgamo7IGorKykgewogICAgICBzdHIgPSBzdHJzW2pdOwogICAgICBjb25zdCBuYW1lUmVjb3JkID0gcGxhdGZvcm1zW2ldICsgZW5jb2RpbmdzW2ldICsgbGFuZ3VhZ2VzW2ldICsgc3RyaW5nMTYoaikgKyBzdHJpbmcxNihzdHIubGVuZ3RoKSArIHN0cmluZzE2KHN0ck9mZnNldCk7CiAgICAgIG5hbWVUYWJsZSArPSBuYW1lUmVjb3JkOwogICAgICBzdHJPZmZzZXQgKz0gc3RyLmxlbmd0aDsKICAgIH0KICB9CiAgbmFtZVRhYmxlICs9IHN0cmluZ3Muam9pbigiIikgKyBzdHJpbmdzVW5pY29kZS5qb2luKCIiKTsKICByZXR1cm4gbmFtZVRhYmxlOwp9CmNsYXNzIEZvbnQgewogIGNvbnN0cnVjdG9yKG5hbWUsIGZpbGUsIHByb3BlcnRpZXMpIHsKICAgIHRoaXMubmFtZSA9IG5hbWU7CiAgICB0aGlzLnBzTmFtZSA9IG51bGw7CiAgICB0aGlzLm1pbWV0eXBlID0gbnVsbDsKICAgIHRoaXMuZGlzYWJsZUZvbnRGYWNlID0gZmFsc2U7CiAgICB0aGlzLmxvYWRlZE5hbWUgPSBwcm9wZXJ0aWVzLmxvYWRlZE5hbWU7CiAgICB0aGlzLmlzVHlwZTNGb250ID0gcHJvcGVydGllcy5pc1R5cGUzRm9udDsKICAgIHRoaXMubWlzc2luZ0ZpbGUgPSBmYWxzZTsKICAgIHRoaXMuY3NzRm9udEluZm8gPSBwcm9wZXJ0aWVzLmNzc0ZvbnRJbmZvOwogICAgdGhpcy5fY2hhcnNDYWNoZSA9IE9iamVjdC5jcmVhdGUobnVsbCk7CiAgICB0aGlzLl9nbHlwaENhY2hlID0gT2JqZWN0LmNyZWF0ZShudWxsKTsKICAgIGxldCBpc1NlcmlmRm9udCA9ICEhKHByb3BlcnRpZXMuZmxhZ3MgJiBfZm9udHNfdXRpbHMuRm9udEZsYWdzLlNlcmlmKTsKICAgIGlmICghaXNTZXJpZkZvbnQgJiYgIXByb3BlcnRpZXMuaXNTaW11bGF0ZWRGbGFncykgewogICAgICBjb25zdCBiYXNlTmFtZSA9IG5hbWUucmVwbGFjZUFsbCgvWyxfXS9nLCAiLSIpLnNwbGl0KCItIilbMF0sCiAgICAgICAgc2VyaWZGb250cyA9ICgwLCBfc3RhbmRhcmRfZm9udHMuZ2V0U2VyaWZGb250cykoKTsKICAgICAgZm9yIChjb25zdCBuYW1lUGFydCBvZiBiYXNlTmFtZS5zcGxpdCgiKyIpKSB7CiAgICAgICAgaWYgKHNlcmlmRm9udHNbbmFtZVBhcnRdKSB7CiAgICAgICAgICBpc1NlcmlmRm9udCA9IHRydWU7CiAgICAgICAgICBicmVhazsKICAgICAgICB9CiAgICAgIH0KICAgIH0KICAgIHRoaXMuaXNTZXJpZkZvbnQgPSBpc1NlcmlmRm9udDsKICAgIHRoaXMuaXNTeW1ib2xpY0ZvbnQgPSAhIShwcm9wZXJ0aWVzLmZsYWdzICYgX2ZvbnRzX3V0aWxzLkZvbnRGbGFncy5TeW1ib2xpYyk7CiAgICB0aGlzLmlzTW9ub3NwYWNlID0gISEocHJvcGVydGllcy5mbGFncyAmIF9mb250c191dGlscy5Gb250RmxhZ3MuRml4ZWRQaXRjaCk7CiAgICBsZXQgewogICAgICB0eXBlLAogICAgICBzdWJ0eXBlCiAgICB9ID0gcHJvcGVydGllczsKICAgIHRoaXMudHlwZSA9IHR5cGU7CiAgICB0aGlzLnN1YnR5cGUgPSBzdWJ0eXBlOwogICAgdGhpcy5zeXN0ZW1Gb250SW5mbyA9IHByb3BlcnRpZXMuc3lzdGVtRm9udEluZm87CiAgICBjb25zdCBtYXRjaGVzID0gbmFtZS5tYXRjaCgvXkludmFsaWRQREZqc0ZvbnRfKC4qKV9cZCskLyk7CiAgICB0aGlzLmlzSW52YWxpZFBERmpzRm9udCA9ICEhbWF0Y2hlczsKICAgIGlmICh0aGlzLmlzSW52YWxpZFBERmpzRm9udCkgewogICAgICB0aGlzLmZhbGxiYWNrTmFtZSA9IG1hdGNoZXNbMV07CiAgICB9IGVsc2UgaWYgKHRoaXMuaXNNb25vc3BhY2UpIHsKICAgICAgdGhpcy5mYWxsYmFja05hbWUgPSAibW9ub3NwYWNlIjsKICAgIH0gZWxzZSBpZiAodGhpcy5pc1NlcmlmRm9udCkgewogICAgICB0aGlzLmZhbGxiYWNrTmFtZSA9ICJzZXJpZiI7CiAgICB9IGVsc2UgewogICAgICB0aGlzLmZhbGxiYWNrTmFtZSA9ICJzYW5zLXNlcmlmIjsKICAgIH0KICAgIGlmICh0aGlzLnN5c3RlbUZvbnRJbmZvPy5ndWVzc0ZhbGxiYWNrKSB7CiAgICAgIHRoaXMuc3lzdGVtRm9udEluZm8uZ3Vlc3NGYWxsYmFjayA9IGZhbHNlOwogICAgICB0aGlzLnN5c3RlbUZvbnRJbmZvLmNzcyArPSBgLCR7dGhpcy5mYWxsYmFja05hbWV9YDsKICAgIH0KICAgIHRoaXMuZGlmZmVyZW5jZXMgPSBwcm9wZXJ0aWVzLmRpZmZlcmVuY2VzOwogICAgdGhpcy53aWR0aHMgPSBwcm9wZXJ0aWVzLndpZHRoczsKICAgIHRoaXMuZGVmYXVsdFdpZHRoID0gcHJvcGVydGllcy5kZWZhdWx0V2lkdGg7CiAgICB0aGlzLmNvbXBvc2l0ZSA9IHByb3BlcnRpZXMuY29tcG9zaXRlOwogICAgdGhpcy5jTWFwID0gcHJvcGVydGllcy5jTWFwOwogICAgdGhpcy5jYXBIZWlnaHQgPSBwcm9wZXJ0aWVzLmNhcEhlaWdodCAvIFBERl9HTFlQSF9TUEFDRV9VTklUUzsKICAgIHRoaXMuYXNjZW50ID0gcHJvcGVydGllcy5hc2NlbnQgLyBQREZfR0xZUEhfU1BBQ0VfVU5JVFM7CiAgICB0aGlzLmRlc2NlbnQgPSBwcm9wZXJ0aWVzLmRlc2NlbnQgLyBQREZfR0xZUEhfU1BBQ0VfVU5JVFM7CiAgICB0aGlzLmxpbmVIZWlnaHQgPSB0aGlzLmFzY2VudCAtIHRoaXMuZGVzY2VudDsKICAgIHRoaXMuZm9udE1hdHJpeCA9IHByb3BlcnRpZXMuZm9udE1hdHJpeDsKICAgIHRoaXMuYmJveCA9IHByb3BlcnRpZXMuYmJveDsKICAgIHRoaXMuZGVmYXVsdEVuY29kaW5nID0gcHJvcGVydGllcy5kZWZhdWx0RW5jb2Rpbmc7CiAgICB0aGlzLnRvVW5pY29kZSA9IHByb3BlcnRpZXMudG9Vbmljb2RlOwogICAgdGhpcy50b0ZvbnRDaGFyID0gW107CiAgICBpZiAocHJvcGVydGllcy50eXBlID09PSAiVHlwZTMiKSB7CiAgICAgIGZvciAobGV0IGNoYXJDb2RlID0gMDsgY2hhckNvZGUgPCAyNTY7IGNoYXJDb2RlKyspIHsKICAgICAgICB0aGlzLnRvRm9udENoYXJbY2hhckNvZGVdID0gdGhpcy5kaWZmZXJlbmNlc1tjaGFyQ29kZV0gfHwgcHJvcGVydGllcy5kZWZhdWx0RW5jb2RpbmdbY2hhckNvZGVdOwogICAgICB9CiAgICAgIHJldHVybjsKICAgIH0KICAgIHRoaXMuY2lkRW5jb2RpbmcgPSBwcm9wZXJ0aWVzLmNpZEVuY29kaW5nIHx8ICIiOwogICAgdGhpcy52ZXJ0aWNhbCA9ICEhcHJvcGVydGllcy52ZXJ0aWNhbDsKICAgIGlmICh0aGlzLnZlcnRpY2FsKSB7CiAgICAgIHRoaXMudm1ldHJpY3MgPSBwcm9wZXJ0aWVzLnZtZXRyaWNzOwogICAgICB0aGlzLmRlZmF1bHRWTWV0cmljcyA9IHByb3BlcnRpZXMuZGVmYXVsdFZNZXRyaWNzOwogICAgfQogICAgaWYgKCFmaWxlIHx8IGZpbGUuaXNFbXB0eSkgewogICAgICBpZiAoZmlsZSkgewogICAgICAgICgwLCBfdXRpbC53YXJuKSgnRm9udCBmaWxlIGlzIGVtcHR5IGluICInICsgbmFtZSArICciICgnICsgdGhpcy5sb2FkZWROYW1lICsgIikiKTsKICAgICAgfQogICAgICB0aGlzLmZhbGxiYWNrVG9TeXN0ZW1Gb250KHByb3BlcnRpZXMpOwogICAgICByZXR1cm47CiAgICB9CiAgICBbdHlwZSwgc3VidHlwZV0gPSBnZXRGb250RmlsZVR5cGUoZmlsZSwgcHJvcGVydGllcyk7CiAgICBpZiAodHlwZSAhPT0gdGhpcy50eXBlIHx8IHN1YnR5cGUgIT09IHRoaXMuc3VidHlwZSkgewogICAgICAoMCwgX3V0aWwuaW5mbykoIkluY29uc2lzdGVudCBmb250IGZpbGUgVHlwZS9TdWJUeXBlLCBleHBlY3RlZDogIiArIGAke3RoaXMudHlwZX0vJHt0aGlzLnN1YnR5cGV9IGJ1dCBmb3VuZDogJHt0eXBlfS8ke3N1YnR5cGV9LmApOwogICAgfQogICAgbGV0IGRhdGE7CiAgICB0cnkgewogICAgICBzd2l0Y2ggKHR5cGUpIHsKICAgICAgICBjYXNlICJNTVR5cGUxIjoKICAgICAgICAgICgwLCBfdXRpbC5pbmZvKSgiTU1UeXBlMSBmb250ICgiICsgbmFtZSArICIpLCBmYWxsaW5nIGJhY2sgdG8gVHlwZTEuIik7CiAgICAgICAgY2FzZSAiVHlwZTEiOgogICAgICAgIGNhc2UgIkNJREZvbnRUeXBlMCI6CiAgICAgICAgICB0aGlzLm1pbWV0eXBlID0gImZvbnQvb3BlbnR5cGUiOwogICAgICAgICAgY29uc3QgY2ZmID0gc3VidHlwZSA9PT0gIlR5cGUxQyIgfHwgc3VidHlwZSA9PT0gIkNJREZvbnRUeXBlMEMiID8gbmV3IF9jZmZfZm9udC5DRkZGb250KGZpbGUsIHByb3BlcnRpZXMpIDogbmV3IF90eXBlMV9mb250LlR5cGUxRm9udChuYW1lLCBmaWxlLCBwcm9wZXJ0aWVzKTsKICAgICAgICAgIGFkanVzdFdpZHRocyhwcm9wZXJ0aWVzKTsKICAgICAgICAgIGRhdGEgPSB0aGlzLmNvbnZlcnQobmFtZSwgY2ZmLCBwcm9wZXJ0aWVzKTsKICAgICAgICAgIGJyZWFrOwogICAgICAgIGNhc2UgIk9wZW5UeXBlIjoKICAgICAgICBjYXNlICJUcnVlVHlwZSI6CiAgICAgICAgY2FzZSAiQ0lERm9udFR5cGUyIjoKICAgICAgICAgIHRoaXMubWltZXR5cGUgPSAiZm9udC9vcGVudHlwZSI7CiAgICAgICAgICBkYXRhID0gdGhpcy5jaGVja0FuZFJlcGFpcihuYW1lLCBmaWxlLCBwcm9wZXJ0aWVzKTsKICAgICAgICAgIGlmICh0aGlzLmlzT3BlblR5cGUpIHsKICAgICAgICAgICAgYWRqdXN0V2lkdGhzKHByb3BlcnRpZXMpOwogICAgICAgICAgICB0eXBlID0gIk9wZW5UeXBlIjsKICAgICAgICAgIH0KICAgICAgICAgIGJyZWFrOwogICAgICAgIGRlZmF1bHQ6CiAgICAgICAgICB0aHJvdyBuZXcgX3V0aWwuRm9ybWF0RXJyb3IoYEZvbnQgJHt0eXBlfSBpcyBub3Qgc3VwcG9ydGVkYCk7CiAgICAgIH0KICAgIH0gY2F0Y2ggKGUpIHsKICAgICAgKDAsIF91dGlsLndhcm4pKGUpOwogICAgICB0aGlzLmZhbGxiYWNrVG9TeXN0ZW1Gb250KHByb3BlcnRpZXMpOwogICAgICByZXR1cm47CiAgICB9CiAgICBhbWVuZEZhbGxiYWNrVG9Vbmljb2RlKHByb3BlcnRpZXMpOwogICAgdGhpcy5kYXRhID0gZGF0YTsKICAgIHRoaXMudHlwZSA9IHR5cGU7CiAgICB0aGlzLnN1YnR5cGUgPSBzdWJ0eXBlOwogICAgdGhpcy5mb250TWF0cml4ID0gcHJvcGVydGllcy5mb250TWF0cml4OwogICAgdGhpcy53aWR0aHMgPSBwcm9wZXJ0aWVzLndpZHRoczsKICAgIHRoaXMuZGVmYXVsdFdpZHRoID0gcHJvcGVydGllcy5kZWZhdWx0V2lkdGg7CiAgICB0aGlzLnRvVW5pY29kZSA9IHByb3BlcnRpZXMudG9Vbmljb2RlOwogICAgdGhpcy5zZWFjTWFwID0gcHJvcGVydGllcy5zZWFjTWFwOwogIH0KICBnZXQgcmVuZGVyZXIoKSB7CiAgICBjb25zdCByZW5kZXJlciA9IF9mb250X3JlbmRlcmVyLkZvbnRSZW5kZXJlckZhY3RvcnkuY3JlYXRlKHRoaXMsIF9mb250c191dGlscy5TRUFDX0FOQUxZU0lTX0VOQUJMRUQpOwogICAgcmV0dXJuICgwLCBfdXRpbC5zaGFkb3cpKHRoaXMsICJyZW5kZXJlciIsIHJlbmRlcmVyKTsKICB9CiAgZXhwb3J0RGF0YShleHRyYVByb3BlcnRpZXMgPSBmYWxzZSkgewogICAgY29uc3QgZXhwb3J0RGF0YVByb3BlcnRpZXMgPSBleHRyYVByb3BlcnRpZXMgPyBbLi4uRVhQT1JUX0RBVEFfUFJPUEVSVElFUywgLi4uRVhQT1JUX0RBVEFfRVhUUkFfUFJPUEVSVElFU10gOiBFWFBPUlRfREFUQV9QUk9QRVJUSUVTOwogICAgY29uc3QgZGF0YSA9IE9iamVjdC5jcmVhdGUobnVsbCk7CiAgICBsZXQgcHJvcGVydHksIHZhbHVlOwogICAgZm9yIChwcm9wZXJ0eSBvZiBleHBvcnREYXRhUHJvcGVydGllcykgewogICAgICB2YWx1ZSA9IHRoaXNbcHJvcGVydHldOwogICAgICBpZiAodmFsdWUgIT09IHVuZGVmaW5lZCkgewogICAgICAgIGRhdGFbcHJvcGVydHldID0gdmFsdWU7CiAgICAgIH0KICAgIH0KICAgIHJldHVybiBkYXRhOwogIH0KICBmYWxsYmFja1RvU3lzdGVtRm9udChwcm9wZXJ0aWVzKSB7CiAgICB0aGlzLm1pc3NpbmdGaWxlID0gdHJ1ZTsKICAgIGNvbnN0IHsKICAgICAgbmFtZSwKICAgICAgdHlwZQogICAgfSA9IHRoaXM7CiAgICBsZXQgZm9udE5hbWUgPSAoMCwgX2ZvbnRzX3V0aWxzLm5vcm1hbGl6ZUZvbnROYW1lKShuYW1lKTsKICAgIGNvbnN0IHN0ZEZvbnRNYXAgPSAoMCwgX3N0YW5kYXJkX2ZvbnRzLmdldFN0ZEZvbnRNYXApKCksCiAgICAgIG5vblN0ZEZvbnRNYXAgPSAoMCwgX3N0YW5kYXJkX2ZvbnRzLmdldE5vblN0ZEZvbnRNYXApKCk7CiAgICBjb25zdCBpc1N0YW5kYXJkRm9udCA9ICEhc3RkRm9udE1hcFtmb250TmFtZV07CiAgICBjb25zdCBpc01hcHBlZFRvU3RhbmRhcmRGb250ID0gISEobm9uU3RkRm9udE1hcFtmb250TmFtZV0gJiYgc3RkRm9udE1hcFtub25TdGRGb250TWFwW2ZvbnROYW1lXV0pOwogICAgZm9udE5hbWUgPSBzdGRGb250TWFwW2ZvbnROYW1lXSB8fCBub25TdGRGb250TWFwW2ZvbnROYW1lXSB8fCBmb250TmFtZTsKICAgIGNvbnN0IGZvbnRCYXNpY01ldHJpY3NNYXAgPSAoMCwgX21ldHJpY3MuZ2V0Rm9udEJhc2ljTWV0cmljcykoKTsKICAgIGNvbnN0IG1ldHJpY3MgPSBmb250QmFzaWNNZXRyaWNzTWFwW2ZvbnROYW1lXTsKICAgIGlmIChtZXRyaWNzKSB7CiAgICAgIGlmIChpc05hTih0aGlzLmFzY2VudCkpIHsKICAgICAgICB0aGlzLmFzY2VudCA9IG1ldHJpY3MuYXNjZW50IC8gUERGX0dMWVBIX1NQQUNFX1VOSVRTOwogICAgICB9CiAgICAgIGlmIChpc05hTih0aGlzLmRlc2NlbnQpKSB7CiAgICAgICAgdGhpcy5kZXNjZW50ID0gbWV0cmljcy5kZXNjZW50IC8gUERGX0dMWVBIX1NQQUNFX1VOSVRTOwogICAgICB9CiAgICAgIGlmIChpc05hTih0aGlzLmNhcEhlaWdodCkpIHsKICAgICAgICB0aGlzLmNhcEhlaWdodCA9IG1ldHJpY3MuY2FwSGVpZ2h0IC8gUERGX0dMWVBIX1NQQUNFX1VOSVRTOwogICAgICB9CiAgICB9CiAgICB0aGlzLmJvbGQgPSAvYm9sZC9naS50ZXN0KGZvbnROYW1lKTsKICAgIHRoaXMuaXRhbGljID0gL29ibGlxdWV8aXRhbGljL2dpLnRlc3QoZm9udE5hbWUpOwogICAgdGhpcy5ibGFjayA9IC9CbGFjay9nLnRlc3QobmFtZSk7CiAgICBjb25zdCBpc05hcnJvdyA9IC9OYXJyb3cvZy50ZXN0KG5hbWUpOwogICAgdGhpcy5yZW1lYXN1cmUgPSAoIWlzU3RhbmRhcmRGb250IHx8IGlzTmFycm93KSAmJiBPYmplY3Qua2V5cyh0aGlzLndpZHRocykubGVuZ3RoID4gMDsKICAgIGlmICgoaXNTdGFuZGFyZEZvbnQgfHwgaXNNYXBwZWRUb1N0YW5kYXJkRm9udCkgJiYgdHlwZSA9PT0gIkNJREZvbnRUeXBlMiIgJiYgdGhpcy5jaWRFbmNvZGluZy5zdGFydHNXaXRoKCJJZGVudGl0eS0iKSkgewogICAgICBjb25zdCBjaWRUb0dpZE1hcCA9IHByb3BlcnRpZXMuY2lkVG9HaWRNYXA7CiAgICAgIGNvbnN0IG1hcCA9IFtdOwogICAgICBhcHBseVN0YW5kYXJkRm9udEdseXBoTWFwKG1hcCwgKDAsIF9zdGFuZGFyZF9mb250cy5nZXRHbHlwaE1hcEZvclN0YW5kYXJkRm9udHMpKCkpOwogICAgICBpZiAoL0FyaWFsLT9CbGFjay9pLnRlc3QobmFtZSkpIHsKICAgICAgICBhcHBseVN0YW5kYXJkRm9udEdseXBoTWFwKG1hcCwgKDAsIF9zdGFuZGFyZF9mb250cy5nZXRTdXBwbGVtZW50YWxHbHlwaE1hcEZvckFyaWFsQmxhY2spKCkpOwogICAgICB9IGVsc2UgaWYgKC9DYWxpYnJpL2kudGVzdChuYW1lKSkgewogICAgICAgIGFwcGx5U3RhbmRhcmRGb250R2x5cGhNYXAobWFwLCAoMCwgX3N0YW5kYXJkX2ZvbnRzLmdldFN1cHBsZW1lbnRhbEdseXBoTWFwRm9yQ2FsaWJyaSkoKSk7CiAgICAgIH0KICAgICAgaWYgKGNpZFRvR2lkTWFwKSB7CiAgICAgICAgZm9yIChjb25zdCBjaGFyQ29kZSBpbiBtYXApIHsKICAgICAgICAgIGNvbnN0IGNpZCA9IG1hcFtjaGFyQ29kZV07CiAgICAgICAgICBpZiAoY2lkVG9HaWRNYXBbY2lkXSAhPT0gdW5kZWZpbmVkKSB7CiAgICAgICAgICAgIG1hcFsrY2hhckNvZGVdID0gY2lkVG9HaWRNYXBbY2lkXTsKICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgaWYgKGNpZFRvR2lkTWFwLmxlbmd0aCAhPT0gdGhpcy50b1VuaWNvZGUubGVuZ3RoICYmIHByb3BlcnRpZXMuaGFzSW5jbHVkZWRUb1VuaWNvZGVNYXAgJiYgdGhpcy50b1VuaWNvZGUgaW5zdGFuY2VvZiBfdG9fdW5pY29kZV9tYXAuSWRlbnRpdHlUb1VuaWNvZGVNYXApIHsKICAgICAgICAgIHRoaXMudG9Vbmljb2RlLmZvckVhY2goZnVuY3Rpb24gKGNoYXJDb2RlLCB1bmljb2RlQ2hhckNvZGUpIHsKICAgICAgICAgICAgY29uc3QgY2lkID0gbWFwW2NoYXJDb2RlXTsKICAgICAgICAgICAgaWYgKGNpZFRvR2lkTWFwW2NpZF0gPT09IHVuZGVmaW5lZCkgewogICAgICAgICAgICAgIG1hcFsrY2hhckNvZGVdID0gdW5pY29kZUNoYXJDb2RlOwogICAgICAgICAgICB9CiAgICAgICAgICB9KTsKICAgICAgICB9CiAgICAgIH0KICAgICAgaWYgKCEodGhpcy50b1VuaWNvZGUgaW5zdGFuY2VvZiBfdG9fdW5pY29kZV9tYXAuSWRlbnRpdHlUb1VuaWNvZGVNYXApKSB7CiAgICAgICAgdGhpcy50b1VuaWNvZGUuZm9yRWFjaChmdW5jdGlvbiAoY2hhckNvZGUsIHVuaWNvZGVDaGFyQ29kZSkgewogICAgICAgICAgbWFwWytjaGFyQ29kZV0gPSB1bmljb2RlQ2hhckNvZGU7CiAgICAgICAgfSk7CiAgICAgIH0KICAgICAgdGhpcy50b0ZvbnRDaGFyID0gbWFwOwogICAgICB0aGlzLnRvVW5pY29kZSA9IG5ldyBfdG9fdW5pY29kZV9tYXAuVG9Vbmljb2RlTWFwKG1hcCk7CiAgICB9IGVsc2UgaWYgKC9TeW1ib2wvaS50ZXN0KGZvbnROYW1lKSkgewogICAgICB0aGlzLnRvRm9udENoYXIgPSBidWlsZFRvRm9udENoYXIoX2VuY29kaW5ncy5TeW1ib2xTZXRFbmNvZGluZywgKDAsIF9nbHlwaGxpc3QuZ2V0R2x5cGhzVW5pY29kZSkoKSwgdGhpcy5kaWZmZXJlbmNlcyk7CiAgICB9IGVsc2UgaWYgKC9EaW5nYmF0cy9pLnRlc3QoZm9udE5hbWUpKSB7CiAgICAgIHRoaXMudG9Gb250Q2hhciA9IGJ1aWxkVG9Gb250Q2hhcihfZW5jb2RpbmdzLlphcGZEaW5nYmF0c0VuY29kaW5nLCAoMCwgX2dseXBobGlzdC5nZXREaW5nYmF0c0dseXBoc1VuaWNvZGUpKCksIHRoaXMuZGlmZmVyZW5jZXMpOwogICAgfSBlbHNlIGlmIChpc1N0YW5kYXJkRm9udCkgewogICAgICBjb25zdCBtYXAgPSBidWlsZFRvRm9udENoYXIodGhpcy5kZWZhdWx0RW5jb2RpbmcsICgwLCBfZ2x5cGhsaXN0LmdldEdseXBoc1VuaWNvZGUpKCksIHRoaXMuZGlmZmVyZW5jZXMpOwogICAgICBpZiAodHlwZSA9PT0gIkNJREZvbnRUeXBlMiIgJiYgIXRoaXMuY2lkRW5jb2Rpbmcuc3RhcnRzV2l0aCgiSWRlbnRpdHktIikgJiYgISh0aGlzLnRvVW5pY29kZSBpbnN0YW5jZW9mIF90b191bmljb2RlX21hcC5JZGVudGl0eVRvVW5pY29kZU1hcCkpIHsKICAgICAgICB0aGlzLnRvVW5pY29kZS5mb3JFYWNoKGZ1bmN0aW9uIChjaGFyQ29kZSwgdW5pY29kZUNoYXJDb2RlKSB7CiAgICAgICAgICBtYXBbK2NoYXJDb2RlXSA9IHVuaWNvZGVDaGFyQ29kZTsKICAgICAgICB9KTsKICAgICAgfQogICAgICB0aGlzLnRvRm9udENoYXIgPSBtYXA7CiAgICB9IGVsc2UgewogICAgICBjb25zdCBnbHlwaHNVbmljb2RlTWFwID0gKDAsIF9nbHlwaGxpc3QuZ2V0R2x5cGhzVW5pY29kZSkoKTsKICAgICAgY29uc3QgbWFwID0gW107CiAgICAgIHRoaXMudG9Vbmljb2RlLmZvckVhY2goKGNoYXJDb2RlLCB1bmljb2RlQ2hhckNvZGUpID0+IHsKICAgICAgICBpZiAoIXRoaXMuY29tcG9zaXRlKSB7CiAgICAgICAgICBjb25zdCBnbHlwaE5hbWUgPSB0aGlzLmRpZmZlcmVuY2VzW2NoYXJDb2RlXSB8fCB0aGlzLmRlZmF1bHRFbmNvZGluZ1tjaGFyQ29kZV07CiAgICAgICAgICBjb25zdCB1bmljb2RlID0gKDAsIF91bmljb2RlLmdldFVuaWNvZGVGb3JHbHlwaCkoZ2x5cGhOYW1lLCBnbHlwaHNVbmljb2RlTWFwKTsKICAgICAgICAgIGlmICh1bmljb2RlICE9PSAtMSkgewogICAgICAgICAgICB1bmljb2RlQ2hhckNvZGUgPSB1bmljb2RlOwogICAgICAgICAgfQogICAgICAgIH0KICAgICAgICBtYXBbK2NoYXJDb2RlXSA9IHVuaWNvZGVDaGFyQ29kZTsKICAgICAgfSk7CiAgICAgIGlmICh0aGlzLmNvbXBvc2l0ZSAmJiB0aGlzLnRvVW5pY29kZSBpbnN0YW5jZW9mIF90b191bmljb2RlX21hcC5JZGVudGl0eVRvVW5pY29kZU1hcCkgewogICAgICAgIGlmICgvVGFob21hfFZlcmRhbmEvaS50ZXN0KG5hbWUpKSB7CiAgICAgICAgICBhcHBseVN0YW5kYXJkRm9udEdseXBoTWFwKG1hcCwgKDAsIF9zdGFuZGFyZF9mb250cy5nZXRHbHlwaE1hcEZvclN0YW5kYXJkRm9udHMpKCkpOwogICAgICAgIH0KICAgICAgfQogICAgICB0aGlzLnRvRm9udENoYXIgPSBtYXA7CiAgICB9CiAgICBhbWVuZEZhbGxiYWNrVG9Vbmljb2RlKHByb3BlcnRpZXMpOwogICAgdGhpcy5sb2FkZWROYW1lID0gZm9udE5hbWUuc3BsaXQoIi0iKVswXTsKICB9CiAgY2hlY2tBbmRSZXBhaXIobmFtZSwgZm9udCwgcHJvcGVydGllcykgewogICAgY29uc3QgVkFMSURfVEFCTEVTID0gWyJPUy8yIiwgImNtYXAiLCAiaGVhZCIsICJoaGVhIiwgImhtdHgiLCAibWF4cCIsICJuYW1lIiwgInBvc3QiLCAibG9jYSIsICJnbHlmIiwgImZwZ20iLCAicHJlcCIsICJjdnQgIiwgIkNGRiAiXTsKICAgIGZ1bmN0aW9uIHJlYWRUYWJsZXMoZmlsZSwgbnVtVGFibGVzKSB7CiAgICAgIGNvbnN0IHRhYmxlcyA9IE9iamVjdC5jcmVhdGUobnVsbCk7CiAgICAgIHRhYmxlc1siT1MvMiJdID0gbnVsbDsKICAgICAgdGFibGVzLmNtYXAgPSBudWxsOwogICAgICB0YWJsZXMuaGVhZCA9IG51bGw7CiAgICAgIHRhYmxlcy5oaGVhID0gbnVsbDsKICAgICAgdGFibGVzLmhtdHggPSBudWxsOwogICAgICB0YWJsZXMubWF4cCA9IG51bGw7CiAgICAgIHRhYmxlcy5uYW1lID0gbnVsbDsKICAgICAgdGFibGVzLnBvc3QgPSBudWxsOwogICAgICBmb3IgKGxldCBpID0gMDsgaSA8IG51bVRhYmxlczsgaSsrKSB7CiAgICAgICAgY29uc3QgdGFibGUgPSByZWFkVGFibGVFbnRyeShmaWxlKTsKICAgICAgICBpZiAoIVZBTElEX1RBQkxFUy5pbmNsdWRlcyh0YWJsZS50YWcpKSB7CiAgICAgICAgICBjb250aW51ZTsKICAgICAgICB9CiAgICAgICAgaWYgKHRhYmxlLmxlbmd0aCA9PT0gMCkgewogICAgICAgICAgY29udGludWU7CiAgICAgICAgfQogICAgICAgIHRhYmxlc1t0YWJsZS50YWddID0gdGFibGU7CiAgICAgIH0KICAgICAgcmV0dXJuIHRhYmxlczsKICAgIH0KICAgIGZ1bmN0aW9uIHJlYWRUYWJsZUVudHJ5KGZpbGUpIHsKICAgICAgY29uc3QgdGFnID0gZmlsZS5nZXRTdHJpbmcoNCk7CiAgICAgIGNvbnN0IGNoZWNrc3VtID0gZmlsZS5nZXRJbnQzMigpID4+PiAwOwogICAgICBjb25zdCBvZmZzZXQgPSBmaWxlLmdldEludDMyKCkgPj4+IDA7CiAgICAgIGNvbnN0IGxlbmd0aCA9IGZpbGUuZ2V0SW50MzIoKSA+Pj4gMDsKICAgICAgY29uc3QgcHJldmlvdXNQb3NpdGlvbiA9IGZpbGUucG9zOwogICAgICBmaWxlLnBvcyA9IGZpbGUuc3RhcnQgfHwgMDsKICAgICAgZmlsZS5za2lwKG9mZnNldCk7CiAgICAgIGNvbnN0IGRhdGEgPSBmaWxlLmdldEJ5dGVzKGxlbmd0aCk7CiAgICAgIGZpbGUucG9zID0gcHJldmlvdXNQb3NpdGlvbjsKICAgICAgaWYgKHRhZyA9PT0gImhlYWQiKSB7CiAgICAgICAgZGF0YVs4XSA9IGRhdGFbOV0gPSBkYXRhWzEwXSA9IGRhdGFbMTFdID0gMDsKICAgICAgICBkYXRhWzE3XSB8PSAweDIwOwogICAgICB9CiAgICAgIHJldHVybiB7CiAgICAgICAgdGFnLAogICAgICAgIGNoZWNrc3VtLAogICAgICAgIGxlbmd0aCwKICAgICAgICBvZmZzZXQsCiAgICAgICAgZGF0YQogICAgICB9OwogICAgfQogICAgZnVuY3Rpb24gcmVhZE9wZW5UeXBlSGVhZGVyKHR0ZikgewogICAgICByZXR1cm4gewogICAgICAgIHZlcnNpb246IHR0Zi5nZXRTdHJpbmcoNCksCiAgICAgICAgbnVtVGFibGVzOiB0dGYuZ2V0VWludDE2KCksCiAgICAgICAgc2VhcmNoUmFuZ2U6IHR0Zi5nZXRVaW50MTYoKSwKICAgICAgICBlbnRyeVNlbGVjdG9yOiB0dGYuZ2V0VWludDE2KCksCiAgICAgICAgcmFuZ2VTaGlmdDogdHRmLmdldFVpbnQxNigpCiAgICAgIH07CiAgICB9CiAgICBmdW5jdGlvbiByZWFkVHJ1ZVR5cGVDb2xsZWN0aW9uSGVhZGVyKHR0YykgewogICAgICBjb25zdCB0dGNUYWcgPSB0dGMuZ2V0U3RyaW5nKDQpOwogICAgICAoMCwgX3V0aWwuYXNzZXJ0KSh0dGNUYWcgPT09ICJ0dGNmIiwgIk11c3QgYmUgYSBUcnVlVHlwZSBDb2xsZWN0aW9uIGZvbnQuIik7CiAgICAgIGNvbnN0IG1ham9yVmVyc2lvbiA9IHR0Yy5nZXRVaW50MTYoKTsKICAgICAgY29uc3QgbWlub3JWZXJzaW9uID0gdHRjLmdldFVpbnQxNigpOwogICAgICBjb25zdCBudW1Gb250cyA9IHR0Yy5nZXRJbnQzMigpID4+PiAwOwogICAgICBjb25zdCBvZmZzZXRUYWJsZSA9IFtdOwogICAgICBmb3IgKGxldCBpID0gMDsgaSA8IG51bUZvbnRzOyBpKyspIHsKICAgICAgICBvZmZzZXRUYWJsZS5wdXNoKHR0Yy5nZXRJbnQzMigpID4+PiAwKTsKICAgICAgfQogICAgICBjb25zdCBoZWFkZXIgPSB7CiAgICAgICAgdHRjVGFnLAogICAgICAgIG1ham9yVmVyc2lvbiwKICAgICAgICBtaW5vclZlcnNpb24sCiAgICAgICAgbnVtRm9udHMsCiAgICAgICAgb2Zmc2V0VGFibGUKICAgICAgfTsKICAgICAgc3dpdGNoIChtYWpvclZlcnNpb24pIHsKICAgICAgICBjYXNlIDE6CiAgICAgICAgICByZXR1cm4gaGVhZGVyOwogICAgICAgIGNhc2UgMjoKICAgICAgICAgIGhlYWRlci5kc2lnVGFnID0gdHRjLmdldEludDMyKCkgPj4+IDA7CiAgICAgICAgICBoZWFkZXIuZHNpZ0xlbmd0aCA9IHR0Yy5nZXRJbnQzMigpID4+PiAwOwogICAgICAgICAgaGVhZGVyLmRzaWdPZmZzZXQgPSB0dGMuZ2V0SW50MzIoKSA+Pj4gMDsKICAgICAgICAgIHJldHVybiBoZWFkZXI7CiAgICAgIH0KICAgICAgdGhyb3cgbmV3IF91dGlsLkZvcm1hdEVycm9yKGBJbnZhbGlkIFRydWVUeXBlIENvbGxlY3Rpb24gbWFqb3JWZXJzaW9uOiAke21ham9yVmVyc2lvbn0uYCk7CiAgICB9CiAgICBmdW5jdGlvbiByZWFkVHJ1ZVR5cGVDb2xsZWN0aW9uRGF0YSh0dGMsIGZvbnROYW1lKSB7CiAgICAgIGNvbnN0IHsKICAgICAgICBudW1Gb250cywKICAgICAgICBvZmZzZXRUYWJsZQogICAgICB9ID0gcmVhZFRydWVUeXBlQ29sbGVjdGlvbkhlYWRlcih0dGMpOwogICAgICBjb25zdCBmb250TmFtZVBhcnRzID0gZm9udE5hbWUuc3BsaXQoIisiKTsKICAgICAgbGV0IGZhbGxiYWNrRGF0YTsKICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCBudW1Gb250czsgaSsrKSB7CiAgICAgICAgdHRjLnBvcyA9ICh0dGMuc3RhcnQgfHwgMCkgKyBvZmZzZXRUYWJsZVtpXTsKICAgICAgICBjb25zdCBwb3RlbnRpYWxIZWFkZXIgPSByZWFkT3BlblR5cGVIZWFkZXIodHRjKTsKICAgICAgICBjb25zdCBwb3RlbnRpYWxUYWJsZXMgPSByZWFkVGFibGVzKHR0YywgcG90ZW50aWFsSGVhZGVyLm51bVRhYmxlcyk7CiAgICAgICAgaWYgKCFwb3RlbnRpYWxUYWJsZXMubmFtZSkgewogICAgICAgICAgdGhyb3cgbmV3IF91dGlsLkZvcm1hdEVycm9yKCdUcnVlVHlwZSBDb2xsZWN0aW9uIGZvbnQgbXVzdCBjb250YWluIGEgIm5hbWUiIHRhYmxlLicpOwogICAgICAgIH0KICAgICAgICBjb25zdCBbbmFtZVRhYmxlXSA9IHJlYWROYW1lVGFibGUocG90ZW50aWFsVGFibGVzLm5hbWUpOwogICAgICAgIGZvciAobGV0IGogPSAwLCBqaiA9IG5hbWVUYWJsZS5sZW5ndGg7IGogPCBqajsgaisrKSB7CiAgICAgICAgICBmb3IgKGxldCBrID0gMCwga2sgPSBuYW1lVGFibGVbal0ubGVuZ3RoOyBrIDwga2s7IGsrKykgewogICAgICAgICAgICBjb25zdCBuYW1lRW50cnkgPSBuYW1lVGFibGVbal1ba10/LnJlcGxhY2VBbGwoL1xzL2csICIiKTsKICAgICAgICAgICAgaWYgKCFuYW1lRW50cnkpIHsKICAgICAgICAgICAgICBjb250aW51ZTsKICAgICAgICAgICAgfQogICAgICAgICAgICBpZiAobmFtZUVudHJ5ID09PSBmb250TmFtZSkgewogICAgICAgICAgICAgIHJldHVybiB7CiAgICAgICAgICAgICAgICBoZWFkZXI6IHBvdGVudGlhbEhlYWRlciwKICAgICAgICAgICAgICAgIHRhYmxlczogcG90ZW50aWFsVGFibGVzCiAgICAgICAgICAgICAgfTsKICAgICAgICAgICAgfQogICAgICAgICAgICBpZiAoZm9udE5hbWVQYXJ0cy5sZW5ndGggPCAyKSB7CiAgICAgICAgICAgICAgY29udGludWU7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgZm9yIChjb25zdCBwYXJ0IG9mIGZvbnROYW1lUGFydHMpIHsKICAgICAgICAgICAgICBpZiAobmFtZUVudHJ5ID09PSBwYXJ0KSB7CiAgICAgICAgICAgICAgICBmYWxsYmFja0RhdGEgPSB7CiAgICAgICAgICAgICAgICAgIG5hbWU6IHBhcnQsCiAgICAgICAgICAgICAgICAgIGhlYWRlcjogcG90ZW50aWFsSGVhZGVyLAogICAgICAgICAgICAgICAgICB0YWJsZXM6IHBvdGVudGlhbFRhYmxlcwogICAgICAgICAgICAgICAgfTsKICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICB9CiAgICAgIH0KICAgICAgaWYgKGZhbGxiYWNrRGF0YSkgewogICAgICAgICgwLCBfdXRpbC53YXJuKShgVHJ1ZVR5cGUgQ29sbGVjdGlvbiBkb2VzIG5vdCBjb250YWluICIke2ZvbnROYW1lfSIgZm9udCwgYCArIGBmYWxsaW5nIGJhY2sgdG8gIiR7ZmFsbGJhY2tEYXRhLm5hbWV9IiBmb250IGluc3RlYWQuYCk7CiAgICAgICAgcmV0dXJuIHsKICAgICAgICAgIGhlYWRlcjogZmFsbGJhY2tEYXRhLmhlYWRlciwKICAgICAgICAgIHRhYmxlczogZmFsbGJhY2tEYXRhLnRhYmxlcwogICAgICAgIH07CiAgICAgIH0KICAgICAgdGhyb3cgbmV3IF91dGlsLkZvcm1hdEVycm9yKGBUcnVlVHlwZSBDb2xsZWN0aW9uIGRvZXMgbm90IGNvbnRhaW4gIiR7Zm9udE5hbWV9IiBmb250LmApOwogICAgfQogICAgZnVuY3Rpb24gcmVhZENtYXBUYWJsZShjbWFwLCBmaWxlLCBpc1N5bWJvbGljRm9udCwgaGFzRW5jb2RpbmcpIHsKICAgICAgaWYgKCFjbWFwKSB7CiAgICAgICAgKDAsIF91dGlsLndhcm4pKCJObyBjbWFwIHRhYmxlIGF2YWlsYWJsZS4iKTsKICAgICAgICByZXR1cm4gewogICAgICAgICAgcGxhdGZvcm1JZDogLTEsCiAgICAgICAgICBlbmNvZGluZ0lkOiAtMSwKICAgICAgICAgIG1hcHBpbmdzOiBbXSwKICAgICAgICAgIGhhc1Nob3J0Q21hcDogZmFsc2UKICAgICAgICB9OwogICAgICB9CiAgICAgIGxldCBzZWdtZW50OwogICAgICBsZXQgc3RhcnQgPSAoZmlsZS5zdGFydCB8fCAwKSArIGNtYXAub2Zmc2V0OwogICAgICBmaWxlLnBvcyA9IHN0YXJ0OwogICAgICBmaWxlLnNraXAoMik7CiAgICAgIGNvbnN0IG51bVRhYmxlcyA9IGZpbGUuZ2V0VWludDE2KCk7CiAgICAgIGxldCBwb3RlbnRpYWxUYWJsZTsKICAgICAgbGV0IGNhbkJyZWFrID0gZmFsc2U7CiAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgbnVtVGFibGVzOyBpKyspIHsKICAgICAgICBjb25zdCBwbGF0Zm9ybUlkID0gZmlsZS5nZXRVaW50MTYoKTsKICAgICAgICBjb25zdCBlbmNvZGluZ0lkID0gZmlsZS5nZXRVaW50MTYoKTsKICAgICAgICBjb25zdCBvZmZzZXQgPSBmaWxlLmdldEludDMyKCkgPj4+IDA7CiAgICAgICAgbGV0IHVzZVRhYmxlID0gZmFsc2U7CiAgICAgICAgaWYgKHBvdGVudGlhbFRhYmxlPy5wbGF0Zm9ybUlkID09PSBwbGF0Zm9ybUlkICYmIHBvdGVudGlhbFRhYmxlPy5lbmNvZGluZ0lkID09PSBlbmNvZGluZ0lkKSB7CiAgICAgICAgICBjb250aW51ZTsKICAgICAgICB9CiAgICAgICAgaWYgKHBsYXRmb3JtSWQgPT09IDAgJiYgKGVuY29kaW5nSWQgPT09IDAgfHwgZW5jb2RpbmdJZCA9PT0gMSB8fCBlbmNvZGluZ0lkID09PSAzKSkgewogICAgICAgICAgdXNlVGFibGUgPSB0cnVlOwogICAgICAgIH0gZWxzZSBpZiAocGxhdGZvcm1JZCA9PT0gMSAmJiBlbmNvZGluZ0lkID09PSAwKSB7CiAgICAgICAgICB1c2VUYWJsZSA9IHRydWU7CiAgICAgICAgfSBlbHNlIGlmIChwbGF0Zm9ybUlkID09PSAzICYmIGVuY29kaW5nSWQgPT09IDEgJiYgKGhhc0VuY29kaW5nIHx8ICFwb3RlbnRpYWxUYWJsZSkpIHsKICAgICAgICAgIHVzZVRhYmxlID0gdHJ1ZTsKICAgICAgICAgIGlmICghaXNTeW1ib2xpY0ZvbnQpIHsKICAgICAgICAgICAgY2FuQnJlYWsgPSB0cnVlOwogICAgICAgICAgfQogICAgICAgIH0gZWxzZSBpZiAoaXNTeW1ib2xpY0ZvbnQgJiYgcGxhdGZvcm1JZCA9PT0gMyAmJiBlbmNvZGluZ0lkID09PSAwKSB7CiAgICAgICAgICB1c2VUYWJsZSA9IHRydWU7CiAgICAgICAgICBsZXQgY29ycmVjdGx5U29ydGVkID0gdHJ1ZTsKICAgICAgICAgIGlmIChpIDwgbnVtVGFibGVzIC0gMSkgewogICAgICAgICAgICBjb25zdCBuZXh0Qnl0ZXMgPSBmaWxlLnBlZWtCeXRlcygyKSwKICAgICAgICAgICAgICBuZXh0UGxhdGZvcm1JZCA9IGludDE2KG5leHRCeXRlc1swXSwgbmV4dEJ5dGVzWzFdKTsKICAgICAgICAgICAgaWYgKG5leHRQbGF0Zm9ybUlkIDwgcGxhdGZvcm1JZCkgewogICAgICAgICAgICAgIGNvcnJlY3RseVNvcnRlZCA9IGZhbHNlOwogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgICBpZiAoY29ycmVjdGx5U29ydGVkKSB7CiAgICAgICAgICAgIGNhbkJyZWFrID0gdHJ1ZTsKICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgaWYgKHVzZVRhYmxlKSB7CiAgICAgICAgICBwb3RlbnRpYWxUYWJsZSA9IHsKICAgICAgICAgICAgcGxhdGZvcm1JZCwKICAgICAgICAgICAgZW5jb2RpbmdJZCwKICAgICAgICAgICAgb2Zmc2V0CiAgICAgICAgICB9OwogICAgICAgIH0KICAgICAgICBpZiAoY2FuQnJlYWspIHsKICAgICAgICAgIGJyZWFrOwogICAgICAgIH0KICAgICAgfQogICAgICBpZiAocG90ZW50aWFsVGFibGUpIHsKICAgICAgICBmaWxlLnBvcyA9IHN0YXJ0ICsgcG90ZW50aWFsVGFibGUub2Zmc2V0OwogICAgICB9CiAgICAgIGlmICghcG90ZW50aWFsVGFibGUgfHwgZmlsZS5wZWVrQnl0ZSgpID09PSAtMSkgewogICAgICAgICgwLCBfdXRpbC53YXJuKSgiQ291bGQgbm90IGZpbmQgYSBwcmVmZXJyZWQgY21hcCB0YWJsZS4iKTsKICAgICAgICByZXR1cm4gewogICAgICAgICAgcGxhdGZvcm1JZDogLTEsCiAgICAgICAgICBlbmNvZGluZ0lkOiAtMSwKICAgICAgICAgIG1hcHBpbmdzOiBbXSwKICAgICAgICAgIGhhc1Nob3J0Q21hcDogZmFsc2UKICAgICAgICB9OwogICAgICB9CiAgICAgIGNvbnN0IGZvcm1hdCA9IGZpbGUuZ2V0VWludDE2KCk7CiAgICAgIGxldCBoYXNTaG9ydENtYXAgPSBmYWxzZTsKICAgICAgY29uc3QgbWFwcGluZ3MgPSBbXTsKICAgICAgbGV0IGosIGdseXBoSWQ7CiAgICAgIGlmIChmb3JtYXQgPT09IDApIHsKICAgICAgICBmaWxlLnNraXAoMiArIDIpOwogICAgICAgIGZvciAoaiA9IDA7IGogPCAyNTY7IGorKykgewogICAgICAgICAgY29uc3QgaW5kZXggPSBmaWxlLmdldEJ5dGUoKTsKICAgICAgICAgIGlmICghaW5kZXgpIHsKICAgICAgICAgICAgY29udGludWU7CiAgICAgICAgICB9CiAgICAgICAgICBtYXBwaW5ncy5wdXNoKHsKICAgICAgICAgICAgY2hhckNvZGU6IGosCiAgICAgICAgICAgIGdseXBoSWQ6IGluZGV4CiAgICAgICAgICB9KTsKICAgICAgICB9CiAgICAgICAgaGFzU2hvcnRDbWFwID0gdHJ1ZTsKICAgICAgfSBlbHNlIGlmIChmb3JtYXQgPT09IDIpIHsKICAgICAgICBmaWxlLnNraXAoMiArIDIpOwogICAgICAgIGNvbnN0IHN1YkhlYWRlcktleXMgPSBbXTsKICAgICAgICBsZXQgbWF4U3ViSGVhZGVyS2V5ID0gMDsKICAgICAgICBmb3IgKGxldCBpID0gMDsgaSA8IDI1NjsgaSsrKSB7CiAgICAgICAgICBjb25zdCBzdWJIZWFkZXJLZXkgPSBmaWxlLmdldFVpbnQxNigpID4+IDM7CiAgICAgICAgICBzdWJIZWFkZXJLZXlzLnB1c2goc3ViSGVhZGVyS2V5KTsKICAgICAgICAgIG1heFN1YkhlYWRlcktleSA9IE1hdGgubWF4KHN1YkhlYWRlcktleSwgbWF4U3ViSGVhZGVyS2V5KTsKICAgICAgICB9CiAgICAgICAgY29uc3Qgc3ViSGVhZGVycyA9IFtdOwogICAgICAgIGZvciAobGV0IGkgPSAwOyBpIDw9IG1heFN1YkhlYWRlcktleTsgaSsrKSB7CiAgICAgICAgICBzdWJIZWFkZXJzLnB1c2goewogICAgICAgICAgICBmaXJzdENvZGU6IGZpbGUuZ2V0VWludDE2KCksCiAgICAgICAgICAgIGVudHJ5Q291bnQ6IGZpbGUuZ2V0VWludDE2KCksCiAgICAgICAgICAgIGlkRGVsdGE6IHNpZ25lZEludDE2KGZpbGUuZ2V0Qnl0ZSgpLCBmaWxlLmdldEJ5dGUoKSksCiAgICAgICAgICAgIGlkUmFuZ2VQb3M6IGZpbGUucG9zICsgZmlsZS5nZXRVaW50MTYoKQogICAgICAgICAgfSk7CiAgICAgICAgfQogICAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgMjU2OyBpKyspIHsKICAgICAgICAgIGlmIChzdWJIZWFkZXJLZXlzW2ldID09PSAwKSB7CiAgICAgICAgICAgIGZpbGUucG9zID0gc3ViSGVhZGVyc1swXS5pZFJhbmdlUG9zICsgMiAqIGk7CiAgICAgICAgICAgIGdseXBoSWQgPSBmaWxlLmdldFVpbnQxNigpOwogICAgICAgICAgICBtYXBwaW5ncy5wdXNoKHsKICAgICAgICAgICAgICBjaGFyQ29kZTogaSwKICAgICAgICAgICAgICBnbHlwaElkCiAgICAgICAgICAgIH0pOwogICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgY29uc3QgcyA9IHN1YkhlYWRlcnNbc3ViSGVhZGVyS2V5c1tpXV07CiAgICAgICAgICAgIGZvciAoaiA9IDA7IGogPCBzLmVudHJ5Q291bnQ7IGorKykgewogICAgICAgICAgICAgIGNvbnN0IGNoYXJDb2RlID0gKGkgPDwgOCkgKyBqICsgcy5maXJzdENvZGU7CiAgICAgICAgICAgICAgZmlsZS5wb3MgPSBzLmlkUmFuZ2VQb3MgKyAyICogajsKICAgICAgICAgICAgICBnbHlwaElkID0gZmlsZS5nZXRVaW50MTYoKTsKICAgICAgICAgICAgICBpZiAoZ2x5cGhJZCAhPT0gMCkgewogICAgICAgICAgICAgICAgZ2x5cGhJZCA9IChnbHlwaElkICsgcy5pZERlbHRhKSAlIDY1NTM2OwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgICBtYXBwaW5ncy5wdXNoKHsKICAgICAgICAgICAgICAgIGNoYXJDb2RlLAogICAgICAgICAgICAgICAgZ2x5cGhJZAogICAgICAgICAgICAgIH0pOwogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICB9IGVsc2UgaWYgKGZvcm1hdCA9PT0gNCkgewogICAgICAgIGZpbGUuc2tpcCgyICsgMik7CiAgICAgICAgY29uc3Qgc2VnQ291bnQgPSBmaWxlLmdldFVpbnQxNigpID4+IDE7CiAgICAgICAgZmlsZS5za2lwKDYpOwogICAgICAgIGNvbnN0IHNlZ21lbnRzID0gW107CiAgICAgICAgbGV0IHNlZ0luZGV4OwogICAgICAgIGZvciAoc2VnSW5kZXggPSAwOyBzZWdJbmRleCA8IHNlZ0NvdW50OyBzZWdJbmRleCsrKSB7CiAgICAgICAgICBzZWdtZW50cy5wdXNoKHsKICAgICAgICAgICAgZW5kOiBmaWxlLmdldFVpbnQxNigpCiAgICAgICAgICB9KTsKICAgICAgICB9CiAgICAgICAgZmlsZS5za2lwKDIpOwogICAgICAgIGZvciAoc2VnSW5kZXggPSAwOyBzZWdJbmRleCA8IHNlZ0NvdW50OyBzZWdJbmRleCsrKSB7CiAgICAgICAgICBzZWdtZW50c1tzZWdJbmRleF0uc3RhcnQgPSBmaWxlLmdldFVpbnQxNigpOwogICAgICAgIH0KICAgICAgICBmb3IgKHNlZ0luZGV4ID0gMDsgc2VnSW5kZXggPCBzZWdDb3VudDsgc2VnSW5kZXgrKykgewogICAgICAgICAgc2VnbWVudHNbc2VnSW5kZXhdLmRlbHRhID0gZmlsZS5nZXRVaW50MTYoKTsKICAgICAgICB9CiAgICAgICAgbGV0IG9mZnNldHNDb3VudCA9IDAsCiAgICAgICAgICBvZmZzZXRJbmRleDsKICAgICAgICBmb3IgKHNlZ0luZGV4ID0gMDsgc2VnSW5kZXggPCBzZWdDb3VudDsgc2VnSW5kZXgrKykgewogICAgICAgICAgc2VnbWVudCA9IHNlZ21lbnRzW3NlZ0luZGV4XTsKICAgICAgICAgIGNvbnN0IHJhbmdlT2Zmc2V0ID0gZmlsZS5nZXRVaW50MTYoKTsKICAgICAgICAgIGlmICghcmFuZ2VPZmZzZXQpIHsKICAgICAgICAgICAgc2VnbWVudC5vZmZzZXRJbmRleCA9IC0xOwogICAgICAgICAgICBjb250aW51ZTsKICAgICAgICAgIH0KICAgICAgICAgIG9mZnNldEluZGV4ID0gKHJhbmdlT2Zmc2V0ID4+IDEpIC0gKHNlZ0NvdW50IC0gc2VnSW5kZXgpOwogICAgICAgICAgc2VnbWVudC5vZmZzZXRJbmRleCA9IG9mZnNldEluZGV4OwogICAgICAgICAgb2Zmc2V0c0NvdW50ID0gTWF0aC5tYXgob2Zmc2V0c0NvdW50LCBvZmZzZXRJbmRleCArIHNlZ21lbnQuZW5kIC0gc2VnbWVudC5zdGFydCArIDEpOwogICAgICAgIH0KICAgICAgICBjb25zdCBvZmZzZXRzID0gW107CiAgICAgICAgZm9yIChqID0gMDsgaiA8IG9mZnNldHNDb3VudDsgaisrKSB7CiAgICAgICAgICBvZmZzZXRzLnB1c2goZmlsZS5nZXRVaW50MTYoKSk7CiAgICAgICAgfQogICAgICAgIGZvciAoc2VnSW5kZXggPSAwOyBzZWdJbmRleCA8IHNlZ0NvdW50OyBzZWdJbmRleCsrKSB7CiAgICAgICAgICBzZWdtZW50ID0gc2VnbWVudHNbc2VnSW5kZXhdOwogICAgICAgICAgc3RhcnQgPSBzZWdtZW50LnN0YXJ0OwogICAgICAgICAgY29uc3QgZW5kID0gc2VnbWVudC5lbmQ7CiAgICAgICAgICBjb25zdCBkZWx0YSA9IHNlZ21lbnQuZGVsdGE7CiAgICAgICAgICBvZmZzZXRJbmRleCA9IHNlZ21lbnQub2Zmc2V0SW5kZXg7CiAgICAgICAgICBmb3IgKGogPSBzdGFydDsgaiA8PSBlbmQ7IGorKykgewogICAgICAgICAgICBpZiAoaiA9PT0gMHhmZmZmKSB7CiAgICAgICAgICAgICAgY29udGludWU7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgZ2x5cGhJZCA9IG9mZnNldEluZGV4IDwgMCA/IGogOiBvZmZzZXRzW29mZnNldEluZGV4ICsgaiAtIHN0YXJ0XTsKICAgICAgICAgICAgZ2x5cGhJZCA9IGdseXBoSWQgKyBkZWx0YSAmIDB4ZmZmZjsKICAgICAgICAgICAgbWFwcGluZ3MucHVzaCh7CiAgICAgICAgICAgICAgY2hhckNvZGU6IGosCiAgICAgICAgICAgICAgZ2x5cGhJZAogICAgICAgICAgICB9KTsKICAgICAgICAgIH0KICAgICAgICB9CiAgICAgIH0gZWxzZSBpZiAoZm9ybWF0ID09PSA2KSB7CiAgICAgICAgZmlsZS5za2lwKDIgKyAyKTsKICAgICAgICBjb25zdCBmaXJzdENvZGUgPSBmaWxlLmdldFVpbnQxNigpOwogICAgICAgIGNvbnN0IGVudHJ5Q291bnQgPSBmaWxlLmdldFVpbnQxNigpOwogICAgICAgIGZvciAoaiA9IDA7IGogPCBlbnRyeUNvdW50OyBqKyspIHsKICAgICAgICAgIGdseXBoSWQgPSBmaWxlLmdldFVpbnQxNigpOwogICAgICAgICAgY29uc3QgY2hhckNvZGUgPSBmaXJzdENvZGUgKyBqOwogICAgICAgICAgbWFwcGluZ3MucHVzaCh7CiAgICAgICAgICAgIGNoYXJDb2RlLAogICAgICAgICAgICBnbHlwaElkCiAgICAgICAgICB9KTsKICAgICAgICB9CiAgICAgIH0gZWxzZSBpZiAoZm9ybWF0ID09PSAxMikgewogICAgICAgIGZpbGUuc2tpcCgyICsgNCArIDQpOwogICAgICAgIGNvbnN0IG5Hcm91cHMgPSBmaWxlLmdldEludDMyKCkgPj4+IDA7CiAgICAgICAgZm9yIChqID0gMDsgaiA8IG5Hcm91cHM7IGorKykgewogICAgICAgICAgY29uc3Qgc3RhcnRDaGFyQ29kZSA9IGZpbGUuZ2V0SW50MzIoKSA+Pj4gMDsKICAgICAgICAgIGNvbnN0IGVuZENoYXJDb2RlID0gZmlsZS5nZXRJbnQzMigpID4+PiAwOwogICAgICAgICAgbGV0IGdseXBoQ29kZSA9IGZpbGUuZ2V0SW50MzIoKSA+Pj4gMDsKICAgICAgICAgIGZvciAobGV0IGNoYXJDb2RlID0gc3RhcnRDaGFyQ29kZTsgY2hhckNvZGUgPD0gZW5kQ2hhckNvZGU7IGNoYXJDb2RlKyspIHsKICAgICAgICAgICAgbWFwcGluZ3MucHVzaCh7CiAgICAgICAgICAgICAgY2hhckNvZGUsCiAgICAgICAgICAgICAgZ2x5cGhJZDogZ2x5cGhDb2RlKysKICAgICAgICAgICAgfSk7CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICB9IGVsc2UgewogICAgICAgICgwLCBfdXRpbC53YXJuKSgiY21hcCB0YWJsZSBoYXMgdW5zdXBwb3J0ZWQgZm9ybWF0OiAiICsgZm9ybWF0KTsKICAgICAgICByZXR1cm4gewogICAgICAgICAgcGxhdGZvcm1JZDogLTEsCiAgICAgICAgICBlbmNvZGluZ0lkOiAtMSwKICAgICAgICAgIG1hcHBpbmdzOiBbXSwKICAgICAgICAgIGhhc1Nob3J0Q21hcDogZmFsc2UKICAgICAgICB9OwogICAgICB9CiAgICAgIG1hcHBpbmdzLnNvcnQoZnVuY3Rpb24gKGEsIGIpIHsKICAgICAgICByZXR1cm4gYS5jaGFyQ29kZSAtIGIuY2hhckNvZGU7CiAgICAgIH0pOwogICAgICBmb3IgKGxldCBpID0gMTsgaSA8IG1hcHBpbmdzLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgaWYgKG1hcHBpbmdzW2kgLSAxXS5jaGFyQ29kZSA9PT0gbWFwcGluZ3NbaV0uY2hhckNvZGUpIHsKICAgICAgICAgIG1hcHBpbmdzLnNwbGljZShpLCAxKTsKICAgICAgICAgIGktLTsKICAgICAgICB9CiAgICAgIH0KICAgICAgcmV0dXJuIHsKICAgICAgICBwbGF0Zm9ybUlkOiBwb3RlbnRpYWxUYWJsZS5wbGF0Zm9ybUlkLAogICAgICAgIGVuY29kaW5nSWQ6IHBvdGVudGlhbFRhYmxlLmVuY29kaW5nSWQsCiAgICAgICAgbWFwcGluZ3MsCiAgICAgICAgaGFzU2hvcnRDbWFwCiAgICAgIH07CiAgICB9CiAgICBmdW5jdGlvbiBzYW5pdGl6ZU1ldHJpY3MoZmlsZSwgaGVhZGVyLCBtZXRyaWNzLCBoZWFkVGFibGUsIG51bUdseXBocywgZHVwRmlyc3RFbnRyeSkgewogICAgICBpZiAoIWhlYWRlcikgewogICAgICAgIGlmIChtZXRyaWNzKSB7CiAgICAgICAgICBtZXRyaWNzLmRhdGEgPSBudWxsOwogICAgICAgIH0KICAgICAgICByZXR1cm47CiAgICAgIH0KICAgICAgZmlsZS5wb3MgPSAoZmlsZS5zdGFydCB8fCAwKSArIGhlYWRlci5vZmZzZXQ7CiAgICAgIGZpbGUucG9zICs9IDQ7CiAgICAgIGZpbGUucG9zICs9IDI7CiAgICAgIGZpbGUucG9zICs9IDI7CiAgICAgIGZpbGUucG9zICs9IDI7CiAgICAgIGZpbGUucG9zICs9IDI7CiAgICAgIGZpbGUucG9zICs9IDI7CiAgICAgIGZpbGUucG9zICs9IDI7CiAgICAgIGZpbGUucG9zICs9IDI7CiAgICAgIGZpbGUucG9zICs9IDI7CiAgICAgIGZpbGUucG9zICs9IDI7CiAgICAgIGNvbnN0IGNhcmV0T2Zmc2V0ID0gZmlsZS5nZXRVaW50MTYoKTsKICAgICAgZmlsZS5wb3MgKz0gODsKICAgICAgZmlsZS5wb3MgKz0gMjsKICAgICAgbGV0IG51bU9mTWV0cmljcyA9IGZpbGUuZ2V0VWludDE2KCk7CiAgICAgIGlmIChjYXJldE9mZnNldCAhPT0gMCkgewogICAgICAgIGNvbnN0IG1hY1N0eWxlID0gaW50MTYoaGVhZFRhYmxlLmRhdGFbNDRdLCBoZWFkVGFibGUuZGF0YVs0NV0pOwogICAgICAgIGlmICghKG1hY1N0eWxlICYgMikpIHsKICAgICAgICAgIGhlYWRlci5kYXRhWzIyXSA9IDA7CiAgICAgICAgICBoZWFkZXIuZGF0YVsyM10gPSAwOwogICAgICAgIH0KICAgICAgfQogICAgICBpZiAobnVtT2ZNZXRyaWNzID4gbnVtR2x5cGhzKSB7CiAgICAgICAgKDAsIF91dGlsLmluZm8pKGBUaGUgbnVtT2ZNZXRyaWNzICgke251bU9mTWV0cmljc30pIHNob3VsZCBub3QgYmUgYCArIGBncmVhdGVyIHRoYW4gdGhlIG51bUdseXBocyAoJHtudW1HbHlwaHN9KS5gKTsKICAgICAgICBudW1PZk1ldHJpY3MgPSBudW1HbHlwaHM7CiAgICAgICAgaGVhZGVyLmRhdGFbMzRdID0gKG51bU9mTWV0cmljcyAmIDB4ZmYwMCkgPj4gODsKICAgICAgICBoZWFkZXIuZGF0YVszNV0gPSBudW1PZk1ldHJpY3MgJiAweDAwZmY7CiAgICAgIH0KICAgICAgY29uc3QgbnVtT2ZTaWRlYmVhcmluZ3MgPSBudW1HbHlwaHMgLSBudW1PZk1ldHJpY3M7CiAgICAgIGNvbnN0IG51bU1pc3NpbmcgPSBudW1PZlNpZGViZWFyaW5ncyAtIChtZXRyaWNzLmxlbmd0aCAtIG51bU9mTWV0cmljcyAqIDQgPj4gMSk7CiAgICAgIGlmIChudW1NaXNzaW5nID4gMCkgewogICAgICAgIGNvbnN0IGVudHJpZXMgPSBuZXcgVWludDhBcnJheShtZXRyaWNzLmxlbmd0aCArIG51bU1pc3NpbmcgKiAyKTsKICAgICAgICBlbnRyaWVzLnNldChtZXRyaWNzLmRhdGEpOwogICAgICAgIGlmIChkdXBGaXJzdEVudHJ5KSB7CiAgICAgICAgICBlbnRyaWVzW21ldHJpY3MubGVuZ3RoXSA9IG1ldHJpY3MuZGF0YVsyXTsKICAgICAgICAgIGVudHJpZXNbbWV0cmljcy5sZW5ndGggKyAxXSA9IG1ldHJpY3MuZGF0YVszXTsKICAgICAgICB9CiAgICAgICAgbWV0cmljcy5kYXRhID0gZW50cmllczsKICAgICAgfQogICAgfQogICAgZnVuY3Rpb24gc2FuaXRpemVHbHlwaChzb3VyY2UsIHNvdXJjZVN0YXJ0LCBzb3VyY2VFbmQsIGRlc3QsIGRlc3RTdGFydCwgaGludHNWYWxpZCkgewogICAgICBjb25zdCBnbHlwaFByb2ZpbGUgPSB7CiAgICAgICAgbGVuZ3RoOiAwLAogICAgICAgIHNpemVPZkluc3RydWN0aW9uczogMAogICAgICB9OwogICAgICBpZiAoc291cmNlU3RhcnQgPCAwIHx8IHNvdXJjZVN0YXJ0ID49IHNvdXJjZS5sZW5ndGggfHwgc291cmNlRW5kID4gc291cmNlLmxlbmd0aCB8fCBzb3VyY2VFbmQgLSBzb3VyY2VTdGFydCA8PSAxMikgewogICAgICAgIHJldHVybiBnbHlwaFByb2ZpbGU7CiAgICAgIH0KICAgICAgY29uc3QgZ2x5ZiA9IHNvdXJjZS5zdWJhcnJheShzb3VyY2VTdGFydCwgc291cmNlRW5kKTsKICAgICAgY29uc3QgeE1pbiA9IHNpZ25lZEludDE2KGdseWZbMl0sIGdseWZbM10pOwogICAgICBjb25zdCB5TWluID0gc2lnbmVkSW50MTYoZ2x5Zls0XSwgZ2x5Zls1XSk7CiAgICAgIGNvbnN0IHhNYXggPSBzaWduZWRJbnQxNihnbHlmWzZdLCBnbHlmWzddKTsKICAgICAgY29uc3QgeU1heCA9IHNpZ25lZEludDE2KGdseWZbOF0sIGdseWZbOV0pOwogICAgICBpZiAoeE1pbiA+IHhNYXgpIHsKICAgICAgICB3cml0ZVNpZ25lZEludDE2KGdseWYsIDIsIHhNYXgpOwogICAgICAgIHdyaXRlU2lnbmVkSW50MTYoZ2x5ZiwgNiwgeE1pbik7CiAgICAgIH0KICAgICAgaWYgKHlNaW4gPiB5TWF4KSB7CiAgICAgICAgd3JpdGVTaWduZWRJbnQxNihnbHlmLCA0LCB5TWF4KTsKICAgICAgICB3cml0ZVNpZ25lZEludDE2KGdseWYsIDgsIHlNaW4pOwogICAgICB9CiAgICAgIGNvbnN0IGNvbnRvdXJzQ291bnQgPSBzaWduZWRJbnQxNihnbHlmWzBdLCBnbHlmWzFdKTsKICAgICAgaWYgKGNvbnRvdXJzQ291bnQgPCAwKSB7CiAgICAgICAgaWYgKGNvbnRvdXJzQ291bnQgPCAtMSkgewogICAgICAgICAgcmV0dXJuIGdseXBoUHJvZmlsZTsKICAgICAgICB9CiAgICAgICAgZGVzdC5zZXQoZ2x5ZiwgZGVzdFN0YXJ0KTsKICAgICAgICBnbHlwaFByb2ZpbGUubGVuZ3RoID0gZ2x5Zi5sZW5ndGg7CiAgICAgICAgcmV0dXJuIGdseXBoUHJvZmlsZTsKICAgICAgfQogICAgICBsZXQgaSwKICAgICAgICBqID0gMTAsCiAgICAgICAgZmxhZ3NDb3VudCA9IDA7CiAgICAgIGZvciAoaSA9IDA7IGkgPCBjb250b3Vyc0NvdW50OyBpKyspIHsKICAgICAgICBjb25zdCBlbmRQb2ludCA9IGdseWZbal0gPDwgOCB8IGdseWZbaiArIDFdOwogICAgICAgIGZsYWdzQ291bnQgPSBlbmRQb2ludCArIDE7CiAgICAgICAgaiArPSAyOwogICAgICB9CiAgICAgIGNvbnN0IGluc3RydWN0aW9uc1N0YXJ0ID0gajsKICAgICAgY29uc3QgaW5zdHJ1Y3Rpb25zTGVuZ3RoID0gZ2x5ZltqXSA8PCA4IHwgZ2x5ZltqICsgMV07CiAgICAgIGdseXBoUHJvZmlsZS5zaXplT2ZJbnN0cnVjdGlvbnMgPSBpbnN0cnVjdGlvbnNMZW5ndGg7CiAgICAgIGogKz0gMiArIGluc3RydWN0aW9uc0xlbmd0aDsKICAgICAgY29uc3QgaW5zdHJ1Y3Rpb25zRW5kID0gajsKICAgICAgbGV0IGNvb3JkaW5hdGVzTGVuZ3RoID0gMDsKICAgICAgZm9yIChpID0gMDsgaSA8IGZsYWdzQ291bnQ7IGkrKykgewogICAgICAgIGNvbnN0IGZsYWcgPSBnbHlmW2orK107CiAgICAgICAgaWYgKGZsYWcgJiAweGMwKSB7CiAgICAgICAgICBnbHlmW2ogLSAxXSA9IGZsYWcgJiAweDNmOwogICAgICAgIH0KICAgICAgICBsZXQgeExlbmd0aCA9IDI7CiAgICAgICAgaWYgKGZsYWcgJiAyKSB7CiAgICAgICAgICB4TGVuZ3RoID0gMTsKICAgICAgICB9IGVsc2UgaWYgKGZsYWcgJiAxNikgewogICAgICAgICAgeExlbmd0aCA9IDA7CiAgICAgICAgfQogICAgICAgIGxldCB5TGVuZ3RoID0gMjsKICAgICAgICBpZiAoZmxhZyAmIDQpIHsKICAgICAgICAgIHlMZW5ndGggPSAxOwogICAgICAgIH0gZWxzZSBpZiAoZmxhZyAmIDMyKSB7CiAgICAgICAgICB5TGVuZ3RoID0gMDsKICAgICAgICB9CiAgICAgICAgY29uc3QgeHlMZW5ndGggPSB4TGVuZ3RoICsgeUxlbmd0aDsKICAgICAgICBjb29yZGluYXRlc0xlbmd0aCArPSB4eUxlbmd0aDsKICAgICAgICBpZiAoZmxhZyAmIDgpIHsKICAgICAgICAgIGNvbnN0IHJlcGVhdCA9IGdseWZbaisrXTsKICAgICAgICAgIGlmIChyZXBlYXQgPT09IDApIHsKICAgICAgICAgICAgZ2x5ZltqIC0gMV0gXj0gODsKICAgICAgICAgIH0KICAgICAgICAgIGkgKz0gcmVwZWF0OwogICAgICAgICAgY29vcmRpbmF0ZXNMZW5ndGggKz0gcmVwZWF0ICogeHlMZW5ndGg7CiAgICAgICAgfQogICAgICB9CiAgICAgIGlmIChjb29yZGluYXRlc0xlbmd0aCA9PT0gMCkgewogICAgICAgIHJldHVybiBnbHlwaFByb2ZpbGU7CiAgICAgIH0KICAgICAgbGV0IGdseXBoRGF0YUxlbmd0aCA9IGogKyBjb29yZGluYXRlc0xlbmd0aDsKICAgICAgaWYgKGdseXBoRGF0YUxlbmd0aCA+IGdseWYubGVuZ3RoKSB7CiAgICAgICAgcmV0dXJuIGdseXBoUHJvZmlsZTsKICAgICAgfQogICAgICBpZiAoIWhpbnRzVmFsaWQgJiYgaW5zdHJ1Y3Rpb25zTGVuZ3RoID4gMCkgewogICAgICAgIGRlc3Quc2V0KGdseWYuc3ViYXJyYXkoMCwgaW5zdHJ1Y3Rpb25zU3RhcnQpLCBkZXN0U3RhcnQpOwogICAgICAgIGRlc3Quc2V0KFswLCAwXSwgZGVzdFN0YXJ0ICsgaW5zdHJ1Y3Rpb25zU3RhcnQpOwogICAgICAgIGRlc3Quc2V0KGdseWYuc3ViYXJyYXkoaW5zdHJ1Y3Rpb25zRW5kLCBnbHlwaERhdGFMZW5ndGgpLCBkZXN0U3RhcnQgKyBpbnN0cnVjdGlvbnNTdGFydCArIDIpOwogICAgICAgIGdseXBoRGF0YUxlbmd0aCAtPSBpbnN0cnVjdGlvbnNMZW5ndGg7CiAgICAgICAgaWYgKGdseWYubGVuZ3RoIC0gZ2x5cGhEYXRhTGVuZ3RoID4gMykgewogICAgICAgICAgZ2x5cGhEYXRhTGVuZ3RoID0gZ2x5cGhEYXRhTGVuZ3RoICsgMyAmIH4zOwogICAgICAgIH0KICAgICAgICBnbHlwaFByb2ZpbGUubGVuZ3RoID0gZ2x5cGhEYXRhTGVuZ3RoOwogICAgICAgIHJldHVybiBnbHlwaFByb2ZpbGU7CiAgICAgIH0KICAgICAgaWYgKGdseWYubGVuZ3RoIC0gZ2x5cGhEYXRhTGVuZ3RoID4gMykgewogICAgICAgIGdseXBoRGF0YUxlbmd0aCA9IGdseXBoRGF0YUxlbmd0aCArIDMgJiB+MzsKICAgICAgICBkZXN0LnNldChnbHlmLnN1YmFycmF5KDAsIGdseXBoRGF0YUxlbmd0aCksIGRlc3RTdGFydCk7CiAgICAgICAgZ2x5cGhQcm9maWxlLmxlbmd0aCA9IGdseXBoRGF0YUxlbmd0aDsKICAgICAgICByZXR1cm4gZ2x5cGhQcm9maWxlOwogICAgICB9CiAgICAgIGRlc3Quc2V0KGdseWYsIGRlc3RTdGFydCk7CiAgICAgIGdseXBoUHJvZmlsZS5sZW5ndGggPSBnbHlmLmxlbmd0aDsKICAgICAgcmV0dXJuIGdseXBoUHJvZmlsZTsKICAgIH0KICAgIGZ1bmN0aW9uIHNhbml0aXplSGVhZChoZWFkLCBudW1HbHlwaHMsIGxvY2FMZW5ndGgpIHsKICAgICAgY29uc3QgZGF0YSA9IGhlYWQuZGF0YTsKICAgICAgY29uc3QgdmVyc2lvbiA9IGludDMyKGRhdGFbMF0sIGRhdGFbMV0sIGRhdGFbMl0sIGRhdGFbM10pOwogICAgICBpZiAodmVyc2lvbiA+PiAxNiAhPT0gMSkgewogICAgICAgICgwLCBfdXRpbC5pbmZvKSgiQXR0ZW1wdGluZyB0byBmaXggaW52YWxpZCB2ZXJzaW9uIGluIGhlYWQgdGFibGU6ICIgKyB2ZXJzaW9uKTsKICAgICAgICBkYXRhWzBdID0gMDsKICAgICAgICBkYXRhWzFdID0gMTsKICAgICAgICBkYXRhWzJdID0gMDsKICAgICAgICBkYXRhWzNdID0gMDsKICAgICAgfQogICAgICBjb25zdCBpbmRleFRvTG9jRm9ybWF0ID0gaW50MTYoZGF0YVs1MF0sIGRhdGFbNTFdKTsKICAgICAgaWYgKGluZGV4VG9Mb2NGb3JtYXQgPCAwIHx8IGluZGV4VG9Mb2NGb3JtYXQgPiAxKSB7CiAgICAgICAgKDAsIF91dGlsLmluZm8pKCJBdHRlbXB0aW5nIHRvIGZpeCBpbnZhbGlkIGluZGV4VG9Mb2NGb3JtYXQgaW4gaGVhZCB0YWJsZTogIiArIGluZGV4VG9Mb2NGb3JtYXQpOwogICAgICAgIGNvbnN0IG51bUdseXBoc1BsdXNPbmUgPSBudW1HbHlwaHMgKyAxOwogICAgICAgIGlmIChsb2NhTGVuZ3RoID09PSBudW1HbHlwaHNQbHVzT25lIDw8IDEpIHsKICAgICAgICAgIGRhdGFbNTBdID0gMDsKICAgICAgICAgIGRhdGFbNTFdID0gMDsKICAgICAgICB9IGVsc2UgaWYgKGxvY2FMZW5ndGggPT09IG51bUdseXBoc1BsdXNPbmUgPDwgMikgewogICAgICAgICAgZGF0YVs1MF0gPSAwOwogICAgICAgICAgZGF0YVs1MV0gPSAxOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICB0aHJvdyBuZXcgX3V0aWwuRm9ybWF0RXJyb3IoIkNvdWxkIG5vdCBmaXggaW5kZXhUb0xvY0Zvcm1hdDogIiArIGluZGV4VG9Mb2NGb3JtYXQpOwogICAgICAgIH0KICAgICAgfQogICAgfQogICAgZnVuY3Rpb24gc2FuaXRpemVHbHlwaExvY2F0aW9ucyhsb2NhLCBnbHlmLCBudW1HbHlwaHMsIGlzR2x5cGhMb2NhdGlvbnNMb25nLCBoaW50c1ZhbGlkLCBkdXBGaXJzdEVudHJ5LCBtYXhTaXplT2ZJbnN0cnVjdGlvbnMpIHsKICAgICAgbGV0IGl0ZW1TaXplLCBpdGVtRGVjb2RlLCBpdGVtRW5jb2RlOwogICAgICBpZiAoaXNHbHlwaExvY2F0aW9uc0xvbmcpIHsKICAgICAgICBpdGVtU2l6ZSA9IDQ7CiAgICAgICAgaXRlbURlY29kZSA9IGZ1bmN0aW9uIGZvbnRJdGVtRGVjb2RlTG9uZyhkYXRhLCBvZmZzZXQpIHsKICAgICAgICAgIHJldHVybiBkYXRhW29mZnNldF0gPDwgMjQgfCBkYXRhW29mZnNldCArIDFdIDw8IDE2IHwgZGF0YVtvZmZzZXQgKyAyXSA8PCA4IHwgZGF0YVtvZmZzZXQgKyAzXTsKICAgICAgICB9OwogICAgICAgIGl0ZW1FbmNvZGUgPSBmdW5jdGlvbiBmb250SXRlbUVuY29kZUxvbmcoZGF0YSwgb2Zmc2V0LCB2YWx1ZSkgewogICAgICAgICAgZGF0YVtvZmZzZXRdID0gdmFsdWUgPj4+IDI0ICYgMHhmZjsKICAgICAgICAgIGRhdGFbb2Zmc2V0ICsgMV0gPSB2YWx1ZSA+PiAxNiAmIDB4ZmY7CiAgICAgICAgICBkYXRhW29mZnNldCArIDJdID0gdmFsdWUgPj4gOCAmIDB4ZmY7CiAgICAgICAgICBkYXRhW29mZnNldCArIDNdID0gdmFsdWUgJiAweGZmOwogICAgICAgIH07CiAgICAgIH0gZWxzZSB7CiAgICAgICAgaXRlbVNpemUgPSAyOwogICAgICAgIGl0ZW1EZWNvZGUgPSBmdW5jdGlvbiBmb250SXRlbURlY29kZShkYXRhLCBvZmZzZXQpIHsKICAgICAgICAgIHJldHVybiBkYXRhW29mZnNldF0gPDwgOSB8IGRhdGFbb2Zmc2V0ICsgMV0gPDwgMTsKICAgICAgICB9OwogICAgICAgIGl0ZW1FbmNvZGUgPSBmdW5jdGlvbiBmb250SXRlbUVuY29kZShkYXRhLCBvZmZzZXQsIHZhbHVlKSB7CiAgICAgICAgICBkYXRhW29mZnNldF0gPSB2YWx1ZSA+PiA5ICYgMHhmZjsKICAgICAgICAgIGRhdGFbb2Zmc2V0ICsgMV0gPSB2YWx1ZSA+PiAxICYgMHhmZjsKICAgICAgICB9OwogICAgICB9CiAgICAgIGNvbnN0IG51bUdseXBoc091dCA9IGR1cEZpcnN0RW50cnkgPyBudW1HbHlwaHMgKyAxIDogbnVtR2x5cGhzOwogICAgICBjb25zdCBsb2NhRGF0YVNpemUgPSBpdGVtU2l6ZSAqICgxICsgbnVtR2x5cGhzT3V0KTsKICAgICAgY29uc3QgbG9jYURhdGEgPSBuZXcgVWludDhBcnJheShsb2NhRGF0YVNpemUpOwogICAgICBsb2NhRGF0YS5zZXQobG9jYS5kYXRhLnN1YmFycmF5KDAsIGxvY2FEYXRhU2l6ZSkpOwogICAgICBsb2NhLmRhdGEgPSBsb2NhRGF0YTsKICAgICAgY29uc3Qgb2xkR2x5ZkRhdGEgPSBnbHlmLmRhdGE7CiAgICAgIGNvbnN0IG9sZEdseWZEYXRhTGVuZ3RoID0gb2xkR2x5ZkRhdGEubGVuZ3RoOwogICAgICBjb25zdCBuZXdHbHlmRGF0YSA9IG5ldyBVaW50OEFycmF5KG9sZEdseWZEYXRhTGVuZ3RoKTsKICAgICAgbGV0IGksIGo7CiAgICAgIGNvbnN0IGxvY2FFbnRyaWVzID0gW107CiAgICAgIGZvciAoaSA9IDAsIGogPSAwOyBpIDwgbnVtR2x5cGhzICsgMTsgaSsrLCBqICs9IGl0ZW1TaXplKSB7CiAgICAgICAgbGV0IG9mZnNldCA9IGl0ZW1EZWNvZGUobG9jYURhdGEsIGopOwogICAgICAgIGlmIChvZmZzZXQgPiBvbGRHbHlmRGF0YUxlbmd0aCkgewogICAgICAgICAgb2Zmc2V0ID0gb2xkR2x5ZkRhdGFMZW5ndGg7CiAgICAgICAgfQogICAgICAgIGxvY2FFbnRyaWVzLnB1c2goewogICAgICAgICAgaW5kZXg6IGksCiAgICAgICAgICBvZmZzZXQsCiAgICAgICAgICBlbmRPZmZzZXQ6IDAKICAgICAgICB9KTsKICAgICAgfQogICAgICBsb2NhRW50cmllcy5zb3J0KChhLCBiKSA9PiB7CiAgICAgICAgcmV0dXJuIGEub2Zmc2V0IC0gYi5vZmZzZXQ7CiAgICAgIH0pOwogICAgICBmb3IgKGkgPSAwOyBpIDwgbnVtR2x5cGhzOyBpKyspIHsKICAgICAgICBsb2NhRW50cmllc1tpXS5lbmRPZmZzZXQgPSBsb2NhRW50cmllc1tpICsgMV0ub2Zmc2V0OwogICAgICB9CiAgICAgIGxvY2FFbnRyaWVzLnNvcnQoKGEsIGIpID0+IHsKICAgICAgICByZXR1cm4gYS5pbmRleCAtIGIuaW5kZXg7CiAgICAgIH0pOwogICAgICBmb3IgKGkgPSAwOyBpIDwgbnVtR2x5cGhzOyBpKyspIHsKICAgICAgICBjb25zdCB7CiAgICAgICAgICBvZmZzZXQsCiAgICAgICAgICBlbmRPZmZzZXQKICAgICAgICB9ID0gbG9jYUVudHJpZXNbaV07CiAgICAgICAgaWYgKG9mZnNldCAhPT0gMCB8fCBlbmRPZmZzZXQgIT09IDApIHsKICAgICAgICAgIGJyZWFrOwogICAgICAgIH0KICAgICAgICBjb25zdCBuZXh0T2Zmc2V0ID0gbG9jYUVudHJpZXNbaSArIDFdLm9mZnNldDsKICAgICAgICBpZiAobmV4dE9mZnNldCA9PT0gMCkgewogICAgICAgICAgY29udGludWU7CiAgICAgICAgfQogICAgICAgIGxvY2FFbnRyaWVzW2ldLmVuZE9mZnNldCA9IG5leHRPZmZzZXQ7CiAgICAgICAgYnJlYWs7CiAgICAgIH0KICAgICAgY29uc3QgbWlzc2luZ0dseXBocyA9IE9iamVjdC5jcmVhdGUobnVsbCk7CiAgICAgIGxldCB3cml0ZU9mZnNldCA9IDA7CiAgICAgIGl0ZW1FbmNvZGUobG9jYURhdGEsIDAsIHdyaXRlT2Zmc2V0KTsKICAgICAgZm9yIChpID0gMCwgaiA9IGl0ZW1TaXplOyBpIDwgbnVtR2x5cGhzOyBpKyssIGogKz0gaXRlbVNpemUpIHsKICAgICAgICBjb25zdCBnbHlwaFByb2ZpbGUgPSBzYW5pdGl6ZUdseXBoKG9sZEdseWZEYXRhLCBsb2NhRW50cmllc1tpXS5vZmZzZXQsIGxvY2FFbnRyaWVzW2ldLmVuZE9mZnNldCwgbmV3R2x5ZkRhdGEsIHdyaXRlT2Zmc2V0LCBoaW50c1ZhbGlkKTsKICAgICAgICBjb25zdCBuZXdMZW5ndGggPSBnbHlwaFByb2ZpbGUubGVuZ3RoOwogICAgICAgIGlmIChuZXdMZW5ndGggPT09IDApIHsKICAgICAgICAgIG1pc3NpbmdHbHlwaHNbaV0gPSB0cnVlOwogICAgICAgIH0KICAgICAgICBpZiAoZ2x5cGhQcm9maWxlLnNpemVPZkluc3RydWN0aW9ucyA+IG1heFNpemVPZkluc3RydWN0aW9ucykgewogICAgICAgICAgbWF4U2l6ZU9mSW5zdHJ1Y3Rpb25zID0gZ2x5cGhQcm9maWxlLnNpemVPZkluc3RydWN0aW9uczsKICAgICAgICB9CiAgICAgICAgd3JpdGVPZmZzZXQgKz0gbmV3TGVuZ3RoOwogICAgICAgIGl0ZW1FbmNvZGUobG9jYURhdGEsIGosIHdyaXRlT2Zmc2V0KTsKICAgICAgfQogICAgICBpZiAod3JpdGVPZmZzZXQgPT09IDApIHsKICAgICAgICBjb25zdCBzaW1wbGVHbHlwaCA9IG5ldyBVaW50OEFycmF5KFswLCAxLCAwLCAwLCAwLCAwLCAwLCAwLCAwLCAwLCAwLCAwLCAwLCAwLCA0OSwgMF0pOwogICAgICAgIGZvciAoaSA9IDAsIGogPSBpdGVtU2l6ZTsgaSA8IG51bUdseXBoc091dDsgaSsrLCBqICs9IGl0ZW1TaXplKSB7CiAgICAgICAgICBpdGVtRW5jb2RlKGxvY2FEYXRhLCBqLCBzaW1wbGVHbHlwaC5sZW5ndGgpOwogICAgICAgIH0KICAgICAgICBnbHlmLmRhdGEgPSBzaW1wbGVHbHlwaDsKICAgICAgfSBlbHNlIGlmIChkdXBGaXJzdEVudHJ5KSB7CiAgICAgICAgY29uc3QgZmlyc3RFbnRyeUxlbmd0aCA9IGl0ZW1EZWNvZGUobG9jYURhdGEsIGl0ZW1TaXplKTsKICAgICAgICBpZiAobmV3R2x5ZkRhdGEubGVuZ3RoID4gZmlyc3RFbnRyeUxlbmd0aCArIHdyaXRlT2Zmc2V0KSB7CiAgICAgICAgICBnbHlmLmRhdGEgPSBuZXdHbHlmRGF0YS5zdWJhcnJheSgwLCBmaXJzdEVudHJ5TGVuZ3RoICsgd3JpdGVPZmZzZXQpOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICBnbHlmLmRhdGEgPSBuZXcgVWludDhBcnJheShmaXJzdEVudHJ5TGVuZ3RoICsgd3JpdGVPZmZzZXQpOwogICAgICAgICAgZ2x5Zi5kYXRhLnNldChuZXdHbHlmRGF0YS5zdWJhcnJheSgwLCB3cml0ZU9mZnNldCkpOwogICAgICAgIH0KICAgICAgICBnbHlmLmRhdGEuc2V0KG5ld0dseWZEYXRhLnN1YmFycmF5KDAsIGZpcnN0RW50cnlMZW5ndGgpLCB3cml0ZU9mZnNldCk7CiAgICAgICAgaXRlbUVuY29kZShsb2NhLmRhdGEsIGxvY2FEYXRhLmxlbmd0aCAtIGl0ZW1TaXplLCB3cml0ZU9mZnNldCArIGZpcnN0RW50cnlMZW5ndGgpOwogICAgICB9IGVsc2UgewogICAgICAgIGdseWYuZGF0YSA9IG5ld0dseWZEYXRhLnN1YmFycmF5KDAsIHdyaXRlT2Zmc2V0KTsKICAgICAgfQogICAgICByZXR1cm4gewogICAgICAgIG1pc3NpbmdHbHlwaHMsCiAgICAgICAgbWF4U2l6ZU9mSW5zdHJ1Y3Rpb25zCiAgICAgIH07CiAgICB9CiAgICBmdW5jdGlvbiByZWFkUG9zdFNjcmlwdFRhYmxlKHBvc3QsIHByb3BlcnRpZXNPYmosIG1heHBOdW1HbHlwaHMpIHsKICAgICAgY29uc3Qgc3RhcnQgPSAoZm9udC5zdGFydCB8fCAwKSArIHBvc3Qub2Zmc2V0OwogICAgICBmb250LnBvcyA9IHN0YXJ0OwogICAgICBjb25zdCBsZW5ndGggPSBwb3N0Lmxlbmd0aCwKICAgICAgICBlbmQgPSBzdGFydCArIGxlbmd0aDsKICAgICAgY29uc3QgdmVyc2lvbiA9IGZvbnQuZ2V0SW50MzIoKTsKICAgICAgZm9udC5za2lwKDI4KTsKICAgICAgbGV0IGdseXBoTmFtZXM7CiAgICAgIGxldCB2YWxpZCA9IHRydWU7CiAgICAgIGxldCBpOwogICAgICBzd2l0Y2ggKHZlcnNpb24pIHsKICAgICAgICBjYXNlIDB4MDAwMTAwMDA6CiAgICAgICAgICBnbHlwaE5hbWVzID0gX2ZvbnRzX3V0aWxzLk1hY1N0YW5kYXJkR2x5cGhPcmRlcmluZzsKICAgICAgICAgIGJyZWFrOwogICAgICAgIGNhc2UgMHgwMDAyMDAwMDoKICAgICAgICAgIGNvbnN0IG51bUdseXBocyA9IGZvbnQuZ2V0VWludDE2KCk7CiAgICAgICAgICBpZiAobnVtR2x5cGhzICE9PSBtYXhwTnVtR2x5cGhzKSB7CiAgICAgICAgICAgIHZhbGlkID0gZmFsc2U7CiAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgfQogICAgICAgICAgY29uc3QgZ2x5cGhOYW1lSW5kZXhlcyA9IFtdOwogICAgICAgICAgZm9yIChpID0gMDsgaSA8IG51bUdseXBoczsgKytpKSB7CiAgICAgICAgICAgIGNvbnN0IGluZGV4ID0gZm9udC5nZXRVaW50MTYoKTsKICAgICAgICAgICAgaWYgKGluZGV4ID49IDMyNzY4KSB7CiAgICAgICAgICAgICAgdmFsaWQgPSBmYWxzZTsKICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgfQogICAgICAgICAgICBnbHlwaE5hbWVJbmRleGVzLnB1c2goaW5kZXgpOwogICAgICAgICAgfQogICAgICAgICAgaWYgKCF2YWxpZCkgewogICAgICAgICAgICBicmVhazsKICAgICAgICAgIH0KICAgICAgICAgIGNvbnN0IGN1c3RvbU5hbWVzID0gW10sCiAgICAgICAgICAgIHN0ckJ1ZiA9IFtdOwogICAgICAgICAgd2hpbGUgKGZvbnQucG9zIDwgZW5kKSB7CiAgICAgICAgICAgIGNvbnN0IHN0cmluZ0xlbmd0aCA9IGZvbnQuZ2V0Qnl0ZSgpOwogICAgICAgICAgICBzdHJCdWYubGVuZ3RoID0gc3RyaW5nTGVuZ3RoOwogICAgICAgICAgICBmb3IgKGkgPSAwOyBpIDwgc3RyaW5nTGVuZ3RoOyArK2kpIHsKICAgICAgICAgICAgICBzdHJCdWZbaV0gPSBTdHJpbmcuZnJvbUNoYXJDb2RlKGZvbnQuZ2V0Qnl0ZSgpKTsKICAgICAgICAgICAgfQogICAgICAgICAgICBjdXN0b21OYW1lcy5wdXNoKHN0ckJ1Zi5qb2luKCIiKSk7CiAgICAgICAgICB9CiAgICAgICAgICBnbHlwaE5hbWVzID0gW107CiAgICAgICAgICBmb3IgKGkgPSAwOyBpIDwgbnVtR2x5cGhzOyArK2kpIHsKICAgICAgICAgICAgY29uc3QgaiA9IGdseXBoTmFtZUluZGV4ZXNbaV07CiAgICAgICAgICAgIGlmIChqIDwgMjU4KSB7CiAgICAgICAgICAgICAgZ2x5cGhOYW1lcy5wdXNoKF9mb250c191dGlscy5NYWNTdGFuZGFyZEdseXBoT3JkZXJpbmdbal0pOwogICAgICAgICAgICAgIGNvbnRpbnVlOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGdseXBoTmFtZXMucHVzaChjdXN0b21OYW1lc1tqIC0gMjU4XSk7CiAgICAgICAgICB9CiAgICAgICAgICBicmVhazsKICAgICAgICBjYXNlIDB4MDAwMzAwMDA6CiAgICAgICAgICBicmVhazsKICAgICAgICBkZWZhdWx0OgogICAgICAgICAgKDAsIF91dGlsLndhcm4pKCJVbmtub3duL3Vuc3VwcG9ydGVkIHBvc3QgdGFibGUgdmVyc2lvbiAiICsgdmVyc2lvbik7CiAgICAgICAgICB2YWxpZCA9IGZhbHNlOwogICAgICAgICAgaWYgKHByb3BlcnRpZXNPYmouZGVmYXVsdEVuY29kaW5nKSB7CiAgICAgICAgICAgIGdseXBoTmFtZXMgPSBwcm9wZXJ0aWVzT2JqLmRlZmF1bHRFbmNvZGluZzsKICAgICAgICAgIH0KICAgICAgICAgIGJyZWFrOwogICAgICB9CiAgICAgIHByb3BlcnRpZXNPYmouZ2x5cGhOYW1lcyA9IGdseXBoTmFtZXM7CiAgICAgIHJldHVybiB2YWxpZDsKICAgIH0KICAgIGZ1bmN0aW9uIHJlYWROYW1lVGFibGUobmFtZVRhYmxlKSB7CiAgICAgIGNvbnN0IHN0YXJ0ID0gKGZvbnQuc3RhcnQgfHwgMCkgKyBuYW1lVGFibGUub2Zmc2V0OwogICAgICBmb250LnBvcyA9IHN0YXJ0OwogICAgICBjb25zdCBuYW1lcyA9IFtbXSwgW11dLAogICAgICAgIHJlY29yZHMgPSBbXTsKICAgICAgY29uc3QgbGVuZ3RoID0gbmFtZVRhYmxlLmxlbmd0aCwKICAgICAgICBlbmQgPSBzdGFydCArIGxlbmd0aDsKICAgICAgY29uc3QgZm9ybWF0ID0gZm9udC5nZXRVaW50MTYoKTsKICAgICAgY29uc3QgRk9STUFUXzBfSEVBREVSX0xFTkdUSCA9IDY7CiAgICAgIGlmIChmb3JtYXQgIT09IDAgfHwgbGVuZ3RoIDwgRk9STUFUXzBfSEVBREVSX0xFTkdUSCkgewogICAgICAgIHJldHVybiBbbmFtZXMsIHJlY29yZHNdOwogICAgICB9CiAgICAgIGNvbnN0IG51bVJlY29yZHMgPSBmb250LmdldFVpbnQxNigpOwogICAgICBjb25zdCBzdHJpbmdzU3RhcnQgPSBmb250LmdldFVpbnQxNigpOwogICAgICBjb25zdCBOQU1FX1JFQ09SRF9MRU5HVEggPSAxMjsKICAgICAgbGV0IGksIGlpOwogICAgICBmb3IgKGkgPSAwOyBpIDwgbnVtUmVjb3JkcyAmJiBmb250LnBvcyArIE5BTUVfUkVDT1JEX0xFTkdUSCA8PSBlbmQ7IGkrKykgewogICAgICAgIGNvbnN0IHIgPSB7CiAgICAgICAgICBwbGF0Zm9ybTogZm9udC5nZXRVaW50MTYoKSwKICAgICAgICAgIGVuY29kaW5nOiBmb250LmdldFVpbnQxNigpLAogICAgICAgICAgbGFuZ3VhZ2U6IGZvbnQuZ2V0VWludDE2KCksCiAgICAgICAgICBuYW1lOiBmb250LmdldFVpbnQxNigpLAogICAgICAgICAgbGVuZ3RoOiBmb250LmdldFVpbnQxNigpLAogICAgICAgICAgb2Zmc2V0OiBmb250LmdldFVpbnQxNigpCiAgICAgICAgfTsKICAgICAgICBpZiAoaXNNYWNOYW1lUmVjb3JkKHIpIHx8IGlzV2luTmFtZVJlY29yZChyKSkgewogICAgICAgICAgcmVjb3Jkcy5wdXNoKHIpOwogICAgICAgIH0KICAgICAgfQogICAgICBmb3IgKGkgPSAwLCBpaSA9IHJlY29yZHMubGVuZ3RoOyBpIDwgaWk7IGkrKykgewogICAgICAgIGNvbnN0IHJlY29yZCA9IHJlY29yZHNbaV07CiAgICAgICAgaWYgKHJlY29yZC5sZW5ndGggPD0gMCkgewogICAgICAgICAgY29udGludWU7CiAgICAgICAgfQogICAgICAgIGNvbnN0IHBvcyA9IHN0YXJ0ICsgc3RyaW5nc1N0YXJ0ICsgcmVjb3JkLm9mZnNldDsKICAgICAgICBpZiAocG9zICsgcmVjb3JkLmxlbmd0aCA+IGVuZCkgewogICAgICAgICAgY29udGludWU7CiAgICAgICAgfQogICAgICAgIGZvbnQucG9zID0gcG9zOwogICAgICAgIGNvbnN0IG5hbWVJbmRleCA9IHJlY29yZC5uYW1lOwogICAgICAgIGlmIChyZWNvcmQuZW5jb2RpbmcpIHsKICAgICAgICAgIGxldCBzdHIgPSAiIjsKICAgICAgICAgIGZvciAobGV0IGogPSAwLCBqaiA9IHJlY29yZC5sZW5ndGg7IGogPCBqajsgaiArPSAyKSB7CiAgICAgICAgICAgIHN0ciArPSBTdHJpbmcuZnJvbUNoYXJDb2RlKGZvbnQuZ2V0VWludDE2KCkpOwogICAgICAgICAgfQogICAgICAgICAgbmFtZXNbMV1bbmFtZUluZGV4XSA9IHN0cjsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgbmFtZXNbMF1bbmFtZUluZGV4XSA9IGZvbnQuZ2V0U3RyaW5nKHJlY29yZC5sZW5ndGgpOwogICAgICAgIH0KICAgICAgfQogICAgICByZXR1cm4gW25hbWVzLCByZWNvcmRzXTsKICAgIH0KICAgIGNvbnN0IFRUT3BzU3RhY2tEZWx0YXMgPSBbMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgLTIsIC0yLCAtMiwgLTIsIDAsIDAsIC0yLCAtNSwgLTEsIC0xLCAtMSwgLTEsIC0xLCAtMSwgLTEsIC0xLCAwLCAwLCAtMSwgMCwgLTEsIC0xLCAtMSwgLTEsIDEsIC0xLCAtOTk5LCAwLCAxLCAwLCAtMSwgLTIsIDAsIC0xLCAtMiwgLTEsIC0xLCAwLCAtMSwgLTEsIDAsIDAsIC05OTksIC05OTksIC0xLCAtMSwgLTEsIC0xLCAtMiwgLTk5OSwgLTIsIC0yLCAtOTk5LCAwLCAtMiwgLTIsIDAsIDAsIC0yLCAwLCAtMiwgMCwgMCwgMCwgLTIsIC0xLCAtMSwgMSwgMSwgMCwgMCwgLTEsIC0xLCAtMSwgLTEsIC0xLCAtMSwgLTEsIDAsIDAsIC0xLCAwLCAtMSwgLTEsIDAsIC05OTksIC0xLCAtMSwgLTEsIC0xLCAtMSwgLTEsIDAsIDAsIDAsIDAsIDAsIDAsIDAsIDAsIDAsIDAsIDAsIDAsIC0yLCAtOTk5LCAtOTk5LCAtOTk5LCAtOTk5LCAtOTk5LCAtMSwgLTEsIC0yLCAtMiwgMCwgMCwgMCwgMCwgLTEsIC0xLCAtOTk5LCAtMiwgLTIsIDAsIDAsIC0xLCAtMiwgLTIsIDAsIDAsIDAsIC0xLCAtMSwgLTEsIC0yXTsKICAgIGZ1bmN0aW9uIHNhbml0aXplVFRQcm9ncmFtKHRhYmxlLCB0dENvbnRleHQpIHsKICAgICAgbGV0IGRhdGEgPSB0YWJsZS5kYXRhOwogICAgICBsZXQgaSA9IDAsCiAgICAgICAgaiwKICAgICAgICBuLAogICAgICAgIGIsCiAgICAgICAgZnVuY0lkLAogICAgICAgIHBjLAogICAgICAgIGxhc3RFbmRmID0gMCwKICAgICAgICBsYXN0RGVmZiA9IDA7CiAgICAgIGNvbnN0IHN0YWNrID0gW107CiAgICAgIGNvbnN0IGNhbGxzdGFjayA9IFtdOwogICAgICBjb25zdCBmdW5jdGlvbnNDYWxsZWQgPSBbXTsKICAgICAgbGV0IHRvb0NvbXBsZXhUb0ZvbGxvd0Z1bmN0aW9ucyA9IHR0Q29udGV4dC50b29Db21wbGV4VG9Gb2xsb3dGdW5jdGlvbnM7CiAgICAgIGxldCBpbkZERUYgPSBmYWxzZSwKICAgICAgICBpZkxldmVsID0gMCwKICAgICAgICBpbkVMU0UgPSAwOwogICAgICBmb3IgKGxldCBpaSA9IGRhdGEubGVuZ3RoOyBpIDwgaWk7KSB7CiAgICAgICAgY29uc3Qgb3AgPSBkYXRhW2krK107CiAgICAgICAgaWYgKG9wID09PSAweDQwKSB7CiAgICAgICAgICBuID0gZGF0YVtpKytdOwogICAgICAgICAgaWYgKGluRkRFRiB8fCBpbkVMU0UpIHsKICAgICAgICAgICAgaSArPSBuOwogICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgZm9yIChqID0gMDsgaiA8IG47IGorKykgewogICAgICAgICAgICAgIHN0YWNrLnB1c2goZGF0YVtpKytdKTsKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgIH0gZWxzZSBpZiAob3AgPT09IDB4NDEpIHsKICAgICAgICAgIG4gPSBkYXRhW2krK107CiAgICAgICAgICBpZiAoaW5GREVGIHx8IGluRUxTRSkgewogICAgICAgICAgICBpICs9IG4gKiAyOwogICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgZm9yIChqID0gMDsgaiA8IG47IGorKykgewogICAgICAgICAgICAgIGIgPSBkYXRhW2krK107CiAgICAgICAgICAgICAgc3RhY2sucHVzaChiIDw8IDggfCBkYXRhW2krK10pOwogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgfSBlbHNlIGlmICgob3AgJiAweGY4KSA9PT0gMHhiMCkgewogICAgICAgICAgbiA9IG9wIC0gMHhiMCArIDE7CiAgICAgICAgICBpZiAoaW5GREVGIHx8IGluRUxTRSkgewogICAgICAgICAgICBpICs9IG47CiAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICBmb3IgKGogPSAwOyBqIDwgbjsgaisrKSB7CiAgICAgICAgICAgICAgc3RhY2sucHVzaChkYXRhW2krK10pOwogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgfSBlbHNlIGlmICgob3AgJiAweGY4KSA9PT0gMHhiOCkgewogICAgICAgICAgbiA9IG9wIC0gMHhiOCArIDE7CiAgICAgICAgICBpZiAoaW5GREVGIHx8IGluRUxTRSkgewogICAgICAgICAgICBpICs9IG4gKiAyOwogICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgZm9yIChqID0gMDsgaiA8IG47IGorKykgewogICAgICAgICAgICAgIGIgPSBkYXRhW2krK107CiAgICAgICAgICAgICAgc3RhY2sucHVzaChiIDw8IDggfCBkYXRhW2krK10pOwogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgfSBlbHNlIGlmIChvcCA9PT0gMHgyYiAmJiAhdG9vQ29tcGxleFRvRm9sbG93RnVuY3Rpb25zKSB7CiAgICAgICAgICBpZiAoIWluRkRFRiAmJiAhaW5FTFNFKSB7CiAgICAgICAgICAgIGZ1bmNJZCA9IHN0YWNrLmF0KC0xKTsKICAgICAgICAgICAgaWYgKGlzTmFOKGZ1bmNJZCkpIHsKICAgICAgICAgICAgICAoMCwgX3V0aWwuaW5mbykoIlRUOiBDQUxMIGVtcHR5IHN0YWNrIChvciBpbnZhbGlkIGVudHJ5KS4iKTsKICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICB0dENvbnRleHQuZnVuY3Rpb25zVXNlZFtmdW5jSWRdID0gdHJ1ZTsKICAgICAgICAgICAgICBpZiAoZnVuY0lkIGluIHR0Q29udGV4dC5mdW5jdGlvbnNTdGFja0RlbHRhcykgewogICAgICAgICAgICAgICAgY29uc3QgbmV3U3RhY2tMZW5ndGggPSBzdGFjay5sZW5ndGggKyB0dENvbnRleHQuZnVuY3Rpb25zU3RhY2tEZWx0YXNbZnVuY0lkXTsKICAgICAgICAgICAgICAgIGlmIChuZXdTdGFja0xlbmd0aCA8IDApIHsKICAgICAgICAgICAgICAgICAgKDAsIF91dGlsLndhcm4pKCJUVDogQ0FMTCBpbnZhbGlkIGZ1bmN0aW9ucyBzdGFjayBkZWx0YS4iKTsKICAgICAgICAgICAgICAgICAgdHRDb250ZXh0LmhpbnRzVmFsaWQgPSBmYWxzZTsKICAgICAgICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgc3RhY2subGVuZ3RoID0gbmV3U3RhY2tMZW5ndGg7CiAgICAgICAgICAgICAgfSBlbHNlIGlmIChmdW5jSWQgaW4gdHRDb250ZXh0LmZ1bmN0aW9uc0RlZmluZWQgJiYgIWZ1bmN0aW9uc0NhbGxlZC5pbmNsdWRlcyhmdW5jSWQpKSB7CiAgICAgICAgICAgICAgICBjYWxsc3RhY2sucHVzaCh7CiAgICAgICAgICAgICAgICAgIGRhdGEsCiAgICAgICAgICAgICAgICAgIGksCiAgICAgICAgICAgICAgICAgIHN0YWNrVG9wOiBzdGFjay5sZW5ndGggLSAxCiAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgIGZ1bmN0aW9uc0NhbGxlZC5wdXNoKGZ1bmNJZCk7CiAgICAgICAgICAgICAgICBwYyA9IHR0Q29udGV4dC5mdW5jdGlvbnNEZWZpbmVkW2Z1bmNJZF07CiAgICAgICAgICAgICAgICBpZiAoIXBjKSB7CiAgICAgICAgICAgICAgICAgICgwLCBfdXRpbC53YXJuKSgiVFQ6IENBTEwgbm9uLWV4aXN0ZW50IGZ1bmN0aW9uIik7CiAgICAgICAgICAgICAgICAgIHR0Q29udGV4dC5oaW50c1ZhbGlkID0gZmFsc2U7CiAgICAgICAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIGRhdGEgPSBwYy5kYXRhOwogICAgICAgICAgICAgICAgaSA9IHBjLmk7CiAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgfSBlbHNlIGlmIChvcCA9PT0gMHgyYyAmJiAhdG9vQ29tcGxleFRvRm9sbG93RnVuY3Rpb25zKSB7CiAgICAgICAgICBpZiAoaW5GREVGIHx8IGluRUxTRSkgewogICAgICAgICAgICAoMCwgX3V0aWwud2FybikoIlRUOiBuZXN0ZWQgRkRFRnMgbm90IGFsbG93ZWQiKTsKICAgICAgICAgICAgdG9vQ29tcGxleFRvRm9sbG93RnVuY3Rpb25zID0gdHJ1ZTsKICAgICAgICAgIH0KICAgICAgICAgIGluRkRFRiA9IHRydWU7CiAgICAgICAgICBsYXN0RGVmZiA9IGk7CiAgICAgICAgICBmdW5jSWQgPSBzdGFjay5wb3AoKTsKICAgICAgICAgIHR0Q29udGV4dC5mdW5jdGlvbnNEZWZpbmVkW2Z1bmNJZF0gPSB7CiAgICAgICAgICAgIGRhdGEsCiAgICAgICAgICAgIGkKICAgICAgICAgIH07CiAgICAgICAgfSBlbHNlIGlmIChvcCA9PT0gMHgyZCkgewogICAgICAgICAgaWYgKGluRkRFRikgewogICAgICAgICAgICBpbkZERUYgPSBmYWxzZTsKICAgICAgICAgICAgbGFzdEVuZGYgPSBpOwogICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgcGMgPSBjYWxsc3RhY2sucG9wKCk7CiAgICAgICAgICAgIGlmICghcGMpIHsKICAgICAgICAgICAgICAoMCwgX3V0aWwud2FybikoIlRUOiBFTkRGIGJhZCBzdGFjayIpOwogICAgICAgICAgICAgIHR0Q29udGV4dC5oaW50c1ZhbGlkID0gZmFsc2U7CiAgICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGZ1bmNJZCA9IGZ1bmN0aW9uc0NhbGxlZC5wb3AoKTsKICAgICAgICAgICAgZGF0YSA9IHBjLmRhdGE7CiAgICAgICAgICAgIGkgPSBwYy5pOwogICAgICAgICAgICB0dENvbnRleHQuZnVuY3Rpb25zU3RhY2tEZWx0YXNbZnVuY0lkXSA9IHN0YWNrLmxlbmd0aCAtIHBjLnN0YWNrVG9wOwogICAgICAgICAgfQogICAgICAgIH0gZWxzZSBpZiAob3AgPT09IDB4ODkpIHsKICAgICAgICAgIGlmIChpbkZERUYgfHwgaW5FTFNFKSB7CiAgICAgICAgICAgICgwLCBfdXRpbC53YXJuKSgiVFQ6IG5lc3RlZCBJREVGcyBub3QgYWxsb3dlZCIpOwogICAgICAgICAgICB0b29Db21wbGV4VG9Gb2xsb3dGdW5jdGlvbnMgPSB0cnVlOwogICAgICAgICAgfQogICAgICAgICAgaW5GREVGID0gdHJ1ZTsKICAgICAgICAgIGxhc3REZWZmID0gaTsKICAgICAgICB9IGVsc2UgaWYgKG9wID09PSAweDU4KSB7CiAgICAgICAgICArK2lmTGV2ZWw7CiAgICAgICAgfSBlbHNlIGlmIChvcCA9PT0gMHgxYikgewogICAgICAgICAgaW5FTFNFID0gaWZMZXZlbDsKICAgICAgICB9IGVsc2UgaWYgKG9wID09PSAweDU5KSB7CiAgICAgICAgICBpZiAoaW5FTFNFID09PSBpZkxldmVsKSB7CiAgICAgICAgICAgIGluRUxTRSA9IDA7CiAgICAgICAgICB9CiAgICAgICAgICAtLWlmTGV2ZWw7CiAgICAgICAgfSBlbHNlIGlmIChvcCA9PT0gMHgxYykgewogICAgICAgICAgaWYgKCFpbkZERUYgJiYgIWluRUxTRSkgewogICAgICAgICAgICBjb25zdCBvZmZzZXQgPSBzdGFjay5hdCgtMSk7CiAgICAgICAgICAgIGlmIChvZmZzZXQgPiAwKSB7CiAgICAgICAgICAgICAgaSArPSBvZmZzZXQgLSAxOwogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIGlmICghaW5GREVGICYmICFpbkVMU0UpIHsKICAgICAgICAgIGxldCBzdGFja0RlbHRhID0gMDsKICAgICAgICAgIGlmIChvcCA8PSAweDhlKSB7CiAgICAgICAgICAgIHN0YWNrRGVsdGEgPSBUVE9wc1N0YWNrRGVsdGFzW29wXTsKICAgICAgICAgIH0gZWxzZSBpZiAob3AgPj0gMHhjMCAmJiBvcCA8PSAweGRmKSB7CiAgICAgICAgICAgIHN0YWNrRGVsdGEgPSAtMTsKICAgICAgICAgIH0gZWxzZSBpZiAob3AgPj0gMHhlMCkgewogICAgICAgICAgICBzdGFja0RlbHRhID0gLTI7CiAgICAgICAgICB9CiAgICAgICAgICBpZiAob3AgPj0gMHg3MSAmJiBvcCA8PSAweDc1KSB7CiAgICAgICAgICAgIG4gPSBzdGFjay5wb3AoKTsKICAgICAgICAgICAgaWYgKCFpc05hTihuKSkgewogICAgICAgICAgICAgIHN0YWNrRGVsdGEgPSAtbiAqIDI7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICAgIHdoaWxlIChzdGFja0RlbHRhIDwgMCAmJiBzdGFjay5sZW5ndGggPiAwKSB7CiAgICAgICAgICAgIHN0YWNrLnBvcCgpOwogICAgICAgICAgICBzdGFja0RlbHRhKys7CiAgICAgICAgICB9CiAgICAgICAgICB3aGlsZSAoc3RhY2tEZWx0YSA+IDApIHsKICAgICAgICAgICAgc3RhY2sucHVzaChOYU4pOwogICAgICAgICAgICBzdGFja0RlbHRhLS07CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICB9CiAgICAgIHR0Q29udGV4dC50b29Db21wbGV4VG9Gb2xsb3dGdW5jdGlvbnMgPSB0b29Db21wbGV4VG9Gb2xsb3dGdW5jdGlvbnM7CiAgICAgIGNvbnN0IGNvbnRlbnQgPSBbZGF0YV07CiAgICAgIGlmIChpID4gZGF0YS5sZW5ndGgpIHsKICAgICAgICBjb250ZW50LnB1c2gobmV3IFVpbnQ4QXJyYXkoaSAtIGRhdGEubGVuZ3RoKSk7CiAgICAgIH0KICAgICAgaWYgKGxhc3REZWZmID4gbGFzdEVuZGYpIHsKICAgICAgICAoMCwgX3V0aWwud2FybikoIlRUOiBjb21wbGVtZW50aW5nIGEgbWlzc2luZyBmdW5jdGlvbiB0YWlsIik7CiAgICAgICAgY29udGVudC5wdXNoKG5ldyBVaW50OEFycmF5KFsweDIyLCAweDJkXSkpOwogICAgICB9CiAgICAgIGZvbGRUVFRhYmxlKHRhYmxlLCBjb250ZW50KTsKICAgIH0KICAgIGZ1bmN0aW9uIGNoZWNrSW52YWxpZEZ1bmN0aW9ucyh0dENvbnRleHQsIG1heEZ1bmN0aW9uRGVmcykgewogICAgICBpZiAodHRDb250ZXh0LnRvb0NvbXBsZXhUb0ZvbGxvd0Z1bmN0aW9ucykgewogICAgICAgIHJldHVybjsKICAgICAgfQogICAgICBpZiAodHRDb250ZXh0LmZ1bmN0aW9uc0RlZmluZWQubGVuZ3RoID4gbWF4RnVuY3Rpb25EZWZzKSB7CiAgICAgICAgKDAsIF91dGlsLndhcm4pKCJUVDogbW9yZSBmdW5jdGlvbnMgZGVmaW5lZCB0aGFuIGV4cGVjdGVkIik7CiAgICAgICAgdHRDb250ZXh0LmhpbnRzVmFsaWQgPSBmYWxzZTsKICAgICAgICByZXR1cm47CiAgICAgIH0KICAgICAgZm9yIChsZXQgaiA9IDAsIGpqID0gdHRDb250ZXh0LmZ1bmN0aW9uc1VzZWQubGVuZ3RoOyBqIDwgamo7IGorKykgewogICAgICAgIGlmIChqID4gbWF4RnVuY3Rpb25EZWZzKSB7CiAgICAgICAgICAoMCwgX3V0aWwud2FybikoIlRUOiBpbnZhbGlkIGZ1bmN0aW9uIGlkOiAiICsgaik7CiAgICAgICAgICB0dENvbnRleHQuaGludHNWYWxpZCA9IGZhbHNlOwogICAgICAgICAgcmV0dXJuOwogICAgICAgIH0KICAgICAgICBpZiAodHRDb250ZXh0LmZ1bmN0aW9uc1VzZWRbal0gJiYgIXR0Q29udGV4dC5mdW5jdGlvbnNEZWZpbmVkW2pdKSB7CiAgICAgICAgICAoMCwgX3V0aWwud2FybikoIlRUOiB1bmRlZmluZWQgZnVuY3Rpb246ICIgKyBqKTsKICAgICAgICAgIHR0Q29udGV4dC5oaW50c1ZhbGlkID0gZmFsc2U7CiAgICAgICAgICByZXR1cm47CiAgICAgICAgfQogICAgICB9CiAgICB9CiAgICBmdW5jdGlvbiBmb2xkVFRUYWJsZSh0YWJsZSwgY29udGVudCkgewogICAgICBpZiAoY29udGVudC5sZW5ndGggPiAxKSB7CiAgICAgICAgbGV0IG5ld0xlbmd0aCA9IDA7CiAgICAgICAgbGV0IGosIGpqOwogICAgICAgIGZvciAoaiA9IDAsIGpqID0gY29udGVudC5sZW5ndGg7IGogPCBqajsgaisrKSB7CiAgICAgICAgICBuZXdMZW5ndGggKz0gY29udGVudFtqXS5sZW5ndGg7CiAgICAgICAgfQogICAgICAgIG5ld0xlbmd0aCA9IG5ld0xlbmd0aCArIDMgJiB+MzsKICAgICAgICBjb25zdCByZXN1bHQgPSBuZXcgVWludDhBcnJheShuZXdMZW5ndGgpOwogICAgICAgIGxldCBwb3MgPSAwOwogICAgICAgIGZvciAoaiA9IDAsIGpqID0gY29udGVudC5sZW5ndGg7IGogPCBqajsgaisrKSB7CiAgICAgICAgICByZXN1bHQuc2V0KGNvbnRlbnRbal0sIHBvcyk7CiAgICAgICAgICBwb3MgKz0gY29udGVudFtqXS5sZW5ndGg7CiAgICAgICAgfQogICAgICAgIHRhYmxlLmRhdGEgPSByZXN1bHQ7CiAgICAgICAgdGFibGUubGVuZ3RoID0gbmV3TGVuZ3RoOwogICAgICB9CiAgICB9CiAgICBmdW5jdGlvbiBzYW5pdGl6ZVRUUHJvZ3JhbXMoZnBnbSwgcHJlcCwgY3Z0LCBtYXhGdW5jdGlvbkRlZnMpIHsKICAgICAgY29uc3QgdHRDb250ZXh0ID0gewogICAgICAgIGZ1bmN0aW9uc0RlZmluZWQ6IFtdLAogICAgICAgIGZ1bmN0aW9uc1VzZWQ6IFtdLAogICAgICAgIGZ1bmN0aW9uc1N0YWNrRGVsdGFzOiBbXSwKICAgICAgICB0b29Db21wbGV4VG9Gb2xsb3dGdW5jdGlvbnM6IGZhbHNlLAogICAgICAgIGhpbnRzVmFsaWQ6IHRydWUKICAgICAgfTsKICAgICAgaWYgKGZwZ20pIHsKICAgICAgICBzYW5pdGl6ZVRUUHJvZ3JhbShmcGdtLCB0dENvbnRleHQpOwogICAgICB9CiAgICAgIGlmIChwcmVwKSB7CiAgICAgICAgc2FuaXRpemVUVFByb2dyYW0ocHJlcCwgdHRDb250ZXh0KTsKICAgICAgfQogICAgICBpZiAoZnBnbSkgewogICAgICAgIGNoZWNrSW52YWxpZEZ1bmN0aW9ucyh0dENvbnRleHQsIG1heEZ1bmN0aW9uRGVmcyk7CiAgICAgIH0KICAgICAgaWYgKGN2dCAmJiBjdnQubGVuZ3RoICYgMSkgewogICAgICAgIGNvbnN0IGN2dERhdGEgPSBuZXcgVWludDhBcnJheShjdnQubGVuZ3RoICsgMSk7CiAgICAgICAgY3Z0RGF0YS5zZXQoY3Z0LmRhdGEpOwogICAgICAgIGN2dC5kYXRhID0gY3Z0RGF0YTsKICAgICAgfQogICAgICByZXR1cm4gdHRDb250ZXh0LmhpbnRzVmFsaWQ7CiAgICB9CiAgICBmb250ID0gbmV3IF9zdHJlYW0uU3RyZWFtKG5ldyBVaW50OEFycmF5KGZvbnQuZ2V0Qnl0ZXMoKSkpOwogICAgbGV0IGhlYWRlciwgdGFibGVzOwogICAgaWYgKGlzVHJ1ZVR5cGVDb2xsZWN0aW9uRmlsZShmb250KSkgewogICAgICBjb25zdCB0dGNEYXRhID0gcmVhZFRydWVUeXBlQ29sbGVjdGlvbkRhdGEoZm9udCwgdGhpcy5uYW1lKTsKICAgICAgaGVhZGVyID0gdHRjRGF0YS5oZWFkZXI7CiAgICAgIHRhYmxlcyA9IHR0Y0RhdGEudGFibGVzOwogICAgfSBlbHNlIHsKICAgICAgaGVhZGVyID0gcmVhZE9wZW5UeXBlSGVhZGVyKGZvbnQpOwogICAgICB0YWJsZXMgPSByZWFkVGFibGVzKGZvbnQsIGhlYWRlci5udW1UYWJsZXMpOwogICAgfQogICAgbGV0IGNmZiwgY2ZmRmlsZTsKICAgIGNvbnN0IGlzVHJ1ZVR5cGUgPSAhdGFibGVzWyJDRkYgIl07CiAgICBpZiAoIWlzVHJ1ZVR5cGUpIHsKICAgICAgY29uc3QgaXNDb21wb3NpdGUgPSBwcm9wZXJ0aWVzLmNvbXBvc2l0ZSAmJiAocHJvcGVydGllcy5jaWRUb0dpZE1hcD8ubGVuZ3RoID4gMCB8fCAhKHByb3BlcnRpZXMuY01hcCBpbnN0YW5jZW9mIF9jbWFwLklkZW50aXR5Q01hcCkpOwogICAgICBpZiAoaGVhZGVyLnZlcnNpb24gPT09ICJPVFRPIiAmJiAhaXNDb21wb3NpdGUgfHwgIXRhYmxlcy5oZWFkIHx8ICF0YWJsZXMuaGhlYSB8fCAhdGFibGVzLm1heHAgfHwgIXRhYmxlcy5wb3N0KSB7CiAgICAgICAgY2ZmRmlsZSA9IG5ldyBfc3RyZWFtLlN0cmVhbSh0YWJsZXNbIkNGRiAiXS5kYXRhKTsKICAgICAgICBjZmYgPSBuZXcgX2NmZl9mb250LkNGRkZvbnQoY2ZmRmlsZSwgcHJvcGVydGllcyk7CiAgICAgICAgYWRqdXN0V2lkdGhzKHByb3BlcnRpZXMpOwogICAgICAgIHJldHVybiB0aGlzLmNvbnZlcnQobmFtZSwgY2ZmLCBwcm9wZXJ0aWVzKTsKICAgICAgfQogICAgICBkZWxldGUgdGFibGVzLmdseWY7CiAgICAgIGRlbGV0ZSB0YWJsZXMubG9jYTsKICAgICAgZGVsZXRlIHRhYmxlcy5mcGdtOwogICAgICBkZWxldGUgdGFibGVzLnByZXA7CiAgICAgIGRlbGV0ZSB0YWJsZXNbImN2dCAiXTsKICAgICAgdGhpcy5pc09wZW5UeXBlID0gdHJ1ZTsKICAgIH0gZWxzZSB7CiAgICAgIGlmICghdGFibGVzLmxvY2EpIHsKICAgICAgICB0aHJvdyBuZXcgX3V0aWwuRm9ybWF0RXJyb3IoJ1JlcXVpcmVkICJsb2NhIiB0YWJsZSBpcyBub3QgZm91bmQnKTsKICAgICAgfQogICAgICBpZiAoIXRhYmxlcy5nbHlmKSB7CiAgICAgICAgKDAsIF91dGlsLndhcm4pKCdSZXF1aXJlZCAiZ2x5ZiIgdGFibGUgaXMgbm90IGZvdW5kIC0tIHRyeWluZyB0byByZWNvdmVyLicpOwogICAgICAgIHRhYmxlcy5nbHlmID0gewogICAgICAgICAgdGFnOiAiZ2x5ZiIsCiAgICAgICAgICBkYXRhOiBuZXcgVWludDhBcnJheSgwKQogICAgICAgIH07CiAgICAgIH0KICAgICAgdGhpcy5pc09wZW5UeXBlID0gZmFsc2U7CiAgICB9CiAgICBpZiAoIXRhYmxlcy5tYXhwKSB7CiAgICAgIHRocm93IG5ldyBfdXRpbC5Gb3JtYXRFcnJvcignUmVxdWlyZWQgIm1heHAiIHRhYmxlIGlzIG5vdCBmb3VuZCcpOwogICAgfQogICAgZm9udC5wb3MgPSAoZm9udC5zdGFydCB8fCAwKSArIHRhYmxlcy5tYXhwLm9mZnNldDsKICAgIGNvbnN0IHZlcnNpb24gPSBmb250LmdldEludDMyKCk7CiAgICBjb25zdCBudW1HbHlwaHMgPSBmb250LmdldFVpbnQxNigpOwogICAgaWYgKHByb3BlcnRpZXMuc2NhbGVGYWN0b3JzPy5sZW5ndGggPT09IG51bUdseXBocyAmJiBpc1RydWVUeXBlKSB7CiAgICAgIGNvbnN0IHsKICAgICAgICBzY2FsZUZhY3RvcnMKICAgICAgfSA9IHByb3BlcnRpZXM7CiAgICAgIGNvbnN0IGlzR2x5cGhMb2NhdGlvbnNMb25nID0gaW50MTYodGFibGVzLmhlYWQuZGF0YVs1MF0sIHRhYmxlcy5oZWFkLmRhdGFbNTFdKTsKICAgICAgY29uc3QgZ2x5cGhzID0gbmV3IF9nbHlmLkdseWZUYWJsZSh7CiAgICAgICAgZ2x5ZlRhYmxlOiB0YWJsZXMuZ2x5Zi5kYXRhLAogICAgICAgIGlzR2x5cGhMb2NhdGlvbnNMb25nLAogICAgICAgIGxvY2FUYWJsZTogdGFibGVzLmxvY2EuZGF0YSwKICAgICAgICBudW1HbHlwaHMKICAgICAgfSk7CiAgICAgIGdseXBocy5zY2FsZShzY2FsZUZhY3RvcnMpOwogICAgICBjb25zdCB7CiAgICAgICAgZ2x5ZiwKICAgICAgICBsb2NhLAogICAgICAgIGlzTG9jYXRpb25Mb25nCiAgICAgIH0gPSBnbHlwaHMud3JpdGUoKTsKICAgICAgdGFibGVzLmdseWYuZGF0YSA9IGdseWY7CiAgICAgIHRhYmxlcy5sb2NhLmRhdGEgPSBsb2NhOwogICAgICBpZiAoaXNMb2NhdGlvbkxvbmcgIT09ICEhaXNHbHlwaExvY2F0aW9uc0xvbmcpIHsKICAgICAgICB0YWJsZXMuaGVhZC5kYXRhWzUwXSA9IDA7CiAgICAgICAgdGFibGVzLmhlYWQuZGF0YVs1MV0gPSBpc0xvY2F0aW9uTG9uZyA/IDEgOiAwOwogICAgICB9CiAgICAgIGNvbnN0IG1ldHJpY3MgPSB0YWJsZXMuaG10eC5kYXRhOwogICAgICBmb3IgKGxldCBpID0gMDsgaSA8IG51bUdseXBoczsgaSsrKSB7CiAgICAgICAgY29uc3QgaiA9IDQgKiBpOwogICAgICAgIGNvbnN0IGFkdmFuY2VXaWR0aCA9IE1hdGgucm91bmQoc2NhbGVGYWN0b3JzW2ldICogaW50MTYobWV0cmljc1tqXSwgbWV0cmljc1tqICsgMV0pKTsKICAgICAgICBtZXRyaWNzW2pdID0gYWR2YW5jZVdpZHRoID4+IDggJiAweGZmOwogICAgICAgIG1ldHJpY3NbaiArIDFdID0gYWR2YW5jZVdpZHRoICYgMHhmZjsKICAgICAgICBjb25zdCBsc2IgPSBNYXRoLnJvdW5kKHNjYWxlRmFjdG9yc1tpXSAqIHNpZ25lZEludDE2KG1ldHJpY3NbaiArIDJdLCBtZXRyaWNzW2ogKyAzXSkpOwogICAgICAgIHdyaXRlU2lnbmVkSW50MTYobWV0cmljcywgaiArIDIsIGxzYik7CiAgICAgIH0KICAgIH0KICAgIGxldCBudW1HbHlwaHNPdXQgPSBudW1HbHlwaHMgKyAxOwogICAgbGV0IGR1cEZpcnN0RW50cnkgPSB0cnVlOwogICAgaWYgKG51bUdseXBoc091dCA+IDB4ZmZmZikgewogICAgICBkdXBGaXJzdEVudHJ5ID0gZmFsc2U7CiAgICAgIG51bUdseXBoc091dCA9IG51bUdseXBoczsKICAgICAgKDAsIF91dGlsLndhcm4pKCJOb3QgZW5vdWdoIHNwYWNlIGluIGdseWZzIHRvIGR1cGxpY2F0ZSBmaXJzdCBnbHlwaC4iKTsKICAgIH0KICAgIGxldCBtYXhGdW5jdGlvbkRlZnMgPSAwOwogICAgbGV0IG1heFNpemVPZkluc3RydWN0aW9ucyA9IDA7CiAgICBpZiAodmVyc2lvbiA+PSAweDAwMDEwMDAwICYmIHRhYmxlcy5tYXhwLmxlbmd0aCA+PSAyMikgewogICAgICBmb250LnBvcyArPSA4OwogICAgICBjb25zdCBtYXhab25lcyA9IGZvbnQuZ2V0VWludDE2KCk7CiAgICAgIGlmIChtYXhab25lcyA+IDIpIHsKICAgICAgICB0YWJsZXMubWF4cC5kYXRhWzE0XSA9IDA7CiAgICAgICAgdGFibGVzLm1heHAuZGF0YVsxNV0gPSAyOwogICAgICB9CiAgICAgIGZvbnQucG9zICs9IDQ7CiAgICAgIG1heEZ1bmN0aW9uRGVmcyA9IGZvbnQuZ2V0VWludDE2KCk7CiAgICAgIGZvbnQucG9zICs9IDQ7CiAgICAgIG1heFNpemVPZkluc3RydWN0aW9ucyA9IGZvbnQuZ2V0VWludDE2KCk7CiAgICB9CiAgICB0YWJsZXMubWF4cC5kYXRhWzRdID0gbnVtR2x5cGhzT3V0ID4+IDg7CiAgICB0YWJsZXMubWF4cC5kYXRhWzVdID0gbnVtR2x5cGhzT3V0ICYgMjU1OwogICAgY29uc3QgaGludHNWYWxpZCA9IHNhbml0aXplVFRQcm9ncmFtcyh0YWJsZXMuZnBnbSwgdGFibGVzLnByZXAsIHRhYmxlc1siY3Z0ICJdLCBtYXhGdW5jdGlvbkRlZnMpOwogICAgaWYgKCFoaW50c1ZhbGlkKSB7CiAgICAgIGRlbGV0ZSB0YWJsZXMuZnBnbTsKICAgICAgZGVsZXRlIHRhYmxlcy5wcmVwOwogICAgICBkZWxldGUgdGFibGVzWyJjdnQgIl07CiAgICB9CiAgICBzYW5pdGl6ZU1ldHJpY3MoZm9udCwgdGFibGVzLmhoZWEsIHRhYmxlcy5obXR4LCB0YWJsZXMuaGVhZCwgbnVtR2x5cGhzT3V0LCBkdXBGaXJzdEVudHJ5KTsKICAgIGlmICghdGFibGVzLmhlYWQpIHsKICAgICAgdGhyb3cgbmV3IF91dGlsLkZvcm1hdEVycm9yKCdSZXF1aXJlZCAiaGVhZCIgdGFibGUgaXMgbm90IGZvdW5kJyk7CiAgICB9CiAgICBzYW5pdGl6ZUhlYWQodGFibGVzLmhlYWQsIG51bUdseXBocywgaXNUcnVlVHlwZSA/IHRhYmxlcy5sb2NhLmxlbmd0aCA6IDApOwogICAgbGV0IG1pc3NpbmdHbHlwaHMgPSBPYmplY3QuY3JlYXRlKG51bGwpOwogICAgaWYgKGlzVHJ1ZVR5cGUpIHsKICAgICAgY29uc3QgaXNHbHlwaExvY2F0aW9uc0xvbmcgPSBpbnQxNih0YWJsZXMuaGVhZC5kYXRhWzUwXSwgdGFibGVzLmhlYWQuZGF0YVs1MV0pOwogICAgICBjb25zdCBnbHlwaHNJbmZvID0gc2FuaXRpemVHbHlwaExvY2F0aW9ucyh0YWJsZXMubG9jYSwgdGFibGVzLmdseWYsIG51bUdseXBocywgaXNHbHlwaExvY2F0aW9uc0xvbmcsIGhpbnRzVmFsaWQsIGR1cEZpcnN0RW50cnksIG1heFNpemVPZkluc3RydWN0aW9ucyk7CiAgICAgIG1pc3NpbmdHbHlwaHMgPSBnbHlwaHNJbmZvLm1pc3NpbmdHbHlwaHM7CiAgICAgIGlmICh2ZXJzaW9uID49IDB4MDAwMTAwMDAgJiYgdGFibGVzLm1heHAubGVuZ3RoID49IDIyKSB7CiAgICAgICAgdGFibGVzLm1heHAuZGF0YVsyNl0gPSBnbHlwaHNJbmZvLm1heFNpemVPZkluc3RydWN0aW9ucyA+PiA4OwogICAgICAgIHRhYmxlcy5tYXhwLmRhdGFbMjddID0gZ2x5cGhzSW5mby5tYXhTaXplT2ZJbnN0cnVjdGlvbnMgJiAyNTU7CiAgICAgIH0KICAgIH0KICAgIGlmICghdGFibGVzLmhoZWEpIHsKICAgICAgdGhyb3cgbmV3IF91dGlsLkZvcm1hdEVycm9yKCdSZXF1aXJlZCAiaGhlYSIgdGFibGUgaXMgbm90IGZvdW5kJyk7CiAgICB9CiAgICBpZiAodGFibGVzLmhoZWEuZGF0YVsxMF0gPT09IDAgJiYgdGFibGVzLmhoZWEuZGF0YVsxMV0gPT09IDApIHsKICAgICAgdGFibGVzLmhoZWEuZGF0YVsxMF0gPSAweGZmOwogICAgICB0YWJsZXMuaGhlYS5kYXRhWzExXSA9IDB4ZmY7CiAgICB9CiAgICBjb25zdCBtZXRyaWNzT3ZlcnJpZGUgPSB7CiAgICAgIHVuaXRzUGVyRW06IGludDE2KHRhYmxlcy5oZWFkLmRhdGFbMThdLCB0YWJsZXMuaGVhZC5kYXRhWzE5XSksCiAgICAgIHlNYXg6IHNpZ25lZEludDE2KHRhYmxlcy5oZWFkLmRhdGFbNDJdLCB0YWJsZXMuaGVhZC5kYXRhWzQzXSksCiAgICAgIHlNaW46IHNpZ25lZEludDE2KHRhYmxlcy5oZWFkLmRhdGFbMzhdLCB0YWJsZXMuaGVhZC5kYXRhWzM5XSksCiAgICAgIGFzY2VudDogc2lnbmVkSW50MTYodGFibGVzLmhoZWEuZGF0YVs0XSwgdGFibGVzLmhoZWEuZGF0YVs1XSksCiAgICAgIGRlc2NlbnQ6IHNpZ25lZEludDE2KHRhYmxlcy5oaGVhLmRhdGFbNl0sIHRhYmxlcy5oaGVhLmRhdGFbN10pLAogICAgICBsaW5lR2FwOiBzaWduZWRJbnQxNih0YWJsZXMuaGhlYS5kYXRhWzhdLCB0YWJsZXMuaGhlYS5kYXRhWzldKQogICAgfTsKICAgIHRoaXMuYXNjZW50ID0gbWV0cmljc092ZXJyaWRlLmFzY2VudCAvIG1ldHJpY3NPdmVycmlkZS51bml0c1BlckVtOwogICAgdGhpcy5kZXNjZW50ID0gbWV0cmljc092ZXJyaWRlLmRlc2NlbnQgLyBtZXRyaWNzT3ZlcnJpZGUudW5pdHNQZXJFbTsKICAgIHRoaXMubGluZUdhcCA9IG1ldHJpY3NPdmVycmlkZS5saW5lR2FwIC8gbWV0cmljc092ZXJyaWRlLnVuaXRzUGVyRW07CiAgICBpZiAodGhpcy5jc3NGb250SW5mbz8ubGluZUhlaWdodCkgewogICAgICB0aGlzLmxpbmVIZWlnaHQgPSB0aGlzLmNzc0ZvbnRJbmZvLm1ldHJpY3MubGluZUhlaWdodDsKICAgICAgdGhpcy5saW5lR2FwID0gdGhpcy5jc3NGb250SW5mby5tZXRyaWNzLmxpbmVHYXA7CiAgICB9IGVsc2UgewogICAgICB0aGlzLmxpbmVIZWlnaHQgPSB0aGlzLmFzY2VudCAtIHRoaXMuZGVzY2VudCArIHRoaXMubGluZUdhcDsKICAgIH0KICAgIGlmICh0YWJsZXMucG9zdCkgewogICAgICByZWFkUG9zdFNjcmlwdFRhYmxlKHRhYmxlcy5wb3N0LCBwcm9wZXJ0aWVzLCBudW1HbHlwaHMpOwogICAgfQogICAgdGFibGVzLnBvc3QgPSB7CiAgICAgIHRhZzogInBvc3QiLAogICAgICBkYXRhOiBjcmVhdGVQb3N0VGFibGUocHJvcGVydGllcykKICAgIH07CiAgICBjb25zdCBjaGFyQ29kZVRvR2x5cGhJZCA9IFtdOwogICAgZnVuY3Rpb24gaGFzR2x5cGgoZ2x5cGhJZCkgewogICAgICByZXR1cm4gIW1pc3NpbmdHbHlwaHNbZ2x5cGhJZF07CiAgICB9CiAgICBpZiAocHJvcGVydGllcy5jb21wb3NpdGUpIHsKICAgICAgY29uc3QgY2lkVG9HaWRNYXAgPSBwcm9wZXJ0aWVzLmNpZFRvR2lkTWFwIHx8IFtdOwogICAgICBjb25zdCBpc0NpZFRvR2lkTWFwRW1wdHkgPSBjaWRUb0dpZE1hcC5sZW5ndGggPT09IDA7CiAgICAgIHByb3BlcnRpZXMuY01hcC5mb3JFYWNoKGZ1bmN0aW9uIChjaGFyQ29kZSwgY2lkKSB7CiAgICAgICAgaWYgKHR5cGVvZiBjaWQgPT09ICJzdHJpbmciKSB7CiAgICAgICAgICBjaWQgPSBjb252ZXJ0Q2lkU3RyaW5nKGNoYXJDb2RlLCBjaWQsIHRydWUpOwogICAgICAgIH0KICAgICAgICBpZiAoY2lkID4gMHhmZmZmKSB7CiAgICAgICAgICB0aHJvdyBuZXcgX3V0aWwuRm9ybWF0RXJyb3IoIk1heCBzaXplIG9mIENJRCBpcyA2NSw1MzUiKTsKICAgICAgICB9CiAgICAgICAgbGV0IGdseXBoSWQgPSAtMTsKICAgICAgICBpZiAoaXNDaWRUb0dpZE1hcEVtcHR5KSB7CiAgICAgICAgICBnbHlwaElkID0gY2lkOwogICAgICAgIH0gZWxzZSBpZiAoY2lkVG9HaWRNYXBbY2lkXSAhPT0gdW5kZWZpbmVkKSB7CiAgICAgICAgICBnbHlwaElkID0gY2lkVG9HaWRNYXBbY2lkXTsKICAgICAgICB9CiAgICAgICAgaWYgKGdseXBoSWQgPj0gMCAmJiBnbHlwaElkIDwgbnVtR2x5cGhzICYmIGhhc0dseXBoKGdseXBoSWQpKSB7CiAgICAgICAgICBjaGFyQ29kZVRvR2x5cGhJZFtjaGFyQ29kZV0gPSBnbHlwaElkOwogICAgICAgIH0KICAgICAgfSk7CiAgICB9IGVsc2UgewogICAgICBjb25zdCBjbWFwVGFibGUgPSByZWFkQ21hcFRhYmxlKHRhYmxlcy5jbWFwLCBmb250LCB0aGlzLmlzU3ltYm9saWNGb250LCBwcm9wZXJ0aWVzLmhhc0VuY29kaW5nKTsKICAgICAgY29uc3QgY21hcFBsYXRmb3JtSWQgPSBjbWFwVGFibGUucGxhdGZvcm1JZDsKICAgICAgY29uc3QgY21hcEVuY29kaW5nSWQgPSBjbWFwVGFibGUuZW5jb2RpbmdJZDsKICAgICAgY29uc3QgY21hcE1hcHBpbmdzID0gY21hcFRhYmxlLm1hcHBpbmdzOwogICAgICBsZXQgYmFzZUVuY29kaW5nID0gW10sCiAgICAgICAgZm9yY2VQb3N0VGFibGUgPSBmYWxzZTsKICAgICAgaWYgKHByb3BlcnRpZXMuaGFzRW5jb2RpbmcgJiYgKHByb3BlcnRpZXMuYmFzZUVuY29kaW5nTmFtZSA9PT0gIk1hY1JvbWFuRW5jb2RpbmciIHx8IHByb3BlcnRpZXMuYmFzZUVuY29kaW5nTmFtZSA9PT0gIldpbkFuc2lFbmNvZGluZyIpKSB7CiAgICAgICAgYmFzZUVuY29kaW5nID0gKDAsIF9lbmNvZGluZ3MuZ2V0RW5jb2RpbmcpKHByb3BlcnRpZXMuYmFzZUVuY29kaW5nTmFtZSk7CiAgICAgIH0KICAgICAgaWYgKHByb3BlcnRpZXMuaGFzRW5jb2RpbmcgJiYgIXRoaXMuaXNTeW1ib2xpY0ZvbnQgJiYgKGNtYXBQbGF0Zm9ybUlkID09PSAzICYmIGNtYXBFbmNvZGluZ0lkID09PSAxIHx8IGNtYXBQbGF0Zm9ybUlkID09PSAxICYmIGNtYXBFbmNvZGluZ0lkID09PSAwKSkgewogICAgICAgIGNvbnN0IGdseXBoc1VuaWNvZGVNYXAgPSAoMCwgX2dseXBobGlzdC5nZXRHbHlwaHNVbmljb2RlKSgpOwogICAgICAgIGZvciAobGV0IGNoYXJDb2RlID0gMDsgY2hhckNvZGUgPCAyNTY7IGNoYXJDb2RlKyspIHsKICAgICAgICAgIGxldCBnbHlwaE5hbWU7CiAgICAgICAgICBpZiAodGhpcy5kaWZmZXJlbmNlc1tjaGFyQ29kZV0gIT09IHVuZGVmaW5lZCkgewogICAgICAgICAgICBnbHlwaE5hbWUgPSB0aGlzLmRpZmZlcmVuY2VzW2NoYXJDb2RlXTsKICAgICAgICAgIH0gZWxzZSBpZiAoYmFzZUVuY29kaW5nLmxlbmd0aCAmJiBiYXNlRW5jb2RpbmdbY2hhckNvZGVdICE9PSAiIikgewogICAgICAgICAgICBnbHlwaE5hbWUgPSBiYXNlRW5jb2RpbmdbY2hhckNvZGVdOwogICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgZ2x5cGhOYW1lID0gX2VuY29kaW5ncy5TdGFuZGFyZEVuY29kaW5nW2NoYXJDb2RlXTsKICAgICAgICAgIH0KICAgICAgICAgIGlmICghZ2x5cGhOYW1lKSB7CiAgICAgICAgICAgIGNvbnRpbnVlOwogICAgICAgICAgfQogICAgICAgICAgY29uc3Qgc3RhbmRhcmRHbHlwaE5hbWUgPSAoMCwgX2ZvbnRzX3V0aWxzLnJlY292ZXJHbHlwaE5hbWUpKGdseXBoTmFtZSwgZ2x5cGhzVW5pY29kZU1hcCk7CiAgICAgICAgICBsZXQgdW5pY29kZU9yQ2hhckNvZGU7CiAgICAgICAgICBpZiAoY21hcFBsYXRmb3JtSWQgPT09IDMgJiYgY21hcEVuY29kaW5nSWQgPT09IDEpIHsKICAgICAgICAgICAgdW5pY29kZU9yQ2hhckNvZGUgPSBnbHlwaHNVbmljb2RlTWFwW3N0YW5kYXJkR2x5cGhOYW1lXTsKICAgICAgICAgIH0gZWxzZSBpZiAoY21hcFBsYXRmb3JtSWQgPT09IDEgJiYgY21hcEVuY29kaW5nSWQgPT09IDApIHsKICAgICAgICAgICAgdW5pY29kZU9yQ2hhckNvZGUgPSBfZW5jb2RpbmdzLk1hY1JvbWFuRW5jb2RpbmcuaW5kZXhPZihzdGFuZGFyZEdseXBoTmFtZSk7CiAgICAgICAgICB9CiAgICAgICAgICBpZiAodW5pY29kZU9yQ2hhckNvZGUgPT09IHVuZGVmaW5lZCkgewogICAgICAgICAgICBpZiAoIXByb3BlcnRpZXMuZ2x5cGhOYW1lcyAmJiBwcm9wZXJ0aWVzLmhhc0luY2x1ZGVkVG9Vbmljb2RlTWFwICYmICEodGhpcy50b1VuaWNvZGUgaW5zdGFuY2VvZiBfdG9fdW5pY29kZV9tYXAuSWRlbnRpdHlUb1VuaWNvZGVNYXApKSB7CiAgICAgICAgICAgICAgY29uc3QgdW5pY29kZSA9IHRoaXMudG9Vbmljb2RlLmdldChjaGFyQ29kZSk7CiAgICAgICAgICAgICAgaWYgKHVuaWNvZGUpIHsKICAgICAgICAgICAgICAgIHVuaWNvZGVPckNoYXJDb2RlID0gdW5pY29kZS5jb2RlUG9pbnRBdCgwKTsKICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICAgICAgaWYgKHVuaWNvZGVPckNoYXJDb2RlID09PSB1bmRlZmluZWQpIHsKICAgICAgICAgICAgICBjb250aW51ZTsKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgICAgZm9yIChjb25zdCBtYXBwaW5nIG9mIGNtYXBNYXBwaW5ncykgewogICAgICAgICAgICBpZiAobWFwcGluZy5jaGFyQ29kZSAhPT0gdW5pY29kZU9yQ2hhckNvZGUpIHsKICAgICAgICAgICAgICBjb250aW51ZTsKICAgICAgICAgICAgfQogICAgICAgICAgICBjaGFyQ29kZVRvR2x5cGhJZFtjaGFyQ29kZV0gPSBtYXBwaW5nLmdseXBoSWQ7CiAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgfQogICAgICAgIH0KICAgICAgfSBlbHNlIGlmIChjbWFwUGxhdGZvcm1JZCA9PT0gMCkgewogICAgICAgIGZvciAoY29uc3QgbWFwcGluZyBvZiBjbWFwTWFwcGluZ3MpIHsKICAgICAgICAgIGNoYXJDb2RlVG9HbHlwaElkW21hcHBpbmcuY2hhckNvZGVdID0gbWFwcGluZy5nbHlwaElkOwogICAgICAgIH0KICAgICAgICBmb3JjZVBvc3RUYWJsZSA9IHRydWU7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgZm9yIChjb25zdCBtYXBwaW5nIG9mIGNtYXBNYXBwaW5ncykgewogICAgICAgICAgbGV0IGNoYXJDb2RlID0gbWFwcGluZy5jaGFyQ29kZTsKICAgICAgICAgIGlmIChjbWFwUGxhdGZvcm1JZCA9PT0gMyAmJiBjaGFyQ29kZSA+PSAweGYwMDAgJiYgY2hhckNvZGUgPD0gMHhmMGZmKSB7CiAgICAgICAgICAgIGNoYXJDb2RlICY9IDB4ZmY7CiAgICAgICAgICB9CiAgICAgICAgICBjaGFyQ29kZVRvR2x5cGhJZFtjaGFyQ29kZV0gPSBtYXBwaW5nLmdseXBoSWQ7CiAgICAgICAgfQogICAgICB9CiAgICAgIGlmIChwcm9wZXJ0aWVzLmdseXBoTmFtZXMgJiYgKGJhc2VFbmNvZGluZy5sZW5ndGggfHwgdGhpcy5kaWZmZXJlbmNlcy5sZW5ndGgpKSB7CiAgICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCAyNTY7ICsraSkgewogICAgICAgICAgaWYgKCFmb3JjZVBvc3RUYWJsZSAmJiBjaGFyQ29kZVRvR2x5cGhJZFtpXSAhPT0gdW5kZWZpbmVkKSB7CiAgICAgICAgICAgIGNvbnRpbnVlOwogICAgICAgICAgfQogICAgICAgICAgY29uc3QgZ2x5cGhOYW1lID0gdGhpcy5kaWZmZXJlbmNlc1tpXSB8fCBiYXNlRW5jb2RpbmdbaV07CiAgICAgICAgICBpZiAoIWdseXBoTmFtZSkgewogICAgICAgICAgICBjb250aW51ZTsKICAgICAgICAgIH0KICAgICAgICAgIGNvbnN0IGdseXBoSWQgPSBwcm9wZXJ0aWVzLmdseXBoTmFtZXMuaW5kZXhPZihnbHlwaE5hbWUpOwogICAgICAgICAgaWYgKGdseXBoSWQgPiAwICYmIGhhc0dseXBoKGdseXBoSWQpKSB7CiAgICAgICAgICAgIGNoYXJDb2RlVG9HbHlwaElkW2ldID0gZ2x5cGhJZDsKICAgICAgICAgIH0KICAgICAgICB9CiAgICAgIH0KICAgIH0KICAgIGlmIChjaGFyQ29kZVRvR2x5cGhJZC5sZW5ndGggPT09IDApIHsKICAgICAgY2hhckNvZGVUb0dseXBoSWRbMF0gPSAwOwogICAgfQogICAgbGV0IGdseXBoWmVyb0lkID0gbnVtR2x5cGhzT3V0IC0gMTsKICAgIGlmICghZHVwRmlyc3RFbnRyeSkgewogICAgICBnbHlwaFplcm9JZCA9IDA7CiAgICB9CiAgICBpZiAoIXByb3BlcnRpZXMuY3NzRm9udEluZm8pIHsKICAgICAgY29uc3QgbmV3TWFwcGluZyA9IGFkanVzdE1hcHBpbmcoY2hhckNvZGVUb0dseXBoSWQsIGhhc0dseXBoLCBnbHlwaFplcm9JZCwgdGhpcy50b1VuaWNvZGUpOwogICAgICB0aGlzLnRvRm9udENoYXIgPSBuZXdNYXBwaW5nLnRvRm9udENoYXI7CiAgICAgIHRhYmxlcy5jbWFwID0gewogICAgICAgIHRhZzogImNtYXAiLAogICAgICAgIGRhdGE6IGNyZWF0ZUNtYXBUYWJsZShuZXdNYXBwaW5nLmNoYXJDb2RlVG9HbHlwaElkLCBuZXdNYXBwaW5nLnRvVW5pY29kZUV4dHJhTWFwLCBudW1HbHlwaHNPdXQpCiAgICAgIH07CiAgICAgIGlmICghdGFibGVzWyJPUy8yIl0gfHwgIXZhbGlkYXRlT1MyVGFibGUodGFibGVzWyJPUy8yIl0sIGZvbnQpKSB7CiAgICAgICAgdGFibGVzWyJPUy8yIl0gPSB7CiAgICAgICAgICB0YWc6ICJPUy8yIiwKICAgICAgICAgIGRhdGE6IGNyZWF0ZU9TMlRhYmxlKHByb3BlcnRpZXMsIG5ld01hcHBpbmcuY2hhckNvZGVUb0dseXBoSWQsIG1ldHJpY3NPdmVycmlkZSkKICAgICAgICB9OwogICAgICB9CiAgICB9CiAgICBpZiAoIWlzVHJ1ZVR5cGUpIHsKICAgICAgdHJ5IHsKICAgICAgICBjZmZGaWxlID0gbmV3IF9zdHJlYW0uU3RyZWFtKHRhYmxlc1siQ0ZGICJdLmRhdGEpOwogICAgICAgIGNvbnN0IHBhcnNlciA9IG5ldyBfY2ZmX3BhcnNlci5DRkZQYXJzZXIoY2ZmRmlsZSwgcHJvcGVydGllcywgX2ZvbnRzX3V0aWxzLlNFQUNfQU5BTFlTSVNfRU5BQkxFRCk7CiAgICAgICAgY2ZmID0gcGFyc2VyLnBhcnNlKCk7CiAgICAgICAgY2ZmLmR1cGxpY2F0ZUZpcnN0R2x5cGgoKTsKICAgICAgICBjb25zdCBjb21waWxlciA9IG5ldyBfY2ZmX3BhcnNlci5DRkZDb21waWxlcihjZmYpOwogICAgICAgIHRhYmxlc1siQ0ZGICJdLmRhdGEgPSBjb21waWxlci5jb21waWxlKCk7CiAgICAgIH0gY2F0Y2ggewogICAgICAgICgwLCBfdXRpbC53YXJuKSgiRmFpbGVkIHRvIGNvbXBpbGUgZm9udCAiICsgcHJvcGVydGllcy5sb2FkZWROYW1lKTsKICAgICAgfQogICAgfQogICAgaWYgKCF0YWJsZXMubmFtZSkgewogICAgICB0YWJsZXMubmFtZSA9IHsKICAgICAgICB0YWc6ICJuYW1lIiwKICAgICAgICBkYXRhOiBjcmVhdGVOYW1lVGFibGUodGhpcy5uYW1lKQogICAgICB9OwogICAgfSBlbHNlIHsKICAgICAgY29uc3QgW25hbWVQcm90b3R5cGUsIG5hbWVSZWNvcmRzXSA9IHJlYWROYW1lVGFibGUodGFibGVzLm5hbWUpOwogICAgICB0YWJsZXMubmFtZS5kYXRhID0gY3JlYXRlTmFtZVRhYmxlKG5hbWUsIG5hbWVQcm90b3R5cGUpOwogICAgICB0aGlzLnBzTmFtZSA9IG5hbWVQcm90b3R5cGVbMF1bNl0gfHwgbnVsbDsKICAgICAgaWYgKCFwcm9wZXJ0aWVzLmNvbXBvc2l0ZSkgewogICAgICAgIGFkanVzdFRydWVUeXBlVG9Vbmljb2RlKHByb3BlcnRpZXMsIHRoaXMuaXNTeW1ib2xpY0ZvbnQsIG5hbWVSZWNvcmRzKTsKICAgICAgfQogICAgfQogICAgY29uc3QgYnVpbGRlciA9IG5ldyBfb3BlbnR5cGVfZmlsZV9idWlsZGVyLk9wZW5UeXBlRmlsZUJ1aWxkZXIoaGVhZGVyLnZlcnNpb24pOwogICAgZm9yIChjb25zdCB0YWJsZVRhZyBpbiB0YWJsZXMpIHsKICAgICAgYnVpbGRlci5hZGRUYWJsZSh0YWJsZVRhZywgdGFibGVzW3RhYmxlVGFnXS5kYXRhKTsKICAgIH0KICAgIHJldHVybiBidWlsZGVyLnRvQXJyYXkoKTsKICB9CiAgY29udmVydChmb250TmFtZSwgZm9udCwgcHJvcGVydGllcykgewogICAgcHJvcGVydGllcy5maXhlZFBpdGNoID0gZmFsc2U7CiAgICBpZiAocHJvcGVydGllcy5idWlsdEluRW5jb2RpbmcpIHsKICAgICAgYWRqdXN0VHlwZTFUb1VuaWNvZGUocHJvcGVydGllcywgcHJvcGVydGllcy5idWlsdEluRW5jb2RpbmcpOwogICAgfQogICAgbGV0IGdseXBoWmVyb0lkID0gMTsKICAgIGlmIChmb250IGluc3RhbmNlb2YgX2NmZl9mb250LkNGRkZvbnQpIHsKICAgICAgZ2x5cGhaZXJvSWQgPSBmb250Lm51bUdseXBocyAtIDE7CiAgICB9CiAgICBjb25zdCBtYXBwaW5nID0gZm9udC5nZXRHbHlwaE1hcHBpbmcocHJvcGVydGllcyk7CiAgICBsZXQgbmV3TWFwcGluZyA9IG51bGw7CiAgICBsZXQgbmV3Q2hhckNvZGVUb0dseXBoSWQgPSBtYXBwaW5nOwogICAgbGV0IHRvVW5pY29kZUV4dHJhTWFwID0gbnVsbDsKICAgIGlmICghcHJvcGVydGllcy5jc3NGb250SW5mbykgewogICAgICBuZXdNYXBwaW5nID0gYWRqdXN0TWFwcGluZyhtYXBwaW5nLCBmb250Lmhhc0dseXBoSWQuYmluZChmb250KSwgZ2x5cGhaZXJvSWQsIHRoaXMudG9Vbmljb2RlKTsKICAgICAgdGhpcy50b0ZvbnRDaGFyID0gbmV3TWFwcGluZy50b0ZvbnRDaGFyOwogICAgICBuZXdDaGFyQ29kZVRvR2x5cGhJZCA9IG5ld01hcHBpbmcuY2hhckNvZGVUb0dseXBoSWQ7CiAgICAgIHRvVW5pY29kZUV4dHJhTWFwID0gbmV3TWFwcGluZy50b1VuaWNvZGVFeHRyYU1hcDsKICAgIH0KICAgIGNvbnN0IG51bUdseXBocyA9IGZvbnQubnVtR2x5cGhzOwogICAgZnVuY3Rpb24gZ2V0Q2hhckNvZGVzKGNoYXJDb2RlVG9HbHlwaElkLCBnbHlwaElkKSB7CiAgICAgIGxldCBjaGFyQ29kZXMgPSBudWxsOwogICAgICBmb3IgKGNvbnN0IGNoYXJDb2RlIGluIGNoYXJDb2RlVG9HbHlwaElkKSB7CiAgICAgICAgaWYgKGdseXBoSWQgPT09IGNoYXJDb2RlVG9HbHlwaElkW2NoYXJDb2RlXSkgewogICAgICAgICAgKGNoYXJDb2RlcyB8fD0gW10pLnB1c2goY2hhckNvZGUgfCAwKTsKICAgICAgICB9CiAgICAgIH0KICAgICAgcmV0dXJuIGNoYXJDb2RlczsKICAgIH0KICAgIGZ1bmN0aW9uIGNyZWF0ZUNoYXJDb2RlKGNoYXJDb2RlVG9HbHlwaElkLCBnbHlwaElkKSB7CiAgICAgIGZvciAoY29uc3QgY2hhckNvZGUgaW4gY2hhckNvZGVUb0dseXBoSWQpIHsKICAgICAgICBpZiAoZ2x5cGhJZCA9PT0gY2hhckNvZGVUb0dseXBoSWRbY2hhckNvZGVdKSB7CiAgICAgICAgICByZXR1cm4gY2hhckNvZGUgfCAwOwogICAgICAgIH0KICAgICAgfQogICAgICBuZXdNYXBwaW5nLmNoYXJDb2RlVG9HbHlwaElkW25ld01hcHBpbmcubmV4dEF2YWlsYWJsZUZvbnRDaGFyQ29kZV0gPSBnbHlwaElkOwogICAgICByZXR1cm4gbmV3TWFwcGluZy5uZXh0QXZhaWxhYmxlRm9udENoYXJDb2RlKys7CiAgICB9CiAgICBjb25zdCBzZWFjcyA9IGZvbnQuc2VhY3M7CiAgICBpZiAobmV3TWFwcGluZyAmJiBfZm9udHNfdXRpbHMuU0VBQ19BTkFMWVNJU19FTkFCTEVEICYmIHNlYWNzPy5sZW5ndGgpIHsKICAgICAgY29uc3QgbWF0cml4ID0gcHJvcGVydGllcy5mb250TWF0cml4IHx8IF91dGlsLkZPTlRfSURFTlRJVFlfTUFUUklYOwogICAgICBjb25zdCBjaGFyc2V0ID0gZm9udC5nZXRDaGFyc2V0KCk7CiAgICAgIGNvbnN0IHNlYWNNYXAgPSBPYmplY3QuY3JlYXRlKG51bGwpOwogICAgICBmb3IgKGxldCBnbHlwaElkIGluIHNlYWNzKSB7CiAgICAgICAgZ2x5cGhJZCB8PSAwOwogICAgICAgIGNvbnN0IHNlYWMgPSBzZWFjc1tnbHlwaElkXTsKICAgICAgICBjb25zdCBiYXNlR2x5cGhOYW1lID0gX2VuY29kaW5ncy5TdGFuZGFyZEVuY29kaW5nW3NlYWNbMl1dOwogICAgICAgIGNvbnN0IGFjY2VudEdseXBoTmFtZSA9IF9lbmNvZGluZ3MuU3RhbmRhcmRFbmNvZGluZ1tzZWFjWzNdXTsKICAgICAgICBjb25zdCBiYXNlR2x5cGhJZCA9IGNoYXJzZXQuaW5kZXhPZihiYXNlR2x5cGhOYW1lKTsKICAgICAgICBjb25zdCBhY2NlbnRHbHlwaElkID0gY2hhcnNldC5pbmRleE9mKGFjY2VudEdseXBoTmFtZSk7CiAgICAgICAgaWYgKGJhc2VHbHlwaElkIDwgMCB8fCBhY2NlbnRHbHlwaElkIDwgMCkgewogICAgICAgICAgY29udGludWU7CiAgICAgICAgfQogICAgICAgIGNvbnN0IGFjY2VudE9mZnNldCA9IHsKICAgICAgICAgIHg6IHNlYWNbMF0gKiBtYXRyaXhbMF0gKyBzZWFjWzFdICogbWF0cml4WzJdICsgbWF0cml4WzRdLAogICAgICAgICAgeTogc2VhY1swXSAqIG1hdHJpeFsxXSArIHNlYWNbMV0gKiBtYXRyaXhbM10gKyBtYXRyaXhbNV0KICAgICAgICB9OwogICAgICAgIGNvbnN0IGNoYXJDb2RlcyA9IGdldENoYXJDb2RlcyhtYXBwaW5nLCBnbHlwaElkKTsKICAgICAgICBpZiAoIWNoYXJDb2RlcykgewogICAgICAgICAgY29udGludWU7CiAgICAgICAgfQogICAgICAgIGZvciAoY29uc3QgY2hhckNvZGUgb2YgY2hhckNvZGVzKSB7CiAgICAgICAgICBjb25zdCBjaGFyQ29kZVRvR2x5cGhJZCA9IG5ld01hcHBpbmcuY2hhckNvZGVUb0dseXBoSWQ7CiAgICAgICAgICBjb25zdCBiYXNlRm9udENoYXJDb2RlID0gY3JlYXRlQ2hhckNvZGUoY2hhckNvZGVUb0dseXBoSWQsIGJhc2VHbHlwaElkKTsKICAgICAgICAgIGNvbnN0IGFjY2VudEZvbnRDaGFyQ29kZSA9IGNyZWF0ZUNoYXJDb2RlKGNoYXJDb2RlVG9HbHlwaElkLCBhY2NlbnRHbHlwaElkKTsKICAgICAgICAgIHNlYWNNYXBbY2hhckNvZGVdID0gewogICAgICAgICAgICBiYXNlRm9udENoYXJDb2RlLAogICAgICAgICAgICBhY2NlbnRGb250Q2hhckNvZGUsCiAgICAgICAgICAgIGFjY2VudE9mZnNldAogICAgICAgICAgfTsKICAgICAgICB9CiAgICAgIH0KICAgICAgcHJvcGVydGllcy5zZWFjTWFwID0gc2VhY01hcDsKICAgIH0KICAgIGNvbnN0IHVuaXRzUGVyRW0gPSAxIC8gKHByb3BlcnRpZXMuZm9udE1hdHJpeCB8fCBfdXRpbC5GT05UX0lERU5USVRZX01BVFJJWClbMF07CiAgICBjb25zdCBidWlsZGVyID0gbmV3IF9vcGVudHlwZV9maWxlX2J1aWxkZXIuT3BlblR5cGVGaWxlQnVpbGRlcigiXHg0Rlx4NTRceDU0XHg0RiIpOwogICAgYnVpbGRlci5hZGRUYWJsZSgiQ0ZGICIsIGZvbnQuZGF0YSk7CiAgICBidWlsZGVyLmFkZFRhYmxlKCJPUy8yIiwgY3JlYXRlT1MyVGFibGUocHJvcGVydGllcywgbmV3Q2hhckNvZGVUb0dseXBoSWQpKTsKICAgIGJ1aWxkZXIuYWRkVGFibGUoImNtYXAiLCBjcmVhdGVDbWFwVGFibGUobmV3Q2hhckNvZGVUb0dseXBoSWQsIHRvVW5pY29kZUV4dHJhTWFwLCBudW1HbHlwaHMpKTsKICAgIGJ1aWxkZXIuYWRkVGFibGUoImhlYWQiLCAiXHgwMFx4MDFceDAwXHgwMCIgKyAiXHgwMFx4MDBceDEwXHgwMCIgKyAiXHgwMFx4MDBceDAwXHgwMCIgKyAiXHg1Rlx4MEZceDNDXHhGNSIgKyAiXHgwMFx4MDAiICsgc2FmZVN0cmluZzE2KHVuaXRzUGVyRW0pICsgIlx4MDBceDAwXHgwMFx4MDBceDllXHgwYlx4N2VceDI3IiArICJceDAwXHgwMFx4MDBceDAwXHg5ZVx4MGJceDdlXHgyNyIgKyAiXHgwMFx4MDAiICsgc2FmZVN0cmluZzE2KHByb3BlcnRpZXMuZGVzY2VudCkgKyAiXHgwRlx4RkYiICsgc2FmZVN0cmluZzE2KHByb3BlcnRpZXMuYXNjZW50KSArIHN0cmluZzE2KHByb3BlcnRpZXMuaXRhbGljQW5nbGUgPyAyIDogMCkgKyAiXHgwMFx4MTEiICsgIlx4MDBceDAwIiArICJceDAwXHgwMCIgKyAiXHgwMFx4MDAiKTsKICAgIGJ1aWxkZXIuYWRkVGFibGUoImhoZWEiLCAiXHgwMFx4MDFceDAwXHgwMCIgKyBzYWZlU3RyaW5nMTYocHJvcGVydGllcy5hc2NlbnQpICsgc2FmZVN0cmluZzE2KHByb3BlcnRpZXMuZGVzY2VudCkgKyAiXHgwMFx4MDAiICsgIlx4RkZceEZGIiArICJceDAwXHgwMCIgKyAiXHgwMFx4MDAiICsgIlx4MDBceDAwIiArIHNhZmVTdHJpbmcxNihwcm9wZXJ0aWVzLmNhcEhlaWdodCkgKyBzYWZlU3RyaW5nMTYoTWF0aC50YW4ocHJvcGVydGllcy5pdGFsaWNBbmdsZSkgKiBwcm9wZXJ0aWVzLnhIZWlnaHQpICsgIlx4MDBceDAwIiArICJceDAwXHgwMCIgKyAiXHgwMFx4MDAiICsgIlx4MDBceDAwIiArICJceDAwXHgwMCIgKyAiXHgwMFx4MDAiICsgc3RyaW5nMTYobnVtR2x5cGhzKSk7CiAgICBidWlsZGVyLmFkZFRhYmxlKCJobXR4IiwgZnVuY3Rpb24gZm9udEZpZWxkc0htdHgoKSB7CiAgICAgIGNvbnN0IGNoYXJzdHJpbmdzID0gZm9udC5jaGFyc3RyaW5nczsKICAgICAgY29uc3QgY2ZmV2lkdGhzID0gZm9udC5jZmYgPyBmb250LmNmZi53aWR0aHMgOiBudWxsOwogICAgICBsZXQgaG10eCA9ICJceDAwXHgwMFx4MDBceDAwIjsKICAgICAgZm9yIChsZXQgaSA9IDEsIGlpID0gbnVtR2x5cGhzOyBpIDwgaWk7IGkrKykgewogICAgICAgIGxldCB3aWR0aCA9IDA7CiAgICAgICAgaWYgKGNoYXJzdHJpbmdzKSB7CiAgICAgICAgICBjb25zdCBjaGFyc3RyaW5nID0gY2hhcnN0cmluZ3NbaSAtIDFdOwogICAgICAgICAgd2lkdGggPSAid2lkdGgiIGluIGNoYXJzdHJpbmcgPyBjaGFyc3RyaW5nLndpZHRoIDogMDsKICAgICAgICB9IGVsc2UgaWYgKGNmZldpZHRocykgewogICAgICAgICAgd2lkdGggPSBNYXRoLmNlaWwoY2ZmV2lkdGhzW2ldIHx8IDApOwogICAgICAgIH0KICAgICAgICBobXR4ICs9IHN0cmluZzE2KHdpZHRoKSArIHN0cmluZzE2KDApOwogICAgICB9CiAgICAgIHJldHVybiBobXR4OwogICAgfSgpKTsKICAgIGJ1aWxkZXIuYWRkVGFibGUoIm1heHAiLCAiXHgwMFx4MDBceDUwXHgwMCIgKyBzdHJpbmcxNihudW1HbHlwaHMpKTsKICAgIGJ1aWxkZXIuYWRkVGFibGUoIm5hbWUiLCBjcmVhdGVOYW1lVGFibGUoZm9udE5hbWUpKTsKICAgIGJ1aWxkZXIuYWRkVGFibGUoInBvc3QiLCBjcmVhdGVQb3N0VGFibGUocHJvcGVydGllcykpOwogICAgcmV0dXJuIGJ1aWxkZXIudG9BcnJheSgpOwogIH0KICBnZXQgc3BhY2VXaWR0aCgpIHsKICAgIGNvbnN0IHBvc3NpYmxlU3BhY2VSZXBsYWNlbWVudHMgPSBbInNwYWNlIiwgIm1pbnVzIiwgIm9uZSIsICJpIiwgIkkiXTsKICAgIGxldCB3aWR0aDsKICAgIGZvciAoY29uc3QgZ2x5cGhOYW1lIG9mIHBvc3NpYmxlU3BhY2VSZXBsYWNlbWVudHMpIHsKICAgICAgaWYgKGdseXBoTmFtZSBpbiB0aGlzLndpZHRocykgewogICAgICAgIHdpZHRoID0gdGhpcy53aWR0aHNbZ2x5cGhOYW1lXTsKICAgICAgICBicmVhazsKICAgICAgfQogICAgICBjb25zdCBnbHlwaHNVbmljb2RlTWFwID0gKDAsIF9nbHlwaGxpc3QuZ2V0R2x5cGhzVW5pY29kZSkoKTsKICAgICAgY29uc3QgZ2x5cGhVbmljb2RlID0gZ2x5cGhzVW5pY29kZU1hcFtnbHlwaE5hbWVdOwogICAgICBsZXQgY2hhcmNvZGUgPSAwOwogICAgICBpZiAodGhpcy5jb21wb3NpdGUgJiYgdGhpcy5jTWFwLmNvbnRhaW5zKGdseXBoVW5pY29kZSkpIHsKICAgICAgICBjaGFyY29kZSA9IHRoaXMuY01hcC5sb29rdXAoZ2x5cGhVbmljb2RlKTsKICAgICAgICBpZiAodHlwZW9mIGNoYXJjb2RlID09PSAic3RyaW5nIikgewogICAgICAgICAgY2hhcmNvZGUgPSBjb252ZXJ0Q2lkU3RyaW5nKGdseXBoVW5pY29kZSwgY2hhcmNvZGUpOwogICAgICAgIH0KICAgICAgfQogICAgICBpZiAoIWNoYXJjb2RlICYmIHRoaXMudG9Vbmljb2RlKSB7CiAgICAgICAgY2hhcmNvZGUgPSB0aGlzLnRvVW5pY29kZS5jaGFyQ29kZU9mKGdseXBoVW5pY29kZSk7CiAgICAgIH0KICAgICAgaWYgKGNoYXJjb2RlIDw9IDApIHsKICAgICAgICBjaGFyY29kZSA9IGdseXBoVW5pY29kZTsKICAgICAgfQogICAgICB3aWR0aCA9IHRoaXMud2lkdGhzW2NoYXJjb2RlXTsKICAgICAgaWYgKHdpZHRoKSB7CiAgICAgICAgYnJlYWs7CiAgICAgIH0KICAgIH0KICAgIHJldHVybiAoMCwgX3V0aWwuc2hhZG93KSh0aGlzLCAic3BhY2VXaWR0aCIsIHdpZHRoIHx8IHRoaXMuZGVmYXVsdFdpZHRoKTsKICB9CiAgX2NoYXJUb0dseXBoKGNoYXJjb2RlLCBpc1NwYWNlID0gZmFsc2UpIHsKICAgIGxldCBnbHlwaCA9IHRoaXMuX2dseXBoQ2FjaGVbY2hhcmNvZGVdOwogICAgaWYgKGdseXBoPy5pc1NwYWNlID09PSBpc1NwYWNlKSB7CiAgICAgIHJldHVybiBnbHlwaDsKICAgIH0KICAgIGxldCBmb250Q2hhckNvZGUsIHdpZHRoLCBvcGVyYXRvckxpc3RJZDsKICAgIGxldCB3aWR0aENvZGUgPSBjaGFyY29kZTsKICAgIGlmICh0aGlzLmNNYXA/LmNvbnRhaW5zKGNoYXJjb2RlKSkgewogICAgICB3aWR0aENvZGUgPSB0aGlzLmNNYXAubG9va3VwKGNoYXJjb2RlKTsKICAgICAgaWYgKHR5cGVvZiB3aWR0aENvZGUgPT09ICJzdHJpbmciKSB7CiAgICAgICAgd2lkdGhDb2RlID0gY29udmVydENpZFN0cmluZyhjaGFyY29kZSwgd2lkdGhDb2RlKTsKICAgICAgfQogICAgfQogICAgd2lkdGggPSB0aGlzLndpZHRoc1t3aWR0aENvZGVdOwogICAgaWYgKHR5cGVvZiB3aWR0aCAhPT0gIm51bWJlciIpIHsKICAgICAgd2lkdGggPSB0aGlzLmRlZmF1bHRXaWR0aDsKICAgIH0KICAgIGNvbnN0IHZtZXRyaWMgPSB0aGlzLnZtZXRyaWNzPy5bd2lkdGhDb2RlXTsKICAgIGxldCB1bmljb2RlID0gdGhpcy50b1VuaWNvZGUuZ2V0KGNoYXJjb2RlKSB8fCBjaGFyY29kZTsKICAgIGlmICh0eXBlb2YgdW5pY29kZSA9PT0gIm51bWJlciIpIHsKICAgICAgdW5pY29kZSA9IFN0cmluZy5mcm9tQ2hhckNvZGUodW5pY29kZSk7CiAgICB9CiAgICBsZXQgaXNJbkZvbnQgPSB0aGlzLnRvRm9udENoYXJbY2hhcmNvZGVdICE9PSB1bmRlZmluZWQ7CiAgICBmb250Q2hhckNvZGUgPSB0aGlzLnRvRm9udENoYXJbY2hhcmNvZGVdIHx8IGNoYXJjb2RlOwogICAgaWYgKHRoaXMubWlzc2luZ0ZpbGUpIHsKICAgICAgY29uc3QgZ2x5cGhOYW1lID0gdGhpcy5kaWZmZXJlbmNlc1tjaGFyY29kZV0gfHwgdGhpcy5kZWZhdWx0RW5jb2RpbmdbY2hhcmNvZGVdOwogICAgICBpZiAoKGdseXBoTmFtZSA9PT0gIi5ub3RkZWYiIHx8IGdseXBoTmFtZSA9PT0gIiIpICYmIHRoaXMudHlwZSA9PT0gIlR5cGUxIikgewogICAgICAgIGZvbnRDaGFyQ29kZSA9IDB4MjA7CiAgICAgIH0KICAgICAgZm9udENoYXJDb2RlID0gKDAsIF91bmljb2RlLm1hcFNwZWNpYWxVbmljb2RlVmFsdWVzKShmb250Q2hhckNvZGUpOwogICAgfQogICAgaWYgKHRoaXMuaXNUeXBlM0ZvbnQpIHsKICAgICAgb3BlcmF0b3JMaXN0SWQgPSBmb250Q2hhckNvZGU7CiAgICB9CiAgICBsZXQgYWNjZW50ID0gbnVsbDsKICAgIGlmICh0aGlzLnNlYWNNYXA/LltjaGFyY29kZV0pIHsKICAgICAgaXNJbkZvbnQgPSB0cnVlOwogICAgICBjb25zdCBzZWFjID0gdGhpcy5zZWFjTWFwW2NoYXJjb2RlXTsKICAgICAgZm9udENoYXJDb2RlID0gc2VhYy5iYXNlRm9udENoYXJDb2RlOwogICAgICBhY2NlbnQgPSB7CiAgICAgICAgZm9udENoYXI6IFN0cmluZy5mcm9tQ29kZVBvaW50KHNlYWMuYWNjZW50Rm9udENoYXJDb2RlKSwKICAgICAgICBvZmZzZXQ6IHNlYWMuYWNjZW50T2Zmc2V0CiAgICAgIH07CiAgICB9CiAgICBsZXQgZm9udENoYXIgPSAiIjsKICAgIGlmICh0eXBlb2YgZm9udENoYXJDb2RlID09PSAibnVtYmVyIikgewogICAgICBpZiAoZm9udENoYXJDb2RlIDw9IDB4MTBmZmZmKSB7CiAgICAgICAgZm9udENoYXIgPSBTdHJpbmcuZnJvbUNvZGVQb2ludChmb250Q2hhckNvZGUpOwogICAgICB9IGVsc2UgewogICAgICAgICgwLCBfdXRpbC53YXJuKShgY2hhclRvR2x5cGggLSBpbnZhbGlkIGZvbnRDaGFyQ29kZTogJHtmb250Q2hhckNvZGV9YCk7CiAgICAgIH0KICAgIH0KICAgIGdseXBoID0gbmV3IEdseXBoKGNoYXJjb2RlLCBmb250Q2hhciwgdW5pY29kZSwgYWNjZW50LCB3aWR0aCwgdm1ldHJpYywgb3BlcmF0b3JMaXN0SWQsIGlzU3BhY2UsIGlzSW5Gb250KTsKICAgIHJldHVybiB0aGlzLl9nbHlwaENhY2hlW2NoYXJjb2RlXSA9IGdseXBoOwogIH0KICBjaGFyc1RvR2x5cGhzKGNoYXJzKSB7CiAgICBsZXQgZ2x5cGhzID0gdGhpcy5fY2hhcnNDYWNoZVtjaGFyc107CiAgICBpZiAoZ2x5cGhzKSB7CiAgICAgIHJldHVybiBnbHlwaHM7CiAgICB9CiAgICBnbHlwaHMgPSBbXTsKICAgIGlmICh0aGlzLmNNYXApIHsKICAgICAgY29uc3QgYyA9IE9iamVjdC5jcmVhdGUobnVsbCksCiAgICAgICAgaWkgPSBjaGFycy5sZW5ndGg7CiAgICAgIGxldCBpID0gMDsKICAgICAgd2hpbGUgKGkgPCBpaSkgewogICAgICAgIHRoaXMuY01hcC5yZWFkQ2hhckNvZGUoY2hhcnMsIGksIGMpOwogICAgICAgIGNvbnN0IHsKICAgICAgICAgIGNoYXJjb2RlLAogICAgICAgICAgbGVuZ3RoCiAgICAgICAgfSA9IGM7CiAgICAgICAgaSArPSBsZW5ndGg7CiAgICAgICAgY29uc3QgZ2x5cGggPSB0aGlzLl9jaGFyVG9HbHlwaChjaGFyY29kZSwgbGVuZ3RoID09PSAxICYmIGNoYXJzLmNoYXJDb2RlQXQoaSAtIDEpID09PSAweDIwKTsKICAgICAgICBnbHlwaHMucHVzaChnbHlwaCk7CiAgICAgIH0KICAgIH0gZWxzZSB7CiAgICAgIGZvciAobGV0IGkgPSAwLCBpaSA9IGNoYXJzLmxlbmd0aDsgaSA8IGlpOyArK2kpIHsKICAgICAgICBjb25zdCBjaGFyY29kZSA9IGNoYXJzLmNoYXJDb2RlQXQoaSk7CiAgICAgICAgY29uc3QgZ2x5cGggPSB0aGlzLl9jaGFyVG9HbHlwaChjaGFyY29kZSwgY2hhcmNvZGUgPT09IDB4MjApOwogICAgICAgIGdseXBocy5wdXNoKGdseXBoKTsKICAgICAgfQogICAgfQogICAgcmV0dXJuIHRoaXMuX2NoYXJzQ2FjaGVbY2hhcnNdID0gZ2x5cGhzOwogIH0KICBnZXRDaGFyUG9zaXRpb25zKGNoYXJzKSB7CiAgICBjb25zdCBwb3NpdGlvbnMgPSBbXTsKICAgIGlmICh0aGlzLmNNYXApIHsKICAgICAgY29uc3QgYyA9IE9iamVjdC5jcmVhdGUobnVsbCk7CiAgICAgIGxldCBpID0gMDsKICAgICAgd2hpbGUgKGkgPCBjaGFycy5sZW5ndGgpIHsKICAgICAgICB0aGlzLmNNYXAucmVhZENoYXJDb2RlKGNoYXJzLCBpLCBjKTsKICAgICAgICBjb25zdCBsZW5ndGggPSBjLmxlbmd0aDsKICAgICAgICBwb3NpdGlvbnMucHVzaChbaSwgaSArIGxlbmd0aF0pOwogICAgICAgIGkgKz0gbGVuZ3RoOwogICAgICB9CiAgICB9IGVsc2UgewogICAgICBmb3IgKGxldCBpID0gMCwgaWkgPSBjaGFycy5sZW5ndGg7IGkgPCBpaTsgKytpKSB7CiAgICAgICAgcG9zaXRpb25zLnB1c2goW2ksIGkgKyAxXSk7CiAgICAgIH0KICAgIH0KICAgIHJldHVybiBwb3NpdGlvbnM7CiAgfQogIGdldCBnbHlwaENhY2hlVmFsdWVzKCkgewogICAgcmV0dXJuIE9iamVjdC52YWx1ZXModGhpcy5fZ2x5cGhDYWNoZSk7CiAgfQogIGVuY29kZVN0cmluZyhzdHIpIHsKICAgIGNvbnN0IGJ1ZmZlcnMgPSBbXTsKICAgIGNvbnN0IGN1cnJlbnRCdWYgPSBbXTsKICAgIGNvbnN0IGhhc0N1cnJlbnRCdWZFcnJvcnMgPSAoKSA9PiBidWZmZXJzLmxlbmd0aCAlIDIgPT09IDE7CiAgICBjb25zdCBnZXRDaGFyQ29kZSA9IHRoaXMudG9Vbmljb2RlIGluc3RhbmNlb2YgX3RvX3VuaWNvZGVfbWFwLklkZW50aXR5VG9Vbmljb2RlTWFwID8gdW5pY29kZSA9PiB0aGlzLnRvVW5pY29kZS5jaGFyQ29kZU9mKHVuaWNvZGUpIDogdW5pY29kZSA9PiB0aGlzLnRvVW5pY29kZS5jaGFyQ29kZU9mKFN0cmluZy5mcm9tQ29kZVBvaW50KHVuaWNvZGUpKTsKICAgIGZvciAobGV0IGkgPSAwLCBpaSA9IHN0ci5sZW5ndGg7IGkgPCBpaTsgaSsrKSB7CiAgICAgIGNvbnN0IHVuaWNvZGUgPSBzdHIuY29kZVBvaW50QXQoaSk7CiAgICAgIGlmICh1bmljb2RlID4gMHhkN2ZmICYmICh1bmljb2RlIDwgMHhlMDAwIHx8IHVuaWNvZGUgPiAweGZmZmQpKSB7CiAgICAgICAgaSsrOwogICAgICB9CiAgICAgIGlmICh0aGlzLnRvVW5pY29kZSkgewogICAgICAgIGNvbnN0IGNoYXJDb2RlID0gZ2V0Q2hhckNvZGUodW5pY29kZSk7CiAgICAgICAgaWYgKGNoYXJDb2RlICE9PSAtMSkgewogICAgICAgICAgaWYgKGhhc0N1cnJlbnRCdWZFcnJvcnMoKSkgewogICAgICAgICAgICBidWZmZXJzLnB1c2goY3VycmVudEJ1Zi5qb2luKCIiKSk7CiAgICAgICAgICAgIGN1cnJlbnRCdWYubGVuZ3RoID0gMDsKICAgICAgICAgIH0KICAgICAgICAgIGNvbnN0IGNoYXJDb2RlTGVuZ3RoID0gdGhpcy5jTWFwID8gdGhpcy5jTWFwLmdldENoYXJDb2RlTGVuZ3RoKGNoYXJDb2RlKSA6IDE7CiAgICAgICAgICBmb3IgKGxldCBqID0gY2hhckNvZGVMZW5ndGggLSAxOyBqID49IDA7IGotLSkgewogICAgICAgICAgICBjdXJyZW50QnVmLnB1c2goU3RyaW5nLmZyb21DaGFyQ29kZShjaGFyQ29kZSA+PiA4ICogaiAmIDB4ZmYpKTsKICAgICAgICAgIH0KICAgICAgICAgIGNvbnRpbnVlOwogICAgICAgIH0KICAgICAgfQogICAgICBpZiAoIWhhc0N1cnJlbnRCdWZFcnJvcnMoKSkgewogICAgICAgIGJ1ZmZlcnMucHVzaChjdXJyZW50QnVmLmpvaW4oIiIpKTsKICAgICAgICBjdXJyZW50QnVmLmxlbmd0aCA9IDA7CiAgICAgIH0KICAgICAgY3VycmVudEJ1Zi5wdXNoKFN0cmluZy5mcm9tQ29kZVBvaW50KHVuaWNvZGUpKTsKICAgIH0KICAgIGJ1ZmZlcnMucHVzaChjdXJyZW50QnVmLmpvaW4oIiIpKTsKICAgIHJldHVybiBidWZmZXJzOwogIH0KfQpleHBvcnRzLkZvbnQgPSBGb250OwpjbGFzcyBFcnJvckZvbnQgewogIGNvbnN0cnVjdG9yKGVycm9yKSB7CiAgICB0aGlzLmVycm9yID0gZXJyb3I7CiAgICB0aGlzLmxvYWRlZE5hbWUgPSAiZ19mb250X2Vycm9yIjsKICAgIHRoaXMubWlzc2luZ0ZpbGUgPSB0cnVlOwogIH0KICBjaGFyc1RvR2x5cGhzKCkgewogICAgcmV0dXJuIFtdOwogIH0KICBlbmNvZGVTdHJpbmcoY2hhcnMpIHsKICAgIHJldHVybiBbY2hhcnNdOwogIH0KICBleHBvcnREYXRhKGV4dHJhUHJvcGVydGllcyA9IGZhbHNlKSB7CiAgICByZXR1cm4gewogICAgICBlcnJvcjogdGhpcy5lcnJvcgogICAgfTsKICB9Cn0KZXhwb3J0cy5FcnJvckZvbnQgPSBFcnJvckZvbnQ7CgovKioqLyB9KSwKLyogMzUgKi8KLyoqKi8gKChfX3VudXNlZF93ZWJwYWNrX21vZHVsZSwgZXhwb3J0cywgX193X3BkZmpzX3JlcXVpcmVfXykgPT4gewoKCgpPYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgIl9fZXNNb2R1bGUiLCAoewogIHZhbHVlOiB0cnVlCn0pKTsKZXhwb3J0cy5DRkZUb3BEaWN0ID0gZXhwb3J0cy5DRkZTdHJpbmdzID0gZXhwb3J0cy5DRkZTdGFuZGFyZFN0cmluZ3MgPSBleHBvcnRzLkNGRlByaXZhdGVEaWN0ID0gZXhwb3J0cy5DRkZQYXJzZXIgPSBleHBvcnRzLkNGRkluZGV4ID0gZXhwb3J0cy5DRkZIZWFkZXIgPSBleHBvcnRzLkNGRkZEU2VsZWN0ID0gZXhwb3J0cy5DRkZDb21waWxlciA9IGV4cG9ydHMuQ0ZGQ2hhcnNldCA9IGV4cG9ydHMuQ0ZGID0gdm9pZCAwOwp2YXIgX3V0aWwgPSBfX3dfcGRmanNfcmVxdWlyZV9fKDIpOwp2YXIgX2NoYXJzZXRzID0gX193X3BkZmpzX3JlcXVpcmVfXygzNik7CnZhciBfZW5jb2RpbmdzID0gX193X3BkZmpzX3JlcXVpcmVfXygzNyk7CmNvbnN0IE1BWF9TVUJSX05FU1RJTkcgPSAxMDsKY29uc3QgQ0ZGU3RhbmRhcmRTdHJpbmdzID0gWyIubm90ZGVmIiwgInNwYWNlIiwgImV4Y2xhbSIsICJxdW90ZWRibCIsICJudW1iZXJzaWduIiwgImRvbGxhciIsICJwZXJjZW50IiwgImFtcGVyc2FuZCIsICJxdW90ZXJpZ2h0IiwgInBhcmVubGVmdCIsICJwYXJlbnJpZ2h0IiwgImFzdGVyaXNrIiwgInBsdXMiLCAiY29tbWEiLCAiaHlwaGVuIiwgInBlcmlvZCIsICJzbGFzaCIsICJ6ZXJvIiwgIm9uZSIsICJ0d28iLCAidGhyZWUiLCAiZm91ciIsICJmaXZlIiwgInNpeCIsICJzZXZlbiIsICJlaWdodCIsICJuaW5lIiwgImNvbG9uIiwgInNlbWljb2xvbiIsICJsZXNzIiwgImVxdWFsIiwgImdyZWF0ZXIiLCAicXVlc3Rpb24iLCAiYXQiLCAiQSIsICJCIiwgIkMiLCAiRCIsICJFIiwgIkYiLCAiRyIsICJIIiwgIkkiLCAiSiIsICJLIiwgIkwiLCAiTSIsICJOIiwgIk8iLCAiUCIsICJRIiwgIlIiLCAiUyIsICJUIiwgIlUiLCAiViIsICJXIiwgIlgiLCAiWSIsICJaIiwgImJyYWNrZXRsZWZ0IiwgImJhY2tzbGFzaCIsICJicmFja2V0cmlnaHQiLCAiYXNjaWljaXJjdW0iLCAidW5kZXJzY29yZSIsICJxdW90ZWxlZnQiLCAiYSIsICJiIiwgImMiLCAiZCIsICJlIiwgImYiLCAiZyIsICJoIiwgImkiLCAiaiIsICJrIiwgImwiLCAibSIsICJuIiwgIm8iLCAicCIsICJxIiwgInIiLCAicyIsICJ0IiwgInUiLCAidiIsICJ3IiwgIngiLCAieSIsICJ6IiwgImJyYWNlbGVmdCIsICJiYXIiLCAiYnJhY2VyaWdodCIsICJhc2NpaXRpbGRlIiwgImV4Y2xhbWRvd24iLCAiY2VudCIsICJzdGVybGluZyIsICJmcmFjdGlvbiIsICJ5ZW4iLCAiZmxvcmluIiwgInNlY3Rpb24iLCAiY3VycmVuY3kiLCAicXVvdGVzaW5nbGUiLCAicXVvdGVkYmxsZWZ0IiwgImd1aWxsZW1vdGxlZnQiLCAiZ3VpbHNpbmdsbGVmdCIsICJndWlsc2luZ2xyaWdodCIsICJmaSIsICJmbCIsICJlbmRhc2giLCAiZGFnZ2VyIiwgImRhZ2dlcmRibCIsICJwZXJpb2RjZW50ZXJlZCIsICJwYXJhZ3JhcGgiLCAiYnVsbGV0IiwgInF1b3Rlc2luZ2xiYXNlIiwgInF1b3RlZGJsYmFzZSIsICJxdW90ZWRibHJpZ2h0IiwgImd1aWxsZW1vdHJpZ2h0IiwgImVsbGlwc2lzIiwgInBlcnRob3VzYW5kIiwgInF1ZXN0aW9uZG93biIsICJncmF2ZSIsICJhY3V0ZSIsICJjaXJjdW1mbGV4IiwgInRpbGRlIiwgIm1hY3JvbiIsICJicmV2ZSIsICJkb3RhY2NlbnQiLCAiZGllcmVzaXMiLCAicmluZyIsICJjZWRpbGxhIiwgImh1bmdhcnVtbGF1dCIsICJvZ29uZWsiLCAiY2Fyb24iLCAiZW1kYXNoIiwgIkFFIiwgIm9yZGZlbWluaW5lIiwgIkxzbGFzaCIsICJPc2xhc2giLCAiT0UiLCAib3JkbWFzY3VsaW5lIiwgImFlIiwgImRvdGxlc3NpIiwgImxzbGFzaCIsICJvc2xhc2giLCAib2UiLCAiZ2VybWFuZGJscyIsICJvbmVzdXBlcmlvciIsICJsb2dpY2Fsbm90IiwgIm11IiwgInRyYWRlbWFyayIsICJFdGgiLCAib25laGFsZiIsICJwbHVzbWludXMiLCAiVGhvcm4iLCAib25lcXVhcnRlciIsICJkaXZpZGUiLCAiYnJva2VuYmFyIiwgImRlZ3JlZSIsICJ0aG9ybiIsICJ0aHJlZXF1YXJ0ZXJzIiwgInR3b3N1cGVyaW9yIiwgInJlZ2lzdGVyZWQiLCAibWludXMiLCAiZXRoIiwgIm11bHRpcGx5IiwgInRocmVlc3VwZXJpb3IiLCAiY29weXJpZ2h0IiwgIkFhY3V0ZSIsICJBY2lyY3VtZmxleCIsICJBZGllcmVzaXMiLCAiQWdyYXZlIiwgIkFyaW5nIiwgIkF0aWxkZSIsICJDY2VkaWxsYSIsICJFYWN1dGUiLCAiRWNpcmN1bWZsZXgiLCAiRWRpZXJlc2lzIiwgIkVncmF2ZSIsICJJYWN1dGUiLCAiSWNpcmN1bWZsZXgiLCAiSWRpZXJlc2lzIiwgIklncmF2ZSIsICJOdGlsZGUiLCAiT2FjdXRlIiwgIk9jaXJjdW1mbGV4IiwgIk9kaWVyZXNpcyIsICJPZ3JhdmUiLCAiT3RpbGRlIiwgIlNjYXJvbiIsICJVYWN1dGUiLCAiVWNpcmN1bWZsZXgiLCAiVWRpZXJlc2lzIiwgIlVncmF2ZSIsICJZYWN1dGUiLCAiWWRpZXJlc2lzIiwgIlpjYXJvbiIsICJhYWN1dGUiLCAiYWNpcmN1bWZsZXgiLCAiYWRpZXJlc2lzIiwgImFncmF2ZSIsICJhcmluZyIsICJhdGlsZGUiLCAiY2NlZGlsbGEiLCAiZWFjdXRlIiwgImVjaXJjdW1mbGV4IiwgImVkaWVyZXNpcyIsICJlZ3JhdmUiLCAiaWFjdXRlIiwgImljaXJjdW1mbGV4IiwgImlkaWVyZXNpcyIsICJpZ3JhdmUiLCAibnRpbGRlIiwgIm9hY3V0ZSIsICJvY2lyY3VtZmxleCIsICJvZGllcmVzaXMiLCAib2dyYXZlIiwgIm90aWxkZSIsICJzY2Fyb24iLCAidWFjdXRlIiwgInVjaXJjdW1mbGV4IiwgInVkaWVyZXNpcyIsICJ1Z3JhdmUiLCAieWFjdXRlIiwgInlkaWVyZXNpcyIsICJ6Y2Fyb24iLCAiZXhjbGFtc21hbGwiLCAiSHVuZ2FydW1sYXV0c21hbGwiLCAiZG9sbGFyb2xkc3R5bGUiLCAiZG9sbGFyc3VwZXJpb3IiLCAiYW1wZXJzYW5kc21hbGwiLCAiQWN1dGVzbWFsbCIsICJwYXJlbmxlZnRzdXBlcmlvciIsICJwYXJlbnJpZ2h0c3VwZXJpb3IiLCAidHdvZG90ZW5sZWFkZXIiLCAib25lZG90ZW5sZWFkZXIiLCAiemVyb29sZHN0eWxlIiwgIm9uZW9sZHN0eWxlIiwgInR3b29sZHN0eWxlIiwgInRocmVlb2xkc3R5bGUiLCAiZm91cm9sZHN0eWxlIiwgImZpdmVvbGRzdHlsZSIsICJzaXhvbGRzdHlsZSIsICJzZXZlbm9sZHN0eWxlIiwgImVpZ2h0b2xkc3R5bGUiLCAibmluZW9sZHN0eWxlIiwgImNvbW1hc3VwZXJpb3IiLCAidGhyZWVxdWFydGVyc2VtZGFzaCIsICJwZXJpb2RzdXBlcmlvciIsICJxdWVzdGlvbnNtYWxsIiwgImFzdXBlcmlvciIsICJic3VwZXJpb3IiLCAiY2VudHN1cGVyaW9yIiwgImRzdXBlcmlvciIsICJlc3VwZXJpb3IiLCAiaXN1cGVyaW9yIiwgImxzdXBlcmlvciIsICJtc3VwZXJpb3IiLCAibnN1cGVyaW9yIiwgIm9zdXBlcmlvciIsICJyc3VwZXJpb3IiLCAic3N1cGVyaW9yIiwgInRzdXBlcmlvciIsICJmZiIsICJmZmkiLCAiZmZsIiwgInBhcmVubGVmdGluZmVyaW9yIiwgInBhcmVucmlnaHRpbmZlcmlvciIsICJDaXJjdW1mbGV4c21hbGwiLCAiaHlwaGVuc3VwZXJpb3IiLCAiR3JhdmVzbWFsbCIsICJBc21hbGwiLCAiQnNtYWxsIiwgIkNzbWFsbCIsICJEc21hbGwiLCAiRXNtYWxsIiwgIkZzbWFsbCIsICJHc21hbGwiLCAiSHNtYWxsIiwgIklzbWFsbCIsICJKc21hbGwiLCAiS3NtYWxsIiwgIkxzbWFsbCIsICJNc21hbGwiLCAiTnNtYWxsIiwgIk9zbWFsbCIsICJQc21hbGwiLCAiUXNtYWxsIiwgIlJzbWFsbCIsICJTc21hbGwiLCAiVHNtYWxsIiwgIlVzbWFsbCIsICJWc21hbGwiLCAiV3NtYWxsIiwgIlhzbWFsbCIsICJZc21hbGwiLCAiWnNtYWxsIiwgImNvbG9ubW9uZXRhcnkiLCAib25lZml0dGVkIiwgInJ1cGlhaCIsICJUaWxkZXNtYWxsIiwgImV4Y2xhbWRvd25zbWFsbCIsICJjZW50b2xkc3R5bGUiLCAiTHNsYXNoc21hbGwiLCAiU2Nhcm9uc21hbGwiLCAiWmNhcm9uc21hbGwiLCAiRGllcmVzaXNzbWFsbCIsICJCcmV2ZXNtYWxsIiwgIkNhcm9uc21hbGwiLCAiRG90YWNjZW50c21hbGwiLCAiTWFjcm9uc21hbGwiLCAiZmlndXJlZGFzaCIsICJoeXBoZW5pbmZlcmlvciIsICJPZ29uZWtzbWFsbCIsICJSaW5nc21hbGwiLCAiQ2VkaWxsYXNtYWxsIiwgInF1ZXN0aW9uZG93bnNtYWxsIiwgIm9uZWVpZ2h0aCIsICJ0aHJlZWVpZ2h0aHMiLCAiZml2ZWVpZ2h0aHMiLCAic2V2ZW5laWdodGhzIiwgIm9uZXRoaXJkIiwgInR3b3RoaXJkcyIsICJ6ZXJvc3VwZXJpb3IiLCAiZm91cnN1cGVyaW9yIiwgImZpdmVzdXBlcmlvciIsICJzaXhzdXBlcmlvciIsICJzZXZlbnN1cGVyaW9yIiwgImVpZ2h0c3VwZXJpb3IiLCAibmluZXN1cGVyaW9yIiwgInplcm9pbmZlcmlvciIsICJvbmVpbmZlcmlvciIsICJ0d29pbmZlcmlvciIsICJ0aHJlZWluZmVyaW9yIiwgImZvdXJpbmZlcmlvciIsICJmaXZlaW5mZXJpb3IiLCAic2l4aW5mZXJpb3IiLCAic2V2ZW5pbmZlcmlvciIsICJlaWdodGluZmVyaW9yIiwgIm5pbmVpbmZlcmlvciIsICJjZW50aW5mZXJpb3IiLCAiZG9sbGFyaW5mZXJpb3IiLCAicGVyaW9kaW5mZXJpb3IiLCAiY29tbWFpbmZlcmlvciIsICJBZ3JhdmVzbWFsbCIsICJBYWN1dGVzbWFsbCIsICJBY2lyY3VtZmxleHNtYWxsIiwgIkF0aWxkZXNtYWxsIiwgIkFkaWVyZXNpc3NtYWxsIiwgIkFyaW5nc21hbGwiLCAiQUVzbWFsbCIsICJDY2VkaWxsYXNtYWxsIiwgIkVncmF2ZXNtYWxsIiwgIkVhY3V0ZXNtYWxsIiwgIkVjaXJjdW1mbGV4c21hbGwiLCAiRWRpZXJlc2lzc21hbGwiLCAiSWdyYXZlc21hbGwiLCAiSWFjdXRlc21hbGwiLCAiSWNpcmN1bWZsZXhzbWFsbCIsICJJZGllcmVzaXNzbWFsbCIsICJFdGhzbWFsbCIsICJOdGlsZGVzbWFsbCIsICJPZ3JhdmVzbWFsbCIsICJPYWN1dGVzbWFsbCIsICJPY2lyY3VtZmxleHNtYWxsIiwgIk90aWxkZXNtYWxsIiwgIk9kaWVyZXNpc3NtYWxsIiwgIk9Fc21hbGwiLCAiT3NsYXNoc21hbGwiLCAiVWdyYXZlc21hbGwiLCAiVWFjdXRlc21hbGwiLCAiVWNpcmN1bWZsZXhzbWFsbCIsICJVZGllcmVzaXNzbWFsbCIsICJZYWN1dGVzbWFsbCIsICJUaG9ybnNtYWxsIiwgIllkaWVyZXNpc3NtYWxsIiwgIjAwMS4wMDAiLCAiMDAxLjAwMSIsICIwMDEuMDAyIiwgIjAwMS4wMDMiLCAiQmxhY2siLCAiQm9sZCIsICJCb29rIiwgIkxpZ2h0IiwgIk1lZGl1bSIsICJSZWd1bGFyIiwgIlJvbWFuIiwgIlNlbWlib2xkIl07CmV4cG9ydHMuQ0ZGU3RhbmRhcmRTdHJpbmdzID0gQ0ZGU3RhbmRhcmRTdHJpbmdzOwpjb25zdCBOVU1fU1RBTkRBUkRfQ0ZGX1NUUklOR1MgPSAzOTE7CmNvbnN0IENoYXJzdHJpbmdWYWxpZGF0aW9uRGF0YSA9IFtudWxsLCB7CiAgaWQ6ICJoc3RlbSIsCiAgbWluOiAyLAogIHN0YWNrQ2xlYXJpbmc6IHRydWUsCiAgc3RlbTogdHJ1ZQp9LCBudWxsLCB7CiAgaWQ6ICJ2c3RlbSIsCiAgbWluOiAyLAogIHN0YWNrQ2xlYXJpbmc6IHRydWUsCiAgc3RlbTogdHJ1ZQp9LCB7CiAgaWQ6ICJ2bW92ZXRvIiwKICBtaW46IDEsCiAgc3RhY2tDbGVhcmluZzogdHJ1ZQp9LCB7CiAgaWQ6ICJybGluZXRvIiwKICBtaW46IDIsCiAgcmVzZXRTdGFjazogdHJ1ZQp9LCB7CiAgaWQ6ICJobGluZXRvIiwKICBtaW46IDEsCiAgcmVzZXRTdGFjazogdHJ1ZQp9LCB7CiAgaWQ6ICJ2bGluZXRvIiwKICBtaW46IDEsCiAgcmVzZXRTdGFjazogdHJ1ZQp9LCB7CiAgaWQ6ICJycmN1cnZldG8iLAogIG1pbjogNiwKICByZXNldFN0YWNrOiB0cnVlCn0sIG51bGwsIHsKICBpZDogImNhbGxzdWJyIiwKICBtaW46IDEsCiAgdW5kZWZTdGFjazogdHJ1ZQp9LCB7CiAgaWQ6ICJyZXR1cm4iLAogIG1pbjogMCwKICB1bmRlZlN0YWNrOiB0cnVlCn0sIG51bGwsIG51bGwsIHsKICBpZDogImVuZGNoYXIiLAogIG1pbjogMCwKICBzdGFja0NsZWFyaW5nOiB0cnVlCn0sIG51bGwsIG51bGwsIG51bGwsIHsKICBpZDogImhzdGVtaG0iLAogIG1pbjogMiwKICBzdGFja0NsZWFyaW5nOiB0cnVlLAogIHN0ZW06IHRydWUKfSwgewogIGlkOiAiaGludG1hc2siLAogIG1pbjogMCwKICBzdGFja0NsZWFyaW5nOiB0cnVlCn0sIHsKICBpZDogImNudHJtYXNrIiwKICBtaW46IDAsCiAgc3RhY2tDbGVhcmluZzogdHJ1ZQp9LCB7CiAgaWQ6ICJybW92ZXRvIiwKICBtaW46IDIsCiAgc3RhY2tDbGVhcmluZzogdHJ1ZQp9LCB7CiAgaWQ6ICJobW92ZXRvIiwKICBtaW46IDEsCiAgc3RhY2tDbGVhcmluZzogdHJ1ZQp9LCB7CiAgaWQ6ICJ2c3RlbWhtIiwKICBtaW46IDIsCiAgc3RhY2tDbGVhcmluZzogdHJ1ZSwKICBzdGVtOiB0cnVlCn0sIHsKICBpZDogInJjdXJ2ZWxpbmUiLAogIG1pbjogOCwKICByZXNldFN0YWNrOiB0cnVlCn0sIHsKICBpZDogInJsaW5lY3VydmUiLAogIG1pbjogOCwKICByZXNldFN0YWNrOiB0cnVlCn0sIHsKICBpZDogInZ2Y3VydmV0byIsCiAgbWluOiA0LAogIHJlc2V0U3RhY2s6IHRydWUKfSwgewogIGlkOiAiaGhjdXJ2ZXRvIiwKICBtaW46IDQsCiAgcmVzZXRTdGFjazogdHJ1ZQp9LCBudWxsLCB7CiAgaWQ6ICJjYWxsZ3N1YnIiLAogIG1pbjogMSwKICB1bmRlZlN0YWNrOiB0cnVlCn0sIHsKICBpZDogInZoY3VydmV0byIsCiAgbWluOiA0LAogIHJlc2V0U3RhY2s6IHRydWUKfSwgewogIGlkOiAiaHZjdXJ2ZXRvIiwKICBtaW46IDQsCiAgcmVzZXRTdGFjazogdHJ1ZQp9XTsKY29uc3QgQ2hhcnN0cmluZ1ZhbGlkYXRpb25EYXRhMTIgPSBbbnVsbCwgbnVsbCwgbnVsbCwgewogIGlkOiAiYW5kIiwKICBtaW46IDIsCiAgc3RhY2tEZWx0YTogLTEKfSwgewogIGlkOiAib3IiLAogIG1pbjogMiwKICBzdGFja0RlbHRhOiAtMQp9LCB7CiAgaWQ6ICJub3QiLAogIG1pbjogMSwKICBzdGFja0RlbHRhOiAwCn0sIG51bGwsIG51bGwsIG51bGwsIHsKICBpZDogImFicyIsCiAgbWluOiAxLAogIHN0YWNrRGVsdGE6IDAKfSwgewogIGlkOiAiYWRkIiwKICBtaW46IDIsCiAgc3RhY2tEZWx0YTogLTEsCiAgc3RhY2tGbihzdGFjaywgaW5kZXgpIHsKICAgIHN0YWNrW2luZGV4IC0gMl0gPSBzdGFja1tpbmRleCAtIDJdICsgc3RhY2tbaW5kZXggLSAxXTsKICB9Cn0sIHsKICBpZDogInN1YiIsCiAgbWluOiAyLAogIHN0YWNrRGVsdGE6IC0xLAogIHN0YWNrRm4oc3RhY2ssIGluZGV4KSB7CiAgICBzdGFja1tpbmRleCAtIDJdID0gc3RhY2tbaW5kZXggLSAyXSAtIHN0YWNrW2luZGV4IC0gMV07CiAgfQp9LCB7CiAgaWQ6ICJkaXYiLAogIG1pbjogMiwKICBzdGFja0RlbHRhOiAtMSwKICBzdGFja0ZuKHN0YWNrLCBpbmRleCkgewogICAgc3RhY2tbaW5kZXggLSAyXSA9IHN0YWNrW2luZGV4IC0gMl0gLyBzdGFja1tpbmRleCAtIDFdOwogIH0KfSwgbnVsbCwgewogIGlkOiAibmVnIiwKICBtaW46IDEsCiAgc3RhY2tEZWx0YTogMCwKICBzdGFja0ZuKHN0YWNrLCBpbmRleCkgewogICAgc3RhY2tbaW5kZXggLSAxXSA9IC1zdGFja1tpbmRleCAtIDFdOwogIH0KfSwgewogIGlkOiAiZXEiLAogIG1pbjogMiwKICBzdGFja0RlbHRhOiAtMQp9LCBudWxsLCBudWxsLCB7CiAgaWQ6ICJkcm9wIiwKICBtaW46IDEsCiAgc3RhY2tEZWx0YTogLTEKfSwgbnVsbCwgewogIGlkOiAicHV0IiwKICBtaW46IDIsCiAgc3RhY2tEZWx0YTogLTIKfSwgewogIGlkOiAiZ2V0IiwKICBtaW46IDEsCiAgc3RhY2tEZWx0YTogMAp9LCB7CiAgaWQ6ICJpZmVsc2UiLAogIG1pbjogNCwKICBzdGFja0RlbHRhOiAtMwp9LCB7CiAgaWQ6ICJyYW5kb20iLAogIG1pbjogMCwKICBzdGFja0RlbHRhOiAxCn0sIHsKICBpZDogIm11bCIsCiAgbWluOiAyLAogIHN0YWNrRGVsdGE6IC0xLAogIHN0YWNrRm4oc3RhY2ssIGluZGV4KSB7CiAgICBzdGFja1tpbmRleCAtIDJdID0gc3RhY2tbaW5kZXggLSAyXSAqIHN0YWNrW2luZGV4IC0gMV07CiAgfQp9LCBudWxsLCB7CiAgaWQ6ICJzcXJ0IiwKICBtaW46IDEsCiAgc3RhY2tEZWx0YTogMAp9LCB7CiAgaWQ6ICJkdXAiLAogIG1pbjogMSwKICBzdGFja0RlbHRhOiAxCn0sIHsKICBpZDogImV4Y2giLAogIG1pbjogMiwKICBzdGFja0RlbHRhOiAwCn0sIHsKICBpZDogImluZGV4IiwKICBtaW46IDIsCiAgc3RhY2tEZWx0YTogMAp9LCB7CiAgaWQ6ICJyb2xsIiwKICBtaW46IDMsCiAgc3RhY2tEZWx0YTogLTIKfSwgbnVsbCwgbnVsbCwgbnVsbCwgewogIGlkOiAiaGZsZXgiLAogIG1pbjogNywKICByZXNldFN0YWNrOiB0cnVlCn0sIHsKICBpZDogImZsZXgiLAogIG1pbjogMTMsCiAgcmVzZXRTdGFjazogdHJ1ZQp9LCB7CiAgaWQ6ICJoZmxleDEiLAogIG1pbjogOSwKICByZXNldFN0YWNrOiB0cnVlCn0sIHsKICBpZDogImZsZXgxIiwKICBtaW46IDExLAogIHJlc2V0U3RhY2s6IHRydWUKfV07CmNsYXNzIENGRlBhcnNlciB7CiAgY29uc3RydWN0b3IoZmlsZSwgcHJvcGVydGllcywgc2VhY0FuYWx5c2lzRW5hYmxlZCkgewogICAgdGhpcy5ieXRlcyA9IGZpbGUuZ2V0Qnl0ZXMoKTsKICAgIHRoaXMucHJvcGVydGllcyA9IHByb3BlcnRpZXM7CiAgICB0aGlzLnNlYWNBbmFseXNpc0VuYWJsZWQgPSAhIXNlYWNBbmFseXNpc0VuYWJsZWQ7CiAgfQogIHBhcnNlKCkgewogICAgY29uc3QgcHJvcGVydGllcyA9IHRoaXMucHJvcGVydGllczsKICAgIGNvbnN0IGNmZiA9IG5ldyBDRkYoKTsKICAgIHRoaXMuY2ZmID0gY2ZmOwogICAgY29uc3QgaGVhZGVyID0gdGhpcy5wYXJzZUhlYWRlcigpOwogICAgY29uc3QgbmFtZUluZGV4ID0gdGhpcy5wYXJzZUluZGV4KGhlYWRlci5lbmRQb3MpOwogICAgY29uc3QgdG9wRGljdEluZGV4ID0gdGhpcy5wYXJzZUluZGV4KG5hbWVJbmRleC5lbmRQb3MpOwogICAgY29uc3Qgc3RyaW5nSW5kZXggPSB0aGlzLnBhcnNlSW5kZXgodG9wRGljdEluZGV4LmVuZFBvcyk7CiAgICBjb25zdCBnbG9iYWxTdWJySW5kZXggPSB0aGlzLnBhcnNlSW5kZXgoc3RyaW5nSW5kZXguZW5kUG9zKTsKICAgIGNvbnN0IHRvcERpY3RQYXJzZWQgPSB0aGlzLnBhcnNlRGljdCh0b3BEaWN0SW5kZXgub2JqLmdldCgwKSk7CiAgICBjb25zdCB0b3BEaWN0ID0gdGhpcy5jcmVhdGVEaWN0KENGRlRvcERpY3QsIHRvcERpY3RQYXJzZWQsIGNmZi5zdHJpbmdzKTsKICAgIGNmZi5oZWFkZXIgPSBoZWFkZXIub2JqOwogICAgY2ZmLm5hbWVzID0gdGhpcy5wYXJzZU5hbWVJbmRleChuYW1lSW5kZXgub2JqKTsKICAgIGNmZi5zdHJpbmdzID0gdGhpcy5wYXJzZVN0cmluZ0luZGV4KHN0cmluZ0luZGV4Lm9iaik7CiAgICBjZmYudG9wRGljdCA9IHRvcERpY3Q7CiAgICBjZmYuZ2xvYmFsU3VickluZGV4ID0gZ2xvYmFsU3VickluZGV4Lm9iajsKICAgIHRoaXMucGFyc2VQcml2YXRlRGljdChjZmYudG9wRGljdCk7CiAgICBjZmYuaXNDSURGb250ID0gdG9wRGljdC5oYXNOYW1lKCJST1MiKTsKICAgIGNvbnN0IGNoYXJTdHJpbmdPZmZzZXQgPSB0b3BEaWN0LmdldEJ5TmFtZSgiQ2hhclN0cmluZ3MiKTsKICAgIGNvbnN0IGNoYXJTdHJpbmdJbmRleCA9IHRoaXMucGFyc2VJbmRleChjaGFyU3RyaW5nT2Zmc2V0KS5vYmo7CiAgICBjb25zdCBmb250TWF0cml4ID0gdG9wRGljdC5nZXRCeU5hbWUoIkZvbnRNYXRyaXgiKTsKICAgIGlmIChmb250TWF0cml4KSB7CiAgICAgIHByb3BlcnRpZXMuZm9udE1hdHJpeCA9IGZvbnRNYXRyaXg7CiAgICB9CiAgICBjb25zdCBmb250QkJveCA9IHRvcERpY3QuZ2V0QnlOYW1lKCJGb250QkJveCIpOwogICAgaWYgKGZvbnRCQm94KSB7CiAgICAgIHByb3BlcnRpZXMuYXNjZW50ID0gTWF0aC5tYXgoZm9udEJCb3hbM10sIGZvbnRCQm94WzFdKTsKICAgICAgcHJvcGVydGllcy5kZXNjZW50ID0gTWF0aC5taW4oZm9udEJCb3hbMV0sIGZvbnRCQm94WzNdKTsKICAgICAgcHJvcGVydGllcy5hc2NlbnRTY2FsZWQgPSB0cnVlOwogICAgfQogICAgbGV0IGNoYXJzZXQsIGVuY29kaW5nOwogICAgaWYgKGNmZi5pc0NJREZvbnQpIHsKICAgICAgY29uc3QgZmRBcnJheUluZGV4ID0gdGhpcy5wYXJzZUluZGV4KHRvcERpY3QuZ2V0QnlOYW1lKCJGREFycmF5IikpLm9iajsKICAgICAgZm9yIChsZXQgaSA9IDAsIGlpID0gZmRBcnJheUluZGV4LmNvdW50OyBpIDwgaWk7ICsraSkgewogICAgICAgIGNvbnN0IGRpY3RSYXcgPSBmZEFycmF5SW5kZXguZ2V0KGkpOwogICAgICAgIGNvbnN0IGZvbnREaWN0ID0gdGhpcy5jcmVhdGVEaWN0KENGRlRvcERpY3QsIHRoaXMucGFyc2VEaWN0KGRpY3RSYXcpLCBjZmYuc3RyaW5ncyk7CiAgICAgICAgdGhpcy5wYXJzZVByaXZhdGVEaWN0KGZvbnREaWN0KTsKICAgICAgICBjZmYuZmRBcnJheS5wdXNoKGZvbnREaWN0KTsKICAgICAgfQogICAgICBlbmNvZGluZyA9IG51bGw7CiAgICAgIGNoYXJzZXQgPSB0aGlzLnBhcnNlQ2hhcnNldHModG9wRGljdC5nZXRCeU5hbWUoImNoYXJzZXQiKSwgY2hhclN0cmluZ0luZGV4LmNvdW50LCBjZmYuc3RyaW5ncywgdHJ1ZSk7CiAgICAgIGNmZi5mZFNlbGVjdCA9IHRoaXMucGFyc2VGRFNlbGVjdCh0b3BEaWN0LmdldEJ5TmFtZSgiRkRTZWxlY3QiKSwgY2hhclN0cmluZ0luZGV4LmNvdW50KTsKICAgIH0gZWxzZSB7CiAgICAgIGNoYXJzZXQgPSB0aGlzLnBhcnNlQ2hhcnNldHModG9wRGljdC5nZXRCeU5hbWUoImNoYXJzZXQiKSwgY2hhclN0cmluZ0luZGV4LmNvdW50LCBjZmYuc3RyaW5ncywgZmFsc2UpOwogICAgICBlbmNvZGluZyA9IHRoaXMucGFyc2VFbmNvZGluZyh0b3BEaWN0LmdldEJ5TmFtZSgiRW5jb2RpbmciKSwgcHJvcGVydGllcywgY2ZmLnN0cmluZ3MsIGNoYXJzZXQuY2hhcnNldCk7CiAgICB9CiAgICBjZmYuY2hhcnNldCA9IGNoYXJzZXQ7CiAgICBjZmYuZW5jb2RpbmcgPSBlbmNvZGluZzsKICAgIGNvbnN0IGNoYXJTdHJpbmdzQW5kU2VhY3MgPSB0aGlzLnBhcnNlQ2hhclN0cmluZ3MoewogICAgICBjaGFyU3RyaW5nczogY2hhclN0cmluZ0luZGV4LAogICAgICBsb2NhbFN1YnJJbmRleDogdG9wRGljdC5wcml2YXRlRGljdC5zdWJyc0luZGV4LAogICAgICBnbG9iYWxTdWJySW5kZXg6IGdsb2JhbFN1YnJJbmRleC5vYmosCiAgICAgIGZkU2VsZWN0OiBjZmYuZmRTZWxlY3QsCiAgICAgIGZkQXJyYXk6IGNmZi5mZEFycmF5LAogICAgICBwcml2YXRlRGljdDogdG9wRGljdC5wcml2YXRlRGljdAogICAgfSk7CiAgICBjZmYuY2hhclN0cmluZ3MgPSBjaGFyU3RyaW5nc0FuZFNlYWNzLmNoYXJTdHJpbmdzOwogICAgY2ZmLnNlYWNzID0gY2hhclN0cmluZ3NBbmRTZWFjcy5zZWFjczsKICAgIGNmZi53aWR0aHMgPSBjaGFyU3RyaW5nc0FuZFNlYWNzLndpZHRoczsKICAgIHJldHVybiBjZmY7CiAgfQogIHBhcnNlSGVhZGVyKCkgewogICAgbGV0IGJ5dGVzID0gdGhpcy5ieXRlczsKICAgIGNvbnN0IGJ5dGVzTGVuZ3RoID0gYnl0ZXMubGVuZ3RoOwogICAgbGV0IG9mZnNldCA9IDA7CiAgICB3aGlsZSAob2Zmc2V0IDwgYnl0ZXNMZW5ndGggJiYgYnl0ZXNbb2Zmc2V0XSAhPT0gMSkgewogICAgICArK29mZnNldDsKICAgIH0KICAgIGlmIChvZmZzZXQgPj0gYnl0ZXNMZW5ndGgpIHsKICAgICAgdGhyb3cgbmV3IF91dGlsLkZvcm1hdEVycm9yKCJJbnZhbGlkIENGRiBoZWFkZXIiKTsKICAgIH0KICAgIGlmIChvZmZzZXQgIT09IDApIHsKICAgICAgKDAsIF91dGlsLmluZm8pKCJjZmYgZGF0YSBpcyBzaGlmdGVkIik7CiAgICAgIGJ5dGVzID0gYnl0ZXMuc3ViYXJyYXkob2Zmc2V0KTsKICAgICAgdGhpcy5ieXRlcyA9IGJ5dGVzOwogICAgfQogICAgY29uc3QgbWFqb3IgPSBieXRlc1swXTsKICAgIGNvbnN0IG1pbm9yID0gYnl0ZXNbMV07CiAgICBjb25zdCBoZHJTaXplID0gYnl0ZXNbMl07CiAgICBjb25zdCBvZmZTaXplID0gYnl0ZXNbM107CiAgICBjb25zdCBoZWFkZXIgPSBuZXcgQ0ZGSGVhZGVyKG1ham9yLCBtaW5vciwgaGRyU2l6ZSwgb2ZmU2l6ZSk7CiAgICByZXR1cm4gewogICAgICBvYmo6IGhlYWRlciwKICAgICAgZW5kUG9zOiBoZHJTaXplCiAgICB9OwogIH0KICBwYXJzZURpY3QoZGljdCkgewogICAgbGV0IHBvcyA9IDA7CiAgICBmdW5jdGlvbiBwYXJzZU9wZXJhbmQoKSB7CiAgICAgIGxldCB2YWx1ZSA9IGRpY3RbcG9zKytdOwogICAgICBpZiAodmFsdWUgPT09IDMwKSB7CiAgICAgICAgcmV0dXJuIHBhcnNlRmxvYXRPcGVyYW5kKCk7CiAgICAgIH0gZWxzZSBpZiAodmFsdWUgPT09IDI4KSB7CiAgICAgICAgdmFsdWUgPSBkaWN0W3BvcysrXTsKICAgICAgICB2YWx1ZSA9ICh2YWx1ZSA8PCAyNCB8IGRpY3RbcG9zKytdIDw8IDE2KSA+PiAxNjsKICAgICAgICByZXR1cm4gdmFsdWU7CiAgICAgIH0gZWxzZSBpZiAodmFsdWUgPT09IDI5KSB7CiAgICAgICAgdmFsdWUgPSBkaWN0W3BvcysrXTsKICAgICAgICB2YWx1ZSA9IHZhbHVlIDw8IDggfCBkaWN0W3BvcysrXTsKICAgICAgICB2YWx1ZSA9IHZhbHVlIDw8IDggfCBkaWN0W3BvcysrXTsKICAgICAgICB2YWx1ZSA9IHZhbHVlIDw8IDggfCBkaWN0W3BvcysrXTsKICAgICAgICByZXR1cm4gdmFsdWU7CiAgICAgIH0gZWxzZSBpZiAodmFsdWUgPj0gMzIgJiYgdmFsdWUgPD0gMjQ2KSB7CiAgICAgICAgcmV0dXJuIHZhbHVlIC0gMTM5OwogICAgICB9IGVsc2UgaWYgKHZhbHVlID49IDI0NyAmJiB2YWx1ZSA8PSAyNTApIHsKICAgICAgICByZXR1cm4gKHZhbHVlIC0gMjQ3KSAqIDI1NiArIGRpY3RbcG9zKytdICsgMTA4OwogICAgICB9IGVsc2UgaWYgKHZhbHVlID49IDI1MSAmJiB2YWx1ZSA8PSAyNTQpIHsKICAgICAgICByZXR1cm4gLSgodmFsdWUgLSAyNTEpICogMjU2KSAtIGRpY3RbcG9zKytdIC0gMTA4OwogICAgICB9CiAgICAgICgwLCBfdXRpbC53YXJuKSgnQ0ZGUGFyc2VyX3BhcnNlRGljdDogIicgKyB2YWx1ZSArICciIGlzIGEgcmVzZXJ2ZWQgY29tbWFuZC4nKTsKICAgICAgcmV0dXJuIE5hTjsKICAgIH0KICAgIGZ1bmN0aW9uIHBhcnNlRmxvYXRPcGVyYW5kKCkgewogICAgICBsZXQgc3RyID0gIiI7CiAgICAgIGNvbnN0IGVvZiA9IDE1OwogICAgICBjb25zdCBsb29rdXAgPSBbIjAiLCAiMSIsICIyIiwgIjMiLCAiNCIsICI1IiwgIjYiLCAiNyIsICI4IiwgIjkiLCAiLiIsICJFIiwgIkUtIiwgbnVsbCwgIi0iXTsKICAgICAgY29uc3QgbGVuZ3RoID0gZGljdC5sZW5ndGg7CiAgICAgIHdoaWxlIChwb3MgPCBsZW5ndGgpIHsKICAgICAgICBjb25zdCBiID0gZGljdFtwb3MrK107CiAgICAgICAgY29uc3QgYjEgPSBiID4+IDQ7CiAgICAgICAgY29uc3QgYjIgPSBiICYgMTU7CiAgICAgICAgaWYgKGIxID09PSBlb2YpIHsKICAgICAgICAgIGJyZWFrOwogICAgICAgIH0KICAgICAgICBzdHIgKz0gbG9va3VwW2IxXTsKICAgICAgICBpZiAoYjIgPT09IGVvZikgewogICAgICAgICAgYnJlYWs7CiAgICAgICAgfQogICAgICAgIHN0ciArPSBsb29rdXBbYjJdOwogICAgICB9CiAgICAgIHJldHVybiBwYXJzZUZsb2F0KHN0cik7CiAgICB9CiAgICBsZXQgb3BlcmFuZHMgPSBbXTsKICAgIGNvbnN0IGVudHJpZXMgPSBbXTsKICAgIHBvcyA9IDA7CiAgICBjb25zdCBlbmQgPSBkaWN0Lmxlbmd0aDsKICAgIHdoaWxlIChwb3MgPCBlbmQpIHsKICAgICAgbGV0IGIgPSBkaWN0W3Bvc107CiAgICAgIGlmIChiIDw9IDIxKSB7CiAgICAgICAgaWYgKGIgPT09IDEyKSB7CiAgICAgICAgICBiID0gYiA8PCA4IHwgZGljdFsrK3Bvc107CiAgICAgICAgfQogICAgICAgIGVudHJpZXMucHVzaChbYiwgb3BlcmFuZHNdKTsKICAgICAgICBvcGVyYW5kcyA9IFtdOwogICAgICAgICsrcG9zOwogICAgICB9IGVsc2UgewogICAgICAgIG9wZXJhbmRzLnB1c2gocGFyc2VPcGVyYW5kKCkpOwogICAgICB9CiAgICB9CiAgICByZXR1cm4gZW50cmllczsKICB9CiAgcGFyc2VJbmRleChwb3MpIHsKICAgIGNvbnN0IGNmZkluZGV4ID0gbmV3IENGRkluZGV4KCk7CiAgICBjb25zdCBieXRlcyA9IHRoaXMuYnl0ZXM7CiAgICBjb25zdCBjb3VudCA9IGJ5dGVzW3BvcysrXSA8PCA4IHwgYnl0ZXNbcG9zKytdOwogICAgY29uc3Qgb2Zmc2V0cyA9IFtdOwogICAgbGV0IGVuZCA9IHBvczsKICAgIGxldCBpLCBpaTsKICAgIGlmIChjb3VudCAhPT0gMCkgewogICAgICBjb25zdCBvZmZzZXRTaXplID0gYnl0ZXNbcG9zKytdOwogICAgICBjb25zdCBzdGFydFBvcyA9IHBvcyArIChjb3VudCArIDEpICogb2Zmc2V0U2l6ZSAtIDE7CiAgICAgIGZvciAoaSA9IDAsIGlpID0gY291bnQgKyAxOyBpIDwgaWk7ICsraSkgewogICAgICAgIGxldCBvZmZzZXQgPSAwOwogICAgICAgIGZvciAobGV0IGogPSAwOyBqIDwgb2Zmc2V0U2l6ZTsgKytqKSB7CiAgICAgICAgICBvZmZzZXQgPDw9IDg7CiAgICAgICAgICBvZmZzZXQgKz0gYnl0ZXNbcG9zKytdOwogICAgICAgIH0KICAgICAgICBvZmZzZXRzLnB1c2goc3RhcnRQb3MgKyBvZmZzZXQpOwogICAgICB9CiAgICAgIGVuZCA9IG9mZnNldHNbY291bnRdOwogICAgfQogICAgZm9yIChpID0gMCwgaWkgPSBvZmZzZXRzLmxlbmd0aCAtIDE7IGkgPCBpaTsgKytpKSB7CiAgICAgIGNvbnN0IG9mZnNldFN0YXJ0ID0gb2Zmc2V0c1tpXTsKICAgICAgY29uc3Qgb2Zmc2V0RW5kID0gb2Zmc2V0c1tpICsgMV07CiAgICAgIGNmZkluZGV4LmFkZChieXRlcy5zdWJhcnJheShvZmZzZXRTdGFydCwgb2Zmc2V0RW5kKSk7CiAgICB9CiAgICByZXR1cm4gewogICAgICBvYmo6IGNmZkluZGV4LAogICAgICBlbmRQb3M6IGVuZAogICAgfTsKICB9CiAgcGFyc2VOYW1lSW5kZXgoaW5kZXgpIHsKICAgIGNvbnN0IG5hbWVzID0gW107CiAgICBmb3IgKGxldCBpID0gMCwgaWkgPSBpbmRleC5jb3VudDsgaSA8IGlpOyArK2kpIHsKICAgICAgY29uc3QgbmFtZSA9IGluZGV4LmdldChpKTsKICAgICAgbmFtZXMucHVzaCgoMCwgX3V0aWwuYnl0ZXNUb1N0cmluZykobmFtZSkpOwogICAgfQogICAgcmV0dXJuIG5hbWVzOwogIH0KICBwYXJzZVN0cmluZ0luZGV4KGluZGV4KSB7CiAgICBjb25zdCBzdHJpbmdzID0gbmV3IENGRlN0cmluZ3MoKTsKICAgIGZvciAobGV0IGkgPSAwLCBpaSA9IGluZGV4LmNvdW50OyBpIDwgaWk7ICsraSkgewogICAgICBjb25zdCBkYXRhID0gaW5kZXguZ2V0KGkpOwogICAgICBzdHJpbmdzLmFkZCgoMCwgX3V0aWwuYnl0ZXNUb1N0cmluZykoZGF0YSkpOwogICAgfQogICAgcmV0dXJuIHN0cmluZ3M7CiAgfQogIGNyZWF0ZURpY3QoVHlwZSwgZGljdCwgc3RyaW5ncykgewogICAgY29uc3QgY2ZmRGljdCA9IG5ldyBUeXBlKHN0cmluZ3MpOwogICAgZm9yIChjb25zdCBba2V5LCB2YWx1ZV0gb2YgZGljdCkgewogICAgICBjZmZEaWN0LnNldEJ5S2V5KGtleSwgdmFsdWUpOwogICAgfQogICAgcmV0dXJuIGNmZkRpY3Q7CiAgfQogIHBhcnNlQ2hhclN0cmluZyhzdGF0ZSwgZGF0YSwgbG9jYWxTdWJySW5kZXgsIGdsb2JhbFN1YnJJbmRleCkgewogICAgaWYgKCFkYXRhIHx8IHN0YXRlLmNhbGxEZXB0aCA+IE1BWF9TVUJSX05FU1RJTkcpIHsKICAgICAgcmV0dXJuIGZhbHNlOwogICAgfQogICAgbGV0IHN0YWNrU2l6ZSA9IHN0YXRlLnN0YWNrU2l6ZTsKICAgIGNvbnN0IHN0YWNrID0gc3RhdGUuc3RhY2s7CiAgICBsZXQgbGVuZ3RoID0gZGF0YS5sZW5ndGg7CiAgICBmb3IgKGxldCBqID0gMDsgaiA8IGxlbmd0aDspIHsKICAgICAgY29uc3QgdmFsdWUgPSBkYXRhW2orK107CiAgICAgIGxldCB2YWxpZGF0aW9uQ29tbWFuZCA9IG51bGw7CiAgICAgIGlmICh2YWx1ZSA9PT0gMTIpIHsKICAgICAgICBjb25zdCBxID0gZGF0YVtqKytdOwogICAgICAgIGlmIChxID09PSAwKSB7CiAgICAgICAgICBkYXRhW2ogLSAyXSA9IDEzOTsKICAgICAgICAgIGRhdGFbaiAtIDFdID0gMjI7CiAgICAgICAgICBzdGFja1NpemUgPSAwOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICB2YWxpZGF0aW9uQ29tbWFuZCA9IENoYXJzdHJpbmdWYWxpZGF0aW9uRGF0YTEyW3FdOwogICAgICAgIH0KICAgICAgfSBlbHNlIGlmICh2YWx1ZSA9PT0gMjgpIHsKICAgICAgICBzdGFja1tzdGFja1NpemVdID0gKGRhdGFbal0gPDwgMjQgfCBkYXRhW2ogKyAxXSA8PCAxNikgPj4gMTY7CiAgICAgICAgaiArPSAyOwogICAgICAgIHN0YWNrU2l6ZSsrOwogICAgICB9IGVsc2UgaWYgKHZhbHVlID09PSAxNCkgewogICAgICAgIGlmIChzdGFja1NpemUgPj0gNCkgewogICAgICAgICAgc3RhY2tTaXplIC09IDQ7CiAgICAgICAgICBpZiAodGhpcy5zZWFjQW5hbHlzaXNFbmFibGVkKSB7CiAgICAgICAgICAgIHN0YXRlLnNlYWMgPSBzdGFjay5zbGljZShzdGFja1NpemUsIHN0YWNrU2l6ZSArIDQpOwogICAgICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIHZhbGlkYXRpb25Db21tYW5kID0gQ2hhcnN0cmluZ1ZhbGlkYXRpb25EYXRhW3ZhbHVlXTsKICAgICAgfSBlbHNlIGlmICh2YWx1ZSA+PSAzMiAmJiB2YWx1ZSA8PSAyNDYpIHsKICAgICAgICBzdGFja1tzdGFja1NpemVdID0gdmFsdWUgLSAxMzk7CiAgICAgICAgc3RhY2tTaXplKys7CiAgICAgIH0gZWxzZSBpZiAodmFsdWUgPj0gMjQ3ICYmIHZhbHVlIDw9IDI1NCkgewogICAgICAgIHN0YWNrW3N0YWNrU2l6ZV0gPSB2YWx1ZSA8IDI1MSA/ICh2YWx1ZSAtIDI0NyA8PCA4KSArIGRhdGFbal0gKyAxMDggOiAtKHZhbHVlIC0gMjUxIDw8IDgpIC0gZGF0YVtqXSAtIDEwODsKICAgICAgICBqKys7CiAgICAgICAgc3RhY2tTaXplKys7CiAgICAgIH0gZWxzZSBpZiAodmFsdWUgPT09IDI1NSkgewogICAgICAgIHN0YWNrW3N0YWNrU2l6ZV0gPSAoZGF0YVtqXSA8PCAyNCB8IGRhdGFbaiArIDFdIDw8IDE2IHwgZGF0YVtqICsgMl0gPDwgOCB8IGRhdGFbaiArIDNdKSAvIDY1NTM2OwogICAgICAgIGogKz0gNDsKICAgICAgICBzdGFja1NpemUrKzsKICAgICAgfSBlbHNlIGlmICh2YWx1ZSA9PT0gMTkgfHwgdmFsdWUgPT09IDIwKSB7CiAgICAgICAgc3RhdGUuaGludHMgKz0gc3RhY2tTaXplID4+IDE7CiAgICAgICAgaWYgKHN0YXRlLmhpbnRzID09PSAwKSB7CiAgICAgICAgICBkYXRhLmNvcHlXaXRoaW4oaiAtIDEsIGosIC0xKTsKICAgICAgICAgIGogLT0gMTsKICAgICAgICAgIGxlbmd0aCAtPSAxOwogICAgICAgICAgY29udGludWU7CiAgICAgICAgfQogICAgICAgIGogKz0gc3RhdGUuaGludHMgKyA3ID4+IDM7CiAgICAgICAgc3RhY2tTaXplICU9IDI7CiAgICAgICAgdmFsaWRhdGlvbkNvbW1hbmQgPSBDaGFyc3RyaW5nVmFsaWRhdGlvbkRhdGFbdmFsdWVdOwogICAgICB9IGVsc2UgaWYgKHZhbHVlID09PSAxMCB8fCB2YWx1ZSA9PT0gMjkpIHsKICAgICAgICBjb25zdCBzdWJyc0luZGV4ID0gdmFsdWUgPT09IDEwID8gbG9jYWxTdWJySW5kZXggOiBnbG9iYWxTdWJySW5kZXg7CiAgICAgICAgaWYgKCFzdWJyc0luZGV4KSB7CiAgICAgICAgICB2YWxpZGF0aW9uQ29tbWFuZCA9IENoYXJzdHJpbmdWYWxpZGF0aW9uRGF0YVt2YWx1ZV07CiAgICAgICAgICAoMCwgX3V0aWwud2FybikoIk1pc3Npbmcgc3VicnNJbmRleCBmb3IgIiArIHZhbGlkYXRpb25Db21tYW5kLmlkKTsKICAgICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgICB9CiAgICAgICAgbGV0IGJpYXMgPSAzMjc2ODsKICAgICAgICBpZiAoc3VicnNJbmRleC5jb3VudCA8IDEyNDApIHsKICAgICAgICAgIGJpYXMgPSAxMDc7CiAgICAgICAgfSBlbHNlIGlmIChzdWJyc0luZGV4LmNvdW50IDwgMzM5MDApIHsKICAgICAgICAgIGJpYXMgPSAxMTMxOwogICAgICAgIH0KICAgICAgICBjb25zdCBzdWJyTnVtYmVyID0gc3RhY2tbLS1zdGFja1NpemVdICsgYmlhczsKICAgICAgICBpZiAoc3Vick51bWJlciA8IDAgfHwgc3Vick51bWJlciA+PSBzdWJyc0luZGV4LmNvdW50IHx8IGlzTmFOKHN1YnJOdW1iZXIpKSB7CiAgICAgICAgICB2YWxpZGF0aW9uQ29tbWFuZCA9IENoYXJzdHJpbmdWYWxpZGF0aW9uRGF0YVt2YWx1ZV07CiAgICAgICAgICAoMCwgX3V0aWwud2FybikoIk91dCBvZiBib3VuZHMgc3VickluZGV4IGZvciAiICsgdmFsaWRhdGlvbkNvbW1hbmQuaWQpOwogICAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICAgIH0KICAgICAgICBzdGF0ZS5zdGFja1NpemUgPSBzdGFja1NpemU7CiAgICAgICAgc3RhdGUuY2FsbERlcHRoKys7CiAgICAgICAgY29uc3QgdmFsaWQgPSB0aGlzLnBhcnNlQ2hhclN0cmluZyhzdGF0ZSwgc3VicnNJbmRleC5nZXQoc3Vick51bWJlciksIGxvY2FsU3VickluZGV4LCBnbG9iYWxTdWJySW5kZXgpOwogICAgICAgIGlmICghdmFsaWQpIHsKICAgICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgICB9CiAgICAgICAgc3RhdGUuY2FsbERlcHRoLS07CiAgICAgICAgc3RhY2tTaXplID0gc3RhdGUuc3RhY2tTaXplOwogICAgICAgIGNvbnRpbnVlOwogICAgICB9IGVsc2UgaWYgKHZhbHVlID09PSAxMSkgewogICAgICAgIHN0YXRlLnN0YWNrU2l6ZSA9IHN0YWNrU2l6ZTsKICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgfSBlbHNlIGlmICh2YWx1ZSA9PT0gMCAmJiBqID09PSBkYXRhLmxlbmd0aCkgewogICAgICAgIGRhdGFbaiAtIDFdID0gMTQ7CiAgICAgICAgdmFsaWRhdGlvbkNvbW1hbmQgPSBDaGFyc3RyaW5nVmFsaWRhdGlvbkRhdGFbMTRdOwogICAgICB9IGVsc2UgaWYgKHZhbHVlID09PSA5KSB7CiAgICAgICAgZGF0YS5jb3B5V2l0aGluKGogLSAxLCBqLCAtMSk7CiAgICAgICAgaiAtPSAxOwogICAgICAgIGxlbmd0aCAtPSAxOwogICAgICAgIGNvbnRpbnVlOwogICAgICB9IGVsc2UgewogICAgICAgIHZhbGlkYXRpb25Db21tYW5kID0gQ2hhcnN0cmluZ1ZhbGlkYXRpb25EYXRhW3ZhbHVlXTsKICAgICAgfQogICAgICBpZiAodmFsaWRhdGlvbkNvbW1hbmQpIHsKICAgICAgICBpZiAodmFsaWRhdGlvbkNvbW1hbmQuc3RlbSkgewogICAgICAgICAgc3RhdGUuaGludHMgKz0gc3RhY2tTaXplID4+IDE7CiAgICAgICAgICBpZiAodmFsdWUgPT09IDMgfHwgdmFsdWUgPT09IDIzKSB7CiAgICAgICAgICAgIHN0YXRlLmhhc1ZTdGVtcyA9IHRydWU7CiAgICAgICAgICB9IGVsc2UgaWYgKHN0YXRlLmhhc1ZTdGVtcyAmJiAodmFsdWUgPT09IDEgfHwgdmFsdWUgPT09IDE4KSkgewogICAgICAgICAgICAoMCwgX3V0aWwud2FybikoIkNGRiBzdGVtIGhpbnRzIGFyZSBpbiB3cm9uZyBvcmRlciIpOwogICAgICAgICAgICBkYXRhW2ogLSAxXSA9IHZhbHVlID09PSAxID8gMyA6IDIzOwogICAgICAgICAgfQogICAgICAgIH0KICAgICAgICBpZiAoIm1pbiIgaW4gdmFsaWRhdGlvbkNvbW1hbmQpIHsKICAgICAgICAgIGlmICghc3RhdGUudW5kZWZTdGFjayAmJiBzdGFja1NpemUgPCB2YWxpZGF0aW9uQ29tbWFuZC5taW4pIHsKICAgICAgICAgICAgKDAsIF91dGlsLndhcm4pKCJOb3QgZW5vdWdoIHBhcmFtZXRlcnMgZm9yICIgKyB2YWxpZGF0aW9uQ29tbWFuZC5pZCArICI7IGFjdHVhbDogIiArIHN0YWNrU2l6ZSArICIsIGV4cGVjdGVkOiAiICsgdmFsaWRhdGlvbkNvbW1hbmQubWluKTsKICAgICAgICAgICAgaWYgKHN0YWNrU2l6ZSA9PT0gMCkgewogICAgICAgICAgICAgIGRhdGFbaiAtIDFdID0gMTQ7CiAgICAgICAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICAgICAgfQogICAgICAgIH0KICAgICAgICBpZiAoc3RhdGUuZmlyc3RTdGFja0NsZWFyaW5nICYmIHZhbGlkYXRpb25Db21tYW5kLnN0YWNrQ2xlYXJpbmcpIHsKICAgICAgICAgIHN0YXRlLmZpcnN0U3RhY2tDbGVhcmluZyA9IGZhbHNlOwogICAgICAgICAgc3RhY2tTaXplIC09IHZhbGlkYXRpb25Db21tYW5kLm1pbjsKICAgICAgICAgIGlmIChzdGFja1NpemUgPj0gMiAmJiB2YWxpZGF0aW9uQ29tbWFuZC5zdGVtKSB7CiAgICAgICAgICAgIHN0YWNrU2l6ZSAlPSAyOwogICAgICAgICAgfSBlbHNlIGlmIChzdGFja1NpemUgPiAxKSB7CiAgICAgICAgICAgICgwLCBfdXRpbC53YXJuKSgiRm91bmQgdG9vIG1hbnkgcGFyYW1ldGVycyBmb3Igc3RhY2stY2xlYXJpbmcgY29tbWFuZCIpOwogICAgICAgICAgfQogICAgICAgICAgaWYgKHN0YWNrU2l6ZSA+IDApIHsKICAgICAgICAgICAgc3RhdGUud2lkdGggPSBzdGFja1tzdGFja1NpemUgLSAxXTsKICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgaWYgKCJzdGFja0RlbHRhIiBpbiB2YWxpZGF0aW9uQ29tbWFuZCkgewogICAgICAgICAgaWYgKCJzdGFja0ZuIiBpbiB2YWxpZGF0aW9uQ29tbWFuZCkgewogICAgICAgICAgICB2YWxpZGF0aW9uQ29tbWFuZC5zdGFja0ZuKHN0YWNrLCBzdGFja1NpemUpOwogICAgICAgICAgfQogICAgICAgICAgc3RhY2tTaXplICs9IHZhbGlkYXRpb25Db21tYW5kLnN0YWNrRGVsdGE7CiAgICAgICAgfSBlbHNlIGlmICh2YWxpZGF0aW9uQ29tbWFuZC5zdGFja0NsZWFyaW5nKSB7CiAgICAgICAgICBzdGFja1NpemUgPSAwOwogICAgICAgIH0gZWxzZSBpZiAodmFsaWRhdGlvbkNvbW1hbmQucmVzZXRTdGFjaykgewogICAgICAgICAgc3RhY2tTaXplID0gMDsKICAgICAgICAgIHN0YXRlLnVuZGVmU3RhY2sgPSBmYWxzZTsKICAgICAgICB9IGVsc2UgaWYgKHZhbGlkYXRpb25Db21tYW5kLnVuZGVmU3RhY2spIHsKICAgICAgICAgIHN0YWNrU2l6ZSA9IDA7CiAgICAgICAgICBzdGF0ZS51bmRlZlN0YWNrID0gdHJ1ZTsKICAgICAgICAgIHN0YXRlLmZpcnN0U3RhY2tDbGVhcmluZyA9IGZhbHNlOwogICAgICAgIH0KICAgICAgfQogICAgfQogICAgaWYgKGxlbmd0aCA8IGRhdGEubGVuZ3RoKSB7CiAgICAgIGRhdGEuZmlsbCgxNCwgbGVuZ3RoKTsKICAgIH0KICAgIHN0YXRlLnN0YWNrU2l6ZSA9IHN0YWNrU2l6ZTsKICAgIHJldHVybiB0cnVlOwogIH0KICBwYXJzZUNoYXJTdHJpbmdzKHsKICAgIGNoYXJTdHJpbmdzLAogICAgbG9jYWxTdWJySW5kZXgsCiAgICBnbG9iYWxTdWJySW5kZXgsCiAgICBmZFNlbGVjdCwKICAgIGZkQXJyYXksCiAgICBwcml2YXRlRGljdAogIH0pIHsKICAgIGNvbnN0IHNlYWNzID0gW107CiAgICBjb25zdCB3aWR0aHMgPSBbXTsKICAgIGNvbnN0IGNvdW50ID0gY2hhclN0cmluZ3MuY291bnQ7CiAgICBmb3IgKGxldCBpID0gMDsgaSA8IGNvdW50OyBpKyspIHsKICAgICAgY29uc3QgY2hhcnN0cmluZyA9IGNoYXJTdHJpbmdzLmdldChpKTsKICAgICAgY29uc3Qgc3RhdGUgPSB7CiAgICAgICAgY2FsbERlcHRoOiAwLAogICAgICAgIHN0YWNrU2l6ZTogMCwKICAgICAgICBzdGFjazogW10sCiAgICAgICAgdW5kZWZTdGFjazogdHJ1ZSwKICAgICAgICBoaW50czogMCwKICAgICAgICBmaXJzdFN0YWNrQ2xlYXJpbmc6IHRydWUsCiAgICAgICAgc2VhYzogbnVsbCwKICAgICAgICB3aWR0aDogbnVsbCwKICAgICAgICBoYXNWU3RlbXM6IGZhbHNlCiAgICAgIH07CiAgICAgIGxldCB2YWxpZCA9IHRydWU7CiAgICAgIGxldCBsb2NhbFN1YnJUb1VzZSA9IG51bGw7CiAgICAgIGxldCBwcml2YXRlRGljdFRvVXNlID0gcHJpdmF0ZURpY3Q7CiAgICAgIGlmIChmZFNlbGVjdCAmJiBmZEFycmF5Lmxlbmd0aCkgewogICAgICAgIGNvbnN0IGZkSW5kZXggPSBmZFNlbGVjdC5nZXRGREluZGV4KGkpOwogICAgICAgIGlmIChmZEluZGV4ID09PSAtMSkgewogICAgICAgICAgKDAsIF91dGlsLndhcm4pKCJHbHlwaCBpbmRleCBpcyBub3QgaW4gZmQgc2VsZWN0LiIpOwogICAgICAgICAgdmFsaWQgPSBmYWxzZTsKICAgICAgICB9CiAgICAgICAgaWYgKGZkSW5kZXggPj0gZmRBcnJheS5sZW5ndGgpIHsKICAgICAgICAgICgwLCBfdXRpbC53YXJuKSgiSW52YWxpZCBmZCBpbmRleCBmb3IgZ2x5cGggaW5kZXguIik7CiAgICAgICAgICB2YWxpZCA9IGZhbHNlOwogICAgICAgIH0KICAgICAgICBpZiAodmFsaWQpIHsKICAgICAgICAgIHByaXZhdGVEaWN0VG9Vc2UgPSBmZEFycmF5W2ZkSW5kZXhdLnByaXZhdGVEaWN0OwogICAgICAgICAgbG9jYWxTdWJyVG9Vc2UgPSBwcml2YXRlRGljdFRvVXNlLnN1YnJzSW5kZXg7CiAgICAgICAgfQogICAgICB9IGVsc2UgaWYgKGxvY2FsU3VickluZGV4KSB7CiAgICAgICAgbG9jYWxTdWJyVG9Vc2UgPSBsb2NhbFN1YnJJbmRleDsKICAgICAgfQogICAgICBpZiAodmFsaWQpIHsKICAgICAgICB2YWxpZCA9IHRoaXMucGFyc2VDaGFyU3RyaW5nKHN0YXRlLCBjaGFyc3RyaW5nLCBsb2NhbFN1YnJUb1VzZSwgZ2xvYmFsU3VickluZGV4KTsKICAgICAgfQogICAgICBpZiAoc3RhdGUud2lkdGggIT09IG51bGwpIHsKICAgICAgICBjb25zdCBub21pbmFsV2lkdGggPSBwcml2YXRlRGljdFRvVXNlLmdldEJ5TmFtZSgibm9taW5hbFdpZHRoWCIpOwogICAgICAgIHdpZHRoc1tpXSA9IG5vbWluYWxXaWR0aCArIHN0YXRlLndpZHRoOwogICAgICB9IGVsc2UgewogICAgICAgIGNvbnN0IGRlZmF1bHRXaWR0aCA9IHByaXZhdGVEaWN0VG9Vc2UuZ2V0QnlOYW1lKCJkZWZhdWx0V2lkdGhYIik7CiAgICAgICAgd2lkdGhzW2ldID0gZGVmYXVsdFdpZHRoOwogICAgICB9CiAgICAgIGlmIChzdGF0ZS5zZWFjICE9PSBudWxsKSB7CiAgICAgICAgc2VhY3NbaV0gPSBzdGF0ZS5zZWFjOwogICAgICB9CiAgICAgIGlmICghdmFsaWQpIHsKICAgICAgICBjaGFyU3RyaW5ncy5zZXQoaSwgbmV3IFVpbnQ4QXJyYXkoWzE0XSkpOwogICAgICB9CiAgICB9CiAgICByZXR1cm4gewogICAgICBjaGFyU3RyaW5ncywKICAgICAgc2VhY3MsCiAgICAgIHdpZHRocwogICAgfTsKICB9CiAgZW1wdHlQcml2YXRlRGljdGlvbmFyeShwYXJlbnREaWN0KSB7CiAgICBjb25zdCBwcml2YXRlRGljdCA9IHRoaXMuY3JlYXRlRGljdChDRkZQcml2YXRlRGljdCwgW10sIHBhcmVudERpY3Quc3RyaW5ncyk7CiAgICBwYXJlbnREaWN0LnNldEJ5S2V5KDE4LCBbMCwgMF0pOwogICAgcGFyZW50RGljdC5wcml2YXRlRGljdCA9IHByaXZhdGVEaWN0OwogIH0KICBwYXJzZVByaXZhdGVEaWN0KHBhcmVudERpY3QpIHsKICAgIGlmICghcGFyZW50RGljdC5oYXNOYW1lKCJQcml2YXRlIikpIHsKICAgICAgdGhpcy5lbXB0eVByaXZhdGVEaWN0aW9uYXJ5KHBhcmVudERpY3QpOwogICAgICByZXR1cm47CiAgICB9CiAgICBjb25zdCBwcml2YXRlT2Zmc2V0ID0gcGFyZW50RGljdC5nZXRCeU5hbWUoIlByaXZhdGUiKTsKICAgIGlmICghQXJyYXkuaXNBcnJheShwcml2YXRlT2Zmc2V0KSB8fCBwcml2YXRlT2Zmc2V0Lmxlbmd0aCAhPT0gMikgewogICAgICBwYXJlbnREaWN0LnJlbW92ZUJ5TmFtZSgiUHJpdmF0ZSIpOwogICAgICByZXR1cm47CiAgICB9CiAgICBjb25zdCBzaXplID0gcHJpdmF0ZU9mZnNldFswXTsKICAgIGNvbnN0IG9mZnNldCA9IHByaXZhdGVPZmZzZXRbMV07CiAgICBpZiAoc2l6ZSA9PT0gMCB8fCBvZmZzZXQgPj0gdGhpcy5ieXRlcy5sZW5ndGgpIHsKICAgICAgdGhpcy5lbXB0eVByaXZhdGVEaWN0aW9uYXJ5KHBhcmVudERpY3QpOwogICAgICByZXR1cm47CiAgICB9CiAgICBjb25zdCBwcml2YXRlRGljdEVuZCA9IG9mZnNldCArIHNpemU7CiAgICBjb25zdCBkaWN0RGF0YSA9IHRoaXMuYnl0ZXMuc3ViYXJyYXkob2Zmc2V0LCBwcml2YXRlRGljdEVuZCk7CiAgICBjb25zdCBkaWN0ID0gdGhpcy5wYXJzZURpY3QoZGljdERhdGEpOwogICAgY29uc3QgcHJpdmF0ZURpY3QgPSB0aGlzLmNyZWF0ZURpY3QoQ0ZGUHJpdmF0ZURpY3QsIGRpY3QsIHBhcmVudERpY3Quc3RyaW5ncyk7CiAgICBwYXJlbnREaWN0LnByaXZhdGVEaWN0ID0gcHJpdmF0ZURpY3Q7CiAgICBpZiAocHJpdmF0ZURpY3QuZ2V0QnlOYW1lKCJFeHBhbnNpb25GYWN0b3IiKSA9PT0gMCkgewogICAgICBwcml2YXRlRGljdC5zZXRCeU5hbWUoIkV4cGFuc2lvbkZhY3RvciIsIDAuMDYpOwogICAgfQogICAgaWYgKCFwcml2YXRlRGljdC5nZXRCeU5hbWUoIlN1YnJzIikpIHsKICAgICAgcmV0dXJuOwogICAgfQogICAgY29uc3Qgc3VicnNPZmZzZXQgPSBwcml2YXRlRGljdC5nZXRCeU5hbWUoIlN1YnJzIik7CiAgICBjb25zdCByZWxhdGl2ZU9mZnNldCA9IG9mZnNldCArIHN1YnJzT2Zmc2V0OwogICAgaWYgKHN1YnJzT2Zmc2V0ID09PSAwIHx8IHJlbGF0aXZlT2Zmc2V0ID49IHRoaXMuYnl0ZXMubGVuZ3RoKSB7CiAgICAgIHRoaXMuZW1wdHlQcml2YXRlRGljdGlvbmFyeShwYXJlbnREaWN0KTsKICAgICAgcmV0dXJuOwogICAgfQogICAgY29uc3Qgc3VicnNJbmRleCA9IHRoaXMucGFyc2VJbmRleChyZWxhdGl2ZU9mZnNldCk7CiAgICBwcml2YXRlRGljdC5zdWJyc0luZGV4ID0gc3VicnNJbmRleC5vYmo7CiAgfQogIHBhcnNlQ2hhcnNldHMocG9zLCBsZW5ndGgsIHN0cmluZ3MsIGNpZCkgewogICAgaWYgKHBvcyA9PT0gMCkgewogICAgICByZXR1cm4gbmV3IENGRkNoYXJzZXQodHJ1ZSwgQ0ZGQ2hhcnNldFByZWRlZmluZWRUeXBlcy5JU09fQURPQkUsIF9jaGFyc2V0cy5JU09BZG9iZUNoYXJzZXQpOwogICAgfSBlbHNlIGlmIChwb3MgPT09IDEpIHsKICAgICAgcmV0dXJuIG5ldyBDRkZDaGFyc2V0KHRydWUsIENGRkNoYXJzZXRQcmVkZWZpbmVkVHlwZXMuRVhQRVJULCBfY2hhcnNldHMuRXhwZXJ0Q2hhcnNldCk7CiAgICB9IGVsc2UgaWYgKHBvcyA9PT0gMikgewogICAgICByZXR1cm4gbmV3IENGRkNoYXJzZXQodHJ1ZSwgQ0ZGQ2hhcnNldFByZWRlZmluZWRUeXBlcy5FWFBFUlRfU1VCU0VULCBfY2hhcnNldHMuRXhwZXJ0U3Vic2V0Q2hhcnNldCk7CiAgICB9CiAgICBjb25zdCBieXRlcyA9IHRoaXMuYnl0ZXM7CiAgICBjb25zdCBzdGFydCA9IHBvczsKICAgIGNvbnN0IGZvcm1hdCA9IGJ5dGVzW3BvcysrXTsKICAgIGNvbnN0IGNoYXJzZXQgPSBbY2lkID8gMCA6ICIubm90ZGVmIl07CiAgICBsZXQgaWQsIGNvdW50LCBpOwogICAgbGVuZ3RoIC09IDE7CiAgICBzd2l0Y2ggKGZvcm1hdCkgewogICAgICBjYXNlIDA6CiAgICAgICAgZm9yIChpID0gMDsgaSA8IGxlbmd0aDsgaSsrKSB7CiAgICAgICAgICBpZCA9IGJ5dGVzW3BvcysrXSA8PCA4IHwgYnl0ZXNbcG9zKytdOwogICAgICAgICAgY2hhcnNldC5wdXNoKGNpZCA/IGlkIDogc3RyaW5ncy5nZXQoaWQpKTsKICAgICAgICB9CiAgICAgICAgYnJlYWs7CiAgICAgIGNhc2UgMToKICAgICAgICB3aGlsZSAoY2hhcnNldC5sZW5ndGggPD0gbGVuZ3RoKSB7CiAgICAgICAgICBpZCA9IGJ5dGVzW3BvcysrXSA8PCA4IHwgYnl0ZXNbcG9zKytdOwogICAgICAgICAgY291bnQgPSBieXRlc1twb3MrK107CiAgICAgICAgICBmb3IgKGkgPSAwOyBpIDw9IGNvdW50OyBpKyspIHsKICAgICAgICAgICAgY2hhcnNldC5wdXNoKGNpZCA/IGlkKysgOiBzdHJpbmdzLmdldChpZCsrKSk7CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIGJyZWFrOwogICAgICBjYXNlIDI6CiAgICAgICAgd2hpbGUgKGNoYXJzZXQubGVuZ3RoIDw9IGxlbmd0aCkgewogICAgICAgICAgaWQgPSBieXRlc1twb3MrK10gPDwgOCB8IGJ5dGVzW3BvcysrXTsKICAgICAgICAgIGNvdW50ID0gYnl0ZXNbcG9zKytdIDw8IDggfCBieXRlc1twb3MrK107CiAgICAgICAgICBmb3IgKGkgPSAwOyBpIDw9IGNvdW50OyBpKyspIHsKICAgICAgICAgICAgY2hhcnNldC5wdXNoKGNpZCA/IGlkKysgOiBzdHJpbmdzLmdldChpZCsrKSk7CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIGJyZWFrOwogICAgICBkZWZhdWx0OgogICAgICAgIHRocm93IG5ldyBfdXRpbC5Gb3JtYXRFcnJvcigiVW5rbm93biBjaGFyc2V0IGZvcm1hdCIpOwogICAgfQogICAgY29uc3QgZW5kID0gcG9zOwogICAgY29uc3QgcmF3ID0gYnl0ZXMuc3ViYXJyYXkoc3RhcnQsIGVuZCk7CiAgICByZXR1cm4gbmV3IENGRkNoYXJzZXQoZmFsc2UsIGZvcm1hdCwgY2hhcnNldCwgcmF3KTsKICB9CiAgcGFyc2VFbmNvZGluZyhwb3MsIHByb3BlcnRpZXMsIHN0cmluZ3MsIGNoYXJzZXQpIHsKICAgIGNvbnN0IGVuY29kaW5nID0gT2JqZWN0LmNyZWF0ZShudWxsKTsKICAgIGNvbnN0IGJ5dGVzID0gdGhpcy5ieXRlczsKICAgIGxldCBwcmVkZWZpbmVkID0gZmFsc2U7CiAgICBsZXQgZm9ybWF0LCBpLCBpaTsKICAgIGxldCByYXcgPSBudWxsOwogICAgZnVuY3Rpb24gcmVhZFN1cHBsZW1lbnQoKSB7CiAgICAgIGNvbnN0IHN1cHBsZW1lbnRzQ291bnQgPSBieXRlc1twb3MrK107CiAgICAgIGZvciAoaSA9IDA7IGkgPCBzdXBwbGVtZW50c0NvdW50OyBpKyspIHsKICAgICAgICBjb25zdCBjb2RlID0gYnl0ZXNbcG9zKytdOwogICAgICAgIGNvbnN0IHNpZCA9IChieXRlc1twb3MrK10gPDwgOCkgKyAoYnl0ZXNbcG9zKytdICYgMHhmZik7CiAgICAgICAgZW5jb2RpbmdbY29kZV0gPSBjaGFyc2V0LmluZGV4T2Yoc3RyaW5ncy5nZXQoc2lkKSk7CiAgICAgIH0KICAgIH0KICAgIGlmIChwb3MgPT09IDAgfHwgcG9zID09PSAxKSB7CiAgICAgIHByZWRlZmluZWQgPSB0cnVlOwogICAgICBmb3JtYXQgPSBwb3M7CiAgICAgIGNvbnN0IGJhc2VFbmNvZGluZyA9IHBvcyA/IF9lbmNvZGluZ3MuRXhwZXJ0RW5jb2RpbmcgOiBfZW5jb2RpbmdzLlN0YW5kYXJkRW5jb2Rpbmc7CiAgICAgIGZvciAoaSA9IDAsIGlpID0gY2hhcnNldC5sZW5ndGg7IGkgPCBpaTsgaSsrKSB7CiAgICAgICAgY29uc3QgaW5kZXggPSBiYXNlRW5jb2RpbmcuaW5kZXhPZihjaGFyc2V0W2ldKTsKICAgICAgICBpZiAoaW5kZXggIT09IC0xKSB7CiAgICAgICAgICBlbmNvZGluZ1tpbmRleF0gPSBpOwogICAgICAgIH0KICAgICAgfQogICAgfSBlbHNlIHsKICAgICAgY29uc3QgZGF0YVN0YXJ0ID0gcG9zOwogICAgICBmb3JtYXQgPSBieXRlc1twb3MrK107CiAgICAgIHN3aXRjaCAoZm9ybWF0ICYgMHg3ZikgewogICAgICAgIGNhc2UgMDoKICAgICAgICAgIGNvbnN0IGdseXBoc0NvdW50ID0gYnl0ZXNbcG9zKytdOwogICAgICAgICAgZm9yIChpID0gMTsgaSA8PSBnbHlwaHNDb3VudDsgaSsrKSB7CiAgICAgICAgICAgIGVuY29kaW5nW2J5dGVzW3BvcysrXV0gPSBpOwogICAgICAgICAgfQogICAgICAgICAgYnJlYWs7CiAgICAgICAgY2FzZSAxOgogICAgICAgICAgY29uc3QgcmFuZ2VzQ291bnQgPSBieXRlc1twb3MrK107CiAgICAgICAgICBsZXQgZ2lkID0gMTsKICAgICAgICAgIGZvciAoaSA9IDA7IGkgPCByYW5nZXNDb3VudDsgaSsrKSB7CiAgICAgICAgICAgIGNvbnN0IHN0YXJ0ID0gYnl0ZXNbcG9zKytdOwogICAgICAgICAgICBjb25zdCBsZWZ0ID0gYnl0ZXNbcG9zKytdOwogICAgICAgICAgICBmb3IgKGxldCBqID0gc3RhcnQ7IGogPD0gc3RhcnQgKyBsZWZ0OyBqKyspIHsKICAgICAgICAgICAgICBlbmNvZGluZ1tqXSA9IGdpZCsrOwogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgICBicmVhazsKICAgICAgICBkZWZhdWx0OgogICAgICAgICAgdGhyb3cgbmV3IF91dGlsLkZvcm1hdEVycm9yKGBVbmtub3duIGVuY29kaW5nIGZvcm1hdDogJHtmb3JtYXR9IGluIENGRmApOwogICAgICB9CiAgICAgIGNvbnN0IGRhdGFFbmQgPSBwb3M7CiAgICAgIGlmIChmb3JtYXQgJiAweDgwKSB7CiAgICAgICAgYnl0ZXNbZGF0YVN0YXJ0XSAmPSAweDdmOwogICAgICAgIHJlYWRTdXBwbGVtZW50KCk7CiAgICAgIH0KICAgICAgcmF3ID0gYnl0ZXMuc3ViYXJyYXkoZGF0YVN0YXJ0LCBkYXRhRW5kKTsKICAgIH0KICAgIGZvcm1hdCAmPSAweDdmOwogICAgcmV0dXJuIG5ldyBDRkZFbmNvZGluZyhwcmVkZWZpbmVkLCBmb3JtYXQsIGVuY29kaW5nLCByYXcpOwogIH0KICBwYXJzZUZEU2VsZWN0KHBvcywgbGVuZ3RoKSB7CiAgICBjb25zdCBieXRlcyA9IHRoaXMuYnl0ZXM7CiAgICBjb25zdCBmb3JtYXQgPSBieXRlc1twb3MrK107CiAgICBjb25zdCBmZFNlbGVjdCA9IFtdOwogICAgbGV0IGk7CiAgICBzd2l0Y2ggKGZvcm1hdCkgewogICAgICBjYXNlIDA6CiAgICAgICAgZm9yIChpID0gMDsgaSA8IGxlbmd0aDsgKytpKSB7CiAgICAgICAgICBjb25zdCBpZCA9IGJ5dGVzW3BvcysrXTsKICAgICAgICAgIGZkU2VsZWN0LnB1c2goaWQpOwogICAgICAgIH0KICAgICAgICBicmVhazsKICAgICAgY2FzZSAzOgogICAgICAgIGNvbnN0IHJhbmdlc0NvdW50ID0gYnl0ZXNbcG9zKytdIDw8IDggfCBieXRlc1twb3MrK107CiAgICAgICAgZm9yIChpID0gMDsgaSA8IHJhbmdlc0NvdW50OyArK2kpIHsKICAgICAgICAgIGxldCBmaXJzdCA9IGJ5dGVzW3BvcysrXSA8PCA4IHwgYnl0ZXNbcG9zKytdOwogICAgICAgICAgaWYgKGkgPT09IDAgJiYgZmlyc3QgIT09IDApIHsKICAgICAgICAgICAgKDAsIF91dGlsLndhcm4pKCJwYXJzZUZEU2VsZWN0OiBUaGUgZmlyc3QgcmFuZ2UgbXVzdCBoYXZlIGEgZmlyc3QgR0lEIG9mIDAiICsgIiAtLSB0cnlpbmcgdG8gcmVjb3Zlci4iKTsKICAgICAgICAgICAgZmlyc3QgPSAwOwogICAgICAgICAgfQogICAgICAgICAgY29uc3QgZmRJbmRleCA9IGJ5dGVzW3BvcysrXTsKICAgICAgICAgIGNvbnN0IG5leHQgPSBieXRlc1twb3NdIDw8IDggfCBieXRlc1twb3MgKyAxXTsKICAgICAgICAgIGZvciAobGV0IGogPSBmaXJzdDsgaiA8IG5leHQ7ICsraikgewogICAgICAgICAgICBmZFNlbGVjdC5wdXNoKGZkSW5kZXgpOwogICAgICAgICAgfQogICAgICAgIH0KICAgICAgICBwb3MgKz0gMjsKICAgICAgICBicmVhazsKICAgICAgZGVmYXVsdDoKICAgICAgICB0aHJvdyBuZXcgX3V0aWwuRm9ybWF0RXJyb3IoYHBhcnNlRkRTZWxlY3Q6IFVua25vd24gZm9ybWF0ICIke2Zvcm1hdH0iLmApOwogICAgfQogICAgaWYgKGZkU2VsZWN0Lmxlbmd0aCAhPT0gbGVuZ3RoKSB7CiAgICAgIHRocm93IG5ldyBfdXRpbC5Gb3JtYXRFcnJvcigicGFyc2VGRFNlbGVjdDogSW52YWxpZCBmb250IGRhdGEuIik7CiAgICB9CiAgICByZXR1cm4gbmV3IENGRkZEU2VsZWN0KGZvcm1hdCwgZmRTZWxlY3QpOwogIH0KfQpleHBvcnRzLkNGRlBhcnNlciA9IENGRlBhcnNlcjsKY2xhc3MgQ0ZGIHsKICBjb25zdHJ1Y3RvcigpIHsKICAgIHRoaXMuaGVhZGVyID0gbnVsbDsKICAgIHRoaXMubmFtZXMgPSBbXTsKICAgIHRoaXMudG9wRGljdCA9IG51bGw7CiAgICB0aGlzLnN0cmluZ3MgPSBuZXcgQ0ZGU3RyaW5ncygpOwogICAgdGhpcy5nbG9iYWxTdWJySW5kZXggPSBudWxsOwogICAgdGhpcy5lbmNvZGluZyA9IG51bGw7CiAgICB0aGlzLmNoYXJzZXQgPSBudWxsOwogICAgdGhpcy5jaGFyU3RyaW5ncyA9IG51bGw7CiAgICB0aGlzLmZkQXJyYXkgPSBbXTsKICAgIHRoaXMuZmRTZWxlY3QgPSBudWxsOwogICAgdGhpcy5pc0NJREZvbnQgPSBmYWxzZTsKICB9CiAgZHVwbGljYXRlRmlyc3RHbHlwaCgpIHsKICAgIGlmICh0aGlzLmNoYXJTdHJpbmdzLmNvdW50ID49IDY1NTM1KSB7CiAgICAgICgwLCBfdXRpbC53YXJuKSgiTm90IGVub3VnaCBzcGFjZSBpbiBjaGFyc3RyaW5ncyB0byBkdXBsaWNhdGUgZmlyc3QgZ2x5cGguIik7CiAgICAgIHJldHVybjsKICAgIH0KICAgIGNvbnN0IGdseXBoWmVybyA9IHRoaXMuY2hhclN0cmluZ3MuZ2V0KDApOwogICAgdGhpcy5jaGFyU3RyaW5ncy5hZGQoZ2x5cGhaZXJvKTsKICAgIGlmICh0aGlzLmlzQ0lERm9udCkgewogICAgICB0aGlzLmZkU2VsZWN0LmZkU2VsZWN0LnB1c2godGhpcy5mZFNlbGVjdC5mZFNlbGVjdFswXSk7CiAgICB9CiAgfQogIGhhc0dseXBoSWQoaWQpIHsKICAgIGlmIChpZCA8IDAgfHwgaWQgPj0gdGhpcy5jaGFyU3RyaW5ncy5jb3VudCkgewogICAgICByZXR1cm4gZmFsc2U7CiAgICB9CiAgICBjb25zdCBnbHlwaCA9IHRoaXMuY2hhclN0cmluZ3MuZ2V0KGlkKTsKICAgIHJldHVybiBnbHlwaC5sZW5ndGggPiAwOwogIH0KfQpleHBvcnRzLkNGRiA9IENGRjsKY2xhc3MgQ0ZGSGVhZGVyIHsKICBjb25zdHJ1Y3RvcihtYWpvciwgbWlub3IsIGhkclNpemUsIG9mZlNpemUpIHsKICAgIHRoaXMubWFqb3IgPSBtYWpvcjsKICAgIHRoaXMubWlub3IgPSBtaW5vcjsKICAgIHRoaXMuaGRyU2l6ZSA9IGhkclNpemU7CiAgICB0aGlzLm9mZlNpemUgPSBvZmZTaXplOwogIH0KfQpleHBvcnRzLkNGRkhlYWRlciA9IENGRkhlYWRlcjsKY2xhc3MgQ0ZGU3RyaW5ncyB7CiAgY29uc3RydWN0b3IoKSB7CiAgICB0aGlzLnN0cmluZ3MgPSBbXTsKICB9CiAgZ2V0KGluZGV4KSB7CiAgICBpZiAoaW5kZXggPj0gMCAmJiBpbmRleCA8PSBOVU1fU1RBTkRBUkRfQ0ZGX1NUUklOR1MgLSAxKSB7CiAgICAgIHJldHVybiBDRkZTdGFuZGFyZFN0cmluZ3NbaW5kZXhdOwogICAgfQogICAgaWYgKGluZGV4IC0gTlVNX1NUQU5EQVJEX0NGRl9TVFJJTkdTIDw9IHRoaXMuc3RyaW5ncy5sZW5ndGgpIHsKICAgICAgcmV0dXJuIHRoaXMuc3RyaW5nc1tpbmRleCAtIE5VTV9TVEFOREFSRF9DRkZfU1RSSU5HU107CiAgICB9CiAgICByZXR1cm4gQ0ZGU3RhbmRhcmRTdHJpbmdzWzBdOwogIH0KICBnZXRTSUQoc3RyKSB7CiAgICBsZXQgaW5kZXggPSBDRkZTdGFuZGFyZFN0cmluZ3MuaW5kZXhPZihzdHIpOwogICAgaWYgKGluZGV4ICE9PSAtMSkgewogICAgICByZXR1cm4gaW5kZXg7CiAgICB9CiAgICBpbmRleCA9IHRoaXMuc3RyaW5ncy5pbmRleE9mKHN0cik7CiAgICBpZiAoaW5kZXggIT09IC0xKSB7CiAgICAgIHJldHVybiBpbmRleCArIE5VTV9TVEFOREFSRF9DRkZfU1RSSU5HUzsKICAgIH0KICAgIHJldHVybiAtMTsKICB9CiAgYWRkKHZhbHVlKSB7CiAgICB0aGlzLnN0cmluZ3MucHVzaCh2YWx1ZSk7CiAgfQogIGdldCBjb3VudCgpIHsKICAgIHJldHVybiB0aGlzLnN0cmluZ3MubGVuZ3RoOwogIH0KfQpleHBvcnRzLkNGRlN0cmluZ3MgPSBDRkZTdHJpbmdzOwpjbGFzcyBDRkZJbmRleCB7CiAgY29uc3RydWN0b3IoKSB7CiAgICB0aGlzLm9iamVjdHMgPSBbXTsKICAgIHRoaXMubGVuZ3RoID0gMDsKICB9CiAgYWRkKGRhdGEpIHsKICAgIHRoaXMubGVuZ3RoICs9IGRhdGEubGVuZ3RoOwogICAgdGhpcy5vYmplY3RzLnB1c2goZGF0YSk7CiAgfQogIHNldChpbmRleCwgZGF0YSkgewogICAgdGhpcy5sZW5ndGggKz0gZGF0YS5sZW5ndGggLSB0aGlzLm9iamVjdHNbaW5kZXhdLmxlbmd0aDsKICAgIHRoaXMub2JqZWN0c1tpbmRleF0gPSBkYXRhOwogIH0KICBnZXQoaW5kZXgpIHsKICAgIHJldHVybiB0aGlzLm9iamVjdHNbaW5kZXhdOwogIH0KICBnZXQgY291bnQoKSB7CiAgICByZXR1cm4gdGhpcy5vYmplY3RzLmxlbmd0aDsKICB9Cn0KZXhwb3J0cy5DRkZJbmRleCA9IENGRkluZGV4OwpjbGFzcyBDRkZEaWN0IHsKICBjb25zdHJ1Y3Rvcih0YWJsZXMsIHN0cmluZ3MpIHsKICAgIHRoaXMua2V5VG9OYW1lTWFwID0gdGFibGVzLmtleVRvTmFtZU1hcDsKICAgIHRoaXMubmFtZVRvS2V5TWFwID0gdGFibGVzLm5hbWVUb0tleU1hcDsKICAgIHRoaXMuZGVmYXVsdHMgPSB0YWJsZXMuZGVmYXVsdHM7CiAgICB0aGlzLnR5cGVzID0gdGFibGVzLnR5cGVzOwogICAgdGhpcy5vcGNvZGVzID0gdGFibGVzLm9wY29kZXM7CiAgICB0aGlzLm9yZGVyID0gdGFibGVzLm9yZGVyOwogICAgdGhpcy5zdHJpbmdzID0gc3RyaW5nczsKICAgIHRoaXMudmFsdWVzID0gT2JqZWN0LmNyZWF0ZShudWxsKTsKICB9CiAgc2V0QnlLZXkoa2V5LCB2YWx1ZSkgewogICAgaWYgKCEoa2V5IGluIHRoaXMua2V5VG9OYW1lTWFwKSkgewogICAgICByZXR1cm4gZmFsc2U7CiAgICB9CiAgICBpZiAodmFsdWUubGVuZ3RoID09PSAwKSB7CiAgICAgIHJldHVybiB0cnVlOwogICAgfQogICAgZm9yIChjb25zdCB2YWwgb2YgdmFsdWUpIHsKICAgICAgaWYgKGlzTmFOKHZhbCkpIHsKICAgICAgICAoMCwgX3V0aWwud2FybikoYEludmFsaWQgQ0ZGRGljdCB2YWx1ZTogIiR7dmFsdWV9IiBmb3Iga2V5ICIke2tleX0iLmApOwogICAgICAgIHJldHVybiB0cnVlOwogICAgICB9CiAgICB9CiAgICBjb25zdCB0eXBlID0gdGhpcy50eXBlc1trZXldOwogICAgaWYgKHR5cGUgPT09ICJudW0iIHx8IHR5cGUgPT09ICJzaWQiIHx8IHR5cGUgPT09ICJvZmZzZXQiKSB7CiAgICAgIHZhbHVlID0gdmFsdWVbMF07CiAgICB9CiAgICB0aGlzLnZhbHVlc1trZXldID0gdmFsdWU7CiAgICByZXR1cm4gdHJ1ZTsKICB9CiAgc2V0QnlOYW1lKG5hbWUsIHZhbHVlKSB7CiAgICBpZiAoIShuYW1lIGluIHRoaXMubmFtZVRvS2V5TWFwKSkgewogICAgICB0aHJvdyBuZXcgX3V0aWwuRm9ybWF0RXJyb3IoYEludmFsaWQgZGljdGlvbmFyeSBuYW1lICIke25hbWV9ImApOwogICAgfQogICAgdGhpcy52YWx1ZXNbdGhpcy5uYW1lVG9LZXlNYXBbbmFtZV1dID0gdmFsdWU7CiAgfQogIGhhc05hbWUobmFtZSkgewogICAgcmV0dXJuIHRoaXMubmFtZVRvS2V5TWFwW25hbWVdIGluIHRoaXMudmFsdWVzOwogIH0KICBnZXRCeU5hbWUobmFtZSkgewogICAgaWYgKCEobmFtZSBpbiB0aGlzLm5hbWVUb0tleU1hcCkpIHsKICAgICAgdGhyb3cgbmV3IF91dGlsLkZvcm1hdEVycm9yKGBJbnZhbGlkIGRpY3Rpb25hcnkgbmFtZSAke25hbWV9ImApOwogICAgfQogICAgY29uc3Qga2V5ID0gdGhpcy5uYW1lVG9LZXlNYXBbbmFtZV07CiAgICBpZiAoIShrZXkgaW4gdGhpcy52YWx1ZXMpKSB7CiAgICAgIHJldHVybiB0aGlzLmRlZmF1bHRzW2tleV07CiAgICB9CiAgICByZXR1cm4gdGhpcy52YWx1ZXNba2V5XTsKICB9CiAgcmVtb3ZlQnlOYW1lKG5hbWUpIHsKICAgIGRlbGV0ZSB0aGlzLnZhbHVlc1t0aGlzLm5hbWVUb0tleU1hcFtuYW1lXV07CiAgfQogIHN0YXRpYyBjcmVhdGVUYWJsZXMobGF5b3V0KSB7CiAgICBjb25zdCB0YWJsZXMgPSB7CiAgICAgIGtleVRvTmFtZU1hcDoge30sCiAgICAgIG5hbWVUb0tleU1hcDoge30sCiAgICAgIGRlZmF1bHRzOiB7fSwKICAgICAgdHlwZXM6IHt9LAogICAgICBvcGNvZGVzOiB7fSwKICAgICAgb3JkZXI6IFtdCiAgICB9OwogICAgZm9yIChjb25zdCBlbnRyeSBvZiBsYXlvdXQpIHsKICAgICAgY29uc3Qga2V5ID0gQXJyYXkuaXNBcnJheShlbnRyeVswXSkgPyAoZW50cnlbMF1bMF0gPDwgOCkgKyBlbnRyeVswXVsxXSA6IGVudHJ5WzBdOwogICAgICB0YWJsZXMua2V5VG9OYW1lTWFwW2tleV0gPSBlbnRyeVsxXTsKICAgICAgdGFibGVzLm5hbWVUb0tleU1hcFtlbnRyeVsxXV0gPSBrZXk7CiAgICAgIHRhYmxlcy50eXBlc1trZXldID0gZW50cnlbMl07CiAgICAgIHRhYmxlcy5kZWZhdWx0c1trZXldID0gZW50cnlbM107CiAgICAgIHRhYmxlcy5vcGNvZGVzW2tleV0gPSBBcnJheS5pc0FycmF5KGVudHJ5WzBdKSA/IGVudHJ5WzBdIDogW2VudHJ5WzBdXTsKICAgICAgdGFibGVzLm9yZGVyLnB1c2goa2V5KTsKICAgIH0KICAgIHJldHVybiB0YWJsZXM7CiAgfQp9CmNvbnN0IENGRlRvcERpY3RMYXlvdXQgPSBbW1sxMiwgMzBdLCAiUk9TIiwgWyJzaWQiLCAic2lkIiwgIm51bSJdLCBudWxsXSwgW1sxMiwgMjBdLCAiU3ludGhldGljQmFzZSIsICJudW0iLCBudWxsXSwgWzAsICJ2ZXJzaW9uIiwgInNpZCIsIG51bGxdLCBbMSwgIk5vdGljZSIsICJzaWQiLCBudWxsXSwgW1sxMiwgMF0sICJDb3B5cmlnaHQiLCAic2lkIiwgbnVsbF0sIFsyLCAiRnVsbE5hbWUiLCAic2lkIiwgbnVsbF0sIFszLCAiRmFtaWx5TmFtZSIsICJzaWQiLCBudWxsXSwgWzQsICJXZWlnaHQiLCAic2lkIiwgbnVsbF0sIFtbMTIsIDFdLCAiaXNGaXhlZFBpdGNoIiwgIm51bSIsIDBdLCBbWzEyLCAyXSwgIkl0YWxpY0FuZ2xlIiwgIm51bSIsIDBdLCBbWzEyLCAzXSwgIlVuZGVybGluZVBvc2l0aW9uIiwgIm51bSIsIC0xMDBdLCBbWzEyLCA0XSwgIlVuZGVybGluZVRoaWNrbmVzcyIsICJudW0iLCA1MF0sIFtbMTIsIDVdLCAiUGFpbnRUeXBlIiwgIm51bSIsIDBdLCBbWzEyLCA2XSwgIkNoYXJzdHJpbmdUeXBlIiwgIm51bSIsIDJdLCBbWzEyLCA3XSwgIkZvbnRNYXRyaXgiLCBbIm51bSIsICJudW0iLCAibnVtIiwgIm51bSIsICJudW0iLCAibnVtIl0sIFswLjAwMSwgMCwgMCwgMC4wMDEsIDAsIDBdXSwgWzEzLCAiVW5pcXVlSUQiLCAibnVtIiwgbnVsbF0sIFs1LCAiRm9udEJCb3giLCBbIm51bSIsICJudW0iLCAibnVtIiwgIm51bSJdLCBbMCwgMCwgMCwgMF1dLCBbWzEyLCA4XSwgIlN0cm9rZVdpZHRoIiwgIm51bSIsIDBdLCBbMTQsICJYVUlEIiwgImFycmF5IiwgbnVsbF0sIFsxNSwgImNoYXJzZXQiLCAib2Zmc2V0IiwgMF0sIFsxNiwgIkVuY29kaW5nIiwgIm9mZnNldCIsIDBdLCBbMTcsICJDaGFyU3RyaW5ncyIsICJvZmZzZXQiLCAwXSwgWzE4LCAiUHJpdmF0ZSIsIFsib2Zmc2V0IiwgIm9mZnNldCJdLCBudWxsXSwgW1sxMiwgMjFdLCAiUG9zdFNjcmlwdCIsICJzaWQiLCBudWxsXSwgW1sxMiwgMjJdLCAiQmFzZUZvbnROYW1lIiwgInNpZCIsIG51bGxdLCBbWzEyLCAyM10sICJCYXNlRm9udEJsZW5kIiwgImRlbHRhIiwgbnVsbF0sIFtbMTIsIDMxXSwgIkNJREZvbnRWZXJzaW9uIiwgIm51bSIsIDBdLCBbWzEyLCAzMl0sICJDSURGb250UmV2aXNpb24iLCAibnVtIiwgMF0sIFtbMTIsIDMzXSwgIkNJREZvbnRUeXBlIiwgIm51bSIsIDBdLCBbWzEyLCAzNF0sICJDSURDb3VudCIsICJudW0iLCA4NzIwXSwgW1sxMiwgMzVdLCAiVUlEQmFzZSIsICJudW0iLCBudWxsXSwgW1sxMiwgMzddLCAiRkRTZWxlY3QiLCAib2Zmc2V0IiwgbnVsbF0sIFtbMTIsIDM2XSwgIkZEQXJyYXkiLCAib2Zmc2V0IiwgbnVsbF0sIFtbMTIsIDM4XSwgIkZvbnROYW1lIiwgInNpZCIsIG51bGxdXTsKY2xhc3MgQ0ZGVG9wRGljdCBleHRlbmRzIENGRkRpY3QgewogIHN0YXRpYyBnZXQgdGFibGVzKCkgewogICAgcmV0dXJuICgwLCBfdXRpbC5zaGFkb3cpKHRoaXMsICJ0YWJsZXMiLCB0aGlzLmNyZWF0ZVRhYmxlcyhDRkZUb3BEaWN0TGF5b3V0KSk7CiAgfQogIGNvbnN0cnVjdG9yKHN0cmluZ3MpIHsKICAgIHN1cGVyKENGRlRvcERpY3QudGFibGVzLCBzdHJpbmdzKTsKICAgIHRoaXMucHJpdmF0ZURpY3QgPSBudWxsOwogIH0KfQpleHBvcnRzLkNGRlRvcERpY3QgPSBDRkZUb3BEaWN0Owpjb25zdCBDRkZQcml2YXRlRGljdExheW91dCA9IFtbNiwgIkJsdWVWYWx1ZXMiLCAiZGVsdGEiLCBudWxsXSwgWzcsICJPdGhlckJsdWVzIiwgImRlbHRhIiwgbnVsbF0sIFs4LCAiRmFtaWx5Qmx1ZXMiLCAiZGVsdGEiLCBudWxsXSwgWzksICJGYW1pbHlPdGhlckJsdWVzIiwgImRlbHRhIiwgbnVsbF0sIFtbMTIsIDldLCAiQmx1ZVNjYWxlIiwgIm51bSIsIDAuMDM5NjI1XSwgW1sxMiwgMTBdLCAiQmx1ZVNoaWZ0IiwgIm51bSIsIDddLCBbWzEyLCAxMV0sICJCbHVlRnV6eiIsICJudW0iLCAxXSwgWzEwLCAiU3RkSFciLCAibnVtIiwgbnVsbF0sIFsxMSwgIlN0ZFZXIiwgIm51bSIsIG51bGxdLCBbWzEyLCAxMl0sICJTdGVtU25hcEgiLCAiZGVsdGEiLCBudWxsXSwgW1sxMiwgMTNdLCAiU3RlbVNuYXBWIiwgImRlbHRhIiwgbnVsbF0sIFtbMTIsIDE0XSwgIkZvcmNlQm9sZCIsICJudW0iLCAwXSwgW1sxMiwgMTddLCAiTGFuZ3VhZ2VHcm91cCIsICJudW0iLCAwXSwgW1sxMiwgMThdLCAiRXhwYW5zaW9uRmFjdG9yIiwgIm51bSIsIDAuMDZdLCBbWzEyLCAxOV0sICJpbml0aWFsUmFuZG9tU2VlZCIsICJudW0iLCAwXSwgWzIwLCAiZGVmYXVsdFdpZHRoWCIsICJudW0iLCAwXSwgWzIxLCAibm9taW5hbFdpZHRoWCIsICJudW0iLCAwXSwgWzE5LCAiU3VicnMiLCAib2Zmc2V0IiwgbnVsbF1dOwpjbGFzcyBDRkZQcml2YXRlRGljdCBleHRlbmRzIENGRkRpY3QgewogIHN0YXRpYyBnZXQgdGFibGVzKCkgewogICAgcmV0dXJuICgwLCBfdXRpbC5zaGFkb3cpKHRoaXMsICJ0YWJsZXMiLCB0aGlzLmNyZWF0ZVRhYmxlcyhDRkZQcml2YXRlRGljdExheW91dCkpOwogIH0KICBjb25zdHJ1Y3RvcihzdHJpbmdzKSB7CiAgICBzdXBlcihDRkZQcml2YXRlRGljdC50YWJsZXMsIHN0cmluZ3MpOwogICAgdGhpcy5zdWJyc0luZGV4ID0gbnVsbDsKICB9Cn0KZXhwb3J0cy5DRkZQcml2YXRlRGljdCA9IENGRlByaXZhdGVEaWN0Owpjb25zdCBDRkZDaGFyc2V0UHJlZGVmaW5lZFR5cGVzID0gewogIElTT19BRE9CRTogMCwKICBFWFBFUlQ6IDEsCiAgRVhQRVJUX1NVQlNFVDogMgp9OwpjbGFzcyBDRkZDaGFyc2V0IHsKICBjb25zdHJ1Y3RvcihwcmVkZWZpbmVkLCBmb3JtYXQsIGNoYXJzZXQsIHJhdykgewogICAgdGhpcy5wcmVkZWZpbmVkID0gcHJlZGVmaW5lZDsKICAgIHRoaXMuZm9ybWF0ID0gZm9ybWF0OwogICAgdGhpcy5jaGFyc2V0ID0gY2hhcnNldDsKICAgIHRoaXMucmF3ID0gcmF3OwogIH0KfQpleHBvcnRzLkNGRkNoYXJzZXQgPSBDRkZDaGFyc2V0OwpjbGFzcyBDRkZFbmNvZGluZyB7CiAgY29uc3RydWN0b3IocHJlZGVmaW5lZCwgZm9ybWF0LCBlbmNvZGluZywgcmF3KSB7CiAgICB0aGlzLnByZWRlZmluZWQgPSBwcmVkZWZpbmVkOwogICAgdGhpcy5mb3JtYXQgPSBmb3JtYXQ7CiAgICB0aGlzLmVuY29kaW5nID0gZW5jb2Rpbmc7CiAgICB0aGlzLnJhdyA9IHJhdzsKICB9Cn0KY2xhc3MgQ0ZGRkRTZWxlY3QgewogIGNvbnN0cnVjdG9yKGZvcm1hdCwgZmRTZWxlY3QpIHsKICAgIHRoaXMuZm9ybWF0ID0gZm9ybWF0OwogICAgdGhpcy5mZFNlbGVjdCA9IGZkU2VsZWN0OwogIH0KICBnZXRGREluZGV4KGdseXBoSW5kZXgpIHsKICAgIGlmIChnbHlwaEluZGV4IDwgMCB8fCBnbHlwaEluZGV4ID49IHRoaXMuZmRTZWxlY3QubGVuZ3RoKSB7CiAgICAgIHJldHVybiAtMTsKICAgIH0KICAgIHJldHVybiB0aGlzLmZkU2VsZWN0W2dseXBoSW5kZXhdOwogIH0KfQpleHBvcnRzLkNGRkZEU2VsZWN0ID0gQ0ZGRkRTZWxlY3Q7CmNsYXNzIENGRk9mZnNldFRyYWNrZXIgewogIGNvbnN0cnVjdG9yKCkgewogICAgdGhpcy5vZmZzZXRzID0gT2JqZWN0LmNyZWF0ZShudWxsKTsKICB9CiAgaXNUcmFja2luZyhrZXkpIHsKICAgIHJldHVybiBrZXkgaW4gdGhpcy5vZmZzZXRzOwogIH0KICB0cmFjayhrZXksIGxvY2F0aW9uKSB7CiAgICBpZiAoa2V5IGluIHRoaXMub2Zmc2V0cykgewogICAgICB0aHJvdyBuZXcgX3V0aWwuRm9ybWF0RXJyb3IoYEFscmVhZHkgdHJhY2tpbmcgbG9jYXRpb24gb2YgJHtrZXl9YCk7CiAgICB9CiAgICB0aGlzLm9mZnNldHNba2V5XSA9IGxvY2F0aW9uOwogIH0KICBvZmZzZXQodmFsdWUpIHsKICAgIGZvciAoY29uc3Qga2V5IGluIHRoaXMub2Zmc2V0cykgewogICAgICB0aGlzLm9mZnNldHNba2V5XSArPSB2YWx1ZTsKICAgIH0KICB9CiAgc2V0RW50cnlMb2NhdGlvbihrZXksIHZhbHVlcywgb3V0cHV0KSB7CiAgICBpZiAoIShrZXkgaW4gdGhpcy5vZmZzZXRzKSkgewogICAgICB0aHJvdyBuZXcgX3V0aWwuRm9ybWF0RXJyb3IoYE5vdCB0cmFja2luZyBsb2NhdGlvbiBvZiAke2tleX1gKTsKICAgIH0KICAgIGNvbnN0IGRhdGEgPSBvdXRwdXQuZGF0YTsKICAgIGNvbnN0IGRhdGFPZmZzZXQgPSB0aGlzLm9mZnNldHNba2V5XTsKICAgIGNvbnN0IHNpemUgPSA1OwogICAgZm9yIChsZXQgaSA9IDAsIGlpID0gdmFsdWVzLmxlbmd0aDsgaSA8IGlpOyArK2kpIHsKICAgICAgY29uc3Qgb2Zmc2V0MCA9IGkgKiBzaXplICsgZGF0YU9mZnNldDsKICAgICAgY29uc3Qgb2Zmc2V0MSA9IG9mZnNldDAgKyAxOwogICAgICBjb25zdCBvZmZzZXQyID0gb2Zmc2V0MCArIDI7CiAgICAgIGNvbnN0IG9mZnNldDMgPSBvZmZzZXQwICsgMzsKICAgICAgY29uc3Qgb2Zmc2V0NCA9IG9mZnNldDAgKyA0OwogICAgICBpZiAoZGF0YVtvZmZzZXQwXSAhPT0gMHgxZCB8fCBkYXRhW29mZnNldDFdICE9PSAwIHx8IGRhdGFbb2Zmc2V0Ml0gIT09IDAgfHwgZGF0YVtvZmZzZXQzXSAhPT0gMCB8fCBkYXRhW29mZnNldDRdICE9PSAwKSB7CiAgICAgICAgdGhyb3cgbmV3IF91dGlsLkZvcm1hdEVycm9yKCJ3cml0aW5nIHRvIGFuIG9mZnNldCB0aGF0IGlzIG5vdCBlbXB0eSIpOwogICAgICB9CiAgICAgIGNvbnN0IHZhbHVlID0gdmFsdWVzW2ldOwogICAgICBkYXRhW29mZnNldDBdID0gMHgxZDsKICAgICAgZGF0YVtvZmZzZXQxXSA9IHZhbHVlID4+IDI0ICYgMHhmZjsKICAgICAgZGF0YVtvZmZzZXQyXSA9IHZhbHVlID4+IDE2ICYgMHhmZjsKICAgICAgZGF0YVtvZmZzZXQzXSA9IHZhbHVlID4+IDggJiAweGZmOwogICAgICBkYXRhW29mZnNldDRdID0gdmFsdWUgJiAweGZmOwogICAgfQogIH0KfQpjbGFzcyBDRkZDb21waWxlciB7CiAgY29uc3RydWN0b3IoY2ZmKSB7CiAgICB0aGlzLmNmZiA9IGNmZjsKICB9CiAgY29tcGlsZSgpIHsKICAgIGNvbnN0IGNmZiA9IHRoaXMuY2ZmOwogICAgY29uc3Qgb3V0cHV0ID0gewogICAgICBkYXRhOiBbXSwKICAgICAgbGVuZ3RoOiAwLAogICAgICBhZGQoZGF0YSkgewogICAgICAgIHRyeSB7CiAgICAgICAgICB0aGlzLmRhdGEucHVzaCguLi5kYXRhKTsKICAgICAgICB9IGNhdGNoIHsKICAgICAgICAgIHRoaXMuZGF0YSA9IHRoaXMuZGF0YS5jb25jYXQoZGF0YSk7CiAgICAgICAgfQogICAgICAgIHRoaXMubGVuZ3RoID0gdGhpcy5kYXRhLmxlbmd0aDsKICAgICAgfQogICAgfTsKICAgIGNvbnN0IGhlYWRlciA9IHRoaXMuY29tcGlsZUhlYWRlcihjZmYuaGVhZGVyKTsKICAgIG91dHB1dC5hZGQoaGVhZGVyKTsKICAgIGNvbnN0IG5hbWVJbmRleCA9IHRoaXMuY29tcGlsZU5hbWVJbmRleChjZmYubmFtZXMpOwogICAgb3V0cHV0LmFkZChuYW1lSW5kZXgpOwogICAgaWYgKGNmZi5pc0NJREZvbnQpIHsKICAgICAgaWYgKGNmZi50b3BEaWN0Lmhhc05hbWUoIkZvbnRNYXRyaXgiKSkgewogICAgICAgIGNvbnN0IGJhc2UgPSBjZmYudG9wRGljdC5nZXRCeU5hbWUoIkZvbnRNYXRyaXgiKTsKICAgICAgICBjZmYudG9wRGljdC5yZW1vdmVCeU5hbWUoIkZvbnRNYXRyaXgiKTsKICAgICAgICBmb3IgKGNvbnN0IHN1YkRpY3Qgb2YgY2ZmLmZkQXJyYXkpIHsKICAgICAgICAgIGxldCBtYXRyaXggPSBiYXNlLnNsaWNlKDApOwogICAgICAgICAgaWYgKHN1YkRpY3QuaGFzTmFtZSgiRm9udE1hdHJpeCIpKSB7CiAgICAgICAgICAgIG1hdHJpeCA9IF91dGlsLlV0aWwudHJhbnNmb3JtKG1hdHJpeCwgc3ViRGljdC5nZXRCeU5hbWUoIkZvbnRNYXRyaXgiKSk7CiAgICAgICAgICB9CiAgICAgICAgICBzdWJEaWN0LnNldEJ5TmFtZSgiRm9udE1hdHJpeCIsIG1hdHJpeCk7CiAgICAgICAgfQogICAgICB9CiAgICB9CiAgICBjb25zdCB4dWlkID0gY2ZmLnRvcERpY3QuZ2V0QnlOYW1lKCJYVUlEIik7CiAgICBpZiAoeHVpZD8ubGVuZ3RoID4gMTYpIHsKICAgICAgY2ZmLnRvcERpY3QucmVtb3ZlQnlOYW1lKCJYVUlEIik7CiAgICB9CiAgICBjZmYudG9wRGljdC5zZXRCeU5hbWUoImNoYXJzZXQiLCAwKTsKICAgIGxldCBjb21waWxlZCA9IHRoaXMuY29tcGlsZVRvcERpY3RzKFtjZmYudG9wRGljdF0sIG91dHB1dC5sZW5ndGgsIGNmZi5pc0NJREZvbnQpOwogICAgb3V0cHV0LmFkZChjb21waWxlZC5vdXRwdXQpOwogICAgY29uc3QgdG9wRGljdFRyYWNrZXIgPSBjb21waWxlZC50cmFja2Vyc1swXTsKICAgIGNvbnN0IHN0cmluZ0luZGV4ID0gdGhpcy5jb21waWxlU3RyaW5nSW5kZXgoY2ZmLnN0cmluZ3Muc3RyaW5ncyk7CiAgICBvdXRwdXQuYWRkKHN0cmluZ0luZGV4KTsKICAgIGNvbnN0IGdsb2JhbFN1YnJJbmRleCA9IHRoaXMuY29tcGlsZUluZGV4KGNmZi5nbG9iYWxTdWJySW5kZXgpOwogICAgb3V0cHV0LmFkZChnbG9iYWxTdWJySW5kZXgpOwogICAgaWYgKGNmZi5lbmNvZGluZyAmJiBjZmYudG9wRGljdC5oYXNOYW1lKCJFbmNvZGluZyIpKSB7CiAgICAgIGlmIChjZmYuZW5jb2RpbmcucHJlZGVmaW5lZCkgewogICAgICAgIHRvcERpY3RUcmFja2VyLnNldEVudHJ5TG9jYXRpb24oIkVuY29kaW5nIiwgW2NmZi5lbmNvZGluZy5mb3JtYXRdLCBvdXRwdXQpOwogICAgICB9IGVsc2UgewogICAgICAgIGNvbnN0IGVuY29kaW5nID0gdGhpcy5jb21waWxlRW5jb2RpbmcoY2ZmLmVuY29kaW5nKTsKICAgICAgICB0b3BEaWN0VHJhY2tlci5zZXRFbnRyeUxvY2F0aW9uKCJFbmNvZGluZyIsIFtvdXRwdXQubGVuZ3RoXSwgb3V0cHV0KTsKICAgICAgICBvdXRwdXQuYWRkKGVuY29kaW5nKTsKICAgICAgfQogICAgfQogICAgY29uc3QgY2hhcnNldCA9IHRoaXMuY29tcGlsZUNoYXJzZXQoY2ZmLmNoYXJzZXQsIGNmZi5jaGFyU3RyaW5ncy5jb3VudCwgY2ZmLnN0cmluZ3MsIGNmZi5pc0NJREZvbnQpOwogICAgdG9wRGljdFRyYWNrZXIuc2V0RW50cnlMb2NhdGlvbigiY2hhcnNldCIsIFtvdXRwdXQubGVuZ3RoXSwgb3V0cHV0KTsKICAgIG91dHB1dC5hZGQoY2hhcnNldCk7CiAgICBjb25zdCBjaGFyU3RyaW5ncyA9IHRoaXMuY29tcGlsZUNoYXJTdHJpbmdzKGNmZi5jaGFyU3RyaW5ncyk7CiAgICB0b3BEaWN0VHJhY2tlci5zZXRFbnRyeUxvY2F0aW9uKCJDaGFyU3RyaW5ncyIsIFtvdXRwdXQubGVuZ3RoXSwgb3V0cHV0KTsKICAgIG91dHB1dC5hZGQoY2hhclN0cmluZ3MpOwogICAgaWYgKGNmZi5pc0NJREZvbnQpIHsKICAgICAgdG9wRGljdFRyYWNrZXIuc2V0RW50cnlMb2NhdGlvbigiRkRTZWxlY3QiLCBbb3V0cHV0Lmxlbmd0aF0sIG91dHB1dCk7CiAgICAgIGNvbnN0IGZkU2VsZWN0ID0gdGhpcy5jb21waWxlRkRTZWxlY3QoY2ZmLmZkU2VsZWN0KTsKICAgICAgb3V0cHV0LmFkZChmZFNlbGVjdCk7CiAgICAgIGNvbXBpbGVkID0gdGhpcy5jb21waWxlVG9wRGljdHMoY2ZmLmZkQXJyYXksIG91dHB1dC5sZW5ndGgsIHRydWUpOwogICAgICB0b3BEaWN0VHJhY2tlci5zZXRFbnRyeUxvY2F0aW9uKCJGREFycmF5IiwgW291dHB1dC5sZW5ndGhdLCBvdXRwdXQpOwogICAgICBvdXRwdXQuYWRkKGNvbXBpbGVkLm91dHB1dCk7CiAgICAgIGNvbnN0IGZvbnREaWN0VHJhY2tlcnMgPSBjb21waWxlZC50cmFja2VyczsKICAgICAgdGhpcy5jb21waWxlUHJpdmF0ZURpY3RzKGNmZi5mZEFycmF5LCBmb250RGljdFRyYWNrZXJzLCBvdXRwdXQpOwogICAgfQogICAgdGhpcy5jb21waWxlUHJpdmF0ZURpY3RzKFtjZmYudG9wRGljdF0sIFt0b3BEaWN0VHJhY2tlcl0sIG91dHB1dCk7CiAgICBvdXRwdXQuYWRkKFswXSk7CiAgICByZXR1cm4gb3V0cHV0LmRhdGE7CiAgfQogIGVuY29kZU51bWJlcih2YWx1ZSkgewogICAgaWYgKE51bWJlci5pc0ludGVnZXIodmFsdWUpKSB7CiAgICAgIHJldHVybiB0aGlzLmVuY29kZUludGVnZXIodmFsdWUpOwogICAgfQogICAgcmV0dXJuIHRoaXMuZW5jb2RlRmxvYXQodmFsdWUpOwogIH0KICBzdGF0aWMgZ2V0IEVuY29kZUZsb2F0UmVnRXhwKCkgewogICAgcmV0dXJuICgwLCBfdXRpbC5zaGFkb3cpKHRoaXMsICJFbmNvZGVGbG9hdFJlZ0V4cCIsIC9cLihcZCo/KSg/Ojl7NSwyMH18MHs1LDIwfSlcZHswLDJ9KD86ZSguKyl8JCkvKTsKICB9CiAgZW5jb2RlRmxvYXQobnVtKSB7CiAgICBsZXQgdmFsdWUgPSBudW0udG9TdHJpbmcoKTsKICAgIGNvbnN0IG0gPSBDRkZDb21waWxlci5FbmNvZGVGbG9hdFJlZ0V4cC5leGVjKHZhbHVlKTsKICAgIGlmIChtKSB7CiAgICAgIGNvbnN0IGVwc2lsb24gPSBwYXJzZUZsb2F0KCIxZSIgKyAoKG1bMl0gPyArbVsyXSA6IDApICsgbVsxXS5sZW5ndGgpKTsKICAgICAgdmFsdWUgPSAoTWF0aC5yb3VuZChudW0gKiBlcHNpbG9uKSAvIGVwc2lsb24pLnRvU3RyaW5nKCk7CiAgICB9CiAgICBsZXQgbmliYmxlcyA9ICIiOwogICAgbGV0IGksIGlpOwogICAgZm9yIChpID0gMCwgaWkgPSB2YWx1ZS5sZW5ndGg7IGkgPCBpaTsgKytpKSB7CiAgICAgIGNvbnN0IGEgPSB2YWx1ZVtpXTsKICAgICAgaWYgKGEgPT09ICJlIikgewogICAgICAgIG5pYmJsZXMgKz0gdmFsdWVbKytpXSA9PT0gIi0iID8gImMiIDogImIiOwogICAgICB9IGVsc2UgaWYgKGEgPT09ICIuIikgewogICAgICAgIG5pYmJsZXMgKz0gImEiOwogICAgICB9IGVsc2UgaWYgKGEgPT09ICItIikgewogICAgICAgIG5pYmJsZXMgKz0gImUiOwogICAgICB9IGVsc2UgewogICAgICAgIG5pYmJsZXMgKz0gYTsKICAgICAgfQogICAgfQogICAgbmliYmxlcyArPSBuaWJibGVzLmxlbmd0aCAmIDEgPyAiZiIgOiAiZmYiOwogICAgY29uc3Qgb3V0ID0gWzMwXTsKICAgIGZvciAoaSA9IDAsIGlpID0gbmliYmxlcy5sZW5ndGg7IGkgPCBpaTsgaSArPSAyKSB7CiAgICAgIG91dC5wdXNoKHBhcnNlSW50KG5pYmJsZXMuc3Vic3RyaW5nKGksIGkgKyAyKSwgMTYpKTsKICAgIH0KICAgIHJldHVybiBvdXQ7CiAgfQogIGVuY29kZUludGVnZXIodmFsdWUpIHsKICAgIGxldCBjb2RlOwogICAgaWYgKHZhbHVlID49IC0xMDcgJiYgdmFsdWUgPD0gMTA3KSB7CiAgICAgIGNvZGUgPSBbdmFsdWUgKyAxMzldOwogICAgfSBlbHNlIGlmICh2YWx1ZSA+PSAxMDggJiYgdmFsdWUgPD0gMTEzMSkgewogICAgICB2YWx1ZSAtPSAxMDg7CiAgICAgIGNvZGUgPSBbKHZhbHVlID4+IDgpICsgMjQ3LCB2YWx1ZSAmIDB4ZmZdOwogICAgfSBlbHNlIGlmICh2YWx1ZSA+PSAtMTEzMSAmJiB2YWx1ZSA8PSAtMTA4KSB7CiAgICAgIHZhbHVlID0gLXZhbHVlIC0gMTA4OwogICAgICBjb2RlID0gWyh2YWx1ZSA+PiA4KSArIDI1MSwgdmFsdWUgJiAweGZmXTsKICAgIH0gZWxzZSBpZiAodmFsdWUgPj0gLTMyNzY4ICYmIHZhbHVlIDw9IDMyNzY3KSB7CiAgICAgIGNvZGUgPSBbMHgxYywgdmFsdWUgPj4gOCAmIDB4ZmYsIHZhbHVlICYgMHhmZl07CiAgICB9IGVsc2UgewogICAgICBjb2RlID0gWzB4MWQsIHZhbHVlID4+IDI0ICYgMHhmZiwgdmFsdWUgPj4gMTYgJiAweGZmLCB2YWx1ZSA+PiA4ICYgMHhmZiwgdmFsdWUgJiAweGZmXTsKICAgIH0KICAgIHJldHVybiBjb2RlOwogIH0KICBjb21waWxlSGVhZGVyKGhlYWRlcikgewogICAgcmV0dXJuIFtoZWFkZXIubWFqb3IsIGhlYWRlci5taW5vciwgNCwgaGVhZGVyLm9mZlNpemVdOwogIH0KICBjb21waWxlTmFtZUluZGV4KG5hbWVzKSB7CiAgICBjb25zdCBuYW1lSW5kZXggPSBuZXcgQ0ZGSW5kZXgoKTsKICAgIGZvciAoY29uc3QgbmFtZSBvZiBuYW1lcykgewogICAgICBjb25zdCBsZW5ndGggPSBNYXRoLm1pbihuYW1lLmxlbmd0aCwgMTI3KTsKICAgICAgbGV0IHNhbml0aXplZE5hbWUgPSBuZXcgQXJyYXkobGVuZ3RoKTsKICAgICAgZm9yIChsZXQgaiA9IDA7IGogPCBsZW5ndGg7IGorKykgewogICAgICAgIGxldCBjaGFyID0gbmFtZVtqXTsKICAgICAgICBpZiAoY2hhciA8ICIhIiB8fCBjaGFyID4gIn4iIHx8IGNoYXIgPT09ICJbIiB8fCBjaGFyID09PSAiXSIgfHwgY2hhciA9PT0gIigiIHx8IGNoYXIgPT09ICIpIiB8fCBjaGFyID09PSAieyIgfHwgY2hhciA9PT0gIn0iIHx8IGNoYXIgPT09ICI8IiB8fCBjaGFyID09PSAiPiIgfHwgY2hhciA9PT0gIi8iIHx8IGNoYXIgPT09ICIlIikgewogICAgICAgICAgY2hhciA9ICJfIjsKICAgICAgICB9CiAgICAgICAgc2FuaXRpemVkTmFtZVtqXSA9IGNoYXI7CiAgICAgIH0KICAgICAgc2FuaXRpemVkTmFtZSA9IHNhbml0aXplZE5hbWUuam9pbigiIik7CiAgICAgIGlmIChzYW5pdGl6ZWROYW1lID09PSAiIikgewogICAgICAgIHNhbml0aXplZE5hbWUgPSAiQmFkX0ZvbnRfTmFtZSI7CiAgICAgIH0KICAgICAgbmFtZUluZGV4LmFkZCgoMCwgX3V0aWwuc3RyaW5nVG9CeXRlcykoc2FuaXRpemVkTmFtZSkpOwogICAgfQogICAgcmV0dXJuIHRoaXMuY29tcGlsZUluZGV4KG5hbWVJbmRleCk7CiAgfQogIGNvbXBpbGVUb3BEaWN0cyhkaWN0cywgbGVuZ3RoLCByZW1vdmVDaWRLZXlzKSB7CiAgICBjb25zdCBmb250RGljdFRyYWNrZXJzID0gW107CiAgICBsZXQgZmRBcnJheUluZGV4ID0gbmV3IENGRkluZGV4KCk7CiAgICBmb3IgKGNvbnN0IGZvbnREaWN0IG9mIGRpY3RzKSB7CiAgICAgIGlmIChyZW1vdmVDaWRLZXlzKSB7CiAgICAgICAgZm9udERpY3QucmVtb3ZlQnlOYW1lKCJDSURGb250VmVyc2lvbiIpOwogICAgICAgIGZvbnREaWN0LnJlbW92ZUJ5TmFtZSgiQ0lERm9udFJldmlzaW9uIik7CiAgICAgICAgZm9udERpY3QucmVtb3ZlQnlOYW1lKCJDSURGb250VHlwZSIpOwogICAgICAgIGZvbnREaWN0LnJlbW92ZUJ5TmFtZSgiQ0lEQ291bnQiKTsKICAgICAgICBmb250RGljdC5yZW1vdmVCeU5hbWUoIlVJREJhc2UiKTsKICAgICAgfQogICAgICBjb25zdCBmb250RGljdFRyYWNrZXIgPSBuZXcgQ0ZGT2Zmc2V0VHJhY2tlcigpOwogICAgICBjb25zdCBmb250RGljdERhdGEgPSB0aGlzLmNvbXBpbGVEaWN0KGZvbnREaWN0LCBmb250RGljdFRyYWNrZXIpOwogICAgICBmb250RGljdFRyYWNrZXJzLnB1c2goZm9udERpY3RUcmFja2VyKTsKICAgICAgZmRBcnJheUluZGV4LmFkZChmb250RGljdERhdGEpOwogICAgICBmb250RGljdFRyYWNrZXIub2Zmc2V0KGxlbmd0aCk7CiAgICB9CiAgICBmZEFycmF5SW5kZXggPSB0aGlzLmNvbXBpbGVJbmRleChmZEFycmF5SW5kZXgsIGZvbnREaWN0VHJhY2tlcnMpOwogICAgcmV0dXJuIHsKICAgICAgdHJhY2tlcnM6IGZvbnREaWN0VHJhY2tlcnMsCiAgICAgIG91dHB1dDogZmRBcnJheUluZGV4CiAgICB9OwogIH0KICBjb21waWxlUHJpdmF0ZURpY3RzKGRpY3RzLCB0cmFja2Vycywgb3V0cHV0KSB7CiAgICBmb3IgKGxldCBpID0gMCwgaWkgPSBkaWN0cy5sZW5ndGg7IGkgPCBpaTsgKytpKSB7CiAgICAgIGNvbnN0IGZvbnREaWN0ID0gZGljdHNbaV07CiAgICAgIGNvbnN0IHByaXZhdGVEaWN0ID0gZm9udERpY3QucHJpdmF0ZURpY3Q7CiAgICAgIGlmICghcHJpdmF0ZURpY3QgfHwgIWZvbnREaWN0Lmhhc05hbWUoIlByaXZhdGUiKSkgewogICAgICAgIHRocm93IG5ldyBfdXRpbC5Gb3JtYXRFcnJvcigiVGhlcmUgbXVzdCBiZSBhIHByaXZhdGUgZGljdGlvbmFyeS4iKTsKICAgICAgfQogICAgICBjb25zdCBwcml2YXRlRGljdFRyYWNrZXIgPSBuZXcgQ0ZGT2Zmc2V0VHJhY2tlcigpOwogICAgICBjb25zdCBwcml2YXRlRGljdERhdGEgPSB0aGlzLmNvbXBpbGVEaWN0KHByaXZhdGVEaWN0LCBwcml2YXRlRGljdFRyYWNrZXIpOwogICAgICBsZXQgb3V0cHV0TGVuZ3RoID0gb3V0cHV0Lmxlbmd0aDsKICAgICAgcHJpdmF0ZURpY3RUcmFja2VyLm9mZnNldChvdXRwdXRMZW5ndGgpOwogICAgICBpZiAoIXByaXZhdGVEaWN0RGF0YS5sZW5ndGgpIHsKICAgICAgICBvdXRwdXRMZW5ndGggPSAwOwogICAgICB9CiAgICAgIHRyYWNrZXJzW2ldLnNldEVudHJ5TG9jYXRpb24oIlByaXZhdGUiLCBbcHJpdmF0ZURpY3REYXRhLmxlbmd0aCwgb3V0cHV0TGVuZ3RoXSwgb3V0cHV0KTsKICAgICAgb3V0cHV0LmFkZChwcml2YXRlRGljdERhdGEpOwogICAgICBpZiAocHJpdmF0ZURpY3Quc3VicnNJbmRleCAmJiBwcml2YXRlRGljdC5oYXNOYW1lKCJTdWJycyIpKSB7CiAgICAgICAgY29uc3Qgc3VicnMgPSB0aGlzLmNvbXBpbGVJbmRleChwcml2YXRlRGljdC5zdWJyc0luZGV4KTsKICAgICAgICBwcml2YXRlRGljdFRyYWNrZXIuc2V0RW50cnlMb2NhdGlvbigiU3VicnMiLCBbcHJpdmF0ZURpY3REYXRhLmxlbmd0aF0sIG91dHB1dCk7CiAgICAgICAgb3V0cHV0LmFkZChzdWJycyk7CiAgICAgIH0KICAgIH0KICB9CiAgY29tcGlsZURpY3QoZGljdCwgb2Zmc2V0VHJhY2tlcikgewogICAgY29uc3Qgb3V0ID0gW107CiAgICBmb3IgKGNvbnN0IGtleSBvZiBkaWN0Lm9yZGVyKSB7CiAgICAgIGlmICghKGtleSBpbiBkaWN0LnZhbHVlcykpIHsKICAgICAgICBjb250aW51ZTsKICAgICAgfQogICAgICBsZXQgdmFsdWVzID0gZGljdC52YWx1ZXNba2V5XTsKICAgICAgbGV0IHR5cGVzID0gZGljdC50eXBlc1trZXldOwogICAgICBpZiAoIUFycmF5LmlzQXJyYXkodHlwZXMpKSB7CiAgICAgICAgdHlwZXMgPSBbdHlwZXNdOwogICAgICB9CiAgICAgIGlmICghQXJyYXkuaXNBcnJheSh2YWx1ZXMpKSB7CiAgICAgICAgdmFsdWVzID0gW3ZhbHVlc107CiAgICAgIH0KICAgICAgaWYgKHZhbHVlcy5sZW5ndGggPT09IDApIHsKICAgICAgICBjb250aW51ZTsKICAgICAgfQogICAgICBmb3IgKGxldCBqID0gMCwgamogPSB0eXBlcy5sZW5ndGg7IGogPCBqajsgKytqKSB7CiAgICAgICAgY29uc3QgdHlwZSA9IHR5cGVzW2pdOwogICAgICAgIGNvbnN0IHZhbHVlID0gdmFsdWVzW2pdOwogICAgICAgIHN3aXRjaCAodHlwZSkgewogICAgICAgICAgY2FzZSAibnVtIjoKICAgICAgICAgIGNhc2UgInNpZCI6CiAgICAgICAgICAgIG91dC5wdXNoKC4uLnRoaXMuZW5jb2RlTnVtYmVyKHZhbHVlKSk7CiAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgY2FzZSAib2Zmc2V0IjoKICAgICAgICAgICAgY29uc3QgbmFtZSA9IGRpY3Qua2V5VG9OYW1lTWFwW2tleV07CiAgICAgICAgICAgIGlmICghb2Zmc2V0VHJhY2tlci5pc1RyYWNraW5nKG5hbWUpKSB7CiAgICAgICAgICAgICAgb2Zmc2V0VHJhY2tlci50cmFjayhuYW1lLCBvdXQubGVuZ3RoKTsKICAgICAgICAgICAgfQogICAgICAgICAgICBvdXQucHVzaCgweDFkLCAwLCAwLCAwLCAwKTsKICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICBjYXNlICJhcnJheSI6CiAgICAgICAgICBjYXNlICJkZWx0YSI6CiAgICAgICAgICAgIG91dC5wdXNoKC4uLnRoaXMuZW5jb2RlTnVtYmVyKHZhbHVlKSk7CiAgICAgICAgICAgIGZvciAobGV0IGsgPSAxLCBrayA9IHZhbHVlcy5sZW5ndGg7IGsgPCBrazsgKytrKSB7CiAgICAgICAgICAgICAgb3V0LnB1c2goLi4udGhpcy5lbmNvZGVOdW1iZXIodmFsdWVzW2tdKSk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICBkZWZhdWx0OgogICAgICAgICAgICB0aHJvdyBuZXcgX3V0aWwuRm9ybWF0RXJyb3IoYFVua25vd24gZGF0YSB0eXBlIG9mICR7dHlwZX1gKTsKICAgICAgICB9CiAgICAgIH0KICAgICAgb3V0LnB1c2goLi4uZGljdC5vcGNvZGVzW2tleV0pOwogICAgfQogICAgcmV0dXJuIG91dDsKICB9CiAgY29tcGlsZVN0cmluZ0luZGV4KHN0cmluZ3MpIHsKICAgIGNvbnN0IHN0cmluZ0luZGV4ID0gbmV3IENGRkluZGV4KCk7CiAgICBmb3IgKGNvbnN0IHN0cmluZyBvZiBzdHJpbmdzKSB7CiAgICAgIHN0cmluZ0luZGV4LmFkZCgoMCwgX3V0aWwuc3RyaW5nVG9CeXRlcykoc3RyaW5nKSk7CiAgICB9CiAgICByZXR1cm4gdGhpcy5jb21waWxlSW5kZXgoc3RyaW5nSW5kZXgpOwogIH0KICBjb21waWxlQ2hhclN0cmluZ3MoY2hhclN0cmluZ3MpIHsKICAgIGNvbnN0IGNoYXJTdHJpbmdzSW5kZXggPSBuZXcgQ0ZGSW5kZXgoKTsKICAgIGZvciAobGV0IGkgPSAwOyBpIDwgY2hhclN0cmluZ3MuY291bnQ7IGkrKykgewogICAgICBjb25zdCBnbHlwaCA9IGNoYXJTdHJpbmdzLmdldChpKTsKICAgICAgaWYgKGdseXBoLmxlbmd0aCA9PT0gMCkgewogICAgICAgIGNoYXJTdHJpbmdzSW5kZXguYWRkKG5ldyBVaW50OEFycmF5KFsweDhiLCAweDBlXSkpOwogICAgICAgIGNvbnRpbnVlOwogICAgICB9CiAgICAgIGNoYXJTdHJpbmdzSW5kZXguYWRkKGdseXBoKTsKICAgIH0KICAgIHJldHVybiB0aGlzLmNvbXBpbGVJbmRleChjaGFyU3RyaW5nc0luZGV4KTsKICB9CiAgY29tcGlsZUNoYXJzZXQoY2hhcnNldCwgbnVtR2x5cGhzLCBzdHJpbmdzLCBpc0NJREZvbnQpIHsKICAgIGxldCBvdXQ7CiAgICBjb25zdCBudW1HbHlwaHNMZXNzTm90RGVmID0gbnVtR2x5cGhzIC0gMTsKICAgIGlmIChpc0NJREZvbnQpIHsKICAgICAgb3V0ID0gbmV3IFVpbnQ4QXJyYXkoWzIsIDAsIDAsIG51bUdseXBoc0xlc3NOb3REZWYgPj4gOCAmIDB4ZmYsIG51bUdseXBoc0xlc3NOb3REZWYgJiAweGZmXSk7CiAgICB9IGVsc2UgewogICAgICBjb25zdCBsZW5ndGggPSAxICsgbnVtR2x5cGhzTGVzc05vdERlZiAqIDI7CiAgICAgIG91dCA9IG5ldyBVaW50OEFycmF5KGxlbmd0aCk7CiAgICAgIG91dFswXSA9IDA7CiAgICAgIGxldCBjaGFyc2V0SW5kZXggPSAwOwogICAgICBjb25zdCBudW1DaGFyc2V0cyA9IGNoYXJzZXQuY2hhcnNldC5sZW5ndGg7CiAgICAgIGxldCB3YXJuZWQgPSBmYWxzZTsKICAgICAgZm9yIChsZXQgaSA9IDE7IGkgPCBvdXQubGVuZ3RoOyBpICs9IDIpIHsKICAgICAgICBsZXQgc2lkID0gMDsKICAgICAgICBpZiAoY2hhcnNldEluZGV4IDwgbnVtQ2hhcnNldHMpIHsKICAgICAgICAgIGNvbnN0IG5hbWUgPSBjaGFyc2V0LmNoYXJzZXRbY2hhcnNldEluZGV4KytdOwogICAgICAgICAgc2lkID0gc3RyaW5ncy5nZXRTSUQobmFtZSk7CiAgICAgICAgICBpZiAoc2lkID09PSAtMSkgewogICAgICAgICAgICBzaWQgPSAwOwogICAgICAgICAgICBpZiAoIXdhcm5lZCkgewogICAgICAgICAgICAgIHdhcm5lZCA9IHRydWU7CiAgICAgICAgICAgICAgKDAsIF91dGlsLndhcm4pKGBDb3VsZG4ndCBmaW5kICR7bmFtZX0gaW4gQ0ZGIHN0cmluZ3NgKTsKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgIH0KICAgICAgICBvdXRbaV0gPSBzaWQgPj4gOCAmIDB4ZmY7CiAgICAgICAgb3V0W2kgKyAxXSA9IHNpZCAmIDB4ZmY7CiAgICAgIH0KICAgIH0KICAgIHJldHVybiB0aGlzLmNvbXBpbGVUeXBlZEFycmF5KG91dCk7CiAgfQogIGNvbXBpbGVFbmNvZGluZyhlbmNvZGluZykgewogICAgcmV0dXJuIHRoaXMuY29tcGlsZVR5cGVkQXJyYXkoZW5jb2RpbmcucmF3KTsKICB9CiAgY29tcGlsZUZEU2VsZWN0KGZkU2VsZWN0KSB7CiAgICBjb25zdCBmb3JtYXQgPSBmZFNlbGVjdC5mb3JtYXQ7CiAgICBsZXQgb3V0LCBpOwogICAgc3dpdGNoIChmb3JtYXQpIHsKICAgICAgY2FzZSAwOgogICAgICAgIG91dCA9IG5ldyBVaW50OEFycmF5KDEgKyBmZFNlbGVjdC5mZFNlbGVjdC5sZW5ndGgpOwogICAgICAgIG91dFswXSA9IGZvcm1hdDsKICAgICAgICBmb3IgKGkgPSAwOyBpIDwgZmRTZWxlY3QuZmRTZWxlY3QubGVuZ3RoOyBpKyspIHsKICAgICAgICAgIG91dFtpICsgMV0gPSBmZFNlbGVjdC5mZFNlbGVjdFtpXTsKICAgICAgICB9CiAgICAgICAgYnJlYWs7CiAgICAgIGNhc2UgMzoKICAgICAgICBjb25zdCBzdGFydCA9IDA7CiAgICAgICAgbGV0IGxhc3RGRCA9IGZkU2VsZWN0LmZkU2VsZWN0WzBdOwogICAgICAgIGNvbnN0IHJhbmdlcyA9IFtmb3JtYXQsIDAsIDAsIHN0YXJ0ID4+IDggJiAweGZmLCBzdGFydCAmIDB4ZmYsIGxhc3RGRF07CiAgICAgICAgZm9yIChpID0gMTsgaSA8IGZkU2VsZWN0LmZkU2VsZWN0Lmxlbmd0aDsgaSsrKSB7CiAgICAgICAgICBjb25zdCBjdXJyZW50RkQgPSBmZFNlbGVjdC5mZFNlbGVjdFtpXTsKICAgICAgICAgIGlmIChjdXJyZW50RkQgIT09IGxhc3RGRCkgewogICAgICAgICAgICByYW5nZXMucHVzaChpID4+IDggJiAweGZmLCBpICYgMHhmZiwgY3VycmVudEZEKTsKICAgICAgICAgICAgbGFzdEZEID0gY3VycmVudEZEOwogICAgICAgICAgfQogICAgICAgIH0KICAgICAgICBjb25zdCBudW1SYW5nZXMgPSAocmFuZ2VzLmxlbmd0aCAtIDMpIC8gMzsKICAgICAgICByYW5nZXNbMV0gPSBudW1SYW5nZXMgPj4gOCAmIDB4ZmY7CiAgICAgICAgcmFuZ2VzWzJdID0gbnVtUmFuZ2VzICYgMHhmZjsKICAgICAgICByYW5nZXMucHVzaChpID4+IDggJiAweGZmLCBpICYgMHhmZik7CiAgICAgICAgb3V0ID0gbmV3IFVpbnQ4QXJyYXkocmFuZ2VzKTsKICAgICAgICBicmVhazsKICAgIH0KICAgIHJldHVybiB0aGlzLmNvbXBpbGVUeXBlZEFycmF5KG91dCk7CiAgfQogIGNvbXBpbGVUeXBlZEFycmF5KGRhdGEpIHsKICAgIHJldHVybiBBcnJheS5mcm9tKGRhdGEpOwogIH0KICBjb21waWxlSW5kZXgoaW5kZXgsIHRyYWNrZXJzID0gW10pIHsKICAgIGNvbnN0IG9iamVjdHMgPSBpbmRleC5vYmplY3RzOwogICAgY29uc3QgY291bnQgPSBvYmplY3RzLmxlbmd0aDsKICAgIGlmIChjb3VudCA9PT0gMCkgewogICAgICByZXR1cm4gWzAsIDBdOwogICAgfQogICAgY29uc3QgZGF0YSA9IFtjb3VudCA+PiA4ICYgMHhmZiwgY291bnQgJiAweGZmXTsKICAgIGxldCBsYXN0T2Zmc2V0ID0gMSwKICAgICAgaTsKICAgIGZvciAoaSA9IDA7IGkgPCBjb3VudDsgKytpKSB7CiAgICAgIGxhc3RPZmZzZXQgKz0gb2JqZWN0c1tpXS5sZW5ndGg7CiAgICB9CiAgICBsZXQgb2Zmc2V0U2l6ZTsKICAgIGlmIChsYXN0T2Zmc2V0IDwgMHgxMDApIHsKICAgICAgb2Zmc2V0U2l6ZSA9IDE7CiAgICB9IGVsc2UgaWYgKGxhc3RPZmZzZXQgPCAweDEwMDAwKSB7CiAgICAgIG9mZnNldFNpemUgPSAyOwogICAgfSBlbHNlIGlmIChsYXN0T2Zmc2V0IDwgMHgxMDAwMDAwKSB7CiAgICAgIG9mZnNldFNpemUgPSAzOwogICAgfSBlbHNlIHsKICAgICAgb2Zmc2V0U2l6ZSA9IDQ7CiAgICB9CiAgICBkYXRhLnB1c2gob2Zmc2V0U2l6ZSk7CiAgICBsZXQgcmVsYXRpdmVPZmZzZXQgPSAxOwogICAgZm9yIChpID0gMDsgaSA8IGNvdW50ICsgMTsgaSsrKSB7CiAgICAgIGlmIChvZmZzZXRTaXplID09PSAxKSB7CiAgICAgICAgZGF0YS5wdXNoKHJlbGF0aXZlT2Zmc2V0ICYgMHhmZik7CiAgICAgIH0gZWxzZSBpZiAob2Zmc2V0U2l6ZSA9PT0gMikgewogICAgICAgIGRhdGEucHVzaChyZWxhdGl2ZU9mZnNldCA+PiA4ICYgMHhmZiwgcmVsYXRpdmVPZmZzZXQgJiAweGZmKTsKICAgICAgfSBlbHNlIGlmIChvZmZzZXRTaXplID09PSAzKSB7CiAgICAgICAgZGF0YS5wdXNoKHJlbGF0aXZlT2Zmc2V0ID4+IDE2ICYgMHhmZiwgcmVsYXRpdmVPZmZzZXQgPj4gOCAmIDB4ZmYsIHJlbGF0aXZlT2Zmc2V0ICYgMHhmZik7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgZGF0YS5wdXNoKHJlbGF0aXZlT2Zmc2V0ID4+PiAyNCAmIDB4ZmYsIHJlbGF0aXZlT2Zmc2V0ID4+IDE2ICYgMHhmZiwgcmVsYXRpdmVPZmZzZXQgPj4gOCAmIDB4ZmYsIHJlbGF0aXZlT2Zmc2V0ICYgMHhmZik7CiAgICAgIH0KICAgICAgaWYgKG9iamVjdHNbaV0pIHsKICAgICAgICByZWxhdGl2ZU9mZnNldCArPSBvYmplY3RzW2ldLmxlbmd0aDsKICAgICAgfQogICAgfQogICAgZm9yIChpID0gMDsgaSA8IGNvdW50OyBpKyspIHsKICAgICAgaWYgKHRyYWNrZXJzW2ldKSB7CiAgICAgICAgdHJhY2tlcnNbaV0ub2Zmc2V0KGRhdGEubGVuZ3RoKTsKICAgICAgfQogICAgICBkYXRhLnB1c2goLi4ub2JqZWN0c1tpXSk7CiAgICB9CiAgICByZXR1cm4gZGF0YTsKICB9Cn0KZXhwb3J0cy5DRkZDb21waWxlciA9IENGRkNvbXBpbGVyOwoKLyoqKi8gfSksCi8qIDM2ICovCi8qKiovICgoX191bnVzZWRfd2VicGFja19tb2R1bGUsIGV4cG9ydHMpID0+IHsKCgoKT2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsICJfX2VzTW9kdWxlIiwgKHsKICB2YWx1ZTogdHJ1ZQp9KSk7CmV4cG9ydHMuSVNPQWRvYmVDaGFyc2V0ID0gZXhwb3J0cy5FeHBlcnRTdWJzZXRDaGFyc2V0ID0gZXhwb3J0cy5FeHBlcnRDaGFyc2V0ID0gdm9pZCAwOwpjb25zdCBJU09BZG9iZUNoYXJzZXQgPSBbIi5ub3RkZWYiLCAic3BhY2UiLCAiZXhjbGFtIiwgInF1b3RlZGJsIiwgIm51bWJlcnNpZ24iLCAiZG9sbGFyIiwgInBlcmNlbnQiLCAiYW1wZXJzYW5kIiwgInF1b3RlcmlnaHQiLCAicGFyZW5sZWZ0IiwgInBhcmVucmlnaHQiLCAiYXN0ZXJpc2siLCAicGx1cyIsICJjb21tYSIsICJoeXBoZW4iLCAicGVyaW9kIiwgInNsYXNoIiwgInplcm8iLCAib25lIiwgInR3byIsICJ0aHJlZSIsICJmb3VyIiwgImZpdmUiLCAic2l4IiwgInNldmVuIiwgImVpZ2h0IiwgIm5pbmUiLCAiY29sb24iLCAic2VtaWNvbG9uIiwgImxlc3MiLCAiZXF1YWwiLCAiZ3JlYXRlciIsICJxdWVzdGlvbiIsICJhdCIsICJBIiwgIkIiLCAiQyIsICJEIiwgIkUiLCAiRiIsICJHIiwgIkgiLCAiSSIsICJKIiwgIksiLCAiTCIsICJNIiwgIk4iLCAiTyIsICJQIiwgIlEiLCAiUiIsICJTIiwgIlQiLCAiVSIsICJWIiwgIlciLCAiWCIsICJZIiwgIloiLCAiYnJhY2tldGxlZnQiLCAiYmFja3NsYXNoIiwgImJyYWNrZXRyaWdodCIsICJhc2NpaWNpcmN1bSIsICJ1bmRlcnNjb3JlIiwgInF1b3RlbGVmdCIsICJhIiwgImIiLCAiYyIsICJkIiwgImUiLCAiZiIsICJnIiwgImgiLCAiaSIsICJqIiwgImsiLCAibCIsICJtIiwgIm4iLCAibyIsICJwIiwgInEiLCAiciIsICJzIiwgInQiLCAidSIsICJ2IiwgInciLCAieCIsICJ5IiwgInoiLCAiYnJhY2VsZWZ0IiwgImJhciIsICJicmFjZXJpZ2h0IiwgImFzY2lpdGlsZGUiLCAiZXhjbGFtZG93biIsICJjZW50IiwgInN0ZXJsaW5nIiwgImZyYWN0aW9uIiwgInllbiIsICJmbG9yaW4iLCAic2VjdGlvbiIsICJjdXJyZW5jeSIsICJxdW90ZXNpbmdsZSIsICJxdW90ZWRibGxlZnQiLCAiZ3VpbGxlbW90bGVmdCIsICJndWlsc2luZ2xsZWZ0IiwgImd1aWxzaW5nbHJpZ2h0IiwgImZpIiwgImZsIiwgImVuZGFzaCIsICJkYWdnZXIiLCAiZGFnZ2VyZGJsIiwgInBlcmlvZGNlbnRlcmVkIiwgInBhcmFncmFwaCIsICJidWxsZXQiLCAicXVvdGVzaW5nbGJhc2UiLCAicXVvdGVkYmxiYXNlIiwgInF1b3RlZGJscmlnaHQiLCAiZ3VpbGxlbW90cmlnaHQiLCAiZWxsaXBzaXMiLCAicGVydGhvdXNhbmQiLCAicXVlc3Rpb25kb3duIiwgImdyYXZlIiwgImFjdXRlIiwgImNpcmN1bWZsZXgiLCAidGlsZGUiLCAibWFjcm9uIiwgImJyZXZlIiwgImRvdGFjY2VudCIsICJkaWVyZXNpcyIsICJyaW5nIiwgImNlZGlsbGEiLCAiaHVuZ2FydW1sYXV0IiwgIm9nb25layIsICJjYXJvbiIsICJlbWRhc2giLCAiQUUiLCAib3JkZmVtaW5pbmUiLCAiTHNsYXNoIiwgIk9zbGFzaCIsICJPRSIsICJvcmRtYXNjdWxpbmUiLCAiYWUiLCAiZG90bGVzc2kiLCAibHNsYXNoIiwgIm9zbGFzaCIsICJvZSIsICJnZXJtYW5kYmxzIiwgIm9uZXN1cGVyaW9yIiwgImxvZ2ljYWxub3QiLCAibXUiLCAidHJhZGVtYXJrIiwgIkV0aCIsICJvbmVoYWxmIiwgInBsdXNtaW51cyIsICJUaG9ybiIsICJvbmVxdWFydGVyIiwgImRpdmlkZSIsICJicm9rZW5iYXIiLCAiZGVncmVlIiwgInRob3JuIiwgInRocmVlcXVhcnRlcnMiLCAidHdvc3VwZXJpb3IiLCAicmVnaXN0ZXJlZCIsICJtaW51cyIsICJldGgiLCAibXVsdGlwbHkiLCAidGhyZWVzdXBlcmlvciIsICJjb3B5cmlnaHQiLCAiQWFjdXRlIiwgIkFjaXJjdW1mbGV4IiwgIkFkaWVyZXNpcyIsICJBZ3JhdmUiLCAiQXJpbmciLCAiQXRpbGRlIiwgIkNjZWRpbGxhIiwgIkVhY3V0ZSIsICJFY2lyY3VtZmxleCIsICJFZGllcmVzaXMiLCAiRWdyYXZlIiwgIklhY3V0ZSIsICJJY2lyY3VtZmxleCIsICJJZGllcmVzaXMiLCAiSWdyYXZlIiwgIk50aWxkZSIsICJPYWN1dGUiLCAiT2NpcmN1bWZsZXgiLCAiT2RpZXJlc2lzIiwgIk9ncmF2ZSIsICJPdGlsZGUiLCAiU2Nhcm9uIiwgIlVhY3V0ZSIsICJVY2lyY3VtZmxleCIsICJVZGllcmVzaXMiLCAiVWdyYXZlIiwgIllhY3V0ZSIsICJZZGllcmVzaXMiLCAiWmNhcm9uIiwgImFhY3V0ZSIsICJhY2lyY3VtZmxleCIsICJhZGllcmVzaXMiLCAiYWdyYXZlIiwgImFyaW5nIiwgImF0aWxkZSIsICJjY2VkaWxsYSIsICJlYWN1dGUiLCAiZWNpcmN1bWZsZXgiLCAiZWRpZXJlc2lzIiwgImVncmF2ZSIsICJpYWN1dGUiLCAiaWNpcmN1bWZsZXgiLCAiaWRpZXJlc2lzIiwgImlncmF2ZSIsICJudGlsZGUiLCAib2FjdXRlIiwgIm9jaXJjdW1mbGV4IiwgIm9kaWVyZXNpcyIsICJvZ3JhdmUiLCAib3RpbGRlIiwgInNjYXJvbiIsICJ1YWN1dGUiLCAidWNpcmN1bWZsZXgiLCAidWRpZXJlc2lzIiwgInVncmF2ZSIsICJ5YWN1dGUiLCAieWRpZXJlc2lzIiwgInpjYXJvbiJdOwpleHBvcnRzLklTT0Fkb2JlQ2hhcnNldCA9IElTT0Fkb2JlQ2hhcnNldDsKY29uc3QgRXhwZXJ0Q2hhcnNldCA9IFsiLm5vdGRlZiIsICJzcGFjZSIsICJleGNsYW1zbWFsbCIsICJIdW5nYXJ1bWxhdXRzbWFsbCIsICJkb2xsYXJvbGRzdHlsZSIsICJkb2xsYXJzdXBlcmlvciIsICJhbXBlcnNhbmRzbWFsbCIsICJBY3V0ZXNtYWxsIiwgInBhcmVubGVmdHN1cGVyaW9yIiwgInBhcmVucmlnaHRzdXBlcmlvciIsICJ0d29kb3RlbmxlYWRlciIsICJvbmVkb3RlbmxlYWRlciIsICJjb21tYSIsICJoeXBoZW4iLCAicGVyaW9kIiwgImZyYWN0aW9uIiwgInplcm9vbGRzdHlsZSIsICJvbmVvbGRzdHlsZSIsICJ0d29vbGRzdHlsZSIsICJ0aHJlZW9sZHN0eWxlIiwgImZvdXJvbGRzdHlsZSIsICJmaXZlb2xkc3R5bGUiLCAic2l4b2xkc3R5bGUiLCAic2V2ZW5vbGRzdHlsZSIsICJlaWdodG9sZHN0eWxlIiwgIm5pbmVvbGRzdHlsZSIsICJjb2xvbiIsICJzZW1pY29sb24iLCAiY29tbWFzdXBlcmlvciIsICJ0aHJlZXF1YXJ0ZXJzZW1kYXNoIiwgInBlcmlvZHN1cGVyaW9yIiwgInF1ZXN0aW9uc21hbGwiLCAiYXN1cGVyaW9yIiwgImJzdXBlcmlvciIsICJjZW50c3VwZXJpb3IiLCAiZHN1cGVyaW9yIiwgImVzdXBlcmlvciIsICJpc3VwZXJpb3IiLCAibHN1cGVyaW9yIiwgIm1zdXBlcmlvciIsICJuc3VwZXJpb3IiLCAib3N1cGVyaW9yIiwgInJzdXBlcmlvciIsICJzc3VwZXJpb3IiLCAidHN1cGVyaW9yIiwgImZmIiwgImZpIiwgImZsIiwgImZmaSIsICJmZmwiLCAicGFyZW5sZWZ0aW5mZXJpb3IiLCAicGFyZW5yaWdodGluZmVyaW9yIiwgIkNpcmN1bWZsZXhzbWFsbCIsICJoeXBoZW5zdXBlcmlvciIsICJHcmF2ZXNtYWxsIiwgIkFzbWFsbCIsICJCc21hbGwiLCAiQ3NtYWxsIiwgIkRzbWFsbCIsICJFc21hbGwiLCAiRnNtYWxsIiwgIkdzbWFsbCIsICJIc21hbGwiLCAiSXNtYWxsIiwgIkpzbWFsbCIsICJLc21hbGwiLCAiTHNtYWxsIiwgIk1zbWFsbCIsICJOc21hbGwiLCAiT3NtYWxsIiwgIlBzbWFsbCIsICJRc21hbGwiLCAiUnNtYWxsIiwgIlNzbWFsbCIsICJUc21hbGwiLCAiVXNtYWxsIiwgIlZzbWFsbCIsICJXc21hbGwiLCAiWHNtYWxsIiwgIllzbWFsbCIsICJac21hbGwiLCAiY29sb25tb25ldGFyeSIsICJvbmVmaXR0ZWQiLCAicnVwaWFoIiwgIlRpbGRlc21hbGwiLCAiZXhjbGFtZG93bnNtYWxsIiwgImNlbnRvbGRzdHlsZSIsICJMc2xhc2hzbWFsbCIsICJTY2Fyb25zbWFsbCIsICJaY2Fyb25zbWFsbCIsICJEaWVyZXNpc3NtYWxsIiwgIkJyZXZlc21hbGwiLCAiQ2Fyb25zbWFsbCIsICJEb3RhY2NlbnRzbWFsbCIsICJNYWNyb25zbWFsbCIsICJmaWd1cmVkYXNoIiwgImh5cGhlbmluZmVyaW9yIiwgIk9nb25la3NtYWxsIiwgIlJpbmdzbWFsbCIsICJDZWRpbGxhc21hbGwiLCAib25lcXVhcnRlciIsICJvbmVoYWxmIiwgInRocmVlcXVhcnRlcnMiLCAicXVlc3Rpb25kb3duc21hbGwiLCAib25lZWlnaHRoIiwgInRocmVlZWlnaHRocyIsICJmaXZlZWlnaHRocyIsICJzZXZlbmVpZ2h0aHMiLCAib25ldGhpcmQiLCAidHdvdGhpcmRzIiwgInplcm9zdXBlcmlvciIsICJvbmVzdXBlcmlvciIsICJ0d29zdXBlcmlvciIsICJ0aHJlZXN1cGVyaW9yIiwgImZvdXJzdXBlcmlvciIsICJmaXZlc3VwZXJpb3IiLCAic2l4c3VwZXJpb3IiLCAic2V2ZW5zdXBlcmlvciIsICJlaWdodHN1cGVyaW9yIiwgIm5pbmVzdXBlcmlvciIsICJ6ZXJvaW5mZXJpb3IiLCAib25laW5mZXJpb3IiLCAidHdvaW5mZXJpb3IiLCAidGhyZWVpbmZlcmlvciIsICJmb3VyaW5mZXJpb3IiLCAiZml2ZWluZmVyaW9yIiwgInNpeGluZmVyaW9yIiwgInNldmVuaW5mZXJpb3IiLCAiZWlnaHRpbmZlcmlvciIsICJuaW5laW5mZXJpb3IiLCAiY2VudGluZmVyaW9yIiwgImRvbGxhcmluZmVyaW9yIiwgInBlcmlvZGluZmVyaW9yIiwgImNvbW1haW5mZXJpb3IiLCAiQWdyYXZlc21hbGwiLCAiQWFjdXRlc21hbGwiLCAiQWNpcmN1bWZsZXhzbWFsbCIsICJBdGlsZGVzbWFsbCIsICJBZGllcmVzaXNzbWFsbCIsICJBcmluZ3NtYWxsIiwgIkFFc21hbGwiLCAiQ2NlZGlsbGFzbWFsbCIsICJFZ3JhdmVzbWFsbCIsICJFYWN1dGVzbWFsbCIsICJFY2lyY3VtZmxleHNtYWxsIiwgIkVkaWVyZXNpc3NtYWxsIiwgIklncmF2ZXNtYWxsIiwgIklhY3V0ZXNtYWxsIiwgIkljaXJjdW1mbGV4c21hbGwiLCAiSWRpZXJlc2lzc21hbGwiLCAiRXRoc21hbGwiLCAiTnRpbGRlc21hbGwiLCAiT2dyYXZlc21hbGwiLCAiT2FjdXRlc21hbGwiLCAiT2NpcmN1bWZsZXhzbWFsbCIsICJPdGlsZGVzbWFsbCIsICJPZGllcmVzaXNzbWFsbCIsICJPRXNtYWxsIiwgIk9zbGFzaHNtYWxsIiwgIlVncmF2ZXNtYWxsIiwgIlVhY3V0ZXNtYWxsIiwgIlVjaXJjdW1mbGV4c21hbGwiLCAiVWRpZXJlc2lzc21hbGwiLCAiWWFjdXRlc21hbGwiLCAiVGhvcm5zbWFsbCIsICJZZGllcmVzaXNzbWFsbCJdOwpleHBvcnRzLkV4cGVydENoYXJzZXQgPSBFeHBlcnRDaGFyc2V0Owpjb25zdCBFeHBlcnRTdWJzZXRDaGFyc2V0ID0gWyIubm90ZGVmIiwgInNwYWNlIiwgImRvbGxhcm9sZHN0eWxlIiwgImRvbGxhcnN1cGVyaW9yIiwgInBhcmVubGVmdHN1cGVyaW9yIiwgInBhcmVucmlnaHRzdXBlcmlvciIsICJ0d29kb3RlbmxlYWRlciIsICJvbmVkb3RlbmxlYWRlciIsICJjb21tYSIsICJoeXBoZW4iLCAicGVyaW9kIiwgImZyYWN0aW9uIiwgInplcm9vbGRzdHlsZSIsICJvbmVvbGRzdHlsZSIsICJ0d29vbGRzdHlsZSIsICJ0aHJlZW9sZHN0eWxlIiwgImZvdXJvbGRzdHlsZSIsICJmaXZlb2xkc3R5bGUiLCAic2l4b2xkc3R5bGUiLCAic2V2ZW5vbGRzdHlsZSIsICJlaWdodG9sZHN0eWxlIiwgIm5pbmVvbGRzdHlsZSIsICJjb2xvbiIsICJzZW1pY29sb24iLCAiY29tbWFzdXBlcmlvciIsICJ0aHJlZXF1YXJ0ZXJzZW1kYXNoIiwgInBlcmlvZHN1cGVyaW9yIiwgImFzdXBlcmlvciIsICJic3VwZXJpb3IiLCAiY2VudHN1cGVyaW9yIiwgImRzdXBlcmlvciIsICJlc3VwZXJpb3IiLCAiaXN1cGVyaW9yIiwgImxzdXBlcmlvciIsICJtc3VwZXJpb3IiLCAibnN1cGVyaW9yIiwgIm9zdXBlcmlvciIsICJyc3VwZXJpb3IiLCAic3N1cGVyaW9yIiwgInRzdXBlcmlvciIsICJmZiIsICJmaSIsICJmbCIsICJmZmkiLCAiZmZsIiwgInBhcmVubGVmdGluZmVyaW9yIiwgInBhcmVucmlnaHRpbmZlcmlvciIsICJoeXBoZW5zdXBlcmlvciIsICJjb2xvbm1vbmV0YXJ5IiwgIm9uZWZpdHRlZCIsICJydXBpYWgiLCAiY2VudG9sZHN0eWxlIiwgImZpZ3VyZWRhc2giLCAiaHlwaGVuaW5mZXJpb3IiLCAib25lcXVhcnRlciIsICJvbmVoYWxmIiwgInRocmVlcXVhcnRlcnMiLCAib25lZWlnaHRoIiwgInRocmVlZWlnaHRocyIsICJmaXZlZWlnaHRocyIsICJzZXZlbmVpZ2h0aHMiLCAib25ldGhpcmQiLCAidHdvdGhpcmRzIiwgInplcm9zdXBlcmlvciIsICJvbmVzdXBlcmlvciIsICJ0d29zdXBlcmlvciIsICJ0aHJlZXN1cGVyaW9yIiwgImZvdXJzdXBlcmlvciIsICJmaXZlc3VwZXJpb3IiLCAic2l4c3VwZXJpb3IiLCAic2V2ZW5zdXBlcmlvciIsICJlaWdodHN1cGVyaW9yIiwgIm5pbmVzdXBlcmlvciIsICJ6ZXJvaW5mZXJpb3IiLCAib25laW5mZXJpb3IiLCAidHdvaW5mZXJpb3IiLCAidGhyZWVpbmZlcmlvciIsICJmb3VyaW5mZXJpb3IiLCAiZml2ZWluZmVyaW9yIiwgInNpeGluZmVyaW9yIiwgInNldmVuaW5mZXJpb3IiLCAiZWlnaHRpbmZlcmlvciIsICJuaW5laW5mZXJpb3IiLCAiY2VudGluZmVyaW9yIiwgImRvbGxhcmluZmVyaW9yIiwgInBlcmlvZGluZmVyaW9yIiwgImNvbW1haW5mZXJpb3IiXTsKZXhwb3J0cy5FeHBlcnRTdWJzZXRDaGFyc2V0ID0gRXhwZXJ0U3Vic2V0Q2hhcnNldDsKCi8qKiovIH0pLAovKiAzNyAqLwovKioqLyAoKF9fdW51c2VkX3dlYnBhY2tfbW9kdWxlLCBleHBvcnRzKSA9PiB7CgoKCk9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCAiX19lc01vZHVsZSIsICh7CiAgdmFsdWU6IHRydWUKfSkpOwpleHBvcnRzLlphcGZEaW5nYmF0c0VuY29kaW5nID0gZXhwb3J0cy5XaW5BbnNpRW5jb2RpbmcgPSBleHBvcnRzLlN5bWJvbFNldEVuY29kaW5nID0gZXhwb3J0cy5TdGFuZGFyZEVuY29kaW5nID0gZXhwb3J0cy5NYWNSb21hbkVuY29kaW5nID0gZXhwb3J0cy5FeHBlcnRFbmNvZGluZyA9IHZvaWQgMDsKZXhwb3J0cy5nZXRFbmNvZGluZyA9IGdldEVuY29kaW5nOwpjb25zdCBFeHBlcnRFbmNvZGluZyA9IFsiIiwgIiIsICIiLCAiIiwgIiIsICIiLCAiIiwgIiIsICIiLCAiIiwgIiIsICIiLCAiIiwgIiIsICIiLCAiIiwgIiIsICIiLCAiIiwgIiIsICIiLCAiIiwgIiIsICIiLCAiIiwgIiIsICIiLCAiIiwgIiIsICIiLCAiIiwgIiIsICJzcGFjZSIsICJleGNsYW1zbWFsbCIsICJIdW5nYXJ1bWxhdXRzbWFsbCIsICIiLCAiZG9sbGFyb2xkc3R5bGUiLCAiZG9sbGFyc3VwZXJpb3IiLCAiYW1wZXJzYW5kc21hbGwiLCAiQWN1dGVzbWFsbCIsICJwYXJlbmxlZnRzdXBlcmlvciIsICJwYXJlbnJpZ2h0c3VwZXJpb3IiLCAidHdvZG90ZW5sZWFkZXIiLCAib25lZG90ZW5sZWFkZXIiLCAiY29tbWEiLCAiaHlwaGVuIiwgInBlcmlvZCIsICJmcmFjdGlvbiIsICJ6ZXJvb2xkc3R5bGUiLCAib25lb2xkc3R5bGUiLCAidHdvb2xkc3R5bGUiLCAidGhyZWVvbGRzdHlsZSIsICJmb3Vyb2xkc3R5bGUiLCAiZml2ZW9sZHN0eWxlIiwgInNpeG9sZHN0eWxlIiwgInNldmVub2xkc3R5bGUiLCAiZWlnaHRvbGRzdHlsZSIsICJuaW5lb2xkc3R5bGUiLCAiY29sb24iLCAic2VtaWNvbG9uIiwgImNvbW1hc3VwZXJpb3IiLCAidGhyZWVxdWFydGVyc2VtZGFzaCIsICJwZXJpb2RzdXBlcmlvciIsICJxdWVzdGlvbnNtYWxsIiwgIiIsICJhc3VwZXJpb3IiLCAiYnN1cGVyaW9yIiwgImNlbnRzdXBlcmlvciIsICJkc3VwZXJpb3IiLCAiZXN1cGVyaW9yIiwgIiIsICIiLCAiIiwgImlzdXBlcmlvciIsICIiLCAiIiwgImxzdXBlcmlvciIsICJtc3VwZXJpb3IiLCAibnN1cGVyaW9yIiwgIm9zdXBlcmlvciIsICIiLCAiIiwgInJzdXBlcmlvciIsICJzc3VwZXJpb3IiLCAidHN1cGVyaW9yIiwgIiIsICJmZiIsICJmaSIsICJmbCIsICJmZmkiLCAiZmZsIiwgInBhcmVubGVmdGluZmVyaW9yIiwgIiIsICJwYXJlbnJpZ2h0aW5mZXJpb3IiLCAiQ2lyY3VtZmxleHNtYWxsIiwgImh5cGhlbnN1cGVyaW9yIiwgIkdyYXZlc21hbGwiLCAiQXNtYWxsIiwgIkJzbWFsbCIsICJDc21hbGwiLCAiRHNtYWxsIiwgIkVzbWFsbCIsICJGc21hbGwiLCAiR3NtYWxsIiwgIkhzbWFsbCIsICJJc21hbGwiLCAiSnNtYWxsIiwgIktzbWFsbCIsICJMc21hbGwiLCAiTXNtYWxsIiwgIk5zbWFsbCIsICJPc21hbGwiLCAiUHNtYWxsIiwgIlFzbWFsbCIsICJSc21hbGwiLCAiU3NtYWxsIiwgIlRzbWFsbCIsICJVc21hbGwiLCAiVnNtYWxsIiwgIldzbWFsbCIsICJYc21hbGwiLCAiWXNtYWxsIiwgIlpzbWFsbCIsICJjb2xvbm1vbmV0YXJ5IiwgIm9uZWZpdHRlZCIsICJydXBpYWgiLCAiVGlsZGVzbWFsbCIsICIiLCAiIiwgIiIsICIiLCAiIiwgIiIsICIiLCAiIiwgIiIsICIiLCAiIiwgIiIsICIiLCAiIiwgIiIsICIiLCAiIiwgIiIsICIiLCAiIiwgIiIsICIiLCAiIiwgIiIsICIiLCAiIiwgIiIsICIiLCAiIiwgIiIsICIiLCAiIiwgIiIsICIiLCAiZXhjbGFtZG93bnNtYWxsIiwgImNlbnRvbGRzdHlsZSIsICJMc2xhc2hzbWFsbCIsICIiLCAiIiwgIlNjYXJvbnNtYWxsIiwgIlpjYXJvbnNtYWxsIiwgIkRpZXJlc2lzc21hbGwiLCAiQnJldmVzbWFsbCIsICJDYXJvbnNtYWxsIiwgIiIsICJEb3RhY2NlbnRzbWFsbCIsICIiLCAiIiwgIk1hY3JvbnNtYWxsIiwgIiIsICIiLCAiZmlndXJlZGFzaCIsICJoeXBoZW5pbmZlcmlvciIsICIiLCAiIiwgIk9nb25la3NtYWxsIiwgIlJpbmdzbWFsbCIsICJDZWRpbGxhc21hbGwiLCAiIiwgIiIsICIiLCAib25lcXVhcnRlciIsICJvbmVoYWxmIiwgInRocmVlcXVhcnRlcnMiLCAicXVlc3Rpb25kb3duc21hbGwiLCAib25lZWlnaHRoIiwgInRocmVlZWlnaHRocyIsICJmaXZlZWlnaHRocyIsICJzZXZlbmVpZ2h0aHMiLCAib25ldGhpcmQiLCAidHdvdGhpcmRzIiwgIiIsICIiLCAiemVyb3N1cGVyaW9yIiwgIm9uZXN1cGVyaW9yIiwgInR3b3N1cGVyaW9yIiwgInRocmVlc3VwZXJpb3IiLCAiZm91cnN1cGVyaW9yIiwgImZpdmVzdXBlcmlvciIsICJzaXhzdXBlcmlvciIsICJzZXZlbnN1cGVyaW9yIiwgImVpZ2h0c3VwZXJpb3IiLCAibmluZXN1cGVyaW9yIiwgInplcm9pbmZlcmlvciIsICJvbmVpbmZlcmlvciIsICJ0d29pbmZlcmlvciIsICJ0aHJlZWluZmVyaW9yIiwgImZvdXJpbmZlcmlvciIsICJmaXZlaW5mZXJpb3IiLCAic2l4aW5mZXJpb3IiLCAic2V2ZW5pbmZlcmlvciIsICJlaWdodGluZmVyaW9yIiwgIm5pbmVpbmZlcmlvciIsICJjZW50aW5mZXJpb3IiLCAiZG9sbGFyaW5mZXJpb3IiLCAicGVyaW9kaW5mZXJpb3IiLCAiY29tbWFpbmZlcmlvciIsICJBZ3JhdmVzbWFsbCIsICJBYWN1dGVzbWFsbCIsICJBY2lyY3VtZmxleHNtYWxsIiwgIkF0aWxkZXNtYWxsIiwgIkFkaWVyZXNpc3NtYWxsIiwgIkFyaW5nc21hbGwiLCAiQUVzbWFsbCIsICJDY2VkaWxsYXNtYWxsIiwgIkVncmF2ZXNtYWxsIiwgIkVhY3V0ZXNtYWxsIiwgIkVjaXJjdW1mbGV4c21hbGwiLCAiRWRpZXJlc2lzc21hbGwiLCAiSWdyYXZlc21hbGwiLCAiSWFjdXRlc21hbGwiLCAiSWNpcmN1bWZsZXhzbWFsbCIsICJJZGllcmVzaXNzbWFsbCIsICJFdGhzbWFsbCIsICJOdGlsZGVzbWFsbCIsICJPZ3JhdmVzbWFsbCIsICJPYWN1dGVzbWFsbCIsICJPY2lyY3VtZmxleHNtYWxsIiwgIk90aWxkZXNtYWxsIiwgIk9kaWVyZXNpc3NtYWxsIiwgIk9Fc21hbGwiLCAiT3NsYXNoc21hbGwiLCAiVWdyYXZlc21hbGwiLCAiVWFjdXRlc21hbGwiLCAiVWNpcmN1bWZsZXhzbWFsbCIsICJVZGllcmVzaXNzbWFsbCIsICJZYWN1dGVzbWFsbCIsICJUaG9ybnNtYWxsIiwgIllkaWVyZXNpc3NtYWxsIl07CmV4cG9ydHMuRXhwZXJ0RW5jb2RpbmcgPSBFeHBlcnRFbmNvZGluZzsKY29uc3QgTWFjRXhwZXJ0RW5jb2RpbmcgPSBbIiIsICIiLCAiIiwgIiIsICIiLCAiIiwgIiIsICIiLCAiIiwgIiIsICIiLCAiIiwgIiIsICIiLCAiIiwgIiIsICIiLCAiIiwgIiIsICIiLCAiIiwgIiIsICIiLCAiIiwgIiIsICIiLCAiIiwgIiIsICIiLCAiIiwgIiIsICIiLCAic3BhY2UiLCAiZXhjbGFtc21hbGwiLCAiSHVuZ2FydW1sYXV0c21hbGwiLCAiY2VudG9sZHN0eWxlIiwgImRvbGxhcm9sZHN0eWxlIiwgImRvbGxhcnN1cGVyaW9yIiwgImFtcGVyc2FuZHNtYWxsIiwgIkFjdXRlc21hbGwiLCAicGFyZW5sZWZ0c3VwZXJpb3IiLCAicGFyZW5yaWdodHN1cGVyaW9yIiwgInR3b2RvdGVubGVhZGVyIiwgIm9uZWRvdGVubGVhZGVyIiwgImNvbW1hIiwgImh5cGhlbiIsICJwZXJpb2QiLCAiZnJhY3Rpb24iLCAiemVyb29sZHN0eWxlIiwgIm9uZW9sZHN0eWxlIiwgInR3b29sZHN0eWxlIiwgInRocmVlb2xkc3R5bGUiLCAiZm91cm9sZHN0eWxlIiwgImZpdmVvbGRzdHlsZSIsICJzaXhvbGRzdHlsZSIsICJzZXZlbm9sZHN0eWxlIiwgImVpZ2h0b2xkc3R5bGUiLCAibmluZW9sZHN0eWxlIiwgImNvbG9uIiwgInNlbWljb2xvbiIsICIiLCAidGhyZWVxdWFydGVyc2VtZGFzaCIsICIiLCAicXVlc3Rpb25zbWFsbCIsICIiLCAiIiwgIiIsICIiLCAiRXRoc21hbGwiLCAiIiwgIiIsICJvbmVxdWFydGVyIiwgIm9uZWhhbGYiLCAidGhyZWVxdWFydGVycyIsICJvbmVlaWdodGgiLCAidGhyZWVlaWdodGhzIiwgImZpdmVlaWdodGhzIiwgInNldmVuZWlnaHRocyIsICJvbmV0aGlyZCIsICJ0d290aGlyZHMiLCAiIiwgIiIsICIiLCAiIiwgIiIsICIiLCAiZmYiLCAiZmkiLCAiZmwiLCAiZmZpIiwgImZmbCIsICJwYXJlbmxlZnRpbmZlcmlvciIsICIiLCAicGFyZW5yaWdodGluZmVyaW9yIiwgIkNpcmN1bWZsZXhzbWFsbCIsICJoeXBoZW5pbmZlcmlvciIsICJHcmF2ZXNtYWxsIiwgIkFzbWFsbCIsICJCc21hbGwiLCAiQ3NtYWxsIiwgIkRzbWFsbCIsICJFc21hbGwiLCAiRnNtYWxsIiwgIkdzbWFsbCIsICJIc21hbGwiLCAiSXNtYWxsIiwgIkpzbWFsbCIsICJLc21hbGwiLCAiTHNtYWxsIiwgIk1zbWFsbCIsICJOc21hbGwiLCAiT3NtYWxsIiwgIlBzbWFsbCIsICJRc21hbGwiLCAiUnNtYWxsIiwgIlNzbWFsbCIsICJUc21hbGwiLCAiVXNtYWxsIiwgIlZzbWFsbCIsICJXc21hbGwiLCAiWHNtYWxsIiwgIllzbWFsbCIsICJac21hbGwiLCAiY29sb25tb25ldGFyeSIsICJvbmVmaXR0ZWQiLCAicnVwaWFoIiwgIlRpbGRlc21hbGwiLCAiIiwgIiIsICJhc3VwZXJpb3IiLCAiY2VudHN1cGVyaW9yIiwgIiIsICIiLCAiIiwgIiIsICJBYWN1dGVzbWFsbCIsICJBZ3JhdmVzbWFsbCIsICJBY2lyY3VtZmxleHNtYWxsIiwgIkFkaWVyZXNpc3NtYWxsIiwgIkF0aWxkZXNtYWxsIiwgIkFyaW5nc21hbGwiLCAiQ2NlZGlsbGFzbWFsbCIsICJFYWN1dGVzbWFsbCIsICJFZ3JhdmVzbWFsbCIsICJFY2lyY3VtZmxleHNtYWxsIiwgIkVkaWVyZXNpc3NtYWxsIiwgIklhY3V0ZXNtYWxsIiwgIklncmF2ZXNtYWxsIiwgIkljaXJjdW1mbGV4c21hbGwiLCAiSWRpZXJlc2lzc21hbGwiLCAiTnRpbGRlc21hbGwiLCAiT2FjdXRlc21hbGwiLCAiT2dyYXZlc21hbGwiLCAiT2NpcmN1bWZsZXhzbWFsbCIsICJPZGllcmVzaXNzbWFsbCIsICJPdGlsZGVzbWFsbCIsICJVYWN1dGVzbWFsbCIsICJVZ3JhdmVzbWFsbCIsICJVY2lyY3VtZmxleHNtYWxsIiwgIlVkaWVyZXNpc3NtYWxsIiwgIiIsICJlaWdodHN1cGVyaW9yIiwgImZvdXJpbmZlcmlvciIsICJ0aHJlZWluZmVyaW9yIiwgInNpeGluZmVyaW9yIiwgImVpZ2h0aW5mZXJpb3IiLCAic2V2ZW5pbmZlcmlvciIsICJTY2Fyb25zbWFsbCIsICIiLCAiY2VudGluZmVyaW9yIiwgInR3b2luZmVyaW9yIiwgIiIsICJEaWVyZXNpc3NtYWxsIiwgIiIsICJDYXJvbnNtYWxsIiwgIm9zdXBlcmlvciIsICJmaXZlaW5mZXJpb3IiLCAiIiwgImNvbW1haW5mZXJpb3IiLCAicGVyaW9kaW5mZXJpb3IiLCAiWWFjdXRlc21hbGwiLCAiIiwgImRvbGxhcmluZmVyaW9yIiwgIiIsICIiLCAiVGhvcm5zbWFsbCIsICIiLCAibmluZWluZmVyaW9yIiwgInplcm9pbmZlcmlvciIsICJaY2Fyb25zbWFsbCIsICJBRXNtYWxsIiwgIk9zbGFzaHNtYWxsIiwgInF1ZXN0aW9uZG93bnNtYWxsIiwgIm9uZWluZmVyaW9yIiwgIkxzbGFzaHNtYWxsIiwgIiIsICIiLCAiIiwgIiIsICIiLCAiIiwgIkNlZGlsbGFzbWFsbCIsICIiLCAiIiwgIiIsICIiLCAiIiwgIk9Fc21hbGwiLCAiZmlndXJlZGFzaCIsICJoeXBoZW5zdXBlcmlvciIsICIiLCAiIiwgIiIsICIiLCAiZXhjbGFtZG93bnNtYWxsIiwgIiIsICJZZGllcmVzaXNzbWFsbCIsICIiLCAib25lc3VwZXJpb3IiLCAidHdvc3VwZXJpb3IiLCAidGhyZWVzdXBlcmlvciIsICJmb3Vyc3VwZXJpb3IiLCAiZml2ZXN1cGVyaW9yIiwgInNpeHN1cGVyaW9yIiwgInNldmVuc3VwZXJpb3IiLCAibmluZXN1cGVyaW9yIiwgInplcm9zdXBlcmlvciIsICIiLCAiZXN1cGVyaW9yIiwgInJzdXBlcmlvciIsICJ0c3VwZXJpb3IiLCAiIiwgIiIsICJpc3VwZXJpb3IiLCAic3N1cGVyaW9yIiwgImRzdXBlcmlvciIsICIiLCAiIiwgIiIsICIiLCAiIiwgImxzdXBlcmlvciIsICJPZ29uZWtzbWFsbCIsICJCcmV2ZXNtYWxsIiwgIk1hY3JvbnNtYWxsIiwgImJzdXBlcmlvciIsICJuc3VwZXJpb3IiLCAibXN1cGVyaW9yIiwgImNvbW1hc3VwZXJpb3IiLCAicGVyaW9kc3VwZXJpb3IiLCAiRG90YWNjZW50c21hbGwiLCAiUmluZ3NtYWxsIiwgIiIsICIiLCAiIiwgIiJdOwpjb25zdCBNYWNSb21hbkVuY29kaW5nID0gWyIiLCAiIiwgIiIsICIiLCAiIiwgIiIsICIiLCAiIiwgIiIsICIiLCAiIiwgIiIsICIiLCAiIiwgIiIsICIiLCAiIiwgIiIsICIiLCAiIiwgIiIsICIiLCAiIiwgIiIsICIiLCAiIiwgIiIsICIiLCAiIiwgIiIsICIiLCAiIiwgInNwYWNlIiwgImV4Y2xhbSIsICJxdW90ZWRibCIsICJudW1iZXJzaWduIiwgImRvbGxhciIsICJwZXJjZW50IiwgImFtcGVyc2FuZCIsICJxdW90ZXNpbmdsZSIsICJwYXJlbmxlZnQiLCAicGFyZW5yaWdodCIsICJhc3RlcmlzayIsICJwbHVzIiwgImNvbW1hIiwgImh5cGhlbiIsICJwZXJpb2QiLCAic2xhc2giLCAiemVybyIsICJvbmUiLCAidHdvIiwgInRocmVlIiwgImZvdXIiLCAiZml2ZSIsICJzaXgiLCAic2V2ZW4iLCAiZWlnaHQiLCAibmluZSIsICJjb2xvbiIsICJzZW1pY29sb24iLCAibGVzcyIsICJlcXVhbCIsICJncmVhdGVyIiwgInF1ZXN0aW9uIiwgImF0IiwgIkEiLCAiQiIsICJDIiwgIkQiLCAiRSIsICJGIiwgIkciLCAiSCIsICJJIiwgIkoiLCAiSyIsICJMIiwgIk0iLCAiTiIsICJPIiwgIlAiLCAiUSIsICJSIiwgIlMiLCAiVCIsICJVIiwgIlYiLCAiVyIsICJYIiwgIlkiLCAiWiIsICJicmFja2V0bGVmdCIsICJiYWNrc2xhc2giLCAiYnJhY2tldHJpZ2h0IiwgImFzY2lpY2lyY3VtIiwgInVuZGVyc2NvcmUiLCAiZ3JhdmUiLCAiYSIsICJiIiwgImMiLCAiZCIsICJlIiwgImYiLCAiZyIsICJoIiwgImkiLCAiaiIsICJrIiwgImwiLCAibSIsICJuIiwgIm8iLCAicCIsICJxIiwgInIiLCAicyIsICJ0IiwgInUiLCAidiIsICJ3IiwgIngiLCAieSIsICJ6IiwgImJyYWNlbGVmdCIsICJiYXIiLCAiYnJhY2VyaWdodCIsICJhc2NpaXRpbGRlIiwgIiIsICJBZGllcmVzaXMiLCAiQXJpbmciLCAiQ2NlZGlsbGEiLCAiRWFjdXRlIiwgIk50aWxkZSIsICJPZGllcmVzaXMiLCAiVWRpZXJlc2lzIiwgImFhY3V0ZSIsICJhZ3JhdmUiLCAiYWNpcmN1bWZsZXgiLCAiYWRpZXJlc2lzIiwgImF0aWxkZSIsICJhcmluZyIsICJjY2VkaWxsYSIsICJlYWN1dGUiLCAiZWdyYXZlIiwgImVjaXJjdW1mbGV4IiwgImVkaWVyZXNpcyIsICJpYWN1dGUiLCAiaWdyYXZlIiwgImljaXJjdW1mbGV4IiwgImlkaWVyZXNpcyIsICJudGlsZGUiLCAib2FjdXRlIiwgIm9ncmF2ZSIsICJvY2lyY3VtZmxleCIsICJvZGllcmVzaXMiLCAib3RpbGRlIiwgInVhY3V0ZSIsICJ1Z3JhdmUiLCAidWNpcmN1bWZsZXgiLCAidWRpZXJlc2lzIiwgImRhZ2dlciIsICJkZWdyZWUiLCAiY2VudCIsICJzdGVybGluZyIsICJzZWN0aW9uIiwgImJ1bGxldCIsICJwYXJhZ3JhcGgiLCAiZ2VybWFuZGJscyIsICJyZWdpc3RlcmVkIiwgImNvcHlyaWdodCIsICJ0cmFkZW1hcmsiLCAiYWN1dGUiLCAiZGllcmVzaXMiLCAibm90ZXF1YWwiLCAiQUUiLCAiT3NsYXNoIiwgImluZmluaXR5IiwgInBsdXNtaW51cyIsICJsZXNzZXF1YWwiLCAiZ3JlYXRlcmVxdWFsIiwgInllbiIsICJtdSIsICJwYXJ0aWFsZGlmZiIsICJzdW1tYXRpb24iLCAicHJvZHVjdCIsICJwaSIsICJpbnRlZ3JhbCIsICJvcmRmZW1pbmluZSIsICJvcmRtYXNjdWxpbmUiLCAiT21lZ2EiLCAiYWUiLCAib3NsYXNoIiwgInF1ZXN0aW9uZG93biIsICJleGNsYW1kb3duIiwgImxvZ2ljYWxub3QiLCAicmFkaWNhbCIsICJmbG9yaW4iLCAiYXBwcm94ZXF1YWwiLCAiRGVsdGEiLCAiZ3VpbGxlbW90bGVmdCIsICJndWlsbGVtb3RyaWdodCIsICJlbGxpcHNpcyIsICJzcGFjZSIsICJBZ3JhdmUiLCAiQXRpbGRlIiwgIk90aWxkZSIsICJPRSIsICJvZSIsICJlbmRhc2giLCAiZW1kYXNoIiwgInF1b3RlZGJsbGVmdCIsICJxdW90ZWRibHJpZ2h0IiwgInF1b3RlbGVmdCIsICJxdW90ZXJpZ2h0IiwgImRpdmlkZSIsICJsb3plbmdlIiwgInlkaWVyZXNpcyIsICJZZGllcmVzaXMiLCAiZnJhY3Rpb24iLCAiY3VycmVuY3kiLCAiZ3VpbHNpbmdsbGVmdCIsICJndWlsc2luZ2xyaWdodCIsICJmaSIsICJmbCIsICJkYWdnZXJkYmwiLCAicGVyaW9kY2VudGVyZWQiLCAicXVvdGVzaW5nbGJhc2UiLCAicXVvdGVkYmxiYXNlIiwgInBlcnRob3VzYW5kIiwgIkFjaXJjdW1mbGV4IiwgIkVjaXJjdW1mbGV4IiwgIkFhY3V0ZSIsICJFZGllcmVzaXMiLCAiRWdyYXZlIiwgIklhY3V0ZSIsICJJY2lyY3VtZmxleCIsICJJZGllcmVzaXMiLCAiSWdyYXZlIiwgIk9hY3V0ZSIsICJPY2lyY3VtZmxleCIsICJhcHBsZSIsICJPZ3JhdmUiLCAiVWFjdXRlIiwgIlVjaXJjdW1mbGV4IiwgIlVncmF2ZSIsICJkb3RsZXNzaSIsICJjaXJjdW1mbGV4IiwgInRpbGRlIiwgIm1hY3JvbiIsICJicmV2ZSIsICJkb3RhY2NlbnQiLCAicmluZyIsICJjZWRpbGxhIiwgImh1bmdhcnVtbGF1dCIsICJvZ29uZWsiLCAiY2Fyb24iXTsKZXhwb3J0cy5NYWNSb21hbkVuY29kaW5nID0gTWFjUm9tYW5FbmNvZGluZzsKY29uc3QgU3RhbmRhcmRFbmNvZGluZyA9IFsiIiwgIiIsICIiLCAiIiwgIiIsICIiLCAiIiwgIiIsICIiLCAiIiwgIiIsICIiLCAiIiwgIiIsICIiLCAiIiwgIiIsICIiLCAiIiwgIiIsICIiLCAiIiwgIiIsICIiLCAiIiwgIiIsICIiLCAiIiwgIiIsICIiLCAiIiwgIiIsICJzcGFjZSIsICJleGNsYW0iLCAicXVvdGVkYmwiLCAibnVtYmVyc2lnbiIsICJkb2xsYXIiLCAicGVyY2VudCIsICJhbXBlcnNhbmQiLCAicXVvdGVyaWdodCIsICJwYXJlbmxlZnQiLCAicGFyZW5yaWdodCIsICJhc3RlcmlzayIsICJwbHVzIiwgImNvbW1hIiwgImh5cGhlbiIsICJwZXJpb2QiLCAic2xhc2giLCAiemVybyIsICJvbmUiLCAidHdvIiwgInRocmVlIiwgImZvdXIiLCAiZml2ZSIsICJzaXgiLCAic2V2ZW4iLCAiZWlnaHQiLCAibmluZSIsICJjb2xvbiIsICJzZW1pY29sb24iLCAibGVzcyIsICJlcXVhbCIsICJncmVhdGVyIiwgInF1ZXN0aW9uIiwgImF0IiwgIkEiLCAiQiIsICJDIiwgIkQiLCAiRSIsICJGIiwgIkciLCAiSCIsICJJIiwgIkoiLCAiSyIsICJMIiwgIk0iLCAiTiIsICJPIiwgIlAiLCAiUSIsICJSIiwgIlMiLCAiVCIsICJVIiwgIlYiLCAiVyIsICJYIiwgIlkiLCAiWiIsICJicmFja2V0bGVmdCIsICJiYWNrc2xhc2giLCAiYnJhY2tldHJpZ2h0IiwgImFzY2lpY2lyY3VtIiwgInVuZGVyc2NvcmUiLCAicXVvdGVsZWZ0IiwgImEiLCAiYiIsICJjIiwgImQiLCAiZSIsICJmIiwgImciLCAiaCIsICJpIiwgImoiLCAiayIsICJsIiwgIm0iLCAibiIsICJvIiwgInAiLCAicSIsICJyIiwgInMiLCAidCIsICJ1IiwgInYiLCAidyIsICJ4IiwgInkiLCAieiIsICJicmFjZWxlZnQiLCAiYmFyIiwgImJyYWNlcmlnaHQiLCAiYXNjaWl0aWxkZSIsICIiLCAiIiwgIiIsICIiLCAiIiwgIiIsICIiLCAiIiwgIiIsICIiLCAiIiwgIiIsICIiLCAiIiwgIiIsICIiLCAiIiwgIiIsICIiLCAiIiwgIiIsICIiLCAiIiwgIiIsICIiLCAiIiwgIiIsICIiLCAiIiwgIiIsICIiLCAiIiwgIiIsICIiLCAiZXhjbGFtZG93biIsICJjZW50IiwgInN0ZXJsaW5nIiwgImZyYWN0aW9uIiwgInllbiIsICJmbG9yaW4iLCAic2VjdGlvbiIsICJjdXJyZW5jeSIsICJxdW90ZXNpbmdsZSIsICJxdW90ZWRibGxlZnQiLCAiZ3VpbGxlbW90bGVmdCIsICJndWlsc2luZ2xsZWZ0IiwgImd1aWxzaW5nbHJpZ2h0IiwgImZpIiwgImZsIiwgIiIsICJlbmRhc2giLCAiZGFnZ2VyIiwgImRhZ2dlcmRibCIsICJwZXJpb2RjZW50ZXJlZCIsICIiLCAicGFyYWdyYXBoIiwgImJ1bGxldCIsICJxdW90ZXNpbmdsYmFzZSIsICJxdW90ZWRibGJhc2UiLCAicXVvdGVkYmxyaWdodCIsICJndWlsbGVtb3RyaWdodCIsICJlbGxpcHNpcyIsICJwZXJ0aG91c2FuZCIsICIiLCAicXVlc3Rpb25kb3duIiwgIiIsICJncmF2ZSIsICJhY3V0ZSIsICJjaXJjdW1mbGV4IiwgInRpbGRlIiwgIm1hY3JvbiIsICJicmV2ZSIsICJkb3RhY2NlbnQiLCAiZGllcmVzaXMiLCAiIiwgInJpbmciLCAiY2VkaWxsYSIsICIiLCAiaHVuZ2FydW1sYXV0IiwgIm9nb25layIsICJjYXJvbiIsICJlbWRhc2giLCAiIiwgIiIsICIiLCAiIiwgIiIsICIiLCAiIiwgIiIsICIiLCAiIiwgIiIsICIiLCAiIiwgIiIsICIiLCAiIiwgIkFFIiwgIiIsICJvcmRmZW1pbmluZSIsICIiLCAiIiwgIiIsICIiLCAiTHNsYXNoIiwgIk9zbGFzaCIsICJPRSIsICJvcmRtYXNjdWxpbmUiLCAiIiwgIiIsICIiLCAiIiwgIiIsICJhZSIsICIiLCAiIiwgIiIsICJkb3RsZXNzaSIsICIiLCAiIiwgImxzbGFzaCIsICJvc2xhc2giLCAib2UiLCAiZ2VybWFuZGJscyIsICIiLCAiIiwgIiIsICIiXTsKZXhwb3J0cy5TdGFuZGFyZEVuY29kaW5nID0gU3RhbmRhcmRFbmNvZGluZzsKY29uc3QgV2luQW5zaUVuY29kaW5nID0gWyIiLCAiIiwgIiIsICIiLCAiIiwgIiIsICIiLCAiIiwgIiIsICIiLCAiIiwgIiIsICIiLCAiIiwgIiIsICIiLCAiIiwgIiIsICIiLCAiIiwgIiIsICIiLCAiIiwgIiIsICIiLCAiIiwgIiIsICIiLCAiIiwgIiIsICIiLCAiIiwgInNwYWNlIiwgImV4Y2xhbSIsICJxdW90ZWRibCIsICJudW1iZXJzaWduIiwgImRvbGxhciIsICJwZXJjZW50IiwgImFtcGVyc2FuZCIsICJxdW90ZXNpbmdsZSIsICJwYXJlbmxlZnQiLCAicGFyZW5yaWdodCIsICJhc3RlcmlzayIsICJwbHVzIiwgImNvbW1hIiwgImh5cGhlbiIsICJwZXJpb2QiLCAic2xhc2giLCAiemVybyIsICJvbmUiLCAidHdvIiwgInRocmVlIiwgImZvdXIiLCAiZml2ZSIsICJzaXgiLCAic2V2ZW4iLCAiZWlnaHQiLCAibmluZSIsICJjb2xvbiIsICJzZW1pY29sb24iLCAibGVzcyIsICJlcXVhbCIsICJncmVhdGVyIiwgInF1ZXN0aW9uIiwgImF0IiwgIkEiLCAiQiIsICJDIiwgIkQiLCAiRSIsICJGIiwgIkciLCAiSCIsICJJIiwgIkoiLCAiSyIsICJMIiwgIk0iLCAiTiIsICJPIiwgIlAiLCAiUSIsICJSIiwgIlMiLCAiVCIsICJVIiwgIlYiLCAiVyIsICJYIiwgIlkiLCAiWiIsICJicmFja2V0bGVmdCIsICJiYWNrc2xhc2giLCAiYnJhY2tldHJpZ2h0IiwgImFzY2lpY2lyY3VtIiwgInVuZGVyc2NvcmUiLCAiZ3JhdmUiLCAiYSIsICJiIiwgImMiLCAiZCIsICJlIiwgImYiLCAiZyIsICJoIiwgImkiLCAiaiIsICJrIiwgImwiLCAibSIsICJuIiwgIm8iLCAicCIsICJxIiwgInIiLCAicyIsICJ0IiwgInUiLCAidiIsICJ3IiwgIngiLCAieSIsICJ6IiwgImJyYWNlbGVmdCIsICJiYXIiLCAiYnJhY2VyaWdodCIsICJhc2NpaXRpbGRlIiwgImJ1bGxldCIsICJFdXJvIiwgImJ1bGxldCIsICJxdW90ZXNpbmdsYmFzZSIsICJmbG9yaW4iLCAicXVvdGVkYmxiYXNlIiwgImVsbGlwc2lzIiwgImRhZ2dlciIsICJkYWdnZXJkYmwiLCAiY2lyY3VtZmxleCIsICJwZXJ0aG91c2FuZCIsICJTY2Fyb24iLCAiZ3VpbHNpbmdsbGVmdCIsICJPRSIsICJidWxsZXQiLCAiWmNhcm9uIiwgImJ1bGxldCIsICJidWxsZXQiLCAicXVvdGVsZWZ0IiwgInF1b3RlcmlnaHQiLCAicXVvdGVkYmxsZWZ0IiwgInF1b3RlZGJscmlnaHQiLCAiYnVsbGV0IiwgImVuZGFzaCIsICJlbWRhc2giLCAidGlsZGUiLCAidHJhZGVtYXJrIiwgInNjYXJvbiIsICJndWlsc2luZ2xyaWdodCIsICJvZSIsICJidWxsZXQiLCAiemNhcm9uIiwgIllkaWVyZXNpcyIsICJzcGFjZSIsICJleGNsYW1kb3duIiwgImNlbnQiLCAic3RlcmxpbmciLCAiY3VycmVuY3kiLCAieWVuIiwgImJyb2tlbmJhciIsICJzZWN0aW9uIiwgImRpZXJlc2lzIiwgImNvcHlyaWdodCIsICJvcmRmZW1pbmluZSIsICJndWlsbGVtb3RsZWZ0IiwgImxvZ2ljYWxub3QiLCAiaHlwaGVuIiwgInJlZ2lzdGVyZWQiLCAibWFjcm9uIiwgImRlZ3JlZSIsICJwbHVzbWludXMiLCAidHdvc3VwZXJpb3IiLCAidGhyZWVzdXBlcmlvciIsICJhY3V0ZSIsICJtdSIsICJwYXJhZ3JhcGgiLCAicGVyaW9kY2VudGVyZWQiLCAiY2VkaWxsYSIsICJvbmVzdXBlcmlvciIsICJvcmRtYXNjdWxpbmUiLCAiZ3VpbGxlbW90cmlnaHQiLCAib25lcXVhcnRlciIsICJvbmVoYWxmIiwgInRocmVlcXVhcnRlcnMiLCAicXVlc3Rpb25kb3duIiwgIkFncmF2ZSIsICJBYWN1dGUiLCAiQWNpcmN1bWZsZXgiLCAiQXRpbGRlIiwgIkFkaWVyZXNpcyIsICJBcmluZyIsICJBRSIsICJDY2VkaWxsYSIsICJFZ3JhdmUiLCAiRWFjdXRlIiwgIkVjaXJjdW1mbGV4IiwgIkVkaWVyZXNpcyIsICJJZ3JhdmUiLCAiSWFjdXRlIiwgIkljaXJjdW1mbGV4IiwgIklkaWVyZXNpcyIsICJFdGgiLCAiTnRpbGRlIiwgIk9ncmF2ZSIsICJPYWN1dGUiLCAiT2NpcmN1bWZsZXgiLCAiT3RpbGRlIiwgIk9kaWVyZXNpcyIsICJtdWx0aXBseSIsICJPc2xhc2giLCAiVWdyYXZlIiwgIlVhY3V0ZSIsICJVY2lyY3VtZmxleCIsICJVZGllcmVzaXMiLCAiWWFjdXRlIiwgIlRob3JuIiwgImdlcm1hbmRibHMiLCAiYWdyYXZlIiwgImFhY3V0ZSIsICJhY2lyY3VtZmxleCIsICJhdGlsZGUiLCAiYWRpZXJlc2lzIiwgImFyaW5nIiwgImFlIiwgImNjZWRpbGxhIiwgImVncmF2ZSIsICJlYWN1dGUiLCAiZWNpcmN1bWZsZXgiLCAiZWRpZXJlc2lzIiwgImlncmF2ZSIsICJpYWN1dGUiLCAiaWNpcmN1bWZsZXgiLCAiaWRpZXJlc2lzIiwgImV0aCIsICJudGlsZGUiLCAib2dyYXZlIiwgIm9hY3V0ZSIsICJvY2lyY3VtZmxleCIsICJvdGlsZGUiLCAib2RpZXJlc2lzIiwgImRpdmlkZSIsICJvc2xhc2giLCAidWdyYXZlIiwgInVhY3V0ZSIsICJ1Y2lyY3VtZmxleCIsICJ1ZGllcmVzaXMiLCAieWFjdXRlIiwgInRob3JuIiwgInlkaWVyZXNpcyJdOwpleHBvcnRzLldpbkFuc2lFbmNvZGluZyA9IFdpbkFuc2lFbmNvZGluZzsKY29uc3QgU3ltYm9sU2V0RW5jb2RpbmcgPSBbIiIsICIiLCAiIiwgIiIsICIiLCAiIiwgIiIsICIiLCAiIiwgIiIsICIiLCAiIiwgIiIsICIiLCAiIiwgIiIsICIiLCAiIiwgIiIsICIiLCAiIiwgIiIsICIiLCAiIiwgIiIsICIiLCAiIiwgIiIsICIiLCAiIiwgIiIsICIiLCAic3BhY2UiLCAiZXhjbGFtIiwgInVuaXZlcnNhbCIsICJudW1iZXJzaWduIiwgImV4aXN0ZW50aWFsIiwgInBlcmNlbnQiLCAiYW1wZXJzYW5kIiwgInN1Y2h0aGF0IiwgInBhcmVubGVmdCIsICJwYXJlbnJpZ2h0IiwgImFzdGVyaXNrbWF0aCIsICJwbHVzIiwgImNvbW1hIiwgIm1pbnVzIiwgInBlcmlvZCIsICJzbGFzaCIsICJ6ZXJvIiwgIm9uZSIsICJ0d28iLCAidGhyZWUiLCAiZm91ciIsICJmaXZlIiwgInNpeCIsICJzZXZlbiIsICJlaWdodCIsICJuaW5lIiwgImNvbG9uIiwgInNlbWljb2xvbiIsICJsZXNzIiwgImVxdWFsIiwgImdyZWF0ZXIiLCAicXVlc3Rpb24iLCAiY29uZ3J1ZW50IiwgIkFscGhhIiwgIkJldGEiLCAiQ2hpIiwgIkRlbHRhIiwgIkVwc2lsb24iLCAiUGhpIiwgIkdhbW1hIiwgIkV0YSIsICJJb3RhIiwgInRoZXRhMSIsICJLYXBwYSIsICJMYW1iZGEiLCAiTXUiLCAiTnUiLCAiT21pY3JvbiIsICJQaSIsICJUaGV0YSIsICJSaG8iLCAiU2lnbWEiLCAiVGF1IiwgIlVwc2lsb24iLCAic2lnbWExIiwgIk9tZWdhIiwgIlhpIiwgIlBzaSIsICJaZXRhIiwgImJyYWNrZXRsZWZ0IiwgInRoZXJlZm9yZSIsICJicmFja2V0cmlnaHQiLCAicGVycGVuZGljdWxhciIsICJ1bmRlcnNjb3JlIiwgInJhZGljYWxleCIsICJhbHBoYSIsICJiZXRhIiwgImNoaSIsICJkZWx0YSIsICJlcHNpbG9uIiwgInBoaSIsICJnYW1tYSIsICJldGEiLCAiaW90YSIsICJwaGkxIiwgImthcHBhIiwgImxhbWJkYSIsICJtdSIsICJudSIsICJvbWljcm9uIiwgInBpIiwgInRoZXRhIiwgInJobyIsICJzaWdtYSIsICJ0YXUiLCAidXBzaWxvbiIsICJvbWVnYTEiLCAib21lZ2EiLCAieGkiLCAicHNpIiwgInpldGEiLCAiYnJhY2VsZWZ0IiwgImJhciIsICJicmFjZXJpZ2h0IiwgInNpbWlsYXIiLCAiIiwgIiIsICIiLCAiIiwgIiIsICIiLCAiIiwgIiIsICIiLCAiIiwgIiIsICIiLCAiIiwgIiIsICIiLCAiIiwgIiIsICIiLCAiIiwgIiIsICIiLCAiIiwgIiIsICIiLCAiIiwgIiIsICIiLCAiIiwgIiIsICIiLCAiIiwgIiIsICIiLCAiRXVybyIsICJVcHNpbG9uMSIsICJtaW51dGUiLCAibGVzc2VxdWFsIiwgImZyYWN0aW9uIiwgImluZmluaXR5IiwgImZsb3JpbiIsICJjbHViIiwgImRpYW1vbmQiLCAiaGVhcnQiLCAic3BhZGUiLCAiYXJyb3dib3RoIiwgImFycm93bGVmdCIsICJhcnJvd3VwIiwgImFycm93cmlnaHQiLCAiYXJyb3dkb3duIiwgImRlZ3JlZSIsICJwbHVzbWludXMiLCAic2Vjb25kIiwgImdyZWF0ZXJlcXVhbCIsICJtdWx0aXBseSIsICJwcm9wb3J0aW9uYWwiLCAicGFydGlhbGRpZmYiLCAiYnVsbGV0IiwgImRpdmlkZSIsICJub3RlcXVhbCIsICJlcXVpdmFsZW5jZSIsICJhcHByb3hlcXVhbCIsICJlbGxpcHNpcyIsICJhcnJvd3ZlcnRleCIsICJhcnJvd2hvcml6ZXgiLCAiY2FycmlhZ2VyZXR1cm4iLCAiYWxlcGgiLCAiSWZyYWt0dXIiLCAiUmZyYWt0dXIiLCAid2VpZXJzdHJhc3MiLCAiY2lyY2xlbXVsdGlwbHkiLCAiY2lyY2xlcGx1cyIsICJlbXB0eXNldCIsICJpbnRlcnNlY3Rpb24iLCAidW5pb24iLCAicHJvcGVyc3VwZXJzZXQiLCAicmVmbGV4c3VwZXJzZXQiLCAibm90c3Vic2V0IiwgInByb3BlcnN1YnNldCIsICJyZWZsZXhzdWJzZXQiLCAiZWxlbWVudCIsICJub3RlbGVtZW50IiwgImFuZ2xlIiwgImdyYWRpZW50IiwgInJlZ2lzdGVyc2VyaWYiLCAiY29weXJpZ2h0c2VyaWYiLCAidHJhZGVtYXJrc2VyaWYiLCAicHJvZHVjdCIsICJyYWRpY2FsIiwgImRvdG1hdGgiLCAibG9naWNhbG5vdCIsICJsb2dpY2FsYW5kIiwgImxvZ2ljYWxvciIsICJhcnJvd2RibGJvdGgiLCAiYXJyb3dkYmxsZWZ0IiwgImFycm93ZGJsdXAiLCAiYXJyb3dkYmxyaWdodCIsICJhcnJvd2RibGRvd24iLCAibG96ZW5nZSIsICJhbmdsZWxlZnQiLCAicmVnaXN0ZXJzYW5zIiwgImNvcHlyaWdodHNhbnMiLCAidHJhZGVtYXJrc2FucyIsICJzdW1tYXRpb24iLCAicGFyZW5sZWZ0dHAiLCAicGFyZW5sZWZ0ZXgiLCAicGFyZW5sZWZ0YnQiLCAiYnJhY2tldGxlZnR0cCIsICJicmFja2V0bGVmdGV4IiwgImJyYWNrZXRsZWZ0YnQiLCAiYnJhY2VsZWZ0dHAiLCAiYnJhY2VsZWZ0bWlkIiwgImJyYWNlbGVmdGJ0IiwgImJyYWNlZXgiLCAiIiwgImFuZ2xlcmlnaHQiLCAiaW50ZWdyYWwiLCAiaW50ZWdyYWx0cCIsICJpbnRlZ3JhbGV4IiwgImludGVncmFsYnQiLCAicGFyZW5yaWdodHRwIiwgInBhcmVucmlnaHRleCIsICJwYXJlbnJpZ2h0YnQiLCAiYnJhY2tldHJpZ2h0dHAiLCAiYnJhY2tldHJpZ2h0ZXgiLCAiYnJhY2tldHJpZ2h0YnQiLCAiYnJhY2VyaWdodHRwIiwgImJyYWNlcmlnaHRtaWQiLCAiYnJhY2VyaWdodGJ0IiwgIiJdOwpleHBvcnRzLlN5bWJvbFNldEVuY29kaW5nID0gU3ltYm9sU2V0RW5jb2Rpbmc7CmNvbnN0IFphcGZEaW5nYmF0c0VuY29kaW5nID0gWyIiLCAiIiwgIiIsICIiLCAiIiwgIiIsICIiLCAiIiwgIiIsICIiLCAiIiwgIiIsICIiLCAiIiwgIiIsICIiLCAiIiwgIiIsICIiLCAiIiwgIiIsICIiLCAiIiwgIiIsICIiLCAiIiwgIiIsICIiLCAiIiwgIiIsICIiLCAiIiwgInNwYWNlIiwgImExIiwgImEyIiwgImEyMDIiLCAiYTMiLCAiYTQiLCAiYTUiLCAiYTExOSIsICJhMTE4IiwgImExMTciLCAiYTExIiwgImExMiIsICJhMTMiLCAiYTE0IiwgImExNSIsICJhMTYiLCAiYTEwNSIsICJhMTciLCAiYTE4IiwgImExOSIsICJhMjAiLCAiYTIxIiwgImEyMiIsICJhMjMiLCAiYTI0IiwgImEyNSIsICJhMjYiLCAiYTI3IiwgImEyOCIsICJhNiIsICJhNyIsICJhOCIsICJhOSIsICJhMTAiLCAiYTI5IiwgImEzMCIsICJhMzEiLCAiYTMyIiwgImEzMyIsICJhMzQiLCAiYTM1IiwgImEzNiIsICJhMzciLCAiYTM4IiwgImEzOSIsICJhNDAiLCAiYTQxIiwgImE0MiIsICJhNDMiLCAiYTQ0IiwgImE0NSIsICJhNDYiLCAiYTQ3IiwgImE0OCIsICJhNDkiLCAiYTUwIiwgImE1MSIsICJhNTIiLCAiYTUzIiwgImE1NCIsICJhNTUiLCAiYTU2IiwgImE1NyIsICJhNTgiLCAiYTU5IiwgImE2MCIsICJhNjEiLCAiYTYyIiwgImE2MyIsICJhNjQiLCAiYTY1IiwgImE2NiIsICJhNjciLCAiYTY4IiwgImE2OSIsICJhNzAiLCAiYTcxIiwgImE3MiIsICJhNzMiLCAiYTc0IiwgImEyMDMiLCAiYTc1IiwgImEyMDQiLCAiYTc2IiwgImE3NyIsICJhNzgiLCAiYTc5IiwgImE4MSIsICJhODIiLCAiYTgzIiwgImE4NCIsICJhOTciLCAiYTk4IiwgImE5OSIsICJhMTAwIiwgIiIsICJhODkiLCAiYTkwIiwgImE5MyIsICJhOTQiLCAiYTkxIiwgImE5MiIsICJhMjA1IiwgImE4NSIsICJhMjA2IiwgImE4NiIsICJhODciLCAiYTg4IiwgImE5NSIsICJhOTYiLCAiIiwgIiIsICIiLCAiIiwgIiIsICIiLCAiIiwgIiIsICIiLCAiIiwgIiIsICIiLCAiIiwgIiIsICIiLCAiIiwgIiIsICIiLCAiIiwgImExMDEiLCAiYTEwMiIsICJhMTAzIiwgImExMDQiLCAiYTEwNiIsICJhMTA3IiwgImExMDgiLCAiYTExMiIsICJhMTExIiwgImExMTAiLCAiYTEwOSIsICJhMTIwIiwgImExMjEiLCAiYTEyMiIsICJhMTIzIiwgImExMjQiLCAiYTEyNSIsICJhMTI2IiwgImExMjciLCAiYTEyOCIsICJhMTI5IiwgImExMzAiLCAiYTEzMSIsICJhMTMyIiwgImExMzMiLCAiYTEzNCIsICJhMTM1IiwgImExMzYiLCAiYTEzNyIsICJhMTM4IiwgImExMzkiLCAiYTE0MCIsICJhMTQxIiwgImExNDIiLCAiYTE0MyIsICJhMTQ0IiwgImExNDUiLCAiYTE0NiIsICJhMTQ3IiwgImExNDgiLCAiYTE0OSIsICJhMTUwIiwgImExNTEiLCAiYTE1MiIsICJhMTUzIiwgImExNTQiLCAiYTE1NSIsICJhMTU2IiwgImExNTciLCAiYTE1OCIsICJhMTU5IiwgImExNjAiLCAiYTE2MSIsICJhMTYzIiwgImExNjQiLCAiYTE5NiIsICJhMTY1IiwgImExOTIiLCAiYTE2NiIsICJhMTY3IiwgImExNjgiLCAiYTE2OSIsICJhMTcwIiwgImExNzEiLCAiYTE3MiIsICJhMTczIiwgImExNjIiLCAiYTE3NCIsICJhMTc1IiwgImExNzYiLCAiYTE3NyIsICJhMTc4IiwgImExNzkiLCAiYTE5MyIsICJhMTgwIiwgImExOTkiLCAiYTE4MSIsICJhMjAwIiwgImExODIiLCAiIiwgImEyMDEiLCAiYTE4MyIsICJhMTg0IiwgImExOTciLCAiYTE4NSIsICJhMTk0IiwgImExOTgiLCAiYTE4NiIsICJhMTk1IiwgImExODciLCAiYTE4OCIsICJhMTg5IiwgImExOTAiLCAiYTE5MSIsICIiXTsKZXhwb3J0cy5aYXBmRGluZ2JhdHNFbmNvZGluZyA9IFphcGZEaW5nYmF0c0VuY29kaW5nOwpmdW5jdGlvbiBnZXRFbmNvZGluZyhlbmNvZGluZ05hbWUpIHsKICBzd2l0Y2ggKGVuY29kaW5nTmFtZSkgewogICAgY2FzZSAiV2luQW5zaUVuY29kaW5nIjoKICAgICAgcmV0dXJuIFdpbkFuc2lFbmNvZGluZzsKICAgIGNhc2UgIlN0YW5kYXJkRW5jb2RpbmciOgogICAgICByZXR1cm4gU3RhbmRhcmRFbmNvZGluZzsKICAgIGNhc2UgIk1hY1JvbWFuRW5jb2RpbmciOgogICAgICByZXR1cm4gTWFjUm9tYW5FbmNvZGluZzsKICAgIGNhc2UgIlN5bWJvbFNldEVuY29kaW5nIjoKICAgICAgcmV0dXJuIFN5bWJvbFNldEVuY29kaW5nOwogICAgY2FzZSAiWmFwZkRpbmdiYXRzRW5jb2RpbmciOgogICAgICByZXR1cm4gWmFwZkRpbmdiYXRzRW5jb2Rpbmc7CiAgICBjYXNlICJFeHBlcnRFbmNvZGluZyI6CiAgICAgIHJldHVybiBFeHBlcnRFbmNvZGluZzsKICAgIGNhc2UgIk1hY0V4cGVydEVuY29kaW5nIjoKICAgICAgcmV0dXJuIE1hY0V4cGVydEVuY29kaW5nOwogICAgZGVmYXVsdDoKICAgICAgcmV0dXJuIG51bGw7CiAgfQp9CgovKioqLyB9KSwKLyogMzggKi8KLyoqKi8gKChfX3VudXNlZF93ZWJwYWNrX21vZHVsZSwgZXhwb3J0cywgX193X3BkZmpzX3JlcXVpcmVfXykgPT4gewoKCgpPYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgIl9fZXNNb2R1bGUiLCAoewogIHZhbHVlOiB0cnVlCn0pKTsKZXhwb3J0cy5TRUFDX0FOQUxZU0lTX0VOQUJMRUQgPSBleHBvcnRzLk1hY1N0YW5kYXJkR2x5cGhPcmRlcmluZyA9IGV4cG9ydHMuRm9udEZsYWdzID0gdm9pZCAwOwpleHBvcnRzLm5vcm1hbGl6ZUZvbnROYW1lID0gbm9ybWFsaXplRm9udE5hbWU7CmV4cG9ydHMucmVjb3ZlckdseXBoTmFtZSA9IHJlY292ZXJHbHlwaE5hbWU7CmV4cG9ydHMudHlwZTFGb250R2x5cGhNYXBwaW5nID0gdHlwZTFGb250R2x5cGhNYXBwaW5nOwp2YXIgX2VuY29kaW5ncyA9IF9fd19wZGZqc19yZXF1aXJlX18oMzcpOwp2YXIgX2dseXBobGlzdCA9IF9fd19wZGZqc19yZXF1aXJlX18oMzkpOwp2YXIgX3VuaWNvZGUgPSBfX3dfcGRmanNfcmVxdWlyZV9fKDQwKTsKdmFyIF91dGlsID0gX193X3BkZmpzX3JlcXVpcmVfXygyKTsKY29uc3QgU0VBQ19BTkFMWVNJU19FTkFCTEVEID0gdHJ1ZTsKZXhwb3J0cy5TRUFDX0FOQUxZU0lTX0VOQUJMRUQgPSBTRUFDX0FOQUxZU0lTX0VOQUJMRUQ7CmNvbnN0IEZvbnRGbGFncyA9IHsKICBGaXhlZFBpdGNoOiAxLAogIFNlcmlmOiAyLAogIFN5bWJvbGljOiA0LAogIFNjcmlwdDogOCwKICBOb25zeW1ib2xpYzogMzIsCiAgSXRhbGljOiA2NCwKICBBbGxDYXA6IDY1NTM2LAogIFNtYWxsQ2FwOiAxMzEwNzIsCiAgRm9yY2VCb2xkOiAyNjIxNDQKfTsKZXhwb3J0cy5Gb250RmxhZ3MgPSBGb250RmxhZ3M7CmNvbnN0IE1hY1N0YW5kYXJkR2x5cGhPcmRlcmluZyA9IFsiLm5vdGRlZiIsICIubnVsbCIsICJub25tYXJraW5ncmV0dXJuIiwgInNwYWNlIiwgImV4Y2xhbSIsICJxdW90ZWRibCIsICJudW1iZXJzaWduIiwgImRvbGxhciIsICJwZXJjZW50IiwgImFtcGVyc2FuZCIsICJxdW90ZXNpbmdsZSIsICJwYXJlbmxlZnQiLCAicGFyZW5yaWdodCIsICJhc3RlcmlzayIsICJwbHVzIiwgImNvbW1hIiwgImh5cGhlbiIsICJwZXJpb2QiLCAic2xhc2giLCAiemVybyIsICJvbmUiLCAidHdvIiwgInRocmVlIiwgImZvdXIiLCAiZml2ZSIsICJzaXgiLCAic2V2ZW4iLCAiZWlnaHQiLCAibmluZSIsICJjb2xvbiIsICJzZW1pY29sb24iLCAibGVzcyIsICJlcXVhbCIsICJncmVhdGVyIiwgInF1ZXN0aW9uIiwgImF0IiwgIkEiLCAiQiIsICJDIiwgIkQiLCAiRSIsICJGIiwgIkciLCAiSCIsICJJIiwgIkoiLCAiSyIsICJMIiwgIk0iLCAiTiIsICJPIiwgIlAiLCAiUSIsICJSIiwgIlMiLCAiVCIsICJVIiwgIlYiLCAiVyIsICJYIiwgIlkiLCAiWiIsICJicmFja2V0bGVmdCIsICJiYWNrc2xhc2giLCAiYnJhY2tldHJpZ2h0IiwgImFzY2lpY2lyY3VtIiwgInVuZGVyc2NvcmUiLCAiZ3JhdmUiLCAiYSIsICJiIiwgImMiLCAiZCIsICJlIiwgImYiLCAiZyIsICJoIiwgImkiLCAiaiIsICJrIiwgImwiLCAibSIsICJuIiwgIm8iLCAicCIsICJxIiwgInIiLCAicyIsICJ0IiwgInUiLCAidiIsICJ3IiwgIngiLCAieSIsICJ6IiwgImJyYWNlbGVmdCIsICJiYXIiLCAiYnJhY2VyaWdodCIsICJhc2NpaXRpbGRlIiwgIkFkaWVyZXNpcyIsICJBcmluZyIsICJDY2VkaWxsYSIsICJFYWN1dGUiLCAiTnRpbGRlIiwgIk9kaWVyZXNpcyIsICJVZGllcmVzaXMiLCAiYWFjdXRlIiwgImFncmF2ZSIsICJhY2lyY3VtZmxleCIsICJhZGllcmVzaXMiLCAiYXRpbGRlIiwgImFyaW5nIiwgImNjZWRpbGxhIiwgImVhY3V0ZSIsICJlZ3JhdmUiLCAiZWNpcmN1bWZsZXgiLCAiZWRpZXJlc2lzIiwgImlhY3V0ZSIsICJpZ3JhdmUiLCAiaWNpcmN1bWZsZXgiLCAiaWRpZXJlc2lzIiwgIm50aWxkZSIsICJvYWN1dGUiLCAib2dyYXZlIiwgIm9jaXJjdW1mbGV4IiwgIm9kaWVyZXNpcyIsICJvdGlsZGUiLCAidWFjdXRlIiwgInVncmF2ZSIsICJ1Y2lyY3VtZmxleCIsICJ1ZGllcmVzaXMiLCAiZGFnZ2VyIiwgImRlZ3JlZSIsICJjZW50IiwgInN0ZXJsaW5nIiwgInNlY3Rpb24iLCAiYnVsbGV0IiwgInBhcmFncmFwaCIsICJnZXJtYW5kYmxzIiwgInJlZ2lzdGVyZWQiLCAiY29weXJpZ2h0IiwgInRyYWRlbWFyayIsICJhY3V0ZSIsICJkaWVyZXNpcyIsICJub3RlcXVhbCIsICJBRSIsICJPc2xhc2giLCAiaW5maW5pdHkiLCAicGx1c21pbnVzIiwgImxlc3NlcXVhbCIsICJncmVhdGVyZXF1YWwiLCAieWVuIiwgIm11IiwgInBhcnRpYWxkaWZmIiwgInN1bW1hdGlvbiIsICJwcm9kdWN0IiwgInBpIiwgImludGVncmFsIiwgIm9yZGZlbWluaW5lIiwgIm9yZG1hc2N1bGluZSIsICJPbWVnYSIsICJhZSIsICJvc2xhc2giLCAicXVlc3Rpb25kb3duIiwgImV4Y2xhbWRvd24iLCAibG9naWNhbG5vdCIsICJyYWRpY2FsIiwgImZsb3JpbiIsICJhcHByb3hlcXVhbCIsICJEZWx0YSIsICJndWlsbGVtb3RsZWZ0IiwgImd1aWxsZW1vdHJpZ2h0IiwgImVsbGlwc2lzIiwgIm5vbmJyZWFraW5nc3BhY2UiLCAiQWdyYXZlIiwgIkF0aWxkZSIsICJPdGlsZGUiLCAiT0UiLCAib2UiLCAiZW5kYXNoIiwgImVtZGFzaCIsICJxdW90ZWRibGxlZnQiLCAicXVvdGVkYmxyaWdodCIsICJxdW90ZWxlZnQiLCAicXVvdGVyaWdodCIsICJkaXZpZGUiLCAibG96ZW5nZSIsICJ5ZGllcmVzaXMiLCAiWWRpZXJlc2lzIiwgImZyYWN0aW9uIiwgImN1cnJlbmN5IiwgImd1aWxzaW5nbGxlZnQiLCAiZ3VpbHNpbmdscmlnaHQiLCAiZmkiLCAiZmwiLCAiZGFnZ2VyZGJsIiwgInBlcmlvZGNlbnRlcmVkIiwgInF1b3Rlc2luZ2xiYXNlIiwgInF1b3RlZGJsYmFzZSIsICJwZXJ0aG91c2FuZCIsICJBY2lyY3VtZmxleCIsICJFY2lyY3VtZmxleCIsICJBYWN1dGUiLCAiRWRpZXJlc2lzIiwgIkVncmF2ZSIsICJJYWN1dGUiLCAiSWNpcmN1bWZsZXgiLCAiSWRpZXJlc2lzIiwgIklncmF2ZSIsICJPYWN1dGUiLCAiT2NpcmN1bWZsZXgiLCAiYXBwbGUiLCAiT2dyYXZlIiwgIlVhY3V0ZSIsICJVY2lyY3VtZmxleCIsICJVZ3JhdmUiLCAiZG90bGVzc2kiLCAiY2lyY3VtZmxleCIsICJ0aWxkZSIsICJtYWNyb24iLCAiYnJldmUiLCAiZG90YWNjZW50IiwgInJpbmciLCAiY2VkaWxsYSIsICJodW5nYXJ1bWxhdXQiLCAib2dvbmVrIiwgImNhcm9uIiwgIkxzbGFzaCIsICJsc2xhc2giLCAiU2Nhcm9uIiwgInNjYXJvbiIsICJaY2Fyb24iLCAiemNhcm9uIiwgImJyb2tlbmJhciIsICJFdGgiLCAiZXRoIiwgIllhY3V0ZSIsICJ5YWN1dGUiLCAiVGhvcm4iLCAidGhvcm4iLCAibWludXMiLCAibXVsdGlwbHkiLCAib25lc3VwZXJpb3IiLCAidHdvc3VwZXJpb3IiLCAidGhyZWVzdXBlcmlvciIsICJvbmVoYWxmIiwgIm9uZXF1YXJ0ZXIiLCAidGhyZWVxdWFydGVycyIsICJmcmFuYyIsICJHYnJldmUiLCAiZ2JyZXZlIiwgIklkb3RhY2NlbnQiLCAiU2NlZGlsbGEiLCAic2NlZGlsbGEiLCAiQ2FjdXRlIiwgImNhY3V0ZSIsICJDY2Fyb24iLCAiY2Nhcm9uIiwgImRjcm9hdCJdOwpleHBvcnRzLk1hY1N0YW5kYXJkR2x5cGhPcmRlcmluZyA9IE1hY1N0YW5kYXJkR2x5cGhPcmRlcmluZzsKZnVuY3Rpb24gcmVjb3ZlckdseXBoTmFtZShuYW1lLCBnbHlwaHNVbmljb2RlTWFwKSB7CiAgaWYgKGdseXBoc1VuaWNvZGVNYXBbbmFtZV0gIT09IHVuZGVmaW5lZCkgewogICAgcmV0dXJuIG5hbWU7CiAgfQogIGNvbnN0IHVuaWNvZGUgPSAoMCwgX3VuaWNvZGUuZ2V0VW5pY29kZUZvckdseXBoKShuYW1lLCBnbHlwaHNVbmljb2RlTWFwKTsKICBpZiAodW5pY29kZSAhPT0gLTEpIHsKICAgIGZvciAoY29uc3Qga2V5IGluIGdseXBoc1VuaWNvZGVNYXApIHsKICAgICAgaWYgKGdseXBoc1VuaWNvZGVNYXBba2V5XSA9PT0gdW5pY29kZSkgewogICAgICAgIHJldHVybiBrZXk7CiAgICAgIH0KICAgIH0KICB9CiAgKDAsIF91dGlsLmluZm8pKCJVbmFibGUgdG8gcmVjb3ZlciBhIHN0YW5kYXJkIGdseXBoIG5hbWUgZm9yOiAiICsgbmFtZSk7CiAgcmV0dXJuIG5hbWU7Cn0KZnVuY3Rpb24gdHlwZTFGb250R2x5cGhNYXBwaW5nKHByb3BlcnRpZXMsIGJ1aWx0SW5FbmNvZGluZywgZ2x5cGhOYW1lcykgewogIGNvbnN0IGNoYXJDb2RlVG9HbHlwaElkID0gT2JqZWN0LmNyZWF0ZShudWxsKTsKICBsZXQgZ2x5cGhJZCwgY2hhckNvZGUsIGJhc2VFbmNvZGluZzsKICBjb25zdCBpc1N5bWJvbGljRm9udCA9ICEhKHByb3BlcnRpZXMuZmxhZ3MgJiBGb250RmxhZ3MuU3ltYm9saWMpOwogIGlmIChwcm9wZXJ0aWVzLmlzSW50ZXJuYWxGb250KSB7CiAgICBiYXNlRW5jb2RpbmcgPSBidWlsdEluRW5jb2Rpbmc7CiAgICBmb3IgKGNoYXJDb2RlID0gMDsgY2hhckNvZGUgPCBiYXNlRW5jb2RpbmcubGVuZ3RoOyBjaGFyQ29kZSsrKSB7CiAgICAgIGdseXBoSWQgPSBnbHlwaE5hbWVzLmluZGV4T2YoYmFzZUVuY29kaW5nW2NoYXJDb2RlXSk7CiAgICAgIGNoYXJDb2RlVG9HbHlwaElkW2NoYXJDb2RlXSA9IGdseXBoSWQgPj0gMCA/IGdseXBoSWQgOiAwOwogICAgfQogIH0gZWxzZSBpZiAocHJvcGVydGllcy5iYXNlRW5jb2RpbmdOYW1lKSB7CiAgICBiYXNlRW5jb2RpbmcgPSAoMCwgX2VuY29kaW5ncy5nZXRFbmNvZGluZykocHJvcGVydGllcy5iYXNlRW5jb2RpbmdOYW1lKTsKICAgIGZvciAoY2hhckNvZGUgPSAwOyBjaGFyQ29kZSA8IGJhc2VFbmNvZGluZy5sZW5ndGg7IGNoYXJDb2RlKyspIHsKICAgICAgZ2x5cGhJZCA9IGdseXBoTmFtZXMuaW5kZXhPZihiYXNlRW5jb2RpbmdbY2hhckNvZGVdKTsKICAgICAgY2hhckNvZGVUb0dseXBoSWRbY2hhckNvZGVdID0gZ2x5cGhJZCA+PSAwID8gZ2x5cGhJZCA6IDA7CiAgICB9CiAgfSBlbHNlIGlmIChpc1N5bWJvbGljRm9udCkgewogICAgZm9yIChjaGFyQ29kZSBpbiBidWlsdEluRW5jb2RpbmcpIHsKICAgICAgY2hhckNvZGVUb0dseXBoSWRbY2hhckNvZGVdID0gYnVpbHRJbkVuY29kaW5nW2NoYXJDb2RlXTsKICAgIH0KICB9IGVsc2UgewogICAgYmFzZUVuY29kaW5nID0gX2VuY29kaW5ncy5TdGFuZGFyZEVuY29kaW5nOwogICAgZm9yIChjaGFyQ29kZSA9IDA7IGNoYXJDb2RlIDwgYmFzZUVuY29kaW5nLmxlbmd0aDsgY2hhckNvZGUrKykgewogICAgICBnbHlwaElkID0gZ2x5cGhOYW1lcy5pbmRleE9mKGJhc2VFbmNvZGluZ1tjaGFyQ29kZV0pOwogICAgICBjaGFyQ29kZVRvR2x5cGhJZFtjaGFyQ29kZV0gPSBnbHlwaElkID49IDAgPyBnbHlwaElkIDogMDsKICAgIH0KICB9CiAgY29uc3QgZGlmZmVyZW5jZXMgPSBwcm9wZXJ0aWVzLmRpZmZlcmVuY2VzOwogIGxldCBnbHlwaHNVbmljb2RlTWFwOwogIGlmIChkaWZmZXJlbmNlcykgewogICAgZm9yIChjaGFyQ29kZSBpbiBkaWZmZXJlbmNlcykgewogICAgICBjb25zdCBnbHlwaE5hbWUgPSBkaWZmZXJlbmNlc1tjaGFyQ29kZV07CiAgICAgIGdseXBoSWQgPSBnbHlwaE5hbWVzLmluZGV4T2YoZ2x5cGhOYW1lKTsKICAgICAgaWYgKGdseXBoSWQgPT09IC0xKSB7CiAgICAgICAgaWYgKCFnbHlwaHNVbmljb2RlTWFwKSB7CiAgICAgICAgICBnbHlwaHNVbmljb2RlTWFwID0gKDAsIF9nbHlwaGxpc3QuZ2V0R2x5cGhzVW5pY29kZSkoKTsKICAgICAgICB9CiAgICAgICAgY29uc3Qgc3RhbmRhcmRHbHlwaE5hbWUgPSByZWNvdmVyR2x5cGhOYW1lKGdseXBoTmFtZSwgZ2x5cGhzVW5pY29kZU1hcCk7CiAgICAgICAgaWYgKHN0YW5kYXJkR2x5cGhOYW1lICE9PSBnbHlwaE5hbWUpIHsKICAgICAgICAgIGdseXBoSWQgPSBnbHlwaE5hbWVzLmluZGV4T2Yoc3RhbmRhcmRHbHlwaE5hbWUpOwogICAgICAgIH0KICAgICAgfQogICAgICBjaGFyQ29kZVRvR2x5cGhJZFtjaGFyQ29kZV0gPSBnbHlwaElkID49IDAgPyBnbHlwaElkIDogMDsKICAgIH0KICB9CiAgcmV0dXJuIGNoYXJDb2RlVG9HbHlwaElkOwp9CmZ1bmN0aW9uIG5vcm1hbGl6ZUZvbnROYW1lKG5hbWUpIHsKICByZXR1cm4gbmFtZS5yZXBsYWNlQWxsKC9bLF9dL2csICItIikucmVwbGFjZUFsbCgvXHMvZywgIiIpOwp9CgovKioqLyB9KSwKLyogMzkgKi8KLyoqKi8gKChfX3VudXNlZF93ZWJwYWNrX21vZHVsZSwgZXhwb3J0cywgX193X3BkZmpzX3JlcXVpcmVfXykgPT4gewoKCgpPYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgIl9fZXNNb2R1bGUiLCAoewogIHZhbHVlOiB0cnVlCn0pKTsKZXhwb3J0cy5nZXRHbHlwaHNVbmljb2RlID0gZXhwb3J0cy5nZXREaW5nYmF0c0dseXBoc1VuaWNvZGUgPSB2b2lkIDA7CnZhciBfY29yZV91dGlscyA9IF9fd19wZGZqc19yZXF1aXJlX18oMyk7CmNvbnN0IGdldEdseXBoc1VuaWNvZGUgPSAoMCwgX2NvcmVfdXRpbHMuZ2V0TG9va3VwVGFibGVGYWN0b3J5KShmdW5jdGlvbiAodCkgewogIHQuQSA9IDB4MDA0MTsKICB0LkFFID0gMHgwMGM2OwogIHQuQUVhY3V0ZSA9IDB4MDFmYzsKICB0LkFFbWFjcm9uID0gMHgwMWUyOwogIHQuQUVzbWFsbCA9IDB4ZjdlNjsKICB0LkFhY3V0ZSA9IDB4MDBjMTsKICB0LkFhY3V0ZXNtYWxsID0gMHhmN2UxOwogIHQuQWJyZXZlID0gMHgwMTAyOwogIHQuQWJyZXZlYWN1dGUgPSAweDFlYWU7CiAgdC5BYnJldmVjeXJpbGxpYyA9IDB4MDRkMDsKICB0LkFicmV2ZWRvdGJlbG93ID0gMHgxZWI2OwogIHQuQWJyZXZlZ3JhdmUgPSAweDFlYjA7CiAgdC5BYnJldmVob29rYWJvdmUgPSAweDFlYjI7CiAgdC5BYnJldmV0aWxkZSA9IDB4MWViNDsKICB0LkFjYXJvbiA9IDB4MDFjZDsKICB0LkFjaXJjbGUgPSAweDI0YjY7CiAgdC5BY2lyY3VtZmxleCA9IDB4MDBjMjsKICB0LkFjaXJjdW1mbGV4YWN1dGUgPSAweDFlYTQ7CiAgdC5BY2lyY3VtZmxleGRvdGJlbG93ID0gMHgxZWFjOwogIHQuQWNpcmN1bWZsZXhncmF2ZSA9IDB4MWVhNjsKICB0LkFjaXJjdW1mbGV4aG9va2Fib3ZlID0gMHgxZWE4OwogIHQuQWNpcmN1bWZsZXhzbWFsbCA9IDB4ZjdlMjsKICB0LkFjaXJjdW1mbGV4dGlsZGUgPSAweDFlYWE7CiAgdC5BY3V0ZSA9IDB4ZjZjOTsKICB0LkFjdXRlc21hbGwgPSAweGY3YjQ7CiAgdC5BY3lyaWxsaWMgPSAweDA0MTA7CiAgdC5BZGJsZ3JhdmUgPSAweDAyMDA7CiAgdC5BZGllcmVzaXMgPSAweDAwYzQ7CiAgdC5BZGllcmVzaXNjeXJpbGxpYyA9IDB4MDRkMjsKICB0LkFkaWVyZXNpc21hY3JvbiA9IDB4MDFkZTsKICB0LkFkaWVyZXNpc3NtYWxsID0gMHhmN2U0OwogIHQuQWRvdGJlbG93ID0gMHgxZWEwOwogIHQuQWRvdG1hY3JvbiA9IDB4MDFlMDsKICB0LkFncmF2ZSA9IDB4MDBjMDsKICB0LkFncmF2ZXNtYWxsID0gMHhmN2UwOwogIHQuQWhvb2thYm92ZSA9IDB4MWVhMjsKICB0LkFpZWN5cmlsbGljID0gMHgwNGQ0OwogIHQuQWludmVydGVkYnJldmUgPSAweDAyMDI7CiAgdC5BbHBoYSA9IDB4MDM5MTsKICB0LkFscGhhdG9ub3MgPSAweDAzODY7CiAgdC5BbWFjcm9uID0gMHgwMTAwOwogIHQuQW1vbm9zcGFjZSA9IDB4ZmYyMTsKICB0LkFvZ29uZWsgPSAweDAxMDQ7CiAgdC5BcmluZyA9IDB4MDBjNTsKICB0LkFyaW5nYWN1dGUgPSAweDAxZmE7CiAgdC5BcmluZ2JlbG93ID0gMHgxZTAwOwogIHQuQXJpbmdzbWFsbCA9IDB4ZjdlNTsKICB0LkFzbWFsbCA9IDB4Zjc2MTsKICB0LkF0aWxkZSA9IDB4MDBjMzsKICB0LkF0aWxkZXNtYWxsID0gMHhmN2UzOwogIHQuQXliYXJtZW5pYW4gPSAweDA1MzE7CiAgdC5CID0gMHgwMDQyOwogIHQuQmNpcmNsZSA9IDB4MjRiNzsKICB0LkJkb3RhY2NlbnQgPSAweDFlMDI7CiAgdC5CZG90YmVsb3cgPSAweDFlMDQ7CiAgdC5CZWN5cmlsbGljID0gMHgwNDExOwogIHQuQmVuYXJtZW5pYW4gPSAweDA1MzI7CiAgdC5CZXRhID0gMHgwMzkyOwogIHQuQmhvb2sgPSAweDAxODE7CiAgdC5CbGluZWJlbG93ID0gMHgxZTA2OwogIHQuQm1vbm9zcGFjZSA9IDB4ZmYyMjsKICB0LkJyZXZlc21hbGwgPSAweGY2ZjQ7CiAgdC5Cc21hbGwgPSAweGY3NjI7CiAgdC5CdG9wYmFyID0gMHgwMTgyOwogIHQuQyA9IDB4MDA0MzsKICB0LkNhYXJtZW5pYW4gPSAweDA1M2U7CiAgdC5DYWN1dGUgPSAweDAxMDY7CiAgdC5DYXJvbiA9IDB4ZjZjYTsKICB0LkNhcm9uc21hbGwgPSAweGY2ZjU7CiAgdC5DY2Fyb24gPSAweDAxMGM7CiAgdC5DY2VkaWxsYSA9IDB4MDBjNzsKICB0LkNjZWRpbGxhYWN1dGUgPSAweDFlMDg7CiAgdC5DY2VkaWxsYXNtYWxsID0gMHhmN2U3OwogIHQuQ2NpcmNsZSA9IDB4MjRiODsKICB0LkNjaXJjdW1mbGV4ID0gMHgwMTA4OwogIHQuQ2RvdCA9IDB4MDEwYTsKICB0LkNkb3RhY2NlbnQgPSAweDAxMGE7CiAgdC5DZWRpbGxhc21hbGwgPSAweGY3Yjg7CiAgdC5DaGFhcm1lbmlhbiA9IDB4MDU0OTsKICB0LkNoZWFia2hhc2lhbmN5cmlsbGljID0gMHgwNGJjOwogIHQuQ2hlY3lyaWxsaWMgPSAweDA0Mjc7CiAgdC5DaGVkZXNjZW5kZXJhYmtoYXNpYW5jeXJpbGxpYyA9IDB4MDRiZTsKICB0LkNoZWRlc2NlbmRlcmN5cmlsbGljID0gMHgwNGI2OwogIHQuQ2hlZGllcmVzaXNjeXJpbGxpYyA9IDB4MDRmNDsKICB0LkNoZWhhcm1lbmlhbiA9IDB4MDU0MzsKICB0LkNoZWtoYWthc3NpYW5jeXJpbGxpYyA9IDB4MDRjYjsKICB0LkNoZXZlcnRpY2Fsc3Ryb2tlY3lyaWxsaWMgPSAweDA0Yjg7CiAgdC5DaGkgPSAweDAzYTc7CiAgdC5DaG9vayA9IDB4MDE4NzsKICB0LkNpcmN1bWZsZXhzbWFsbCA9IDB4ZjZmNjsKICB0LkNtb25vc3BhY2UgPSAweGZmMjM7CiAgdC5Db2FybWVuaWFuID0gMHgwNTUxOwogIHQuQ3NtYWxsID0gMHhmNzYzOwogIHQuRCA9IDB4MDA0NDsKICB0LkRaID0gMHgwMWYxOwogIHQuRFpjYXJvbiA9IDB4MDFjNDsKICB0LkRhYXJtZW5pYW4gPSAweDA1MzQ7CiAgdC5EYWZyaWNhbiA9IDB4MDE4OTsKICB0LkRjYXJvbiA9IDB4MDEwZTsKICB0LkRjZWRpbGxhID0gMHgxZTEwOwogIHQuRGNpcmNsZSA9IDB4MjRiOTsKICB0LkRjaXJjdW1mbGV4YmVsb3cgPSAweDFlMTI7CiAgdC5EY3JvYXQgPSAweDAxMTA7CiAgdC5EZG90YWNjZW50ID0gMHgxZTBhOwogIHQuRGRvdGJlbG93ID0gMHgxZTBjOwogIHQuRGVjeXJpbGxpYyA9IDB4MDQxNDsKICB0LkRlaWNvcHRpYyA9IDB4MDNlZTsKICB0LkRlbHRhID0gMHgyMjA2OwogIHQuRGVsdGFncmVlayA9IDB4MDM5NDsKICB0LkRob29rID0gMHgwMThhOwogIHQuRGllcmVzaXMgPSAweGY2Y2I7CiAgdC5EaWVyZXNpc0FjdXRlID0gMHhmNmNjOwogIHQuRGllcmVzaXNHcmF2ZSA9IDB4ZjZjZDsKICB0LkRpZXJlc2lzc21hbGwgPSAweGY3YTg7CiAgdC5EaWdhbW1hZ3JlZWsgPSAweDAzZGM7CiAgdC5EamVjeXJpbGxpYyA9IDB4MDQwMjsKICB0LkRsaW5lYmVsb3cgPSAweDFlMGU7CiAgdC5EbW9ub3NwYWNlID0gMHhmZjI0OwogIHQuRG90YWNjZW50c21hbGwgPSAweGY2Zjc7CiAgdC5Ec2xhc2ggPSAweDAxMTA7CiAgdC5Ec21hbGwgPSAweGY3NjQ7CiAgdC5EdG9wYmFyID0gMHgwMThiOwogIHQuRHogPSAweDAxZjI7CiAgdC5EemNhcm9uID0gMHgwMWM1OwogIHQuRHplYWJraGFzaWFuY3lyaWxsaWMgPSAweDA0ZTA7CiAgdC5EemVjeXJpbGxpYyA9IDB4MDQwNTsKICB0LkR6aGVjeXJpbGxpYyA9IDB4MDQwZjsKICB0LkUgPSAweDAwNDU7CiAgdC5FYWN1dGUgPSAweDAwYzk7CiAgdC5FYWN1dGVzbWFsbCA9IDB4ZjdlOTsKICB0LkVicmV2ZSA9IDB4MDExNDsKICB0LkVjYXJvbiA9IDB4MDExYTsKICB0LkVjZWRpbGxhYnJldmUgPSAweDFlMWM7CiAgdC5FY2hhcm1lbmlhbiA9IDB4MDUzNTsKICB0LkVjaXJjbGUgPSAweDI0YmE7CiAgdC5FY2lyY3VtZmxleCA9IDB4MDBjYTsKICB0LkVjaXJjdW1mbGV4YWN1dGUgPSAweDFlYmU7CiAgdC5FY2lyY3VtZmxleGJlbG93ID0gMHgxZTE4OwogIHQuRWNpcmN1bWZsZXhkb3RiZWxvdyA9IDB4MWVjNjsKICB0LkVjaXJjdW1mbGV4Z3JhdmUgPSAweDFlYzA7CiAgdC5FY2lyY3VtZmxleGhvb2thYm92ZSA9IDB4MWVjMjsKICB0LkVjaXJjdW1mbGV4c21hbGwgPSAweGY3ZWE7CiAgdC5FY2lyY3VtZmxleHRpbGRlID0gMHgxZWM0OwogIHQuRWN5cmlsbGljID0gMHgwNDA0OwogIHQuRWRibGdyYXZlID0gMHgwMjA0OwogIHQuRWRpZXJlc2lzID0gMHgwMGNiOwogIHQuRWRpZXJlc2lzc21hbGwgPSAweGY3ZWI7CiAgdC5FZG90ID0gMHgwMTE2OwogIHQuRWRvdGFjY2VudCA9IDB4MDExNjsKICB0LkVkb3RiZWxvdyA9IDB4MWViODsKICB0LkVmY3lyaWxsaWMgPSAweDA0MjQ7CiAgdC5FZ3JhdmUgPSAweDAwYzg7CiAgdC5FZ3JhdmVzbWFsbCA9IDB4ZjdlODsKICB0LkVoYXJtZW5pYW4gPSAweDA1Mzc7CiAgdC5FaG9va2Fib3ZlID0gMHgxZWJhOwogIHQuRWlnaHRyb21hbiA9IDB4MjE2NzsKICB0LkVpbnZlcnRlZGJyZXZlID0gMHgwMjA2OwogIHQuRWlvdGlmaWVkY3lyaWxsaWMgPSAweDA0NjQ7CiAgdC5FbGN5cmlsbGljID0gMHgwNDFiOwogIHQuRWxldmVucm9tYW4gPSAweDIxNmE7CiAgdC5FbWFjcm9uID0gMHgwMTEyOwogIHQuRW1hY3JvbmFjdXRlID0gMHgxZTE2OwogIHQuRW1hY3JvbmdyYXZlID0gMHgxZTE0OwogIHQuRW1jeXJpbGxpYyA9IDB4MDQxYzsKICB0LkVtb25vc3BhY2UgPSAweGZmMjU7CiAgdC5FbmN5cmlsbGljID0gMHgwNDFkOwogIHQuRW5kZXNjZW5kZXJjeXJpbGxpYyA9IDB4MDRhMjsKICB0LkVuZyA9IDB4MDE0YTsKICB0LkVuZ2hlY3lyaWxsaWMgPSAweDA0YTQ7CiAgdC5Fbmhvb2tjeXJpbGxpYyA9IDB4MDRjNzsKICB0LkVvZ29uZWsgPSAweDAxMTg7CiAgdC5Fb3BlbiA9IDB4MDE5MDsKICB0LkVwc2lsb24gPSAweDAzOTU7CiAgdC5FcHNpbG9udG9ub3MgPSAweDAzODg7CiAgdC5FcmN5cmlsbGljID0gMHgwNDIwOwogIHQuRXJldmVyc2VkID0gMHgwMThlOwogIHQuRXJldmVyc2VkY3lyaWxsaWMgPSAweDA0MmQ7CiAgdC5Fc2N5cmlsbGljID0gMHgwNDIxOwogIHQuRXNkZXNjZW5kZXJjeXJpbGxpYyA9IDB4MDRhYTsKICB0LkVzaCA9IDB4MDFhOTsKICB0LkVzbWFsbCA9IDB4Zjc2NTsKICB0LkV0YSA9IDB4MDM5NzsKICB0LkV0YXJtZW5pYW4gPSAweDA1Mzg7CiAgdC5FdGF0b25vcyA9IDB4MDM4OTsKICB0LkV0aCA9IDB4MDBkMDsKICB0LkV0aHNtYWxsID0gMHhmN2YwOwogIHQuRXRpbGRlID0gMHgxZWJjOwogIHQuRXRpbGRlYmVsb3cgPSAweDFlMWE7CiAgdC5FdXJvID0gMHgyMGFjOwogIHQuRXpoID0gMHgwMWI3OwogIHQuRXpoY2Fyb24gPSAweDAxZWU7CiAgdC5FemhyZXZlcnNlZCA9IDB4MDFiODsKICB0LkYgPSAweDAwNDY7CiAgdC5GY2lyY2xlID0gMHgyNGJiOwogIHQuRmRvdGFjY2VudCA9IDB4MWUxZTsKICB0LkZlaGFybWVuaWFuID0gMHgwNTU2OwogIHQuRmVpY29wdGljID0gMHgwM2U0OwogIHQuRmhvb2sgPSAweDAxOTE7CiAgdC5GaXRhY3lyaWxsaWMgPSAweDA0NzI7CiAgdC5GaXZlcm9tYW4gPSAweDIxNjQ7CiAgdC5GbW9ub3NwYWNlID0gMHhmZjI2OwogIHQuRm91cnJvbWFuID0gMHgyMTYzOwogIHQuRnNtYWxsID0gMHhmNzY2OwogIHQuRyA9IDB4MDA0NzsKICB0LkdCc3F1YXJlID0gMHgzMzg3OwogIHQuR2FjdXRlID0gMHgwMWY0OwogIHQuR2FtbWEgPSAweDAzOTM7CiAgdC5HYW1tYWFmcmljYW4gPSAweDAxOTQ7CiAgdC5HYW5naWFjb3B0aWMgPSAweDAzZWE7CiAgdC5HYnJldmUgPSAweDAxMWU7CiAgdC5HY2Fyb24gPSAweDAxZTY7CiAgdC5HY2VkaWxsYSA9IDB4MDEyMjsKICB0LkdjaXJjbGUgPSAweDI0YmM7CiAgdC5HY2lyY3VtZmxleCA9IDB4MDExYzsKICB0Lkdjb21tYWFjY2VudCA9IDB4MDEyMjsKICB0Lkdkb3QgPSAweDAxMjA7CiAgdC5HZG90YWNjZW50ID0gMHgwMTIwOwogIHQuR2VjeXJpbGxpYyA9IDB4MDQxMzsKICB0LkdoYWRhcm1lbmlhbiA9IDB4MDU0MjsKICB0LkdoZW1pZGRsZWhvb2tjeXJpbGxpYyA9IDB4MDQ5NDsKICB0LkdoZXN0cm9rZWN5cmlsbGljID0gMHgwNDkyOwogIHQuR2hldXB0dXJuY3lyaWxsaWMgPSAweDA0OTA7CiAgdC5HaG9vayA9IDB4MDE5MzsKICB0LkdpbWFybWVuaWFuID0gMHgwNTMzOwogIHQuR2plY3lyaWxsaWMgPSAweDA0MDM7CiAgdC5HbWFjcm9uID0gMHgxZTIwOwogIHQuR21vbm9zcGFjZSA9IDB4ZmYyNzsKICB0LkdyYXZlID0gMHhmNmNlOwogIHQuR3JhdmVzbWFsbCA9IDB4Zjc2MDsKICB0LkdzbWFsbCA9IDB4Zjc2NzsKICB0LkdzbWFsbGhvb2sgPSAweDAyOWI7CiAgdC5Hc3Ryb2tlID0gMHgwMWU0OwogIHQuSCA9IDB4MDA0ODsKICB0LkgxODUzMyA9IDB4MjVjZjsKICB0LkgxODU0MyA9IDB4MjVhYTsKICB0LkgxODU1MSA9IDB4MjVhYjsKICB0LkgyMjA3MyA9IDB4MjVhMTsKICB0LkhQc3F1YXJlID0gMHgzM2NiOwogIHQuSGFhYmtoYXNpYW5jeXJpbGxpYyA9IDB4MDRhODsKICB0LkhhZGVzY2VuZGVyY3lyaWxsaWMgPSAweDA0YjI7CiAgdC5IYXJkc2lnbmN5cmlsbGljID0gMHgwNDJhOwogIHQuSGJhciA9IDB4MDEyNjsKICB0LkhicmV2ZWJlbG93ID0gMHgxZTJhOwogIHQuSGNlZGlsbGEgPSAweDFlMjg7CiAgdC5IY2lyY2xlID0gMHgyNGJkOwogIHQuSGNpcmN1bWZsZXggPSAweDAxMjQ7CiAgdC5IZGllcmVzaXMgPSAweDFlMjY7CiAgdC5IZG90YWNjZW50ID0gMHgxZTIyOwogIHQuSGRvdGJlbG93ID0gMHgxZTI0OwogIHQuSG1vbm9zcGFjZSA9IDB4ZmYyODsKICB0LkhvYXJtZW5pYW4gPSAweDA1NDA7CiAgdC5Ib3JpY29wdGljID0gMHgwM2U4OwogIHQuSHNtYWxsID0gMHhmNzY4OwogIHQuSHVuZ2FydW1sYXV0ID0gMHhmNmNmOwogIHQuSHVuZ2FydW1sYXV0c21hbGwgPSAweGY2Zjg7CiAgdC5IenNxdWFyZSA9IDB4MzM5MDsKICB0LkkgPSAweDAwNDk7CiAgdC5JQWN5cmlsbGljID0gMHgwNDJmOwogIHQuSUogPSAweDAxMzI7CiAgdC5JVWN5cmlsbGljID0gMHgwNDJlOwogIHQuSWFjdXRlID0gMHgwMGNkOwogIHQuSWFjdXRlc21hbGwgPSAweGY3ZWQ7CiAgdC5JYnJldmUgPSAweDAxMmM7CiAgdC5JY2Fyb24gPSAweDAxY2Y7CiAgdC5JY2lyY2xlID0gMHgyNGJlOwogIHQuSWNpcmN1bWZsZXggPSAweDAwY2U7CiAgdC5JY2lyY3VtZmxleHNtYWxsID0gMHhmN2VlOwogIHQuSWN5cmlsbGljID0gMHgwNDA2OwogIHQuSWRibGdyYXZlID0gMHgwMjA4OwogIHQuSWRpZXJlc2lzID0gMHgwMGNmOwogIHQuSWRpZXJlc2lzYWN1dGUgPSAweDFlMmU7CiAgdC5JZGllcmVzaXNjeXJpbGxpYyA9IDB4MDRlNDsKICB0LklkaWVyZXNpc3NtYWxsID0gMHhmN2VmOwogIHQuSWRvdCA9IDB4MDEzMDsKICB0Lklkb3RhY2NlbnQgPSAweDAxMzA7CiAgdC5JZG90YmVsb3cgPSAweDFlY2E7CiAgdC5JZWJyZXZlY3lyaWxsaWMgPSAweDA0ZDY7CiAgdC5JZWN5cmlsbGljID0gMHgwNDE1OwogIHQuSWZyYWt0dXIgPSAweDIxMTE7CiAgdC5JZ3JhdmUgPSAweDAwY2M7CiAgdC5JZ3JhdmVzbWFsbCA9IDB4ZjdlYzsKICB0Lklob29rYWJvdmUgPSAweDFlYzg7CiAgdC5JaWN5cmlsbGljID0gMHgwNDE4OwogIHQuSWludmVydGVkYnJldmUgPSAweDAyMGE7CiAgdC5JaXNob3J0Y3lyaWxsaWMgPSAweDA0MTk7CiAgdC5JbWFjcm9uID0gMHgwMTJhOwogIHQuSW1hY3JvbmN5cmlsbGljID0gMHgwNGUyOwogIHQuSW1vbm9zcGFjZSA9IDB4ZmYyOTsKICB0LkluaWFybWVuaWFuID0gMHgwNTNiOwogIHQuSW9jeXJpbGxpYyA9IDB4MDQwMTsKICB0LklvZ29uZWsgPSAweDAxMmU7CiAgdC5Jb3RhID0gMHgwMzk5OwogIHQuSW90YWFmcmljYW4gPSAweDAxOTY7CiAgdC5Jb3RhZGllcmVzaXMgPSAweDAzYWE7CiAgdC5Jb3RhdG9ub3MgPSAweDAzOGE7CiAgdC5Jc21hbGwgPSAweGY3Njk7CiAgdC5Jc3Ryb2tlID0gMHgwMTk3OwogIHQuSXRpbGRlID0gMHgwMTI4OwogIHQuSXRpbGRlYmVsb3cgPSAweDFlMmM7CiAgdC5JemhpdHNhY3lyaWxsaWMgPSAweDA0NzQ7CiAgdC5JemhpdHNhZGJsZ3JhdmVjeXJpbGxpYyA9IDB4MDQ3NjsKICB0LkogPSAweDAwNGE7CiAgdC5KYWFybWVuaWFuID0gMHgwNTQxOwogIHQuSmNpcmNsZSA9IDB4MjRiZjsKICB0LkpjaXJjdW1mbGV4ID0gMHgwMTM0OwogIHQuSmVjeXJpbGxpYyA9IDB4MDQwODsKICB0LkpoZWhhcm1lbmlhbiA9IDB4MDU0YjsKICB0Lkptb25vc3BhY2UgPSAweGZmMmE7CiAgdC5Kc21hbGwgPSAweGY3NmE7CiAgdC5LID0gMHgwMDRiOwogIHQuS0JzcXVhcmUgPSAweDMzODU7CiAgdC5LS3NxdWFyZSA9IDB4MzNjZDsKICB0LkthYmFzaGtpcmN5cmlsbGljID0gMHgwNGEwOwogIHQuS2FjdXRlID0gMHgxZTMwOwogIHQuS2FjeXJpbGxpYyA9IDB4MDQxYTsKICB0LkthZGVzY2VuZGVyY3lyaWxsaWMgPSAweDA0OWE7CiAgdC5LYWhvb2tjeXJpbGxpYyA9IDB4MDRjMzsKICB0LkthcHBhID0gMHgwMzlhOwogIHQuS2FzdHJva2VjeXJpbGxpYyA9IDB4MDQ5ZTsKICB0LkthdmVydGljYWxzdHJva2VjeXJpbGxpYyA9IDB4MDQ5YzsKICB0LktjYXJvbiA9IDB4MDFlODsKICB0LktjZWRpbGxhID0gMHgwMTM2OwogIHQuS2NpcmNsZSA9IDB4MjRjMDsKICB0Lktjb21tYWFjY2VudCA9IDB4MDEzNjsKICB0Lktkb3RiZWxvdyA9IDB4MWUzMjsKICB0LktlaGFybWVuaWFuID0gMHgwNTU0OwogIHQuS2VuYXJtZW5pYW4gPSAweDA1M2Y7CiAgdC5LaGFjeXJpbGxpYyA9IDB4MDQyNTsKICB0LktoZWljb3B0aWMgPSAweDAzZTY7CiAgdC5LaG9vayA9IDB4MDE5ODsKICB0LktqZWN5cmlsbGljID0gMHgwNDBjOwogIHQuS2xpbmViZWxvdyA9IDB4MWUzNDsKICB0Lkttb25vc3BhY2UgPSAweGZmMmI7CiAgdC5Lb3BwYWN5cmlsbGljID0gMHgwNDgwOwogIHQuS29wcGFncmVlayA9IDB4MDNkZTsKICB0LktzaWN5cmlsbGljID0gMHgwNDZlOwogIHQuS3NtYWxsID0gMHhmNzZiOwogIHQuTCA9IDB4MDA0YzsKICB0LkxKID0gMHgwMWM3OwogIHQuTEwgPSAweGY2YmY7CiAgdC5MYWN1dGUgPSAweDAxMzk7CiAgdC5MYW1iZGEgPSAweDAzOWI7CiAgdC5MY2Fyb24gPSAweDAxM2Q7CiAgdC5MY2VkaWxsYSA9IDB4MDEzYjsKICB0LkxjaXJjbGUgPSAweDI0YzE7CiAgdC5MY2lyY3VtZmxleGJlbG93ID0gMHgxZTNjOwogIHQuTGNvbW1hYWNjZW50ID0gMHgwMTNiOwogIHQuTGRvdCA9IDB4MDEzZjsKICB0Lkxkb3RhY2NlbnQgPSAweDAxM2Y7CiAgdC5MZG90YmVsb3cgPSAweDFlMzY7CiAgdC5MZG90YmVsb3dtYWNyb24gPSAweDFlMzg7CiAgdC5MaXduYXJtZW5pYW4gPSAweDA1M2M7CiAgdC5MaiA9IDB4MDFjODsKICB0LkxqZWN5cmlsbGljID0gMHgwNDA5OwogIHQuTGxpbmViZWxvdyA9IDB4MWUzYTsKICB0Lkxtb25vc3BhY2UgPSAweGZmMmM7CiAgdC5Mc2xhc2ggPSAweDAxNDE7CiAgdC5Mc2xhc2hzbWFsbCA9IDB4ZjZmOTsKICB0LkxzbWFsbCA9IDB4Zjc2YzsKICB0Lk0gPSAweDAwNGQ7CiAgdC5NQnNxdWFyZSA9IDB4MzM4NjsKICB0Lk1hY3JvbiA9IDB4ZjZkMDsKICB0Lk1hY3JvbnNtYWxsID0gMHhmN2FmOwogIHQuTWFjdXRlID0gMHgxZTNlOwogIHQuTWNpcmNsZSA9IDB4MjRjMjsKICB0Lk1kb3RhY2NlbnQgPSAweDFlNDA7CiAgdC5NZG90YmVsb3cgPSAweDFlNDI7CiAgdC5NZW5hcm1lbmlhbiA9IDB4MDU0NDsKICB0Lk1tb25vc3BhY2UgPSAweGZmMmQ7CiAgdC5Nc21hbGwgPSAweGY3NmQ7CiAgdC5NdHVybmVkID0gMHgwMTljOwogIHQuTXUgPSAweDAzOWM7CiAgdC5OID0gMHgwMDRlOwogIHQuTkogPSAweDAxY2E7CiAgdC5OYWN1dGUgPSAweDAxNDM7CiAgdC5OY2Fyb24gPSAweDAxNDc7CiAgdC5OY2VkaWxsYSA9IDB4MDE0NTsKICB0Lk5jaXJjbGUgPSAweDI0YzM7CiAgdC5OY2lyY3VtZmxleGJlbG93ID0gMHgxZTRhOwogIHQuTmNvbW1hYWNjZW50ID0gMHgwMTQ1OwogIHQuTmRvdGFjY2VudCA9IDB4MWU0NDsKICB0Lk5kb3RiZWxvdyA9IDB4MWU0NjsKICB0Lk5ob29rbGVmdCA9IDB4MDE5ZDsKICB0Lk5pbmVyb21hbiA9IDB4MjE2ODsKICB0Lk5qID0gMHgwMWNiOwogIHQuTmplY3lyaWxsaWMgPSAweDA0MGE7CiAgdC5ObGluZWJlbG93ID0gMHgxZTQ4OwogIHQuTm1vbm9zcGFjZSA9IDB4ZmYyZTsKICB0Lk5vd2FybWVuaWFuID0gMHgwNTQ2OwogIHQuTnNtYWxsID0gMHhmNzZlOwogIHQuTnRpbGRlID0gMHgwMGQxOwogIHQuTnRpbGRlc21hbGwgPSAweGY3ZjE7CiAgdC5OdSA9IDB4MDM5ZDsKICB0Lk8gPSAweDAwNGY7CiAgdC5PRSA9IDB4MDE1MjsKICB0Lk9Fc21hbGwgPSAweGY2ZmE7CiAgdC5PYWN1dGUgPSAweDAwZDM7CiAgdC5PYWN1dGVzbWFsbCA9IDB4ZjdmMzsKICB0Lk9iYXJyZWRjeXJpbGxpYyA9IDB4MDRlODsKICB0Lk9iYXJyZWRkaWVyZXNpc2N5cmlsbGljID0gMHgwNGVhOwogIHQuT2JyZXZlID0gMHgwMTRlOwogIHQuT2Nhcm9uID0gMHgwMWQxOwogIHQuT2NlbnRlcmVkdGlsZGUgPSAweDAxOWY7CiAgdC5PY2lyY2xlID0gMHgyNGM0OwogIHQuT2NpcmN1bWZsZXggPSAweDAwZDQ7CiAgdC5PY2lyY3VtZmxleGFjdXRlID0gMHgxZWQwOwogIHQuT2NpcmN1bWZsZXhkb3RiZWxvdyA9IDB4MWVkODsKICB0Lk9jaXJjdW1mbGV4Z3JhdmUgPSAweDFlZDI7CiAgdC5PY2lyY3VtZmxleGhvb2thYm92ZSA9IDB4MWVkNDsKICB0Lk9jaXJjdW1mbGV4c21hbGwgPSAweGY3ZjQ7CiAgdC5PY2lyY3VtZmxleHRpbGRlID0gMHgxZWQ2OwogIHQuT2N5cmlsbGljID0gMHgwNDFlOwogIHQuT2RibGFjdXRlID0gMHgwMTUwOwogIHQuT2RibGdyYXZlID0gMHgwMjBjOwogIHQuT2RpZXJlc2lzID0gMHgwMGQ2OwogIHQuT2RpZXJlc2lzY3lyaWxsaWMgPSAweDA0ZTY7CiAgdC5PZGllcmVzaXNzbWFsbCA9IDB4ZjdmNjsKICB0Lk9kb3RiZWxvdyA9IDB4MWVjYzsKICB0Lk9nb25la3NtYWxsID0gMHhmNmZiOwogIHQuT2dyYXZlID0gMHgwMGQyOwogIHQuT2dyYXZlc21hbGwgPSAweGY3ZjI7CiAgdC5PaGFybWVuaWFuID0gMHgwNTU1OwogIHQuT2htID0gMHgyMTI2OwogIHQuT2hvb2thYm92ZSA9IDB4MWVjZTsKICB0Lk9ob3JuID0gMHgwMWEwOwogIHQuT2hvcm5hY3V0ZSA9IDB4MWVkYTsKICB0Lk9ob3JuZG90YmVsb3cgPSAweDFlZTI7CiAgdC5PaG9ybmdyYXZlID0gMHgxZWRjOwogIHQuT2hvcm5ob29rYWJvdmUgPSAweDFlZGU7CiAgdC5PaG9ybnRpbGRlID0gMHgxZWUwOwogIHQuT2h1bmdhcnVtbGF1dCA9IDB4MDE1MDsKICB0Lk9pID0gMHgwMWEyOwogIHQuT2ludmVydGVkYnJldmUgPSAweDAyMGU7CiAgdC5PbWFjcm9uID0gMHgwMTRjOwogIHQuT21hY3JvbmFjdXRlID0gMHgxZTUyOwogIHQuT21hY3JvbmdyYXZlID0gMHgxZTUwOwogIHQuT21lZ2EgPSAweDIxMjY7CiAgdC5PbWVnYWN5cmlsbGljID0gMHgwNDYwOwogIHQuT21lZ2FncmVlayA9IDB4MDNhOTsKICB0Lk9tZWdhcm91bmRjeXJpbGxpYyA9IDB4MDQ3YTsKICB0Lk9tZWdhdGl0bG9jeXJpbGxpYyA9IDB4MDQ3YzsKICB0Lk9tZWdhdG9ub3MgPSAweDAzOGY7CiAgdC5PbWljcm9uID0gMHgwMzlmOwogIHQuT21pY3JvbnRvbm9zID0gMHgwMzhjOwogIHQuT21vbm9zcGFjZSA9IDB4ZmYyZjsKICB0Lk9uZXJvbWFuID0gMHgyMTYwOwogIHQuT29nb25layA9IDB4MDFlYTsKICB0Lk9vZ29uZWttYWNyb24gPSAweDAxZWM7CiAgdC5Pb3BlbiA9IDB4MDE4NjsKICB0Lk9zbGFzaCA9IDB4MDBkODsKICB0Lk9zbGFzaGFjdXRlID0gMHgwMWZlOwogIHQuT3NsYXNoc21hbGwgPSAweGY3Zjg7CiAgdC5Pc21hbGwgPSAweGY3NmY7CiAgdC5Pc3Ryb2tlYWN1dGUgPSAweDAxZmU7CiAgdC5PdGN5cmlsbGljID0gMHgwNDdlOwogIHQuT3RpbGRlID0gMHgwMGQ1OwogIHQuT3RpbGRlYWN1dGUgPSAweDFlNGM7CiAgdC5PdGlsZGVkaWVyZXNpcyA9IDB4MWU0ZTsKICB0Lk90aWxkZXNtYWxsID0gMHhmN2Y1OwogIHQuUCA9IDB4MDA1MDsKICB0LlBhY3V0ZSA9IDB4MWU1NDsKICB0LlBjaXJjbGUgPSAweDI0YzU7CiAgdC5QZG90YWNjZW50ID0gMHgxZTU2OwogIHQuUGVjeXJpbGxpYyA9IDB4MDQxZjsKICB0LlBlaGFybWVuaWFuID0gMHgwNTRhOwogIHQuUGVtaWRkbGVob29rY3lyaWxsaWMgPSAweDA0YTY7CiAgdC5QaGkgPSAweDAzYTY7CiAgdC5QaG9vayA9IDB4MDFhNDsKICB0LlBpID0gMHgwM2EwOwogIHQuUGl3cmFybWVuaWFuID0gMHgwNTUzOwogIHQuUG1vbm9zcGFjZSA9IDB4ZmYzMDsKICB0LlBzaSA9IDB4MDNhODsKICB0LlBzaWN5cmlsbGljID0gMHgwNDcwOwogIHQuUHNtYWxsID0gMHhmNzcwOwogIHQuUSA9IDB4MDA1MTsKICB0LlFjaXJjbGUgPSAweDI0YzY7CiAgdC5RbW9ub3NwYWNlID0gMHhmZjMxOwogIHQuUXNtYWxsID0gMHhmNzcxOwogIHQuUiA9IDB4MDA1MjsKICB0LlJhYXJtZW5pYW4gPSAweDA1NGM7CiAgdC5SYWN1dGUgPSAweDAxNTQ7CiAgdC5SY2Fyb24gPSAweDAxNTg7CiAgdC5SY2VkaWxsYSA9IDB4MDE1NjsKICB0LlJjaXJjbGUgPSAweDI0Yzc7CiAgdC5SY29tbWFhY2NlbnQgPSAweDAxNTY7CiAgdC5SZGJsZ3JhdmUgPSAweDAyMTA7CiAgdC5SZG90YWNjZW50ID0gMHgxZTU4OwogIHQuUmRvdGJlbG93ID0gMHgxZTVhOwogIHQuUmRvdGJlbG93bWFjcm9uID0gMHgxZTVjOwogIHQuUmVoYXJtZW5pYW4gPSAweDA1NTA7CiAgdC5SZnJha3R1ciA9IDB4MjExYzsKICB0LlJobyA9IDB4MDNhMTsKICB0LlJpbmdzbWFsbCA9IDB4ZjZmYzsKICB0LlJpbnZlcnRlZGJyZXZlID0gMHgwMjEyOwogIHQuUmxpbmViZWxvdyA9IDB4MWU1ZTsKICB0LlJtb25vc3BhY2UgPSAweGZmMzI7CiAgdC5Sc21hbGwgPSAweGY3NzI7CiAgdC5Sc21hbGxpbnZlcnRlZCA9IDB4MDI4MTsKICB0LlJzbWFsbGludmVydGVkc3VwZXJpb3IgPSAweDAyYjY7CiAgdC5TID0gMHgwMDUzOwogIHQuU0YwMTAwMDAgPSAweDI1MGM7CiAgdC5TRjAyMDAwMCA9IDB4MjUxNDsKICB0LlNGMDMwMDAwID0gMHgyNTEwOwogIHQuU0YwNDAwMDAgPSAweDI1MTg7CiAgdC5TRjA1MDAwMCA9IDB4MjUzYzsKICB0LlNGMDYwMDAwID0gMHgyNTJjOwogIHQuU0YwNzAwMDAgPSAweDI1MzQ7CiAgdC5TRjA4MDAwMCA9IDB4MjUxYzsKICB0LlNGMDkwMDAwID0gMHgyNTI0OwogIHQuU0YxMDAwMDAgPSAweDI1MDA7CiAgdC5TRjExMDAwMCA9IDB4MjUwMjsKICB0LlNGMTkwMDAwID0gMHgyNTYxOwogIHQuU0YyMDAwMDAgPSAweDI1NjI7CiAgdC5TRjIxMDAwMCA9IDB4MjU1NjsKICB0LlNGMjIwMDAwID0gMHgyNTU1OwogIHQuU0YyMzAwMDAgPSAweDI1NjM7CiAgdC5TRjI0MDAwMCA9IDB4MjU1MTsKICB0LlNGMjUwMDAwID0gMHgyNTU3OwogIHQuU0YyNjAwMDAgPSAweDI1NWQ7CiAgdC5TRjI3MDAwMCA9IDB4MjU1YzsKICB0LlNGMjgwMDAwID0gMHgyNTViOwogIHQuU0YzNjAwMDAgPSAweDI1NWU7CiAgdC5TRjM3MDAwMCA9IDB4MjU1ZjsKICB0LlNGMzgwMDAwID0gMHgyNTVhOwogIHQuU0YzOTAwMDAgPSAweDI1NTQ7CiAgdC5TRjQwMDAwMCA9IDB4MjU2OTsKICB0LlNGNDEwMDAwID0gMHgyNTY2OwogIHQuU0Y0MjAwMDAgPSAweDI1NjA7CiAgdC5TRjQzMDAwMCA9IDB4MjU1MDsKICB0LlNGNDQwMDAwID0gMHgyNTZjOwogIHQuU0Y0NTAwMDAgPSAweDI1Njc7CiAgdC5TRjQ2MDAwMCA9IDB4MjU2ODsKICB0LlNGNDcwMDAwID0gMHgyNTY0OwogIHQuU0Y0ODAwMDAgPSAweDI1NjU7CiAgdC5TRjQ5MDAwMCA9IDB4MjU1OTsKICB0LlNGNTAwMDAwID0gMHgyNTU4OwogIHQuU0Y1MTAwMDAgPSAweDI1NTI7CiAgdC5TRjUyMDAwMCA9IDB4MjU1MzsKICB0LlNGNTMwMDAwID0gMHgyNTZiOwogIHQuU0Y1NDAwMDAgPSAweDI1NmE7CiAgdC5TYWN1dGUgPSAweDAxNWE7CiAgdC5TYWN1dGVkb3RhY2NlbnQgPSAweDFlNjQ7CiAgdC5TYW1waWdyZWVrID0gMHgwM2UwOwogIHQuU2Nhcm9uID0gMHgwMTYwOwogIHQuU2Nhcm9uZG90YWNjZW50ID0gMHgxZTY2OwogIHQuU2Nhcm9uc21hbGwgPSAweGY2ZmQ7CiAgdC5TY2VkaWxsYSA9IDB4MDE1ZTsKICB0LlNjaHdhID0gMHgwMThmOwogIHQuU2Nod2FjeXJpbGxpYyA9IDB4MDRkODsKICB0LlNjaHdhZGllcmVzaXNjeXJpbGxpYyA9IDB4MDRkYTsKICB0LlNjaXJjbGUgPSAweDI0Yzg7CiAgdC5TY2lyY3VtZmxleCA9IDB4MDE1YzsKICB0LlNjb21tYWFjY2VudCA9IDB4MDIxODsKICB0LlNkb3RhY2NlbnQgPSAweDFlNjA7CiAgdC5TZG90YmVsb3cgPSAweDFlNjI7CiAgdC5TZG90YmVsb3dkb3RhY2NlbnQgPSAweDFlNjg7CiAgdC5TZWhhcm1lbmlhbiA9IDB4MDU0ZDsKICB0LlNldmVucm9tYW4gPSAweDIxNjY7CiAgdC5TaGFhcm1lbmlhbiA9IDB4MDU0NzsKICB0LlNoYWN5cmlsbGljID0gMHgwNDI4OwogIHQuU2hjaGFjeXJpbGxpYyA9IDB4MDQyOTsKICB0LlNoZWljb3B0aWMgPSAweDAzZTI7CiAgdC5TaGhhY3lyaWxsaWMgPSAweDA0YmE7CiAgdC5TaGltYWNvcHRpYyA9IDB4MDNlYzsKICB0LlNpZ21hID0gMHgwM2EzOwogIHQuU2l4cm9tYW4gPSAweDIxNjU7CiAgdC5TbW9ub3NwYWNlID0gMHhmZjMzOwogIHQuU29mdHNpZ25jeXJpbGxpYyA9IDB4MDQyYzsKICB0LlNzbWFsbCA9IDB4Zjc3MzsKICB0LlN0aWdtYWdyZWVrID0gMHgwM2RhOwogIHQuVCA9IDB4MDA1NDsKICB0LlRhdSA9IDB4MDNhNDsKICB0LlRiYXIgPSAweDAxNjY7CiAgdC5UY2Fyb24gPSAweDAxNjQ7CiAgdC5UY2VkaWxsYSA9IDB4MDE2MjsKICB0LlRjaXJjbGUgPSAweDI0Yzk7CiAgdC5UY2lyY3VtZmxleGJlbG93ID0gMHgxZTcwOwogIHQuVGNvbW1hYWNjZW50ID0gMHgwMTYyOwogIHQuVGRvdGFjY2VudCA9IDB4MWU2YTsKICB0LlRkb3RiZWxvdyA9IDB4MWU2YzsKICB0LlRlY3lyaWxsaWMgPSAweDA0MjI7CiAgdC5UZWRlc2NlbmRlcmN5cmlsbGljID0gMHgwNGFjOwogIHQuVGVucm9tYW4gPSAweDIxNjk7CiAgdC5UZXRzZWN5cmlsbGljID0gMHgwNGI0OwogIHQuVGhldGEgPSAweDAzOTg7CiAgdC5UaG9vayA9IDB4MDFhYzsKICB0LlRob3JuID0gMHgwMGRlOwogIHQuVGhvcm5zbWFsbCA9IDB4ZjdmZTsKICB0LlRocmVlcm9tYW4gPSAweDIxNjI7CiAgdC5UaWxkZXNtYWxsID0gMHhmNmZlOwogIHQuVGl3bmFybWVuaWFuID0gMHgwNTRmOwogIHQuVGxpbmViZWxvdyA9IDB4MWU2ZTsKICB0LlRtb25vc3BhY2UgPSAweGZmMzQ7CiAgdC5Ub2FybWVuaWFuID0gMHgwNTM5OwogIHQuVG9uZWZpdmUgPSAweDAxYmM7CiAgdC5Ub25lc2l4ID0gMHgwMTg0OwogIHQuVG9uZXR3byA9IDB4MDFhNzsKICB0LlRyZXRyb2ZsZXhob29rID0gMHgwMWFlOwogIHQuVHNlY3lyaWxsaWMgPSAweDA0MjY7CiAgdC5Uc2hlY3lyaWxsaWMgPSAweDA0MGI7CiAgdC5Uc21hbGwgPSAweGY3NzQ7CiAgdC5Ud2VsdmVyb21hbiA9IDB4MjE2YjsKICB0LlR3b3JvbWFuID0gMHgyMTYxOwogIHQuVSA9IDB4MDA1NTsKICB0LlVhY3V0ZSA9IDB4MDBkYTsKICB0LlVhY3V0ZXNtYWxsID0gMHhmN2ZhOwogIHQuVWJyZXZlID0gMHgwMTZjOwogIHQuVWNhcm9uID0gMHgwMWQzOwogIHQuVWNpcmNsZSA9IDB4MjRjYTsKICB0LlVjaXJjdW1mbGV4ID0gMHgwMGRiOwogIHQuVWNpcmN1bWZsZXhiZWxvdyA9IDB4MWU3NjsKICB0LlVjaXJjdW1mbGV4c21hbGwgPSAweGY3ZmI7CiAgdC5VY3lyaWxsaWMgPSAweDA0MjM7CiAgdC5VZGJsYWN1dGUgPSAweDAxNzA7CiAgdC5VZGJsZ3JhdmUgPSAweDAyMTQ7CiAgdC5VZGllcmVzaXMgPSAweDAwZGM7CiAgdC5VZGllcmVzaXNhY3V0ZSA9IDB4MDFkNzsKICB0LlVkaWVyZXNpc2JlbG93ID0gMHgxZTcyOwogIHQuVWRpZXJlc2lzY2Fyb24gPSAweDAxZDk7CiAgdC5VZGllcmVzaXNjeXJpbGxpYyA9IDB4MDRmMDsKICB0LlVkaWVyZXNpc2dyYXZlID0gMHgwMWRiOwogIHQuVWRpZXJlc2lzbWFjcm9uID0gMHgwMWQ1OwogIHQuVWRpZXJlc2lzc21hbGwgPSAweGY3ZmM7CiAgdC5VZG90YmVsb3cgPSAweDFlZTQ7CiAgdC5VZ3JhdmUgPSAweDAwZDk7CiAgdC5VZ3JhdmVzbWFsbCA9IDB4ZjdmOTsKICB0LlVob29rYWJvdmUgPSAweDFlZTY7CiAgdC5VaG9ybiA9IDB4MDFhZjsKICB0LlVob3JuYWN1dGUgPSAweDFlZTg7CiAgdC5VaG9ybmRvdGJlbG93ID0gMHgxZWYwOwogIHQuVWhvcm5ncmF2ZSA9IDB4MWVlYTsKICB0LlVob3JuaG9va2Fib3ZlID0gMHgxZWVjOwogIHQuVWhvcm50aWxkZSA9IDB4MWVlZTsKICB0LlVodW5nYXJ1bWxhdXQgPSAweDAxNzA7CiAgdC5VaHVuZ2FydW1sYXV0Y3lyaWxsaWMgPSAweDA0ZjI7CiAgdC5VaW52ZXJ0ZWRicmV2ZSA9IDB4MDIxNjsKICB0LlVrY3lyaWxsaWMgPSAweDA0Nzg7CiAgdC5VbWFjcm9uID0gMHgwMTZhOwogIHQuVW1hY3JvbmN5cmlsbGljID0gMHgwNGVlOwogIHQuVW1hY3JvbmRpZXJlc2lzID0gMHgxZTdhOwogIHQuVW1vbm9zcGFjZSA9IDB4ZmYzNTsKICB0LlVvZ29uZWsgPSAweDAxNzI7CiAgdC5VcHNpbG9uID0gMHgwM2E1OwogIHQuVXBzaWxvbjEgPSAweDAzZDI7CiAgdC5VcHNpbG9uYWN1dGVob29rc3ltYm9sZ3JlZWsgPSAweDAzZDM7CiAgdC5VcHNpbG9uYWZyaWNhbiA9IDB4MDFiMTsKICB0LlVwc2lsb25kaWVyZXNpcyA9IDB4MDNhYjsKICB0LlVwc2lsb25kaWVyZXNpc2hvb2tzeW1ib2xncmVlayA9IDB4MDNkNDsKICB0LlVwc2lsb25ob29rc3ltYm9sID0gMHgwM2QyOwogIHQuVXBzaWxvbnRvbm9zID0gMHgwMzhlOwogIHQuVXJpbmcgPSAweDAxNmU7CiAgdC5Vc2hvcnRjeXJpbGxpYyA9IDB4MDQwZTsKICB0LlVzbWFsbCA9IDB4Zjc3NTsKICB0LlVzdHJhaWdodGN5cmlsbGljID0gMHgwNGFlOwogIHQuVXN0cmFpZ2h0c3Ryb2tlY3lyaWxsaWMgPSAweDA0YjA7CiAgdC5VdGlsZGUgPSAweDAxNjg7CiAgdC5VdGlsZGVhY3V0ZSA9IDB4MWU3ODsKICB0LlV0aWxkZWJlbG93ID0gMHgxZTc0OwogIHQuViA9IDB4MDA1NjsKICB0LlZjaXJjbGUgPSAweDI0Y2I7CiAgdC5WZG90YmVsb3cgPSAweDFlN2U7CiAgdC5WZWN5cmlsbGljID0gMHgwNDEyOwogIHQuVmV3YXJtZW5pYW4gPSAweDA1NGU7CiAgdC5WaG9vayA9IDB4MDFiMjsKICB0LlZtb25vc3BhY2UgPSAweGZmMzY7CiAgdC5Wb2FybWVuaWFuID0gMHgwNTQ4OwogIHQuVnNtYWxsID0gMHhmNzc2OwogIHQuVnRpbGRlID0gMHgxZTdjOwogIHQuVyA9IDB4MDA1NzsKICB0LldhY3V0ZSA9IDB4MWU4MjsKICB0LldjaXJjbGUgPSAweDI0Y2M7CiAgdC5XY2lyY3VtZmxleCA9IDB4MDE3NDsKICB0LldkaWVyZXNpcyA9IDB4MWU4NDsKICB0Lldkb3RhY2NlbnQgPSAweDFlODY7CiAgdC5XZG90YmVsb3cgPSAweDFlODg7CiAgdC5XZ3JhdmUgPSAweDFlODA7CiAgdC5XbW9ub3NwYWNlID0gMHhmZjM3OwogIHQuV3NtYWxsID0gMHhmNzc3OwogIHQuWCA9IDB4MDA1ODsKICB0LlhjaXJjbGUgPSAweDI0Y2Q7CiAgdC5YZGllcmVzaXMgPSAweDFlOGM7CiAgdC5YZG90YWNjZW50ID0gMHgxZThhOwogIHQuWGVoYXJtZW5pYW4gPSAweDA1M2Q7CiAgdC5YaSA9IDB4MDM5ZTsKICB0Llhtb25vc3BhY2UgPSAweGZmMzg7CiAgdC5Yc21hbGwgPSAweGY3Nzg7CiAgdC5ZID0gMHgwMDU5OwogIHQuWWFjdXRlID0gMHgwMGRkOwogIHQuWWFjdXRlc21hbGwgPSAweGY3ZmQ7CiAgdC5ZYXRjeXJpbGxpYyA9IDB4MDQ2MjsKICB0LlljaXJjbGUgPSAweDI0Y2U7CiAgdC5ZY2lyY3VtZmxleCA9IDB4MDE3NjsKICB0LllkaWVyZXNpcyA9IDB4MDE3ODsKICB0LllkaWVyZXNpc3NtYWxsID0gMHhmN2ZmOwogIHQuWWRvdGFjY2VudCA9IDB4MWU4ZTsKICB0Lllkb3RiZWxvdyA9IDB4MWVmNDsKICB0LlllcmljeXJpbGxpYyA9IDB4MDQyYjsKICB0LlllcnVkaWVyZXNpc2N5cmlsbGljID0gMHgwNGY4OwogIHQuWWdyYXZlID0gMHgxZWYyOwogIHQuWWhvb2sgPSAweDAxYjM7CiAgdC5ZaG9va2Fib3ZlID0gMHgxZWY2OwogIHQuWWlhcm1lbmlhbiA9IDB4MDU0NTsKICB0LllpY3lyaWxsaWMgPSAweDA0MDc7CiAgdC5ZaXduYXJtZW5pYW4gPSAweDA1NTI7CiAgdC5ZbW9ub3NwYWNlID0gMHhmZjM5OwogIHQuWXNtYWxsID0gMHhmNzc5OwogIHQuWXRpbGRlID0gMHgxZWY4OwogIHQuWXVzYmlnY3lyaWxsaWMgPSAweDA0NmE7CiAgdC5ZdXNiaWdpb3RpZmllZGN5cmlsbGljID0gMHgwNDZjOwogIHQuWXVzbGl0dGxlY3lyaWxsaWMgPSAweDA0NjY7CiAgdC5ZdXNsaXR0bGVpb3RpZmllZGN5cmlsbGljID0gMHgwNDY4OwogIHQuWiA9IDB4MDA1YTsKICB0LlphYXJtZW5pYW4gPSAweDA1MzY7CiAgdC5aYWN1dGUgPSAweDAxNzk7CiAgdC5aY2Fyb24gPSAweDAxN2Q7CiAgdC5aY2Fyb25zbWFsbCA9IDB4ZjZmZjsKICB0LlpjaXJjbGUgPSAweDI0Y2Y7CiAgdC5aY2lyY3VtZmxleCA9IDB4MWU5MDsKICB0Llpkb3QgPSAweDAxN2I7CiAgdC5aZG90YWNjZW50ID0gMHgwMTdiOwogIHQuWmRvdGJlbG93ID0gMHgxZTkyOwogIHQuWmVjeXJpbGxpYyA9IDB4MDQxNzsKICB0LlplZGVzY2VuZGVyY3lyaWxsaWMgPSAweDA0OTg7CiAgdC5aZWRpZXJlc2lzY3lyaWxsaWMgPSAweDA0ZGU7CiAgdC5aZXRhID0gMHgwMzk2OwogIHQuWmhlYXJtZW5pYW4gPSAweDA1M2E7CiAgdC5aaGVicmV2ZWN5cmlsbGljID0gMHgwNGMxOwogIHQuWmhlY3lyaWxsaWMgPSAweDA0MTY7CiAgdC5aaGVkZXNjZW5kZXJjeXJpbGxpYyA9IDB4MDQ5NjsKICB0LlpoZWRpZXJlc2lzY3lyaWxsaWMgPSAweDA0ZGM7CiAgdC5abGluZWJlbG93ID0gMHgxZTk0OwogIHQuWm1vbm9zcGFjZSA9IDB4ZmYzYTsKICB0LlpzbWFsbCA9IDB4Zjc3YTsKICB0LlpzdHJva2UgPSAweDAxYjU7CiAgdC5hID0gMHgwMDYxOwogIHQuYWFiZW5nYWxpID0gMHgwOTg2OwogIHQuYWFjdXRlID0gMHgwMGUxOwogIHQuYWFkZXZhID0gMHgwOTA2OwogIHQuYWFndWphcmF0aSA9IDB4MGE4NjsKICB0LmFhZ3VybXVraGkgPSAweDBhMDY7CiAgdC5hYW1hdHJhZ3VybXVraGkgPSAweDBhM2U7CiAgdC5hYXJ1c3F1YXJlID0gMHgzMzAzOwogIHQuYWF2b3dlbHNpZ25iZW5nYWxpID0gMHgwOWJlOwogIHQuYWF2b3dlbHNpZ25kZXZhID0gMHgwOTNlOwogIHQuYWF2b3dlbHNpZ25ndWphcmF0aSA9IDB4MGFiZTsKICB0LmFiYnJldmlhdGlvbm1hcmthcm1lbmlhbiA9IDB4MDU1ZjsKICB0LmFiYnJldmlhdGlvbnNpZ25kZXZhID0gMHgwOTcwOwogIHQuYWJlbmdhbGkgPSAweDA5ODU7CiAgdC5hYm9wb21vZm8gPSAweDMxMWE7CiAgdC5hYnJldmUgPSAweDAxMDM7CiAgdC5hYnJldmVhY3V0ZSA9IDB4MWVhZjsKICB0LmFicmV2ZWN5cmlsbGljID0gMHgwNGQxOwogIHQuYWJyZXZlZG90YmVsb3cgPSAweDFlYjc7CiAgdC5hYnJldmVncmF2ZSA9IDB4MWViMTsKICB0LmFicmV2ZWhvb2thYm92ZSA9IDB4MWViMzsKICB0LmFicmV2ZXRpbGRlID0gMHgxZWI1OwogIHQuYWNhcm9uID0gMHgwMWNlOwogIHQuYWNpcmNsZSA9IDB4MjRkMDsKICB0LmFjaXJjdW1mbGV4ID0gMHgwMGUyOwogIHQuYWNpcmN1bWZsZXhhY3V0ZSA9IDB4MWVhNTsKICB0LmFjaXJjdW1mbGV4ZG90YmVsb3cgPSAweDFlYWQ7CiAgdC5hY2lyY3VtZmxleGdyYXZlID0gMHgxZWE3OwogIHQuYWNpcmN1bWZsZXhob29rYWJvdmUgPSAweDFlYTk7CiAgdC5hY2lyY3VtZmxleHRpbGRlID0gMHgxZWFiOwogIHQuYWN1dGUgPSAweDAwYjQ7CiAgdC5hY3V0ZWJlbG93Y21iID0gMHgwMzE3OwogIHQuYWN1dGVjbWIgPSAweDAzMDE7CiAgdC5hY3V0ZWNvbWIgPSAweDAzMDE7CiAgdC5hY3V0ZWRldmEgPSAweDA5NTQ7CiAgdC5hY3V0ZWxvd21vZCA9IDB4MDJjZjsKICB0LmFjdXRldG9uZWNtYiA9IDB4MDM0MTsKICB0LmFjeXJpbGxpYyA9IDB4MDQzMDsKICB0LmFkYmxncmF2ZSA9IDB4MDIwMTsKICB0LmFkZGFrZ3VybXVraGkgPSAweDBhNzE7CiAgdC5hZGV2YSA9IDB4MDkwNTsKICB0LmFkaWVyZXNpcyA9IDB4MDBlNDsKICB0LmFkaWVyZXNpc2N5cmlsbGljID0gMHgwNGQzOwogIHQuYWRpZXJlc2lzbWFjcm9uID0gMHgwMWRmOwogIHQuYWRvdGJlbG93ID0gMHgxZWExOwogIHQuYWRvdG1hY3JvbiA9IDB4MDFlMTsKICB0LmFlID0gMHgwMGU2OwogIHQuYWVhY3V0ZSA9IDB4MDFmZDsKICB0LmFla29yZWFuID0gMHgzMTUwOwogIHQuYWVtYWNyb24gPSAweDAxZTM7CiAgdC5hZmlpMDAyMDggPSAweDIwMTU7CiAgdC5hZmlpMDg5NDEgPSAweDIwYTQ7CiAgdC5hZmlpMTAwMTcgPSAweDA0MTA7CiAgdC5hZmlpMTAwMTggPSAweDA0MTE7CiAgdC5hZmlpMTAwMTkgPSAweDA0MTI7CiAgdC5hZmlpMTAwMjAgPSAweDA0MTM7CiAgdC5hZmlpMTAwMjEgPSAweDA0MTQ7CiAgdC5hZmlpMTAwMjIgPSAweDA0MTU7CiAgdC5hZmlpMTAwMjMgPSAweDA0MDE7CiAgdC5hZmlpMTAwMjQgPSAweDA0MTY7CiAgdC5hZmlpMTAwMjUgPSAweDA0MTc7CiAgdC5hZmlpMTAwMjYgPSAweDA0MTg7CiAgdC5hZmlpMTAwMjcgPSAweDA0MTk7CiAgdC5hZmlpMTAwMjggPSAweDA0MWE7CiAgdC5hZmlpMTAwMjkgPSAweDA0MWI7CiAgdC5hZmlpMTAwMzAgPSAweDA0MWM7CiAgdC5hZmlpMTAwMzEgPSAweDA0MWQ7CiAgdC5hZmlpMTAwMzIgPSAweDA0MWU7CiAgdC5hZmlpMTAwMzMgPSAweDA0MWY7CiAgdC5hZmlpMTAwMzQgPSAweDA0MjA7CiAgdC5hZmlpMTAwMzUgPSAweDA0MjE7CiAgdC5hZmlpMTAwMzYgPSAweDA0MjI7CiAgdC5hZmlpMTAwMzcgPSAweDA0MjM7CiAgdC5hZmlpMTAwMzggPSAweDA0MjQ7CiAgdC5hZmlpMTAwMzkgPSAweDA0MjU7CiAgdC5hZmlpMTAwNDAgPSAweDA0MjY7CiAgdC5hZmlpMTAwNDEgPSAweDA0Mjc7CiAgdC5hZmlpMTAwNDIgPSAweDA0Mjg7CiAgdC5hZmlpMTAwNDMgPSAweDA0Mjk7CiAgdC5hZmlpMTAwNDQgPSAweDA0MmE7CiAgdC5hZmlpMTAwNDUgPSAweDA0MmI7CiAgdC5hZmlpMTAwNDYgPSAweDA0MmM7CiAgdC5hZmlpMTAwNDcgPSAweDA0MmQ7CiAgdC5hZmlpMTAwNDggPSAweDA0MmU7CiAgdC5hZmlpMTAwNDkgPSAweDA0MmY7CiAgdC5hZmlpMTAwNTAgPSAweDA0OTA7CiAgdC5hZmlpMTAwNTEgPSAweDA0MDI7CiAgdC5hZmlpMTAwNTIgPSAweDA0MDM7CiAgdC5hZmlpMTAwNTMgPSAweDA0MDQ7CiAgdC5hZmlpMTAwNTQgPSAweDA0MDU7CiAgdC5hZmlpMTAwNTUgPSAweDA0MDY7CiAgdC5hZmlpMTAwNTYgPSAweDA0MDc7CiAgdC5hZmlpMTAwNTcgPSAweDA0MDg7CiAgdC5hZmlpMTAwNTggPSAweDA0MDk7CiAgdC5hZmlpMTAwNTkgPSAweDA0MGE7CiAgdC5hZmlpMTAwNjAgPSAweDA0MGI7CiAgdC5hZmlpMTAwNjEgPSAweDA0MGM7CiAgdC5hZmlpMTAwNjIgPSAweDA0MGU7CiAgdC5hZmlpMTAwNjMgPSAweGY2YzQ7CiAgdC5hZmlpMTAwNjQgPSAweGY2YzU7CiAgdC5hZmlpMTAwNjUgPSAweDA0MzA7CiAgdC5hZmlpMTAwNjYgPSAweDA0MzE7CiAgdC5hZmlpMTAwNjcgPSAweDA0MzI7CiAgdC5hZmlpMTAwNjggPSAweDA0MzM7CiAgdC5hZmlpMTAwNjkgPSAweDA0MzQ7CiAgdC5hZmlpMTAwNzAgPSAweDA0MzU7CiAgdC5hZmlpMTAwNzEgPSAweDA0NTE7CiAgdC5hZmlpMTAwNzIgPSAweDA0MzY7CiAgdC5hZmlpMTAwNzMgPSAweDA0Mzc7CiAgdC5hZmlpMTAwNzQgPSAweDA0Mzg7CiAgdC5hZmlpMTAwNzUgPSAweDA0Mzk7CiAgdC5hZmlpMTAwNzYgPSAweDA0M2E7CiAgdC5hZmlpMTAwNzcgPSAweDA0M2I7CiAgdC5hZmlpMTAwNzggPSAweDA0M2M7CiAgdC5hZmlpMTAwNzkgPSAweDA0M2Q7CiAgdC5hZmlpMTAwODAgPSAweDA0M2U7CiAgdC5hZmlpMTAwODEgPSAweDA0M2Y7CiAgdC5hZmlpMTAwODIgPSAweDA0NDA7CiAgdC5hZmlpMTAwODMgPSAweDA0NDE7CiAgdC5hZmlpMTAwODQgPSAweDA0NDI7CiAgdC5hZmlpMTAwODUgPSAweDA0NDM7CiAgdC5hZmlpMTAwODYgPSAweDA0NDQ7CiAgdC5hZmlpMTAwODcgPSAweDA0NDU7CiAgdC5hZmlpMTAwODggPSAweDA0NDY7CiAgdC5hZmlpMTAwODkgPSAweDA0NDc7CiAgdC5hZmlpMTAwOTAgPSAweDA0NDg7CiAgdC5hZmlpMTAwOTEgPSAweDA0NDk7CiAgdC5hZmlpMTAwOTIgPSAweDA0NGE7CiAgdC5hZmlpMTAwOTMgPSAweDA0NGI7CiAgdC5hZmlpMTAwOTQgPSAweDA0NGM7CiAgdC5hZmlpMTAwOTUgPSAweDA0NGQ7CiAgdC5hZmlpMTAwOTYgPSAweDA0NGU7CiAgdC5hZmlpMTAwOTcgPSAweDA0NGY7CiAgdC5hZmlpMTAwOTggPSAweDA0OTE7CiAgdC5hZmlpMTAwOTkgPSAweDA0NTI7CiAgdC5hZmlpMTAxMDAgPSAweDA0NTM7CiAgdC5hZmlpMTAxMDEgPSAweDA0NTQ7CiAgdC5hZmlpMTAxMDIgPSAweDA0NTU7CiAgdC5hZmlpMTAxMDMgPSAweDA0NTY7CiAgdC5hZmlpMTAxMDQgPSAweDA0NTc7CiAgdC5hZmlpMTAxMDUgPSAweDA0NTg7CiAgdC5hZmlpMTAxMDYgPSAweDA0NTk7CiAgdC5hZmlpMTAxMDcgPSAweDA0NWE7CiAgdC5hZmlpMTAxMDggPSAweDA0NWI7CiAgdC5hZmlpMTAxMDkgPSAweDA0NWM7CiAgdC5hZmlpMTAxMTAgPSAweDA0NWU7CiAgdC5hZmlpMTAxNDUgPSAweDA0MGY7CiAgdC5hZmlpMTAxNDYgPSAweDA0NjI7CiAgdC5hZmlpMTAxNDcgPSAweDA0NzI7CiAgdC5hZmlpMTAxNDggPSAweDA0NzQ7CiAgdC5hZmlpMTAxOTIgPSAweGY2YzY7CiAgdC5hZmlpMTAxOTMgPSAweDA0NWY7CiAgdC5hZmlpMTAxOTQgPSAweDA0NjM7CiAgdC5hZmlpMTAxOTUgPSAweDA0NzM7CiAgdC5hZmlpMTAxOTYgPSAweDA0NzU7CiAgdC5hZmlpMTA4MzEgPSAweGY2Yzc7CiAgdC5hZmlpMTA4MzIgPSAweGY2Yzg7CiAgdC5hZmlpMTA4NDYgPSAweDA0ZDk7CiAgdC5hZmlpMjk5ID0gMHgyMDBlOwogIHQuYWZpaTMwMCA9IDB4MjAwZjsKICB0LmFmaWkzMDEgPSAweDIwMGQ7CiAgdC5hZmlpNTczODEgPSAweDA2NmE7CiAgdC5hZmlpNTczODggPSAweDA2MGM7CiAgdC5hZmlpNTczOTIgPSAweDA2NjA7CiAgdC5hZmlpNTczOTMgPSAweDA2NjE7CiAgdC5hZmlpNTczOTQgPSAweDA2NjI7CiAgdC5hZmlpNTczOTUgPSAweDA2NjM7CiAgdC5hZmlpNTczOTYgPSAweDA2NjQ7CiAgdC5hZmlpNTczOTcgPSAweDA2NjU7CiAgdC5hZmlpNTczOTggPSAweDA2NjY7CiAgdC5hZmlpNTczOTkgPSAweDA2Njc7CiAgdC5hZmlpNTc0MDAgPSAweDA2Njg7CiAgdC5hZmlpNTc0MDEgPSAweDA2Njk7CiAgdC5hZmlpNTc0MDMgPSAweDA2MWI7CiAgdC5hZmlpNTc0MDcgPSAweDA2MWY7CiAgdC5hZmlpNTc0MDkgPSAweDA2MjE7CiAgdC5hZmlpNTc0MTAgPSAweDA2MjI7CiAgdC5hZmlpNTc0MTEgPSAweDA2MjM7CiAgdC5hZmlpNTc0MTIgPSAweDA2MjQ7CiAgdC5hZmlpNTc0MTMgPSAweDA2MjU7CiAgdC5hZmlpNTc0MTQgPSAweDA2MjY7CiAgdC5hZmlpNTc0MTUgPSAweDA2Mjc7CiAgdC5hZmlpNTc0MTYgPSAweDA2Mjg7CiAgdC5hZmlpNTc0MTcgPSAweDA2Mjk7CiAgdC5hZmlpNTc0MTggPSAweDA2MmE7CiAgdC5hZmlpNTc0MTkgPSAweDA2MmI7CiAgdC5hZmlpNTc0MjAgPSAweDA2MmM7CiAgdC5hZmlpNTc0MjEgPSAweDA2MmQ7CiAgdC5hZmlpNTc0MjIgPSAweDA2MmU7CiAgdC5hZmlpNTc0MjMgPSAweDA2MmY7CiAgdC5hZmlpNTc0MjQgPSAweDA2MzA7CiAgdC5hZmlpNTc0MjUgPSAweDA2MzE7CiAgdC5hZmlpNTc0MjYgPSAweDA2MzI7CiAgdC5hZmlpNTc0MjcgPSAweDA2MzM7CiAgdC5hZmlpNTc0MjggPSAweDA2MzQ7CiAgdC5hZmlpNTc0MjkgPSAweDA2MzU7CiAgdC5hZmlpNTc0MzAgPSAweDA2MzY7CiAgdC5hZmlpNTc0MzEgPSAweDA2Mzc7CiAgdC5hZmlpNTc0MzIgPSAweDA2Mzg7CiAgdC5hZmlpNTc0MzMgPSAweDA2Mzk7CiAgdC5hZmlpNTc0MzQgPSAweDA2M2E7CiAgdC5hZmlpNTc0NDAgPSAweDA2NDA7CiAgdC5hZmlpNTc0NDEgPSAweDA2NDE7CiAgdC5hZmlpNTc0NDIgPSAweDA2NDI7CiAgdC5hZmlpNTc0NDMgPSAweDA2NDM7CiAgdC5hZmlpNTc0NDQgPSAweDA2NDQ7CiAgdC5hZmlpNTc0NDUgPSAweDA2NDU7CiAgdC5hZmlpNTc0NDYgPSAweDA2NDY7CiAgdC5hZmlpNTc0NDggPSAweDA2NDg7CiAgdC5hZmlpNTc0NDkgPSAweDA2NDk7CiAgdC5hZmlpNTc0NTAgPSAweDA2NGE7CiAgdC5hZmlpNTc0NTEgPSAweDA2NGI7CiAgdC5hZmlpNTc0NTIgPSAweDA2NGM7CiAgdC5hZmlpNTc0NTMgPSAweDA2NGQ7CiAgdC5hZmlpNTc0NTQgPSAweDA2NGU7CiAgdC5hZmlpNTc0NTUgPSAweDA2NGY7CiAgdC5hZmlpNTc0NTYgPSAweDA2NTA7CiAgdC5hZmlpNTc0NTcgPSAweDA2NTE7CiAgdC5hZmlpNTc0NTggPSAweDA2NTI7CiAgdC5hZmlpNTc0NzAgPSAweDA2NDc7CiAgdC5hZmlpNTc1MDUgPSAweDA2YTQ7CiAgdC5hZmlpNTc1MDYgPSAweDA2N2U7CiAgdC5hZmlpNTc1MDcgPSAweDA2ODY7CiAgdC5hZmlpNTc1MDggPSAweDA2OTg7CiAgdC5hZmlpNTc1MDkgPSAweDA2YWY7CiAgdC5hZmlpNTc1MTEgPSAweDA2Nzk7CiAgdC5hZmlpNTc1MTIgPSAweDA2ODg7CiAgdC5hZmlpNTc1MTMgPSAweDA2OTE7CiAgdC5hZmlpNTc1MTQgPSAweDA2YmE7CiAgdC5hZmlpNTc1MTkgPSAweDA2ZDI7CiAgdC5hZmlpNTc1MzQgPSAweDA2ZDU7CiAgdC5hZmlpNTc2MzYgPSAweDIwYWE7CiAgdC5hZmlpNTc2NDUgPSAweDA1YmU7CiAgdC5hZmlpNTc2NTggPSAweDA1YzM7CiAgdC5hZmlpNTc2NjQgPSAweDA1ZDA7CiAgdC5hZmlpNTc2NjUgPSAweDA1ZDE7CiAgdC5hZmlpNTc2NjYgPSAweDA1ZDI7CiAgdC5hZmlpNTc2NjcgPSAweDA1ZDM7CiAgdC5hZmlpNTc2NjggPSAweDA1ZDQ7CiAgdC5hZmlpNTc2NjkgPSAweDA1ZDU7CiAgdC5hZmlpNTc2NzAgPSAweDA1ZDY7CiAgdC5hZmlpNTc2NzEgPSAweDA1ZDc7CiAgdC5hZmlpNTc2NzIgPSAweDA1ZDg7CiAgdC5hZmlpNTc2NzMgPSAweDA1ZDk7CiAgdC5hZmlpNTc2NzQgPSAweDA1ZGE7CiAgdC5hZmlpNTc2NzUgPSAweDA1ZGI7CiAgdC5hZmlpNTc2NzYgPSAweDA1ZGM7CiAgdC5hZmlpNTc2NzcgPSAweDA1ZGQ7CiAgdC5hZmlpNTc2NzggPSAweDA1ZGU7CiAgdC5hZmlpNTc2NzkgPSAweDA1ZGY7CiAgdC5hZmlpNTc2ODAgPSAweDA1ZTA7CiAgdC5hZmlpNTc2ODEgPSAweDA1ZTE7CiAgdC5hZmlpNTc2ODIgPSAweDA1ZTI7CiAgdC5hZmlpNTc2ODMgPSAweDA1ZTM7CiAgdC5hZmlpNTc2ODQgPSAweDA1ZTQ7CiAgdC5hZmlpNTc2ODUgPSAweDA1ZTU7CiAgdC5hZmlpNTc2ODYgPSAweDA1ZTY7CiAgdC5hZmlpNTc2ODcgPSAweDA1ZTc7CiAgdC5hZmlpNTc2ODggPSAweDA1ZTg7CiAgdC5hZmlpNTc2ODkgPSAweDA1ZTk7CiAgdC5hZmlpNTc2OTAgPSAweDA1ZWE7CiAgdC5hZmlpNTc2OTQgPSAweGZiMmE7CiAgdC5hZmlpNTc2OTUgPSAweGZiMmI7CiAgdC5hZmlpNTc3MDAgPSAweGZiNGI7CiAgdC5hZmlpNTc3MDUgPSAweGZiMWY7CiAgdC5hZmlpNTc3MTYgPSAweDA1ZjA7CiAgdC5hZmlpNTc3MTcgPSAweDA1ZjE7CiAgdC5hZmlpNTc3MTggPSAweDA1ZjI7CiAgdC5hZmlpNTc3MjMgPSAweGZiMzU7CiAgdC5hZmlpNTc3OTMgPSAweDA1YjQ7CiAgdC5hZmlpNTc3OTQgPSAweDA1YjU7CiAgdC5hZmlpNTc3OTUgPSAweDA1YjY7CiAgdC5hZmlpNTc3OTYgPSAweDA1YmI7CiAgdC5hZmlpNTc3OTcgPSAweDA1Yjg7CiAgdC5hZmlpNTc3OTggPSAweDA1Yjc7CiAgdC5hZmlpNTc3OTkgPSAweDA1YjA7CiAgdC5hZmlpNTc4MDAgPSAweDA1YjI7CiAgdC5hZmlpNTc4MDEgPSAweDA1YjE7CiAgdC5hZmlpNTc4MDIgPSAweDA1YjM7CiAgdC5hZmlpNTc4MDMgPSAweDA1YzI7CiAgdC5hZmlpNTc4MDQgPSAweDA1YzE7CiAgdC5hZmlpNTc4MDYgPSAweDA1Yjk7CiAgdC5hZmlpNTc4MDcgPSAweDA1YmM7CiAgdC5hZmlpNTc4MzkgPSAweDA1YmQ7CiAgdC5hZmlpNTc4NDEgPSAweDA1YmY7CiAgdC5hZmlpNTc4NDIgPSAweDA1YzA7CiAgdC5hZmlpNTc5MjkgPSAweDAyYmM7CiAgdC5hZmlpNjEyNDggPSAweDIxMDU7CiAgdC5hZmlpNjEyODkgPSAweDIxMTM7CiAgdC5hZmlpNjEzNTIgPSAweDIxMTY7CiAgdC5hZmlpNjE1NzMgPSAweDIwMmM7CiAgdC5hZmlpNjE1NzQgPSAweDIwMmQ7CiAgdC5hZmlpNjE1NzUgPSAweDIwMmU7CiAgdC5hZmlpNjE2NjQgPSAweDIwMGM7CiAgdC5hZmlpNjMxNjcgPSAweDA2NmQ7CiAgdC5hZmlpNjQ5MzcgPSAweDAyYmQ7CiAgdC5hZ3JhdmUgPSAweDAwZTA7CiAgdC5hZ3VqYXJhdGkgPSAweDBhODU7CiAgdC5hZ3VybXVraGkgPSAweDBhMDU7CiAgdC5haGlyYWdhbmEgPSAweDMwNDI7CiAgdC5haG9va2Fib3ZlID0gMHgxZWEzOwogIHQuYWliZW5nYWxpID0gMHgwOTkwOwogIHQuYWlib3BvbW9mbyA9IDB4MzExZTsKICB0LmFpZGV2YSA9IDB4MDkxMDsKICB0LmFpZWN5cmlsbGljID0gMHgwNGQ1OwogIHQuYWlndWphcmF0aSA9IDB4MGE5MDsKICB0LmFpZ3VybXVraGkgPSAweDBhMTA7CiAgdC5haW1hdHJhZ3VybXVraGkgPSAweDBhNDg7CiAgdC5haW5hcmFiaWMgPSAweDA2Mzk7CiAgdC5haW5maW5hbGFyYWJpYyA9IDB4ZmVjYTsKICB0LmFpbmluaXRpYWxhcmFiaWMgPSAweGZlY2I7CiAgdC5haW5tZWRpYWxhcmFiaWMgPSAweGZlY2M7CiAgdC5haW52ZXJ0ZWRicmV2ZSA9IDB4MDIwMzsKICB0LmFpdm93ZWxzaWduYmVuZ2FsaSA9IDB4MDljODsKICB0LmFpdm93ZWxzaWduZGV2YSA9IDB4MDk0ODsKICB0LmFpdm93ZWxzaWduZ3VqYXJhdGkgPSAweDBhYzg7CiAgdC5ha2F0YWthbmEgPSAweDMwYTI7CiAgdC5ha2F0YWthbmFoYWxmd2lkdGggPSAweGZmNzE7CiAgdC5ha29yZWFuID0gMHgzMTRmOwogIHQuYWxlZiA9IDB4MDVkMDsKICB0LmFsZWZhcmFiaWMgPSAweDA2Mjc7CiAgdC5hbGVmZGFnZXNoaGVicmV3ID0gMHhmYjMwOwogIHQuYWxlZmZpbmFsYXJhYmljID0gMHhmZThlOwogIHQuYWxlZmhhbXphYWJvdmVhcmFiaWMgPSAweDA2MjM7CiAgdC5hbGVmaGFtemFhYm92ZWZpbmFsYXJhYmljID0gMHhmZTg0OwogIHQuYWxlZmhhbXphYmVsb3dhcmFiaWMgPSAweDA2MjU7CiAgdC5hbGVmaGFtemFiZWxvd2ZpbmFsYXJhYmljID0gMHhmZTg4OwogIHQuYWxlZmhlYnJldyA9IDB4MDVkMDsKICB0LmFsZWZsYW1lZGhlYnJldyA9IDB4ZmI0ZjsKICB0LmFsZWZtYWRkYWFib3ZlYXJhYmljID0gMHgwNjIyOwogIHQuYWxlZm1hZGRhYWJvdmVmaW5hbGFyYWJpYyA9IDB4ZmU4MjsKICB0LmFsZWZtYWtzdXJhYXJhYmljID0gMHgwNjQ5OwogIHQuYWxlZm1ha3N1cmFmaW5hbGFyYWJpYyA9IDB4ZmVmMDsKICB0LmFsZWZtYWtzdXJhaW5pdGlhbGFyYWJpYyA9IDB4ZmVmMzsKICB0LmFsZWZtYWtzdXJhbWVkaWFsYXJhYmljID0gMHhmZWY0OwogIHQuYWxlZnBhdGFoaGVicmV3ID0gMHhmYjJlOwogIHQuYWxlZnFhbWF0c2hlYnJldyA9IDB4ZmIyZjsKICB0LmFsZXBoID0gMHgyMTM1OwogIHQuYWxsZXF1YWwgPSAweDIyNGM7CiAgdC5hbHBoYSA9IDB4MDNiMTsKICB0LmFscGhhdG9ub3MgPSAweDAzYWM7CiAgdC5hbWFjcm9uID0gMHgwMTAxOwogIHQuYW1vbm9zcGFjZSA9IDB4ZmY0MTsKICB0LmFtcGVyc2FuZCA9IDB4MDAyNjsKICB0LmFtcGVyc2FuZG1vbm9zcGFjZSA9IDB4ZmYwNjsKICB0LmFtcGVyc2FuZHNtYWxsID0gMHhmNzI2OwogIHQuYW1zcXVhcmUgPSAweDMzYzI7CiAgdC5hbmJvcG9tb2ZvID0gMHgzMTIyOwogIHQuYW5nYm9wb21vZm8gPSAweDMxMjQ7CiAgdC5hbmdicmFja2V0bGVmdCA9IDB4MzAwODsKICB0LmFuZ2JyYWNrZXRyaWdodCA9IDB4MzAwOTsKICB0LmFuZ2toYW5raHV0aGFpID0gMHgwZTVhOwogIHQuYW5nbGUgPSAweDIyMjA7CiAgdC5hbmdsZWJyYWNrZXRsZWZ0ID0gMHgzMDA4OwogIHQuYW5nbGVicmFja2V0bGVmdHZlcnRpY2FsID0gMHhmZTNmOwogIHQuYW5nbGVicmFja2V0cmlnaHQgPSAweDMwMDk7CiAgdC5hbmdsZWJyYWNrZXRyaWdodHZlcnRpY2FsID0gMHhmZTQwOwogIHQuYW5nbGVsZWZ0ID0gMHgyMzI5OwogIHQuYW5nbGVyaWdodCA9IDB4MjMyYTsKICB0LmFuZ3N0cm9tID0gMHgyMTJiOwogIHQuYW5vdGVsZWlhID0gMHgwMzg3OwogIHQuYW51ZGF0dGFkZXZhID0gMHgwOTUyOwogIHQuYW51c3ZhcmFiZW5nYWxpID0gMHgwOTgyOwogIHQuYW51c3ZhcmFkZXZhID0gMHgwOTAyOwogIHQuYW51c3ZhcmFndWphcmF0aSA9IDB4MGE4MjsKICB0LmFvZ29uZWsgPSAweDAxMDU7CiAgdC5hcGFhdG9zcXVhcmUgPSAweDMzMDA7CiAgdC5hcGFyZW4gPSAweDI0OWM7CiAgdC5hcG9zdHJvcGhlYXJtZW5pYW4gPSAweDA1NWE7CiAgdC5hcG9zdHJvcGhlbW9kID0gMHgwMmJjOwogIHQuYXBwbGUgPSAweGY4ZmY7CiAgdC5hcHByb2FjaGVzID0gMHgyMjUwOwogIHQuYXBwcm94ZXF1YWwgPSAweDIyNDg7CiAgdC5hcHByb3hlcXVhbG9yaW1hZ2UgPSAweDIyNTI7CiAgdC5hcHByb3hpbWF0ZWx5ZXF1YWwgPSAweDIyNDU7CiAgdC5hcmFlYWVrb3JlYW4gPSAweDMxOGU7CiAgdC5hcmFlYWtvcmVhbiA9IDB4MzE4ZDsKICB0LmFyYyA9IDB4MjMxMjsKICB0LmFyaWdodGhhbGZyaW5nID0gMHgxZTlhOwogIHQuYXJpbmcgPSAweDAwZTU7CiAgdC5hcmluZ2FjdXRlID0gMHgwMWZiOwogIHQuYXJpbmdiZWxvdyA9IDB4MWUwMTsKICB0LmFycm93Ym90aCA9IDB4MjE5NDsKICB0LmFycm93ZGFzaGRvd24gPSAweDIxZTM7CiAgdC5hcnJvd2Rhc2hsZWZ0ID0gMHgyMWUwOwogIHQuYXJyb3dkYXNocmlnaHQgPSAweDIxZTI7CiAgdC5hcnJvd2Rhc2h1cCA9IDB4MjFlMTsKICB0LmFycm93ZGJsYm90aCA9IDB4MjFkNDsKICB0LmFycm93ZGJsZG93biA9IDB4MjFkMzsKICB0LmFycm93ZGJsbGVmdCA9IDB4MjFkMDsKICB0LmFycm93ZGJscmlnaHQgPSAweDIxZDI7CiAgdC5hcnJvd2RibHVwID0gMHgyMWQxOwogIHQuYXJyb3dkb3duID0gMHgyMTkzOwogIHQuYXJyb3dkb3dubGVmdCA9IDB4MjE5OTsKICB0LmFycm93ZG93bnJpZ2h0ID0gMHgyMTk4OwogIHQuYXJyb3dkb3dud2hpdGUgPSAweDIxZTk7CiAgdC5hcnJvd2hlYWRkb3dubW9kID0gMHgwMmM1OwogIHQuYXJyb3doZWFkbGVmdG1vZCA9IDB4MDJjMjsKICB0LmFycm93aGVhZHJpZ2h0bW9kID0gMHgwMmMzOwogIHQuYXJyb3doZWFkdXBtb2QgPSAweDAyYzQ7CiAgdC5hcnJvd2hvcml6ZXggPSAweGY4ZTc7CiAgdC5hcnJvd2xlZnQgPSAweDIxOTA7CiAgdC5hcnJvd2xlZnRkYmwgPSAweDIxZDA7CiAgdC5hcnJvd2xlZnRkYmxzdHJva2UgPSAweDIxY2Q7CiAgdC5hcnJvd2xlZnRvdmVycmlnaHQgPSAweDIxYzY7CiAgdC5hcnJvd2xlZnR3aGl0ZSA9IDB4MjFlNjsKICB0LmFycm93cmlnaHQgPSAweDIxOTI7CiAgdC5hcnJvd3JpZ2h0ZGJsc3Ryb2tlID0gMHgyMWNmOwogIHQuYXJyb3dyaWdodGhlYXZ5ID0gMHgyNzllOwogIHQuYXJyb3dyaWdodG92ZXJsZWZ0ID0gMHgyMWM0OwogIHQuYXJyb3dyaWdodHdoaXRlID0gMHgyMWU4OwogIHQuYXJyb3d0YWJsZWZ0ID0gMHgyMWU0OwogIHQuYXJyb3d0YWJyaWdodCA9IDB4MjFlNTsKICB0LmFycm93dXAgPSAweDIxOTE7CiAgdC5hcnJvd3VwZG4gPSAweDIxOTU7CiAgdC5hcnJvd3VwZG5ic2UgPSAweDIxYTg7CiAgdC5hcnJvd3VwZG93bmJhc2UgPSAweDIxYTg7CiAgdC5hcnJvd3VwbGVmdCA9IDB4MjE5NjsKICB0LmFycm93dXBsZWZ0b2Zkb3duID0gMHgyMWM1OwogIHQuYXJyb3d1cHJpZ2h0ID0gMHgyMTk3OwogIHQuYXJyb3d1cHdoaXRlID0gMHgyMWU3OwogIHQuYXJyb3d2ZXJ0ZXggPSAweGY4ZTY7CiAgdC5hc2NpaWNpcmN1bSA9IDB4MDA1ZTsKICB0LmFzY2lpY2lyY3VtbW9ub3NwYWNlID0gMHhmZjNlOwogIHQuYXNjaWl0aWxkZSA9IDB4MDA3ZTsKICB0LmFzY2lpdGlsZGVtb25vc3BhY2UgPSAweGZmNWU7CiAgdC5hc2NyaXB0ID0gMHgwMjUxOwogIHQuYXNjcmlwdHR1cm5lZCA9IDB4MDI1MjsKICB0LmFzbWFsbGhpcmFnYW5hID0gMHgzMDQxOwogIHQuYXNtYWxsa2F0YWthbmEgPSAweDMwYTE7CiAgdC5hc21hbGxrYXRha2FuYWhhbGZ3aWR0aCA9IDB4ZmY2NzsKICB0LmFzdGVyaXNrID0gMHgwMDJhOwogIHQuYXN0ZXJpc2thbHRvbmVhcmFiaWMgPSAweDA2NmQ7CiAgdC5hc3Rlcmlza2FyYWJpYyA9IDB4MDY2ZDsKICB0LmFzdGVyaXNrbWF0aCA9IDB4MjIxNzsKICB0LmFzdGVyaXNrbW9ub3NwYWNlID0gMHhmZjBhOwogIHQuYXN0ZXJpc2tzbWFsbCA9IDB4ZmU2MTsKICB0LmFzdGVyaXNtID0gMHgyMDQyOwogIHQuYXN1cGVyaW9yID0gMHhmNmU5OwogIHQuYXN5bXB0b3RpY2FsbHllcXVhbCA9IDB4MjI0MzsKICB0LmF0ID0gMHgwMDQwOwogIHQuYXRpbGRlID0gMHgwMGUzOwogIHQuYXRtb25vc3BhY2UgPSAweGZmMjA7CiAgdC5hdHNtYWxsID0gMHhmZTZiOwogIHQuYXR1cm5lZCA9IDB4MDI1MDsKICB0LmF1YmVuZ2FsaSA9IDB4MDk5NDsKICB0LmF1Ym9wb21vZm8gPSAweDMxMjA7CiAgdC5hdWRldmEgPSAweDA5MTQ7CiAgdC5hdWd1amFyYXRpID0gMHgwYTk0OwogIHQuYXVndXJtdWtoaSA9IDB4MGExNDsKICB0LmF1bGVuZ3RobWFya2JlbmdhbGkgPSAweDA5ZDc7CiAgdC5hdW1hdHJhZ3VybXVraGkgPSAweDBhNGM7CiAgdC5hdXZvd2Vsc2lnbmJlbmdhbGkgPSAweDA5Y2M7CiAgdC5hdXZvd2Vsc2lnbmRldmEgPSAweDA5NGM7CiAgdC5hdXZvd2Vsc2lnbmd1amFyYXRpID0gMHgwYWNjOwogIHQuYXZhZ3JhaGFkZXZhID0gMHgwOTNkOwogIHQuYXliYXJtZW5pYW4gPSAweDA1NjE7CiAgdC5heWluID0gMHgwNWUyOwogIHQuYXlpbmFsdG9uZWhlYnJldyA9IDB4ZmIyMDsKICB0LmF5aW5oZWJyZXcgPSAweDA1ZTI7CiAgdC5iID0gMHgwMDYyOwogIHQuYmFiZW5nYWxpID0gMHgwOWFjOwogIHQuYmFja3NsYXNoID0gMHgwMDVjOwogIHQuYmFja3NsYXNobW9ub3NwYWNlID0gMHhmZjNjOwogIHQuYmFkZXZhID0gMHgwOTJjOwogIHQuYmFndWphcmF0aSA9IDB4MGFhYzsKICB0LmJhZ3VybXVraGkgPSAweDBhMmM7CiAgdC5iYWhpcmFnYW5hID0gMHgzMDcwOwogIHQuYmFodHRoYWkgPSAweDBlM2Y7CiAgdC5iYWthdGFrYW5hID0gMHgzMGQwOwogIHQuYmFyID0gMHgwMDdjOwogIHQuYmFybW9ub3NwYWNlID0gMHhmZjVjOwogIHQuYmJvcG9tb2ZvID0gMHgzMTA1OwogIHQuYmNpcmNsZSA9IDB4MjRkMTsKICB0LmJkb3RhY2NlbnQgPSAweDFlMDM7CiAgdC5iZG90YmVsb3cgPSAweDFlMDU7CiAgdC5iZWFtZWRzaXh0ZWVudGhub3RlcyA9IDB4MjY2YzsKICB0LmJlY2F1c2UgPSAweDIyMzU7CiAgdC5iZWN5cmlsbGljID0gMHgwNDMxOwogIHQuYmVoYXJhYmljID0gMHgwNjI4OwogIHQuYmVoZmluYWxhcmFiaWMgPSAweGZlOTA7CiAgdC5iZWhpbml0aWFsYXJhYmljID0gMHhmZTkxOwogIHQuYmVoaXJhZ2FuYSA9IDB4MzA3OTsKICB0LmJlaG1lZGlhbGFyYWJpYyA9IDB4ZmU5MjsKICB0LmJlaG1lZW1pbml0aWFsYXJhYmljID0gMHhmYzlmOwogIHQuYmVobWVlbWlzb2xhdGVkYXJhYmljID0gMHhmYzA4OwogIHQuYmVobm9vbmZpbmFsYXJhYmljID0gMHhmYzZkOwogIHQuYmVrYXRha2FuYSA9IDB4MzBkOTsKICB0LmJlbmFybWVuaWFuID0gMHgwNTYyOwogIHQuYmV0ID0gMHgwNWQxOwogIHQuYmV0YSA9IDB4MDNiMjsKICB0LmJldGFzeW1ib2xncmVlayA9IDB4MDNkMDsKICB0LmJldGRhZ2VzaCA9IDB4ZmIzMTsKICB0LmJldGRhZ2VzaGhlYnJldyA9IDB4ZmIzMTsKICB0LmJldGhlYnJldyA9IDB4MDVkMTsKICB0LmJldHJhZmVoZWJyZXcgPSAweGZiNGM7CiAgdC5iaGFiZW5nYWxpID0gMHgwOWFkOwogIHQuYmhhZGV2YSA9IDB4MDkyZDsKICB0LmJoYWd1amFyYXRpID0gMHgwYWFkOwogIHQuYmhhZ3VybXVraGkgPSAweDBhMmQ7CiAgdC5iaG9vayA9IDB4MDI1MzsKICB0LmJpaGlyYWdhbmEgPSAweDMwNzM7CiAgdC5iaWthdGFrYW5hID0gMHgzMGQzOwogIHQuYmlsYWJpYWxjbGljayA9IDB4MDI5ODsKICB0LmJpbmRpZ3VybXVraGkgPSAweDBhMDI7CiAgdC5iaXJ1c3F1YXJlID0gMHgzMzMxOwogIHQuYmxhY2tjaXJjbGUgPSAweDI1Y2Y7CiAgdC5ibGFja2RpYW1vbmQgPSAweDI1YzY7CiAgdC5ibGFja2Rvd25wb2ludGluZ3RyaWFuZ2xlID0gMHgyNWJjOwogIHQuYmxhY2tsZWZ0cG9pbnRpbmdwb2ludGVyID0gMHgyNWM0OwogIHQuYmxhY2tsZWZ0cG9pbnRpbmd0cmlhbmdsZSA9IDB4MjVjMDsKICB0LmJsYWNrbGVudGljdWxhcmJyYWNrZXRsZWZ0ID0gMHgzMDEwOwogIHQuYmxhY2tsZW50aWN1bGFyYnJhY2tldGxlZnR2ZXJ0aWNhbCA9IDB4ZmUzYjsKICB0LmJsYWNrbGVudGljdWxhcmJyYWNrZXRyaWdodCA9IDB4MzAxMTsKICB0LmJsYWNrbGVudGljdWxhcmJyYWNrZXRyaWdodHZlcnRpY2FsID0gMHhmZTNjOwogIHQuYmxhY2tsb3dlcmxlZnR0cmlhbmdsZSA9IDB4MjVlMzsKICB0LmJsYWNrbG93ZXJyaWdodHRyaWFuZ2xlID0gMHgyNWUyOwogIHQuYmxhY2tyZWN0YW5nbGUgPSAweDI1YWM7CiAgdC5ibGFja3JpZ2h0cG9pbnRpbmdwb2ludGVyID0gMHgyNWJhOwogIHQuYmxhY2tyaWdodHBvaW50aW5ndHJpYW5nbGUgPSAweDI1YjY7CiAgdC5ibGFja3NtYWxsc3F1YXJlID0gMHgyNWFhOwogIHQuYmxhY2tzbWlsaW5nZmFjZSA9IDB4MjYzYjsKICB0LmJsYWNrc3F1YXJlID0gMHgyNWEwOwogIHQuYmxhY2tzdGFyID0gMHgyNjA1OwogIHQuYmxhY2t1cHBlcmxlZnR0cmlhbmdsZSA9IDB4MjVlNDsKICB0LmJsYWNrdXBwZXJyaWdodHRyaWFuZ2xlID0gMHgyNWU1OwogIHQuYmxhY2t1cHBvaW50aW5nc21hbGx0cmlhbmdsZSA9IDB4MjViNDsKICB0LmJsYWNrdXBwb2ludGluZ3RyaWFuZ2xlID0gMHgyNWIyOwogIHQuYmxhbmsgPSAweDI0MjM7CiAgdC5ibGluZWJlbG93ID0gMHgxZTA3OwogIHQuYmxvY2sgPSAweDI1ODg7CiAgdC5ibW9ub3NwYWNlID0gMHhmZjQyOwogIHQuYm9iYWltYWl0aGFpID0gMHgwZTFhOwogIHQuYm9oaXJhZ2FuYSA9IDB4MzA3YzsKICB0LmJva2F0YWthbmEgPSAweDMwZGM7CiAgdC5icGFyZW4gPSAweDI0OWQ7CiAgdC5icXNxdWFyZSA9IDB4MzNjMzsKICB0LmJyYWNlZXggPSAweGY4ZjQ7CiAgdC5icmFjZWxlZnQgPSAweDAwN2I7CiAgdC5icmFjZWxlZnRidCA9IDB4ZjhmMzsKICB0LmJyYWNlbGVmdG1pZCA9IDB4ZjhmMjsKICB0LmJyYWNlbGVmdG1vbm9zcGFjZSA9IDB4ZmY1YjsKICB0LmJyYWNlbGVmdHNtYWxsID0gMHhmZTViOwogIHQuYnJhY2VsZWZ0dHAgPSAweGY4ZjE7CiAgdC5icmFjZWxlZnR2ZXJ0aWNhbCA9IDB4ZmUzNzsKICB0LmJyYWNlcmlnaHQgPSAweDAwN2Q7CiAgdC5icmFjZXJpZ2h0YnQgPSAweGY4ZmU7CiAgdC5icmFjZXJpZ2h0bWlkID0gMHhmOGZkOwogIHQuYnJhY2VyaWdodG1vbm9zcGFjZSA9IDB4ZmY1ZDsKICB0LmJyYWNlcmlnaHRzbWFsbCA9IDB4ZmU1YzsKICB0LmJyYWNlcmlnaHR0cCA9IDB4ZjhmYzsKICB0LmJyYWNlcmlnaHR2ZXJ0aWNhbCA9IDB4ZmUzODsKICB0LmJyYWNrZXRsZWZ0ID0gMHgwMDViOwogIHQuYnJhY2tldGxlZnRidCA9IDB4ZjhmMDsKICB0LmJyYWNrZXRsZWZ0ZXggPSAweGY4ZWY7CiAgdC5icmFja2V0bGVmdG1vbm9zcGFjZSA9IDB4ZmYzYjsKICB0LmJyYWNrZXRsZWZ0dHAgPSAweGY4ZWU7CiAgdC5icmFja2V0cmlnaHQgPSAweDAwNWQ7CiAgdC5icmFja2V0cmlnaHRidCA9IDB4ZjhmYjsKICB0LmJyYWNrZXRyaWdodGV4ID0gMHhmOGZhOwogIHQuYnJhY2tldHJpZ2h0bW9ub3NwYWNlID0gMHhmZjNkOwogIHQuYnJhY2tldHJpZ2h0dHAgPSAweGY4Zjk7CiAgdC5icmV2ZSA9IDB4MDJkODsKICB0LmJyZXZlYmVsb3djbWIgPSAweDAzMmU7CiAgdC5icmV2ZWNtYiA9IDB4MDMwNjsKICB0LmJyZXZlaW52ZXJ0ZWRiZWxvd2NtYiA9IDB4MDMyZjsKICB0LmJyZXZlaW52ZXJ0ZWRjbWIgPSAweDAzMTE7CiAgdC5icmV2ZWludmVydGVkZG91YmxlY21iID0gMHgwMzYxOwogIHQuYnJpZGdlYmVsb3djbWIgPSAweDAzMmE7CiAgdC5icmlkZ2VpbnZlcnRlZGJlbG93Y21iID0gMHgwMzNhOwogIHQuYnJva2VuYmFyID0gMHgwMGE2OwogIHQuYnN0cm9rZSA9IDB4MDE4MDsKICB0LmJzdXBlcmlvciA9IDB4ZjZlYTsKICB0LmJ0b3BiYXIgPSAweDAxODM7CiAgdC5idWhpcmFnYW5hID0gMHgzMDc2OwogIHQuYnVrYXRha2FuYSA9IDB4MzBkNjsKICB0LmJ1bGxldCA9IDB4MjAyMjsKICB0LmJ1bGxldGludmVyc2UgPSAweDI1ZDg7CiAgdC5idWxsZXRvcGVyYXRvciA9IDB4MjIxOTsKICB0LmJ1bGxzZXllID0gMHgyNWNlOwogIHQuYyA9IDB4MDA2MzsKICB0LmNhYXJtZW5pYW4gPSAweDA1NmU7CiAgdC5jYWJlbmdhbGkgPSAweDA5OWE7CiAgdC5jYWN1dGUgPSAweDAxMDc7CiAgdC5jYWRldmEgPSAweDA5MWE7CiAgdC5jYWd1amFyYXRpID0gMHgwYTlhOwogIHQuY2FndXJtdWtoaSA9IDB4MGExYTsKICB0LmNhbHNxdWFyZSA9IDB4MzM4ODsKICB0LmNhbmRyYWJpbmR1YmVuZ2FsaSA9IDB4MDk4MTsKICB0LmNhbmRyYWJpbmR1Y21iID0gMHgwMzEwOwogIHQuY2FuZHJhYmluZHVkZXZhID0gMHgwOTAxOwogIHQuY2FuZHJhYmluZHVndWphcmF0aSA9IDB4MGE4MTsKICB0LmNhcHNsb2NrID0gMHgyMWVhOwogIHQuY2FyZW9mID0gMHgyMTA1OwogIHQuY2Fyb24gPSAweDAyYzc7CiAgdC5jYXJvbmJlbG93Y21iID0gMHgwMzJjOwogIHQuY2Fyb25jbWIgPSAweDAzMGM7CiAgdC5jYXJyaWFnZXJldHVybiA9IDB4MjFiNTsKICB0LmNib3BvbW9mbyA9IDB4MzExODsKICB0LmNjYXJvbiA9IDB4MDEwZDsKICB0LmNjZWRpbGxhID0gMHgwMGU3OwogIHQuY2NlZGlsbGFhY3V0ZSA9IDB4MWUwOTsKICB0LmNjaXJjbGUgPSAweDI0ZDI7CiAgdC5jY2lyY3VtZmxleCA9IDB4MDEwOTsKICB0LmNjdXJsID0gMHgwMjU1OwogIHQuY2RvdCA9IDB4MDEwYjsKICB0LmNkb3RhY2NlbnQgPSAweDAxMGI7CiAgdC5jZHNxdWFyZSA9IDB4MzNjNTsKICB0LmNlZGlsbGEgPSAweDAwYjg7CiAgdC5jZWRpbGxhY21iID0gMHgwMzI3OwogIHQuY2VudCA9IDB4MDBhMjsKICB0LmNlbnRpZ3JhZGUgPSAweDIxMDM7CiAgdC5jZW50aW5mZXJpb3IgPSAweGY2ZGY7CiAgdC5jZW50bW9ub3NwYWNlID0gMHhmZmUwOwogIHQuY2VudG9sZHN0eWxlID0gMHhmN2EyOwogIHQuY2VudHN1cGVyaW9yID0gMHhmNmUwOwogIHQuY2hhYXJtZW5pYW4gPSAweDA1Nzk7CiAgdC5jaGFiZW5nYWxpID0gMHgwOTliOwogIHQuY2hhZGV2YSA9IDB4MDkxYjsKICB0LmNoYWd1amFyYXRpID0gMHgwYTliOwogIHQuY2hhZ3VybXVraGkgPSAweDBhMWI7CiAgdC5jaGJvcG9tb2ZvID0gMHgzMTE0OwogIHQuY2hlYWJraGFzaWFuY3lyaWxsaWMgPSAweDA0YmQ7CiAgdC5jaGVja21hcmsgPSAweDI3MTM7CiAgdC5jaGVjeXJpbGxpYyA9IDB4MDQ0NzsKICB0LmNoZWRlc2NlbmRlcmFia2hhc2lhbmN5cmlsbGljID0gMHgwNGJmOwogIHQuY2hlZGVzY2VuZGVyY3lyaWxsaWMgPSAweDA0Yjc7CiAgdC5jaGVkaWVyZXNpc2N5cmlsbGljID0gMHgwNGY1OwogIHQuY2hlaGFybWVuaWFuID0gMHgwNTczOwogIHQuY2hla2hha2Fzc2lhbmN5cmlsbGljID0gMHgwNGNjOwogIHQuY2hldmVydGljYWxzdHJva2VjeXJpbGxpYyA9IDB4MDRiOTsKICB0LmNoaSA9IDB4MDNjNzsKICB0LmNoaWV1Y2hhY2lyY2xla29yZWFuID0gMHgzMjc3OwogIHQuY2hpZXVjaGFwYXJlbmtvcmVhbiA9IDB4MzIxNzsKICB0LmNoaWV1Y2hjaXJjbGVrb3JlYW4gPSAweDMyNjk7CiAgdC5jaGlldWNoa29yZWFuID0gMHgzMTRhOwogIHQuY2hpZXVjaHBhcmVua29yZWFuID0gMHgzMjA5OwogIHQuY2hvY2hhbmd0aGFpID0gMHgwZTBhOwogIHQuY2hvY2hhbnRoYWkgPSAweDBlMDg7CiAgdC5jaG9jaGluZ3RoYWkgPSAweDBlMDk7CiAgdC5jaG9jaG9ldGhhaSA9IDB4MGUwYzsKICB0LmNob29rID0gMHgwMTg4OwogIHQuY2lldWNhY2lyY2xla29yZWFuID0gMHgzMjc2OwogIHQuY2lldWNhcGFyZW5rb3JlYW4gPSAweDMyMTY7CiAgdC5jaWV1Y2NpcmNsZWtvcmVhbiA9IDB4MzI2ODsKICB0LmNpZXVja29yZWFuID0gMHgzMTQ4OwogIHQuY2lldWNwYXJlbmtvcmVhbiA9IDB4MzIwODsKICB0LmNpZXVjdXBhcmVua29yZWFuID0gMHgzMjFjOwogIHQuY2lyY2xlID0gMHgyNWNiOwogIHQuY2lyY2xlY29weXJ0ID0gMHgwMGE5OwogIHQuY2lyY2xlbXVsdGlwbHkgPSAweDIyOTc7CiAgdC5jaXJjbGVvdCA9IDB4MjI5OTsKICB0LmNpcmNsZXBsdXMgPSAweDIyOTU7CiAgdC5jaXJjbGVwb3N0YWxtYXJrID0gMHgzMDM2OwogIHQuY2lyY2xld2l0aGxlZnRoYWxmYmxhY2sgPSAweDI1ZDA7CiAgdC5jaXJjbGV3aXRocmlnaHRoYWxmYmxhY2sgPSAweDI1ZDE7CiAgdC5jaXJjdW1mbGV4ID0gMHgwMmM2OwogIHQuY2lyY3VtZmxleGJlbG93Y21iID0gMHgwMzJkOwogIHQuY2lyY3VtZmxleGNtYiA9IDB4MDMwMjsKICB0LmNsZWFyID0gMHgyMzI3OwogIHQuY2xpY2thbHZlb2xhciA9IDB4MDFjMjsKICB0LmNsaWNrZGVudGFsID0gMHgwMWMwOwogIHQuY2xpY2tsYXRlcmFsID0gMHgwMWMxOwogIHQuY2xpY2tyZXRyb2ZsZXggPSAweDAxYzM7CiAgdC5jbHViID0gMHgyNjYzOwogIHQuY2x1YnN1aXRibGFjayA9IDB4MjY2MzsKICB0LmNsdWJzdWl0d2hpdGUgPSAweDI2Njc7CiAgdC5jbWN1YmVkc3F1YXJlID0gMHgzM2E0OwogIHQuY21vbm9zcGFjZSA9IDB4ZmY0MzsKICB0LmNtc3F1YXJlZHNxdWFyZSA9IDB4MzNhMDsKICB0LmNvYXJtZW5pYW4gPSAweDA1ODE7CiAgdC5jb2xvbiA9IDB4MDAzYTsKICB0LmNvbG9ubW9uZXRhcnkgPSAweDIwYTE7CiAgdC5jb2xvbm1vbm9zcGFjZSA9IDB4ZmYxYTsKICB0LmNvbG9uc2lnbiA9IDB4MjBhMTsKICB0LmNvbG9uc21hbGwgPSAweGZlNTU7CiAgdC5jb2xvbnRyaWFuZ3VsYXJoYWxmbW9kID0gMHgwMmQxOwogIHQuY29sb250cmlhbmd1bGFybW9kID0gMHgwMmQwOwogIHQuY29tbWEgPSAweDAwMmM7CiAgdC5jb21tYWFib3ZlY21iID0gMHgwMzEzOwogIHQuY29tbWFhYm92ZXJpZ2h0Y21iID0gMHgwMzE1OwogIHQuY29tbWFhY2NlbnQgPSAweGY2YzM7CiAgdC5jb21tYWFyYWJpYyA9IDB4MDYwYzsKICB0LmNvbW1hYXJtZW5pYW4gPSAweDA1NWQ7CiAgdC5jb21tYWluZmVyaW9yID0gMHhmNmUxOwogIHQuY29tbWFtb25vc3BhY2UgPSAweGZmMGM7CiAgdC5jb21tYXJldmVyc2VkYWJvdmVjbWIgPSAweDAzMTQ7CiAgdC5jb21tYXJldmVyc2VkbW9kID0gMHgwMmJkOwogIHQuY29tbWFzbWFsbCA9IDB4ZmU1MDsKICB0LmNvbW1hc3VwZXJpb3IgPSAweGY2ZTI7CiAgdC5jb21tYXR1cm5lZGFib3ZlY21iID0gMHgwMzEyOwogIHQuY29tbWF0dXJuZWRtb2QgPSAweDAyYmI7CiAgdC5jb21wYXNzID0gMHgyNjNjOwogIHQuY29uZ3J1ZW50ID0gMHgyMjQ1OwogIHQuY29udG91cmludGVncmFsID0gMHgyMjJlOwogIHQuY29udHJvbCA9IDB4MjMwMzsKICB0LmNvbnRyb2xBQ0sgPSAweDAwMDY7CiAgdC5jb250cm9sQkVMID0gMHgwMDA3OwogIHQuY29udHJvbEJTID0gMHgwMDA4OwogIHQuY29udHJvbENBTiA9IDB4MDAxODsKICB0LmNvbnRyb2xDUiA9IDB4MDAwZDsKICB0LmNvbnRyb2xEQzEgPSAweDAwMTE7CiAgdC5jb250cm9sREMyID0gMHgwMDEyOwogIHQuY29udHJvbERDMyA9IDB4MDAxMzsKICB0LmNvbnRyb2xEQzQgPSAweDAwMTQ7CiAgdC5jb250cm9sREVMID0gMHgwMDdmOwogIHQuY29udHJvbERMRSA9IDB4MDAxMDsKICB0LmNvbnRyb2xFTSA9IDB4MDAxOTsKICB0LmNvbnRyb2xFTlEgPSAweDAwMDU7CiAgdC5jb250cm9sRU9UID0gMHgwMDA0OwogIHQuY29udHJvbEVTQyA9IDB4MDAxYjsKICB0LmNvbnRyb2xFVEIgPSAweDAwMTc7CiAgdC5jb250cm9sRVRYID0gMHgwMDAzOwogIHQuY29udHJvbEZGID0gMHgwMDBjOwogIHQuY29udHJvbEZTID0gMHgwMDFjOwogIHQuY29udHJvbEdTID0gMHgwMDFkOwogIHQuY29udHJvbEhUID0gMHgwMDA5OwogIHQuY29udHJvbExGID0gMHgwMDBhOwogIHQuY29udHJvbE5BSyA9IDB4MDAxNTsKICB0LmNvbnRyb2xOVUxMID0gMHgwMDAwOwogIHQuY29udHJvbFJTID0gMHgwMDFlOwogIHQuY29udHJvbFNJID0gMHgwMDBmOwogIHQuY29udHJvbFNPID0gMHgwMDBlOwogIHQuY29udHJvbFNPVCA9IDB4MDAwMjsKICB0LmNvbnRyb2xTVFggPSAweDAwMDE7CiAgdC5jb250cm9sU1VCID0gMHgwMDFhOwogIHQuY29udHJvbFNZTiA9IDB4MDAxNjsKICB0LmNvbnRyb2xVUyA9IDB4MDAxZjsKICB0LmNvbnRyb2xWVCA9IDB4MDAwYjsKICB0LmNvcHlyaWdodCA9IDB4MDBhOTsKICB0LmNvcHlyaWdodHNhbnMgPSAweGY4ZTk7CiAgdC5jb3B5cmlnaHRzZXJpZiA9IDB4ZjZkOTsKICB0LmNvcm5lcmJyYWNrZXRsZWZ0ID0gMHgzMDBjOwogIHQuY29ybmVyYnJhY2tldGxlZnRoYWxmd2lkdGggPSAweGZmNjI7CiAgdC5jb3JuZXJicmFja2V0bGVmdHZlcnRpY2FsID0gMHhmZTQxOwogIHQuY29ybmVyYnJhY2tldHJpZ2h0ID0gMHgzMDBkOwogIHQuY29ybmVyYnJhY2tldHJpZ2h0aGFsZndpZHRoID0gMHhmZjYzOwogIHQuY29ybmVyYnJhY2tldHJpZ2h0dmVydGljYWwgPSAweGZlNDI7CiAgdC5jb3Jwb3JhdGlvbnNxdWFyZSA9IDB4MzM3ZjsKICB0LmNvc3F1YXJlID0gMHgzM2M3OwogIHQuY292ZXJrZ3NxdWFyZSA9IDB4MzNjNjsKICB0LmNwYXJlbiA9IDB4MjQ5ZTsKICB0LmNydXplaXJvID0gMHgyMGEyOwogIHQuY3N0cmV0Y2hlZCA9IDB4MDI5NzsKICB0LmN1cmx5YW5kID0gMHgyMmNmOwogIHQuY3VybHlvciA9IDB4MjJjZTsKICB0LmN1cnJlbmN5ID0gMHgwMGE0OwogIHQuY3lyQnJldmUgPSAweGY2ZDE7CiAgdC5jeXJGbGV4ID0gMHhmNmQyOwogIHQuY3lyYnJldmUgPSAweGY2ZDQ7CiAgdC5jeXJmbGV4ID0gMHhmNmQ1OwogIHQuZCA9IDB4MDA2NDsKICB0LmRhYXJtZW5pYW4gPSAweDA1NjQ7CiAgdC5kYWJlbmdhbGkgPSAweDA5YTY7CiAgdC5kYWRhcmFiaWMgPSAweDA2MzY7CiAgdC5kYWRldmEgPSAweDA5MjY7CiAgdC5kYWRmaW5hbGFyYWJpYyA9IDB4ZmViZTsKICB0LmRhZGluaXRpYWxhcmFiaWMgPSAweGZlYmY7CiAgdC5kYWRtZWRpYWxhcmFiaWMgPSAweGZlYzA7CiAgdC5kYWdlc2ggPSAweDA1YmM7CiAgdC5kYWdlc2hoZWJyZXcgPSAweDA1YmM7CiAgdC5kYWdnZXIgPSAweDIwMjA7CiAgdC5kYWdnZXJkYmwgPSAweDIwMjE7CiAgdC5kYWd1amFyYXRpID0gMHgwYWE2OwogIHQuZGFndXJtdWtoaSA9IDB4MGEyNjsKICB0LmRhaGlyYWdhbmEgPSAweDMwNjA7CiAgdC5kYWthdGFrYW5hID0gMHgzMGMwOwogIHQuZGFsYXJhYmljID0gMHgwNjJmOwogIHQuZGFsZXQgPSAweDA1ZDM7CiAgdC5kYWxldGRhZ2VzaCA9IDB4ZmIzMzsKICB0LmRhbGV0ZGFnZXNoaGVicmV3ID0gMHhmYjMzOwogIHQuZGFsZXRoZWJyZXcgPSAweDA1ZDM7CiAgdC5kYWxmaW5hbGFyYWJpYyA9IDB4ZmVhYTsKICB0LmRhbW1hYXJhYmljID0gMHgwNjRmOwogIHQuZGFtbWFsb3dhcmFiaWMgPSAweDA2NGY7CiAgdC5kYW1tYXRhbmFsdG9uZWFyYWJpYyA9IDB4MDY0YzsKICB0LmRhbW1hdGFuYXJhYmljID0gMHgwNjRjOwogIHQuZGFuZGEgPSAweDA5NjQ7CiAgdC5kYXJnYWhlYnJldyA9IDB4MDVhNzsKICB0LmRhcmdhbGVmdGhlYnJldyA9IDB4MDVhNzsKICB0LmRhc2lhcG5ldW1hdGFjeXJpbGxpY2NtYiA9IDB4MDQ4NTsKICB0LmRibEdyYXZlID0gMHhmNmQzOwogIHQuZGJsYW5nbGVicmFja2V0bGVmdCA9IDB4MzAwYTsKICB0LmRibGFuZ2xlYnJhY2tldGxlZnR2ZXJ0aWNhbCA9IDB4ZmUzZDsKICB0LmRibGFuZ2xlYnJhY2tldHJpZ2h0ID0gMHgzMDBiOwogIHQuZGJsYW5nbGVicmFja2V0cmlnaHR2ZXJ0aWNhbCA9IDB4ZmUzZTsKICB0LmRibGFyY2hpbnZlcnRlZGJlbG93Y21iID0gMHgwMzJiOwogIHQuZGJsYXJyb3dsZWZ0ID0gMHgyMWQ0OwogIHQuZGJsYXJyb3dyaWdodCA9IDB4MjFkMjsKICB0LmRibGRhbmRhID0gMHgwOTY1OwogIHQuZGJsZ3JhdmUgPSAweGY2ZDY7CiAgdC5kYmxncmF2ZWNtYiA9IDB4MDMwZjsKICB0LmRibGludGVncmFsID0gMHgyMjJjOwogIHQuZGJsbG93bGluZSA9IDB4MjAxNzsKICB0LmRibGxvd2xpbmVjbWIgPSAweDAzMzM7CiAgdC5kYmxvdmVybGluZWNtYiA9IDB4MDMzZjsKICB0LmRibHByaW1lbW9kID0gMHgwMmJhOwogIHQuZGJsdmVydGljYWxiYXIgPSAweDIwMTY7CiAgdC5kYmx2ZXJ0aWNhbGxpbmVhYm92ZWNtYiA9IDB4MDMwZTsKICB0LmRib3BvbW9mbyA9IDB4MzEwOTsKICB0LmRic3F1YXJlID0gMHgzM2M4OwogIHQuZGNhcm9uID0gMHgwMTBmOwogIHQuZGNlZGlsbGEgPSAweDFlMTE7CiAgdC5kY2lyY2xlID0gMHgyNGQzOwogIHQuZGNpcmN1bWZsZXhiZWxvdyA9IDB4MWUxMzsKICB0LmRjcm9hdCA9IDB4MDExMTsKICB0LmRkYWJlbmdhbGkgPSAweDA5YTE7CiAgdC5kZGFkZXZhID0gMHgwOTIxOwogIHQuZGRhZ3VqYXJhdGkgPSAweDBhYTE7CiAgdC5kZGFndXJtdWtoaSA9IDB4MGEyMTsKICB0LmRkYWxhcmFiaWMgPSAweDA2ODg7CiAgdC5kZGFsZmluYWxhcmFiaWMgPSAweGZiODk7CiAgdC5kZGRoYWRldmEgPSAweDA5NWM7CiAgdC5kZGhhYmVuZ2FsaSA9IDB4MDlhMjsKICB0LmRkaGFkZXZhID0gMHgwOTIyOwogIHQuZGRoYWd1amFyYXRpID0gMHgwYWEyOwogIHQuZGRoYWd1cm11a2hpID0gMHgwYTIyOwogIHQuZGRvdGFjY2VudCA9IDB4MWUwYjsKICB0LmRkb3RiZWxvdyA9IDB4MWUwZDsKICB0LmRlY2ltYWxzZXBhcmF0b3JhcmFiaWMgPSAweDA2NmI7CiAgdC5kZWNpbWFsc2VwYXJhdG9ycGVyc2lhbiA9IDB4MDY2YjsKICB0LmRlY3lyaWxsaWMgPSAweDA0MzQ7CiAgdC5kZWdyZWUgPSAweDAwYjA7CiAgdC5kZWhpaGVicmV3ID0gMHgwNWFkOwogIHQuZGVoaXJhZ2FuYSA9IDB4MzA2NzsKICB0LmRlaWNvcHRpYyA9IDB4MDNlZjsKICB0LmRla2F0YWthbmEgPSAweDMwYzc7CiAgdC5kZWxldGVsZWZ0ID0gMHgyMzJiOwogIHQuZGVsZXRlcmlnaHQgPSAweDIzMjY7CiAgdC5kZWx0YSA9IDB4MDNiNDsKICB0LmRlbHRhdHVybmVkID0gMHgwMThkOwogIHQuZGVub21pbmF0b3JtaW51c29uZW51bWVyYXRvcmJlbmdhbGkgPSAweDA5Zjg7CiAgdC5kZXpoID0gMHgwMmE0OwogIHQuZGhhYmVuZ2FsaSA9IDB4MDlhNzsKICB0LmRoYWRldmEgPSAweDA5Mjc7CiAgdC5kaGFndWphcmF0aSA9IDB4MGFhNzsKICB0LmRoYWd1cm11a2hpID0gMHgwYTI3OwogIHQuZGhvb2sgPSAweDAyNTc7CiAgdC5kaWFseXRpa2F0b25vcyA9IDB4MDM4NTsKICB0LmRpYWx5dGlrYXRvbm9zY21iID0gMHgwMzQ0OwogIHQuZGlhbW9uZCA9IDB4MjY2NjsKICB0LmRpYW1vbmRzdWl0d2hpdGUgPSAweDI2NjI7CiAgdC5kaWVyZXNpcyA9IDB4MDBhODsKICB0LmRpZXJlc2lzYWN1dGUgPSAweGY2ZDc7CiAgdC5kaWVyZXNpc2JlbG93Y21iID0gMHgwMzI0OwogIHQuZGllcmVzaXNjbWIgPSAweDAzMDg7CiAgdC5kaWVyZXNpc2dyYXZlID0gMHhmNmQ4OwogIHQuZGllcmVzaXN0b25vcyA9IDB4MDM4NTsKICB0LmRpaGlyYWdhbmEgPSAweDMwNjI7CiAgdC5kaWthdGFrYW5hID0gMHgzMGMyOwogIHQuZGl0dG9tYXJrID0gMHgzMDAzOwogIHQuZGl2aWRlID0gMHgwMGY3OwogIHQuZGl2aWRlcyA9IDB4MjIyMzsKICB0LmRpdmlzaW9uc2xhc2ggPSAweDIyMTU7CiAgdC5kamVjeXJpbGxpYyA9IDB4MDQ1MjsKICB0LmRrc2hhZGUgPSAweDI1OTM7CiAgdC5kbGluZWJlbG93ID0gMHgxZTBmOwogIHQuZGxzcXVhcmUgPSAweDMzOTc7CiAgdC5kbWFjcm9uID0gMHgwMTExOwogIHQuZG1vbm9zcGFjZSA9IDB4ZmY0NDsKICB0LmRuYmxvY2sgPSAweDI1ODQ7CiAgdC5kb2NoYWRhdGhhaSA9IDB4MGUwZTsKICB0LmRvZGVrdGhhaSA9IDB4MGUxNDsKICB0LmRvaGlyYWdhbmEgPSAweDMwNjk7CiAgdC5kb2thdGFrYW5hID0gMHgzMGM5OwogIHQuZG9sbGFyID0gMHgwMDI0OwogIHQuZG9sbGFyaW5mZXJpb3IgPSAweGY2ZTM7CiAgdC5kb2xsYXJtb25vc3BhY2UgPSAweGZmMDQ7CiAgdC5kb2xsYXJvbGRzdHlsZSA9IDB4ZjcyNDsKICB0LmRvbGxhcnNtYWxsID0gMHhmZTY5OwogIHQuZG9sbGFyc3VwZXJpb3IgPSAweGY2ZTQ7CiAgdC5kb25nID0gMHgyMGFiOwogIHQuZG9ydXNxdWFyZSA9IDB4MzMyNjsKICB0LmRvdGFjY2VudCA9IDB4MDJkOTsKICB0LmRvdGFjY2VudGNtYiA9IDB4MDMwNzsKICB0LmRvdGJlbG93Y21iID0gMHgwMzIzOwogIHQuZG90YmVsb3djb21iID0gMHgwMzIzOwogIHQuZG90a2F0YWthbmEgPSAweDMwZmI7CiAgdC5kb3RsZXNzaSA9IDB4MDEzMTsKICB0LmRvdGxlc3NqID0gMHhmNmJlOwogIHQuZG90bGVzc2pzdHJva2Vob29rID0gMHgwMjg0OwogIHQuZG90bWF0aCA9IDB4MjJjNTsKICB0LmRvdHRlZGNpcmNsZSA9IDB4MjVjYzsKICB0LmRvdWJsZXlvZHBhdGFoID0gMHhmYjFmOwogIHQuZG91YmxleW9kcGF0YWhoZWJyZXcgPSAweGZiMWY7CiAgdC5kb3dudGFja2JlbG93Y21iID0gMHgwMzFlOwogIHQuZG93bnRhY2ttb2QgPSAweDAyZDU7CiAgdC5kcGFyZW4gPSAweDI0OWY7CiAgdC5kc3VwZXJpb3IgPSAweGY2ZWI7CiAgdC5kdGFpbCA9IDB4MDI1NjsKICB0LmR0b3BiYXIgPSAweDAxOGM7CiAgdC5kdWhpcmFnYW5hID0gMHgzMDY1OwogIHQuZHVrYXRha2FuYSA9IDB4MzBjNTsKICB0LmR6ID0gMHgwMWYzOwogIHQuZHphbHRvbmUgPSAweDAyYTM7CiAgdC5kemNhcm9uID0gMHgwMWM2OwogIHQuZHpjdXJsID0gMHgwMmE1OwogIHQuZHplYWJraGFzaWFuY3lyaWxsaWMgPSAweDA0ZTE7CiAgdC5kemVjeXJpbGxpYyA9IDB4MDQ1NTsKICB0LmR6aGVjeXJpbGxpYyA9IDB4MDQ1ZjsKICB0LmUgPSAweDAwNjU7CiAgdC5lYWN1dGUgPSAweDAwZTk7CiAgdC5lYXJ0aCA9IDB4MjY0MTsKICB0LmViZW5nYWxpID0gMHgwOThmOwogIHQuZWJvcG9tb2ZvID0gMHgzMTFjOwogIHQuZWJyZXZlID0gMHgwMTE1OwogIHQuZWNhbmRyYWRldmEgPSAweDA5MGQ7CiAgdC5lY2FuZHJhZ3VqYXJhdGkgPSAweDBhOGQ7CiAgdC5lY2FuZHJhdm93ZWxzaWduZGV2YSA9IDB4MDk0NTsKICB0LmVjYW5kcmF2b3dlbHNpZ25ndWphcmF0aSA9IDB4MGFjNTsKICB0LmVjYXJvbiA9IDB4MDExYjsKICB0LmVjZWRpbGxhYnJldmUgPSAweDFlMWQ7CiAgdC5lY2hhcm1lbmlhbiA9IDB4MDU2NTsKICB0LmVjaHlpd25hcm1lbmlhbiA9IDB4MDU4NzsKICB0LmVjaXJjbGUgPSAweDI0ZDQ7CiAgdC5lY2lyY3VtZmxleCA9IDB4MDBlYTsKICB0LmVjaXJjdW1mbGV4YWN1dGUgPSAweDFlYmY7CiAgdC5lY2lyY3VtZmxleGJlbG93ID0gMHgxZTE5OwogIHQuZWNpcmN1bWZsZXhkb3RiZWxvdyA9IDB4MWVjNzsKICB0LmVjaXJjdW1mbGV4Z3JhdmUgPSAweDFlYzE7CiAgdC5lY2lyY3VtZmxleGhvb2thYm92ZSA9IDB4MWVjMzsKICB0LmVjaXJjdW1mbGV4dGlsZGUgPSAweDFlYzU7CiAgdC5lY3lyaWxsaWMgPSAweDA0NTQ7CiAgdC5lZGJsZ3JhdmUgPSAweDAyMDU7CiAgdC5lZGV2YSA9IDB4MDkwZjsKICB0LmVkaWVyZXNpcyA9IDB4MDBlYjsKICB0LmVkb3QgPSAweDAxMTc7CiAgdC5lZG90YWNjZW50ID0gMHgwMTE3OwogIHQuZWRvdGJlbG93ID0gMHgxZWI5OwogIHQuZWVndXJtdWtoaSA9IDB4MGEwZjsKICB0LmVlbWF0cmFndXJtdWtoaSA9IDB4MGE0NzsKICB0LmVmY3lyaWxsaWMgPSAweDA0NDQ7CiAgdC5lZ3JhdmUgPSAweDAwZTg7CiAgdC5lZ3VqYXJhdGkgPSAweDBhOGY7CiAgdC5laGFybWVuaWFuID0gMHgwNTY3OwogIHQuZWhib3BvbW9mbyA9IDB4MzExZDsKICB0LmVoaXJhZ2FuYSA9IDB4MzA0ODsKICB0LmVob29rYWJvdmUgPSAweDFlYmI7CiAgdC5laWJvcG9tb2ZvID0gMHgzMTFmOwogIHQuZWlnaHQgPSAweDAwMzg7CiAgdC5laWdodGFyYWJpYyA9IDB4MDY2ODsKICB0LmVpZ2h0YmVuZ2FsaSA9IDB4MDllZTsKICB0LmVpZ2h0Y2lyY2xlID0gMHgyNDY3OwogIHQuZWlnaHRjaXJjbGVpbnZlcnNlc2Fuc3NlcmlmID0gMHgyNzkxOwogIHQuZWlnaHRkZXZhID0gMHgwOTZlOwogIHQuZWlnaHRlZW5jaXJjbGUgPSAweDI0NzE7CiAgdC5laWdodGVlbnBhcmVuID0gMHgyNDg1OwogIHQuZWlnaHRlZW5wZXJpb2QgPSAweDI0OTk7CiAgdC5laWdodGd1amFyYXRpID0gMHgwYWVlOwogIHQuZWlnaHRndXJtdWtoaSA9IDB4MGE2ZTsKICB0LmVpZ2h0aGFja2FyYWJpYyA9IDB4MDY2ODsKICB0LmVpZ2h0aGFuZ3pob3UgPSAweDMwMjg7CiAgdC5laWdodGhub3RlYmVhbWVkID0gMHgyNjZiOwogIHQuZWlnaHRpZGVvZ3JhcGhpY3BhcmVuID0gMHgzMjI3OwogIHQuZWlnaHRpbmZlcmlvciA9IDB4MjA4ODsKICB0LmVpZ2h0bW9ub3NwYWNlID0gMHhmZjE4OwogIHQuZWlnaHRvbGRzdHlsZSA9IDB4ZjczODsKICB0LmVpZ2h0cGFyZW4gPSAweDI0N2I7CiAgdC5laWdodHBlcmlvZCA9IDB4MjQ4ZjsKICB0LmVpZ2h0cGVyc2lhbiA9IDB4MDZmODsKICB0LmVpZ2h0cm9tYW4gPSAweDIxNzc7CiAgdC5laWdodHN1cGVyaW9yID0gMHgyMDc4OwogIHQuZWlnaHR0aGFpID0gMHgwZTU4OwogIHQuZWludmVydGVkYnJldmUgPSAweDAyMDc7CiAgdC5laW90aWZpZWRjeXJpbGxpYyA9IDB4MDQ2NTsKICB0LmVrYXRha2FuYSA9IDB4MzBhODsKICB0LmVrYXRha2FuYWhhbGZ3aWR0aCA9IDB4ZmY3NDsKICB0LmVrb25rYXJndXJtdWtoaSA9IDB4MGE3NDsKICB0LmVrb3JlYW4gPSAweDMxNTQ7CiAgdC5lbGN5cmlsbGljID0gMHgwNDNiOwogIHQuZWxlbWVudCA9IDB4MjIwODsKICB0LmVsZXZlbmNpcmNsZSA9IDB4MjQ2YTsKICB0LmVsZXZlbnBhcmVuID0gMHgyNDdlOwogIHQuZWxldmVucGVyaW9kID0gMHgyNDkyOwogIHQuZWxldmVucm9tYW4gPSAweDIxN2E7CiAgdC5lbGxpcHNpcyA9IDB4MjAyNjsKICB0LmVsbGlwc2lzdmVydGljYWwgPSAweDIyZWU7CiAgdC5lbWFjcm9uID0gMHgwMTEzOwogIHQuZW1hY3JvbmFjdXRlID0gMHgxZTE3OwogIHQuZW1hY3JvbmdyYXZlID0gMHgxZTE1OwogIHQuZW1jeXJpbGxpYyA9IDB4MDQzYzsKICB0LmVtZGFzaCA9IDB4MjAxNDsKICB0LmVtZGFzaHZlcnRpY2FsID0gMHhmZTMxOwogIHQuZW1vbm9zcGFjZSA9IDB4ZmY0NTsKICB0LmVtcGhhc2lzbWFya2FybWVuaWFuID0gMHgwNTViOwogIHQuZW1wdHlzZXQgPSAweDIyMDU7CiAgdC5lbmJvcG9tb2ZvID0gMHgzMTIzOwogIHQuZW5jeXJpbGxpYyA9IDB4MDQzZDsKICB0LmVuZGFzaCA9IDB4MjAxMzsKICB0LmVuZGFzaHZlcnRpY2FsID0gMHhmZTMyOwogIHQuZW5kZXNjZW5kZXJjeXJpbGxpYyA9IDB4MDRhMzsKICB0LmVuZyA9IDB4MDE0YjsKICB0LmVuZ2JvcG9tb2ZvID0gMHgzMTI1OwogIHQuZW5naGVjeXJpbGxpYyA9IDB4MDRhNTsKICB0LmVuaG9va2N5cmlsbGljID0gMHgwNGM4OwogIHQuZW5zcGFjZSA9IDB4MjAwMjsKICB0LmVvZ29uZWsgPSAweDAxMTk7CiAgdC5lb2tvcmVhbiA9IDB4MzE1MzsKICB0LmVvcGVuID0gMHgwMjViOwogIHQuZW9wZW5jbG9zZWQgPSAweDAyOWE7CiAgdC5lb3BlbnJldmVyc2VkID0gMHgwMjVjOwogIHQuZW9wZW5yZXZlcnNlZGNsb3NlZCA9IDB4MDI1ZTsKICB0LmVvcGVucmV2ZXJzZWRob29rID0gMHgwMjVkOwogIHQuZXBhcmVuID0gMHgyNGEwOwogIHQuZXBzaWxvbiA9IDB4MDNiNTsKICB0LmVwc2lsb250b25vcyA9IDB4MDNhZDsKICB0LmVxdWFsID0gMHgwMDNkOwogIHQuZXF1YWxtb25vc3BhY2UgPSAweGZmMWQ7CiAgdC5lcXVhbHNtYWxsID0gMHhmZTY2OwogIHQuZXF1YWxzdXBlcmlvciA9IDB4MjA3YzsKICB0LmVxdWl2YWxlbmNlID0gMHgyMjYxOwogIHQuZXJib3BvbW9mbyA9IDB4MzEyNjsKICB0LmVyY3lyaWxsaWMgPSAweDA0NDA7CiAgdC5lcmV2ZXJzZWQgPSAweDAyNTg7CiAgdC5lcmV2ZXJzZWRjeXJpbGxpYyA9IDB4MDQ0ZDsKICB0LmVzY3lyaWxsaWMgPSAweDA0NDE7CiAgdC5lc2Rlc2NlbmRlcmN5cmlsbGljID0gMHgwNGFiOwogIHQuZXNoID0gMHgwMjgzOwogIHQuZXNoY3VybCA9IDB4MDI4NjsKICB0LmVzaG9ydGRldmEgPSAweDA5MGU7CiAgdC5lc2hvcnR2b3dlbHNpZ25kZXZhID0gMHgwOTQ2OwogIHQuZXNocmV2ZXJzZWRsb29wID0gMHgwMWFhOwogIHQuZXNoc3F1YXRyZXZlcnNlZCA9IDB4MDI4NTsKICB0LmVzbWFsbGhpcmFnYW5hID0gMHgzMDQ3OwogIHQuZXNtYWxsa2F0YWthbmEgPSAweDMwYTc7CiAgdC5lc21hbGxrYXRha2FuYWhhbGZ3aWR0aCA9IDB4ZmY2YTsKICB0LmVzdGltYXRlZCA9IDB4MjEyZTsKICB0LmVzdXBlcmlvciA9IDB4ZjZlYzsKICB0LmV0YSA9IDB4MDNiNzsKICB0LmV0YXJtZW5pYW4gPSAweDA1Njg7CiAgdC5ldGF0b25vcyA9IDB4MDNhZTsKICB0LmV0aCA9IDB4MDBmMDsKICB0LmV0aWxkZSA9IDB4MWViZDsKICB0LmV0aWxkZWJlbG93ID0gMHgxZTFiOwogIHQuZXRuYWh0YWZvdWtoaGVicmV3ID0gMHgwNTkxOwogIHQuZXRuYWh0YWZvdWtobGVmdGhlYnJldyA9IDB4MDU5MTsKICB0LmV0bmFodGFoZWJyZXcgPSAweDA1OTE7CiAgdC5ldG5haHRhbGVmdGhlYnJldyA9IDB4MDU5MTsKICB0LmV0dXJuZWQgPSAweDAxZGQ7CiAgdC5ldWtvcmVhbiA9IDB4MzE2MTsKICB0LmV1cm8gPSAweDIwYWM7CiAgdC5ldm93ZWxzaWduYmVuZ2FsaSA9IDB4MDljNzsKICB0LmV2b3dlbHNpZ25kZXZhID0gMHgwOTQ3OwogIHQuZXZvd2Vsc2lnbmd1amFyYXRpID0gMHgwYWM3OwogIHQuZXhjbGFtID0gMHgwMDIxOwogIHQuZXhjbGFtYXJtZW5pYW4gPSAweDA1NWM7CiAgdC5leGNsYW1kYmwgPSAweDIwM2M7CiAgdC5leGNsYW1kb3duID0gMHgwMGExOwogIHQuZXhjbGFtZG93bnNtYWxsID0gMHhmN2ExOwogIHQuZXhjbGFtbW9ub3NwYWNlID0gMHhmZjAxOwogIHQuZXhjbGFtc21hbGwgPSAweGY3MjE7CiAgdC5leGlzdGVudGlhbCA9IDB4MjIwMzsKICB0LmV6aCA9IDB4MDI5MjsKICB0LmV6aGNhcm9uID0gMHgwMWVmOwogIHQuZXpoY3VybCA9IDB4MDI5MzsKICB0LmV6aHJldmVyc2VkID0gMHgwMWI5OwogIHQuZXpodGFpbCA9IDB4MDFiYTsKICB0LmYgPSAweDAwNjY7CiAgdC5mYWRldmEgPSAweDA5NWU7CiAgdC5mYWd1cm11a2hpID0gMHgwYTVlOwogIHQuZmFocmVuaGVpdCA9IDB4MjEwOTsKICB0LmZhdGhhYXJhYmljID0gMHgwNjRlOwogIHQuZmF0aGFsb3dhcmFiaWMgPSAweDA2NGU7CiAgdC5mYXRoYXRhbmFyYWJpYyA9IDB4MDY0YjsKICB0LmZib3BvbW9mbyA9IDB4MzEwODsKICB0LmZjaXJjbGUgPSAweDI0ZDU7CiAgdC5mZG90YWNjZW50ID0gMHgxZTFmOwogIHQuZmVoYXJhYmljID0gMHgwNjQxOwogIHQuZmVoYXJtZW5pYW4gPSAweDA1ODY7CiAgdC5mZWhmaW5hbGFyYWJpYyA9IDB4ZmVkMjsKICB0LmZlaGluaXRpYWxhcmFiaWMgPSAweGZlZDM7CiAgdC5mZWhtZWRpYWxhcmFiaWMgPSAweGZlZDQ7CiAgdC5mZWljb3B0aWMgPSAweDAzZTU7CiAgdC5mZW1hbGUgPSAweDI2NDA7CiAgdC5mZiA9IDB4ZmIwMDsKICB0LmZfZiA9IDB4ZmIwMDsKICB0LmZmaSA9IDB4ZmIwMzsKICB0LmZfZl9pID0gMHhmYjAzOwogIHQuZmZsID0gMHhmYjA0OwogIHQuZl9mX2wgPSAweGZiMDQ7CiAgdC5maSA9IDB4ZmIwMTsKICB0LmZfaSA9IDB4ZmIwMTsKICB0LmZpZnRlZW5jaXJjbGUgPSAweDI0NmU7CiAgdC5maWZ0ZWVucGFyZW4gPSAweDI0ODI7CiAgdC5maWZ0ZWVucGVyaW9kID0gMHgyNDk2OwogIHQuZmlndXJlZGFzaCA9IDB4MjAxMjsKICB0LmZpbGxlZGJveCA9IDB4MjVhMDsKICB0LmZpbGxlZHJlY3QgPSAweDI1YWM7CiAgdC5maW5hbGthZiA9IDB4MDVkYTsKICB0LmZpbmFsa2FmZGFnZXNoID0gMHhmYjNhOwogIHQuZmluYWxrYWZkYWdlc2hoZWJyZXcgPSAweGZiM2E7CiAgdC5maW5hbGthZmhlYnJldyA9IDB4MDVkYTsKICB0LmZpbmFsbWVtID0gMHgwNWRkOwogIHQuZmluYWxtZW1oZWJyZXcgPSAweDA1ZGQ7CiAgdC5maW5hbG51biA9IDB4MDVkZjsKICB0LmZpbmFsbnVuaGVicmV3ID0gMHgwNWRmOwogIHQuZmluYWxwZSA9IDB4MDVlMzsKICB0LmZpbmFscGVoZWJyZXcgPSAweDA1ZTM7CiAgdC5maW5hbHRzYWRpID0gMHgwNWU1OwogIHQuZmluYWx0c2FkaWhlYnJldyA9IDB4MDVlNTsKICB0LmZpcnN0dG9uZWNoaW5lc2UgPSAweDAyYzk7CiAgdC5maXNoZXllID0gMHgyNWM5OwogIHQuZml0YWN5cmlsbGljID0gMHgwNDczOwogIHQuZml2ZSA9IDB4MDAzNTsKICB0LmZpdmVhcmFiaWMgPSAweDA2NjU7CiAgdC5maXZlYmVuZ2FsaSA9IDB4MDllYjsKICB0LmZpdmVjaXJjbGUgPSAweDI0NjQ7CiAgdC5maXZlY2lyY2xlaW52ZXJzZXNhbnNzZXJpZiA9IDB4Mjc4ZTsKICB0LmZpdmVkZXZhID0gMHgwOTZiOwogIHQuZml2ZWVpZ2h0aHMgPSAweDIxNWQ7CiAgdC5maXZlZ3VqYXJhdGkgPSAweDBhZWI7CiAgdC5maXZlZ3VybXVraGkgPSAweDBhNmI7CiAgdC5maXZlaGFja2FyYWJpYyA9IDB4MDY2NTsKICB0LmZpdmVoYW5nemhvdSA9IDB4MzAyNTsKICB0LmZpdmVpZGVvZ3JhcGhpY3BhcmVuID0gMHgzMjI0OwogIHQuZml2ZWluZmVyaW9yID0gMHgyMDg1OwogIHQuZml2ZW1vbm9zcGFjZSA9IDB4ZmYxNTsKICB0LmZpdmVvbGRzdHlsZSA9IDB4ZjczNTsKICB0LmZpdmVwYXJlbiA9IDB4MjQ3ODsKICB0LmZpdmVwZXJpb2QgPSAweDI0OGM7CiAgdC5maXZlcGVyc2lhbiA9IDB4MDZmNTsKICB0LmZpdmVyb21hbiA9IDB4MjE3NDsKICB0LmZpdmVzdXBlcmlvciA9IDB4MjA3NTsKICB0LmZpdmV0aGFpID0gMHgwZTU1OwogIHQuZmwgPSAweGZiMDI7CiAgdC5mX2wgPSAweGZiMDI7CiAgdC5mbG9yaW4gPSAweDAxOTI7CiAgdC5mbW9ub3NwYWNlID0gMHhmZjQ2OwogIHQuZm1zcXVhcmUgPSAweDMzOTk7CiAgdC5mb2ZhbnRoYWkgPSAweDBlMWY7CiAgdC5mb2ZhdGhhaSA9IDB4MGUxZDsKICB0LmZvbmdtYW50aGFpID0gMHgwZTRmOwogIHQuZm9yYWxsID0gMHgyMjAwOwogIHQuZm91ciA9IDB4MDAzNDsKICB0LmZvdXJhcmFiaWMgPSAweDA2NjQ7CiAgdC5mb3VyYmVuZ2FsaSA9IDB4MDllYTsKICB0LmZvdXJjaXJjbGUgPSAweDI0NjM7CiAgdC5mb3VyY2lyY2xlaW52ZXJzZXNhbnNzZXJpZiA9IDB4Mjc4ZDsKICB0LmZvdXJkZXZhID0gMHgwOTZhOwogIHQuZm91cmd1amFyYXRpID0gMHgwYWVhOwogIHQuZm91cmd1cm11a2hpID0gMHgwYTZhOwogIHQuZm91cmhhY2thcmFiaWMgPSAweDA2NjQ7CiAgdC5mb3VyaGFuZ3pob3UgPSAweDMwMjQ7CiAgdC5mb3VyaWRlb2dyYXBoaWNwYXJlbiA9IDB4MzIyMzsKICB0LmZvdXJpbmZlcmlvciA9IDB4MjA4NDsKICB0LmZvdXJtb25vc3BhY2UgPSAweGZmMTQ7CiAgdC5mb3VybnVtZXJhdG9yYmVuZ2FsaSA9IDB4MDlmNzsKICB0LmZvdXJvbGRzdHlsZSA9IDB4ZjczNDsKICB0LmZvdXJwYXJlbiA9IDB4MjQ3NzsKICB0LmZvdXJwZXJpb2QgPSAweDI0OGI7CiAgdC5mb3VycGVyc2lhbiA9IDB4MDZmNDsKICB0LmZvdXJyb21hbiA9IDB4MjE3MzsKICB0LmZvdXJzdXBlcmlvciA9IDB4MjA3NDsKICB0LmZvdXJ0ZWVuY2lyY2xlID0gMHgyNDZkOwogIHQuZm91cnRlZW5wYXJlbiA9IDB4MjQ4MTsKICB0LmZvdXJ0ZWVucGVyaW9kID0gMHgyNDk1OwogIHQuZm91cnRoYWkgPSAweDBlNTQ7CiAgdC5mb3VydGh0b25lY2hpbmVzZSA9IDB4MDJjYjsKICB0LmZwYXJlbiA9IDB4MjRhMTsKICB0LmZyYWN0aW9uID0gMHgyMDQ0OwogIHQuZnJhbmMgPSAweDIwYTM7CiAgdC5nID0gMHgwMDY3OwogIHQuZ2FiZW5nYWxpID0gMHgwOTk3OwogIHQuZ2FjdXRlID0gMHgwMWY1OwogIHQuZ2FkZXZhID0gMHgwOTE3OwogIHQuZ2FmYXJhYmljID0gMHgwNmFmOwogIHQuZ2FmZmluYWxhcmFiaWMgPSAweGZiOTM7CiAgdC5nYWZpbml0aWFsYXJhYmljID0gMHhmYjk0OwogIHQuZ2FmbWVkaWFsYXJhYmljID0gMHhmYjk1OwogIHQuZ2FndWphcmF0aSA9IDB4MGE5NzsKICB0LmdhZ3VybXVraGkgPSAweDBhMTc7CiAgdC5nYWhpcmFnYW5hID0gMHgzMDRjOwogIHQuZ2FrYXRha2FuYSA9IDB4MzBhYzsKICB0LmdhbW1hID0gMHgwM2IzOwogIHQuZ2FtbWFsYXRpbnNtYWxsID0gMHgwMjYzOwogIHQuZ2FtbWFzdXBlcmlvciA9IDB4MDJlMDsKICB0LmdhbmdpYWNvcHRpYyA9IDB4MDNlYjsKICB0Lmdib3BvbW9mbyA9IDB4MzEwZDsKICB0LmdicmV2ZSA9IDB4MDExZjsKICB0LmdjYXJvbiA9IDB4MDFlNzsKICB0LmdjZWRpbGxhID0gMHgwMTIzOwogIHQuZ2NpcmNsZSA9IDB4MjRkNjsKICB0LmdjaXJjdW1mbGV4ID0gMHgwMTFkOwogIHQuZ2NvbW1hYWNjZW50ID0gMHgwMTIzOwogIHQuZ2RvdCA9IDB4MDEyMTsKICB0Lmdkb3RhY2NlbnQgPSAweDAxMjE7CiAgdC5nZWN5cmlsbGljID0gMHgwNDMzOwogIHQuZ2VoaXJhZ2FuYSA9IDB4MzA1MjsKICB0Lmdla2F0YWthbmEgPSAweDMwYjI7CiAgdC5nZW9tZXRyaWNhbGx5ZXF1YWwgPSAweDIyNTE7CiAgdC5nZXJlc2hhY2NlbnRoZWJyZXcgPSAweDA1OWM7CiAgdC5nZXJlc2hoZWJyZXcgPSAweDA1ZjM7CiAgdC5nZXJlc2htdXFkYW1oZWJyZXcgPSAweDA1OWQ7CiAgdC5nZXJtYW5kYmxzID0gMHgwMGRmOwogIHQuZ2Vyc2hheWltYWNjZW50aGVicmV3ID0gMHgwNTllOwogIHQuZ2Vyc2hheWltaGVicmV3ID0gMHgwNWY0OwogIHQuZ2V0YW1hcmsgPSAweDMwMTM7CiAgdC5naGFiZW5nYWxpID0gMHgwOTk4OwogIHQuZ2hhZGFybWVuaWFuID0gMHgwNTcyOwogIHQuZ2hhZGV2YSA9IDB4MDkxODsKICB0LmdoYWd1amFyYXRpID0gMHgwYTk4OwogIHQuZ2hhZ3VybXVraGkgPSAweDBhMTg7CiAgdC5naGFpbmFyYWJpYyA9IDB4MDYzYTsKICB0LmdoYWluZmluYWxhcmFiaWMgPSAweGZlY2U7CiAgdC5naGFpbmluaXRpYWxhcmFiaWMgPSAweGZlY2Y7CiAgdC5naGFpbm1lZGlhbGFyYWJpYyA9IDB4ZmVkMDsKICB0LmdoZW1pZGRsZWhvb2tjeXJpbGxpYyA9IDB4MDQ5NTsKICB0LmdoZXN0cm9rZWN5cmlsbGljID0gMHgwNDkzOwogIHQuZ2hldXB0dXJuY3lyaWxsaWMgPSAweDA0OTE7CiAgdC5naGhhZGV2YSA9IDB4MDk1YTsKICB0LmdoaGFndXJtdWtoaSA9IDB4MGE1YTsKICB0Lmdob29rID0gMHgwMjYwOwogIHQuZ2h6c3F1YXJlID0gMHgzMzkzOwogIHQuZ2loaXJhZ2FuYSA9IDB4MzA0ZTsKICB0Lmdpa2F0YWthbmEgPSAweDMwYWU7CiAgdC5naW1hcm1lbmlhbiA9IDB4MDU2MzsKICB0LmdpbWVsID0gMHgwNWQyOwogIHQuZ2ltZWxkYWdlc2ggPSAweGZiMzI7CiAgdC5naW1lbGRhZ2VzaGhlYnJldyA9IDB4ZmIzMjsKICB0LmdpbWVsaGVicmV3ID0gMHgwNWQyOwogIHQuZ2plY3lyaWxsaWMgPSAweDA0NTM7CiAgdC5nbG90dGFsaW52ZXJ0ZWRzdHJva2UgPSAweDAxYmU7CiAgdC5nbG90dGFsc3RvcCA9IDB4MDI5NDsKICB0Lmdsb3R0YWxzdG9waW52ZXJ0ZWQgPSAweDAyOTY7CiAgdC5nbG90dGFsc3RvcG1vZCA9IDB4MDJjMDsKICB0Lmdsb3R0YWxzdG9wcmV2ZXJzZWQgPSAweDAyOTU7CiAgdC5nbG90dGFsc3RvcHJldmVyc2VkbW9kID0gMHgwMmMxOwogIHQuZ2xvdHRhbHN0b3ByZXZlcnNlZHN1cGVyaW9yID0gMHgwMmU0OwogIHQuZ2xvdHRhbHN0b3BzdHJva2UgPSAweDAyYTE7CiAgdC5nbG90dGFsc3RvcHN0cm9rZXJldmVyc2VkID0gMHgwMmEyOwogIHQuZ21hY3JvbiA9IDB4MWUyMTsKICB0Lmdtb25vc3BhY2UgPSAweGZmNDc7CiAgdC5nb2hpcmFnYW5hID0gMHgzMDU0OwogIHQuZ29rYXRha2FuYSA9IDB4MzBiNDsKICB0LmdwYXJlbiA9IDB4MjRhMjsKICB0LmdwYXNxdWFyZSA9IDB4MzNhYzsKICB0LmdyYWRpZW50ID0gMHgyMjA3OwogIHQuZ3JhdmUgPSAweDAwNjA7CiAgdC5ncmF2ZWJlbG93Y21iID0gMHgwMzE2OwogIHQuZ3JhdmVjbWIgPSAweDAzMDA7CiAgdC5ncmF2ZWNvbWIgPSAweDAzMDA7CiAgdC5ncmF2ZWRldmEgPSAweDA5NTM7CiAgdC5ncmF2ZWxvd21vZCA9IDB4MDJjZTsKICB0LmdyYXZlbW9ub3NwYWNlID0gMHhmZjQwOwogIHQuZ3JhdmV0b25lY21iID0gMHgwMzQwOwogIHQuZ3JlYXRlciA9IDB4MDAzZTsKICB0LmdyZWF0ZXJlcXVhbCA9IDB4MjI2NTsKICB0LmdyZWF0ZXJlcXVhbG9ybGVzcyA9IDB4MjJkYjsKICB0LmdyZWF0ZXJtb25vc3BhY2UgPSAweGZmMWU7CiAgdC5ncmVhdGVyb3JlcXVpdmFsZW50ID0gMHgyMjczOwogIHQuZ3JlYXRlcm9ybGVzcyA9IDB4MjI3NzsKICB0LmdyZWF0ZXJvdmVyZXF1YWwgPSAweDIyNjc7CiAgdC5ncmVhdGVyc21hbGwgPSAweGZlNjU7CiAgdC5nc2NyaXB0ID0gMHgwMjYxOwogIHQuZ3N0cm9rZSA9IDB4MDFlNTsKICB0Lmd1aGlyYWdhbmEgPSAweDMwNTA7CiAgdC5ndWlsbGVtb3RsZWZ0ID0gMHgwMGFiOwogIHQuZ3VpbGxlbW90cmlnaHQgPSAweDAwYmI7CiAgdC5ndWlsc2luZ2xsZWZ0ID0gMHgyMDM5OwogIHQuZ3VpbHNpbmdscmlnaHQgPSAweDIwM2E7CiAgdC5ndWthdGFrYW5hID0gMHgzMGIwOwogIHQuZ3VyYW11c3F1YXJlID0gMHgzMzE4OwogIHQuZ3lzcXVhcmUgPSAweDMzYzk7CiAgdC5oID0gMHgwMDY4OwogIHQuaGFhYmtoYXNpYW5jeXJpbGxpYyA9IDB4MDRhOTsKICB0LmhhYWx0b25lYXJhYmljID0gMHgwNmMxOwogIHQuaGFiZW5nYWxpID0gMHgwOWI5OwogIHQuaGFkZXNjZW5kZXJjeXJpbGxpYyA9IDB4MDRiMzsKICB0LmhhZGV2YSA9IDB4MDkzOTsKICB0LmhhZ3VqYXJhdGkgPSAweDBhYjk7CiAgdC5oYWd1cm11a2hpID0gMHgwYTM5OwogIHQuaGFoYXJhYmljID0gMHgwNjJkOwogIHQuaGFoZmluYWxhcmFiaWMgPSAweGZlYTI7CiAgdC5oYWhpbml0aWFsYXJhYmljID0gMHhmZWEzOwogIHQuaGFoaXJhZ2FuYSA9IDB4MzA2ZjsKICB0LmhhaG1lZGlhbGFyYWJpYyA9IDB4ZmVhNDsKICB0LmhhaXR1c3F1YXJlID0gMHgzMzJhOwogIHQuaGFrYXRha2FuYSA9IDB4MzBjZjsKICB0Lmhha2F0YWthbmFoYWxmd2lkdGggPSAweGZmOGE7CiAgdC5oYWxhbnRndXJtdWtoaSA9IDB4MGE0ZDsKICB0LmhhbXphYXJhYmljID0gMHgwNjIxOwogIHQuaGFtemFsb3dhcmFiaWMgPSAweDA2MjE7CiAgdC5oYW5ndWxmaWxsZXIgPSAweDMxNjQ7CiAgdC5oYXJkc2lnbmN5cmlsbGljID0gMHgwNDRhOwogIHQuaGFycG9vbmxlZnRiYXJidXAgPSAweDIxYmM7CiAgdC5oYXJwb29ucmlnaHRiYXJidXAgPSAweDIxYzA7CiAgdC5oYXNxdWFyZSA9IDB4MzNjYTsKICB0LmhhdGFmcGF0YWggPSAweDA1YjI7CiAgdC5oYXRhZnBhdGFoMTYgPSAweDA1YjI7CiAgdC5oYXRhZnBhdGFoMjMgPSAweDA1YjI7CiAgdC5oYXRhZnBhdGFoMmYgPSAweDA1YjI7CiAgdC5oYXRhZnBhdGFoaGVicmV3ID0gMHgwNWIyOwogIHQuaGF0YWZwYXRhaG5hcnJvd2hlYnJldyA9IDB4MDViMjsKICB0LmhhdGFmcGF0YWhxdWFydGVyaGVicmV3ID0gMHgwNWIyOwogIHQuaGF0YWZwYXRhaHdpZGVoZWJyZXcgPSAweDA1YjI7CiAgdC5oYXRhZnFhbWF0cyA9IDB4MDViMzsKICB0LmhhdGFmcWFtYXRzMWIgPSAweDA1YjM7CiAgdC5oYXRhZnFhbWF0czI4ID0gMHgwNWIzOwogIHQuaGF0YWZxYW1hdHMzNCA9IDB4MDViMzsKICB0LmhhdGFmcWFtYXRzaGVicmV3ID0gMHgwNWIzOwogIHQuaGF0YWZxYW1hdHNuYXJyb3doZWJyZXcgPSAweDA1YjM7CiAgdC5oYXRhZnFhbWF0c3F1YXJ0ZXJoZWJyZXcgPSAweDA1YjM7CiAgdC5oYXRhZnFhbWF0c3dpZGVoZWJyZXcgPSAweDA1YjM7CiAgdC5oYXRhZnNlZ29sID0gMHgwNWIxOwogIHQuaGF0YWZzZWdvbDE3ID0gMHgwNWIxOwogIHQuaGF0YWZzZWdvbDI0ID0gMHgwNWIxOwogIHQuaGF0YWZzZWdvbDMwID0gMHgwNWIxOwogIHQuaGF0YWZzZWdvbGhlYnJldyA9IDB4MDViMTsKICB0LmhhdGFmc2Vnb2xuYXJyb3doZWJyZXcgPSAweDA1YjE7CiAgdC5oYXRhZnNlZ29scXVhcnRlcmhlYnJldyA9IDB4MDViMTsKICB0LmhhdGFmc2Vnb2x3aWRlaGVicmV3ID0gMHgwNWIxOwogIHQuaGJhciA9IDB4MDEyNzsKICB0Lmhib3BvbW9mbyA9IDB4MzEwZjsKICB0LmhicmV2ZWJlbG93ID0gMHgxZTJiOwogIHQuaGNlZGlsbGEgPSAweDFlMjk7CiAgdC5oY2lyY2xlID0gMHgyNGQ3OwogIHQuaGNpcmN1bWZsZXggPSAweDAxMjU7CiAgdC5oZGllcmVzaXMgPSAweDFlMjc7CiAgdC5oZG90YWNjZW50ID0gMHgxZTIzOwogIHQuaGRvdGJlbG93ID0gMHgxZTI1OwogIHQuaGUgPSAweDA1ZDQ7CiAgdC5oZWFydCA9IDB4MjY2NTsKICB0LmhlYXJ0c3VpdGJsYWNrID0gMHgyNjY1OwogIHQuaGVhcnRzdWl0d2hpdGUgPSAweDI2NjE7CiAgdC5oZWRhZ2VzaCA9IDB4ZmIzNDsKICB0LmhlZGFnZXNoaGVicmV3ID0gMHhmYjM0OwogIHQuaGVoYWx0b25lYXJhYmljID0gMHgwNmMxOwogIHQuaGVoYXJhYmljID0gMHgwNjQ3OwogIHQuaGVoZWJyZXcgPSAweDA1ZDQ7CiAgdC5oZWhmaW5hbGFsdG9uZWFyYWJpYyA9IDB4ZmJhNzsKICB0LmhlaGZpbmFsYWx0dHdvYXJhYmljID0gMHhmZWVhOwogIHQuaGVoZmluYWxhcmFiaWMgPSAweGZlZWE7CiAgdC5oZWhoYW16YWFib3ZlZmluYWxhcmFiaWMgPSAweGZiYTU7CiAgdC5oZWhoYW16YWFib3ZlaXNvbGF0ZWRhcmFiaWMgPSAweGZiYTQ7CiAgdC5oZWhpbml0aWFsYWx0b25lYXJhYmljID0gMHhmYmE4OwogIHQuaGVoaW5pdGlhbGFyYWJpYyA9IDB4ZmVlYjsKICB0LmhlaGlyYWdhbmEgPSAweDMwNzg7CiAgdC5oZWhtZWRpYWxhbHRvbmVhcmFiaWMgPSAweGZiYTk7CiAgdC5oZWhtZWRpYWxhcmFiaWMgPSAweGZlZWM7CiAgdC5oZWlzZWllcmFzcXVhcmUgPSAweDMzN2I7CiAgdC5oZWthdGFrYW5hID0gMHgzMGQ4OwogIHQuaGVrYXRha2FuYWhhbGZ3aWR0aCA9IDB4ZmY4ZDsKICB0Lmhla3V0YWFydXNxdWFyZSA9IDB4MzMzNjsKICB0Lmhlbmdob29rID0gMHgwMjY3OwogIHQuaGVydXR1c3F1YXJlID0gMHgzMzM5OwogIHQuaGV0ID0gMHgwNWQ3OwogIHQuaGV0aGVicmV3ID0gMHgwNWQ3OwogIHQuaGhvb2sgPSAweDAyNjY7CiAgdC5oaG9va3N1cGVyaW9yID0gMHgwMmIxOwogIHQuaGlldWhhY2lyY2xla29yZWFuID0gMHgzMjdiOwogIHQuaGlldWhhcGFyZW5rb3JlYW4gPSAweDMyMWI7CiAgdC5oaWV1aGNpcmNsZWtvcmVhbiA9IDB4MzI2ZDsKICB0LmhpZXVoa29yZWFuID0gMHgzMTRlOwogIHQuaGlldWhwYXJlbmtvcmVhbiA9IDB4MzIwZDsKICB0LmhpaGlyYWdhbmEgPSAweDMwNzI7CiAgdC5oaWthdGFrYW5hID0gMHgzMGQyOwogIHQuaGlrYXRha2FuYWhhbGZ3aWR0aCA9IDB4ZmY4YjsKICB0LmhpcmlxID0gMHgwNWI0OwogIHQuaGlyaXExNCA9IDB4MDViNDsKICB0LmhpcmlxMjEgPSAweDA1YjQ7CiAgdC5oaXJpcTJkID0gMHgwNWI0OwogIHQuaGlyaXFoZWJyZXcgPSAweDA1YjQ7CiAgdC5oaXJpcW5hcnJvd2hlYnJldyA9IDB4MDViNDsKICB0LmhpcmlxcXVhcnRlcmhlYnJldyA9IDB4MDViNDsKICB0Lmhpcmlxd2lkZWhlYnJldyA9IDB4MDViNDsKICB0LmhsaW5lYmVsb3cgPSAweDFlOTY7CiAgdC5obW9ub3NwYWNlID0gMHhmZjQ4OwogIHQuaG9hcm1lbmlhbiA9IDB4MDU3MDsKICB0LmhvaGlwdGhhaSA9IDB4MGUyYjsKICB0LmhvaGlyYWdhbmEgPSAweDMwN2I7CiAgdC5ob2thdGFrYW5hID0gMHgzMGRiOwogIHQuaG9rYXRha2FuYWhhbGZ3aWR0aCA9IDB4ZmY4ZTsKICB0LmhvbGFtID0gMHgwNWI5OwogIHQuaG9sYW0xOSA9IDB4MDViOTsKICB0LmhvbGFtMjYgPSAweDA1Yjk7CiAgdC5ob2xhbTMyID0gMHgwNWI5OwogIHQuaG9sYW1oZWJyZXcgPSAweDA1Yjk7CiAgdC5ob2xhbW5hcnJvd2hlYnJldyA9IDB4MDViOTsKICB0LmhvbGFtcXVhcnRlcmhlYnJldyA9IDB4MDViOTsKICB0LmhvbGFtd2lkZWhlYnJldyA9IDB4MDViOTsKICB0Lmhvbm9raHVrdGhhaSA9IDB4MGUyZTsKICB0Lmhvb2thYm92ZWNvbWIgPSAweDAzMDk7CiAgdC5ob29rY21iID0gMHgwMzA5OwogIHQuaG9va3BhbGF0YWxpemVkYmVsb3djbWIgPSAweDAzMjE7CiAgdC5ob29rcmV0cm9mbGV4YmVsb3djbWIgPSAweDAzMjI7CiAgdC5ob29uc3F1YXJlID0gMHgzMzQyOwogIHQuaG9yaWNvcHRpYyA9IDB4MDNlOTsKICB0Lmhvcml6b250YWxiYXIgPSAweDIwMTU7CiAgdC5ob3JuY21iID0gMHgwMzFiOwogIHQuaG90c3ByaW5ncyA9IDB4MjY2ODsKICB0LmhvdXNlID0gMHgyMzAyOwogIHQuaHBhcmVuID0gMHgyNGEzOwogIHQuaHN1cGVyaW9yID0gMHgwMmIwOwogIHQuaHR1cm5lZCA9IDB4MDI2NTsKICB0Lmh1aGlyYWdhbmEgPSAweDMwNzU7CiAgdC5odWlpdG9zcXVhcmUgPSAweDMzMzM7CiAgdC5odWthdGFrYW5hID0gMHgzMGQ1OwogIHQuaHVrYXRha2FuYWhhbGZ3aWR0aCA9IDB4ZmY4YzsKICB0Lmh1bmdhcnVtbGF1dCA9IDB4MDJkZDsKICB0Lmh1bmdhcnVtbGF1dGNtYiA9IDB4MDMwYjsKICB0Lmh2ID0gMHgwMTk1OwogIHQuaHlwaGVuID0gMHgwMDJkOwogIHQuaHlwaGVuaW5mZXJpb3IgPSAweGY2ZTU7CiAgdC5oeXBoZW5tb25vc3BhY2UgPSAweGZmMGQ7CiAgdC5oeXBoZW5zbWFsbCA9IDB4ZmU2MzsKICB0Lmh5cGhlbnN1cGVyaW9yID0gMHhmNmU2OwogIHQuaHlwaGVudHdvID0gMHgyMDEwOwogIHQuaSA9IDB4MDA2OTsKICB0LmlhY3V0ZSA9IDB4MDBlZDsKICB0LmlhY3lyaWxsaWMgPSAweDA0NGY7CiAgdC5pYmVuZ2FsaSA9IDB4MDk4NzsKICB0Lmlib3BvbW9mbyA9IDB4MzEyNzsKICB0LmlicmV2ZSA9IDB4MDEyZDsKICB0LmljYXJvbiA9IDB4MDFkMDsKICB0LmljaXJjbGUgPSAweDI0ZDg7CiAgdC5pY2lyY3VtZmxleCA9IDB4MDBlZTsKICB0LmljeXJpbGxpYyA9IDB4MDQ1NjsKICB0LmlkYmxncmF2ZSA9IDB4MDIwOTsKICB0LmlkZW9ncmFwaGVhcnRoY2lyY2xlID0gMHgzMjhmOwogIHQuaWRlb2dyYXBoZmlyZWNpcmNsZSA9IDB4MzI4YjsKICB0LmlkZW9ncmFwaGljYWxsaWFuY2VwYXJlbiA9IDB4MzIzZjsKICB0LmlkZW9ncmFwaGljY2FsbHBhcmVuID0gMHgzMjNhOwogIHQuaWRlb2dyYXBoaWNjZW50cmVjaXJjbGUgPSAweDMyYTU7CiAgdC5pZGVvZ3JhcGhpY2Nsb3NlID0gMHgzMDA2OwogIHQuaWRlb2dyYXBoaWNjb21tYSA9IDB4MzAwMTsKICB0LmlkZW9ncmFwaGljY29tbWFsZWZ0ID0gMHhmZjY0OwogIHQuaWRlb2dyYXBoaWNjb25ncmF0dWxhdGlvbnBhcmVuID0gMHgzMjM3OwogIHQuaWRlb2dyYXBoaWNjb3JyZWN0Y2lyY2xlID0gMHgzMmEzOwogIHQuaWRlb2dyYXBoaWNlYXJ0aHBhcmVuID0gMHgzMjJmOwogIHQuaWRlb2dyYXBoaWNlbnRlcnByaXNlcGFyZW4gPSAweDMyM2Q7CiAgdC5pZGVvZ3JhcGhpY2V4Y2VsbGVudGNpcmNsZSA9IDB4MzI5ZDsKICB0LmlkZW9ncmFwaGljZmVzdGl2YWxwYXJlbiA9IDB4MzI0MDsKICB0LmlkZW9ncmFwaGljZmluYW5jaWFsY2lyY2xlID0gMHgzMjk2OwogIHQuaWRlb2dyYXBoaWNmaW5hbmNpYWxwYXJlbiA9IDB4MzIzNjsKICB0LmlkZW9ncmFwaGljZmlyZXBhcmVuID0gMHgzMjJiOwogIHQuaWRlb2dyYXBoaWNoYXZlcGFyZW4gPSAweDMyMzI7CiAgdC5pZGVvZ3JhcGhpY2hpZ2hjaXJjbGUgPSAweDMyYTQ7CiAgdC5pZGVvZ3JhcGhpY2l0ZXJhdGlvbm1hcmsgPSAweDMwMDU7CiAgdC5pZGVvZ3JhcGhpY2xhYm9yY2lyY2xlID0gMHgzMjk4OwogIHQuaWRlb2dyYXBoaWNsYWJvcnBhcmVuID0gMHgzMjM4OwogIHQuaWRlb2dyYXBoaWNsZWZ0Y2lyY2xlID0gMHgzMmE3OwogIHQuaWRlb2dyYXBoaWNsb3djaXJjbGUgPSAweDMyYTY7CiAgdC5pZGVvZ3JhcGhpY21lZGljaW5lY2lyY2xlID0gMHgzMmE5OwogIHQuaWRlb2dyYXBoaWNtZXRhbHBhcmVuID0gMHgzMjJlOwogIHQuaWRlb2dyYXBoaWNtb29ucGFyZW4gPSAweDMyMmE7CiAgdC5pZGVvZ3JhcGhpY25hbWVwYXJlbiA9IDB4MzIzNDsKICB0LmlkZW9ncmFwaGljcGVyaW9kID0gMHgzMDAyOwogIHQuaWRlb2dyYXBoaWNwcmludGNpcmNsZSA9IDB4MzI5ZTsKICB0LmlkZW9ncmFwaGljcmVhY2hwYXJlbiA9IDB4MzI0MzsKICB0LmlkZW9ncmFwaGljcmVwcmVzZW50cGFyZW4gPSAweDMyMzk7CiAgdC5pZGVvZ3JhcGhpY3Jlc291cmNlcGFyZW4gPSAweDMyM2U7CiAgdC5pZGVvZ3JhcGhpY3JpZ2h0Y2lyY2xlID0gMHgzMmE4OwogIHQuaWRlb2dyYXBoaWNzZWNyZXRjaXJjbGUgPSAweDMyOTk7CiAgdC5pZGVvZ3JhcGhpY3NlbGZwYXJlbiA9IDB4MzI0MjsKICB0LmlkZW9ncmFwaGljc29jaWV0eXBhcmVuID0gMHgzMjMzOwogIHQuaWRlb2dyYXBoaWNzcGFjZSA9IDB4MzAwMDsKICB0LmlkZW9ncmFwaGljc3BlY2lhbHBhcmVuID0gMHgzMjM1OwogIHQuaWRlb2dyYXBoaWNzdG9ja3BhcmVuID0gMHgzMjMxOwogIHQuaWRlb2dyYXBoaWNzdHVkeXBhcmVuID0gMHgzMjNiOwogIHQuaWRlb2dyYXBoaWNzdW5wYXJlbiA9IDB4MzIzMDsKICB0LmlkZW9ncmFwaGljc3VwZXJ2aXNlcGFyZW4gPSAweDMyM2M7CiAgdC5pZGVvZ3JhcGhpY3dhdGVycGFyZW4gPSAweDMyMmM7CiAgdC5pZGVvZ3JhcGhpY3dvb2RwYXJlbiA9IDB4MzIyZDsKICB0LmlkZW9ncmFwaGljemVybyA9IDB4MzAwNzsKICB0LmlkZW9ncmFwaG1ldGFsY2lyY2xlID0gMHgzMjhlOwogIHQuaWRlb2dyYXBobW9vbmNpcmNsZSA9IDB4MzI4YTsKICB0LmlkZW9ncmFwaG5hbWVjaXJjbGUgPSAweDMyOTQ7CiAgdC5pZGVvZ3JhcGhzdW5jaXJjbGUgPSAweDMyOTA7CiAgdC5pZGVvZ3JhcGh3YXRlcmNpcmNsZSA9IDB4MzI4YzsKICB0LmlkZW9ncmFwaHdvb2RjaXJjbGUgPSAweDMyOGQ7CiAgdC5pZGV2YSA9IDB4MDkwNzsKICB0LmlkaWVyZXNpcyA9IDB4MDBlZjsKICB0LmlkaWVyZXNpc2FjdXRlID0gMHgxZTJmOwogIHQuaWRpZXJlc2lzY3lyaWxsaWMgPSAweDA0ZTU7CiAgdC5pZG90YmVsb3cgPSAweDFlY2I7CiAgdC5pZWJyZXZlY3lyaWxsaWMgPSAweDA0ZDc7CiAgdC5pZWN5cmlsbGljID0gMHgwNDM1OwogIHQuaWV1bmdhY2lyY2xla29yZWFuID0gMHgzMjc1OwogIHQuaWV1bmdhcGFyZW5rb3JlYW4gPSAweDMyMTU7CiAgdC5pZXVuZ2NpcmNsZWtvcmVhbiA9IDB4MzI2NzsKICB0LmlldW5na29yZWFuID0gMHgzMTQ3OwogIHQuaWV1bmdwYXJlbmtvcmVhbiA9IDB4MzIwNzsKICB0LmlncmF2ZSA9IDB4MDBlYzsKICB0LmlndWphcmF0aSA9IDB4MGE4NzsKICB0LmlndXJtdWtoaSA9IDB4MGEwNzsKICB0LmloaXJhZ2FuYSA9IDB4MzA0NDsKICB0Lmlob29rYWJvdmUgPSAweDFlYzk7CiAgdC5paWJlbmdhbGkgPSAweDA5ODg7CiAgdC5paWN5cmlsbGljID0gMHgwNDM4OwogIHQuaWlkZXZhID0gMHgwOTA4OwogIHQuaWlndWphcmF0aSA9IDB4MGE4ODsKICB0LmlpZ3VybXVraGkgPSAweDBhMDg7CiAgdC5paW1hdHJhZ3VybXVraGkgPSAweDBhNDA7CiAgdC5paW52ZXJ0ZWRicmV2ZSA9IDB4MDIwYjsKICB0Lmlpc2hvcnRjeXJpbGxpYyA9IDB4MDQzOTsKICB0Lmlpdm93ZWxzaWduYmVuZ2FsaSA9IDB4MDljMDsKICB0Lmlpdm93ZWxzaWduZGV2YSA9IDB4MDk0MDsKICB0Lmlpdm93ZWxzaWduZ3VqYXJhdGkgPSAweDBhYzA7CiAgdC5paiA9IDB4MDEzMzsKICB0LmlrYXRha2FuYSA9IDB4MzBhNDsKICB0LmlrYXRha2FuYWhhbGZ3aWR0aCA9IDB4ZmY3MjsKICB0Lmlrb3JlYW4gPSAweDMxNjM7CiAgdC5pbGRlID0gMHgwMmRjOwogIHQuaWx1eWhlYnJldyA9IDB4MDVhYzsKICB0LmltYWNyb24gPSAweDAxMmI7CiAgdC5pbWFjcm9uY3lyaWxsaWMgPSAweDA0ZTM7CiAgdC5pbWFnZW9yYXBwcm94aW1hdGVseWVxdWFsID0gMHgyMjUzOwogIHQuaW1hdHJhZ3VybXVraGkgPSAweDBhM2Y7CiAgdC5pbW9ub3NwYWNlID0gMHhmZjQ5OwogIHQuaW5jcmVtZW50ID0gMHgyMjA2OwogIHQuaW5maW5pdHkgPSAweDIyMWU7CiAgdC5pbmlhcm1lbmlhbiA9IDB4MDU2YjsKICB0LmludGVncmFsID0gMHgyMjJiOwogIHQuaW50ZWdyYWxib3R0b20gPSAweDIzMjE7CiAgdC5pbnRlZ3JhbGJ0ID0gMHgyMzIxOwogIHQuaW50ZWdyYWxleCA9IDB4ZjhmNTsKICB0LmludGVncmFsdG9wID0gMHgyMzIwOwogIHQuaW50ZWdyYWx0cCA9IDB4MjMyMDsKICB0LmludGVyc2VjdGlvbiA9IDB4MjIyOTsKICB0LmludGlzcXVhcmUgPSAweDMzMDU7CiAgdC5pbnZidWxsZXQgPSAweDI1ZDg7CiAgdC5pbnZjaXJjbGUgPSAweDI1ZDk7CiAgdC5pbnZzbWlsZWZhY2UgPSAweDI2M2I7CiAgdC5pb2N5cmlsbGljID0gMHgwNDUxOwogIHQuaW9nb25layA9IDB4MDEyZjsKICB0LmlvdGEgPSAweDAzYjk7CiAgdC5pb3RhZGllcmVzaXMgPSAweDAzY2E7CiAgdC5pb3RhZGllcmVzaXN0b25vcyA9IDB4MDM5MDsKICB0LmlvdGFsYXRpbiA9IDB4MDI2OTsKICB0LmlvdGF0b25vcyA9IDB4MDNhZjsKICB0LmlwYXJlbiA9IDB4MjRhNDsKICB0LmlyaWd1cm11a2hpID0gMHgwYTcyOwogIHQuaXNtYWxsaGlyYWdhbmEgPSAweDMwNDM7CiAgdC5pc21hbGxrYXRha2FuYSA9IDB4MzBhMzsKICB0LmlzbWFsbGthdGFrYW5haGFsZndpZHRoID0gMHhmZjY4OwogIHQuaXNzaGFyYmVuZ2FsaSA9IDB4MDlmYTsKICB0LmlzdHJva2UgPSAweDAyNjg7CiAgdC5pc3VwZXJpb3IgPSAweGY2ZWQ7CiAgdC5pdGVyYXRpb25oaXJhZ2FuYSA9IDB4MzA5ZDsKICB0Lml0ZXJhdGlvbmthdGFrYW5hID0gMHgzMGZkOwogIHQuaXRpbGRlID0gMHgwMTI5OwogIHQuaXRpbGRlYmVsb3cgPSAweDFlMmQ7CiAgdC5pdWJvcG9tb2ZvID0gMHgzMTI5OwogIHQuaXVjeXJpbGxpYyA9IDB4MDQ0ZTsKICB0Lml2b3dlbHNpZ25iZW5nYWxpID0gMHgwOWJmOwogIHQuaXZvd2Vsc2lnbmRldmEgPSAweDA5M2Y7CiAgdC5pdm93ZWxzaWduZ3VqYXJhdGkgPSAweDBhYmY7CiAgdC5pemhpdHNhY3lyaWxsaWMgPSAweDA0NzU7CiAgdC5pemhpdHNhZGJsZ3JhdmVjeXJpbGxpYyA9IDB4MDQ3NzsKICB0LmogPSAweDAwNmE7CiAgdC5qYWFybWVuaWFuID0gMHgwNTcxOwogIHQuamFiZW5nYWxpID0gMHgwOTljOwogIHQuamFkZXZhID0gMHgwOTFjOwogIHQuamFndWphcmF0aSA9IDB4MGE5YzsKICB0LmphZ3VybXVraGkgPSAweDBhMWM7CiAgdC5qYm9wb21vZm8gPSAweDMxMTA7CiAgdC5qY2Fyb24gPSAweDAxZjA7CiAgdC5qY2lyY2xlID0gMHgyNGQ5OwogIHQuamNpcmN1bWZsZXggPSAweDAxMzU7CiAgdC5qY3Jvc3NlZHRhaWwgPSAweDAyOWQ7CiAgdC5qZG90bGVzc3N0cm9rZSA9IDB4MDI1ZjsKICB0LmplY3lyaWxsaWMgPSAweDA0NTg7CiAgdC5qZWVtYXJhYmljID0gMHgwNjJjOwogIHQuamVlbWZpbmFsYXJhYmljID0gMHhmZTllOwogIHQuamVlbWluaXRpYWxhcmFiaWMgPSAweGZlOWY7CiAgdC5qZWVtbWVkaWFsYXJhYmljID0gMHhmZWEwOwogIHQuamVoYXJhYmljID0gMHgwNjk4OwogIHQuamVoZmluYWxhcmFiaWMgPSAweGZiOGI7CiAgdC5qaGFiZW5nYWxpID0gMHgwOTlkOwogIHQuamhhZGV2YSA9IDB4MDkxZDsKICB0LmpoYWd1amFyYXRpID0gMHgwYTlkOwogIHQuamhhZ3VybXVraGkgPSAweDBhMWQ7CiAgdC5qaGVoYXJtZW5pYW4gPSAweDA1N2I7CiAgdC5qaXMgPSAweDMwMDQ7CiAgdC5qbW9ub3NwYWNlID0gMHhmZjRhOwogIHQuanBhcmVuID0gMHgyNGE1OwogIHQuanN1cGVyaW9yID0gMHgwMmIyOwogIHQuayA9IDB4MDA2YjsKICB0LmthYmFzaGtpcmN5cmlsbGljID0gMHgwNGExOwogIHQua2FiZW5nYWxpID0gMHgwOTk1OwogIHQua2FjdXRlID0gMHgxZTMxOwogIHQua2FjeXJpbGxpYyA9IDB4MDQzYTsKICB0LmthZGVzY2VuZGVyY3lyaWxsaWMgPSAweDA0OWI7CiAgdC5rYWRldmEgPSAweDA5MTU7CiAgdC5rYWYgPSAweDA1ZGI7CiAgdC5rYWZhcmFiaWMgPSAweDA2NDM7CiAgdC5rYWZkYWdlc2ggPSAweGZiM2I7CiAgdC5rYWZkYWdlc2hoZWJyZXcgPSAweGZiM2I7CiAgdC5rYWZmaW5hbGFyYWJpYyA9IDB4ZmVkYTsKICB0LmthZmhlYnJldyA9IDB4MDVkYjsKICB0LmthZmluaXRpYWxhcmFiaWMgPSAweGZlZGI7CiAgdC5rYWZtZWRpYWxhcmFiaWMgPSAweGZlZGM7CiAgdC5rYWZyYWZlaGVicmV3ID0gMHhmYjRkOwogIHQua2FndWphcmF0aSA9IDB4MGE5NTsKICB0LmthZ3VybXVraGkgPSAweDBhMTU7CiAgdC5rYWhpcmFnYW5hID0gMHgzMDRiOwogIHQua2Fob29rY3lyaWxsaWMgPSAweDA0YzQ7CiAgdC5rYWthdGFrYW5hID0gMHgzMGFiOwogIHQua2FrYXRha2FuYWhhbGZ3aWR0aCA9IDB4ZmY3NjsKICB0LmthcHBhID0gMHgwM2JhOwogIHQua2FwcGFzeW1ib2xncmVlayA9IDB4MDNmMDsKICB0LmthcHllb3VubWlldW1rb3JlYW4gPSAweDMxNzE7CiAgdC5rYXB5ZW91bnBoaWV1cGhrb3JlYW4gPSAweDMxODQ7CiAgdC5rYXB5ZW91bnBpZXVwa29yZWFuID0gMHgzMTc4OwogIHQua2FweWVvdW5zc2FuZ3BpZXVwa29yZWFuID0gMHgzMTc5OwogIHQua2Fyb3JpaXNxdWFyZSA9IDB4MzMwZDsKICB0Lmthc2hpZGFhdXRvYXJhYmljID0gMHgwNjQwOwogIHQua2FzaGlkYWF1dG9ub3NpZGViZWFyaW5nYXJhYmljID0gMHgwNjQwOwogIHQua2FzbWFsbGthdGFrYW5hID0gMHgzMGY1OwogIHQua2FzcXVhcmUgPSAweDMzODQ7CiAgdC5rYXNyYWFyYWJpYyA9IDB4MDY1MDsKICB0Lmthc3JhdGFuYXJhYmljID0gMHgwNjRkOwogIHQua2FzdHJva2VjeXJpbGxpYyA9IDB4MDQ5ZjsKICB0LmthdGFoaXJhcHJvbG9uZ21hcmtoYWxmd2lkdGggPSAweGZmNzA7CiAgdC5rYXZlcnRpY2Fsc3Ryb2tlY3lyaWxsaWMgPSAweDA0OWQ7CiAgdC5rYm9wb21vZm8gPSAweDMxMGU7CiAgdC5rY2Fsc3F1YXJlID0gMHgzMzg5OwogIHQua2Nhcm9uID0gMHgwMWU5OwogIHQua2NlZGlsbGEgPSAweDAxMzc7CiAgdC5rY2lyY2xlID0gMHgyNGRhOwogIHQua2NvbW1hYWNjZW50ID0gMHgwMTM3OwogIHQua2RvdGJlbG93ID0gMHgxZTMzOwogIHQua2VoYXJtZW5pYW4gPSAweDA1ODQ7CiAgdC5rZWhpcmFnYW5hID0gMHgzMDUxOwogIHQua2VrYXRha2FuYSA9IDB4MzBiMTsKICB0Lmtla2F0YWthbmFoYWxmd2lkdGggPSAweGZmNzk7CiAgdC5rZW5hcm1lbmlhbiA9IDB4MDU2ZjsKICB0Lmtlc21hbGxrYXRha2FuYSA9IDB4MzBmNjsKICB0LmtncmVlbmxhbmRpYyA9IDB4MDEzODsKICB0LmtoYWJlbmdhbGkgPSAweDA5OTY7CiAgdC5raGFjeXJpbGxpYyA9IDB4MDQ0NTsKICB0LmtoYWRldmEgPSAweDA5MTY7CiAgdC5raGFndWphcmF0aSA9IDB4MGE5NjsKICB0LmtoYWd1cm11a2hpID0gMHgwYTE2OwogIHQua2hhaGFyYWJpYyA9IDB4MDYyZTsKICB0LmtoYWhmaW5hbGFyYWJpYyA9IDB4ZmVhNjsKICB0LmtoYWhpbml0aWFsYXJhYmljID0gMHhmZWE3OwogIHQua2hhaG1lZGlhbGFyYWJpYyA9IDB4ZmVhODsKICB0LmtoZWljb3B0aWMgPSAweDAzZTc7CiAgdC5raGhhZGV2YSA9IDB4MDk1OTsKICB0LmtoaGFndXJtdWtoaSA9IDB4MGE1OTsKICB0LmtoaWV1a2hhY2lyY2xla29yZWFuID0gMHgzMjc4OwogIHQua2hpZXVraGFwYXJlbmtvcmVhbiA9IDB4MzIxODsKICB0LmtoaWV1a2hjaXJjbGVrb3JlYW4gPSAweDMyNmE7CiAgdC5raGlldWtoa29yZWFuID0gMHgzMTRiOwogIHQua2hpZXVraHBhcmVua29yZWFuID0gMHgzMjBhOwogIHQua2hva2hhaXRoYWkgPSAweDBlMDI7CiAgdC5raG9raG9udGhhaSA9IDB4MGUwNTsKICB0Lmtob2todWF0dGhhaSA9IDB4MGUwMzsKICB0Lmtob2tod2FpdGhhaSA9IDB4MGUwNDsKICB0Lmtob211dHRoYWkgPSAweDBlNWI7CiAgdC5raG9vayA9IDB4MDE5OTsKICB0Lmtob3Jha2hhbmd0aGFpID0gMHgwZTA2OwogIHQua2h6c3F1YXJlID0gMHgzMzkxOwogIHQua2loaXJhZ2FuYSA9IDB4MzA0ZDsKICB0Lmtpa2F0YWthbmEgPSAweDMwYWQ7CiAgdC5raWthdGFrYW5haGFsZndpZHRoID0gMHhmZjc3OwogIHQua2lyb2d1cmFtdXNxdWFyZSA9IDB4MzMxNTsKICB0Lmtpcm9tZWV0b3J1c3F1YXJlID0gMHgzMzE2OwogIHQua2lyb3NxdWFyZSA9IDB4MzMxNDsKICB0LmtpeWVva2FjaXJjbGVrb3JlYW4gPSAweDMyNmU7CiAgdC5raXllb2thcGFyZW5rb3JlYW4gPSAweDMyMGU7CiAgdC5raXllb2tjaXJjbGVrb3JlYW4gPSAweDMyNjA7CiAgdC5raXllb2trb3JlYW4gPSAweDMxMzE7CiAgdC5raXllb2twYXJlbmtvcmVhbiA9IDB4MzIwMDsKICB0LmtpeWVva3Npb3Nrb3JlYW4gPSAweDMxMzM7CiAgdC5ramVjeXJpbGxpYyA9IDB4MDQ1YzsKICB0LmtsaW5lYmVsb3cgPSAweDFlMzU7CiAgdC5rbHNxdWFyZSA9IDB4MzM5ODsKICB0LmttY3ViZWRzcXVhcmUgPSAweDMzYTY7CiAgdC5rbW9ub3NwYWNlID0gMHhmZjRiOwogIHQua21zcXVhcmVkc3F1YXJlID0gMHgzM2EyOwogIHQua29oaXJhZ2FuYSA9IDB4MzA1MzsKICB0LmtvaG1zcXVhcmUgPSAweDMzYzA7CiAgdC5rb2thaXRoYWkgPSAweDBlMDE7CiAgdC5rb2thdGFrYW5hID0gMHgzMGIzOwogIHQua29rYXRha2FuYWhhbGZ3aWR0aCA9IDB4ZmY3YTsKICB0Lmtvb3Bvc3F1YXJlID0gMHgzMzFlOwogIHQua29wcGFjeXJpbGxpYyA9IDB4MDQ4MTsKICB0LmtvcmVhbnN0YW5kYXJkc3ltYm9sID0gMHgzMjdmOwogIHQua29yb25pc2NtYiA9IDB4MDM0MzsKICB0LmtwYXJlbiA9IDB4MjRhNjsKICB0LmtwYXNxdWFyZSA9IDB4MzNhYTsKICB0LmtzaWN5cmlsbGljID0gMHgwNDZmOwogIHQua3RzcXVhcmUgPSAweDMzY2Y7CiAgdC5rdHVybmVkID0gMHgwMjllOwogIHQua3VoaXJhZ2FuYSA9IDB4MzA0ZjsKICB0Lmt1a2F0YWthbmEgPSAweDMwYWY7CiAgdC5rdWthdGFrYW5haGFsZndpZHRoID0gMHhmZjc4OwogIHQua3ZzcXVhcmUgPSAweDMzYjg7CiAgdC5rd3NxdWFyZSA9IDB4MzNiZTsKICB0LmwgPSAweDAwNmM7CiAgdC5sYWJlbmdhbGkgPSAweDA5YjI7CiAgdC5sYWN1dGUgPSAweDAxM2E7CiAgdC5sYWRldmEgPSAweDA5MzI7CiAgdC5sYWd1amFyYXRpID0gMHgwYWIyOwogIHQubGFndXJtdWtoaSA9IDB4MGEzMjsKICB0Lmxha2toYW5neWFvdGhhaSA9IDB4MGU0NTsKICB0LmxhbWFsZWZmaW5hbGFyYWJpYyA9IDB4ZmVmYzsKICB0LmxhbWFsZWZoYW16YWFib3ZlZmluYWxhcmFiaWMgPSAweGZlZjg7CiAgdC5sYW1hbGVmaGFtemFhYm92ZWlzb2xhdGVkYXJhYmljID0gMHhmZWY3OwogIHQubGFtYWxlZmhhbXphYmVsb3dmaW5hbGFyYWJpYyA9IDB4ZmVmYTsKICB0LmxhbWFsZWZoYW16YWJlbG93aXNvbGF0ZWRhcmFiaWMgPSAweGZlZjk7CiAgdC5sYW1hbGVmaXNvbGF0ZWRhcmFiaWMgPSAweGZlZmI7CiAgdC5sYW1hbGVmbWFkZGFhYm92ZWZpbmFsYXJhYmljID0gMHhmZWY2OwogIHQubGFtYWxlZm1hZGRhYWJvdmVpc29sYXRlZGFyYWJpYyA9IDB4ZmVmNTsKICB0LmxhbWFyYWJpYyA9IDB4MDY0NDsKICB0LmxhbWJkYSA9IDB4MDNiYjsKICB0LmxhbWJkYXN0cm9rZSA9IDB4MDE5YjsKICB0LmxhbWVkID0gMHgwNWRjOwogIHQubGFtZWRkYWdlc2ggPSAweGZiM2M7CiAgdC5sYW1lZGRhZ2VzaGhlYnJldyA9IDB4ZmIzYzsKICB0LmxhbWVkaGVicmV3ID0gMHgwNWRjOwogIHQubGFtZmluYWxhcmFiaWMgPSAweGZlZGU7CiAgdC5sYW1oYWhpbml0aWFsYXJhYmljID0gMHhmY2NhOwogIHQubGFtaW5pdGlhbGFyYWJpYyA9IDB4ZmVkZjsKICB0LmxhbWplZW1pbml0aWFsYXJhYmljID0gMHhmY2M5OwogIHQubGFta2hhaGluaXRpYWxhcmFiaWMgPSAweGZjY2I7CiAgdC5sYW1sYW1oZWhpc29sYXRlZGFyYWJpYyA9IDB4ZmRmMjsKICB0LmxhbW1lZGlhbGFyYWJpYyA9IDB4ZmVlMDsKICB0LmxhbW1lZW1oYWhpbml0aWFsYXJhYmljID0gMHhmZDg4OwogIHQubGFtbWVlbWluaXRpYWxhcmFiaWMgPSAweGZjY2M7CiAgdC5sYXJnZWNpcmNsZSA9IDB4MjVlZjsKICB0LmxiYXIgPSAweDAxOWE7CiAgdC5sYmVsdCA9IDB4MDI2YzsKICB0Lmxib3BvbW9mbyA9IDB4MzEwYzsKICB0LmxjYXJvbiA9IDB4MDEzZTsKICB0LmxjZWRpbGxhID0gMHgwMTNjOwogIHQubGNpcmNsZSA9IDB4MjRkYjsKICB0LmxjaXJjdW1mbGV4YmVsb3cgPSAweDFlM2Q7CiAgdC5sY29tbWFhY2NlbnQgPSAweDAxM2M7CiAgdC5sZG90ID0gMHgwMTQwOwogIHQubGRvdGFjY2VudCA9IDB4MDE0MDsKICB0Lmxkb3RiZWxvdyA9IDB4MWUzNzsKICB0Lmxkb3RiZWxvd21hY3JvbiA9IDB4MWUzOTsKICB0LmxlZnRhbmdsZWFib3ZlY21iID0gMHgwMzFhOwogIHQubGVmdHRhY2tiZWxvd2NtYiA9IDB4MDMxODsKICB0Lmxlc3MgPSAweDAwM2M7CiAgdC5sZXNzZXF1YWwgPSAweDIyNjQ7CiAgdC5sZXNzZXF1YWxvcmdyZWF0ZXIgPSAweDIyZGE7CiAgdC5sZXNzbW9ub3NwYWNlID0gMHhmZjFjOwogIHQubGVzc29yZXF1aXZhbGVudCA9IDB4MjI3MjsKICB0Lmxlc3NvcmdyZWF0ZXIgPSAweDIyNzY7CiAgdC5sZXNzb3ZlcmVxdWFsID0gMHgyMjY2OwogIHQubGVzc3NtYWxsID0gMHhmZTY0OwogIHQubGV6aCA9IDB4MDI2ZTsKICB0LmxmYmxvY2sgPSAweDI1OGM7CiAgdC5saG9va3JldHJvZmxleCA9IDB4MDI2ZDsKICB0LmxpcmEgPSAweDIwYTQ7CiAgdC5saXduYXJtZW5pYW4gPSAweDA1NmM7CiAgdC5saiA9IDB4MDFjOTsKICB0LmxqZWN5cmlsbGljID0gMHgwNDU5OwogIHQubGwgPSAweGY2YzA7CiAgdC5sbGFkZXZhID0gMHgwOTMzOwogIHQubGxhZ3VqYXJhdGkgPSAweDBhYjM7CiAgdC5sbGluZWJlbG93ID0gMHgxZTNiOwogIHQubGxsYWRldmEgPSAweDA5MzQ7CiAgdC5sbHZvY2FsaWNiZW5nYWxpID0gMHgwOWUxOwogIHQubGx2b2NhbGljZGV2YSA9IDB4MDk2MTsKICB0Lmxsdm9jYWxpY3Zvd2Vsc2lnbmJlbmdhbGkgPSAweDA5ZTM7CiAgdC5sbHZvY2FsaWN2b3dlbHNpZ25kZXZhID0gMHgwOTYzOwogIHQubG1pZGRsZXRpbGRlID0gMHgwMjZiOwogIHQubG1vbm9zcGFjZSA9IDB4ZmY0YzsKICB0Lmxtc3F1YXJlID0gMHgzM2QwOwogIHQubG9jaHVsYXRoYWkgPSAweDBlMmM7CiAgdC5sb2dpY2FsYW5kID0gMHgyMjI3OwogIHQubG9naWNhbG5vdCA9IDB4MDBhYzsKICB0LmxvZ2ljYWxub3RyZXZlcnNlZCA9IDB4MjMxMDsKICB0LmxvZ2ljYWxvciA9IDB4MjIyODsKICB0LmxvbGluZ3RoYWkgPSAweDBlMjU7CiAgdC5sb25ncyA9IDB4MDE3ZjsKICB0Lmxvd2xpbmVjZW50ZXJsaW5lID0gMHhmZTRlOwogIHQubG93bGluZWNtYiA9IDB4MDMzMjsKICB0Lmxvd2xpbmVkYXNoZWQgPSAweGZlNGQ7CiAgdC5sb3plbmdlID0gMHgyNWNhOwogIHQubHBhcmVuID0gMHgyNGE3OwogIHQubHNsYXNoID0gMHgwMTQyOwogIHQubHNxdWFyZSA9IDB4MjExMzsKICB0LmxzdXBlcmlvciA9IDB4ZjZlZTsKICB0Lmx0c2hhZGUgPSAweDI1OTE7CiAgdC5sdXRoYWkgPSAweDBlMjY7CiAgdC5sdm9jYWxpY2JlbmdhbGkgPSAweDA5OGM7CiAgdC5sdm9jYWxpY2RldmEgPSAweDA5MGM7CiAgdC5sdm9jYWxpY3Zvd2Vsc2lnbmJlbmdhbGkgPSAweDA5ZTI7CiAgdC5sdm9jYWxpY3Zvd2Vsc2lnbmRldmEgPSAweDA5NjI7CiAgdC5seHNxdWFyZSA9IDB4MzNkMzsKICB0Lm0gPSAweDAwNmQ7CiAgdC5tYWJlbmdhbGkgPSAweDA5YWU7CiAgdC5tYWNyb24gPSAweDAwYWY7CiAgdC5tYWNyb25iZWxvd2NtYiA9IDB4MDMzMTsKICB0Lm1hY3JvbmNtYiA9IDB4MDMwNDsKICB0Lm1hY3Jvbmxvd21vZCA9IDB4MDJjZDsKICB0Lm1hY3Jvbm1vbm9zcGFjZSA9IDB4ZmZlMzsKICB0Lm1hY3V0ZSA9IDB4MWUzZjsKICB0Lm1hZGV2YSA9IDB4MDkyZTsKICB0Lm1hZ3VqYXJhdGkgPSAweDBhYWU7CiAgdC5tYWd1cm11a2hpID0gMHgwYTJlOwogIHQubWFoYXBha2hoZWJyZXcgPSAweDA1YTQ7CiAgdC5tYWhhcGFraGxlZnRoZWJyZXcgPSAweDA1YTQ7CiAgdC5tYWhpcmFnYW5hID0gMHgzMDdlOwogIHQubWFpY2hhdHRhd2Fsb3dsZWZ0dGhhaSA9IDB4Zjg5NTsKICB0Lm1haWNoYXR0YXdhbG93cmlnaHR0aGFpID0gMHhmODk0OwogIHQubWFpY2hhdHRhd2F0aGFpID0gMHgwZTRiOwogIHQubWFpY2hhdHRhd2F1cHBlcmxlZnR0aGFpID0gMHhmODkzOwogIHQubWFpZWtsb3dsZWZ0dGhhaSA9IDB4Zjg4YzsKICB0Lm1haWVrbG93cmlnaHR0aGFpID0gMHhmODhiOwogIHQubWFpZWt0aGFpID0gMHgwZTQ4OwogIHQubWFpZWt1cHBlcmxlZnR0aGFpID0gMHhmODhhOwogIHQubWFpaGFuYWthdGxlZnR0aGFpID0gMHhmODg0OwogIHQubWFpaGFuYWthdHRoYWkgPSAweDBlMzE7CiAgdC5tYWl0YWlraHVsZWZ0dGhhaSA9IDB4Zjg4OTsKICB0Lm1haXRhaWtodXRoYWkgPSAweDBlNDc7CiAgdC5tYWl0aG9sb3dsZWZ0dGhhaSA9IDB4Zjg4ZjsKICB0Lm1haXRob2xvd3JpZ2h0dGhhaSA9IDB4Zjg4ZTsKICB0Lm1haXRob3RoYWkgPSAweDBlNDk7CiAgdC5tYWl0aG91cHBlcmxlZnR0aGFpID0gMHhmODhkOwogIHQubWFpdHJpbG93bGVmdHRoYWkgPSAweGY4OTI7CiAgdC5tYWl0cmlsb3dyaWdodHRoYWkgPSAweGY4OTE7CiAgdC5tYWl0cml0aGFpID0gMHgwZTRhOwogIHQubWFpdHJpdXBwZXJsZWZ0dGhhaSA9IDB4Zjg5MDsKICB0Lm1haXlhbW9rdGhhaSA9IDB4MGU0NjsKICB0Lm1ha2F0YWthbmEgPSAweDMwZGU7CiAgdC5tYWthdGFrYW5haGFsZndpZHRoID0gMHhmZjhmOwogIHQubWFsZSA9IDB4MjY0MjsKICB0Lm1hbnN5b25zcXVhcmUgPSAweDMzNDc7CiAgdC5tYXFhZmhlYnJldyA9IDB4MDViZTsKICB0Lm1hcnMgPSAweDI2NDI7CiAgdC5tYXNvcmFjaXJjbGVoZWJyZXcgPSAweDA1YWY7CiAgdC5tYXNxdWFyZSA9IDB4MzM4MzsKICB0Lm1ib3BvbW9mbyA9IDB4MzEwNzsKICB0Lm1ic3F1YXJlID0gMHgzM2Q0OwogIHQubWNpcmNsZSA9IDB4MjRkYzsKICB0Lm1jdWJlZHNxdWFyZSA9IDB4MzNhNTsKICB0Lm1kb3RhY2NlbnQgPSAweDFlNDE7CiAgdC5tZG90YmVsb3cgPSAweDFlNDM7CiAgdC5tZWVtYXJhYmljID0gMHgwNjQ1OwogIHQubWVlbWZpbmFsYXJhYmljID0gMHhmZWUyOwogIHQubWVlbWluaXRpYWxhcmFiaWMgPSAweGZlZTM7CiAgdC5tZWVtbWVkaWFsYXJhYmljID0gMHhmZWU0OwogIHQubWVlbW1lZW1pbml0aWFsYXJhYmljID0gMHhmY2QxOwogIHQubWVlbW1lZW1pc29sYXRlZGFyYWJpYyA9IDB4ZmM0ODsKICB0Lm1lZXRvcnVzcXVhcmUgPSAweDMzNGQ7CiAgdC5tZWhpcmFnYW5hID0gMHgzMDgxOwogIHQubWVpemllcmFzcXVhcmUgPSAweDMzN2U7CiAgdC5tZWthdGFrYW5hID0gMHgzMGUxOwogIHQubWVrYXRha2FuYWhhbGZ3aWR0aCA9IDB4ZmY5MjsKICB0Lm1lbSA9IDB4MDVkZTsKICB0Lm1lbWRhZ2VzaCA9IDB4ZmIzZTsKICB0Lm1lbWRhZ2VzaGhlYnJldyA9IDB4ZmIzZTsKICB0Lm1lbWhlYnJldyA9IDB4MDVkZTsKICB0Lm1lbmFybWVuaWFuID0gMHgwNTc0OwogIHQubWVya2hhaGVicmV3ID0gMHgwNWE1OwogIHQubWVya2hha2VmdWxhaGVicmV3ID0gMHgwNWE2OwogIHQubWVya2hha2VmdWxhbGVmdGhlYnJldyA9IDB4MDVhNjsKICB0Lm1lcmtoYWxlZnRoZWJyZXcgPSAweDA1YTU7CiAgdC5taG9vayA9IDB4MDI3MTsKICB0Lm1oenNxdWFyZSA9IDB4MzM5MjsKICB0Lm1pZGRsZWRvdGthdGFrYW5haGFsZndpZHRoID0gMHhmZjY1OwogIHQubWlkZG90ID0gMHgwMGI3OwogIHQubWlldW1hY2lyY2xla29yZWFuID0gMHgzMjcyOwogIHQubWlldW1hcGFyZW5rb3JlYW4gPSAweDMyMTI7CiAgdC5taWV1bWNpcmNsZWtvcmVhbiA9IDB4MzI2NDsKICB0Lm1pZXVta29yZWFuID0gMHgzMTQxOwogIHQubWlldW1wYW5zaW9za29yZWFuID0gMHgzMTcwOwogIHQubWlldW1wYXJlbmtvcmVhbiA9IDB4MzIwNDsKICB0Lm1pZXVtcGlldXBrb3JlYW4gPSAweDMxNmU7CiAgdC5taWV1bXNpb3Nrb3JlYW4gPSAweDMxNmY7CiAgdC5taWhpcmFnYW5hID0gMHgzMDdmOwogIHQubWlrYXRha2FuYSA9IDB4MzBkZjsKICB0Lm1pa2F0YWthbmFoYWxmd2lkdGggPSAweGZmOTA7CiAgdC5taW51cyA9IDB4MjIxMjsKICB0Lm1pbnVzYmVsb3djbWIgPSAweDAzMjA7CiAgdC5taW51c2NpcmNsZSA9IDB4MjI5NjsKICB0Lm1pbnVzbW9kID0gMHgwMmQ3OwogIHQubWludXNwbHVzID0gMHgyMjEzOwogIHQubWludXRlID0gMHgyMDMyOwogIHQubWlyaWJhYXJ1c3F1YXJlID0gMHgzMzRhOwogIHQubWlyaXNxdWFyZSA9IDB4MzM0OTsKICB0Lm1sb25nbGVndHVybmVkID0gMHgwMjcwOwogIHQubWxzcXVhcmUgPSAweDMzOTY7CiAgdC5tbWN1YmVkc3F1YXJlID0gMHgzM2EzOwogIHQubW1vbm9zcGFjZSA9IDB4ZmY0ZDsKICB0Lm1tc3F1YXJlZHNxdWFyZSA9IDB4MzM5ZjsKICB0Lm1vaGlyYWdhbmEgPSAweDMwODI7CiAgdC5tb2htc3F1YXJlID0gMHgzM2MxOwogIHQubW9rYXRha2FuYSA9IDB4MzBlMjsKICB0Lm1va2F0YWthbmFoYWxmd2lkdGggPSAweGZmOTM7CiAgdC5tb2xzcXVhcmUgPSAweDMzZDY7CiAgdC5tb21hdGhhaSA9IDB4MGUyMTsKICB0Lm1vdmVyc3NxdWFyZSA9IDB4MzNhNzsKICB0Lm1vdmVyc3NxdWFyZWRzcXVhcmUgPSAweDMzYTg7CiAgdC5tcGFyZW4gPSAweDI0YTg7CiAgdC5tcGFzcXVhcmUgPSAweDMzYWI7CiAgdC5tc3NxdWFyZSA9IDB4MzNiMzsKICB0Lm1zdXBlcmlvciA9IDB4ZjZlZjsKICB0Lm10dXJuZWQgPSAweDAyNmY7CiAgdC5tdSA9IDB4MDBiNTsKICB0Lm11MSA9IDB4MDBiNTsKICB0Lm11YXNxdWFyZSA9IDB4MzM4MjsKICB0Lm11Y2hncmVhdGVyID0gMHgyMjZiOwogIHQubXVjaGxlc3MgPSAweDIyNmE7CiAgdC5tdWZzcXVhcmUgPSAweDMzOGM7CiAgdC5tdWdyZWVrID0gMHgwM2JjOwogIHQubXVnc3F1YXJlID0gMHgzMzhkOwogIHQubXVoaXJhZ2FuYSA9IDB4MzA4MDsKICB0Lm11a2F0YWthbmEgPSAweDMwZTA7CiAgdC5tdWthdGFrYW5haGFsZndpZHRoID0gMHhmZjkxOwogIHQubXVsc3F1YXJlID0gMHgzMzk1OwogIHQubXVsdGlwbHkgPSAweDAwZDc7CiAgdC5tdW1zcXVhcmUgPSAweDMzOWI7CiAgdC5tdW5haGhlYnJldyA9IDB4MDVhMzsKICB0Lm11bmFobGVmdGhlYnJldyA9IDB4MDVhMzsKICB0Lm11c2ljYWxub3RlID0gMHgyNjZhOwogIHQubXVzaWNhbG5vdGVkYmwgPSAweDI2NmI7CiAgdC5tdXNpY2ZsYXRzaWduID0gMHgyNjZkOwogIHQubXVzaWNzaGFycHNpZ24gPSAweDI2NmY7CiAgdC5tdXNzcXVhcmUgPSAweDMzYjI7CiAgdC5tdXZzcXVhcmUgPSAweDMzYjY7CiAgdC5tdXdzcXVhcmUgPSAweDMzYmM7CiAgdC5tdm1lZ2FzcXVhcmUgPSAweDMzYjk7CiAgdC5tdnNxdWFyZSA9IDB4MzNiNzsKICB0Lm13bWVnYXNxdWFyZSA9IDB4MzNiZjsKICB0Lm13c3F1YXJlID0gMHgzM2JkOwogIHQubiA9IDB4MDA2ZTsKICB0Lm5hYmVuZ2FsaSA9IDB4MDlhODsKICB0Lm5hYmxhID0gMHgyMjA3OwogIHQubmFjdXRlID0gMHgwMTQ0OwogIHQubmFkZXZhID0gMHgwOTI4OwogIHQubmFndWphcmF0aSA9IDB4MGFhODsKICB0Lm5hZ3VybXVraGkgPSAweDBhMjg7CiAgdC5uYWhpcmFnYW5hID0gMHgzMDZhOwogIHQubmFrYXRha2FuYSA9IDB4MzBjYTsKICB0Lm5ha2F0YWthbmFoYWxmd2lkdGggPSAweGZmODU7CiAgdC5uYXBvc3Ryb3BoZSA9IDB4MDE0OTsKICB0Lm5hc3F1YXJlID0gMHgzMzgxOwogIHQubmJvcG9tb2ZvID0gMHgzMTBiOwogIHQubmJzcGFjZSA9IDB4MDBhMDsKICB0Lm5jYXJvbiA9IDB4MDE0ODsKICB0Lm5jZWRpbGxhID0gMHgwMTQ2OwogIHQubmNpcmNsZSA9IDB4MjRkZDsKICB0Lm5jaXJjdW1mbGV4YmVsb3cgPSAweDFlNGI7CiAgdC5uY29tbWFhY2NlbnQgPSAweDAxNDY7CiAgdC5uZG90YWNjZW50ID0gMHgxZTQ1OwogIHQubmRvdGJlbG93ID0gMHgxZTQ3OwogIHQubmVoaXJhZ2FuYSA9IDB4MzA2ZDsKICB0Lm5la2F0YWthbmEgPSAweDMwY2Q7CiAgdC5uZWthdGFrYW5haGFsZndpZHRoID0gMHhmZjg4OwogIHQubmV3c2hlcWVsc2lnbiA9IDB4MjBhYTsKICB0Lm5mc3F1YXJlID0gMHgzMzhiOwogIHQubmdhYmVuZ2FsaSA9IDB4MDk5OTsKICB0Lm5nYWRldmEgPSAweDA5MTk7CiAgdC5uZ2FndWphcmF0aSA9IDB4MGE5OTsKICB0Lm5nYWd1cm11a2hpID0gMHgwYTE5OwogIHQubmdvbmd1dGhhaSA9IDB4MGUwNzsKICB0Lm5oaXJhZ2FuYSA9IDB4MzA5MzsKICB0Lm5ob29rbGVmdCA9IDB4MDI3MjsKICB0Lm5ob29rcmV0cm9mbGV4ID0gMHgwMjczOwogIHQubmlldW5hY2lyY2xla29yZWFuID0gMHgzMjZmOwogIHQubmlldW5hcGFyZW5rb3JlYW4gPSAweDMyMGY7CiAgdC5uaWV1bmNpZXVja29yZWFuID0gMHgzMTM1OwogIHQubmlldW5jaXJjbGVrb3JlYW4gPSAweDMyNjE7CiAgdC5uaWV1bmhpZXVoa29yZWFuID0gMHgzMTM2OwogIHQubmlldW5rb3JlYW4gPSAweDMxMzQ7CiAgdC5uaWV1bnBhbnNpb3Nrb3JlYW4gPSAweDMxNjg7CiAgdC5uaWV1bnBhcmVua29yZWFuID0gMHgzMjAxOwogIHQubmlldW5zaW9za29yZWFuID0gMHgzMTY3OwogIHQubmlldW50aWtldXRrb3JlYW4gPSAweDMxNjY7CiAgdC5uaWhpcmFnYW5hID0gMHgzMDZiOwogIHQubmlrYXRha2FuYSA9IDB4MzBjYjsKICB0Lm5pa2F0YWthbmFoYWxmd2lkdGggPSAweGZmODY7CiAgdC5uaWtoYWhpdGxlZnR0aGFpID0gMHhmODk5OwogIHQubmlraGFoaXR0aGFpID0gMHgwZTRkOwogIHQubmluZSA9IDB4MDAzOTsKICB0Lm5pbmVhcmFiaWMgPSAweDA2Njk7CiAgdC5uaW5lYmVuZ2FsaSA9IDB4MDllZjsKICB0Lm5pbmVjaXJjbGUgPSAweDI0Njg7CiAgdC5uaW5lY2lyY2xlaW52ZXJzZXNhbnNzZXJpZiA9IDB4Mjc5MjsKICB0Lm5pbmVkZXZhID0gMHgwOTZmOwogIHQubmluZWd1amFyYXRpID0gMHgwYWVmOwogIHQubmluZWd1cm11a2hpID0gMHgwYTZmOwogIHQubmluZWhhY2thcmFiaWMgPSAweDA2Njk7CiAgdC5uaW5laGFuZ3pob3UgPSAweDMwMjk7CiAgdC5uaW5laWRlb2dyYXBoaWNwYXJlbiA9IDB4MzIyODsKICB0Lm5pbmVpbmZlcmlvciA9IDB4MjA4OTsKICB0Lm5pbmVtb25vc3BhY2UgPSAweGZmMTk7CiAgdC5uaW5lb2xkc3R5bGUgPSAweGY3Mzk7CiAgdC5uaW5lcGFyZW4gPSAweDI0N2M7CiAgdC5uaW5lcGVyaW9kID0gMHgyNDkwOwogIHQubmluZXBlcnNpYW4gPSAweDA2Zjk7CiAgdC5uaW5lcm9tYW4gPSAweDIxNzg7CiAgdC5uaW5lc3VwZXJpb3IgPSAweDIwNzk7CiAgdC5uaW5ldGVlbmNpcmNsZSA9IDB4MjQ3MjsKICB0Lm5pbmV0ZWVucGFyZW4gPSAweDI0ODY7CiAgdC5uaW5ldGVlbnBlcmlvZCA9IDB4MjQ5YTsKICB0Lm5pbmV0aGFpID0gMHgwZTU5OwogIHQubmogPSAweDAxY2M7CiAgdC5uamVjeXJpbGxpYyA9IDB4MDQ1YTsKICB0Lm5rYXRha2FuYSA9IDB4MzBmMzsKICB0Lm5rYXRha2FuYWhhbGZ3aWR0aCA9IDB4ZmY5ZDsKICB0Lm5sZWdyaWdodGxvbmcgPSAweDAxOWU7CiAgdC5ubGluZWJlbG93ID0gMHgxZTQ5OwogIHQubm1vbm9zcGFjZSA9IDB4ZmY0ZTsKICB0Lm5tc3F1YXJlID0gMHgzMzlhOwogIHQubm5hYmVuZ2FsaSA9IDB4MDlhMzsKICB0Lm5uYWRldmEgPSAweDA5MjM7CiAgdC5ubmFndWphcmF0aSA9IDB4MGFhMzsKICB0Lm5uYWd1cm11a2hpID0gMHgwYTIzOwogIHQubm5uYWRldmEgPSAweDA5Mjk7CiAgdC5ub2hpcmFnYW5hID0gMHgzMDZlOwogIHQubm9rYXRha2FuYSA9IDB4MzBjZTsKICB0Lm5va2F0YWthbmFoYWxmd2lkdGggPSAweGZmODk7CiAgdC5ub25icmVha2luZ3NwYWNlID0gMHgwMGEwOwogIHQubm9uZW50aGFpID0gMHgwZTEzOwogIHQubm9udXRoYWkgPSAweDBlMTk7CiAgdC5ub29uYXJhYmljID0gMHgwNjQ2OwogIHQubm9vbmZpbmFsYXJhYmljID0gMHhmZWU2OwogIHQubm9vbmdodW5uYWFyYWJpYyA9IDB4MDZiYTsKICB0Lm5vb25naHVubmFmaW5hbGFyYWJpYyA9IDB4ZmI5ZjsKICB0Lm5vb25pbml0aWFsYXJhYmljID0gMHhmZWU3OwogIHQubm9vbmplZW1pbml0aWFsYXJhYmljID0gMHhmY2QyOwogIHQubm9vbmplZW1pc29sYXRlZGFyYWJpYyA9IDB4ZmM0YjsKICB0Lm5vb25tZWRpYWxhcmFiaWMgPSAweGZlZTg7CiAgdC5ub29ubWVlbWluaXRpYWxhcmFiaWMgPSAweGZjZDU7CiAgdC5ub29ubWVlbWlzb2xhdGVkYXJhYmljID0gMHhmYzRlOwogIHQubm9vbm5vb25maW5hbGFyYWJpYyA9IDB4ZmM4ZDsKICB0Lm5vdGNvbnRhaW5zID0gMHgyMjBjOwogIHQubm90ZWxlbWVudCA9IDB4MjIwOTsKICB0Lm5vdGVsZW1lbnRvZiA9IDB4MjIwOTsKICB0Lm5vdGVxdWFsID0gMHgyMjYwOwogIHQubm90Z3JlYXRlciA9IDB4MjI2ZjsKICB0Lm5vdGdyZWF0ZXJub3JlcXVhbCA9IDB4MjI3MTsKICB0Lm5vdGdyZWF0ZXJub3JsZXNzID0gMHgyMjc5OwogIHQubm90aWRlbnRpY2FsID0gMHgyMjYyOwogIHQubm90bGVzcyA9IDB4MjI2ZTsKICB0Lm5vdGxlc3Nub3JlcXVhbCA9IDB4MjI3MDsKICB0Lm5vdHBhcmFsbGVsID0gMHgyMjI2OwogIHQubm90cHJlY2VkZXMgPSAweDIyODA7CiAgdC5ub3RzdWJzZXQgPSAweDIyODQ7CiAgdC5ub3RzdWNjZWVkcyA9IDB4MjI4MTsKICB0Lm5vdHN1cGVyc2V0ID0gMHgyMjg1OwogIHQubm93YXJtZW5pYW4gPSAweDA1NzY7CiAgdC5ucGFyZW4gPSAweDI0YTk7CiAgdC5uc3NxdWFyZSA9IDB4MzNiMTsKICB0Lm5zdXBlcmlvciA9IDB4MjA3ZjsKICB0Lm50aWxkZSA9IDB4MDBmMTsKICB0Lm51ID0gMHgwM2JkOwogIHQubnVoaXJhZ2FuYSA9IDB4MzA2YzsKICB0Lm51a2F0YWthbmEgPSAweDMwY2M7CiAgdC5udWthdGFrYW5haGFsZndpZHRoID0gMHhmZjg3OwogIHQubnVrdGFiZW5nYWxpID0gMHgwOWJjOwogIHQubnVrdGFkZXZhID0gMHgwOTNjOwogIHQubnVrdGFndWphcmF0aSA9IDB4MGFiYzsKICB0Lm51a3RhZ3VybXVraGkgPSAweDBhM2M7CiAgdC5udW1iZXJzaWduID0gMHgwMDIzOwogIHQubnVtYmVyc2lnbm1vbm9zcGFjZSA9IDB4ZmYwMzsKICB0Lm51bWJlcnNpZ25zbWFsbCA9IDB4ZmU1ZjsKICB0Lm51bWVyYWxzaWduZ3JlZWsgPSAweDAzNzQ7CiAgdC5udW1lcmFsc2lnbmxvd2VyZ3JlZWsgPSAweDAzNzU7CiAgdC5udW1lcm8gPSAweDIxMTY7CiAgdC5udW4gPSAweDA1ZTA7CiAgdC5udW5kYWdlc2ggPSAweGZiNDA7CiAgdC5udW5kYWdlc2hoZWJyZXcgPSAweGZiNDA7CiAgdC5udW5oZWJyZXcgPSAweDA1ZTA7CiAgdC5udnNxdWFyZSA9IDB4MzNiNTsKICB0Lm53c3F1YXJlID0gMHgzM2JiOwogIHQubnlhYmVuZ2FsaSA9IDB4MDk5ZTsKICB0Lm55YWRldmEgPSAweDA5MWU7CiAgdC5ueWFndWphcmF0aSA9IDB4MGE5ZTsKICB0Lm55YWd1cm11a2hpID0gMHgwYTFlOwogIHQubyA9IDB4MDA2ZjsKICB0Lm9hY3V0ZSA9IDB4MDBmMzsKICB0Lm9hbmd0aGFpID0gMHgwZTJkOwogIHQub2JhcnJlZCA9IDB4MDI3NTsKICB0Lm9iYXJyZWRjeXJpbGxpYyA9IDB4MDRlOTsKICB0Lm9iYXJyZWRkaWVyZXNpc2N5cmlsbGljID0gMHgwNGViOwogIHQub2JlbmdhbGkgPSAweDA5OTM7CiAgdC5vYm9wb21vZm8gPSAweDMxMWI7CiAgdC5vYnJldmUgPSAweDAxNGY7CiAgdC5vY2FuZHJhZGV2YSA9IDB4MDkxMTsKICB0Lm9jYW5kcmFndWphcmF0aSA9IDB4MGE5MTsKICB0Lm9jYW5kcmF2b3dlbHNpZ25kZXZhID0gMHgwOTQ5OwogIHQub2NhbmRyYXZvd2Vsc2lnbmd1amFyYXRpID0gMHgwYWM5OwogIHQub2Nhcm9uID0gMHgwMWQyOwogIHQub2NpcmNsZSA9IDB4MjRkZTsKICB0Lm9jaXJjdW1mbGV4ID0gMHgwMGY0OwogIHQub2NpcmN1bWZsZXhhY3V0ZSA9IDB4MWVkMTsKICB0Lm9jaXJjdW1mbGV4ZG90YmVsb3cgPSAweDFlZDk7CiAgdC5vY2lyY3VtZmxleGdyYXZlID0gMHgxZWQzOwogIHQub2NpcmN1bWZsZXhob29rYWJvdmUgPSAweDFlZDU7CiAgdC5vY2lyY3VtZmxleHRpbGRlID0gMHgxZWQ3OwogIHQub2N5cmlsbGljID0gMHgwNDNlOwogIHQub2RibGFjdXRlID0gMHgwMTUxOwogIHQub2RibGdyYXZlID0gMHgwMjBkOwogIHQub2RldmEgPSAweDA5MTM7CiAgdC5vZGllcmVzaXMgPSAweDAwZjY7CiAgdC5vZGllcmVzaXNjeXJpbGxpYyA9IDB4MDRlNzsKICB0Lm9kb3RiZWxvdyA9IDB4MWVjZDsKICB0Lm9lID0gMHgwMTUzOwogIHQub2Vrb3JlYW4gPSAweDMxNWE7CiAgdC5vZ29uZWsgPSAweDAyZGI7CiAgdC5vZ29uZWtjbWIgPSAweDAzMjg7CiAgdC5vZ3JhdmUgPSAweDAwZjI7CiAgdC5vZ3VqYXJhdGkgPSAweDBhOTM7CiAgdC5vaGFybWVuaWFuID0gMHgwNTg1OwogIHQub2hpcmFnYW5hID0gMHgzMDRhOwogIHQub2hvb2thYm92ZSA9IDB4MWVjZjsKICB0Lm9ob3JuID0gMHgwMWExOwogIHQub2hvcm5hY3V0ZSA9IDB4MWVkYjsKICB0Lm9ob3JuZG90YmVsb3cgPSAweDFlZTM7CiAgdC5vaG9ybmdyYXZlID0gMHgxZWRkOwogIHQub2hvcm5ob29rYWJvdmUgPSAweDFlZGY7CiAgdC5vaG9ybnRpbGRlID0gMHgxZWUxOwogIHQub2h1bmdhcnVtbGF1dCA9IDB4MDE1MTsKICB0Lm9pID0gMHgwMWEzOwogIHQub2ludmVydGVkYnJldmUgPSAweDAyMGY7CiAgdC5va2F0YWthbmEgPSAweDMwYWE7CiAgdC5va2F0YWthbmFoYWxmd2lkdGggPSAweGZmNzU7CiAgdC5va29yZWFuID0gMHgzMTU3OwogIHQub2xlaGVicmV3ID0gMHgwNWFiOwogIHQub21hY3JvbiA9IDB4MDE0ZDsKICB0Lm9tYWNyb25hY3V0ZSA9IDB4MWU1MzsKICB0Lm9tYWNyb25ncmF2ZSA9IDB4MWU1MTsKICB0Lm9tZGV2YSA9IDB4MDk1MDsKICB0Lm9tZWdhID0gMHgwM2M5OwogIHQub21lZ2ExID0gMHgwM2Q2OwogIHQub21lZ2FjeXJpbGxpYyA9IDB4MDQ2MTsKICB0Lm9tZWdhbGF0aW5jbG9zZWQgPSAweDAyNzc7CiAgdC5vbWVnYXJvdW5kY3lyaWxsaWMgPSAweDA0N2I7CiAgdC5vbWVnYXRpdGxvY3lyaWxsaWMgPSAweDA0N2Q7CiAgdC5vbWVnYXRvbm9zID0gMHgwM2NlOwogIHQub21ndWphcmF0aSA9IDB4MGFkMDsKICB0Lm9taWNyb24gPSAweDAzYmY7CiAgdC5vbWljcm9udG9ub3MgPSAweDAzY2M7CiAgdC5vbW9ub3NwYWNlID0gMHhmZjRmOwogIHQub25lID0gMHgwMDMxOwogIHQub25lYXJhYmljID0gMHgwNjYxOwogIHQub25lYmVuZ2FsaSA9IDB4MDllNzsKICB0Lm9uZWNpcmNsZSA9IDB4MjQ2MDsKICB0Lm9uZWNpcmNsZWludmVyc2VzYW5zc2VyaWYgPSAweDI3OGE7CiAgdC5vbmVkZXZhID0gMHgwOTY3OwogIHQub25lZG90ZW5sZWFkZXIgPSAweDIwMjQ7CiAgdC5vbmVlaWdodGggPSAweDIxNWI7CiAgdC5vbmVmaXR0ZWQgPSAweGY2ZGM7CiAgdC5vbmVndWphcmF0aSA9IDB4MGFlNzsKICB0Lm9uZWd1cm11a2hpID0gMHgwYTY3OwogIHQub25laGFja2FyYWJpYyA9IDB4MDY2MTsKICB0Lm9uZWhhbGYgPSAweDAwYmQ7CiAgdC5vbmVoYW5nemhvdSA9IDB4MzAyMTsKICB0Lm9uZWlkZW9ncmFwaGljcGFyZW4gPSAweDMyMjA7CiAgdC5vbmVpbmZlcmlvciA9IDB4MjA4MTsKICB0Lm9uZW1vbm9zcGFjZSA9IDB4ZmYxMTsKICB0Lm9uZW51bWVyYXRvcmJlbmdhbGkgPSAweDA5ZjQ7CiAgdC5vbmVvbGRzdHlsZSA9IDB4ZjczMTsKICB0Lm9uZXBhcmVuID0gMHgyNDc0OwogIHQub25lcGVyaW9kID0gMHgyNDg4OwogIHQub25lcGVyc2lhbiA9IDB4MDZmMTsKICB0Lm9uZXF1YXJ0ZXIgPSAweDAwYmM7CiAgdC5vbmVyb21hbiA9IDB4MjE3MDsKICB0Lm9uZXN1cGVyaW9yID0gMHgwMGI5OwogIHQub25ldGhhaSA9IDB4MGU1MTsKICB0Lm9uZXRoaXJkID0gMHgyMTUzOwogIHQub29nb25layA9IDB4MDFlYjsKICB0Lm9vZ29uZWttYWNyb24gPSAweDAxZWQ7CiAgdC5vb2d1cm11a2hpID0gMHgwYTEzOwogIHQub29tYXRyYWd1cm11a2hpID0gMHgwYTRiOwogIHQub29wZW4gPSAweDAyNTQ7CiAgdC5vcGFyZW4gPSAweDI0YWE7CiAgdC5vcGVuYnVsbGV0ID0gMHgyNWU2OwogIHQub3B0aW9uID0gMHgyMzI1OwogIHQub3JkZmVtaW5pbmUgPSAweDAwYWE7CiAgdC5vcmRtYXNjdWxpbmUgPSAweDAwYmE7CiAgdC5vcnRob2dvbmFsID0gMHgyMjFmOwogIHQub3Nob3J0ZGV2YSA9IDB4MDkxMjsKICB0Lm9zaG9ydHZvd2Vsc2lnbmRldmEgPSAweDA5NGE7CiAgdC5vc2xhc2ggPSAweDAwZjg7CiAgdC5vc2xhc2hhY3V0ZSA9IDB4MDFmZjsKICB0Lm9zbWFsbGhpcmFnYW5hID0gMHgzMDQ5OwogIHQub3NtYWxsa2F0YWthbmEgPSAweDMwYTk7CiAgdC5vc21hbGxrYXRha2FuYWhhbGZ3aWR0aCA9IDB4ZmY2YjsKICB0Lm9zdHJva2VhY3V0ZSA9IDB4MDFmZjsKICB0Lm9zdXBlcmlvciA9IDB4ZjZmMDsKICB0Lm90Y3lyaWxsaWMgPSAweDA0N2Y7CiAgdC5vdGlsZGUgPSAweDAwZjU7CiAgdC5vdGlsZGVhY3V0ZSA9IDB4MWU0ZDsKICB0Lm90aWxkZWRpZXJlc2lzID0gMHgxZTRmOwogIHQub3Vib3BvbW9mbyA9IDB4MzEyMTsKICB0Lm92ZXJsaW5lID0gMHgyMDNlOwogIHQub3ZlcmxpbmVjZW50ZXJsaW5lID0gMHhmZTRhOwogIHQub3ZlcmxpbmVjbWIgPSAweDAzMDU7CiAgdC5vdmVybGluZWRhc2hlZCA9IDB4ZmU0OTsKICB0Lm92ZXJsaW5lZGJsd2F2eSA9IDB4ZmU0YzsKICB0Lm92ZXJsaW5ld2F2eSA9IDB4ZmU0YjsKICB0Lm92ZXJzY29yZSA9IDB4MDBhZjsKICB0Lm92b3dlbHNpZ25iZW5nYWxpID0gMHgwOWNiOwogIHQub3Zvd2Vsc2lnbmRldmEgPSAweDA5NGI7CiAgdC5vdm93ZWxzaWduZ3VqYXJhdGkgPSAweDBhY2I7CiAgdC5wID0gMHgwMDcwOwogIHQucGFhbXBzc3F1YXJlID0gMHgzMzgwOwogIHQucGFhc2VudG9zcXVhcmUgPSAweDMzMmI7CiAgdC5wYWJlbmdhbGkgPSAweDA5YWE7CiAgdC5wYWN1dGUgPSAweDFlNTU7CiAgdC5wYWRldmEgPSAweDA5MmE7CiAgdC5wYWdlZG93biA9IDB4MjFkZjsKICB0LnBhZ2V1cCA9IDB4MjFkZTsKICB0LnBhZ3VqYXJhdGkgPSAweDBhYWE7CiAgdC5wYWd1cm11a2hpID0gMHgwYTJhOwogIHQucGFoaXJhZ2FuYSA9IDB4MzA3MTsKICB0LnBhaXlhbm5vaXRoYWkgPSAweDBlMmY7CiAgdC5wYWthdGFrYW5hID0gMHgzMGQxOwogIHQucGFsYXRhbGl6YXRpb25jeXJpbGxpY2NtYiA9IDB4MDQ4NDsKICB0LnBhbG9jaGthY3lyaWxsaWMgPSAweDA0YzA7CiAgdC5wYW5zaW9za29yZWFuID0gMHgzMTdmOwogIHQucGFyYWdyYXBoID0gMHgwMGI2OwogIHQucGFyYWxsZWwgPSAweDIyMjU7CiAgdC5wYXJlbmxlZnQgPSAweDAwMjg7CiAgdC5wYXJlbmxlZnRhbHRvbmVhcmFiaWMgPSAweGZkM2U7CiAgdC5wYXJlbmxlZnRidCA9IDB4ZjhlZDsKICB0LnBhcmVubGVmdGV4ID0gMHhmOGVjOwogIHQucGFyZW5sZWZ0aW5mZXJpb3IgPSAweDIwOGQ7CiAgdC5wYXJlbmxlZnRtb25vc3BhY2UgPSAweGZmMDg7CiAgdC5wYXJlbmxlZnRzbWFsbCA9IDB4ZmU1OTsKICB0LnBhcmVubGVmdHN1cGVyaW9yID0gMHgyMDdkOwogIHQucGFyZW5sZWZ0dHAgPSAweGY4ZWI7CiAgdC5wYXJlbmxlZnR2ZXJ0aWNhbCA9IDB4ZmUzNTsKICB0LnBhcmVucmlnaHQgPSAweDAwMjk7CiAgdC5wYXJlbnJpZ2h0YWx0b25lYXJhYmljID0gMHhmZDNmOwogIHQucGFyZW5yaWdodGJ0ID0gMHhmOGY4OwogIHQucGFyZW5yaWdodGV4ID0gMHhmOGY3OwogIHQucGFyZW5yaWdodGluZmVyaW9yID0gMHgyMDhlOwogIHQucGFyZW5yaWdodG1vbm9zcGFjZSA9IDB4ZmYwOTsKICB0LnBhcmVucmlnaHRzbWFsbCA9IDB4ZmU1YTsKICB0LnBhcmVucmlnaHRzdXBlcmlvciA9IDB4MjA3ZTsKICB0LnBhcmVucmlnaHR0cCA9IDB4ZjhmNjsKICB0LnBhcmVucmlnaHR2ZXJ0aWNhbCA9IDB4ZmUzNjsKICB0LnBhcnRpYWxkaWZmID0gMHgyMjAyOwogIHQucGFzZXFoZWJyZXcgPSAweDA1YzA7CiAgdC5wYXNodGFoZWJyZXcgPSAweDA1OTk7CiAgdC5wYXNxdWFyZSA9IDB4MzNhOTsKICB0LnBhdGFoID0gMHgwNWI3OwogIHQucGF0YWgxMSA9IDB4MDViNzsKICB0LnBhdGFoMWQgPSAweDA1Yjc7CiAgdC5wYXRhaDJhID0gMHgwNWI3OwogIHQucGF0YWhoZWJyZXcgPSAweDA1Yjc7CiAgdC5wYXRhaG5hcnJvd2hlYnJldyA9IDB4MDViNzsKICB0LnBhdGFocXVhcnRlcmhlYnJldyA9IDB4MDViNzsKICB0LnBhdGFod2lkZWhlYnJldyA9IDB4MDViNzsKICB0LnBhemVyaGVicmV3ID0gMHgwNWExOwogIHQucGJvcG9tb2ZvID0gMHgzMTA2OwogIHQucGNpcmNsZSA9IDB4MjRkZjsKICB0LnBkb3RhY2NlbnQgPSAweDFlNTc7CiAgdC5wZSA9IDB4MDVlNDsKICB0LnBlY3lyaWxsaWMgPSAweDA0M2Y7CiAgdC5wZWRhZ2VzaCA9IDB4ZmI0NDsKICB0LnBlZGFnZXNoaGVicmV3ID0gMHhmYjQ0OwogIHQucGVlemlzcXVhcmUgPSAweDMzM2I7CiAgdC5wZWZpbmFsZGFnZXNoaGVicmV3ID0gMHhmYjQzOwogIHQucGVoYXJhYmljID0gMHgwNjdlOwogIHQucGVoYXJtZW5pYW4gPSAweDA1N2E7CiAgdC5wZWhlYnJldyA9IDB4MDVlNDsKICB0LnBlaGZpbmFsYXJhYmljID0gMHhmYjU3OwogIHQucGVoaW5pdGlhbGFyYWJpYyA9IDB4ZmI1ODsKICB0LnBlaGlyYWdhbmEgPSAweDMwN2E7CiAgdC5wZWhtZWRpYWxhcmFiaWMgPSAweGZiNTk7CiAgdC5wZWthdGFrYW5hID0gMHgzMGRhOwogIHQucGVtaWRkbGVob29rY3lyaWxsaWMgPSAweDA0YTc7CiAgdC5wZXJhZmVoZWJyZXcgPSAweGZiNGU7CiAgdC5wZXJjZW50ID0gMHgwMDI1OwogIHQucGVyY2VudGFyYWJpYyA9IDB4MDY2YTsKICB0LnBlcmNlbnRtb25vc3BhY2UgPSAweGZmMDU7CiAgdC5wZXJjZW50c21hbGwgPSAweGZlNmE7CiAgdC5wZXJpb2QgPSAweDAwMmU7CiAgdC5wZXJpb2Rhcm1lbmlhbiA9IDB4MDU4OTsKICB0LnBlcmlvZGNlbnRlcmVkID0gMHgwMGI3OwogIHQucGVyaW9kaGFsZndpZHRoID0gMHhmZjYxOwogIHQucGVyaW9kaW5mZXJpb3IgPSAweGY2ZTc7CiAgdC5wZXJpb2Rtb25vc3BhY2UgPSAweGZmMGU7CiAgdC5wZXJpb2RzbWFsbCA9IDB4ZmU1MjsKICB0LnBlcmlvZHN1cGVyaW9yID0gMHhmNmU4OwogIHQucGVyaXNwb21lbmlncmVla2NtYiA9IDB4MDM0MjsKICB0LnBlcnBlbmRpY3VsYXIgPSAweDIyYTU7CiAgdC5wZXJ0aG91c2FuZCA9IDB4MjAzMDsKICB0LnBlc2V0YSA9IDB4MjBhNzsKICB0LnBmc3F1YXJlID0gMHgzMzhhOwogIHQucGhhYmVuZ2FsaSA9IDB4MDlhYjsKICB0LnBoYWRldmEgPSAweDA5MmI7CiAgdC5waGFndWphcmF0aSA9IDB4MGFhYjsKICB0LnBoYWd1cm11a2hpID0gMHgwYTJiOwogIHQucGhpID0gMHgwM2M2OwogIHQucGhpMSA9IDB4MDNkNTsKICB0LnBoaWV1cGhhY2lyY2xla29yZWFuID0gMHgzMjdhOwogIHQucGhpZXVwaGFwYXJlbmtvcmVhbiA9IDB4MzIxYTsKICB0LnBoaWV1cGhjaXJjbGVrb3JlYW4gPSAweDMyNmM7CiAgdC5waGlldXBoa29yZWFuID0gMHgzMTRkOwogIHQucGhpZXVwaHBhcmVua29yZWFuID0gMHgzMjBjOwogIHQucGhpbGF0aW4gPSAweDAyNzg7CiAgdC5waGludGh1dGhhaSA9IDB4MGUzYTsKICB0LnBoaXN5bWJvbGdyZWVrID0gMHgwM2Q1OwogIHQucGhvb2sgPSAweDAxYTU7CiAgdC5waG9waGFudGhhaSA9IDB4MGUxZTsKICB0LnBob3BodW5ndGhhaSA9IDB4MGUxYzsKICB0LnBob3NhbXBoYW90aGFpID0gMHgwZTIwOwogIHQucGkgPSAweDAzYzA7CiAgdC5waWV1cGFjaXJjbGVrb3JlYW4gPSAweDMyNzM7CiAgdC5waWV1cGFwYXJlbmtvcmVhbiA9IDB4MzIxMzsKICB0LnBpZXVwY2lldWNrb3JlYW4gPSAweDMxNzY7CiAgdC5waWV1cGNpcmNsZWtvcmVhbiA9IDB4MzI2NTsKICB0LnBpZXVwa2l5ZW9ra29yZWFuID0gMHgzMTcyOwogIHQucGlldXBrb3JlYW4gPSAweDMxNDI7CiAgdC5waWV1cHBhcmVua29yZWFuID0gMHgzMjA1OwogIHQucGlldXBzaW9za2l5ZW9ra29yZWFuID0gMHgzMTc0OwogIHQucGlldXBzaW9za29yZWFuID0gMHgzMTQ0OwogIHQucGlldXBzaW9zdGlrZXV0a29yZWFuID0gMHgzMTc1OwogIHQucGlldXB0aGlldXRoa29yZWFuID0gMHgzMTc3OwogIHQucGlldXB0aWtldXRrb3JlYW4gPSAweDMxNzM7CiAgdC5waWhpcmFnYW5hID0gMHgzMDc0OwogIHQucGlrYXRha2FuYSA9IDB4MzBkNDsKICB0LnBpc3ltYm9sZ3JlZWsgPSAweDAzZDY7CiAgdC5waXdyYXJtZW5pYW4gPSAweDA1ODM7CiAgdC5wbGFuY2tvdmVyMnBpID0gMHgyMTBmOwogIHQucGxhbmNrb3ZlcjJwaTEgPSAweDIxMGY7CiAgdC5wbHVzID0gMHgwMDJiOwogIHQucGx1c2JlbG93Y21iID0gMHgwMzFmOwogIHQucGx1c2NpcmNsZSA9IDB4MjI5NTsKICB0LnBsdXNtaW51cyA9IDB4MDBiMTsKICB0LnBsdXNtb2QgPSAweDAyZDY7CiAgdC5wbHVzbW9ub3NwYWNlID0gMHhmZjBiOwogIHQucGx1c3NtYWxsID0gMHhmZTYyOwogIHQucGx1c3N1cGVyaW9yID0gMHgyMDdhOwogIHQucG1vbm9zcGFjZSA9IDB4ZmY1MDsKICB0LnBtc3F1YXJlID0gMHgzM2Q4OwogIHQucG9oaXJhZ2FuYSA9IDB4MzA3ZDsKICB0LnBvaW50aW5naW5kZXhkb3dud2hpdGUgPSAweDI2MWY7CiAgdC5wb2ludGluZ2luZGV4bGVmdHdoaXRlID0gMHgyNjFjOwogIHQucG9pbnRpbmdpbmRleHJpZ2h0d2hpdGUgPSAweDI2MWU7CiAgdC5wb2ludGluZ2luZGV4dXB3aGl0ZSA9IDB4MjYxZDsKICB0LnBva2F0YWthbmEgPSAweDMwZGQ7CiAgdC5wb3BsYXRoYWkgPSAweDBlMWI7CiAgdC5wb3N0YWxtYXJrID0gMHgzMDEyOwogIHQucG9zdGFsbWFya2ZhY2UgPSAweDMwMjA7CiAgdC5wcGFyZW4gPSAweDI0YWI7CiAgdC5wcmVjZWRlcyA9IDB4MjI3YTsKICB0LnByZXNjcmlwdGlvbiA9IDB4MjExZTsKICB0LnByaW1lbW9kID0gMHgwMmI5OwogIHQucHJpbWVyZXZlcnNlZCA9IDB4MjAzNTsKICB0LnByb2R1Y3QgPSAweDIyMGY7CiAgdC5wcm9qZWN0aXZlID0gMHgyMzA1OwogIHQucHJvbG9uZ2Vka2FuYSA9IDB4MzBmYzsKICB0LnByb3BlbGxvciA9IDB4MjMxODsKICB0LnByb3BlcnN1YnNldCA9IDB4MjI4MjsKICB0LnByb3BlcnN1cGVyc2V0ID0gMHgyMjgzOwogIHQucHJvcG9ydGlvbiA9IDB4MjIzNzsKICB0LnByb3BvcnRpb25hbCA9IDB4MjIxZDsKICB0LnBzaSA9IDB4MDNjODsKICB0LnBzaWN5cmlsbGljID0gMHgwNDcxOwogIHQucHNpbGlwbmV1bWF0YWN5cmlsbGljY21iID0gMHgwNDg2OwogIHQucHNzcXVhcmUgPSAweDMzYjA7CiAgdC5wdWhpcmFnYW5hID0gMHgzMDc3OwogIHQucHVrYXRha2FuYSA9IDB4MzBkNzsKICB0LnB2c3F1YXJlID0gMHgzM2I0OwogIHQucHdzcXVhcmUgPSAweDMzYmE7CiAgdC5xID0gMHgwMDcxOwogIHQucWFkZXZhID0gMHgwOTU4OwogIHQucWFkbWFoZWJyZXcgPSAweDA1YTg7CiAgdC5xYWZhcmFiaWMgPSAweDA2NDI7CiAgdC5xYWZmaW5hbGFyYWJpYyA9IDB4ZmVkNjsKICB0LnFhZmluaXRpYWxhcmFiaWMgPSAweGZlZDc7CiAgdC5xYWZtZWRpYWxhcmFiaWMgPSAweGZlZDg7CiAgdC5xYW1hdHMgPSAweDA1Yjg7CiAgdC5xYW1hdHMxMCA9IDB4MDViODsKICB0LnFhbWF0czFhID0gMHgwNWI4OwogIHQucWFtYXRzMWMgPSAweDA1Yjg7CiAgdC5xYW1hdHMyNyA9IDB4MDViODsKICB0LnFhbWF0czI5ID0gMHgwNWI4OwogIHQucWFtYXRzMzMgPSAweDA1Yjg7CiAgdC5xYW1hdHNkZSA9IDB4MDViODsKICB0LnFhbWF0c2hlYnJldyA9IDB4MDViODsKICB0LnFhbWF0c25hcnJvd2hlYnJldyA9IDB4MDViODsKICB0LnFhbWF0c3FhdGFuaGVicmV3ID0gMHgwNWI4OwogIHQucWFtYXRzcWF0YW5uYXJyb3doZWJyZXcgPSAweDA1Yjg7CiAgdC5xYW1hdHNxYXRhbnF1YXJ0ZXJoZWJyZXcgPSAweDA1Yjg7CiAgdC5xYW1hdHNxYXRhbndpZGVoZWJyZXcgPSAweDA1Yjg7CiAgdC5xYW1hdHNxdWFydGVyaGVicmV3ID0gMHgwNWI4OwogIHQucWFtYXRzd2lkZWhlYnJldyA9IDB4MDViODsKICB0LnFhcm5leXBhcmFoZWJyZXcgPSAweDA1OWY7CiAgdC5xYm9wb21vZm8gPSAweDMxMTE7CiAgdC5xY2lyY2xlID0gMHgyNGUwOwogIHQucWhvb2sgPSAweDAyYTA7CiAgdC5xbW9ub3NwYWNlID0gMHhmZjUxOwogIHQucW9mID0gMHgwNWU3OwogIHQucW9mZGFnZXNoID0gMHhmYjQ3OwogIHQucW9mZGFnZXNoaGVicmV3ID0gMHhmYjQ3OwogIHQucW9maGVicmV3ID0gMHgwNWU3OwogIHQucXBhcmVuID0gMHgyNGFjOwogIHQucXVhcnRlcm5vdGUgPSAweDI2Njk7CiAgdC5xdWJ1dHMgPSAweDA1YmI7CiAgdC5xdWJ1dHMxOCA9IDB4MDViYjsKICB0LnF1YnV0czI1ID0gMHgwNWJiOwogIHQucXVidXRzMzEgPSAweDA1YmI7CiAgdC5xdWJ1dHNoZWJyZXcgPSAweDA1YmI7CiAgdC5xdWJ1dHNuYXJyb3doZWJyZXcgPSAweDA1YmI7CiAgdC5xdWJ1dHNxdWFydGVyaGVicmV3ID0gMHgwNWJiOwogIHQucXVidXRzd2lkZWhlYnJldyA9IDB4MDViYjsKICB0LnF1ZXN0aW9uID0gMHgwMDNmOwogIHQucXVlc3Rpb25hcmFiaWMgPSAweDA2MWY7CiAgdC5xdWVzdGlvbmFybWVuaWFuID0gMHgwNTVlOwogIHQucXVlc3Rpb25kb3duID0gMHgwMGJmOwogIHQucXVlc3Rpb25kb3duc21hbGwgPSAweGY3YmY7CiAgdC5xdWVzdGlvbmdyZWVrID0gMHgwMzdlOwogIHQucXVlc3Rpb25tb25vc3BhY2UgPSAweGZmMWY7CiAgdC5xdWVzdGlvbnNtYWxsID0gMHhmNzNmOwogIHQucXVvdGVkYmwgPSAweDAwMjI7CiAgdC5xdW90ZWRibGJhc2UgPSAweDIwMWU7CiAgdC5xdW90ZWRibGxlZnQgPSAweDIwMWM7CiAgdC5xdW90ZWRibG1vbm9zcGFjZSA9IDB4ZmYwMjsKICB0LnF1b3RlZGJscHJpbWUgPSAweDMwMWU7CiAgdC5xdW90ZWRibHByaW1lcmV2ZXJzZWQgPSAweDMwMWQ7CiAgdC5xdW90ZWRibHJpZ2h0ID0gMHgyMDFkOwogIHQucXVvdGVsZWZ0ID0gMHgyMDE4OwogIHQucXVvdGVsZWZ0cmV2ZXJzZWQgPSAweDIwMWI7CiAgdC5xdW90ZXJldmVyc2VkID0gMHgyMDFiOwogIHQucXVvdGVyaWdodCA9IDB4MjAxOTsKICB0LnF1b3RlcmlnaHRuID0gMHgwMTQ5OwogIHQucXVvdGVzaW5nbGJhc2UgPSAweDIwMWE7CiAgdC5xdW90ZXNpbmdsZSA9IDB4MDAyNzsKICB0LnF1b3Rlc2luZ2xlbW9ub3NwYWNlID0gMHhmZjA3OwogIHQuciA9IDB4MDA3MjsKICB0LnJhYXJtZW5pYW4gPSAweDA1N2M7CiAgdC5yYWJlbmdhbGkgPSAweDA5YjA7CiAgdC5yYWN1dGUgPSAweDAxNTU7CiAgdC5yYWRldmEgPSAweDA5MzA7CiAgdC5yYWRpY2FsID0gMHgyMjFhOwogIHQucmFkaWNhbGV4ID0gMHhmOGU1OwogIHQucmFkb3ZlcnNzcXVhcmUgPSAweDMzYWU7CiAgdC5yYWRvdmVyc3NxdWFyZWRzcXVhcmUgPSAweDMzYWY7CiAgdC5yYWRzcXVhcmUgPSAweDMzYWQ7CiAgdC5yYWZlID0gMHgwNWJmOwogIHQucmFmZWhlYnJldyA9IDB4MDViZjsKICB0LnJhZ3VqYXJhdGkgPSAweDBhYjA7CiAgdC5yYWd1cm11a2hpID0gMHgwYTMwOwogIHQucmFoaXJhZ2FuYSA9IDB4MzA4OTsKICB0LnJha2F0YWthbmEgPSAweDMwZTk7CiAgdC5yYWthdGFrYW5haGFsZndpZHRoID0gMHhmZjk3OwogIHQucmFsb3dlcmRpYWdvbmFsYmVuZ2FsaSA9IDB4MDlmMTsKICB0LnJhbWlkZGxlZGlhZ29uYWxiZW5nYWxpID0gMHgwOWYwOwogIHQucmFtc2hvcm4gPSAweDAyNjQ7CiAgdC5yYXRpbyA9IDB4MjIzNjsKICB0LnJib3BvbW9mbyA9IDB4MzExNjsKICB0LnJjYXJvbiA9IDB4MDE1OTsKICB0LnJjZWRpbGxhID0gMHgwMTU3OwogIHQucmNpcmNsZSA9IDB4MjRlMTsKICB0LnJjb21tYWFjY2VudCA9IDB4MDE1NzsKICB0LnJkYmxncmF2ZSA9IDB4MDIxMTsKICB0LnJkb3RhY2NlbnQgPSAweDFlNTk7CiAgdC5yZG90YmVsb3cgPSAweDFlNWI7CiAgdC5yZG90YmVsb3dtYWNyb24gPSAweDFlNWQ7CiAgdC5yZWZlcmVuY2VtYXJrID0gMHgyMDNiOwogIHQucmVmbGV4c3Vic2V0ID0gMHgyMjg2OwogIHQucmVmbGV4c3VwZXJzZXQgPSAweDIyODc7CiAgdC5yZWdpc3RlcmVkID0gMHgwMGFlOwogIHQucmVnaXN0ZXJzYW5zID0gMHhmOGU4OwogIHQucmVnaXN0ZXJzZXJpZiA9IDB4ZjZkYTsKICB0LnJlaGFyYWJpYyA9IDB4MDYzMTsKICB0LnJlaGFybWVuaWFuID0gMHgwNTgwOwogIHQucmVoZmluYWxhcmFiaWMgPSAweGZlYWU7CiAgdC5yZWhpcmFnYW5hID0gMHgzMDhjOwogIHQucmVrYXRha2FuYSA9IDB4MzBlYzsKICB0LnJla2F0YWthbmFoYWxmd2lkdGggPSAweGZmOWE7CiAgdC5yZXNoID0gMHgwNWU4OwogIHQucmVzaGRhZ2VzaGhlYnJldyA9IDB4ZmI0ODsKICB0LnJlc2hoZWJyZXcgPSAweDA1ZTg7CiAgdC5yZXZlcnNlZHRpbGRlID0gMHgyMjNkOwogIHQucmV2aWFoZWJyZXcgPSAweDA1OTc7CiAgdC5yZXZpYW11Z3Jhc2hoZWJyZXcgPSAweDA1OTc7CiAgdC5yZXZsb2dpY2Fsbm90ID0gMHgyMzEwOwogIHQucmZpc2hob29rID0gMHgwMjdlOwogIHQucmZpc2hob29rcmV2ZXJzZWQgPSAweDAyN2Y7CiAgdC5yaGFiZW5nYWxpID0gMHgwOWRkOwogIHQucmhhZGV2YSA9IDB4MDk1ZDsKICB0LnJobyA9IDB4MDNjMTsKICB0LnJob29rID0gMHgwMjdkOwogIHQucmhvb2t0dXJuZWQgPSAweDAyN2I7CiAgdC5yaG9va3R1cm5lZHN1cGVyaW9yID0gMHgwMmI1OwogIHQucmhvc3ltYm9sZ3JlZWsgPSAweDAzZjE7CiAgdC5yaG90aWNob29rbW9kID0gMHgwMmRlOwogIHQucmlldWxhY2lyY2xla29yZWFuID0gMHgzMjcxOwogIHQucmlldWxhcGFyZW5rb3JlYW4gPSAweDMyMTE7CiAgdC5yaWV1bGNpcmNsZWtvcmVhbiA9IDB4MzI2MzsKICB0LnJpZXVsaGlldWhrb3JlYW4gPSAweDMxNDA7CiAgdC5yaWV1bGtpeWVva2tvcmVhbiA9IDB4MzEzYTsKICB0LnJpZXVsa2l5ZW9rc2lvc2tvcmVhbiA9IDB4MzE2OTsKICB0LnJpZXVsa29yZWFuID0gMHgzMTM5OwogIHQucmlldWxtaWV1bWtvcmVhbiA9IDB4MzEzYjsKICB0LnJpZXVscGFuc2lvc2tvcmVhbiA9IDB4MzE2YzsKICB0LnJpZXVscGFyZW5rb3JlYW4gPSAweDMyMDM7CiAgdC5yaWV1bHBoaWV1cGhrb3JlYW4gPSAweDMxM2Y7CiAgdC5yaWV1bHBpZXVwa29yZWFuID0gMHgzMTNjOwogIHQucmlldWxwaWV1cHNpb3Nrb3JlYW4gPSAweDMxNmI7CiAgdC5yaWV1bHNpb3Nrb3JlYW4gPSAweDMxM2Q7CiAgdC5yaWV1bHRoaWV1dGhrb3JlYW4gPSAweDMxM2U7CiAgdC5yaWV1bHRpa2V1dGtvcmVhbiA9IDB4MzE2YTsKICB0LnJpZXVseWVvcmluaGlldWhrb3JlYW4gPSAweDMxNmQ7CiAgdC5yaWdodGFuZ2xlID0gMHgyMjFmOwogIHQucmlnaHR0YWNrYmVsb3djbWIgPSAweDAzMTk7CiAgdC5yaWdodHRyaWFuZ2xlID0gMHgyMmJmOwogIHQucmloaXJhZ2FuYSA9IDB4MzA4YTsKICB0LnJpa2F0YWthbmEgPSAweDMwZWE7CiAgdC5yaWthdGFrYW5haGFsZndpZHRoID0gMHhmZjk4OwogIHQucmluZyA9IDB4MDJkYTsKICB0LnJpbmdiZWxvd2NtYiA9IDB4MDMyNTsKICB0LnJpbmdjbWIgPSAweDAzMGE7CiAgdC5yaW5naGFsZmxlZnQgPSAweDAyYmY7CiAgdC5yaW5naGFsZmxlZnRhcm1lbmlhbiA9IDB4MDU1OTsKICB0LnJpbmdoYWxmbGVmdGJlbG93Y21iID0gMHgwMzFjOwogIHQucmluZ2hhbGZsZWZ0Y2VudGVyZWQgPSAweDAyZDM7CiAgdC5yaW5naGFsZnJpZ2h0ID0gMHgwMmJlOwogIHQucmluZ2hhbGZyaWdodGJlbG93Y21iID0gMHgwMzM5OwogIHQucmluZ2hhbGZyaWdodGNlbnRlcmVkID0gMHgwMmQyOwogIHQucmludmVydGVkYnJldmUgPSAweDAyMTM7CiAgdC5yaXR0b3J1c3F1YXJlID0gMHgzMzUxOwogIHQucmxpbmViZWxvdyA9IDB4MWU1ZjsKICB0LnJsb25nbGVnID0gMHgwMjdjOwogIHQucmxvbmdsZWd0dXJuZWQgPSAweDAyN2E7CiAgdC5ybW9ub3NwYWNlID0gMHhmZjUyOwogIHQucm9oaXJhZ2FuYSA9IDB4MzA4ZDsKICB0LnJva2F0YWthbmEgPSAweDMwZWQ7CiAgdC5yb2thdGFrYW5haGFsZndpZHRoID0gMHhmZjliOwogIHQucm9ydWF0aGFpID0gMHgwZTIzOwogIHQucnBhcmVuID0gMHgyNGFkOwogIHQucnJhYmVuZ2FsaSA9IDB4MDlkYzsKICB0LnJyYWRldmEgPSAweDA5MzE7CiAgdC5ycmFndXJtdWtoaSA9IDB4MGE1YzsKICB0LnJyZWhhcmFiaWMgPSAweDA2OTE7CiAgdC5ycmVoZmluYWxhcmFiaWMgPSAweGZiOGQ7CiAgdC5ycnZvY2FsaWNiZW5nYWxpID0gMHgwOWUwOwogIHQucnJ2b2NhbGljZGV2YSA9IDB4MDk2MDsKICB0LnJydm9jYWxpY2d1amFyYXRpID0gMHgwYWUwOwogIHQucnJ2b2NhbGljdm93ZWxzaWduYmVuZ2FsaSA9IDB4MDljNDsKICB0LnJydm9jYWxpY3Zvd2Vsc2lnbmRldmEgPSAweDA5NDQ7CiAgdC5ycnZvY2FsaWN2b3dlbHNpZ25ndWphcmF0aSA9IDB4MGFjNDsKICB0LnJzdXBlcmlvciA9IDB4ZjZmMTsKICB0LnJ0YmxvY2sgPSAweDI1OTA7CiAgdC5ydHVybmVkID0gMHgwMjc5OwogIHQucnR1cm5lZHN1cGVyaW9yID0gMHgwMmI0OwogIHQucnVoaXJhZ2FuYSA9IDB4MzA4YjsKICB0LnJ1a2F0YWthbmEgPSAweDMwZWI7CiAgdC5ydWthdGFrYW5haGFsZndpZHRoID0gMHhmZjk5OwogIHQucnVwZWVtYXJrYmVuZ2FsaSA9IDB4MDlmMjsKICB0LnJ1cGVlc2lnbmJlbmdhbGkgPSAweDA5ZjM7CiAgdC5ydXBpYWggPSAweGY2ZGQ7CiAgdC5ydXRoYWkgPSAweDBlMjQ7CiAgdC5ydm9jYWxpY2JlbmdhbGkgPSAweDA5OGI7CiAgdC5ydm9jYWxpY2RldmEgPSAweDA5MGI7CiAgdC5ydm9jYWxpY2d1amFyYXRpID0gMHgwYThiOwogIHQucnZvY2FsaWN2b3dlbHNpZ25iZW5nYWxpID0gMHgwOWMzOwogIHQucnZvY2FsaWN2b3dlbHNpZ25kZXZhID0gMHgwOTQzOwogIHQucnZvY2FsaWN2b3dlbHNpZ25ndWphcmF0aSA9IDB4MGFjMzsKICB0LnMgPSAweDAwNzM7CiAgdC5zYWJlbmdhbGkgPSAweDA5Yjg7CiAgdC5zYWN1dGUgPSAweDAxNWI7CiAgdC5zYWN1dGVkb3RhY2NlbnQgPSAweDFlNjU7CiAgdC5zYWRhcmFiaWMgPSAweDA2MzU7CiAgdC5zYWRldmEgPSAweDA5Mzg7CiAgdC5zYWRmaW5hbGFyYWJpYyA9IDB4ZmViYTsKICB0LnNhZGluaXRpYWxhcmFiaWMgPSAweGZlYmI7CiAgdC5zYWRtZWRpYWxhcmFiaWMgPSAweGZlYmM7CiAgdC5zYWd1amFyYXRpID0gMHgwYWI4OwogIHQuc2FndXJtdWtoaSA9IDB4MGEzODsKICB0LnNhaGlyYWdhbmEgPSAweDMwNTU7CiAgdC5zYWthdGFrYW5hID0gMHgzMGI1OwogIHQuc2FrYXRha2FuYWhhbGZ3aWR0aCA9IDB4ZmY3YjsKICB0LnNhbGxhbGxhaG91YWxheWhld2FzYWxsYW1hcmFiaWMgPSAweGZkZmE7CiAgdC5zYW1la2ggPSAweDA1ZTE7CiAgdC5zYW1la2hkYWdlc2ggPSAweGZiNDE7CiAgdC5zYW1la2hkYWdlc2hoZWJyZXcgPSAweGZiNDE7CiAgdC5zYW1la2hoZWJyZXcgPSAweDA1ZTE7CiAgdC5zYXJhYWF0aGFpID0gMHgwZTMyOwogIHQuc2FyYWFldGhhaSA9IDB4MGU0MTsKICB0LnNhcmFhaW1haW1hbGFpdGhhaSA9IDB4MGU0NDsKICB0LnNhcmFhaW1haW11YW50aGFpID0gMHgwZTQzOwogIHQuc2FyYWFtdGhhaSA9IDB4MGUzMzsKICB0LnNhcmFhdGhhaSA9IDB4MGUzMDsKICB0LnNhcmFldGhhaSA9IDB4MGU0MDsKICB0LnNhcmFpaWxlZnR0aGFpID0gMHhmODg2OwogIHQuc2FyYWlpdGhhaSA9IDB4MGUzNTsKICB0LnNhcmFpbGVmdHRoYWkgPSAweGY4ODU7CiAgdC5zYXJhaXRoYWkgPSAweDBlMzQ7CiAgdC5zYXJhb3RoYWkgPSAweDBlNDI7CiAgdC5zYXJhdWVlbGVmdHRoYWkgPSAweGY4ODg7CiAgdC5zYXJhdWVldGhhaSA9IDB4MGUzNzsKICB0LnNhcmF1ZWxlZnR0aGFpID0gMHhmODg3OwogIHQuc2FyYXVldGhhaSA9IDB4MGUzNjsKICB0LnNhcmF1dGhhaSA9IDB4MGUzODsKICB0LnNhcmF1dXRoYWkgPSAweDBlMzk7CiAgdC5zYm9wb21vZm8gPSAweDMxMTk7CiAgdC5zY2Fyb24gPSAweDAxNjE7CiAgdC5zY2Fyb25kb3RhY2NlbnQgPSAweDFlNjc7CiAgdC5zY2VkaWxsYSA9IDB4MDE1ZjsKICB0LnNjaHdhID0gMHgwMjU5OwogIHQuc2Nod2FjeXJpbGxpYyA9IDB4MDRkOTsKICB0LnNjaHdhZGllcmVzaXNjeXJpbGxpYyA9IDB4MDRkYjsKICB0LnNjaHdhaG9vayA9IDB4MDI1YTsKICB0LnNjaXJjbGUgPSAweDI0ZTI7CiAgdC5zY2lyY3VtZmxleCA9IDB4MDE1ZDsKICB0LnNjb21tYWFjY2VudCA9IDB4MDIxOTsKICB0LnNkb3RhY2NlbnQgPSAweDFlNjE7CiAgdC5zZG90YmVsb3cgPSAweDFlNjM7CiAgdC5zZG90YmVsb3dkb3RhY2NlbnQgPSAweDFlNjk7CiAgdC5zZWFndWxsYmVsb3djbWIgPSAweDAzM2M7CiAgdC5zZWNvbmQgPSAweDIwMzM7CiAgdC5zZWNvbmR0b25lY2hpbmVzZSA9IDB4MDJjYTsKICB0LnNlY3Rpb24gPSAweDAwYTc7CiAgdC5zZWVuYXJhYmljID0gMHgwNjMzOwogIHQuc2VlbmZpbmFsYXJhYmljID0gMHhmZWIyOwogIHQuc2VlbmluaXRpYWxhcmFiaWMgPSAweGZlYjM7CiAgdC5zZWVubWVkaWFsYXJhYmljID0gMHhmZWI0OwogIHQuc2Vnb2wgPSAweDA1YjY7CiAgdC5zZWdvbDEzID0gMHgwNWI2OwogIHQuc2Vnb2wxZiA9IDB4MDViNjsKICB0LnNlZ29sMmMgPSAweDA1YjY7CiAgdC5zZWdvbGhlYnJldyA9IDB4MDViNjsKICB0LnNlZ29sbmFycm93aGVicmV3ID0gMHgwNWI2OwogIHQuc2Vnb2xxdWFydGVyaGVicmV3ID0gMHgwNWI2OwogIHQuc2Vnb2x0YWhlYnJldyA9IDB4MDU5MjsKICB0LnNlZ29sd2lkZWhlYnJldyA9IDB4MDViNjsKICB0LnNlaGFybWVuaWFuID0gMHgwNTdkOwogIHQuc2VoaXJhZ2FuYSA9IDB4MzA1YjsKICB0LnNla2F0YWthbmEgPSAweDMwYmI7CiAgdC5zZWthdGFrYW5haGFsZndpZHRoID0gMHhmZjdlOwogIHQuc2VtaWNvbG9uID0gMHgwMDNiOwogIHQuc2VtaWNvbG9uYXJhYmljID0gMHgwNjFiOwogIHQuc2VtaWNvbG9ubW9ub3NwYWNlID0gMHhmZjFiOwogIHQuc2VtaWNvbG9uc21hbGwgPSAweGZlNTQ7CiAgdC5zZW1pdm9pY2VkbWFya2thbmEgPSAweDMwOWM7CiAgdC5zZW1pdm9pY2VkbWFya2thbmFoYWxmd2lkdGggPSAweGZmOWY7CiAgdC5zZW50aXNxdWFyZSA9IDB4MzMyMjsKICB0LnNlbnRvc3F1YXJlID0gMHgzMzIzOwogIHQuc2V2ZW4gPSAweDAwMzc7CiAgdC5zZXZlbmFyYWJpYyA9IDB4MDY2NzsKICB0LnNldmVuYmVuZ2FsaSA9IDB4MDllZDsKICB0LnNldmVuY2lyY2xlID0gMHgyNDY2OwogIHQuc2V2ZW5jaXJjbGVpbnZlcnNlc2Fuc3NlcmlmID0gMHgyNzkwOwogIHQuc2V2ZW5kZXZhID0gMHgwOTZkOwogIHQuc2V2ZW5laWdodGhzID0gMHgyMTVlOwogIHQuc2V2ZW5ndWphcmF0aSA9IDB4MGFlZDsKICB0LnNldmVuZ3VybXVraGkgPSAweDBhNmQ7CiAgdC5zZXZlbmhhY2thcmFiaWMgPSAweDA2Njc7CiAgdC5zZXZlbmhhbmd6aG91ID0gMHgzMDI3OwogIHQuc2V2ZW5pZGVvZ3JhcGhpY3BhcmVuID0gMHgzMjI2OwogIHQuc2V2ZW5pbmZlcmlvciA9IDB4MjA4NzsKICB0LnNldmVubW9ub3NwYWNlID0gMHhmZjE3OwogIHQuc2V2ZW5vbGRzdHlsZSA9IDB4ZjczNzsKICB0LnNldmVucGFyZW4gPSAweDI0N2E7CiAgdC5zZXZlbnBlcmlvZCA9IDB4MjQ4ZTsKICB0LnNldmVucGVyc2lhbiA9IDB4MDZmNzsKICB0LnNldmVucm9tYW4gPSAweDIxNzY7CiAgdC5zZXZlbnN1cGVyaW9yID0gMHgyMDc3OwogIHQuc2V2ZW50ZWVuY2lyY2xlID0gMHgyNDcwOwogIHQuc2V2ZW50ZWVucGFyZW4gPSAweDI0ODQ7CiAgdC5zZXZlbnRlZW5wZXJpb2QgPSAweDI0OTg7CiAgdC5zZXZlbnRoYWkgPSAweDBlNTc7CiAgdC5zZnRoeXBoZW4gPSAweDAwYWQ7CiAgdC5zaGFhcm1lbmlhbiA9IDB4MDU3NzsKICB0LnNoYWJlbmdhbGkgPSAweDA5YjY7CiAgdC5zaGFjeXJpbGxpYyA9IDB4MDQ0ODsKICB0LnNoYWRkYWFyYWJpYyA9IDB4MDY1MTsKICB0LnNoYWRkYWRhbW1hYXJhYmljID0gMHhmYzYxOwogIHQuc2hhZGRhZGFtbWF0YW5hcmFiaWMgPSAweGZjNWU7CiAgdC5zaGFkZGFmYXRoYWFyYWJpYyA9IDB4ZmM2MDsKICB0LnNoYWRkYWthc3JhYXJhYmljID0gMHhmYzYyOwogIHQuc2hhZGRha2FzcmF0YW5hcmFiaWMgPSAweGZjNWY7CiAgdC5zaGFkZSA9IDB4MjU5MjsKICB0LnNoYWRlZGFyayA9IDB4MjU5MzsKICB0LnNoYWRlbGlnaHQgPSAweDI1OTE7CiAgdC5zaGFkZW1lZGl1bSA9IDB4MjU5MjsKICB0LnNoYWRldmEgPSAweDA5MzY7CiAgdC5zaGFndWphcmF0aSA9IDB4MGFiNjsKICB0LnNoYWd1cm11a2hpID0gMHgwYTM2OwogIHQuc2hhbHNoZWxldGhlYnJldyA9IDB4MDU5MzsKICB0LnNoYm9wb21vZm8gPSAweDMxMTU7CiAgdC5zaGNoYWN5cmlsbGljID0gMHgwNDQ5OwogIHQuc2hlZW5hcmFiaWMgPSAweDA2MzQ7CiAgdC5zaGVlbmZpbmFsYXJhYmljID0gMHhmZWI2OwogIHQuc2hlZW5pbml0aWFsYXJhYmljID0gMHhmZWI3OwogIHQuc2hlZW5tZWRpYWxhcmFiaWMgPSAweGZlYjg7CiAgdC5zaGVpY29wdGljID0gMHgwM2UzOwogIHQuc2hlcWVsID0gMHgyMGFhOwogIHQuc2hlcWVsaGVicmV3ID0gMHgyMGFhOwogIHQuc2hldmEgPSAweDA1YjA7CiAgdC5zaGV2YTExNSA9IDB4MDViMDsKICB0LnNoZXZhMTUgPSAweDA1YjA7CiAgdC5zaGV2YTIyID0gMHgwNWIwOwogIHQuc2hldmEyZSA9IDB4MDViMDsKICB0LnNoZXZhaGVicmV3ID0gMHgwNWIwOwogIHQuc2hldmFuYXJyb3doZWJyZXcgPSAweDA1YjA7CiAgdC5zaGV2YXF1YXJ0ZXJoZWJyZXcgPSAweDA1YjA7CiAgdC5zaGV2YXdpZGVoZWJyZXcgPSAweDA1YjA7CiAgdC5zaGhhY3lyaWxsaWMgPSAweDA0YmI7CiAgdC5zaGltYWNvcHRpYyA9IDB4MDNlZDsKICB0LnNoaW4gPSAweDA1ZTk7CiAgdC5zaGluZGFnZXNoID0gMHhmYjQ5OwogIHQuc2hpbmRhZ2VzaGhlYnJldyA9IDB4ZmI0OTsKICB0LnNoaW5kYWdlc2hzaGluZG90ID0gMHhmYjJjOwogIHQuc2hpbmRhZ2VzaHNoaW5kb3RoZWJyZXcgPSAweGZiMmM7CiAgdC5zaGluZGFnZXNoc2luZG90ID0gMHhmYjJkOwogIHQuc2hpbmRhZ2VzaHNpbmRvdGhlYnJldyA9IDB4ZmIyZDsKICB0LnNoaW5kb3RoZWJyZXcgPSAweDA1YzE7CiAgdC5zaGluaGVicmV3ID0gMHgwNWU5OwogIHQuc2hpbnNoaW5kb3QgPSAweGZiMmE7CiAgdC5zaGluc2hpbmRvdGhlYnJldyA9IDB4ZmIyYTsKICB0LnNoaW5zaW5kb3QgPSAweGZiMmI7CiAgdC5zaGluc2luZG90aGVicmV3ID0gMHhmYjJiOwogIHQuc2hvb2sgPSAweDAyODI7CiAgdC5zaWdtYSA9IDB4MDNjMzsKICB0LnNpZ21hMSA9IDB4MDNjMjsKICB0LnNpZ21hZmluYWwgPSAweDAzYzI7CiAgdC5zaWdtYWx1bmF0ZXN5bWJvbGdyZWVrID0gMHgwM2YyOwogIHQuc2loaXJhZ2FuYSA9IDB4MzA1NzsKICB0LnNpa2F0YWthbmEgPSAweDMwYjc7CiAgdC5zaWthdGFrYW5haGFsZndpZHRoID0gMHhmZjdjOwogIHQuc2lsdXFoZWJyZXcgPSAweDA1YmQ7CiAgdC5zaWx1cWxlZnRoZWJyZXcgPSAweDA1YmQ7CiAgdC5zaW1pbGFyID0gMHgyMjNjOwogIHQuc2luZG90aGVicmV3ID0gMHgwNWMyOwogIHQuc2lvc2FjaXJjbGVrb3JlYW4gPSAweDMyNzQ7CiAgdC5zaW9zYXBhcmVua29yZWFuID0gMHgzMjE0OwogIHQuc2lvc2NpZXVja29yZWFuID0gMHgzMTdlOwogIHQuc2lvc2NpcmNsZWtvcmVhbiA9IDB4MzI2NjsKICB0LnNpb3NraXllb2trb3JlYW4gPSAweDMxN2E7CiAgdC5zaW9za29yZWFuID0gMHgzMTQ1OwogIHQuc2lvc25pZXVua29yZWFuID0gMHgzMTdiOwogIHQuc2lvc3BhcmVua29yZWFuID0gMHgzMjA2OwogIHQuc2lvc3BpZXVwa29yZWFuID0gMHgzMTdkOwogIHQuc2lvc3Rpa2V1dGtvcmVhbiA9IDB4MzE3YzsKICB0LnNpeCA9IDB4MDAzNjsKICB0LnNpeGFyYWJpYyA9IDB4MDY2NjsKICB0LnNpeGJlbmdhbGkgPSAweDA5ZWM7CiAgdC5zaXhjaXJjbGUgPSAweDI0NjU7CiAgdC5zaXhjaXJjbGVpbnZlcnNlc2Fuc3NlcmlmID0gMHgyNzhmOwogIHQuc2l4ZGV2YSA9IDB4MDk2YzsKICB0LnNpeGd1amFyYXRpID0gMHgwYWVjOwogIHQuc2l4Z3VybXVraGkgPSAweDBhNmM7CiAgdC5zaXhoYWNrYXJhYmljID0gMHgwNjY2OwogIHQuc2l4aGFuZ3pob3UgPSAweDMwMjY7CiAgdC5zaXhpZGVvZ3JhcGhpY3BhcmVuID0gMHgzMjI1OwogIHQuc2l4aW5mZXJpb3IgPSAweDIwODY7CiAgdC5zaXhtb25vc3BhY2UgPSAweGZmMTY7CiAgdC5zaXhvbGRzdHlsZSA9IDB4ZjczNjsKICB0LnNpeHBhcmVuID0gMHgyNDc5OwogIHQuc2l4cGVyaW9kID0gMHgyNDhkOwogIHQuc2l4cGVyc2lhbiA9IDB4MDZmNjsKICB0LnNpeHJvbWFuID0gMHgyMTc1OwogIHQuc2l4c3VwZXJpb3IgPSAweDIwNzY7CiAgdC5zaXh0ZWVuY2lyY2xlID0gMHgyNDZmOwogIHQuc2l4dGVlbmN1cnJlbmN5ZGVub21pbmF0b3JiZW5nYWxpID0gMHgwOWY5OwogIHQuc2l4dGVlbnBhcmVuID0gMHgyNDgzOwogIHQuc2l4dGVlbnBlcmlvZCA9IDB4MjQ5NzsKICB0LnNpeHRoYWkgPSAweDBlNTY7CiAgdC5zbGFzaCA9IDB4MDAyZjsKICB0LnNsYXNobW9ub3NwYWNlID0gMHhmZjBmOwogIHQuc2xvbmcgPSAweDAxN2Y7CiAgdC5zbG9uZ2RvdGFjY2VudCA9IDB4MWU5YjsKICB0LnNtaWxlZmFjZSA9IDB4MjYzYTsKICB0LnNtb25vc3BhY2UgPSAweGZmNTM7CiAgdC5zb2ZwYXN1cWhlYnJldyA9IDB4MDVjMzsKICB0LnNvZnRoeXBoZW4gPSAweDAwYWQ7CiAgdC5zb2Z0c2lnbmN5cmlsbGljID0gMHgwNDRjOwogIHQuc29oaXJhZ2FuYSA9IDB4MzA1ZDsKICB0LnNva2F0YWthbmEgPSAweDMwYmQ7CiAgdC5zb2thdGFrYW5haGFsZndpZHRoID0gMHhmZjdmOwogIHQuc29saWR1c2xvbmdvdmVybGF5Y21iID0gMHgwMzM4OwogIHQuc29saWR1c3Nob3J0b3ZlcmxheWNtYiA9IDB4MDMzNzsKICB0LnNvcnVzaXRoYWkgPSAweDBlMjk7CiAgdC5zb3NhbGF0aGFpID0gMHgwZTI4OwogIHQuc29zb3RoYWkgPSAweDBlMGI7CiAgdC5zb3N1YXRoYWkgPSAweDBlMmE7CiAgdC5zcGFjZSA9IDB4MDAyMDsKICB0LnNwYWNlaGFja2FyYWJpYyA9IDB4MDAyMDsKICB0LnNwYWRlID0gMHgyNjYwOwogIHQuc3BhZGVzdWl0YmxhY2sgPSAweDI2NjA7CiAgdC5zcGFkZXN1aXR3aGl0ZSA9IDB4MjY2NDsKICB0LnNwYXJlbiA9IDB4MjRhZTsKICB0LnNxdWFyZWJlbG93Y21iID0gMHgwMzNiOwogIHQuc3F1YXJlY2MgPSAweDMzYzQ7CiAgdC5zcXVhcmVjbSA9IDB4MzM5ZDsKICB0LnNxdWFyZWRpYWdvbmFsY3Jvc3NoYXRjaGZpbGwgPSAweDI1YTk7CiAgdC5zcXVhcmVob3Jpem9udGFsZmlsbCA9IDB4MjVhNDsKICB0LnNxdWFyZWtnID0gMHgzMzhmOwogIHQuc3F1YXJla20gPSAweDMzOWU7CiAgdC5zcXVhcmVrbWNhcGl0YWwgPSAweDMzY2U7CiAgdC5zcXVhcmVsbiA9IDB4MzNkMTsKICB0LnNxdWFyZWxvZyA9IDB4MzNkMjsKICB0LnNxdWFyZW1nID0gMHgzMzhlOwogIHQuc3F1YXJlbWlsID0gMHgzM2Q1OwogIHQuc3F1YXJlbW0gPSAweDMzOWM7CiAgdC5zcXVhcmVtc3F1YXJlZCA9IDB4MzNhMTsKICB0LnNxdWFyZW9ydGhvZ29uYWxjcm9zc2hhdGNoZmlsbCA9IDB4MjVhNjsKICB0LnNxdWFyZXVwcGVybGVmdHRvbG93ZXJyaWdodGZpbGwgPSAweDI1YTc7CiAgdC5zcXVhcmV1cHBlcnJpZ2h0dG9sb3dlcmxlZnRmaWxsID0gMHgyNWE4OwogIHQuc3F1YXJldmVydGljYWxmaWxsID0gMHgyNWE1OwogIHQuc3F1YXJld2hpdGV3aXRoc21hbGxibGFjayA9IDB4MjVhMzsKICB0LnNyc3F1YXJlID0gMHgzM2RiOwogIHQuc3NhYmVuZ2FsaSA9IDB4MDliNzsKICB0LnNzYWRldmEgPSAweDA5Mzc7CiAgdC5zc2FndWphcmF0aSA9IDB4MGFiNzsKICB0LnNzYW5nY2lldWNrb3JlYW4gPSAweDMxNDk7CiAgdC5zc2FuZ2hpZXVoa29yZWFuID0gMHgzMTg1OwogIHQuc3NhbmdpZXVuZ2tvcmVhbiA9IDB4MzE4MDsKICB0LnNzYW5na2l5ZW9ra29yZWFuID0gMHgzMTMyOwogIHQuc3NhbmduaWV1bmtvcmVhbiA9IDB4MzE2NTsKICB0LnNzYW5ncGlldXBrb3JlYW4gPSAweDMxNDM7CiAgdC5zc2FuZ3Npb3Nrb3JlYW4gPSAweDMxNDY7CiAgdC5zc2FuZ3Rpa2V1dGtvcmVhbiA9IDB4MzEzODsKICB0LnNzdXBlcmlvciA9IDB4ZjZmMjsKICB0LnN0ZXJsaW5nID0gMHgwMGEzOwogIHQuc3Rlcmxpbmdtb25vc3BhY2UgPSAweGZmZTE7CiAgdC5zdHJva2Vsb25nb3ZlcmxheWNtYiA9IDB4MDMzNjsKICB0LnN0cm9rZXNob3J0b3ZlcmxheWNtYiA9IDB4MDMzNTsKICB0LnN1YnNldCA9IDB4MjI4MjsKICB0LnN1YnNldG5vdGVxdWFsID0gMHgyMjhhOwogIHQuc3Vic2V0b3JlcXVhbCA9IDB4MjI4NjsKICB0LnN1Y2NlZWRzID0gMHgyMjdiOwogIHQuc3VjaHRoYXQgPSAweDIyMGI7CiAgdC5zdWhpcmFnYW5hID0gMHgzMDU5OwogIHQuc3VrYXRha2FuYSA9IDB4MzBiOTsKICB0LnN1a2F0YWthbmFoYWxmd2lkdGggPSAweGZmN2Q7CiAgdC5zdWt1bmFyYWJpYyA9IDB4MDY1MjsKICB0LnN1bW1hdGlvbiA9IDB4MjIxMTsKICB0LnN1biA9IDB4MjYzYzsKICB0LnN1cGVyc2V0ID0gMHgyMjgzOwogIHQuc3VwZXJzZXRub3RlcXVhbCA9IDB4MjI4YjsKICB0LnN1cGVyc2V0b3JlcXVhbCA9IDB4MjI4NzsKICB0LnN2c3F1YXJlID0gMHgzM2RjOwogIHQuc3lvdXdhZXJhc3F1YXJlID0gMHgzMzdjOwogIHQudCA9IDB4MDA3NDsKICB0LnRhYmVuZ2FsaSA9IDB4MDlhNDsKICB0LnRhY2tkb3duID0gMHgyMmE0OwogIHQudGFja2xlZnQgPSAweDIyYTM7CiAgdC50YWRldmEgPSAweDA5MjQ7CiAgdC50YWd1amFyYXRpID0gMHgwYWE0OwogIHQudGFndXJtdWtoaSA9IDB4MGEyNDsKICB0LnRhaGFyYWJpYyA9IDB4MDYzNzsKICB0LnRhaGZpbmFsYXJhYmljID0gMHhmZWMyOwogIHQudGFoaW5pdGlhbGFyYWJpYyA9IDB4ZmVjMzsKICB0LnRhaGlyYWdhbmEgPSAweDMwNWY7CiAgdC50YWhtZWRpYWxhcmFiaWMgPSAweGZlYzQ7CiAgdC50YWlzeW91ZXJhc3F1YXJlID0gMHgzMzdkOwogIHQudGFrYXRha2FuYSA9IDB4MzBiZjsKICB0LnRha2F0YWthbmFoYWxmd2lkdGggPSAweGZmODA7CiAgdC50YXR3ZWVsYXJhYmljID0gMHgwNjQwOwogIHQudGF1ID0gMHgwM2M0OwogIHQudGF2ID0gMHgwNWVhOwogIHQudGF2ZGFnZXMgPSAweGZiNGE7CiAgdC50YXZkYWdlc2ggPSAweGZiNGE7CiAgdC50YXZkYWdlc2hoZWJyZXcgPSAweGZiNGE7CiAgdC50YXZoZWJyZXcgPSAweDA1ZWE7CiAgdC50YmFyID0gMHgwMTY3OwogIHQudGJvcG9tb2ZvID0gMHgzMTBhOwogIHQudGNhcm9uID0gMHgwMTY1OwogIHQudGNjdXJsID0gMHgwMmE4OwogIHQudGNlZGlsbGEgPSAweDAxNjM7CiAgdC50Y2hlaGFyYWJpYyA9IDB4MDY4NjsKICB0LnRjaGVoZmluYWxhcmFiaWMgPSAweGZiN2I7CiAgdC50Y2hlaGluaXRpYWxhcmFiaWMgPSAweGZiN2M7CiAgdC50Y2hlaG1lZGlhbGFyYWJpYyA9IDB4ZmI3ZDsKICB0LnRjaXJjbGUgPSAweDI0ZTM7CiAgdC50Y2lyY3VtZmxleGJlbG93ID0gMHgxZTcxOwogIHQudGNvbW1hYWNjZW50ID0gMHgwMTYzOwogIHQudGRpZXJlc2lzID0gMHgxZTk3OwogIHQudGRvdGFjY2VudCA9IDB4MWU2YjsKICB0LnRkb3RiZWxvdyA9IDB4MWU2ZDsKICB0LnRlY3lyaWxsaWMgPSAweDA0NDI7CiAgdC50ZWRlc2NlbmRlcmN5cmlsbGljID0gMHgwNGFkOwogIHQudGVoYXJhYmljID0gMHgwNjJhOwogIHQudGVoZmluYWxhcmFiaWMgPSAweGZlOTY7CiAgdC50ZWhoYWhpbml0aWFsYXJhYmljID0gMHhmY2EyOwogIHQudGVoaGFoaXNvbGF0ZWRhcmFiaWMgPSAweGZjMGM7CiAgdC50ZWhpbml0aWFsYXJhYmljID0gMHhmZTk3OwogIHQudGVoaXJhZ2FuYSA9IDB4MzA2NjsKICB0LnRlaGplZW1pbml0aWFsYXJhYmljID0gMHhmY2ExOwogIHQudGVoamVlbWlzb2xhdGVkYXJhYmljID0gMHhmYzBiOwogIHQudGVobWFyYnV0YWFyYWJpYyA9IDB4MDYyOTsKICB0LnRlaG1hcmJ1dGFmaW5hbGFyYWJpYyA9IDB4ZmU5NDsKICB0LnRlaG1lZGlhbGFyYWJpYyA9IDB4ZmU5ODsKICB0LnRlaG1lZW1pbml0aWFsYXJhYmljID0gMHhmY2E0OwogIHQudGVobWVlbWlzb2xhdGVkYXJhYmljID0gMHhmYzBlOwogIHQudGVobm9vbmZpbmFsYXJhYmljID0gMHhmYzczOwogIHQudGVrYXRha2FuYSA9IDB4MzBjNjsKICB0LnRla2F0YWthbmFoYWxmd2lkdGggPSAweGZmODM7CiAgdC50ZWxlcGhvbmUgPSAweDIxMjE7CiAgdC50ZWxlcGhvbmVibGFjayA9IDB4MjYwZTsKICB0LnRlbGlzaGFnZWRvbGFoZWJyZXcgPSAweDA1YTA7CiAgdC50ZWxpc2hhcWV0YW5haGVicmV3ID0gMHgwNWE5OwogIHQudGVuY2lyY2xlID0gMHgyNDY5OwogIHQudGVuaWRlb2dyYXBoaWNwYXJlbiA9IDB4MzIyOTsKICB0LnRlbnBhcmVuID0gMHgyNDdkOwogIHQudGVucGVyaW9kID0gMHgyNDkxOwogIHQudGVucm9tYW4gPSAweDIxNzk7CiAgdC50ZXNoID0gMHgwMmE3OwogIHQudGV0ID0gMHgwNWQ4OwogIHQudGV0ZGFnZXNoID0gMHhmYjM4OwogIHQudGV0ZGFnZXNoaGVicmV3ID0gMHhmYjM4OwogIHQudGV0aGVicmV3ID0gMHgwNWQ4OwogIHQudGV0c2VjeXJpbGxpYyA9IDB4MDRiNTsKICB0LnRldmlyaGVicmV3ID0gMHgwNTliOwogIHQudGV2aXJsZWZ0aGVicmV3ID0gMHgwNTliOwogIHQudGhhYmVuZ2FsaSA9IDB4MDlhNTsKICB0LnRoYWRldmEgPSAweDA5MjU7CiAgdC50aGFndWphcmF0aSA9IDB4MGFhNTsKICB0LnRoYWd1cm11a2hpID0gMHgwYTI1OwogIHQudGhhbGFyYWJpYyA9IDB4MDYzMDsKICB0LnRoYWxmaW5hbGFyYWJpYyA9IDB4ZmVhYzsKICB0LnRoYW50aGFraGF0bG93bGVmdHRoYWkgPSAweGY4OTg7CiAgdC50aGFudGhha2hhdGxvd3JpZ2h0dGhhaSA9IDB4Zjg5NzsKICB0LnRoYW50aGFraGF0dGhhaSA9IDB4MGU0YzsKICB0LnRoYW50aGFraGF0dXBwZXJsZWZ0dGhhaSA9IDB4Zjg5NjsKICB0LnRoZWhhcmFiaWMgPSAweDA2MmI7CiAgdC50aGVoZmluYWxhcmFiaWMgPSAweGZlOWE7CiAgdC50aGVoaW5pdGlhbGFyYWJpYyA9IDB4ZmU5YjsKICB0LnRoZWhtZWRpYWxhcmFiaWMgPSAweGZlOWM7CiAgdC50aGVyZWV4aXN0cyA9IDB4MjIwMzsKICB0LnRoZXJlZm9yZSA9IDB4MjIzNDsKICB0LnRoZXRhID0gMHgwM2I4OwogIHQudGhldGExID0gMHgwM2QxOwogIHQudGhldGFzeW1ib2xncmVlayA9IDB4MDNkMTsKICB0LnRoaWV1dGhhY2lyY2xla29yZWFuID0gMHgzMjc5OwogIHQudGhpZXV0aGFwYXJlbmtvcmVhbiA9IDB4MzIxOTsKICB0LnRoaWV1dGhjaXJjbGVrb3JlYW4gPSAweDMyNmI7CiAgdC50aGlldXRoa29yZWFuID0gMHgzMTRjOwogIHQudGhpZXV0aHBhcmVua29yZWFuID0gMHgzMjBiOwogIHQudGhpcnRlZW5jaXJjbGUgPSAweDI0NmM7CiAgdC50aGlydGVlbnBhcmVuID0gMHgyNDgwOwogIHQudGhpcnRlZW5wZXJpb2QgPSAweDI0OTQ7CiAgdC50aG9uYW5nbW9udGhvdGhhaSA9IDB4MGUxMTsKICB0LnRob29rID0gMHgwMWFkOwogIHQudGhvcGh1dGhhb3RoYWkgPSAweDBlMTI7CiAgdC50aG9ybiA9IDB4MDBmZTsKICB0LnRob3RoYWhhbnRoYWkgPSAweDBlMTc7CiAgdC50aG90aGFudGhhaSA9IDB4MGUxMDsKICB0LnRob3Rob25ndGhhaSA9IDB4MGUxODsKICB0LnRob3RodW5ndGhhaSA9IDB4MGUxNjsKICB0LnRob3VzYW5kY3lyaWxsaWMgPSAweDA0ODI7CiAgdC50aG91c2FuZHNzZXBhcmF0b3JhcmFiaWMgPSAweDA2NmM7CiAgdC50aG91c2FuZHNzZXBhcmF0b3JwZXJzaWFuID0gMHgwNjZjOwogIHQudGhyZWUgPSAweDAwMzM7CiAgdC50aHJlZWFyYWJpYyA9IDB4MDY2MzsKICB0LnRocmVlYmVuZ2FsaSA9IDB4MDllOTsKICB0LnRocmVlY2lyY2xlID0gMHgyNDYyOwogIHQudGhyZWVjaXJjbGVpbnZlcnNlc2Fuc3NlcmlmID0gMHgyNzhjOwogIHQudGhyZWVkZXZhID0gMHgwOTY5OwogIHQudGhyZWVlaWdodGhzID0gMHgyMTVjOwogIHQudGhyZWVndWphcmF0aSA9IDB4MGFlOTsKICB0LnRocmVlZ3VybXVraGkgPSAweDBhNjk7CiAgdC50aHJlZWhhY2thcmFiaWMgPSAweDA2NjM7CiAgdC50aHJlZWhhbmd6aG91ID0gMHgzMDIzOwogIHQudGhyZWVpZGVvZ3JhcGhpY3BhcmVuID0gMHgzMjIyOwogIHQudGhyZWVpbmZlcmlvciA9IDB4MjA4MzsKICB0LnRocmVlbW9ub3NwYWNlID0gMHhmZjEzOwogIHQudGhyZWVudW1lcmF0b3JiZW5nYWxpID0gMHgwOWY2OwogIHQudGhyZWVvbGRzdHlsZSA9IDB4ZjczMzsKICB0LnRocmVlcGFyZW4gPSAweDI0NzY7CiAgdC50aHJlZXBlcmlvZCA9IDB4MjQ4YTsKICB0LnRocmVlcGVyc2lhbiA9IDB4MDZmMzsKICB0LnRocmVlcXVhcnRlcnMgPSAweDAwYmU7CiAgdC50aHJlZXF1YXJ0ZXJzZW1kYXNoID0gMHhmNmRlOwogIHQudGhyZWVyb21hbiA9IDB4MjE3MjsKICB0LnRocmVlc3VwZXJpb3IgPSAweDAwYjM7CiAgdC50aHJlZXRoYWkgPSAweDBlNTM7CiAgdC50aHpzcXVhcmUgPSAweDMzOTQ7CiAgdC50aWhpcmFnYW5hID0gMHgzMDYxOwogIHQudGlrYXRha2FuYSA9IDB4MzBjMTsKICB0LnRpa2F0YWthbmFoYWxmd2lkdGggPSAweGZmODE7CiAgdC50aWtldXRhY2lyY2xla29yZWFuID0gMHgzMjcwOwogIHQudGlrZXV0YXBhcmVua29yZWFuID0gMHgzMjEwOwogIHQudGlrZXV0Y2lyY2xla29yZWFuID0gMHgzMjYyOwogIHQudGlrZXV0a29yZWFuID0gMHgzMTM3OwogIHQudGlrZXV0cGFyZW5rb3JlYW4gPSAweDMyMDI7CiAgdC50aWxkZSA9IDB4MDJkYzsKICB0LnRpbGRlYmVsb3djbWIgPSAweDAzMzA7CiAgdC50aWxkZWNtYiA9IDB4MDMwMzsKICB0LnRpbGRlY29tYiA9IDB4MDMwMzsKICB0LnRpbGRlZG91YmxlY21iID0gMHgwMzYwOwogIHQudGlsZGVvcGVyYXRvciA9IDB4MjIzYzsKICB0LnRpbGRlb3ZlcmxheWNtYiA9IDB4MDMzNDsKICB0LnRpbGRldmVydGljYWxjbWIgPSAweDAzM2U7CiAgdC50aW1lc2NpcmNsZSA9IDB4MjI5NzsKICB0LnRpcGVoYWhlYnJldyA9IDB4MDU5NjsKICB0LnRpcGVoYWxlZnRoZWJyZXcgPSAweDA1OTY7CiAgdC50aXBwaWd1cm11a2hpID0gMHgwYTcwOwogIHQudGl0bG9jeXJpbGxpY2NtYiA9IDB4MDQ4MzsKICB0LnRpd25hcm1lbmlhbiA9IDB4MDU3ZjsKICB0LnRsaW5lYmVsb3cgPSAweDFlNmY7CiAgdC50bW9ub3NwYWNlID0gMHhmZjU0OwogIHQudG9hcm1lbmlhbiA9IDB4MDU2OTsKICB0LnRvaGlyYWdhbmEgPSAweDMwNjg7CiAgdC50b2thdGFrYW5hID0gMHgzMGM4OwogIHQudG9rYXRha2FuYWhhbGZ3aWR0aCA9IDB4ZmY4NDsKICB0LnRvbmViYXJleHRyYWhpZ2htb2QgPSAweDAyZTU7CiAgdC50b25lYmFyZXh0cmFsb3dtb2QgPSAweDAyZTk7CiAgdC50b25lYmFyaGlnaG1vZCA9IDB4MDJlNjsKICB0LnRvbmViYXJsb3dtb2QgPSAweDAyZTg7CiAgdC50b25lYmFybWlkbW9kID0gMHgwMmU3OwogIHQudG9uZWZpdmUgPSAweDAxYmQ7CiAgdC50b25lc2l4ID0gMHgwMTg1OwogIHQudG9uZXR3byA9IDB4MDFhODsKICB0LnRvbm9zID0gMHgwMzg0OwogIHQudG9uc3F1YXJlID0gMHgzMzI3OwogIHQudG9wYXRha3RoYWkgPSAweDBlMGY7CiAgdC50b3J0b2lzZXNoZWxsYnJhY2tldGxlZnQgPSAweDMwMTQ7CiAgdC50b3J0b2lzZXNoZWxsYnJhY2tldGxlZnRzbWFsbCA9IDB4ZmU1ZDsKICB0LnRvcnRvaXNlc2hlbGxicmFja2V0bGVmdHZlcnRpY2FsID0gMHhmZTM5OwogIHQudG9ydG9pc2VzaGVsbGJyYWNrZXRyaWdodCA9IDB4MzAxNTsKICB0LnRvcnRvaXNlc2hlbGxicmFja2V0cmlnaHRzbWFsbCA9IDB4ZmU1ZTsKICB0LnRvcnRvaXNlc2hlbGxicmFja2V0cmlnaHR2ZXJ0aWNhbCA9IDB4ZmUzYTsKICB0LnRvdGFvdGhhaSA9IDB4MGUxNTsKICB0LnRwYWxhdGFsaG9vayA9IDB4MDFhYjsKICB0LnRwYXJlbiA9IDB4MjRhZjsKICB0LnRyYWRlbWFyayA9IDB4MjEyMjsKICB0LnRyYWRlbWFya3NhbnMgPSAweGY4ZWE7CiAgdC50cmFkZW1hcmtzZXJpZiA9IDB4ZjZkYjsKICB0LnRyZXRyb2ZsZXhob29rID0gMHgwMjg4OwogIHQudHJpYWdkbiA9IDB4MjViYzsKICB0LnRyaWFnbGYgPSAweDI1YzQ7CiAgdC50cmlhZ3J0ID0gMHgyNWJhOwogIHQudHJpYWd1cCA9IDB4MjViMjsKICB0LnRzID0gMHgwMmE2OwogIHQudHNhZGkgPSAweDA1ZTY7CiAgdC50c2FkaWRhZ2VzaCA9IDB4ZmI0NjsKICB0LnRzYWRpZGFnZXNoaGVicmV3ID0gMHhmYjQ2OwogIHQudHNhZGloZWJyZXcgPSAweDA1ZTY7CiAgdC50c2VjeXJpbGxpYyA9IDB4MDQ0NjsKICB0LnRzZXJlID0gMHgwNWI1OwogIHQudHNlcmUxMiA9IDB4MDViNTsKICB0LnRzZXJlMWUgPSAweDA1YjU7CiAgdC50c2VyZTJiID0gMHgwNWI1OwogIHQudHNlcmVoZWJyZXcgPSAweDA1YjU7CiAgdC50c2VyZW5hcnJvd2hlYnJldyA9IDB4MDViNTsKICB0LnRzZXJlcXVhcnRlcmhlYnJldyA9IDB4MDViNTsKICB0LnRzZXJld2lkZWhlYnJldyA9IDB4MDViNTsKICB0LnRzaGVjeXJpbGxpYyA9IDB4MDQ1YjsKICB0LnRzdXBlcmlvciA9IDB4ZjZmMzsKICB0LnR0YWJlbmdhbGkgPSAweDA5OWY7CiAgdC50dGFkZXZhID0gMHgwOTFmOwogIHQudHRhZ3VqYXJhdGkgPSAweDBhOWY7CiAgdC50dGFndXJtdWtoaSA9IDB4MGExZjsKICB0LnR0ZWhhcmFiaWMgPSAweDA2Nzk7CiAgdC50dGVoZmluYWxhcmFiaWMgPSAweGZiNjc7CiAgdC50dGVoaW5pdGlhbGFyYWJpYyA9IDB4ZmI2ODsKICB0LnR0ZWhtZWRpYWxhcmFiaWMgPSAweGZiNjk7CiAgdC50dGhhYmVuZ2FsaSA9IDB4MDlhMDsKICB0LnR0aGFkZXZhID0gMHgwOTIwOwogIHQudHRoYWd1amFyYXRpID0gMHgwYWEwOwogIHQudHRoYWd1cm11a2hpID0gMHgwYTIwOwogIHQudHR1cm5lZCA9IDB4MDI4NzsKICB0LnR1aGlyYWdhbmEgPSAweDMwNjQ7CiAgdC50dWthdGFrYW5hID0gMHgzMGM0OwogIHQudHVrYXRha2FuYWhhbGZ3aWR0aCA9IDB4ZmY4MjsKICB0LnR1c21hbGxoaXJhZ2FuYSA9IDB4MzA2MzsKICB0LnR1c21hbGxrYXRha2FuYSA9IDB4MzBjMzsKICB0LnR1c21hbGxrYXRha2FuYWhhbGZ3aWR0aCA9IDB4ZmY2ZjsKICB0LnR3ZWx2ZWNpcmNsZSA9IDB4MjQ2YjsKICB0LnR3ZWx2ZXBhcmVuID0gMHgyNDdmOwogIHQudHdlbHZlcGVyaW9kID0gMHgyNDkzOwogIHQudHdlbHZlcm9tYW4gPSAweDIxN2I7CiAgdC50d2VudHljaXJjbGUgPSAweDI0NzM7CiAgdC50d2VudHloYW5nemhvdSA9IDB4NTM0NDsKICB0LnR3ZW50eXBhcmVuID0gMHgyNDg3OwogIHQudHdlbnR5cGVyaW9kID0gMHgyNDliOwogIHQudHdvID0gMHgwMDMyOwogIHQudHdvYXJhYmljID0gMHgwNjYyOwogIHQudHdvYmVuZ2FsaSA9IDB4MDllODsKICB0LnR3b2NpcmNsZSA9IDB4MjQ2MTsKICB0LnR3b2NpcmNsZWludmVyc2VzYW5zc2VyaWYgPSAweDI3OGI7CiAgdC50d29kZXZhID0gMHgwOTY4OwogIHQudHdvZG90ZW5sZWFkZXIgPSAweDIwMjU7CiAgdC50d29kb3RsZWFkZXIgPSAweDIwMjU7CiAgdC50d29kb3RsZWFkZXJ2ZXJ0aWNhbCA9IDB4ZmUzMDsKICB0LnR3b2d1amFyYXRpID0gMHgwYWU4OwogIHQudHdvZ3VybXVraGkgPSAweDBhNjg7CiAgdC50d29oYWNrYXJhYmljID0gMHgwNjYyOwogIHQudHdvaGFuZ3pob3UgPSAweDMwMjI7CiAgdC50d29pZGVvZ3JhcGhpY3BhcmVuID0gMHgzMjIxOwogIHQudHdvaW5mZXJpb3IgPSAweDIwODI7CiAgdC50d29tb25vc3BhY2UgPSAweGZmMTI7CiAgdC50d29udW1lcmF0b3JiZW5nYWxpID0gMHgwOWY1OwogIHQudHdvb2xkc3R5bGUgPSAweGY3MzI7CiAgdC50d29wYXJlbiA9IDB4MjQ3NTsKICB0LnR3b3BlcmlvZCA9IDB4MjQ4OTsKICB0LnR3b3BlcnNpYW4gPSAweDA2ZjI7CiAgdC50d29yb21hbiA9IDB4MjE3MTsKICB0LnR3b3N0cm9rZSA9IDB4MDFiYjsKICB0LnR3b3N1cGVyaW9yID0gMHgwMGIyOwogIHQudHdvdGhhaSA9IDB4MGU1MjsKICB0LnR3b3RoaXJkcyA9IDB4MjE1NDsKICB0LnUgPSAweDAwNzU7CiAgdC51YWN1dGUgPSAweDAwZmE7CiAgdC51YmFyID0gMHgwMjg5OwogIHQudWJlbmdhbGkgPSAweDA5ODk7CiAgdC51Ym9wb21vZm8gPSAweDMxMjg7CiAgdC51YnJldmUgPSAweDAxNmQ7CiAgdC51Y2Fyb24gPSAweDAxZDQ7CiAgdC51Y2lyY2xlID0gMHgyNGU0OwogIHQudWNpcmN1bWZsZXggPSAweDAwZmI7CiAgdC51Y2lyY3VtZmxleGJlbG93ID0gMHgxZTc3OwogIHQudWN5cmlsbGljID0gMHgwNDQzOwogIHQudWRhdHRhZGV2YSA9IDB4MDk1MTsKICB0LnVkYmxhY3V0ZSA9IDB4MDE3MTsKICB0LnVkYmxncmF2ZSA9IDB4MDIxNTsKICB0LnVkZXZhID0gMHgwOTA5OwogIHQudWRpZXJlc2lzID0gMHgwMGZjOwogIHQudWRpZXJlc2lzYWN1dGUgPSAweDAxZDg7CiAgdC51ZGllcmVzaXNiZWxvdyA9IDB4MWU3MzsKICB0LnVkaWVyZXNpc2Nhcm9uID0gMHgwMWRhOwogIHQudWRpZXJlc2lzY3lyaWxsaWMgPSAweDA0ZjE7CiAgdC51ZGllcmVzaXNncmF2ZSA9IDB4MDFkYzsKICB0LnVkaWVyZXNpc21hY3JvbiA9IDB4MDFkNjsKICB0LnVkb3RiZWxvdyA9IDB4MWVlNTsKICB0LnVncmF2ZSA9IDB4MDBmOTsKICB0LnVndWphcmF0aSA9IDB4MGE4OTsKICB0LnVndXJtdWtoaSA9IDB4MGEwOTsKICB0LnVoaXJhZ2FuYSA9IDB4MzA0NjsKICB0LnVob29rYWJvdmUgPSAweDFlZTc7CiAgdC51aG9ybiA9IDB4MDFiMDsKICB0LnVob3JuYWN1dGUgPSAweDFlZTk7CiAgdC51aG9ybmRvdGJlbG93ID0gMHgxZWYxOwogIHQudWhvcm5ncmF2ZSA9IDB4MWVlYjsKICB0LnVob3JuaG9va2Fib3ZlID0gMHgxZWVkOwogIHQudWhvcm50aWxkZSA9IDB4MWVlZjsKICB0LnVodW5nYXJ1bWxhdXQgPSAweDAxNzE7CiAgdC51aHVuZ2FydW1sYXV0Y3lyaWxsaWMgPSAweDA0ZjM7CiAgdC51aW52ZXJ0ZWRicmV2ZSA9IDB4MDIxNzsKICB0LnVrYXRha2FuYSA9IDB4MzBhNjsKICB0LnVrYXRha2FuYWhhbGZ3aWR0aCA9IDB4ZmY3MzsKICB0LnVrY3lyaWxsaWMgPSAweDA0Nzk7CiAgdC51a29yZWFuID0gMHgzMTVjOwogIHQudW1hY3JvbiA9IDB4MDE2YjsKICB0LnVtYWNyb25jeXJpbGxpYyA9IDB4MDRlZjsKICB0LnVtYWNyb25kaWVyZXNpcyA9IDB4MWU3YjsKICB0LnVtYXRyYWd1cm11a2hpID0gMHgwYTQxOwogIHQudW1vbm9zcGFjZSA9IDB4ZmY1NTsKICB0LnVuZGVyc2NvcmUgPSAweDAwNWY7CiAgdC51bmRlcnNjb3JlZGJsID0gMHgyMDE3OwogIHQudW5kZXJzY29yZW1vbm9zcGFjZSA9IDB4ZmYzZjsKICB0LnVuZGVyc2NvcmV2ZXJ0aWNhbCA9IDB4ZmUzMzsKICB0LnVuZGVyc2NvcmV3YXZ5ID0gMHhmZTRmOwogIHQudW5pb24gPSAweDIyMmE7CiAgdC51bml2ZXJzYWwgPSAweDIyMDA7CiAgdC51b2dvbmVrID0gMHgwMTczOwogIHQudXBhcmVuID0gMHgyNGIwOwogIHQudXBibG9jayA9IDB4MjU4MDsKICB0LnVwcGVyZG90aGVicmV3ID0gMHgwNWM0OwogIHQudXBzaWxvbiA9IDB4MDNjNTsKICB0LnVwc2lsb25kaWVyZXNpcyA9IDB4MDNjYjsKICB0LnVwc2lsb25kaWVyZXNpc3Rvbm9zID0gMHgwM2IwOwogIHQudXBzaWxvbmxhdGluID0gMHgwMjhhOwogIHQudXBzaWxvbnRvbm9zID0gMHgwM2NkOwogIHQudXB0YWNrYmVsb3djbWIgPSAweDAzMWQ7CiAgdC51cHRhY2ttb2QgPSAweDAyZDQ7CiAgdC51cmFndXJtdWtoaSA9IDB4MGE3MzsKICB0LnVyaW5nID0gMHgwMTZmOwogIHQudXNob3J0Y3lyaWxsaWMgPSAweDA0NWU7CiAgdC51c21hbGxoaXJhZ2FuYSA9IDB4MzA0NTsKICB0LnVzbWFsbGthdGFrYW5hID0gMHgzMGE1OwogIHQudXNtYWxsa2F0YWthbmFoYWxmd2lkdGggPSAweGZmNjk7CiAgdC51c3RyYWlnaHRjeXJpbGxpYyA9IDB4MDRhZjsKICB0LnVzdHJhaWdodHN0cm9rZWN5cmlsbGljID0gMHgwNGIxOwogIHQudXRpbGRlID0gMHgwMTY5OwogIHQudXRpbGRlYWN1dGUgPSAweDFlNzk7CiAgdC51dGlsZGViZWxvdyA9IDB4MWU3NTsKICB0LnV1YmVuZ2FsaSA9IDB4MDk4YTsKICB0LnV1ZGV2YSA9IDB4MDkwYTsKICB0LnV1Z3VqYXJhdGkgPSAweDBhOGE7CiAgdC51dWd1cm11a2hpID0gMHgwYTBhOwogIHQudXVtYXRyYWd1cm11a2hpID0gMHgwYTQyOwogIHQudXV2b3dlbHNpZ25iZW5nYWxpID0gMHgwOWMyOwogIHQudXV2b3dlbHNpZ25kZXZhID0gMHgwOTQyOwogIHQudXV2b3dlbHNpZ25ndWphcmF0aSA9IDB4MGFjMjsKICB0LnV2b3dlbHNpZ25iZW5nYWxpID0gMHgwOWMxOwogIHQudXZvd2Vsc2lnbmRldmEgPSAweDA5NDE7CiAgdC51dm93ZWxzaWduZ3VqYXJhdGkgPSAweDBhYzE7CiAgdC52ID0gMHgwMDc2OwogIHQudmFkZXZhID0gMHgwOTM1OwogIHQudmFndWphcmF0aSA9IDB4MGFiNTsKICB0LnZhZ3VybXVraGkgPSAweDBhMzU7CiAgdC52YWthdGFrYW5hID0gMHgzMGY3OwogIHQudmF2ID0gMHgwNWQ1OwogIHQudmF2ZGFnZXNoID0gMHhmYjM1OwogIHQudmF2ZGFnZXNoNjUgPSAweGZiMzU7CiAgdC52YXZkYWdlc2hoZWJyZXcgPSAweGZiMzU7CiAgdC52YXZoZWJyZXcgPSAweDA1ZDU7CiAgdC52YXZob2xhbSA9IDB4ZmI0YjsKICB0LnZhdmhvbGFtaGVicmV3ID0gMHhmYjRiOwogIHQudmF2dmF2aGVicmV3ID0gMHgwNWYwOwogIHQudmF2eW9kaGVicmV3ID0gMHgwNWYxOwogIHQudmNpcmNsZSA9IDB4MjRlNTsKICB0LnZkb3RiZWxvdyA9IDB4MWU3ZjsKICB0LnZlY3lyaWxsaWMgPSAweDA0MzI7CiAgdC52ZWhhcmFiaWMgPSAweDA2YTQ7CiAgdC52ZWhmaW5hbGFyYWJpYyA9IDB4ZmI2YjsKICB0LnZlaGluaXRpYWxhcmFiaWMgPSAweGZiNmM7CiAgdC52ZWhtZWRpYWxhcmFiaWMgPSAweGZiNmQ7CiAgdC52ZWthdGFrYW5hID0gMHgzMGY5OwogIHQudmVudXMgPSAweDI2NDA7CiAgdC52ZXJ0aWNhbGJhciA9IDB4MDA3YzsKICB0LnZlcnRpY2FsbGluZWFib3ZlY21iID0gMHgwMzBkOwogIHQudmVydGljYWxsaW5lYmVsb3djbWIgPSAweDAzMjk7CiAgdC52ZXJ0aWNhbGxpbmVsb3dtb2QgPSAweDAyY2M7CiAgdC52ZXJ0aWNhbGxpbmVtb2QgPSAweDAyYzg7CiAgdC52ZXdhcm1lbmlhbiA9IDB4MDU3ZTsKICB0LnZob29rID0gMHgwMjhiOwogIHQudmlrYXRha2FuYSA9IDB4MzBmODsKICB0LnZpcmFtYWJlbmdhbGkgPSAweDA5Y2Q7CiAgdC52aXJhbWFkZXZhID0gMHgwOTRkOwogIHQudmlyYW1hZ3VqYXJhdGkgPSAweDBhY2Q7CiAgdC52aXNhcmdhYmVuZ2FsaSA9IDB4MDk4MzsKICB0LnZpc2FyZ2FkZXZhID0gMHgwOTAzOwogIHQudmlzYXJnYWd1amFyYXRpID0gMHgwYTgzOwogIHQudm1vbm9zcGFjZSA9IDB4ZmY1NjsKICB0LnZvYXJtZW5pYW4gPSAweDA1Nzg7CiAgdC52b2ljZWRpdGVyYXRpb25oaXJhZ2FuYSA9IDB4MzA5ZTsKICB0LnZvaWNlZGl0ZXJhdGlvbmthdGFrYW5hID0gMHgzMGZlOwogIHQudm9pY2VkbWFya2thbmEgPSAweDMwOWI7CiAgdC52b2ljZWRtYXJra2FuYWhhbGZ3aWR0aCA9IDB4ZmY5ZTsKICB0LnZva2F0YWthbmEgPSAweDMwZmE7CiAgdC52cGFyZW4gPSAweDI0YjE7CiAgdC52dGlsZGUgPSAweDFlN2Q7CiAgdC52dHVybmVkID0gMHgwMjhjOwogIHQudnVoaXJhZ2FuYSA9IDB4MzA5NDsKICB0LnZ1a2F0YWthbmEgPSAweDMwZjQ7CiAgdC53ID0gMHgwMDc3OwogIHQud2FjdXRlID0gMHgxZTgzOwogIHQud2Fla29yZWFuID0gMHgzMTU5OwogIHQud2FoaXJhZ2FuYSA9IDB4MzA4ZjsKICB0Lndha2F0YWthbmEgPSAweDMwZWY7CiAgdC53YWthdGFrYW5haGFsZndpZHRoID0gMHhmZjljOwogIHQud2Frb3JlYW4gPSAweDMxNTg7CiAgdC53YXNtYWxsaGlyYWdhbmEgPSAweDMwOGU7CiAgdC53YXNtYWxsa2F0YWthbmEgPSAweDMwZWU7CiAgdC53YXR0b3NxdWFyZSA9IDB4MzM1NzsKICB0LndhdmVkYXNoID0gMHgzMDFjOwogIHQud2F2eXVuZGVyc2NvcmV2ZXJ0aWNhbCA9IDB4ZmUzNDsKICB0Lndhd2FyYWJpYyA9IDB4MDY0ODsKICB0Lndhd2ZpbmFsYXJhYmljID0gMHhmZWVlOwogIHQud2F3aGFtemFhYm92ZWFyYWJpYyA9IDB4MDYyNDsKICB0Lndhd2hhbXphYWJvdmVmaW5hbGFyYWJpYyA9IDB4ZmU4NjsKICB0Lndic3F1YXJlID0gMHgzM2RkOwogIHQud2NpcmNsZSA9IDB4MjRlNjsKICB0LndjaXJjdW1mbGV4ID0gMHgwMTc1OwogIHQud2RpZXJlc2lzID0gMHgxZTg1OwogIHQud2RvdGFjY2VudCA9IDB4MWU4NzsKICB0Lndkb3RiZWxvdyA9IDB4MWU4OTsKICB0LndlaGlyYWdhbmEgPSAweDMwOTE7CiAgdC53ZWllcnN0cmFzcyA9IDB4MjExODsKICB0Lndla2F0YWthbmEgPSAweDMwZjE7CiAgdC53ZWtvcmVhbiA9IDB4MzE1ZTsKICB0Lndlb2tvcmVhbiA9IDB4MzE1ZDsKICB0LndncmF2ZSA9IDB4MWU4MTsKICB0LndoaXRlYnVsbGV0ID0gMHgyNWU2OwogIHQud2hpdGVjaXJjbGUgPSAweDI1Y2I7CiAgdC53aGl0ZWNpcmNsZWludmVyc2UgPSAweDI1ZDk7CiAgdC53aGl0ZWNvcm5lcmJyYWNrZXRsZWZ0ID0gMHgzMDBlOwogIHQud2hpdGVjb3JuZXJicmFja2V0bGVmdHZlcnRpY2FsID0gMHhmZTQzOwogIHQud2hpdGVjb3JuZXJicmFja2V0cmlnaHQgPSAweDMwMGY7CiAgdC53aGl0ZWNvcm5lcmJyYWNrZXRyaWdodHZlcnRpY2FsID0gMHhmZTQ0OwogIHQud2hpdGVkaWFtb25kID0gMHgyNWM3OwogIHQud2hpdGVkaWFtb25kY29udGFpbmluZ2JsYWNrc21hbGxkaWFtb25kID0gMHgyNWM4OwogIHQud2hpdGVkb3ducG9pbnRpbmdzbWFsbHRyaWFuZ2xlID0gMHgyNWJmOwogIHQud2hpdGVkb3ducG9pbnRpbmd0cmlhbmdsZSA9IDB4MjViZDsKICB0LndoaXRlbGVmdHBvaW50aW5nc21hbGx0cmlhbmdsZSA9IDB4MjVjMzsKICB0LndoaXRlbGVmdHBvaW50aW5ndHJpYW5nbGUgPSAweDI1YzE7CiAgdC53aGl0ZWxlbnRpY3VsYXJicmFja2V0bGVmdCA9IDB4MzAxNjsKICB0LndoaXRlbGVudGljdWxhcmJyYWNrZXRyaWdodCA9IDB4MzAxNzsKICB0LndoaXRlcmlnaHRwb2ludGluZ3NtYWxsdHJpYW5nbGUgPSAweDI1Yjk7CiAgdC53aGl0ZXJpZ2h0cG9pbnRpbmd0cmlhbmdsZSA9IDB4MjViNzsKICB0LndoaXRlc21hbGxzcXVhcmUgPSAweDI1YWI7CiAgdC53aGl0ZXNtaWxpbmdmYWNlID0gMHgyNjNhOwogIHQud2hpdGVzcXVhcmUgPSAweDI1YTE7CiAgdC53aGl0ZXN0YXIgPSAweDI2MDY7CiAgdC53aGl0ZXRlbGVwaG9uZSA9IDB4MjYwZjsKICB0LndoaXRldG9ydG9pc2VzaGVsbGJyYWNrZXRsZWZ0ID0gMHgzMDE4OwogIHQud2hpdGV0b3J0b2lzZXNoZWxsYnJhY2tldHJpZ2h0ID0gMHgzMDE5OwogIHQud2hpdGV1cHBvaW50aW5nc21hbGx0cmlhbmdsZSA9IDB4MjViNTsKICB0LndoaXRldXBwb2ludGluZ3RyaWFuZ2xlID0gMHgyNWIzOwogIHQud2loaXJhZ2FuYSA9IDB4MzA5MDsKICB0Lndpa2F0YWthbmEgPSAweDMwZjA7CiAgdC53aWtvcmVhbiA9IDB4MzE1ZjsKICB0Lndtb25vc3BhY2UgPSAweGZmNTc7CiAgdC53b2hpcmFnYW5hID0gMHgzMDkyOwogIHQud29rYXRha2FuYSA9IDB4MzBmMjsKICB0Lndva2F0YWthbmFoYWxmd2lkdGggPSAweGZmNjY7CiAgdC53b24gPSAweDIwYTk7CiAgdC53b25tb25vc3BhY2UgPSAweGZmZTY7CiAgdC53b3dhZW50aGFpID0gMHgwZTI3OwogIHQud3BhcmVuID0gMHgyNGIyOwogIHQud3JpbmcgPSAweDFlOTg7CiAgdC53c3VwZXJpb3IgPSAweDAyYjc7CiAgdC53dHVybmVkID0gMHgwMjhkOwogIHQud3lubiA9IDB4MDFiZjsKICB0LnggPSAweDAwNzg7CiAgdC54YWJvdmVjbWIgPSAweDAzM2Q7CiAgdC54Ym9wb21vZm8gPSAweDMxMTI7CiAgdC54Y2lyY2xlID0gMHgyNGU3OwogIHQueGRpZXJlc2lzID0gMHgxZThkOwogIHQueGRvdGFjY2VudCA9IDB4MWU4YjsKICB0LnhlaGFybWVuaWFuID0gMHgwNTZkOwogIHQueGkgPSAweDAzYmU7CiAgdC54bW9ub3NwYWNlID0gMHhmZjU4OwogIHQueHBhcmVuID0gMHgyNGIzOwogIHQueHN1cGVyaW9yID0gMHgwMmUzOwogIHQueSA9IDB4MDA3OTsKICB0LnlhYWRvc3F1YXJlID0gMHgzMzRlOwogIHQueWFiZW5nYWxpID0gMHgwOWFmOwogIHQueWFjdXRlID0gMHgwMGZkOwogIHQueWFkZXZhID0gMHgwOTJmOwogIHQueWFla29yZWFuID0gMHgzMTUyOwogIHQueWFndWphcmF0aSA9IDB4MGFhZjsKICB0LnlhZ3VybXVraGkgPSAweDBhMmY7CiAgdC55YWhpcmFnYW5hID0gMHgzMDg0OwogIHQueWFrYXRha2FuYSA9IDB4MzBlNDsKICB0Lnlha2F0YWthbmFoYWxmd2lkdGggPSAweGZmOTQ7CiAgdC55YWtvcmVhbiA9IDB4MzE1MTsKICB0LnlhbWFra2FudGhhaSA9IDB4MGU0ZTsKICB0Lnlhc21hbGxoaXJhZ2FuYSA9IDB4MzA4MzsKICB0Lnlhc21hbGxrYXRha2FuYSA9IDB4MzBlMzsKICB0Lnlhc21hbGxrYXRha2FuYWhhbGZ3aWR0aCA9IDB4ZmY2YzsKICB0LnlhdGN5cmlsbGljID0gMHgwNDYzOwogIHQueWNpcmNsZSA9IDB4MjRlODsKICB0LnljaXJjdW1mbGV4ID0gMHgwMTc3OwogIHQueWRpZXJlc2lzID0gMHgwMGZmOwogIHQueWRvdGFjY2VudCA9IDB4MWU4ZjsKICB0Lnlkb3RiZWxvdyA9IDB4MWVmNTsKICB0LnllaGFyYWJpYyA9IDB4MDY0YTsKICB0LnllaGJhcnJlZWFyYWJpYyA9IDB4MDZkMjsKICB0LnllaGJhcnJlZWZpbmFsYXJhYmljID0gMHhmYmFmOwogIHQueWVoZmluYWxhcmFiaWMgPSAweGZlZjI7CiAgdC55ZWhoYW16YWFib3ZlYXJhYmljID0gMHgwNjI2OwogIHQueWVoaGFtemFhYm92ZWZpbmFsYXJhYmljID0gMHhmZThhOwogIHQueWVoaGFtemFhYm92ZWluaXRpYWxhcmFiaWMgPSAweGZlOGI7CiAgdC55ZWhoYW16YWFib3ZlbWVkaWFsYXJhYmljID0gMHhmZThjOwogIHQueWVoaW5pdGlhbGFyYWJpYyA9IDB4ZmVmMzsKICB0LnllaG1lZGlhbGFyYWJpYyA9IDB4ZmVmNDsKICB0LnllaG1lZW1pbml0aWFsYXJhYmljID0gMHhmY2RkOwogIHQueWVobWVlbWlzb2xhdGVkYXJhYmljID0gMHhmYzU4OwogIHQueWVobm9vbmZpbmFsYXJhYmljID0gMHhmYzk0OwogIHQueWVodGhyZWVkb3RzYmVsb3dhcmFiaWMgPSAweDA2ZDE7CiAgdC55ZWtvcmVhbiA9IDB4MzE1NjsKICB0LnllbiA9IDB4MDBhNTsKICB0Lnllbm1vbm9zcGFjZSA9IDB4ZmZlNTsKICB0Lnllb2tvcmVhbiA9IDB4MzE1NTsKICB0Lnllb3JpbmhpZXVoa29yZWFuID0gMHgzMTg2OwogIHQueWVyYWhiZW55b21vaGVicmV3ID0gMHgwNWFhOwogIHQueWVyYWhiZW55b21vbGVmdGhlYnJldyA9IDB4MDVhYTsKICB0LnllcmljeXJpbGxpYyA9IDB4MDQ0YjsKICB0LnllcnVkaWVyZXNpc2N5cmlsbGljID0gMHgwNGY5OwogIHQueWVzaWV1bmdrb3JlYW4gPSAweDMxODE7CiAgdC55ZXNpZXVuZ3BhbnNpb3Nrb3JlYW4gPSAweDMxODM7CiAgdC55ZXNpZXVuZ3Npb3Nrb3JlYW4gPSAweDMxODI7CiAgdC55ZXRpdmhlYnJldyA9IDB4MDU5YTsKICB0LnlncmF2ZSA9IDB4MWVmMzsKICB0Lnlob29rID0gMHgwMWI0OwogIHQueWhvb2thYm92ZSA9IDB4MWVmNzsKICB0LnlpYXJtZW5pYW4gPSAweDA1NzU7CiAgdC55aWN5cmlsbGljID0gMHgwNDU3OwogIHQueWlrb3JlYW4gPSAweDMxNjI7CiAgdC55aW55YW5nID0gMHgyNjJmOwogIHQueWl3bmFybWVuaWFuID0gMHgwNTgyOwogIHQueW1vbm9zcGFjZSA9IDB4ZmY1OTsKICB0LnlvZCA9IDB4MDVkOTsKICB0LnlvZGRhZ2VzaCA9IDB4ZmIzOTsKICB0LnlvZGRhZ2VzaGhlYnJldyA9IDB4ZmIzOTsKICB0LnlvZGhlYnJldyA9IDB4MDVkOTsKICB0LnlvZHlvZGhlYnJldyA9IDB4MDVmMjsKICB0LnlvZHlvZHBhdGFoaGVicmV3ID0gMHhmYjFmOwogIHQueW9oaXJhZ2FuYSA9IDB4MzA4ODsKICB0LnlvaWtvcmVhbiA9IDB4MzE4OTsKICB0Lnlva2F0YWthbmEgPSAweDMwZTg7CiAgdC55b2thdGFrYW5haGFsZndpZHRoID0gMHhmZjk2OwogIHQueW9rb3JlYW4gPSAweDMxNWI7CiAgdC55b3NtYWxsaGlyYWdhbmEgPSAweDMwODc7CiAgdC55b3NtYWxsa2F0YWthbmEgPSAweDMwZTc7CiAgdC55b3NtYWxsa2F0YWthbmFoYWxmd2lkdGggPSAweGZmNmU7CiAgdC55b3RncmVlayA9IDB4MDNmMzsKICB0LnlveWFla29yZWFuID0gMHgzMTg4OwogIHQueW95YWtvcmVhbiA9IDB4MzE4NzsKICB0LnlveWFrdGhhaSA9IDB4MGUyMjsKICB0LnlveWluZ3RoYWkgPSAweDBlMGQ7CiAgdC55cGFyZW4gPSAweDI0YjQ7CiAgdC55cG9nZWdyYW1tZW5pID0gMHgwMzdhOwogIHQueXBvZ2VncmFtbWVuaWdyZWVrY21iID0gMHgwMzQ1OwogIHQueXIgPSAweDAxYTY7CiAgdC55cmluZyA9IDB4MWU5OTsKICB0LnlzdXBlcmlvciA9IDB4MDJiODsKICB0Lnl0aWxkZSA9IDB4MWVmOTsKICB0Lnl0dXJuZWQgPSAweDAyOGU7CiAgdC55dWhpcmFnYW5hID0gMHgzMDg2OwogIHQueXVpa29yZWFuID0gMHgzMThjOwogIHQueXVrYXRha2FuYSA9IDB4MzBlNjsKICB0Lnl1a2F0YWthbmFoYWxmd2lkdGggPSAweGZmOTU7CiAgdC55dWtvcmVhbiA9IDB4MzE2MDsKICB0Lnl1c2JpZ2N5cmlsbGljID0gMHgwNDZiOwogIHQueXVzYmlnaW90aWZpZWRjeXJpbGxpYyA9IDB4MDQ2ZDsKICB0Lnl1c2xpdHRsZWN5cmlsbGljID0gMHgwNDY3OwogIHQueXVzbGl0dGxlaW90aWZpZWRjeXJpbGxpYyA9IDB4MDQ2OTsKICB0Lnl1c21hbGxoaXJhZ2FuYSA9IDB4MzA4NTsKICB0Lnl1c21hbGxrYXRha2FuYSA9IDB4MzBlNTsKICB0Lnl1c21hbGxrYXRha2FuYWhhbGZ3aWR0aCA9IDB4ZmY2ZDsKICB0Lnl1eWVrb3JlYW4gPSAweDMxOGI7CiAgdC55dXllb2tvcmVhbiA9IDB4MzE4YTsKICB0Lnl5YWJlbmdhbGkgPSAweDA5ZGY7CiAgdC55eWFkZXZhID0gMHgwOTVmOwogIHQueiA9IDB4MDA3YTsKICB0LnphYXJtZW5pYW4gPSAweDA1NjY7CiAgdC56YWN1dGUgPSAweDAxN2E7CiAgdC56YWRldmEgPSAweDA5NWI7CiAgdC56YWd1cm11a2hpID0gMHgwYTViOwogIHQuemFoYXJhYmljID0gMHgwNjM4OwogIHQuemFoZmluYWxhcmFiaWMgPSAweGZlYzY7CiAgdC56YWhpbml0aWFsYXJhYmljID0gMHhmZWM3OwogIHQuemFoaXJhZ2FuYSA9IDB4MzA1NjsKICB0LnphaG1lZGlhbGFyYWJpYyA9IDB4ZmVjODsKICB0LnphaW5hcmFiaWMgPSAweDA2MzI7CiAgdC56YWluZmluYWxhcmFiaWMgPSAweGZlYjA7CiAgdC56YWthdGFrYW5hID0gMHgzMGI2OwogIHQuemFxZWZnYWRvbGhlYnJldyA9IDB4MDU5NTsKICB0LnphcWVmcWF0YW5oZWJyZXcgPSAweDA1OTQ7CiAgdC56YXJxYWhlYnJldyA9IDB4MDU5ODsKICB0LnpheWluID0gMHgwNWQ2OwogIHQuemF5aW5kYWdlc2ggPSAweGZiMzY7CiAgdC56YXlpbmRhZ2VzaGhlYnJldyA9IDB4ZmIzNjsKICB0LnpheWluaGVicmV3ID0gMHgwNWQ2OwogIHQuemJvcG9tb2ZvID0gMHgzMTE3OwogIHQuemNhcm9uID0gMHgwMTdlOwogIHQuemNpcmNsZSA9IDB4MjRlOTsKICB0LnpjaXJjdW1mbGV4ID0gMHgxZTkxOwogIHQuemN1cmwgPSAweDAyOTE7CiAgdC56ZG90ID0gMHgwMTdjOwogIHQuemRvdGFjY2VudCA9IDB4MDE3YzsKICB0Lnpkb3RiZWxvdyA9IDB4MWU5MzsKICB0LnplY3lyaWxsaWMgPSAweDA0Mzc7CiAgdC56ZWRlc2NlbmRlcmN5cmlsbGljID0gMHgwNDk5OwogIHQuemVkaWVyZXNpc2N5cmlsbGljID0gMHgwNGRmOwogIHQuemVoaXJhZ2FuYSA9IDB4MzA1YzsKICB0Lnpla2F0YWthbmEgPSAweDMwYmM7CiAgdC56ZXJvID0gMHgwMDMwOwogIHQuemVyb2FyYWJpYyA9IDB4MDY2MDsKICB0Lnplcm9iZW5nYWxpID0gMHgwOWU2OwogIHQuemVyb2RldmEgPSAweDA5NjY7CiAgdC56ZXJvZ3VqYXJhdGkgPSAweDBhZTY7CiAgdC56ZXJvZ3VybXVraGkgPSAweDBhNjY7CiAgdC56ZXJvaGFja2FyYWJpYyA9IDB4MDY2MDsKICB0Lnplcm9pbmZlcmlvciA9IDB4MjA4MDsKICB0Lnplcm9tb25vc3BhY2UgPSAweGZmMTA7CiAgdC56ZXJvb2xkc3R5bGUgPSAweGY3MzA7CiAgdC56ZXJvcGVyc2lhbiA9IDB4MDZmMDsKICB0Lnplcm9zdXBlcmlvciA9IDB4MjA3MDsKICB0Lnplcm90aGFpID0gMHgwZTUwOwogIHQuemVyb3dpZHRoam9pbmVyID0gMHhmZWZmOwogIHQuemVyb3dpZHRobm9uam9pbmVyID0gMHgyMDBjOwogIHQuemVyb3dpZHRoc3BhY2UgPSAweDIwMGI7CiAgdC56ZXRhID0gMHgwM2I2OwogIHQuemhib3BvbW9mbyA9IDB4MzExMzsKICB0LnpoZWFybWVuaWFuID0gMHgwNTZhOwogIHQuemhlYnJldmVjeXJpbGxpYyA9IDB4MDRjMjsKICB0LnpoZWN5cmlsbGljID0gMHgwNDM2OwogIHQuemhlZGVzY2VuZGVyY3lyaWxsaWMgPSAweDA0OTc7CiAgdC56aGVkaWVyZXNpc2N5cmlsbGljID0gMHgwNGRkOwogIHQuemloaXJhZ2FuYSA9IDB4MzA1ODsKICB0Lnppa2F0YWthbmEgPSAweDMwYjg7CiAgdC56aW5vcmhlYnJldyA9IDB4MDVhZTsKICB0LnpsaW5lYmVsb3cgPSAweDFlOTU7CiAgdC56bW9ub3NwYWNlID0gMHhmZjVhOwogIHQuem9oaXJhZ2FuYSA9IDB4MzA1ZTsKICB0Lnpva2F0YWthbmEgPSAweDMwYmU7CiAgdC56cGFyZW4gPSAweDI0YjU7CiAgdC56cmV0cm9mbGV4aG9vayA9IDB4MDI5MDsKICB0LnpzdHJva2UgPSAweDAxYjY7CiAgdC56dWhpcmFnYW5hID0gMHgzMDVhOwogIHQuenVrYXRha2FuYSA9IDB4MzBiYTsKICB0WyIubm90ZGVmIl0gPSAweDAwMDA7CiAgdC5hbmdicmFja2V0bGVmdGJpZyA9IDB4MjMyOTsKICB0LmFuZ2JyYWNrZXRsZWZ0QmlnID0gMHgyMzI5OwogIHQuYW5nYnJhY2tldGxlZnRiaWdnID0gMHgyMzI5OwogIHQuYW5nYnJhY2tldGxlZnRCaWdnID0gMHgyMzI5OwogIHQuYW5nYnJhY2tldHJpZ2h0QmlnID0gMHgyMzJhOwogIHQuYW5nYnJhY2tldHJpZ2h0YmlnID0gMHgyMzJhOwogIHQuYW5nYnJhY2tldHJpZ2h0QmlnZyA9IDB4MjMyYTsKICB0LmFuZ2JyYWNrZXRyaWdodGJpZ2cgPSAweDIzMmE7CiAgdC5hcnJvd2hvb2tsZWZ0ID0gMHgyMWFhOwogIHQuYXJyb3dob29rcmlnaHQgPSAweDIxYTk7CiAgdC5hcnJvd2xlZnR0b3BoYWxmID0gMHgyMWJjOwogIHQuYXJyb3dsZWZ0Ym90aGFsZiA9IDB4MjFiZDsKICB0LmFycm93bm9ydGhlYXN0ID0gMHgyMTk3OwogIHQuYXJyb3dub3J0aHdlc3QgPSAweDIxOTY7CiAgdC5hcnJvd3JpZ2h0dG9waGFsZiA9IDB4MjFjMDsKICB0LmFycm93cmlnaHRib3RoYWxmID0gMHgyMWMxOwogIHQuYXJyb3dzb3V0aGVhc3QgPSAweDIxOTg7CiAgdC5hcnJvd3NvdXRod2VzdCA9IDB4MjE5OTsKICB0LmJhY2tzbGFzaGJpZyA9IDB4MjIxNjsKICB0LmJhY2tzbGFzaEJpZyA9IDB4MjIxNjsKICB0LmJhY2tzbGFzaEJpZ2cgPSAweDIyMTY7CiAgdC5iYWNrc2xhc2hiaWdnID0gMHgyMjE2OwogIHQuYmFyZGJsID0gMHgyMDE2OwogIHQuYnJhY2VodGlwZG93bmxlZnQgPSAweGZlMzc7CiAgdC5icmFjZWh0aXBkb3ducmlnaHQgPSAweGZlMzc7CiAgdC5icmFjZWh0aXB1cGxlZnQgPSAweGZlMzg7CiAgdC5icmFjZWh0aXB1cHJpZ2h0ID0gMHhmZTM4OwogIHQuYnJhY2VsZWZ0QmlnID0gMHgwMDdiOwogIHQuYnJhY2VsZWZ0YmlnID0gMHgwMDdiOwogIHQuYnJhY2VsZWZ0YmlnZyA9IDB4MDA3YjsKICB0LmJyYWNlbGVmdEJpZ2cgPSAweDAwN2I7CiAgdC5icmFjZXJpZ2h0QmlnID0gMHgwMDdkOwogIHQuYnJhY2VyaWdodGJpZyA9IDB4MDA3ZDsKICB0LmJyYWNlcmlnaHRiaWdnID0gMHgwMDdkOwogIHQuYnJhY2VyaWdodEJpZ2cgPSAweDAwN2Q7CiAgdC5icmFja2V0bGVmdGJpZyA9IDB4MDA1YjsKICB0LmJyYWNrZXRsZWZ0QmlnID0gMHgwMDViOwogIHQuYnJhY2tldGxlZnRiaWdnID0gMHgwMDViOwogIHQuYnJhY2tldGxlZnRCaWdnID0gMHgwMDViOwogIHQuYnJhY2tldHJpZ2h0QmlnID0gMHgwMDVkOwogIHQuYnJhY2tldHJpZ2h0YmlnID0gMHgwMDVkOwogIHQuYnJhY2tldHJpZ2h0YmlnZyA9IDB4MDA1ZDsKICB0LmJyYWNrZXRyaWdodEJpZ2cgPSAweDAwNWQ7CiAgdC5jZWlsaW5nbGVmdGJpZyA9IDB4MjMwODsKICB0LmNlaWxpbmdsZWZ0QmlnID0gMHgyMzA4OwogIHQuY2VpbGluZ2xlZnRCaWdnID0gMHgyMzA4OwogIHQuY2VpbGluZ2xlZnRiaWdnID0gMHgyMzA4OwogIHQuY2VpbGluZ3JpZ2h0YmlnID0gMHgyMzA5OwogIHQuY2VpbGluZ3JpZ2h0QmlnID0gMHgyMzA5OwogIHQuY2VpbGluZ3JpZ2h0YmlnZyA9IDB4MjMwOTsKICB0LmNlaWxpbmdyaWdodEJpZ2cgPSAweDIzMDk7CiAgdC5jaXJjbGVkb3RkaXNwbGF5ID0gMHgyMjk5OwogIHQuY2lyY2xlZG90dGV4dCA9IDB4MjI5OTsKICB0LmNpcmNsZW11bHRpcGx5ZGlzcGxheSA9IDB4MjI5NzsKICB0LmNpcmNsZW11bHRpcGx5dGV4dCA9IDB4MjI5NzsKICB0LmNpcmNsZXBsdXNkaXNwbGF5ID0gMHgyMjk1OwogIHQuY2lyY2xlcGx1c3RleHQgPSAweDIyOTU7CiAgdC5jb250aW50ZWdyYWxkaXNwbGF5ID0gMHgyMjJlOwogIHQuY29udGludGVncmFsdGV4dCA9IDB4MjIyZTsKICB0LmNvcHJvZHVjdGRpc3BsYXkgPSAweDIyMTA7CiAgdC5jb3Byb2R1Y3R0ZXh0ID0gMHgyMjEwOwogIHQuZmxvb3JsZWZ0QmlnID0gMHgyMzBhOwogIHQuZmxvb3JsZWZ0YmlnID0gMHgyMzBhOwogIHQuZmxvb3JsZWZ0YmlnZyA9IDB4MjMwYTsKICB0LmZsb29ybGVmdEJpZ2cgPSAweDIzMGE7CiAgdC5mbG9vcnJpZ2h0YmlnID0gMHgyMzBiOwogIHQuZmxvb3JyaWdodEJpZyA9IDB4MjMwYjsKICB0LmZsb29ycmlnaHRCaWdnID0gMHgyMzBiOwogIHQuZmxvb3JyaWdodGJpZ2cgPSAweDIzMGI7CiAgdC5oYXR3aWRlID0gMHgwMzAyOwogIHQuaGF0d2lkZXIgPSAweDAzMDI7CiAgdC5oYXR3aWRlc3QgPSAweDAzMDI7CiAgdC5pbnRlcmNhbCA9IDB4MWQ0MDsKICB0LmludGVncmFsZGlzcGxheSA9IDB4MjIyYjsKICB0LmludGVncmFsdGV4dCA9IDB4MjIyYjsKICB0LmludGVyc2VjdGlvbmRpc3BsYXkgPSAweDIyYzI7CiAgdC5pbnRlcnNlY3Rpb250ZXh0ID0gMHgyMmMyOwogIHQubG9naWNhbGFuZGRpc3BsYXkgPSAweDIyMjc7CiAgdC5sb2dpY2FsYW5kdGV4dCA9IDB4MjIyNzsKICB0LmxvZ2ljYWxvcmRpc3BsYXkgPSAweDIyMjg7CiAgdC5sb2dpY2Fsb3J0ZXh0ID0gMHgyMjI4OwogIHQucGFyZW5sZWZ0QmlnID0gMHgwMDI4OwogIHQucGFyZW5sZWZ0YmlnID0gMHgwMDI4OwogIHQucGFyZW5sZWZ0QmlnZyA9IDB4MDAyODsKICB0LnBhcmVubGVmdGJpZ2cgPSAweDAwMjg7CiAgdC5wYXJlbnJpZ2h0QmlnID0gMHgwMDI5OwogIHQucGFyZW5yaWdodGJpZyA9IDB4MDAyOTsKICB0LnBhcmVucmlnaHRCaWdnID0gMHgwMDI5OwogIHQucGFyZW5yaWdodGJpZ2cgPSAweDAwMjk7CiAgdC5wcmltZSA9IDB4MjAzMjsKICB0LnByb2R1Y3RkaXNwbGF5ID0gMHgyMjBmOwogIHQucHJvZHVjdHRleHQgPSAweDIyMGY7CiAgdC5yYWRpY2FsYmlnID0gMHgyMjFhOwogIHQucmFkaWNhbEJpZyA9IDB4MjIxYTsKICB0LnJhZGljYWxCaWdnID0gMHgyMjFhOwogIHQucmFkaWNhbGJpZ2cgPSAweDIyMWE7CiAgdC5yYWRpY2FsYnQgPSAweDIyMWE7CiAgdC5yYWRpY2FsdHAgPSAweDIyMWE7CiAgdC5yYWRpY2FsdmVydGV4ID0gMHgyMjFhOwogIHQuc2xhc2hiaWcgPSAweDAwMmY7CiAgdC5zbGFzaEJpZyA9IDB4MDAyZjsKICB0LnNsYXNoQmlnZyA9IDB4MDAyZjsKICB0LnNsYXNoYmlnZyA9IDB4MDAyZjsKICB0LnN1bW1hdGlvbmRpc3BsYXkgPSAweDIyMTE7CiAgdC5zdW1tYXRpb250ZXh0ID0gMHgyMjExOwogIHQudGlsZGV3aWRlID0gMHgwMmRjOwogIHQudGlsZGV3aWRlciA9IDB4MDJkYzsKICB0LnRpbGRld2lkZXN0ID0gMHgwMmRjOwogIHQudW5pb25kaXNwbGF5ID0gMHgyMmMzOwogIHQudW5pb25tdWx0aWRpc3BsYXkgPSAweDIyOGU7CiAgdC51bmlvbm11bHRpdGV4dCA9IDB4MjI4ZTsKICB0LnVuaW9uc3FkaXNwbGF5ID0gMHgyMjk0OwogIHQudW5pb25zcXRleHQgPSAweDIyOTQ7CiAgdC51bmlvbnRleHQgPSAweDIyYzM7CiAgdC52ZXh0ZW5kZG91YmxlID0gMHgyMjI1OwogIHQudmV4dGVuZHNpbmdsZSA9IDB4MjIyMzsKfSk7CmV4cG9ydHMuZ2V0R2x5cGhzVW5pY29kZSA9IGdldEdseXBoc1VuaWNvZGU7CmNvbnN0IGdldERpbmdiYXRzR2x5cGhzVW5pY29kZSA9ICgwLCBfY29yZV91dGlscy5nZXRMb29rdXBUYWJsZUZhY3RvcnkpKGZ1bmN0aW9uICh0KSB7CiAgdC5zcGFjZSA9IDB4MDAyMDsKICB0LmExID0gMHgyNzAxOwogIHQuYTIgPSAweDI3MDI7CiAgdC5hMjAyID0gMHgyNzAzOwogIHQuYTMgPSAweDI3MDQ7CiAgdC5hNCA9IDB4MjYwZTsKICB0LmE1ID0gMHgyNzA2OwogIHQuYTExOSA9IDB4MjcwNzsKICB0LmExMTggPSAweDI3MDg7CiAgdC5hMTE3ID0gMHgyNzA5OwogIHQuYTExID0gMHgyNjFiOwogIHQuYTEyID0gMHgyNjFlOwogIHQuYTEzID0gMHgyNzBjOwogIHQuYTE0ID0gMHgyNzBkOwogIHQuYTE1ID0gMHgyNzBlOwogIHQuYTE2ID0gMHgyNzBmOwogIHQuYTEwNSA9IDB4MjcxMDsKICB0LmExNyA9IDB4MjcxMTsKICB0LmExOCA9IDB4MjcxMjsKICB0LmExOSA9IDB4MjcxMzsKICB0LmEyMCA9IDB4MjcxNDsKICB0LmEyMSA9IDB4MjcxNTsKICB0LmEyMiA9IDB4MjcxNjsKICB0LmEyMyA9IDB4MjcxNzsKICB0LmEyNCA9IDB4MjcxODsKICB0LmEyNSA9IDB4MjcxOTsKICB0LmEyNiA9IDB4MjcxYTsKICB0LmEyNyA9IDB4MjcxYjsKICB0LmEyOCA9IDB4MjcxYzsKICB0LmE2ID0gMHgyNzFkOwogIHQuYTcgPSAweDI3MWU7CiAgdC5hOCA9IDB4MjcxZjsKICB0LmE5ID0gMHgyNzIwOwogIHQuYTEwID0gMHgyNzIxOwogIHQuYTI5ID0gMHgyNzIyOwogIHQuYTMwID0gMHgyNzIzOwogIHQuYTMxID0gMHgyNzI0OwogIHQuYTMyID0gMHgyNzI1OwogIHQuYTMzID0gMHgyNzI2OwogIHQuYTM0ID0gMHgyNzI3OwogIHQuYTM1ID0gMHgyNjA1OwogIHQuYTM2ID0gMHgyNzI5OwogIHQuYTM3ID0gMHgyNzJhOwogIHQuYTM4ID0gMHgyNzJiOwogIHQuYTM5ID0gMHgyNzJjOwogIHQuYTQwID0gMHgyNzJkOwogIHQuYTQxID0gMHgyNzJlOwogIHQuYTQyID0gMHgyNzJmOwogIHQuYTQzID0gMHgyNzMwOwogIHQuYTQ0ID0gMHgyNzMxOwogIHQuYTQ1ID0gMHgyNzMyOwogIHQuYTQ2ID0gMHgyNzMzOwogIHQuYTQ3ID0gMHgyNzM0OwogIHQuYTQ4ID0gMHgyNzM1OwogIHQuYTQ5ID0gMHgyNzM2OwogIHQuYTUwID0gMHgyNzM3OwogIHQuYTUxID0gMHgyNzM4OwogIHQuYTUyID0gMHgyNzM5OwogIHQuYTUzID0gMHgyNzNhOwogIHQuYTU0ID0gMHgyNzNiOwogIHQuYTU1ID0gMHgyNzNjOwogIHQuYTU2ID0gMHgyNzNkOwogIHQuYTU3ID0gMHgyNzNlOwogIHQuYTU4ID0gMHgyNzNmOwogIHQuYTU5ID0gMHgyNzQwOwogIHQuYTYwID0gMHgyNzQxOwogIHQuYTYxID0gMHgyNzQyOwogIHQuYTYyID0gMHgyNzQzOwogIHQuYTYzID0gMHgyNzQ0OwogIHQuYTY0ID0gMHgyNzQ1OwogIHQuYTY1ID0gMHgyNzQ2OwogIHQuYTY2ID0gMHgyNzQ3OwogIHQuYTY3ID0gMHgyNzQ4OwogIHQuYTY4ID0gMHgyNzQ5OwogIHQuYTY5ID0gMHgyNzRhOwogIHQuYTcwID0gMHgyNzRiOwogIHQuYTcxID0gMHgyNWNmOwogIHQuYTcyID0gMHgyNzRkOwogIHQuYTczID0gMHgyNWEwOwogIHQuYTc0ID0gMHgyNzRmOwogIHQuYTIwMyA9IDB4Mjc1MDsKICB0LmE3NSA9IDB4Mjc1MTsKICB0LmEyMDQgPSAweDI3NTI7CiAgdC5hNzYgPSAweDI1YjI7CiAgdC5hNzcgPSAweDI1YmM7CiAgdC5hNzggPSAweDI1YzY7CiAgdC5hNzkgPSAweDI3NTY7CiAgdC5hODEgPSAweDI1ZDc7CiAgdC5hODIgPSAweDI3NTg7CiAgdC5hODMgPSAweDI3NTk7CiAgdC5hODQgPSAweDI3NWE7CiAgdC5hOTcgPSAweDI3NWI7CiAgdC5hOTggPSAweDI3NWM7CiAgdC5hOTkgPSAweDI3NWQ7CiAgdC5hMTAwID0gMHgyNzVlOwogIHQuYTEwMSA9IDB4Mjc2MTsKICB0LmExMDIgPSAweDI3NjI7CiAgdC5hMTAzID0gMHgyNzYzOwogIHQuYTEwNCA9IDB4Mjc2NDsKICB0LmExMDYgPSAweDI3NjU7CiAgdC5hMTA3ID0gMHgyNzY2OwogIHQuYTEwOCA9IDB4Mjc2NzsKICB0LmExMTIgPSAweDI2NjM7CiAgdC5hMTExID0gMHgyNjY2OwogIHQuYTExMCA9IDB4MjY2NTsKICB0LmExMDkgPSAweDI2NjA7CiAgdC5hMTIwID0gMHgyNDYwOwogIHQuYTEyMSA9IDB4MjQ2MTsKICB0LmExMjIgPSAweDI0NjI7CiAgdC5hMTIzID0gMHgyNDYzOwogIHQuYTEyNCA9IDB4MjQ2NDsKICB0LmExMjUgPSAweDI0NjU7CiAgdC5hMTI2ID0gMHgyNDY2OwogIHQuYTEyNyA9IDB4MjQ2NzsKICB0LmExMjggPSAweDI0Njg7CiAgdC5hMTI5ID0gMHgyNDY5OwogIHQuYTEzMCA9IDB4Mjc3NjsKICB0LmExMzEgPSAweDI3Nzc7CiAgdC5hMTMyID0gMHgyNzc4OwogIHQuYTEzMyA9IDB4Mjc3OTsKICB0LmExMzQgPSAweDI3N2E7CiAgdC5hMTM1ID0gMHgyNzdiOwogIHQuYTEzNiA9IDB4Mjc3YzsKICB0LmExMzcgPSAweDI3N2Q7CiAgdC5hMTM4ID0gMHgyNzdlOwogIHQuYTEzOSA9IDB4Mjc3ZjsKICB0LmExNDAgPSAweDI3ODA7CiAgdC5hMTQxID0gMHgyNzgxOwogIHQuYTE0MiA9IDB4Mjc4MjsKICB0LmExNDMgPSAweDI3ODM7CiAgdC5hMTQ0ID0gMHgyNzg0OwogIHQuYTE0NSA9IDB4Mjc4NTsKICB0LmExNDYgPSAweDI3ODY7CiAgdC5hMTQ3ID0gMHgyNzg3OwogIHQuYTE0OCA9IDB4Mjc4ODsKICB0LmExNDkgPSAweDI3ODk7CiAgdC5hMTUwID0gMHgyNzhhOwogIHQuYTE1MSA9IDB4Mjc4YjsKICB0LmExNTIgPSAweDI3OGM7CiAgdC5hMTUzID0gMHgyNzhkOwogIHQuYTE1NCA9IDB4Mjc4ZTsKICB0LmExNTUgPSAweDI3OGY7CiAgdC5hMTU2ID0gMHgyNzkwOwogIHQuYTE1NyA9IDB4Mjc5MTsKICB0LmExNTggPSAweDI3OTI7CiAgdC5hMTU5ID0gMHgyNzkzOwogIHQuYTE2MCA9IDB4Mjc5NDsKICB0LmExNjEgPSAweDIxOTI7CiAgdC5hMTYzID0gMHgyMTk0OwogIHQuYTE2NCA9IDB4MjE5NTsKICB0LmExOTYgPSAweDI3OTg7CiAgdC5hMTY1ID0gMHgyNzk5OwogIHQuYTE5MiA9IDB4Mjc5YTsKICB0LmExNjYgPSAweDI3OWI7CiAgdC5hMTY3ID0gMHgyNzljOwogIHQuYTE2OCA9IDB4Mjc5ZDsKICB0LmExNjkgPSAweDI3OWU7CiAgdC5hMTcwID0gMHgyNzlmOwogIHQuYTE3MSA9IDB4MjdhMDsKICB0LmExNzIgPSAweDI3YTE7CiAgdC5hMTczID0gMHgyN2EyOwogIHQuYTE2MiA9IDB4MjdhMzsKICB0LmExNzQgPSAweDI3YTQ7CiAgdC5hMTc1ID0gMHgyN2E1OwogIHQuYTE3NiA9IDB4MjdhNjsKICB0LmExNzcgPSAweDI3YTc7CiAgdC5hMTc4ID0gMHgyN2E4OwogIHQuYTE3OSA9IDB4MjdhOTsKICB0LmExOTMgPSAweDI3YWE7CiAgdC5hMTgwID0gMHgyN2FiOwogIHQuYTE5OSA9IDB4MjdhYzsKICB0LmExODEgPSAweDI3YWQ7CiAgdC5hMjAwID0gMHgyN2FlOwogIHQuYTE4MiA9IDB4MjdhZjsKICB0LmEyMDEgPSAweDI3YjE7CiAgdC5hMTgzID0gMHgyN2IyOwogIHQuYTE4NCA9IDB4MjdiMzsKICB0LmExOTcgPSAweDI3YjQ7CiAgdC5hMTg1ID0gMHgyN2I1OwogIHQuYTE5NCA9IDB4MjdiNjsKICB0LmExOTggPSAweDI3Yjc7CiAgdC5hMTg2ID0gMHgyN2I4OwogIHQuYTE5NSA9IDB4MjdiOTsKICB0LmExODcgPSAweDI3YmE7CiAgdC5hMTg4ID0gMHgyN2JiOwogIHQuYTE4OSA9IDB4MjdiYzsKICB0LmExOTAgPSAweDI3YmQ7CiAgdC5hMTkxID0gMHgyN2JlOwogIHQuYTg5ID0gMHgyNzY4OwogIHQuYTkwID0gMHgyNzY5OwogIHQuYTkzID0gMHgyNzZhOwogIHQuYTk0ID0gMHgyNzZiOwogIHQuYTkxID0gMHgyNzZjOwogIHQuYTkyID0gMHgyNzZkOwogIHQuYTIwNSA9IDB4Mjc2ZTsKICB0LmE4NSA9IDB4Mjc2ZjsKICB0LmEyMDYgPSAweDI3NzA7CiAgdC5hODYgPSAweDI3NzE7CiAgdC5hODcgPSAweDI3NzI7CiAgdC5hODggPSAweDI3NzM7CiAgdC5hOTUgPSAweDI3NzQ7CiAgdC5hOTYgPSAweDI3NzU7CiAgdFsiLm5vdGRlZiJdID0gMHgwMDAwOwp9KTsKZXhwb3J0cy5nZXREaW5nYmF0c0dseXBoc1VuaWNvZGUgPSBnZXREaW5nYmF0c0dseXBoc1VuaWNvZGU7CgovKioqLyB9KSwKLyogNDAgKi8KLyoqKi8gKChfX3VudXNlZF93ZWJwYWNrX21vZHVsZSwgZXhwb3J0cywgX193X3BkZmpzX3JlcXVpcmVfXykgPT4gewoKCgpPYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgIl9fZXNNb2R1bGUiLCAoewogIHZhbHVlOiB0cnVlCn0pKTsKZXhwb3J0cy5jbGVhclVuaWNvZGVDYWNoZXMgPSBjbGVhclVuaWNvZGVDYWNoZXM7CmV4cG9ydHMuZ2V0Q2hhclVuaWNvZGVDYXRlZ29yeSA9IGdldENoYXJVbmljb2RlQ2F0ZWdvcnk7CmV4cG9ydHMuZ2V0VW5pY29kZUZvckdseXBoID0gZ2V0VW5pY29kZUZvckdseXBoOwpleHBvcnRzLmdldFVuaWNvZGVSYW5nZUZvciA9IGdldFVuaWNvZGVSYW5nZUZvcjsKZXhwb3J0cy5tYXBTcGVjaWFsVW5pY29kZVZhbHVlcyA9IG1hcFNwZWNpYWxVbmljb2RlVmFsdWVzOwp2YXIgX2NvcmVfdXRpbHMgPSBfX3dfcGRmanNfcmVxdWlyZV9fKDMpOwpjb25zdCBnZXRTcGVjaWFsUFVBU3ltYm9scyA9ICgwLCBfY29yZV91dGlscy5nZXRMb29rdXBUYWJsZUZhY3RvcnkpKGZ1bmN0aW9uICh0KSB7CiAgdFs2MzcyMV0gPSAweDAwYTk7CiAgdFs2MzE5M10gPSAweDAwYTk7CiAgdFs2MzcyMF0gPSAweDAwYWU7CiAgdFs2MzE5NF0gPSAweDAwYWU7CiAgdFs2MzcyMl0gPSAweDIxMjI7CiAgdFs2MzE5NV0gPSAweDIxMjI7CiAgdFs2MzcyOV0gPSAweDIzYTc7CiAgdFs2MzczMF0gPSAweDIzYTg7CiAgdFs2MzczMV0gPSAweDIzYTk7CiAgdFs2Mzc0MF0gPSAweDIzYWI7CiAgdFs2Mzc0MV0gPSAweDIzYWM7CiAgdFs2Mzc0Ml0gPSAweDIzYWQ7CiAgdFs2MzcyNl0gPSAweDIzYTE7CiAgdFs2MzcyN10gPSAweDIzYTI7CiAgdFs2MzcyOF0gPSAweDIzYTM7CiAgdFs2MzczN10gPSAweDIzYTQ7CiAgdFs2MzczOF0gPSAweDIzYTU7CiAgdFs2MzczOV0gPSAweDIzYTY7CiAgdFs2MzcyM10gPSAweDIzOWI7CiAgdFs2MzcyNF0gPSAweDIzOWM7CiAgdFs2MzcyNV0gPSAweDIzOWQ7CiAgdFs2MzczNF0gPSAweDIzOWU7CiAgdFs2MzczNV0gPSAweDIzOWY7CiAgdFs2MzczNl0gPSAweDIzYTA7Cn0pOwpmdW5jdGlvbiBtYXBTcGVjaWFsVW5pY29kZVZhbHVlcyhjb2RlKSB7CiAgaWYgKGNvZGUgPj0gMHhmZmYwICYmIGNvZGUgPD0gMHhmZmZmKSB7CiAgICByZXR1cm4gMDsKICB9IGVsc2UgaWYgKGNvZGUgPj0gMHhmNjAwICYmIGNvZGUgPD0gMHhmOGZmKSB7CiAgICByZXR1cm4gZ2V0U3BlY2lhbFBVQVN5bWJvbHMoKVtjb2RlXSB8fCBjb2RlOwogIH0gZWxzZSBpZiAoY29kZSA9PT0gMHgwMGFkKSB7CiAgICByZXR1cm4gMHgwMDJkOwogIH0KICByZXR1cm4gY29kZTsKfQpmdW5jdGlvbiBnZXRVbmljb2RlRm9yR2x5cGgobmFtZSwgZ2x5cGhzVW5pY29kZU1hcCkgewogIGxldCB1bmljb2RlID0gZ2x5cGhzVW5pY29kZU1hcFtuYW1lXTsKICBpZiAodW5pY29kZSAhPT0gdW5kZWZpbmVkKSB7CiAgICByZXR1cm4gdW5pY29kZTsKICB9CiAgaWYgKCFuYW1lKSB7CiAgICByZXR1cm4gLTE7CiAgfQogIGlmIChuYW1lWzBdID09PSAidSIpIHsKICAgIGNvbnN0IG5hbWVMZW4gPSBuYW1lLmxlbmd0aDsKICAgIGxldCBoZXhTdHI7CiAgICBpZiAobmFtZUxlbiA9PT0gNyAmJiBuYW1lWzFdID09PSAibiIgJiYgbmFtZVsyXSA9PT0gImkiKSB7CiAgICAgIGhleFN0ciA9IG5hbWUuc3Vic3RyaW5nKDMpOwogICAgfSBlbHNlIGlmIChuYW1lTGVuID49IDUgJiYgbmFtZUxlbiA8PSA3KSB7CiAgICAgIGhleFN0ciA9IG5hbWUuc3Vic3RyaW5nKDEpOwogICAgfSBlbHNlIHsKICAgICAgcmV0dXJuIC0xOwogICAgfQogICAgaWYgKGhleFN0ciA9PT0gaGV4U3RyLnRvVXBwZXJDYXNlKCkpIHsKICAgICAgdW5pY29kZSA9IHBhcnNlSW50KGhleFN0ciwgMTYpOwogICAgICBpZiAodW5pY29kZSA+PSAwKSB7CiAgICAgICAgcmV0dXJuIHVuaWNvZGU7CiAgICAgIH0KICAgIH0KICB9CiAgcmV0dXJuIC0xOwp9CmNvbnN0IFVuaWNvZGVSYW5nZXMgPSBbWzB4MDAwMCwgMHgwMDdmXSwgWzB4MDA4MCwgMHgwMGZmXSwgWzB4MDEwMCwgMHgwMTdmXSwgWzB4MDE4MCwgMHgwMjRmXSwgWzB4MDI1MCwgMHgwMmFmLCAweDFkMDAsIDB4MWQ3ZiwgMHgxZDgwLCAweDFkYmZdLCBbMHgwMmIwLCAweDAyZmYsIDB4YTcwMCwgMHhhNzFmXSwgWzB4MDMwMCwgMHgwMzZmLCAweDFkYzAsIDB4MWRmZl0sIFsweDAzNzAsIDB4MDNmZl0sIFsweDJjODAsIDB4MmNmZl0sIFsweDA0MDAsIDB4MDRmZiwgMHgwNTAwLCAweDA1MmYsIDB4MmRlMCwgMHgyZGZmLCAweGE2NDAsIDB4YTY5Zl0sIFsweDA1MzAsIDB4MDU4Zl0sIFsweDA1OTAsIDB4MDVmZl0sIFsweGE1MDAsIDB4YTYzZl0sIFsweDA2MDAsIDB4MDZmZiwgMHgwNzUwLCAweDA3N2ZdLCBbMHgwN2MwLCAweDA3ZmZdLCBbMHgwOTAwLCAweDA5N2ZdLCBbMHgwOTgwLCAweDA5ZmZdLCBbMHgwYTAwLCAweDBhN2ZdLCBbMHgwYTgwLCAweDBhZmZdLCBbMHgwYjAwLCAweDBiN2ZdLCBbMHgwYjgwLCAweDBiZmZdLCBbMHgwYzAwLCAweDBjN2ZdLCBbMHgwYzgwLCAweDBjZmZdLCBbMHgwZDAwLCAweDBkN2ZdLCBbMHgwZTAwLCAweDBlN2ZdLCBbMHgwZTgwLCAweDBlZmZdLCBbMHgxMGEwLCAweDEwZmYsIDB4MmQwMCwgMHgyZDJmXSwgWzB4MWIwMCwgMHgxYjdmXSwgWzB4MTEwMCwgMHgxMWZmXSwgWzB4MWUwMCwgMHgxZWZmLCAweDJjNjAsIDB4MmM3ZiwgMHhhNzIwLCAweGE3ZmZdLCBbMHgxZjAwLCAweDFmZmZdLCBbMHgyMDAwLCAweDIwNmYsIDB4MmUwMCwgMHgyZTdmXSwgWzB4MjA3MCwgMHgyMDlmXSwgWzB4MjBhMCwgMHgyMGNmXSwgWzB4MjBkMCwgMHgyMGZmXSwgWzB4MjEwMCwgMHgyMTRmXSwgWzB4MjE1MCwgMHgyMThmXSwgWzB4MjE5MCwgMHgyMWZmLCAweDI3ZjAsIDB4MjdmZiwgMHgyOTAwLCAweDI5N2YsIDB4MmIwMCwgMHgyYmZmXSwgWzB4MjIwMCwgMHgyMmZmLCAweDJhMDAsIDB4MmFmZiwgMHgyN2MwLCAweDI3ZWYsIDB4Mjk4MCwgMHgyOWZmXSwgWzB4MjMwMCwgMHgyM2ZmXSwgWzB4MjQwMCwgMHgyNDNmXSwgWzB4MjQ0MCwgMHgyNDVmXSwgWzB4MjQ2MCwgMHgyNGZmXSwgWzB4MjUwMCwgMHgyNTdmXSwgWzB4MjU4MCwgMHgyNTlmXSwgWzB4MjVhMCwgMHgyNWZmXSwgWzB4MjYwMCwgMHgyNmZmXSwgWzB4MjcwMCwgMHgyN2JmXSwgWzB4MzAwMCwgMHgzMDNmXSwgWzB4MzA0MCwgMHgzMDlmXSwgWzB4MzBhMCwgMHgzMGZmLCAweDMxZjAsIDB4MzFmZl0sIFsweDMxMDAsIDB4MzEyZiwgMHgzMWEwLCAweDMxYmZdLCBbMHgzMTMwLCAweDMxOGZdLCBbMHhhODQwLCAweGE4N2ZdLCBbMHgzMjAwLCAweDMyZmZdLCBbMHgzMzAwLCAweDMzZmZdLCBbMHhhYzAwLCAweGQ3YWZdLCBbMHhkODAwLCAweGRmZmZdLCBbMHgxMDkwMCwgMHgxMDkxZl0sIFsweDRlMDAsIDB4OWZmZiwgMHgyZTgwLCAweDJlZmYsIDB4MmYwMCwgMHgyZmRmLCAweDJmZjAsIDB4MmZmZiwgMHgzNDAwLCAweDRkYmYsIDB4MjAwMDAsIDB4MmE2ZGYsIDB4MzE5MCwgMHgzMTlmXSwgWzB4ZTAwMCwgMHhmOGZmXSwgWzB4MzFjMCwgMHgzMWVmLCAweGY5MDAsIDB4ZmFmZiwgMHgyZjgwMCwgMHgyZmExZl0sIFsweGZiMDAsIDB4ZmI0Zl0sIFsweGZiNTAsIDB4ZmRmZl0sIFsweGZlMjAsIDB4ZmUyZl0sIFsweGZlMTAsIDB4ZmUxZl0sIFsweGZlNTAsIDB4ZmU2Zl0sIFsweGZlNzAsIDB4ZmVmZl0sIFsweGZmMDAsIDB4ZmZlZl0sIFsweGZmZjAsIDB4ZmZmZl0sIFsweDBmMDAsIDB4MGZmZl0sIFsweDA3MDAsIDB4MDc0Zl0sIFsweDA3ODAsIDB4MDdiZl0sIFsweDBkODAsIDB4MGRmZl0sIFsweDEwMDAsIDB4MTA5Zl0sIFsweDEyMDAsIDB4MTM3ZiwgMHgxMzgwLCAweDEzOWYsIDB4MmQ4MCwgMHgyZGRmXSwgWzB4MTNhMCwgMHgxM2ZmXSwgWzB4MTQwMCwgMHgxNjdmXSwgWzB4MTY4MCwgMHgxNjlmXSwgWzB4MTZhMCwgMHgxNmZmXSwgWzB4MTc4MCwgMHgxN2ZmXSwgWzB4MTgwMCwgMHgxOGFmXSwgWzB4MjgwMCwgMHgyOGZmXSwgWzB4YTAwMCwgMHhhNDhmXSwgWzB4MTcwMCwgMHgxNzFmLCAweDE3MjAsIDB4MTczZiwgMHgxNzQwLCAweDE3NWYsIDB4MTc2MCwgMHgxNzdmXSwgWzB4MTAzMDAsIDB4MTAzMmZdLCBbMHgxMDMzMCwgMHgxMDM0Zl0sIFsweDEwNDAwLCAweDEwNDRmXSwgWzB4MWQwMDAsIDB4MWQwZmYsIDB4MWQxMDAsIDB4MWQxZmYsIDB4MWQyMDAsIDB4MWQyNGZdLCBbMHgxZDQwMCwgMHgxZDdmZl0sIFsweGZmMDAwLCAweGZmZmZkXSwgWzB4ZmUwMCwgMHhmZTBmLCAweGUwMTAwLCAweGUwMWVmXSwgWzB4ZTAwMDAsIDB4ZTAwN2ZdLCBbMHgxOTAwLCAweDE5NGZdLCBbMHgxOTUwLCAweDE5N2ZdLCBbMHgxOTgwLCAweDE5ZGZdLCBbMHgxYTAwLCAweDFhMWZdLCBbMHgyYzAwLCAweDJjNWZdLCBbMHgyZDMwLCAweDJkN2ZdLCBbMHg0ZGMwLCAweDRkZmZdLCBbMHhhODAwLCAweGE4MmZdLCBbMHgxMDAwMCwgMHgxMDA3ZiwgMHgxMDA4MCwgMHgxMDBmZiwgMHgxMDEwMCwgMHgxMDEzZl0sIFsweDEwMTQwLCAweDEwMThmXSwgWzB4MTAzODAsIDB4MTAzOWZdLCBbMHgxMDNhMCwgMHgxMDNkZl0sIFsweDEwNDUwLCAweDEwNDdmXSwgWzB4MTA0ODAsIDB4MTA0YWZdLCBbMHgxMDgwMCwgMHgxMDgzZl0sIFsweDEwYTAwLCAweDEwYTVmXSwgWzB4MWQzMDAsIDB4MWQzNWZdLCBbMHgxMjAwMCwgMHgxMjNmZiwgMHgxMjQwMCwgMHgxMjQ3Zl0sIFsweDFkMzYwLCAweDFkMzdmXSwgWzB4MWI4MCwgMHgxYmJmXSwgWzB4MWMwMCwgMHgxYzRmXSwgWzB4MWM1MCwgMHgxYzdmXSwgWzB4YTg4MCwgMHhhOGRmXSwgWzB4YTkwMCwgMHhhOTJmXSwgWzB4YTkzMCwgMHhhOTVmXSwgWzB4YWEwMCwgMHhhYTVmXSwgWzB4MTAxOTAsIDB4MTAxY2ZdLCBbMHgxMDFkMCwgMHgxMDFmZl0sIFsweDEwMmEwLCAweDEwMmRmLCAweDEwMjgwLCAweDEwMjlmLCAweDEwOTIwLCAweDEwOTNmXSwgWzB4MWYwMzAsIDB4MWYwOWYsIDB4MWYwMDAsIDB4MWYwMmZdXTsKZnVuY3Rpb24gZ2V0VW5pY29kZVJhbmdlRm9yKHZhbHVlLCBsYXN0UG9zaXRpb24gPSAtMSkgewogIGlmIChsYXN0UG9zaXRpb24gIT09IC0xKSB7CiAgICBjb25zdCByYW5nZSA9IFVuaWNvZGVSYW5nZXNbbGFzdFBvc2l0aW9uXTsKICAgIGZvciAobGV0IGkgPSAwLCBpaSA9IHJhbmdlLmxlbmd0aDsgaSA8IGlpOyBpICs9IDIpIHsKICAgICAgaWYgKHZhbHVlID49IHJhbmdlW2ldICYmIHZhbHVlIDw9IHJhbmdlW2kgKyAxXSkgewogICAgICAgIHJldHVybiBsYXN0UG9zaXRpb247CiAgICAgIH0KICAgIH0KICB9CiAgZm9yIChsZXQgaSA9IDAsIGlpID0gVW5pY29kZVJhbmdlcy5sZW5ndGg7IGkgPCBpaTsgaSsrKSB7CiAgICBjb25zdCByYW5nZSA9IFVuaWNvZGVSYW5nZXNbaV07CiAgICBmb3IgKGxldCBqID0gMCwgamogPSByYW5nZS5sZW5ndGg7IGogPCBqajsgaiArPSAyKSB7CiAgICAgIGlmICh2YWx1ZSA+PSByYW5nZVtqXSAmJiB2YWx1ZSA8PSByYW5nZVtqICsgMV0pIHsKICAgICAgICByZXR1cm4gaTsKICAgICAgfQogICAgfQogIH0KICByZXR1cm4gLTE7Cn0KY29uc3QgU3BlY2lhbENoYXJSZWdFeHAgPSBuZXcgUmVnRXhwKCJeKFxccyl8KFxccHtNbn0pfChcXHB7Q2Z9KSQiLCAidSIpOwpjb25zdCBDYXRlZ29yeUNhY2hlID0gbmV3IE1hcCgpOwpmdW5jdGlvbiBnZXRDaGFyVW5pY29kZUNhdGVnb3J5KGNoYXIpIHsKICBjb25zdCBjYWNoZWRDYXRlZ29yeSA9IENhdGVnb3J5Q2FjaGUuZ2V0KGNoYXIpOwogIGlmIChjYWNoZWRDYXRlZ29yeSkgewogICAgcmV0dXJuIGNhY2hlZENhdGVnb3J5OwogIH0KICBjb25zdCBncm91cHMgPSBjaGFyLm1hdGNoKFNwZWNpYWxDaGFyUmVnRXhwKTsKICBjb25zdCBjYXRlZ29yeSA9IHsKICAgIGlzV2hpdGVzcGFjZTogISFncm91cHM/LlsxXSwKICAgIGlzWmVyb1dpZHRoRGlhY3JpdGljOiAhIWdyb3Vwcz8uWzJdLAogICAgaXNJbnZpc2libGVGb3JtYXRNYXJrOiAhIWdyb3Vwcz8uWzNdCiAgfTsKICBDYXRlZ29yeUNhY2hlLnNldChjaGFyLCBjYXRlZ29yeSk7CiAgcmV0dXJuIGNhdGVnb3J5Owp9CmZ1bmN0aW9uIGNsZWFyVW5pY29kZUNhY2hlcygpIHsKICBDYXRlZ29yeUNhY2hlLmNsZWFyKCk7Cn0KCi8qKiovIH0pLAovKiA0MSAqLwovKioqLyAoKF9fdW51c2VkX3dlYnBhY2tfbW9kdWxlLCBleHBvcnRzLCBfX3dfcGRmanNfcmVxdWlyZV9fKSA9PiB7CgoKCk9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCAiX19lc01vZHVsZSIsICh7CiAgdmFsdWU6IHRydWUKfSkpOwpleHBvcnRzLmdldFNlcmlmRm9udHMgPSBleHBvcnRzLmdldE5vblN0ZEZvbnRNYXAgPSBleHBvcnRzLmdldEdseXBoTWFwRm9yU3RhbmRhcmRGb250cyA9IGV4cG9ydHMuZ2V0Rm9udE5hbWVUb0ZpbGVNYXAgPSB2b2lkIDA7CmV4cG9ydHMuZ2V0U3RhbmRhcmRGb250TmFtZSA9IGdldFN0YW5kYXJkRm9udE5hbWU7CmV4cG9ydHMuZ2V0U3ltYm9sc0ZvbnRzID0gZXhwb3J0cy5nZXRTdXBwbGVtZW50YWxHbHlwaE1hcEZvckNhbGlicmkgPSBleHBvcnRzLmdldFN1cHBsZW1lbnRhbEdseXBoTWFwRm9yQXJpYWxCbGFjayA9IGV4cG9ydHMuZ2V0U3RkRm9udE1hcCA9IHZvaWQgMDsKZXhwb3J0cy5pc0tub3duRm9udE5hbWUgPSBpc0tub3duRm9udE5hbWU7CnZhciBfY29yZV91dGlscyA9IF9fd19wZGZqc19yZXF1aXJlX18oMyk7CnZhciBfZm9udHNfdXRpbHMgPSBfX3dfcGRmanNfcmVxdWlyZV9fKDM4KTsKY29uc3QgZ2V0U3RkRm9udE1hcCA9ICgwLCBfY29yZV91dGlscy5nZXRMb29rdXBUYWJsZUZhY3RvcnkpKGZ1bmN0aW9uICh0KSB7CiAgdFsiVGltZXMtUm9tYW4iXSA9ICJUaW1lcy1Sb21hbiI7CiAgdC5IZWx2ZXRpY2EgPSAiSGVsdmV0aWNhIjsKICB0LkNvdXJpZXIgPSAiQ291cmllciI7CiAgdC5TeW1ib2wgPSAiU3ltYm9sIjsKICB0WyJUaW1lcy1Cb2xkIl0gPSAiVGltZXMtQm9sZCI7CiAgdFsiSGVsdmV0aWNhLUJvbGQiXSA9ICJIZWx2ZXRpY2EtQm9sZCI7CiAgdFsiQ291cmllci1Cb2xkIl0gPSAiQ291cmllci1Cb2xkIjsKICB0LlphcGZEaW5nYmF0cyA9ICJaYXBmRGluZ2JhdHMiOwogIHRbIlRpbWVzLUl0YWxpYyJdID0gIlRpbWVzLUl0YWxpYyI7CiAgdFsiSGVsdmV0aWNhLU9ibGlxdWUiXSA9ICJIZWx2ZXRpY2EtT2JsaXF1ZSI7CiAgdFsiQ291cmllci1PYmxpcXVlIl0gPSAiQ291cmllci1PYmxpcXVlIjsKICB0WyJUaW1lcy1Cb2xkSXRhbGljIl0gPSAiVGltZXMtQm9sZEl0YWxpYyI7CiAgdFsiSGVsdmV0aWNhLUJvbGRPYmxpcXVlIl0gPSAiSGVsdmV0aWNhLUJvbGRPYmxpcXVlIjsKICB0WyJDb3VyaWVyLUJvbGRPYmxpcXVlIl0gPSAiQ291cmllci1Cb2xkT2JsaXF1ZSI7CiAgdC5BcmlhbE5hcnJvdyA9ICJIZWx2ZXRpY2EiOwogIHRbIkFyaWFsTmFycm93LUJvbGQiXSA9ICJIZWx2ZXRpY2EtQm9sZCI7CiAgdFsiQXJpYWxOYXJyb3ctQm9sZEl0YWxpYyJdID0gIkhlbHZldGljYS1Cb2xkT2JsaXF1ZSI7CiAgdFsiQXJpYWxOYXJyb3ctSXRhbGljIl0gPSAiSGVsdmV0aWNhLU9ibGlxdWUiOwogIHQuQXJpYWxCbGFjayA9ICJIZWx2ZXRpY2EiOwogIHRbIkFyaWFsQmxhY2stQm9sZCJdID0gIkhlbHZldGljYS1Cb2xkIjsKICB0WyJBcmlhbEJsYWNrLUJvbGRJdGFsaWMiXSA9ICJIZWx2ZXRpY2EtQm9sZE9ibGlxdWUiOwogIHRbIkFyaWFsQmxhY2stSXRhbGljIl0gPSAiSGVsdmV0aWNhLU9ibGlxdWUiOwogIHRbIkFyaWFsLUJsYWNrIl0gPSAiSGVsdmV0aWNhIjsKICB0WyJBcmlhbC1CbGFjay1Cb2xkIl0gPSAiSGVsdmV0aWNhLUJvbGQiOwogIHRbIkFyaWFsLUJsYWNrLUJvbGRJdGFsaWMiXSA9ICJIZWx2ZXRpY2EtQm9sZE9ibGlxdWUiOwogIHRbIkFyaWFsLUJsYWNrLUl0YWxpYyJdID0gIkhlbHZldGljYS1PYmxpcXVlIjsKICB0LkFyaWFsID0gIkhlbHZldGljYSI7CiAgdFsiQXJpYWwtQm9sZCJdID0gIkhlbHZldGljYS1Cb2xkIjsKICB0WyJBcmlhbC1Cb2xkSXRhbGljIl0gPSAiSGVsdmV0aWNhLUJvbGRPYmxpcXVlIjsKICB0WyJBcmlhbC1JdGFsaWMiXSA9ICJIZWx2ZXRpY2EtT2JsaXF1ZSI7CiAgdC5BcmlhbE1UID0gIkhlbHZldGljYSI7CiAgdFsiQXJpYWwtQm9sZEl0YWxpY01UIl0gPSAiSGVsdmV0aWNhLUJvbGRPYmxpcXVlIjsKICB0WyJBcmlhbC1Cb2xkTVQiXSA9ICJIZWx2ZXRpY2EtQm9sZCI7CiAgdFsiQXJpYWwtSXRhbGljTVQiXSA9ICJIZWx2ZXRpY2EtT2JsaXF1ZSI7CiAgdFsiQXJpYWwtQm9sZEl0YWxpY01ULUJvbGRJdGFsaWMiXSA9ICJIZWx2ZXRpY2EtQm9sZE9ibGlxdWUiOwogIHRbIkFyaWFsLUJvbGRNVC1Cb2xkIl0gPSAiSGVsdmV0aWNhLUJvbGQiOwogIHRbIkFyaWFsLUl0YWxpY01ULUl0YWxpYyJdID0gIkhlbHZldGljYS1PYmxpcXVlIjsKICB0LkFyaWFsVW5pY29kZU1TID0gIkhlbHZldGljYSI7CiAgdFsiQXJpYWxVbmljb2RlTVMtQm9sZCJdID0gIkhlbHZldGljYS1Cb2xkIjsKICB0WyJBcmlhbFVuaWNvZGVNUy1Cb2xkSXRhbGljIl0gPSAiSGVsdmV0aWNhLUJvbGRPYmxpcXVlIjsKICB0WyJBcmlhbFVuaWNvZGVNUy1JdGFsaWMiXSA9ICJIZWx2ZXRpY2EtT2JsaXF1ZSI7CiAgdFsiQ291cmllci1Cb2xkSXRhbGljIl0gPSAiQ291cmllci1Cb2xkT2JsaXF1ZSI7CiAgdFsiQ291cmllci1JdGFsaWMiXSA9ICJDb3VyaWVyLU9ibGlxdWUiOwogIHQuQ291cmllck5ldyA9ICJDb3VyaWVyIjsKICB0WyJDb3VyaWVyTmV3LUJvbGQiXSA9ICJDb3VyaWVyLUJvbGQiOwogIHRbIkNvdXJpZXJOZXctQm9sZEl0YWxpYyJdID0gIkNvdXJpZXItQm9sZE9ibGlxdWUiOwogIHRbIkNvdXJpZXJOZXctSXRhbGljIl0gPSAiQ291cmllci1PYmxpcXVlIjsKICB0WyJDb3VyaWVyTmV3UFMtQm9sZEl0YWxpY01UIl0gPSAiQ291cmllci1Cb2xkT2JsaXF1ZSI7CiAgdFsiQ291cmllck5ld1BTLUJvbGRNVCJdID0gIkNvdXJpZXItQm9sZCI7CiAgdFsiQ291cmllck5ld1BTLUl0YWxpY01UIl0gPSAiQ291cmllci1PYmxpcXVlIjsKICB0LkNvdXJpZXJOZXdQU01UID0gIkNvdXJpZXIiOwogIHRbIkhlbHZldGljYS1Cb2xkSXRhbGljIl0gPSAiSGVsdmV0aWNhLUJvbGRPYmxpcXVlIjsKICB0WyJIZWx2ZXRpY2EtSXRhbGljIl0gPSAiSGVsdmV0aWNhLU9ibGlxdWUiOwogIHRbIlN5bWJvbC1Cb2xkIl0gPSAiU3ltYm9sIjsKICB0WyJTeW1ib2wtQm9sZEl0YWxpYyJdID0gIlN5bWJvbCI7CiAgdFsiU3ltYm9sLUl0YWxpYyJdID0gIlN5bWJvbCI7CiAgdC5UaW1lc05ld1JvbWFuID0gIlRpbWVzLVJvbWFuIjsKICB0WyJUaW1lc05ld1JvbWFuLUJvbGQiXSA9ICJUaW1lcy1Cb2xkIjsKICB0WyJUaW1lc05ld1JvbWFuLUJvbGRJdGFsaWMiXSA9ICJUaW1lcy1Cb2xkSXRhbGljIjsKICB0WyJUaW1lc05ld1JvbWFuLUl0YWxpYyJdID0gIlRpbWVzLUl0YWxpYyI7CiAgdC5UaW1lc05ld1JvbWFuUFMgPSAiVGltZXMtUm9tYW4iOwogIHRbIlRpbWVzTmV3Um9tYW5QUy1Cb2xkIl0gPSAiVGltZXMtQm9sZCI7CiAgdFsiVGltZXNOZXdSb21hblBTLUJvbGRJdGFsaWMiXSA9ICJUaW1lcy1Cb2xkSXRhbGljIjsKICB0WyJUaW1lc05ld1JvbWFuUFMtQm9sZEl0YWxpY01UIl0gPSAiVGltZXMtQm9sZEl0YWxpYyI7CiAgdFsiVGltZXNOZXdSb21hblBTLUJvbGRNVCJdID0gIlRpbWVzLUJvbGQiOwogIHRbIlRpbWVzTmV3Um9tYW5QUy1JdGFsaWMiXSA9ICJUaW1lcy1JdGFsaWMiOwogIHRbIlRpbWVzTmV3Um9tYW5QUy1JdGFsaWNNVCJdID0gIlRpbWVzLUl0YWxpYyI7CiAgdC5UaW1lc05ld1JvbWFuUFNNVCA9ICJUaW1lcy1Sb21hbiI7CiAgdFsiVGltZXNOZXdSb21hblBTTVQtQm9sZCJdID0gIlRpbWVzLUJvbGQiOwogIHRbIlRpbWVzTmV3Um9tYW5QU01ULUJvbGRJdGFsaWMiXSA9ICJUaW1lcy1Cb2xkSXRhbGljIjsKICB0WyJUaW1lc05ld1JvbWFuUFNNVC1JdGFsaWMiXSA9ICJUaW1lcy1JdGFsaWMiOwp9KTsKZXhwb3J0cy5nZXRTdGRGb250TWFwID0gZ2V0U3RkRm9udE1hcDsKY29uc3QgZ2V0Rm9udE5hbWVUb0ZpbGVNYXAgPSAoMCwgX2NvcmVfdXRpbHMuZ2V0TG9va3VwVGFibGVGYWN0b3J5KShmdW5jdGlvbiAodCkgewogIHQuQ291cmllciA9ICJGb3hpdEZpeGVkLnBmYiI7CiAgdFsiQ291cmllci1Cb2xkIl0gPSAiRm94aXRGaXhlZEJvbGQucGZiIjsKICB0WyJDb3VyaWVyLUJvbGRPYmxpcXVlIl0gPSAiRm94aXRGaXhlZEJvbGRJdGFsaWMucGZiIjsKICB0WyJDb3VyaWVyLU9ibGlxdWUiXSA9ICJGb3hpdEZpeGVkSXRhbGljLnBmYiI7CiAgdC5IZWx2ZXRpY2EgPSAiTGliZXJhdGlvblNhbnMtUmVndWxhci50dGYiOwogIHRbIkhlbHZldGljYS1Cb2xkIl0gPSAiTGliZXJhdGlvblNhbnMtQm9sZC50dGYiOwogIHRbIkhlbHZldGljYS1Cb2xkT2JsaXF1ZSJdID0gIkxpYmVyYXRpb25TYW5zLUJvbGRJdGFsaWMudHRmIjsKICB0WyJIZWx2ZXRpY2EtT2JsaXF1ZSJdID0gIkxpYmVyYXRpb25TYW5zLUl0YWxpYy50dGYiOwogIHRbIlRpbWVzLVJvbWFuIl0gPSAiRm94aXRTZXJpZi5wZmIiOwogIHRbIlRpbWVzLUJvbGQiXSA9ICJGb3hpdFNlcmlmQm9sZC5wZmIiOwogIHRbIlRpbWVzLUJvbGRJdGFsaWMiXSA9ICJGb3hpdFNlcmlmQm9sZEl0YWxpYy5wZmIiOwogIHRbIlRpbWVzLUl0YWxpYyJdID0gIkZveGl0U2VyaWZJdGFsaWMucGZiIjsKICB0LlN5bWJvbCA9ICJGb3hpdFN5bWJvbC5wZmIiOwogIHQuWmFwZkRpbmdiYXRzID0gIkZveGl0RGluZ2JhdHMucGZiIjsKICB0WyJMaWJlcmF0aW9uU2Fucy1SZWd1bGFyIl0gPSAiTGliZXJhdGlvblNhbnMtUmVndWxhci50dGYiOwogIHRbIkxpYmVyYXRpb25TYW5zLUJvbGQiXSA9ICJMaWJlcmF0aW9uU2Fucy1Cb2xkLnR0ZiI7CiAgdFsiTGliZXJhdGlvblNhbnMtSXRhbGljIl0gPSAiTGliZXJhdGlvblNhbnMtSXRhbGljLnR0ZiI7CiAgdFsiTGliZXJhdGlvblNhbnMtQm9sZEl0YWxpYyJdID0gIkxpYmVyYXRpb25TYW5zLUJvbGRJdGFsaWMudHRmIjsKfSk7CmV4cG9ydHMuZ2V0Rm9udE5hbWVUb0ZpbGVNYXAgPSBnZXRGb250TmFtZVRvRmlsZU1hcDsKY29uc3QgZ2V0Tm9uU3RkRm9udE1hcCA9ICgwLCBfY29yZV91dGlscy5nZXRMb29rdXBUYWJsZUZhY3RvcnkpKGZ1bmN0aW9uICh0KSB7CiAgdC5DYWxpYnJpID0gIkhlbHZldGljYSI7CiAgdFsiQ2FsaWJyaS1Cb2xkIl0gPSAiSGVsdmV0aWNhLUJvbGQiOwogIHRbIkNhbGlicmktQm9sZEl0YWxpYyJdID0gIkhlbHZldGljYS1Cb2xkT2JsaXF1ZSI7CiAgdFsiQ2FsaWJyaS1JdGFsaWMiXSA9ICJIZWx2ZXRpY2EtT2JsaXF1ZSI7CiAgdC5DZW50dXJ5R290aGljID0gIkhlbHZldGljYSI7CiAgdFsiQ2VudHVyeUdvdGhpYy1Cb2xkIl0gPSAiSGVsdmV0aWNhLUJvbGQiOwogIHRbIkNlbnR1cnlHb3RoaWMtQm9sZEl0YWxpYyJdID0gIkhlbHZldGljYS1Cb2xkT2JsaXF1ZSI7CiAgdFsiQ2VudHVyeUdvdGhpYy1JdGFsaWMiXSA9ICJIZWx2ZXRpY2EtT2JsaXF1ZSI7CiAgdC5Db21pY1NhbnNNUyA9ICJDb21pYyBTYW5zIE1TIjsKICB0WyJDb21pY1NhbnNNUy1Cb2xkIl0gPSAiQ29taWMgU2FucyBNUy1Cb2xkIjsKICB0WyJDb21pY1NhbnNNUy1Cb2xkSXRhbGljIl0gPSAiQ29taWMgU2FucyBNUy1Cb2xkSXRhbGljIjsKICB0WyJDb21pY1NhbnNNUy1JdGFsaWMiXSA9ICJDb21pYyBTYW5zIE1TLUl0YWxpYyI7CiAgdC5JbXBhY3QgPSAiSGVsdmV0aWNhIjsKICB0WyJJdGNTeW1ib2wtQm9sZCJdID0gIkhlbHZldGljYS1Cb2xkIjsKICB0WyJJdGNTeW1ib2wtQm9sZEl0YWxpYyJdID0gIkhlbHZldGljYS1Cb2xkT2JsaXF1ZSI7CiAgdFsiSXRjU3ltYm9sLUJvb2siXSA9ICJIZWx2ZXRpY2EiOwogIHRbIkl0Y1N5bWJvbC1Cb29rSXRhbGljIl0gPSAiSGVsdmV0aWNhLU9ibGlxdWUiOwogIHRbIkl0Y1N5bWJvbC1NZWRpdW0iXSA9ICJIZWx2ZXRpY2EiOwogIHRbIkl0Y1N5bWJvbC1NZWRpdW1JdGFsaWMiXSA9ICJIZWx2ZXRpY2EtT2JsaXF1ZSI7CiAgdC5MdWNpZGFDb25zb2xlID0gIkNvdXJpZXIiOwogIHRbIkx1Y2lkYUNvbnNvbGUtQm9sZCJdID0gIkNvdXJpZXItQm9sZCI7CiAgdFsiTHVjaWRhQ29uc29sZS1Cb2xkSXRhbGljIl0gPSAiQ291cmllci1Cb2xkT2JsaXF1ZSI7CiAgdFsiTHVjaWRhQ29uc29sZS1JdGFsaWMiXSA9ICJDb3VyaWVyLU9ibGlxdWUiOwogIHRbIkx1Y2lkYVNhbnMtRGVtaSJdID0gIkhlbHZldGljYS1Cb2xkIjsKICB0WyJNUy1Hb3RoaWMiXSA9ICJNUyBHb3RoaWMiOwogIHRbIk1TLUdvdGhpYy1Cb2xkIl0gPSAiTVMgR290aGljLUJvbGQiOwogIHRbIk1TLUdvdGhpYy1Cb2xkSXRhbGljIl0gPSAiTVMgR290aGljLUJvbGRJdGFsaWMiOwogIHRbIk1TLUdvdGhpYy1JdGFsaWMiXSA9ICJNUyBHb3RoaWMtSXRhbGljIjsKICB0WyJNUy1NaW5jaG8iXSA9ICJNUyBNaW5jaG8iOwogIHRbIk1TLU1pbmNoby1Cb2xkIl0gPSAiTVMgTWluY2hvLUJvbGQiOwogIHRbIk1TLU1pbmNoby1Cb2xkSXRhbGljIl0gPSAiTVMgTWluY2hvLUJvbGRJdGFsaWMiOwogIHRbIk1TLU1pbmNoby1JdGFsaWMiXSA9ICJNUyBNaW5jaG8tSXRhbGljIjsKICB0WyJNUy1QR290aGljIl0gPSAiTVMgUEdvdGhpYyI7CiAgdFsiTVMtUEdvdGhpYy1Cb2xkIl0gPSAiTVMgUEdvdGhpYy1Cb2xkIjsKICB0WyJNUy1QR290aGljLUJvbGRJdGFsaWMiXSA9ICJNUyBQR290aGljLUJvbGRJdGFsaWMiOwogIHRbIk1TLVBHb3RoaWMtSXRhbGljIl0gPSAiTVMgUEdvdGhpYy1JdGFsaWMiOwogIHRbIk1TLVBNaW5jaG8iXSA9ICJNUyBQTWluY2hvIjsKICB0WyJNUy1QTWluY2hvLUJvbGQiXSA9ICJNUyBQTWluY2hvLUJvbGQiOwogIHRbIk1TLVBNaW5jaG8tQm9sZEl0YWxpYyJdID0gIk1TIFBNaW5jaG8tQm9sZEl0YWxpYyI7CiAgdFsiTVMtUE1pbmNoby1JdGFsaWMiXSA9ICJNUyBQTWluY2hvLUl0YWxpYyI7CiAgdC5OdXB0aWFsU2NyaXB0ID0gIlRpbWVzLUl0YWxpYyI7CiAgdC5TZWdvZVVJU3ltYm9sID0gIkhlbHZldGljYSI7Cn0pOwpleHBvcnRzLmdldE5vblN0ZEZvbnRNYXAgPSBnZXROb25TdGRGb250TWFwOwpjb25zdCBnZXRTZXJpZkZvbnRzID0gKDAsIF9jb3JlX3V0aWxzLmdldExvb2t1cFRhYmxlRmFjdG9yeSkoZnVuY3Rpb24gKHQpIHsKICB0WyJBZG9iZSBKZW5zb24iXSA9IHRydWU7CiAgdFsiQWRvYmUgVGV4dCJdID0gdHJ1ZTsKICB0LkFsYmVydHVzID0gdHJ1ZTsKICB0LkFsZHVzID0gdHJ1ZTsKICB0LkFsZXhhbmRyaWEgPSB0cnVlOwogIHQuQWxnZXJpYW4gPSB0cnVlOwogIHRbIkFtZXJpY2FuIFR5cGV3cml0ZXIiXSA9IHRydWU7CiAgdC5BbnRpcXVhID0gdHJ1ZTsKICB0LkFwZXggPSB0cnVlOwogIHQuQXJubyA9IHRydWU7CiAgdC5Bc3RlciA9IHRydWU7CiAgdC5BdXJvcmEgPSB0cnVlOwogIHQuQmFza2VydmlsbGUgPSB0cnVlOwogIHQuQmVsbCA9IHRydWU7CiAgdC5CZW1ibyA9IHRydWU7CiAgdFsiQmVtYm8gU2Nob29sYm9vayJdID0gdHJ1ZTsKICB0LkJlbmd1aWF0ID0gdHJ1ZTsKICB0WyJCZXJrZWxleSBPbGQgU3R5bGUiXSA9IHRydWU7CiAgdFsiQmVybmhhcmQgTW9kZXJuIl0gPSB0cnVlOwogIHRbIkJlcnRob2xkIENpdHkiXSA9IHRydWU7CiAgdC5Cb2RvbmkgPSB0cnVlOwogIHRbIkJhdWVyIEJvZG9uaSJdID0gdHJ1ZTsKICB0WyJCb29rIEFudGlxdWEiXSA9IHRydWU7CiAgdC5Cb29rbWFuID0gdHJ1ZTsKICB0WyJCb3JkZWF1eCBSb21hbiJdID0gdHJ1ZTsKICB0WyJDYWxpZm9ybmlhbiBGQiJdID0gdHJ1ZTsKICB0LkNhbGlzdG8gPSB0cnVlOwogIHQuQ2FsdmVydCA9IHRydWU7CiAgdC5DYXBpdGFscyA9IHRydWU7CiAgdC5DYW1icmlhID0gdHJ1ZTsKICB0LkNhcnRpZXIgPSB0cnVlOwogIHQuQ2FzbG9uID0gdHJ1ZTsKICB0LkNhdHVsbCA9IHRydWU7CiAgdC5DZW50YXVyID0gdHJ1ZTsKICB0WyJDZW50dXJ5IE9sZCBTdHlsZSJdID0gdHJ1ZTsKICB0WyJDZW50dXJ5IFNjaG9vbGJvb2siXSA9IHRydWU7CiAgdC5DaGFwYXJyYWwgPSB0cnVlOwogIHRbIkNoYXJpcyBTSUwiXSA9IHRydWU7CiAgdC5DaGVsdGVuaGFtID0gdHJ1ZTsKICB0WyJDaG9sbGEgU2xhYiJdID0gdHJ1ZTsKICB0LkNsYXJlbmRvbiA9IHRydWU7CiAgdC5DbGVhcmZhY2UgPSB0cnVlOwogIHQuQ29jaGluID0gdHJ1ZTsKICB0LkNvbG9ubmEgPSB0cnVlOwogIHRbIkNvbXB1dGVyIE1vZGVybiJdID0gdHJ1ZTsKICB0WyJDb25jcmV0ZSBSb21hbiJdID0gdHJ1ZTsKICB0LkNvbnN0YW50aWEgPSB0cnVlOwogIHRbIkNvb3BlciBCbGFjayJdID0gdHJ1ZTsKICB0LkNvcm9uYSA9IHRydWU7CiAgdC5FY290eXBlID0gdHJ1ZTsKICB0LkVneXB0aWVubmUgPSB0cnVlOwogIHQuRWxlcGhhbnQgPSB0cnVlOwogIHQuRXhjZWxzaW9yID0gdHJ1ZTsKICB0LkZhaXJmaWVsZCA9IHRydWU7CiAgdFsiRkYgU2NhbGEiXSA9IHRydWU7CiAgdC5Gb2xrYXJkID0gdHJ1ZTsKICB0LkZvb3RsaWdodCA9IHRydWU7CiAgdC5GcmVlU2VyaWYgPSB0cnVlOwogIHRbIkZyaXogUXVhZHJhdGEiXSA9IHRydWU7CiAgdC5HYXJhbW9uZCA9IHRydWU7CiAgdC5HZW50aXVtID0gdHJ1ZTsKICB0Lkdlb3JnaWEgPSB0cnVlOwogIHQuR2xvdWNlc3RlciA9IHRydWU7CiAgdFsiR291ZHkgT2xkIFN0eWxlIl0gPSB0cnVlOwogIHRbIkdvdWR5IFNjaG9vbGJvb2siXSA9IHRydWU7CiAgdFsiR291ZHkgUHJvIEZvbnQiXSA9IHRydWU7CiAgdC5HcmFuam9uID0gdHJ1ZTsKICB0WyJHdWFyZGlhbiBFZ3lwdGlhbiJdID0gdHJ1ZTsKICB0LkhlYXRoZXIgPSB0cnVlOwogIHQuSGVyY3VsZXMgPSB0cnVlOwogIHRbIkhpZ2ggVG93ZXIgVGV4dCJdID0gdHJ1ZTsKICB0Lkhpcm9zaGlnZSA9IHRydWU7CiAgdFsiSG9lZmxlciBUZXh0Il0gPSB0cnVlOwogIHRbIkh1bWFuYSBTZXJpZiJdID0gdHJ1ZTsKICB0LkltcHJpbnQgPSB0cnVlOwogIHRbIklvbmljIE5vLiA1Il0gPSB0cnVlOwogIHQuSmFuc29uID0gdHJ1ZTsKICB0LkpvYW5uYSA9IHRydWU7CiAgdC5Lb3Jpbm5hID0gdHJ1ZTsKICB0LkxleGljb24gPSB0cnVlOwogIHQuTGliZXJhdGlvblNlcmlmID0gdHJ1ZTsKICB0WyJMaWJlcmF0aW9uIFNlcmlmIl0gPSB0cnVlOwogIHRbIkxpbnV4IExpYmVydGluZSJdID0gdHJ1ZTsKICB0LkxpdGVyYXR1cm5heWEgPSB0cnVlOwogIHQuTHVjaWRhID0gdHJ1ZTsKICB0WyJMdWNpZGEgQnJpZ2h0Il0gPSB0cnVlOwogIHQuTWVsaW9yID0gdHJ1ZTsKICB0Lk1lbXBoaXMgPSB0cnVlOwogIHQuTWlsbGVyID0gdHJ1ZTsKICB0Lk1pbmlvbiA9IHRydWU7CiAgdC5Nb2Rlcm4gPSB0cnVlOwogIHRbIk1vbmEgTGlzYSJdID0gdHJ1ZTsKICB0WyJNcnMgRWF2ZXMiXSA9IHRydWU7CiAgdFsiTVMgU2VyaWYiXSA9IHRydWU7CiAgdFsiTXVzZW8gU2xhYiJdID0gdHJ1ZTsKICB0WyJOZXcgWW9yayJdID0gdHJ1ZTsKICB0WyJOaW1idXMgUm9tYW4iXSA9IHRydWU7CiAgdFsiTlBTIFJhd2xpbnNvbiBSb2Fkd2F5Il0gPSB0cnVlOwogIHQuTnVwdGlhbFNjcmlwdCA9IHRydWU7CiAgdC5QYWxhdGlubyA9IHRydWU7CiAgdC5QZXJwZXR1YSA9IHRydWU7CiAgdC5QbGFudGluID0gdHJ1ZTsKICB0WyJQbGFudGluIFNjaG9vbGJvb2siXSA9IHRydWU7CiAgdC5QbGF5YmlsbCA9IHRydWU7CiAgdFsiUG9vciBSaWNoYXJkIl0gPSB0cnVlOwogIHRbIlJhd2xpbnNvbiBSb2Fkd2F5Il0gPSB0cnVlOwogIHQuUmVuYXVsdCA9IHRydWU7CiAgdC5SZXF1aWVtID0gdHJ1ZTsKICB0LlJvY2t3ZWxsID0gdHJ1ZTsKICB0LlJvbWFuID0gdHJ1ZTsKICB0WyJSb3RpcyBTZXJpZiJdID0gdHJ1ZTsKICB0LlNhYm9uID0gdHJ1ZTsKICB0LlNjYWxhID0gdHJ1ZTsKICB0LlNlYWd1bGwgPSB0cnVlOwogIHQuU2lzdGluYSA9IHRydWU7CiAgdC5Tb3V2ZW5pciA9IHRydWU7CiAgdC5TVElYID0gdHJ1ZTsKICB0WyJTdG9uZSBJbmZvcm1hbCJdID0gdHJ1ZTsKICB0WyJTdG9uZSBTZXJpZiJdID0gdHJ1ZTsKICB0LlN5bGZhZW4gPSB0cnVlOwogIHQuVGltZXMgPSB0cnVlOwogIHQuVHJhamFuID0gdHJ1ZTsKICB0WyJUcmluaXTDqSJdID0gdHJ1ZTsKICB0WyJUcnVtcCBNZWRpYWV2YWwiXSA9IHRydWU7CiAgdC5VdG9waWEgPSB0cnVlOwogIHRbIlZhbGUgVHlwZSJdID0gdHJ1ZTsKICB0WyJCaXRzdHJlYW0gVmVyYSJdID0gdHJ1ZTsKICB0WyJWZXJhIFNlcmlmIl0gPSB0cnVlOwogIHQuVmVyc2FpbGxlcyA9IHRydWU7CiAgdC5XYW50ZWQgPSB0cnVlOwogIHQuV2Vpc3MgPSB0cnVlOwogIHRbIldpZGUgTGF0aW4iXSA9IHRydWU7CiAgdC5XaW5kc29yID0gdHJ1ZTsKICB0LlhJVFMgPSB0cnVlOwp9KTsKZXhwb3J0cy5nZXRTZXJpZkZvbnRzID0gZ2V0U2VyaWZGb250czsKY29uc3QgZ2V0U3ltYm9sc0ZvbnRzID0gKDAsIF9jb3JlX3V0aWxzLmdldExvb2t1cFRhYmxlRmFjdG9yeSkoZnVuY3Rpb24gKHQpIHsKICB0LkRpbmdiYXRzID0gdHJ1ZTsKICB0LlN5bWJvbCA9IHRydWU7CiAgdC5aYXBmRGluZ2JhdHMgPSB0cnVlOwogIHQuV2luZ2RpbmdzID0gdHJ1ZTsKICB0WyJXaW5nZGluZ3MtQm9sZCJdID0gdHJ1ZTsKICB0WyJXaW5nZGluZ3MtUmVndWxhciJdID0gdHJ1ZTsKfSk7CmV4cG9ydHMuZ2V0U3ltYm9sc0ZvbnRzID0gZ2V0U3ltYm9sc0ZvbnRzOwpjb25zdCBnZXRHbHlwaE1hcEZvclN0YW5kYXJkRm9udHMgPSAoMCwgX2NvcmVfdXRpbHMuZ2V0TG9va3VwVGFibGVGYWN0b3J5KShmdW5jdGlvbiAodCkgewogIHRbMl0gPSAxMDsKICB0WzNdID0gMzI7CiAgdFs0XSA9IDMzOwogIHRbNV0gPSAzNDsKICB0WzZdID0gMzU7CiAgdFs3XSA9IDM2OwogIHRbOF0gPSAzNzsKICB0WzldID0gMzg7CiAgdFsxMF0gPSAzOTsKICB0WzExXSA9IDQwOwogIHRbMTJdID0gNDE7CiAgdFsxM10gPSA0MjsKICB0WzE0XSA9IDQzOwogIHRbMTVdID0gNDQ7CiAgdFsxNl0gPSA0NTsKICB0WzE3XSA9IDQ2OwogIHRbMThdID0gNDc7CiAgdFsxOV0gPSA0ODsKICB0WzIwXSA9IDQ5OwogIHRbMjFdID0gNTA7CiAgdFsyMl0gPSA1MTsKICB0WzIzXSA9IDUyOwogIHRbMjRdID0gNTM7CiAgdFsyNV0gPSA1NDsKICB0WzI2XSA9IDU1OwogIHRbMjddID0gNTY7CiAgdFsyOF0gPSA1NzsKICB0WzI5XSA9IDU4OwogIHRbMzBdID0gODk0OwogIHRbMzFdID0gNjA7CiAgdFszMl0gPSA2MTsKICB0WzMzXSA9IDYyOwogIHRbMzRdID0gNjM7CiAgdFszNV0gPSA2NDsKICB0WzM2XSA9IDY1OwogIHRbMzddID0gNjY7CiAgdFszOF0gPSA2NzsKICB0WzM5XSA9IDY4OwogIHRbNDBdID0gNjk7CiAgdFs0MV0gPSA3MDsKICB0WzQyXSA9IDcxOwogIHRbNDNdID0gNzI7CiAgdFs0NF0gPSA3MzsKICB0WzQ1XSA9IDc0OwogIHRbNDZdID0gNzU7CiAgdFs0N10gPSA3NjsKICB0WzQ4XSA9IDc3OwogIHRbNDldID0gNzg7CiAgdFs1MF0gPSA3OTsKICB0WzUxXSA9IDgwOwogIHRbNTJdID0gODE7CiAgdFs1M10gPSA4MjsKICB0WzU0XSA9IDgzOwogIHRbNTVdID0gODQ7CiAgdFs1Nl0gPSA4NTsKICB0WzU3XSA9IDg2OwogIHRbNThdID0gODc7CiAgdFs1OV0gPSA4ODsKICB0WzYwXSA9IDg5OwogIHRbNjFdID0gOTA7CiAgdFs2Ml0gPSA5MTsKICB0WzYzXSA9IDkyOwogIHRbNjRdID0gOTM7CiAgdFs2NV0gPSA5NDsKICB0WzY2XSA9IDk1OwogIHRbNjddID0gOTY7CiAgdFs2OF0gPSA5NzsKICB0WzY5XSA9IDk4OwogIHRbNzBdID0gOTk7CiAgdFs3MV0gPSAxMDA7CiAgdFs3Ml0gPSAxMDE7CiAgdFs3M10gPSAxMDI7CiAgdFs3NF0gPSAxMDM7CiAgdFs3NV0gPSAxMDQ7CiAgdFs3Nl0gPSAxMDU7CiAgdFs3N10gPSAxMDY7CiAgdFs3OF0gPSAxMDc7CiAgdFs3OV0gPSAxMDg7CiAgdFs4MF0gPSAxMDk7CiAgdFs4MV0gPSAxMTA7CiAgdFs4Ml0gPSAxMTE7CiAgdFs4M10gPSAxMTI7CiAgdFs4NF0gPSAxMTM7CiAgdFs4NV0gPSAxMTQ7CiAgdFs4Nl0gPSAxMTU7CiAgdFs4N10gPSAxMTY7CiAgdFs4OF0gPSAxMTc7CiAgdFs4OV0gPSAxMTg7CiAgdFs5MF0gPSAxMTk7CiAgdFs5MV0gPSAxMjA7CiAgdFs5Ml0gPSAxMjE7CiAgdFs5M10gPSAxMjI7CiAgdFs5NF0gPSAxMjM7CiAgdFs5NV0gPSAxMjQ7CiAgdFs5Nl0gPSAxMjU7CiAgdFs5N10gPSAxMjY7CiAgdFs5OF0gPSAxOTY7CiAgdFs5OV0gPSAxOTc7CiAgdFsxMDBdID0gMTk5OwogIHRbMTAxXSA9IDIwMTsKICB0WzEwMl0gPSAyMDk7CiAgdFsxMDNdID0gMjE0OwogIHRbMTA0XSA9IDIyMDsKICB0WzEwNV0gPSAyMjU7CiAgdFsxMDZdID0gMjI0OwogIHRbMTA3XSA9IDIyNjsKICB0WzEwOF0gPSAyMjg7CiAgdFsxMDldID0gMjI3OwogIHRbMTEwXSA9IDIyOTsKICB0WzExMV0gPSAyMzE7CiAgdFsxMTJdID0gMjMzOwogIHRbMTEzXSA9IDIzMjsKICB0WzExNF0gPSAyMzQ7CiAgdFsxMTVdID0gMjM1OwogIHRbMTE2XSA9IDIzNzsKICB0WzExN10gPSAyMzY7CiAgdFsxMThdID0gMjM4OwogIHRbMTE5XSA9IDIzOTsKICB0WzEyMF0gPSAyNDE7CiAgdFsxMjFdID0gMjQzOwogIHRbMTIyXSA9IDI0MjsKICB0WzEyM10gPSAyNDQ7CiAgdFsxMjRdID0gMjQ2OwogIHRbMTI1XSA9IDI0NTsKICB0WzEyNl0gPSAyNTA7CiAgdFsxMjddID0gMjQ5OwogIHRbMTI4XSA9IDI1MTsKICB0WzEyOV0gPSAyNTI7CiAgdFsxMzBdID0gODIyNDsKICB0WzEzMV0gPSAxNzY7CiAgdFsxMzJdID0gMTYyOwogIHRbMTMzXSA9IDE2MzsKICB0WzEzNF0gPSAxNjc7CiAgdFsxMzVdID0gODIyNjsKICB0WzEzNl0gPSAxODI7CiAgdFsxMzddID0gMjIzOwogIHRbMTM4XSA9IDE3NDsKICB0WzEzOV0gPSAxNjk7CiAgdFsxNDBdID0gODQ4MjsKICB0WzE0MV0gPSAxODA7CiAgdFsxNDJdID0gMTY4OwogIHRbMTQzXSA9IDg4MDA7CiAgdFsxNDRdID0gMTk4OwogIHRbMTQ1XSA9IDIxNjsKICB0WzE0Nl0gPSA4NzM0OwogIHRbMTQ3XSA9IDE3NzsKICB0WzE0OF0gPSA4ODA0OwogIHRbMTQ5XSA9IDg4MDU7CiAgdFsxNTBdID0gMTY1OwogIHRbMTUxXSA9IDE4MTsKICB0WzE1Ml0gPSA4NzA2OwogIHRbMTUzXSA9IDg3MjE7CiAgdFsxNTRdID0gODcxOTsKICB0WzE1Nl0gPSA4NzQ3OwogIHRbMTU3XSA9IDE3MDsKICB0WzE1OF0gPSAxODY7CiAgdFsxNTldID0gODQ4NjsKICB0WzE2MF0gPSAyMzA7CiAgdFsxNjFdID0gMjQ4OwogIHRbMTYyXSA9IDE5MTsKICB0WzE2M10gPSAxNjE7CiAgdFsxNjRdID0gMTcyOwogIHRbMTY1XSA9IDg3MzA7CiAgdFsxNjZdID0gNDAyOwogIHRbMTY3XSA9IDg3NzY7CiAgdFsxNjhdID0gODcxMDsKICB0WzE2OV0gPSAxNzE7CiAgdFsxNzBdID0gMTg3OwogIHRbMTcxXSA9IDgyMzA7CiAgdFsxNzldID0gODIyMDsKICB0WzE4MF0gPSA4MjIxOwogIHRbMTgxXSA9IDgyMTY7CiAgdFsxODJdID0gODIxNzsKICB0WzIwMF0gPSAxOTM7CiAgdFsyMDNdID0gMjA1OwogIHRbMjA3XSA9IDIxMTsKICB0WzIxMF0gPSAyMTg7CiAgdFsyMjNdID0gNzExOwogIHRbMjI0XSA9IDMyMTsKICB0WzIyNV0gPSAzMjI7CiAgdFsyMjZdID0gMzUyOwogIHRbMjI3XSA9IDM1MzsKICB0WzIyOF0gPSAzODE7CiAgdFsyMjldID0gMzgyOwogIHRbMjMzXSA9IDIyMTsKICB0WzIzNF0gPSAyNTM7CiAgdFsyNTJdID0gMjYzOwogIHRbMjUzXSA9IDI2ODsKICB0WzI1NF0gPSAyNjk7CiAgdFsyNThdID0gMjU4OwogIHRbMjYwXSA9IDI2MDsKICB0WzI2MV0gPSAyNjE7CiAgdFsyNjVdID0gMjgwOwogIHRbMjY2XSA9IDI4MTsKICB0WzI2N10gPSAyODI7CiAgdFsyNjhdID0gMjgzOwogIHRbMjY5XSA9IDMxMzsKICB0WzI3NV0gPSAzMjM7CiAgdFsyNzZdID0gMzI0OwogIHRbMjc4XSA9IDMyODsKICB0WzI4M10gPSAzNDQ7CiAgdFsyODRdID0gMzQ1OwogIHRbMjg1XSA9IDM0NjsKICB0WzI4Nl0gPSAzNDc7CiAgdFsyOTJdID0gMzY3OwogIHRbMjk1XSA9IDM3NzsKICB0WzI5Nl0gPSAzNzg7CiAgdFsyOThdID0gMzgwOwogIHRbMzA1XSA9IDk2MzsKICB0WzMwNl0gPSA5NjQ7CiAgdFszMDddID0gOTY2OwogIHRbMzA4XSA9IDgyMTU7CiAgdFszMDldID0gODI1MjsKICB0WzMxMF0gPSA4MzE5OwogIHRbMzExXSA9IDgzNTk7CiAgdFszMTJdID0gODU5MjsKICB0WzMxM10gPSA4NTkzOwogIHRbMzM3XSA9IDk1NTI7CiAgdFs0OTNdID0gMTAzOTsKICB0WzQ5NF0gPSAxMDQwOwogIHRbNjcyXSA9IDE0ODg7CiAgdFs2NzNdID0gMTQ4OTsKICB0WzY3NF0gPSAxNDkwOwogIHRbNjc1XSA9IDE0OTE7CiAgdFs2NzZdID0gMTQ5MjsKICB0WzY3N10gPSAxNDkzOwogIHRbNjc4XSA9IDE0OTQ7CiAgdFs2NzldID0gMTQ5NTsKICB0WzY4MF0gPSAxNDk2OwogIHRbNjgxXSA9IDE0OTc7CiAgdFs2ODJdID0gMTQ5ODsKICB0WzY4M10gPSAxNDk5OwogIHRbNjg0XSA9IDE1MDA7CiAgdFs2ODVdID0gMTUwMTsKICB0WzY4Nl0gPSAxNTAyOwogIHRbNjg3XSA9IDE1MDM7CiAgdFs2ODhdID0gMTUwNDsKICB0WzY4OV0gPSAxNTA1OwogIHRbNjkwXSA9IDE1MDY7CiAgdFs2OTFdID0gMTUwNzsKICB0WzY5Ml0gPSAxNTA4OwogIHRbNjkzXSA9IDE1MDk7CiAgdFs2OTRdID0gMTUxMDsKICB0WzY5NV0gPSAxNTExOwogIHRbNjk2XSA9IDE1MTI7CiAgdFs2OTddID0gMTUxMzsKICB0WzY5OF0gPSAxNTE0OwogIHRbNzA1XSA9IDE1MjQ7CiAgdFs3MDZdID0gODM2MjsKICB0WzcxMF0gPSA2NDI4ODsKICB0WzcxMV0gPSA2NDI5ODsKICB0Wzc1OV0gPSAxNjE3OwogIHRbNzYxXSA9IDE3NzY7CiAgdFs3NjNdID0gMTc3ODsKICB0Wzc3NV0gPSAxNjUyOwogIHRbNzc3XSA9IDE3NjQ7CiAgdFs3NzhdID0gMTc4MDsKICB0Wzc3OV0gPSAxNzgxOwogIHRbNzgwXSA9IDE3ODI7CiAgdFs3ODJdID0gNzcxOwogIHRbNzgzXSA9IDY0NzI2OwogIHRbNzg2XSA9IDgzNjM7CiAgdFs3ODhdID0gODUzMjsKICB0Wzc5MF0gPSA3Njg7CiAgdFs3OTFdID0gNzY5OwogIHRbNzkyXSA9IDc2ODsKICB0Wzc5NV0gPSA4MDM7CiAgdFs3OTddID0gNjQzMzY7CiAgdFs3OThdID0gNjQzMzc7CiAgdFs3OTldID0gNjQzNDI7CiAgdFs4MDBdID0gNjQzNDM7CiAgdFs4MDFdID0gNjQzNDQ7CiAgdFs4MDJdID0gNjQzNDU7CiAgdFs4MDNdID0gNjQzNjI7CiAgdFs4MDRdID0gNjQzNjM7CiAgdFs4MDVdID0gNjQzNjQ7CiAgdFsyNDI0XSA9IDc4MjE7CiAgdFsyNDI1XSA9IDc4MjI7CiAgdFsyNDI2XSA9IDc4MjM7CiAgdFsyNDI3XSA9IDc4MjQ7CiAgdFsyNDI4XSA9IDc4MjU7CiAgdFsyNDI5XSA9IDc4MjY7CiAgdFsyNDMwXSA9IDc4Mjc7CiAgdFsyNDMzXSA9IDc2ODI7CiAgdFsyNjc4XSA9IDgwNDU7CiAgdFsyNjc5XSA9IDgwNDY7CiAgdFsyODMwXSA9IDE1NTI7CiAgdFsyODM4XSA9IDY4NjsKICB0WzI4NDBdID0gNzUxOwogIHRbMjg0Ml0gPSA3NTM7CiAgdFsyODQzXSA9IDc1NDsKICB0WzI4NDRdID0gNzU1OwogIHRbMjg0Nl0gPSA3NTc7CiAgdFsyODU2XSA9IDc2NzsKICB0WzI4NTddID0gODQ4OwogIHRbMjg1OF0gPSA4NDk7CiAgdFsyODYyXSA9IDg1MzsKICB0WzI4NjNdID0gODU0OwogIHRbMjg2NF0gPSA4NTU7CiAgdFsyODY1XSA9IDg2MTsKICB0WzI4NjZdID0gODYyOwogIHRbMjkwNl0gPSA3NDYwOwogIHRbMjkwOF0gPSA3NDYyOwogIHRbMjkwOV0gPSA3NDYzOwogIHRbMjkxMF0gPSA3NDY0OwogIHRbMjkxMl0gPSA3NDY2OwogIHRbMjkxM10gPSA3NDY3OwogIHRbMjkxNF0gPSA3NDY4OwogIHRbMjkxNl0gPSA3NDcwOwogIHRbMjkxN10gPSA3NDcxOwogIHRbMjkxOF0gPSA3NDcyOwogIHRbMjkyMF0gPSA3NDc0OwogIHRbMjkyMV0gPSA3NDc1OwogIHRbMjkyMl0gPSA3NDc2OwogIHRbMjkyNF0gPSA3NDc4OwogIHRbMjkyNV0gPSA3NDc5OwogIHRbMjkyNl0gPSA3NDgwOwogIHRbMjkyOF0gPSA3NDgyOwogIHRbMjkyOV0gPSA3NDgzOwogIHRbMjkzMF0gPSA3NDg0OwogIHRbMjkzMl0gPSA3NDg2OwogIHRbMjkzM10gPSA3NDg3OwogIHRbMjkzNF0gPSA3NDg4OwogIHRbMjkzNl0gPSA3NDkwOwogIHRbMjkzN10gPSA3NDkxOwogIHRbMjkzOF0gPSA3NDkyOwogIHRbMjk0MF0gPSA3NDk0OwogIHRbMjk0MV0gPSA3NDk1OwogIHRbMjk0Ml0gPSA3NDk2OwogIHRbMjk0NF0gPSA3NDk4OwogIHRbMjk0Nl0gPSA3NTAwOwogIHRbMjk0OF0gPSA3NTAyOwogIHRbMjk1MF0gPSA3NTA0OwogIHRbMjk1MV0gPSA3NTA1OwogIHRbMjk1Ml0gPSA3NTA2OwogIHRbMjk1NF0gPSA3NTA4OwogIHRbMjk1NV0gPSA3NTA5OwogIHRbMjk1Nl0gPSA3NTEwOwogIHRbMjk1OF0gPSA3NTEyOwogIHRbMjk1OV0gPSA3NTEzOwogIHRbMjk2MF0gPSA3NTE0OwogIHRbMjk2Ml0gPSA3NTE2OwogIHRbMjk2M10gPSA3NTE3OwogIHRbMjk2NF0gPSA3NTE4OwogIHRbMjk2Nl0gPSA3NTIwOwogIHRbMjk2N10gPSA3NTIxOwogIHRbMjk2OF0gPSA3NTIyOwogIHRbMjk3MF0gPSA3NTI0OwogIHRbMjk3MV0gPSA3NTI1OwogIHRbMjk3Ml0gPSA3NTI2OwogIHRbMjk3NF0gPSA3NTI4OwogIHRbMjk3NV0gPSA3NTI5OwogIHRbMjk3Nl0gPSA3NTMwOwogIHRbMjk3OF0gPSAxNTM3OwogIHRbMjk3OV0gPSAxNTM4OwogIHRbMjk4MF0gPSAxNTM5OwogIHRbMjk4Ml0gPSAxNTQ5OwogIHRbMjk4M10gPSAxNTUxOwogIHRbMjk4NF0gPSAxNTUyOwogIHRbMjk4Nl0gPSAxNTU0OwogIHRbMjk4N10gPSAxNTU1OwogIHRbMjk4OF0gPSAxNTU2OwogIHRbMjk5MF0gPSAxNjIzOwogIHRbMjk5MV0gPSAxNjI0OwogIHRbMjk5NV0gPSAxNzc1OwogIHRbMjk5OV0gPSAxNzkxOwogIHRbMzAwMl0gPSA2NDI5MDsKICB0WzMwMDNdID0gNjQyOTE7CiAgdFszMDA0XSA9IDY0MjkyOwogIHRbMzAwNl0gPSA2NDI5NDsKICB0WzMwMDddID0gNjQyOTU7CiAgdFszMDA4XSA9IDY0Mjk2OwogIHRbMzAxMV0gPSAxOTAwOwogIHRbMzAxNF0gPSA4MjIzOwogIHRbMzAxNV0gPSA4MjQ0OwogIHRbMzAxN10gPSA3NTMyOwogIHRbMzAxOF0gPSA3NTMzOwogIHRbMzAxOV0gPSA3NTM0OwogIHRbMzA3NV0gPSA3NTkwOwogIHRbMzA3Nl0gPSA3NTkxOwogIHRbMzA3OV0gPSA3NTk0OwogIHRbMzA4MF0gPSA3NTk1OwogIHRbMzA4M10gPSA3NTk4OwogIHRbMzA4NF0gPSA3NTk5OwogIHRbMzA4N10gPSA3NjAyOwogIHRbMzA4OF0gPSA3NjAzOwogIHRbMzA5MV0gPSA3NjA2OwogIHRbMzA5Ml0gPSA3NjA3OwogIHRbMzA5NV0gPSA3NjEwOwogIHRbMzA5Nl0gPSA3NjExOwogIHRbMzA5OV0gPSA3NjE0OwogIHRbMzEwMF0gPSA3NjE1OwogIHRbMzEwM10gPSA3NjE4OwogIHRbMzEwNF0gPSA3NjE5OwogIHRbMzEwN10gPSA4MzM3OwogIHRbMzEwOF0gPSA4MzM4OwogIHRbMzExNl0gPSAxODg0OwogIHRbMzExOV0gPSAxODg1OwogIHRbMzEyMF0gPSAxODg1OwogIHRbMzEyM10gPSAxODg2OwogIHRbMzEyNF0gPSAxODg2OwogIHRbMzEyN10gPSAxODg3OwogIHRbMzEyOF0gPSAxODg3OwogIHRbMzEzMV0gPSAxODg4OwogIHRbMzEzMl0gPSAxODg4OwogIHRbMzEzNV0gPSAxODg5OwogIHRbMzEzNl0gPSAxODg5OwogIHRbMzEzOV0gPSAxODkwOwogIHRbMzE0MF0gPSAxODkwOwogIHRbMzE0M10gPSAxODkxOwogIHRbMzE0NF0gPSAxODkxOwogIHRbMzE0N10gPSAxODkyOwogIHRbMzE0OF0gPSAxODkyOwogIHRbMzE1M10gPSA1ODA7CiAgdFszMTU0XSA9IDU4MTsKICB0WzMxNTddID0gNTg0OwogIHRbMzE1OF0gPSA1ODU7CiAgdFszMTYxXSA9IDU4ODsKICB0WzMxNjJdID0gNTg5OwogIHRbMzE2NV0gPSA4OTE7CiAgdFszMTY2XSA9IDg5MjsKICB0WzMxNjldID0gMTI3NDsKICB0WzMxNzBdID0gMTI3NTsKICB0WzMxNzNdID0gMTI3ODsKICB0WzMxNzRdID0gMTI3OTsKICB0WzMxODFdID0gNzYyMjsKICB0WzMxODJdID0gNzYyMzsKICB0WzMyODJdID0gMTE3OTk7CiAgdFszMzE2XSA9IDU3ODsKICB0WzMzNzldID0gNDI3ODU7CiAgdFszMzkzXSA9IDExNTk7CiAgdFszNDE2XSA9IDgzNzc7Cn0pOwpleHBvcnRzLmdldEdseXBoTWFwRm9yU3RhbmRhcmRGb250cyA9IGdldEdseXBoTWFwRm9yU3RhbmRhcmRGb250czsKY29uc3QgZ2V0U3VwcGxlbWVudGFsR2x5cGhNYXBGb3JBcmlhbEJsYWNrID0gKDAsIF9jb3JlX3V0aWxzLmdldExvb2t1cFRhYmxlRmFjdG9yeSkoZnVuY3Rpb24gKHQpIHsKICB0WzIyN10gPSAzMjI7CiAgdFsyNjRdID0gMjYxOwogIHRbMjkxXSA9IDM0NjsKfSk7CmV4cG9ydHMuZ2V0U3VwcGxlbWVudGFsR2x5cGhNYXBGb3JBcmlhbEJsYWNrID0gZ2V0U3VwcGxlbWVudGFsR2x5cGhNYXBGb3JBcmlhbEJsYWNrOwpjb25zdCBnZXRTdXBwbGVtZW50YWxHbHlwaE1hcEZvckNhbGlicmkgPSAoMCwgX2NvcmVfdXRpbHMuZ2V0TG9va3VwVGFibGVGYWN0b3J5KShmdW5jdGlvbiAodCkgewogIHRbMV0gPSAzMjsKICB0WzRdID0gNjU7CiAgdFs1XSA9IDE5MjsKICB0WzZdID0gMTkzOwogIHRbOV0gPSAxOTY7CiAgdFsxN10gPSA2NjsKICB0WzE4XSA9IDY3OwogIHRbMjFdID0gMjY4OwogIHRbMjRdID0gNjg7CiAgdFsyOF0gPSA2OTsKICB0WzI5XSA9IDIwMDsKICB0WzMwXSA9IDIwMTsKICB0WzMyXSA9IDI4MjsKICB0WzM4XSA9IDcwOwogIHRbMzldID0gNzE7CiAgdFs0NF0gPSA3MjsKICB0WzQ3XSA9IDczOwogIHRbNDhdID0gMjA0OwogIHRbNDldID0gMjA1OwogIHRbNThdID0gNzQ7CiAgdFs2MF0gPSA3NTsKICB0WzYyXSA9IDc2OwogIHRbNjhdID0gNzc7CiAgdFs2OV0gPSA3ODsKICB0Wzc1XSA9IDc5OwogIHRbNzZdID0gMjEwOwogIHRbODBdID0gMjE0OwogIHRbODddID0gODA7CiAgdFs4OV0gPSA4MTsKICB0WzkwXSA9IDgyOwogIHRbOTJdID0gMzQ0OwogIHRbOTRdID0gODM7CiAgdFs5N10gPSAzNTI7CiAgdFsxMDBdID0gODQ7CiAgdFsxMDRdID0gODU7CiAgdFsxMDldID0gMjIwOwogIHRbMTE1XSA9IDg2OwogIHRbMTE2XSA9IDg3OwogIHRbMTIxXSA9IDg4OwogIHRbMTIyXSA9IDg5OwogIHRbMTI0XSA9IDIyMTsKICB0WzEyN10gPSA5MDsKICB0WzEyOV0gPSAzODE7CiAgdFsyNThdID0gOTc7CiAgdFsyNTldID0gMjI0OwogIHRbMjYwXSA9IDIyNTsKICB0WzI2M10gPSAyMjg7CiAgdFsyNjhdID0gMjYxOwogIHRbMjcxXSA9IDk4OwogIHRbMjcyXSA9IDk5OwogIHRbMjczXSA9IDI2MzsKICB0WzI3NV0gPSAyNjk7CiAgdFsyODJdID0gMTAwOwogIHRbMjg2XSA9IDEwMTsKICB0WzI4N10gPSAyMzI7CiAgdFsyODhdID0gMjMzOwogIHRbMjkwXSA9IDI4MzsKICB0WzI5NV0gPSAyODE7CiAgdFsyOTZdID0gMTAyOwogIHRbMzM2XSA9IDEwMzsKICB0WzM0Nl0gPSAxMDQ7CiAgdFszNDldID0gMTA1OwogIHRbMzUwXSA9IDIzNjsKICB0WzM1MV0gPSAyMzc7CiAgdFszNjFdID0gMTA2OwogIHRbMzY0XSA9IDEwNzsKICB0WzM2N10gPSAxMDg7CiAgdFszNzFdID0gMzIyOwogIHRbMzczXSA9IDEwOTsKICB0WzM3NF0gPSAxMTA7CiAgdFszODFdID0gMTExOwogIHRbMzgyXSA9IDI0MjsKICB0WzM4M10gPSAyNDM7CiAgdFszODZdID0gMjQ2OwogIHRbMzkzXSA9IDExMjsKICB0WzM5NV0gPSAxMTM7CiAgdFszOTZdID0gMTE0OwogIHRbMzk4XSA9IDM0NTsKICB0WzQwMF0gPSAxMTU7CiAgdFs0MDFdID0gMzQ3OwogIHRbNDAzXSA9IDM1MzsKICB0WzQxMF0gPSAxMTY7CiAgdFs0MzddID0gMTE3OwogIHRbNDQyXSA9IDI1MjsKICB0WzQ0OF0gPSAxMTg7CiAgdFs0NDldID0gMTE5OwogIHRbNDU0XSA9IDEyMDsKICB0WzQ1NV0gPSAxMjE7CiAgdFs0NTddID0gMjUzOwogIHRbNDYwXSA9IDEyMjsKICB0WzQ2Ml0gPSAzODI7CiAgdFs0NjNdID0gMzgwOwogIHRbODUzXSA9IDQ0OwogIHRbODU1XSA9IDU4OwogIHRbODU2XSA9IDQ2OwogIHRbODc2XSA9IDQ3OwogIHRbODc4XSA9IDQ1OwogIHRbODgyXSA9IDQ1OwogIHRbODk0XSA9IDQwOwogIHRbODk1XSA9IDQxOwogIHRbODk2XSA9IDkxOwogIHRbODk3XSA9IDkzOwogIHRbOTIzXSA9IDY0OwogIHRbMTAwNF0gPSA0ODsKICB0WzEwMDVdID0gNDk7CiAgdFsxMDA2XSA9IDUwOwogIHRbMTAwN10gPSA1MTsKICB0WzEwMDhdID0gNTI7CiAgdFsxMDA5XSA9IDUzOwogIHRbMTAxMF0gPSA1NDsKICB0WzEwMTFdID0gNTU7CiAgdFsxMDEyXSA9IDU2OwogIHRbMTAxM10gPSA1NzsKICB0WzEwODFdID0gMzc7CiAgdFsxMDg1XSA9IDQzOwogIHRbMTA4Nl0gPSA0NTsKfSk7CmV4cG9ydHMuZ2V0U3VwcGxlbWVudGFsR2x5cGhNYXBGb3JDYWxpYnJpID0gZ2V0U3VwcGxlbWVudGFsR2x5cGhNYXBGb3JDYWxpYnJpOwpmdW5jdGlvbiBnZXRTdGFuZGFyZEZvbnROYW1lKG5hbWUpIHsKICBjb25zdCBmb250TmFtZSA9ICgwLCBfZm9udHNfdXRpbHMubm9ybWFsaXplRm9udE5hbWUpKG5hbWUpOwogIGNvbnN0IHN0ZEZvbnRNYXAgPSBnZXRTdGRGb250TWFwKCk7CiAgcmV0dXJuIHN0ZEZvbnRNYXBbZm9udE5hbWVdOwp9CmZ1bmN0aW9uIGlzS25vd25Gb250TmFtZShuYW1lKSB7CiAgY29uc3QgZm9udE5hbWUgPSAoMCwgX2ZvbnRzX3V0aWxzLm5vcm1hbGl6ZUZvbnROYW1lKShuYW1lKTsKICByZXR1cm4gISEoZ2V0U3RkRm9udE1hcCgpW2ZvbnROYW1lXSB8fCBnZXROb25TdGRGb250TWFwKClbZm9udE5hbWVdIHx8IGdldFNlcmlmRm9udHMoKVtmb250TmFtZV0gfHwgZ2V0U3ltYm9sc0ZvbnRzKClbZm9udE5hbWVdKTsKfQoKLyoqKi8gfSksCi8qIDQyICovCi8qKiovICgoX191bnVzZWRfd2VicGFja19tb2R1bGUsIGV4cG9ydHMsIF9fd19wZGZqc19yZXF1aXJlX18pID0+IHsKCgoKT2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsICJfX2VzTW9kdWxlIiwgKHsKICB2YWx1ZTogdHJ1ZQp9KSk7CmV4cG9ydHMuVG9Vbmljb2RlTWFwID0gZXhwb3J0cy5JZGVudGl0eVRvVW5pY29kZU1hcCA9IHZvaWQgMDsKdmFyIF91dGlsID0gX193X3BkZmpzX3JlcXVpcmVfXygyKTsKY2xhc3MgVG9Vbmljb2RlTWFwIHsKICBjb25zdHJ1Y3RvcihjbWFwID0gW10pIHsKICAgIHRoaXMuX21hcCA9IGNtYXA7CiAgfQogIGdldCBsZW5ndGgoKSB7CiAgICByZXR1cm4gdGhpcy5fbWFwLmxlbmd0aDsKICB9CiAgZm9yRWFjaChjYWxsYmFjaykgewogICAgZm9yIChjb25zdCBjaGFyQ29kZSBpbiB0aGlzLl9tYXApIHsKICAgICAgY2FsbGJhY2soY2hhckNvZGUsIHRoaXMuX21hcFtjaGFyQ29kZV0uY2hhckNvZGVBdCgwKSk7CiAgICB9CiAgfQogIGhhcyhpKSB7CiAgICByZXR1cm4gdGhpcy5fbWFwW2ldICE9PSB1bmRlZmluZWQ7CiAgfQogIGdldChpKSB7CiAgICByZXR1cm4gdGhpcy5fbWFwW2ldOwogIH0KICBjaGFyQ29kZU9mKHZhbHVlKSB7CiAgICBjb25zdCBtYXAgPSB0aGlzLl9tYXA7CiAgICBpZiAobWFwLmxlbmd0aCA8PSAweDEwMDAwKSB7CiAgICAgIHJldHVybiBtYXAuaW5kZXhPZih2YWx1ZSk7CiAgICB9CiAgICBmb3IgKGNvbnN0IGNoYXJDb2RlIGluIG1hcCkgewogICAgICBpZiAobWFwW2NoYXJDb2RlXSA9PT0gdmFsdWUpIHsKICAgICAgICByZXR1cm4gY2hhckNvZGUgfCAwOwogICAgICB9CiAgICB9CiAgICByZXR1cm4gLTE7CiAgfQogIGFtZW5kKG1hcCkgewogICAgZm9yIChjb25zdCBjaGFyQ29kZSBpbiBtYXApIHsKICAgICAgdGhpcy5fbWFwW2NoYXJDb2RlXSA9IG1hcFtjaGFyQ29kZV07CiAgICB9CiAgfQp9CmV4cG9ydHMuVG9Vbmljb2RlTWFwID0gVG9Vbmljb2RlTWFwOwpjbGFzcyBJZGVudGl0eVRvVW5pY29kZU1hcCB7CiAgY29uc3RydWN0b3IoZmlyc3RDaGFyLCBsYXN0Q2hhcikgewogICAgdGhpcy5maXJzdENoYXIgPSBmaXJzdENoYXI7CiAgICB0aGlzLmxhc3RDaGFyID0gbGFzdENoYXI7CiAgfQogIGdldCBsZW5ndGgoKSB7CiAgICByZXR1cm4gdGhpcy5sYXN0Q2hhciArIDEgLSB0aGlzLmZpcnN0Q2hhcjsKICB9CiAgZm9yRWFjaChjYWxsYmFjaykgewogICAgZm9yIChsZXQgaSA9IHRoaXMuZmlyc3RDaGFyLCBpaSA9IHRoaXMubGFzdENoYXI7IGkgPD0gaWk7IGkrKykgewogICAgICBjYWxsYmFjayhpLCBpKTsKICAgIH0KICB9CiAgaGFzKGkpIHsKICAgIHJldHVybiB0aGlzLmZpcnN0Q2hhciA8PSBpICYmIGkgPD0gdGhpcy5sYXN0Q2hhcjsKICB9CiAgZ2V0KGkpIHsKICAgIGlmICh0aGlzLmZpcnN0Q2hhciA8PSBpICYmIGkgPD0gdGhpcy5sYXN0Q2hhcikgewogICAgICByZXR1cm4gU3RyaW5nLmZyb21DaGFyQ29kZShpKTsKICAgIH0KICAgIHJldHVybiB1bmRlZmluZWQ7CiAgfQogIGNoYXJDb2RlT2YodikgewogICAgcmV0dXJuIE51bWJlci5pc0ludGVnZXIodikgJiYgdiA+PSB0aGlzLmZpcnN0Q2hhciAmJiB2IDw9IHRoaXMubGFzdENoYXIgPyB2IDogLTE7CiAgfQogIGFtZW5kKG1hcCkgewogICAgKDAsIF91dGlsLnVucmVhY2hhYmxlKSgiU2hvdWxkIG5vdCBjYWxsIGFtZW5kKCkiKTsKICB9Cn0KZXhwb3J0cy5JZGVudGl0eVRvVW5pY29kZU1hcCA9IElkZW50aXR5VG9Vbmljb2RlTWFwOwoKLyoqKi8gfSksCi8qIDQzICovCi8qKiovICgoX191bnVzZWRfd2VicGFja19tb2R1bGUsIGV4cG9ydHMsIF9fd19wZGZqc19yZXF1aXJlX18pID0+IHsKCgoKT2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsICJfX2VzTW9kdWxlIiwgKHsKICB2YWx1ZTogdHJ1ZQp9KSk7CmV4cG9ydHMuQ0ZGRm9udCA9IHZvaWQgMDsKdmFyIF9jZmZfcGFyc2VyID0gX193X3BkZmpzX3JlcXVpcmVfXygzNSk7CnZhciBfZm9udHNfdXRpbHMgPSBfX3dfcGRmanNfcmVxdWlyZV9fKDM4KTsKdmFyIF91dGlsID0gX193X3BkZmpzX3JlcXVpcmVfXygyKTsKY2xhc3MgQ0ZGRm9udCB7CiAgY29uc3RydWN0b3IoZmlsZSwgcHJvcGVydGllcykgewogICAgdGhpcy5wcm9wZXJ0aWVzID0gcHJvcGVydGllczsKICAgIGNvbnN0IHBhcnNlciA9IG5ldyBfY2ZmX3BhcnNlci5DRkZQYXJzZXIoZmlsZSwgcHJvcGVydGllcywgX2ZvbnRzX3V0aWxzLlNFQUNfQU5BTFlTSVNfRU5BQkxFRCk7CiAgICB0aGlzLmNmZiA9IHBhcnNlci5wYXJzZSgpOwogICAgdGhpcy5jZmYuZHVwbGljYXRlRmlyc3RHbHlwaCgpOwogICAgY29uc3QgY29tcGlsZXIgPSBuZXcgX2NmZl9wYXJzZXIuQ0ZGQ29tcGlsZXIodGhpcy5jZmYpOwogICAgdGhpcy5zZWFjcyA9IHRoaXMuY2ZmLnNlYWNzOwogICAgdHJ5IHsKICAgICAgdGhpcy5kYXRhID0gY29tcGlsZXIuY29tcGlsZSgpOwogICAgfSBjYXRjaCB7CiAgICAgICgwLCBfdXRpbC53YXJuKSgiRmFpbGVkIHRvIGNvbXBpbGUgZm9udCAiICsgcHJvcGVydGllcy5sb2FkZWROYW1lKTsKICAgICAgdGhpcy5kYXRhID0gZmlsZTsKICAgIH0KICAgIHRoaXMuX2NyZWF0ZUJ1aWx0SW5FbmNvZGluZygpOwogIH0KICBnZXQgbnVtR2x5cGhzKCkgewogICAgcmV0dXJuIHRoaXMuY2ZmLmNoYXJTdHJpbmdzLmNvdW50OwogIH0KICBnZXRDaGFyc2V0KCkgewogICAgcmV0dXJuIHRoaXMuY2ZmLmNoYXJzZXQuY2hhcnNldDsKICB9CiAgZ2V0R2x5cGhNYXBwaW5nKCkgewogICAgY29uc3QgY2ZmID0gdGhpcy5jZmY7CiAgICBjb25zdCBwcm9wZXJ0aWVzID0gdGhpcy5wcm9wZXJ0aWVzOwogICAgY29uc3QgewogICAgICBjaWRUb0dpZE1hcCwKICAgICAgY01hcAogICAgfSA9IHByb3BlcnRpZXM7CiAgICBjb25zdCBjaGFyc2V0cyA9IGNmZi5jaGFyc2V0LmNoYXJzZXQ7CiAgICBsZXQgY2hhckNvZGVUb0dseXBoSWQ7CiAgICBsZXQgZ2x5cGhJZDsKICAgIGlmIChwcm9wZXJ0aWVzLmNvbXBvc2l0ZSkgewogICAgICBsZXQgaW52Q2lkVG9HaWRNYXA7CiAgICAgIGlmIChjaWRUb0dpZE1hcD8ubGVuZ3RoID4gMCkgewogICAgICAgIGludkNpZFRvR2lkTWFwID0gT2JqZWN0LmNyZWF0ZShudWxsKTsKICAgICAgICBmb3IgKGxldCBpID0gMCwgaWkgPSBjaWRUb0dpZE1hcC5sZW5ndGg7IGkgPCBpaTsgaSsrKSB7CiAgICAgICAgICBjb25zdCBnaWQgPSBjaWRUb0dpZE1hcFtpXTsKICAgICAgICAgIGlmIChnaWQgIT09IHVuZGVmaW5lZCkgewogICAgICAgICAgICBpbnZDaWRUb0dpZE1hcFtnaWRdID0gaTsKICAgICAgICAgIH0KICAgICAgICB9CiAgICAgIH0KICAgICAgY2hhckNvZGVUb0dseXBoSWQgPSBPYmplY3QuY3JlYXRlKG51bGwpOwogICAgICBsZXQgY2hhckNvZGU7CiAgICAgIGlmIChjZmYuaXNDSURGb250KSB7CiAgICAgICAgZm9yIChnbHlwaElkID0gMDsgZ2x5cGhJZCA8IGNoYXJzZXRzLmxlbmd0aDsgZ2x5cGhJZCsrKSB7CiAgICAgICAgICBjb25zdCBjaWQgPSBjaGFyc2V0c1tnbHlwaElkXTsKICAgICAgICAgIGNoYXJDb2RlID0gY01hcC5jaGFyQ29kZU9mKGNpZCk7CiAgICAgICAgICBpZiAoaW52Q2lkVG9HaWRNYXA/LltjaGFyQ29kZV0gIT09IHVuZGVmaW5lZCkgewogICAgICAgICAgICBjaGFyQ29kZSA9IGludkNpZFRvR2lkTWFwW2NoYXJDb2RlXTsKICAgICAgICAgIH0KICAgICAgICAgIGNoYXJDb2RlVG9HbHlwaElkW2NoYXJDb2RlXSA9IGdseXBoSWQ7CiAgICAgICAgfQogICAgICB9IGVsc2UgewogICAgICAgIGZvciAoZ2x5cGhJZCA9IDA7IGdseXBoSWQgPCBjZmYuY2hhclN0cmluZ3MuY291bnQ7IGdseXBoSWQrKykgewogICAgICAgICAgY2hhckNvZGUgPSBjTWFwLmNoYXJDb2RlT2YoZ2x5cGhJZCk7CiAgICAgICAgICBjaGFyQ29kZVRvR2x5cGhJZFtjaGFyQ29kZV0gPSBnbHlwaElkOwogICAgICAgIH0KICAgICAgfQogICAgICByZXR1cm4gY2hhckNvZGVUb0dseXBoSWQ7CiAgICB9CiAgICBsZXQgZW5jb2RpbmcgPSBjZmYuZW5jb2RpbmcgPyBjZmYuZW5jb2RpbmcuZW5jb2RpbmcgOiBudWxsOwogICAgaWYgKHByb3BlcnRpZXMuaXNJbnRlcm5hbEZvbnQpIHsKICAgICAgZW5jb2RpbmcgPSBwcm9wZXJ0aWVzLmRlZmF1bHRFbmNvZGluZzsKICAgIH0KICAgIGNoYXJDb2RlVG9HbHlwaElkID0gKDAsIF9mb250c191dGlscy50eXBlMUZvbnRHbHlwaE1hcHBpbmcpKHByb3BlcnRpZXMsIGVuY29kaW5nLCBjaGFyc2V0cyk7CiAgICByZXR1cm4gY2hhckNvZGVUb0dseXBoSWQ7CiAgfQogIGhhc0dseXBoSWQoaWQpIHsKICAgIHJldHVybiB0aGlzLmNmZi5oYXNHbHlwaElkKGlkKTsKICB9CiAgX2NyZWF0ZUJ1aWx0SW5FbmNvZGluZygpIHsKICAgIGNvbnN0IHsKICAgICAgY2hhcnNldCwKICAgICAgZW5jb2RpbmcKICAgIH0gPSB0aGlzLmNmZjsKICAgIGlmICghY2hhcnNldCB8fCAhZW5jb2RpbmcpIHsKICAgICAgcmV0dXJuOwogICAgfQogICAgY29uc3QgY2hhcnNldHMgPSBjaGFyc2V0LmNoYXJzZXQsCiAgICAgIGVuY29kaW5ncyA9IGVuY29kaW5nLmVuY29kaW5nOwogICAgY29uc3QgbWFwID0gW107CiAgICBmb3IgKGNvbnN0IGNoYXJDb2RlIGluIGVuY29kaW5ncykgewogICAgICBjb25zdCBnbHlwaElkID0gZW5jb2RpbmdzW2NoYXJDb2RlXTsKICAgICAgaWYgKGdseXBoSWQgPj0gMCkgewogICAgICAgIGNvbnN0IGdseXBoTmFtZSA9IGNoYXJzZXRzW2dseXBoSWRdOwogICAgICAgIGlmIChnbHlwaE5hbWUpIHsKICAgICAgICAgIG1hcFtjaGFyQ29kZV0gPSBnbHlwaE5hbWU7CiAgICAgICAgfQogICAgICB9CiAgICB9CiAgICBpZiAobWFwLmxlbmd0aCA+IDApIHsKICAgICAgdGhpcy5wcm9wZXJ0aWVzLmJ1aWx0SW5FbmNvZGluZyA9IG1hcDsKICAgIH0KICB9Cn0KZXhwb3J0cy5DRkZGb250ID0gQ0ZGRm9udDsKCi8qKiovIH0pLAovKiA0NCAqLwovKioqLyAoKF9fdW51c2VkX3dlYnBhY2tfbW9kdWxlLCBleHBvcnRzLCBfX3dfcGRmanNfcmVxdWlyZV9fKSA9PiB7CgoKCk9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCAiX19lc01vZHVsZSIsICh7CiAgdmFsdWU6IHRydWUKfSkpOwpleHBvcnRzLkZvbnRSZW5kZXJlckZhY3RvcnkgPSB2b2lkIDA7CnZhciBfdXRpbCA9IF9fd19wZGZqc19yZXF1aXJlX18oMik7CnZhciBfY2ZmX3BhcnNlciA9IF9fd19wZGZqc19yZXF1aXJlX18oMzUpOwp2YXIgX2dseXBobGlzdCA9IF9fd19wZGZqc19yZXF1aXJlX18oMzkpOwp2YXIgX2VuY29kaW5ncyA9IF9fd19wZGZqc19yZXF1aXJlX18oMzcpOwp2YXIgX3N0cmVhbSA9IF9fd19wZGZqc19yZXF1aXJlX18oOCk7CmZ1bmN0aW9uIGdldFVpbnQzMihkYXRhLCBvZmZzZXQpIHsKICByZXR1cm4gKGRhdGFbb2Zmc2V0XSA8PCAyNCB8IGRhdGFbb2Zmc2V0ICsgMV0gPDwgMTYgfCBkYXRhW29mZnNldCArIDJdIDw8IDggfCBkYXRhW29mZnNldCArIDNdKSA+Pj4gMDsKfQpmdW5jdGlvbiBnZXRVaW50MTYoZGF0YSwgb2Zmc2V0KSB7CiAgcmV0dXJuIGRhdGFbb2Zmc2V0XSA8PCA4IHwgZGF0YVtvZmZzZXQgKyAxXTsKfQpmdW5jdGlvbiBnZXRJbnQxNihkYXRhLCBvZmZzZXQpIHsKICByZXR1cm4gKGRhdGFbb2Zmc2V0XSA8PCAyNCB8IGRhdGFbb2Zmc2V0ICsgMV0gPDwgMTYpID4+IDE2Owp9CmZ1bmN0aW9uIGdldEludDgoZGF0YSwgb2Zmc2V0KSB7CiAgcmV0dXJuIGRhdGFbb2Zmc2V0XSA8PCAyNCA+PiAyNDsKfQpmdW5jdGlvbiBnZXRGbG9hdDIxNChkYXRhLCBvZmZzZXQpIHsKICByZXR1cm4gZ2V0SW50MTYoZGF0YSwgb2Zmc2V0KSAvIDE2Mzg0Owp9CmZ1bmN0aW9uIGdldFN1YnJvdXRpbmVCaWFzKHN1YnJzKSB7CiAgY29uc3QgbnVtU3VicnMgPSBzdWJycy5sZW5ndGg7CiAgbGV0IGJpYXMgPSAzMjc2ODsKICBpZiAobnVtU3VicnMgPCAxMjQwKSB7CiAgICBiaWFzID0gMTA3OwogIH0gZWxzZSBpZiAobnVtU3VicnMgPCAzMzkwMCkgewogICAgYmlhcyA9IDExMzE7CiAgfQogIHJldHVybiBiaWFzOwp9CmZ1bmN0aW9uIHBhcnNlQ21hcChkYXRhLCBzdGFydCwgZW5kKSB7CiAgY29uc3Qgb2Zmc2V0ID0gZ2V0VWludDE2KGRhdGEsIHN0YXJ0ICsgMikgPT09IDEgPyBnZXRVaW50MzIoZGF0YSwgc3RhcnQgKyA4KSA6IGdldFVpbnQzMihkYXRhLCBzdGFydCArIDE2KTsKICBjb25zdCBmb3JtYXQgPSBnZXRVaW50MTYoZGF0YSwgc3RhcnQgKyBvZmZzZXQpOwogIGxldCByYW5nZXMsIHAsIGk7CiAgaWYgKGZvcm1hdCA9PT0gNCkgewogICAgZ2V0VWludDE2KGRhdGEsIHN0YXJ0ICsgb2Zmc2V0ICsgMik7CiAgICBjb25zdCBzZWdDb3VudCA9IGdldFVpbnQxNihkYXRhLCBzdGFydCArIG9mZnNldCArIDYpID4+IDE7CiAgICBwID0gc3RhcnQgKyBvZmZzZXQgKyAxNDsKICAgIHJhbmdlcyA9IFtdOwogICAgZm9yIChpID0gMDsgaSA8IHNlZ0NvdW50OyBpKyssIHAgKz0gMikgewogICAgICByYW5nZXNbaV0gPSB7CiAgICAgICAgZW5kOiBnZXRVaW50MTYoZGF0YSwgcCkKICAgICAgfTsKICAgIH0KICAgIHAgKz0gMjsKICAgIGZvciAoaSA9IDA7IGkgPCBzZWdDb3VudDsgaSsrLCBwICs9IDIpIHsKICAgICAgcmFuZ2VzW2ldLnN0YXJ0ID0gZ2V0VWludDE2KGRhdGEsIHApOwogICAgfQogICAgZm9yIChpID0gMDsgaSA8IHNlZ0NvdW50OyBpKyssIHAgKz0gMikgewogICAgICByYW5nZXNbaV0uaWREZWx0YSA9IGdldFVpbnQxNihkYXRhLCBwKTsKICAgIH0KICAgIGZvciAoaSA9IDA7IGkgPCBzZWdDb3VudDsgaSsrLCBwICs9IDIpIHsKICAgICAgbGV0IGlkT2Zmc2V0ID0gZ2V0VWludDE2KGRhdGEsIHApOwogICAgICBpZiAoaWRPZmZzZXQgPT09IDApIHsKICAgICAgICBjb250aW51ZTsKICAgICAgfQogICAgICByYW5nZXNbaV0uaWRzID0gW107CiAgICAgIGZvciAobGV0IGogPSAwLCBqaiA9IHJhbmdlc1tpXS5lbmQgLSByYW5nZXNbaV0uc3RhcnQgKyAxOyBqIDwgamo7IGorKykgewogICAgICAgIHJhbmdlc1tpXS5pZHNbal0gPSBnZXRVaW50MTYoZGF0YSwgcCArIGlkT2Zmc2V0KTsKICAgICAgICBpZE9mZnNldCArPSAyOwogICAgICB9CiAgICB9CiAgICByZXR1cm4gcmFuZ2VzOwogIH0gZWxzZSBpZiAoZm9ybWF0ID09PSAxMikgewogICAgY29uc3QgZ3JvdXBzID0gZ2V0VWludDMyKGRhdGEsIHN0YXJ0ICsgb2Zmc2V0ICsgMTIpOwogICAgcCA9IHN0YXJ0ICsgb2Zmc2V0ICsgMTY7CiAgICByYW5nZXMgPSBbXTsKICAgIGZvciAoaSA9IDA7IGkgPCBncm91cHM7IGkrKykgewogICAgICBzdGFydCA9IGdldFVpbnQzMihkYXRhLCBwKTsKICAgICAgcmFuZ2VzLnB1c2goewogICAgICAgIHN0YXJ0LAogICAgICAgIGVuZDogZ2V0VWludDMyKGRhdGEsIHAgKyA0KSwKICAgICAgICBpZERlbHRhOiBnZXRVaW50MzIoZGF0YSwgcCArIDgpIC0gc3RhcnQKICAgICAgfSk7CiAgICAgIHAgKz0gMTI7CiAgICB9CiAgICByZXR1cm4gcmFuZ2VzOwogIH0KICB0aHJvdyBuZXcgX3V0aWwuRm9ybWF0RXJyb3IoYHVuc3VwcG9ydGVkIGNtYXA6ICR7Zm9ybWF0fWApOwp9CmZ1bmN0aW9uIHBhcnNlQ2ZmKGRhdGEsIHN0YXJ0LCBlbmQsIHNlYWNBbmFseXNpc0VuYWJsZWQpIHsKICBjb25zdCBwcm9wZXJ0aWVzID0ge307CiAgY29uc3QgcGFyc2VyID0gbmV3IF9jZmZfcGFyc2VyLkNGRlBhcnNlcihuZXcgX3N0cmVhbS5TdHJlYW0oZGF0YSwgc3RhcnQsIGVuZCAtIHN0YXJ0KSwgcHJvcGVydGllcywgc2VhY0FuYWx5c2lzRW5hYmxlZCk7CiAgY29uc3QgY2ZmID0gcGFyc2VyLnBhcnNlKCk7CiAgcmV0dXJuIHsKICAgIGdseXBoczogY2ZmLmNoYXJTdHJpbmdzLm9iamVjdHMsCiAgICBzdWJyczogY2ZmLnRvcERpY3QucHJpdmF0ZURpY3Q/LnN1YnJzSW5kZXg/Lm9iamVjdHMsCiAgICBnc3VicnM6IGNmZi5nbG9iYWxTdWJySW5kZXg/Lm9iamVjdHMsCiAgICBpc0NGRkNJREZvbnQ6IGNmZi5pc0NJREZvbnQsCiAgICBmZFNlbGVjdDogY2ZmLmZkU2VsZWN0LAogICAgZmRBcnJheTogY2ZmLmZkQXJyYXkKICB9Owp9CmZ1bmN0aW9uIHBhcnNlR2x5ZlRhYmxlKGdseWYsIGxvY2EsIGlzR2x5cGhMb2NhdGlvbnNMb25nKSB7CiAgbGV0IGl0ZW1TaXplLCBpdGVtRGVjb2RlOwogIGlmIChpc0dseXBoTG9jYXRpb25zTG9uZykgewogICAgaXRlbVNpemUgPSA0OwogICAgaXRlbURlY29kZSA9IGdldFVpbnQzMjsKICB9IGVsc2UgewogICAgaXRlbVNpemUgPSAyOwogICAgaXRlbURlY29kZSA9IChkYXRhLCBvZmZzZXQpID0+IDIgKiBnZXRVaW50MTYoZGF0YSwgb2Zmc2V0KTsKICB9CiAgY29uc3QgZ2x5cGhzID0gW107CiAgbGV0IHN0YXJ0T2Zmc2V0ID0gaXRlbURlY29kZShsb2NhLCAwKTsKICBmb3IgKGxldCBqID0gaXRlbVNpemU7IGogPCBsb2NhLmxlbmd0aDsgaiArPSBpdGVtU2l6ZSkgewogICAgY29uc3QgZW5kT2Zmc2V0ID0gaXRlbURlY29kZShsb2NhLCBqKTsKICAgIGdseXBocy5wdXNoKGdseWYuc3ViYXJyYXkoc3RhcnRPZmZzZXQsIGVuZE9mZnNldCkpOwogICAgc3RhcnRPZmZzZXQgPSBlbmRPZmZzZXQ7CiAgfQogIHJldHVybiBnbHlwaHM7Cn0KZnVuY3Rpb24gbG9va3VwQ21hcChyYW5nZXMsIHVuaWNvZGUpIHsKICBjb25zdCBjb2RlID0gdW5pY29kZS5jb2RlUG9pbnRBdCgwKTsKICBsZXQgZ2lkID0gMCwKICAgIGwgPSAwLAogICAgciA9IHJhbmdlcy5sZW5ndGggLSAxOwogIHdoaWxlIChsIDwgcikgewogICAgY29uc3QgYyA9IGwgKyByICsgMSA+PiAxOwogICAgaWYgKGNvZGUgPCByYW5nZXNbY10uc3RhcnQpIHsKICAgICAgciA9IGMgLSAxOwogICAgfSBlbHNlIHsKICAgICAgbCA9IGM7CiAgICB9CiAgfQogIGlmIChyYW5nZXNbbF0uc3RhcnQgPD0gY29kZSAmJiBjb2RlIDw9IHJhbmdlc1tsXS5lbmQpIHsKICAgIGdpZCA9IHJhbmdlc1tsXS5pZERlbHRhICsgKHJhbmdlc1tsXS5pZHMgPyByYW5nZXNbbF0uaWRzW2NvZGUgLSByYW5nZXNbbF0uc3RhcnRdIDogY29kZSkgJiAweGZmZmY7CiAgfQogIHJldHVybiB7CiAgICBjaGFyQ29kZTogY29kZSwKICAgIGdseXBoSWQ6IGdpZAogIH07Cn0KZnVuY3Rpb24gY29tcGlsZUdseWYoY29kZSwgY21kcywgZm9udCkgewogIGZ1bmN0aW9uIG1vdmVUbyh4LCB5KSB7CiAgICBjbWRzLnB1c2goewogICAgICBjbWQ6ICJtb3ZlVG8iLAogICAgICBhcmdzOiBbeCwgeV0KICAgIH0pOwogIH0KICBmdW5jdGlvbiBsaW5lVG8oeCwgeSkgewogICAgY21kcy5wdXNoKHsKICAgICAgY21kOiAibGluZVRvIiwKICAgICAgYXJnczogW3gsIHldCiAgICB9KTsKICB9CiAgZnVuY3Rpb24gcXVhZHJhdGljQ3VydmVUbyh4YSwgeWEsIHgsIHkpIHsKICAgIGNtZHMucHVzaCh7CiAgICAgIGNtZDogInF1YWRyYXRpY0N1cnZlVG8iLAogICAgICBhcmdzOiBbeGEsIHlhLCB4LCB5XQogICAgfSk7CiAgfQogIGxldCBpID0gMDsKICBjb25zdCBudW1iZXJPZkNvbnRvdXJzID0gZ2V0SW50MTYoY29kZSwgaSk7CiAgbGV0IGZsYWdzOwogIGxldCB4ID0gMCwKICAgIHkgPSAwOwogIGkgKz0gMTA7CiAgaWYgKG51bWJlck9mQ29udG91cnMgPCAwKSB7CiAgICBkbyB7CiAgICAgIGZsYWdzID0gZ2V0VWludDE2KGNvZGUsIGkpOwogICAgICBjb25zdCBnbHlwaEluZGV4ID0gZ2V0VWludDE2KGNvZGUsIGkgKyAyKTsKICAgICAgaSArPSA0OwogICAgICBsZXQgYXJnMSwgYXJnMjsKICAgICAgaWYgKGZsYWdzICYgMHgwMSkgewogICAgICAgIGlmIChmbGFncyAmIDB4MDIpIHsKICAgICAgICAgIGFyZzEgPSBnZXRJbnQxNihjb2RlLCBpKTsKICAgICAgICAgIGFyZzIgPSBnZXRJbnQxNihjb2RlLCBpICsgMik7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIGFyZzEgPSBnZXRVaW50MTYoY29kZSwgaSk7CiAgICAgICAgICBhcmcyID0gZ2V0VWludDE2KGNvZGUsIGkgKyAyKTsKICAgICAgICB9CiAgICAgICAgaSArPSA0OwogICAgICB9IGVsc2UgaWYgKGZsYWdzICYgMHgwMikgewogICAgICAgIGFyZzEgPSBnZXRJbnQ4KGNvZGUsIGkrKyk7CiAgICAgICAgYXJnMiA9IGdldEludDgoY29kZSwgaSsrKTsKICAgICAgfSBlbHNlIHsKICAgICAgICBhcmcxID0gY29kZVtpKytdOwogICAgICAgIGFyZzIgPSBjb2RlW2krK107CiAgICAgIH0KICAgICAgaWYgKGZsYWdzICYgMHgwMikgewogICAgICAgIHggPSBhcmcxOwogICAgICAgIHkgPSBhcmcyOwogICAgICB9IGVsc2UgewogICAgICAgIHggPSAwOwogICAgICAgIHkgPSAwOwogICAgICB9CiAgICAgIGxldCBzY2FsZVggPSAxLAogICAgICAgIHNjYWxlWSA9IDEsCiAgICAgICAgc2NhbGUwMSA9IDAsCiAgICAgICAgc2NhbGUxMCA9IDA7CiAgICAgIGlmIChmbGFncyAmIDB4MDgpIHsKICAgICAgICBzY2FsZVggPSBzY2FsZVkgPSBnZXRGbG9hdDIxNChjb2RlLCBpKTsKICAgICAgICBpICs9IDI7CiAgICAgIH0gZWxzZSBpZiAoZmxhZ3MgJiAweDQwKSB7CiAgICAgICAgc2NhbGVYID0gZ2V0RmxvYXQyMTQoY29kZSwgaSk7CiAgICAgICAgc2NhbGVZID0gZ2V0RmxvYXQyMTQoY29kZSwgaSArIDIpOwogICAgICAgIGkgKz0gNDsKICAgICAgfSBlbHNlIGlmIChmbGFncyAmIDB4ODApIHsKICAgICAgICBzY2FsZVggPSBnZXRGbG9hdDIxNChjb2RlLCBpKTsKICAgICAgICBzY2FsZTAxID0gZ2V0RmxvYXQyMTQoY29kZSwgaSArIDIpOwogICAgICAgIHNjYWxlMTAgPSBnZXRGbG9hdDIxNChjb2RlLCBpICsgNCk7CiAgICAgICAgc2NhbGVZID0gZ2V0RmxvYXQyMTQoY29kZSwgaSArIDYpOwogICAgICAgIGkgKz0gODsKICAgICAgfQogICAgICBjb25zdCBzdWJnbHlwaCA9IGZvbnQuZ2x5cGhzW2dseXBoSW5kZXhdOwogICAgICBpZiAoc3ViZ2x5cGgpIHsKICAgICAgICBjbWRzLnB1c2goewogICAgICAgICAgY21kOiAic2F2ZSIKICAgICAgICB9LCB7CiAgICAgICAgICBjbWQ6ICJ0cmFuc2Zvcm0iLAogICAgICAgICAgYXJnczogW3NjYWxlWCwgc2NhbGUwMSwgc2NhbGUxMCwgc2NhbGVZLCB4LCB5XQogICAgICAgIH0pOwogICAgICAgIGlmICghKGZsYWdzICYgMHgwMikpIHt9CiAgICAgICAgY29tcGlsZUdseWYoc3ViZ2x5cGgsIGNtZHMsIGZvbnQpOwogICAgICAgIGNtZHMucHVzaCh7CiAgICAgICAgICBjbWQ6ICJyZXN0b3JlIgogICAgICAgIH0pOwogICAgICB9CiAgICB9IHdoaWxlIChmbGFncyAmIDB4MjApOwogIH0gZWxzZSB7CiAgICBjb25zdCBlbmRQdHNPZkNvbnRvdXJzID0gW107CiAgICBsZXQgaiwgamo7CiAgICBmb3IgKGogPSAwOyBqIDwgbnVtYmVyT2ZDb250b3VyczsgaisrKSB7CiAgICAgIGVuZFB0c09mQ29udG91cnMucHVzaChnZXRVaW50MTYoY29kZSwgaSkpOwogICAgICBpICs9IDI7CiAgICB9CiAgICBjb25zdCBpbnN0cnVjdGlvbkxlbmd0aCA9IGdldFVpbnQxNihjb2RlLCBpKTsKICAgIGkgKz0gMiArIGluc3RydWN0aW9uTGVuZ3RoOwogICAgY29uc3QgbnVtYmVyT2ZQb2ludHMgPSBlbmRQdHNPZkNvbnRvdXJzLmF0KC0xKSArIDE7CiAgICBjb25zdCBwb2ludHMgPSBbXTsKICAgIHdoaWxlIChwb2ludHMubGVuZ3RoIDwgbnVtYmVyT2ZQb2ludHMpIHsKICAgICAgZmxhZ3MgPSBjb2RlW2krK107CiAgICAgIGxldCByZXBlYXQgPSAxOwogICAgICBpZiAoZmxhZ3MgJiAweDA4KSB7CiAgICAgICAgcmVwZWF0ICs9IGNvZGVbaSsrXTsKICAgICAgfQogICAgICB3aGlsZSAocmVwZWF0LS0gPiAwKSB7CiAgICAgICAgcG9pbnRzLnB1c2goewogICAgICAgICAgZmxhZ3MKICAgICAgICB9KTsKICAgICAgfQogICAgfQogICAgZm9yIChqID0gMDsgaiA8IG51bWJlck9mUG9pbnRzOyBqKyspIHsKICAgICAgc3dpdGNoIChwb2ludHNbal0uZmxhZ3MgJiAweDEyKSB7CiAgICAgICAgY2FzZSAweDAwOgogICAgICAgICAgeCArPSBnZXRJbnQxNihjb2RlLCBpKTsKICAgICAgICAgIGkgKz0gMjsKICAgICAgICAgIGJyZWFrOwogICAgICAgIGNhc2UgMHgwMjoKICAgICAgICAgIHggLT0gY29kZVtpKytdOwogICAgICAgICAgYnJlYWs7CiAgICAgICAgY2FzZSAweDEyOgogICAgICAgICAgeCArPSBjb2RlW2krK107CiAgICAgICAgICBicmVhazsKICAgICAgfQogICAgICBwb2ludHNbal0ueCA9IHg7CiAgICB9CiAgICBmb3IgKGogPSAwOyBqIDwgbnVtYmVyT2ZQb2ludHM7IGorKykgewogICAgICBzd2l0Y2ggKHBvaW50c1tqXS5mbGFncyAmIDB4MjQpIHsKICAgICAgICBjYXNlIDB4MDA6CiAgICAgICAgICB5ICs9IGdldEludDE2KGNvZGUsIGkpOwogICAgICAgICAgaSArPSAyOwogICAgICAgICAgYnJlYWs7CiAgICAgICAgY2FzZSAweDA0OgogICAgICAgICAgeSAtPSBjb2RlW2krK107CiAgICAgICAgICBicmVhazsKICAgICAgICBjYXNlIDB4MjQ6CiAgICAgICAgICB5ICs9IGNvZGVbaSsrXTsKICAgICAgICAgIGJyZWFrOwogICAgICB9CiAgICAgIHBvaW50c1tqXS55ID0geTsKICAgIH0KICAgIGxldCBzdGFydFBvaW50ID0gMDsKICAgIGZvciAoaSA9IDA7IGkgPCBudW1iZXJPZkNvbnRvdXJzOyBpKyspIHsKICAgICAgY29uc3QgZW5kUG9pbnQgPSBlbmRQdHNPZkNvbnRvdXJzW2ldOwogICAgICBjb25zdCBjb250b3VyID0gcG9pbnRzLnNsaWNlKHN0YXJ0UG9pbnQsIGVuZFBvaW50ICsgMSk7CiAgICAgIGlmIChjb250b3VyWzBdLmZsYWdzICYgMSkgewogICAgICAgIGNvbnRvdXIucHVzaChjb250b3VyWzBdKTsKICAgICAgfSBlbHNlIGlmIChjb250b3VyLmF0KC0xKS5mbGFncyAmIDEpIHsKICAgICAgICBjb250b3VyLnVuc2hpZnQoY29udG91ci5hdCgtMSkpOwogICAgICB9IGVsc2UgewogICAgICAgIGNvbnN0IHAgPSB7CiAgICAgICAgICBmbGFnczogMSwKICAgICAgICAgIHg6IChjb250b3VyWzBdLnggKyBjb250b3VyLmF0KC0xKS54KSAvIDIsCiAgICAgICAgICB5OiAoY29udG91clswXS55ICsgY29udG91ci5hdCgtMSkueSkgLyAyCiAgICAgICAgfTsKICAgICAgICBjb250b3VyLnVuc2hpZnQocCk7CiAgICAgICAgY29udG91ci5wdXNoKHApOwogICAgICB9CiAgICAgIG1vdmVUbyhjb250b3VyWzBdLngsIGNvbnRvdXJbMF0ueSk7CiAgICAgIGZvciAoaiA9IDEsIGpqID0gY29udG91ci5sZW5ndGg7IGogPCBqajsgaisrKSB7CiAgICAgICAgaWYgKGNvbnRvdXJbal0uZmxhZ3MgJiAxKSB7CiAgICAgICAgICBsaW5lVG8oY29udG91cltqXS54LCBjb250b3VyW2pdLnkpOwogICAgICAgIH0gZWxzZSBpZiAoY29udG91cltqICsgMV0uZmxhZ3MgJiAxKSB7CiAgICAgICAgICBxdWFkcmF0aWNDdXJ2ZVRvKGNvbnRvdXJbal0ueCwgY29udG91cltqXS55LCBjb250b3VyW2ogKyAxXS54LCBjb250b3VyW2ogKyAxXS55KTsKICAgICAgICAgIGorKzsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgcXVhZHJhdGljQ3VydmVUbyhjb250b3VyW2pdLngsIGNvbnRvdXJbal0ueSwgKGNvbnRvdXJbal0ueCArIGNvbnRvdXJbaiArIDFdLngpIC8gMiwgKGNvbnRvdXJbal0ueSArIGNvbnRvdXJbaiArIDFdLnkpIC8gMik7CiAgICAgICAgfQogICAgICB9CiAgICAgIHN0YXJ0UG9pbnQgPSBlbmRQb2ludCArIDE7CiAgICB9CiAgfQp9CmZ1bmN0aW9uIGNvbXBpbGVDaGFyU3RyaW5nKGNoYXJTdHJpbmdDb2RlLCBjbWRzLCBmb250LCBnbHlwaElkKSB7CiAgZnVuY3Rpb24gbW92ZVRvKHgsIHkpIHsKICAgIGNtZHMucHVzaCh7CiAgICAgIGNtZDogIm1vdmVUbyIsCiAgICAgIGFyZ3M6IFt4LCB5XQogICAgfSk7CiAgfQogIGZ1bmN0aW9uIGxpbmVUbyh4LCB5KSB7CiAgICBjbWRzLnB1c2goewogICAgICBjbWQ6ICJsaW5lVG8iLAogICAgICBhcmdzOiBbeCwgeV0KICAgIH0pOwogIH0KICBmdW5jdGlvbiBiZXppZXJDdXJ2ZVRvKHgxLCB5MSwgeDIsIHkyLCB4LCB5KSB7CiAgICBjbWRzLnB1c2goewogICAgICBjbWQ6ICJiZXppZXJDdXJ2ZVRvIiwKICAgICAgYXJnczogW3gxLCB5MSwgeDIsIHkyLCB4LCB5XQogICAgfSk7CiAgfQogIGNvbnN0IHN0YWNrID0gW107CiAgbGV0IHggPSAwLAogICAgeSA9IDA7CiAgbGV0IHN0ZW1zID0gMDsKICBmdW5jdGlvbiBwYXJzZShjb2RlKSB7CiAgICBsZXQgaSA9IDA7CiAgICB3aGlsZSAoaSA8IGNvZGUubGVuZ3RoKSB7CiAgICAgIGxldCBzdGFja0NsZWFuID0gZmFsc2U7CiAgICAgIGxldCB2ID0gY29kZVtpKytdOwogICAgICBsZXQgeGEsIHhiLCB5YSwgeWIsIHkxLCB5MiwgeTMsIG4sIHN1YnJDb2RlOwogICAgICBzd2l0Y2ggKHYpIHsKICAgICAgICBjYXNlIDE6CiAgICAgICAgICBzdGVtcyArPSBzdGFjay5sZW5ndGggPj4gMTsKICAgICAgICAgIHN0YWNrQ2xlYW4gPSB0cnVlOwogICAgICAgICAgYnJlYWs7CiAgICAgICAgY2FzZSAzOgogICAgICAgICAgc3RlbXMgKz0gc3RhY2subGVuZ3RoID4+IDE7CiAgICAgICAgICBzdGFja0NsZWFuID0gdHJ1ZTsKICAgICAgICAgIGJyZWFrOwogICAgICAgIGNhc2UgNDoKICAgICAgICAgIHkgKz0gc3RhY2sucG9wKCk7CiAgICAgICAgICBtb3ZlVG8oeCwgeSk7CiAgICAgICAgICBzdGFja0NsZWFuID0gdHJ1ZTsKICAgICAgICAgIGJyZWFrOwogICAgICAgIGNhc2UgNToKICAgICAgICAgIHdoaWxlIChzdGFjay5sZW5ndGggPiAwKSB7CiAgICAgICAgICAgIHggKz0gc3RhY2suc2hpZnQoKTsKICAgICAgICAgICAgeSArPSBzdGFjay5zaGlmdCgpOwogICAgICAgICAgICBsaW5lVG8oeCwgeSk7CiAgICAgICAgICB9CiAgICAgICAgICBicmVhazsKICAgICAgICBjYXNlIDY6CiAgICAgICAgICB3aGlsZSAoc3RhY2subGVuZ3RoID4gMCkgewogICAgICAgICAgICB4ICs9IHN0YWNrLnNoaWZ0KCk7CiAgICAgICAgICAgIGxpbmVUbyh4LCB5KTsKICAgICAgICAgICAgaWYgKHN0YWNrLmxlbmd0aCA9PT0gMCkgewogICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICB9CiAgICAgICAgICAgIHkgKz0gc3RhY2suc2hpZnQoKTsKICAgICAgICAgICAgbGluZVRvKHgsIHkpOwogICAgICAgICAgfQogICAgICAgICAgYnJlYWs7CiAgICAgICAgY2FzZSA3OgogICAgICAgICAgd2hpbGUgKHN0YWNrLmxlbmd0aCA+IDApIHsKICAgICAgICAgICAgeSArPSBzdGFjay5zaGlmdCgpOwogICAgICAgICAgICBsaW5lVG8oeCwgeSk7CiAgICAgICAgICAgIGlmIChzdGFjay5sZW5ndGggPT09IDApIHsKICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgfQogICAgICAgICAgICB4ICs9IHN0YWNrLnNoaWZ0KCk7CiAgICAgICAgICAgIGxpbmVUbyh4LCB5KTsKICAgICAgICAgIH0KICAgICAgICAgIGJyZWFrOwogICAgICAgIGNhc2UgODoKICAgICAgICAgIHdoaWxlIChzdGFjay5sZW5ndGggPiAwKSB7CiAgICAgICAgICAgIHhhID0geCArIHN0YWNrLnNoaWZ0KCk7CiAgICAgICAgICAgIHlhID0geSArIHN0YWNrLnNoaWZ0KCk7CiAgICAgICAgICAgIHhiID0geGEgKyBzdGFjay5zaGlmdCgpOwogICAgICAgICAgICB5YiA9IHlhICsgc3RhY2suc2hpZnQoKTsKICAgICAgICAgICAgeCA9IHhiICsgc3RhY2suc2hpZnQoKTsKICAgICAgICAgICAgeSA9IHliICsgc3RhY2suc2hpZnQoKTsKICAgICAgICAgICAgYmV6aWVyQ3VydmVUbyh4YSwgeWEsIHhiLCB5YiwgeCwgeSk7CiAgICAgICAgICB9CiAgICAgICAgICBicmVhazsKICAgICAgICBjYXNlIDEwOgogICAgICAgICAgbiA9IHN0YWNrLnBvcCgpOwogICAgICAgICAgc3VickNvZGUgPSBudWxsOwogICAgICAgICAgaWYgKGZvbnQuaXNDRkZDSURGb250KSB7CiAgICAgICAgICAgIGNvbnN0IGZkSW5kZXggPSBmb250LmZkU2VsZWN0LmdldEZESW5kZXgoZ2x5cGhJZCk7CiAgICAgICAgICAgIGlmIChmZEluZGV4ID49IDAgJiYgZmRJbmRleCA8IGZvbnQuZmRBcnJheS5sZW5ndGgpIHsKICAgICAgICAgICAgICBjb25zdCBmb250RGljdCA9IGZvbnQuZmRBcnJheVtmZEluZGV4XTsKICAgICAgICAgICAgICBsZXQgc3VicnM7CiAgICAgICAgICAgICAgaWYgKGZvbnREaWN0LnByaXZhdGVEaWN0Py5zdWJyc0luZGV4KSB7CiAgICAgICAgICAgICAgICBzdWJycyA9IGZvbnREaWN0LnByaXZhdGVEaWN0LnN1YnJzSW5kZXgub2JqZWN0czsKICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgaWYgKHN1YnJzKSB7CiAgICAgICAgICAgICAgICBuICs9IGdldFN1YnJvdXRpbmVCaWFzKHN1YnJzKTsKICAgICAgICAgICAgICAgIHN1YnJDb2RlID0gc3VicnNbbl07CiAgICAgICAgICAgICAgfQogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICgwLCBfdXRpbC53YXJuKSgiSW52YWxpZCBmZCBpbmRleCBmb3IgZ2x5cGggaW5kZXguIik7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIHN1YnJDb2RlID0gZm9udC5zdWJyc1tuICsgZm9udC5zdWJyc0JpYXNdOwogICAgICAgICAgfQogICAgICAgICAgaWYgKHN1YnJDb2RlKSB7CiAgICAgICAgICAgIHBhcnNlKHN1YnJDb2RlKTsKICAgICAgICAgIH0KICAgICAgICAgIGJyZWFrOwogICAgICAgIGNhc2UgMTE6CiAgICAgICAgICByZXR1cm47CiAgICAgICAgY2FzZSAxMjoKICAgICAgICAgIHYgPSBjb2RlW2krK107CiAgICAgICAgICBzd2l0Y2ggKHYpIHsKICAgICAgICAgICAgY2FzZSAzNDoKICAgICAgICAgICAgICB4YSA9IHggKyBzdGFjay5zaGlmdCgpOwogICAgICAgICAgICAgIHhiID0geGEgKyBzdGFjay5zaGlmdCgpOwogICAgICAgICAgICAgIHkxID0geSArIHN0YWNrLnNoaWZ0KCk7CiAgICAgICAgICAgICAgeCA9IHhiICsgc3RhY2suc2hpZnQoKTsKICAgICAgICAgICAgICBiZXppZXJDdXJ2ZVRvKHhhLCB5LCB4YiwgeTEsIHgsIHkxKTsKICAgICAgICAgICAgICB4YSA9IHggKyBzdGFjay5zaGlmdCgpOwogICAgICAgICAgICAgIHhiID0geGEgKyBzdGFjay5zaGlmdCgpOwogICAgICAgICAgICAgIHggPSB4YiArIHN0YWNrLnNoaWZ0KCk7CiAgICAgICAgICAgICAgYmV6aWVyQ3VydmVUbyh4YSwgeTEsIHhiLCB5LCB4LCB5KTsKICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgY2FzZSAzNToKICAgICAgICAgICAgICB4YSA9IHggKyBzdGFjay5zaGlmdCgpOwogICAgICAgICAgICAgIHlhID0geSArIHN0YWNrLnNoaWZ0KCk7CiAgICAgICAgICAgICAgeGIgPSB4YSArIHN0YWNrLnNoaWZ0KCk7CiAgICAgICAgICAgICAgeWIgPSB5YSArIHN0YWNrLnNoaWZ0KCk7CiAgICAgICAgICAgICAgeCA9IHhiICsgc3RhY2suc2hpZnQoKTsKICAgICAgICAgICAgICB5ID0geWIgKyBzdGFjay5zaGlmdCgpOwogICAgICAgICAgICAgIGJlemllckN1cnZlVG8oeGEsIHlhLCB4YiwgeWIsIHgsIHkpOwogICAgICAgICAgICAgIHhhID0geCArIHN0YWNrLnNoaWZ0KCk7CiAgICAgICAgICAgICAgeWEgPSB5ICsgc3RhY2suc2hpZnQoKTsKICAgICAgICAgICAgICB4YiA9IHhhICsgc3RhY2suc2hpZnQoKTsKICAgICAgICAgICAgICB5YiA9IHlhICsgc3RhY2suc2hpZnQoKTsKICAgICAgICAgICAgICB4ID0geGIgKyBzdGFjay5zaGlmdCgpOwogICAgICAgICAgICAgIHkgPSB5YiArIHN0YWNrLnNoaWZ0KCk7CiAgICAgICAgICAgICAgYmV6aWVyQ3VydmVUbyh4YSwgeWEsIHhiLCB5YiwgeCwgeSk7CiAgICAgICAgICAgICAgc3RhY2sucG9wKCk7CiAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgIGNhc2UgMzY6CiAgICAgICAgICAgICAgeGEgPSB4ICsgc3RhY2suc2hpZnQoKTsKICAgICAgICAgICAgICB5MSA9IHkgKyBzdGFjay5zaGlmdCgpOwogICAgICAgICAgICAgIHhiID0geGEgKyBzdGFjay5zaGlmdCgpOwogICAgICAgICAgICAgIHkyID0geTEgKyBzdGFjay5zaGlmdCgpOwogICAgICAgICAgICAgIHggPSB4YiArIHN0YWNrLnNoaWZ0KCk7CiAgICAgICAgICAgICAgYmV6aWVyQ3VydmVUbyh4YSwgeTEsIHhiLCB5MiwgeCwgeTIpOwogICAgICAgICAgICAgIHhhID0geCArIHN0YWNrLnNoaWZ0KCk7CiAgICAgICAgICAgICAgeGIgPSB4YSArIHN0YWNrLnNoaWZ0KCk7CiAgICAgICAgICAgICAgeTMgPSB5MiArIHN0YWNrLnNoaWZ0KCk7CiAgICAgICAgICAgICAgeCA9IHhiICsgc3RhY2suc2hpZnQoKTsKICAgICAgICAgICAgICBiZXppZXJDdXJ2ZVRvKHhhLCB5MiwgeGIsIHkzLCB4LCB5KTsKICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgY2FzZSAzNzoKICAgICAgICAgICAgICBjb25zdCB4MCA9IHgsCiAgICAgICAgICAgICAgICB5MCA9IHk7CiAgICAgICAgICAgICAgeGEgPSB4ICsgc3RhY2suc2hpZnQoKTsKICAgICAgICAgICAgICB5YSA9IHkgKyBzdGFjay5zaGlmdCgpOwogICAgICAgICAgICAgIHhiID0geGEgKyBzdGFjay5zaGlmdCgpOwogICAgICAgICAgICAgIHliID0geWEgKyBzdGFjay5zaGlmdCgpOwogICAgICAgICAgICAgIHggPSB4YiArIHN0YWNrLnNoaWZ0KCk7CiAgICAgICAgICAgICAgeSA9IHliICsgc3RhY2suc2hpZnQoKTsKICAgICAgICAgICAgICBiZXppZXJDdXJ2ZVRvKHhhLCB5YSwgeGIsIHliLCB4LCB5KTsKICAgICAgICAgICAgICB4YSA9IHggKyBzdGFjay5zaGlmdCgpOwogICAgICAgICAgICAgIHlhID0geSArIHN0YWNrLnNoaWZ0KCk7CiAgICAgICAgICAgICAgeGIgPSB4YSArIHN0YWNrLnNoaWZ0KCk7CiAgICAgICAgICAgICAgeWIgPSB5YSArIHN0YWNrLnNoaWZ0KCk7CiAgICAgICAgICAgICAgeCA9IHhiOwogICAgICAgICAgICAgIHkgPSB5YjsKICAgICAgICAgICAgICBpZiAoTWF0aC5hYnMoeCAtIHgwKSA+IE1hdGguYWJzKHkgLSB5MCkpIHsKICAgICAgICAgICAgICAgIHggKz0gc3RhY2suc2hpZnQoKTsKICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgeSArPSBzdGFjay5zaGlmdCgpOwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgICBiZXppZXJDdXJ2ZVRvKHhhLCB5YSwgeGIsIHliLCB4LCB5KTsKICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgZGVmYXVsdDoKICAgICAgICAgICAgICB0aHJvdyBuZXcgX3V0aWwuRm9ybWF0RXJyb3IoYHVua25vd24gb3BlcmF0b3I6IDEyICR7dn1gKTsKICAgICAgICAgIH0KICAgICAgICAgIGJyZWFrOwogICAgICAgIGNhc2UgMTQ6CiAgICAgICAgICBpZiAoc3RhY2subGVuZ3RoID49IDQpIHsKICAgICAgICAgICAgY29uc3QgYWNoYXIgPSBzdGFjay5wb3AoKTsKICAgICAgICAgICAgY29uc3QgYmNoYXIgPSBzdGFjay5wb3AoKTsKICAgICAgICAgICAgeSA9IHN0YWNrLnBvcCgpOwogICAgICAgICAgICB4ID0gc3RhY2sucG9wKCk7CiAgICAgICAgICAgIGNtZHMucHVzaCh7CiAgICAgICAgICAgICAgY21kOiAic2F2ZSIKICAgICAgICAgICAgfSwgewogICAgICAgICAgICAgIGNtZDogInRyYW5zbGF0ZSIsCiAgICAgICAgICAgICAgYXJnczogW3gsIHldCiAgICAgICAgICAgIH0pOwogICAgICAgICAgICBsZXQgY21hcCA9IGxvb2t1cENtYXAoZm9udC5jbWFwLCBTdHJpbmcuZnJvbUNoYXJDb2RlKGZvbnQuZ2x5cGhOYW1lTWFwW19lbmNvZGluZ3MuU3RhbmRhcmRFbmNvZGluZ1thY2hhcl1dKSk7CiAgICAgICAgICAgIGNvbXBpbGVDaGFyU3RyaW5nKGZvbnQuZ2x5cGhzW2NtYXAuZ2x5cGhJZF0sIGNtZHMsIGZvbnQsIGNtYXAuZ2x5cGhJZCk7CiAgICAgICAgICAgIGNtZHMucHVzaCh7CiAgICAgICAgICAgICAgY21kOiAicmVzdG9yZSIKICAgICAgICAgICAgfSk7CiAgICAgICAgICAgIGNtYXAgPSBsb29rdXBDbWFwKGZvbnQuY21hcCwgU3RyaW5nLmZyb21DaGFyQ29kZShmb250LmdseXBoTmFtZU1hcFtfZW5jb2RpbmdzLlN0YW5kYXJkRW5jb2RpbmdbYmNoYXJdXSkpOwogICAgICAgICAgICBjb21waWxlQ2hhclN0cmluZyhmb250LmdseXBoc1tjbWFwLmdseXBoSWRdLCBjbWRzLCBmb250LCBjbWFwLmdseXBoSWQpOwogICAgICAgICAgfQogICAgICAgICAgcmV0dXJuOwogICAgICAgIGNhc2UgMTg6CiAgICAgICAgICBzdGVtcyArPSBzdGFjay5sZW5ndGggPj4gMTsKICAgICAgICAgIHN0YWNrQ2xlYW4gPSB0cnVlOwogICAgICAgICAgYnJlYWs7CiAgICAgICAgY2FzZSAxOToKICAgICAgICAgIHN0ZW1zICs9IHN0YWNrLmxlbmd0aCA+PiAxOwogICAgICAgICAgaSArPSBzdGVtcyArIDcgPj4gMzsKICAgICAgICAgIHN0YWNrQ2xlYW4gPSB0cnVlOwogICAgICAgICAgYnJlYWs7CiAgICAgICAgY2FzZSAyMDoKICAgICAgICAgIHN0ZW1zICs9IHN0YWNrLmxlbmd0aCA+PiAxOwogICAgICAgICAgaSArPSBzdGVtcyArIDcgPj4gMzsKICAgICAgICAgIHN0YWNrQ2xlYW4gPSB0cnVlOwogICAgICAgICAgYnJlYWs7CiAgICAgICAgY2FzZSAyMToKICAgICAgICAgIHkgKz0gc3RhY2sucG9wKCk7CiAgICAgICAgICB4ICs9IHN0YWNrLnBvcCgpOwogICAgICAgICAgbW92ZVRvKHgsIHkpOwogICAgICAgICAgc3RhY2tDbGVhbiA9IHRydWU7CiAgICAgICAgICBicmVhazsKICAgICAgICBjYXNlIDIyOgogICAgICAgICAgeCArPSBzdGFjay5wb3AoKTsKICAgICAgICAgIG1vdmVUbyh4LCB5KTsKICAgICAgICAgIHN0YWNrQ2xlYW4gPSB0cnVlOwogICAgICAgICAgYnJlYWs7CiAgICAgICAgY2FzZSAyMzoKICAgICAgICAgIHN0ZW1zICs9IHN0YWNrLmxlbmd0aCA+PiAxOwogICAgICAgICAgc3RhY2tDbGVhbiA9IHRydWU7CiAgICAgICAgICBicmVhazsKICAgICAgICBjYXNlIDI0OgogICAgICAgICAgd2hpbGUgKHN0YWNrLmxlbmd0aCA+IDIpIHsKICAgICAgICAgICAgeGEgPSB4ICsgc3RhY2suc2hpZnQoKTsKICAgICAgICAgICAgeWEgPSB5ICsgc3RhY2suc2hpZnQoKTsKICAgICAgICAgICAgeGIgPSB4YSArIHN0YWNrLnNoaWZ0KCk7CiAgICAgICAgICAgIHliID0geWEgKyBzdGFjay5zaGlmdCgpOwogICAgICAgICAgICB4ID0geGIgKyBzdGFjay5zaGlmdCgpOwogICAgICAgICAgICB5ID0geWIgKyBzdGFjay5zaGlmdCgpOwogICAgICAgICAgICBiZXppZXJDdXJ2ZVRvKHhhLCB5YSwgeGIsIHliLCB4LCB5KTsKICAgICAgICAgIH0KICAgICAgICAgIHggKz0gc3RhY2suc2hpZnQoKTsKICAgICAgICAgIHkgKz0gc3RhY2suc2hpZnQoKTsKICAgICAgICAgIGxpbmVUbyh4LCB5KTsKICAgICAgICAgIGJyZWFrOwogICAgICAgIGNhc2UgMjU6CiAgICAgICAgICB3aGlsZSAoc3RhY2subGVuZ3RoID4gNikgewogICAgICAgICAgICB4ICs9IHN0YWNrLnNoaWZ0KCk7CiAgICAgICAgICAgIHkgKz0gc3RhY2suc2hpZnQoKTsKICAgICAgICAgICAgbGluZVRvKHgsIHkpOwogICAgICAgICAgfQogICAgICAgICAgeGEgPSB4ICsgc3RhY2suc2hpZnQoKTsKICAgICAgICAgIHlhID0geSArIHN0YWNrLnNoaWZ0KCk7CiAgICAgICAgICB4YiA9IHhhICsgc3RhY2suc2hpZnQoKTsKICAgICAgICAgIHliID0geWEgKyBzdGFjay5zaGlmdCgpOwogICAgICAgICAgeCA9IHhiICsgc3RhY2suc2hpZnQoKTsKICAgICAgICAgIHkgPSB5YiArIHN0YWNrLnNoaWZ0KCk7CiAgICAgICAgICBiZXppZXJDdXJ2ZVRvKHhhLCB5YSwgeGIsIHliLCB4LCB5KTsKICAgICAgICAgIGJyZWFrOwogICAgICAgIGNhc2UgMjY6CiAgICAgICAgICBpZiAoc3RhY2subGVuZ3RoICUgMikgewogICAgICAgICAgICB4ICs9IHN0YWNrLnNoaWZ0KCk7CiAgICAgICAgICB9CiAgICAgICAgICB3aGlsZSAoc3RhY2subGVuZ3RoID4gMCkgewogICAgICAgICAgICB4YSA9IHg7CiAgICAgICAgICAgIHlhID0geSArIHN0YWNrLnNoaWZ0KCk7CiAgICAgICAgICAgIHhiID0geGEgKyBzdGFjay5zaGlmdCgpOwogICAgICAgICAgICB5YiA9IHlhICsgc3RhY2suc2hpZnQoKTsKICAgICAgICAgICAgeCA9IHhiOwogICAgICAgICAgICB5ID0geWIgKyBzdGFjay5zaGlmdCgpOwogICAgICAgICAgICBiZXppZXJDdXJ2ZVRvKHhhLCB5YSwgeGIsIHliLCB4LCB5KTsKICAgICAgICAgIH0KICAgICAgICAgIGJyZWFrOwogICAgICAgIGNhc2UgMjc6CiAgICAgICAgICBpZiAoc3RhY2subGVuZ3RoICUgMikgewogICAgICAgICAgICB5ICs9IHN0YWNrLnNoaWZ0KCk7CiAgICAgICAgICB9CiAgICAgICAgICB3aGlsZSAoc3RhY2subGVuZ3RoID4gMCkgewogICAgICAgICAgICB4YSA9IHggKyBzdGFjay5zaGlmdCgpOwogICAgICAgICAgICB5YSA9IHk7CiAgICAgICAgICAgIHhiID0geGEgKyBzdGFjay5zaGlmdCgpOwogICAgICAgICAgICB5YiA9IHlhICsgc3RhY2suc2hpZnQoKTsKICAgICAgICAgICAgeCA9IHhiICsgc3RhY2suc2hpZnQoKTsKICAgICAgICAgICAgeSA9IHliOwogICAgICAgICAgICBiZXppZXJDdXJ2ZVRvKHhhLCB5YSwgeGIsIHliLCB4LCB5KTsKICAgICAgICAgIH0KICAgICAgICAgIGJyZWFrOwogICAgICAgIGNhc2UgMjg6CiAgICAgICAgICBzdGFjay5wdXNoKChjb2RlW2ldIDw8IDI0IHwgY29kZVtpICsgMV0gPDwgMTYpID4+IDE2KTsKICAgICAgICAgIGkgKz0gMjsKICAgICAgICAgIGJyZWFrOwogICAgICAgIGNhc2UgMjk6CiAgICAgICAgICBuID0gc3RhY2sucG9wKCkgKyBmb250LmdzdWJyc0JpYXM7CiAgICAgICAgICBzdWJyQ29kZSA9IGZvbnQuZ3N1YnJzW25dOwogICAgICAgICAgaWYgKHN1YnJDb2RlKSB7CiAgICAgICAgICAgIHBhcnNlKHN1YnJDb2RlKTsKICAgICAgICAgIH0KICAgICAgICAgIGJyZWFrOwogICAgICAgIGNhc2UgMzA6CiAgICAgICAgICB3aGlsZSAoc3RhY2subGVuZ3RoID4gMCkgewogICAgICAgICAgICB4YSA9IHg7CiAgICAgICAgICAgIHlhID0geSArIHN0YWNrLnNoaWZ0KCk7CiAgICAgICAgICAgIHhiID0geGEgKyBzdGFjay5zaGlmdCgpOwogICAgICAgICAgICB5YiA9IHlhICsgc3RhY2suc2hpZnQoKTsKICAgICAgICAgICAgeCA9IHhiICsgc3RhY2suc2hpZnQoKTsKICAgICAgICAgICAgeSA9IHliICsgKHN0YWNrLmxlbmd0aCA9PT0gMSA/IHN0YWNrLnNoaWZ0KCkgOiAwKTsKICAgICAgICAgICAgYmV6aWVyQ3VydmVUbyh4YSwgeWEsIHhiLCB5YiwgeCwgeSk7CiAgICAgICAgICAgIGlmIChzdGFjay5sZW5ndGggPT09IDApIHsKICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgfQogICAgICAgICAgICB4YSA9IHggKyBzdGFjay5zaGlmdCgpOwogICAgICAgICAgICB5YSA9IHk7CiAgICAgICAgICAgIHhiID0geGEgKyBzdGFjay5zaGlmdCgpOwogICAgICAgICAgICB5YiA9IHlhICsgc3RhY2suc2hpZnQoKTsKICAgICAgICAgICAgeSA9IHliICsgc3RhY2suc2hpZnQoKTsKICAgICAgICAgICAgeCA9IHhiICsgKHN0YWNrLmxlbmd0aCA9PT0gMSA/IHN0YWNrLnNoaWZ0KCkgOiAwKTsKICAgICAgICAgICAgYmV6aWVyQ3VydmVUbyh4YSwgeWEsIHhiLCB5YiwgeCwgeSk7CiAgICAgICAgICB9CiAgICAgICAgICBicmVhazsKICAgICAgICBjYXNlIDMxOgogICAgICAgICAgd2hpbGUgKHN0YWNrLmxlbmd0aCA+IDApIHsKICAgICAgICAgICAgeGEgPSB4ICsgc3RhY2suc2hpZnQoKTsKICAgICAgICAgICAgeWEgPSB5OwogICAgICAgICAgICB4YiA9IHhhICsgc3RhY2suc2hpZnQoKTsKICAgICAgICAgICAgeWIgPSB5YSArIHN0YWNrLnNoaWZ0KCk7CiAgICAgICAgICAgIHkgPSB5YiArIHN0YWNrLnNoaWZ0KCk7CiAgICAgICAgICAgIHggPSB4YiArIChzdGFjay5sZW5ndGggPT09IDEgPyBzdGFjay5zaGlmdCgpIDogMCk7CiAgICAgICAgICAgIGJlemllckN1cnZlVG8oeGEsIHlhLCB4YiwgeWIsIHgsIHkpOwogICAgICAgICAgICBpZiAoc3RhY2subGVuZ3RoID09PSAwKSB7CiAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgeGEgPSB4OwogICAgICAgICAgICB5YSA9IHkgKyBzdGFjay5zaGlmdCgpOwogICAgICAgICAgICB4YiA9IHhhICsgc3RhY2suc2hpZnQoKTsKICAgICAgICAgICAgeWIgPSB5YSArIHN0YWNrLnNoaWZ0KCk7CiAgICAgICAgICAgIHggPSB4YiArIHN0YWNrLnNoaWZ0KCk7CiAgICAgICAgICAgIHkgPSB5YiArIChzdGFjay5sZW5ndGggPT09IDEgPyBzdGFjay5zaGlmdCgpIDogMCk7CiAgICAgICAgICAgIGJlemllckN1cnZlVG8oeGEsIHlhLCB4YiwgeWIsIHgsIHkpOwogICAgICAgICAgfQogICAgICAgICAgYnJlYWs7CiAgICAgICAgZGVmYXVsdDoKICAgICAgICAgIGlmICh2IDwgMzIpIHsKICAgICAgICAgICAgdGhyb3cgbmV3IF91dGlsLkZvcm1hdEVycm9yKGB1bmtub3duIG9wZXJhdG9yOiAke3Z9YCk7CiAgICAgICAgICB9CiAgICAgICAgICBpZiAodiA8IDI0NykgewogICAgICAgICAgICBzdGFjay5wdXNoKHYgLSAxMzkpOwogICAgICAgICAgfSBlbHNlIGlmICh2IDwgMjUxKSB7CiAgICAgICAgICAgIHN0YWNrLnB1c2goKHYgLSAyNDcpICogMjU2ICsgY29kZVtpKytdICsgMTA4KTsKICAgICAgICAgIH0gZWxzZSBpZiAodiA8IDI1NSkgewogICAgICAgICAgICBzdGFjay5wdXNoKC0odiAtIDI1MSkgKiAyNTYgLSBjb2RlW2krK10gLSAxMDgpOwogICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgc3RhY2sucHVzaCgoY29kZVtpXSA8PCAyNCB8IGNvZGVbaSArIDFdIDw8IDE2IHwgY29kZVtpICsgMl0gPDwgOCB8IGNvZGVbaSArIDNdKSAvIDY1NTM2KTsKICAgICAgICAgICAgaSArPSA0OwogICAgICAgICAgfQogICAgICAgICAgYnJlYWs7CiAgICAgIH0KICAgICAgaWYgKHN0YWNrQ2xlYW4pIHsKICAgICAgICBzdGFjay5sZW5ndGggPSAwOwogICAgICB9CiAgICB9CiAgfQogIHBhcnNlKGNoYXJTdHJpbmdDb2RlKTsKfQpjb25zdCBOT09QID0gW107CmNsYXNzIENvbXBpbGVkRm9udCB7CiAgY29uc3RydWN0b3IoZm9udE1hdHJpeCkgewogICAgaWYgKHRoaXMuY29uc3RydWN0b3IgPT09IENvbXBpbGVkRm9udCkgewogICAgICAoMCwgX3V0aWwudW5yZWFjaGFibGUpKCJDYW5ub3QgaW5pdGlhbGl6ZSBDb21waWxlZEZvbnQuIik7CiAgICB9CiAgICB0aGlzLmZvbnRNYXRyaXggPSBmb250TWF0cml4OwogICAgdGhpcy5jb21waWxlZEdseXBocyA9IE9iamVjdC5jcmVhdGUobnVsbCk7CiAgICB0aGlzLmNvbXBpbGVkQ2hhckNvZGVUb0dseXBoSWQgPSBPYmplY3QuY3JlYXRlKG51bGwpOwogIH0KICBnZXRQYXRoSnModW5pY29kZSkgewogICAgY29uc3QgewogICAgICBjaGFyQ29kZSwKICAgICAgZ2x5cGhJZAogICAgfSA9IGxvb2t1cENtYXAodGhpcy5jbWFwLCB1bmljb2RlKTsKICAgIGxldCBmbiA9IHRoaXMuY29tcGlsZWRHbHlwaHNbZ2x5cGhJZF07CiAgICBpZiAoIWZuKSB7CiAgICAgIHRyeSB7CiAgICAgICAgZm4gPSB0aGlzLmNvbXBpbGVHbHlwaCh0aGlzLmdseXBoc1tnbHlwaElkXSwgZ2x5cGhJZCk7CiAgICAgICAgdGhpcy5jb21waWxlZEdseXBoc1tnbHlwaElkXSA9IGZuOwogICAgICB9IGNhdGNoIChleCkgewogICAgICAgIHRoaXMuY29tcGlsZWRHbHlwaHNbZ2x5cGhJZF0gPSBOT09QOwogICAgICAgIGlmICh0aGlzLmNvbXBpbGVkQ2hhckNvZGVUb0dseXBoSWRbY2hhckNvZGVdID09PSB1bmRlZmluZWQpIHsKICAgICAgICAgIHRoaXMuY29tcGlsZWRDaGFyQ29kZVRvR2x5cGhJZFtjaGFyQ29kZV0gPSBnbHlwaElkOwogICAgICAgIH0KICAgICAgICB0aHJvdyBleDsKICAgICAgfQogICAgfQogICAgaWYgKHRoaXMuY29tcGlsZWRDaGFyQ29kZVRvR2x5cGhJZFtjaGFyQ29kZV0gPT09IHVuZGVmaW5lZCkgewogICAgICB0aGlzLmNvbXBpbGVkQ2hhckNvZGVUb0dseXBoSWRbY2hhckNvZGVdID0gZ2x5cGhJZDsKICAgIH0KICAgIHJldHVybiBmbjsKICB9CiAgY29tcGlsZUdseXBoKGNvZGUsIGdseXBoSWQpIHsKICAgIGlmICghY29kZSB8fCBjb2RlLmxlbmd0aCA9PT0gMCB8fCBjb2RlWzBdID09PSAxNCkgewogICAgICByZXR1cm4gTk9PUDsKICAgIH0KICAgIGxldCBmb250TWF0cml4ID0gdGhpcy5mb250TWF0cml4OwogICAgaWYgKHRoaXMuaXNDRkZDSURGb250KSB7CiAgICAgIGNvbnN0IGZkSW5kZXggPSB0aGlzLmZkU2VsZWN0LmdldEZESW5kZXgoZ2x5cGhJZCk7CiAgICAgIGlmIChmZEluZGV4ID49IDAgJiYgZmRJbmRleCA8IHRoaXMuZmRBcnJheS5sZW5ndGgpIHsKICAgICAgICBjb25zdCBmb250RGljdCA9IHRoaXMuZmRBcnJheVtmZEluZGV4XTsKICAgICAgICBmb250TWF0cml4ID0gZm9udERpY3QuZ2V0QnlOYW1lKCJGb250TWF0cml4IikgfHwgX3V0aWwuRk9OVF9JREVOVElUWV9NQVRSSVg7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgKDAsIF91dGlsLndhcm4pKCJJbnZhbGlkIGZkIGluZGV4IGZvciBnbHlwaCBpbmRleC4iKTsKICAgICAgfQogICAgfQogICAgY29uc3QgY21kcyA9IFt7CiAgICAgIGNtZDogInNhdmUiCiAgICB9LCB7CiAgICAgIGNtZDogInRyYW5zZm9ybSIsCiAgICAgIGFyZ3M6IGZvbnRNYXRyaXguc2xpY2UoKQogICAgfSwgewogICAgICBjbWQ6ICJzY2FsZSIsCiAgICAgIGFyZ3M6IFsic2l6ZSIsICItc2l6ZSJdCiAgICB9XTsKICAgIHRoaXMuY29tcGlsZUdseXBoSW1wbChjb2RlLCBjbWRzLCBnbHlwaElkKTsKICAgIGNtZHMucHVzaCh7CiAgICAgIGNtZDogInJlc3RvcmUiCiAgICB9KTsKICAgIHJldHVybiBjbWRzOwogIH0KICBjb21waWxlR2x5cGhJbXBsKCkgewogICAgKDAsIF91dGlsLnVucmVhY2hhYmxlKSgiQ2hpbGRyZW4gY2xhc3NlcyBzaG91bGQgaW1wbGVtZW50IHRoaXMuIik7CiAgfQogIGhhc0J1aWx0UGF0aCh1bmljb2RlKSB7CiAgICBjb25zdCB7CiAgICAgIGNoYXJDb2RlLAogICAgICBnbHlwaElkCiAgICB9ID0gbG9va3VwQ21hcCh0aGlzLmNtYXAsIHVuaWNvZGUpOwogICAgcmV0dXJuIHRoaXMuY29tcGlsZWRHbHlwaHNbZ2x5cGhJZF0gIT09IHVuZGVmaW5lZCAmJiB0aGlzLmNvbXBpbGVkQ2hhckNvZGVUb0dseXBoSWRbY2hhckNvZGVdICE9PSB1bmRlZmluZWQ7CiAgfQp9CmNsYXNzIFRydWVUeXBlQ29tcGlsZWQgZXh0ZW5kcyBDb21waWxlZEZvbnQgewogIGNvbnN0cnVjdG9yKGdseXBocywgY21hcCwgZm9udE1hdHJpeCkgewogICAgc3VwZXIoZm9udE1hdHJpeCB8fCBbMC4wMDA0ODgsIDAsIDAsIDAuMDAwNDg4LCAwLCAwXSk7CiAgICB0aGlzLmdseXBocyA9IGdseXBoczsKICAgIHRoaXMuY21hcCA9IGNtYXA7CiAgfQogIGNvbXBpbGVHbHlwaEltcGwoY29kZSwgY21kcykgewogICAgY29tcGlsZUdseWYoY29kZSwgY21kcywgdGhpcyk7CiAgfQp9CmNsYXNzIFR5cGUyQ29tcGlsZWQgZXh0ZW5kcyBDb21waWxlZEZvbnQgewogIGNvbnN0cnVjdG9yKGNmZkluZm8sIGNtYXAsIGZvbnRNYXRyaXgsIGdseXBoTmFtZU1hcCkgewogICAgc3VwZXIoZm9udE1hdHJpeCB8fCBbMC4wMDEsIDAsIDAsIDAuMDAxLCAwLCAwXSk7CiAgICB0aGlzLmdseXBocyA9IGNmZkluZm8uZ2x5cGhzOwogICAgdGhpcy5nc3VicnMgPSBjZmZJbmZvLmdzdWJycyB8fCBbXTsKICAgIHRoaXMuc3VicnMgPSBjZmZJbmZvLnN1YnJzIHx8IFtdOwogICAgdGhpcy5jbWFwID0gY21hcDsKICAgIHRoaXMuZ2x5cGhOYW1lTWFwID0gZ2x5cGhOYW1lTWFwIHx8ICgwLCBfZ2x5cGhsaXN0LmdldEdseXBoc1VuaWNvZGUpKCk7CiAgICB0aGlzLmdzdWJyc0JpYXMgPSBnZXRTdWJyb3V0aW5lQmlhcyh0aGlzLmdzdWJycyk7CiAgICB0aGlzLnN1YnJzQmlhcyA9IGdldFN1YnJvdXRpbmVCaWFzKHRoaXMuc3VicnMpOwogICAgdGhpcy5pc0NGRkNJREZvbnQgPSBjZmZJbmZvLmlzQ0ZGQ0lERm9udDsKICAgIHRoaXMuZmRTZWxlY3QgPSBjZmZJbmZvLmZkU2VsZWN0OwogICAgdGhpcy5mZEFycmF5ID0gY2ZmSW5mby5mZEFycmF5OwogIH0KICBjb21waWxlR2x5cGhJbXBsKGNvZGUsIGNtZHMsIGdseXBoSWQpIHsKICAgIGNvbXBpbGVDaGFyU3RyaW5nKGNvZGUsIGNtZHMsIHRoaXMsIGdseXBoSWQpOwogIH0KfQpjbGFzcyBGb250UmVuZGVyZXJGYWN0b3J5IHsKICBzdGF0aWMgY3JlYXRlKGZvbnQsIHNlYWNBbmFseXNpc0VuYWJsZWQpIHsKICAgIGNvbnN0IGRhdGEgPSBuZXcgVWludDhBcnJheShmb250LmRhdGEpOwogICAgbGV0IGNtYXAsIGdseWYsIGxvY2EsIGNmZiwgaW5kZXhUb0xvY0Zvcm1hdCwgdW5pdHNQZXJFbTsKICAgIGNvbnN0IG51bVRhYmxlcyA9IGdldFVpbnQxNihkYXRhLCA0KTsKICAgIGZvciAobGV0IGkgPSAwLCBwID0gMTI7IGkgPCBudW1UYWJsZXM7IGkrKywgcCArPSAxNikgewogICAgICBjb25zdCB0YWcgPSAoMCwgX3V0aWwuYnl0ZXNUb1N0cmluZykoZGF0YS5zdWJhcnJheShwLCBwICsgNCkpOwogICAgICBjb25zdCBvZmZzZXQgPSBnZXRVaW50MzIoZGF0YSwgcCArIDgpOwogICAgICBjb25zdCBsZW5ndGggPSBnZXRVaW50MzIoZGF0YSwgcCArIDEyKTsKICAgICAgc3dpdGNoICh0YWcpIHsKICAgICAgICBjYXNlICJjbWFwIjoKICAgICAgICAgIGNtYXAgPSBwYXJzZUNtYXAoZGF0YSwgb2Zmc2V0LCBvZmZzZXQgKyBsZW5ndGgpOwogICAgICAgICAgYnJlYWs7CiAgICAgICAgY2FzZSAiZ2x5ZiI6CiAgICAgICAgICBnbHlmID0gZGF0YS5zdWJhcnJheShvZmZzZXQsIG9mZnNldCArIGxlbmd0aCk7CiAgICAgICAgICBicmVhazsKICAgICAgICBjYXNlICJsb2NhIjoKICAgICAgICAgIGxvY2EgPSBkYXRhLnN1YmFycmF5KG9mZnNldCwgb2Zmc2V0ICsgbGVuZ3RoKTsKICAgICAgICAgIGJyZWFrOwogICAgICAgIGNhc2UgImhlYWQiOgogICAgICAgICAgdW5pdHNQZXJFbSA9IGdldFVpbnQxNihkYXRhLCBvZmZzZXQgKyAxOCk7CiAgICAgICAgICBpbmRleFRvTG9jRm9ybWF0ID0gZ2V0VWludDE2KGRhdGEsIG9mZnNldCArIDUwKTsKICAgICAgICAgIGJyZWFrOwogICAgICAgIGNhc2UgIkNGRiAiOgogICAgICAgICAgY2ZmID0gcGFyc2VDZmYoZGF0YSwgb2Zmc2V0LCBvZmZzZXQgKyBsZW5ndGgsIHNlYWNBbmFseXNpc0VuYWJsZWQpOwogICAgICAgICAgYnJlYWs7CiAgICAgIH0KICAgIH0KICAgIGlmIChnbHlmKSB7CiAgICAgIGNvbnN0IGZvbnRNYXRyaXggPSAhdW5pdHNQZXJFbSA/IGZvbnQuZm9udE1hdHJpeCA6IFsxIC8gdW5pdHNQZXJFbSwgMCwgMCwgMSAvIHVuaXRzUGVyRW0sIDAsIDBdOwogICAgICByZXR1cm4gbmV3IFRydWVUeXBlQ29tcGlsZWQocGFyc2VHbHlmVGFibGUoZ2x5ZiwgbG9jYSwgaW5kZXhUb0xvY0Zvcm1hdCksIGNtYXAsIGZvbnRNYXRyaXgpOwogICAgfQogICAgcmV0dXJuIG5ldyBUeXBlMkNvbXBpbGVkKGNmZiwgY21hcCwgZm9udC5mb250TWF0cml4LCBmb250LmdseXBoTmFtZU1hcCk7CiAgfQp9CmV4cG9ydHMuRm9udFJlbmRlcmVyRmFjdG9yeSA9IEZvbnRSZW5kZXJlckZhY3Rvcnk7CgovKioqLyB9KSwKLyogNDUgKi8KLyoqKi8gKChfX3VudXNlZF93ZWJwYWNrX21vZHVsZSwgZXhwb3J0cywgX193X3BkZmpzX3JlcXVpcmVfXykgPT4gewoKCgpPYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgIl9fZXNNb2R1bGUiLCAoewogIHZhbHVlOiB0cnVlCn0pKTsKZXhwb3J0cy5nZXRNZXRyaWNzID0gZXhwb3J0cy5nZXRGb250QmFzaWNNZXRyaWNzID0gdm9pZCAwOwp2YXIgX2NvcmVfdXRpbHMgPSBfX3dfcGRmanNfcmVxdWlyZV9fKDMpOwpjb25zdCBnZXRNZXRyaWNzID0gKDAsIF9jb3JlX3V0aWxzLmdldExvb2t1cFRhYmxlRmFjdG9yeSkoZnVuY3Rpb24gKHQpIHsKICB0LkNvdXJpZXIgPSA2MDA7CiAgdFsiQ291cmllci1Cb2xkIl0gPSA2MDA7CiAgdFsiQ291cmllci1Cb2xkT2JsaXF1ZSJdID0gNjAwOwogIHRbIkNvdXJpZXItT2JsaXF1ZSJdID0gNjAwOwogIHQuSGVsdmV0aWNhID0gKDAsIF9jb3JlX3V0aWxzLmdldExvb2t1cFRhYmxlRmFjdG9yeSkoZnVuY3Rpb24gKHQpIHsKICAgIHQuc3BhY2UgPSAyNzg7CiAgICB0LmV4Y2xhbSA9IDI3ODsKICAgIHQucXVvdGVkYmwgPSAzNTU7CiAgICB0Lm51bWJlcnNpZ24gPSA1NTY7CiAgICB0LmRvbGxhciA9IDU1NjsKICAgIHQucGVyY2VudCA9IDg4OTsKICAgIHQuYW1wZXJzYW5kID0gNjY3OwogICAgdC5xdW90ZXJpZ2h0ID0gMjIyOwogICAgdC5wYXJlbmxlZnQgPSAzMzM7CiAgICB0LnBhcmVucmlnaHQgPSAzMzM7CiAgICB0LmFzdGVyaXNrID0gMzg5OwogICAgdC5wbHVzID0gNTg0OwogICAgdC5jb21tYSA9IDI3ODsKICAgIHQuaHlwaGVuID0gMzMzOwogICAgdC5wZXJpb2QgPSAyNzg7CiAgICB0LnNsYXNoID0gMjc4OwogICAgdC56ZXJvID0gNTU2OwogICAgdC5vbmUgPSA1NTY7CiAgICB0LnR3byA9IDU1NjsKICAgIHQudGhyZWUgPSA1NTY7CiAgICB0LmZvdXIgPSA1NTY7CiAgICB0LmZpdmUgPSA1NTY7CiAgICB0LnNpeCA9IDU1NjsKICAgIHQuc2V2ZW4gPSA1NTY7CiAgICB0LmVpZ2h0ID0gNTU2OwogICAgdC5uaW5lID0gNTU2OwogICAgdC5jb2xvbiA9IDI3ODsKICAgIHQuc2VtaWNvbG9uID0gMjc4OwogICAgdC5sZXNzID0gNTg0OwogICAgdC5lcXVhbCA9IDU4NDsKICAgIHQuZ3JlYXRlciA9IDU4NDsKICAgIHQucXVlc3Rpb24gPSA1NTY7CiAgICB0LmF0ID0gMTAxNTsKICAgIHQuQSA9IDY2NzsKICAgIHQuQiA9IDY2NzsKICAgIHQuQyA9IDcyMjsKICAgIHQuRCA9IDcyMjsKICAgIHQuRSA9IDY2NzsKICAgIHQuRiA9IDYxMTsKICAgIHQuRyA9IDc3ODsKICAgIHQuSCA9IDcyMjsKICAgIHQuSSA9IDI3ODsKICAgIHQuSiA9IDUwMDsKICAgIHQuSyA9IDY2NzsKICAgIHQuTCA9IDU1NjsKICAgIHQuTSA9IDgzMzsKICAgIHQuTiA9IDcyMjsKICAgIHQuTyA9IDc3ODsKICAgIHQuUCA9IDY2NzsKICAgIHQuUSA9IDc3ODsKICAgIHQuUiA9IDcyMjsKICAgIHQuUyA9IDY2NzsKICAgIHQuVCA9IDYxMTsKICAgIHQuVSA9IDcyMjsKICAgIHQuViA9IDY2NzsKICAgIHQuVyA9IDk0NDsKICAgIHQuWCA9IDY2NzsKICAgIHQuWSA9IDY2NzsKICAgIHQuWiA9IDYxMTsKICAgIHQuYnJhY2tldGxlZnQgPSAyNzg7CiAgICB0LmJhY2tzbGFzaCA9IDI3ODsKICAgIHQuYnJhY2tldHJpZ2h0ID0gMjc4OwogICAgdC5hc2NpaWNpcmN1bSA9IDQ2OTsKICAgIHQudW5kZXJzY29yZSA9IDU1NjsKICAgIHQucXVvdGVsZWZ0ID0gMjIyOwogICAgdC5hID0gNTU2OwogICAgdC5iID0gNTU2OwogICAgdC5jID0gNTAwOwogICAgdC5kID0gNTU2OwogICAgdC5lID0gNTU2OwogICAgdC5mID0gMjc4OwogICAgdC5nID0gNTU2OwogICAgdC5oID0gNTU2OwogICAgdC5pID0gMjIyOwogICAgdC5qID0gMjIyOwogICAgdC5rID0gNTAwOwogICAgdC5sID0gMjIyOwogICAgdC5tID0gODMzOwogICAgdC5uID0gNTU2OwogICAgdC5vID0gNTU2OwogICAgdC5wID0gNTU2OwogICAgdC5xID0gNTU2OwogICAgdC5yID0gMzMzOwogICAgdC5zID0gNTAwOwogICAgdC50ID0gMjc4OwogICAgdC51ID0gNTU2OwogICAgdC52ID0gNTAwOwogICAgdC53ID0gNzIyOwogICAgdC54ID0gNTAwOwogICAgdC55ID0gNTAwOwogICAgdC56ID0gNTAwOwogICAgdC5icmFjZWxlZnQgPSAzMzQ7CiAgICB0LmJhciA9IDI2MDsKICAgIHQuYnJhY2VyaWdodCA9IDMzNDsKICAgIHQuYXNjaWl0aWxkZSA9IDU4NDsKICAgIHQuZXhjbGFtZG93biA9IDMzMzsKICAgIHQuY2VudCA9IDU1NjsKICAgIHQuc3RlcmxpbmcgPSA1NTY7CiAgICB0LmZyYWN0aW9uID0gMTY3OwogICAgdC55ZW4gPSA1NTY7CiAgICB0LmZsb3JpbiA9IDU1NjsKICAgIHQuc2VjdGlvbiA9IDU1NjsKICAgIHQuY3VycmVuY3kgPSA1NTY7CiAgICB0LnF1b3Rlc2luZ2xlID0gMTkxOwogICAgdC5xdW90ZWRibGxlZnQgPSAzMzM7CiAgICB0Lmd1aWxsZW1vdGxlZnQgPSA1NTY7CiAgICB0Lmd1aWxzaW5nbGxlZnQgPSAzMzM7CiAgICB0Lmd1aWxzaW5nbHJpZ2h0ID0gMzMzOwogICAgdC5maSA9IDUwMDsKICAgIHQuZmwgPSA1MDA7CiAgICB0LmVuZGFzaCA9IDU1NjsKICAgIHQuZGFnZ2VyID0gNTU2OwogICAgdC5kYWdnZXJkYmwgPSA1NTY7CiAgICB0LnBlcmlvZGNlbnRlcmVkID0gMjc4OwogICAgdC5wYXJhZ3JhcGggPSA1Mzc7CiAgICB0LmJ1bGxldCA9IDM1MDsKICAgIHQucXVvdGVzaW5nbGJhc2UgPSAyMjI7CiAgICB0LnF1b3RlZGJsYmFzZSA9IDMzMzsKICAgIHQucXVvdGVkYmxyaWdodCA9IDMzMzsKICAgIHQuZ3VpbGxlbW90cmlnaHQgPSA1NTY7CiAgICB0LmVsbGlwc2lzID0gMTAwMDsKICAgIHQucGVydGhvdXNhbmQgPSAxMDAwOwogICAgdC5xdWVzdGlvbmRvd24gPSA2MTE7CiAgICB0LmdyYXZlID0gMzMzOwogICAgdC5hY3V0ZSA9IDMzMzsKICAgIHQuY2lyY3VtZmxleCA9IDMzMzsKICAgIHQudGlsZGUgPSAzMzM7CiAgICB0Lm1hY3JvbiA9IDMzMzsKICAgIHQuYnJldmUgPSAzMzM7CiAgICB0LmRvdGFjY2VudCA9IDMzMzsKICAgIHQuZGllcmVzaXMgPSAzMzM7CiAgICB0LnJpbmcgPSAzMzM7CiAgICB0LmNlZGlsbGEgPSAzMzM7CiAgICB0Lmh1bmdhcnVtbGF1dCA9IDMzMzsKICAgIHQub2dvbmVrID0gMzMzOwogICAgdC5jYXJvbiA9IDMzMzsKICAgIHQuZW1kYXNoID0gMTAwMDsKICAgIHQuQUUgPSAxMDAwOwogICAgdC5vcmRmZW1pbmluZSA9IDM3MDsKICAgIHQuTHNsYXNoID0gNTU2OwogICAgdC5Pc2xhc2ggPSA3Nzg7CiAgICB0Lk9FID0gMTAwMDsKICAgIHQub3JkbWFzY3VsaW5lID0gMzY1OwogICAgdC5hZSA9IDg4OTsKICAgIHQuZG90bGVzc2kgPSAyNzg7CiAgICB0LmxzbGFzaCA9IDIyMjsKICAgIHQub3NsYXNoID0gNjExOwogICAgdC5vZSA9IDk0NDsKICAgIHQuZ2VybWFuZGJscyA9IDYxMTsKICAgIHQuSWRpZXJlc2lzID0gMjc4OwogICAgdC5lYWN1dGUgPSA1NTY7CiAgICB0LmFicmV2ZSA9IDU1NjsKICAgIHQudWh1bmdhcnVtbGF1dCA9IDU1NjsKICAgIHQuZWNhcm9uID0gNTU2OwogICAgdC5ZZGllcmVzaXMgPSA2Njc7CiAgICB0LmRpdmlkZSA9IDU4NDsKICAgIHQuWWFjdXRlID0gNjY3OwogICAgdC5BY2lyY3VtZmxleCA9IDY2NzsKICAgIHQuYWFjdXRlID0gNTU2OwogICAgdC5VY2lyY3VtZmxleCA9IDcyMjsKICAgIHQueWFjdXRlID0gNTAwOwogICAgdC5zY29tbWFhY2NlbnQgPSA1MDA7CiAgICB0LmVjaXJjdW1mbGV4ID0gNTU2OwogICAgdC5VcmluZyA9IDcyMjsKICAgIHQuVWRpZXJlc2lzID0gNzIyOwogICAgdC5hb2dvbmVrID0gNTU2OwogICAgdC5VYWN1dGUgPSA3MjI7CiAgICB0LnVvZ29uZWsgPSA1NTY7CiAgICB0LkVkaWVyZXNpcyA9IDY2NzsKICAgIHQuRGNyb2F0ID0gNzIyOwogICAgdC5jb21tYWFjY2VudCA9IDI1MDsKICAgIHQuY29weXJpZ2h0ID0gNzM3OwogICAgdC5FbWFjcm9uID0gNjY3OwogICAgdC5jY2Fyb24gPSA1MDA7CiAgICB0LmFyaW5nID0gNTU2OwogICAgdC5OY29tbWFhY2NlbnQgPSA3MjI7CiAgICB0LmxhY3V0ZSA9IDIyMjsKICAgIHQuYWdyYXZlID0gNTU2OwogICAgdC5UY29tbWFhY2NlbnQgPSA2MTE7CiAgICB0LkNhY3V0ZSA9IDcyMjsKICAgIHQuYXRpbGRlID0gNTU2OwogICAgdC5FZG90YWNjZW50ID0gNjY3OwogICAgdC5zY2Fyb24gPSA1MDA7CiAgICB0LnNjZWRpbGxhID0gNTAwOwogICAgdC5pYWN1dGUgPSAyNzg7CiAgICB0LmxvemVuZ2UgPSA0NzE7CiAgICB0LlJjYXJvbiA9IDcyMjsKICAgIHQuR2NvbW1hYWNjZW50ID0gNzc4OwogICAgdC51Y2lyY3VtZmxleCA9IDU1NjsKICAgIHQuYWNpcmN1bWZsZXggPSA1NTY7CiAgICB0LkFtYWNyb24gPSA2Njc7CiAgICB0LnJjYXJvbiA9IDMzMzsKICAgIHQuY2NlZGlsbGEgPSA1MDA7CiAgICB0Llpkb3RhY2NlbnQgPSA2MTE7CiAgICB0LlRob3JuID0gNjY3OwogICAgdC5PbWFjcm9uID0gNzc4OwogICAgdC5SYWN1dGUgPSA3MjI7CiAgICB0LlNhY3V0ZSA9IDY2NzsKICAgIHQuZGNhcm9uID0gNjQzOwogICAgdC5VbWFjcm9uID0gNzIyOwogICAgdC51cmluZyA9IDU1NjsKICAgIHQudGhyZWVzdXBlcmlvciA9IDMzMzsKICAgIHQuT2dyYXZlID0gNzc4OwogICAgdC5BZ3JhdmUgPSA2Njc7CiAgICB0LkFicmV2ZSA9IDY2NzsKICAgIHQubXVsdGlwbHkgPSA1ODQ7CiAgICB0LnVhY3V0ZSA9IDU1NjsKICAgIHQuVGNhcm9uID0gNjExOwogICAgdC5wYXJ0aWFsZGlmZiA9IDQ3NjsKICAgIHQueWRpZXJlc2lzID0gNTAwOwogICAgdC5OYWN1dGUgPSA3MjI7CiAgICB0LmljaXJjdW1mbGV4ID0gMjc4OwogICAgdC5FY2lyY3VtZmxleCA9IDY2NzsKICAgIHQuYWRpZXJlc2lzID0gNTU2OwogICAgdC5lZGllcmVzaXMgPSA1NTY7CiAgICB0LmNhY3V0ZSA9IDUwMDsKICAgIHQubmFjdXRlID0gNTU2OwogICAgdC51bWFjcm9uID0gNTU2OwogICAgdC5OY2Fyb24gPSA3MjI7CiAgICB0LklhY3V0ZSA9IDI3ODsKICAgIHQucGx1c21pbnVzID0gNTg0OwogICAgdC5icm9rZW5iYXIgPSAyNjA7CiAgICB0LnJlZ2lzdGVyZWQgPSA3Mzc7CiAgICB0LkdicmV2ZSA9IDc3ODsKICAgIHQuSWRvdGFjY2VudCA9IDI3ODsKICAgIHQuc3VtbWF0aW9uID0gNjAwOwogICAgdC5FZ3JhdmUgPSA2Njc7CiAgICB0LnJhY3V0ZSA9IDMzMzsKICAgIHQub21hY3JvbiA9IDU1NjsKICAgIHQuWmFjdXRlID0gNjExOwogICAgdC5aY2Fyb24gPSA2MTE7CiAgICB0LmdyZWF0ZXJlcXVhbCA9IDU0OTsKICAgIHQuRXRoID0gNzIyOwogICAgdC5DY2VkaWxsYSA9IDcyMjsKICAgIHQubGNvbW1hYWNjZW50ID0gMjIyOwogICAgdC50Y2Fyb24gPSAzMTc7CiAgICB0LmVvZ29uZWsgPSA1NTY7CiAgICB0LlVvZ29uZWsgPSA3MjI7CiAgICB0LkFhY3V0ZSA9IDY2NzsKICAgIHQuQWRpZXJlc2lzID0gNjY3OwogICAgdC5lZ3JhdmUgPSA1NTY7CiAgICB0LnphY3V0ZSA9IDUwMDsKICAgIHQuaW9nb25layA9IDIyMjsKICAgIHQuT2FjdXRlID0gNzc4OwogICAgdC5vYWN1dGUgPSA1NTY7CiAgICB0LmFtYWNyb24gPSA1NTY7CiAgICB0LnNhY3V0ZSA9IDUwMDsKICAgIHQuaWRpZXJlc2lzID0gMjc4OwogICAgdC5PY2lyY3VtZmxleCA9IDc3ODsKICAgIHQuVWdyYXZlID0gNzIyOwogICAgdC5EZWx0YSA9IDYxMjsKICAgIHQudGhvcm4gPSA1NTY7CiAgICB0LnR3b3N1cGVyaW9yID0gMzMzOwogICAgdC5PZGllcmVzaXMgPSA3Nzg7CiAgICB0Lm11ID0gNTU2OwogICAgdC5pZ3JhdmUgPSAyNzg7CiAgICB0Lm9odW5nYXJ1bWxhdXQgPSA1NTY7CiAgICB0LkVvZ29uZWsgPSA2Njc7CiAgICB0LmRjcm9hdCA9IDU1NjsKICAgIHQudGhyZWVxdWFydGVycyA9IDgzNDsKICAgIHQuU2NlZGlsbGEgPSA2Njc7CiAgICB0LmxjYXJvbiA9IDI5OTsKICAgIHQuS2NvbW1hYWNjZW50ID0gNjY3OwogICAgdC5MYWN1dGUgPSA1NTY7CiAgICB0LnRyYWRlbWFyayA9IDEwMDA7CiAgICB0LmVkb3RhY2NlbnQgPSA1NTY7CiAgICB0LklncmF2ZSA9IDI3ODsKICAgIHQuSW1hY3JvbiA9IDI3ODsKICAgIHQuTGNhcm9uID0gNTU2OwogICAgdC5vbmVoYWxmID0gODM0OwogICAgdC5sZXNzZXF1YWwgPSA1NDk7CiAgICB0Lm9jaXJjdW1mbGV4ID0gNTU2OwogICAgdC5udGlsZGUgPSA1NTY7CiAgICB0LlVodW5nYXJ1bWxhdXQgPSA3MjI7CiAgICB0LkVhY3V0ZSA9IDY2NzsKICAgIHQuZW1hY3JvbiA9IDU1NjsKICAgIHQuZ2JyZXZlID0gNTU2OwogICAgdC5vbmVxdWFydGVyID0gODM0OwogICAgdC5TY2Fyb24gPSA2Njc7CiAgICB0LlNjb21tYWFjY2VudCA9IDY2NzsKICAgIHQuT2h1bmdhcnVtbGF1dCA9IDc3ODsKICAgIHQuZGVncmVlID0gNDAwOwogICAgdC5vZ3JhdmUgPSA1NTY7CiAgICB0LkNjYXJvbiA9IDcyMjsKICAgIHQudWdyYXZlID0gNTU2OwogICAgdC5yYWRpY2FsID0gNDUzOwogICAgdC5EY2Fyb24gPSA3MjI7CiAgICB0LnJjb21tYWFjY2VudCA9IDMzMzsKICAgIHQuTnRpbGRlID0gNzIyOwogICAgdC5vdGlsZGUgPSA1NTY7CiAgICB0LlJjb21tYWFjY2VudCA9IDcyMjsKICAgIHQuTGNvbW1hYWNjZW50ID0gNTU2OwogICAgdC5BdGlsZGUgPSA2Njc7CiAgICB0LkFvZ29uZWsgPSA2Njc7CiAgICB0LkFyaW5nID0gNjY3OwogICAgdC5PdGlsZGUgPSA3Nzg7CiAgICB0Lnpkb3RhY2NlbnQgPSA1MDA7CiAgICB0LkVjYXJvbiA9IDY2NzsKICAgIHQuSW9nb25layA9IDI3ODsKICAgIHQua2NvbW1hYWNjZW50ID0gNTAwOwogICAgdC5taW51cyA9IDU4NDsKICAgIHQuSWNpcmN1bWZsZXggPSAyNzg7CiAgICB0Lm5jYXJvbiA9IDU1NjsKICAgIHQudGNvbW1hYWNjZW50ID0gMjc4OwogICAgdC5sb2dpY2Fsbm90ID0gNTg0OwogICAgdC5vZGllcmVzaXMgPSA1NTY7CiAgICB0LnVkaWVyZXNpcyA9IDU1NjsKICAgIHQubm90ZXF1YWwgPSA1NDk7CiAgICB0Lmdjb21tYWFjY2VudCA9IDU1NjsKICAgIHQuZXRoID0gNTU2OwogICAgdC56Y2Fyb24gPSA1MDA7CiAgICB0Lm5jb21tYWFjY2VudCA9IDU1NjsKICAgIHQub25lc3VwZXJpb3IgPSAzMzM7CiAgICB0LmltYWNyb24gPSAyNzg7CiAgICB0LkV1cm8gPSA1NTY7CiAgfSk7CiAgdFsiSGVsdmV0aWNhLUJvbGQiXSA9ICgwLCBfY29yZV91dGlscy5nZXRMb29rdXBUYWJsZUZhY3RvcnkpKGZ1bmN0aW9uICh0KSB7CiAgICB0LnNwYWNlID0gMjc4OwogICAgdC5leGNsYW0gPSAzMzM7CiAgICB0LnF1b3RlZGJsID0gNDc0OwogICAgdC5udW1iZXJzaWduID0gNTU2OwogICAgdC5kb2xsYXIgPSA1NTY7CiAgICB0LnBlcmNlbnQgPSA4ODk7CiAgICB0LmFtcGVyc2FuZCA9IDcyMjsKICAgIHQucXVvdGVyaWdodCA9IDI3ODsKICAgIHQucGFyZW5sZWZ0ID0gMzMzOwogICAgdC5wYXJlbnJpZ2h0ID0gMzMzOwogICAgdC5hc3RlcmlzayA9IDM4OTsKICAgIHQucGx1cyA9IDU4NDsKICAgIHQuY29tbWEgPSAyNzg7CiAgICB0Lmh5cGhlbiA9IDMzMzsKICAgIHQucGVyaW9kID0gMjc4OwogICAgdC5zbGFzaCA9IDI3ODsKICAgIHQuemVybyA9IDU1NjsKICAgIHQub25lID0gNTU2OwogICAgdC50d28gPSA1NTY7CiAgICB0LnRocmVlID0gNTU2OwogICAgdC5mb3VyID0gNTU2OwogICAgdC5maXZlID0gNTU2OwogICAgdC5zaXggPSA1NTY7CiAgICB0LnNldmVuID0gNTU2OwogICAgdC5laWdodCA9IDU1NjsKICAgIHQubmluZSA9IDU1NjsKICAgIHQuY29sb24gPSAzMzM7CiAgICB0LnNlbWljb2xvbiA9IDMzMzsKICAgIHQubGVzcyA9IDU4NDsKICAgIHQuZXF1YWwgPSA1ODQ7CiAgICB0LmdyZWF0ZXIgPSA1ODQ7CiAgICB0LnF1ZXN0aW9uID0gNjExOwogICAgdC5hdCA9IDk3NTsKICAgIHQuQSA9IDcyMjsKICAgIHQuQiA9IDcyMjsKICAgIHQuQyA9IDcyMjsKICAgIHQuRCA9IDcyMjsKICAgIHQuRSA9IDY2NzsKICAgIHQuRiA9IDYxMTsKICAgIHQuRyA9IDc3ODsKICAgIHQuSCA9IDcyMjsKICAgIHQuSSA9IDI3ODsKICAgIHQuSiA9IDU1NjsKICAgIHQuSyA9IDcyMjsKICAgIHQuTCA9IDYxMTsKICAgIHQuTSA9IDgzMzsKICAgIHQuTiA9IDcyMjsKICAgIHQuTyA9IDc3ODsKICAgIHQuUCA9IDY2NzsKICAgIHQuUSA9IDc3ODsKICAgIHQuUiA9IDcyMjsKICAgIHQuUyA9IDY2NzsKICAgIHQuVCA9IDYxMTsKICAgIHQuVSA9IDcyMjsKICAgIHQuViA9IDY2NzsKICAgIHQuVyA9IDk0NDsKICAgIHQuWCA9IDY2NzsKICAgIHQuWSA9IDY2NzsKICAgIHQuWiA9IDYxMTsKICAgIHQuYnJhY2tldGxlZnQgPSAzMzM7CiAgICB0LmJhY2tzbGFzaCA9IDI3ODsKICAgIHQuYnJhY2tldHJpZ2h0ID0gMzMzOwogICAgdC5hc2NpaWNpcmN1bSA9IDU4NDsKICAgIHQudW5kZXJzY29yZSA9IDU1NjsKICAgIHQucXVvdGVsZWZ0ID0gMjc4OwogICAgdC5hID0gNTU2OwogICAgdC5iID0gNjExOwogICAgdC5jID0gNTU2OwogICAgdC5kID0gNjExOwogICAgdC5lID0gNTU2OwogICAgdC5mID0gMzMzOwogICAgdC5nID0gNjExOwogICAgdC5oID0gNjExOwogICAgdC5pID0gMjc4OwogICAgdC5qID0gMjc4OwogICAgdC5rID0gNTU2OwogICAgdC5sID0gMjc4OwogICAgdC5tID0gODg5OwogICAgdC5uID0gNjExOwogICAgdC5vID0gNjExOwogICAgdC5wID0gNjExOwogICAgdC5xID0gNjExOwogICAgdC5yID0gMzg5OwogICAgdC5zID0gNTU2OwogICAgdC50ID0gMzMzOwogICAgdC51ID0gNjExOwogICAgdC52ID0gNTU2OwogICAgdC53ID0gNzc4OwogICAgdC54ID0gNTU2OwogICAgdC55ID0gNTU2OwogICAgdC56ID0gNTAwOwogICAgdC5icmFjZWxlZnQgPSAzODk7CiAgICB0LmJhciA9IDI4MDsKICAgIHQuYnJhY2VyaWdodCA9IDM4OTsKICAgIHQuYXNjaWl0aWxkZSA9IDU4NDsKICAgIHQuZXhjbGFtZG93biA9IDMzMzsKICAgIHQuY2VudCA9IDU1NjsKICAgIHQuc3RlcmxpbmcgPSA1NTY7CiAgICB0LmZyYWN0aW9uID0gMTY3OwogICAgdC55ZW4gPSA1NTY7CiAgICB0LmZsb3JpbiA9IDU1NjsKICAgIHQuc2VjdGlvbiA9IDU1NjsKICAgIHQuY3VycmVuY3kgPSA1NTY7CiAgICB0LnF1b3Rlc2luZ2xlID0gMjM4OwogICAgdC5xdW90ZWRibGxlZnQgPSA1MDA7CiAgICB0Lmd1aWxsZW1vdGxlZnQgPSA1NTY7CiAgICB0Lmd1aWxzaW5nbGxlZnQgPSAzMzM7CiAgICB0Lmd1aWxzaW5nbHJpZ2h0ID0gMzMzOwogICAgdC5maSA9IDYxMTsKICAgIHQuZmwgPSA2MTE7CiAgICB0LmVuZGFzaCA9IDU1NjsKICAgIHQuZGFnZ2VyID0gNTU2OwogICAgdC5kYWdnZXJkYmwgPSA1NTY7CiAgICB0LnBlcmlvZGNlbnRlcmVkID0gMjc4OwogICAgdC5wYXJhZ3JhcGggPSA1NTY7CiAgICB0LmJ1bGxldCA9IDM1MDsKICAgIHQucXVvdGVzaW5nbGJhc2UgPSAyNzg7CiAgICB0LnF1b3RlZGJsYmFzZSA9IDUwMDsKICAgIHQucXVvdGVkYmxyaWdodCA9IDUwMDsKICAgIHQuZ3VpbGxlbW90cmlnaHQgPSA1NTY7CiAgICB0LmVsbGlwc2lzID0gMTAwMDsKICAgIHQucGVydGhvdXNhbmQgPSAxMDAwOwogICAgdC5xdWVzdGlvbmRvd24gPSA2MTE7CiAgICB0LmdyYXZlID0gMzMzOwogICAgdC5hY3V0ZSA9IDMzMzsKICAgIHQuY2lyY3VtZmxleCA9IDMzMzsKICAgIHQudGlsZGUgPSAzMzM7CiAgICB0Lm1hY3JvbiA9IDMzMzsKICAgIHQuYnJldmUgPSAzMzM7CiAgICB0LmRvdGFjY2VudCA9IDMzMzsKICAgIHQuZGllcmVzaXMgPSAzMzM7CiAgICB0LnJpbmcgPSAzMzM7CiAgICB0LmNlZGlsbGEgPSAzMzM7CiAgICB0Lmh1bmdhcnVtbGF1dCA9IDMzMzsKICAgIHQub2dvbmVrID0gMzMzOwogICAgdC5jYXJvbiA9IDMzMzsKICAgIHQuZW1kYXNoID0gMTAwMDsKICAgIHQuQUUgPSAxMDAwOwogICAgdC5vcmRmZW1pbmluZSA9IDM3MDsKICAgIHQuTHNsYXNoID0gNjExOwogICAgdC5Pc2xhc2ggPSA3Nzg7CiAgICB0Lk9FID0gMTAwMDsKICAgIHQub3JkbWFzY3VsaW5lID0gMzY1OwogICAgdC5hZSA9IDg4OTsKICAgIHQuZG90bGVzc2kgPSAyNzg7CiAgICB0LmxzbGFzaCA9IDI3ODsKICAgIHQub3NsYXNoID0gNjExOwogICAgdC5vZSA9IDk0NDsKICAgIHQuZ2VybWFuZGJscyA9IDYxMTsKICAgIHQuSWRpZXJlc2lzID0gMjc4OwogICAgdC5lYWN1dGUgPSA1NTY7CiAgICB0LmFicmV2ZSA9IDU1NjsKICAgIHQudWh1bmdhcnVtbGF1dCA9IDYxMTsKICAgIHQuZWNhcm9uID0gNTU2OwogICAgdC5ZZGllcmVzaXMgPSA2Njc7CiAgICB0LmRpdmlkZSA9IDU4NDsKICAgIHQuWWFjdXRlID0gNjY3OwogICAgdC5BY2lyY3VtZmxleCA9IDcyMjsKICAgIHQuYWFjdXRlID0gNTU2OwogICAgdC5VY2lyY3VtZmxleCA9IDcyMjsKICAgIHQueWFjdXRlID0gNTU2OwogICAgdC5zY29tbWFhY2NlbnQgPSA1NTY7CiAgICB0LmVjaXJjdW1mbGV4ID0gNTU2OwogICAgdC5VcmluZyA9IDcyMjsKICAgIHQuVWRpZXJlc2lzID0gNzIyOwogICAgdC5hb2dvbmVrID0gNTU2OwogICAgdC5VYWN1dGUgPSA3MjI7CiAgICB0LnVvZ29uZWsgPSA2MTE7CiAgICB0LkVkaWVyZXNpcyA9IDY2NzsKICAgIHQuRGNyb2F0ID0gNzIyOwogICAgdC5jb21tYWFjY2VudCA9IDI1MDsKICAgIHQuY29weXJpZ2h0ID0gNzM3OwogICAgdC5FbWFjcm9uID0gNjY3OwogICAgdC5jY2Fyb24gPSA1NTY7CiAgICB0LmFyaW5nID0gNTU2OwogICAgdC5OY29tbWFhY2NlbnQgPSA3MjI7CiAgICB0LmxhY3V0ZSA9IDI3ODsKICAgIHQuYWdyYXZlID0gNTU2OwogICAgdC5UY29tbWFhY2NlbnQgPSA2MTE7CiAgICB0LkNhY3V0ZSA9IDcyMjsKICAgIHQuYXRpbGRlID0gNTU2OwogICAgdC5FZG90YWNjZW50ID0gNjY3OwogICAgdC5zY2Fyb24gPSA1NTY7CiAgICB0LnNjZWRpbGxhID0gNTU2OwogICAgdC5pYWN1dGUgPSAyNzg7CiAgICB0LmxvemVuZ2UgPSA0OTQ7CiAgICB0LlJjYXJvbiA9IDcyMjsKICAgIHQuR2NvbW1hYWNjZW50ID0gNzc4OwogICAgdC51Y2lyY3VtZmxleCA9IDYxMTsKICAgIHQuYWNpcmN1bWZsZXggPSA1NTY7CiAgICB0LkFtYWNyb24gPSA3MjI7CiAgICB0LnJjYXJvbiA9IDM4OTsKICAgIHQuY2NlZGlsbGEgPSA1NTY7CiAgICB0Llpkb3RhY2NlbnQgPSA2MTE7CiAgICB0LlRob3JuID0gNjY3OwogICAgdC5PbWFjcm9uID0gNzc4OwogICAgdC5SYWN1dGUgPSA3MjI7CiAgICB0LlNhY3V0ZSA9IDY2NzsKICAgIHQuZGNhcm9uID0gNzQzOwogICAgdC5VbWFjcm9uID0gNzIyOwogICAgdC51cmluZyA9IDYxMTsKICAgIHQudGhyZWVzdXBlcmlvciA9IDMzMzsKICAgIHQuT2dyYXZlID0gNzc4OwogICAgdC5BZ3JhdmUgPSA3MjI7CiAgICB0LkFicmV2ZSA9IDcyMjsKICAgIHQubXVsdGlwbHkgPSA1ODQ7CiAgICB0LnVhY3V0ZSA9IDYxMTsKICAgIHQuVGNhcm9uID0gNjExOwogICAgdC5wYXJ0aWFsZGlmZiA9IDQ5NDsKICAgIHQueWRpZXJlc2lzID0gNTU2OwogICAgdC5OYWN1dGUgPSA3MjI7CiAgICB0LmljaXJjdW1mbGV4ID0gMjc4OwogICAgdC5FY2lyY3VtZmxleCA9IDY2NzsKICAgIHQuYWRpZXJlc2lzID0gNTU2OwogICAgdC5lZGllcmVzaXMgPSA1NTY7CiAgICB0LmNhY3V0ZSA9IDU1NjsKICAgIHQubmFjdXRlID0gNjExOwogICAgdC51bWFjcm9uID0gNjExOwogICAgdC5OY2Fyb24gPSA3MjI7CiAgICB0LklhY3V0ZSA9IDI3ODsKICAgIHQucGx1c21pbnVzID0gNTg0OwogICAgdC5icm9rZW5iYXIgPSAyODA7CiAgICB0LnJlZ2lzdGVyZWQgPSA3Mzc7CiAgICB0LkdicmV2ZSA9IDc3ODsKICAgIHQuSWRvdGFjY2VudCA9IDI3ODsKICAgIHQuc3VtbWF0aW9uID0gNjAwOwogICAgdC5FZ3JhdmUgPSA2Njc7CiAgICB0LnJhY3V0ZSA9IDM4OTsKICAgIHQub21hY3JvbiA9IDYxMTsKICAgIHQuWmFjdXRlID0gNjExOwogICAgdC5aY2Fyb24gPSA2MTE7CiAgICB0LmdyZWF0ZXJlcXVhbCA9IDU0OTsKICAgIHQuRXRoID0gNzIyOwogICAgdC5DY2VkaWxsYSA9IDcyMjsKICAgIHQubGNvbW1hYWNjZW50ID0gMjc4OwogICAgdC50Y2Fyb24gPSAzODk7CiAgICB0LmVvZ29uZWsgPSA1NTY7CiAgICB0LlVvZ29uZWsgPSA3MjI7CiAgICB0LkFhY3V0ZSA9IDcyMjsKICAgIHQuQWRpZXJlc2lzID0gNzIyOwogICAgdC5lZ3JhdmUgPSA1NTY7CiAgICB0LnphY3V0ZSA9IDUwMDsKICAgIHQuaW9nb25layA9IDI3ODsKICAgIHQuT2FjdXRlID0gNzc4OwogICAgdC5vYWN1dGUgPSA2MTE7CiAgICB0LmFtYWNyb24gPSA1NTY7CiAgICB0LnNhY3V0ZSA9IDU1NjsKICAgIHQuaWRpZXJlc2lzID0gMjc4OwogICAgdC5PY2lyY3VtZmxleCA9IDc3ODsKICAgIHQuVWdyYXZlID0gNzIyOwogICAgdC5EZWx0YSA9IDYxMjsKICAgIHQudGhvcm4gPSA2MTE7CiAgICB0LnR3b3N1cGVyaW9yID0gMzMzOwogICAgdC5PZGllcmVzaXMgPSA3Nzg7CiAgICB0Lm11ID0gNjExOwogICAgdC5pZ3JhdmUgPSAyNzg7CiAgICB0Lm9odW5nYXJ1bWxhdXQgPSA2MTE7CiAgICB0LkVvZ29uZWsgPSA2Njc7CiAgICB0LmRjcm9hdCA9IDYxMTsKICAgIHQudGhyZWVxdWFydGVycyA9IDgzNDsKICAgIHQuU2NlZGlsbGEgPSA2Njc7CiAgICB0LmxjYXJvbiA9IDQwMDsKICAgIHQuS2NvbW1hYWNjZW50ID0gNzIyOwogICAgdC5MYWN1dGUgPSA2MTE7CiAgICB0LnRyYWRlbWFyayA9IDEwMDA7CiAgICB0LmVkb3RhY2NlbnQgPSA1NTY7CiAgICB0LklncmF2ZSA9IDI3ODsKICAgIHQuSW1hY3JvbiA9IDI3ODsKICAgIHQuTGNhcm9uID0gNjExOwogICAgdC5vbmVoYWxmID0gODM0OwogICAgdC5sZXNzZXF1YWwgPSA1NDk7CiAgICB0Lm9jaXJjdW1mbGV4ID0gNjExOwogICAgdC5udGlsZGUgPSA2MTE7CiAgICB0LlVodW5nYXJ1bWxhdXQgPSA3MjI7CiAgICB0LkVhY3V0ZSA9IDY2NzsKICAgIHQuZW1hY3JvbiA9IDU1NjsKICAgIHQuZ2JyZXZlID0gNjExOwogICAgdC5vbmVxdWFydGVyID0gODM0OwogICAgdC5TY2Fyb24gPSA2Njc7CiAgICB0LlNjb21tYWFjY2VudCA9IDY2NzsKICAgIHQuT2h1bmdhcnVtbGF1dCA9IDc3ODsKICAgIHQuZGVncmVlID0gNDAwOwogICAgdC5vZ3JhdmUgPSA2MTE7CiAgICB0LkNjYXJvbiA9IDcyMjsKICAgIHQudWdyYXZlID0gNjExOwogICAgdC5yYWRpY2FsID0gNTQ5OwogICAgdC5EY2Fyb24gPSA3MjI7CiAgICB0LnJjb21tYWFjY2VudCA9IDM4OTsKICAgIHQuTnRpbGRlID0gNzIyOwogICAgdC5vdGlsZGUgPSA2MTE7CiAgICB0LlJjb21tYWFjY2VudCA9IDcyMjsKICAgIHQuTGNvbW1hYWNjZW50ID0gNjExOwogICAgdC5BdGlsZGUgPSA3MjI7CiAgICB0LkFvZ29uZWsgPSA3MjI7CiAgICB0LkFyaW5nID0gNzIyOwogICAgdC5PdGlsZGUgPSA3Nzg7CiAgICB0Lnpkb3RhY2NlbnQgPSA1MDA7CiAgICB0LkVjYXJvbiA9IDY2NzsKICAgIHQuSW9nb25layA9IDI3ODsKICAgIHQua2NvbW1hYWNjZW50ID0gNTU2OwogICAgdC5taW51cyA9IDU4NDsKICAgIHQuSWNpcmN1bWZsZXggPSAyNzg7CiAgICB0Lm5jYXJvbiA9IDYxMTsKICAgIHQudGNvbW1hYWNjZW50ID0gMzMzOwogICAgdC5sb2dpY2Fsbm90ID0gNTg0OwogICAgdC5vZGllcmVzaXMgPSA2MTE7CiAgICB0LnVkaWVyZXNpcyA9IDYxMTsKICAgIHQubm90ZXF1YWwgPSA1NDk7CiAgICB0Lmdjb21tYWFjY2VudCA9IDYxMTsKICAgIHQuZXRoID0gNjExOwogICAgdC56Y2Fyb24gPSA1MDA7CiAgICB0Lm5jb21tYWFjY2VudCA9IDYxMTsKICAgIHQub25lc3VwZXJpb3IgPSAzMzM7CiAgICB0LmltYWNyb24gPSAyNzg7CiAgICB0LkV1cm8gPSA1NTY7CiAgfSk7CiAgdFsiSGVsdmV0aWNhLUJvbGRPYmxpcXVlIl0gPSAoMCwgX2NvcmVfdXRpbHMuZ2V0TG9va3VwVGFibGVGYWN0b3J5KShmdW5jdGlvbiAodCkgewogICAgdC5zcGFjZSA9IDI3ODsKICAgIHQuZXhjbGFtID0gMzMzOwogICAgdC5xdW90ZWRibCA9IDQ3NDsKICAgIHQubnVtYmVyc2lnbiA9IDU1NjsKICAgIHQuZG9sbGFyID0gNTU2OwogICAgdC5wZXJjZW50ID0gODg5OwogICAgdC5hbXBlcnNhbmQgPSA3MjI7CiAgICB0LnF1b3RlcmlnaHQgPSAyNzg7CiAgICB0LnBhcmVubGVmdCA9IDMzMzsKICAgIHQucGFyZW5yaWdodCA9IDMzMzsKICAgIHQuYXN0ZXJpc2sgPSAzODk7CiAgICB0LnBsdXMgPSA1ODQ7CiAgICB0LmNvbW1hID0gMjc4OwogICAgdC5oeXBoZW4gPSAzMzM7CiAgICB0LnBlcmlvZCA9IDI3ODsKICAgIHQuc2xhc2ggPSAyNzg7CiAgICB0Lnplcm8gPSA1NTY7CiAgICB0Lm9uZSA9IDU1NjsKICAgIHQudHdvID0gNTU2OwogICAgdC50aHJlZSA9IDU1NjsKICAgIHQuZm91ciA9IDU1NjsKICAgIHQuZml2ZSA9IDU1NjsKICAgIHQuc2l4ID0gNTU2OwogICAgdC5zZXZlbiA9IDU1NjsKICAgIHQuZWlnaHQgPSA1NTY7CiAgICB0Lm5pbmUgPSA1NTY7CiAgICB0LmNvbG9uID0gMzMzOwogICAgdC5zZW1pY29sb24gPSAzMzM7CiAgICB0Lmxlc3MgPSA1ODQ7CiAgICB0LmVxdWFsID0gNTg0OwogICAgdC5ncmVhdGVyID0gNTg0OwogICAgdC5xdWVzdGlvbiA9IDYxMTsKICAgIHQuYXQgPSA5NzU7CiAgICB0LkEgPSA3MjI7CiAgICB0LkIgPSA3MjI7CiAgICB0LkMgPSA3MjI7CiAgICB0LkQgPSA3MjI7CiAgICB0LkUgPSA2Njc7CiAgICB0LkYgPSA2MTE7CiAgICB0LkcgPSA3Nzg7CiAgICB0LkggPSA3MjI7CiAgICB0LkkgPSAyNzg7CiAgICB0LkogPSA1NTY7CiAgICB0LksgPSA3MjI7CiAgICB0LkwgPSA2MTE7CiAgICB0Lk0gPSA4MzM7CiAgICB0Lk4gPSA3MjI7CiAgICB0Lk8gPSA3Nzg7CiAgICB0LlAgPSA2Njc7CiAgICB0LlEgPSA3Nzg7CiAgICB0LlIgPSA3MjI7CiAgICB0LlMgPSA2Njc7CiAgICB0LlQgPSA2MTE7CiAgICB0LlUgPSA3MjI7CiAgICB0LlYgPSA2Njc7CiAgICB0LlcgPSA5NDQ7CiAgICB0LlggPSA2Njc7CiAgICB0LlkgPSA2Njc7CiAgICB0LlogPSA2MTE7CiAgICB0LmJyYWNrZXRsZWZ0ID0gMzMzOwogICAgdC5iYWNrc2xhc2ggPSAyNzg7CiAgICB0LmJyYWNrZXRyaWdodCA9IDMzMzsKICAgIHQuYXNjaWljaXJjdW0gPSA1ODQ7CiAgICB0LnVuZGVyc2NvcmUgPSA1NTY7CiAgICB0LnF1b3RlbGVmdCA9IDI3ODsKICAgIHQuYSA9IDU1NjsKICAgIHQuYiA9IDYxMTsKICAgIHQuYyA9IDU1NjsKICAgIHQuZCA9IDYxMTsKICAgIHQuZSA9IDU1NjsKICAgIHQuZiA9IDMzMzsKICAgIHQuZyA9IDYxMTsKICAgIHQuaCA9IDYxMTsKICAgIHQuaSA9IDI3ODsKICAgIHQuaiA9IDI3ODsKICAgIHQuayA9IDU1NjsKICAgIHQubCA9IDI3ODsKICAgIHQubSA9IDg4OTsKICAgIHQubiA9IDYxMTsKICAgIHQubyA9IDYxMTsKICAgIHQucCA9IDYxMTsKICAgIHQucSA9IDYxMTsKICAgIHQuciA9IDM4OTsKICAgIHQucyA9IDU1NjsKICAgIHQudCA9IDMzMzsKICAgIHQudSA9IDYxMTsKICAgIHQudiA9IDU1NjsKICAgIHQudyA9IDc3ODsKICAgIHQueCA9IDU1NjsKICAgIHQueSA9IDU1NjsKICAgIHQueiA9IDUwMDsKICAgIHQuYnJhY2VsZWZ0ID0gMzg5OwogICAgdC5iYXIgPSAyODA7CiAgICB0LmJyYWNlcmlnaHQgPSAzODk7CiAgICB0LmFzY2lpdGlsZGUgPSA1ODQ7CiAgICB0LmV4Y2xhbWRvd24gPSAzMzM7CiAgICB0LmNlbnQgPSA1NTY7CiAgICB0LnN0ZXJsaW5nID0gNTU2OwogICAgdC5mcmFjdGlvbiA9IDE2NzsKICAgIHQueWVuID0gNTU2OwogICAgdC5mbG9yaW4gPSA1NTY7CiAgICB0LnNlY3Rpb24gPSA1NTY7CiAgICB0LmN1cnJlbmN5ID0gNTU2OwogICAgdC5xdW90ZXNpbmdsZSA9IDIzODsKICAgIHQucXVvdGVkYmxsZWZ0ID0gNTAwOwogICAgdC5ndWlsbGVtb3RsZWZ0ID0gNTU2OwogICAgdC5ndWlsc2luZ2xsZWZ0ID0gMzMzOwogICAgdC5ndWlsc2luZ2xyaWdodCA9IDMzMzsKICAgIHQuZmkgPSA2MTE7CiAgICB0LmZsID0gNjExOwogICAgdC5lbmRhc2ggPSA1NTY7CiAgICB0LmRhZ2dlciA9IDU1NjsKICAgIHQuZGFnZ2VyZGJsID0gNTU2OwogICAgdC5wZXJpb2RjZW50ZXJlZCA9IDI3ODsKICAgIHQucGFyYWdyYXBoID0gNTU2OwogICAgdC5idWxsZXQgPSAzNTA7CiAgICB0LnF1b3Rlc2luZ2xiYXNlID0gMjc4OwogICAgdC5xdW90ZWRibGJhc2UgPSA1MDA7CiAgICB0LnF1b3RlZGJscmlnaHQgPSA1MDA7CiAgICB0Lmd1aWxsZW1vdHJpZ2h0ID0gNTU2OwogICAgdC5lbGxpcHNpcyA9IDEwMDA7CiAgICB0LnBlcnRob3VzYW5kID0gMTAwMDsKICAgIHQucXVlc3Rpb25kb3duID0gNjExOwogICAgdC5ncmF2ZSA9IDMzMzsKICAgIHQuYWN1dGUgPSAzMzM7CiAgICB0LmNpcmN1bWZsZXggPSAzMzM7CiAgICB0LnRpbGRlID0gMzMzOwogICAgdC5tYWNyb24gPSAzMzM7CiAgICB0LmJyZXZlID0gMzMzOwogICAgdC5kb3RhY2NlbnQgPSAzMzM7CiAgICB0LmRpZXJlc2lzID0gMzMzOwogICAgdC5yaW5nID0gMzMzOwogICAgdC5jZWRpbGxhID0gMzMzOwogICAgdC5odW5nYXJ1bWxhdXQgPSAzMzM7CiAgICB0Lm9nb25layA9IDMzMzsKICAgIHQuY2Fyb24gPSAzMzM7CiAgICB0LmVtZGFzaCA9IDEwMDA7CiAgICB0LkFFID0gMTAwMDsKICAgIHQub3JkZmVtaW5pbmUgPSAzNzA7CiAgICB0LkxzbGFzaCA9IDYxMTsKICAgIHQuT3NsYXNoID0gNzc4OwogICAgdC5PRSA9IDEwMDA7CiAgICB0Lm9yZG1hc2N1bGluZSA9IDM2NTsKICAgIHQuYWUgPSA4ODk7CiAgICB0LmRvdGxlc3NpID0gMjc4OwogICAgdC5sc2xhc2ggPSAyNzg7CiAgICB0Lm9zbGFzaCA9IDYxMTsKICAgIHQub2UgPSA5NDQ7CiAgICB0Lmdlcm1hbmRibHMgPSA2MTE7CiAgICB0LklkaWVyZXNpcyA9IDI3ODsKICAgIHQuZWFjdXRlID0gNTU2OwogICAgdC5hYnJldmUgPSA1NTY7CiAgICB0LnVodW5nYXJ1bWxhdXQgPSA2MTE7CiAgICB0LmVjYXJvbiA9IDU1NjsKICAgIHQuWWRpZXJlc2lzID0gNjY3OwogICAgdC5kaXZpZGUgPSA1ODQ7CiAgICB0LllhY3V0ZSA9IDY2NzsKICAgIHQuQWNpcmN1bWZsZXggPSA3MjI7CiAgICB0LmFhY3V0ZSA9IDU1NjsKICAgIHQuVWNpcmN1bWZsZXggPSA3MjI7CiAgICB0LnlhY3V0ZSA9IDU1NjsKICAgIHQuc2NvbW1hYWNjZW50ID0gNTU2OwogICAgdC5lY2lyY3VtZmxleCA9IDU1NjsKICAgIHQuVXJpbmcgPSA3MjI7CiAgICB0LlVkaWVyZXNpcyA9IDcyMjsKICAgIHQuYW9nb25layA9IDU1NjsKICAgIHQuVWFjdXRlID0gNzIyOwogICAgdC51b2dvbmVrID0gNjExOwogICAgdC5FZGllcmVzaXMgPSA2Njc7CiAgICB0LkRjcm9hdCA9IDcyMjsKICAgIHQuY29tbWFhY2NlbnQgPSAyNTA7CiAgICB0LmNvcHlyaWdodCA9IDczNzsKICAgIHQuRW1hY3JvbiA9IDY2NzsKICAgIHQuY2Nhcm9uID0gNTU2OwogICAgdC5hcmluZyA9IDU1NjsKICAgIHQuTmNvbW1hYWNjZW50ID0gNzIyOwogICAgdC5sYWN1dGUgPSAyNzg7CiAgICB0LmFncmF2ZSA9IDU1NjsKICAgIHQuVGNvbW1hYWNjZW50ID0gNjExOwogICAgdC5DYWN1dGUgPSA3MjI7CiAgICB0LmF0aWxkZSA9IDU1NjsKICAgIHQuRWRvdGFjY2VudCA9IDY2NzsKICAgIHQuc2Nhcm9uID0gNTU2OwogICAgdC5zY2VkaWxsYSA9IDU1NjsKICAgIHQuaWFjdXRlID0gMjc4OwogICAgdC5sb3plbmdlID0gNDk0OwogICAgdC5SY2Fyb24gPSA3MjI7CiAgICB0Lkdjb21tYWFjY2VudCA9IDc3ODsKICAgIHQudWNpcmN1bWZsZXggPSA2MTE7CiAgICB0LmFjaXJjdW1mbGV4ID0gNTU2OwogICAgdC5BbWFjcm9uID0gNzIyOwogICAgdC5yY2Fyb24gPSAzODk7CiAgICB0LmNjZWRpbGxhID0gNTU2OwogICAgdC5aZG90YWNjZW50ID0gNjExOwogICAgdC5UaG9ybiA9IDY2NzsKICAgIHQuT21hY3JvbiA9IDc3ODsKICAgIHQuUmFjdXRlID0gNzIyOwogICAgdC5TYWN1dGUgPSA2Njc7CiAgICB0LmRjYXJvbiA9IDc0MzsKICAgIHQuVW1hY3JvbiA9IDcyMjsKICAgIHQudXJpbmcgPSA2MTE7CiAgICB0LnRocmVlc3VwZXJpb3IgPSAzMzM7CiAgICB0Lk9ncmF2ZSA9IDc3ODsKICAgIHQuQWdyYXZlID0gNzIyOwogICAgdC5BYnJldmUgPSA3MjI7CiAgICB0Lm11bHRpcGx5ID0gNTg0OwogICAgdC51YWN1dGUgPSA2MTE7CiAgICB0LlRjYXJvbiA9IDYxMTsKICAgIHQucGFydGlhbGRpZmYgPSA0OTQ7CiAgICB0LnlkaWVyZXNpcyA9IDU1NjsKICAgIHQuTmFjdXRlID0gNzIyOwogICAgdC5pY2lyY3VtZmxleCA9IDI3ODsKICAgIHQuRWNpcmN1bWZsZXggPSA2Njc7CiAgICB0LmFkaWVyZXNpcyA9IDU1NjsKICAgIHQuZWRpZXJlc2lzID0gNTU2OwogICAgdC5jYWN1dGUgPSA1NTY7CiAgICB0Lm5hY3V0ZSA9IDYxMTsKICAgIHQudW1hY3JvbiA9IDYxMTsKICAgIHQuTmNhcm9uID0gNzIyOwogICAgdC5JYWN1dGUgPSAyNzg7CiAgICB0LnBsdXNtaW51cyA9IDU4NDsKICAgIHQuYnJva2VuYmFyID0gMjgwOwogICAgdC5yZWdpc3RlcmVkID0gNzM3OwogICAgdC5HYnJldmUgPSA3Nzg7CiAgICB0Lklkb3RhY2NlbnQgPSAyNzg7CiAgICB0LnN1bW1hdGlvbiA9IDYwMDsKICAgIHQuRWdyYXZlID0gNjY3OwogICAgdC5yYWN1dGUgPSAzODk7CiAgICB0Lm9tYWNyb24gPSA2MTE7CiAgICB0LlphY3V0ZSA9IDYxMTsKICAgIHQuWmNhcm9uID0gNjExOwogICAgdC5ncmVhdGVyZXF1YWwgPSA1NDk7CiAgICB0LkV0aCA9IDcyMjsKICAgIHQuQ2NlZGlsbGEgPSA3MjI7CiAgICB0Lmxjb21tYWFjY2VudCA9IDI3ODsKICAgIHQudGNhcm9uID0gMzg5OwogICAgdC5lb2dvbmVrID0gNTU2OwogICAgdC5Vb2dvbmVrID0gNzIyOwogICAgdC5BYWN1dGUgPSA3MjI7CiAgICB0LkFkaWVyZXNpcyA9IDcyMjsKICAgIHQuZWdyYXZlID0gNTU2OwogICAgdC56YWN1dGUgPSA1MDA7CiAgICB0LmlvZ29uZWsgPSAyNzg7CiAgICB0Lk9hY3V0ZSA9IDc3ODsKICAgIHQub2FjdXRlID0gNjExOwogICAgdC5hbWFjcm9uID0gNTU2OwogICAgdC5zYWN1dGUgPSA1NTY7CiAgICB0LmlkaWVyZXNpcyA9IDI3ODsKICAgIHQuT2NpcmN1bWZsZXggPSA3Nzg7CiAgICB0LlVncmF2ZSA9IDcyMjsKICAgIHQuRGVsdGEgPSA2MTI7CiAgICB0LnRob3JuID0gNjExOwogICAgdC50d29zdXBlcmlvciA9IDMzMzsKICAgIHQuT2RpZXJlc2lzID0gNzc4OwogICAgdC5tdSA9IDYxMTsKICAgIHQuaWdyYXZlID0gMjc4OwogICAgdC5vaHVuZ2FydW1sYXV0ID0gNjExOwogICAgdC5Fb2dvbmVrID0gNjY3OwogICAgdC5kY3JvYXQgPSA2MTE7CiAgICB0LnRocmVlcXVhcnRlcnMgPSA4MzQ7CiAgICB0LlNjZWRpbGxhID0gNjY3OwogICAgdC5sY2Fyb24gPSA0MDA7CiAgICB0Lktjb21tYWFjY2VudCA9IDcyMjsKICAgIHQuTGFjdXRlID0gNjExOwogICAgdC50cmFkZW1hcmsgPSAxMDAwOwogICAgdC5lZG90YWNjZW50ID0gNTU2OwogICAgdC5JZ3JhdmUgPSAyNzg7CiAgICB0LkltYWNyb24gPSAyNzg7CiAgICB0LkxjYXJvbiA9IDYxMTsKICAgIHQub25laGFsZiA9IDgzNDsKICAgIHQubGVzc2VxdWFsID0gNTQ5OwogICAgdC5vY2lyY3VtZmxleCA9IDYxMTsKICAgIHQubnRpbGRlID0gNjExOwogICAgdC5VaHVuZ2FydW1sYXV0ID0gNzIyOwogICAgdC5FYWN1dGUgPSA2Njc7CiAgICB0LmVtYWNyb24gPSA1NTY7CiAgICB0LmdicmV2ZSA9IDYxMTsKICAgIHQub25lcXVhcnRlciA9IDgzNDsKICAgIHQuU2Nhcm9uID0gNjY3OwogICAgdC5TY29tbWFhY2NlbnQgPSA2Njc7CiAgICB0Lk9odW5nYXJ1bWxhdXQgPSA3Nzg7CiAgICB0LmRlZ3JlZSA9IDQwMDsKICAgIHQub2dyYXZlID0gNjExOwogICAgdC5DY2Fyb24gPSA3MjI7CiAgICB0LnVncmF2ZSA9IDYxMTsKICAgIHQucmFkaWNhbCA9IDU0OTsKICAgIHQuRGNhcm9uID0gNzIyOwogICAgdC5yY29tbWFhY2NlbnQgPSAzODk7CiAgICB0Lk50aWxkZSA9IDcyMjsKICAgIHQub3RpbGRlID0gNjExOwogICAgdC5SY29tbWFhY2NlbnQgPSA3MjI7CiAgICB0Lkxjb21tYWFjY2VudCA9IDYxMTsKICAgIHQuQXRpbGRlID0gNzIyOwogICAgdC5Bb2dvbmVrID0gNzIyOwogICAgdC5BcmluZyA9IDcyMjsKICAgIHQuT3RpbGRlID0gNzc4OwogICAgdC56ZG90YWNjZW50ID0gNTAwOwogICAgdC5FY2Fyb24gPSA2Njc7CiAgICB0LklvZ29uZWsgPSAyNzg7CiAgICB0Lmtjb21tYWFjY2VudCA9IDU1NjsKICAgIHQubWludXMgPSA1ODQ7CiAgICB0LkljaXJjdW1mbGV4ID0gMjc4OwogICAgdC5uY2Fyb24gPSA2MTE7CiAgICB0LnRjb21tYWFjY2VudCA9IDMzMzsKICAgIHQubG9naWNhbG5vdCA9IDU4NDsKICAgIHQub2RpZXJlc2lzID0gNjExOwogICAgdC51ZGllcmVzaXMgPSA2MTE7CiAgICB0Lm5vdGVxdWFsID0gNTQ5OwogICAgdC5nY29tbWFhY2NlbnQgPSA2MTE7CiAgICB0LmV0aCA9IDYxMTsKICAgIHQuemNhcm9uID0gNTAwOwogICAgdC5uY29tbWFhY2NlbnQgPSA2MTE7CiAgICB0Lm9uZXN1cGVyaW9yID0gMzMzOwogICAgdC5pbWFjcm9uID0gMjc4OwogICAgdC5FdXJvID0gNTU2OwogIH0pOwogIHRbIkhlbHZldGljYS1PYmxpcXVlIl0gPSAoMCwgX2NvcmVfdXRpbHMuZ2V0TG9va3VwVGFibGVGYWN0b3J5KShmdW5jdGlvbiAodCkgewogICAgdC5zcGFjZSA9IDI3ODsKICAgIHQuZXhjbGFtID0gMjc4OwogICAgdC5xdW90ZWRibCA9IDM1NTsKICAgIHQubnVtYmVyc2lnbiA9IDU1NjsKICAgIHQuZG9sbGFyID0gNTU2OwogICAgdC5wZXJjZW50ID0gODg5OwogICAgdC5hbXBlcnNhbmQgPSA2Njc7CiAgICB0LnF1b3RlcmlnaHQgPSAyMjI7CiAgICB0LnBhcmVubGVmdCA9IDMzMzsKICAgIHQucGFyZW5yaWdodCA9IDMzMzsKICAgIHQuYXN0ZXJpc2sgPSAzODk7CiAgICB0LnBsdXMgPSA1ODQ7CiAgICB0LmNvbW1hID0gMjc4OwogICAgdC5oeXBoZW4gPSAzMzM7CiAgICB0LnBlcmlvZCA9IDI3ODsKICAgIHQuc2xhc2ggPSAyNzg7CiAgICB0Lnplcm8gPSA1NTY7CiAgICB0Lm9uZSA9IDU1NjsKICAgIHQudHdvID0gNTU2OwogICAgdC50aHJlZSA9IDU1NjsKICAgIHQuZm91ciA9IDU1NjsKICAgIHQuZml2ZSA9IDU1NjsKICAgIHQuc2l4ID0gNTU2OwogICAgdC5zZXZlbiA9IDU1NjsKICAgIHQuZWlnaHQgPSA1NTY7CiAgICB0Lm5pbmUgPSA1NTY7CiAgICB0LmNvbG9uID0gMjc4OwogICAgdC5zZW1pY29sb24gPSAyNzg7CiAgICB0Lmxlc3MgPSA1ODQ7CiAgICB0LmVxdWFsID0gNTg0OwogICAgdC5ncmVhdGVyID0gNTg0OwogICAgdC5xdWVzdGlvbiA9IDU1NjsKICAgIHQuYXQgPSAxMDE1OwogICAgdC5BID0gNjY3OwogICAgdC5CID0gNjY3OwogICAgdC5DID0gNzIyOwogICAgdC5EID0gNzIyOwogICAgdC5FID0gNjY3OwogICAgdC5GID0gNjExOwogICAgdC5HID0gNzc4OwogICAgdC5IID0gNzIyOwogICAgdC5JID0gMjc4OwogICAgdC5KID0gNTAwOwogICAgdC5LID0gNjY3OwogICAgdC5MID0gNTU2OwogICAgdC5NID0gODMzOwogICAgdC5OID0gNzIyOwogICAgdC5PID0gNzc4OwogICAgdC5QID0gNjY3OwogICAgdC5RID0gNzc4OwogICAgdC5SID0gNzIyOwogICAgdC5TID0gNjY3OwogICAgdC5UID0gNjExOwogICAgdC5VID0gNzIyOwogICAgdC5WID0gNjY3OwogICAgdC5XID0gOTQ0OwogICAgdC5YID0gNjY3OwogICAgdC5ZID0gNjY3OwogICAgdC5aID0gNjExOwogICAgdC5icmFja2V0bGVmdCA9IDI3ODsKICAgIHQuYmFja3NsYXNoID0gMjc4OwogICAgdC5icmFja2V0cmlnaHQgPSAyNzg7CiAgICB0LmFzY2lpY2lyY3VtID0gNDY5OwogICAgdC51bmRlcnNjb3JlID0gNTU2OwogICAgdC5xdW90ZWxlZnQgPSAyMjI7CiAgICB0LmEgPSA1NTY7CiAgICB0LmIgPSA1NTY7CiAgICB0LmMgPSA1MDA7CiAgICB0LmQgPSA1NTY7CiAgICB0LmUgPSA1NTY7CiAgICB0LmYgPSAyNzg7CiAgICB0LmcgPSA1NTY7CiAgICB0LmggPSA1NTY7CiAgICB0LmkgPSAyMjI7CiAgICB0LmogPSAyMjI7CiAgICB0LmsgPSA1MDA7CiAgICB0LmwgPSAyMjI7CiAgICB0Lm0gPSA4MzM7CiAgICB0Lm4gPSA1NTY7CiAgICB0Lm8gPSA1NTY7CiAgICB0LnAgPSA1NTY7CiAgICB0LnEgPSA1NTY7CiAgICB0LnIgPSAzMzM7CiAgICB0LnMgPSA1MDA7CiAgICB0LnQgPSAyNzg7CiAgICB0LnUgPSA1NTY7CiAgICB0LnYgPSA1MDA7CiAgICB0LncgPSA3MjI7CiAgICB0LnggPSA1MDA7CiAgICB0LnkgPSA1MDA7CiAgICB0LnogPSA1MDA7CiAgICB0LmJyYWNlbGVmdCA9IDMzNDsKICAgIHQuYmFyID0gMjYwOwogICAgdC5icmFjZXJpZ2h0ID0gMzM0OwogICAgdC5hc2NpaXRpbGRlID0gNTg0OwogICAgdC5leGNsYW1kb3duID0gMzMzOwogICAgdC5jZW50ID0gNTU2OwogICAgdC5zdGVybGluZyA9IDU1NjsKICAgIHQuZnJhY3Rpb24gPSAxNjc7CiAgICB0LnllbiA9IDU1NjsKICAgIHQuZmxvcmluID0gNTU2OwogICAgdC5zZWN0aW9uID0gNTU2OwogICAgdC5jdXJyZW5jeSA9IDU1NjsKICAgIHQucXVvdGVzaW5nbGUgPSAxOTE7CiAgICB0LnF1b3RlZGJsbGVmdCA9IDMzMzsKICAgIHQuZ3VpbGxlbW90bGVmdCA9IDU1NjsKICAgIHQuZ3VpbHNpbmdsbGVmdCA9IDMzMzsKICAgIHQuZ3VpbHNpbmdscmlnaHQgPSAzMzM7CiAgICB0LmZpID0gNTAwOwogICAgdC5mbCA9IDUwMDsKICAgIHQuZW5kYXNoID0gNTU2OwogICAgdC5kYWdnZXIgPSA1NTY7CiAgICB0LmRhZ2dlcmRibCA9IDU1NjsKICAgIHQucGVyaW9kY2VudGVyZWQgPSAyNzg7CiAgICB0LnBhcmFncmFwaCA9IDUzNzsKICAgIHQuYnVsbGV0ID0gMzUwOwogICAgdC5xdW90ZXNpbmdsYmFzZSA9IDIyMjsKICAgIHQucXVvdGVkYmxiYXNlID0gMzMzOwogICAgdC5xdW90ZWRibHJpZ2h0ID0gMzMzOwogICAgdC5ndWlsbGVtb3RyaWdodCA9IDU1NjsKICAgIHQuZWxsaXBzaXMgPSAxMDAwOwogICAgdC5wZXJ0aG91c2FuZCA9IDEwMDA7CiAgICB0LnF1ZXN0aW9uZG93biA9IDYxMTsKICAgIHQuZ3JhdmUgPSAzMzM7CiAgICB0LmFjdXRlID0gMzMzOwogICAgdC5jaXJjdW1mbGV4ID0gMzMzOwogICAgdC50aWxkZSA9IDMzMzsKICAgIHQubWFjcm9uID0gMzMzOwogICAgdC5icmV2ZSA9IDMzMzsKICAgIHQuZG90YWNjZW50ID0gMzMzOwogICAgdC5kaWVyZXNpcyA9IDMzMzsKICAgIHQucmluZyA9IDMzMzsKICAgIHQuY2VkaWxsYSA9IDMzMzsKICAgIHQuaHVuZ2FydW1sYXV0ID0gMzMzOwogICAgdC5vZ29uZWsgPSAzMzM7CiAgICB0LmNhcm9uID0gMzMzOwogICAgdC5lbWRhc2ggPSAxMDAwOwogICAgdC5BRSA9IDEwMDA7CiAgICB0Lm9yZGZlbWluaW5lID0gMzcwOwogICAgdC5Mc2xhc2ggPSA1NTY7CiAgICB0Lk9zbGFzaCA9IDc3ODsKICAgIHQuT0UgPSAxMDAwOwogICAgdC5vcmRtYXNjdWxpbmUgPSAzNjU7CiAgICB0LmFlID0gODg5OwogICAgdC5kb3RsZXNzaSA9IDI3ODsKICAgIHQubHNsYXNoID0gMjIyOwogICAgdC5vc2xhc2ggPSA2MTE7CiAgICB0Lm9lID0gOTQ0OwogICAgdC5nZXJtYW5kYmxzID0gNjExOwogICAgdC5JZGllcmVzaXMgPSAyNzg7CiAgICB0LmVhY3V0ZSA9IDU1NjsKICAgIHQuYWJyZXZlID0gNTU2OwogICAgdC51aHVuZ2FydW1sYXV0ID0gNTU2OwogICAgdC5lY2Fyb24gPSA1NTY7CiAgICB0LllkaWVyZXNpcyA9IDY2NzsKICAgIHQuZGl2aWRlID0gNTg0OwogICAgdC5ZYWN1dGUgPSA2Njc7CiAgICB0LkFjaXJjdW1mbGV4ID0gNjY3OwogICAgdC5hYWN1dGUgPSA1NTY7CiAgICB0LlVjaXJjdW1mbGV4ID0gNzIyOwogICAgdC55YWN1dGUgPSA1MDA7CiAgICB0LnNjb21tYWFjY2VudCA9IDUwMDsKICAgIHQuZWNpcmN1bWZsZXggPSA1NTY7CiAgICB0LlVyaW5nID0gNzIyOwogICAgdC5VZGllcmVzaXMgPSA3MjI7CiAgICB0LmFvZ29uZWsgPSA1NTY7CiAgICB0LlVhY3V0ZSA9IDcyMjsKICAgIHQudW9nb25layA9IDU1NjsKICAgIHQuRWRpZXJlc2lzID0gNjY3OwogICAgdC5EY3JvYXQgPSA3MjI7CiAgICB0LmNvbW1hYWNjZW50ID0gMjUwOwogICAgdC5jb3B5cmlnaHQgPSA3Mzc7CiAgICB0LkVtYWNyb24gPSA2Njc7CiAgICB0LmNjYXJvbiA9IDUwMDsKICAgIHQuYXJpbmcgPSA1NTY7CiAgICB0Lk5jb21tYWFjY2VudCA9IDcyMjsKICAgIHQubGFjdXRlID0gMjIyOwogICAgdC5hZ3JhdmUgPSA1NTY7CiAgICB0LlRjb21tYWFjY2VudCA9IDYxMTsKICAgIHQuQ2FjdXRlID0gNzIyOwogICAgdC5hdGlsZGUgPSA1NTY7CiAgICB0LkVkb3RhY2NlbnQgPSA2Njc7CiAgICB0LnNjYXJvbiA9IDUwMDsKICAgIHQuc2NlZGlsbGEgPSA1MDA7CiAgICB0LmlhY3V0ZSA9IDI3ODsKICAgIHQubG96ZW5nZSA9IDQ3MTsKICAgIHQuUmNhcm9uID0gNzIyOwogICAgdC5HY29tbWFhY2NlbnQgPSA3Nzg7CiAgICB0LnVjaXJjdW1mbGV4ID0gNTU2OwogICAgdC5hY2lyY3VtZmxleCA9IDU1NjsKICAgIHQuQW1hY3JvbiA9IDY2NzsKICAgIHQucmNhcm9uID0gMzMzOwogICAgdC5jY2VkaWxsYSA9IDUwMDsKICAgIHQuWmRvdGFjY2VudCA9IDYxMTsKICAgIHQuVGhvcm4gPSA2Njc7CiAgICB0Lk9tYWNyb24gPSA3Nzg7CiAgICB0LlJhY3V0ZSA9IDcyMjsKICAgIHQuU2FjdXRlID0gNjY3OwogICAgdC5kY2Fyb24gPSA2NDM7CiAgICB0LlVtYWNyb24gPSA3MjI7CiAgICB0LnVyaW5nID0gNTU2OwogICAgdC50aHJlZXN1cGVyaW9yID0gMzMzOwogICAgdC5PZ3JhdmUgPSA3Nzg7CiAgICB0LkFncmF2ZSA9IDY2NzsKICAgIHQuQWJyZXZlID0gNjY3OwogICAgdC5tdWx0aXBseSA9IDU4NDsKICAgIHQudWFjdXRlID0gNTU2OwogICAgdC5UY2Fyb24gPSA2MTE7CiAgICB0LnBhcnRpYWxkaWZmID0gNDc2OwogICAgdC55ZGllcmVzaXMgPSA1MDA7CiAgICB0Lk5hY3V0ZSA9IDcyMjsKICAgIHQuaWNpcmN1bWZsZXggPSAyNzg7CiAgICB0LkVjaXJjdW1mbGV4ID0gNjY3OwogICAgdC5hZGllcmVzaXMgPSA1NTY7CiAgICB0LmVkaWVyZXNpcyA9IDU1NjsKICAgIHQuY2FjdXRlID0gNTAwOwogICAgdC5uYWN1dGUgPSA1NTY7CiAgICB0LnVtYWNyb24gPSA1NTY7CiAgICB0Lk5jYXJvbiA9IDcyMjsKICAgIHQuSWFjdXRlID0gMjc4OwogICAgdC5wbHVzbWludXMgPSA1ODQ7CiAgICB0LmJyb2tlbmJhciA9IDI2MDsKICAgIHQucmVnaXN0ZXJlZCA9IDczNzsKICAgIHQuR2JyZXZlID0gNzc4OwogICAgdC5JZG90YWNjZW50ID0gMjc4OwogICAgdC5zdW1tYXRpb24gPSA2MDA7CiAgICB0LkVncmF2ZSA9IDY2NzsKICAgIHQucmFjdXRlID0gMzMzOwogICAgdC5vbWFjcm9uID0gNTU2OwogICAgdC5aYWN1dGUgPSA2MTE7CiAgICB0LlpjYXJvbiA9IDYxMTsKICAgIHQuZ3JlYXRlcmVxdWFsID0gNTQ5OwogICAgdC5FdGggPSA3MjI7CiAgICB0LkNjZWRpbGxhID0gNzIyOwogICAgdC5sY29tbWFhY2NlbnQgPSAyMjI7CiAgICB0LnRjYXJvbiA9IDMxNzsKICAgIHQuZW9nb25layA9IDU1NjsKICAgIHQuVW9nb25layA9IDcyMjsKICAgIHQuQWFjdXRlID0gNjY3OwogICAgdC5BZGllcmVzaXMgPSA2Njc7CiAgICB0LmVncmF2ZSA9IDU1NjsKICAgIHQuemFjdXRlID0gNTAwOwogICAgdC5pb2dvbmVrID0gMjIyOwogICAgdC5PYWN1dGUgPSA3Nzg7CiAgICB0Lm9hY3V0ZSA9IDU1NjsKICAgIHQuYW1hY3JvbiA9IDU1NjsKICAgIHQuc2FjdXRlID0gNTAwOwogICAgdC5pZGllcmVzaXMgPSAyNzg7CiAgICB0Lk9jaXJjdW1mbGV4ID0gNzc4OwogICAgdC5VZ3JhdmUgPSA3MjI7CiAgICB0LkRlbHRhID0gNjEyOwogICAgdC50aG9ybiA9IDU1NjsKICAgIHQudHdvc3VwZXJpb3IgPSAzMzM7CiAgICB0Lk9kaWVyZXNpcyA9IDc3ODsKICAgIHQubXUgPSA1NTY7CiAgICB0LmlncmF2ZSA9IDI3ODsKICAgIHQub2h1bmdhcnVtbGF1dCA9IDU1NjsKICAgIHQuRW9nb25layA9IDY2NzsKICAgIHQuZGNyb2F0ID0gNTU2OwogICAgdC50aHJlZXF1YXJ0ZXJzID0gODM0OwogICAgdC5TY2VkaWxsYSA9IDY2NzsKICAgIHQubGNhcm9uID0gMjk5OwogICAgdC5LY29tbWFhY2NlbnQgPSA2Njc7CiAgICB0LkxhY3V0ZSA9IDU1NjsKICAgIHQudHJhZGVtYXJrID0gMTAwMDsKICAgIHQuZWRvdGFjY2VudCA9IDU1NjsKICAgIHQuSWdyYXZlID0gMjc4OwogICAgdC5JbWFjcm9uID0gMjc4OwogICAgdC5MY2Fyb24gPSA1NTY7CiAgICB0Lm9uZWhhbGYgPSA4MzQ7CiAgICB0Lmxlc3NlcXVhbCA9IDU0OTsKICAgIHQub2NpcmN1bWZsZXggPSA1NTY7CiAgICB0Lm50aWxkZSA9IDU1NjsKICAgIHQuVWh1bmdhcnVtbGF1dCA9IDcyMjsKICAgIHQuRWFjdXRlID0gNjY3OwogICAgdC5lbWFjcm9uID0gNTU2OwogICAgdC5nYnJldmUgPSA1NTY7CiAgICB0Lm9uZXF1YXJ0ZXIgPSA4MzQ7CiAgICB0LlNjYXJvbiA9IDY2NzsKICAgIHQuU2NvbW1hYWNjZW50ID0gNjY3OwogICAgdC5PaHVuZ2FydW1sYXV0ID0gNzc4OwogICAgdC5kZWdyZWUgPSA0MDA7CiAgICB0Lm9ncmF2ZSA9IDU1NjsKICAgIHQuQ2Nhcm9uID0gNzIyOwogICAgdC51Z3JhdmUgPSA1NTY7CiAgICB0LnJhZGljYWwgPSA0NTM7CiAgICB0LkRjYXJvbiA9IDcyMjsKICAgIHQucmNvbW1hYWNjZW50ID0gMzMzOwogICAgdC5OdGlsZGUgPSA3MjI7CiAgICB0Lm90aWxkZSA9IDU1NjsKICAgIHQuUmNvbW1hYWNjZW50ID0gNzIyOwogICAgdC5MY29tbWFhY2NlbnQgPSA1NTY7CiAgICB0LkF0aWxkZSA9IDY2NzsKICAgIHQuQW9nb25layA9IDY2NzsKICAgIHQuQXJpbmcgPSA2Njc7CiAgICB0Lk90aWxkZSA9IDc3ODsKICAgIHQuemRvdGFjY2VudCA9IDUwMDsKICAgIHQuRWNhcm9uID0gNjY3OwogICAgdC5Jb2dvbmVrID0gMjc4OwogICAgdC5rY29tbWFhY2NlbnQgPSA1MDA7CiAgICB0Lm1pbnVzID0gNTg0OwogICAgdC5JY2lyY3VtZmxleCA9IDI3ODsKICAgIHQubmNhcm9uID0gNTU2OwogICAgdC50Y29tbWFhY2NlbnQgPSAyNzg7CiAgICB0LmxvZ2ljYWxub3QgPSA1ODQ7CiAgICB0Lm9kaWVyZXNpcyA9IDU1NjsKICAgIHQudWRpZXJlc2lzID0gNTU2OwogICAgdC5ub3RlcXVhbCA9IDU0OTsKICAgIHQuZ2NvbW1hYWNjZW50ID0gNTU2OwogICAgdC5ldGggPSA1NTY7CiAgICB0LnpjYXJvbiA9IDUwMDsKICAgIHQubmNvbW1hYWNjZW50ID0gNTU2OwogICAgdC5vbmVzdXBlcmlvciA9IDMzMzsKICAgIHQuaW1hY3JvbiA9IDI3ODsKICAgIHQuRXVybyA9IDU1NjsKICB9KTsKICB0LlN5bWJvbCA9ICgwLCBfY29yZV91dGlscy5nZXRMb29rdXBUYWJsZUZhY3RvcnkpKGZ1bmN0aW9uICh0KSB7CiAgICB0LnNwYWNlID0gMjUwOwogICAgdC5leGNsYW0gPSAzMzM7CiAgICB0LnVuaXZlcnNhbCA9IDcxMzsKICAgIHQubnVtYmVyc2lnbiA9IDUwMDsKICAgIHQuZXhpc3RlbnRpYWwgPSA1NDk7CiAgICB0LnBlcmNlbnQgPSA4MzM7CiAgICB0LmFtcGVyc2FuZCA9IDc3ODsKICAgIHQuc3VjaHRoYXQgPSA0Mzk7CiAgICB0LnBhcmVubGVmdCA9IDMzMzsKICAgIHQucGFyZW5yaWdodCA9IDMzMzsKICAgIHQuYXN0ZXJpc2ttYXRoID0gNTAwOwogICAgdC5wbHVzID0gNTQ5OwogICAgdC5jb21tYSA9IDI1MDsKICAgIHQubWludXMgPSA1NDk7CiAgICB0LnBlcmlvZCA9IDI1MDsKICAgIHQuc2xhc2ggPSAyNzg7CiAgICB0Lnplcm8gPSA1MDA7CiAgICB0Lm9uZSA9IDUwMDsKICAgIHQudHdvID0gNTAwOwogICAgdC50aHJlZSA9IDUwMDsKICAgIHQuZm91ciA9IDUwMDsKICAgIHQuZml2ZSA9IDUwMDsKICAgIHQuc2l4ID0gNTAwOwogICAgdC5zZXZlbiA9IDUwMDsKICAgIHQuZWlnaHQgPSA1MDA7CiAgICB0Lm5pbmUgPSA1MDA7CiAgICB0LmNvbG9uID0gMjc4OwogICAgdC5zZW1pY29sb24gPSAyNzg7CiAgICB0Lmxlc3MgPSA1NDk7CiAgICB0LmVxdWFsID0gNTQ5OwogICAgdC5ncmVhdGVyID0gNTQ5OwogICAgdC5xdWVzdGlvbiA9IDQ0NDsKICAgIHQuY29uZ3J1ZW50ID0gNTQ5OwogICAgdC5BbHBoYSA9IDcyMjsKICAgIHQuQmV0YSA9IDY2NzsKICAgIHQuQ2hpID0gNzIyOwogICAgdC5EZWx0YSA9IDYxMjsKICAgIHQuRXBzaWxvbiA9IDYxMTsKICAgIHQuUGhpID0gNzYzOwogICAgdC5HYW1tYSA9IDYwMzsKICAgIHQuRXRhID0gNzIyOwogICAgdC5Jb3RhID0gMzMzOwogICAgdC50aGV0YTEgPSA2MzE7CiAgICB0LkthcHBhID0gNzIyOwogICAgdC5MYW1iZGEgPSA2ODY7CiAgICB0Lk11ID0gODg5OwogICAgdC5OdSA9IDcyMjsKICAgIHQuT21pY3JvbiA9IDcyMjsKICAgIHQuUGkgPSA3Njg7CiAgICB0LlRoZXRhID0gNzQxOwogICAgdC5SaG8gPSA1NTY7CiAgICB0LlNpZ21hID0gNTkyOwogICAgdC5UYXUgPSA2MTE7CiAgICB0LlVwc2lsb24gPSA2OTA7CiAgICB0LnNpZ21hMSA9IDQzOTsKICAgIHQuT21lZ2EgPSA3Njg7CiAgICB0LlhpID0gNjQ1OwogICAgdC5Qc2kgPSA3OTU7CiAgICB0LlpldGEgPSA2MTE7CiAgICB0LmJyYWNrZXRsZWZ0ID0gMzMzOwogICAgdC50aGVyZWZvcmUgPSA4NjM7CiAgICB0LmJyYWNrZXRyaWdodCA9IDMzMzsKICAgIHQucGVycGVuZGljdWxhciA9IDY1ODsKICAgIHQudW5kZXJzY29yZSA9IDUwMDsKICAgIHQucmFkaWNhbGV4ID0gNTAwOwogICAgdC5hbHBoYSA9IDYzMTsKICAgIHQuYmV0YSA9IDU0OTsKICAgIHQuY2hpID0gNTQ5OwogICAgdC5kZWx0YSA9IDQ5NDsKICAgIHQuZXBzaWxvbiA9IDQzOTsKICAgIHQucGhpID0gNTIxOwogICAgdC5nYW1tYSA9IDQxMTsKICAgIHQuZXRhID0gNjAzOwogICAgdC5pb3RhID0gMzI5OwogICAgdC5waGkxID0gNjAzOwogICAgdC5rYXBwYSA9IDU0OTsKICAgIHQubGFtYmRhID0gNTQ5OwogICAgdC5tdSA9IDU3NjsKICAgIHQubnUgPSA1MjE7CiAgICB0Lm9taWNyb24gPSA1NDk7CiAgICB0LnBpID0gNTQ5OwogICAgdC50aGV0YSA9IDUyMTsKICAgIHQucmhvID0gNTQ5OwogICAgdC5zaWdtYSA9IDYwMzsKICAgIHQudGF1ID0gNDM5OwogICAgdC51cHNpbG9uID0gNTc2OwogICAgdC5vbWVnYTEgPSA3MTM7CiAgICB0Lm9tZWdhID0gNjg2OwogICAgdC54aSA9IDQ5MzsKICAgIHQucHNpID0gNjg2OwogICAgdC56ZXRhID0gNDk0OwogICAgdC5icmFjZWxlZnQgPSA0ODA7CiAgICB0LmJhciA9IDIwMDsKICAgIHQuYnJhY2VyaWdodCA9IDQ4MDsKICAgIHQuc2ltaWxhciA9IDU0OTsKICAgIHQuRXVybyA9IDc1MDsKICAgIHQuVXBzaWxvbjEgPSA2MjA7CiAgICB0Lm1pbnV0ZSA9IDI0NzsKICAgIHQubGVzc2VxdWFsID0gNTQ5OwogICAgdC5mcmFjdGlvbiA9IDE2NzsKICAgIHQuaW5maW5pdHkgPSA3MTM7CiAgICB0LmZsb3JpbiA9IDUwMDsKICAgIHQuY2x1YiA9IDc1MzsKICAgIHQuZGlhbW9uZCA9IDc1MzsKICAgIHQuaGVhcnQgPSA3NTM7CiAgICB0LnNwYWRlID0gNzUzOwogICAgdC5hcnJvd2JvdGggPSAxMDQyOwogICAgdC5hcnJvd2xlZnQgPSA5ODc7CiAgICB0LmFycm93dXAgPSA2MDM7CiAgICB0LmFycm93cmlnaHQgPSA5ODc7CiAgICB0LmFycm93ZG93biA9IDYwMzsKICAgIHQuZGVncmVlID0gNDAwOwogICAgdC5wbHVzbWludXMgPSA1NDk7CiAgICB0LnNlY29uZCA9IDQxMTsKICAgIHQuZ3JlYXRlcmVxdWFsID0gNTQ5OwogICAgdC5tdWx0aXBseSA9IDU0OTsKICAgIHQucHJvcG9ydGlvbmFsID0gNzEzOwogICAgdC5wYXJ0aWFsZGlmZiA9IDQ5NDsKICAgIHQuYnVsbGV0ID0gNDYwOwogICAgdC5kaXZpZGUgPSA1NDk7CiAgICB0Lm5vdGVxdWFsID0gNTQ5OwogICAgdC5lcXVpdmFsZW5jZSA9IDU0OTsKICAgIHQuYXBwcm94ZXF1YWwgPSA1NDk7CiAgICB0LmVsbGlwc2lzID0gMTAwMDsKICAgIHQuYXJyb3d2ZXJ0ZXggPSA2MDM7CiAgICB0LmFycm93aG9yaXpleCA9IDEwMDA7CiAgICB0LmNhcnJpYWdlcmV0dXJuID0gNjU4OwogICAgdC5hbGVwaCA9IDgyMzsKICAgIHQuSWZyYWt0dXIgPSA2ODY7CiAgICB0LlJmcmFrdHVyID0gNzk1OwogICAgdC53ZWllcnN0cmFzcyA9IDk4NzsKICAgIHQuY2lyY2xlbXVsdGlwbHkgPSA3Njg7CiAgICB0LmNpcmNsZXBsdXMgPSA3Njg7CiAgICB0LmVtcHR5c2V0ID0gODIzOwogICAgdC5pbnRlcnNlY3Rpb24gPSA3Njg7CiAgICB0LnVuaW9uID0gNzY4OwogICAgdC5wcm9wZXJzdXBlcnNldCA9IDcxMzsKICAgIHQucmVmbGV4c3VwZXJzZXQgPSA3MTM7CiAgICB0Lm5vdHN1YnNldCA9IDcxMzsKICAgIHQucHJvcGVyc3Vic2V0ID0gNzEzOwogICAgdC5yZWZsZXhzdWJzZXQgPSA3MTM7CiAgICB0LmVsZW1lbnQgPSA3MTM7CiAgICB0Lm5vdGVsZW1lbnQgPSA3MTM7CiAgICB0LmFuZ2xlID0gNzY4OwogICAgdC5ncmFkaWVudCA9IDcxMzsKICAgIHQucmVnaXN0ZXJzZXJpZiA9IDc5MDsKICAgIHQuY29weXJpZ2h0c2VyaWYgPSA3OTA7CiAgICB0LnRyYWRlbWFya3NlcmlmID0gODkwOwogICAgdC5wcm9kdWN0ID0gODIzOwogICAgdC5yYWRpY2FsID0gNTQ5OwogICAgdC5kb3RtYXRoID0gMjUwOwogICAgdC5sb2dpY2Fsbm90ID0gNzEzOwogICAgdC5sb2dpY2FsYW5kID0gNjAzOwogICAgdC5sb2dpY2Fsb3IgPSA2MDM7CiAgICB0LmFycm93ZGJsYm90aCA9IDEwNDI7CiAgICB0LmFycm93ZGJsbGVmdCA9IDk4NzsKICAgIHQuYXJyb3dkYmx1cCA9IDYwMzsKICAgIHQuYXJyb3dkYmxyaWdodCA9IDk4NzsKICAgIHQuYXJyb3dkYmxkb3duID0gNjAzOwogICAgdC5sb3plbmdlID0gNDk0OwogICAgdC5hbmdsZWxlZnQgPSAzMjk7CiAgICB0LnJlZ2lzdGVyc2FucyA9IDc5MDsKICAgIHQuY29weXJpZ2h0c2FucyA9IDc5MDsKICAgIHQudHJhZGVtYXJrc2FucyA9IDc4NjsKICAgIHQuc3VtbWF0aW9uID0gNzEzOwogICAgdC5wYXJlbmxlZnR0cCA9IDM4NDsKICAgIHQucGFyZW5sZWZ0ZXggPSAzODQ7CiAgICB0LnBhcmVubGVmdGJ0ID0gMzg0OwogICAgdC5icmFja2V0bGVmdHRwID0gMzg0OwogICAgdC5icmFja2V0bGVmdGV4ID0gMzg0OwogICAgdC5icmFja2V0bGVmdGJ0ID0gMzg0OwogICAgdC5icmFjZWxlZnR0cCA9IDQ5NDsKICAgIHQuYnJhY2VsZWZ0bWlkID0gNDk0OwogICAgdC5icmFjZWxlZnRidCA9IDQ5NDsKICAgIHQuYnJhY2VleCA9IDQ5NDsKICAgIHQuYW5nbGVyaWdodCA9IDMyOTsKICAgIHQuaW50ZWdyYWwgPSAyNzQ7CiAgICB0LmludGVncmFsdHAgPSA2ODY7CiAgICB0LmludGVncmFsZXggPSA2ODY7CiAgICB0LmludGVncmFsYnQgPSA2ODY7CiAgICB0LnBhcmVucmlnaHR0cCA9IDM4NDsKICAgIHQucGFyZW5yaWdodGV4ID0gMzg0OwogICAgdC5wYXJlbnJpZ2h0YnQgPSAzODQ7CiAgICB0LmJyYWNrZXRyaWdodHRwID0gMzg0OwogICAgdC5icmFja2V0cmlnaHRleCA9IDM4NDsKICAgIHQuYnJhY2tldHJpZ2h0YnQgPSAzODQ7CiAgICB0LmJyYWNlcmlnaHR0cCA9IDQ5NDsKICAgIHQuYnJhY2VyaWdodG1pZCA9IDQ5NDsKICAgIHQuYnJhY2VyaWdodGJ0ID0gNDk0OwogICAgdC5hcHBsZSA9IDc5MDsKICB9KTsKICB0WyJUaW1lcy1Sb21hbiJdID0gKDAsIF9jb3JlX3V0aWxzLmdldExvb2t1cFRhYmxlRmFjdG9yeSkoZnVuY3Rpb24gKHQpIHsKICAgIHQuc3BhY2UgPSAyNTA7CiAgICB0LmV4Y2xhbSA9IDMzMzsKICAgIHQucXVvdGVkYmwgPSA0MDg7CiAgICB0Lm51bWJlcnNpZ24gPSA1MDA7CiAgICB0LmRvbGxhciA9IDUwMDsKICAgIHQucGVyY2VudCA9IDgzMzsKICAgIHQuYW1wZXJzYW5kID0gNzc4OwogICAgdC5xdW90ZXJpZ2h0ID0gMzMzOwogICAgdC5wYXJlbmxlZnQgPSAzMzM7CiAgICB0LnBhcmVucmlnaHQgPSAzMzM7CiAgICB0LmFzdGVyaXNrID0gNTAwOwogICAgdC5wbHVzID0gNTY0OwogICAgdC5jb21tYSA9IDI1MDsKICAgIHQuaHlwaGVuID0gMzMzOwogICAgdC5wZXJpb2QgPSAyNTA7CiAgICB0LnNsYXNoID0gMjc4OwogICAgdC56ZXJvID0gNTAwOwogICAgdC5vbmUgPSA1MDA7CiAgICB0LnR3byA9IDUwMDsKICAgIHQudGhyZWUgPSA1MDA7CiAgICB0LmZvdXIgPSA1MDA7CiAgICB0LmZpdmUgPSA1MDA7CiAgICB0LnNpeCA9IDUwMDsKICAgIHQuc2V2ZW4gPSA1MDA7CiAgICB0LmVpZ2h0ID0gNTAwOwogICAgdC5uaW5lID0gNTAwOwogICAgdC5jb2xvbiA9IDI3ODsKICAgIHQuc2VtaWNvbG9uID0gMjc4OwogICAgdC5sZXNzID0gNTY0OwogICAgdC5lcXVhbCA9IDU2NDsKICAgIHQuZ3JlYXRlciA9IDU2NDsKICAgIHQucXVlc3Rpb24gPSA0NDQ7CiAgICB0LmF0ID0gOTIxOwogICAgdC5BID0gNzIyOwogICAgdC5CID0gNjY3OwogICAgdC5DID0gNjY3OwogICAgdC5EID0gNzIyOwogICAgdC5FID0gNjExOwogICAgdC5GID0gNTU2OwogICAgdC5HID0gNzIyOwogICAgdC5IID0gNzIyOwogICAgdC5JID0gMzMzOwogICAgdC5KID0gMzg5OwogICAgdC5LID0gNzIyOwogICAgdC5MID0gNjExOwogICAgdC5NID0gODg5OwogICAgdC5OID0gNzIyOwogICAgdC5PID0gNzIyOwogICAgdC5QID0gNTU2OwogICAgdC5RID0gNzIyOwogICAgdC5SID0gNjY3OwogICAgdC5TID0gNTU2OwogICAgdC5UID0gNjExOwogICAgdC5VID0gNzIyOwogICAgdC5WID0gNzIyOwogICAgdC5XID0gOTQ0OwogICAgdC5YID0gNzIyOwogICAgdC5ZID0gNzIyOwogICAgdC5aID0gNjExOwogICAgdC5icmFja2V0bGVmdCA9IDMzMzsKICAgIHQuYmFja3NsYXNoID0gMjc4OwogICAgdC5icmFja2V0cmlnaHQgPSAzMzM7CiAgICB0LmFzY2lpY2lyY3VtID0gNDY5OwogICAgdC51bmRlcnNjb3JlID0gNTAwOwogICAgdC5xdW90ZWxlZnQgPSAzMzM7CiAgICB0LmEgPSA0NDQ7CiAgICB0LmIgPSA1MDA7CiAgICB0LmMgPSA0NDQ7CiAgICB0LmQgPSA1MDA7CiAgICB0LmUgPSA0NDQ7CiAgICB0LmYgPSAzMzM7CiAgICB0LmcgPSA1MDA7CiAgICB0LmggPSA1MDA7CiAgICB0LmkgPSAyNzg7CiAgICB0LmogPSAyNzg7CiAgICB0LmsgPSA1MDA7CiAgICB0LmwgPSAyNzg7CiAgICB0Lm0gPSA3Nzg7CiAgICB0Lm4gPSA1MDA7CiAgICB0Lm8gPSA1MDA7CiAgICB0LnAgPSA1MDA7CiAgICB0LnEgPSA1MDA7CiAgICB0LnIgPSAzMzM7CiAgICB0LnMgPSAzODk7CiAgICB0LnQgPSAyNzg7CiAgICB0LnUgPSA1MDA7CiAgICB0LnYgPSA1MDA7CiAgICB0LncgPSA3MjI7CiAgICB0LnggPSA1MDA7CiAgICB0LnkgPSA1MDA7CiAgICB0LnogPSA0NDQ7CiAgICB0LmJyYWNlbGVmdCA9IDQ4MDsKICAgIHQuYmFyID0gMjAwOwogICAgdC5icmFjZXJpZ2h0ID0gNDgwOwogICAgdC5hc2NpaXRpbGRlID0gNTQxOwogICAgdC5leGNsYW1kb3duID0gMzMzOwogICAgdC5jZW50ID0gNTAwOwogICAgdC5zdGVybGluZyA9IDUwMDsKICAgIHQuZnJhY3Rpb24gPSAxNjc7CiAgICB0LnllbiA9IDUwMDsKICAgIHQuZmxvcmluID0gNTAwOwogICAgdC5zZWN0aW9uID0gNTAwOwogICAgdC5jdXJyZW5jeSA9IDUwMDsKICAgIHQucXVvdGVzaW5nbGUgPSAxODA7CiAgICB0LnF1b3RlZGJsbGVmdCA9IDQ0NDsKICAgIHQuZ3VpbGxlbW90bGVmdCA9IDUwMDsKICAgIHQuZ3VpbHNpbmdsbGVmdCA9IDMzMzsKICAgIHQuZ3VpbHNpbmdscmlnaHQgPSAzMzM7CiAgICB0LmZpID0gNTU2OwogICAgdC5mbCA9IDU1NjsKICAgIHQuZW5kYXNoID0gNTAwOwogICAgdC5kYWdnZXIgPSA1MDA7CiAgICB0LmRhZ2dlcmRibCA9IDUwMDsKICAgIHQucGVyaW9kY2VudGVyZWQgPSAyNTA7CiAgICB0LnBhcmFncmFwaCA9IDQ1MzsKICAgIHQuYnVsbGV0ID0gMzUwOwogICAgdC5xdW90ZXNpbmdsYmFzZSA9IDMzMzsKICAgIHQucXVvdGVkYmxiYXNlID0gNDQ0OwogICAgdC5xdW90ZWRibHJpZ2h0ID0gNDQ0OwogICAgdC5ndWlsbGVtb3RyaWdodCA9IDUwMDsKICAgIHQuZWxsaXBzaXMgPSAxMDAwOwogICAgdC5wZXJ0aG91c2FuZCA9IDEwMDA7CiAgICB0LnF1ZXN0aW9uZG93biA9IDQ0NDsKICAgIHQuZ3JhdmUgPSAzMzM7CiAgICB0LmFjdXRlID0gMzMzOwogICAgdC5jaXJjdW1mbGV4ID0gMzMzOwogICAgdC50aWxkZSA9IDMzMzsKICAgIHQubWFjcm9uID0gMzMzOwogICAgdC5icmV2ZSA9IDMzMzsKICAgIHQuZG90YWNjZW50ID0gMzMzOwogICAgdC5kaWVyZXNpcyA9IDMzMzsKICAgIHQucmluZyA9IDMzMzsKICAgIHQuY2VkaWxsYSA9IDMzMzsKICAgIHQuaHVuZ2FydW1sYXV0ID0gMzMzOwogICAgdC5vZ29uZWsgPSAzMzM7CiAgICB0LmNhcm9uID0gMzMzOwogICAgdC5lbWRhc2ggPSAxMDAwOwogICAgdC5BRSA9IDg4OTsKICAgIHQub3JkZmVtaW5pbmUgPSAyNzY7CiAgICB0LkxzbGFzaCA9IDYxMTsKICAgIHQuT3NsYXNoID0gNzIyOwogICAgdC5PRSA9IDg4OTsKICAgIHQub3JkbWFzY3VsaW5lID0gMzEwOwogICAgdC5hZSA9IDY2NzsKICAgIHQuZG90bGVzc2kgPSAyNzg7CiAgICB0LmxzbGFzaCA9IDI3ODsKICAgIHQub3NsYXNoID0gNTAwOwogICAgdC5vZSA9IDcyMjsKICAgIHQuZ2VybWFuZGJscyA9IDUwMDsKICAgIHQuSWRpZXJlc2lzID0gMzMzOwogICAgdC5lYWN1dGUgPSA0NDQ7CiAgICB0LmFicmV2ZSA9IDQ0NDsKICAgIHQudWh1bmdhcnVtbGF1dCA9IDUwMDsKICAgIHQuZWNhcm9uID0gNDQ0OwogICAgdC5ZZGllcmVzaXMgPSA3MjI7CiAgICB0LmRpdmlkZSA9IDU2NDsKICAgIHQuWWFjdXRlID0gNzIyOwogICAgdC5BY2lyY3VtZmxleCA9IDcyMjsKICAgIHQuYWFjdXRlID0gNDQ0OwogICAgdC5VY2lyY3VtZmxleCA9IDcyMjsKICAgIHQueWFjdXRlID0gNTAwOwogICAgdC5zY29tbWFhY2NlbnQgPSAzODk7CiAgICB0LmVjaXJjdW1mbGV4ID0gNDQ0OwogICAgdC5VcmluZyA9IDcyMjsKICAgIHQuVWRpZXJlc2lzID0gNzIyOwogICAgdC5hb2dvbmVrID0gNDQ0OwogICAgdC5VYWN1dGUgPSA3MjI7CiAgICB0LnVvZ29uZWsgPSA1MDA7CiAgICB0LkVkaWVyZXNpcyA9IDYxMTsKICAgIHQuRGNyb2F0ID0gNzIyOwogICAgdC5jb21tYWFjY2VudCA9IDI1MDsKICAgIHQuY29weXJpZ2h0ID0gNzYwOwogICAgdC5FbWFjcm9uID0gNjExOwogICAgdC5jY2Fyb24gPSA0NDQ7CiAgICB0LmFyaW5nID0gNDQ0OwogICAgdC5OY29tbWFhY2NlbnQgPSA3MjI7CiAgICB0LmxhY3V0ZSA9IDI3ODsKICAgIHQuYWdyYXZlID0gNDQ0OwogICAgdC5UY29tbWFhY2NlbnQgPSA2MTE7CiAgICB0LkNhY3V0ZSA9IDY2NzsKICAgIHQuYXRpbGRlID0gNDQ0OwogICAgdC5FZG90YWNjZW50ID0gNjExOwogICAgdC5zY2Fyb24gPSAzODk7CiAgICB0LnNjZWRpbGxhID0gMzg5OwogICAgdC5pYWN1dGUgPSAyNzg7CiAgICB0LmxvemVuZ2UgPSA0NzE7CiAgICB0LlJjYXJvbiA9IDY2NzsKICAgIHQuR2NvbW1hYWNjZW50ID0gNzIyOwogICAgdC51Y2lyY3VtZmxleCA9IDUwMDsKICAgIHQuYWNpcmN1bWZsZXggPSA0NDQ7CiAgICB0LkFtYWNyb24gPSA3MjI7CiAgICB0LnJjYXJvbiA9IDMzMzsKICAgIHQuY2NlZGlsbGEgPSA0NDQ7CiAgICB0Llpkb3RhY2NlbnQgPSA2MTE7CiAgICB0LlRob3JuID0gNTU2OwogICAgdC5PbWFjcm9uID0gNzIyOwogICAgdC5SYWN1dGUgPSA2Njc7CiAgICB0LlNhY3V0ZSA9IDU1NjsKICAgIHQuZGNhcm9uID0gNTg4OwogICAgdC5VbWFjcm9uID0gNzIyOwogICAgdC51cmluZyA9IDUwMDsKICAgIHQudGhyZWVzdXBlcmlvciA9IDMwMDsKICAgIHQuT2dyYXZlID0gNzIyOwogICAgdC5BZ3JhdmUgPSA3MjI7CiAgICB0LkFicmV2ZSA9IDcyMjsKICAgIHQubXVsdGlwbHkgPSA1NjQ7CiAgICB0LnVhY3V0ZSA9IDUwMDsKICAgIHQuVGNhcm9uID0gNjExOwogICAgdC5wYXJ0aWFsZGlmZiA9IDQ3NjsKICAgIHQueWRpZXJlc2lzID0gNTAwOwogICAgdC5OYWN1dGUgPSA3MjI7CiAgICB0LmljaXJjdW1mbGV4ID0gMjc4OwogICAgdC5FY2lyY3VtZmxleCA9IDYxMTsKICAgIHQuYWRpZXJlc2lzID0gNDQ0OwogICAgdC5lZGllcmVzaXMgPSA0NDQ7CiAgICB0LmNhY3V0ZSA9IDQ0NDsKICAgIHQubmFjdXRlID0gNTAwOwogICAgdC51bWFjcm9uID0gNTAwOwogICAgdC5OY2Fyb24gPSA3MjI7CiAgICB0LklhY3V0ZSA9IDMzMzsKICAgIHQucGx1c21pbnVzID0gNTY0OwogICAgdC5icm9rZW5iYXIgPSAyMDA7CiAgICB0LnJlZ2lzdGVyZWQgPSA3NjA7CiAgICB0LkdicmV2ZSA9IDcyMjsKICAgIHQuSWRvdGFjY2VudCA9IDMzMzsKICAgIHQuc3VtbWF0aW9uID0gNjAwOwogICAgdC5FZ3JhdmUgPSA2MTE7CiAgICB0LnJhY3V0ZSA9IDMzMzsKICAgIHQub21hY3JvbiA9IDUwMDsKICAgIHQuWmFjdXRlID0gNjExOwogICAgdC5aY2Fyb24gPSA2MTE7CiAgICB0LmdyZWF0ZXJlcXVhbCA9IDU0OTsKICAgIHQuRXRoID0gNzIyOwogICAgdC5DY2VkaWxsYSA9IDY2NzsKICAgIHQubGNvbW1hYWNjZW50ID0gMjc4OwogICAgdC50Y2Fyb24gPSAzMjY7CiAgICB0LmVvZ29uZWsgPSA0NDQ7CiAgICB0LlVvZ29uZWsgPSA3MjI7CiAgICB0LkFhY3V0ZSA9IDcyMjsKICAgIHQuQWRpZXJlc2lzID0gNzIyOwogICAgdC5lZ3JhdmUgPSA0NDQ7CiAgICB0LnphY3V0ZSA9IDQ0NDsKICAgIHQuaW9nb25layA9IDI3ODsKICAgIHQuT2FjdXRlID0gNzIyOwogICAgdC5vYWN1dGUgPSA1MDA7CiAgICB0LmFtYWNyb24gPSA0NDQ7CiAgICB0LnNhY3V0ZSA9IDM4OTsKICAgIHQuaWRpZXJlc2lzID0gMjc4OwogICAgdC5PY2lyY3VtZmxleCA9IDcyMjsKICAgIHQuVWdyYXZlID0gNzIyOwogICAgdC5EZWx0YSA9IDYxMjsKICAgIHQudGhvcm4gPSA1MDA7CiAgICB0LnR3b3N1cGVyaW9yID0gMzAwOwogICAgdC5PZGllcmVzaXMgPSA3MjI7CiAgICB0Lm11ID0gNTAwOwogICAgdC5pZ3JhdmUgPSAyNzg7CiAgICB0Lm9odW5nYXJ1bWxhdXQgPSA1MDA7CiAgICB0LkVvZ29uZWsgPSA2MTE7CiAgICB0LmRjcm9hdCA9IDUwMDsKICAgIHQudGhyZWVxdWFydGVycyA9IDc1MDsKICAgIHQuU2NlZGlsbGEgPSA1NTY7CiAgICB0LmxjYXJvbiA9IDM0NDsKICAgIHQuS2NvbW1hYWNjZW50ID0gNzIyOwogICAgdC5MYWN1dGUgPSA2MTE7CiAgICB0LnRyYWRlbWFyayA9IDk4MDsKICAgIHQuZWRvdGFjY2VudCA9IDQ0NDsKICAgIHQuSWdyYXZlID0gMzMzOwogICAgdC5JbWFjcm9uID0gMzMzOwogICAgdC5MY2Fyb24gPSA2MTE7CiAgICB0Lm9uZWhhbGYgPSA3NTA7CiAgICB0Lmxlc3NlcXVhbCA9IDU0OTsKICAgIHQub2NpcmN1bWZsZXggPSA1MDA7CiAgICB0Lm50aWxkZSA9IDUwMDsKICAgIHQuVWh1bmdhcnVtbGF1dCA9IDcyMjsKICAgIHQuRWFjdXRlID0gNjExOwogICAgdC5lbWFjcm9uID0gNDQ0OwogICAgdC5nYnJldmUgPSA1MDA7CiAgICB0Lm9uZXF1YXJ0ZXIgPSA3NTA7CiAgICB0LlNjYXJvbiA9IDU1NjsKICAgIHQuU2NvbW1hYWNjZW50ID0gNTU2OwogICAgdC5PaHVuZ2FydW1sYXV0ID0gNzIyOwogICAgdC5kZWdyZWUgPSA0MDA7CiAgICB0Lm9ncmF2ZSA9IDUwMDsKICAgIHQuQ2Nhcm9uID0gNjY3OwogICAgdC51Z3JhdmUgPSA1MDA7CiAgICB0LnJhZGljYWwgPSA0NTM7CiAgICB0LkRjYXJvbiA9IDcyMjsKICAgIHQucmNvbW1hYWNjZW50ID0gMzMzOwogICAgdC5OdGlsZGUgPSA3MjI7CiAgICB0Lm90aWxkZSA9IDUwMDsKICAgIHQuUmNvbW1hYWNjZW50ID0gNjY3OwogICAgdC5MY29tbWFhY2NlbnQgPSA2MTE7CiAgICB0LkF0aWxkZSA9IDcyMjsKICAgIHQuQW9nb25layA9IDcyMjsKICAgIHQuQXJpbmcgPSA3MjI7CiAgICB0Lk90aWxkZSA9IDcyMjsKICAgIHQuemRvdGFjY2VudCA9IDQ0NDsKICAgIHQuRWNhcm9uID0gNjExOwogICAgdC5Jb2dvbmVrID0gMzMzOwogICAgdC5rY29tbWFhY2NlbnQgPSA1MDA7CiAgICB0Lm1pbnVzID0gNTY0OwogICAgdC5JY2lyY3VtZmxleCA9IDMzMzsKICAgIHQubmNhcm9uID0gNTAwOwogICAgdC50Y29tbWFhY2NlbnQgPSAyNzg7CiAgICB0LmxvZ2ljYWxub3QgPSA1NjQ7CiAgICB0Lm9kaWVyZXNpcyA9IDUwMDsKICAgIHQudWRpZXJlc2lzID0gNTAwOwogICAgdC5ub3RlcXVhbCA9IDU0OTsKICAgIHQuZ2NvbW1hYWNjZW50ID0gNTAwOwogICAgdC5ldGggPSA1MDA7CiAgICB0LnpjYXJvbiA9IDQ0NDsKICAgIHQubmNvbW1hYWNjZW50ID0gNTAwOwogICAgdC5vbmVzdXBlcmlvciA9IDMwMDsKICAgIHQuaW1hY3JvbiA9IDI3ODsKICAgIHQuRXVybyA9IDUwMDsKICB9KTsKICB0WyJUaW1lcy1Cb2xkIl0gPSAoMCwgX2NvcmVfdXRpbHMuZ2V0TG9va3VwVGFibGVGYWN0b3J5KShmdW5jdGlvbiAodCkgewogICAgdC5zcGFjZSA9IDI1MDsKICAgIHQuZXhjbGFtID0gMzMzOwogICAgdC5xdW90ZWRibCA9IDU1NTsKICAgIHQubnVtYmVyc2lnbiA9IDUwMDsKICAgIHQuZG9sbGFyID0gNTAwOwogICAgdC5wZXJjZW50ID0gMTAwMDsKICAgIHQuYW1wZXJzYW5kID0gODMzOwogICAgdC5xdW90ZXJpZ2h0ID0gMzMzOwogICAgdC5wYXJlbmxlZnQgPSAzMzM7CiAgICB0LnBhcmVucmlnaHQgPSAzMzM7CiAgICB0LmFzdGVyaXNrID0gNTAwOwogICAgdC5wbHVzID0gNTcwOwogICAgdC5jb21tYSA9IDI1MDsKICAgIHQuaHlwaGVuID0gMzMzOwogICAgdC5wZXJpb2QgPSAyNTA7CiAgICB0LnNsYXNoID0gMjc4OwogICAgdC56ZXJvID0gNTAwOwogICAgdC5vbmUgPSA1MDA7CiAgICB0LnR3byA9IDUwMDsKICAgIHQudGhyZWUgPSA1MDA7CiAgICB0LmZvdXIgPSA1MDA7CiAgICB0LmZpdmUgPSA1MDA7CiAgICB0LnNpeCA9IDUwMDsKICAgIHQuc2V2ZW4gPSA1MDA7CiAgICB0LmVpZ2h0ID0gNTAwOwogICAgdC5uaW5lID0gNTAwOwogICAgdC5jb2xvbiA9IDMzMzsKICAgIHQuc2VtaWNvbG9uID0gMzMzOwogICAgdC5sZXNzID0gNTcwOwogICAgdC5lcXVhbCA9IDU3MDsKICAgIHQuZ3JlYXRlciA9IDU3MDsKICAgIHQucXVlc3Rpb24gPSA1MDA7CiAgICB0LmF0ID0gOTMwOwogICAgdC5BID0gNzIyOwogICAgdC5CID0gNjY3OwogICAgdC5DID0gNzIyOwogICAgdC5EID0gNzIyOwogICAgdC5FID0gNjY3OwogICAgdC5GID0gNjExOwogICAgdC5HID0gNzc4OwogICAgdC5IID0gNzc4OwogICAgdC5JID0gMzg5OwogICAgdC5KID0gNTAwOwogICAgdC5LID0gNzc4OwogICAgdC5MID0gNjY3OwogICAgdC5NID0gOTQ0OwogICAgdC5OID0gNzIyOwogICAgdC5PID0gNzc4OwogICAgdC5QID0gNjExOwogICAgdC5RID0gNzc4OwogICAgdC5SID0gNzIyOwogICAgdC5TID0gNTU2OwogICAgdC5UID0gNjY3OwogICAgdC5VID0gNzIyOwogICAgdC5WID0gNzIyOwogICAgdC5XID0gMTAwMDsKICAgIHQuWCA9IDcyMjsKICAgIHQuWSA9IDcyMjsKICAgIHQuWiA9IDY2NzsKICAgIHQuYnJhY2tldGxlZnQgPSAzMzM7CiAgICB0LmJhY2tzbGFzaCA9IDI3ODsKICAgIHQuYnJhY2tldHJpZ2h0ID0gMzMzOwogICAgdC5hc2NpaWNpcmN1bSA9IDU4MTsKICAgIHQudW5kZXJzY29yZSA9IDUwMDsKICAgIHQucXVvdGVsZWZ0ID0gMzMzOwogICAgdC5hID0gNTAwOwogICAgdC5iID0gNTU2OwogICAgdC5jID0gNDQ0OwogICAgdC5kID0gNTU2OwogICAgdC5lID0gNDQ0OwogICAgdC5mID0gMzMzOwogICAgdC5nID0gNTAwOwogICAgdC5oID0gNTU2OwogICAgdC5pID0gMjc4OwogICAgdC5qID0gMzMzOwogICAgdC5rID0gNTU2OwogICAgdC5sID0gMjc4OwogICAgdC5tID0gODMzOwogICAgdC5uID0gNTU2OwogICAgdC5vID0gNTAwOwogICAgdC5wID0gNTU2OwogICAgdC5xID0gNTU2OwogICAgdC5yID0gNDQ0OwogICAgdC5zID0gMzg5OwogICAgdC50ID0gMzMzOwogICAgdC51ID0gNTU2OwogICAgdC52ID0gNTAwOwogICAgdC53ID0gNzIyOwogICAgdC54ID0gNTAwOwogICAgdC55ID0gNTAwOwogICAgdC56ID0gNDQ0OwogICAgdC5icmFjZWxlZnQgPSAzOTQ7CiAgICB0LmJhciA9IDIyMDsKICAgIHQuYnJhY2VyaWdodCA9IDM5NDsKICAgIHQuYXNjaWl0aWxkZSA9IDUyMDsKICAgIHQuZXhjbGFtZG93biA9IDMzMzsKICAgIHQuY2VudCA9IDUwMDsKICAgIHQuc3RlcmxpbmcgPSA1MDA7CiAgICB0LmZyYWN0aW9uID0gMTY3OwogICAgdC55ZW4gPSA1MDA7CiAgICB0LmZsb3JpbiA9IDUwMDsKICAgIHQuc2VjdGlvbiA9IDUwMDsKICAgIHQuY3VycmVuY3kgPSA1MDA7CiAgICB0LnF1b3Rlc2luZ2xlID0gMjc4OwogICAgdC5xdW90ZWRibGxlZnQgPSA1MDA7CiAgICB0Lmd1aWxsZW1vdGxlZnQgPSA1MDA7CiAgICB0Lmd1aWxzaW5nbGxlZnQgPSAzMzM7CiAgICB0Lmd1aWxzaW5nbHJpZ2h0ID0gMzMzOwogICAgdC5maSA9IDU1NjsKICAgIHQuZmwgPSA1NTY7CiAgICB0LmVuZGFzaCA9IDUwMDsKICAgIHQuZGFnZ2VyID0gNTAwOwogICAgdC5kYWdnZXJkYmwgPSA1MDA7CiAgICB0LnBlcmlvZGNlbnRlcmVkID0gMjUwOwogICAgdC5wYXJhZ3JhcGggPSA1NDA7CiAgICB0LmJ1bGxldCA9IDM1MDsKICAgIHQucXVvdGVzaW5nbGJhc2UgPSAzMzM7CiAgICB0LnF1b3RlZGJsYmFzZSA9IDUwMDsKICAgIHQucXVvdGVkYmxyaWdodCA9IDUwMDsKICAgIHQuZ3VpbGxlbW90cmlnaHQgPSA1MDA7CiAgICB0LmVsbGlwc2lzID0gMTAwMDsKICAgIHQucGVydGhvdXNhbmQgPSAxMDAwOwogICAgdC5xdWVzdGlvbmRvd24gPSA1MDA7CiAgICB0LmdyYXZlID0gMzMzOwogICAgdC5hY3V0ZSA9IDMzMzsKICAgIHQuY2lyY3VtZmxleCA9IDMzMzsKICAgIHQudGlsZGUgPSAzMzM7CiAgICB0Lm1hY3JvbiA9IDMzMzsKICAgIHQuYnJldmUgPSAzMzM7CiAgICB0LmRvdGFjY2VudCA9IDMzMzsKICAgIHQuZGllcmVzaXMgPSAzMzM7CiAgICB0LnJpbmcgPSAzMzM7CiAgICB0LmNlZGlsbGEgPSAzMzM7CiAgICB0Lmh1bmdhcnVtbGF1dCA9IDMzMzsKICAgIHQub2dvbmVrID0gMzMzOwogICAgdC5jYXJvbiA9IDMzMzsKICAgIHQuZW1kYXNoID0gMTAwMDsKICAgIHQuQUUgPSAxMDAwOwogICAgdC5vcmRmZW1pbmluZSA9IDMwMDsKICAgIHQuTHNsYXNoID0gNjY3OwogICAgdC5Pc2xhc2ggPSA3Nzg7CiAgICB0Lk9FID0gMTAwMDsKICAgIHQub3JkbWFzY3VsaW5lID0gMzMwOwogICAgdC5hZSA9IDcyMjsKICAgIHQuZG90bGVzc2kgPSAyNzg7CiAgICB0LmxzbGFzaCA9IDI3ODsKICAgIHQub3NsYXNoID0gNTAwOwogICAgdC5vZSA9IDcyMjsKICAgIHQuZ2VybWFuZGJscyA9IDU1NjsKICAgIHQuSWRpZXJlc2lzID0gMzg5OwogICAgdC5lYWN1dGUgPSA0NDQ7CiAgICB0LmFicmV2ZSA9IDUwMDsKICAgIHQudWh1bmdhcnVtbGF1dCA9IDU1NjsKICAgIHQuZWNhcm9uID0gNDQ0OwogICAgdC5ZZGllcmVzaXMgPSA3MjI7CiAgICB0LmRpdmlkZSA9IDU3MDsKICAgIHQuWWFjdXRlID0gNzIyOwogICAgdC5BY2lyY3VtZmxleCA9IDcyMjsKICAgIHQuYWFjdXRlID0gNTAwOwogICAgdC5VY2lyY3VtZmxleCA9IDcyMjsKICAgIHQueWFjdXRlID0gNTAwOwogICAgdC5zY29tbWFhY2NlbnQgPSAzODk7CiAgICB0LmVjaXJjdW1mbGV4ID0gNDQ0OwogICAgdC5VcmluZyA9IDcyMjsKICAgIHQuVWRpZXJlc2lzID0gNzIyOwogICAgdC5hb2dvbmVrID0gNTAwOwogICAgdC5VYWN1dGUgPSA3MjI7CiAgICB0LnVvZ29uZWsgPSA1NTY7CiAgICB0LkVkaWVyZXNpcyA9IDY2NzsKICAgIHQuRGNyb2F0ID0gNzIyOwogICAgdC5jb21tYWFjY2VudCA9IDI1MDsKICAgIHQuY29weXJpZ2h0ID0gNzQ3OwogICAgdC5FbWFjcm9uID0gNjY3OwogICAgdC5jY2Fyb24gPSA0NDQ7CiAgICB0LmFyaW5nID0gNTAwOwogICAgdC5OY29tbWFhY2NlbnQgPSA3MjI7CiAgICB0LmxhY3V0ZSA9IDI3ODsKICAgIHQuYWdyYXZlID0gNTAwOwogICAgdC5UY29tbWFhY2NlbnQgPSA2Njc7CiAgICB0LkNhY3V0ZSA9IDcyMjsKICAgIHQuYXRpbGRlID0gNTAwOwogICAgdC5FZG90YWNjZW50ID0gNjY3OwogICAgdC5zY2Fyb24gPSAzODk7CiAgICB0LnNjZWRpbGxhID0gMzg5OwogICAgdC5pYWN1dGUgPSAyNzg7CiAgICB0LmxvemVuZ2UgPSA0OTQ7CiAgICB0LlJjYXJvbiA9IDcyMjsKICAgIHQuR2NvbW1hYWNjZW50ID0gNzc4OwogICAgdC51Y2lyY3VtZmxleCA9IDU1NjsKICAgIHQuYWNpcmN1bWZsZXggPSA1MDA7CiAgICB0LkFtYWNyb24gPSA3MjI7CiAgICB0LnJjYXJvbiA9IDQ0NDsKICAgIHQuY2NlZGlsbGEgPSA0NDQ7CiAgICB0Llpkb3RhY2NlbnQgPSA2Njc7CiAgICB0LlRob3JuID0gNjExOwogICAgdC5PbWFjcm9uID0gNzc4OwogICAgdC5SYWN1dGUgPSA3MjI7CiAgICB0LlNhY3V0ZSA9IDU1NjsKICAgIHQuZGNhcm9uID0gNjcyOwogICAgdC5VbWFjcm9uID0gNzIyOwogICAgdC51cmluZyA9IDU1NjsKICAgIHQudGhyZWVzdXBlcmlvciA9IDMwMDsKICAgIHQuT2dyYXZlID0gNzc4OwogICAgdC5BZ3JhdmUgPSA3MjI7CiAgICB0LkFicmV2ZSA9IDcyMjsKICAgIHQubXVsdGlwbHkgPSA1NzA7CiAgICB0LnVhY3V0ZSA9IDU1NjsKICAgIHQuVGNhcm9uID0gNjY3OwogICAgdC5wYXJ0aWFsZGlmZiA9IDQ5NDsKICAgIHQueWRpZXJlc2lzID0gNTAwOwogICAgdC5OYWN1dGUgPSA3MjI7CiAgICB0LmljaXJjdW1mbGV4ID0gMjc4OwogICAgdC5FY2lyY3VtZmxleCA9IDY2NzsKICAgIHQuYWRpZXJlc2lzID0gNTAwOwogICAgdC5lZGllcmVzaXMgPSA0NDQ7CiAgICB0LmNhY3V0ZSA9IDQ0NDsKICAgIHQubmFjdXRlID0gNTU2OwogICAgdC51bWFjcm9uID0gNTU2OwogICAgdC5OY2Fyb24gPSA3MjI7CiAgICB0LklhY3V0ZSA9IDM4OTsKICAgIHQucGx1c21pbnVzID0gNTcwOwogICAgdC5icm9rZW5iYXIgPSAyMjA7CiAgICB0LnJlZ2lzdGVyZWQgPSA3NDc7CiAgICB0LkdicmV2ZSA9IDc3ODsKICAgIHQuSWRvdGFjY2VudCA9IDM4OTsKICAgIHQuc3VtbWF0aW9uID0gNjAwOwogICAgdC5FZ3JhdmUgPSA2Njc7CiAgICB0LnJhY3V0ZSA9IDQ0NDsKICAgIHQub21hY3JvbiA9IDUwMDsKICAgIHQuWmFjdXRlID0gNjY3OwogICAgdC5aY2Fyb24gPSA2Njc7CiAgICB0LmdyZWF0ZXJlcXVhbCA9IDU0OTsKICAgIHQuRXRoID0gNzIyOwogICAgdC5DY2VkaWxsYSA9IDcyMjsKICAgIHQubGNvbW1hYWNjZW50ID0gMjc4OwogICAgdC50Y2Fyb24gPSA0MTY7CiAgICB0LmVvZ29uZWsgPSA0NDQ7CiAgICB0LlVvZ29uZWsgPSA3MjI7CiAgICB0LkFhY3V0ZSA9IDcyMjsKICAgIHQuQWRpZXJlc2lzID0gNzIyOwogICAgdC5lZ3JhdmUgPSA0NDQ7CiAgICB0LnphY3V0ZSA9IDQ0NDsKICAgIHQuaW9nb25layA9IDI3ODsKICAgIHQuT2FjdXRlID0gNzc4OwogICAgdC5vYWN1dGUgPSA1MDA7CiAgICB0LmFtYWNyb24gPSA1MDA7CiAgICB0LnNhY3V0ZSA9IDM4OTsKICAgIHQuaWRpZXJlc2lzID0gMjc4OwogICAgdC5PY2lyY3VtZmxleCA9IDc3ODsKICAgIHQuVWdyYXZlID0gNzIyOwogICAgdC5EZWx0YSA9IDYxMjsKICAgIHQudGhvcm4gPSA1NTY7CiAgICB0LnR3b3N1cGVyaW9yID0gMzAwOwogICAgdC5PZGllcmVzaXMgPSA3Nzg7CiAgICB0Lm11ID0gNTU2OwogICAgdC5pZ3JhdmUgPSAyNzg7CiAgICB0Lm9odW5nYXJ1bWxhdXQgPSA1MDA7CiAgICB0LkVvZ29uZWsgPSA2Njc7CiAgICB0LmRjcm9hdCA9IDU1NjsKICAgIHQudGhyZWVxdWFydGVycyA9IDc1MDsKICAgIHQuU2NlZGlsbGEgPSA1NTY7CiAgICB0LmxjYXJvbiA9IDM5NDsKICAgIHQuS2NvbW1hYWNjZW50ID0gNzc4OwogICAgdC5MYWN1dGUgPSA2Njc7CiAgICB0LnRyYWRlbWFyayA9IDEwMDA7CiAgICB0LmVkb3RhY2NlbnQgPSA0NDQ7CiAgICB0LklncmF2ZSA9IDM4OTsKICAgIHQuSW1hY3JvbiA9IDM4OTsKICAgIHQuTGNhcm9uID0gNjY3OwogICAgdC5vbmVoYWxmID0gNzUwOwogICAgdC5sZXNzZXF1YWwgPSA1NDk7CiAgICB0Lm9jaXJjdW1mbGV4ID0gNTAwOwogICAgdC5udGlsZGUgPSA1NTY7CiAgICB0LlVodW5nYXJ1bWxhdXQgPSA3MjI7CiAgICB0LkVhY3V0ZSA9IDY2NzsKICAgIHQuZW1hY3JvbiA9IDQ0NDsKICAgIHQuZ2JyZXZlID0gNTAwOwogICAgdC5vbmVxdWFydGVyID0gNzUwOwogICAgdC5TY2Fyb24gPSA1NTY7CiAgICB0LlNjb21tYWFjY2VudCA9IDU1NjsKICAgIHQuT2h1bmdhcnVtbGF1dCA9IDc3ODsKICAgIHQuZGVncmVlID0gNDAwOwogICAgdC5vZ3JhdmUgPSA1MDA7CiAgICB0LkNjYXJvbiA9IDcyMjsKICAgIHQudWdyYXZlID0gNTU2OwogICAgdC5yYWRpY2FsID0gNTQ5OwogICAgdC5EY2Fyb24gPSA3MjI7CiAgICB0LnJjb21tYWFjY2VudCA9IDQ0NDsKICAgIHQuTnRpbGRlID0gNzIyOwogICAgdC5vdGlsZGUgPSA1MDA7CiAgICB0LlJjb21tYWFjY2VudCA9IDcyMjsKICAgIHQuTGNvbW1hYWNjZW50ID0gNjY3OwogICAgdC5BdGlsZGUgPSA3MjI7CiAgICB0LkFvZ29uZWsgPSA3MjI7CiAgICB0LkFyaW5nID0gNzIyOwogICAgdC5PdGlsZGUgPSA3Nzg7CiAgICB0Lnpkb3RhY2NlbnQgPSA0NDQ7CiAgICB0LkVjYXJvbiA9IDY2NzsKICAgIHQuSW9nb25layA9IDM4OTsKICAgIHQua2NvbW1hYWNjZW50ID0gNTU2OwogICAgdC5taW51cyA9IDU3MDsKICAgIHQuSWNpcmN1bWZsZXggPSAzODk7CiAgICB0Lm5jYXJvbiA9IDU1NjsKICAgIHQudGNvbW1hYWNjZW50ID0gMzMzOwogICAgdC5sb2dpY2Fsbm90ID0gNTcwOwogICAgdC5vZGllcmVzaXMgPSA1MDA7CiAgICB0LnVkaWVyZXNpcyA9IDU1NjsKICAgIHQubm90ZXF1YWwgPSA1NDk7CiAgICB0Lmdjb21tYWFjY2VudCA9IDUwMDsKICAgIHQuZXRoID0gNTAwOwogICAgdC56Y2Fyb24gPSA0NDQ7CiAgICB0Lm5jb21tYWFjY2VudCA9IDU1NjsKICAgIHQub25lc3VwZXJpb3IgPSAzMDA7CiAgICB0LmltYWNyb24gPSAyNzg7CiAgICB0LkV1cm8gPSA1MDA7CiAgfSk7CiAgdFsiVGltZXMtQm9sZEl0YWxpYyJdID0gKDAsIF9jb3JlX3V0aWxzLmdldExvb2t1cFRhYmxlRmFjdG9yeSkoZnVuY3Rpb24gKHQpIHsKICAgIHQuc3BhY2UgPSAyNTA7CiAgICB0LmV4Y2xhbSA9IDM4OTsKICAgIHQucXVvdGVkYmwgPSA1NTU7CiAgICB0Lm51bWJlcnNpZ24gPSA1MDA7CiAgICB0LmRvbGxhciA9IDUwMDsKICAgIHQucGVyY2VudCA9IDgzMzsKICAgIHQuYW1wZXJzYW5kID0gNzc4OwogICAgdC5xdW90ZXJpZ2h0ID0gMzMzOwogICAgdC5wYXJlbmxlZnQgPSAzMzM7CiAgICB0LnBhcmVucmlnaHQgPSAzMzM7CiAgICB0LmFzdGVyaXNrID0gNTAwOwogICAgdC5wbHVzID0gNTcwOwogICAgdC5jb21tYSA9IDI1MDsKICAgIHQuaHlwaGVuID0gMzMzOwogICAgdC5wZXJpb2QgPSAyNTA7CiAgICB0LnNsYXNoID0gMjc4OwogICAgdC56ZXJvID0gNTAwOwogICAgdC5vbmUgPSA1MDA7CiAgICB0LnR3byA9IDUwMDsKICAgIHQudGhyZWUgPSA1MDA7CiAgICB0LmZvdXIgPSA1MDA7CiAgICB0LmZpdmUgPSA1MDA7CiAgICB0LnNpeCA9IDUwMDsKICAgIHQuc2V2ZW4gPSA1MDA7CiAgICB0LmVpZ2h0ID0gNTAwOwogICAgdC5uaW5lID0gNTAwOwogICAgdC5jb2xvbiA9IDMzMzsKICAgIHQuc2VtaWNvbG9uID0gMzMzOwogICAgdC5sZXNzID0gNTcwOwogICAgdC5lcXVhbCA9IDU3MDsKICAgIHQuZ3JlYXRlciA9IDU3MDsKICAgIHQucXVlc3Rpb24gPSA1MDA7CiAgICB0LmF0ID0gODMyOwogICAgdC5BID0gNjY3OwogICAgdC5CID0gNjY3OwogICAgdC5DID0gNjY3OwogICAgdC5EID0gNzIyOwogICAgdC5FID0gNjY3OwogICAgdC5GID0gNjY3OwogICAgdC5HID0gNzIyOwogICAgdC5IID0gNzc4OwogICAgdC5JID0gMzg5OwogICAgdC5KID0gNTAwOwogICAgdC5LID0gNjY3OwogICAgdC5MID0gNjExOwogICAgdC5NID0gODg5OwogICAgdC5OID0gNzIyOwogICAgdC5PID0gNzIyOwogICAgdC5QID0gNjExOwogICAgdC5RID0gNzIyOwogICAgdC5SID0gNjY3OwogICAgdC5TID0gNTU2OwogICAgdC5UID0gNjExOwogICAgdC5VID0gNzIyOwogICAgdC5WID0gNjY3OwogICAgdC5XID0gODg5OwogICAgdC5YID0gNjY3OwogICAgdC5ZID0gNjExOwogICAgdC5aID0gNjExOwogICAgdC5icmFja2V0bGVmdCA9IDMzMzsKICAgIHQuYmFja3NsYXNoID0gMjc4OwogICAgdC5icmFja2V0cmlnaHQgPSAzMzM7CiAgICB0LmFzY2lpY2lyY3VtID0gNTcwOwogICAgdC51bmRlcnNjb3JlID0gNTAwOwogICAgdC5xdW90ZWxlZnQgPSAzMzM7CiAgICB0LmEgPSA1MDA7CiAgICB0LmIgPSA1MDA7CiAgICB0LmMgPSA0NDQ7CiAgICB0LmQgPSA1MDA7CiAgICB0LmUgPSA0NDQ7CiAgICB0LmYgPSAzMzM7CiAgICB0LmcgPSA1MDA7CiAgICB0LmggPSA1NTY7CiAgICB0LmkgPSAyNzg7CiAgICB0LmogPSAyNzg7CiAgICB0LmsgPSA1MDA7CiAgICB0LmwgPSAyNzg7CiAgICB0Lm0gPSA3Nzg7CiAgICB0Lm4gPSA1NTY7CiAgICB0Lm8gPSA1MDA7CiAgICB0LnAgPSA1MDA7CiAgICB0LnEgPSA1MDA7CiAgICB0LnIgPSAzODk7CiAgICB0LnMgPSAzODk7CiAgICB0LnQgPSAyNzg7CiAgICB0LnUgPSA1NTY7CiAgICB0LnYgPSA0NDQ7CiAgICB0LncgPSA2Njc7CiAgICB0LnggPSA1MDA7CiAgICB0LnkgPSA0NDQ7CiAgICB0LnogPSAzODk7CiAgICB0LmJyYWNlbGVmdCA9IDM0ODsKICAgIHQuYmFyID0gMjIwOwogICAgdC5icmFjZXJpZ2h0ID0gMzQ4OwogICAgdC5hc2NpaXRpbGRlID0gNTcwOwogICAgdC5leGNsYW1kb3duID0gMzg5OwogICAgdC5jZW50ID0gNTAwOwogICAgdC5zdGVybGluZyA9IDUwMDsKICAgIHQuZnJhY3Rpb24gPSAxNjc7CiAgICB0LnllbiA9IDUwMDsKICAgIHQuZmxvcmluID0gNTAwOwogICAgdC5zZWN0aW9uID0gNTAwOwogICAgdC5jdXJyZW5jeSA9IDUwMDsKICAgIHQucXVvdGVzaW5nbGUgPSAyNzg7CiAgICB0LnF1b3RlZGJsbGVmdCA9IDUwMDsKICAgIHQuZ3VpbGxlbW90bGVmdCA9IDUwMDsKICAgIHQuZ3VpbHNpbmdsbGVmdCA9IDMzMzsKICAgIHQuZ3VpbHNpbmdscmlnaHQgPSAzMzM7CiAgICB0LmZpID0gNTU2OwogICAgdC5mbCA9IDU1NjsKICAgIHQuZW5kYXNoID0gNTAwOwogICAgdC5kYWdnZXIgPSA1MDA7CiAgICB0LmRhZ2dlcmRibCA9IDUwMDsKICAgIHQucGVyaW9kY2VudGVyZWQgPSAyNTA7CiAgICB0LnBhcmFncmFwaCA9IDUwMDsKICAgIHQuYnVsbGV0ID0gMzUwOwogICAgdC5xdW90ZXNpbmdsYmFzZSA9IDMzMzsKICAgIHQucXVvdGVkYmxiYXNlID0gNTAwOwogICAgdC5xdW90ZWRibHJpZ2h0ID0gNTAwOwogICAgdC5ndWlsbGVtb3RyaWdodCA9IDUwMDsKICAgIHQuZWxsaXBzaXMgPSAxMDAwOwogICAgdC5wZXJ0aG91c2FuZCA9IDEwMDA7CiAgICB0LnF1ZXN0aW9uZG93biA9IDUwMDsKICAgIHQuZ3JhdmUgPSAzMzM7CiAgICB0LmFjdXRlID0gMzMzOwogICAgdC5jaXJjdW1mbGV4ID0gMzMzOwogICAgdC50aWxkZSA9IDMzMzsKICAgIHQubWFjcm9uID0gMzMzOwogICAgdC5icmV2ZSA9IDMzMzsKICAgIHQuZG90YWNjZW50ID0gMzMzOwogICAgdC5kaWVyZXNpcyA9IDMzMzsKICAgIHQucmluZyA9IDMzMzsKICAgIHQuY2VkaWxsYSA9IDMzMzsKICAgIHQuaHVuZ2FydW1sYXV0ID0gMzMzOwogICAgdC5vZ29uZWsgPSAzMzM7CiAgICB0LmNhcm9uID0gMzMzOwogICAgdC5lbWRhc2ggPSAxMDAwOwogICAgdC5BRSA9IDk0NDsKICAgIHQub3JkZmVtaW5pbmUgPSAyNjY7CiAgICB0LkxzbGFzaCA9IDYxMTsKICAgIHQuT3NsYXNoID0gNzIyOwogICAgdC5PRSA9IDk0NDsKICAgIHQub3JkbWFzY3VsaW5lID0gMzAwOwogICAgdC5hZSA9IDcyMjsKICAgIHQuZG90bGVzc2kgPSAyNzg7CiAgICB0LmxzbGFzaCA9IDI3ODsKICAgIHQub3NsYXNoID0gNTAwOwogICAgdC5vZSA9IDcyMjsKICAgIHQuZ2VybWFuZGJscyA9IDUwMDsKICAgIHQuSWRpZXJlc2lzID0gMzg5OwogICAgdC5lYWN1dGUgPSA0NDQ7CiAgICB0LmFicmV2ZSA9IDUwMDsKICAgIHQudWh1bmdhcnVtbGF1dCA9IDU1NjsKICAgIHQuZWNhcm9uID0gNDQ0OwogICAgdC5ZZGllcmVzaXMgPSA2MTE7CiAgICB0LmRpdmlkZSA9IDU3MDsKICAgIHQuWWFjdXRlID0gNjExOwogICAgdC5BY2lyY3VtZmxleCA9IDY2NzsKICAgIHQuYWFjdXRlID0gNTAwOwogICAgdC5VY2lyY3VtZmxleCA9IDcyMjsKICAgIHQueWFjdXRlID0gNDQ0OwogICAgdC5zY29tbWFhY2NlbnQgPSAzODk7CiAgICB0LmVjaXJjdW1mbGV4ID0gNDQ0OwogICAgdC5VcmluZyA9IDcyMjsKICAgIHQuVWRpZXJlc2lzID0gNzIyOwogICAgdC5hb2dvbmVrID0gNTAwOwogICAgdC5VYWN1dGUgPSA3MjI7CiAgICB0LnVvZ29uZWsgPSA1NTY7CiAgICB0LkVkaWVyZXNpcyA9IDY2NzsKICAgIHQuRGNyb2F0ID0gNzIyOwogICAgdC5jb21tYWFjY2VudCA9IDI1MDsKICAgIHQuY29weXJpZ2h0ID0gNzQ3OwogICAgdC5FbWFjcm9uID0gNjY3OwogICAgdC5jY2Fyb24gPSA0NDQ7CiAgICB0LmFyaW5nID0gNTAwOwogICAgdC5OY29tbWFhY2NlbnQgPSA3MjI7CiAgICB0LmxhY3V0ZSA9IDI3ODsKICAgIHQuYWdyYXZlID0gNTAwOwogICAgdC5UY29tbWFhY2NlbnQgPSA2MTE7CiAgICB0LkNhY3V0ZSA9IDY2NzsKICAgIHQuYXRpbGRlID0gNTAwOwogICAgdC5FZG90YWNjZW50ID0gNjY3OwogICAgdC5zY2Fyb24gPSAzODk7CiAgICB0LnNjZWRpbGxhID0gMzg5OwogICAgdC5pYWN1dGUgPSAyNzg7CiAgICB0LmxvemVuZ2UgPSA0OTQ7CiAgICB0LlJjYXJvbiA9IDY2NzsKICAgIHQuR2NvbW1hYWNjZW50ID0gNzIyOwogICAgdC51Y2lyY3VtZmxleCA9IDU1NjsKICAgIHQuYWNpcmN1bWZsZXggPSA1MDA7CiAgICB0LkFtYWNyb24gPSA2Njc7CiAgICB0LnJjYXJvbiA9IDM4OTsKICAgIHQuY2NlZGlsbGEgPSA0NDQ7CiAgICB0Llpkb3RhY2NlbnQgPSA2MTE7CiAgICB0LlRob3JuID0gNjExOwogICAgdC5PbWFjcm9uID0gNzIyOwogICAgdC5SYWN1dGUgPSA2Njc7CiAgICB0LlNhY3V0ZSA9IDU1NjsKICAgIHQuZGNhcm9uID0gNjA4OwogICAgdC5VbWFjcm9uID0gNzIyOwogICAgdC51cmluZyA9IDU1NjsKICAgIHQudGhyZWVzdXBlcmlvciA9IDMwMDsKICAgIHQuT2dyYXZlID0gNzIyOwogICAgdC5BZ3JhdmUgPSA2Njc7CiAgICB0LkFicmV2ZSA9IDY2NzsKICAgIHQubXVsdGlwbHkgPSA1NzA7CiAgICB0LnVhY3V0ZSA9IDU1NjsKICAgIHQuVGNhcm9uID0gNjExOwogICAgdC5wYXJ0aWFsZGlmZiA9IDQ5NDsKICAgIHQueWRpZXJlc2lzID0gNDQ0OwogICAgdC5OYWN1dGUgPSA3MjI7CiAgICB0LmljaXJjdW1mbGV4ID0gMjc4OwogICAgdC5FY2lyY3VtZmxleCA9IDY2NzsKICAgIHQuYWRpZXJlc2lzID0gNTAwOwogICAgdC5lZGllcmVzaXMgPSA0NDQ7CiAgICB0LmNhY3V0ZSA9IDQ0NDsKICAgIHQubmFjdXRlID0gNTU2OwogICAgdC51bWFjcm9uID0gNTU2OwogICAgdC5OY2Fyb24gPSA3MjI7CiAgICB0LklhY3V0ZSA9IDM4OTsKICAgIHQucGx1c21pbnVzID0gNTcwOwogICAgdC5icm9rZW5iYXIgPSAyMjA7CiAgICB0LnJlZ2lzdGVyZWQgPSA3NDc7CiAgICB0LkdicmV2ZSA9IDcyMjsKICAgIHQuSWRvdGFjY2VudCA9IDM4OTsKICAgIHQuc3VtbWF0aW9uID0gNjAwOwogICAgdC5FZ3JhdmUgPSA2Njc7CiAgICB0LnJhY3V0ZSA9IDM4OTsKICAgIHQub21hY3JvbiA9IDUwMDsKICAgIHQuWmFjdXRlID0gNjExOwogICAgdC5aY2Fyb24gPSA2MTE7CiAgICB0LmdyZWF0ZXJlcXVhbCA9IDU0OTsKICAgIHQuRXRoID0gNzIyOwogICAgdC5DY2VkaWxsYSA9IDY2NzsKICAgIHQubGNvbW1hYWNjZW50ID0gMjc4OwogICAgdC50Y2Fyb24gPSAzNjY7CiAgICB0LmVvZ29uZWsgPSA0NDQ7CiAgICB0LlVvZ29uZWsgPSA3MjI7CiAgICB0LkFhY3V0ZSA9IDY2NzsKICAgIHQuQWRpZXJlc2lzID0gNjY3OwogICAgdC5lZ3JhdmUgPSA0NDQ7CiAgICB0LnphY3V0ZSA9IDM4OTsKICAgIHQuaW9nb25layA9IDI3ODsKICAgIHQuT2FjdXRlID0gNzIyOwogICAgdC5vYWN1dGUgPSA1MDA7CiAgICB0LmFtYWNyb24gPSA1MDA7CiAgICB0LnNhY3V0ZSA9IDM4OTsKICAgIHQuaWRpZXJlc2lzID0gMjc4OwogICAgdC5PY2lyY3VtZmxleCA9IDcyMjsKICAgIHQuVWdyYXZlID0gNzIyOwogICAgdC5EZWx0YSA9IDYxMjsKICAgIHQudGhvcm4gPSA1MDA7CiAgICB0LnR3b3N1cGVyaW9yID0gMzAwOwogICAgdC5PZGllcmVzaXMgPSA3MjI7CiAgICB0Lm11ID0gNTc2OwogICAgdC5pZ3JhdmUgPSAyNzg7CiAgICB0Lm9odW5nYXJ1bWxhdXQgPSA1MDA7CiAgICB0LkVvZ29uZWsgPSA2Njc7CiAgICB0LmRjcm9hdCA9IDUwMDsKICAgIHQudGhyZWVxdWFydGVycyA9IDc1MDsKICAgIHQuU2NlZGlsbGEgPSA1NTY7CiAgICB0LmxjYXJvbiA9IDM4MjsKICAgIHQuS2NvbW1hYWNjZW50ID0gNjY3OwogICAgdC5MYWN1dGUgPSA2MTE7CiAgICB0LnRyYWRlbWFyayA9IDEwMDA7CiAgICB0LmVkb3RhY2NlbnQgPSA0NDQ7CiAgICB0LklncmF2ZSA9IDM4OTsKICAgIHQuSW1hY3JvbiA9IDM4OTsKICAgIHQuTGNhcm9uID0gNjExOwogICAgdC5vbmVoYWxmID0gNzUwOwogICAgdC5sZXNzZXF1YWwgPSA1NDk7CiAgICB0Lm9jaXJjdW1mbGV4ID0gNTAwOwogICAgdC5udGlsZGUgPSA1NTY7CiAgICB0LlVodW5nYXJ1bWxhdXQgPSA3MjI7CiAgICB0LkVhY3V0ZSA9IDY2NzsKICAgIHQuZW1hY3JvbiA9IDQ0NDsKICAgIHQuZ2JyZXZlID0gNTAwOwogICAgdC5vbmVxdWFydGVyID0gNzUwOwogICAgdC5TY2Fyb24gPSA1NTY7CiAgICB0LlNjb21tYWFjY2VudCA9IDU1NjsKICAgIHQuT2h1bmdhcnVtbGF1dCA9IDcyMjsKICAgIHQuZGVncmVlID0gNDAwOwogICAgdC5vZ3JhdmUgPSA1MDA7CiAgICB0LkNjYXJvbiA9IDY2NzsKICAgIHQudWdyYXZlID0gNTU2OwogICAgdC5yYWRpY2FsID0gNTQ5OwogICAgdC5EY2Fyb24gPSA3MjI7CiAgICB0LnJjb21tYWFjY2VudCA9IDM4OTsKICAgIHQuTnRpbGRlID0gNzIyOwogICAgdC5vdGlsZGUgPSA1MDA7CiAgICB0LlJjb21tYWFjY2VudCA9IDY2NzsKICAgIHQuTGNvbW1hYWNjZW50ID0gNjExOwogICAgdC5BdGlsZGUgPSA2Njc7CiAgICB0LkFvZ29uZWsgPSA2Njc7CiAgICB0LkFyaW5nID0gNjY3OwogICAgdC5PdGlsZGUgPSA3MjI7CiAgICB0Lnpkb3RhY2NlbnQgPSAzODk7CiAgICB0LkVjYXJvbiA9IDY2NzsKICAgIHQuSW9nb25layA9IDM4OTsKICAgIHQua2NvbW1hYWNjZW50ID0gNTAwOwogICAgdC5taW51cyA9IDYwNjsKICAgIHQuSWNpcmN1bWZsZXggPSAzODk7CiAgICB0Lm5jYXJvbiA9IDU1NjsKICAgIHQudGNvbW1hYWNjZW50ID0gMjc4OwogICAgdC5sb2dpY2Fsbm90ID0gNjA2OwogICAgdC5vZGllcmVzaXMgPSA1MDA7CiAgICB0LnVkaWVyZXNpcyA9IDU1NjsKICAgIHQubm90ZXF1YWwgPSA1NDk7CiAgICB0Lmdjb21tYWFjY2VudCA9IDUwMDsKICAgIHQuZXRoID0gNTAwOwogICAgdC56Y2Fyb24gPSAzODk7CiAgICB0Lm5jb21tYWFjY2VudCA9IDU1NjsKICAgIHQub25lc3VwZXJpb3IgPSAzMDA7CiAgICB0LmltYWNyb24gPSAyNzg7CiAgICB0LkV1cm8gPSA1MDA7CiAgfSk7CiAgdFsiVGltZXMtSXRhbGljIl0gPSAoMCwgX2NvcmVfdXRpbHMuZ2V0TG9va3VwVGFibGVGYWN0b3J5KShmdW5jdGlvbiAodCkgewogICAgdC5zcGFjZSA9IDI1MDsKICAgIHQuZXhjbGFtID0gMzMzOwogICAgdC5xdW90ZWRibCA9IDQyMDsKICAgIHQubnVtYmVyc2lnbiA9IDUwMDsKICAgIHQuZG9sbGFyID0gNTAwOwogICAgdC5wZXJjZW50ID0gODMzOwogICAgdC5hbXBlcnNhbmQgPSA3Nzg7CiAgICB0LnF1b3RlcmlnaHQgPSAzMzM7CiAgICB0LnBhcmVubGVmdCA9IDMzMzsKICAgIHQucGFyZW5yaWdodCA9IDMzMzsKICAgIHQuYXN0ZXJpc2sgPSA1MDA7CiAgICB0LnBsdXMgPSA2NzU7CiAgICB0LmNvbW1hID0gMjUwOwogICAgdC5oeXBoZW4gPSAzMzM7CiAgICB0LnBlcmlvZCA9IDI1MDsKICAgIHQuc2xhc2ggPSAyNzg7CiAgICB0Lnplcm8gPSA1MDA7CiAgICB0Lm9uZSA9IDUwMDsKICAgIHQudHdvID0gNTAwOwogICAgdC50aHJlZSA9IDUwMDsKICAgIHQuZm91ciA9IDUwMDsKICAgIHQuZml2ZSA9IDUwMDsKICAgIHQuc2l4ID0gNTAwOwogICAgdC5zZXZlbiA9IDUwMDsKICAgIHQuZWlnaHQgPSA1MDA7CiAgICB0Lm5pbmUgPSA1MDA7CiAgICB0LmNvbG9uID0gMzMzOwogICAgdC5zZW1pY29sb24gPSAzMzM7CiAgICB0Lmxlc3MgPSA2NzU7CiAgICB0LmVxdWFsID0gNjc1OwogICAgdC5ncmVhdGVyID0gNjc1OwogICAgdC5xdWVzdGlvbiA9IDUwMDsKICAgIHQuYXQgPSA5MjA7CiAgICB0LkEgPSA2MTE7CiAgICB0LkIgPSA2MTE7CiAgICB0LkMgPSA2Njc7CiAgICB0LkQgPSA3MjI7CiAgICB0LkUgPSA2MTE7CiAgICB0LkYgPSA2MTE7CiAgICB0LkcgPSA3MjI7CiAgICB0LkggPSA3MjI7CiAgICB0LkkgPSAzMzM7CiAgICB0LkogPSA0NDQ7CiAgICB0LksgPSA2Njc7CiAgICB0LkwgPSA1NTY7CiAgICB0Lk0gPSA4MzM7CiAgICB0Lk4gPSA2Njc7CiAgICB0Lk8gPSA3MjI7CiAgICB0LlAgPSA2MTE7CiAgICB0LlEgPSA3MjI7CiAgICB0LlIgPSA2MTE7CiAgICB0LlMgPSA1MDA7CiAgICB0LlQgPSA1NTY7CiAgICB0LlUgPSA3MjI7CiAgICB0LlYgPSA2MTE7CiAgICB0LlcgPSA4MzM7CiAgICB0LlggPSA2MTE7CiAgICB0LlkgPSA1NTY7CiAgICB0LlogPSA1NTY7CiAgICB0LmJyYWNrZXRsZWZ0ID0gMzg5OwogICAgdC5iYWNrc2xhc2ggPSAyNzg7CiAgICB0LmJyYWNrZXRyaWdodCA9IDM4OTsKICAgIHQuYXNjaWljaXJjdW0gPSA0MjI7CiAgICB0LnVuZGVyc2NvcmUgPSA1MDA7CiAgICB0LnF1b3RlbGVmdCA9IDMzMzsKICAgIHQuYSA9IDUwMDsKICAgIHQuYiA9IDUwMDsKICAgIHQuYyA9IDQ0NDsKICAgIHQuZCA9IDUwMDsKICAgIHQuZSA9IDQ0NDsKICAgIHQuZiA9IDI3ODsKICAgIHQuZyA9IDUwMDsKICAgIHQuaCA9IDUwMDsKICAgIHQuaSA9IDI3ODsKICAgIHQuaiA9IDI3ODsKICAgIHQuayA9IDQ0NDsKICAgIHQubCA9IDI3ODsKICAgIHQubSA9IDcyMjsKICAgIHQubiA9IDUwMDsKICAgIHQubyA9IDUwMDsKICAgIHQucCA9IDUwMDsKICAgIHQucSA9IDUwMDsKICAgIHQuciA9IDM4OTsKICAgIHQucyA9IDM4OTsKICAgIHQudCA9IDI3ODsKICAgIHQudSA9IDUwMDsKICAgIHQudiA9IDQ0NDsKICAgIHQudyA9IDY2NzsKICAgIHQueCA9IDQ0NDsKICAgIHQueSA9IDQ0NDsKICAgIHQueiA9IDM4OTsKICAgIHQuYnJhY2VsZWZ0ID0gNDAwOwogICAgdC5iYXIgPSAyNzU7CiAgICB0LmJyYWNlcmlnaHQgPSA0MDA7CiAgICB0LmFzY2lpdGlsZGUgPSA1NDE7CiAgICB0LmV4Y2xhbWRvd24gPSAzODk7CiAgICB0LmNlbnQgPSA1MDA7CiAgICB0LnN0ZXJsaW5nID0gNTAwOwogICAgdC5mcmFjdGlvbiA9IDE2NzsKICAgIHQueWVuID0gNTAwOwogICAgdC5mbG9yaW4gPSA1MDA7CiAgICB0LnNlY3Rpb24gPSA1MDA7CiAgICB0LmN1cnJlbmN5ID0gNTAwOwogICAgdC5xdW90ZXNpbmdsZSA9IDIxNDsKICAgIHQucXVvdGVkYmxsZWZ0ID0gNTU2OwogICAgdC5ndWlsbGVtb3RsZWZ0ID0gNTAwOwogICAgdC5ndWlsc2luZ2xsZWZ0ID0gMzMzOwogICAgdC5ndWlsc2luZ2xyaWdodCA9IDMzMzsKICAgIHQuZmkgPSA1MDA7CiAgICB0LmZsID0gNTAwOwogICAgdC5lbmRhc2ggPSA1MDA7CiAgICB0LmRhZ2dlciA9IDUwMDsKICAgIHQuZGFnZ2VyZGJsID0gNTAwOwogICAgdC5wZXJpb2RjZW50ZXJlZCA9IDI1MDsKICAgIHQucGFyYWdyYXBoID0gNTIzOwogICAgdC5idWxsZXQgPSAzNTA7CiAgICB0LnF1b3Rlc2luZ2xiYXNlID0gMzMzOwogICAgdC5xdW90ZWRibGJhc2UgPSA1NTY7CiAgICB0LnF1b3RlZGJscmlnaHQgPSA1NTY7CiAgICB0Lmd1aWxsZW1vdHJpZ2h0ID0gNTAwOwogICAgdC5lbGxpcHNpcyA9IDg4OTsKICAgIHQucGVydGhvdXNhbmQgPSAxMDAwOwogICAgdC5xdWVzdGlvbmRvd24gPSA1MDA7CiAgICB0LmdyYXZlID0gMzMzOwogICAgdC5hY3V0ZSA9IDMzMzsKICAgIHQuY2lyY3VtZmxleCA9IDMzMzsKICAgIHQudGlsZGUgPSAzMzM7CiAgICB0Lm1hY3JvbiA9IDMzMzsKICAgIHQuYnJldmUgPSAzMzM7CiAgICB0LmRvdGFjY2VudCA9IDMzMzsKICAgIHQuZGllcmVzaXMgPSAzMzM7CiAgICB0LnJpbmcgPSAzMzM7CiAgICB0LmNlZGlsbGEgPSAzMzM7CiAgICB0Lmh1bmdhcnVtbGF1dCA9IDMzMzsKICAgIHQub2dvbmVrID0gMzMzOwogICAgdC5jYXJvbiA9IDMzMzsKICAgIHQuZW1kYXNoID0gODg5OwogICAgdC5BRSA9IDg4OTsKICAgIHQub3JkZmVtaW5pbmUgPSAyNzY7CiAgICB0LkxzbGFzaCA9IDU1NjsKICAgIHQuT3NsYXNoID0gNzIyOwogICAgdC5PRSA9IDk0NDsKICAgIHQub3JkbWFzY3VsaW5lID0gMzEwOwogICAgdC5hZSA9IDY2NzsKICAgIHQuZG90bGVzc2kgPSAyNzg7CiAgICB0LmxzbGFzaCA9IDI3ODsKICAgIHQub3NsYXNoID0gNTAwOwogICAgdC5vZSA9IDY2NzsKICAgIHQuZ2VybWFuZGJscyA9IDUwMDsKICAgIHQuSWRpZXJlc2lzID0gMzMzOwogICAgdC5lYWN1dGUgPSA0NDQ7CiAgICB0LmFicmV2ZSA9IDUwMDsKICAgIHQudWh1bmdhcnVtbGF1dCA9IDUwMDsKICAgIHQuZWNhcm9uID0gNDQ0OwogICAgdC5ZZGllcmVzaXMgPSA1NTY7CiAgICB0LmRpdmlkZSA9IDY3NTsKICAgIHQuWWFjdXRlID0gNTU2OwogICAgdC5BY2lyY3VtZmxleCA9IDYxMTsKICAgIHQuYWFjdXRlID0gNTAwOwogICAgdC5VY2lyY3VtZmxleCA9IDcyMjsKICAgIHQueWFjdXRlID0gNDQ0OwogICAgdC5zY29tbWFhY2NlbnQgPSAzODk7CiAgICB0LmVjaXJjdW1mbGV4ID0gNDQ0OwogICAgdC5VcmluZyA9IDcyMjsKICAgIHQuVWRpZXJlc2lzID0gNzIyOwogICAgdC5hb2dvbmVrID0gNTAwOwogICAgdC5VYWN1dGUgPSA3MjI7CiAgICB0LnVvZ29uZWsgPSA1MDA7CiAgICB0LkVkaWVyZXNpcyA9IDYxMTsKICAgIHQuRGNyb2F0ID0gNzIyOwogICAgdC5jb21tYWFjY2VudCA9IDI1MDsKICAgIHQuY29weXJpZ2h0ID0gNzYwOwogICAgdC5FbWFjcm9uID0gNjExOwogICAgdC5jY2Fyb24gPSA0NDQ7CiAgICB0LmFyaW5nID0gNTAwOwogICAgdC5OY29tbWFhY2NlbnQgPSA2Njc7CiAgICB0LmxhY3V0ZSA9IDI3ODsKICAgIHQuYWdyYXZlID0gNTAwOwogICAgdC5UY29tbWFhY2NlbnQgPSA1NTY7CiAgICB0LkNhY3V0ZSA9IDY2NzsKICAgIHQuYXRpbGRlID0gNTAwOwogICAgdC5FZG90YWNjZW50ID0gNjExOwogICAgdC5zY2Fyb24gPSAzODk7CiAgICB0LnNjZWRpbGxhID0gMzg5OwogICAgdC5pYWN1dGUgPSAyNzg7CiAgICB0LmxvemVuZ2UgPSA0NzE7CiAgICB0LlJjYXJvbiA9IDYxMTsKICAgIHQuR2NvbW1hYWNjZW50ID0gNzIyOwogICAgdC51Y2lyY3VtZmxleCA9IDUwMDsKICAgIHQuYWNpcmN1bWZsZXggPSA1MDA7CiAgICB0LkFtYWNyb24gPSA2MTE7CiAgICB0LnJjYXJvbiA9IDM4OTsKICAgIHQuY2NlZGlsbGEgPSA0NDQ7CiAgICB0Llpkb3RhY2NlbnQgPSA1NTY7CiAgICB0LlRob3JuID0gNjExOwogICAgdC5PbWFjcm9uID0gNzIyOwogICAgdC5SYWN1dGUgPSA2MTE7CiAgICB0LlNhY3V0ZSA9IDUwMDsKICAgIHQuZGNhcm9uID0gNTQ0OwogICAgdC5VbWFjcm9uID0gNzIyOwogICAgdC51cmluZyA9IDUwMDsKICAgIHQudGhyZWVzdXBlcmlvciA9IDMwMDsKICAgIHQuT2dyYXZlID0gNzIyOwogICAgdC5BZ3JhdmUgPSA2MTE7CiAgICB0LkFicmV2ZSA9IDYxMTsKICAgIHQubXVsdGlwbHkgPSA2NzU7CiAgICB0LnVhY3V0ZSA9IDUwMDsKICAgIHQuVGNhcm9uID0gNTU2OwogICAgdC5wYXJ0aWFsZGlmZiA9IDQ3NjsKICAgIHQueWRpZXJlc2lzID0gNDQ0OwogICAgdC5OYWN1dGUgPSA2Njc7CiAgICB0LmljaXJjdW1mbGV4ID0gMjc4OwogICAgdC5FY2lyY3VtZmxleCA9IDYxMTsKICAgIHQuYWRpZXJlc2lzID0gNTAwOwogICAgdC5lZGllcmVzaXMgPSA0NDQ7CiAgICB0LmNhY3V0ZSA9IDQ0NDsKICAgIHQubmFjdXRlID0gNTAwOwogICAgdC51bWFjcm9uID0gNTAwOwogICAgdC5OY2Fyb24gPSA2Njc7CiAgICB0LklhY3V0ZSA9IDMzMzsKICAgIHQucGx1c21pbnVzID0gNjc1OwogICAgdC5icm9rZW5iYXIgPSAyNzU7CiAgICB0LnJlZ2lzdGVyZWQgPSA3NjA7CiAgICB0LkdicmV2ZSA9IDcyMjsKICAgIHQuSWRvdGFjY2VudCA9IDMzMzsKICAgIHQuc3VtbWF0aW9uID0gNjAwOwogICAgdC5FZ3JhdmUgPSA2MTE7CiAgICB0LnJhY3V0ZSA9IDM4OTsKICAgIHQub21hY3JvbiA9IDUwMDsKICAgIHQuWmFjdXRlID0gNTU2OwogICAgdC5aY2Fyb24gPSA1NTY7CiAgICB0LmdyZWF0ZXJlcXVhbCA9IDU0OTsKICAgIHQuRXRoID0gNzIyOwogICAgdC5DY2VkaWxsYSA9IDY2NzsKICAgIHQubGNvbW1hYWNjZW50ID0gMjc4OwogICAgdC50Y2Fyb24gPSAzMDA7CiAgICB0LmVvZ29uZWsgPSA0NDQ7CiAgICB0LlVvZ29uZWsgPSA3MjI7CiAgICB0LkFhY3V0ZSA9IDYxMTsKICAgIHQuQWRpZXJlc2lzID0gNjExOwogICAgdC5lZ3JhdmUgPSA0NDQ7CiAgICB0LnphY3V0ZSA9IDM4OTsKICAgIHQuaW9nb25layA9IDI3ODsKICAgIHQuT2FjdXRlID0gNzIyOwogICAgdC5vYWN1dGUgPSA1MDA7CiAgICB0LmFtYWNyb24gPSA1MDA7CiAgICB0LnNhY3V0ZSA9IDM4OTsKICAgIHQuaWRpZXJlc2lzID0gMjc4OwogICAgdC5PY2lyY3VtZmxleCA9IDcyMjsKICAgIHQuVWdyYXZlID0gNzIyOwogICAgdC5EZWx0YSA9IDYxMjsKICAgIHQudGhvcm4gPSA1MDA7CiAgICB0LnR3b3N1cGVyaW9yID0gMzAwOwogICAgdC5PZGllcmVzaXMgPSA3MjI7CiAgICB0Lm11ID0gNTAwOwogICAgdC5pZ3JhdmUgPSAyNzg7CiAgICB0Lm9odW5nYXJ1bWxhdXQgPSA1MDA7CiAgICB0LkVvZ29uZWsgPSA2MTE7CiAgICB0LmRjcm9hdCA9IDUwMDsKICAgIHQudGhyZWVxdWFydGVycyA9IDc1MDsKICAgIHQuU2NlZGlsbGEgPSA1MDA7CiAgICB0LmxjYXJvbiA9IDMwMDsKICAgIHQuS2NvbW1hYWNjZW50ID0gNjY3OwogICAgdC5MYWN1dGUgPSA1NTY7CiAgICB0LnRyYWRlbWFyayA9IDk4MDsKICAgIHQuZWRvdGFjY2VudCA9IDQ0NDsKICAgIHQuSWdyYXZlID0gMzMzOwogICAgdC5JbWFjcm9uID0gMzMzOwogICAgdC5MY2Fyb24gPSA2MTE7CiAgICB0Lm9uZWhhbGYgPSA3NTA7CiAgICB0Lmxlc3NlcXVhbCA9IDU0OTsKICAgIHQub2NpcmN1bWZsZXggPSA1MDA7CiAgICB0Lm50aWxkZSA9IDUwMDsKICAgIHQuVWh1bmdhcnVtbGF1dCA9IDcyMjsKICAgIHQuRWFjdXRlID0gNjExOwogICAgdC5lbWFjcm9uID0gNDQ0OwogICAgdC5nYnJldmUgPSA1MDA7CiAgICB0Lm9uZXF1YXJ0ZXIgPSA3NTA7CiAgICB0LlNjYXJvbiA9IDUwMDsKICAgIHQuU2NvbW1hYWNjZW50ID0gNTAwOwogICAgdC5PaHVuZ2FydW1sYXV0ID0gNzIyOwogICAgdC5kZWdyZWUgPSA0MDA7CiAgICB0Lm9ncmF2ZSA9IDUwMDsKICAgIHQuQ2Nhcm9uID0gNjY3OwogICAgdC51Z3JhdmUgPSA1MDA7CiAgICB0LnJhZGljYWwgPSA0NTM7CiAgICB0LkRjYXJvbiA9IDcyMjsKICAgIHQucmNvbW1hYWNjZW50ID0gMzg5OwogICAgdC5OdGlsZGUgPSA2Njc7CiAgICB0Lm90aWxkZSA9IDUwMDsKICAgIHQuUmNvbW1hYWNjZW50ID0gNjExOwogICAgdC5MY29tbWFhY2NlbnQgPSA1NTY7CiAgICB0LkF0aWxkZSA9IDYxMTsKICAgIHQuQW9nb25layA9IDYxMTsKICAgIHQuQXJpbmcgPSA2MTE7CiAgICB0Lk90aWxkZSA9IDcyMjsKICAgIHQuemRvdGFjY2VudCA9IDM4OTsKICAgIHQuRWNhcm9uID0gNjExOwogICAgdC5Jb2dvbmVrID0gMzMzOwogICAgdC5rY29tbWFhY2NlbnQgPSA0NDQ7CiAgICB0Lm1pbnVzID0gNjc1OwogICAgdC5JY2lyY3VtZmxleCA9IDMzMzsKICAgIHQubmNhcm9uID0gNTAwOwogICAgdC50Y29tbWFhY2NlbnQgPSAyNzg7CiAgICB0LmxvZ2ljYWxub3QgPSA2NzU7CiAgICB0Lm9kaWVyZXNpcyA9IDUwMDsKICAgIHQudWRpZXJlc2lzID0gNTAwOwogICAgdC5ub3RlcXVhbCA9IDU0OTsKICAgIHQuZ2NvbW1hYWNjZW50ID0gNTAwOwogICAgdC5ldGggPSA1MDA7CiAgICB0LnpjYXJvbiA9IDM4OTsKICAgIHQubmNvbW1hYWNjZW50ID0gNTAwOwogICAgdC5vbmVzdXBlcmlvciA9IDMwMDsKICAgIHQuaW1hY3JvbiA9IDI3ODsKICAgIHQuRXVybyA9IDUwMDsKICB9KTsKICB0LlphcGZEaW5nYmF0cyA9ICgwLCBfY29yZV91dGlscy5nZXRMb29rdXBUYWJsZUZhY3RvcnkpKGZ1bmN0aW9uICh0KSB7CiAgICB0LnNwYWNlID0gMjc4OwogICAgdC5hMSA9IDk3NDsKICAgIHQuYTIgPSA5NjE7CiAgICB0LmEyMDIgPSA5NzQ7CiAgICB0LmEzID0gOTgwOwogICAgdC5hNCA9IDcxOTsKICAgIHQuYTUgPSA3ODk7CiAgICB0LmExMTkgPSA3OTA7CiAgICB0LmExMTggPSA3OTE7CiAgICB0LmExMTcgPSA2OTA7CiAgICB0LmExMSA9IDk2MDsKICAgIHQuYTEyID0gOTM5OwogICAgdC5hMTMgPSA1NDk7CiAgICB0LmExNCA9IDg1NTsKICAgIHQuYTE1ID0gOTExOwogICAgdC5hMTYgPSA5MzM7CiAgICB0LmExMDUgPSA5MTE7CiAgICB0LmExNyA9IDk0NTsKICAgIHQuYTE4ID0gOTc0OwogICAgdC5hMTkgPSA3NTU7CiAgICB0LmEyMCA9IDg0NjsKICAgIHQuYTIxID0gNzYyOwogICAgdC5hMjIgPSA3NjE7CiAgICB0LmEyMyA9IDU3MTsKICAgIHQuYTI0ID0gNjc3OwogICAgdC5hMjUgPSA3NjM7CiAgICB0LmEyNiA9IDc2MDsKICAgIHQuYTI3ID0gNzU5OwogICAgdC5hMjggPSA3NTQ7CiAgICB0LmE2ID0gNDk0OwogICAgdC5hNyA9IDU1MjsKICAgIHQuYTggPSA1Mzc7CiAgICB0LmE5ID0gNTc3OwogICAgdC5hMTAgPSA2OTI7CiAgICB0LmEyOSA9IDc4NjsKICAgIHQuYTMwID0gNzg4OwogICAgdC5hMzEgPSA3ODg7CiAgICB0LmEzMiA9IDc5MDsKICAgIHQuYTMzID0gNzkzOwogICAgdC5hMzQgPSA3OTQ7CiAgICB0LmEzNSA9IDgxNjsKICAgIHQuYTM2ID0gODIzOwogICAgdC5hMzcgPSA3ODk7CiAgICB0LmEzOCA9IDg0MTsKICAgIHQuYTM5ID0gODIzOwogICAgdC5hNDAgPSA4MzM7CiAgICB0LmE0MSA9IDgxNjsKICAgIHQuYTQyID0gODMxOwogICAgdC5hNDMgPSA5MjM7CiAgICB0LmE0NCA9IDc0NDsKICAgIHQuYTQ1ID0gNzIzOwogICAgdC5hNDYgPSA3NDk7CiAgICB0LmE0NyA9IDc5MDsKICAgIHQuYTQ4ID0gNzkyOwogICAgdC5hNDkgPSA2OTU7CiAgICB0LmE1MCA9IDc3NjsKICAgIHQuYTUxID0gNzY4OwogICAgdC5hNTIgPSA3OTI7CiAgICB0LmE1MyA9IDc1OTsKICAgIHQuYTU0ID0gNzA3OwogICAgdC5hNTUgPSA3MDg7CiAgICB0LmE1NiA9IDY4MjsKICAgIHQuYTU3ID0gNzAxOwogICAgdC5hNTggPSA4MjY7CiAgICB0LmE1OSA9IDgxNTsKICAgIHQuYTYwID0gNzg5OwogICAgdC5hNjEgPSA3ODk7CiAgICB0LmE2MiA9IDcwNzsKICAgIHQuYTYzID0gNjg3OwogICAgdC5hNjQgPSA2OTY7CiAgICB0LmE2NSA9IDY4OTsKICAgIHQuYTY2ID0gNzg2OwogICAgdC5hNjcgPSA3ODc7CiAgICB0LmE2OCA9IDcxMzsKICAgIHQuYTY5ID0gNzkxOwogICAgdC5hNzAgPSA3ODU7CiAgICB0LmE3MSA9IDc5MTsKICAgIHQuYTcyID0gODczOwogICAgdC5hNzMgPSA3NjE7CiAgICB0LmE3NCA9IDc2MjsKICAgIHQuYTIwMyA9IDc2MjsKICAgIHQuYTc1ID0gNzU5OwogICAgdC5hMjA0ID0gNzU5OwogICAgdC5hNzYgPSA4OTI7CiAgICB0LmE3NyA9IDg5MjsKICAgIHQuYTc4ID0gNzg4OwogICAgdC5hNzkgPSA3ODQ7CiAgICB0LmE4MSA9IDQzODsKICAgIHQuYTgyID0gMTM4OwogICAgdC5hODMgPSAyNzc7CiAgICB0LmE4NCA9IDQxNTsKICAgIHQuYTk3ID0gMzkyOwogICAgdC5hOTggPSAzOTI7CiAgICB0LmE5OSA9IDY2ODsKICAgIHQuYTEwMCA9IDY2ODsKICAgIHQuYTg5ID0gMzkwOwogICAgdC5hOTAgPSAzOTA7CiAgICB0LmE5MyA9IDMxNzsKICAgIHQuYTk0ID0gMzE3OwogICAgdC5hOTEgPSAyNzY7CiAgICB0LmE5MiA9IDI3NjsKICAgIHQuYTIwNSA9IDUwOTsKICAgIHQuYTg1ID0gNTA5OwogICAgdC5hMjA2ID0gNDEwOwogICAgdC5hODYgPSA0MTA7CiAgICB0LmE4NyA9IDIzNDsKICAgIHQuYTg4ID0gMjM0OwogICAgdC5hOTUgPSAzMzQ7CiAgICB0LmE5NiA9IDMzNDsKICAgIHQuYTEwMSA9IDczMjsKICAgIHQuYTEwMiA9IDU0NDsKICAgIHQuYTEwMyA9IDU0NDsKICAgIHQuYTEwNCA9IDkxMDsKICAgIHQuYTEwNiA9IDY2NzsKICAgIHQuYTEwNyA9IDc2MDsKICAgIHQuYTEwOCA9IDc2MDsKICAgIHQuYTExMiA9IDc3NjsKICAgIHQuYTExMSA9IDU5NTsKICAgIHQuYTExMCA9IDY5NDsKICAgIHQuYTEwOSA9IDYyNjsKICAgIHQuYTEyMCA9IDc4ODsKICAgIHQuYTEyMSA9IDc4ODsKICAgIHQuYTEyMiA9IDc4ODsKICAgIHQuYTEyMyA9IDc4ODsKICAgIHQuYTEyNCA9IDc4ODsKICAgIHQuYTEyNSA9IDc4ODsKICAgIHQuYTEyNiA9IDc4ODsKICAgIHQuYTEyNyA9IDc4ODsKICAgIHQuYTEyOCA9IDc4ODsKICAgIHQuYTEyOSA9IDc4ODsKICAgIHQuYTEzMCA9IDc4ODsKICAgIHQuYTEzMSA9IDc4ODsKICAgIHQuYTEzMiA9IDc4ODsKICAgIHQuYTEzMyA9IDc4ODsKICAgIHQuYTEzNCA9IDc4ODsKICAgIHQuYTEzNSA9IDc4ODsKICAgIHQuYTEzNiA9IDc4ODsKICAgIHQuYTEzNyA9IDc4ODsKICAgIHQuYTEzOCA9IDc4ODsKICAgIHQuYTEzOSA9IDc4ODsKICAgIHQuYTE0MCA9IDc4ODsKICAgIHQuYTE0MSA9IDc4ODsKICAgIHQuYTE0MiA9IDc4ODsKICAgIHQuYTE0MyA9IDc4ODsKICAgIHQuYTE0NCA9IDc4ODsKICAgIHQuYTE0NSA9IDc4ODsKICAgIHQuYTE0NiA9IDc4ODsKICAgIHQuYTE0NyA9IDc4ODsKICAgIHQuYTE0OCA9IDc4ODsKICAgIHQuYTE0OSA9IDc4ODsKICAgIHQuYTE1MCA9IDc4ODsKICAgIHQuYTE1MSA9IDc4ODsKICAgIHQuYTE1MiA9IDc4ODsKICAgIHQuYTE1MyA9IDc4ODsKICAgIHQuYTE1NCA9IDc4ODsKICAgIHQuYTE1NSA9IDc4ODsKICAgIHQuYTE1NiA9IDc4ODsKICAgIHQuYTE1NyA9IDc4ODsKICAgIHQuYTE1OCA9IDc4ODsKICAgIHQuYTE1OSA9IDc4ODsKICAgIHQuYTE2MCA9IDg5NDsKICAgIHQuYTE2MSA9IDgzODsKICAgIHQuYTE2MyA9IDEwMTY7CiAgICB0LmExNjQgPSA0NTg7CiAgICB0LmExOTYgPSA3NDg7CiAgICB0LmExNjUgPSA5MjQ7CiAgICB0LmExOTIgPSA3NDg7CiAgICB0LmExNjYgPSA5MTg7CiAgICB0LmExNjcgPSA5Mjc7CiAgICB0LmExNjggPSA5Mjg7CiAgICB0LmExNjkgPSA5Mjg7CiAgICB0LmExNzAgPSA4MzQ7CiAgICB0LmExNzEgPSA4NzM7CiAgICB0LmExNzIgPSA4Mjg7CiAgICB0LmExNzMgPSA5MjQ7CiAgICB0LmExNjIgPSA5MjQ7CiAgICB0LmExNzQgPSA5MTc7CiAgICB0LmExNzUgPSA5MzA7CiAgICB0LmExNzYgPSA5MzE7CiAgICB0LmExNzcgPSA0NjM7CiAgICB0LmExNzggPSA4ODM7CiAgICB0LmExNzkgPSA4MzY7CiAgICB0LmExOTMgPSA4MzY7CiAgICB0LmExODAgPSA4Njc7CiAgICB0LmExOTkgPSA4Njc7CiAgICB0LmExODEgPSA2OTY7CiAgICB0LmEyMDAgPSA2OTY7CiAgICB0LmExODIgPSA4NzQ7CiAgICB0LmEyMDEgPSA4NzQ7CiAgICB0LmExODMgPSA3NjA7CiAgICB0LmExODQgPSA5NDY7CiAgICB0LmExOTcgPSA3NzE7CiAgICB0LmExODUgPSA4NjU7CiAgICB0LmExOTQgPSA3NzE7CiAgICB0LmExOTggPSA4ODg7CiAgICB0LmExODYgPSA5Njc7CiAgICB0LmExOTUgPSA4ODg7CiAgICB0LmExODcgPSA4MzE7CiAgICB0LmExODggPSA4NzM7CiAgICB0LmExODkgPSA5Mjc7CiAgICB0LmExOTAgPSA5NzA7CiAgICB0LmExOTEgPSA5MTg7CiAgfSk7Cn0pOwpleHBvcnRzLmdldE1ldHJpY3MgPSBnZXRNZXRyaWNzOwpjb25zdCBnZXRGb250QmFzaWNNZXRyaWNzID0gKDAsIF9jb3JlX3V0aWxzLmdldExvb2t1cFRhYmxlRmFjdG9yeSkoZnVuY3Rpb24gKHQpIHsKICB0LkNvdXJpZXIgPSB7CiAgICBhc2NlbnQ6IDYyOSwKICAgIGRlc2NlbnQ6IC0xNTcsCiAgICBjYXBIZWlnaHQ6IDU2MiwKICAgIHhIZWlnaHQ6IC00MjYKICB9OwogIHRbIkNvdXJpZXItQm9sZCJdID0gewogICAgYXNjZW50OiA2MjksCiAgICBkZXNjZW50OiAtMTU3LAogICAgY2FwSGVpZ2h0OiA1NjIsCiAgICB4SGVpZ2h0OiA0MzkKICB9OwogIHRbIkNvdXJpZXItT2JsaXF1ZSJdID0gewogICAgYXNjZW50OiA2MjksCiAgICBkZXNjZW50OiAtMTU3LAogICAgY2FwSGVpZ2h0OiA1NjIsCiAgICB4SGVpZ2h0OiA0MjYKICB9OwogIHRbIkNvdXJpZXItQm9sZE9ibGlxdWUiXSA9IHsKICAgIGFzY2VudDogNjI5LAogICAgZGVzY2VudDogLTE1NywKICAgIGNhcEhlaWdodDogNTYyLAogICAgeEhlaWdodDogNDI2CiAgfTsKICB0LkhlbHZldGljYSA9IHsKICAgIGFzY2VudDogNzE4LAogICAgZGVzY2VudDogLTIwNywKICAgIGNhcEhlaWdodDogNzE4LAogICAgeEhlaWdodDogNTIzCiAgfTsKICB0WyJIZWx2ZXRpY2EtQm9sZCJdID0gewogICAgYXNjZW50OiA3MTgsCiAgICBkZXNjZW50OiAtMjA3LAogICAgY2FwSGVpZ2h0OiA3MTgsCiAgICB4SGVpZ2h0OiA1MzIKICB9OwogIHRbIkhlbHZldGljYS1PYmxpcXVlIl0gPSB7CiAgICBhc2NlbnQ6IDcxOCwKICAgIGRlc2NlbnQ6IC0yMDcsCiAgICBjYXBIZWlnaHQ6IDcxOCwKICAgIHhIZWlnaHQ6IDUyMwogIH07CiAgdFsiSGVsdmV0aWNhLUJvbGRPYmxpcXVlIl0gPSB7CiAgICBhc2NlbnQ6IDcxOCwKICAgIGRlc2NlbnQ6IC0yMDcsCiAgICBjYXBIZWlnaHQ6IDcxOCwKICAgIHhIZWlnaHQ6IDUzMgogIH07CiAgdFsiVGltZXMtUm9tYW4iXSA9IHsKICAgIGFzY2VudDogNjgzLAogICAgZGVzY2VudDogLTIxNywKICAgIGNhcEhlaWdodDogNjYyLAogICAgeEhlaWdodDogNDUwCiAgfTsKICB0WyJUaW1lcy1Cb2xkIl0gPSB7CiAgICBhc2NlbnQ6IDY4MywKICAgIGRlc2NlbnQ6IC0yMTcsCiAgICBjYXBIZWlnaHQ6IDY3NiwKICAgIHhIZWlnaHQ6IDQ2MQogIH07CiAgdFsiVGltZXMtSXRhbGljIl0gPSB7CiAgICBhc2NlbnQ6IDY4MywKICAgIGRlc2NlbnQ6IC0yMTcsCiAgICBjYXBIZWlnaHQ6IDY1MywKICAgIHhIZWlnaHQ6IDQ0MQogIH07CiAgdFsiVGltZXMtQm9sZEl0YWxpYyJdID0gewogICAgYXNjZW50OiA2ODMsCiAgICBkZXNjZW50OiAtMjE3LAogICAgY2FwSGVpZ2h0OiA2NjksCiAgICB4SGVpZ2h0OiA0NjIKICB9OwogIHQuU3ltYm9sID0gewogICAgYXNjZW50OiBNYXRoLk5hTiwKICAgIGRlc2NlbnQ6IE1hdGguTmFOLAogICAgY2FwSGVpZ2h0OiBNYXRoLk5hTiwKICAgIHhIZWlnaHQ6IE1hdGguTmFOCiAgfTsKICB0LlphcGZEaW5nYmF0cyA9IHsKICAgIGFzY2VudDogTWF0aC5OYU4sCiAgICBkZXNjZW50OiBNYXRoLk5hTiwKICAgIGNhcEhlaWdodDogTWF0aC5OYU4sCiAgICB4SGVpZ2h0OiBNYXRoLk5hTgogIH07Cn0pOwpleHBvcnRzLmdldEZvbnRCYXNpY01ldHJpY3MgPSBnZXRGb250QmFzaWNNZXRyaWNzOwoKLyoqKi8gfSksCi8qIDQ2ICovCi8qKiovICgoX191bnVzZWRfd2VicGFja19tb2R1bGUsIGV4cG9ydHMpID0+IHsKCgoKT2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsICJfX2VzTW9kdWxlIiwgKHsKICB2YWx1ZTogdHJ1ZQp9KSk7CmV4cG9ydHMuR2x5ZlRhYmxlID0gdm9pZCAwOwpjb25zdCBPTl9DVVJWRV9QT0lOVCA9IDEgPDwgMDsKY29uc3QgWF9TSE9SVF9WRUNUT1IgPSAxIDw8IDE7CmNvbnN0IFlfU0hPUlRfVkVDVE9SID0gMSA8PCAyOwpjb25zdCBSRVBFQVRfRkxBRyA9IDEgPDwgMzsKY29uc3QgWF9JU19TQU1FX09SX1BPU0lUSVZFX1hfU0hPUlRfVkVDVE9SID0gMSA8PCA0Owpjb25zdCBZX0lTX1NBTUVfT1JfUE9TSVRJVkVfWV9TSE9SVF9WRUNUT1IgPSAxIDw8IDU7CmNvbnN0IE9WRVJMQVBfU0lNUExFID0gMSA8PCA2Owpjb25zdCBBUkdfMV9BTkRfMl9BUkVfV09SRFMgPSAxIDw8IDA7CmNvbnN0IEFSR1NfQVJFX1hZX1ZBTFVFUyA9IDEgPDwgMTsKY29uc3QgV0VfSEFWRV9BX1NDQUxFID0gMSA8PCAzOwpjb25zdCBNT1JFX0NPTVBPTkVOVFMgPSAxIDw8IDU7CmNvbnN0IFdFX0hBVkVfQU5fWF9BTkRfWV9TQ0FMRSA9IDEgPDwgNjsKY29uc3QgV0VfSEFWRV9BX1RXT19CWV9UV08gPSAxIDw8IDc7CmNvbnN0IFdFX0hBVkVfSU5TVFJVQ1RJT05TID0gMSA8PCA4OwpjbGFzcyBHbHlmVGFibGUgewogIGNvbnN0cnVjdG9yKHsKICAgIGdseWZUYWJsZSwKICAgIGlzR2x5cGhMb2NhdGlvbnNMb25nLAogICAgbG9jYVRhYmxlLAogICAgbnVtR2x5cGhzCiAgfSkgewogICAgdGhpcy5nbHlwaHMgPSBbXTsKICAgIGNvbnN0IGxvY2EgPSBuZXcgRGF0YVZpZXcobG9jYVRhYmxlLmJ1ZmZlciwgbG9jYVRhYmxlLmJ5dGVPZmZzZXQsIGxvY2FUYWJsZS5ieXRlTGVuZ3RoKTsKICAgIGNvbnN0IGdseWYgPSBuZXcgRGF0YVZpZXcoZ2x5ZlRhYmxlLmJ1ZmZlciwgZ2x5ZlRhYmxlLmJ5dGVPZmZzZXQsIGdseWZUYWJsZS5ieXRlTGVuZ3RoKTsKICAgIGNvbnN0IG9mZnNldFNpemUgPSBpc0dseXBoTG9jYXRpb25zTG9uZyA/IDQgOiAyOwogICAgbGV0IHByZXYgPSBpc0dseXBoTG9jYXRpb25zTG9uZyA/IGxvY2EuZ2V0VWludDMyKDApIDogMiAqIGxvY2EuZ2V0VWludDE2KDApOwogICAgbGV0IHBvcyA9IDA7CiAgICBmb3IgKGxldCBpID0gMDsgaSA8IG51bUdseXBoczsgaSsrKSB7CiAgICAgIHBvcyArPSBvZmZzZXRTaXplOwogICAgICBjb25zdCBuZXh0ID0gaXNHbHlwaExvY2F0aW9uc0xvbmcgPyBsb2NhLmdldFVpbnQzMihwb3MpIDogMiAqIGxvY2EuZ2V0VWludDE2KHBvcyk7CiAgICAgIGlmIChuZXh0ID09PSBwcmV2KSB7CiAgICAgICAgdGhpcy5nbHlwaHMucHVzaChuZXcgR2x5cGgoe30pKTsKICAgICAgICBjb250aW51ZTsKICAgICAgfQogICAgICBjb25zdCBnbHlwaCA9IEdseXBoLnBhcnNlKHByZXYsIGdseWYpOwogICAgICB0aGlzLmdseXBocy5wdXNoKGdseXBoKTsKICAgICAgcHJldiA9IG5leHQ7CiAgICB9CiAgfQogIGdldFNpemUoKSB7CiAgICByZXR1cm4gdGhpcy5nbHlwaHMucmVkdWNlKChhLCBnKSA9PiB7CiAgICAgIGNvbnN0IHNpemUgPSBnLmdldFNpemUoKTsKICAgICAgcmV0dXJuIGEgKyAoc2l6ZSArIDMgJiB+Myk7CiAgICB9LCAwKTsKICB9CiAgd3JpdGUoKSB7CiAgICBjb25zdCB0b3RhbFNpemUgPSB0aGlzLmdldFNpemUoKTsKICAgIGNvbnN0IGdseWZUYWJsZSA9IG5ldyBEYXRhVmlldyhuZXcgQXJyYXlCdWZmZXIodG90YWxTaXplKSk7CiAgICBjb25zdCBpc0xvY2F0aW9uTG9uZyA9IHRvdGFsU2l6ZSA+IDB4MWZmZmU7CiAgICBjb25zdCBvZmZzZXRTaXplID0gaXNMb2NhdGlvbkxvbmcgPyA0IDogMjsKICAgIGNvbnN0IGxvY2FUYWJsZSA9IG5ldyBEYXRhVmlldyhuZXcgQXJyYXlCdWZmZXIoKHRoaXMuZ2x5cGhzLmxlbmd0aCArIDEpICogb2Zmc2V0U2l6ZSkpOwogICAgaWYgKGlzTG9jYXRpb25Mb25nKSB7CiAgICAgIGxvY2FUYWJsZS5zZXRVaW50MzIoMCwgMCk7CiAgICB9IGVsc2UgewogICAgICBsb2NhVGFibGUuc2V0VWludDE2KDAsIDApOwogICAgfQogICAgbGV0IHBvcyA9IDA7CiAgICBsZXQgbG9jYUluZGV4ID0gMDsKICAgIGZvciAoY29uc3QgZ2x5cGggb2YgdGhpcy5nbHlwaHMpIHsKICAgICAgcG9zICs9IGdseXBoLndyaXRlKHBvcywgZ2x5ZlRhYmxlKTsKICAgICAgcG9zID0gcG9zICsgMyAmIH4zOwogICAgICBsb2NhSW5kZXggKz0gb2Zmc2V0U2l6ZTsKICAgICAgaWYgKGlzTG9jYXRpb25Mb25nKSB7CiAgICAgICAgbG9jYVRhYmxlLnNldFVpbnQzMihsb2NhSW5kZXgsIHBvcyk7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgbG9jYVRhYmxlLnNldFVpbnQxNihsb2NhSW5kZXgsIHBvcyA+PiAxKTsKICAgICAgfQogICAgfQogICAgcmV0dXJuIHsKICAgICAgaXNMb2NhdGlvbkxvbmcsCiAgICAgIGxvY2E6IG5ldyBVaW50OEFycmF5KGxvY2FUYWJsZS5idWZmZXIpLAogICAgICBnbHlmOiBuZXcgVWludDhBcnJheShnbHlmVGFibGUuYnVmZmVyKQogICAgfTsKICB9CiAgc2NhbGUoZmFjdG9ycykgewogICAgZm9yIChsZXQgaSA9IDAsIGlpID0gdGhpcy5nbHlwaHMubGVuZ3RoOyBpIDwgaWk7IGkrKykgewogICAgICB0aGlzLmdseXBoc1tpXS5zY2FsZShmYWN0b3JzW2ldKTsKICAgIH0KICB9Cn0KZXhwb3J0cy5HbHlmVGFibGUgPSBHbHlmVGFibGU7CmNsYXNzIEdseXBoIHsKICBjb25zdHJ1Y3Rvcih7CiAgICBoZWFkZXIgPSBudWxsLAogICAgc2ltcGxlID0gbnVsbCwKICAgIGNvbXBvc2l0ZXMgPSBudWxsCiAgfSkgewogICAgdGhpcy5oZWFkZXIgPSBoZWFkZXI7CiAgICB0aGlzLnNpbXBsZSA9IHNpbXBsZTsKICAgIHRoaXMuY29tcG9zaXRlcyA9IGNvbXBvc2l0ZXM7CiAgfQogIHN0YXRpYyBwYXJzZShwb3MsIGdseWYpIHsKICAgIGNvbnN0IFtyZWFkLCBoZWFkZXJdID0gR2x5cGhIZWFkZXIucGFyc2UocG9zLCBnbHlmKTsKICAgIHBvcyArPSByZWFkOwogICAgaWYgKGhlYWRlci5udW1iZXJPZkNvbnRvdXJzIDwgMCkgewogICAgICBjb25zdCBjb21wb3NpdGVzID0gW107CiAgICAgIHdoaWxlICh0cnVlKSB7CiAgICAgICAgY29uc3QgW24sIGNvbXBvc2l0ZV0gPSBDb21wb3NpdGVHbHlwaC5wYXJzZShwb3MsIGdseWYpOwogICAgICAgIHBvcyArPSBuOwogICAgICAgIGNvbXBvc2l0ZXMucHVzaChjb21wb3NpdGUpOwogICAgICAgIGlmICghKGNvbXBvc2l0ZS5mbGFncyAmIE1PUkVfQ09NUE9ORU5UUykpIHsKICAgICAgICAgIGJyZWFrOwogICAgICAgIH0KICAgICAgfQogICAgICByZXR1cm4gbmV3IEdseXBoKHsKICAgICAgICBoZWFkZXIsCiAgICAgICAgY29tcG9zaXRlcwogICAgICB9KTsKICAgIH0KICAgIGNvbnN0IHNpbXBsZSA9IFNpbXBsZUdseXBoLnBhcnNlKHBvcywgZ2x5ZiwgaGVhZGVyLm51bWJlck9mQ29udG91cnMpOwogICAgcmV0dXJuIG5ldyBHbHlwaCh7CiAgICAgIGhlYWRlciwKICAgICAgc2ltcGxlCiAgICB9KTsKICB9CiAgZ2V0U2l6ZSgpIHsKICAgIGlmICghdGhpcy5oZWFkZXIpIHsKICAgICAgcmV0dXJuIDA7CiAgICB9CiAgICBjb25zdCBzaXplID0gdGhpcy5zaW1wbGUgPyB0aGlzLnNpbXBsZS5nZXRTaXplKCkgOiB0aGlzLmNvbXBvc2l0ZXMucmVkdWNlKChhLCBjKSA9PiBhICsgYy5nZXRTaXplKCksIDApOwogICAgcmV0dXJuIHRoaXMuaGVhZGVyLmdldFNpemUoKSArIHNpemU7CiAgfQogIHdyaXRlKHBvcywgYnVmKSB7CiAgICBpZiAoIXRoaXMuaGVhZGVyKSB7CiAgICAgIHJldHVybiAwOwogICAgfQogICAgY29uc3Qgc3BvcyA9IHBvczsKICAgIHBvcyArPSB0aGlzLmhlYWRlci53cml0ZShwb3MsIGJ1Zik7CiAgICBpZiAodGhpcy5zaW1wbGUpIHsKICAgICAgcG9zICs9IHRoaXMuc2ltcGxlLndyaXRlKHBvcywgYnVmKTsKICAgIH0gZWxzZSB7CiAgICAgIGZvciAoY29uc3QgY29tcG9zaXRlIG9mIHRoaXMuY29tcG9zaXRlcykgewogICAgICAgIHBvcyArPSBjb21wb3NpdGUud3JpdGUocG9zLCBidWYpOwogICAgICB9CiAgICB9CiAgICByZXR1cm4gcG9zIC0gc3BvczsKICB9CiAgc2NhbGUoZmFjdG9yKSB7CiAgICBpZiAoIXRoaXMuaGVhZGVyKSB7CiAgICAgIHJldHVybjsKICAgIH0KICAgIGNvbnN0IHhNaWRkbGUgPSAodGhpcy5oZWFkZXIueE1pbiArIHRoaXMuaGVhZGVyLnhNYXgpIC8gMjsKICAgIHRoaXMuaGVhZGVyLnNjYWxlKHhNaWRkbGUsIGZhY3Rvcik7CiAgICBpZiAodGhpcy5zaW1wbGUpIHsKICAgICAgdGhpcy5zaW1wbGUuc2NhbGUoeE1pZGRsZSwgZmFjdG9yKTsKICAgIH0gZWxzZSB7CiAgICAgIGZvciAoY29uc3QgY29tcG9zaXRlIG9mIHRoaXMuY29tcG9zaXRlcykgewogICAgICAgIGNvbXBvc2l0ZS5zY2FsZSh4TWlkZGxlLCBmYWN0b3IpOwogICAgICB9CiAgICB9CiAgfQp9CmNsYXNzIEdseXBoSGVhZGVyIHsKICBjb25zdHJ1Y3Rvcih7CiAgICBudW1iZXJPZkNvbnRvdXJzLAogICAgeE1pbiwKICAgIHlNaW4sCiAgICB4TWF4LAogICAgeU1heAogIH0pIHsKICAgIHRoaXMubnVtYmVyT2ZDb250b3VycyA9IG51bWJlck9mQ29udG91cnM7CiAgICB0aGlzLnhNaW4gPSB4TWluOwogICAgdGhpcy55TWluID0geU1pbjsKICAgIHRoaXMueE1heCA9IHhNYXg7CiAgICB0aGlzLnlNYXggPSB5TWF4OwogIH0KICBzdGF0aWMgcGFyc2UocG9zLCBnbHlmKSB7CiAgICByZXR1cm4gWzEwLCBuZXcgR2x5cGhIZWFkZXIoewogICAgICBudW1iZXJPZkNvbnRvdXJzOiBnbHlmLmdldEludDE2KHBvcyksCiAgICAgIHhNaW46IGdseWYuZ2V0SW50MTYocG9zICsgMiksCiAgICAgIHlNaW46IGdseWYuZ2V0SW50MTYocG9zICsgNCksCiAgICAgIHhNYXg6IGdseWYuZ2V0SW50MTYocG9zICsgNiksCiAgICAgIHlNYXg6IGdseWYuZ2V0SW50MTYocG9zICsgOCkKICAgIH0pXTsKICB9CiAgZ2V0U2l6ZSgpIHsKICAgIHJldHVybiAxMDsKICB9CiAgd3JpdGUocG9zLCBidWYpIHsKICAgIGJ1Zi5zZXRJbnQxNihwb3MsIHRoaXMubnVtYmVyT2ZDb250b3Vycyk7CiAgICBidWYuc2V0SW50MTYocG9zICsgMiwgdGhpcy54TWluKTsKICAgIGJ1Zi5zZXRJbnQxNihwb3MgKyA0LCB0aGlzLnlNaW4pOwogICAgYnVmLnNldEludDE2KHBvcyArIDYsIHRoaXMueE1heCk7CiAgICBidWYuc2V0SW50MTYocG9zICsgOCwgdGhpcy55TWF4KTsKICAgIHJldHVybiAxMDsKICB9CiAgc2NhbGUoeCwgZmFjdG9yKSB7CiAgICB0aGlzLnhNaW4gPSBNYXRoLnJvdW5kKHggKyAodGhpcy54TWluIC0geCkgKiBmYWN0b3IpOwogICAgdGhpcy54TWF4ID0gTWF0aC5yb3VuZCh4ICsgKHRoaXMueE1heCAtIHgpICogZmFjdG9yKTsKICB9Cn0KY2xhc3MgQ29udG91ciB7CiAgY29uc3RydWN0b3IoewogICAgZmxhZ3MsCiAgICB4Q29vcmRpbmF0ZXMsCiAgICB5Q29vcmRpbmF0ZXMKICB9KSB7CiAgICB0aGlzLnhDb29yZGluYXRlcyA9IHhDb29yZGluYXRlczsKICAgIHRoaXMueUNvb3JkaW5hdGVzID0geUNvb3JkaW5hdGVzOwogICAgdGhpcy5mbGFncyA9IGZsYWdzOwogIH0KfQpjbGFzcyBTaW1wbGVHbHlwaCB7CiAgY29uc3RydWN0b3IoewogICAgY29udG91cnMsCiAgICBpbnN0cnVjdGlvbnMKICB9KSB7CiAgICB0aGlzLmNvbnRvdXJzID0gY29udG91cnM7CiAgICB0aGlzLmluc3RydWN0aW9ucyA9IGluc3RydWN0aW9uczsKICB9CiAgc3RhdGljIHBhcnNlKHBvcywgZ2x5ZiwgbnVtYmVyT2ZDb250b3VycykgewogICAgY29uc3QgZW5kUHRzT2ZDb250b3VycyA9IFtdOwogICAgZm9yIChsZXQgaSA9IDA7IGkgPCBudW1iZXJPZkNvbnRvdXJzOyBpKyspIHsKICAgICAgY29uc3QgZW5kUHQgPSBnbHlmLmdldFVpbnQxNihwb3MpOwogICAgICBwb3MgKz0gMjsKICAgICAgZW5kUHRzT2ZDb250b3Vycy5wdXNoKGVuZFB0KTsKICAgIH0KICAgIGNvbnN0IG51bWJlck9mUHQgPSBlbmRQdHNPZkNvbnRvdXJzW251bWJlck9mQ29udG91cnMgLSAxXSArIDE7CiAgICBjb25zdCBpbnN0cnVjdGlvbkxlbmd0aCA9IGdseWYuZ2V0VWludDE2KHBvcyk7CiAgICBwb3MgKz0gMjsKICAgIGNvbnN0IGluc3RydWN0aW9ucyA9IG5ldyBVaW50OEFycmF5KGdseWYpLnNsaWNlKHBvcywgcG9zICsgaW5zdHJ1Y3Rpb25MZW5ndGgpOwogICAgcG9zICs9IGluc3RydWN0aW9uTGVuZ3RoOwogICAgY29uc3QgZmxhZ3MgPSBbXTsKICAgIGZvciAobGV0IGkgPSAwOyBpIDwgbnVtYmVyT2ZQdDsgcG9zKyssIGkrKykgewogICAgICBsZXQgZmxhZyA9IGdseWYuZ2V0VWludDgocG9zKTsKICAgICAgZmxhZ3MucHVzaChmbGFnKTsKICAgICAgaWYgKGZsYWcgJiBSRVBFQVRfRkxBRykgewogICAgICAgIGNvbnN0IGNvdW50ID0gZ2x5Zi5nZXRVaW50OCgrK3Bvcyk7CiAgICAgICAgZmxhZyBePSBSRVBFQVRfRkxBRzsKICAgICAgICBmb3IgKGxldCBtID0gMDsgbSA8IGNvdW50OyBtKyspIHsKICAgICAgICAgIGZsYWdzLnB1c2goZmxhZyk7CiAgICAgICAgfQogICAgICAgIGkgKz0gY291bnQ7CiAgICAgIH0KICAgIH0KICAgIGNvbnN0IGFsbFhDb29yZGluYXRlcyA9IFtdOwogICAgbGV0IHhDb29yZGluYXRlcyA9IFtdOwogICAgbGV0IHlDb29yZGluYXRlcyA9IFtdOwogICAgbGV0IHBvaW50RmxhZ3MgPSBbXTsKICAgIGNvbnN0IGNvbnRvdXJzID0gW107CiAgICBsZXQgZW5kUHRzT2ZDb250b3Vyc0luZGV4ID0gMDsKICAgIGxldCBsYXN0Q29vcmRpbmF0ZSA9IDA7CiAgICBmb3IgKGxldCBpID0gMDsgaSA8IG51bWJlck9mUHQ7IGkrKykgewogICAgICBjb25zdCBmbGFnID0gZmxhZ3NbaV07CiAgICAgIGlmIChmbGFnICYgWF9TSE9SVF9WRUNUT1IpIHsKICAgICAgICBjb25zdCB4ID0gZ2x5Zi5nZXRVaW50OChwb3MrKyk7CiAgICAgICAgbGFzdENvb3JkaW5hdGUgKz0gZmxhZyAmIFhfSVNfU0FNRV9PUl9QT1NJVElWRV9YX1NIT1JUX1ZFQ1RPUiA/IHggOiAteDsKICAgICAgICB4Q29vcmRpbmF0ZXMucHVzaChsYXN0Q29vcmRpbmF0ZSk7CiAgICAgIH0gZWxzZSBpZiAoZmxhZyAmIFhfSVNfU0FNRV9PUl9QT1NJVElWRV9YX1NIT1JUX1ZFQ1RPUikgewogICAgICAgIHhDb29yZGluYXRlcy5wdXNoKGxhc3RDb29yZGluYXRlKTsKICAgICAgfSBlbHNlIHsKICAgICAgICBsYXN0Q29vcmRpbmF0ZSArPSBnbHlmLmdldEludDE2KHBvcyk7CiAgICAgICAgcG9zICs9IDI7CiAgICAgICAgeENvb3JkaW5hdGVzLnB1c2gobGFzdENvb3JkaW5hdGUpOwogICAgICB9CiAgICAgIGlmIChlbmRQdHNPZkNvbnRvdXJzW2VuZFB0c09mQ29udG91cnNJbmRleF0gPT09IGkpIHsKICAgICAgICBlbmRQdHNPZkNvbnRvdXJzSW5kZXgrKzsKICAgICAgICBhbGxYQ29vcmRpbmF0ZXMucHVzaCh4Q29vcmRpbmF0ZXMpOwogICAgICAgIHhDb29yZGluYXRlcyA9IFtdOwogICAgICB9CiAgICB9CiAgICBsYXN0Q29vcmRpbmF0ZSA9IDA7CiAgICBlbmRQdHNPZkNvbnRvdXJzSW5kZXggPSAwOwogICAgZm9yIChsZXQgaSA9IDA7IGkgPCBudW1iZXJPZlB0OyBpKyspIHsKICAgICAgY29uc3QgZmxhZyA9IGZsYWdzW2ldOwogICAgICBpZiAoZmxhZyAmIFlfU0hPUlRfVkVDVE9SKSB7CiAgICAgICAgY29uc3QgeSA9IGdseWYuZ2V0VWludDgocG9zKyspOwogICAgICAgIGxhc3RDb29yZGluYXRlICs9IGZsYWcgJiBZX0lTX1NBTUVfT1JfUE9TSVRJVkVfWV9TSE9SVF9WRUNUT1IgPyB5IDogLXk7CiAgICAgICAgeUNvb3JkaW5hdGVzLnB1c2gobGFzdENvb3JkaW5hdGUpOwogICAgICB9IGVsc2UgaWYgKGZsYWcgJiBZX0lTX1NBTUVfT1JfUE9TSVRJVkVfWV9TSE9SVF9WRUNUT1IpIHsKICAgICAgICB5Q29vcmRpbmF0ZXMucHVzaChsYXN0Q29vcmRpbmF0ZSk7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgbGFzdENvb3JkaW5hdGUgKz0gZ2x5Zi5nZXRJbnQxNihwb3MpOwogICAgICAgIHBvcyArPSAyOwogICAgICAgIHlDb29yZGluYXRlcy5wdXNoKGxhc3RDb29yZGluYXRlKTsKICAgICAgfQogICAgICBwb2ludEZsYWdzLnB1c2goZmxhZyAmIE9OX0NVUlZFX1BPSU5UIHwgZmxhZyAmIE9WRVJMQVBfU0lNUExFKTsKICAgICAgaWYgKGVuZFB0c09mQ29udG91cnNbZW5kUHRzT2ZDb250b3Vyc0luZGV4XSA9PT0gaSkgewogICAgICAgIHhDb29yZGluYXRlcyA9IGFsbFhDb29yZGluYXRlc1tlbmRQdHNPZkNvbnRvdXJzSW5kZXhdOwogICAgICAgIGVuZFB0c09mQ29udG91cnNJbmRleCsrOwogICAgICAgIGNvbnRvdXJzLnB1c2gobmV3IENvbnRvdXIoewogICAgICAgICAgZmxhZ3M6IHBvaW50RmxhZ3MsCiAgICAgICAgICB4Q29vcmRpbmF0ZXMsCiAgICAgICAgICB5Q29vcmRpbmF0ZXMKICAgICAgICB9KSk7CiAgICAgICAgeUNvb3JkaW5hdGVzID0gW107CiAgICAgICAgcG9pbnRGbGFncyA9IFtdOwogICAgICB9CiAgICB9CiAgICByZXR1cm4gbmV3IFNpbXBsZUdseXBoKHsKICAgICAgY29udG91cnMsCiAgICAgIGluc3RydWN0aW9ucwogICAgfSk7CiAgfQogIGdldFNpemUoKSB7CiAgICBsZXQgc2l6ZSA9IHRoaXMuY29udG91cnMubGVuZ3RoICogMiArIDIgKyB0aGlzLmluc3RydWN0aW9ucy5sZW5ndGg7CiAgICBsZXQgbGFzdFggPSAwOwogICAgbGV0IGxhc3RZID0gMDsKICAgIGZvciAoY29uc3QgY29udG91ciBvZiB0aGlzLmNvbnRvdXJzKSB7CiAgICAgIHNpemUgKz0gY29udG91ci5mbGFncy5sZW5ndGg7CiAgICAgIGZvciAobGV0IGkgPSAwLCBpaSA9IGNvbnRvdXIueENvb3JkaW5hdGVzLmxlbmd0aDsgaSA8IGlpOyBpKyspIHsKICAgICAgICBjb25zdCB4ID0gY29udG91ci54Q29vcmRpbmF0ZXNbaV07CiAgICAgICAgY29uc3QgeSA9IGNvbnRvdXIueUNvb3JkaW5hdGVzW2ldOwogICAgICAgIGxldCBhYnMgPSBNYXRoLmFicyh4IC0gbGFzdFgpOwogICAgICAgIGlmIChhYnMgPiAyNTUpIHsKICAgICAgICAgIHNpemUgKz0gMjsKICAgICAgICB9IGVsc2UgaWYgKGFicyA+IDApIHsKICAgICAgICAgIHNpemUgKz0gMTsKICAgICAgICB9CiAgICAgICAgbGFzdFggPSB4OwogICAgICAgIGFicyA9IE1hdGguYWJzKHkgLSBsYXN0WSk7CiAgICAgICAgaWYgKGFicyA+IDI1NSkgewogICAgICAgICAgc2l6ZSArPSAyOwogICAgICAgIH0gZWxzZSBpZiAoYWJzID4gMCkgewogICAgICAgICAgc2l6ZSArPSAxOwogICAgICAgIH0KICAgICAgICBsYXN0WSA9IHk7CiAgICAgIH0KICAgIH0KICAgIHJldHVybiBzaXplOwogIH0KICB3cml0ZShwb3MsIGJ1ZikgewogICAgY29uc3Qgc3BvcyA9IHBvczsKICAgIGNvbnN0IHhDb29yZGluYXRlcyA9IFtdOwogICAgY29uc3QgeUNvb3JkaW5hdGVzID0gW107CiAgICBjb25zdCBmbGFncyA9IFtdOwogICAgbGV0IGxhc3RYID0gMDsKICAgIGxldCBsYXN0WSA9IDA7CiAgICBmb3IgKGNvbnN0IGNvbnRvdXIgb2YgdGhpcy5jb250b3VycykgewogICAgICBmb3IgKGxldCBpID0gMCwgaWkgPSBjb250b3VyLnhDb29yZGluYXRlcy5sZW5ndGg7IGkgPCBpaTsgaSsrKSB7CiAgICAgICAgbGV0IGZsYWcgPSBjb250b3VyLmZsYWdzW2ldOwogICAgICAgIGNvbnN0IHggPSBjb250b3VyLnhDb29yZGluYXRlc1tpXTsKICAgICAgICBsZXQgZGVsdGEgPSB4IC0gbGFzdFg7CiAgICAgICAgaWYgKGRlbHRhID09PSAwKSB7CiAgICAgICAgICBmbGFnIHw9IFhfSVNfU0FNRV9PUl9QT1NJVElWRV9YX1NIT1JUX1ZFQ1RPUjsKICAgICAgICAgIHhDb29yZGluYXRlcy5wdXNoKDApOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICBjb25zdCBhYnMgPSBNYXRoLmFicyhkZWx0YSk7CiAgICAgICAgICBpZiAoYWJzIDw9IDI1NSkgewogICAgICAgICAgICBmbGFnIHw9IGRlbHRhID49IDAgPyBYX1NIT1JUX1ZFQ1RPUiB8IFhfSVNfU0FNRV9PUl9QT1NJVElWRV9YX1NIT1JUX1ZFQ1RPUiA6IFhfU0hPUlRfVkVDVE9SOwogICAgICAgICAgICB4Q29vcmRpbmF0ZXMucHVzaChhYnMpOwogICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgeENvb3JkaW5hdGVzLnB1c2goZGVsdGEpOwogICAgICAgICAgfQogICAgICAgIH0KICAgICAgICBsYXN0WCA9IHg7CiAgICAgICAgY29uc3QgeSA9IGNvbnRvdXIueUNvb3JkaW5hdGVzW2ldOwogICAgICAgIGRlbHRhID0geSAtIGxhc3RZOwogICAgICAgIGlmIChkZWx0YSA9PT0gMCkgewogICAgICAgICAgZmxhZyB8PSBZX0lTX1NBTUVfT1JfUE9TSVRJVkVfWV9TSE9SVF9WRUNUT1I7CiAgICAgICAgICB5Q29vcmRpbmF0ZXMucHVzaCgwKTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgY29uc3QgYWJzID0gTWF0aC5hYnMoZGVsdGEpOwogICAgICAgICAgaWYgKGFicyA8PSAyNTUpIHsKICAgICAgICAgICAgZmxhZyB8PSBkZWx0YSA+PSAwID8gWV9TSE9SVF9WRUNUT1IgfCBZX0lTX1NBTUVfT1JfUE9TSVRJVkVfWV9TSE9SVF9WRUNUT1IgOiBZX1NIT1JUX1ZFQ1RPUjsKICAgICAgICAgICAgeUNvb3JkaW5hdGVzLnB1c2goYWJzKTsKICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIHlDb29yZGluYXRlcy5wdXNoKGRlbHRhKTsKICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgbGFzdFkgPSB5OwogICAgICAgIGZsYWdzLnB1c2goZmxhZyk7CiAgICAgIH0KICAgICAgYnVmLnNldFVpbnQxNihwb3MsIHhDb29yZGluYXRlcy5sZW5ndGggLSAxKTsKICAgICAgcG9zICs9IDI7CiAgICB9CiAgICBidWYuc2V0VWludDE2KHBvcywgdGhpcy5pbnN0cnVjdGlvbnMubGVuZ3RoKTsKICAgIHBvcyArPSAyOwogICAgaWYgKHRoaXMuaW5zdHJ1Y3Rpb25zLmxlbmd0aCkgewogICAgICBuZXcgVWludDhBcnJheShidWYuYnVmZmVyLCAwLCBidWYuYnVmZmVyLmJ5dGVMZW5ndGgpLnNldCh0aGlzLmluc3RydWN0aW9ucywgcG9zKTsKICAgICAgcG9zICs9IHRoaXMuaW5zdHJ1Y3Rpb25zLmxlbmd0aDsKICAgIH0KICAgIGZvciAoY29uc3QgZmxhZyBvZiBmbGFncykgewogICAgICBidWYuc2V0VWludDgocG9zKyssIGZsYWcpOwogICAgfQogICAgZm9yIChsZXQgaSA9IDAsIGlpID0geENvb3JkaW5hdGVzLmxlbmd0aDsgaSA8IGlpOyBpKyspIHsKICAgICAgY29uc3QgeCA9IHhDb29yZGluYXRlc1tpXTsKICAgICAgY29uc3QgZmxhZyA9IGZsYWdzW2ldOwogICAgICBpZiAoZmxhZyAmIFhfU0hPUlRfVkVDVE9SKSB7CiAgICAgICAgYnVmLnNldFVpbnQ4KHBvcysrLCB4KTsKICAgICAgfSBlbHNlIGlmICghKGZsYWcgJiBYX0lTX1NBTUVfT1JfUE9TSVRJVkVfWF9TSE9SVF9WRUNUT1IpKSB7CiAgICAgICAgYnVmLnNldEludDE2KHBvcywgeCk7CiAgICAgICAgcG9zICs9IDI7CiAgICAgIH0KICAgIH0KICAgIGZvciAobGV0IGkgPSAwLCBpaSA9IHlDb29yZGluYXRlcy5sZW5ndGg7IGkgPCBpaTsgaSsrKSB7CiAgICAgIGNvbnN0IHkgPSB5Q29vcmRpbmF0ZXNbaV07CiAgICAgIGNvbnN0IGZsYWcgPSBmbGFnc1tpXTsKICAgICAgaWYgKGZsYWcgJiBZX1NIT1JUX1ZFQ1RPUikgewogICAgICAgIGJ1Zi5zZXRVaW50OChwb3MrKywgeSk7CiAgICAgIH0gZWxzZSBpZiAoIShmbGFnICYgWV9JU19TQU1FX09SX1BPU0lUSVZFX1lfU0hPUlRfVkVDVE9SKSkgewogICAgICAgIGJ1Zi5zZXRJbnQxNihwb3MsIHkpOwogICAgICAgIHBvcyArPSAyOwogICAgICB9CiAgICB9CiAgICByZXR1cm4gcG9zIC0gc3BvczsKICB9CiAgc2NhbGUoeCwgZmFjdG9yKSB7CiAgICBmb3IgKGNvbnN0IGNvbnRvdXIgb2YgdGhpcy5jb250b3VycykgewogICAgICBpZiAoY29udG91ci54Q29vcmRpbmF0ZXMubGVuZ3RoID09PSAwKSB7CiAgICAgICAgY29udGludWU7CiAgICAgIH0KICAgICAgZm9yIChsZXQgaSA9IDAsIGlpID0gY29udG91ci54Q29vcmRpbmF0ZXMubGVuZ3RoOyBpIDwgaWk7IGkrKykgewogICAgICAgIGNvbnRvdXIueENvb3JkaW5hdGVzW2ldID0gTWF0aC5yb3VuZCh4ICsgKGNvbnRvdXIueENvb3JkaW5hdGVzW2ldIC0geCkgKiBmYWN0b3IpOwogICAgICB9CiAgICB9CiAgfQp9CmNsYXNzIENvbXBvc2l0ZUdseXBoIHsKICBjb25zdHJ1Y3Rvcih7CiAgICBmbGFncywKICAgIGdseXBoSW5kZXgsCiAgICBhcmd1bWVudDEsCiAgICBhcmd1bWVudDIsCiAgICB0cmFuc2YsCiAgICBpbnN0cnVjdGlvbnMKICB9KSB7CiAgICB0aGlzLmZsYWdzID0gZmxhZ3M7CiAgICB0aGlzLmdseXBoSW5kZXggPSBnbHlwaEluZGV4OwogICAgdGhpcy5hcmd1bWVudDEgPSBhcmd1bWVudDE7CiAgICB0aGlzLmFyZ3VtZW50MiA9IGFyZ3VtZW50MjsKICAgIHRoaXMudHJhbnNmID0gdHJhbnNmOwogICAgdGhpcy5pbnN0cnVjdGlvbnMgPSBpbnN0cnVjdGlvbnM7CiAgfQogIHN0YXRpYyBwYXJzZShwb3MsIGdseWYpIHsKICAgIGNvbnN0IHNwb3MgPSBwb3M7CiAgICBjb25zdCB0cmFuc2YgPSBbXTsKICAgIGxldCBmbGFncyA9IGdseWYuZ2V0VWludDE2KHBvcyk7CiAgICBjb25zdCBnbHlwaEluZGV4ID0gZ2x5Zi5nZXRVaW50MTYocG9zICsgMik7CiAgICBwb3MgKz0gNDsKICAgIGxldCBhcmd1bWVudDEsIGFyZ3VtZW50MjsKICAgIGlmIChmbGFncyAmIEFSR18xX0FORF8yX0FSRV9XT1JEUykgewogICAgICBpZiAoZmxhZ3MgJiBBUkdTX0FSRV9YWV9WQUxVRVMpIHsKICAgICAgICBhcmd1bWVudDEgPSBnbHlmLmdldEludDE2KHBvcyk7CiAgICAgICAgYXJndW1lbnQyID0gZ2x5Zi5nZXRJbnQxNihwb3MgKyAyKTsKICAgICAgfSBlbHNlIHsKICAgICAgICBhcmd1bWVudDEgPSBnbHlmLmdldFVpbnQxNihwb3MpOwogICAgICAgIGFyZ3VtZW50MiA9IGdseWYuZ2V0VWludDE2KHBvcyArIDIpOwogICAgICB9CiAgICAgIHBvcyArPSA0OwogICAgICBmbGFncyBePSBBUkdfMV9BTkRfMl9BUkVfV09SRFM7CiAgICB9IGVsc2UgewogICAgICBpZiAoZmxhZ3MgJiBBUkdTX0FSRV9YWV9WQUxVRVMpIHsKICAgICAgICBhcmd1bWVudDEgPSBnbHlmLmdldEludDgocG9zKTsKICAgICAgICBhcmd1bWVudDIgPSBnbHlmLmdldEludDgocG9zICsgMSk7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgYXJndW1lbnQxID0gZ2x5Zi5nZXRVaW50OChwb3MpOwogICAgICAgIGFyZ3VtZW50MiA9IGdseWYuZ2V0VWludDgocG9zICsgMSk7CiAgICAgIH0KICAgICAgcG9zICs9IDI7CiAgICB9CiAgICBpZiAoZmxhZ3MgJiBXRV9IQVZFX0FfU0NBTEUpIHsKICAgICAgdHJhbnNmLnB1c2goZ2x5Zi5nZXRVaW50MTYocG9zKSk7CiAgICAgIHBvcyArPSAyOwogICAgfSBlbHNlIGlmIChmbGFncyAmIFdFX0hBVkVfQU5fWF9BTkRfWV9TQ0FMRSkgewogICAgICB0cmFuc2YucHVzaChnbHlmLmdldFVpbnQxNihwb3MpLCBnbHlmLmdldFVpbnQxNihwb3MgKyAyKSk7CiAgICAgIHBvcyArPSA0OwogICAgfSBlbHNlIGlmIChmbGFncyAmIFdFX0hBVkVfQV9UV09fQllfVFdPKSB7CiAgICAgIHRyYW5zZi5wdXNoKGdseWYuZ2V0VWludDE2KHBvcyksIGdseWYuZ2V0VWludDE2KHBvcyArIDIpLCBnbHlmLmdldFVpbnQxNihwb3MgKyA0KSwgZ2x5Zi5nZXRVaW50MTYocG9zICsgNikpOwogICAgICBwb3MgKz0gODsKICAgIH0KICAgIGxldCBpbnN0cnVjdGlvbnMgPSBudWxsOwogICAgaWYgKGZsYWdzICYgV0VfSEFWRV9JTlNUUlVDVElPTlMpIHsKICAgICAgY29uc3QgaW5zdHJ1Y3Rpb25MZW5ndGggPSBnbHlmLmdldFVpbnQxNihwb3MpOwogICAgICBwb3MgKz0gMjsKICAgICAgaW5zdHJ1Y3Rpb25zID0gbmV3IFVpbnQ4QXJyYXkoZ2x5Zikuc2xpY2UocG9zLCBwb3MgKyBpbnN0cnVjdGlvbkxlbmd0aCk7CiAgICAgIHBvcyArPSBpbnN0cnVjdGlvbkxlbmd0aDsKICAgIH0KICAgIHJldHVybiBbcG9zIC0gc3BvcywgbmV3IENvbXBvc2l0ZUdseXBoKHsKICAgICAgZmxhZ3MsCiAgICAgIGdseXBoSW5kZXgsCiAgICAgIGFyZ3VtZW50MSwKICAgICAgYXJndW1lbnQyLAogICAgICB0cmFuc2YsCiAgICAgIGluc3RydWN0aW9ucwogICAgfSldOwogIH0KICBnZXRTaXplKCkgewogICAgbGV0IHNpemUgPSAyICsgMiArIHRoaXMudHJhbnNmLmxlbmd0aCAqIDI7CiAgICBpZiAodGhpcy5mbGFncyAmIFdFX0hBVkVfSU5TVFJVQ1RJT05TKSB7CiAgICAgIHNpemUgKz0gMiArIHRoaXMuaW5zdHJ1Y3Rpb25zLmxlbmd0aDsKICAgIH0KICAgIHNpemUgKz0gMjsKICAgIGlmICh0aGlzLmZsYWdzICYgMikgewogICAgICBpZiAoISh0aGlzLmFyZ3VtZW50MSA+PSAtMTI4ICYmIHRoaXMuYXJndW1lbnQxIDw9IDEyNyAmJiB0aGlzLmFyZ3VtZW50MiA+PSAtMTI4ICYmIHRoaXMuYXJndW1lbnQyIDw9IDEyNykpIHsKICAgICAgICBzaXplICs9IDI7CiAgICAgIH0KICAgIH0gZWxzZSBpZiAoISh0aGlzLmFyZ3VtZW50MSA+PSAwICYmIHRoaXMuYXJndW1lbnQxIDw9IDI1NSAmJiB0aGlzLmFyZ3VtZW50MiA+PSAwICYmIHRoaXMuYXJndW1lbnQyIDw9IDI1NSkpIHsKICAgICAgc2l6ZSArPSAyOwogICAgfQogICAgcmV0dXJuIHNpemU7CiAgfQogIHdyaXRlKHBvcywgYnVmKSB7CiAgICBjb25zdCBzcG9zID0gcG9zOwogICAgaWYgKHRoaXMuZmxhZ3MgJiBBUkdTX0FSRV9YWV9WQUxVRVMpIHsKICAgICAgaWYgKCEodGhpcy5hcmd1bWVudDEgPj0gLTEyOCAmJiB0aGlzLmFyZ3VtZW50MSA8PSAxMjcgJiYgdGhpcy5hcmd1bWVudDIgPj0gLTEyOCAmJiB0aGlzLmFyZ3VtZW50MiA8PSAxMjcpKSB7CiAgICAgICAgdGhpcy5mbGFncyB8PSBBUkdfMV9BTkRfMl9BUkVfV09SRFM7CiAgICAgIH0KICAgIH0gZWxzZSBpZiAoISh0aGlzLmFyZ3VtZW50MSA+PSAwICYmIHRoaXMuYXJndW1lbnQxIDw9IDI1NSAmJiB0aGlzLmFyZ3VtZW50MiA+PSAwICYmIHRoaXMuYXJndW1lbnQyIDw9IDI1NSkpIHsKICAgICAgdGhpcy5mbGFncyB8PSBBUkdfMV9BTkRfMl9BUkVfV09SRFM7CiAgICB9CiAgICBidWYuc2V0VWludDE2KHBvcywgdGhpcy5mbGFncyk7CiAgICBidWYuc2V0VWludDE2KHBvcyArIDIsIHRoaXMuZ2x5cGhJbmRleCk7CiAgICBwb3MgKz0gNDsKICAgIGlmICh0aGlzLmZsYWdzICYgQVJHXzFfQU5EXzJfQVJFX1dPUkRTKSB7CiAgICAgIGlmICh0aGlzLmZsYWdzICYgQVJHU19BUkVfWFlfVkFMVUVTKSB7CiAgICAgICAgYnVmLnNldEludDE2KHBvcywgdGhpcy5hcmd1bWVudDEpOwogICAgICAgIGJ1Zi5zZXRJbnQxNihwb3MgKyAyLCB0aGlzLmFyZ3VtZW50Mik7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgYnVmLnNldFVpbnQxNihwb3MsIHRoaXMuYXJndW1lbnQxKTsKICAgICAgICBidWYuc2V0VWludDE2KHBvcyArIDIsIHRoaXMuYXJndW1lbnQyKTsKICAgICAgfQogICAgICBwb3MgKz0gNDsKICAgIH0gZWxzZSB7CiAgICAgIGJ1Zi5zZXRVaW50OChwb3MsIHRoaXMuYXJndW1lbnQxKTsKICAgICAgYnVmLnNldFVpbnQ4KHBvcyArIDEsIHRoaXMuYXJndW1lbnQyKTsKICAgICAgcG9zICs9IDI7CiAgICB9CiAgICBpZiAodGhpcy5mbGFncyAmIFdFX0hBVkVfSU5TVFJVQ1RJT05TKSB7CiAgICAgIGJ1Zi5zZXRVaW50MTYocG9zLCB0aGlzLmluc3RydWN0aW9ucy5sZW5ndGgpOwogICAgICBwb3MgKz0gMjsKICAgICAgaWYgKHRoaXMuaW5zdHJ1Y3Rpb25zLmxlbmd0aCkgewogICAgICAgIG5ldyBVaW50OEFycmF5KGJ1Zi5idWZmZXIsIDAsIGJ1Zi5idWZmZXIuYnl0ZUxlbmd0aCkuc2V0KHRoaXMuaW5zdHJ1Y3Rpb25zLCBwb3MpOwogICAgICAgIHBvcyArPSB0aGlzLmluc3RydWN0aW9ucy5sZW5ndGg7CiAgICAgIH0KICAgIH0KICAgIHJldHVybiBwb3MgLSBzcG9zOwogIH0KICBzY2FsZSh4LCBmYWN0b3IpIHt9Cn0KCi8qKiovIH0pLAovKiA0NyAqLwovKioqLyAoKF9fdW51c2VkX3dlYnBhY2tfbW9kdWxlLCBleHBvcnRzLCBfX3dfcGRmanNfcmVxdWlyZV9fKSA9PiB7CgoKCk9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCAiX19lc01vZHVsZSIsICh7CiAgdmFsdWU6IHRydWUKfSkpOwpleHBvcnRzLk9wZW5UeXBlRmlsZUJ1aWxkZXIgPSB2b2lkIDA7CnZhciBfY29yZV91dGlscyA9IF9fd19wZGZqc19yZXF1aXJlX18oMyk7CnZhciBfdXRpbCA9IF9fd19wZGZqc19yZXF1aXJlX18oMik7CmZ1bmN0aW9uIHdyaXRlSW50MTYoZGVzdCwgb2Zmc2V0LCBudW0pIHsKICBkZXN0W29mZnNldF0gPSBudW0gPj4gOCAmIDB4ZmY7CiAgZGVzdFtvZmZzZXQgKyAxXSA9IG51bSAmIDB4ZmY7Cn0KZnVuY3Rpb24gd3JpdGVJbnQzMihkZXN0LCBvZmZzZXQsIG51bSkgewogIGRlc3Rbb2Zmc2V0XSA9IG51bSA+PiAyNCAmIDB4ZmY7CiAgZGVzdFtvZmZzZXQgKyAxXSA9IG51bSA+PiAxNiAmIDB4ZmY7CiAgZGVzdFtvZmZzZXQgKyAyXSA9IG51bSA+PiA4ICYgMHhmZjsKICBkZXN0W29mZnNldCArIDNdID0gbnVtICYgMHhmZjsKfQpmdW5jdGlvbiB3cml0ZURhdGEoZGVzdCwgb2Zmc2V0LCBkYXRhKSB7CiAgaWYgKGRhdGEgaW5zdGFuY2VvZiBVaW50OEFycmF5KSB7CiAgICBkZXN0LnNldChkYXRhLCBvZmZzZXQpOwogIH0gZWxzZSBpZiAodHlwZW9mIGRhdGEgPT09ICJzdHJpbmciKSB7CiAgICBmb3IgKGxldCBpID0gMCwgaWkgPSBkYXRhLmxlbmd0aDsgaSA8IGlpOyBpKyspIHsKICAgICAgZGVzdFtvZmZzZXQrK10gPSBkYXRhLmNoYXJDb2RlQXQoaSkgJiAweGZmOwogICAgfQogIH0gZWxzZSB7CiAgICBmb3IgKGNvbnN0IG51bSBvZiBkYXRhKSB7CiAgICAgIGRlc3Rbb2Zmc2V0KytdID0gbnVtICYgMHhmZjsKICAgIH0KICB9Cn0KY29uc3QgT1RGX0hFQURFUl9TSVpFID0gMTI7CmNvbnN0IE9URl9UQUJMRV9FTlRSWV9TSVpFID0gMTY7CmNsYXNzIE9wZW5UeXBlRmlsZUJ1aWxkZXIgewogIGNvbnN0cnVjdG9yKHNmbnQpIHsKICAgIHRoaXMuc2ZudCA9IHNmbnQ7CiAgICB0aGlzLnRhYmxlcyA9IE9iamVjdC5jcmVhdGUobnVsbCk7CiAgfQogIHN0YXRpYyBnZXRTZWFyY2hQYXJhbXMoZW50cmllc0NvdW50LCBlbnRyeVNpemUpIHsKICAgIGxldCBtYXhQb3dlcjIgPSAxLAogICAgICBsb2cyID0gMDsKICAgIHdoaWxlICgobWF4UG93ZXIyIF4gZW50cmllc0NvdW50KSA+IG1heFBvd2VyMikgewogICAgICBtYXhQb3dlcjIgPDw9IDE7CiAgICAgIGxvZzIrKzsKICAgIH0KICAgIGNvbnN0IHNlYXJjaFJhbmdlID0gbWF4UG93ZXIyICogZW50cnlTaXplOwogICAgcmV0dXJuIHsKICAgICAgcmFuZ2U6IHNlYXJjaFJhbmdlLAogICAgICBlbnRyeTogbG9nMiwKICAgICAgcmFuZ2VTaGlmdDogZW50cnlTaXplICogZW50cmllc0NvdW50IC0gc2VhcmNoUmFuZ2UKICAgIH07CiAgfQogIHRvQXJyYXkoKSB7CiAgICBsZXQgc2ZudCA9IHRoaXMuc2ZudDsKICAgIGNvbnN0IHRhYmxlcyA9IHRoaXMudGFibGVzOwogICAgY29uc3QgdGFibGVzTmFtZXMgPSBPYmplY3Qua2V5cyh0YWJsZXMpOwogICAgdGFibGVzTmFtZXMuc29ydCgpOwogICAgY29uc3QgbnVtVGFibGVzID0gdGFibGVzTmFtZXMubGVuZ3RoOwogICAgbGV0IGksIGosIGpqLCB0YWJsZSwgdGFibGVOYW1lOwogICAgbGV0IG9mZnNldCA9IE9URl9IRUFERVJfU0laRSArIG51bVRhYmxlcyAqIE9URl9UQUJMRV9FTlRSWV9TSVpFOwogICAgY29uc3QgdGFibGVPZmZzZXRzID0gW29mZnNldF07CiAgICBmb3IgKGkgPSAwOyBpIDwgbnVtVGFibGVzOyBpKyspIHsKICAgICAgdGFibGUgPSB0YWJsZXNbdGFibGVzTmFtZXNbaV1dOwogICAgICBjb25zdCBwYWRkZWRMZW5ndGggPSAodGFibGUubGVuZ3RoICsgMyAmIH4zKSA+Pj4gMDsKICAgICAgb2Zmc2V0ICs9IHBhZGRlZExlbmd0aDsKICAgICAgdGFibGVPZmZzZXRzLnB1c2gob2Zmc2V0KTsKICAgIH0KICAgIGNvbnN0IGZpbGUgPSBuZXcgVWludDhBcnJheShvZmZzZXQpOwogICAgZm9yIChpID0gMDsgaSA8IG51bVRhYmxlczsgaSsrKSB7CiAgICAgIHRhYmxlID0gdGFibGVzW3RhYmxlc05hbWVzW2ldXTsKICAgICAgd3JpdGVEYXRhKGZpbGUsIHRhYmxlT2Zmc2V0c1tpXSwgdGFibGUpOwogICAgfQogICAgaWYgKHNmbnQgPT09ICJ0cnVlIikgewogICAgICBzZm50ID0gKDAsIF91dGlsLnN0cmluZzMyKSgweDAwMDEwMDAwKTsKICAgIH0KICAgIGZpbGVbMF0gPSBzZm50LmNoYXJDb2RlQXQoMCkgJiAweGZmOwogICAgZmlsZVsxXSA9IHNmbnQuY2hhckNvZGVBdCgxKSAmIDB4ZmY7CiAgICBmaWxlWzJdID0gc2ZudC5jaGFyQ29kZUF0KDIpICYgMHhmZjsKICAgIGZpbGVbM10gPSBzZm50LmNoYXJDb2RlQXQoMykgJiAweGZmOwogICAgd3JpdGVJbnQxNihmaWxlLCA0LCBudW1UYWJsZXMpOwogICAgY29uc3Qgc2VhcmNoUGFyYW1zID0gT3BlblR5cGVGaWxlQnVpbGRlci5nZXRTZWFyY2hQYXJhbXMobnVtVGFibGVzLCAxNik7CiAgICB3cml0ZUludDE2KGZpbGUsIDYsIHNlYXJjaFBhcmFtcy5yYW5nZSk7CiAgICB3cml0ZUludDE2KGZpbGUsIDgsIHNlYXJjaFBhcmFtcy5lbnRyeSk7CiAgICB3cml0ZUludDE2KGZpbGUsIDEwLCBzZWFyY2hQYXJhbXMucmFuZ2VTaGlmdCk7CiAgICBvZmZzZXQgPSBPVEZfSEVBREVSX1NJWkU7CiAgICBmb3IgKGkgPSAwOyBpIDwgbnVtVGFibGVzOyBpKyspIHsKICAgICAgdGFibGVOYW1lID0gdGFibGVzTmFtZXNbaV07CiAgICAgIGZpbGVbb2Zmc2V0XSA9IHRhYmxlTmFtZS5jaGFyQ29kZUF0KDApICYgMHhmZjsKICAgICAgZmlsZVtvZmZzZXQgKyAxXSA9IHRhYmxlTmFtZS5jaGFyQ29kZUF0KDEpICYgMHhmZjsKICAgICAgZmlsZVtvZmZzZXQgKyAyXSA9IHRhYmxlTmFtZS5jaGFyQ29kZUF0KDIpICYgMHhmZjsKICAgICAgZmlsZVtvZmZzZXQgKyAzXSA9IHRhYmxlTmFtZS5jaGFyQ29kZUF0KDMpICYgMHhmZjsKICAgICAgbGV0IGNoZWNrc3VtID0gMDsKICAgICAgZm9yIChqID0gdGFibGVPZmZzZXRzW2ldLCBqaiA9IHRhYmxlT2Zmc2V0c1tpICsgMV07IGogPCBqajsgaiArPSA0KSB7CiAgICAgICAgY29uc3QgcXVhZCA9ICgwLCBfY29yZV91dGlscy5yZWFkVWludDMyKShmaWxlLCBqKTsKICAgICAgICBjaGVja3N1bSA9IGNoZWNrc3VtICsgcXVhZCA+Pj4gMDsKICAgICAgfQogICAgICB3cml0ZUludDMyKGZpbGUsIG9mZnNldCArIDQsIGNoZWNrc3VtKTsKICAgICAgd3JpdGVJbnQzMihmaWxlLCBvZmZzZXQgKyA4LCB0YWJsZU9mZnNldHNbaV0pOwogICAgICB3cml0ZUludDMyKGZpbGUsIG9mZnNldCArIDEyLCB0YWJsZXNbdGFibGVOYW1lXS5sZW5ndGgpOwogICAgICBvZmZzZXQgKz0gT1RGX1RBQkxFX0VOVFJZX1NJWkU7CiAgICB9CiAgICByZXR1cm4gZmlsZTsKICB9CiAgYWRkVGFibGUodGFnLCBkYXRhKSB7CiAgICBpZiAodGFnIGluIHRoaXMudGFibGVzKSB7CiAgICAgIHRocm93IG5ldyBFcnJvcigiVGFibGUgIiArIHRhZyArICIgYWxyZWFkeSBleGlzdHMiKTsKICAgIH0KICAgIHRoaXMudGFibGVzW3RhZ10gPSBkYXRhOwogIH0KfQpleHBvcnRzLk9wZW5UeXBlRmlsZUJ1aWxkZXIgPSBPcGVuVHlwZUZpbGVCdWlsZGVyOwoKLyoqKi8gfSksCi8qIDQ4ICovCi8qKiovICgoX191bnVzZWRfd2VicGFja19tb2R1bGUsIGV4cG9ydHMsIF9fd19wZGZqc19yZXF1aXJlX18pID0+IHsKCgoKT2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsICJfX2VzTW9kdWxlIiwgKHsKICB2YWx1ZTogdHJ1ZQp9KSk7CmV4cG9ydHMuVHlwZTFGb250ID0gdm9pZCAwOwp2YXIgX2NmZl9wYXJzZXIgPSBfX3dfcGRmanNfcmVxdWlyZV9fKDM1KTsKdmFyIF91dGlsID0gX193X3BkZmpzX3JlcXVpcmVfXygyKTsKdmFyIF9mb250c191dGlscyA9IF9fd19wZGZqc19yZXF1aXJlX18oMzgpOwp2YXIgX2NvcmVfdXRpbHMgPSBfX3dfcGRmanNfcmVxdWlyZV9fKDMpOwp2YXIgX3N0cmVhbSA9IF9fd19wZGZqc19yZXF1aXJlX18oOCk7CnZhciBfdHlwZTFfcGFyc2VyID0gX193X3BkZmpzX3JlcXVpcmVfXyg0OSk7CmZ1bmN0aW9uIGZpbmRCbG9jayhzdHJlYW1CeXRlcywgc2lnbmF0dXJlLCBzdGFydEluZGV4KSB7CiAgY29uc3Qgc3RyZWFtQnl0ZXNMZW5ndGggPSBzdHJlYW1CeXRlcy5sZW5ndGg7CiAgY29uc3Qgc2lnbmF0dXJlTGVuZ3RoID0gc2lnbmF0dXJlLmxlbmd0aDsKICBjb25zdCBzY2FuTGVuZ3RoID0gc3RyZWFtQnl0ZXNMZW5ndGggLSBzaWduYXR1cmVMZW5ndGg7CiAgbGV0IGkgPSBzdGFydEluZGV4LAogICAgZm91bmQgPSBmYWxzZTsKICB3aGlsZSAoaSA8IHNjYW5MZW5ndGgpIHsKICAgIGxldCBqID0gMDsKICAgIHdoaWxlIChqIDwgc2lnbmF0dXJlTGVuZ3RoICYmIHN0cmVhbUJ5dGVzW2kgKyBqXSA9PT0gc2lnbmF0dXJlW2pdKSB7CiAgICAgIGorKzsKICAgIH0KICAgIGlmIChqID49IHNpZ25hdHVyZUxlbmd0aCkgewogICAgICBpICs9IGo7CiAgICAgIHdoaWxlIChpIDwgc3RyZWFtQnl0ZXNMZW5ndGggJiYgKDAsIF9jb3JlX3V0aWxzLmlzV2hpdGVTcGFjZSkoc3RyZWFtQnl0ZXNbaV0pKSB7CiAgICAgICAgaSsrOwogICAgICB9CiAgICAgIGZvdW5kID0gdHJ1ZTsKICAgICAgYnJlYWs7CiAgICB9CiAgICBpKys7CiAgfQogIHJldHVybiB7CiAgICBmb3VuZCwKICAgIGxlbmd0aDogaQogIH07Cn0KZnVuY3Rpb24gZ2V0SGVhZGVyQmxvY2soc3RyZWFtLCBzdWdnZXN0ZWRMZW5ndGgpIHsKICBjb25zdCBFRVhFQ19TSUdOQVRVUkUgPSBbMHg2NSwgMHg2NSwgMHg3OCwgMHg2NSwgMHg2M107CiAgY29uc3Qgc3RyZWFtU3RhcnRQb3MgPSBzdHJlYW0ucG9zOwogIGxldCBoZWFkZXJCeXRlcywgaGVhZGVyQnl0ZXNMZW5ndGgsIGJsb2NrOwogIHRyeSB7CiAgICBoZWFkZXJCeXRlcyA9IHN0cmVhbS5nZXRCeXRlcyhzdWdnZXN0ZWRMZW5ndGgpOwogICAgaGVhZGVyQnl0ZXNMZW5ndGggPSBoZWFkZXJCeXRlcy5sZW5ndGg7CiAgfSBjYXRjaCB7fQogIGlmIChoZWFkZXJCeXRlc0xlbmd0aCA9PT0gc3VnZ2VzdGVkTGVuZ3RoKSB7CiAgICBibG9jayA9IGZpbmRCbG9jayhoZWFkZXJCeXRlcywgRUVYRUNfU0lHTkFUVVJFLCBzdWdnZXN0ZWRMZW5ndGggLSAyICogRUVYRUNfU0lHTkFUVVJFLmxlbmd0aCk7CiAgICBpZiAoYmxvY2suZm91bmQgJiYgYmxvY2subGVuZ3RoID09PSBzdWdnZXN0ZWRMZW5ndGgpIHsKICAgICAgcmV0dXJuIHsKICAgICAgICBzdHJlYW06IG5ldyBfc3RyZWFtLlN0cmVhbShoZWFkZXJCeXRlcyksCiAgICAgICAgbGVuZ3RoOiBzdWdnZXN0ZWRMZW5ndGgKICAgICAgfTsKICAgIH0KICB9CiAgKDAsIF91dGlsLndhcm4pKCdJbnZhbGlkICJMZW5ndGgxIiBwcm9wZXJ0eSBpbiBUeXBlMSBmb250IC0tIHRyeWluZyB0byByZWNvdmVyLicpOwogIHN0cmVhbS5wb3MgPSBzdHJlYW1TdGFydFBvczsKICBjb25zdCBTQ0FOX0JMT0NLX0xFTkdUSCA9IDIwNDg7CiAgbGV0IGFjdHVhbExlbmd0aDsKICB3aGlsZSAodHJ1ZSkgewogICAgY29uc3Qgc2NhbkJ5dGVzID0gc3RyZWFtLnBlZWtCeXRlcyhTQ0FOX0JMT0NLX0xFTkdUSCk7CiAgICBibG9jayA9IGZpbmRCbG9jayhzY2FuQnl0ZXMsIEVFWEVDX1NJR05BVFVSRSwgMCk7CiAgICBpZiAoYmxvY2subGVuZ3RoID09PSAwKSB7CiAgICAgIGJyZWFrOwogICAgfQogICAgc3RyZWFtLnBvcyArPSBibG9jay5sZW5ndGg7CiAgICBpZiAoYmxvY2suZm91bmQpIHsKICAgICAgYWN0dWFsTGVuZ3RoID0gc3RyZWFtLnBvcyAtIHN0cmVhbVN0YXJ0UG9zOwogICAgICBicmVhazsKICAgIH0KICB9CiAgc3RyZWFtLnBvcyA9IHN0cmVhbVN0YXJ0UG9zOwogIGlmIChhY3R1YWxMZW5ndGgpIHsKICAgIHJldHVybiB7CiAgICAgIHN0cmVhbTogbmV3IF9zdHJlYW0uU3RyZWFtKHN0cmVhbS5nZXRCeXRlcyhhY3R1YWxMZW5ndGgpKSwKICAgICAgbGVuZ3RoOiBhY3R1YWxMZW5ndGgKICAgIH07CiAgfQogICgwLCBfdXRpbC53YXJuKSgnVW5hYmxlIHRvIHJlY292ZXIgIkxlbmd0aDEiIHByb3BlcnR5IGluIFR5cGUxIGZvbnQgLS0gdXNpbmcgYXMgaXMuJyk7CiAgcmV0dXJuIHsKICAgIHN0cmVhbTogbmV3IF9zdHJlYW0uU3RyZWFtKHN0cmVhbS5nZXRCeXRlcyhzdWdnZXN0ZWRMZW5ndGgpKSwKICAgIGxlbmd0aDogc3VnZ2VzdGVkTGVuZ3RoCiAgfTsKfQpmdW5jdGlvbiBnZXRFZXhlY0Jsb2NrKHN0cmVhbSwgc3VnZ2VzdGVkTGVuZ3RoKSB7CiAgY29uc3QgZWV4ZWNCeXRlcyA9IHN0cmVhbS5nZXRCeXRlcygpOwogIGlmIChlZXhlY0J5dGVzLmxlbmd0aCA9PT0gMCkgewogICAgdGhyb3cgbmV3IF91dGlsLkZvcm1hdEVycm9yKCJnZXRFZXhlY0Jsb2NrIC0gbm8gZm9udCBwcm9ncmFtIGZvdW5kLiIpOwogIH0KICByZXR1cm4gewogICAgc3RyZWFtOiBuZXcgX3N0cmVhbS5TdHJlYW0oZWV4ZWNCeXRlcyksCiAgICBsZW5ndGg6IGVleGVjQnl0ZXMubGVuZ3RoCiAgfTsKfQpjbGFzcyBUeXBlMUZvbnQgewogIGNvbnN0cnVjdG9yKG5hbWUsIGZpbGUsIHByb3BlcnRpZXMpIHsKICAgIGNvbnN0IFBGQl9IRUFERVJfU0laRSA9IDY7CiAgICBsZXQgaGVhZGVyQmxvY2tMZW5ndGggPSBwcm9wZXJ0aWVzLmxlbmd0aDE7CiAgICBsZXQgZWV4ZWNCbG9ja0xlbmd0aCA9IHByb3BlcnRpZXMubGVuZ3RoMjsKICAgIGxldCBwZmJIZWFkZXIgPSBmaWxlLnBlZWtCeXRlcyhQRkJfSEVBREVSX1NJWkUpOwogICAgY29uc3QgcGZiSGVhZGVyUHJlc2VudCA9IHBmYkhlYWRlclswXSA9PT0gMHg4MCAmJiBwZmJIZWFkZXJbMV0gPT09IDB4MDE7CiAgICBpZiAocGZiSGVhZGVyUHJlc2VudCkgewogICAgICBmaWxlLnNraXAoUEZCX0hFQURFUl9TSVpFKTsKICAgICAgaGVhZGVyQmxvY2tMZW5ndGggPSBwZmJIZWFkZXJbNV0gPDwgMjQgfCBwZmJIZWFkZXJbNF0gPDwgMTYgfCBwZmJIZWFkZXJbM10gPDwgOCB8IHBmYkhlYWRlclsyXTsKICAgIH0KICAgIGNvbnN0IGhlYWRlckJsb2NrID0gZ2V0SGVhZGVyQmxvY2soZmlsZSwgaGVhZGVyQmxvY2tMZW5ndGgpOwogICAgY29uc3QgaGVhZGVyQmxvY2tQYXJzZXIgPSBuZXcgX3R5cGUxX3BhcnNlci5UeXBlMVBhcnNlcihoZWFkZXJCbG9jay5zdHJlYW0sIGZhbHNlLCBfZm9udHNfdXRpbHMuU0VBQ19BTkFMWVNJU19FTkFCTEVEKTsKICAgIGhlYWRlckJsb2NrUGFyc2VyLmV4dHJhY3RGb250SGVhZGVyKHByb3BlcnRpZXMpOwogICAgaWYgKHBmYkhlYWRlclByZXNlbnQpIHsKICAgICAgcGZiSGVhZGVyID0gZmlsZS5nZXRCeXRlcyhQRkJfSEVBREVSX1NJWkUpOwogICAgICBlZXhlY0Jsb2NrTGVuZ3RoID0gcGZiSGVhZGVyWzVdIDw8IDI0IHwgcGZiSGVhZGVyWzRdIDw8IDE2IHwgcGZiSGVhZGVyWzNdIDw8IDggfCBwZmJIZWFkZXJbMl07CiAgICB9CiAgICBjb25zdCBlZXhlY0Jsb2NrID0gZ2V0RWV4ZWNCbG9jayhmaWxlLCBlZXhlY0Jsb2NrTGVuZ3RoKTsKICAgIGNvbnN0IGVleGVjQmxvY2tQYXJzZXIgPSBuZXcgX3R5cGUxX3BhcnNlci5UeXBlMVBhcnNlcihlZXhlY0Jsb2NrLnN0cmVhbSwgdHJ1ZSwgX2ZvbnRzX3V0aWxzLlNFQUNfQU5BTFlTSVNfRU5BQkxFRCk7CiAgICBjb25zdCBkYXRhID0gZWV4ZWNCbG9ja1BhcnNlci5leHRyYWN0Rm9udFByb2dyYW0ocHJvcGVydGllcyk7CiAgICBmb3IgKGNvbnN0IGtleSBpbiBkYXRhLnByb3BlcnRpZXMpIHsKICAgICAgcHJvcGVydGllc1trZXldID0gZGF0YS5wcm9wZXJ0aWVzW2tleV07CiAgICB9CiAgICBjb25zdCBjaGFyc3RyaW5ncyA9IGRhdGEuY2hhcnN0cmluZ3M7CiAgICBjb25zdCB0eXBlMkNoYXJzdHJpbmdzID0gdGhpcy5nZXRUeXBlMkNoYXJzdHJpbmdzKGNoYXJzdHJpbmdzKTsKICAgIGNvbnN0IHN1YnJzID0gdGhpcy5nZXRUeXBlMlN1YnJzKGRhdGEuc3VicnMpOwogICAgdGhpcy5jaGFyc3RyaW5ncyA9IGNoYXJzdHJpbmdzOwogICAgdGhpcy5kYXRhID0gdGhpcy53cmFwKG5hbWUsIHR5cGUyQ2hhcnN0cmluZ3MsIHRoaXMuY2hhcnN0cmluZ3MsIHN1YnJzLCBwcm9wZXJ0aWVzKTsKICAgIHRoaXMuc2VhY3MgPSB0aGlzLmdldFNlYWNzKGRhdGEuY2hhcnN0cmluZ3MpOwogIH0KICBnZXQgbnVtR2x5cGhzKCkgewogICAgcmV0dXJuIHRoaXMuY2hhcnN0cmluZ3MubGVuZ3RoICsgMTsKICB9CiAgZ2V0Q2hhcnNldCgpIHsKICAgIGNvbnN0IGNoYXJzZXQgPSBbIi5ub3RkZWYiXTsKICAgIGZvciAoY29uc3QgewogICAgICBnbHlwaE5hbWUKICAgIH0gb2YgdGhpcy5jaGFyc3RyaW5ncykgewogICAgICBjaGFyc2V0LnB1c2goZ2x5cGhOYW1lKTsKICAgIH0KICAgIHJldHVybiBjaGFyc2V0OwogIH0KICBnZXRHbHlwaE1hcHBpbmcocHJvcGVydGllcykgewogICAgY29uc3QgY2hhcnN0cmluZ3MgPSB0aGlzLmNoYXJzdHJpbmdzOwogICAgaWYgKHByb3BlcnRpZXMuY29tcG9zaXRlKSB7CiAgICAgIGNvbnN0IGNoYXJDb2RlVG9HbHlwaElkID0gT2JqZWN0LmNyZWF0ZShudWxsKTsKICAgICAgZm9yIChsZXQgZ2x5cGhJZCA9IDAsIGNoYXJzdHJpbmdzTGVuID0gY2hhcnN0cmluZ3MubGVuZ3RoOyBnbHlwaElkIDwgY2hhcnN0cmluZ3NMZW47IGdseXBoSWQrKykgewogICAgICAgIGNvbnN0IGNoYXJDb2RlID0gcHJvcGVydGllcy5jTWFwLmNoYXJDb2RlT2YoZ2x5cGhJZCk7CiAgICAgICAgY2hhckNvZGVUb0dseXBoSWRbY2hhckNvZGVdID0gZ2x5cGhJZCArIDE7CiAgICAgIH0KICAgICAgcmV0dXJuIGNoYXJDb2RlVG9HbHlwaElkOwogICAgfQogICAgY29uc3QgZ2x5cGhOYW1lcyA9IFsiLm5vdGRlZiJdOwogICAgbGV0IGJ1aWx0SW5FbmNvZGluZywgZ2x5cGhJZDsKICAgIGZvciAoZ2x5cGhJZCA9IDA7IGdseXBoSWQgPCBjaGFyc3RyaW5ncy5sZW5ndGg7IGdseXBoSWQrKykgewogICAgICBnbHlwaE5hbWVzLnB1c2goY2hhcnN0cmluZ3NbZ2x5cGhJZF0uZ2x5cGhOYW1lKTsKICAgIH0KICAgIGNvbnN0IGVuY29kaW5nID0gcHJvcGVydGllcy5idWlsdEluRW5jb2Rpbmc7CiAgICBpZiAoZW5jb2RpbmcpIHsKICAgICAgYnVpbHRJbkVuY29kaW5nID0gT2JqZWN0LmNyZWF0ZShudWxsKTsKICAgICAgZm9yIChjb25zdCBjaGFyQ29kZSBpbiBlbmNvZGluZykgewogICAgICAgIGdseXBoSWQgPSBnbHlwaE5hbWVzLmluZGV4T2YoZW5jb2RpbmdbY2hhckNvZGVdKTsKICAgICAgICBpZiAoZ2x5cGhJZCA+PSAwKSB7CiAgICAgICAgICBidWlsdEluRW5jb2RpbmdbY2hhckNvZGVdID0gZ2x5cGhJZDsKICAgICAgICB9CiAgICAgIH0KICAgIH0KICAgIHJldHVybiAoMCwgX2ZvbnRzX3V0aWxzLnR5cGUxRm9udEdseXBoTWFwcGluZykocHJvcGVydGllcywgYnVpbHRJbkVuY29kaW5nLCBnbHlwaE5hbWVzKTsKICB9CiAgaGFzR2x5cGhJZChpZCkgewogICAgaWYgKGlkIDwgMCB8fCBpZCA+PSB0aGlzLm51bUdseXBocykgewogICAgICByZXR1cm4gZmFsc2U7CiAgICB9CiAgICBpZiAoaWQgPT09IDApIHsKICAgICAgcmV0dXJuIHRydWU7CiAgICB9CiAgICBjb25zdCBnbHlwaCA9IHRoaXMuY2hhcnN0cmluZ3NbaWQgLSAxXTsKICAgIHJldHVybiBnbHlwaC5jaGFyc3RyaW5nLmxlbmd0aCA+IDA7CiAgfQogIGdldFNlYWNzKGNoYXJzdHJpbmdzKSB7CiAgICBjb25zdCBzZWFjTWFwID0gW107CiAgICBmb3IgKGxldCBpID0gMCwgaWkgPSBjaGFyc3RyaW5ncy5sZW5ndGg7IGkgPCBpaTsgaSsrKSB7CiAgICAgIGNvbnN0IGNoYXJzdHJpbmcgPSBjaGFyc3RyaW5nc1tpXTsKICAgICAgaWYgKGNoYXJzdHJpbmcuc2VhYykgewogICAgICAgIHNlYWNNYXBbaSArIDFdID0gY2hhcnN0cmluZy5zZWFjOwogICAgICB9CiAgICB9CiAgICByZXR1cm4gc2VhY01hcDsKICB9CiAgZ2V0VHlwZTJDaGFyc3RyaW5ncyh0eXBlMUNoYXJzdHJpbmdzKSB7CiAgICBjb25zdCB0eXBlMkNoYXJzdHJpbmdzID0gW107CiAgICBmb3IgKGNvbnN0IHR5cGUxQ2hhcnN0cmluZyBvZiB0eXBlMUNoYXJzdHJpbmdzKSB7CiAgICAgIHR5cGUyQ2hhcnN0cmluZ3MucHVzaCh0eXBlMUNoYXJzdHJpbmcuY2hhcnN0cmluZyk7CiAgICB9CiAgICByZXR1cm4gdHlwZTJDaGFyc3RyaW5nczsKICB9CiAgZ2V0VHlwZTJTdWJycyh0eXBlMVN1YnJzKSB7CiAgICBsZXQgYmlhcyA9IDA7CiAgICBjb25zdCBjb3VudCA9IHR5cGUxU3VicnMubGVuZ3RoOwogICAgaWYgKGNvdW50IDwgMTEzMykgewogICAgICBiaWFzID0gMTA3OwogICAgfSBlbHNlIGlmIChjb3VudCA8IDMzNzY5KSB7CiAgICAgIGJpYXMgPSAxMTMxOwogICAgfSBlbHNlIHsKICAgICAgYmlhcyA9IDMyNzY4OwogICAgfQogICAgY29uc3QgdHlwZTJTdWJycyA9IFtdOwogICAgbGV0IGk7CiAgICBmb3IgKGkgPSAwOyBpIDwgYmlhczsgaSsrKSB7CiAgICAgIHR5cGUyU3VicnMucHVzaChbMHgwYl0pOwogICAgfQogICAgZm9yIChpID0gMDsgaSA8IGNvdW50OyBpKyspIHsKICAgICAgdHlwZTJTdWJycy5wdXNoKHR5cGUxU3VicnNbaV0pOwogICAgfQogICAgcmV0dXJuIHR5cGUyU3VicnM7CiAgfQogIHdyYXAobmFtZSwgZ2x5cGhzLCBjaGFyc3RyaW5ncywgc3VicnMsIHByb3BlcnRpZXMpIHsKICAgIGNvbnN0IGNmZiA9IG5ldyBfY2ZmX3BhcnNlci5DRkYoKTsKICAgIGNmZi5oZWFkZXIgPSBuZXcgX2NmZl9wYXJzZXIuQ0ZGSGVhZGVyKDEsIDAsIDQsIDQpOwogICAgY2ZmLm5hbWVzID0gW25hbWVdOwogICAgY29uc3QgdG9wRGljdCA9IG5ldyBfY2ZmX3BhcnNlci5DRkZUb3BEaWN0KCk7CiAgICB0b3BEaWN0LnNldEJ5TmFtZSgidmVyc2lvbiIsIDM5MSk7CiAgICB0b3BEaWN0LnNldEJ5TmFtZSgiTm90aWNlIiwgMzkyKTsKICAgIHRvcERpY3Quc2V0QnlOYW1lKCJGdWxsTmFtZSIsIDM5Myk7CiAgICB0b3BEaWN0LnNldEJ5TmFtZSgiRmFtaWx5TmFtZSIsIDM5NCk7CiAgICB0b3BEaWN0LnNldEJ5TmFtZSgiV2VpZ2h0IiwgMzk1KTsKICAgIHRvcERpY3Quc2V0QnlOYW1lKCJFbmNvZGluZyIsIG51bGwpOwogICAgdG9wRGljdC5zZXRCeU5hbWUoIkZvbnRNYXRyaXgiLCBwcm9wZXJ0aWVzLmZvbnRNYXRyaXgpOwogICAgdG9wRGljdC5zZXRCeU5hbWUoIkZvbnRCQm94IiwgcHJvcGVydGllcy5iYm94KTsKICAgIHRvcERpY3Quc2V0QnlOYW1lKCJjaGFyc2V0IiwgbnVsbCk7CiAgICB0b3BEaWN0LnNldEJ5TmFtZSgiQ2hhclN0cmluZ3MiLCBudWxsKTsKICAgIHRvcERpY3Quc2V0QnlOYW1lKCJQcml2YXRlIiwgbnVsbCk7CiAgICBjZmYudG9wRGljdCA9IHRvcERpY3Q7CiAgICBjb25zdCBzdHJpbmdzID0gbmV3IF9jZmZfcGFyc2VyLkNGRlN0cmluZ3MoKTsKICAgIHN0cmluZ3MuYWRkKCJWZXJzaW9uIDAuMTEiKTsKICAgIHN0cmluZ3MuYWRkKCJTZWUgb3JpZ2luYWwgbm90aWNlIik7CiAgICBzdHJpbmdzLmFkZChuYW1lKTsKICAgIHN0cmluZ3MuYWRkKG5hbWUpOwogICAgc3RyaW5ncy5hZGQoIk1lZGl1bSIpOwogICAgY2ZmLnN0cmluZ3MgPSBzdHJpbmdzOwogICAgY2ZmLmdsb2JhbFN1YnJJbmRleCA9IG5ldyBfY2ZmX3BhcnNlci5DRkZJbmRleCgpOwogICAgY29uc3QgY291bnQgPSBnbHlwaHMubGVuZ3RoOwogICAgY29uc3QgY2hhcnNldEFycmF5ID0gWyIubm90ZGVmIl07CiAgICBsZXQgaSwgaWk7CiAgICBmb3IgKGkgPSAwOyBpIDwgY291bnQ7IGkrKykgewogICAgICBjb25zdCBnbHlwaE5hbWUgPSBjaGFyc3RyaW5nc1tpXS5nbHlwaE5hbWU7CiAgICAgIGNvbnN0IGluZGV4ID0gX2NmZl9wYXJzZXIuQ0ZGU3RhbmRhcmRTdHJpbmdzLmluZGV4T2YoZ2x5cGhOYW1lKTsKICAgICAgaWYgKGluZGV4ID09PSAtMSkgewogICAgICAgIHN0cmluZ3MuYWRkKGdseXBoTmFtZSk7CiAgICAgIH0KICAgICAgY2hhcnNldEFycmF5LnB1c2goZ2x5cGhOYW1lKTsKICAgIH0KICAgIGNmZi5jaGFyc2V0ID0gbmV3IF9jZmZfcGFyc2VyLkNGRkNoYXJzZXQoZmFsc2UsIDAsIGNoYXJzZXRBcnJheSk7CiAgICBjb25zdCBjaGFyU3RyaW5nc0luZGV4ID0gbmV3IF9jZmZfcGFyc2VyLkNGRkluZGV4KCk7CiAgICBjaGFyU3RyaW5nc0luZGV4LmFkZChbMHg4YiwgMHgwZV0pOwogICAgZm9yIChpID0gMDsgaSA8IGNvdW50OyBpKyspIHsKICAgICAgY2hhclN0cmluZ3NJbmRleC5hZGQoZ2x5cGhzW2ldKTsKICAgIH0KICAgIGNmZi5jaGFyU3RyaW5ncyA9IGNoYXJTdHJpbmdzSW5kZXg7CiAgICBjb25zdCBwcml2YXRlRGljdCA9IG5ldyBfY2ZmX3BhcnNlci5DRkZQcml2YXRlRGljdCgpOwogICAgcHJpdmF0ZURpY3Quc2V0QnlOYW1lKCJTdWJycyIsIG51bGwpOwogICAgY29uc3QgZmllbGRzID0gWyJCbHVlVmFsdWVzIiwgIk90aGVyQmx1ZXMiLCAiRmFtaWx5Qmx1ZXMiLCAiRmFtaWx5T3RoZXJCbHVlcyIsICJTdGVtU25hcEgiLCAiU3RlbVNuYXBWIiwgIkJsdWVTaGlmdCIsICJCbHVlRnV6eiIsICJCbHVlU2NhbGUiLCAiTGFuZ3VhZ2VHcm91cCIsICJFeHBhbnNpb25GYWN0b3IiLCAiRm9yY2VCb2xkIiwgIlN0ZEhXIiwgIlN0ZFZXIl07CiAgICBmb3IgKGkgPSAwLCBpaSA9IGZpZWxkcy5sZW5ndGg7IGkgPCBpaTsgaSsrKSB7CiAgICAgIGNvbnN0IGZpZWxkID0gZmllbGRzW2ldOwogICAgICBpZiAoIShmaWVsZCBpbiBwcm9wZXJ0aWVzLnByaXZhdGVEYXRhKSkgewogICAgICAgIGNvbnRpbnVlOwogICAgICB9CiAgICAgIGNvbnN0IHZhbHVlID0gcHJvcGVydGllcy5wcml2YXRlRGF0YVtmaWVsZF07CiAgICAgIGlmIChBcnJheS5pc0FycmF5KHZhbHVlKSkgewogICAgICAgIGZvciAobGV0IGogPSB2YWx1ZS5sZW5ndGggLSAxOyBqID4gMDsgai0tKSB7CiAgICAgICAgICB2YWx1ZVtqXSAtPSB2YWx1ZVtqIC0gMV07CiAgICAgICAgfQogICAgICB9CiAgICAgIHByaXZhdGVEaWN0LnNldEJ5TmFtZShmaWVsZCwgdmFsdWUpOwogICAgfQogICAgY2ZmLnRvcERpY3QucHJpdmF0ZURpY3QgPSBwcml2YXRlRGljdDsKICAgIGNvbnN0IHN1YnJJbmRleCA9IG5ldyBfY2ZmX3BhcnNlci5DRkZJbmRleCgpOwogICAgZm9yIChpID0gMCwgaWkgPSBzdWJycy5sZW5ndGg7IGkgPCBpaTsgaSsrKSB7CiAgICAgIHN1YnJJbmRleC5hZGQoc3VicnNbaV0pOwogICAgfQogICAgcHJpdmF0ZURpY3Quc3VicnNJbmRleCA9IHN1YnJJbmRleDsKICAgIGNvbnN0IGNvbXBpbGVyID0gbmV3IF9jZmZfcGFyc2VyLkNGRkNvbXBpbGVyKGNmZik7CiAgICByZXR1cm4gY29tcGlsZXIuY29tcGlsZSgpOwogIH0KfQpleHBvcnRzLlR5cGUxRm9udCA9IFR5cGUxRm9udDsKCi8qKiovIH0pLAovKiA0OSAqLwovKioqLyAoKF9fdW51c2VkX3dlYnBhY2tfbW9kdWxlLCBleHBvcnRzLCBfX3dfcGRmanNfcmVxdWlyZV9fKSA9PiB7CgoKCk9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCAiX19lc01vZHVsZSIsICh7CiAgdmFsdWU6IHRydWUKfSkpOwpleHBvcnRzLlR5cGUxUGFyc2VyID0gdm9pZCAwOwp2YXIgX2VuY29kaW5ncyA9IF9fd19wZGZqc19yZXF1aXJlX18oMzcpOwp2YXIgX2NvcmVfdXRpbHMgPSBfX3dfcGRmanNfcmVxdWlyZV9fKDMpOwp2YXIgX3N0cmVhbSA9IF9fd19wZGZqc19yZXF1aXJlX18oOCk7CnZhciBfdXRpbCA9IF9fd19wZGZqc19yZXF1aXJlX18oMik7CmNvbnN0IEhJTlRJTkdfRU5BQkxFRCA9IGZhbHNlOwpjb25zdCBDT01NQU5EX01BUCA9IHsKICBoc3RlbTogWzFdLAogIHZzdGVtOiBbM10sCiAgdm1vdmV0bzogWzRdLAogIHJsaW5ldG86IFs1XSwKICBobGluZXRvOiBbNl0sCiAgdmxpbmV0bzogWzddLAogIHJyY3VydmV0bzogWzhdLAogIGNhbGxzdWJyOiBbMTBdLAogIGZsZXg6IFsxMiwgMzVdLAogIGRyb3A6IFsxMiwgMThdLAogIGVuZGNoYXI6IFsxNF0sCiAgcm1vdmV0bzogWzIxXSwKICBobW92ZXRvOiBbMjJdLAogIHZoY3VydmV0bzogWzMwXSwKICBodmN1cnZldG86IFszMV0KfTsKY2xhc3MgVHlwZTFDaGFyU3RyaW5nIHsKICBjb25zdHJ1Y3RvcigpIHsKICAgIHRoaXMud2lkdGggPSAwOwogICAgdGhpcy5sc2IgPSAwOwogICAgdGhpcy5mbGV4aW5nID0gZmFsc2U7CiAgICB0aGlzLm91dHB1dCA9IFtdOwogICAgdGhpcy5zdGFjayA9IFtdOwogIH0KICBjb252ZXJ0KGVuY29kZWQsIHN1YnJzLCBzZWFjQW5hbHlzaXNFbmFibGVkKSB7CiAgICBjb25zdCBjb3VudCA9IGVuY29kZWQubGVuZ3RoOwogICAgbGV0IGVycm9yID0gZmFsc2U7CiAgICBsZXQgd3gsIHNieCwgc3Vick51bWJlcjsKICAgIGZvciAobGV0IGkgPSAwOyBpIDwgY291bnQ7IGkrKykgewogICAgICBsZXQgdmFsdWUgPSBlbmNvZGVkW2ldOwogICAgICBpZiAodmFsdWUgPCAzMikgewogICAgICAgIGlmICh2YWx1ZSA9PT0gMTIpIHsKICAgICAgICAgIHZhbHVlID0gKHZhbHVlIDw8IDgpICsgZW5jb2RlZFsrK2ldOwogICAgICAgIH0KICAgICAgICBzd2l0Y2ggKHZhbHVlKSB7CiAgICAgICAgICBjYXNlIDE6CiAgICAgICAgICAgIGlmICghSElOVElOR19FTkFCTEVEKSB7CiAgICAgICAgICAgICAgdGhpcy5zdGFjayA9IFtdOwogICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGVycm9yID0gdGhpcy5leGVjdXRlQ29tbWFuZCgyLCBDT01NQU5EX01BUC5oc3RlbSk7CiAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgY2FzZSAzOgogICAgICAgICAgICBpZiAoIUhJTlRJTkdfRU5BQkxFRCkgewogICAgICAgICAgICAgIHRoaXMuc3RhY2sgPSBbXTsKICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgfQogICAgICAgICAgICBlcnJvciA9IHRoaXMuZXhlY3V0ZUNvbW1hbmQoMiwgQ09NTUFORF9NQVAudnN0ZW0pOwogICAgICAgICAgICBicmVhazsKICAgICAgICAgIGNhc2UgNDoKICAgICAgICAgICAgaWYgKHRoaXMuZmxleGluZykgewogICAgICAgICAgICAgIGlmICh0aGlzLnN0YWNrLmxlbmd0aCA8IDEpIHsKICAgICAgICAgICAgICAgIGVycm9yID0gdHJ1ZTsKICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgICBjb25zdCBkeSA9IHRoaXMuc3RhY2sucG9wKCk7CiAgICAgICAgICAgICAgdGhpcy5zdGFjay5wdXNoKDAsIGR5KTsKICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgfQogICAgICAgICAgICBlcnJvciA9IHRoaXMuZXhlY3V0ZUNvbW1hbmQoMSwgQ09NTUFORF9NQVAudm1vdmV0byk7CiAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgY2FzZSA1OgogICAgICAgICAgICBlcnJvciA9IHRoaXMuZXhlY3V0ZUNvbW1hbmQoMiwgQ09NTUFORF9NQVAucmxpbmV0byk7CiAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgY2FzZSA2OgogICAgICAgICAgICBlcnJvciA9IHRoaXMuZXhlY3V0ZUNvbW1hbmQoMSwgQ09NTUFORF9NQVAuaGxpbmV0byk7CiAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgY2FzZSA3OgogICAgICAgICAgICBlcnJvciA9IHRoaXMuZXhlY3V0ZUNvbW1hbmQoMSwgQ09NTUFORF9NQVAudmxpbmV0byk7CiAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgY2FzZSA4OgogICAgICAgICAgICBlcnJvciA9IHRoaXMuZXhlY3V0ZUNvbW1hbmQoNiwgQ09NTUFORF9NQVAucnJjdXJ2ZXRvKTsKICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICBjYXNlIDk6CiAgICAgICAgICAgIHRoaXMuc3RhY2sgPSBbXTsKICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICBjYXNlIDEwOgogICAgICAgICAgICBpZiAodGhpcy5zdGFjay5sZW5ndGggPCAxKSB7CiAgICAgICAgICAgICAgZXJyb3IgPSB0cnVlOwogICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICB9CiAgICAgICAgICAgIHN1YnJOdW1iZXIgPSB0aGlzLnN0YWNrLnBvcCgpOwogICAgICAgICAgICBpZiAoIXN1YnJzW3N1YnJOdW1iZXJdKSB7CiAgICAgICAgICAgICAgZXJyb3IgPSB0cnVlOwogICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGVycm9yID0gdGhpcy5jb252ZXJ0KHN1YnJzW3N1YnJOdW1iZXJdLCBzdWJycywgc2VhY0FuYWx5c2lzRW5hYmxlZCk7CiAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgY2FzZSAxMToKICAgICAgICAgICAgcmV0dXJuIGVycm9yOwogICAgICAgICAgY2FzZSAxMzoKICAgICAgICAgICAgaWYgKHRoaXMuc3RhY2subGVuZ3RoIDwgMikgewogICAgICAgICAgICAgIGVycm9yID0gdHJ1ZTsKICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgfQogICAgICAgICAgICB3eCA9IHRoaXMuc3RhY2sucG9wKCk7CiAgICAgICAgICAgIHNieCA9IHRoaXMuc3RhY2sucG9wKCk7CiAgICAgICAgICAgIHRoaXMubHNiID0gc2J4OwogICAgICAgICAgICB0aGlzLndpZHRoID0gd3g7CiAgICAgICAgICAgIHRoaXMuc3RhY2sucHVzaCh3eCwgc2J4KTsKICAgICAgICAgICAgZXJyb3IgPSB0aGlzLmV4ZWN1dGVDb21tYW5kKDIsIENPTU1BTkRfTUFQLmhtb3ZldG8pOwogICAgICAgICAgICBicmVhazsKICAgICAgICAgIGNhc2UgMTQ6CiAgICAgICAgICAgIHRoaXMub3V0cHV0LnB1c2goQ09NTUFORF9NQVAuZW5kY2hhclswXSk7CiAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgY2FzZSAyMToKICAgICAgICAgICAgaWYgKHRoaXMuZmxleGluZykgewogICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGVycm9yID0gdGhpcy5leGVjdXRlQ29tbWFuZCgyLCBDT01NQU5EX01BUC5ybW92ZXRvKTsKICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICBjYXNlIDIyOgogICAgICAgICAgICBpZiAodGhpcy5mbGV4aW5nKSB7CiAgICAgICAgICAgICAgdGhpcy5zdGFjay5wdXNoKDApOwogICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGVycm9yID0gdGhpcy5leGVjdXRlQ29tbWFuZCgxLCBDT01NQU5EX01BUC5obW92ZXRvKTsKICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICBjYXNlIDMwOgogICAgICAgICAgICBlcnJvciA9IHRoaXMuZXhlY3V0ZUNvbW1hbmQoNCwgQ09NTUFORF9NQVAudmhjdXJ2ZXRvKTsKICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICBjYXNlIDMxOgogICAgICAgICAgICBlcnJvciA9IHRoaXMuZXhlY3V0ZUNvbW1hbmQoNCwgQ09NTUFORF9NQVAuaHZjdXJ2ZXRvKTsKICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICBjYXNlICgxMiA8PCA4KSArIDA6CiAgICAgICAgICAgIHRoaXMuc3RhY2sgPSBbXTsKICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICBjYXNlICgxMiA8PCA4KSArIDE6CiAgICAgICAgICAgIGlmICghSElOVElOR19FTkFCTEVEKSB7CiAgICAgICAgICAgICAgdGhpcy5zdGFjayA9IFtdOwogICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGVycm9yID0gdGhpcy5leGVjdXRlQ29tbWFuZCgyLCBDT01NQU5EX01BUC52c3RlbSk7CiAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgY2FzZSAoMTIgPDwgOCkgKyAyOgogICAgICAgICAgICBpZiAoIUhJTlRJTkdfRU5BQkxFRCkgewogICAgICAgICAgICAgIHRoaXMuc3RhY2sgPSBbXTsKICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgfQogICAgICAgICAgICBlcnJvciA9IHRoaXMuZXhlY3V0ZUNvbW1hbmQoMiwgQ09NTUFORF9NQVAuaHN0ZW0pOwogICAgICAgICAgICBicmVhazsKICAgICAgICAgIGNhc2UgKDEyIDw8IDgpICsgNjoKICAgICAgICAgICAgaWYgKHNlYWNBbmFseXNpc0VuYWJsZWQpIHsKICAgICAgICAgICAgICBjb25zdCBhc2IgPSB0aGlzLnN0YWNrLmF0KC01KTsKICAgICAgICAgICAgICB0aGlzLnNlYWMgPSB0aGlzLnN0YWNrLnNwbGljZSgtNCwgNCk7CiAgICAgICAgICAgICAgdGhpcy5zZWFjWzBdICs9IHRoaXMubHNiIC0gYXNiOwogICAgICAgICAgICAgIGVycm9yID0gdGhpcy5leGVjdXRlQ29tbWFuZCgwLCBDT01NQU5EX01BUC5lbmRjaGFyKTsKICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICBlcnJvciA9IHRoaXMuZXhlY3V0ZUNvbW1hbmQoNCwgQ09NTUFORF9NQVAuZW5kY2hhcik7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICBjYXNlICgxMiA8PCA4KSArIDc6CiAgICAgICAgICAgIGlmICh0aGlzLnN0YWNrLmxlbmd0aCA8IDQpIHsKICAgICAgICAgICAgICBlcnJvciA9IHRydWU7CiAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgdGhpcy5zdGFjay5wb3AoKTsKICAgICAgICAgICAgd3ggPSB0aGlzLnN0YWNrLnBvcCgpOwogICAgICAgICAgICBjb25zdCBzYnkgPSB0aGlzLnN0YWNrLnBvcCgpOwogICAgICAgICAgICBzYnggPSB0aGlzLnN0YWNrLnBvcCgpOwogICAgICAgICAgICB0aGlzLmxzYiA9IHNieDsKICAgICAgICAgICAgdGhpcy53aWR0aCA9IHd4OwogICAgICAgICAgICB0aGlzLnN0YWNrLnB1c2god3gsIHNieCwgc2J5KTsKICAgICAgICAgICAgZXJyb3IgPSB0aGlzLmV4ZWN1dGVDb21tYW5kKDMsIENPTU1BTkRfTUFQLnJtb3ZldG8pOwogICAgICAgICAgICBicmVhazsKICAgICAgICAgIGNhc2UgKDEyIDw8IDgpICsgMTI6CiAgICAgICAgICAgIGlmICh0aGlzLnN0YWNrLmxlbmd0aCA8IDIpIHsKICAgICAgICAgICAgICBlcnJvciA9IHRydWU7CiAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgY29uc3QgbnVtMiA9IHRoaXMuc3RhY2sucG9wKCk7CiAgICAgICAgICAgIGNvbnN0IG51bTEgPSB0aGlzLnN0YWNrLnBvcCgpOwogICAgICAgICAgICB0aGlzLnN0YWNrLnB1c2gobnVtMSAvIG51bTIpOwogICAgICAgICAgICBicmVhazsKICAgICAgICAgIGNhc2UgKDEyIDw8IDgpICsgMTY6CiAgICAgICAgICAgIGlmICh0aGlzLnN0YWNrLmxlbmd0aCA8IDIpIHsKICAgICAgICAgICAgICBlcnJvciA9IHRydWU7CiAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgc3Vick51bWJlciA9IHRoaXMuc3RhY2sucG9wKCk7CiAgICAgICAgICAgIGNvbnN0IG51bUFyZ3MgPSB0aGlzLnN0YWNrLnBvcCgpOwogICAgICAgICAgICBpZiAoc3Vick51bWJlciA9PT0gMCAmJiBudW1BcmdzID09PSAzKSB7CiAgICAgICAgICAgICAgY29uc3QgZmxleEFyZ3MgPSB0aGlzLnN0YWNrLnNwbGljZSgtMTcsIDE3KTsKICAgICAgICAgICAgICB0aGlzLnN0YWNrLnB1c2goZmxleEFyZ3NbMl0gKyBmbGV4QXJnc1swXSwgZmxleEFyZ3NbM10gKyBmbGV4QXJnc1sxXSwgZmxleEFyZ3NbNF0sIGZsZXhBcmdzWzVdLCBmbGV4QXJnc1s2XSwgZmxleEFyZ3NbN10sIGZsZXhBcmdzWzhdLCBmbGV4QXJnc1s5XSwgZmxleEFyZ3NbMTBdLCBmbGV4QXJnc1sxMV0sIGZsZXhBcmdzWzEyXSwgZmxleEFyZ3NbMTNdLCBmbGV4QXJnc1sxNF0pOwogICAgICAgICAgICAgIGVycm9yID0gdGhpcy5leGVjdXRlQ29tbWFuZCgxMywgQ09NTUFORF9NQVAuZmxleCwgdHJ1ZSk7CiAgICAgICAgICAgICAgdGhpcy5mbGV4aW5nID0gZmFsc2U7CiAgICAgICAgICAgICAgdGhpcy5zdGFjay5wdXNoKGZsZXhBcmdzWzE1XSwgZmxleEFyZ3NbMTZdKTsKICAgICAgICAgICAgfSBlbHNlIGlmIChzdWJyTnVtYmVyID09PSAxICYmIG51bUFyZ3MgPT09IDApIHsKICAgICAgICAgICAgICB0aGlzLmZsZXhpbmcgPSB0cnVlOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgY2FzZSAoMTIgPDwgOCkgKyAxNzoKICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICBjYXNlICgxMiA8PCA4KSArIDMzOgogICAgICAgICAgICB0aGlzLnN0YWNrID0gW107CiAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgZGVmYXVsdDoKICAgICAgICAgICAgKDAsIF91dGlsLndhcm4pKCdVbmtub3duIHR5cGUgMSBjaGFyc3RyaW5nIGNvbW1hbmQgb2YgIicgKyB2YWx1ZSArICciJyk7CiAgICAgICAgICAgIGJyZWFrOwogICAgICAgIH0KICAgICAgICBpZiAoZXJyb3IpIHsKICAgICAgICAgIGJyZWFrOwogICAgICAgIH0KICAgICAgICBjb250aW51ZTsKICAgICAgfSBlbHNlIGlmICh2YWx1ZSA8PSAyNDYpIHsKICAgICAgICB2YWx1ZSAtPSAxMzk7CiAgICAgIH0gZWxzZSBpZiAodmFsdWUgPD0gMjUwKSB7CiAgICAgICAgdmFsdWUgPSAodmFsdWUgLSAyNDcpICogMjU2ICsgZW5jb2RlZFsrK2ldICsgMTA4OwogICAgICB9IGVsc2UgaWYgKHZhbHVlIDw9IDI1NCkgewogICAgICAgIHZhbHVlID0gLSgodmFsdWUgLSAyNTEpICogMjU2KSAtIGVuY29kZWRbKytpXSAtIDEwODsKICAgICAgfSBlbHNlIHsKICAgICAgICB2YWx1ZSA9IChlbmNvZGVkWysraV0gJiAweGZmKSA8PCAyNCB8IChlbmNvZGVkWysraV0gJiAweGZmKSA8PCAxNiB8IChlbmNvZGVkWysraV0gJiAweGZmKSA8PCA4IHwgKGVuY29kZWRbKytpXSAmIDB4ZmYpIDw8IDA7CiAgICAgIH0KICAgICAgdGhpcy5zdGFjay5wdXNoKHZhbHVlKTsKICAgIH0KICAgIHJldHVybiBlcnJvcjsKICB9CiAgZXhlY3V0ZUNvbW1hbmQoaG93TWFueUFyZ3MsIGNvbW1hbmQsIGtlZXBTdGFjaykgewogICAgY29uc3Qgc3RhY2tMZW5ndGggPSB0aGlzLnN0YWNrLmxlbmd0aDsKICAgIGlmIChob3dNYW55QXJncyA+IHN0YWNrTGVuZ3RoKSB7CiAgICAgIHJldHVybiB0cnVlOwogICAgfQogICAgY29uc3Qgc3RhcnQgPSBzdGFja0xlbmd0aCAtIGhvd01hbnlBcmdzOwogICAgZm9yIChsZXQgaSA9IHN0YXJ0OyBpIDwgc3RhY2tMZW5ndGg7IGkrKykgewogICAgICBsZXQgdmFsdWUgPSB0aGlzLnN0YWNrW2ldOwogICAgICBpZiAoTnVtYmVyLmlzSW50ZWdlcih2YWx1ZSkpIHsKICAgICAgICB0aGlzLm91dHB1dC5wdXNoKDI4LCB2YWx1ZSA+PiA4ICYgMHhmZiwgdmFsdWUgJiAweGZmKTsKICAgICAgfSBlbHNlIHsKICAgICAgICB2YWx1ZSA9IDY1NTM2ICogdmFsdWUgfCAwOwogICAgICAgIHRoaXMub3V0cHV0LnB1c2goMjU1LCB2YWx1ZSA+PiAyNCAmIDB4ZmYsIHZhbHVlID4+IDE2ICYgMHhmZiwgdmFsdWUgPj4gOCAmIDB4ZmYsIHZhbHVlICYgMHhmZik7CiAgICAgIH0KICAgIH0KICAgIHRoaXMub3V0cHV0LnB1c2goLi4uY29tbWFuZCk7CiAgICBpZiAoa2VlcFN0YWNrKSB7CiAgICAgIHRoaXMuc3RhY2suc3BsaWNlKHN0YXJ0LCBob3dNYW55QXJncyk7CiAgICB9IGVsc2UgewogICAgICB0aGlzLnN0YWNrLmxlbmd0aCA9IDA7CiAgICB9CiAgICByZXR1cm4gZmFsc2U7CiAgfQp9CmNvbnN0IEVFWEVDX0VOQ1JZUFRfS0VZID0gNTU2NjU7CmNvbnN0IENIQVJfU1RSU19FTkNSWVBUX0tFWSA9IDQzMzA7CmZ1bmN0aW9uIGlzSGV4RGlnaXQoY29kZSkgewogIHJldHVybiBjb2RlID49IDQ4ICYmIGNvZGUgPD0gNTcgfHwgY29kZSA+PSA2NSAmJiBjb2RlIDw9IDcwIHx8IGNvZGUgPj0gOTcgJiYgY29kZSA8PSAxMDI7Cn0KZnVuY3Rpb24gZGVjcnlwdChkYXRhLCBrZXksIGRpc2NhcmROdW1iZXIpIHsKICBpZiAoZGlzY2FyZE51bWJlciA+PSBkYXRhLmxlbmd0aCkgewogICAgcmV0dXJuIG5ldyBVaW50OEFycmF5KDApOwogIH0KICBjb25zdCBjMSA9IDUyODQ1LAogICAgYzIgPSAyMjcxOTsKICBsZXQgciA9IGtleSB8IDAsCiAgICBpLAogICAgajsKICBmb3IgKGkgPSAwOyBpIDwgZGlzY2FyZE51bWJlcjsgaSsrKSB7CiAgICByID0gKGRhdGFbaV0gKyByKSAqIGMxICsgYzIgJiAoMSA8PCAxNikgLSAxOwogIH0KICBjb25zdCBjb3VudCA9IGRhdGEubGVuZ3RoIC0gZGlzY2FyZE51bWJlcjsKICBjb25zdCBkZWNyeXB0ZWQgPSBuZXcgVWludDhBcnJheShjb3VudCk7CiAgZm9yIChpID0gZGlzY2FyZE51bWJlciwgaiA9IDA7IGogPCBjb3VudDsgaSsrLCBqKyspIHsKICAgIGNvbnN0IHZhbHVlID0gZGF0YVtpXTsKICAgIGRlY3J5cHRlZFtqXSA9IHZhbHVlIF4gciA+PiA4OwogICAgciA9ICh2YWx1ZSArIHIpICogYzEgKyBjMiAmICgxIDw8IDE2KSAtIDE7CiAgfQogIHJldHVybiBkZWNyeXB0ZWQ7Cn0KZnVuY3Rpb24gZGVjcnlwdEFzY2lpKGRhdGEsIGtleSwgZGlzY2FyZE51bWJlcikgewogIGNvbnN0IGMxID0gNTI4NDUsCiAgICBjMiA9IDIyNzE5OwogIGxldCByID0ga2V5IHwgMDsKICBjb25zdCBjb3VudCA9IGRhdGEubGVuZ3RoLAogICAgbWF5YmVMZW5ndGggPSBjb3VudCA+Pj4gMTsKICBjb25zdCBkZWNyeXB0ZWQgPSBuZXcgVWludDhBcnJheShtYXliZUxlbmd0aCk7CiAgbGV0IGksIGo7CiAgZm9yIChpID0gMCwgaiA9IDA7IGkgPCBjb3VudDsgaSsrKSB7CiAgICBjb25zdCBkaWdpdDEgPSBkYXRhW2ldOwogICAgaWYgKCFpc0hleERpZ2l0KGRpZ2l0MSkpIHsKICAgICAgY29udGludWU7CiAgICB9CiAgICBpKys7CiAgICBsZXQgZGlnaXQyOwogICAgd2hpbGUgKGkgPCBjb3VudCAmJiAhaXNIZXhEaWdpdChkaWdpdDIgPSBkYXRhW2ldKSkgewogICAgICBpKys7CiAgICB9CiAgICBpZiAoaSA8IGNvdW50KSB7CiAgICAgIGNvbnN0IHZhbHVlID0gcGFyc2VJbnQoU3RyaW5nLmZyb21DaGFyQ29kZShkaWdpdDEsIGRpZ2l0MiksIDE2KTsKICAgICAgZGVjcnlwdGVkW2orK10gPSB2YWx1ZSBeIHIgPj4gODsKICAgICAgciA9ICh2YWx1ZSArIHIpICogYzEgKyBjMiAmICgxIDw8IDE2KSAtIDE7CiAgICB9CiAgfQogIHJldHVybiBkZWNyeXB0ZWQuc2xpY2UoZGlzY2FyZE51bWJlciwgaik7Cn0KZnVuY3Rpb24gaXNTcGVjaWFsKGMpIHsKICByZXR1cm4gYyA9PT0gMHgyZiB8fCBjID09PSAweDViIHx8IGMgPT09IDB4NWQgfHwgYyA9PT0gMHg3YiB8fCBjID09PSAweDdkIHx8IGMgPT09IDB4MjggfHwgYyA9PT0gMHgyOTsKfQpjbGFzcyBUeXBlMVBhcnNlciB7CiAgY29uc3RydWN0b3Ioc3RyZWFtLCBlbmNyeXB0ZWQsIHNlYWNBbmFseXNpc0VuYWJsZWQpIHsKICAgIGlmIChlbmNyeXB0ZWQpIHsKICAgICAgY29uc3QgZGF0YSA9IHN0cmVhbS5nZXRCeXRlcygpOwogICAgICBjb25zdCBpc0JpbmFyeSA9ICEoKGlzSGV4RGlnaXQoZGF0YVswXSkgfHwgKDAsIF9jb3JlX3V0aWxzLmlzV2hpdGVTcGFjZSkoZGF0YVswXSkpICYmIGlzSGV4RGlnaXQoZGF0YVsxXSkgJiYgaXNIZXhEaWdpdChkYXRhWzJdKSAmJiBpc0hleERpZ2l0KGRhdGFbM10pICYmIGlzSGV4RGlnaXQoZGF0YVs0XSkgJiYgaXNIZXhEaWdpdChkYXRhWzVdKSAmJiBpc0hleERpZ2l0KGRhdGFbNl0pICYmIGlzSGV4RGlnaXQoZGF0YVs3XSkpOwogICAgICBzdHJlYW0gPSBuZXcgX3N0cmVhbS5TdHJlYW0oaXNCaW5hcnkgPyBkZWNyeXB0KGRhdGEsIEVFWEVDX0VOQ1JZUFRfS0VZLCA0KSA6IGRlY3J5cHRBc2NpaShkYXRhLCBFRVhFQ19FTkNSWVBUX0tFWSwgNCkpOwogICAgfQogICAgdGhpcy5zZWFjQW5hbHlzaXNFbmFibGVkID0gISFzZWFjQW5hbHlzaXNFbmFibGVkOwogICAgdGhpcy5zdHJlYW0gPSBzdHJlYW07CiAgICB0aGlzLm5leHRDaGFyKCk7CiAgfQogIHJlYWROdW1iZXJBcnJheSgpIHsKICAgIHRoaXMuZ2V0VG9rZW4oKTsKICAgIGNvbnN0IGFycmF5ID0gW107CiAgICB3aGlsZSAodHJ1ZSkgewogICAgICBjb25zdCB0b2tlbiA9IHRoaXMuZ2V0VG9rZW4oKTsKICAgICAgaWYgKHRva2VuID09PSBudWxsIHx8IHRva2VuID09PSAiXSIgfHwgdG9rZW4gPT09ICJ9IikgewogICAgICAgIGJyZWFrOwogICAgICB9CiAgICAgIGFycmF5LnB1c2gocGFyc2VGbG9hdCh0b2tlbiB8fCAwKSk7CiAgICB9CiAgICByZXR1cm4gYXJyYXk7CiAgfQogIHJlYWROdW1iZXIoKSB7CiAgICBjb25zdCB0b2tlbiA9IHRoaXMuZ2V0VG9rZW4oKTsKICAgIHJldHVybiBwYXJzZUZsb2F0KHRva2VuIHx8IDApOwogIH0KICByZWFkSW50KCkgewogICAgY29uc3QgdG9rZW4gPSB0aGlzLmdldFRva2VuKCk7CiAgICByZXR1cm4gcGFyc2VJbnQodG9rZW4gfHwgMCwgMTApIHwgMDsKICB9CiAgcmVhZEJvb2xlYW4oKSB7CiAgICBjb25zdCB0b2tlbiA9IHRoaXMuZ2V0VG9rZW4oKTsKICAgIHJldHVybiB0b2tlbiA9PT0gInRydWUiID8gMSA6IDA7CiAgfQogIG5leHRDaGFyKCkgewogICAgcmV0dXJuIHRoaXMuY3VycmVudENoYXIgPSB0aGlzLnN0cmVhbS5nZXRCeXRlKCk7CiAgfQogIHByZXZDaGFyKCkgewogICAgdGhpcy5zdHJlYW0uc2tpcCgtMik7CiAgICByZXR1cm4gdGhpcy5jdXJyZW50Q2hhciA9IHRoaXMuc3RyZWFtLmdldEJ5dGUoKTsKICB9CiAgZ2V0VG9rZW4oKSB7CiAgICBsZXQgY29tbWVudCA9IGZhbHNlOwogICAgbGV0IGNoID0gdGhpcy5jdXJyZW50Q2hhcjsKICAgIHdoaWxlICh0cnVlKSB7CiAgICAgIGlmIChjaCA9PT0gLTEpIHsKICAgICAgICByZXR1cm4gbnVsbDsKICAgICAgfQogICAgICBpZiAoY29tbWVudCkgewogICAgICAgIGlmIChjaCA9PT0gMHgwYSB8fCBjaCA9PT0gMHgwZCkgewogICAgICAgICAgY29tbWVudCA9IGZhbHNlOwogICAgICAgIH0KICAgICAgfSBlbHNlIGlmIChjaCA9PT0gMHgyNSkgewogICAgICAgIGNvbW1lbnQgPSB0cnVlOwogICAgICB9IGVsc2UgaWYgKCEoMCwgX2NvcmVfdXRpbHMuaXNXaGl0ZVNwYWNlKShjaCkpIHsKICAgICAgICBicmVhazsKICAgICAgfQogICAgICBjaCA9IHRoaXMubmV4dENoYXIoKTsKICAgIH0KICAgIGlmIChpc1NwZWNpYWwoY2gpKSB7CiAgICAgIHRoaXMubmV4dENoYXIoKTsKICAgICAgcmV0dXJuIFN0cmluZy5mcm9tQ2hhckNvZGUoY2gpOwogICAgfQogICAgbGV0IHRva2VuID0gIiI7CiAgICBkbyB7CiAgICAgIHRva2VuICs9IFN0cmluZy5mcm9tQ2hhckNvZGUoY2gpOwogICAgICBjaCA9IHRoaXMubmV4dENoYXIoKTsKICAgIH0gd2hpbGUgKGNoID49IDAgJiYgISgwLCBfY29yZV91dGlscy5pc1doaXRlU3BhY2UpKGNoKSAmJiAhaXNTcGVjaWFsKGNoKSk7CiAgICByZXR1cm4gdG9rZW47CiAgfQogIHJlYWRDaGFyU3RyaW5ncyhieXRlcywgbGVuSVYpIHsKICAgIGlmIChsZW5JViA9PT0gLTEpIHsKICAgICAgcmV0dXJuIGJ5dGVzOwogICAgfQogICAgcmV0dXJuIGRlY3J5cHQoYnl0ZXMsIENIQVJfU1RSU19FTkNSWVBUX0tFWSwgbGVuSVYpOwogIH0KICBleHRyYWN0Rm9udFByb2dyYW0ocHJvcGVydGllcykgewogICAgY29uc3Qgc3RyZWFtID0gdGhpcy5zdHJlYW07CiAgICBjb25zdCBzdWJycyA9IFtdLAogICAgICBjaGFyc3RyaW5ncyA9IFtdOwogICAgY29uc3QgcHJpdmF0ZURhdGEgPSBPYmplY3QuY3JlYXRlKG51bGwpOwogICAgcHJpdmF0ZURhdGEubGVuSVYgPSA0OwogICAgY29uc3QgcHJvZ3JhbSA9IHsKICAgICAgc3VicnM6IFtdLAogICAgICBjaGFyc3RyaW5nczogW10sCiAgICAgIHByb3BlcnRpZXM6IHsKICAgICAgICBwcml2YXRlRGF0YQogICAgICB9CiAgICB9OwogICAgbGV0IHRva2VuLCBsZW5ndGgsIGRhdGEsIGxlbklWOwogICAgd2hpbGUgKCh0b2tlbiA9IHRoaXMuZ2V0VG9rZW4oKSkgIT09IG51bGwpIHsKICAgICAgaWYgKHRva2VuICE9PSAiLyIpIHsKICAgICAgICBjb250aW51ZTsKICAgICAgfQogICAgICB0b2tlbiA9IHRoaXMuZ2V0VG9rZW4oKTsKICAgICAgc3dpdGNoICh0b2tlbikgewogICAgICAgIGNhc2UgIkNoYXJTdHJpbmdzIjoKICAgICAgICAgIHRoaXMuZ2V0VG9rZW4oKTsKICAgICAgICAgIHRoaXMuZ2V0VG9rZW4oKTsKICAgICAgICAgIHRoaXMuZ2V0VG9rZW4oKTsKICAgICAgICAgIHRoaXMuZ2V0VG9rZW4oKTsKICAgICAgICAgIHdoaWxlICh0cnVlKSB7CiAgICAgICAgICAgIHRva2VuID0gdGhpcy5nZXRUb2tlbigpOwogICAgICAgICAgICBpZiAodG9rZW4gPT09IG51bGwgfHwgdG9rZW4gPT09ICJlbmQiKSB7CiAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgaWYgKHRva2VuICE9PSAiLyIpIHsKICAgICAgICAgICAgICBjb250aW51ZTsKICAgICAgICAgICAgfQogICAgICAgICAgICBjb25zdCBnbHlwaCA9IHRoaXMuZ2V0VG9rZW4oKTsKICAgICAgICAgICAgbGVuZ3RoID0gdGhpcy5yZWFkSW50KCk7CiAgICAgICAgICAgIHRoaXMuZ2V0VG9rZW4oKTsKICAgICAgICAgICAgZGF0YSA9IGxlbmd0aCA+IDAgPyBzdHJlYW0uZ2V0Qnl0ZXMobGVuZ3RoKSA6IG5ldyBVaW50OEFycmF5KDApOwogICAgICAgICAgICBsZW5JViA9IHByb2dyYW0ucHJvcGVydGllcy5wcml2YXRlRGF0YS5sZW5JVjsKICAgICAgICAgICAgY29uc3QgZW5jb2RlZCA9IHRoaXMucmVhZENoYXJTdHJpbmdzKGRhdGEsIGxlbklWKTsKICAgICAgICAgICAgdGhpcy5uZXh0Q2hhcigpOwogICAgICAgICAgICB0b2tlbiA9IHRoaXMuZ2V0VG9rZW4oKTsKICAgICAgICAgICAgaWYgKHRva2VuID09PSAibm9hY2Nlc3MiKSB7CiAgICAgICAgICAgICAgdGhpcy5nZXRUb2tlbigpOwogICAgICAgICAgICB9IGVsc2UgaWYgKHRva2VuID09PSAiLyIpIHsKICAgICAgICAgICAgICB0aGlzLnByZXZDaGFyKCk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgY2hhcnN0cmluZ3MucHVzaCh7CiAgICAgICAgICAgICAgZ2x5cGgsCiAgICAgICAgICAgICAgZW5jb2RlZAogICAgICAgICAgICB9KTsKICAgICAgICAgIH0KICAgICAgICAgIGJyZWFrOwogICAgICAgIGNhc2UgIlN1YnJzIjoKICAgICAgICAgIHRoaXMucmVhZEludCgpOwogICAgICAgICAgdGhpcy5nZXRUb2tlbigpOwogICAgICAgICAgd2hpbGUgKHRoaXMuZ2V0VG9rZW4oKSA9PT0gImR1cCIpIHsKICAgICAgICAgICAgY29uc3QgaW5kZXggPSB0aGlzLnJlYWRJbnQoKTsKICAgICAgICAgICAgbGVuZ3RoID0gdGhpcy5yZWFkSW50KCk7CiAgICAgICAgICAgIHRoaXMuZ2V0VG9rZW4oKTsKICAgICAgICAgICAgZGF0YSA9IGxlbmd0aCA+IDAgPyBzdHJlYW0uZ2V0Qnl0ZXMobGVuZ3RoKSA6IG5ldyBVaW50OEFycmF5KDApOwogICAgICAgICAgICBsZW5JViA9IHByb2dyYW0ucHJvcGVydGllcy5wcml2YXRlRGF0YS5sZW5JVjsKICAgICAgICAgICAgY29uc3QgZW5jb2RlZCA9IHRoaXMucmVhZENoYXJTdHJpbmdzKGRhdGEsIGxlbklWKTsKICAgICAgICAgICAgdGhpcy5uZXh0Q2hhcigpOwogICAgICAgICAgICB0b2tlbiA9IHRoaXMuZ2V0VG9rZW4oKTsKICAgICAgICAgICAgaWYgKHRva2VuID09PSAibm9hY2Nlc3MiKSB7CiAgICAgICAgICAgICAgdGhpcy5nZXRUb2tlbigpOwogICAgICAgICAgICB9CiAgICAgICAgICAgIHN1YnJzW2luZGV4XSA9IGVuY29kZWQ7CiAgICAgICAgICB9CiAgICAgICAgICBicmVhazsKICAgICAgICBjYXNlICJCbHVlVmFsdWVzIjoKICAgICAgICBjYXNlICJPdGhlckJsdWVzIjoKICAgICAgICBjYXNlICJGYW1pbHlCbHVlcyI6CiAgICAgICAgY2FzZSAiRmFtaWx5T3RoZXJCbHVlcyI6CiAgICAgICAgICBjb25zdCBibHVlQXJyYXkgPSB0aGlzLnJlYWROdW1iZXJBcnJheSgpOwogICAgICAgICAgaWYgKGJsdWVBcnJheS5sZW5ndGggPiAwICYmIGJsdWVBcnJheS5sZW5ndGggJSAyID09PSAwICYmIEhJTlRJTkdfRU5BQkxFRCkgewogICAgICAgICAgICBwcm9ncmFtLnByb3BlcnRpZXMucHJpdmF0ZURhdGFbdG9rZW5dID0gYmx1ZUFycmF5OwogICAgICAgICAgfQogICAgICAgICAgYnJlYWs7CiAgICAgICAgY2FzZSAiU3RlbVNuYXBIIjoKICAgICAgICBjYXNlICJTdGVtU25hcFYiOgogICAgICAgICAgcHJvZ3JhbS5wcm9wZXJ0aWVzLnByaXZhdGVEYXRhW3Rva2VuXSA9IHRoaXMucmVhZE51bWJlckFycmF5KCk7CiAgICAgICAgICBicmVhazsKICAgICAgICBjYXNlICJTdGRIVyI6CiAgICAgICAgY2FzZSAiU3RkVlciOgogICAgICAgICAgcHJvZ3JhbS5wcm9wZXJ0aWVzLnByaXZhdGVEYXRhW3Rva2VuXSA9IHRoaXMucmVhZE51bWJlckFycmF5KClbMF07CiAgICAgICAgICBicmVhazsKICAgICAgICBjYXNlICJCbHVlU2hpZnQiOgogICAgICAgIGNhc2UgImxlbklWIjoKICAgICAgICBjYXNlICJCbHVlRnV6eiI6CiAgICAgICAgY2FzZSAiQmx1ZVNjYWxlIjoKICAgICAgICBjYXNlICJMYW5ndWFnZUdyb3VwIjoKICAgICAgICAgIHByb2dyYW0ucHJvcGVydGllcy5wcml2YXRlRGF0YVt0b2tlbl0gPSB0aGlzLnJlYWROdW1iZXIoKTsKICAgICAgICAgIGJyZWFrOwogICAgICAgIGNhc2UgIkV4cGFuc2lvbkZhY3RvciI6CiAgICAgICAgICBwcm9ncmFtLnByb3BlcnRpZXMucHJpdmF0ZURhdGFbdG9rZW5dID0gdGhpcy5yZWFkTnVtYmVyKCkgfHwgMC4wNjsKICAgICAgICAgIGJyZWFrOwogICAgICAgIGNhc2UgIkZvcmNlQm9sZCI6CiAgICAgICAgICBwcm9ncmFtLnByb3BlcnRpZXMucHJpdmF0ZURhdGFbdG9rZW5dID0gdGhpcy5yZWFkQm9vbGVhbigpOwogICAgICAgICAgYnJlYWs7CiAgICAgIH0KICAgIH0KICAgIGZvciAoY29uc3QgewogICAgICBlbmNvZGVkLAogICAgICBnbHlwaAogICAgfSBvZiBjaGFyc3RyaW5ncykgewogICAgICBjb25zdCBjaGFyU3RyaW5nID0gbmV3IFR5cGUxQ2hhclN0cmluZygpOwogICAgICBjb25zdCBlcnJvciA9IGNoYXJTdHJpbmcuY29udmVydChlbmNvZGVkLCBzdWJycywgdGhpcy5zZWFjQW5hbHlzaXNFbmFibGVkKTsKICAgICAgbGV0IG91dHB1dCA9IGNoYXJTdHJpbmcub3V0cHV0OwogICAgICBpZiAoZXJyb3IpIHsKICAgICAgICBvdXRwdXQgPSBbMTRdOwogICAgICB9CiAgICAgIGNvbnN0IGNoYXJTdHJpbmdPYmplY3QgPSB7CiAgICAgICAgZ2x5cGhOYW1lOiBnbHlwaCwKICAgICAgICBjaGFyc3RyaW5nOiBvdXRwdXQsCiAgICAgICAgd2lkdGg6IGNoYXJTdHJpbmcud2lkdGgsCiAgICAgICAgbHNiOiBjaGFyU3RyaW5nLmxzYiwKICAgICAgICBzZWFjOiBjaGFyU3RyaW5nLnNlYWMKICAgICAgfTsKICAgICAgaWYgKGdseXBoID09PSAiLm5vdGRlZiIpIHsKICAgICAgICBwcm9ncmFtLmNoYXJzdHJpbmdzLnVuc2hpZnQoY2hhclN0cmluZ09iamVjdCk7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgcHJvZ3JhbS5jaGFyc3RyaW5ncy5wdXNoKGNoYXJTdHJpbmdPYmplY3QpOwogICAgICB9CiAgICAgIGlmIChwcm9wZXJ0aWVzLmJ1aWx0SW5FbmNvZGluZykgewogICAgICAgIGNvbnN0IGluZGV4ID0gcHJvcGVydGllcy5idWlsdEluRW5jb2RpbmcuaW5kZXhPZihnbHlwaCk7CiAgICAgICAgaWYgKGluZGV4ID4gLTEgJiYgcHJvcGVydGllcy53aWR0aHNbaW5kZXhdID09PSB1bmRlZmluZWQgJiYgaW5kZXggPj0gcHJvcGVydGllcy5maXJzdENoYXIgJiYgaW5kZXggPD0gcHJvcGVydGllcy5sYXN0Q2hhcikgewogICAgICAgICAgcHJvcGVydGllcy53aWR0aHNbaW5kZXhdID0gY2hhclN0cmluZy53aWR0aDsKICAgICAgICB9CiAgICAgIH0KICAgIH0KICAgIHJldHVybiBwcm9ncmFtOwogIH0KICBleHRyYWN0Rm9udEhlYWRlcihwcm9wZXJ0aWVzKSB7CiAgICBsZXQgdG9rZW47CiAgICB3aGlsZSAoKHRva2VuID0gdGhpcy5nZXRUb2tlbigpKSAhPT0gbnVsbCkgewogICAgICBpZiAodG9rZW4gIT09ICIvIikgewogICAgICAgIGNvbnRpbnVlOwogICAgICB9CiAgICAgIHRva2VuID0gdGhpcy5nZXRUb2tlbigpOwogICAgICBzd2l0Y2ggKHRva2VuKSB7CiAgICAgICAgY2FzZSAiRm9udE1hdHJpeCI6CiAgICAgICAgICBjb25zdCBtYXRyaXggPSB0aGlzLnJlYWROdW1iZXJBcnJheSgpOwogICAgICAgICAgcHJvcGVydGllcy5mb250TWF0cml4ID0gbWF0cml4OwogICAgICAgICAgYnJlYWs7CiAgICAgICAgY2FzZSAiRW5jb2RpbmciOgogICAgICAgICAgY29uc3QgZW5jb2RpbmdBcmcgPSB0aGlzLmdldFRva2VuKCk7CiAgICAgICAgICBsZXQgZW5jb2Rpbmc7CiAgICAgICAgICBpZiAoIS9eXGQrJC8udGVzdChlbmNvZGluZ0FyZykpIHsKICAgICAgICAgICAgZW5jb2RpbmcgPSAoMCwgX2VuY29kaW5ncy5nZXRFbmNvZGluZykoZW5jb2RpbmdBcmcpOwogICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgZW5jb2RpbmcgPSBbXTsKICAgICAgICAgICAgY29uc3Qgc2l6ZSA9IHBhcnNlSW50KGVuY29kaW5nQXJnLCAxMCkgfCAwOwogICAgICAgICAgICB0aGlzLmdldFRva2VuKCk7CiAgICAgICAgICAgIGZvciAobGV0IGogPSAwOyBqIDwgc2l6ZTsgaisrKSB7CiAgICAgICAgICAgICAgdG9rZW4gPSB0aGlzLmdldFRva2VuKCk7CiAgICAgICAgICAgICAgd2hpbGUgKHRva2VuICE9PSAiZHVwIiAmJiB0b2tlbiAhPT0gImRlZiIpIHsKICAgICAgICAgICAgICAgIHRva2VuID0gdGhpcy5nZXRUb2tlbigpOwogICAgICAgICAgICAgICAgaWYgKHRva2VuID09PSBudWxsKSB7CiAgICAgICAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgaWYgKHRva2VuID09PSAiZGVmIikgewogICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIGNvbnN0IGluZGV4ID0gdGhpcy5yZWFkSW50KCk7CiAgICAgICAgICAgICAgdGhpcy5nZXRUb2tlbigpOwogICAgICAgICAgICAgIGNvbnN0IGdseXBoID0gdGhpcy5nZXRUb2tlbigpOwogICAgICAgICAgICAgIGVuY29kaW5nW2luZGV4XSA9IGdseXBoOwogICAgICAgICAgICAgIHRoaXMuZ2V0VG9rZW4oKTsKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgICAgcHJvcGVydGllcy5idWlsdEluRW5jb2RpbmcgPSBlbmNvZGluZzsKICAgICAgICAgIGJyZWFrOwogICAgICAgIGNhc2UgIkZvbnRCQm94IjoKICAgICAgICAgIGNvbnN0IGZvbnRCQm94ID0gdGhpcy5yZWFkTnVtYmVyQXJyYXkoKTsKICAgICAgICAgIHByb3BlcnRpZXMuYXNjZW50ID0gTWF0aC5tYXgoZm9udEJCb3hbM10sIGZvbnRCQm94WzFdKTsKICAgICAgICAgIHByb3BlcnRpZXMuZGVzY2VudCA9IE1hdGgubWluKGZvbnRCQm94WzFdLCBmb250QkJveFszXSk7CiAgICAgICAgICBwcm9wZXJ0aWVzLmFzY2VudFNjYWxlZCA9IHRydWU7CiAgICAgICAgICBicmVhazsKICAgICAgfQogICAgfQogIH0KfQpleHBvcnRzLlR5cGUxUGFyc2VyID0gVHlwZTFQYXJzZXI7CgovKioqLyB9KSwKLyogNTAgKi8KLyoqKi8gKChfX3VudXNlZF93ZWJwYWNrX21vZHVsZSwgZXhwb3J0cywgX193X3BkZmpzX3JlcXVpcmVfXykgPT4gewoKCgpPYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgIl9fZXNNb2R1bGUiLCAoewogIHZhbHVlOiB0cnVlCn0pKTsKZXhwb3J0cy5QYXR0ZXJuID0gdm9pZCAwOwpleHBvcnRzLmNsZWFyUGF0dGVybkNhY2hlcyA9IGNsZWFyUGF0dGVybkNhY2hlczsKZXhwb3J0cy5nZXRUaWxpbmdQYXR0ZXJuSVIgPSBnZXRUaWxpbmdQYXR0ZXJuSVI7CnZhciBfdXRpbCA9IF9fd19wZGZqc19yZXF1aXJlX18oMik7CnZhciBfYmFzZV9zdHJlYW0gPSBfX3dfcGRmanNfcmVxdWlyZV9fKDUpOwp2YXIgX2NvbG9yc3BhY2UgPSBfX3dfcGRmanNfcmVxdWlyZV9fKDEyKTsKdmFyIF9jb3JlX3V0aWxzID0gX193X3BkZmpzX3JlcXVpcmVfXygzKTsKY29uc3QgU2hhZGluZ1R5cGUgPSB7CiAgRlVOQ1RJT05fQkFTRUQ6IDEsCiAgQVhJQUw6IDIsCiAgUkFESUFMOiAzLAogIEZSRUVfRk9STV9NRVNIOiA0LAogIExBVFRJQ0VfRk9STV9NRVNIOiA1LAogIENPT05TX1BBVENIX01FU0g6IDYsCiAgVEVOU09SX1BBVENIX01FU0g6IDcKfTsKY2xhc3MgUGF0dGVybiB7CiAgY29uc3RydWN0b3IoKSB7CiAgICAoMCwgX3V0aWwudW5yZWFjaGFibGUpKCJDYW5ub3QgaW5pdGlhbGl6ZSBQYXR0ZXJuLiIpOwogIH0KICBzdGF0aWMgcGFyc2VTaGFkaW5nKHNoYWRpbmcsIHhyZWYsIHJlcywgcGRmRnVuY3Rpb25GYWN0b3J5LCBsb2NhbENvbG9yU3BhY2VDYWNoZSkgewogICAgY29uc3QgZGljdCA9IHNoYWRpbmcgaW5zdGFuY2VvZiBfYmFzZV9zdHJlYW0uQmFzZVN0cmVhbSA/IHNoYWRpbmcuZGljdCA6IHNoYWRpbmc7CiAgICBjb25zdCB0eXBlID0gZGljdC5nZXQoIlNoYWRpbmdUeXBlIik7CiAgICB0cnkgewogICAgICBzd2l0Y2ggKHR5cGUpIHsKICAgICAgICBjYXNlIFNoYWRpbmdUeXBlLkFYSUFMOgogICAgICAgIGNhc2UgU2hhZGluZ1R5cGUuUkFESUFMOgogICAgICAgICAgcmV0dXJuIG5ldyBSYWRpYWxBeGlhbFNoYWRpbmcoZGljdCwgeHJlZiwgcmVzLCBwZGZGdW5jdGlvbkZhY3RvcnksIGxvY2FsQ29sb3JTcGFjZUNhY2hlKTsKICAgICAgICBjYXNlIFNoYWRpbmdUeXBlLkZSRUVfRk9STV9NRVNIOgogICAgICAgIGNhc2UgU2hhZGluZ1R5cGUuTEFUVElDRV9GT1JNX01FU0g6CiAgICAgICAgY2FzZSBTaGFkaW5nVHlwZS5DT09OU19QQVRDSF9NRVNIOgogICAgICAgIGNhc2UgU2hhZGluZ1R5cGUuVEVOU09SX1BBVENIX01FU0g6CiAgICAgICAgICByZXR1cm4gbmV3IE1lc2hTaGFkaW5nKHNoYWRpbmcsIHhyZWYsIHJlcywgcGRmRnVuY3Rpb25GYWN0b3J5LCBsb2NhbENvbG9yU3BhY2VDYWNoZSk7CiAgICAgICAgZGVmYXVsdDoKICAgICAgICAgIHRocm93IG5ldyBfdXRpbC5Gb3JtYXRFcnJvcigiVW5zdXBwb3J0ZWQgU2hhZGluZ1R5cGU6ICIgKyB0eXBlKTsKICAgICAgfQogICAgfSBjYXRjaCAoZXgpIHsKICAgICAgaWYgKGV4IGluc3RhbmNlb2YgX2NvcmVfdXRpbHMuTWlzc2luZ0RhdGFFeGNlcHRpb24pIHsKICAgICAgICB0aHJvdyBleDsKICAgICAgfQogICAgICAoMCwgX3V0aWwud2FybikoZXgpOwogICAgICByZXR1cm4gbmV3IER1bW15U2hhZGluZygpOwogICAgfQogIH0KfQpleHBvcnRzLlBhdHRlcm4gPSBQYXR0ZXJuOwpjbGFzcyBCYXNlU2hhZGluZyB7CiAgc3RhdGljIFNNQUxMX05VTUJFUiA9IDFlLTY7CiAgY29uc3RydWN0b3IoKSB7CiAgICBpZiAodGhpcy5jb25zdHJ1Y3RvciA9PT0gQmFzZVNoYWRpbmcpIHsKICAgICAgKDAsIF91dGlsLnVucmVhY2hhYmxlKSgiQ2Fubm90IGluaXRpYWxpemUgQmFzZVNoYWRpbmcuIik7CiAgICB9CiAgfQogIGdldElSKCkgewogICAgKDAsIF91dGlsLnVucmVhY2hhYmxlKSgiQWJzdHJhY3QgbWV0aG9kIGBnZXRJUmAgY2FsbGVkLiIpOwogIH0KfQpjbGFzcyBSYWRpYWxBeGlhbFNoYWRpbmcgZXh0ZW5kcyBCYXNlU2hhZGluZyB7CiAgY29uc3RydWN0b3IoZGljdCwgeHJlZiwgcmVzb3VyY2VzLCBwZGZGdW5jdGlvbkZhY3RvcnksIGxvY2FsQ29sb3JTcGFjZUNhY2hlKSB7CiAgICBzdXBlcigpOwogICAgdGhpcy5jb29yZHNBcnIgPSBkaWN0LmdldEFycmF5KCJDb29yZHMiKTsKICAgIHRoaXMuc2hhZGluZ1R5cGUgPSBkaWN0LmdldCgiU2hhZGluZ1R5cGUiKTsKICAgIGNvbnN0IGNzID0gX2NvbG9yc3BhY2UuQ29sb3JTcGFjZS5wYXJzZSh7CiAgICAgIGNzOiBkaWN0LmdldFJhdygiQ1MiKSB8fCBkaWN0LmdldFJhdygiQ29sb3JTcGFjZSIpLAogICAgICB4cmVmLAogICAgICByZXNvdXJjZXMsCiAgICAgIHBkZkZ1bmN0aW9uRmFjdG9yeSwKICAgICAgbG9jYWxDb2xvclNwYWNlQ2FjaGUKICAgIH0pOwogICAgY29uc3QgYmJveCA9IGRpY3QuZ2V0QXJyYXkoIkJCb3giKTsKICAgIHRoaXMuYmJveCA9IEFycmF5LmlzQXJyYXkoYmJveCkgJiYgYmJveC5sZW5ndGggPT09IDQgPyBfdXRpbC5VdGlsLm5vcm1hbGl6ZVJlY3QoYmJveCkgOiBudWxsOwogICAgbGV0IHQwID0gMC4wLAogICAgICB0MSA9IDEuMDsKICAgIGlmIChkaWN0LmhhcygiRG9tYWluIikpIHsKICAgICAgY29uc3QgZG9tYWluQXJyID0gZGljdC5nZXRBcnJheSgiRG9tYWluIik7CiAgICAgIHQwID0gZG9tYWluQXJyWzBdOwogICAgICB0MSA9IGRvbWFpbkFyclsxXTsKICAgIH0KICAgIGxldCBleHRlbmRTdGFydCA9IGZhbHNlLAogICAgICBleHRlbmRFbmQgPSBmYWxzZTsKICAgIGlmIChkaWN0LmhhcygiRXh0ZW5kIikpIHsKICAgICAgY29uc3QgZXh0ZW5kQXJyID0gZGljdC5nZXRBcnJheSgiRXh0ZW5kIik7CiAgICAgIGV4dGVuZFN0YXJ0ID0gZXh0ZW5kQXJyWzBdOwogICAgICBleHRlbmRFbmQgPSBleHRlbmRBcnJbMV07CiAgICB9CiAgICBpZiAodGhpcy5zaGFkaW5nVHlwZSA9PT0gU2hhZGluZ1R5cGUuUkFESUFMICYmICghZXh0ZW5kU3RhcnQgfHwgIWV4dGVuZEVuZCkpIHsKICAgICAgY29uc3QgW3gxLCB5MSwgcjEsIHgyLCB5MiwgcjJdID0gdGhpcy5jb29yZHNBcnI7CiAgICAgIGNvbnN0IGRpc3RhbmNlID0gTWF0aC5oeXBvdCh4MSAtIHgyLCB5MSAtIHkyKTsKICAgICAgaWYgKHIxIDw9IHIyICsgZGlzdGFuY2UgJiYgcjIgPD0gcjEgKyBkaXN0YW5jZSkgewogICAgICAgICgwLCBfdXRpbC53YXJuKSgiVW5zdXBwb3J0ZWQgcmFkaWFsIGdyYWRpZW50LiIpOwogICAgICB9CiAgICB9CiAgICB0aGlzLmV4dGVuZFN0YXJ0ID0gZXh0ZW5kU3RhcnQ7CiAgICB0aGlzLmV4dGVuZEVuZCA9IGV4dGVuZEVuZDsKICAgIGNvbnN0IGZuT2JqID0gZGljdC5nZXRSYXcoIkZ1bmN0aW9uIik7CiAgICBjb25zdCBmbiA9IHBkZkZ1bmN0aW9uRmFjdG9yeS5jcmVhdGVGcm9tQXJyYXkoZm5PYmopOwogICAgY29uc3QgTlVNQkVSX09GX1NBTVBMRVMgPSA4NDA7CiAgICBjb25zdCBzdGVwID0gKHQxIC0gdDApIC8gTlVNQkVSX09GX1NBTVBMRVM7CiAgICBjb25zdCBjb2xvclN0b3BzID0gdGhpcy5jb2xvclN0b3BzID0gW107CiAgICBpZiAodDAgPj0gdDEgfHwgc3RlcCA8PSAwKSB7CiAgICAgICgwLCBfdXRpbC5pbmZvKSgiQmFkIHNoYWRpbmcgZG9tYWluLiIpOwogICAgICByZXR1cm47CiAgICB9CiAgICBjb25zdCBjb2xvciA9IG5ldyBGbG9hdDMyQXJyYXkoY3MubnVtQ29tcHMpLAogICAgICByYXRpbyA9IG5ldyBGbG9hdDMyQXJyYXkoMSk7CiAgICBsZXQgcmdiQ29sb3I7CiAgICBsZXQgaUJhc2UgPSAwOwogICAgcmF0aW9bMF0gPSB0MDsKICAgIGZuKHJhdGlvLCAwLCBjb2xvciwgMCk7CiAgICBsZXQgcmdiQmFzZSA9IGNzLmdldFJnYihjb2xvciwgMCk7CiAgICBjb25zdCBjc3NDb2xvckJhc2UgPSBfdXRpbC5VdGlsLm1ha2VIZXhDb2xvcihyZ2JCYXNlWzBdLCByZ2JCYXNlWzFdLCByZ2JCYXNlWzJdKTsKICAgIGNvbG9yU3RvcHMucHVzaChbMCwgY3NzQ29sb3JCYXNlXSk7CiAgICBsZXQgaVByZXYgPSAxOwogICAgcmF0aW9bMF0gPSB0MCArIHN0ZXA7CiAgICBmbihyYXRpbywgMCwgY29sb3IsIDApOwogICAgbGV0IHJnYlByZXYgPSBjcy5nZXRSZ2IoY29sb3IsIDApOwogICAgbGV0IG1heFNsb3BlUiA9IHJnYlByZXZbMF0gLSByZ2JCYXNlWzBdICsgMTsKICAgIGxldCBtYXhTbG9wZUcgPSByZ2JQcmV2WzFdIC0gcmdiQmFzZVsxXSArIDE7CiAgICBsZXQgbWF4U2xvcGVCID0gcmdiUHJldlsyXSAtIHJnYkJhc2VbMl0gKyAxOwogICAgbGV0IG1pblNsb3BlUiA9IHJnYlByZXZbMF0gLSByZ2JCYXNlWzBdIC0gMTsKICAgIGxldCBtaW5TbG9wZUcgPSByZ2JQcmV2WzFdIC0gcmdiQmFzZVsxXSAtIDE7CiAgICBsZXQgbWluU2xvcGVCID0gcmdiUHJldlsyXSAtIHJnYkJhc2VbMl0gLSAxOwogICAgZm9yIChsZXQgaSA9IDI7IGkgPCBOVU1CRVJfT0ZfU0FNUExFUzsgaSsrKSB7CiAgICAgIHJhdGlvWzBdID0gdDAgKyBpICogc3RlcDsKICAgICAgZm4ocmF0aW8sIDAsIGNvbG9yLCAwKTsKICAgICAgcmdiQ29sb3IgPSBjcy5nZXRSZ2IoY29sb3IsIDApOwogICAgICBjb25zdCBydW4gPSBpIC0gaUJhc2U7CiAgICAgIG1heFNsb3BlUiA9IE1hdGgubWluKG1heFNsb3BlUiwgKHJnYkNvbG9yWzBdIC0gcmdiQmFzZVswXSArIDEpIC8gcnVuKTsKICAgICAgbWF4U2xvcGVHID0gTWF0aC5taW4obWF4U2xvcGVHLCAocmdiQ29sb3JbMV0gLSByZ2JCYXNlWzFdICsgMSkgLyBydW4pOwogICAgICBtYXhTbG9wZUIgPSBNYXRoLm1pbihtYXhTbG9wZUIsIChyZ2JDb2xvclsyXSAtIHJnYkJhc2VbMl0gKyAxKSAvIHJ1bik7CiAgICAgIG1pblNsb3BlUiA9IE1hdGgubWF4KG1pblNsb3BlUiwgKHJnYkNvbG9yWzBdIC0gcmdiQmFzZVswXSAtIDEpIC8gcnVuKTsKICAgICAgbWluU2xvcGVHID0gTWF0aC5tYXgobWluU2xvcGVHLCAocmdiQ29sb3JbMV0gLSByZ2JCYXNlWzFdIC0gMSkgLyBydW4pOwogICAgICBtaW5TbG9wZUIgPSBNYXRoLm1heChtaW5TbG9wZUIsIChyZ2JDb2xvclsyXSAtIHJnYkJhc2VbMl0gLSAxKSAvIHJ1bik7CiAgICAgIGNvbnN0IHNsb3Blc0V4aXN0ID0gbWluU2xvcGVSIDw9IG1heFNsb3BlUiAmJiBtaW5TbG9wZUcgPD0gbWF4U2xvcGVHICYmIG1pblNsb3BlQiA8PSBtYXhTbG9wZUI7CiAgICAgIGlmICghc2xvcGVzRXhpc3QpIHsKICAgICAgICBjb25zdCBjc3NDb2xvciA9IF91dGlsLlV0aWwubWFrZUhleENvbG9yKHJnYlByZXZbMF0sIHJnYlByZXZbMV0sIHJnYlByZXZbMl0pOwogICAgICAgIGNvbG9yU3RvcHMucHVzaChbaVByZXYgLyBOVU1CRVJfT0ZfU0FNUExFUywgY3NzQ29sb3JdKTsKICAgICAgICBtYXhTbG9wZVIgPSByZ2JDb2xvclswXSAtIHJnYlByZXZbMF0gKyAxOwogICAgICAgIG1heFNsb3BlRyA9IHJnYkNvbG9yWzFdIC0gcmdiUHJldlsxXSArIDE7CiAgICAgICAgbWF4U2xvcGVCID0gcmdiQ29sb3JbMl0gLSByZ2JQcmV2WzJdICsgMTsKICAgICAgICBtaW5TbG9wZVIgPSByZ2JDb2xvclswXSAtIHJnYlByZXZbMF0gLSAxOwogICAgICAgIG1pblNsb3BlRyA9IHJnYkNvbG9yWzFdIC0gcmdiUHJldlsxXSAtIDE7CiAgICAgICAgbWluU2xvcGVCID0gcmdiQ29sb3JbMl0gLSByZ2JQcmV2WzJdIC0gMTsKICAgICAgICBpQmFzZSA9IGlQcmV2OwogICAgICAgIHJnYkJhc2UgPSByZ2JQcmV2OwogICAgICB9CiAgICAgIGlQcmV2ID0gaTsKICAgICAgcmdiUHJldiA9IHJnYkNvbG9yOwogICAgfQogICAgY29uc3QgY3NzQ29sb3IgPSBfdXRpbC5VdGlsLm1ha2VIZXhDb2xvcihyZ2JQcmV2WzBdLCByZ2JQcmV2WzFdLCByZ2JQcmV2WzJdKTsKICAgIGNvbG9yU3RvcHMucHVzaChbMSwgY3NzQ29sb3JdKTsKICAgIGxldCBiYWNrZ3JvdW5kID0gInRyYW5zcGFyZW50IjsKICAgIGlmIChkaWN0LmhhcygiQmFja2dyb3VuZCIpKSB7CiAgICAgIHJnYkNvbG9yID0gY3MuZ2V0UmdiKGRpY3QuZ2V0KCJCYWNrZ3JvdW5kIiksIDApOwogICAgICBiYWNrZ3JvdW5kID0gX3V0aWwuVXRpbC5tYWtlSGV4Q29sb3IocmdiQ29sb3JbMF0sIHJnYkNvbG9yWzFdLCByZ2JDb2xvclsyXSk7CiAgICB9CiAgICBpZiAoIWV4dGVuZFN0YXJ0KSB7CiAgICAgIGNvbG9yU3RvcHMudW5zaGlmdChbMCwgYmFja2dyb3VuZF0pOwogICAgICBjb2xvclN0b3BzWzFdWzBdICs9IEJhc2VTaGFkaW5nLlNNQUxMX05VTUJFUjsKICAgIH0KICAgIGlmICghZXh0ZW5kRW5kKSB7CiAgICAgIGNvbG9yU3RvcHMuYXQoLTEpWzBdIC09IEJhc2VTaGFkaW5nLlNNQUxMX05VTUJFUjsKICAgICAgY29sb3JTdG9wcy5wdXNoKFsxLCBiYWNrZ3JvdW5kXSk7CiAgICB9CiAgICB0aGlzLmNvbG9yU3RvcHMgPSBjb2xvclN0b3BzOwogIH0KICBnZXRJUigpIHsKICAgIGNvbnN0IGNvb3Jkc0FyciA9IHRoaXMuY29vcmRzQXJyOwogICAgY29uc3Qgc2hhZGluZ1R5cGUgPSB0aGlzLnNoYWRpbmdUeXBlOwogICAgbGV0IHR5cGUsIHAwLCBwMSwgcjAsIHIxOwogICAgaWYgKHNoYWRpbmdUeXBlID09PSBTaGFkaW5nVHlwZS5BWElBTCkgewogICAgICBwMCA9IFtjb29yZHNBcnJbMF0sIGNvb3Jkc0FyclsxXV07CiAgICAgIHAxID0gW2Nvb3Jkc0FyclsyXSwgY29vcmRzQXJyWzNdXTsKICAgICAgcjAgPSBudWxsOwogICAgICByMSA9IG51bGw7CiAgICAgIHR5cGUgPSAiYXhpYWwiOwogICAgfSBlbHNlIGlmIChzaGFkaW5nVHlwZSA9PT0gU2hhZGluZ1R5cGUuUkFESUFMKSB7CiAgICAgIHAwID0gW2Nvb3Jkc0FyclswXSwgY29vcmRzQXJyWzFdXTsKICAgICAgcDEgPSBbY29vcmRzQXJyWzNdLCBjb29yZHNBcnJbNF1dOwogICAgICByMCA9IGNvb3Jkc0FyclsyXTsKICAgICAgcjEgPSBjb29yZHNBcnJbNV07CiAgICAgIHR5cGUgPSAicmFkaWFsIjsKICAgIH0gZWxzZSB7CiAgICAgICgwLCBfdXRpbC51bnJlYWNoYWJsZSkoYGdldFBhdHRlcm4gdHlwZSB1bmtub3duOiAke3NoYWRpbmdUeXBlfWApOwogICAgfQogICAgcmV0dXJuIFsiUmFkaWFsQXhpYWwiLCB0eXBlLCB0aGlzLmJib3gsIHRoaXMuY29sb3JTdG9wcywgcDAsIHAxLCByMCwgcjFdOwogIH0KfQpjbGFzcyBNZXNoU3RyZWFtUmVhZGVyIHsKICBjb25zdHJ1Y3RvcihzdHJlYW0sIGNvbnRleHQpIHsKICAgIHRoaXMuc3RyZWFtID0gc3RyZWFtOwogICAgdGhpcy5jb250ZXh0ID0gY29udGV4dDsKICAgIHRoaXMuYnVmZmVyID0gMDsKICAgIHRoaXMuYnVmZmVyTGVuZ3RoID0gMDsKICAgIGNvbnN0IG51bUNvbXBzID0gY29udGV4dC5udW1Db21wczsKICAgIHRoaXMudG1wQ29tcHNCdWYgPSBuZXcgRmxvYXQzMkFycmF5KG51bUNvbXBzKTsKICAgIGNvbnN0IGNzTnVtQ29tcHMgPSBjb250ZXh0LmNvbG9yU3BhY2UubnVtQ29tcHM7CiAgICB0aGlzLnRtcENzQ29tcHNCdWYgPSBjb250ZXh0LmNvbG9yRm4gPyBuZXcgRmxvYXQzMkFycmF5KGNzTnVtQ29tcHMpIDogdGhpcy50bXBDb21wc0J1ZjsKICB9CiAgZ2V0IGhhc0RhdGEoKSB7CiAgICBpZiAodGhpcy5zdHJlYW0uZW5kKSB7CiAgICAgIHJldHVybiB0aGlzLnN0cmVhbS5wb3MgPCB0aGlzLnN0cmVhbS5lbmQ7CiAgICB9CiAgICBpZiAodGhpcy5idWZmZXJMZW5ndGggPiAwKSB7CiAgICAgIHJldHVybiB0cnVlOwogICAgfQogICAgY29uc3QgbmV4dEJ5dGUgPSB0aGlzLnN0cmVhbS5nZXRCeXRlKCk7CiAgICBpZiAobmV4dEJ5dGUgPCAwKSB7CiAgICAgIHJldHVybiBmYWxzZTsKICAgIH0KICAgIHRoaXMuYnVmZmVyID0gbmV4dEJ5dGU7CiAgICB0aGlzLmJ1ZmZlckxlbmd0aCA9IDg7CiAgICByZXR1cm4gdHJ1ZTsKICB9CiAgcmVhZEJpdHMobikgewogICAgbGV0IGJ1ZmZlciA9IHRoaXMuYnVmZmVyOwogICAgbGV0IGJ1ZmZlckxlbmd0aCA9IHRoaXMuYnVmZmVyTGVuZ3RoOwogICAgaWYgKG4gPT09IDMyKSB7CiAgICAgIGlmIChidWZmZXJMZW5ndGggPT09IDApIHsKICAgICAgICByZXR1cm4gKHRoaXMuc3RyZWFtLmdldEJ5dGUoKSA8PCAyNCB8IHRoaXMuc3RyZWFtLmdldEJ5dGUoKSA8PCAxNiB8IHRoaXMuc3RyZWFtLmdldEJ5dGUoKSA8PCA4IHwgdGhpcy5zdHJlYW0uZ2V0Qnl0ZSgpKSA+Pj4gMDsKICAgICAgfQogICAgICBidWZmZXIgPSBidWZmZXIgPDwgMjQgfCB0aGlzLnN0cmVhbS5nZXRCeXRlKCkgPDwgMTYgfCB0aGlzLnN0cmVhbS5nZXRCeXRlKCkgPDwgOCB8IHRoaXMuc3RyZWFtLmdldEJ5dGUoKTsKICAgICAgY29uc3QgbmV4dEJ5dGUgPSB0aGlzLnN0cmVhbS5nZXRCeXRlKCk7CiAgICAgIHRoaXMuYnVmZmVyID0gbmV4dEJ5dGUgJiAoMSA8PCBidWZmZXJMZW5ndGgpIC0gMTsKICAgICAgcmV0dXJuIChidWZmZXIgPDwgOCAtIGJ1ZmZlckxlbmd0aCB8IChuZXh0Qnl0ZSAmIDB4ZmYpID4+IGJ1ZmZlckxlbmd0aCkgPj4+IDA7CiAgICB9CiAgICBpZiAobiA9PT0gOCAmJiBidWZmZXJMZW5ndGggPT09IDApIHsKICAgICAgcmV0dXJuIHRoaXMuc3RyZWFtLmdldEJ5dGUoKTsKICAgIH0KICAgIHdoaWxlIChidWZmZXJMZW5ndGggPCBuKSB7CiAgICAgIGJ1ZmZlciA9IGJ1ZmZlciA8PCA4IHwgdGhpcy5zdHJlYW0uZ2V0Qnl0ZSgpOwogICAgICBidWZmZXJMZW5ndGggKz0gODsKICAgIH0KICAgIGJ1ZmZlckxlbmd0aCAtPSBuOwogICAgdGhpcy5idWZmZXJMZW5ndGggPSBidWZmZXJMZW5ndGg7CiAgICB0aGlzLmJ1ZmZlciA9IGJ1ZmZlciAmICgxIDw8IGJ1ZmZlckxlbmd0aCkgLSAxOwogICAgcmV0dXJuIGJ1ZmZlciA+PiBidWZmZXJMZW5ndGg7CiAgfQogIGFsaWduKCkgewogICAgdGhpcy5idWZmZXIgPSAwOwogICAgdGhpcy5idWZmZXJMZW5ndGggPSAwOwogIH0KICByZWFkRmxhZygpIHsKICAgIHJldHVybiB0aGlzLnJlYWRCaXRzKHRoaXMuY29udGV4dC5iaXRzUGVyRmxhZyk7CiAgfQogIHJlYWRDb29yZGluYXRlKCkgewogICAgY29uc3QgYml0c1BlckNvb3JkaW5hdGUgPSB0aGlzLmNvbnRleHQuYml0c1BlckNvb3JkaW5hdGU7CiAgICBjb25zdCB4aSA9IHRoaXMucmVhZEJpdHMoYml0c1BlckNvb3JkaW5hdGUpOwogICAgY29uc3QgeWkgPSB0aGlzLnJlYWRCaXRzKGJpdHNQZXJDb29yZGluYXRlKTsKICAgIGNvbnN0IGRlY29kZSA9IHRoaXMuY29udGV4dC5kZWNvZGU7CiAgICBjb25zdCBzY2FsZSA9IGJpdHNQZXJDb29yZGluYXRlIDwgMzIgPyAxIC8gKCgxIDw8IGJpdHNQZXJDb29yZGluYXRlKSAtIDEpIDogMi4zMjgzMDY0MzY1Mzg2OTYzZS0xMDsKICAgIHJldHVybiBbeGkgKiBzY2FsZSAqIChkZWNvZGVbMV0gLSBkZWNvZGVbMF0pICsgZGVjb2RlWzBdLCB5aSAqIHNjYWxlICogKGRlY29kZVszXSAtIGRlY29kZVsyXSkgKyBkZWNvZGVbMl1dOwogIH0KICByZWFkQ29tcG9uZW50cygpIHsKICAgIGNvbnN0IG51bUNvbXBzID0gdGhpcy5jb250ZXh0Lm51bUNvbXBzOwogICAgY29uc3QgYml0c1BlckNvbXBvbmVudCA9IHRoaXMuY29udGV4dC5iaXRzUGVyQ29tcG9uZW50OwogICAgY29uc3Qgc2NhbGUgPSBiaXRzUGVyQ29tcG9uZW50IDwgMzIgPyAxIC8gKCgxIDw8IGJpdHNQZXJDb21wb25lbnQpIC0gMSkgOiAyLjMyODMwNjQzNjUzODY5NjNlLTEwOwogICAgY29uc3QgZGVjb2RlID0gdGhpcy5jb250ZXh0LmRlY29kZTsKICAgIGNvbnN0IGNvbXBvbmVudHMgPSB0aGlzLnRtcENvbXBzQnVmOwogICAgZm9yIChsZXQgaSA9IDAsIGogPSA0OyBpIDwgbnVtQ29tcHM7IGkrKywgaiArPSAyKSB7CiAgICAgIGNvbnN0IGNpID0gdGhpcy5yZWFkQml0cyhiaXRzUGVyQ29tcG9uZW50KTsKICAgICAgY29tcG9uZW50c1tpXSA9IGNpICogc2NhbGUgKiAoZGVjb2RlW2ogKyAxXSAtIGRlY29kZVtqXSkgKyBkZWNvZGVbal07CiAgICB9CiAgICBjb25zdCBjb2xvciA9IHRoaXMudG1wQ3NDb21wc0J1ZjsKICAgIGlmICh0aGlzLmNvbnRleHQuY29sb3JGbikgewogICAgICB0aGlzLmNvbnRleHQuY29sb3JGbihjb21wb25lbnRzLCAwLCBjb2xvciwgMCk7CiAgICB9CiAgICByZXR1cm4gdGhpcy5jb250ZXh0LmNvbG9yU3BhY2UuZ2V0UmdiKGNvbG9yLCAwKTsKICB9Cn0KbGV0IGJDYWNoZSA9IE9iamVjdC5jcmVhdGUobnVsbCk7CmZ1bmN0aW9uIGJ1aWxkQihjb3VudCkgewogIGNvbnN0IGx1dCA9IFtdOwogIGZvciAobGV0IGkgPSAwOyBpIDw9IGNvdW50OyBpKyspIHsKICAgIGNvbnN0IHQgPSBpIC8gY291bnQsCiAgICAgIHRfID0gMSAtIHQ7CiAgICBsdXQucHVzaChuZXcgRmxvYXQzMkFycmF5KFt0XyAqKiAzLCAzICogdCAqIHRfICoqIDIsIDMgKiB0ICoqIDIgKiB0XywgdCAqKiAzXSkpOwogIH0KICByZXR1cm4gbHV0Owp9CmZ1bmN0aW9uIGdldEIoY291bnQpIHsKICByZXR1cm4gYkNhY2hlW2NvdW50XSB8fD0gYnVpbGRCKGNvdW50KTsKfQpmdW5jdGlvbiBjbGVhclBhdHRlcm5DYWNoZXMoKSB7CiAgYkNhY2hlID0gT2JqZWN0LmNyZWF0ZShudWxsKTsKfQpjbGFzcyBNZXNoU2hhZGluZyBleHRlbmRzIEJhc2VTaGFkaW5nIHsKICBzdGF0aWMgTUlOX1NQTElUX1BBVENIX0NIVU5LU19BTU9VTlQgPSAzOwogIHN0YXRpYyBNQVhfU1BMSVRfUEFUQ0hfQ0hVTktTX0FNT1VOVCA9IDIwOwogIHN0YXRpYyBUUklBTkdMRV9ERU5TSVRZID0gMjA7CiAgY29uc3RydWN0b3Ioc3RyZWFtLCB4cmVmLCByZXNvdXJjZXMsIHBkZkZ1bmN0aW9uRmFjdG9yeSwgbG9jYWxDb2xvclNwYWNlQ2FjaGUpIHsKICAgIHN1cGVyKCk7CiAgICBpZiAoIShzdHJlYW0gaW5zdGFuY2VvZiBfYmFzZV9zdHJlYW0uQmFzZVN0cmVhbSkpIHsKICAgICAgdGhyb3cgbmV3IF91dGlsLkZvcm1hdEVycm9yKCJNZXNoIGRhdGEgaXMgbm90IGEgc3RyZWFtIik7CiAgICB9CiAgICBjb25zdCBkaWN0ID0gc3RyZWFtLmRpY3Q7CiAgICB0aGlzLnNoYWRpbmdUeXBlID0gZGljdC5nZXQoIlNoYWRpbmdUeXBlIik7CiAgICBjb25zdCBiYm94ID0gZGljdC5nZXRBcnJheSgiQkJveCIpOwogICAgdGhpcy5iYm94ID0gQXJyYXkuaXNBcnJheShiYm94KSAmJiBiYm94Lmxlbmd0aCA9PT0gNCA/IF91dGlsLlV0aWwubm9ybWFsaXplUmVjdChiYm94KSA6IG51bGw7CiAgICBjb25zdCBjcyA9IF9jb2xvcnNwYWNlLkNvbG9yU3BhY2UucGFyc2UoewogICAgICBjczogZGljdC5nZXRSYXcoIkNTIikgfHwgZGljdC5nZXRSYXcoIkNvbG9yU3BhY2UiKSwKICAgICAgeHJlZiwKICAgICAgcmVzb3VyY2VzLAogICAgICBwZGZGdW5jdGlvbkZhY3RvcnksCiAgICAgIGxvY2FsQ29sb3JTcGFjZUNhY2hlCiAgICB9KTsKICAgIHRoaXMuYmFja2dyb3VuZCA9IGRpY3QuaGFzKCJCYWNrZ3JvdW5kIikgPyBjcy5nZXRSZ2IoZGljdC5nZXQoIkJhY2tncm91bmQiKSwgMCkgOiBudWxsOwogICAgY29uc3QgZm5PYmogPSBkaWN0LmdldFJhdygiRnVuY3Rpb24iKTsKICAgIGNvbnN0IGZuID0gZm5PYmogPyBwZGZGdW5jdGlvbkZhY3RvcnkuY3JlYXRlRnJvbUFycmF5KGZuT2JqKSA6IG51bGw7CiAgICB0aGlzLmNvb3JkcyA9IFtdOwogICAgdGhpcy5jb2xvcnMgPSBbXTsKICAgIHRoaXMuZmlndXJlcyA9IFtdOwogICAgY29uc3QgZGVjb2RlQ29udGV4dCA9IHsKICAgICAgYml0c1BlckNvb3JkaW5hdGU6IGRpY3QuZ2V0KCJCaXRzUGVyQ29vcmRpbmF0ZSIpLAogICAgICBiaXRzUGVyQ29tcG9uZW50OiBkaWN0LmdldCgiQml0c1BlckNvbXBvbmVudCIpLAogICAgICBiaXRzUGVyRmxhZzogZGljdC5nZXQoIkJpdHNQZXJGbGFnIiksCiAgICAgIGRlY29kZTogZGljdC5nZXRBcnJheSgiRGVjb2RlIiksCiAgICAgIGNvbG9yRm46IGZuLAogICAgICBjb2xvclNwYWNlOiBjcywKICAgICAgbnVtQ29tcHM6IGZuID8gMSA6IGNzLm51bUNvbXBzCiAgICB9OwogICAgY29uc3QgcmVhZGVyID0gbmV3IE1lc2hTdHJlYW1SZWFkZXIoc3RyZWFtLCBkZWNvZGVDb250ZXh0KTsKICAgIGxldCBwYXRjaE1lc2ggPSBmYWxzZTsKICAgIHN3aXRjaCAodGhpcy5zaGFkaW5nVHlwZSkgewogICAgICBjYXNlIFNoYWRpbmdUeXBlLkZSRUVfRk9STV9NRVNIOgogICAgICAgIHRoaXMuX2RlY29kZVR5cGU0U2hhZGluZyhyZWFkZXIpOwogICAgICAgIGJyZWFrOwogICAgICBjYXNlIFNoYWRpbmdUeXBlLkxBVFRJQ0VfRk9STV9NRVNIOgogICAgICAgIGNvbnN0IHZlcnRpY2VzUGVyUm93ID0gZGljdC5nZXQoIlZlcnRpY2VzUGVyUm93IikgfCAwOwogICAgICAgIGlmICh2ZXJ0aWNlc1BlclJvdyA8IDIpIHsKICAgICAgICAgIHRocm93IG5ldyBfdXRpbC5Gb3JtYXRFcnJvcigiSW52YWxpZCBWZXJ0aWNlc1BlclJvdyIpOwogICAgICAgIH0KICAgICAgICB0aGlzLl9kZWNvZGVUeXBlNVNoYWRpbmcocmVhZGVyLCB2ZXJ0aWNlc1BlclJvdyk7CiAgICAgICAgYnJlYWs7CiAgICAgIGNhc2UgU2hhZGluZ1R5cGUuQ09PTlNfUEFUQ0hfTUVTSDoKICAgICAgICB0aGlzLl9kZWNvZGVUeXBlNlNoYWRpbmcocmVhZGVyKTsKICAgICAgICBwYXRjaE1lc2ggPSB0cnVlOwogICAgICAgIGJyZWFrOwogICAgICBjYXNlIFNoYWRpbmdUeXBlLlRFTlNPUl9QQVRDSF9NRVNIOgogICAgICAgIHRoaXMuX2RlY29kZVR5cGU3U2hhZGluZyhyZWFkZXIpOwogICAgICAgIHBhdGNoTWVzaCA9IHRydWU7CiAgICAgICAgYnJlYWs7CiAgICAgIGRlZmF1bHQ6CiAgICAgICAgKDAsIF91dGlsLnVucmVhY2hhYmxlKSgiVW5zdXBwb3J0ZWQgbWVzaCB0eXBlLiIpOwogICAgICAgIGJyZWFrOwogICAgfQogICAgaWYgKHBhdGNoTWVzaCkgewogICAgICB0aGlzLl91cGRhdGVCb3VuZHMoKTsKICAgICAgZm9yIChsZXQgaSA9IDAsIGlpID0gdGhpcy5maWd1cmVzLmxlbmd0aDsgaSA8IGlpOyBpKyspIHsKICAgICAgICB0aGlzLl9idWlsZEZpZ3VyZUZyb21QYXRjaChpKTsKICAgICAgfQogICAgfQogICAgdGhpcy5fdXBkYXRlQm91bmRzKCk7CiAgICB0aGlzLl9wYWNrRGF0YSgpOwogIH0KICBfZGVjb2RlVHlwZTRTaGFkaW5nKHJlYWRlcikgewogICAgY29uc3QgY29vcmRzID0gdGhpcy5jb29yZHM7CiAgICBjb25zdCBjb2xvcnMgPSB0aGlzLmNvbG9yczsKICAgIGNvbnN0IG9wZXJhdG9ycyA9IFtdOwogICAgY29uc3QgcHMgPSBbXTsKICAgIGxldCB2ZXJ0aWNlc0xlZnQgPSAwOwogICAgd2hpbGUgKHJlYWRlci5oYXNEYXRhKSB7CiAgICAgIGNvbnN0IGYgPSByZWFkZXIucmVhZEZsYWcoKTsKICAgICAgY29uc3QgY29vcmQgPSByZWFkZXIucmVhZENvb3JkaW5hdGUoKTsKICAgICAgY29uc3QgY29sb3IgPSByZWFkZXIucmVhZENvbXBvbmVudHMoKTsKICAgICAgaWYgKHZlcnRpY2VzTGVmdCA9PT0gMCkgewogICAgICAgIGlmICghKDAgPD0gZiAmJiBmIDw9IDIpKSB7CiAgICAgICAgICB0aHJvdyBuZXcgX3V0aWwuRm9ybWF0RXJyb3IoIlVua25vd24gdHlwZTQgZmxhZyIpOwogICAgICAgIH0KICAgICAgICBzd2l0Y2ggKGYpIHsKICAgICAgICAgIGNhc2UgMDoKICAgICAgICAgICAgdmVydGljZXNMZWZ0ID0gMzsKICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICBjYXNlIDE6CiAgICAgICAgICAgIHBzLnB1c2gocHMuYXQoLTIpLCBwcy5hdCgtMSkpOwogICAgICAgICAgICB2ZXJ0aWNlc0xlZnQgPSAxOwogICAgICAgICAgICBicmVhazsKICAgICAgICAgIGNhc2UgMjoKICAgICAgICAgICAgcHMucHVzaChwcy5hdCgtMyksIHBzLmF0KC0xKSk7CiAgICAgICAgICAgIHZlcnRpY2VzTGVmdCA9IDE7CiAgICAgICAgICAgIGJyZWFrOwogICAgICAgIH0KICAgICAgICBvcGVyYXRvcnMucHVzaChmKTsKICAgICAgfQogICAgICBwcy5wdXNoKGNvb3Jkcy5sZW5ndGgpOwogICAgICBjb29yZHMucHVzaChjb29yZCk7CiAgICAgIGNvbG9ycy5wdXNoKGNvbG9yKTsKICAgICAgdmVydGljZXNMZWZ0LS07CiAgICAgIHJlYWRlci5hbGlnbigpOwogICAgfQogICAgdGhpcy5maWd1cmVzLnB1c2goewogICAgICB0eXBlOiAidHJpYW5nbGVzIiwKICAgICAgY29vcmRzOiBuZXcgSW50MzJBcnJheShwcyksCiAgICAgIGNvbG9yczogbmV3IEludDMyQXJyYXkocHMpCiAgICB9KTsKICB9CiAgX2RlY29kZVR5cGU1U2hhZGluZyhyZWFkZXIsIHZlcnRpY2VzUGVyUm93KSB7CiAgICBjb25zdCBjb29yZHMgPSB0aGlzLmNvb3JkczsKICAgIGNvbnN0IGNvbG9ycyA9IHRoaXMuY29sb3JzOwogICAgY29uc3QgcHMgPSBbXTsKICAgIHdoaWxlIChyZWFkZXIuaGFzRGF0YSkgewogICAgICBjb25zdCBjb29yZCA9IHJlYWRlci5yZWFkQ29vcmRpbmF0ZSgpOwogICAgICBjb25zdCBjb2xvciA9IHJlYWRlci5yZWFkQ29tcG9uZW50cygpOwogICAgICBwcy5wdXNoKGNvb3Jkcy5sZW5ndGgpOwogICAgICBjb29yZHMucHVzaChjb29yZCk7CiAgICAgIGNvbG9ycy5wdXNoKGNvbG9yKTsKICAgIH0KICAgIHRoaXMuZmlndXJlcy5wdXNoKHsKICAgICAgdHlwZTogImxhdHRpY2UiLAogICAgICBjb29yZHM6IG5ldyBJbnQzMkFycmF5KHBzKSwKICAgICAgY29sb3JzOiBuZXcgSW50MzJBcnJheShwcyksCiAgICAgIHZlcnRpY2VzUGVyUm93CiAgICB9KTsKICB9CiAgX2RlY29kZVR5cGU2U2hhZGluZyhyZWFkZXIpIHsKICAgIGNvbnN0IGNvb3JkcyA9IHRoaXMuY29vcmRzOwogICAgY29uc3QgY29sb3JzID0gdGhpcy5jb2xvcnM7CiAgICBjb25zdCBwcyA9IG5ldyBJbnQzMkFycmF5KDE2KTsKICAgIGNvbnN0IGNzID0gbmV3IEludDMyQXJyYXkoNCk7CiAgICB3aGlsZSAocmVhZGVyLmhhc0RhdGEpIHsKICAgICAgY29uc3QgZiA9IHJlYWRlci5yZWFkRmxhZygpOwogICAgICBpZiAoISgwIDw9IGYgJiYgZiA8PSAzKSkgewogICAgICAgIHRocm93IG5ldyBfdXRpbC5Gb3JtYXRFcnJvcigiVW5rbm93biB0eXBlNiBmbGFnIik7CiAgICAgIH0KICAgICAgY29uc3QgcGkgPSBjb29yZHMubGVuZ3RoOwogICAgICBmb3IgKGxldCBpID0gMCwgaWkgPSBmICE9PSAwID8gOCA6IDEyOyBpIDwgaWk7IGkrKykgewogICAgICAgIGNvb3Jkcy5wdXNoKHJlYWRlci5yZWFkQ29vcmRpbmF0ZSgpKTsKICAgICAgfQogICAgICBjb25zdCBjaSA9IGNvbG9ycy5sZW5ndGg7CiAgICAgIGZvciAobGV0IGkgPSAwLCBpaSA9IGYgIT09IDAgPyAyIDogNDsgaSA8IGlpOyBpKyspIHsKICAgICAgICBjb2xvcnMucHVzaChyZWFkZXIucmVhZENvbXBvbmVudHMoKSk7CiAgICAgIH0KICAgICAgbGV0IHRtcDEsIHRtcDIsIHRtcDMsIHRtcDQ7CiAgICAgIHN3aXRjaCAoZikgewogICAgICAgIGNhc2UgMDoKICAgICAgICAgIHBzWzEyXSA9IHBpICsgMzsKICAgICAgICAgIHBzWzEzXSA9IHBpICsgNDsKICAgICAgICAgIHBzWzE0XSA9IHBpICsgNTsKICAgICAgICAgIHBzWzE1XSA9IHBpICsgNjsKICAgICAgICAgIHBzWzhdID0gcGkgKyAyOwogICAgICAgICAgcHNbMTFdID0gcGkgKyA3OwogICAgICAgICAgcHNbNF0gPSBwaSArIDE7CiAgICAgICAgICBwc1s3XSA9IHBpICsgODsKICAgICAgICAgIHBzWzBdID0gcGk7CiAgICAgICAgICBwc1sxXSA9IHBpICsgMTE7CiAgICAgICAgICBwc1syXSA9IHBpICsgMTA7CiAgICAgICAgICBwc1szXSA9IHBpICsgOTsKICAgICAgICAgIGNzWzJdID0gY2kgKyAxOwogICAgICAgICAgY3NbM10gPSBjaSArIDI7CiAgICAgICAgICBjc1swXSA9IGNpOwogICAgICAgICAgY3NbMV0gPSBjaSArIDM7CiAgICAgICAgICBicmVhazsKICAgICAgICBjYXNlIDE6CiAgICAgICAgICB0bXAxID0gcHNbMTJdOwogICAgICAgICAgdG1wMiA9IHBzWzEzXTsKICAgICAgICAgIHRtcDMgPSBwc1sxNF07CiAgICAgICAgICB0bXA0ID0gcHNbMTVdOwogICAgICAgICAgcHNbMTJdID0gdG1wNDsKICAgICAgICAgIHBzWzEzXSA9IHBpICsgMDsKICAgICAgICAgIHBzWzE0XSA9IHBpICsgMTsKICAgICAgICAgIHBzWzE1XSA9IHBpICsgMjsKICAgICAgICAgIHBzWzhdID0gdG1wMzsKICAgICAgICAgIHBzWzExXSA9IHBpICsgMzsKICAgICAgICAgIHBzWzRdID0gdG1wMjsKICAgICAgICAgIHBzWzddID0gcGkgKyA0OwogICAgICAgICAgcHNbMF0gPSB0bXAxOwogICAgICAgICAgcHNbMV0gPSBwaSArIDc7CiAgICAgICAgICBwc1syXSA9IHBpICsgNjsKICAgICAgICAgIHBzWzNdID0gcGkgKyA1OwogICAgICAgICAgdG1wMSA9IGNzWzJdOwogICAgICAgICAgdG1wMiA9IGNzWzNdOwogICAgICAgICAgY3NbMl0gPSB0bXAyOwogICAgICAgICAgY3NbM10gPSBjaTsKICAgICAgICAgIGNzWzBdID0gdG1wMTsKICAgICAgICAgIGNzWzFdID0gY2kgKyAxOwogICAgICAgICAgYnJlYWs7CiAgICAgICAgY2FzZSAyOgogICAgICAgICAgdG1wMSA9IHBzWzE1XTsKICAgICAgICAgIHRtcDIgPSBwc1sxMV07CiAgICAgICAgICBwc1sxMl0gPSBwc1szXTsKICAgICAgICAgIHBzWzEzXSA9IHBpICsgMDsKICAgICAgICAgIHBzWzE0XSA9IHBpICsgMTsKICAgICAgICAgIHBzWzE1XSA9IHBpICsgMjsKICAgICAgICAgIHBzWzhdID0gcHNbN107CiAgICAgICAgICBwc1sxMV0gPSBwaSArIDM7CiAgICAgICAgICBwc1s0XSA9IHRtcDI7CiAgICAgICAgICBwc1s3XSA9IHBpICsgNDsKICAgICAgICAgIHBzWzBdID0gdG1wMTsKICAgICAgICAgIHBzWzFdID0gcGkgKyA3OwogICAgICAgICAgcHNbMl0gPSBwaSArIDY7CiAgICAgICAgICBwc1szXSA9IHBpICsgNTsKICAgICAgICAgIHRtcDEgPSBjc1szXTsKICAgICAgICAgIGNzWzJdID0gY3NbMV07CiAgICAgICAgICBjc1szXSA9IGNpOwogICAgICAgICAgY3NbMF0gPSB0bXAxOwogICAgICAgICAgY3NbMV0gPSBjaSArIDE7CiAgICAgICAgICBicmVhazsKICAgICAgICBjYXNlIDM6CiAgICAgICAgICBwc1sxMl0gPSBwc1swXTsKICAgICAgICAgIHBzWzEzXSA9IHBpICsgMDsKICAgICAgICAgIHBzWzE0XSA9IHBpICsgMTsKICAgICAgICAgIHBzWzE1XSA9IHBpICsgMjsKICAgICAgICAgIHBzWzhdID0gcHNbMV07CiAgICAgICAgICBwc1sxMV0gPSBwaSArIDM7CiAgICAgICAgICBwc1s0XSA9IHBzWzJdOwogICAgICAgICAgcHNbN10gPSBwaSArIDQ7CiAgICAgICAgICBwc1swXSA9IHBzWzNdOwogICAgICAgICAgcHNbMV0gPSBwaSArIDc7CiAgICAgICAgICBwc1syXSA9IHBpICsgNjsKICAgICAgICAgIHBzWzNdID0gcGkgKyA1OwogICAgICAgICAgY3NbMl0gPSBjc1swXTsKICAgICAgICAgIGNzWzNdID0gY2k7CiAgICAgICAgICBjc1swXSA9IGNzWzFdOwogICAgICAgICAgY3NbMV0gPSBjaSArIDE7CiAgICAgICAgICBicmVhazsKICAgICAgfQogICAgICBwc1s1XSA9IGNvb3Jkcy5sZW5ndGg7CiAgICAgIGNvb3Jkcy5wdXNoKFsoLTQgKiBjb29yZHNbcHNbMF1dWzBdIC0gY29vcmRzW3BzWzE1XV1bMF0gKyA2ICogKGNvb3Jkc1twc1s0XV1bMF0gKyBjb29yZHNbcHNbMV1dWzBdKSAtIDIgKiAoY29vcmRzW3BzWzEyXV1bMF0gKyBjb29yZHNbcHNbM11dWzBdKSArIDMgKiAoY29vcmRzW3BzWzEzXV1bMF0gKyBjb29yZHNbcHNbN11dWzBdKSkgLyA5LCAoLTQgKiBjb29yZHNbcHNbMF1dWzFdIC0gY29vcmRzW3BzWzE1XV1bMV0gKyA2ICogKGNvb3Jkc1twc1s0XV1bMV0gKyBjb29yZHNbcHNbMV1dWzFdKSAtIDIgKiAoY29vcmRzW3BzWzEyXV1bMV0gKyBjb29yZHNbcHNbM11dWzFdKSArIDMgKiAoY29vcmRzW3BzWzEzXV1bMV0gKyBjb29yZHNbcHNbN11dWzFdKSkgLyA5XSk7CiAgICAgIHBzWzZdID0gY29vcmRzLmxlbmd0aDsKICAgICAgY29vcmRzLnB1c2goWygtNCAqIGNvb3Jkc1twc1szXV1bMF0gLSBjb29yZHNbcHNbMTJdXVswXSArIDYgKiAoY29vcmRzW3BzWzJdXVswXSArIGNvb3Jkc1twc1s3XV1bMF0pIC0gMiAqIChjb29yZHNbcHNbMF1dWzBdICsgY29vcmRzW3BzWzE1XV1bMF0pICsgMyAqIChjb29yZHNbcHNbNF1dWzBdICsgY29vcmRzW3BzWzE0XV1bMF0pKSAvIDksICgtNCAqIGNvb3Jkc1twc1szXV1bMV0gLSBjb29yZHNbcHNbMTJdXVsxXSArIDYgKiAoY29vcmRzW3BzWzJdXVsxXSArIGNvb3Jkc1twc1s3XV1bMV0pIC0gMiAqIChjb29yZHNbcHNbMF1dWzFdICsgY29vcmRzW3BzWzE1XV1bMV0pICsgMyAqIChjb29yZHNbcHNbNF1dWzFdICsgY29vcmRzW3BzWzE0XV1bMV0pKSAvIDldKTsKICAgICAgcHNbOV0gPSBjb29yZHMubGVuZ3RoOwogICAgICBjb29yZHMucHVzaChbKC00ICogY29vcmRzW3BzWzEyXV1bMF0gLSBjb29yZHNbcHNbM11dWzBdICsgNiAqIChjb29yZHNbcHNbOF1dWzBdICsgY29vcmRzW3BzWzEzXV1bMF0pIC0gMiAqIChjb29yZHNbcHNbMF1dWzBdICsgY29vcmRzW3BzWzE1XV1bMF0pICsgMyAqIChjb29yZHNbcHNbMTFdXVswXSArIGNvb3Jkc1twc1sxXV1bMF0pKSAvIDksICgtNCAqIGNvb3Jkc1twc1sxMl1dWzFdIC0gY29vcmRzW3BzWzNdXVsxXSArIDYgKiAoY29vcmRzW3BzWzhdXVsxXSArIGNvb3Jkc1twc1sxM11dWzFdKSAtIDIgKiAoY29vcmRzW3BzWzBdXVsxXSArIGNvb3Jkc1twc1sxNV1dWzFdKSArIDMgKiAoY29vcmRzW3BzWzExXV1bMV0gKyBjb29yZHNbcHNbMV1dWzFdKSkgLyA5XSk7CiAgICAgIHBzWzEwXSA9IGNvb3Jkcy5sZW5ndGg7CiAgICAgIGNvb3Jkcy5wdXNoKFsoLTQgKiBjb29yZHNbcHNbMTVdXVswXSAtIGNvb3Jkc1twc1swXV1bMF0gKyA2ICogKGNvb3Jkc1twc1sxMV1dWzBdICsgY29vcmRzW3BzWzE0XV1bMF0pIC0gMiAqIChjb29yZHNbcHNbMTJdXVswXSArIGNvb3Jkc1twc1szXV1bMF0pICsgMyAqIChjb29yZHNbcHNbMl1dWzBdICsgY29vcmRzW3BzWzhdXVswXSkpIC8gOSwgKC00ICogY29vcmRzW3BzWzE1XV1bMV0gLSBjb29yZHNbcHNbMF1dWzFdICsgNiAqIChjb29yZHNbcHNbMTFdXVsxXSArIGNvb3Jkc1twc1sxNF1dWzFdKSAtIDIgKiAoY29vcmRzW3BzWzEyXV1bMV0gKyBjb29yZHNbcHNbM11dWzFdKSArIDMgKiAoY29vcmRzW3BzWzJdXVsxXSArIGNvb3Jkc1twc1s4XV1bMV0pKSAvIDldKTsKICAgICAgdGhpcy5maWd1cmVzLnB1c2goewogICAgICAgIHR5cGU6ICJwYXRjaCIsCiAgICAgICAgY29vcmRzOiBuZXcgSW50MzJBcnJheShwcyksCiAgICAgICAgY29sb3JzOiBuZXcgSW50MzJBcnJheShjcykKICAgICAgfSk7CiAgICB9CiAgfQogIF9kZWNvZGVUeXBlN1NoYWRpbmcocmVhZGVyKSB7CiAgICBjb25zdCBjb29yZHMgPSB0aGlzLmNvb3JkczsKICAgIGNvbnN0IGNvbG9ycyA9IHRoaXMuY29sb3JzOwogICAgY29uc3QgcHMgPSBuZXcgSW50MzJBcnJheSgxNik7CiAgICBjb25zdCBjcyA9IG5ldyBJbnQzMkFycmF5KDQpOwogICAgd2hpbGUgKHJlYWRlci5oYXNEYXRhKSB7CiAgICAgIGNvbnN0IGYgPSByZWFkZXIucmVhZEZsYWcoKTsKICAgICAgaWYgKCEoMCA8PSBmICYmIGYgPD0gMykpIHsKICAgICAgICB0aHJvdyBuZXcgX3V0aWwuRm9ybWF0RXJyb3IoIlVua25vd24gdHlwZTcgZmxhZyIpOwogICAgICB9CiAgICAgIGNvbnN0IHBpID0gY29vcmRzLmxlbmd0aDsKICAgICAgZm9yIChsZXQgaSA9IDAsIGlpID0gZiAhPT0gMCA/IDEyIDogMTY7IGkgPCBpaTsgaSsrKSB7CiAgICAgICAgY29vcmRzLnB1c2gocmVhZGVyLnJlYWRDb29yZGluYXRlKCkpOwogICAgICB9CiAgICAgIGNvbnN0IGNpID0gY29sb3JzLmxlbmd0aDsKICAgICAgZm9yIChsZXQgaSA9IDAsIGlpID0gZiAhPT0gMCA/IDIgOiA0OyBpIDwgaWk7IGkrKykgewogICAgICAgIGNvbG9ycy5wdXNoKHJlYWRlci5yZWFkQ29tcG9uZW50cygpKTsKICAgICAgfQogICAgICBsZXQgdG1wMSwgdG1wMiwgdG1wMywgdG1wNDsKICAgICAgc3dpdGNoIChmKSB7CiAgICAgICAgY2FzZSAwOgogICAgICAgICAgcHNbMTJdID0gcGkgKyAzOwogICAgICAgICAgcHNbMTNdID0gcGkgKyA0OwogICAgICAgICAgcHNbMTRdID0gcGkgKyA1OwogICAgICAgICAgcHNbMTVdID0gcGkgKyA2OwogICAgICAgICAgcHNbOF0gPSBwaSArIDI7CiAgICAgICAgICBwc1s5XSA9IHBpICsgMTM7CiAgICAgICAgICBwc1sxMF0gPSBwaSArIDE0OwogICAgICAgICAgcHNbMTFdID0gcGkgKyA3OwogICAgICAgICAgcHNbNF0gPSBwaSArIDE7CiAgICAgICAgICBwc1s1XSA9IHBpICsgMTI7CiAgICAgICAgICBwc1s2XSA9IHBpICsgMTU7CiAgICAgICAgICBwc1s3XSA9IHBpICsgODsKICAgICAgICAgIHBzWzBdID0gcGk7CiAgICAgICAgICBwc1sxXSA9IHBpICsgMTE7CiAgICAgICAgICBwc1syXSA9IHBpICsgMTA7CiAgICAgICAgICBwc1szXSA9IHBpICsgOTsKICAgICAgICAgIGNzWzJdID0gY2kgKyAxOwogICAgICAgICAgY3NbM10gPSBjaSArIDI7CiAgICAgICAgICBjc1swXSA9IGNpOwogICAgICAgICAgY3NbMV0gPSBjaSArIDM7CiAgICAgICAgICBicmVhazsKICAgICAgICBjYXNlIDE6CiAgICAgICAgICB0bXAxID0gcHNbMTJdOwogICAgICAgICAgdG1wMiA9IHBzWzEzXTsKICAgICAgICAgIHRtcDMgPSBwc1sxNF07CiAgICAgICAgICB0bXA0ID0gcHNbMTVdOwogICAgICAgICAgcHNbMTJdID0gdG1wNDsKICAgICAgICAgIHBzWzEzXSA9IHBpICsgMDsKICAgICAgICAgIHBzWzE0XSA9IHBpICsgMTsKICAgICAgICAgIHBzWzE1XSA9IHBpICsgMjsKICAgICAgICAgIHBzWzhdID0gdG1wMzsKICAgICAgICAgIHBzWzldID0gcGkgKyA5OwogICAgICAgICAgcHNbMTBdID0gcGkgKyAxMDsKICAgICAgICAgIHBzWzExXSA9IHBpICsgMzsKICAgICAgICAgIHBzWzRdID0gdG1wMjsKICAgICAgICAgIHBzWzVdID0gcGkgKyA4OwogICAgICAgICAgcHNbNl0gPSBwaSArIDExOwogICAgICAgICAgcHNbN10gPSBwaSArIDQ7CiAgICAgICAgICBwc1swXSA9IHRtcDE7CiAgICAgICAgICBwc1sxXSA9IHBpICsgNzsKICAgICAgICAgIHBzWzJdID0gcGkgKyA2OwogICAgICAgICAgcHNbM10gPSBwaSArIDU7CiAgICAgICAgICB0bXAxID0gY3NbMl07CiAgICAgICAgICB0bXAyID0gY3NbM107CiAgICAgICAgICBjc1syXSA9IHRtcDI7CiAgICAgICAgICBjc1szXSA9IGNpOwogICAgICAgICAgY3NbMF0gPSB0bXAxOwogICAgICAgICAgY3NbMV0gPSBjaSArIDE7CiAgICAgICAgICBicmVhazsKICAgICAgICBjYXNlIDI6CiAgICAgICAgICB0bXAxID0gcHNbMTVdOwogICAgICAgICAgdG1wMiA9IHBzWzExXTsKICAgICAgICAgIHBzWzEyXSA9IHBzWzNdOwogICAgICAgICAgcHNbMTNdID0gcGkgKyAwOwogICAgICAgICAgcHNbMTRdID0gcGkgKyAxOwogICAgICAgICAgcHNbMTVdID0gcGkgKyAyOwogICAgICAgICAgcHNbOF0gPSBwc1s3XTsKICAgICAgICAgIHBzWzldID0gcGkgKyA5OwogICAgICAgICAgcHNbMTBdID0gcGkgKyAxMDsKICAgICAgICAgIHBzWzExXSA9IHBpICsgMzsKICAgICAgICAgIHBzWzRdID0gdG1wMjsKICAgICAgICAgIHBzWzVdID0gcGkgKyA4OwogICAgICAgICAgcHNbNl0gPSBwaSArIDExOwogICAgICAgICAgcHNbN10gPSBwaSArIDQ7CiAgICAgICAgICBwc1swXSA9IHRtcDE7CiAgICAgICAgICBwc1sxXSA9IHBpICsgNzsKICAgICAgICAgIHBzWzJdID0gcGkgKyA2OwogICAgICAgICAgcHNbM10gPSBwaSArIDU7CiAgICAgICAgICB0bXAxID0gY3NbM107CiAgICAgICAgICBjc1syXSA9IGNzWzFdOwogICAgICAgICAgY3NbM10gPSBjaTsKICAgICAgICAgIGNzWzBdID0gdG1wMTsKICAgICAgICAgIGNzWzFdID0gY2kgKyAxOwogICAgICAgICAgYnJlYWs7CiAgICAgICAgY2FzZSAzOgogICAgICAgICAgcHNbMTJdID0gcHNbMF07CiAgICAgICAgICBwc1sxM10gPSBwaSArIDA7CiAgICAgICAgICBwc1sxNF0gPSBwaSArIDE7CiAgICAgICAgICBwc1sxNV0gPSBwaSArIDI7CiAgICAgICAgICBwc1s4XSA9IHBzWzFdOwogICAgICAgICAgcHNbOV0gPSBwaSArIDk7CiAgICAgICAgICBwc1sxMF0gPSBwaSArIDEwOwogICAgICAgICAgcHNbMTFdID0gcGkgKyAzOwogICAgICAgICAgcHNbNF0gPSBwc1syXTsKICAgICAgICAgIHBzWzVdID0gcGkgKyA4OwogICAgICAgICAgcHNbNl0gPSBwaSArIDExOwogICAgICAgICAgcHNbN10gPSBwaSArIDQ7CiAgICAgICAgICBwc1swXSA9IHBzWzNdOwogICAgICAgICAgcHNbMV0gPSBwaSArIDc7CiAgICAgICAgICBwc1syXSA9IHBpICsgNjsKICAgICAgICAgIHBzWzNdID0gcGkgKyA1OwogICAgICAgICAgY3NbMl0gPSBjc1swXTsKICAgICAgICAgIGNzWzNdID0gY2k7CiAgICAgICAgICBjc1swXSA9IGNzWzFdOwogICAgICAgICAgY3NbMV0gPSBjaSArIDE7CiAgICAgICAgICBicmVhazsKICAgICAgfQogICAgICB0aGlzLmZpZ3VyZXMucHVzaCh7CiAgICAgICAgdHlwZTogInBhdGNoIiwKICAgICAgICBjb29yZHM6IG5ldyBJbnQzMkFycmF5KHBzKSwKICAgICAgICBjb2xvcnM6IG5ldyBJbnQzMkFycmF5KGNzKQogICAgICB9KTsKICAgIH0KICB9CiAgX2J1aWxkRmlndXJlRnJvbVBhdGNoKGluZGV4KSB7CiAgICBjb25zdCBmaWd1cmUgPSB0aGlzLmZpZ3VyZXNbaW5kZXhdOwogICAgKDAsIF91dGlsLmFzc2VydCkoZmlndXJlLnR5cGUgPT09ICJwYXRjaCIsICJVbmV4cGVjdGVkIHBhdGNoIG1lc2ggZmlndXJlIik7CiAgICBjb25zdCBjb29yZHMgPSB0aGlzLmNvb3JkcywKICAgICAgY29sb3JzID0gdGhpcy5jb2xvcnM7CiAgICBjb25zdCBwaSA9IGZpZ3VyZS5jb29yZHM7CiAgICBjb25zdCBjaSA9IGZpZ3VyZS5jb2xvcnM7CiAgICBjb25zdCBmaWd1cmVNaW5YID0gTWF0aC5taW4oY29vcmRzW3BpWzBdXVswXSwgY29vcmRzW3BpWzNdXVswXSwgY29vcmRzW3BpWzEyXV1bMF0sIGNvb3Jkc1twaVsxNV1dWzBdKTsKICAgIGNvbnN0IGZpZ3VyZU1pblkgPSBNYXRoLm1pbihjb29yZHNbcGlbMF1dWzFdLCBjb29yZHNbcGlbM11dWzFdLCBjb29yZHNbcGlbMTJdXVsxXSwgY29vcmRzW3BpWzE1XV1bMV0pOwogICAgY29uc3QgZmlndXJlTWF4WCA9IE1hdGgubWF4KGNvb3Jkc1twaVswXV1bMF0sIGNvb3Jkc1twaVszXV1bMF0sIGNvb3Jkc1twaVsxMl1dWzBdLCBjb29yZHNbcGlbMTVdXVswXSk7CiAgICBjb25zdCBmaWd1cmVNYXhZID0gTWF0aC5tYXgoY29vcmRzW3BpWzBdXVsxXSwgY29vcmRzW3BpWzNdXVsxXSwgY29vcmRzW3BpWzEyXV1bMV0sIGNvb3Jkc1twaVsxNV1dWzFdKTsKICAgIGxldCBzcGxpdFhCeSA9IE1hdGguY2VpbCgoZmlndXJlTWF4WCAtIGZpZ3VyZU1pblgpICogTWVzaFNoYWRpbmcuVFJJQU5HTEVfREVOU0lUWSAvICh0aGlzLmJvdW5kc1syXSAtIHRoaXMuYm91bmRzWzBdKSk7CiAgICBzcGxpdFhCeSA9IE1hdGgubWF4KE1lc2hTaGFkaW5nLk1JTl9TUExJVF9QQVRDSF9DSFVOS1NfQU1PVU5ULCBNYXRoLm1pbihNZXNoU2hhZGluZy5NQVhfU1BMSVRfUEFUQ0hfQ0hVTktTX0FNT1VOVCwgc3BsaXRYQnkpKTsKICAgIGxldCBzcGxpdFlCeSA9IE1hdGguY2VpbCgoZmlndXJlTWF4WSAtIGZpZ3VyZU1pblkpICogTWVzaFNoYWRpbmcuVFJJQU5HTEVfREVOU0lUWSAvICh0aGlzLmJvdW5kc1szXSAtIHRoaXMuYm91bmRzWzFdKSk7CiAgICBzcGxpdFlCeSA9IE1hdGgubWF4KE1lc2hTaGFkaW5nLk1JTl9TUExJVF9QQVRDSF9DSFVOS1NfQU1PVU5ULCBNYXRoLm1pbihNZXNoU2hhZGluZy5NQVhfU1BMSVRfUEFUQ0hfQ0hVTktTX0FNT1VOVCwgc3BsaXRZQnkpKTsKICAgIGNvbnN0IHZlcnRpY2VzUGVyUm93ID0gc3BsaXRYQnkgKyAxOwogICAgY29uc3QgZmlndXJlQ29vcmRzID0gbmV3IEludDMyQXJyYXkoKHNwbGl0WUJ5ICsgMSkgKiB2ZXJ0aWNlc1BlclJvdyk7CiAgICBjb25zdCBmaWd1cmVDb2xvcnMgPSBuZXcgSW50MzJBcnJheSgoc3BsaXRZQnkgKyAxKSAqIHZlcnRpY2VzUGVyUm93KTsKICAgIGxldCBrID0gMDsKICAgIGNvbnN0IGNsID0gbmV3IFVpbnQ4QXJyYXkoMyksCiAgICAgIGNyID0gbmV3IFVpbnQ4QXJyYXkoMyk7CiAgICBjb25zdCBjMCA9IGNvbG9yc1tjaVswXV0sCiAgICAgIGMxID0gY29sb3JzW2NpWzFdXSwKICAgICAgYzIgPSBjb2xvcnNbY2lbMl1dLAogICAgICBjMyA9IGNvbG9yc1tjaVszXV07CiAgICBjb25zdCBiUm93ID0gZ2V0QihzcGxpdFlCeSksCiAgICAgIGJDb2wgPSBnZXRCKHNwbGl0WEJ5KTsKICAgIGZvciAobGV0IHJvdyA9IDA7IHJvdyA8PSBzcGxpdFlCeTsgcm93KyspIHsKICAgICAgY2xbMF0gPSAoYzBbMF0gKiAoc3BsaXRZQnkgLSByb3cpICsgYzJbMF0gKiByb3cpIC8gc3BsaXRZQnkgfCAwOwogICAgICBjbFsxXSA9IChjMFsxXSAqIChzcGxpdFlCeSAtIHJvdykgKyBjMlsxXSAqIHJvdykgLyBzcGxpdFlCeSB8IDA7CiAgICAgIGNsWzJdID0gKGMwWzJdICogKHNwbGl0WUJ5IC0gcm93KSArIGMyWzJdICogcm93KSAvIHNwbGl0WUJ5IHwgMDsKICAgICAgY3JbMF0gPSAoYzFbMF0gKiAoc3BsaXRZQnkgLSByb3cpICsgYzNbMF0gKiByb3cpIC8gc3BsaXRZQnkgfCAwOwogICAgICBjclsxXSA9IChjMVsxXSAqIChzcGxpdFlCeSAtIHJvdykgKyBjM1sxXSAqIHJvdykgLyBzcGxpdFlCeSB8IDA7CiAgICAgIGNyWzJdID0gKGMxWzJdICogKHNwbGl0WUJ5IC0gcm93KSArIGMzWzJdICogcm93KSAvIHNwbGl0WUJ5IHwgMDsKICAgICAgZm9yIChsZXQgY29sID0gMDsgY29sIDw9IHNwbGl0WEJ5OyBjb2wrKywgaysrKSB7CiAgICAgICAgaWYgKChyb3cgPT09IDAgfHwgcm93ID09PSBzcGxpdFlCeSkgJiYgKGNvbCA9PT0gMCB8fCBjb2wgPT09IHNwbGl0WEJ5KSkgewogICAgICAgICAgY29udGludWU7CiAgICAgICAgfQogICAgICAgIGxldCB4ID0gMCwKICAgICAgICAgIHkgPSAwOwogICAgICAgIGxldCBxID0gMDsKICAgICAgICBmb3IgKGxldCBpID0gMDsgaSA8PSAzOyBpKyspIHsKICAgICAgICAgIGZvciAobGV0IGogPSAwOyBqIDw9IDM7IGorKywgcSsrKSB7CiAgICAgICAgICAgIGNvbnN0IG0gPSBiUm93W3Jvd11baV0gKiBiQ29sW2NvbF1bal07CiAgICAgICAgICAgIHggKz0gY29vcmRzW3BpW3FdXVswXSAqIG07CiAgICAgICAgICAgIHkgKz0gY29vcmRzW3BpW3FdXVsxXSAqIG07CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIGZpZ3VyZUNvb3Jkc1trXSA9IGNvb3Jkcy5sZW5ndGg7CiAgICAgICAgY29vcmRzLnB1c2goW3gsIHldKTsKICAgICAgICBmaWd1cmVDb2xvcnNba10gPSBjb2xvcnMubGVuZ3RoOwogICAgICAgIGNvbnN0IG5ld0NvbG9yID0gbmV3IFVpbnQ4QXJyYXkoMyk7CiAgICAgICAgbmV3Q29sb3JbMF0gPSAoY2xbMF0gKiAoc3BsaXRYQnkgLSBjb2wpICsgY3JbMF0gKiBjb2wpIC8gc3BsaXRYQnkgfCAwOwogICAgICAgIG5ld0NvbG9yWzFdID0gKGNsWzFdICogKHNwbGl0WEJ5IC0gY29sKSArIGNyWzFdICogY29sKSAvIHNwbGl0WEJ5IHwgMDsKICAgICAgICBuZXdDb2xvclsyXSA9IChjbFsyXSAqIChzcGxpdFhCeSAtIGNvbCkgKyBjclsyXSAqIGNvbCkgLyBzcGxpdFhCeSB8IDA7CiAgICAgICAgY29sb3JzLnB1c2gobmV3Q29sb3IpOwogICAgICB9CiAgICB9CiAgICBmaWd1cmVDb29yZHNbMF0gPSBwaVswXTsKICAgIGZpZ3VyZUNvbG9yc1swXSA9IGNpWzBdOwogICAgZmlndXJlQ29vcmRzW3NwbGl0WEJ5XSA9IHBpWzNdOwogICAgZmlndXJlQ29sb3JzW3NwbGl0WEJ5XSA9IGNpWzFdOwogICAgZmlndXJlQ29vcmRzW3ZlcnRpY2VzUGVyUm93ICogc3BsaXRZQnldID0gcGlbMTJdOwogICAgZmlndXJlQ29sb3JzW3ZlcnRpY2VzUGVyUm93ICogc3BsaXRZQnldID0gY2lbMl07CiAgICBmaWd1cmVDb29yZHNbdmVydGljZXNQZXJSb3cgKiBzcGxpdFlCeSArIHNwbGl0WEJ5XSA9IHBpWzE1XTsKICAgIGZpZ3VyZUNvbG9yc1t2ZXJ0aWNlc1BlclJvdyAqIHNwbGl0WUJ5ICsgc3BsaXRYQnldID0gY2lbM107CiAgICB0aGlzLmZpZ3VyZXNbaW5kZXhdID0gewogICAgICB0eXBlOiAibGF0dGljZSIsCiAgICAgIGNvb3JkczogZmlndXJlQ29vcmRzLAogICAgICBjb2xvcnM6IGZpZ3VyZUNvbG9ycywKICAgICAgdmVydGljZXNQZXJSb3cKICAgIH07CiAgfQogIF91cGRhdGVCb3VuZHMoKSB7CiAgICBsZXQgbWluWCA9IHRoaXMuY29vcmRzWzBdWzBdLAogICAgICBtaW5ZID0gdGhpcy5jb29yZHNbMF1bMV0sCiAgICAgIG1heFggPSBtaW5YLAogICAgICBtYXhZID0gbWluWTsKICAgIGZvciAobGV0IGkgPSAxLCBpaSA9IHRoaXMuY29vcmRzLmxlbmd0aDsgaSA8IGlpOyBpKyspIHsKICAgICAgY29uc3QgeCA9IHRoaXMuY29vcmRzW2ldWzBdLAogICAgICAgIHkgPSB0aGlzLmNvb3Jkc1tpXVsxXTsKICAgICAgbWluWCA9IG1pblggPiB4ID8geCA6IG1pblg7CiAgICAgIG1pblkgPSBtaW5ZID4geSA/IHkgOiBtaW5ZOwogICAgICBtYXhYID0gbWF4WCA8IHggPyB4IDogbWF4WDsKICAgICAgbWF4WSA9IG1heFkgPCB5ID8geSA6IG1heFk7CiAgICB9CiAgICB0aGlzLmJvdW5kcyA9IFttaW5YLCBtaW5ZLCBtYXhYLCBtYXhZXTsKICB9CiAgX3BhY2tEYXRhKCkgewogICAgbGV0IGksIGlpLCBqLCBqajsKICAgIGNvbnN0IGNvb3JkcyA9IHRoaXMuY29vcmRzOwogICAgY29uc3QgY29vcmRzUGFja2VkID0gbmV3IEZsb2F0MzJBcnJheShjb29yZHMubGVuZ3RoICogMik7CiAgICBmb3IgKGkgPSAwLCBqID0gMCwgaWkgPSBjb29yZHMubGVuZ3RoOyBpIDwgaWk7IGkrKykgewogICAgICBjb25zdCB4eSA9IGNvb3Jkc1tpXTsKICAgICAgY29vcmRzUGFja2VkW2orK10gPSB4eVswXTsKICAgICAgY29vcmRzUGFja2VkW2orK10gPSB4eVsxXTsKICAgIH0KICAgIHRoaXMuY29vcmRzID0gY29vcmRzUGFja2VkOwogICAgY29uc3QgY29sb3JzID0gdGhpcy5jb2xvcnM7CiAgICBjb25zdCBjb2xvcnNQYWNrZWQgPSBuZXcgVWludDhBcnJheShjb2xvcnMubGVuZ3RoICogMyk7CiAgICBmb3IgKGkgPSAwLCBqID0gMCwgaWkgPSBjb2xvcnMubGVuZ3RoOyBpIDwgaWk7IGkrKykgewogICAgICBjb25zdCBjID0gY29sb3JzW2ldOwogICAgICBjb2xvcnNQYWNrZWRbaisrXSA9IGNbMF07CiAgICAgIGNvbG9yc1BhY2tlZFtqKytdID0gY1sxXTsKICAgICAgY29sb3JzUGFja2VkW2orK10gPSBjWzJdOwogICAgfQogICAgdGhpcy5jb2xvcnMgPSBjb2xvcnNQYWNrZWQ7CiAgICBjb25zdCBmaWd1cmVzID0gdGhpcy5maWd1cmVzOwogICAgZm9yIChpID0gMCwgaWkgPSBmaWd1cmVzLmxlbmd0aDsgaSA8IGlpOyBpKyspIHsKICAgICAgY29uc3QgZmlndXJlID0gZmlndXJlc1tpXSwKICAgICAgICBwcyA9IGZpZ3VyZS5jb29yZHMsCiAgICAgICAgY3MgPSBmaWd1cmUuY29sb3JzOwogICAgICBmb3IgKGogPSAwLCBqaiA9IHBzLmxlbmd0aDsgaiA8IGpqOyBqKyspIHsKICAgICAgICBwc1tqXSAqPSAyOwogICAgICAgIGNzW2pdICo9IDM7CiAgICAgIH0KICAgIH0KICB9CiAgZ2V0SVIoKSB7CiAgICByZXR1cm4gWyJNZXNoIiwgdGhpcy5zaGFkaW5nVHlwZSwgdGhpcy5jb29yZHMsIHRoaXMuY29sb3JzLCB0aGlzLmZpZ3VyZXMsIHRoaXMuYm91bmRzLCB0aGlzLmJib3gsIHRoaXMuYmFja2dyb3VuZF07CiAgfQp9CmNsYXNzIER1bW15U2hhZGluZyBleHRlbmRzIEJhc2VTaGFkaW5nIHsKICBnZXRJUigpIHsKICAgIHJldHVybiBbIkR1bW15Il07CiAgfQp9CmZ1bmN0aW9uIGdldFRpbGluZ1BhdHRlcm5JUihvcGVyYXRvckxpc3QsIGRpY3QsIGNvbG9yKSB7CiAgY29uc3QgbWF0cml4ID0gZGljdC5nZXRBcnJheSgiTWF0cml4Iik7CiAgY29uc3QgYmJveCA9IF91dGlsLlV0aWwubm9ybWFsaXplUmVjdChkaWN0LmdldEFycmF5KCJCQm94IikpOwogIGNvbnN0IHhzdGVwID0gZGljdC5nZXQoIlhTdGVwIik7CiAgY29uc3QgeXN0ZXAgPSBkaWN0LmdldCgiWVN0ZXAiKTsKICBjb25zdCBwYWludFR5cGUgPSBkaWN0LmdldCgiUGFpbnRUeXBlIik7CiAgY29uc3QgdGlsaW5nVHlwZSA9IGRpY3QuZ2V0KCJUaWxpbmdUeXBlIik7CiAgaWYgKGJib3hbMl0gLSBiYm94WzBdID09PSAwIHx8IGJib3hbM10gLSBiYm94WzFdID09PSAwKSB7CiAgICB0aHJvdyBuZXcgX3V0aWwuRm9ybWF0RXJyb3IoYEludmFsaWQgZ2V0VGlsaW5nUGF0dGVybklSIC9CQm94IGFycmF5OiBbJHtiYm94fV0uYCk7CiAgfQogIHJldHVybiBbIlRpbGluZ1BhdHRlcm4iLCBjb2xvciwgb3BlcmF0b3JMaXN0LCBtYXRyaXgsIGJib3gsIHhzdGVwLCB5c3RlcCwgcGFpbnRUeXBlLCB0aWxpbmdUeXBlXTsKfQoKLyoqKi8gfSksCi8qIDUxICovCi8qKiovICgoX191bnVzZWRfd2VicGFja19tb2R1bGUsIGV4cG9ydHMsIF9fd19wZGZqc19yZXF1aXJlX18pID0+IHsKCgoKT2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsICJfX2VzTW9kdWxlIiwgKHsKICB2YWx1ZTogdHJ1ZQp9KSk7CmV4cG9ydHMuZ2V0WGZhRm9udERpY3QgPSBnZXRYZmFGb250RGljdDsKZXhwb3J0cy5nZXRYZmFGb250TmFtZSA9IGdldFhmYUZvbnROYW1lOwp2YXIgX2NhbGlicmlfZmFjdG9ycyA9IF9fd19wZGZqc19yZXF1aXJlX18oNTIpOwp2YXIgX3ByaW1pdGl2ZXMgPSBfX3dfcGRmanNfcmVxdWlyZV9fKDQpOwp2YXIgX2hlbHZldGljYV9mYWN0b3JzID0gX193X3BkZmpzX3JlcXVpcmVfXyg1Myk7CnZhciBfbGliZXJhdGlvbnNhbnNfd2lkdGhzID0gX193X3BkZmpzX3JlcXVpcmVfXyg1NCk7CnZhciBfbXlyaWFkcHJvX2ZhY3RvcnMgPSBfX3dfcGRmanNfcmVxdWlyZV9fKDU1KTsKdmFyIF9zZWdvZXVpX2ZhY3RvcnMgPSBfX3dfcGRmanNfcmVxdWlyZV9fKDU2KTsKdmFyIF9jb3JlX3V0aWxzID0gX193X3BkZmpzX3JlcXVpcmVfXygzKTsKdmFyIF9mb250c191dGlscyA9IF9fd19wZGZqc19yZXF1aXJlX18oMzgpOwpjb25zdCBnZXRYRkFGb250TWFwID0gKDAsIF9jb3JlX3V0aWxzLmdldExvb2t1cFRhYmxlRmFjdG9yeSkoZnVuY3Rpb24gKHQpIHsKICB0WyJNeXJpYWRQcm8tUmVndWxhciJdID0gdFsiUGRmSlMtRmFsbGJhY2stUmVndWxhciJdID0gewogICAgbmFtZTogIkxpYmVyYXRpb25TYW5zLVJlZ3VsYXIiLAogICAgZmFjdG9yczogX215cmlhZHByb19mYWN0b3JzLk15cmlhZFByb1JlZ3VsYXJGYWN0b3JzLAogICAgYmFzZVdpZHRoczogX2xpYmVyYXRpb25zYW5zX3dpZHRocy5MaWJlcmF0aW9uU2Fuc1JlZ3VsYXJXaWR0aHMsCiAgICBiYXNlTWFwcGluZzogX2xpYmVyYXRpb25zYW5zX3dpZHRocy5MaWJlcmF0aW9uU2Fuc1JlZ3VsYXJNYXBwaW5nLAogICAgbWV0cmljczogX215cmlhZHByb19mYWN0b3JzLk15cmlhZFByb1JlZ3VsYXJNZXRyaWNzCiAgfTsKICB0WyJNeXJpYWRQcm8tQm9sZCJdID0gdFsiUGRmSlMtRmFsbGJhY2stQm9sZCJdID0gewogICAgbmFtZTogIkxpYmVyYXRpb25TYW5zLUJvbGQiLAogICAgZmFjdG9yczogX215cmlhZHByb19mYWN0b3JzLk15cmlhZFByb0JvbGRGYWN0b3JzLAogICAgYmFzZVdpZHRoczogX2xpYmVyYXRpb25zYW5zX3dpZHRocy5MaWJlcmF0aW9uU2Fuc0JvbGRXaWR0aHMsCiAgICBiYXNlTWFwcGluZzogX2xpYmVyYXRpb25zYW5zX3dpZHRocy5MaWJlcmF0aW9uU2Fuc0JvbGRNYXBwaW5nLAogICAgbWV0cmljczogX215cmlhZHByb19mYWN0b3JzLk15cmlhZFByb0JvbGRNZXRyaWNzCiAgfTsKICB0WyJNeXJpYWRQcm8tSXQiXSA9IHRbIk15cmlhZFByby1JdGFsaWMiXSA9IHRbIlBkZkpTLUZhbGxiYWNrLUl0YWxpYyJdID0gewogICAgbmFtZTogIkxpYmVyYXRpb25TYW5zLUl0YWxpYyIsCiAgICBmYWN0b3JzOiBfbXlyaWFkcHJvX2ZhY3RvcnMuTXlyaWFkUHJvSXRhbGljRmFjdG9ycywKICAgIGJhc2VXaWR0aHM6IF9saWJlcmF0aW9uc2Fuc193aWR0aHMuTGliZXJhdGlvblNhbnNJdGFsaWNXaWR0aHMsCiAgICBiYXNlTWFwcGluZzogX2xpYmVyYXRpb25zYW5zX3dpZHRocy5MaWJlcmF0aW9uU2Fuc0l0YWxpY01hcHBpbmcsCiAgICBtZXRyaWNzOiBfbXlyaWFkcHJvX2ZhY3RvcnMuTXlyaWFkUHJvSXRhbGljTWV0cmljcwogIH07CiAgdFsiTXlyaWFkUHJvLUJvbGRJdCJdID0gdFsiTXlyaWFkUHJvLUJvbGRJdGFsaWMiXSA9IHRbIlBkZkpTLUZhbGxiYWNrLUJvbGRJdGFsaWMiXSA9IHsKICAgIG5hbWU6ICJMaWJlcmF0aW9uU2Fucy1Cb2xkSXRhbGljIiwKICAgIGZhY3RvcnM6IF9teXJpYWRwcm9fZmFjdG9ycy5NeXJpYWRQcm9Cb2xkSXRhbGljRmFjdG9ycywKICAgIGJhc2VXaWR0aHM6IF9saWJlcmF0aW9uc2Fuc193aWR0aHMuTGliZXJhdGlvblNhbnNCb2xkSXRhbGljV2lkdGhzLAogICAgYmFzZU1hcHBpbmc6IF9saWJlcmF0aW9uc2Fuc193aWR0aHMuTGliZXJhdGlvblNhbnNCb2xkSXRhbGljTWFwcGluZywKICAgIG1ldHJpY3M6IF9teXJpYWRwcm9fZmFjdG9ycy5NeXJpYWRQcm9Cb2xkSXRhbGljTWV0cmljcwogIH07CiAgdC5BcmlhbE1UID0gdC5BcmlhbCA9IHRbIkFyaWFsLVJlZ3VsYXIiXSA9IHsKICAgIG5hbWU6ICJMaWJlcmF0aW9uU2Fucy1SZWd1bGFyIiwKICAgIGJhc2VXaWR0aHM6IF9saWJlcmF0aW9uc2Fuc193aWR0aHMuTGliZXJhdGlvblNhbnNSZWd1bGFyV2lkdGhzLAogICAgYmFzZU1hcHBpbmc6IF9saWJlcmF0aW9uc2Fuc193aWR0aHMuTGliZXJhdGlvblNhbnNSZWd1bGFyTWFwcGluZwogIH07CiAgdFsiQXJpYWwtQm9sZE1UIl0gPSB0WyJBcmlhbC1Cb2xkIl0gPSB7CiAgICBuYW1lOiAiTGliZXJhdGlvblNhbnMtQm9sZCIsCiAgICBiYXNlV2lkdGhzOiBfbGliZXJhdGlvbnNhbnNfd2lkdGhzLkxpYmVyYXRpb25TYW5zQm9sZFdpZHRocywKICAgIGJhc2VNYXBwaW5nOiBfbGliZXJhdGlvbnNhbnNfd2lkdGhzLkxpYmVyYXRpb25TYW5zQm9sZE1hcHBpbmcKICB9OwogIHRbIkFyaWFsLUl0YWxpY01UIl0gPSB0WyJBcmlhbC1JdGFsaWMiXSA9IHsKICAgIG5hbWU6ICJMaWJlcmF0aW9uU2Fucy1JdGFsaWMiLAogICAgYmFzZVdpZHRoczogX2xpYmVyYXRpb25zYW5zX3dpZHRocy5MaWJlcmF0aW9uU2Fuc0l0YWxpY1dpZHRocywKICAgIGJhc2VNYXBwaW5nOiBfbGliZXJhdGlvbnNhbnNfd2lkdGhzLkxpYmVyYXRpb25TYW5zSXRhbGljTWFwcGluZwogIH07CiAgdFsiQXJpYWwtQm9sZEl0YWxpY01UIl0gPSB0WyJBcmlhbC1Cb2xkSXRhbGljIl0gPSB7CiAgICBuYW1lOiAiTGliZXJhdGlvblNhbnMtQm9sZEl0YWxpYyIsCiAgICBiYXNlV2lkdGhzOiBfbGliZXJhdGlvbnNhbnNfd2lkdGhzLkxpYmVyYXRpb25TYW5zQm9sZEl0YWxpY1dpZHRocywKICAgIGJhc2VNYXBwaW5nOiBfbGliZXJhdGlvbnNhbnNfd2lkdGhzLkxpYmVyYXRpb25TYW5zQm9sZEl0YWxpY01hcHBpbmcKICB9OwogIHRbIkNhbGlicmktUmVndWxhciJdID0gewogICAgbmFtZTogIkxpYmVyYXRpb25TYW5zLVJlZ3VsYXIiLAogICAgZmFjdG9yczogX2NhbGlicmlfZmFjdG9ycy5DYWxpYnJpUmVndWxhckZhY3RvcnMsCiAgICBiYXNlV2lkdGhzOiBfbGliZXJhdGlvbnNhbnNfd2lkdGhzLkxpYmVyYXRpb25TYW5zUmVndWxhcldpZHRocywKICAgIGJhc2VNYXBwaW5nOiBfbGliZXJhdGlvbnNhbnNfd2lkdGhzLkxpYmVyYXRpb25TYW5zUmVndWxhck1hcHBpbmcsCiAgICBtZXRyaWNzOiBfY2FsaWJyaV9mYWN0b3JzLkNhbGlicmlSZWd1bGFyTWV0cmljcwogIH07CiAgdFsiQ2FsaWJyaS1Cb2xkIl0gPSB7CiAgICBuYW1lOiAiTGliZXJhdGlvblNhbnMtQm9sZCIsCiAgICBmYWN0b3JzOiBfY2FsaWJyaV9mYWN0b3JzLkNhbGlicmlCb2xkRmFjdG9ycywKICAgIGJhc2VXaWR0aHM6IF9saWJlcmF0aW9uc2Fuc193aWR0aHMuTGliZXJhdGlvblNhbnNCb2xkV2lkdGhzLAogICAgYmFzZU1hcHBpbmc6IF9saWJlcmF0aW9uc2Fuc193aWR0aHMuTGliZXJhdGlvblNhbnNCb2xkTWFwcGluZywKICAgIG1ldHJpY3M6IF9jYWxpYnJpX2ZhY3RvcnMuQ2FsaWJyaUJvbGRNZXRyaWNzCiAgfTsKICB0WyJDYWxpYnJpLUl0YWxpYyJdID0gewogICAgbmFtZTogIkxpYmVyYXRpb25TYW5zLUl0YWxpYyIsCiAgICBmYWN0b3JzOiBfY2FsaWJyaV9mYWN0b3JzLkNhbGlicmlJdGFsaWNGYWN0b3JzLAogICAgYmFzZVdpZHRoczogX2xpYmVyYXRpb25zYW5zX3dpZHRocy5MaWJlcmF0aW9uU2Fuc0l0YWxpY1dpZHRocywKICAgIGJhc2VNYXBwaW5nOiBfbGliZXJhdGlvbnNhbnNfd2lkdGhzLkxpYmVyYXRpb25TYW5zSXRhbGljTWFwcGluZywKICAgIG1ldHJpY3M6IF9jYWxpYnJpX2ZhY3RvcnMuQ2FsaWJyaUl0YWxpY01ldHJpY3MKICB9OwogIHRbIkNhbGlicmktQm9sZEl0YWxpYyJdID0gewogICAgbmFtZTogIkxpYmVyYXRpb25TYW5zLUJvbGRJdGFsaWMiLAogICAgZmFjdG9yczogX2NhbGlicmlfZmFjdG9ycy5DYWxpYnJpQm9sZEl0YWxpY0ZhY3RvcnMsCiAgICBiYXNlV2lkdGhzOiBfbGliZXJhdGlvbnNhbnNfd2lkdGhzLkxpYmVyYXRpb25TYW5zQm9sZEl0YWxpY1dpZHRocywKICAgIGJhc2VNYXBwaW5nOiBfbGliZXJhdGlvbnNhbnNfd2lkdGhzLkxpYmVyYXRpb25TYW5zQm9sZEl0YWxpY01hcHBpbmcsCiAgICBtZXRyaWNzOiBfY2FsaWJyaV9mYWN0b3JzLkNhbGlicmlCb2xkSXRhbGljTWV0cmljcwogIH07CiAgdFsiU2Vnb2V1aS1SZWd1bGFyIl0gPSB7CiAgICBuYW1lOiAiTGliZXJhdGlvblNhbnMtUmVndWxhciIsCiAgICBmYWN0b3JzOiBfc2Vnb2V1aV9mYWN0b3JzLlNlZ29ldWlSZWd1bGFyRmFjdG9ycywKICAgIGJhc2VXaWR0aHM6IF9saWJlcmF0aW9uc2Fuc193aWR0aHMuTGliZXJhdGlvblNhbnNSZWd1bGFyV2lkdGhzLAogICAgYmFzZU1hcHBpbmc6IF9saWJlcmF0aW9uc2Fuc193aWR0aHMuTGliZXJhdGlvblNhbnNSZWd1bGFyTWFwcGluZywKICAgIG1ldHJpY3M6IF9zZWdvZXVpX2ZhY3RvcnMuU2Vnb2V1aVJlZ3VsYXJNZXRyaWNzCiAgfTsKICB0WyJTZWdvZXVpLUJvbGQiXSA9IHsKICAgIG5hbWU6ICJMaWJlcmF0aW9uU2Fucy1Cb2xkIiwKICAgIGZhY3RvcnM6IF9zZWdvZXVpX2ZhY3RvcnMuU2Vnb2V1aUJvbGRGYWN0b3JzLAogICAgYmFzZVdpZHRoczogX2xpYmVyYXRpb25zYW5zX3dpZHRocy5MaWJlcmF0aW9uU2Fuc0JvbGRXaWR0aHMsCiAgICBiYXNlTWFwcGluZzogX2xpYmVyYXRpb25zYW5zX3dpZHRocy5MaWJlcmF0aW9uU2Fuc0JvbGRNYXBwaW5nLAogICAgbWV0cmljczogX3NlZ29ldWlfZmFjdG9ycy5TZWdvZXVpQm9sZE1ldHJpY3MKICB9OwogIHRbIlNlZ29ldWktSXRhbGljIl0gPSB7CiAgICBuYW1lOiAiTGliZXJhdGlvblNhbnMtSXRhbGljIiwKICAgIGZhY3RvcnM6IF9zZWdvZXVpX2ZhY3RvcnMuU2Vnb2V1aUl0YWxpY0ZhY3RvcnMsCiAgICBiYXNlV2lkdGhzOiBfbGliZXJhdGlvbnNhbnNfd2lkdGhzLkxpYmVyYXRpb25TYW5zSXRhbGljV2lkdGhzLAogICAgYmFzZU1hcHBpbmc6IF9saWJlcmF0aW9uc2Fuc193aWR0aHMuTGliZXJhdGlvblNhbnNJdGFsaWNNYXBwaW5nLAogICAgbWV0cmljczogX3NlZ29ldWlfZmFjdG9ycy5TZWdvZXVpSXRhbGljTWV0cmljcwogIH07CiAgdFsiU2Vnb2V1aS1Cb2xkSXRhbGljIl0gPSB7CiAgICBuYW1lOiAiTGliZXJhdGlvblNhbnMtQm9sZEl0YWxpYyIsCiAgICBmYWN0b3JzOiBfc2Vnb2V1aV9mYWN0b3JzLlNlZ29ldWlCb2xkSXRhbGljRmFjdG9ycywKICAgIGJhc2VXaWR0aHM6IF9saWJlcmF0aW9uc2Fuc193aWR0aHMuTGliZXJhdGlvblNhbnNCb2xkSXRhbGljV2lkdGhzLAogICAgYmFzZU1hcHBpbmc6IF9saWJlcmF0aW9uc2Fuc193aWR0aHMuTGliZXJhdGlvblNhbnNCb2xkSXRhbGljTWFwcGluZywKICAgIG1ldHJpY3M6IF9zZWdvZXVpX2ZhY3RvcnMuU2Vnb2V1aUJvbGRJdGFsaWNNZXRyaWNzCiAgfTsKICB0WyJIZWx2ZXRpY2EtUmVndWxhciJdID0gdC5IZWx2ZXRpY2EgPSB7CiAgICBuYW1lOiAiTGliZXJhdGlvblNhbnMtUmVndWxhciIsCiAgICBmYWN0b3JzOiBfaGVsdmV0aWNhX2ZhY3RvcnMuSGVsdmV0aWNhUmVndWxhckZhY3RvcnMsCiAgICBiYXNlV2lkdGhzOiBfbGliZXJhdGlvbnNhbnNfd2lkdGhzLkxpYmVyYXRpb25TYW5zUmVndWxhcldpZHRocywKICAgIGJhc2VNYXBwaW5nOiBfbGliZXJhdGlvbnNhbnNfd2lkdGhzLkxpYmVyYXRpb25TYW5zUmVndWxhck1hcHBpbmcsCiAgICBtZXRyaWNzOiBfaGVsdmV0aWNhX2ZhY3RvcnMuSGVsdmV0aWNhUmVndWxhck1ldHJpY3MKICB9OwogIHRbIkhlbHZldGljYS1Cb2xkIl0gPSB7CiAgICBuYW1lOiAiTGliZXJhdGlvblNhbnMtQm9sZCIsCiAgICBmYWN0b3JzOiBfaGVsdmV0aWNhX2ZhY3RvcnMuSGVsdmV0aWNhQm9sZEZhY3RvcnMsCiAgICBiYXNlV2lkdGhzOiBfbGliZXJhdGlvbnNhbnNfd2lkdGhzLkxpYmVyYXRpb25TYW5zQm9sZFdpZHRocywKICAgIGJhc2VNYXBwaW5nOiBfbGliZXJhdGlvbnNhbnNfd2lkdGhzLkxpYmVyYXRpb25TYW5zQm9sZE1hcHBpbmcsCiAgICBtZXRyaWNzOiBfaGVsdmV0aWNhX2ZhY3RvcnMuSGVsdmV0aWNhQm9sZE1ldHJpY3MKICB9OwogIHRbIkhlbHZldGljYS1JdGFsaWMiXSA9IHsKICAgIG5hbWU6ICJMaWJlcmF0aW9uU2Fucy1JdGFsaWMiLAogICAgZmFjdG9yczogX2hlbHZldGljYV9mYWN0b3JzLkhlbHZldGljYUl0YWxpY0ZhY3RvcnMsCiAgICBiYXNlV2lkdGhzOiBfbGliZXJhdGlvbnNhbnNfd2lkdGhzLkxpYmVyYXRpb25TYW5zSXRhbGljV2lkdGhzLAogICAgYmFzZU1hcHBpbmc6IF9saWJlcmF0aW9uc2Fuc193aWR0aHMuTGliZXJhdGlvblNhbnNJdGFsaWNNYXBwaW5nLAogICAgbWV0cmljczogX2hlbHZldGljYV9mYWN0b3JzLkhlbHZldGljYUl0YWxpY01ldHJpY3MKICB9OwogIHRbIkhlbHZldGljYS1Cb2xkSXRhbGljIl0gPSB7CiAgICBuYW1lOiAiTGliZXJhdGlvblNhbnMtQm9sZEl0YWxpYyIsCiAgICBmYWN0b3JzOiBfaGVsdmV0aWNhX2ZhY3RvcnMuSGVsdmV0aWNhQm9sZEl0YWxpY0ZhY3RvcnMsCiAgICBiYXNlV2lkdGhzOiBfbGliZXJhdGlvbnNhbnNfd2lkdGhzLkxpYmVyYXRpb25TYW5zQm9sZEl0YWxpY1dpZHRocywKICAgIGJhc2VNYXBwaW5nOiBfbGliZXJhdGlvbnNhbnNfd2lkdGhzLkxpYmVyYXRpb25TYW5zQm9sZEl0YWxpY01hcHBpbmcsCiAgICBtZXRyaWNzOiBfaGVsdmV0aWNhX2ZhY3RvcnMuSGVsdmV0aWNhQm9sZEl0YWxpY01ldHJpY3MKICB9Owp9KTsKZnVuY3Rpb24gZ2V0WGZhRm9udE5hbWUobmFtZSkgewogIGNvbnN0IGZvbnROYW1lID0gKDAsIF9mb250c191dGlscy5ub3JtYWxpemVGb250TmFtZSkobmFtZSk7CiAgY29uc3QgZm9udE1hcCA9IGdldFhGQUZvbnRNYXAoKTsKICByZXR1cm4gZm9udE1hcFtmb250TmFtZV07Cn0KZnVuY3Rpb24gZ2V0WGZhRm9udFdpZHRocyhuYW1lKSB7CiAgY29uc3QgaW5mbyA9IGdldFhmYUZvbnROYW1lKG5hbWUpOwogIGlmICghaW5mbykgewogICAgcmV0dXJuIG51bGw7CiAgfQogIGNvbnN0IHsKICAgIGJhc2VXaWR0aHMsCiAgICBiYXNlTWFwcGluZywKICAgIGZhY3RvcnMKICB9ID0gaW5mbzsKICBjb25zdCByZXNjYWxlZEJhc2VXaWR0aHMgPSAhZmFjdG9ycyA/IGJhc2VXaWR0aHMgOiBiYXNlV2lkdGhzLm1hcCgodywgaSkgPT4gdyAqIGZhY3RvcnNbaV0pOwogIGxldCBjdXJyZW50Q29kZSA9IC0yOwogIGxldCBjdXJyZW50QXJyYXk7CiAgY29uc3QgbmV3V2lkdGhzID0gW107CiAgZm9yIChjb25zdCBbdW5pY29kZSwgZ2x5cGhJbmRleF0gb2YgYmFzZU1hcHBpbmcubWFwKChjaGFyVW5pY29kZSwgaW5kZXgpID0+IFtjaGFyVW5pY29kZSwgaW5kZXhdKS5zb3J0KChbdW5pY29kZTFdLCBbdW5pY29kZTJdKSA9PiB1bmljb2RlMSAtIHVuaWNvZGUyKSkgewogICAgaWYgKHVuaWNvZGUgPT09IC0xKSB7CiAgICAgIGNvbnRpbnVlOwogICAgfQogICAgaWYgKHVuaWNvZGUgPT09IGN1cnJlbnRDb2RlICsgMSkgewogICAgICBjdXJyZW50QXJyYXkucHVzaChyZXNjYWxlZEJhc2VXaWR0aHNbZ2x5cGhJbmRleF0pOwogICAgICBjdXJyZW50Q29kZSArPSAxOwogICAgfSBlbHNlIHsKICAgICAgY3VycmVudENvZGUgPSB1bmljb2RlOwogICAgICBjdXJyZW50QXJyYXkgPSBbcmVzY2FsZWRCYXNlV2lkdGhzW2dseXBoSW5kZXhdXTsKICAgICAgbmV3V2lkdGhzLnB1c2godW5pY29kZSwgY3VycmVudEFycmF5KTsKICAgIH0KICB9CiAgcmV0dXJuIG5ld1dpZHRoczsKfQpmdW5jdGlvbiBnZXRYZmFGb250RGljdChuYW1lKSB7CiAgY29uc3Qgd2lkdGhzID0gZ2V0WGZhRm9udFdpZHRocyhuYW1lKTsKICBjb25zdCBkaWN0ID0gbmV3IF9wcmltaXRpdmVzLkRpY3QobnVsbCk7CiAgZGljdC5zZXQoIkJhc2VGb250IiwgX3ByaW1pdGl2ZXMuTmFtZS5nZXQobmFtZSkpOwogIGRpY3Quc2V0KCJUeXBlIiwgX3ByaW1pdGl2ZXMuTmFtZS5nZXQoIkZvbnQiKSk7CiAgZGljdC5zZXQoIlN1YnR5cGUiLCBfcHJpbWl0aXZlcy5OYW1lLmdldCgiQ0lERm9udFR5cGUyIikpOwogIGRpY3Quc2V0KCJFbmNvZGluZyIsIF9wcmltaXRpdmVzLk5hbWUuZ2V0KCJJZGVudGl0eS1IIikpOwogIGRpY3Quc2V0KCJDSURUb0dJRE1hcCIsIF9wcmltaXRpdmVzLk5hbWUuZ2V0KCJJZGVudGl0eSIpKTsKICBkaWN0LnNldCgiVyIsIHdpZHRocyk7CiAgZGljdC5zZXQoIkZpcnN0Q2hhciIsIHdpZHRoc1swXSk7CiAgZGljdC5zZXQoIkxhc3RDaGFyIiwgd2lkdGhzLmF0KC0yKSArIHdpZHRocy5hdCgtMSkubGVuZ3RoIC0gMSk7CiAgY29uc3QgZGVzY3JpcHRvciA9IG5ldyBfcHJpbWl0aXZlcy5EaWN0KG51bGwpOwogIGRpY3Quc2V0KCJGb250RGVzY3JpcHRvciIsIGRlc2NyaXB0b3IpOwogIGNvbnN0IHN5c3RlbUluZm8gPSBuZXcgX3ByaW1pdGl2ZXMuRGljdChudWxsKTsKICBzeXN0ZW1JbmZvLnNldCgiT3JkZXJpbmciLCAiSWRlbnRpdHkiKTsKICBzeXN0ZW1JbmZvLnNldCgiUmVnaXN0cnkiLCAiQWRvYmUiKTsKICBzeXN0ZW1JbmZvLnNldCgiU3VwcGxlbWVudCIsIDApOwogIGRpY3Quc2V0KCJDSURTeXN0ZW1JbmZvIiwgc3lzdGVtSW5mbyk7CiAgcmV0dXJuIGRpY3Q7Cn0KCi8qKiovIH0pLAovKiA1MiAqLwovKioqLyAoKF9fdW51c2VkX3dlYnBhY2tfbW9kdWxlLCBleHBvcnRzKSA9PiB7CgoKCk9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCAiX19lc01vZHVsZSIsICh7CiAgdmFsdWU6IHRydWUKfSkpOwpleHBvcnRzLkNhbGlicmlSZWd1bGFyTWV0cmljcyA9IGV4cG9ydHMuQ2FsaWJyaVJlZ3VsYXJGYWN0b3JzID0gZXhwb3J0cy5DYWxpYnJpSXRhbGljTWV0cmljcyA9IGV4cG9ydHMuQ2FsaWJyaUl0YWxpY0ZhY3RvcnMgPSBleHBvcnRzLkNhbGlicmlCb2xkTWV0cmljcyA9IGV4cG9ydHMuQ2FsaWJyaUJvbGRJdGFsaWNNZXRyaWNzID0gZXhwb3J0cy5DYWxpYnJpQm9sZEl0YWxpY0ZhY3RvcnMgPSBleHBvcnRzLkNhbGlicmlCb2xkRmFjdG9ycyA9IHZvaWQgMDsKY29uc3QgQ2FsaWJyaUJvbGRGYWN0b3JzID0gWzEuMzg3NywgMSwgMSwgMSwgMC45NzgwMSwgMC45MjQ4MiwgMC44OTU1MiwgMC45MTEzMywgMC44MTk4OCwgMC45NzU2NiwgMC45ODE1MiwgMC45MzU0OCwgMC45MzU0OCwgMS4yNzk4LCAwLjg1Mjg0LCAwLjkyNzk0LCAxLCAwLjk2MTM0LCAxLjU0NjU3LCAwLjkxMTMzLCAwLjkxMTMzLCAwLjkxMTMzLCAwLjkxMTMzLCAwLjkxMTMzLCAwLjkxMTMzLCAwLjkxMTMzLCAwLjkxMTMzLCAwLjkxMTMzLCAwLjkxMTMzLCAwLjgyODQ1LCAwLjgyODQ1LCAwLjg1Mjg0LCAwLjg1Mjg0LCAwLjg1Mjg0LCAwLjc1ODU5LCAwLjkyMTM4LCAwLjgzOTA4LCAwLjc3NjIsIDAuNzMyOTMsIDAuODcyODksIDAuNzMxMzMsIDAuNzUxNCwgMC44MTkyMSwgMC44NzM1NiwgMC45NTk1OCwgMC41OTUyNiwgMC43NTcyNywgMC42OTIyNSwgMS4wNDkyNCwgMC45MTIxLCAwLjg2OTQzLCAwLjc5Nzk1LCAwLjg4MTk4LCAwLjc3OTU4LCAwLjcwODY0LCAwLjgxMDU1LCAwLjkwMzk5LCAwLjg4NjUzLCAwLjk2MDE3LCAwLjgyNTc3LCAwLjc3ODkyLCAwLjc4MjU3LCAwLjk3NTA3LCAxLjU0NjU3LCAwLjk3NTA3LCAwLjg1Mjg0LCAwLjg5NTUyLCAwLjkwMTc2LCAwLjg4NzYyLCAwLjg3ODUsIDAuNzUyNDEsIDAuODc4NSwgMC45MDUxOCwgMC45NTAxNSwgMC43NzYxOCwgMC44Nzg1LCAwLjg4NDAxLCAwLjkxOTE2LCAwLjg2MzA0LCAwLjg4NDAxLCAwLjkxNDg4LCAwLjg3ODUsIDAuODgwMSwgMC44Nzg1LCAwLjg3ODUsIDAuOTEzNDMsIDAuNzE3MywgMS4wNDEwNiwgMC44Nzg1LCAwLjg1MDc1LCAwLjk1Nzk0LCAwLjgyNjE2LCAwLjg1MTYyLCAwLjc5NDkyLCAwLjg4MzMxLCAxLjY5ODA4LCAwLjg4MzMxLCAwLjg1Mjg0LCAwLjk3ODAxLCAwLjg5NTUyLCAwLjkxMTMzLCAwLjg5NTUyLCAwLjkxMTMzLCAxLjc4MDEsIDAuODk1NTIsIDEuMjQ0ODcsIDEuMTMyNTQsIDEuMTI0MDEsIDAuOTY4MzksIDAuODUyODQsIDAuNjg3ODcsIDAuNzA2NDUsIDAuODU1OTIsIDAuOTA3NDcsIDEuMDE0NjYsIDEuMDA4OCwgMC45MDMyMywgMSwgMS4wNzQ2MywgMSwgMC45MTA1NiwgMC43NTgwNiwgMS4xOTExOCwgMC45NjgzOSwgMC43ODg2NCwgMC44Mjg0NSwgMC44NDEzMywgMC43NTg1OSwgMC44MzkwOCwgMC44MzkwOCwgMC44MzkwOCwgMC44MzkwOCwgMC44MzkwOCwgMC44MzkwOCwgMC43NzUzOSwgMC43MzI5MywgMC43MzEzMywgMC43MzEzMywgMC43MzEzMywgMC43MzEzMywgMC45NTk1OCwgMC45NTk1OCwgMC45NTk1OCwgMC45NTk1OCwgMC44ODUwNiwgMC45MTIxLCAwLjg2OTQzLCAwLjg2OTQzLCAwLjg2OTQzLCAwLjg2OTQzLCAwLjg2OTQzLCAwLjg1Mjg0LCAwLjg3NTA4LCAwLjkwMzk5LCAwLjkwMzk5LCAwLjkwMzk5LCAwLjkwMzk5LCAwLjc3ODkyLCAwLjc5Nzk1LCAwLjkwODA3LCAwLjg4NzYyLCAwLjg4NzYyLCAwLjg4NzYyLCAwLjg4NzYyLCAwLjg4NzYyLCAwLjg4NzYyLCAwLjg3MTUsIDAuNzUyNDEsIDAuOTA1MTgsIDAuOTA1MTgsIDAuOTA1MTgsIDAuOTA1MTgsIDAuODg0MDEsIDAuODg0MDEsIDAuODg0MDEsIDAuODg0MDEsIDAuODc4NSwgMC44Nzg1LCAwLjg4MDEsIDAuODgwMSwgMC44ODAxLCAwLjg4MDEsIDAuODgwMSwgMC45MDc0NywgMC44OTA0OSwgMC44Nzg1LCAwLjg3ODUsIDAuODc4NSwgMC44Nzg1LCAwLjg1MTYyLCAwLjg3ODUsIDAuODUxNjIsIDAuODM5MDgsIDAuODg3NjIsIDAuODM5MDgsIDAuODg3NjIsIDAuODM5MDgsIDAuODg3NjIsIDAuNzMyOTMsIDAuNzUyNDEsIDAuNzMyOTMsIDAuNzUyNDEsIDAuNzMyOTMsIDAuNzUyNDEsIDAuNzMyOTMsIDAuNzUyNDEsIDAuODcyODksIDAuODMwMTYsIDAuODg1MDYsIDAuOTMxMjUsIDAuNzMxMzMsIDAuOTA1MTgsIDAuNzMxMzMsIDAuOTA1MTgsIDAuNzMxMzMsIDAuOTA1MTgsIDAuNzMxMzMsIDAuOTA1MTgsIDAuNzMxMzMsIDAuOTA1MTgsIDAuODE5MjEsIDAuNzc2MTgsIDAuODE5MjEsIDAuNzc2MTgsIDAuODE5MjEsIDAuNzc2MTgsIDEsIDEsIDAuODczNTYsIDAuODc4NSwgMC45MTA3NSwgMC44OTYwOCwgMC45NTk1OCwgMC44ODQwMSwgMC45NTk1OCwgMC44ODQwMSwgMC45NTk1OCwgMC44ODQwMSwgMC45NTk1OCwgMC44ODQwMSwgMC45NTk1OCwgMC44ODQwMSwgMC43NjIyOSwgMC45MDE2NywgMC41OTUyNiwgMC45MTkxNiwgMSwgMSwgMC44NjMwNCwgMC42OTIyNSwgMC44ODQwMSwgMSwgMSwgMC43MDQyNCwgMC43OTQ2OCwgMC45MTkyNiwgMC44ODE3NSwgMC43MDgyMywgMC45NDkwMywgMC45MTIxLCAwLjg3ODUsIDEsIDEsIDAuOTEyMSwgMC44Nzg1LCAwLjg3ODAyLCAwLjg4NjU2LCAwLjg3ODUsIDAuODY5NDMsIDAuODgwMSwgMC44Njk0MywgMC44ODAxLCAwLjg2OTQzLCAwLjg4MDEsIDAuODc0MDIsIDAuODkyOTEsIDAuNzc5NTgsIDAuOTEzNDMsIDEsIDEsIDAuNzc5NTgsIDAuOTEzNDMsIDAuNzA4NjQsIDAuNzE3MywgMC43MDg2NCwgMC43MTczLCAwLjcwODY0LCAwLjcxNzMsIDAuNzA4NjQsIDAuNzE3MywgMSwgMSwgMC44MTA1NSwgMC43NTg0MSwgMC44MTA1NSwgMS4wNjQ1MiwgMC45MDM5OSwgMC44Nzg1LCAwLjkwMzk5LCAwLjg3ODUsIDAuOTAzOTksIDAuODc4NSwgMC45MDM5OSwgMC44Nzg1LCAwLjkwMzk5LCAwLjg3ODUsIDAuOTAzOTksIDAuODc4NSwgMC45NjAxNywgMC45NTc5NCwgMC43Nzg5MiwgMC44NTE2MiwgMC43Nzg5MiwgMC43ODI1NywgMC43OTQ5MiwgMC43ODI1NywgMC43OTQ5MiwgMC43ODI1NywgMC43OTQ5MiwgMC45Mjk3LCAwLjU2ODkyLCAwLjgzOTA4LCAwLjg4NzYyLCAwLjc3NTM5LCAwLjg3MTUsIDAuODc1MDgsIDAuODkwNDksIDEsIDEsIDAuODEwNTUsIDEuMDQxMDYsIDEuMjA1MjgsIDEuMjA1MjgsIDEsIDEuMTU1NDMsIDAuNzA2NzQsIDAuOTgzODcsIDAuOTQ3MjEsIDEuMzM0MzEsIDEuNDU4OTQsIDAuOTUxNjEsIDEuMDYzMDMsIDAuODM5MDgsIDAuODAzNTIsIDAuNTcxODQsIDAuNjk2NSwgMC41NjI4OSwgMC44MjAwMSwgMC41NjAyOSwgMC44MTIzNSwgMS4wMjk4OCwgMC44MzkwOCwgMC43NzYyLCAwLjY4MTU2LCAwLjgwMzY3LCAwLjczMTMzLCAwLjc4MjU3LCAwLjg3MzU2LCAwLjg2OTQzLCAwLjk1OTU4LCAwLjc1NzI3LCAwLjg5MDE5LCAxLjA0OTI0LCAwLjkxMjEsIDAuNzY0OCwgMC44Njk0MywgMC44NzM1NiwgMC43OTc5NSwgMC43ODI3NSwgMC44MTA1NSwgMC43Nzg5MiwgMC45NzYyLCAwLjgyNTc3LCAwLjk5ODE5LCAwLjg0ODk2LCAwLjk1OTU4LCAwLjc3ODkyLCAwLjk2MTA4LCAxLjAxNDA3LCAwLjg5MDQ5LCAxLjAyOTg4LCAwLjk0MjExLCAwLjk2MTA4LCAwLjg5MzYsIDAuODQwMjEsIDAuODc4NDIsIDAuOTYzOTksIDAuNzkxMDksIDAuODkwNDksIDEuMDA4MTMsIDEuMDI5ODgsIDAuODYwNzcsIDAuODc0NDUsIDAuOTIwOTksIDAuODQ3MjMsIDAuODY1MTMsIDAuODgwMSwgMC43NTYzOCwgMC44NTcxNCwgMC43ODIxNiwgMC43OTU4NiwgMC44Nzk2NSwgMC45NDIxMSwgMC45Nzc0NywgMC43ODI4NywgMC45NzkyNiwgMC44NDk3MSwgMS4wMjk4OCwgMC45NDIxMSwgMC44ODAxLCAwLjk0MjExLCAwLjg0OTcxLCAwLjczMTMzLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAwLjkwMjY0LCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAwLjkwNTE4LCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAwLjkwNTQ4LCAxLCAxLCAxLCAxLCAxLCAxLCAwLjk2MDE3LCAwLjk1Nzk0LCAwLjk2MDE3LCAwLjk1Nzk0LCAwLjk2MDE3LCAwLjk1Nzk0LCAwLjc3ODkyLCAwLjg1MTYyLCAxLCAxLCAwLjg5NTUyLCAwLjkwNTI3LCAxLCAwLjkwMzYzLCAwLjkyNzk0LCAwLjkyNzk0LCAwLjkyNzk0LCAwLjkyNzk0LCAwLjg3MDEyLCAwLjg3MDEyLCAwLjg3MDEyLCAwLjg5NTUyLCAwLjg5NTUyLCAxLjQyMjU5LCAwLjcxMTQzLCAxLjA2MTUyLCAxLCAxLCAxLjAzMzcyLCAxLjAzMzcyLCAwLjk3MTcxLCAxLjQ5NTYsIDIuMjgwNywgMC45MzgzNSwgMC44MzQwNiwgMC45MTEzMywgMC44NDEwNywgMC45MTEzMywgMSwgMSwgMSwgMC43MjAyMSwgMSwgMS4yMzEwOCwgMC44MzQ4OSwgMC44ODUyNSwgMC44ODUyNSwgMC44MTQ5OSwgMC45MDUyNywgMS44MTA1NSwgMC45MDUyNywgMS44MTA1NSwgMS4zMTAwNiwgMS41MzcxMSwgMC45NDQzNCwgMS4wODY5NiwgMSwgMC45NTAxOCwgMC43NzE5MiwgMC44NTI4NCwgMC45MDc0NywgMS4xNzUzNCwgMC42OTgyNSwgMC45NzE2LCAxLjM3MDc3LCAwLjkwNzQ3LCAwLjkwNzQ3LCAwLjg1MzU2LCAwLjkwNzQ3LCAwLjkwNzQ3LCAxLjQ0OTQ3LCAwLjg1Mjg0LCAwLjg5NDEsIDAuODk0MSwgMC43MDU3MiwgMC44LCAwLjcwNTcyLCAwLjcwNTcyLCAwLjcwNTcyLCAwLjcwNTcyLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAwLjk5ODYyLCAwLjk5ODYyLCAxLCAxLCAxLCAxLCAxLCAxLjA4MDA0LCAwLjkxMDI3LCAxLCAxLCAxLCAwLjk5ODYyLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAwLjkwNzI3LCAwLjkwNzI3LCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxXTsKZXhwb3J0cy5DYWxpYnJpQm9sZEZhY3RvcnMgPSBDYWxpYnJpQm9sZEZhY3RvcnM7CmNvbnN0IENhbGlicmlCb2xkTWV0cmljcyA9IHsKICBsaW5lSGVpZ2h0OiAxLjIyMDcsCiAgbGluZUdhcDogMC4yMjA3Cn07CmV4cG9ydHMuQ2FsaWJyaUJvbGRNZXRyaWNzID0gQ2FsaWJyaUJvbGRNZXRyaWNzOwpjb25zdCBDYWxpYnJpQm9sZEl0YWxpY0ZhY3RvcnMgPSBbMS4zODc3LCAxLCAxLCAxLCAwLjk3ODAxLCAwLjkyNDgyLCAwLjg5NTUyLCAwLjkxMTMzLCAwLjgxOTg4LCAwLjk3NTY2LCAwLjk4MTUyLCAwLjkzNTQ4LCAwLjkzNTQ4LCAxLjI3OTgsIDAuODUyODQsIDAuOTI3OTQsIDEsIDAuOTYxMzQsIDEuNTYyMzksIDAuOTExMzMsIDAuOTExMzMsIDAuOTExMzMsIDAuOTExMzMsIDAuOTExMzMsIDAuOTExMzMsIDAuOTExMzMsIDAuOTExMzMsIDAuOTExMzMsIDAuOTExMzMsIDAuODI4NDUsIDAuODI4NDUsIDAuODUyODQsIDAuODUyODQsIDAuODUyODQsIDAuNzU4NTksIDAuOTIxMzgsIDAuODM5MDgsIDAuNzc2MiwgMC43MTgwNSwgMC44NzI4OSwgMC43MzEzMywgMC43NTE0LCAwLjgxOTIxLCAwLjg3MzU2LCAwLjk1OTU4LCAwLjU5NTI2LCAwLjc1NzI3LCAwLjY5MjI1LCAxLjA0OTI0LCAwLjkwODcyLCAwLjg1OTM4LCAwLjc5Nzk1LCAwLjg3MDY4LCAwLjc3OTU4LCAwLjY5NzY2LCAwLjgxMDU1LCAwLjkwMzk5LCAwLjg4NjUzLCAwLjk2MDY4LCAwLjgyNTc3LCAwLjc3ODkyLCAwLjc4MjU3LCAwLjk3NTA3LCAxLjUyOSwgMC45NzUwNywgMC44NTI4NCwgMC44OTU1MiwgMC45MDE3NiwgMC45NDkwOCwgMC44NjQxMSwgMC43NDAxMiwgMC44NjQxMSwgMC44ODMyMywgMC45NTAxNSwgMC44NjQxMSwgMC44NjMzMSwgMC44ODQwMSwgMC45MTkxNiwgMC44NjMwNCwgMC44ODQwMSwgMC45MDM5LCAwLjg2MzMxLCAwLjg2MzMxLCAwLjg2NDExLCAwLjg2NDExLCAwLjkwNDY0LCAwLjcwODUyLCAxLjA0MTA2LCAwLjg2MzMxLCAwLjg0MzcyLCAwLjk1Nzk0LCAwLjgyNjE2LCAwLjg0NTQ4LCAwLjc5NDkyLCAwLjg4MzMxLCAxLjY5ODA4LCAwLjg4MzMxLCAwLjg1Mjg0LCAwLjk3ODAxLCAwLjg5NTUyLCAwLjkxMTMzLCAwLjg5NTUyLCAwLjkxMTMzLCAxLjc4MDEsIDAuODk1NTIsIDEuMjQ0ODcsIDEuMTMyNTQsIDEuMTkxMjksIDAuOTY4MzksIDAuODUyODQsIDAuNjg3ODcsIDAuNzA2NDUsIDAuODU1OTIsIDAuOTA3NDcsIDEuMDE0NjYsIDEuMDA4OCwgMC45MDMyMywgMSwgMS4wNzQ2MywgMSwgMC45MTA1NiwgMC43NTgwNiwgMS4xOTExOCwgMC45NjgzOSwgMC43ODg2NCwgMC44Mjg0NSwgMC44NDEzMywgMC43NTg1OSwgMC44MzkwOCwgMC44MzkwOCwgMC44MzkwOCwgMC44MzkwOCwgMC44MzkwOCwgMC44MzkwOCwgMC43NzUzOSwgMC43MTgwNSwgMC43MzEzMywgMC43MzEzMywgMC43MzEzMywgMC43MzEzMywgMC45NTk1OCwgMC45NTk1OCwgMC45NTk1OCwgMC45NTk1OCwgMC44ODUwNiwgMC45MDg3MiwgMC44NTkzOCwgMC44NTkzOCwgMC44NTkzOCwgMC44NTkzOCwgMC44NTkzOCwgMC44NTI4NCwgMC44NzA2OCwgMC45MDM5OSwgMC45MDM5OSwgMC45MDM5OSwgMC45MDM5OSwgMC43Nzg5MiwgMC43OTc5NSwgMC45MDgwNywgMC45NDkwOCwgMC45NDkwOCwgMC45NDkwOCwgMC45NDkwOCwgMC45NDkwOCwgMC45NDkwOCwgMC44NTg4NywgMC43NDAxMiwgMC44ODMyMywgMC44ODMyMywgMC44ODMyMywgMC44ODMyMywgMC44ODQwMSwgMC44ODQwMSwgMC44ODQwMSwgMC44ODQwMSwgMC44Nzg1LCAwLjg2MzMxLCAwLjg2MzMxLCAwLjg2MzMxLCAwLjg2MzMxLCAwLjg2MzMxLCAwLjg2MzMxLCAwLjkwNzQ3LCAwLjg5MDQ5LCAwLjg2MzMxLCAwLjg2MzMxLCAwLjg2MzMxLCAwLjg2MzMxLCAwLjg0NTQ4LCAwLjg2NDExLCAwLjg0NTQ4LCAwLjgzOTA4LCAwLjk0OTA4LCAwLjgzOTA4LCAwLjk0OTA4LCAwLjgzOTA4LCAwLjk0OTA4LCAwLjcxODA1LCAwLjc0MDEyLCAwLjcxODA1LCAwLjc0MDEyLCAwLjcxODA1LCAwLjc0MDEyLCAwLjcxODA1LCAwLjc0MDEyLCAwLjg3Mjg5LCAwLjc5NTM4LCAwLjg4NTA2LCAwLjkyNzI2LCAwLjczMTMzLCAwLjg4MzIzLCAwLjczMTMzLCAwLjg4MzIzLCAwLjczMTMzLCAwLjg4MzIzLCAwLjczMTMzLCAwLjg4MzIzLCAwLjczMTMzLCAwLjg4MzIzLCAwLjgxOTIxLCAwLjg2NDExLCAwLjgxOTIxLCAwLjg2NDExLCAwLjgxOTIxLCAwLjg2NDExLCAxLCAxLCAwLjg3MzU2LCAwLjg2MzMxLCAwLjkxMDc1LCAwLjg3NzcsIDAuOTU5NTgsIDAuODg0MDEsIDAuOTU5NTgsIDAuODg0MDEsIDAuOTU5NTgsIDAuODg0MDEsIDAuOTU5NTgsIDAuODg0MDEsIDAuOTU5NTgsIDAuODg0MDEsIDAuNzY0NjcsIDAuOTAxNjcsIDAuNTk1MjYsIDAuOTE5MTYsIDEsIDEsIDAuODYzMDQsIDAuNjkyMjUsIDAuODg0MDEsIDEsIDEsIDAuNzA0MjQsIDAuNzczMTIsIDAuOTE5MjYsIDAuODgxNzUsIDAuNzA4MjMsIDAuOTQ5MDMsIDAuOTA4NzIsIDAuODYzMzEsIDEsIDEsIDAuOTA4NzIsIDAuODYzMzEsIDAuODY5MDYsIDAuODgxMTYsIDAuODYzMzEsIDAuODU5MzgsIDAuODYzMzEsIDAuODU5MzgsIDAuODYzMzEsIDAuODU5MzgsIDAuODYzMzEsIDAuODc0MDIsIDAuODY1NDksIDAuNzc5NTgsIDAuOTA0NjQsIDEsIDEsIDAuNzc5NTgsIDAuOTA0NjQsIDAuNjk3NjYsIDAuNzA4NTIsIDAuNjk3NjYsIDAuNzA4NTIsIDAuNjk3NjYsIDAuNzA4NTIsIDAuNjk3NjYsIDAuNzA4NTIsIDEsIDEsIDAuODEwNTUsIDAuNzU4NDEsIDAuODEwNTUsIDEuMDY0NTIsIDAuOTAzOTksIDAuODYzMzEsIDAuOTAzOTksIDAuODYzMzEsIDAuOTAzOTksIDAuODYzMzEsIDAuOTAzOTksIDAuODYzMzEsIDAuOTAzOTksIDAuODYzMzEsIDAuOTAzOTksIDAuODYzMzEsIDAuOTYwNjgsIDAuOTU3OTQsIDAuNzc4OTIsIDAuODQ1NDgsIDAuNzc4OTIsIDAuNzgyNTcsIDAuNzk0OTIsIDAuNzgyNTcsIDAuNzk0OTIsIDAuNzgyNTcsIDAuNzk0OTIsIDAuOTI5NywgMC41Njg5MiwgMC44MzkwOCwgMC45NDkwOCwgMC43NzUzOSwgMC44NTg4NywgMC44NzA2OCwgMC44OTA0OSwgMSwgMSwgMC44MTA1NSwgMS4wNDEwNiwgMS4yMDUyOCwgMS4yMDUyOCwgMSwgMS4xNTU0MywgMC43MDA4OCwgMC45ODM4NywgMC45NDcyMSwgMS4zMzQzMSwgMS40NTg5NCwgMC45NTE2MSwgMS40ODM4NywgMC44MzkwOCwgMC44MDM1MiwgMC41NzExOCwgMC42OTY1LCAwLjU2MzQ3LCAwLjc5MTc5LCAwLjU1ODUzLCAwLjgwMzQ2LCAxLjAyOTg4LCAwLjgzOTA4LCAwLjc3NjIsIDAuNjcxNzQsIDAuODYwMzYsIDAuNzMxMzMsIDAuNzgyNTcsIDAuODczNTYsIDAuODY0NDEsIDAuOTU5NTgsIDAuNzU3MjcsIDAuODkwMTksIDEuMDQ5MjQsIDAuOTA4NzIsIDAuNzQ4ODksIDAuODU5MzgsIDAuODc4OTEsIDAuNzk3OTUsIDAuNzk1NywgMC44MTA1NSwgMC43Nzg5MiwgMC45NzQ0NywgMC44MjU3NywgMC45NzQ2NiwgMC44NzE3OSwgMC45NTk1OCwgMC43Nzg5MiwgMC45NDI1MiwgMC45NTYxMiwgMC44NzUzLCAxLjAyOTg4LCAwLjkyNzMzLCAwLjk0MjUyLCAwLjg3NDExLCAwLjg0MDIxLCAwLjg3MjgsIDAuOTU2MTIsIDAuNzQwODEsIDAuODc1MywgMS4wMjE4OSwgMS4wMjk4OCwgMC44NDgxNCwgMC44NzQ0NSwgMC45MTgyMiwgMC44NDcyMywgMC44NTY2OCwgMC44NjMzMSwgMC44MTM0NCwgMC44NzU4MSwgMC43NjQyMiwgMC44MjA0NiwgMC45NjA1NywgMC45MjczMywgMC45OTM3NSwgMC43ODAyMiwgMC45NTQ1MiwgMC44NjAxNSwgMS4wMjk4OCwgMC45MjczMywgMC44NjMzMSwgMC45MjczMywgMC44NjAxNSwgMC43MzEzMywgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMC45MDYzMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMC44ODMyMywgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMC44NTE3NCwgMSwgMSwgMSwgMSwgMSwgMSwgMC45NjA2OCwgMC45NTc5NCwgMC45NjA2OCwgMC45NTc5NCwgMC45NjA2OCwgMC45NTc5NCwgMC43Nzg5MiwgMC44NDU0OCwgMSwgMSwgMC44OTU1MiwgMC45MDUyNywgMSwgMC45MDM2MywgMC45Mjc5NCwgMC45Mjc5NCwgMC45Mjc5NCwgMC44OTgwNywgMC44NzAxMiwgMC44NzAxMiwgMC44NzAxMiwgMC44OTU1MiwgMC44OTU1MiwgMS40MjI1OSwgMC43MTA5NCwgMS4wNjE1MiwgMSwgMSwgMS4wMzM3MiwgMS4wMzM3MiwgMC45NzE3MSwgMS40OTU2LCAyLjI4MDcsIDAuOTI5NzIsIDAuODM0MDYsIDAuOTExMzMsIDAuODMzMjYsIDAuOTExMzMsIDEsIDEsIDEsIDAuNzIwMjEsIDEsIDEuMjMxMDgsIDAuODM0ODksIDAuODg1MjUsIDAuODg1MjUsIDAuODE0OTksIDAuOTA2MTYsIDEuODEwNTUsIDAuOTA1MjcsIDEuODEwNTUsIDEuMzEwNywgMS41MzcxMSwgMC45NDQzNCwgMS4wODY5NiwgMSwgMC45NTAxOCwgMC43NzE5MiwgMC44NTI4NCwgMC45MDc0NywgMS4xNzUzNCwgMC42OTgyNSwgMC45NzE2LCAxLjM3MDc3LCAwLjkwNzQ3LCAwLjkwNzQ3LCAwLjg1MzU2LCAwLjkwNzQ3LCAwLjkwNzQ3LCAxLjQ0OTQ3LCAwLjg1Mjg0LCAwLjg5NDEsIDAuODk0MSwgMC43MDU3MiwgMC44LCAwLjcwNTcyLCAwLjcwNTcyLCAwLjcwNTcyLCAwLjcwNTcyLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAwLjk5ODYyLCAwLjk5ODYyLCAxLCAxLCAxLCAxLCAxLCAxLjA4MDA0LCAwLjkxMDI3LCAxLCAxLCAxLCAwLjk5ODYyLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAwLjkwNzI3LCAwLjkwNzI3LCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxXTsKZXhwb3J0cy5DYWxpYnJpQm9sZEl0YWxpY0ZhY3RvcnMgPSBDYWxpYnJpQm9sZEl0YWxpY0ZhY3RvcnM7CmNvbnN0IENhbGlicmlCb2xkSXRhbGljTWV0cmljcyA9IHsKICBsaW5lSGVpZ2h0OiAxLjIyMDcsCiAgbGluZUdhcDogMC4yMjA3Cn07CmV4cG9ydHMuQ2FsaWJyaUJvbGRJdGFsaWNNZXRyaWNzID0gQ2FsaWJyaUJvbGRJdGFsaWNNZXRyaWNzOwpjb25zdCBDYWxpYnJpSXRhbGljRmFjdG9ycyA9IFsxLjM4NzcsIDEsIDEsIDEsIDEuMTcyMjMsIDEuMTI5MywgMC44OTU1MiwgMC45MTEzMywgMC44MDM5NSwgMS4wMjI2OSwgMS4xNTYwMSwgMC45MTA1NiwgMC45MTA1NiwgMS4yNzk4LCAwLjg1Mjg0LCAwLjg5ODA3LCAxLCAwLjkwODYxLCAxLjM5NTQzLCAwLjkxMTMzLCAwLjkxMTMzLCAwLjkxMTMzLCAwLjkxMTMzLCAwLjkxMTMzLCAwLjkxMTMzLCAwLjkxMTMzLCAwLjkxMTMzLCAwLjkxMTMzLCAwLjkxMTMzLCAwLjk2MzA5LCAwLjk2MzA5LCAwLjg1Mjg0LCAwLjg1Mjg0LCAwLjg1Mjg0LCAwLjgzMzE5LCAwLjg4MDcxLCAwLjg2NzUsIDAuODE1NTIsIDAuNzIzNDYsIDAuODUxOTMsIDAuNzMyMDYsIDAuNzUyMiwgMC44MTEwNSwgMC44NjI3NSwgMC45MDY4NSwgMC42Mzc3LCAwLjc3ODkyLCAwLjc1NTkzLCAxLjAyNjM4LCAwLjg5MjQ5LCAwLjg0MTE4LCAwLjc3NDUyLCAwLjg1Mzc0LCAwLjc1MTg2LCAwLjY3Nzg5LCAwLjc5Nzc2LCAwLjg4ODQ0LCAwLjg1MDY2LCAwLjk0MzA5LCAwLjc3ODE4LCAwLjczMDYsIDAuNzY2NTksIDEuMTAzNjksIDEuMzgzMTMsIDEuMTAzNjksIDEuMDYxMzksIDAuODk1NTIsIDAuODczOSwgMC45MjQ1LCAwLjkyNDUsIDAuODMyMDMsIDAuOTI0NSwgMC44NTg2NSwgMS4wOTg0MiwgMC45MjQ1LCAwLjkyNDUsIDEuMDMyOTcsIDEuMDc2OTIsIDAuOTA5MTgsIDEuMDMyOTcsIDAuOTQ5NTksIDAuOTI0NSwgMC45MjI3NCwgMC45MjQ1LCAwLjkyNDUsIDEuMDI5MzMsIDAuNzc4MzIsIDEuMjA1NjIsIDAuOTI0NSwgMC44OTE2LCAwLjk4OTg2LCAwLjg2NjIxLCAwLjg5NDUzLCAwLjc5MDA0LCAwLjk0MTUyLCAxLjc3MjU2LCAwLjk0MTUyLCAwLjg1Mjg0LCAwLjk3ODAxLCAwLjg5NTUyLCAwLjkxMTMzLCAwLjg5NTUyLCAwLjkxMTMzLCAxLjkxNzI5LCAwLjg5NTUyLCAxLjE3ODg5LCAxLjEzMjU0LCAxLjE2MzU5LCAwLjkyMDk4LCAwLjg1Mjg0LCAwLjY4Nzg3LCAwLjcxMzUzLCAwLjg0NzM3LCAwLjkwNzQ3LCAxLjAwODgsIDEuMDA0NCwgMC44NzY4MywgMSwgMS4wOTA5MSwgMSwgMC45MjIyOSwgMC43MzksIDEuMTU2NDIsIDAuOTIwOTgsIDAuNzYyODgsIDAuODA1MDQsIDAuODA5NzIsIDAuNzU4NTksIDAuODY3NSwgMC44Njc1LCAwLjg2NzUsIDAuODY3NSwgMC44Njc1LCAwLjg2NzUsIDAuNzYzMTgsIDAuNzIzNDYsIDAuNzMyMDYsIDAuNzMyMDYsIDAuNzMyMDYsIDAuNzMyMDYsIDAuOTA2ODUsIDAuOTA2ODUsIDAuOTA2ODUsIDAuOTA2ODUsIDAuODY0NzcsIDAuODkyNDksIDAuODQxMTgsIDAuODQxMTgsIDAuODQxMTgsIDAuODQxMTgsIDAuODQxMTgsIDAuODUyODQsIDAuODQ1NTcsIDAuODg4NDQsIDAuODg4NDQsIDAuODg4NDQsIDAuODg4NDQsIDAuNzMwNiwgMC43NzQ1MiwgMC44NjMzMSwgMC45MjQ1LCAwLjkyNDUsIDAuOTI0NSwgMC45MjQ1LCAwLjkyNDUsIDAuOTI0NSwgMC44NDg0MywgMC44MzIwMywgMC44NTg2NSwgMC44NTg2NSwgMC44NTg2NSwgMC44NTg2NSwgMC44MjYwMSwgMC44MjYwMSwgMC44MjYwMSwgMC44MjYwMSwgMC45NDQ2OSwgMC45MjQ1LCAwLjkyMjc0LCAwLjkyMjc0LCAwLjkyMjc0LCAwLjkyMjc0LCAwLjkyMjc0LCAwLjkwNzQ3LCAwLjg2NjUxLCAwLjkyNDUsIDAuOTI0NSwgMC45MjQ1LCAwLjkyNDUsIDAuODk0NTMsIDAuOTI0NSwgMC44OTQ1MywgMC44Njc1LCAwLjkyNDUsIDAuODY3NSwgMC45MjQ1LCAwLjg2NzUsIDAuOTI0NSwgMC43MjM0NiwgMC44MzIwMywgMC43MjM0NiwgMC44MzIwMywgMC43MjM0NiwgMC44MzIwMywgMC43MjM0NiwgMC44MzIwMywgMC44NTE5MywgMC44ODc1LCAwLjg2NDc3LCAwLjk5MDM0LCAwLjczMjA2LCAwLjg1ODY1LCAwLjczMjA2LCAwLjg1ODY1LCAwLjczMjA2LCAwLjg1ODY1LCAwLjczMjA2LCAwLjg1ODY1LCAwLjczMjA2LCAwLjg1ODY1LCAwLjgxMTA1LCAwLjkyNDUsIDAuODExMDUsIDAuOTI0NSwgMC44MTEwNSwgMC45MjQ1LCAxLCAxLCAwLjg2Mjc1LCAwLjkyNDUsIDAuOTA4NzIsIDAuOTM1OTEsIDAuOTA2ODUsIDAuODI2MDEsIDAuOTA2ODUsIDAuODI2MDEsIDAuOTA2ODUsIDAuODI2MDEsIDAuOTA2ODUsIDEuMDMyOTcsIDAuOTA2ODUsIDAuODI2MDEsIDAuNzc4OTYsIDEuMDU2MTEsIDAuNjM3NywgMS4wNzY5MiwgMSwgMSwgMC45MDkxOCwgMC43NTU5MywgMS4wMzI5NywgMSwgMSwgMC43NjAzMiwgMC45Mzc1LCAwLjk4MTU2LCAwLjkzNDA3LCAwLjc3MjYxLCAxLjExNDI5LCAwLjg5MjQ5LCAwLjkyNDUsIDEsIDEsIDAuODkyNDksIDAuOTI0NSwgMC45MjUzNCwgMC44NjY5OCwgMC45MjQ1LCAwLjg0MTE4LCAwLjkyMjc0LCAwLjg0MTE4LCAwLjkyMjc0LCAwLjg0MTE4LCAwLjkyMjc0LCAwLjg2NjcsIDAuODYyOTEsIDAuNzUxODYsIDEuMDI5MzMsIDEsIDEsIDAuNzUxODYsIDEuMDI5MzMsIDAuNjc3ODksIDAuNzc4MzIsIDAuNjc3ODksIDAuNzc4MzIsIDAuNjc3ODksIDAuNzc4MzIsIDAuNjc3ODksIDAuNzc4MzIsIDEsIDEsIDAuNzk3NzYsIDAuOTc2NTUsIDAuNzk3NzYsIDEuMjMwMjMsIDAuODg4NDQsIDAuOTI0NSwgMC44ODg0NCwgMC45MjQ1LCAwLjg4ODQ0LCAwLjkyNDUsIDAuODg4NDQsIDAuOTI0NSwgMC44ODg0NCwgMC45MjQ1LCAwLjg4ODQ0LCAwLjkyNDUsIDAuOTQzMDksIDAuOTg5ODYsIDAuNzMwNiwgMC44OTQ1MywgMC43MzA2LCAwLjc2NjU5LCAwLjc5MDA0LCAwLjc2NjU5LCAwLjc5MDA0LCAwLjc2NjU5LCAwLjc5MDA0LCAxLjA5MjMxLCAwLjU0ODczLCAwLjg2NzUsIDAuOTI0NSwgMC43NjMxOCwgMC44NDg0MywgMC44NDU1NywgMC44NjY1MSwgMSwgMSwgMC43OTc3NiwgMS4yMDU2MiwgMS4xODYyMiwgMS4xODYyMiwgMSwgMS4xNDM3LCAwLjY3MDA5LCAwLjk2MzM0LCAwLjkzNjk1LCAxLjM1MTkxLCAxLjQwOTA5LCAwLjk1MTYxLCAxLjQ4Mzg3LCAwLjg2NzUsIDAuOTA4NjEsIDAuNjE5MiwgMC43MzYzLCAwLjY0ODI0LCAwLjgyNDExLCAwLjU2MzIxLCAwLjg1Njk2LCAxLjIzNTE2LCAwLjg2NzUsIDAuODE1NTIsIDAuNzI4NiwgMC44NDEzNCwgMC43MzIwNiwgMC43NjY1OSwgMC44NjI3NSwgMC44NDM2OSwgMC45MDY4NSwgMC43Nzg5MiwgMC44NTg3MSwgMS4wMjYzOCwgMC44OTI0OSwgMC43NTgyOCwgMC44NDExOCwgMC44NTk4NCwgMC43NzQ1MiwgMC43NjQ2NiwgMC43OTc3NiwgMC43MzA2LCAwLjkwNzgyLCAwLjc3ODE4LCAwLjkwMywgMC44NzI5MSwgMC45MDY4NSwgMC43MzA2LCAwLjk5MDU4LCAxLjAzNjY3LCAwLjk0NjM1LCAxLjIzNTE2LCAwLjk4NDksIDAuOTkwNTgsIDAuOTIzOTMsIDAuODkxNiwgMC45NDIsIDEuMDM2NjcsIDAuNzUwMjYsIDAuOTQ2MzUsIDEuMDI5NywgMS4yMzUxNiwgMC45MDkxOCwgMC45NDA0OCwgMC45ODIxNywgMC44OTc0NiwgMC44NDE1MywgMC45MjI3NCwgMC44MjUwNywgMC44ODgzMiwgMC44NDQzOCwgMC44ODE3OCwgMS4wMzUyNSwgMC45ODQ5LCAxLjAwMjI1LCAwLjc4MDg2LCAwLjk3MjQ4LCAwLjg5NDA0LCAxLjIzNTE2LCAwLjk4NDksIDAuOTIyNzQsIDAuOTg0OSwgMC44OTQwNCwgMC43MzIwNiwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMC44OTY5MywgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMC44NTg2NSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMC45MDkzMywgMSwgMSwgMSwgMSwgMSwgMSwgMC45NDMwOSwgMC45ODk4NiwgMC45NDMwOSwgMC45ODk4NiwgMC45NDMwOSwgMC45ODk4NiwgMC43MzA2LCAwLjg5NDUzLCAxLCAxLCAwLjg5NTUyLCAwLjkwNTI3LCAxLCAwLjkwMTg2LCAxLjEyMzA4LCAxLjEyMzA4LCAxLjEyMzA4LCAxLjEyMzA4LCAxLjI1NjYsIDEuMjU2NiwgMS4yNTY2LCAwLjg5NTUyLCAwLjg5NTUyLCAxLjQyMjU5LCAwLjY4OTk0LCAxLjAzODA5LCAxLCAxLCAxLjAxNzYsIDEuMDE3NiwgMS4xMTUyMywgMS40OTU2LCAyLjAxNDYyLCAwLjk3ODU4LCAwLjgyNjE2LCAwLjkxMTMzLCAwLjgzNDM3LCAwLjkxMTMzLCAxLCAxLCAxLCAwLjcwNTA4LCAxLCAxLjIzMTA4LCAwLjc5ODAxLCAwLjg0NDI2LCAwLjg0NDI2LCAwLjc3NCwgMC45MDU3MiwgMS44MTA1NSwgMC45MDc0OSwgMS44MTA1NSwgMS4yODgwOSwgMS41NTQ2OSwgMC45NDQzNCwgMS4wNzgwNiwgMSwgMC45NzA5NCwgMC43NTg5LCAwLjg1Mjg0LCAwLjkwNzQ3LCAxLjE5NjU4LCAwLjY5ODI1LCAwLjk3NjIyLCAxLjMzNTEyLCAwLjkwNzQ3LCAwLjkwNzQ3LCAwLjg1Mjg0LCAwLjkwNzQ3LCAwLjkwNzQ3LCAxLjQ0OTQ3LCAwLjg1Mjg0LCAwLjg5NDEsIDAuODk0MSwgMC43MDU3MiwgMC44LCAwLjcwNTcyLCAwLjcwNTcyLCAwLjcwNTcyLCAwLjcwNTcyLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAwLjk5ODYyLCAwLjk5ODYyLCAxLCAxLCAxLCAxLCAxLCAxLjAzMzYsIDAuOTEwMjcsIDEsIDEsIDEsIDAuOTk4NjIsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEuMDU4NTksIDEuMDU4NTksIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDFdOwpleHBvcnRzLkNhbGlicmlJdGFsaWNGYWN0b3JzID0gQ2FsaWJyaUl0YWxpY0ZhY3RvcnM7CmNvbnN0IENhbGlicmlJdGFsaWNNZXRyaWNzID0gewogIGxpbmVIZWlnaHQ6IDEuMjIwNywKICBsaW5lR2FwOiAwLjIyMDcKfTsKZXhwb3J0cy5DYWxpYnJpSXRhbGljTWV0cmljcyA9IENhbGlicmlJdGFsaWNNZXRyaWNzOwpjb25zdCBDYWxpYnJpUmVndWxhckZhY3RvcnMgPSBbMS4zODc3LCAxLCAxLCAxLCAxLjE3MjIzLCAxLjEyOTMsIDAuODk1NTIsIDAuOTExMzMsIDAuODAzOTUsIDEuMDIyNjksIDEuMTU2MDEsIDAuOTEwNTYsIDAuOTEwNTYsIDEuMjc5OCwgMC44NTI4NCwgMC44OTgwNywgMSwgMC45MDg2MSwgMS4zOTAxNiwgMC45MTEzMywgMC45MTEzMywgMC45MTEzMywgMC45MTEzMywgMC45MTEzMywgMC45MTEzMywgMC45MTEzMywgMC45MTEzMywgMC45MTEzMywgMC45MTEzMywgMC45NjMwOSwgMC45NjMwOSwgMC44NTI4NCwgMC44NTI4NCwgMC44NTI4NCwgMC44MzMxOSwgMC44ODA3MSwgMC44Njc1LCAwLjgxNTUyLCAwLjczODM0LCAwLjg1MTkzLCAwLjczMjA2LCAwLjc1MjIsIDAuODExMDUsIDAuODYyNzUsIDAuOTA2ODUsIDAuNjM3NywgMC43Nzg5MiwgMC43NTU5MywgMS4wMjYzOCwgMC44OTM4NSwgMC44NTEyMiwgMC43NzQ1MiwgMC44NjUwMywgMC43NTE4NiwgMC42ODg4NywgMC43OTc3NiwgMC44ODg0NCwgMC44NTA2NiwgMC45NDI1OCwgMC43NzgxOCwgMC43MzA2LCAwLjc2NjU5LCAxLjEwMzY5LCAxLjM5MDE2LCAxLjEwMzY5LCAxLjA2MTM5LCAwLjg5NTUyLCAwLjg3MzksIDAuODYxMjgsIDAuOTQ0NjksIDAuODQ1NywgMC45NDQ2OSwgMC44OTQ2NCwgMS4wOTg0MiwgMC44NDYzNiwgMC45NDQ2OSwgMS4wMzI5NywgMS4wNzY5MiwgMC45MDkxOCwgMS4wMzI5NywgMC45NTg5NywgMC45NDQ2OSwgMC45NDgyLCAwLjk0NDY5LCAwLjk0NDY5LCAxLjA0NjkyLCAwLjc4MjIzLCAxLjIwNTYyLCAwLjk0NDY5LCAwLjkwMzMyLCAwLjk4OTg2LCAwLjg2NjIxLCAwLjkwNTI3LCAwLjc5MDA0LCAwLjk0MTUyLCAxLjc3MjU2LCAwLjk0MTUyLCAwLjg1Mjg0LCAwLjk3ODAxLCAwLjg5NTUyLCAwLjkxMTMzLCAwLjg5NTUyLCAwLjkxMTMzLCAxLjkxNzI5LCAwLjg5NTUyLCAxLjE3ODg5LCAxLjEzMjU0LCAxLjA4NzA3LCAwLjkyMDk4LCAwLjg1Mjg0LCAwLjY4Nzg3LCAwLjcxMzUzLCAwLjg0NzM3LCAwLjkwNzQ3LCAxLjAwODgsIDEuMDA0NCwgMC44NzY4MywgMSwgMS4wOTA5MSwgMSwgMC45MjIyOSwgMC43MzksIDEuMTU2NDIsIDAuOTIwOTgsIDAuNzYyODgsIDAuODA1MDQsIDAuODA5NzIsIDAuNzU4NTksIDAuODY3NSwgMC44Njc1LCAwLjg2NzUsIDAuODY3NSwgMC44Njc1LCAwLjg2NzUsIDAuNzYzMTgsIDAuNzM4MzQsIDAuNzMyMDYsIDAuNzMyMDYsIDAuNzMyMDYsIDAuNzMyMDYsIDAuOTA2ODUsIDAuOTA2ODUsIDAuOTA2ODUsIDAuOTA2ODUsIDAuODY0NzcsIDAuODkzODUsIDAuODUxMjIsIDAuODUxMjIsIDAuODUxMjIsIDAuODUxMjIsIDAuODUxMjIsIDAuODUyODQsIDAuODUzMTEsIDAuODg4NDQsIDAuODg4NDQsIDAuODg4NDQsIDAuODg4NDQsIDAuNzMwNiwgMC43NzQ1MiwgMC44NjMzMSwgMC44NjEyOCwgMC44NjEyOCwgMC44NjEyOCwgMC44NjEyOCwgMC44NjEyOCwgMC44NjEyOCwgMC44NjkzLCAwLjg0NTcsIDAuODk0NjQsIDAuODk0NjQsIDAuODk0NjQsIDAuODk0NjQsIDAuODI2MDEsIDAuODI2MDEsIDAuODI2MDEsIDAuODI2MDEsIDAuOTQ0NjksIDAuOTQ0NjksIDAuOTQ4MiwgMC45NDgyLCAwLjk0ODIsIDAuOTQ4MiwgMC45NDgyLCAwLjkwNzQ3LCAwLjg2NjUxLCAwLjk0NDY5LCAwLjk0NDY5LCAwLjk0NDY5LCAwLjk0NDY5LCAwLjkwNTI3LCAwLjk0NDY5LCAwLjkwNTI3LCAwLjg2NzUsIDAuODYxMjgsIDAuODY3NSwgMC44NjEyOCwgMC44Njc1LCAwLjg2MTI4LCAwLjczODM0LCAwLjg0NTcsIDAuNzM4MzQsIDAuODQ1NywgMC43MzgzNCwgMC44NDU3LCAwLjczODM0LCAwLjg0NTcsIDAuODUxOTMsIDAuOTI0NTQsIDAuODY0NzcsIDAuOTkyMSwgMC43MzIwNiwgMC44OTQ2NCwgMC43MzIwNiwgMC44OTQ2NCwgMC43MzIwNiwgMC44OTQ2NCwgMC43MzIwNiwgMC44OTQ2NCwgMC43MzIwNiwgMC44OTQ2NCwgMC44MTEwNSwgMC44NDYzNiwgMC44MTEwNSwgMC44NDYzNiwgMC44MTEwNSwgMC44NDYzNiwgMSwgMSwgMC44NjI3NSwgMC45NDQ2OSwgMC45MDg3MiwgMC45NTc4NiwgMC45MDY4NSwgMC44MjYwMSwgMC45MDY4NSwgMC44MjYwMSwgMC45MDY4NSwgMC44MjYwMSwgMC45MDY4NSwgMS4wMzI5NywgMC45MDY4NSwgMC44MjYwMSwgMC43Nzc0MSwgMS4wNTYxMSwgMC42Mzc3LCAxLjA3NjkyLCAxLCAxLCAwLjkwOTE4LCAwLjc1NTkzLCAxLjAzMjk3LCAxLCAxLCAwLjc2MDMyLCAwLjkwNDUyLCAwLjk4MTU2LCAxLjExODQyLCAwLjc3MjYxLCAxLjExNDI5LCAwLjg5Mzg1LCAwLjk0NDY5LCAxLCAxLCAwLjg5Mzg1LCAwLjk0NDY5LCAwLjk1ODc3LCAwLjg2OTAxLCAwLjk0NDY5LCAwLjg1MTIyLCAwLjk0ODIsIDAuODUxMjIsIDAuOTQ4MiwgMC44NTEyMiwgMC45NDgyLCAwLjg2NjcsIDAuOTAwMTYsIDAuNzUxODYsIDEuMDQ2OTIsIDEsIDEsIDAuNzUxODYsIDEuMDQ2OTIsIDAuNjg4ODcsIDAuNzgyMjMsIDAuNjg4ODcsIDAuNzgyMjMsIDAuNjg4ODcsIDAuNzgyMjMsIDAuNjg4ODcsIDAuNzgyMjMsIDEsIDEsIDAuNzk3NzYsIDAuOTIxODgsIDAuNzk3NzYsIDEuMjMwMjMsIDAuODg4NDQsIDAuOTQ0NjksIDAuODg4NDQsIDAuOTQ0NjksIDAuODg4NDQsIDAuOTQ0NjksIDAuODg4NDQsIDAuOTQ0NjksIDAuODg4NDQsIDAuOTQ0NjksIDAuODg4NDQsIDAuOTQ0NjksIDAuOTQyNTgsIDAuOTg5ODYsIDAuNzMwNiwgMC45MDUyNywgMC43MzA2LCAwLjc2NjU5LCAwLjc5MDA0LCAwLjc2NjU5LCAwLjc5MDA0LCAwLjc2NjU5LCAwLjc5MDA0LCAxLjA5MjMxLCAwLjU0ODczLCAwLjg2NzUsIDAuODYxMjgsIDAuNzYzMTgsIDAuODY5MywgMC44NTMxMSwgMC44NjY1MSwgMSwgMSwgMC43OTc3NiwgMS4yMDU2MiwgMS4xODYyMiwgMS4xODYyMiwgMSwgMS4xNDM3LCAwLjY3NzQyLCAwLjk2MzM0LCAwLjkzNjk1LCAxLjM1MTkxLCAxLjQwOTA5LCAwLjk1MTYxLCAxLjQ4Mzg3LCAwLjg2Njg2LCAwLjkwODYxLCAwLjYyMjY3LCAwLjc0MzU5LCAwLjY1NjQ5LCAwLjg1NDk4LCAwLjU2OTYzLCAwLjg4MjU0LCAxLjIzNTE2LCAwLjg2NzUsIDAuODE1NTIsIDAuNzU0NDMsIDAuODQ1MDMsIDAuNzMyMDYsIDAuNzY2NTksIDAuODYyNzUsIDAuODUxMjIsIDAuOTA2ODUsIDAuNzc4OTIsIDAuODU3NDYsIDEuMDI2MzgsIDAuODkzODUsIDAuNzU2NTcsIDAuODUxMjIsIDAuODYyNzUsIDAuNzc0NTIsIDAuNzQxNzEsIDAuNzk3NzYsIDAuNzMwNiwgMC45NTE2NSwgMC43NzgxOCwgMC44OTc3MiwgMC44ODgzMSwgMC45MDY4NSwgMC43MzA2LCAwLjk4MTQyLCAxLjAyMTkxLCAwLjk2NTc2LCAxLjIzNTE2LCAwLjk5MDE4LCAwLjk4MTQyLCAwLjkyMzYsIDAuODkyNTgsIDAuOTQwMzUsIDEuMDIxOTEsIDAuNzg4NDgsIDAuOTY1NzYsIDAuOTU2MSwgMS4yMzUxNiwgMC45MDkxOCwgMC45MjU3OCwgMC45NTQyNCwgMC44OTc0NiwgMC44Mzk2OSwgMC45NDgyLCAwLjgwMTEzLCAwLjg5NDQyLCAwLjg1MjA4LCAwLjg2MTU1LCAwLjk4MDIyLCAwLjk5MDE4LCAxLjAwNDUyLCAwLjgxMjA5LCAwLjk5MjQ3LCAwLjg5MTgxLCAxLjIzNTE2LCAwLjk5MDE4LCAwLjk0ODIsIDAuOTkwMTgsIDAuODkxODEsIDAuNzMyMDYsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDAuODg4NDQsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDAuODk0NjQsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDAuOTY3NjYsIDEsIDEsIDEsIDEsIDEsIDEsIDAuOTQyNTgsIDAuOTg5ODYsIDAuOTQyNTgsIDAuOTg5ODYsIDAuOTQyNTgsIDAuOTg5ODYsIDAuNzMwNiwgMC45MDUyNywgMSwgMSwgMC44OTU1MiwgMC45MDUyNywgMSwgMC45MDE4NiwgMS4xMjMwOCwgMS4xMjMwOCwgMS4xMjMwOCwgMS4xMjMwOCwgMS4yNTY2LCAxLjI1NjYsIDEuMjU2NiwgMC44OTU1MiwgMC44OTU1MiwgMS40MjI1OSwgMC42OTA0MywgMS4wMzgwOSwgMSwgMSwgMS4wMTc2LCAxLjAxNzYsIDEuMTE1MjMsIDEuNDk1NiwgMi4wMTQ2MiwgMC45OTMzMSwgMC44MjYxNiwgMC45MTEzMywgMC44NDI4NiwgMC45MTEzMywgMSwgMSwgMSwgMC43MDUwOCwgMSwgMS4yMzEwOCwgMC43OTgwMSwgMC44NDQyNiwgMC44NDQyNiwgMC43NzQsIDAuOTA1MjcsIDEuODEwNTUsIDAuOTA1MjcsIDEuODEwNTUsIDEuMjg4MDksIDEuNTU0NjksIDAuOTQ0MzQsIDEuMDc4MDYsIDEsIDAuOTcwOTQsIDAuNzU4OSwgMC44NTI4NCwgMC45MDc0NywgMS4xOTY1OCwgMC42OTgyNSwgMC45NzYyMiwgMS4zMzUxMiwgMC45MDc0NywgMC45MDc0NywgMC44NTM1NiwgMC45MDc0NywgMC45MDc0NywgMS40NDk0NywgMC44NTI4NCwgMC44OTQxLCAwLjg5NDEsIDAuNzA1NzIsIDAuOCwgMC43MDU3MiwgMC43MDU3MiwgMC43MDU3MiwgMC43MDU3MiwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMC45OTg2MiwgMC45OTg2MiwgMSwgMSwgMSwgMSwgMSwgMS4wMzM2LCAwLjkxMDI3LCAxLCAxLCAxLCAwLjk5ODYyLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLjA1ODU5LCAxLjA1ODU5LCAxLCAxLCAxLCAxLjA3MTg1LCAwLjk5NDEzLCAwLjk2MzM0LCAxLjA4MDY1LCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxXTsKZXhwb3J0cy5DYWxpYnJpUmVndWxhckZhY3RvcnMgPSBDYWxpYnJpUmVndWxhckZhY3RvcnM7CmNvbnN0IENhbGlicmlSZWd1bGFyTWV0cmljcyA9IHsKICBsaW5lSGVpZ2h0OiAxLjIyMDcsCiAgbGluZUdhcDogMC4yMjA3Cn07CmV4cG9ydHMuQ2FsaWJyaVJlZ3VsYXJNZXRyaWNzID0gQ2FsaWJyaVJlZ3VsYXJNZXRyaWNzOwoKLyoqKi8gfSksCi8qIDUzICovCi8qKiovICgoX191bnVzZWRfd2VicGFja19tb2R1bGUsIGV4cG9ydHMpID0+IHsKCgoKT2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsICJfX2VzTW9kdWxlIiwgKHsKICB2YWx1ZTogdHJ1ZQp9KSk7CmV4cG9ydHMuSGVsdmV0aWNhUmVndWxhck1ldHJpY3MgPSBleHBvcnRzLkhlbHZldGljYVJlZ3VsYXJGYWN0b3JzID0gZXhwb3J0cy5IZWx2ZXRpY2FJdGFsaWNNZXRyaWNzID0gZXhwb3J0cy5IZWx2ZXRpY2FJdGFsaWNGYWN0b3JzID0gZXhwb3J0cy5IZWx2ZXRpY2FCb2xkTWV0cmljcyA9IGV4cG9ydHMuSGVsdmV0aWNhQm9sZEl0YWxpY01ldHJpY3MgPSBleHBvcnRzLkhlbHZldGljYUJvbGRJdGFsaWNGYWN0b3JzID0gZXhwb3J0cy5IZWx2ZXRpY2FCb2xkRmFjdG9ycyA9IHZvaWQgMDsKY29uc3QgSGVsdmV0aWNhQm9sZEZhY3RvcnMgPSBbMC43NjExNiwgMSwgMSwgMS4wMDA2LCAwLjk5OTk4LCAwLjk5OTc0LCAwLjk5OTczLCAwLjk5OTczLCAwLjk5OTgyLCAwLjk5OTc3LCAxLjAwMDg3LCAwLjk5OTk4LCAwLjk5OTk4LCAwLjk5OTU5LCAxLjAwMDAzLCAxLjAwMDYsIDAuOTk5OTgsIDEuMDAwNiwgMS4wMDA2LCAwLjk5OTczLCAwLjk5OTczLCAwLjk5OTczLCAwLjk5OTczLCAwLjk5OTczLCAwLjk5OTczLCAwLjk5OTczLCAwLjk5OTczLCAwLjk5OTczLCAwLjk5OTczLCAwLjk5OTk4LCAxLCAxLjAwMDAzLCAxLjAwMDAzLCAxLjAwMDAzLCAxLjAwMDI2LCAwLjk5OTksIDAuOTk5NzcsIDAuOTk5NzcsIDAuOTk5NzcsIDAuOTk5NzcsIDEuMDAwMDEsIDEuMDAwMjYsIDEuMDAwMjIsIDAuOTk5NzcsIDEuMDAwNiwgMC45OTk3MywgMC45OTk3NywgMS4wMDAyNiwgMC45OTk5OSwgMC45OTk3NywgMS4wMDAyMiwgMS4wMDAwMSwgMS4wMDAyMiwgMC45OTk3NywgMS4wMDAwMSwgMS4wMDAyNiwgMC45OTk3NywgMS4wMDAwMSwgMS4wMDAxNiwgMS4wMDAwMSwgMS4wMDAwMSwgMS4wMDAyNiwgMC45OTk5OCwgMS4wMDA2LCAwLjk5OTk4LCAxLjAwMDAzLCAwLjk5OTczLCAwLjk5OTk4LCAwLjk5OTczLCAxLjAwMDI2LCAwLjk5OTczLCAxLjAwMDI2LCAwLjk5OTczLCAwLjk5OTk4LCAxLjAwMDI2LCAxLjAwMDI2LCAxLjAwMDYsIDEuMDAwNiwgMC45OTk3MywgMS4wMDA2LCAwLjk5OTgyLCAxLjAwMDI2LCAxLjAwMDI2LCAxLjAwMDI2LCAxLjAwMDI2LCAwLjk5OTU5LCAwLjk5OTczLCAwLjk5OTk4LCAxLjAwMDI2LCAwLjk5OTczLCAxLjAwMDIyLCAwLjk5OTczLCAwLjk5OTczLCAxLCAwLjk5OTU5LCAxLjAwMDc3LCAwLjk5OTU5LCAxLjAwMDAzLCAwLjk5OTk4LCAwLjk5OTczLCAwLjk5OTczLCAwLjk5OTczLCAwLjk5OTczLCAxLjAwMDc3LCAwLjk5OTczLCAwLjk5OTk4LCAxLjAwMDI1LCAwLjk5OTY4LCAwLjk5OTczLCAxLjAwMDAzLCAxLjAwMDI1LCAwLjYwMjk5LCAxLjAwMDI0LCAxLjA2NDA5LCAxLCAxLCAwLjk5OTk4LCAxLCAwLjk5OTczLCAxLjAwMDYsIDAuOTk5OTgsIDEsIDAuOTk5MzYsIDAuOTk5NzMsIDEuMDAwMDIsIDEuMDAwMDIsIDEuMDAwMDIsIDEuMDAwMjYsIDAuOTk5NzcsIDAuOTk5NzcsIDAuOTk5NzcsIDAuOTk5NzcsIDAuOTk5NzcsIDAuOTk5NzcsIDEsIDAuOTk5NzcsIDEuMDAwMDEsIDEuMDAwMDEsIDEuMDAwMDEsIDEuMDAwMDEsIDEuMDAwNiwgMS4wMDA2LCAxLjAwMDYsIDEuMDAwNiwgMC45OTk3NywgMC45OTk3NywgMS4wMDAyMiwgMS4wMDAyMiwgMS4wMDAyMiwgMS4wMDAyMiwgMS4wMDAyMiwgMS4wMDAwMywgMS4wMDAyMiwgMC45OTk3NywgMC45OTk3NywgMC45OTk3NywgMC45OTk3NywgMS4wMDAwMSwgMS4wMDAwMSwgMS4wMDAyNiwgMC45OTk3MywgMC45OTk3MywgMC45OTk3MywgMC45OTk3MywgMC45OTk3MywgMC45OTk3MywgMC45OTk4MiwgMC45OTk3MywgMC45OTk3MywgMC45OTk3MywgMC45OTk3MywgMC45OTk3MywgMS4wMDA2LCAxLjAwMDYsIDEuMDAwNiwgMS4wMDA2LCAxLjAwMDI2LCAxLjAwMDI2LCAxLjAwMDI2LCAxLjAwMDI2LCAxLjAwMDI2LCAxLjAwMDI2LCAxLjAwMDI2LCAxLjA2NDA5LCAxLjAwMDI2LCAxLjAwMDI2LCAxLjAwMDI2LCAxLjAwMDI2LCAxLjAwMDI2LCAwLjk5OTczLCAxLjAwMDI2LCAwLjk5OTczLCAwLjk5OTc3LCAwLjk5OTczLCAwLjk5OTc3LCAwLjk5OTczLCAwLjk5OTc3LCAwLjk5OTczLCAwLjk5OTc3LCAwLjk5OTczLCAwLjk5OTc3LCAwLjk5OTczLCAwLjk5OTc3LCAwLjk5OTczLCAwLjk5OTc3LCAwLjk5OTczLCAwLjk5OTc3LCAxLjAzMzc0LCAwLjk5OTc3LCAxLjAwMDI2LCAxLjAwMDAxLCAwLjk5OTczLCAxLjAwMDAxLCAwLjk5OTczLCAxLjAwMDAxLCAwLjk5OTczLCAxLjAwMDAxLCAwLjk5OTczLCAxLjAwMDAxLCAwLjk5OTczLCAxLjAwMDIyLCAxLjAwMDI2LCAxLjAwMDIyLCAxLjAwMDI2LCAxLjAwMDIyLCAxLjAwMDI2LCAxLjAwMDIyLCAxLjAwMDI2LCAwLjk5OTc3LCAxLjAwMDI2LCAwLjk5OTc3LCAxLjAwMDI2LCAxLjAwMDYsIDEuMDAwNiwgMS4wMDA2LCAxLjAwMDYsIDEuMDAwNiwgMS4wMDA2LCAxLjAwMDYsIDEuMDAwNiwgMS4wMDA2LCAxLjAwMDYsIDEuMDAwNDIsIDAuOTk5NzMsIDAuOTk5NzMsIDEuMDAwNiwgMC45OTk3NywgMC45OTk3MywgMC45OTk3MywgMS4wMDAyNiwgMS4wMDA2LCAxLjAwMDI2LCAxLjAwMDYsIDEuMDAwMjYsIDEuMDM4MjgsIDEuMDAwMjYsIDAuOTk5OTksIDEuMDAwMjYsIDEuMDAwNiwgMC45OTk3NywgMS4wMDAyNiwgMC45OTk3NywgMS4wMDAyNiwgMC45OTk3NywgMS4wMDAyNiwgMC45OTkzLCAwLjk5OTgsIDEuMDAwMjYsIDEuMDAwMjIsIDEuMDAwMjYsIDEuMDAwMjIsIDEuMDAwMjYsIDEuMDAwMjIsIDEuMDAwMjYsIDEsIDEuMDAwMTYsIDAuOTk5NzcsIDAuOTk5NTksIDAuOTk5NzcsIDAuOTk5NTksIDAuOTk5NzcsIDAuOTk5NTksIDEuMDAwMDEsIDAuOTk5NzMsIDEuMDAwMDEsIDAuOTk5NzMsIDEuMDAwMDEsIDAuOTk5NzMsIDEuMDAwMDEsIDAuOTk5NzMsIDEuMDAwMjYsIDAuOTk5OTgsIDEuMDAwMjYsIDAuODEyMSwgMS4wMDAyNiwgMC45OTk5OCwgMC45OTk3NywgMS4wMDAyNiwgMC45OTk3NywgMS4wMDAyNiwgMC45OTk3NywgMS4wMDAyNiwgMC45OTk3NywgMS4wMDAyNiwgMC45OTk3NywgMS4wMDAyNiwgMC45OTk3NywgMS4wMDAyNiwgMS4wMDAxNiwgMS4wMDAyMiwgMS4wMDAwMSwgMC45OTk3MywgMS4wMDAwMSwgMS4wMDAyNiwgMSwgMS4wMDAyNiwgMSwgMS4wMDAyNiwgMSwgMS4wMDA2LCAwLjk5OTczLCAwLjk5OTc3LCAwLjk5OTczLCAxLCAwLjk5OTgyLCAxLjAwMDIyLCAxLjAwMDI2LCAxLjAwMDAxLCAwLjk5OTczLCAxLjAwMDI2LCAwLjk5OTk4LCAwLjk5OTk4LCAwLjk5OTk4LCAwLjk5OTk4LCAwLjk5OTk4LCAwLjk5OTk4LCAwLjk5OTk4LCAwLjk5OTk4LCAwLjk5OTk4LCAwLjk5OTk4LCAwLjk5OTk4LCAxLjAwMDM0LCAwLjk5OTc3LCAxLCAwLjk5OTk3LCAxLjAwMDI2LCAxLjAwMDc4LCAxLjAwMDM2LCAwLjk5OTczLCAxLjAwMDEzLCAxLjAwMDYsIDAuOTk5NzcsIDAuOTk5NzcsIDAuOTk5ODgsIDAuODUxNDgsIDEuMDAwMDEsIDEuMDAwMjYsIDAuOTk5NzcsIDEuMDAwMjIsIDEuMDAwNiwgMC45OTk3NywgMS4wMDAwMSwgMC45OTk5OSwgMC45OTk3NywgMS4wMDA2OSwgMS4wMDAyMiwgMC45OTk3NywgMS4wMDAwMSwgMC45OTk4NCwgMS4wMDAyNiwgMS4wMDAwMSwgMS4wMDAyNCwgMS4wMDAwMSwgMC45OTk5LCAxLCAxLjAwMDYsIDEuMDAwMDEsIDEuMDAwNDEsIDAuOTk5NjIsIDEuMDAwMjYsIDEuMDAwNiwgMC45OTk5NSwgMS4wMDA0MSwgMC45OTk0MiwgMC45OTk3MywgMC45OTkyNywgMS4wMDA4MiwgMC45OTkwMiwgMS4wMDAyNiwgMS4wMDA4NywgMS4wMDA2LCAxLjAwMDY5LCAwLjk5OTczLCAwLjk5ODY3LCAwLjk5OTczLCAwLjk5OTMsIDEuMDAwMjYsIDEuMDAwNDksIDEuMDAwNTYsIDEsIDAuOTk5ODgsIDAuOTk5MzUsIDAuOTk5OTUsIDAuOTk5NTQsIDEuMDAwNTUsIDAuOTk5NDUsIDEuMDAwMzIsIDEuMDAwNiwgMC45OTk5NSwgMS4wMDAyNiwgMC45OTk5NSwgMS4wMDAzMiwgMS4wMDAwMSwgMS4wMDAwOCwgMC45OTk3MSwgMS4wMDAxOSwgMC45OTk0LCAxLjAwMDAxLCAxLjAwMDYsIDEuMDAwNDQsIDAuOTk5NzMsIDEuMDAwMjMsIDEuMDAwNDcsIDEsIDAuOTk5NDIsIDAuOTk1NjEsIDAuOTk5ODksIDEuMDAwMzUsIDAuOTk5NzcsIDEuMDAwMzUsIDAuOTk5NzcsIDEuMDAwMTksIDAuOTk5NDQsIDEuMDAwMDEsIDEuMDAwMjEsIDAuOTk5MjYsIDEuMDAwMzUsIDEuMDAwMzUsIDAuOTk5NDIsIDEuMDAwNDgsIDAuOTk5OTksIDAuOTk5NzcsIDEuMDAwMjIsIDEuMDAwMzUsIDEuMDAwMDEsIDAuOTk5NzcsIDEuMDAwMjYsIDAuOTk5ODksIDEuMDAwNTcsIDEuMDAwMDEsIDAuOTk5MzYsIDEuMDAwNTIsIDEuMDAwMTIsIDAuOTk5OTYsIDEuMDAwNDMsIDEsIDEuMDAwMzUsIDAuOTk5NCwgMC45OTk3NiwgMS4wMDAzNSwgMC45OTk3MywgMS4wMDA1MiwgMS4wMDA0MSwgMS4wMDExOSwgMS4wMDAzNywgMC45OTk3MywgMS4wMDAwMiwgMC45OTk4NiwgMS4wMDA0MSwgMS4wMDA0MSwgMC45OTkwMiwgMC45OTk2LCAxLjAwMDM0LCAwLjk5OTk5LCAxLjAwMDI2LCAwLjk5OTk5LCAxLjAwMDI2LCAwLjk5OTczLCAxLjAwMDUyLCAwLjk5OTczLCAxLCAwLjk5OTczLCAxLjAwMDQxLCAxLjAwMDc1LCAwLjk5OTQsIDEuMDAwMywgMC45OTk5OSwgMSwgMS4wMDA0MSwgMC45OTk1NSwgMSwgMC45OTkxNSwgMC45OTk3MywgMC45OTk3MywgMS4wMDAyNiwgMS4wMDExOSwgMC45OTk1NSwgMC45OTk3MywgMS4wMDA2LCAwLjk5OTExLCAxLjAwMDYsIDEuMDAwMjYsIDAuOTk5NzIsIDEuMDAwMjYsIDAuOTk5MDIsIDEuMDAwNDEsIDAuOTk5NzMsIDAuOTk5OTksIDEsIDEsIDEuMDAwMzgsIDEuMDAwNSwgMS4wMDAxNiwgMS4wMDAyMiwgMS4wMDAxNiwgMS4wMDAyMiwgMS4wMDAxNiwgMS4wMDAyMiwgMS4wMDAwMSwgMC45OTk3MywgMSwgMSwgMC45OTk3MywgMSwgMSwgMC45OTk1NSwgMS4wMDA2LCAxLjAwMDYsIDEuMDAwNiwgMS4wMDA2LCAxLCAxLCAxLCAwLjk5OTczLCAwLjk5OTczLCAwLjk5OTcyLCAxLCAxLCAxLjAwMTA2LCAwLjk5OTk5LCAwLjk5OTk4LCAwLjk5OTk4LCAwLjk5OTk5LCAwLjk5OTk4LCAxLjY2NDc1LCAxLCAwLjk5OTczLCAwLjk5OTczLCAxLjAwMDIzLCAwLjk5OTczLCAwLjk5OTcxLCAxLjAwMDQ3LCAxLjAwMDIzLCAxLCAwLjk5OTkxLCAwLjk5OTg0LCAxLjAwMDAyLCAxLjAwMDAyLCAxLjAwMDAyLCAxLjAwMDAyLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAwLjk5OTcyLCAxLCAxLjIwOTg1LCAxLjM5NzEzLCAxLjAwMDAzLCAxLjAwMDMxLCAxLjAwMDE1LCAxLCAwLjk5NTYxLCAxLjAwMDI3LCAxLjAwMDMxLCAxLjAwMDMxLCAwLjk5OTE1LCAxLjAwMDMxLCAxLjAwMDMxLCAwLjk5OTk5LCAxLjAwMDAzLCAwLjk5OTk5LCAwLjk5OTk5LCAxLjQxMTQ0LCAxLjYsIDEuNDExNDQsIDEuNDExNDQsIDEuNDExNDQsIDEuNDExNDQsIDEuNDExNDQsIDEuNDExNDQsIDEuNDExNDQsIDEuNDExNDQsIDEuNDExNDQsIDEuNDExNDQsIDEuNDExNDQsIDEuNDExNDQsIDEuNDExNDQsIDEuNDExNDQsIDEuNDExNDQsIDEuNDExNDQsIDEuNDExNDQsIDEuNDExNDQsIDEuNDExNDQsIDEuNDExNDQsIDEuNDExNDQsIDEuNDExNDQsIDEuNDExNDQsIDEuNDExNDQsIDEuNDExNDQsIDEuNDExNDQsIDEuNDExNDQsIDEuNDExNDQsIDEuNDExNDQsIDEuNDExNDQsIDEuNDExNDQsIDEuNDExNDQsIDEuNDExNDQsIDEuNDExNDQsIDEuNDExNDQsIDEuNDExNDQsIDEuNDExNDQsIDEuNDExNDQsIDEuNDExNDQsIDEuNDExNDQsIDEuNDExNDQsIDEuNDExNDQsIDEuNDExNDQsIDEuNDA1NzksIDEuNDA1NzksIDEuMzY2MjUsIDAuOTk5OTksIDEsIDAuOTk4NjEsIDAuOTk4NjEsIDEsIDEuMDAwMjYsIDEuMDAwMjYsIDEuMDAwMjYsIDEuMDAwMjYsIDAuOTk5NzIsIDAuOTk5OTksIDAuOTk5OTksIDAuOTk5OTksIDAuOTk5OTksIDEuNDA0ODMsIDEsIDAuOTk5NzcsIDEuMDAwNTQsIDEsIDEsIDAuOTk5NTMsIDAuOTk5NjIsIDEuMDAwNDIsIDAuOTk5NSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMC45OTk5OCwgMC45OTk5OCwgMC45OTk5OCwgMC45OTk5OCwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMV07CmV4cG9ydHMuSGVsdmV0aWNhQm9sZEZhY3RvcnMgPSBIZWx2ZXRpY2FCb2xkRmFjdG9yczsKY29uc3QgSGVsdmV0aWNhQm9sZE1ldHJpY3MgPSB7CiAgbGluZUhlaWdodDogMS4yLAogIGxpbmVHYXA6IDAuMgp9OwpleHBvcnRzLkhlbHZldGljYUJvbGRNZXRyaWNzID0gSGVsdmV0aWNhQm9sZE1ldHJpY3M7CmNvbnN0IEhlbHZldGljYUJvbGRJdGFsaWNGYWN0b3JzID0gWzAuNzYxMTYsIDEsIDEsIDEuMDAwNiwgMC45OTk5OCwgMC45OTk3NCwgMC45OTk3MywgMC45OTk3MywgMC45OTk4MiwgMC45OTk3NywgMS4wMDA4NywgMC45OTk5OCwgMC45OTk5OCwgMC45OTk1OSwgMS4wMDAwMywgMS4wMDA2LCAwLjk5OTk4LCAxLjAwMDYsIDEuMDAwNiwgMC45OTk3MywgMC45OTk3MywgMC45OTk3MywgMC45OTk3MywgMC45OTk3MywgMC45OTk3MywgMC45OTk3MywgMC45OTk3MywgMC45OTk3MywgMC45OTk3MywgMC45OTk5OCwgMSwgMS4wMDAwMywgMS4wMDAwMywgMS4wMDAwMywgMS4wMDAyNiwgMC45OTk5LCAwLjk5OTc3LCAwLjk5OTc3LCAwLjk5OTc3LCAwLjk5OTc3LCAxLjAwMDAxLCAxLjAwMDI2LCAxLjAwMDIyLCAwLjk5OTc3LCAxLjAwMDYsIDAuOTk5NzMsIDAuOTk5NzcsIDEuMDAwMjYsIDAuOTk5OTksIDAuOTk5NzcsIDEuMDAwMjIsIDEuMDAwMDEsIDEuMDAwMjIsIDAuOTk5NzcsIDEuMDAwMDEsIDEuMDAwMjYsIDAuOTk5NzcsIDEuMDAwMDEsIDEuMDAwMTYsIDEuMDAwMDEsIDEuMDAwMDEsIDEuMDAwMjYsIDAuOTk5OTgsIDEuMDAwNiwgMC45OTk5OCwgMS4wMDAwMywgMC45OTk3MywgMC45OTk5OCwgMC45OTk3MywgMS4wMDAyNiwgMC45OTk3MywgMS4wMDAyNiwgMC45OTk3MywgMC45OTk5OCwgMS4wMDAyNiwgMS4wMDAyNiwgMS4wMDA2LCAxLjAwMDYsIDAuOTk5NzMsIDEuMDAwNiwgMC45OTk4MiwgMS4wMDAyNiwgMS4wMDAyNiwgMS4wMDAyNiwgMS4wMDAyNiwgMC45OTk1OSwgMC45OTk3MywgMC45OTk5OCwgMS4wMDAyNiwgMC45OTk3MywgMS4wMDAyMiwgMC45OTk3MywgMC45OTk3MywgMSwgMC45OTk1OSwgMS4wMDA3NywgMC45OTk1OSwgMS4wMDAwMywgMC45OTk5OCwgMC45OTk3MywgMC45OTk3MywgMC45OTk3MywgMC45OTk3MywgMS4wMDA3NywgMC45OTk3MywgMC45OTk5OCwgMS4wMDAyNSwgMC45OTk2OCwgMC45OTk3MywgMS4wMDAwMywgMS4wMDAyNSwgMC42MDI5OSwgMS4wMDAyNCwgMS4wNjQwOSwgMSwgMSwgMC45OTk5OCwgMSwgMC45OTk3MywgMS4wMDA2LCAwLjk5OTk4LCAxLCAwLjk5OTM2LCAwLjk5OTczLCAxLjAwMDAyLCAxLjAwMDAyLCAxLjAwMDAyLCAxLjAwMDI2LCAwLjk5OTc3LCAwLjk5OTc3LCAwLjk5OTc3LCAwLjk5OTc3LCAwLjk5OTc3LCAwLjk5OTc3LCAxLCAwLjk5OTc3LCAxLjAwMDAxLCAxLjAwMDAxLCAxLjAwMDAxLCAxLjAwMDAxLCAxLjAwMDYsIDEuMDAwNiwgMS4wMDA2LCAxLjAwMDYsIDAuOTk5NzcsIDAuOTk5NzcsIDEuMDAwMjIsIDEuMDAwMjIsIDEuMDAwMjIsIDEuMDAwMjIsIDEuMDAwMjIsIDEuMDAwMDMsIDEuMDAwMjIsIDAuOTk5NzcsIDAuOTk5NzcsIDAuOTk5NzcsIDAuOTk5NzcsIDEuMDAwMDEsIDEuMDAwMDEsIDEuMDAwMjYsIDAuOTk5NzMsIDAuOTk5NzMsIDAuOTk5NzMsIDAuOTk5NzMsIDAuOTk5NzMsIDAuOTk5NzMsIDAuOTk5ODIsIDAuOTk5NzMsIDAuOTk5NzMsIDAuOTk5NzMsIDAuOTk5NzMsIDAuOTk5NzMsIDEuMDAwNiwgMS4wMDA2LCAxLjAwMDYsIDEuMDAwNiwgMS4wMDAyNiwgMS4wMDAyNiwgMS4wMDAyNiwgMS4wMDAyNiwgMS4wMDAyNiwgMS4wMDAyNiwgMS4wMDAyNiwgMS4wNjQwOSwgMS4wMDAyNiwgMS4wMDAyNiwgMS4wMDAyNiwgMS4wMDAyNiwgMS4wMDAyNiwgMC45OTk3MywgMS4wMDAyNiwgMC45OTk3MywgMC45OTk3NywgMC45OTk3MywgMC45OTk3NywgMC45OTk3MywgMC45OTk3NywgMC45OTk3MywgMC45OTk3NywgMC45OTk3MywgMC45OTk3NywgMC45OTk3MywgMC45OTk3NywgMC45OTk3MywgMC45OTk3NywgMC45OTk3MywgMC45OTk3NywgMS4wMDQ0LCAwLjk5OTc3LCAxLjAwMDI2LCAxLjAwMDAxLCAwLjk5OTczLCAxLjAwMDAxLCAwLjk5OTczLCAxLjAwMDAxLCAwLjk5OTczLCAxLjAwMDAxLCAwLjk5OTczLCAxLjAwMDAxLCAwLjk5OTczLCAxLjAwMDIyLCAxLjAwMDI2LCAxLjAwMDIyLCAxLjAwMDI2LCAxLjAwMDIyLCAxLjAwMDI2LCAxLjAwMDIyLCAxLjAwMDI2LCAwLjk5OTc3LCAxLjAwMDI2LCAwLjk5OTc3LCAxLjAwMDI2LCAxLjAwMDYsIDEuMDAwNiwgMS4wMDA2LCAxLjAwMDYsIDEuMDAwNiwgMS4wMDA2LCAxLjAwMDYsIDEuMDAwNiwgMS4wMDA2LCAxLjAwMDYsIDAuOTk5NzEsIDAuOTk5NzMsIDAuOTk5NzMsIDEuMDAwNiwgMC45OTk3NywgMC45OTk3MywgMC45OTk3MywgMS4wMDAyNiwgMS4wMDA2LCAxLjAwMDI2LCAxLjAwMDYsIDEuMDAwMjYsIDEuMDEwMTEsIDEuMDAwMjYsIDAuOTk5OTksIDEuMDAwMjYsIDEuMDAwNiwgMC45OTk3NywgMS4wMDAyNiwgMC45OTk3NywgMS4wMDAyNiwgMC45OTk3NywgMS4wMDAyNiwgMC45OTkzLCAwLjk5OTgsIDEuMDAwMjYsIDEuMDAwMjIsIDEuMDAwMjYsIDEuMDAwMjIsIDEuMDAwMjYsIDEuMDAwMjIsIDEuMDAwMjYsIDEsIDEuMDAwMTYsIDAuOTk5NzcsIDAuOTk5NTksIDAuOTk5NzcsIDAuOTk5NTksIDAuOTk5NzcsIDAuOTk5NTksIDEuMDAwMDEsIDAuOTk5NzMsIDEuMDAwMDEsIDAuOTk5NzMsIDEuMDAwMDEsIDAuOTk5NzMsIDEuMDAwMDEsIDAuOTk5NzMsIDEuMDAwMjYsIDAuOTk5OTgsIDEuMDAwMjYsIDAuODEyMSwgMS4wMDAyNiwgMC45OTk5OCwgMC45OTk3NywgMS4wMDAyNiwgMC45OTk3NywgMS4wMDAyNiwgMC45OTk3NywgMS4wMDAyNiwgMC45OTk3NywgMS4wMDAyNiwgMC45OTk3NywgMS4wMDAyNiwgMC45OTk3NywgMS4wMDAyNiwgMS4wMDAxNiwgMS4wMDAyMiwgMS4wMDAwMSwgMC45OTk3MywgMS4wMDAwMSwgMS4wMDAyNiwgMSwgMS4wMDAyNiwgMSwgMS4wMDAyNiwgMSwgMS4wMDA2LCAwLjk5OTczLCAwLjk5OTc3LCAwLjk5OTczLCAxLCAwLjk5OTgyLCAxLjAwMDIyLCAxLjAwMDI2LCAxLjAwMDAxLCAwLjk5OTczLCAxLjAwMDI2LCAwLjk5OTk4LCAwLjk5OTk4LCAwLjk5OTk4LCAwLjk5OTk4LCAwLjk5OTk4LCAwLjk5OTk4LCAwLjk5OTk4LCAwLjk5OTk4LCAwLjk5OTk4LCAwLjk5OTk4LCAwLjk5OTk4LCAwLjk5OTk4LCAwLjk5OTc3LCAxLCAxLCAxLjAwMDI2LCAwLjk5OTY5LCAwLjk5OTcyLCAwLjk5OTgxLCAwLjk5OTgsIDEuMDAwNiwgMC45OTk3NywgMC45OTk3NywgMS4wMDAyMiwgMC45MTE1NSwgMS4wMDAwMSwgMS4wMDAyNiwgMC45OTk3NywgMS4wMDAyMiwgMS4wMDA2LCAwLjk5OTc3LCAxLjAwMDAxLCAwLjk5OTk5LCAwLjk5OTc3LCAwLjk5OTY2LCAxLjAwMDIyLCAxLjAwMDMyLCAxLjAwMDAxLCAwLjk5OTQ0LCAxLjAwMDI2LCAxLjAwMDAxLCAwLjk5OTY4LCAxLjAwMDAxLCAxLjAwMDQ3LCAxLCAxLjAwMDYsIDEuMDAwMDEsIDAuOTk5ODEsIDEuMDAxMDEsIDEuMDAwMjYsIDEuMDAwNiwgMC45OTk0OCwgMC45OTk4MSwgMS4wMDA2NCwgMC45OTk3MywgMC45OTk0MiwgMS4wMDEwMSwgMS4wMDA2MSwgMS4wMDAyNiwgMS4wMDA2OSwgMS4wMDA2LCAxLjAwMDE0LCAwLjk5OTczLCAxLjAxMzIyLCAwLjk5OTczLCAxLjAwMDY1LCAxLjAwMDI2LCAxLjAwMDEyLCAwLjk5OTIzLCAxLCAxLjAwMDY0LCAxLjAwMDc2LCAwLjk5OTQ4LCAxLjAwMDU1LCAxLjAwMDYzLCAxLjAwMDA3LCAwLjk5OTQzLCAxLjAwMDYsIDAuOTk5NDgsIDEuMDAwMjYsIDAuOTk5NDgsIDAuOTk5NDMsIDEuMDAwMDEsIDEuMDAwMDEsIDEuMDAwMjksIDEuMDAwMzgsIDEuMDAwMzUsIDEuMDAwMDEsIDEuMDAwNiwgMS4wMDA2LCAwLjk5OTczLCAwLjk5OTc4LCAxLjAwMDAxLCAxLjAwMDU3LCAwLjk5OTg5LCAwLjk5OTY3LCAwLjk5OTY0LCAwLjk5OTY3LCAwLjk5OTc3LCAwLjk5OTk5LCAwLjk5OTc3LCAxLjAwMDM4LCAwLjk5OTc3LCAxLjAwMDAxLCAwLjk5OTczLCAxLjAwMDY2LCAwLjk5OTY3LCAwLjk5OTY3LCAxLjAwMDQxLCAwLjk5OTk4LCAwLjk5OTk5LCAwLjk5OTc3LCAxLjAwMDIyLCAwLjk5OTY3LCAxLjAwMDAxLCAwLjk5OTc3LCAxLjAwMDI2LCAwLjk5OTY0LCAxLjAwMDMxLCAxLjAwMDAxLCAwLjk5OTk5LCAwLjk5OTk5LCAxLCAxLjAwMDIzLCAxLCAxLCAwLjk5OTk5LCAxLjAwMDM1LCAxLjAwMDAxLCAwLjk5OTk5LCAwLjk5OTczLCAwLjk5OTc3LCAwLjk5OTk5LCAxLjAwMDU4LCAwLjk5OTczLCAwLjk5OTczLCAwLjk5OTU1LCAwLjk5OTUsIDEuMDAwMjYsIDEuMDAwMjYsIDEuMDAwMzIsIDAuOTk5ODksIDEuMDAwMzQsIDAuOTk5OTksIDEuMDAwMjYsIDEuMDAwMjYsIDEuMDAwMjYsIDAuOTk5NzMsIDAuNDU5OTgsIDAuOTk5NzMsIDEuMDAwMjYsIDAuOTk5NzMsIDEuMDAwMDEsIDAuOTk5OTksIDAuOTk5ODIsIDAuOTk5OTQsIDAuOTk5OTYsIDEsIDEuMDAwNDIsIDEuMDAwNDQsIDEuMDAwMjksIDEuMDAwMjMsIDAuOTk5NzMsIDAuOTk5NzMsIDEuMDAwMjYsIDAuOTk5NDksIDEuMDAwMDIsIDAuOTk5NzMsIDEuMDAwNiwgMS4wMDA2LCAxLjAwMDYsIDAuOTk5NzUsIDEuMDAwMjYsIDEuMDAwMjYsIDEuMDAwMzIsIDAuOTg2ODUsIDAuOTk5NzMsIDEuMDAwMjYsIDEsIDEsIDAuOTk5NjYsIDEuMDAwNDQsIDEuMDAwMTYsIDEuMDAwMjIsIDEuMDAwMTYsIDEuMDAwMjIsIDEuMDAwMTYsIDEuMDAwMjIsIDEuMDAwMDEsIDAuOTk5NzMsIDEsIDEsIDAuOTk5NzMsIDEsIDEsIDAuOTk5NTUsIDEuMDAwNiwgMS4wMDA2LCAxLjAwMDYsIDEuMDAwNiwgMSwgMSwgMSwgMC45OTk3MywgMC45OTk3MywgMC45OTk3MiwgMSwgMSwgMS4wMDEwNiwgMC45OTk5OSwgMC45OTk5OCwgMC45OTk5OCwgMC45OTk5OSwgMC45OTk5OCwgMS42NjQ3NSwgMSwgMC45OTk3MywgMC45OTk3MywgMSwgMC45OTk3MywgMC45OTk3MSwgMC45OTk3OCwgMSwgMSwgMC45OTk5MSwgMC45OTk4NCwgMS4wMDAwMiwgMS4wMDAwMiwgMS4wMDAwMiwgMS4wMDAwMiwgMS4wMDA5OCwgMSwgMSwgMSwgMS4wMDA0OSwgMSwgMSwgMC45OTk3MiwgMSwgMS4yMDk4NSwgMS4zOTcxMywgMS4wMDAwMywgMS4wMDAzMSwgMS4wMDAxNSwgMSwgMC45OTU2MSwgMS4wMDAyNywgMS4wMDAzMSwgMS4wMDAzMSwgMC45OTkxNSwgMS4wMDAzMSwgMS4wMDAzMSwgMC45OTk5OSwgMS4wMDAwMywgMC45OTk5OSwgMC45OTk5OSwgMS40MTE0NCwgMS42LCAxLjQxMTQ0LCAxLjQxMTQ0LCAxLjQxMTQ0LCAxLjQxMTQ0LCAxLjQxMTQ0LCAxLjQxMTQ0LCAxLjQxMTQ0LCAxLjQxMTQ0LCAxLjQxMTQ0LCAxLjQxMTQ0LCAxLjQxMTQ0LCAxLjQxMTQ0LCAxLjQxMTQ0LCAxLjQxMTQ0LCAxLjQxMTQ0LCAxLjQxMTQ0LCAxLjQxMTQ0LCAxLjQxMTQ0LCAxLjQxMTQ0LCAxLjQxMTQ0LCAxLjQxMTQ0LCAxLjQxMTQ0LCAxLjQxMTQ0LCAxLjQxMTQ0LCAxLjQxMTQ0LCAxLjQxMTQ0LCAxLjQxMTQ0LCAxLjQxMTQ0LCAxLjQxMTQ0LCAxLjQxMTQ0LCAxLjQxMTQ0LCAxLjQxMTQ0LCAxLjQxMTQ0LCAxLjQxMTQ0LCAxLjQxMTQ0LCAxLjQxMTQ0LCAxLjQxMTQ0LCAxLjQxMTQ0LCAxLjQxMTQ0LCAxLjQxMTQ0LCAxLjQxMTQ0LCAxLjQxMTQ0LCAxLjQxMTQ0LCAxLjQwNTc5LCAxLjQwNTc5LCAxLjM2NjI1LCAwLjk5OTk5LCAxLCAwLjk5ODYxLCAwLjk5ODYxLCAxLCAxLjAwMDI2LCAxLjAwMDI2LCAxLjAwMDI2LCAxLjAwMDI2LCAwLjk5OTcyLCAwLjk5OTk5LCAwLjk5OTk5LCAwLjk5OTk5LCAwLjk5OTk5LCAxLjQwNDgzLCAxLCAwLjk5OTc3LCAxLjAwMDU0LCAxLCAxLCAwLjk5OTUzLCAwLjk5OTYyLCAxLjAwMDQyLCAwLjk5OTUsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDAuOTk5OTgsIDAuOTk5OTgsIDAuOTk5OTgsIDAuOTk5OTgsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDFdOwpleHBvcnRzLkhlbHZldGljYUJvbGRJdGFsaWNGYWN0b3JzID0gSGVsdmV0aWNhQm9sZEl0YWxpY0ZhY3RvcnM7CmNvbnN0IEhlbHZldGljYUJvbGRJdGFsaWNNZXRyaWNzID0gewogIGxpbmVIZWlnaHQ6IDEuMzUsCiAgbGluZUdhcDogMC4yCn07CmV4cG9ydHMuSGVsdmV0aWNhQm9sZEl0YWxpY01ldHJpY3MgPSBIZWx2ZXRpY2FCb2xkSXRhbGljTWV0cmljczsKY29uc3QgSGVsdmV0aWNhSXRhbGljRmFjdG9ycyA9IFswLjc2MTE2LCAxLCAxLCAxLjAwMDYsIDEuMDAwNiwgMS4wMDAwNiwgMC45OTk3MywgMC45OTk3MywgMC45OTk4MiwgMS4wMDAwMSwgMS4wMDA0MywgMC45OTk5OCwgMC45OTk5OCwgMC45OTk1OSwgMS4wMDAwMywgMS4wMDA2LCAwLjk5OTk4LCAxLjAwMDYsIDEuMDAwNiwgMC45OTk3MywgMC45OTk3MywgMC45OTk3MywgMC45OTk3MywgMC45OTk3MywgMC45OTk3MywgMC45OTk3MywgMC45OTk3MywgMC45OTk3MywgMC45OTk3MywgMS4wMDA2LCAxLCAxLjAwMDAzLCAxLjAwMDAzLCAxLjAwMDAzLCAwLjk5OTczLCAwLjk5OTg3LCAxLjAwMDAxLCAxLjAwMDAxLCAwLjk5OTc3LCAwLjk5OTc3LCAxLjAwMDAxLCAxLjAwMDI2LCAxLjAwMDIyLCAwLjk5OTc3LCAxLjAwMDYsIDEsIDEuMDAwMDEsIDAuOTk5NzMsIDAuOTk5OTksIDAuOTk5NzcsIDEuMDAwMjIsIDEuMDAwMDEsIDEuMDAwMjIsIDAuOTk5NzcsIDEuMDAwMDEsIDEuMDAwMjYsIDAuOTk5NzcsIDEuMDAwMDEsIDEuMDAwMTYsIDEuMDAwMDEsIDEuMDAwMDEsIDEuMDAwMjYsIDEuMDAwNiwgMS4wMDA2LCAxLjAwMDYsIDAuOTk5NDksIDAuOTk5NzMsIDAuOTk5OTgsIDAuOTk5NzMsIDAuOTk5NzMsIDEsIDAuOTk5NzMsIDAuOTk5NzMsIDEuMDAwNiwgMC45OTk3MywgMC45OTk3MywgMC45OTkyNCwgMC45OTkyNCwgMSwgMC45OTkyNCwgMC45OTk5OSwgMC45OTk3MywgMC45OTk3MywgMC45OTk3MywgMC45OTk3MywgMC45OTk5OCwgMSwgMS4wMDA2LCAwLjk5OTczLCAxLCAwLjk5OTc3LCAxLCAxLCAxLCAxLjAwMDA1LCAxLjAwMDksIDEuMDAwMDUsIDEuMDAwMDMsIDAuOTk5OTgsIDAuOTk5NzMsIDAuOTk5NzMsIDAuOTk5NzMsIDAuOTk5NzMsIDEuMDAwOSwgMC45OTk3MywgMC45OTk5OCwgMS4wMDAyNSwgMC45OTk2OCwgMC45OTk3MywgMS4wMDAwMywgMS4wMDAyNSwgMC42MDI5OSwgMS4wMDAyNCwgMS4wNjQwOSwgMSwgMSwgMC45OTk5OCwgMSwgMC45OTk4LCAxLjAwMDYsIDAuOTk5OTgsIDEsIDAuOTk5MzYsIDAuOTk5NzMsIDEuMDAwMDIsIDEuMDAwMDIsIDEuMDAwMDIsIDEuMDAwMjYsIDEuMDAwMDEsIDEuMDAwMDEsIDEuMDAwMDEsIDEuMDAwMDEsIDEuMDAwMDEsIDEuMDAwMDEsIDEsIDAuOTk5NzcsIDEuMDAwMDEsIDEuMDAwMDEsIDEuMDAwMDEsIDEuMDAwMDEsIDEuMDAwNiwgMS4wMDA2LCAxLjAwMDYsIDEuMDAwNiwgMC45OTk3NywgMC45OTk3NywgMS4wMDAyMiwgMS4wMDAyMiwgMS4wMDAyMiwgMS4wMDAyMiwgMS4wMDAyMiwgMS4wMDAwMywgMS4wMDAyMiwgMC45OTk3NywgMC45OTk3NywgMC45OTk3NywgMC45OTk3NywgMS4wMDAwMSwgMS4wMDAwMSwgMS4wMDAyNiwgMC45OTk3MywgMC45OTk3MywgMC45OTk3MywgMC45OTk3MywgMC45OTk3MywgMC45OTk3MywgMC45OTk4MiwgMSwgMC45OTk3MywgMC45OTk3MywgMC45OTk3MywgMC45OTk3MywgMS4wMDA2LCAxLjAwMDYsIDEuMDAwNiwgMS4wMDA2LCAwLjk5OTczLCAwLjk5OTczLCAwLjk5OTczLCAwLjk5OTczLCAwLjk5OTczLCAwLjk5OTczLCAwLjk5OTczLCAxLjA2NDA5LCAxLjAwMDI2LCAwLjk5OTczLCAwLjk5OTczLCAwLjk5OTczLCAwLjk5OTczLCAxLCAwLjk5OTczLCAxLCAxLjAwMDAxLCAwLjk5OTczLCAxLjAwMDAxLCAwLjk5OTczLCAxLjAwMDAxLCAwLjk5OTczLCAwLjk5OTc3LCAxLCAwLjk5OTc3LCAxLCAwLjk5OTc3LCAxLCAwLjk5OTc3LCAxLCAwLjk5OTc3LCAxLjAyODgsIDAuOTk5NzcsIDAuOTk5NzMsIDEuMDAwMDEsIDAuOTk5NzMsIDEuMDAwMDEsIDAuOTk5NzMsIDEuMDAwMDEsIDAuOTk5NzMsIDEuMDAwMDEsIDAuOTk5NzMsIDEuMDAwMDEsIDAuOTk5NzMsIDEuMDAwMjIsIDAuOTk5NzMsIDEuMDAwMjIsIDAuOTk5NzMsIDEuMDAwMjIsIDAuOTk5NzMsIDEuMDAwMjIsIDAuOTk5NzMsIDAuOTk5NzcsIDAuOTk5NzMsIDAuOTk5NzcsIDAuOTk5NzMsIDEuMDAwNiwgMS4wMDA2LCAxLjAwMDYsIDEuMDAwNiwgMS4wMDA2LCAxLjAwMDYsIDEuMDAwNiwgMC45OTkyNCwgMS4wMDA2LCAxLjAwMDYsIDAuOTk5NDYsIDEuMDAwMzQsIDEsIDAuOTk5MjQsIDEuMDAwMDEsIDEsIDEsIDAuOTk5NzMsIDAuOTk5MjQsIDAuOTk5NzMsIDAuOTk5MjQsIDAuOTk5NzMsIDEuMDYzMTEsIDAuOTk5NzMsIDEuMDAwMjQsIDAuOTk5NzMsIDAuOTk5MjQsIDAuOTk5NzcsIDAuOTk5NzMsIDAuOTk5NzcsIDAuOTk5NzMsIDAuOTk5NzcsIDAuOTk5NzMsIDEuMDAwNDEsIDAuOTk5OCwgMC45OTk3MywgMS4wMDAyMiwgMC45OTk3MywgMS4wMDAyMiwgMC45OTk3MywgMS4wMDAyMiwgMC45OTk3MywgMSwgMS4wMDAxNiwgMC45OTk3NywgMC45OTk5OCwgMC45OTk3NywgMC45OTk5OCwgMC45OTk3NywgMC45OTk5OCwgMS4wMDAwMSwgMSwgMS4wMDAwMSwgMSwgMS4wMDAwMSwgMSwgMS4wMDAwMSwgMSwgMS4wMDAyNiwgMS4wMDA2LCAxLjAwMDI2LCAwLjg5NTQ3LCAxLjAwMDI2LCAxLjAwMDYsIDAuOTk5NzcsIDAuOTk5NzMsIDAuOTk5NzcsIDAuOTk5NzMsIDAuOTk5NzcsIDAuOTk5NzMsIDAuOTk5NzcsIDAuOTk5NzMsIDAuOTk5NzcsIDAuOTk5NzMsIDAuOTk5NzcsIDAuOTk5NzMsIDEuMDAwMTYsIDAuOTk5NzcsIDEuMDAwMDEsIDEsIDEuMDAwMDEsIDEuMDAwMjYsIDEsIDEuMDAwMjYsIDEsIDEuMDAwMjYsIDEsIDAuOTk5MjQsIDAuOTk5NzMsIDEuMDAwMDEsIDAuOTk5NzMsIDEsIDAuOTk5ODIsIDEuMDAwMjIsIDEuMDAwMjYsIDEuMDAwMDEsIDEsIDEuMDAwMjYsIDEuMDAwNiwgMC45OTk5OCwgMC45OTk5OCwgMC45OTk5OCwgMC45OTk5OCwgMC45OTk5OCwgMC45OTk5OCwgMC45OTk5OCwgMC45OTk5OCwgMC45OTk5OCwgMC45OTk5OCwgMC45OTk5OCwgMS4wMDAwMSwgMSwgMS4wMDA1NCwgMC45OTk3NywgMS4wMDA4NCwgMS4wMDAwNywgMC45OTk3MywgMS4wMDAxMywgMC45OTkyNCwgMS4wMDAwMSwgMS4wMDAwMSwgMC45OTk0NSwgMC45MTIyMSwgMS4wMDAwMSwgMS4wMDAyNiwgMC45OTk3NywgMS4wMDAyMiwgMS4wMDA2LCAxLjAwMDAxLCAxLjAwMDAxLCAwLjk5OTk5LCAwLjk5OTc3LCAwLjk5OTMzLCAxLjAwMDIyLCAxLjAwMDU0LCAxLjAwMDAxLCAxLjAwMDY1LCAxLjAwMDI2LCAxLjAwMDAxLCAxLjAwMDEsIDEuMDAwMDEsIDEuMDAwNTIsIDEsIDEuMDAwNiwgMS4wMDAwMSwgMC45OTk0NSwgMC45OTg5NywgMC45OTk2OCwgMC45OTkyNCwgMS4wMDAzNiwgMC45OTk0NSwgMC45OTk0OSwgMSwgMS4wMDA2LCAwLjk5ODk3LCAwLjk5OTE4LCAwLjk5OTY4LCAwLjk5OTExLCAwLjk5OTI0LCAxLCAwLjk5OTYyLCAxLjAxNDg3LCAxLCAxLjAwMDUsIDAuOTk5NzMsIDEuMDAwMTIsIDEuMDAwNDMsIDEsIDAuOTk5OTUsIDAuOTk5OTQsIDEuMDAwMzYsIDAuOTk5NDcsIDEuMDAwMTksIDEuMDAwNjMsIDEuMDAwMjUsIDAuOTk5MjQsIDEuMDAwMzYsIDAuOTk5NzMsIDEuMDAwMzYsIDEuMDAwMjUsIDEuMDAwMDEsIDEuMDAwMDEsIDEuMDAwMjcsIDEuMDAwMSwgMS4wMDA2OCwgMS4wMDAwMSwgMS4wMDA2LCAxLjAwMDYsIDEsIDEuMDAwMDgsIDAuOTk5NTcsIDAuOTk5NzIsIDAuOTk5NCwgMC45OTk1NCwgMC45OTk3NSwgMS4wMDA1MSwgMS4wMDAwMSwgMS4wMDAxOSwgMS4wMDAwMSwgMS4wMDAxLCAwLjk5OTg2LCAxLjAwMDAxLCAxLjAwMDAxLCAxLjAwMDM4LCAwLjk5OTU0LCAwLjk5OTU0LCAwLjk5OTQsIDEuMDAwNjYsIDAuOTk5OTksIDAuOTk5NzcsIDEuMDAwMjIsIDEuMDAwNTQsIDEuMDAwMDEsIDAuOTk5NzcsIDEuMDAwMjYsIDAuOTk5NzUsIDEuMDAwMSwgMS4wMDAwMSwgMC45OTk5MywgMC45OTk1LCAwLjk5OTU1LCAxLjAwMDE2LCAwLjk5OTc4LCAwLjk5OTc0LCAxLjAwMDE5LCAxLjAwMDIyLCAwLjk5OTU1LCAxLjAwMDUzLCAwLjk5OTczLCAxLjAwMDg5LCAxLjAwMDA1LCAwLjk5OTY3LCAxLjAwMDQ4LCAwLjk5OTczLCAxLjAwMDAyLCAxLjAwMDM0LCAwLjk5OTczLCAwLjk5OTczLCAwLjk5OTY0LCAxLjAwMDA2LCAxLjAwMDY2LCAwLjk5OTQ3LCAwLjk5OTczLCAwLjk4ODk0LCAwLjk5OTczLCAxLCAwLjQ0ODk4LCAxLCAwLjk5OTQ2LCAxLCAxLjAwMDM5LCAxLjAwMDgyLCAwLjk5OTkxLCAwLjk5OTkxLCAwLjk5OTg1LCAxLjAwMDIyLCAxLjAwMDIzLCAxLjAwMDYxLCAxLjAwMDA2LCAwLjk5OTY2LCAwLjk5OTczLCAwLjk5OTczLCAwLjk5OTczLCAxLjAwMDE5LCAxLjAwMDgsIDEsIDAuOTk5MjQsIDAuOTk5MjQsIDAuOTk5MjQsIDAuOTk5ODMsIDEuMDAwNDQsIDAuOTk5NzMsIDAuOTk5NjQsIDAuOTgzMzIsIDEsIDAuOTk5NzMsIDEsIDEsIDAuOTk5NjIsIDAuOTk4OTUsIDEuMDAwMTYsIDAuOTk5NzcsIDEuMDAwMTYsIDAuOTk5NzcsIDEuMDAwMTYsIDAuOTk5NzcsIDEuMDAwMDEsIDEsIDEsIDEsIDAuOTk5NzMsIDEsIDEsIDAuOTk5NTUsIDAuOTk5MjQsIDAuOTk5MjQsIDAuOTk5MjQsIDAuOTk5MjQsIDAuOTk5OTgsIDAuOTk5OTgsIDAuOTk5OTgsIDAuOTk5NzMsIDAuOTk5NzMsIDAuOTk5NzIsIDEsIDEsIDEuMDAyNjcsIDAuOTk5OTksIDAuOTk5OTgsIDAuOTk5OTgsIDEsIDAuOTk5OTgsIDEuNjY0NzUsIDEsIDAuOTk5NzMsIDAuOTk5NzMsIDEuMDAwMjMsIDAuOTk5NzMsIDEuMDA0MjMsIDAuOTk5MjUsIDAuOTk5OTksIDEsIDAuOTk5OTEsIDAuOTk5ODQsIDEuMDAwMDIsIDEuMDAwMDIsIDEuMDAwMDIsIDEuMDAwMDIsIDEuMDAwNDksIDEsIDEuMDAyNDUsIDEsIDEsIDEsIDEsIDAuOTYzMjksIDEsIDEuMjA5ODUsIDEuMzk3MTMsIDEuMDAwMDMsIDAuODI1NCwgMS4wMDAxNSwgMSwgMS4wMDAzNSwgMS4wMDAyNywgMS4wMDAzMSwgMS4wMDAzMSwgMS4wMDAwMywgMS4wMDAzMSwgMS4wMDAzMSwgMC45OTk5OSwgMS4wMDAwMywgMC45OTk5OSwgMC45OTk5OSwgMS40MTE0NCwgMS42LCAxLjQxMTQ0LCAxLjQxMTQ0LCAxLjQxMTQ0LCAxLjQxMTQ0LCAxLjQxMTQ0LCAxLjQxMTQ0LCAxLjQxMTQ0LCAxLjQxMTQ0LCAxLjQxMTQ0LCAxLjQxMTQ0LCAxLjQxMTQ0LCAxLjQxMTQ0LCAxLjQxMTQ0LCAxLjQxMTQ0LCAxLjQxMTQ0LCAxLjQxMTQ0LCAxLjQxMTQ0LCAxLjQxMTQ0LCAxLjQxMTQ0LCAxLjQxMTQ0LCAxLjQxMTQ0LCAxLjQxMTQ0LCAxLjQxMTQ0LCAxLjQxMTQ0LCAxLjQxMTQ0LCAxLjQxMTQ0LCAxLjQxMTQ0LCAxLjQxMTQ0LCAxLjQxMTQ0LCAxLjQxMTQ0LCAxLjQxMTQ0LCAxLjQxMTQ0LCAxLjQxMTQ0LCAxLjQxMTQ0LCAxLjQxMTQ0LCAxLjQxMTQ0LCAxLjQxMTQ0LCAxLjQxMTQ0LCAxLjQxMTQ0LCAxLjQxMTQ0LCAxLjQxMTQ0LCAxLjQxMTQ0LCAxLjQxMTQ0LCAxLjQwNTc5LCAxLjQwNTc5LCAxLjM2NjI1LCAwLjk5OTk5LCAxLCAwLjk5ODYxLCAwLjk5ODYxLCAxLCAxLjAwMDI2LCAxLjAwMDI2LCAxLjAwMDI2LCAxLjAwMDI2LCAwLjk1MzE3LCAwLjk5OTk5LCAwLjk5OTk5LCAwLjk5OTk5LCAwLjk5OTk5LCAxLjQwNDgzLCAxLCAwLjk5OTc3LCAxLjAwMDU0LCAxLCAxLCAwLjk5OTUzLCAwLjk5OTYyLCAxLjAwMDQyLCAwLjk5OTUsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDAuOTk5OTgsIDAuOTk5OTgsIDAuOTk5OTgsIDAuOTk5OTgsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDFdOwpleHBvcnRzLkhlbHZldGljYUl0YWxpY0ZhY3RvcnMgPSBIZWx2ZXRpY2FJdGFsaWNGYWN0b3JzOwpjb25zdCBIZWx2ZXRpY2FJdGFsaWNNZXRyaWNzID0gewogIGxpbmVIZWlnaHQ6IDEuMzUsCiAgbGluZUdhcDogMC4yCn07CmV4cG9ydHMuSGVsdmV0aWNhSXRhbGljTWV0cmljcyA9IEhlbHZldGljYUl0YWxpY01ldHJpY3M7CmNvbnN0IEhlbHZldGljYVJlZ3VsYXJGYWN0b3JzID0gWzAuNzYxMTYsIDEsIDEsIDEuMDAwNiwgMS4wMDA2LCAxLjAwMDA2LCAwLjk5OTczLCAwLjk5OTczLCAwLjk5OTgyLCAxLjAwMDAxLCAxLjAwMDQzLCAwLjk5OTk4LCAwLjk5OTk4LCAwLjk5OTU5LCAxLjAwMDAzLCAxLjAwMDYsIDAuOTk5OTgsIDEuMDAwNiwgMS4wMDA2LCAwLjk5OTczLCAwLjk5OTczLCAwLjk5OTczLCAwLjk5OTczLCAwLjk5OTczLCAwLjk5OTczLCAwLjk5OTczLCAwLjk5OTczLCAwLjk5OTczLCAwLjk5OTczLCAxLjAwMDYsIDEsIDEuMDAwMDMsIDEuMDAwMDMsIDEuMDAwMDMsIDAuOTk5NzMsIDAuOTk5ODcsIDEuMDAwMDEsIDEuMDAwMDEsIDAuOTk5NzcsIDAuOTk5NzcsIDEuMDAwMDEsIDEuMDAwMjYsIDEuMDAwMjIsIDAuOTk5NzcsIDEuMDAwNiwgMSwgMS4wMDAwMSwgMC45OTk3MywgMC45OTk5OSwgMC45OTk3NywgMS4wMDAyMiwgMS4wMDAwMSwgMS4wMDAyMiwgMC45OTk3NywgMS4wMDAwMSwgMS4wMDAyNiwgMC45OTk3NywgMS4wMDAwMSwgMS4wMDAxNiwgMS4wMDAwMSwgMS4wMDAwMSwgMS4wMDAyNiwgMS4wMDA2LCAxLjAwMDYsIDEuMDAwNiwgMC45OTk0OSwgMC45OTk3MywgMC45OTk5OCwgMC45OTk3MywgMC45OTk3MywgMSwgMC45OTk3MywgMC45OTk3MywgMS4wMDA2LCAwLjk5OTczLCAwLjk5OTczLCAwLjk5OTI0LCAwLjk5OTI0LCAxLCAwLjk5OTI0LCAwLjk5OTk5LCAwLjk5OTczLCAwLjk5OTczLCAwLjk5OTczLCAwLjk5OTczLCAwLjk5OTk4LCAxLCAxLjAwMDYsIDAuOTk5NzMsIDEsIDAuOTk5NzcsIDEsIDEsIDEsIDEuMDAwMDUsIDEuMDAwOSwgMS4wMDAwNSwgMS4wMDAwMywgMC45OTk5OCwgMC45OTk3MywgMC45OTk3MywgMC45OTk3MywgMC45OTk3MywgMS4wMDA5LCAwLjk5OTczLCAwLjk5OTk4LCAxLjAwMDI1LCAwLjk5OTY4LCAwLjk5OTczLCAxLjAwMDAzLCAxLjAwMDI1LCAwLjYwMjk5LCAxLjAwMDI0LCAxLjA2NDA5LCAxLCAxLCAwLjk5OTk4LCAxLCAwLjk5OTgsIDEuMDAwNiwgMC45OTk5OCwgMSwgMC45OTkzNiwgMC45OTk3MywgMS4wMDAwMiwgMS4wMDAwMiwgMS4wMDAwMiwgMS4wMDAyNiwgMS4wMDAwMSwgMS4wMDAwMSwgMS4wMDAwMSwgMS4wMDAwMSwgMS4wMDAwMSwgMS4wMDAwMSwgMSwgMC45OTk3NywgMS4wMDAwMSwgMS4wMDAwMSwgMS4wMDAwMSwgMS4wMDAwMSwgMS4wMDA2LCAxLjAwMDYsIDEuMDAwNiwgMS4wMDA2LCAwLjk5OTc3LCAwLjk5OTc3LCAxLjAwMDIyLCAxLjAwMDIyLCAxLjAwMDIyLCAxLjAwMDIyLCAxLjAwMDIyLCAxLjAwMDAzLCAxLjAwMDIyLCAwLjk5OTc3LCAwLjk5OTc3LCAwLjk5OTc3LCAwLjk5OTc3LCAxLjAwMDAxLCAxLjAwMDAxLCAxLjAwMDI2LCAwLjk5OTczLCAwLjk5OTczLCAwLjk5OTczLCAwLjk5OTczLCAwLjk5OTczLCAwLjk5OTczLCAwLjk5OTgyLCAxLCAwLjk5OTczLCAwLjk5OTczLCAwLjk5OTczLCAwLjk5OTczLCAxLjAwMDYsIDEuMDAwNiwgMS4wMDA2LCAxLjAwMDYsIDAuOTk5NzMsIDAuOTk5NzMsIDAuOTk5NzMsIDAuOTk5NzMsIDAuOTk5NzMsIDAuOTk5NzMsIDAuOTk5NzMsIDEuMDY0MDksIDEuMDAwMjYsIDAuOTk5NzMsIDAuOTk5NzMsIDAuOTk5NzMsIDAuOTk5NzMsIDEsIDAuOTk5NzMsIDEsIDEuMDAwMDEsIDAuOTk5NzMsIDEuMDAwMDEsIDAuOTk5NzMsIDEuMDAwMDEsIDAuOTk5NzMsIDAuOTk5NzcsIDEsIDAuOTk5NzcsIDEsIDAuOTk5NzcsIDEsIDAuOTk5NzcsIDEsIDAuOTk5NzcsIDEuMDQ1OTYsIDAuOTk5NzcsIDAuOTk5NzMsIDEuMDAwMDEsIDAuOTk5NzMsIDEuMDAwMDEsIDAuOTk5NzMsIDEuMDAwMDEsIDAuOTk5NzMsIDEuMDAwMDEsIDAuOTk5NzMsIDEuMDAwMDEsIDAuOTk5NzMsIDEuMDAwMjIsIDAuOTk5NzMsIDEuMDAwMjIsIDAuOTk5NzMsIDEuMDAwMjIsIDAuOTk5NzMsIDEuMDAwMjIsIDAuOTk5NzMsIDAuOTk5NzcsIDAuOTk5NzMsIDAuOTk5NzcsIDAuOTk5NzMsIDEuMDAwNiwgMS4wMDA2LCAxLjAwMDYsIDEuMDAwNiwgMS4wMDA2LCAxLjAwMDYsIDEuMDAwNiwgMC45OTkyNCwgMS4wMDA2LCAxLjAwMDYsIDEuMDAwMTksIDEuMDAwMzQsIDEsIDAuOTk5MjQsIDEuMDAwMDEsIDEsIDEsIDAuOTk5NzMsIDAuOTk5MjQsIDAuOTk5NzMsIDAuOTk5MjQsIDAuOTk5NzMsIDEuMDI1NzIsIDAuOTk5NzMsIDEuMDAwMDUsIDAuOTk5NzMsIDAuOTk5MjQsIDAuOTk5NzcsIDAuOTk5NzMsIDAuOTk5NzcsIDAuOTk5NzMsIDAuOTk5NzcsIDAuOTk5NzMsIDAuOTk5OTksIDAuOTk5OCwgMC45OTk3MywgMS4wMDAyMiwgMC45OTk3MywgMS4wMDAyMiwgMC45OTk3MywgMS4wMDAyMiwgMC45OTk3MywgMSwgMS4wMDAxNiwgMC45OTk3NywgMC45OTk5OCwgMC45OTk3NywgMC45OTk5OCwgMC45OTk3NywgMC45OTk5OCwgMS4wMDAwMSwgMSwgMS4wMDAwMSwgMSwgMS4wMDAwMSwgMSwgMS4wMDAwMSwgMSwgMS4wMDAyNiwgMS4wMDA2LCAxLjAwMDI2LCAwLjg0NTMzLCAxLjAwMDI2LCAxLjAwMDYsIDAuOTk5NzcsIDAuOTk5NzMsIDAuOTk5NzcsIDAuOTk5NzMsIDAuOTk5NzcsIDAuOTk5NzMsIDAuOTk5NzcsIDAuOTk5NzMsIDAuOTk5NzcsIDAuOTk5NzMsIDAuOTk5NzcsIDAuOTk5NzMsIDEuMDAwMTYsIDAuOTk5NzcsIDEuMDAwMDEsIDEsIDEuMDAwMDEsIDEuMDAwMjYsIDEsIDEuMDAwMjYsIDEsIDEuMDAwMjYsIDEsIDAuOTk5MjQsIDAuOTk5NzMsIDEuMDAwMDEsIDAuOTk5NzMsIDEsIDAuOTk5ODIsIDEuMDAwMjIsIDEuMDAwMjYsIDEuMDAwMDEsIDEsIDEuMDAwMjYsIDEuMDAwNiwgMC45OTk5OCwgMC45OTk5OCwgMC45OTk5OCwgMC45OTk5OCwgMC45OTk5OCwgMC45OTk5OCwgMC45OTk5OCwgMC45OTk5OCwgMC45OTk5OCwgMC45OTk5OCwgMC45OTk5OCwgMC45OTkyOCwgMSwgMC45OTk3NywgMS4wMDAxMywgMS4wMDA1NSwgMC45OTk0NywgMC45OTk0NSwgMC45OTk0MSwgMC45OTkyNCwgMS4wMDAwMSwgMS4wMDAwMSwgMS4wMDA0LCAwLjkxNjIxLCAxLjAwMDAxLCAxLjAwMDI2LCAwLjk5OTc3LCAxLjAwMDIyLCAxLjAwMDYsIDEuMDAwMDEsIDEuMDAwMDUsIDAuOTk5OTksIDAuOTk5NzcsIDEuMDAwMTUsIDEuMDAwMjIsIDAuOTk5NzcsIDEuMDAwMDEsIDAuOTk5NzMsIDEuMDAwMjYsIDEuMDAwMDEsIDEuMDAwMTksIDEuMDAwMDEsIDAuOTk5NDYsIDEsIDEuMDAwNiwgMS4wMDAwMSwgMC45OTk3OCwgMS4wMDA0NSwgMC45OTk3MywgMC45OTkyNCwgMS4wMDAyMywgMC45OTk3OCwgMC45OTk2NiwgMSwgMS4wMDA2NSwgMS4wMDA0NSwgMS4wMDAxOSwgMC45OTk3MywgMC45OTk3MywgMC45OTkyNCwgMSwgMSwgMC45NjQ5OSwgMSwgMS4wMDA1NSwgMC45OTk3MywgMS4wMDAwOCwgMS4wMDAyNywgMSwgMC45OTk3LCAwLjk5OTk1LCAxLjAwMDIzLCAwLjk5OTMzLCAxLjAwMDE5LCAxLjAwMDE1LCAxLjAwMDMxLCAwLjk5OTI0LCAxLjAwMDIzLCAwLjk5OTczLCAxLjAwMDIzLCAxLjAwMDMxLCAxLjAwMDAxLCAwLjk5OTI4LCAxLjAwMDI5LCAxLjAwMDkyLCAxLjAwMDM1LCAxLjAwMDAxLCAxLjAwMDYsIDEuMDAwNiwgMSwgMC45OTk4OCwgMC45OTk3NSwgMSwgMS4wMDA4MiwgMC45OTU2MSwgMC45OTk2LCAxLjAwMDM1LCAxLjAwMDAxLCAwLjk5OTYyLCAxLjAwMDAxLCAxLjAwMDkyLCAwLjk5OTY0LCAxLjAwMDAxLCAwLjk5OTYzLCAwLjk5OTk5LCAxLjAwMDM1LCAxLjAwMDM1LCAxLjAwMDgyLCAwLjk5OTYyLCAwLjk5OTk5LCAwLjk5OTc3LCAxLjAwMDIyLCAxLjAwMDM1LCAxLjAwMDAxLCAwLjk5OTc3LCAxLjAwMDI2LCAwLjk5OTYsIDAuOTk5NjcsIDEuMDAwMDEsIDEuMDAwMzQsIDEuMDAwNzQsIDEuMDAwNTQsIDEuMDAwNTMsIDEuMDAwNjMsIDAuOTk5NzEsIDAuOTk5NjIsIDEuMDAwMzUsIDAuOTk5NzUsIDAuOTk5NzcsIDAuOTk5NzMsIDEuMDAwNDMsIDAuOTk5NTMsIDEuMDAwNywgMC45OTkxNSwgMC45OTk3MywgMS4wMDAwOCwgMC45OTg5MiwgMS4wMDA3MywgMS4wMDA3MywgMS4wMDExNCwgMC45OTkxNSwgMS4wMDA3MywgMC45OTk1NSwgMC45OTk3MywgMS4wMDA5MiwgMC45OTk3MywgMSwgMC45OTk5OCwgMSwgMS4wMDAzLCAxLCAxLjAwMDQzLCAxLjAwMDAxLCAwLjk5OTY5LCAxLjAwMDMsIDEsIDEuMDAwMzUsIDEuMDAwMDEsIDAuOTk5NSwgMSwgMS4wMDA5MiwgMC45OTk3MywgMC45OTk3MywgMC45OTk3MywgMS4wMDA3LCAwLjk5OTUsIDEsIDAuOTk5MjQsIDEuMDAwNiwgMC45OTkyNCwgMC45OTk3MiwgMS4wMDA2MiwgMC45OTk3MywgMS4wMDExNCwgMS4wMDA3MywgMSwgMC45OTk1NSwgMSwgMSwgMS4wMDA0NywgMC45OTk2OCwgMS4wMDAxNiwgMC45OTk3NywgMS4wMDAxNiwgMC45OTk3NywgMS4wMDAxNiwgMC45OTk3NywgMS4wMDAwMSwgMSwgMSwgMSwgMC45OTk3MywgMSwgMSwgMC45OTk1NSwgMC45OTkyNCwgMC45OTkyNCwgMC45OTkyNCwgMC45OTkyNCwgMC45OTk5OCwgMC45OTk5OCwgMC45OTk5OCwgMC45OTk3MywgMC45OTk3MywgMC45OTk3MiwgMSwgMSwgMS4wMDI2NywgMC45OTk5OSwgMC45OTk5OCwgMC45OTk5OCwgMSwgMC45OTk5OCwgMS42NjQ3NSwgMSwgMC45OTk3MywgMC45OTk3MywgMS4wMDAyMywgMC45OTk3MywgMC45OTk3MSwgMC45OTkyNSwgMS4wMDAyMywgMSwgMC45OTk5MSwgMC45OTk4NCwgMS4wMDAwMiwgMS4wMDAwMiwgMS4wMDAwMiwgMS4wMDAwMiwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMC45NjMyOSwgMSwgMS4yMDk4NSwgMS4zOTcxMywgMS4wMDAwMywgMC44MjU0LCAxLjAwMDE1LCAxLCAxLjAwMDM1LCAxLjAwMDI3LCAxLjAwMDMxLCAxLjAwMDMxLCAwLjk5OTE1LCAxLjAwMDMxLCAxLjAwMDMxLCAwLjk5OTk5LCAxLjAwMDAzLCAwLjk5OTk5LCAwLjk5OTk5LCAxLjQxMTQ0LCAxLjYsIDEuNDExNDQsIDEuNDExNDQsIDEuNDExNDQsIDEuNDExNDQsIDEuNDExNDQsIDEuNDExNDQsIDEuNDExNDQsIDEuNDExNDQsIDEuNDExNDQsIDEuNDExNDQsIDEuNDExNDQsIDEuNDExNDQsIDEuNDExNDQsIDEuNDExNDQsIDEuNDExNDQsIDEuNDExNDQsIDEuNDExNDQsIDEuNDExNDQsIDEuNDExNDQsIDEuNDExNDQsIDEuNDExNDQsIDEuNDExNDQsIDEuNDExNDQsIDEuNDExNDQsIDEuNDExNDQsIDEuNDExNDQsIDEuNDExNDQsIDEuNDExNDQsIDEuNDExNDQsIDEuNDExNDQsIDEuNDExNDQsIDEuNDExNDQsIDEuNDExNDQsIDEuNDExNDQsIDEuNDExNDQsIDEuNDExNDQsIDEuNDExNDQsIDEuNDExNDQsIDEuNDExNDQsIDEuNDExNDQsIDEuNDExNDQsIDEuNDExNDQsIDEuNDExNDQsIDEuNDA1NzksIDEuNDA1NzksIDEuMzY2MjUsIDAuOTk5OTksIDEsIDAuOTk4NjEsIDAuOTk4NjEsIDEsIDEuMDAwMjYsIDEuMDAwMjYsIDEuMDAwMjYsIDEuMDAwMjYsIDAuOTUzMTcsIDAuOTk5OTksIDAuOTk5OTksIDAuOTk5OTksIDAuOTk5OTksIDEuNDA0ODMsIDEsIDAuOTk5NzcsIDEuMDAwNTQsIDEsIDEsIDAuOTk5NTMsIDAuOTk5NjIsIDEuMDAwNDIsIDAuOTk5NSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMV07CmV4cG9ydHMuSGVsdmV0aWNhUmVndWxhckZhY3RvcnMgPSBIZWx2ZXRpY2FSZWd1bGFyRmFjdG9yczsKY29uc3QgSGVsdmV0aWNhUmVndWxhck1ldHJpY3MgPSB7CiAgbGluZUhlaWdodDogMS4yLAogIGxpbmVHYXA6IDAuMgp9OwpleHBvcnRzLkhlbHZldGljYVJlZ3VsYXJNZXRyaWNzID0gSGVsdmV0aWNhUmVndWxhck1ldHJpY3M7CgovKioqLyB9KSwKLyogNTQgKi8KLyoqKi8gKChfX3VudXNlZF93ZWJwYWNrX21vZHVsZSwgZXhwb3J0cykgPT4gewoKCgpPYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgIl9fZXNNb2R1bGUiLCAoewogIHZhbHVlOiB0cnVlCn0pKTsKZXhwb3J0cy5MaWJlcmF0aW9uU2Fuc1JlZ3VsYXJXaWR0aHMgPSBleHBvcnRzLkxpYmVyYXRpb25TYW5zUmVndWxhck1hcHBpbmcgPSBleHBvcnRzLkxpYmVyYXRpb25TYW5zSXRhbGljV2lkdGhzID0gZXhwb3J0cy5MaWJlcmF0aW9uU2Fuc0l0YWxpY01hcHBpbmcgPSBleHBvcnRzLkxpYmVyYXRpb25TYW5zQm9sZFdpZHRocyA9IGV4cG9ydHMuTGliZXJhdGlvblNhbnNCb2xkTWFwcGluZyA9IGV4cG9ydHMuTGliZXJhdGlvblNhbnNCb2xkSXRhbGljV2lkdGhzID0gZXhwb3J0cy5MaWJlcmF0aW9uU2Fuc0JvbGRJdGFsaWNNYXBwaW5nID0gdm9pZCAwOwpjb25zdCBMaWJlcmF0aW9uU2Fuc0JvbGRXaWR0aHMgPSBbMzY1LCAwLCAzMzMsIDI3OCwgMzMzLCA0NzQsIDU1NiwgNTU2LCA4ODksIDcyMiwgMjM4LCAzMzMsIDMzMywgMzg5LCA1ODQsIDI3OCwgMzMzLCAyNzgsIDI3OCwgNTU2LCA1NTYsIDU1NiwgNTU2LCA1NTYsIDU1NiwgNTU2LCA1NTYsIDU1NiwgNTU2LCAzMzMsIDMzMywgNTg0LCA1ODQsIDU4NCwgNjExLCA5NzUsIDcyMiwgNzIyLCA3MjIsIDcyMiwgNjY3LCA2MTEsIDc3OCwgNzIyLCAyNzgsIDU1NiwgNzIyLCA2MTEsIDgzMywgNzIyLCA3NzgsIDY2NywgNzc4LCA3MjIsIDY2NywgNjExLCA3MjIsIDY2NywgOTQ0LCA2NjcsIDY2NywgNjExLCAzMzMsIDI3OCwgMzMzLCA1ODQsIDU1NiwgMzMzLCA1NTYsIDYxMSwgNTU2LCA2MTEsIDU1NiwgMzMzLCA2MTEsIDYxMSwgMjc4LCAyNzgsIDU1NiwgMjc4LCA4ODksIDYxMSwgNjExLCA2MTEsIDYxMSwgMzg5LCA1NTYsIDMzMywgNjExLCA1NTYsIDc3OCwgNTU2LCA1NTYsIDUwMCwgMzg5LCAyODAsIDM4OSwgNTg0LCAzMzMsIDU1NiwgNTU2LCA1NTYsIDU1NiwgMjgwLCA1NTYsIDMzMywgNzM3LCAzNzAsIDU1NiwgNTg0LCA3MzcsIDU1MiwgNDAwLCA1NDksIDMzMywgMzMzLCAzMzMsIDU3NiwgNTU2LCAyNzgsIDMzMywgMzMzLCAzNjUsIDU1NiwgODM0LCA4MzQsIDgzNCwgNjExLCA3MjIsIDcyMiwgNzIyLCA3MjIsIDcyMiwgNzIyLCAxMDAwLCA3MjIsIDY2NywgNjY3LCA2NjcsIDY2NywgMjc4LCAyNzgsIDI3OCwgMjc4LCA3MjIsIDcyMiwgNzc4LCA3NzgsIDc3OCwgNzc4LCA3NzgsIDU4NCwgNzc4LCA3MjIsIDcyMiwgNzIyLCA3MjIsIDY2NywgNjY3LCA2MTEsIDU1NiwgNTU2LCA1NTYsIDU1NiwgNTU2LCA1NTYsIDg4OSwgNTU2LCA1NTYsIDU1NiwgNTU2LCA1NTYsIDI3OCwgMjc4LCAyNzgsIDI3OCwgNjExLCA2MTEsIDYxMSwgNjExLCA2MTEsIDYxMSwgNjExLCA1NDksIDYxMSwgNjExLCA2MTEsIDYxMSwgNjExLCA1NTYsIDYxMSwgNTU2LCA3MjIsIDU1NiwgNzIyLCA1NTYsIDcyMiwgNTU2LCA3MjIsIDU1NiwgNzIyLCA1NTYsIDcyMiwgNTU2LCA3MjIsIDU1NiwgNzIyLCA3MTksIDcyMiwgNjExLCA2NjcsIDU1NiwgNjY3LCA1NTYsIDY2NywgNTU2LCA2NjcsIDU1NiwgNjY3LCA1NTYsIDc3OCwgNjExLCA3NzgsIDYxMSwgNzc4LCA2MTEsIDc3OCwgNjExLCA3MjIsIDYxMSwgNzIyLCA2MTEsIDI3OCwgMjc4LCAyNzgsIDI3OCwgMjc4LCAyNzgsIDI3OCwgMjc4LCAyNzgsIDI3OCwgNzg1LCA1NTYsIDU1NiwgMjc4LCA3MjIsIDU1NiwgNTU2LCA2MTEsIDI3OCwgNjExLCAyNzgsIDYxMSwgMzg1LCA2MTEsIDQ3OSwgNjExLCAyNzgsIDcyMiwgNjExLCA3MjIsIDYxMSwgNzIyLCA2MTEsIDcwOCwgNzIzLCA2MTEsIDc3OCwgNjExLCA3NzgsIDYxMSwgNzc4LCA2MTEsIDEwMDAsIDk0NCwgNzIyLCAzODksIDcyMiwgMzg5LCA3MjIsIDM4OSwgNjY3LCA1NTYsIDY2NywgNTU2LCA2NjcsIDU1NiwgNjY3LCA1NTYsIDYxMSwgMzMzLCA2MTEsIDQ3OSwgNjExLCAzMzMsIDcyMiwgNjExLCA3MjIsIDYxMSwgNzIyLCA2MTEsIDcyMiwgNjExLCA3MjIsIDYxMSwgNzIyLCA2MTEsIDk0NCwgNzc4LCA2NjcsIDU1NiwgNjY3LCA2MTEsIDUwMCwgNjExLCA1MDAsIDYxMSwgNTAwLCAyNzgsIDU1NiwgNzIyLCA1NTYsIDEwMDAsIDg4OSwgNzc4LCA2MTEsIDY2NywgNTU2LCA2MTEsIDMzMywgMzMzLCAzMzMsIDMzMywgMzMzLCAzMzMsIDMzMywgMzMzLCAzMzMsIDMzMywgMzMzLCA0NjUsIDcyMiwgMzMzLCA4NTMsIDkwNiwgNDc0LCA4MjUsIDkyNywgODM4LCAyNzgsIDcyMiwgNzIyLCA2MDEsIDcxOSwgNjY3LCA2MTEsIDcyMiwgNzc4LCAyNzgsIDcyMiwgNjY3LCA4MzMsIDcyMiwgNjQ0LCA3NzgsIDcyMiwgNjY3LCA2MDAsIDYxMSwgNjY3LCA4MjEsIDY2NywgODA5LCA4MDIsIDI3OCwgNjY3LCA2MTUsIDQ1MSwgNjExLCAyNzgsIDU4MiwgNjE1LCA2MTAsIDU1NiwgNjA2LCA0NzUsIDQ2MCwgNjExLCA1NDEsIDI3OCwgNTU4LCA1NTYsIDYxMiwgNTU2LCA0NDUsIDYxMSwgNzY2LCA2MTksIDUyMCwgNjg0LCA0NDYsIDU4MiwgNzE1LCA1NzYsIDc1MywgODQ1LCAyNzgsIDU4MiwgNjExLCA1ODIsIDg0NSwgNjY3LCA2NjksIDg4NSwgNTY3LCA3MTEsIDY2NywgMjc4LCAyNzYsIDU1NiwgMTA5NCwgMTA2MiwgODc1LCA2MTAsIDcyMiwgNjIyLCA3MTksIDcyMiwgNzE5LCA3MjIsIDU2NywgNzEyLCA2NjcsIDkwNCwgNjI2LCA3MTksIDcxOSwgNjEwLCA3MDIsIDgzMywgNzIyLCA3NzgsIDcxOSwgNjY3LCA3MjIsIDYxMSwgNjIyLCA4NTQsIDY2NywgNzMwLCA3MDMsIDEwMDUsIDEwMTksIDg3MCwgOTc5LCA3MTksIDcxMSwgMTAzMSwgNzE5LCA1NTYsIDYxOCwgNjE1LCA0MTcsIDYzNSwgNTU2LCA3MDksIDQ5NywgNjE1LCA2MTUsIDUwMCwgNjM1LCA3NDAsIDYwNCwgNjExLCA2MDQsIDYxMSwgNTU2LCA0OTAsIDU1NiwgODc1LCA1NTYsIDYxNSwgNTgxLCA4MzMsIDg0NCwgNzI5LCA4NTQsIDYxNSwgNTUyLCA4NTQsIDU4MywgNTU2LCA1NTYsIDYxMSwgNDE3LCA1NTIsIDU1NiwgMjc4LCAyODEsIDI3OCwgOTY5LCA5MDYsIDYxMSwgNTAwLCA2MTUsIDU1NiwgNjA0LCA3NzgsIDYxMSwgNDg3LCA0NDcsIDk0NCwgNzc4LCA5NDQsIDc3OCwgOTQ0LCA3NzgsIDY2NywgNTU2LCAzMzMsIDMzMywgNTU2LCAxMDAwLCAxMDAwLCA1NTIsIDI3OCwgMjc4LCAyNzgsIDI3OCwgNTAwLCA1MDAsIDUwMCwgNTU2LCA1NTYsIDM1MCwgMTAwMCwgMTAwMCwgMjQwLCA0NzksIDMzMywgMzMzLCA2MDQsIDMzMywgMTY3LCAzOTYsIDU1NiwgNTU2LCAxMDk0LCA1NTYsIDg4NSwgNDg5LCAxMTE1LCAxMDAwLCA3NjgsIDYwMCwgODM0LCA4MzQsIDgzNCwgODM0LCAxMDAwLCA1MDAsIDEwMDAsIDUwMCwgMTAwMCwgNTAwLCA1MDAsIDQ5NCwgNjEyLCA4MjMsIDcxMywgNTg0LCA1NDksIDcxMywgOTc5LCA3MjIsIDI3NCwgNTQ5LCA1NDksIDU4MywgNTQ5LCA1NDksIDYwNCwgNTg0LCA2MDQsIDYwNCwgNzA4LCA2MjUsIDcwOCwgNzA4LCA3MDgsIDcwOCwgNzA4LCA3MDgsIDcwOCwgNzA4LCA3MDgsIDcwOCwgNzA4LCA3MDgsIDcwOCwgNzA4LCA3MDgsIDcwOCwgNzA4LCA3MDgsIDcwOCwgNzA4LCA3MDgsIDcwOCwgNzA4LCA3MDgsIDcwOCwgNzA4LCA3MDgsIDcwOCwgNzA4LCA3MDgsIDcwOCwgNzA4LCA3MDgsIDcwOCwgNzA4LCA3MDgsIDcwOCwgNzA4LCA3MDgsIDcwOCwgNzA4LCA3MDgsIDcwOCwgNzA4LCA3MDgsIDcyOSwgNjA0LCA2MDQsIDM1NCwgMzU0LCAxMDAwLCA5OTAsIDk5MCwgOTkwLCA5OTAsIDQ5NCwgNjA0LCA2MDQsIDYwNCwgNjA0LCAzNTQsIDEwMjEsIDEwNTIsIDkxNywgNzUwLCA3NTAsIDUzMSwgNjU2LCA1OTQsIDUxMCwgNTAwLCA3NTAsIDc1MCwgNjExLCA2MTEsIDMzMywgMzMzLCAzMzMsIDMzMywgMzMzLCAzMzMsIDMzMywgMzMzLCAyMjIsIDIyMiwgMzMzLCAzMzMsIDMzMywgMzMzLCAzMzMsIDMzMywgMzMzLCAzMzNdOwpleHBvcnRzLkxpYmVyYXRpb25TYW5zQm9sZFdpZHRocyA9IExpYmVyYXRpb25TYW5zQm9sZFdpZHRoczsKY29uc3QgTGliZXJhdGlvblNhbnNCb2xkTWFwcGluZyA9IFstMSwgLTEsIC0xLCAzMiwgMzMsIDM0LCAzNSwgMzYsIDM3LCAzOCwgMzksIDQwLCA0MSwgNDIsIDQzLCA0NCwgNDUsIDQ2LCA0NywgNDgsIDQ5LCA1MCwgNTEsIDUyLCA1MywgNTQsIDU1LCA1NiwgNTcsIDU4LCA1OSwgNjAsIDYxLCA2MiwgNjMsIDY0LCA2NSwgNjYsIDY3LCA2OCwgNjksIDcwLCA3MSwgNzIsIDczLCA3NCwgNzUsIDc2LCA3NywgNzgsIDc5LCA4MCwgODEsIDgyLCA4MywgODQsIDg1LCA4NiwgODcsIDg4LCA4OSwgOTAsIDkxLCA5MiwgOTMsIDk0LCA5NSwgOTYsIDk3LCA5OCwgOTksIDEwMCwgMTAxLCAxMDIsIDEwMywgMTA0LCAxMDUsIDEwNiwgMTA3LCAxMDgsIDEwOSwgMTEwLCAxMTEsIDExMiwgMTEzLCAxMTQsIDExNSwgMTE2LCAxMTcsIDExOCwgMTE5LCAxMjAsIDEyMSwgMTIyLCAxMjMsIDEyNCwgMTI1LCAxMjYsIDE2MSwgMTYyLCAxNjMsIDE2NCwgMTY1LCAxNjYsIDE2NywgMTY4LCAxNjksIDE3MCwgMTcxLCAxNzIsIDE3NCwgMTc1LCAxNzYsIDE3NywgMTc4LCAxNzksIDE4MCwgMTgxLCAxODIsIDE4MywgMTg0LCAxODUsIDE4NiwgMTg3LCAxODgsIDE4OSwgMTkwLCAxOTEsIDE5MiwgMTkzLCAxOTQsIDE5NSwgMTk2LCAxOTcsIDE5OCwgMTk5LCAyMDAsIDIwMSwgMjAyLCAyMDMsIDIwNCwgMjA1LCAyMDYsIDIwNywgMjA4LCAyMDksIDIxMCwgMjExLCAyMTIsIDIxMywgMjE0LCAyMTUsIDIxNiwgMjE3LCAyMTgsIDIxOSwgMjIwLCAyMjEsIDIyMiwgMjIzLCAyMjQsIDIyNSwgMjI2LCAyMjcsIDIyOCwgMjI5LCAyMzAsIDIzMSwgMjMyLCAyMzMsIDIzNCwgMjM1LCAyMzYsIDIzNywgMjM4LCAyMzksIDI0MCwgMjQxLCAyNDIsIDI0MywgMjQ0LCAyNDUsIDI0NiwgMjQ3LCAyNDgsIDI0OSwgMjUwLCAyNTEsIDI1MiwgMjUzLCAyNTQsIDI1NSwgMjU2LCAyNTcsIDI1OCwgMjU5LCAyNjAsIDI2MSwgMjYyLCAyNjMsIDI2NCwgMjY1LCAyNjYsIDI2NywgMjY4LCAyNjksIDI3MCwgMjcxLCAyNzIsIDI3MywgMjc0LCAyNzUsIDI3NiwgMjc3LCAyNzgsIDI3OSwgMjgwLCAyODEsIDI4MiwgMjgzLCAyODQsIDI4NSwgMjg2LCAyODcsIDI4OCwgMjg5LCAyOTAsIDI5MSwgMjkyLCAyOTMsIDI5NCwgMjk1LCAyOTYsIDI5NywgMjk4LCAyOTksIDMwMCwgMzAxLCAzMDIsIDMwMywgMzA0LCAzMDUsIDMwNiwgMzA3LCAzMDgsIDMwOSwgMzEwLCAzMTEsIDMxMiwgMzEzLCAzMTQsIDMxNSwgMzE2LCAzMTcsIDMxOCwgMzE5LCAzMjAsIDMyMSwgMzIyLCAzMjMsIDMyNCwgMzI1LCAzMjYsIDMyNywgMzI4LCAzMjksIDMzMCwgMzMxLCAzMzIsIDMzMywgMzM0LCAzMzUsIDMzNiwgMzM3LCAzMzgsIDMzOSwgMzQwLCAzNDEsIDM0MiwgMzQzLCAzNDQsIDM0NSwgMzQ2LCAzNDcsIDM0OCwgMzQ5LCAzNTAsIDM1MSwgMzUyLCAzNTMsIDM1NCwgMzU1LCAzNTYsIDM1NywgMzU4LCAzNTksIDM2MCwgMzYxLCAzNjIsIDM2MywgMzY0LCAzNjUsIDM2NiwgMzY3LCAzNjgsIDM2OSwgMzcwLCAzNzEsIDM3MiwgMzczLCAzNzQsIDM3NSwgMzc2LCAzNzcsIDM3OCwgMzc5LCAzODAsIDM4MSwgMzgyLCAzODMsIDQwMiwgNTA2LCA1MDcsIDUwOCwgNTA5LCA1MTAsIDUxMSwgNTM2LCA1MzcsIDUzOCwgNTM5LCA3MTAsIDcxMSwgNzEzLCA3MjgsIDcyOSwgNzMwLCA3MzEsIDczMiwgNzMzLCA5MDAsIDkwMSwgOTAyLCA5MDMsIDkwNCwgOTA1LCA5MDYsIDkwOCwgOTEwLCA5MTEsIDkxMiwgOTEzLCA5MTQsIDkxNSwgOTE2LCA5MTcsIDkxOCwgOTE5LCA5MjAsIDkyMSwgOTIyLCA5MjMsIDkyNCwgOTI1LCA5MjYsIDkyNywgOTI4LCA5MjksIDkzMSwgOTMyLCA5MzMsIDkzNCwgOTM1LCA5MzYsIDkzNywgOTM4LCA5MzksIDk0MCwgOTQxLCA5NDIsIDk0MywgOTQ0LCA5NDUsIDk0NiwgOTQ3LCA5NDgsIDk0OSwgOTUwLCA5NTEsIDk1MiwgOTUzLCA5NTQsIDk1NSwgOTU2LCA5NTcsIDk1OCwgOTU5LCA5NjAsIDk2MSwgOTYyLCA5NjMsIDk2NCwgOTY1LCA5NjYsIDk2NywgOTY4LCA5NjksIDk3MCwgOTcxLCA5NzIsIDk3MywgOTc0LCAxMDI0LCAxMDI1LCAxMDI2LCAxMDI3LCAxMDI4LCAxMDI5LCAxMDMwLCAxMDMxLCAxMDMyLCAxMDMzLCAxMDM0LCAxMDM1LCAxMDM2LCAxMDM3LCAxMDM4LCAxMDM5LCAxMDQwLCAxMDQxLCAxMDQyLCAxMDQzLCAxMDQ0LCAxMDQ1LCAxMDQ2LCAxMDQ3LCAxMDQ4LCAxMDQ5LCAxMDUwLCAxMDUxLCAxMDUyLCAxMDUzLCAxMDU0LCAxMDU1LCAxMDU2LCAxMDU3LCAxMDU4LCAxMDU5LCAxMDYwLCAxMDYxLCAxMDYyLCAxMDYzLCAxMDY0LCAxMDY1LCAxMDY2LCAxMDY3LCAxMDY4LCAxMDY5LCAxMDcwLCAxMDcxLCAxMDcyLCAxMDczLCAxMDc0LCAxMDc1LCAxMDc2LCAxMDc3LCAxMDc4LCAxMDc5LCAxMDgwLCAxMDgxLCAxMDgyLCAxMDgzLCAxMDg0LCAxMDg1LCAxMDg2LCAxMDg3LCAxMDg4LCAxMDg5LCAxMDkwLCAxMDkxLCAxMDkyLCAxMDkzLCAxMDk0LCAxMDk1LCAxMDk2LCAxMDk3LCAxMDk4LCAxMDk5LCAxMTAwLCAxMTAxLCAxMTAyLCAxMTAzLCAxMTA0LCAxMTA1LCAxMTA2LCAxMTA3LCAxMTA4LCAxMTA5LCAxMTEwLCAxMTExLCAxMTEyLCAxMTEzLCAxMTE0LCAxMTE1LCAxMTE2LCAxMTE3LCAxMTE4LCAxMTE5LCAxMTM4LCAxMTM5LCAxMTY4LCAxMTY5LCA3ODA4LCA3ODA5LCA3ODEwLCA3ODExLCA3ODEyLCA3ODEzLCA3OTIyLCA3OTIzLCA4MjA4LCA4MjA5LCA4MjExLCA4MjEyLCA4MjEzLCA4MjE1LCA4MjE2LCA4MjE3LCA4MjE4LCA4MjE5LCA4MjIwLCA4MjIxLCA4MjIyLCA4MjI0LCA4MjI1LCA4MjI2LCA4MjMwLCA4MjQwLCA4MjQyLCA4MjQzLCA4MjQ5LCA4MjUwLCA4MjUyLCA4MjU0LCA4MjYwLCA4MzE5LCA4MzU1LCA4MzU2LCA4MzU5LCA4MzY0LCA4NDUzLCA4NDY3LCA4NDcwLCA4NDgyLCA4NDg2LCA4NDk0LCA4NTM5LCA4NTQwLCA4NTQxLCA4NTQyLCA4NTkyLCA4NTkzLCA4NTk0LCA4NTk1LCA4NTk2LCA4NTk3LCA4NjE2LCA4NzA2LCA4NzEwLCA4NzE5LCA4NzIxLCA4NzIyLCA4NzMwLCA4NzM0LCA4NzM1LCA4NzQ1LCA4NzQ3LCA4Nzc2LCA4ODAwLCA4ODAxLCA4ODA0LCA4ODA1LCA4OTYyLCA4OTc2LCA4OTkyLCA4OTkzLCA5NDcyLCA5NDc0LCA5NDg0LCA5NDg4LCA5NDkyLCA5NDk2LCA5NTAwLCA5NTA4LCA5NTE2LCA5NTI0LCA5NTMyLCA5NTUyLCA5NTUzLCA5NTU0LCA5NTU1LCA5NTU2LCA5NTU3LCA5NTU4LCA5NTU5LCA5NTYwLCA5NTYxLCA5NTYyLCA5NTYzLCA5NTY0LCA5NTY1LCA5NTY2LCA5NTY3LCA5NTY4LCA5NTY5LCA5NTcwLCA5NTcxLCA5NTcyLCA5NTczLCA5NTc0LCA5NTc1LCA5NTc2LCA5NTc3LCA5NTc4LCA5NTc5LCA5NTgwLCA5NjAwLCA5NjA0LCA5NjA4LCA5NjEyLCA5NjE2LCA5NjE3LCA5NjE4LCA5NjE5LCA5NjMyLCA5NjMzLCA5NjQyLCA5NjQzLCA5NjQ0LCA5NjUwLCA5NjU4LCA5NjYwLCA5NjY4LCA5Njc0LCA5Njc1LCA5Njc5LCA5Njg4LCA5Njg5LCA5NzAyLCA5Nzg2LCA5Nzg3LCA5Nzg4LCA5NzkyLCA5Nzk0LCA5ODI0LCA5ODI3LCA5ODI5LCA5ODMwLCA5ODM0LCA5ODM1LCA5ODM2LCA2MTQ0MSwgNjE0NDIsIDYxNDQ1LCAtMSwgLTEsIC0xLCAtMSwgLTEsIC0xLCAtMSwgLTEsIC0xLCAtMSwgLTEsIC0xLCAtMSwgLTEsIC0xLCAtMSwgLTFdOwpleHBvcnRzLkxpYmVyYXRpb25TYW5zQm9sZE1hcHBpbmcgPSBMaWJlcmF0aW9uU2Fuc0JvbGRNYXBwaW5nOwpjb25zdCBMaWJlcmF0aW9uU2Fuc0JvbGRJdGFsaWNXaWR0aHMgPSBbMzY1LCAwLCAzMzMsIDI3OCwgMzMzLCA0NzQsIDU1NiwgNTU2LCA4ODksIDcyMiwgMjM4LCAzMzMsIDMzMywgMzg5LCA1ODQsIDI3OCwgMzMzLCAyNzgsIDI3OCwgNTU2LCA1NTYsIDU1NiwgNTU2LCA1NTYsIDU1NiwgNTU2LCA1NTYsIDU1NiwgNTU2LCAzMzMsIDMzMywgNTg0LCA1ODQsIDU4NCwgNjExLCA5NzUsIDcyMiwgNzIyLCA3MjIsIDcyMiwgNjY3LCA2MTEsIDc3OCwgNzIyLCAyNzgsIDU1NiwgNzIyLCA2MTEsIDgzMywgNzIyLCA3NzgsIDY2NywgNzc4LCA3MjIsIDY2NywgNjExLCA3MjIsIDY2NywgOTQ0LCA2NjcsIDY2NywgNjExLCAzMzMsIDI3OCwgMzMzLCA1ODQsIDU1NiwgMzMzLCA1NTYsIDYxMSwgNTU2LCA2MTEsIDU1NiwgMzMzLCA2MTEsIDYxMSwgMjc4LCAyNzgsIDU1NiwgMjc4LCA4ODksIDYxMSwgNjExLCA2MTEsIDYxMSwgMzg5LCA1NTYsIDMzMywgNjExLCA1NTYsIDc3OCwgNTU2LCA1NTYsIDUwMCwgMzg5LCAyODAsIDM4OSwgNTg0LCAzMzMsIDU1NiwgNTU2LCA1NTYsIDU1NiwgMjgwLCA1NTYsIDMzMywgNzM3LCAzNzAsIDU1NiwgNTg0LCA3MzcsIDU1MiwgNDAwLCA1NDksIDMzMywgMzMzLCAzMzMsIDU3NiwgNTU2LCAyNzgsIDMzMywgMzMzLCAzNjUsIDU1NiwgODM0LCA4MzQsIDgzNCwgNjExLCA3MjIsIDcyMiwgNzIyLCA3MjIsIDcyMiwgNzIyLCAxMDAwLCA3MjIsIDY2NywgNjY3LCA2NjcsIDY2NywgMjc4LCAyNzgsIDI3OCwgMjc4LCA3MjIsIDcyMiwgNzc4LCA3NzgsIDc3OCwgNzc4LCA3NzgsIDU4NCwgNzc4LCA3MjIsIDcyMiwgNzIyLCA3MjIsIDY2NywgNjY3LCA2MTEsIDU1NiwgNTU2LCA1NTYsIDU1NiwgNTU2LCA1NTYsIDg4OSwgNTU2LCA1NTYsIDU1NiwgNTU2LCA1NTYsIDI3OCwgMjc4LCAyNzgsIDI3OCwgNjExLCA2MTEsIDYxMSwgNjExLCA2MTEsIDYxMSwgNjExLCA1NDksIDYxMSwgNjExLCA2MTEsIDYxMSwgNjExLCA1NTYsIDYxMSwgNTU2LCA3MjIsIDU1NiwgNzIyLCA1NTYsIDcyMiwgNTU2LCA3MjIsIDU1NiwgNzIyLCA1NTYsIDcyMiwgNTU2LCA3MjIsIDU1NiwgNzIyLCA3NDAsIDcyMiwgNjExLCA2NjcsIDU1NiwgNjY3LCA1NTYsIDY2NywgNTU2LCA2NjcsIDU1NiwgNjY3LCA1NTYsIDc3OCwgNjExLCA3NzgsIDYxMSwgNzc4LCA2MTEsIDc3OCwgNjExLCA3MjIsIDYxMSwgNzIyLCA2MTEsIDI3OCwgMjc4LCAyNzgsIDI3OCwgMjc4LCAyNzgsIDI3OCwgMjc4LCAyNzgsIDI3OCwgNzgyLCA1NTYsIDU1NiwgMjc4LCA3MjIsIDU1NiwgNTU2LCA2MTEsIDI3OCwgNjExLCAyNzgsIDYxMSwgMzk2LCA2MTEsIDQ3OSwgNjExLCAyNzgsIDcyMiwgNjExLCA3MjIsIDYxMSwgNzIyLCA2MTEsIDcwOCwgNzIzLCA2MTEsIDc3OCwgNjExLCA3NzgsIDYxMSwgNzc4LCA2MTEsIDEwMDAsIDk0NCwgNzIyLCAzODksIDcyMiwgMzg5LCA3MjIsIDM4OSwgNjY3LCA1NTYsIDY2NywgNTU2LCA2NjcsIDU1NiwgNjY3LCA1NTYsIDYxMSwgMzMzLCA2MTEsIDQ3OSwgNjExLCAzMzMsIDcyMiwgNjExLCA3MjIsIDYxMSwgNzIyLCA2MTEsIDcyMiwgNjExLCA3MjIsIDYxMSwgNzIyLCA2MTEsIDk0NCwgNzc4LCA2NjcsIDU1NiwgNjY3LCA2MTEsIDUwMCwgNjExLCA1MDAsIDYxMSwgNTAwLCAyNzgsIDU1NiwgNzIyLCA1NTYsIDEwMDAsIDg4OSwgNzc4LCA2MTEsIDY2NywgNTU2LCA2MTEsIDMzMywgMzMzLCAzMzMsIDMzMywgMzMzLCAzMzMsIDMzMywgMzMzLCAzMzMsIDMzMywgMzMzLCAzMzMsIDcyMiwgMzMzLCA4NTQsIDkwNiwgNDczLCA4NDQsIDkzMCwgODQ3LCAyNzgsIDcyMiwgNzIyLCA2MTAsIDY3MSwgNjY3LCA2MTEsIDcyMiwgNzc4LCAyNzgsIDcyMiwgNjY3LCA4MzMsIDcyMiwgNjU3LCA3NzgsIDcxOCwgNjY3LCA1OTAsIDYxMSwgNjY3LCA4MjIsIDY2NywgODI5LCA3ODEsIDI3OCwgNjY3LCA2MjAsIDQ3OSwgNjExLCAyNzgsIDU5MSwgNjIwLCA2MjEsIDU1NiwgNjEwLCA0NzksIDQ5MiwgNjExLCA1NTgsIDI3OCwgNTY2LCA1NTYsIDYwMywgNTU2LCA0NTAsIDYxMSwgNzEyLCA2MDUsIDUzMiwgNjY0LCA0MDksIDU5MSwgNzA0LCA1NzgsIDc3MywgODM0LCAyNzgsIDU5MSwgNjExLCA1OTEsIDgzNCwgNjY3LCA2NjcsIDg4NiwgNjE0LCA3MTksIDY2NywgMjc4LCAyNzgsIDU1NiwgMTA5NCwgMTA0MiwgODU0LCA2MjIsIDcxOSwgNjc3LCA3MTksIDcyMiwgNzA4LCA3MjIsIDYxNCwgNzIyLCA2NjcsIDkyNywgNjQzLCA3MTksIDcxOSwgNjE1LCA2ODcsIDgzMywgNzIyLCA3NzgsIDcxOSwgNjY3LCA3MjIsIDYxMSwgNjc3LCA3ODEsIDY2NywgNzI5LCA3MDgsIDk3OSwgOTg5LCA4NTQsIDEwMDAsIDcwOCwgNzE5LCAxMDQyLCA3MjksIDU1NiwgNjE5LCA2MDQsIDUzNCwgNjE4LCA1NTYsIDczNiwgNTEwLCA2MTEsIDYxMSwgNTA3LCA2MjIsIDc0MCwgNjA0LCA2MTEsIDYxMSwgNjExLCA1NTYsIDg4OSwgNTU2LCA4ODUsIDU1NiwgNjQ2LCA1ODMsIDg4OSwgOTM1LCA3MDcsIDg1NCwgNTk0LCA1NTIsIDg2NSwgNTg5LCA1NTYsIDU1NiwgNjExLCA0NjksIDU2MywgNTU2LCAyNzgsIDI3OCwgMjc4LCA5NjksIDkwNiwgNjExLCA1MDcsIDYxOSwgNTU2LCA2MTEsIDc3OCwgNjExLCA1NzUsIDQ2NywgOTQ0LCA3NzgsIDk0NCwgNzc4LCA5NDQsIDc3OCwgNjY3LCA1NTYsIDMzMywgMzMzLCA1NTYsIDEwMDAsIDEwMDAsIDU1MiwgMjc4LCAyNzgsIDI3OCwgMjc4LCA1MDAsIDUwMCwgNTAwLCA1NTYsIDU1NiwgMzUwLCAxMDAwLCAxMDAwLCAyNDAsIDQ3OSwgMzMzLCAzMzMsIDYwNCwgMzMzLCAxNjcsIDM5NiwgNTU2LCA1NTYsIDExMDQsIDU1NiwgODg1LCA1MTYsIDExNDYsIDEwMDAsIDc2OCwgNjAwLCA4MzQsIDgzNCwgODM0LCA4MzQsIDk5OSwgNTAwLCAxMDAwLCA1MDAsIDEwMDAsIDUwMCwgNTAwLCA0OTQsIDYxMiwgODIzLCA3MTMsIDU4NCwgNTQ5LCA3MTMsIDk3OSwgNzIyLCAyNzQsIDU0OSwgNTQ5LCA1ODMsIDU0OSwgNTQ5LCA2MDQsIDU4NCwgNjA0LCA2MDQsIDcwOCwgNjI1LCA3MDgsIDcwOCwgNzA4LCA3MDgsIDcwOCwgNzA4LCA3MDgsIDcwOCwgNzA4LCA3MDgsIDcwOCwgNzA4LCA3MDgsIDcwOCwgNzA4LCA3MDgsIDcwOCwgNzA4LCA3MDgsIDcwOCwgNzA4LCA3MDgsIDcwOCwgNzA4LCA3MDgsIDcwOCwgNzA4LCA3MDgsIDcwOCwgNzA4LCA3MDgsIDcwOCwgNzA4LCA3MDgsIDcwOCwgNzA4LCA3MDgsIDcwOCwgNzA4LCA3MDgsIDcwOCwgNzA4LCA3MDgsIDcwOCwgNzA4LCA3MjksIDYwNCwgNjA0LCAzNTQsIDM1NCwgMTAwMCwgOTkwLCA5OTAsIDk5MCwgOTkwLCA0OTQsIDYwNCwgNjA0LCA2MDQsIDYwNCwgMzU0LCAxMDIxLCAxMDUyLCA5MTcsIDc1MCwgNzUwLCA1MzEsIDY1NiwgNTk0LCA1MTAsIDUwMCwgNzUwLCA3NTAsIDYxMSwgNjExLCAzMzMsIDMzMywgMzMzLCAzMzMsIDMzMywgMzMzLCAzMzMsIDMzMywgMjIyLCAyMjIsIDMzMywgMzMzLCAzMzMsIDMzMywgMzMzLCAzMzMsIDMzMywgMzMzXTsKZXhwb3J0cy5MaWJlcmF0aW9uU2Fuc0JvbGRJdGFsaWNXaWR0aHMgPSBMaWJlcmF0aW9uU2Fuc0JvbGRJdGFsaWNXaWR0aHM7CmNvbnN0IExpYmVyYXRpb25TYW5zQm9sZEl0YWxpY01hcHBpbmcgPSBbLTEsIC0xLCAtMSwgMzIsIDMzLCAzNCwgMzUsIDM2LCAzNywgMzgsIDM5LCA0MCwgNDEsIDQyLCA0MywgNDQsIDQ1LCA0NiwgNDcsIDQ4LCA0OSwgNTAsIDUxLCA1MiwgNTMsIDU0LCA1NSwgNTYsIDU3LCA1OCwgNTksIDYwLCA2MSwgNjIsIDYzLCA2NCwgNjUsIDY2LCA2NywgNjgsIDY5LCA3MCwgNzEsIDcyLCA3MywgNzQsIDc1LCA3NiwgNzcsIDc4LCA3OSwgODAsIDgxLCA4MiwgODMsIDg0LCA4NSwgODYsIDg3LCA4OCwgODksIDkwLCA5MSwgOTIsIDkzLCA5NCwgOTUsIDk2LCA5NywgOTgsIDk5LCAxMDAsIDEwMSwgMTAyLCAxMDMsIDEwNCwgMTA1LCAxMDYsIDEwNywgMTA4LCAxMDksIDExMCwgMTExLCAxMTIsIDExMywgMTE0LCAxMTUsIDExNiwgMTE3LCAxMTgsIDExOSwgMTIwLCAxMjEsIDEyMiwgMTIzLCAxMjQsIDEyNSwgMTI2LCAxNjEsIDE2MiwgMTYzLCAxNjQsIDE2NSwgMTY2LCAxNjcsIDE2OCwgMTY5LCAxNzAsIDE3MSwgMTcyLCAxNzQsIDE3NSwgMTc2LCAxNzcsIDE3OCwgMTc5LCAxODAsIDE4MSwgMTgyLCAxODMsIDE4NCwgMTg1LCAxODYsIDE4NywgMTg4LCAxODksIDE5MCwgMTkxLCAxOTIsIDE5MywgMTk0LCAxOTUsIDE5NiwgMTk3LCAxOTgsIDE5OSwgMjAwLCAyMDEsIDIwMiwgMjAzLCAyMDQsIDIwNSwgMjA2LCAyMDcsIDIwOCwgMjA5LCAyMTAsIDIxMSwgMjEyLCAyMTMsIDIxNCwgMjE1LCAyMTYsIDIxNywgMjE4LCAyMTksIDIyMCwgMjIxLCAyMjIsIDIyMywgMjI0LCAyMjUsIDIyNiwgMjI3LCAyMjgsIDIyOSwgMjMwLCAyMzEsIDIzMiwgMjMzLCAyMzQsIDIzNSwgMjM2LCAyMzcsIDIzOCwgMjM5LCAyNDAsIDI0MSwgMjQyLCAyNDMsIDI0NCwgMjQ1LCAyNDYsIDI0NywgMjQ4LCAyNDksIDI1MCwgMjUxLCAyNTIsIDI1MywgMjU0LCAyNTUsIDI1NiwgMjU3LCAyNTgsIDI1OSwgMjYwLCAyNjEsIDI2MiwgMjYzLCAyNjQsIDI2NSwgMjY2LCAyNjcsIDI2OCwgMjY5LCAyNzAsIDI3MSwgMjcyLCAyNzMsIDI3NCwgMjc1LCAyNzYsIDI3NywgMjc4LCAyNzksIDI4MCwgMjgxLCAyODIsIDI4MywgMjg0LCAyODUsIDI4NiwgMjg3LCAyODgsIDI4OSwgMjkwLCAyOTEsIDI5MiwgMjkzLCAyOTQsIDI5NSwgMjk2LCAyOTcsIDI5OCwgMjk5LCAzMDAsIDMwMSwgMzAyLCAzMDMsIDMwNCwgMzA1LCAzMDYsIDMwNywgMzA4LCAzMDksIDMxMCwgMzExLCAzMTIsIDMxMywgMzE0LCAzMTUsIDMxNiwgMzE3LCAzMTgsIDMxOSwgMzIwLCAzMjEsIDMyMiwgMzIzLCAzMjQsIDMyNSwgMzI2LCAzMjcsIDMyOCwgMzI5LCAzMzAsIDMzMSwgMzMyLCAzMzMsIDMzNCwgMzM1LCAzMzYsIDMzNywgMzM4LCAzMzksIDM0MCwgMzQxLCAzNDIsIDM0MywgMzQ0LCAzNDUsIDM0NiwgMzQ3LCAzNDgsIDM0OSwgMzUwLCAzNTEsIDM1MiwgMzUzLCAzNTQsIDM1NSwgMzU2LCAzNTcsIDM1OCwgMzU5LCAzNjAsIDM2MSwgMzYyLCAzNjMsIDM2NCwgMzY1LCAzNjYsIDM2NywgMzY4LCAzNjksIDM3MCwgMzcxLCAzNzIsIDM3MywgMzc0LCAzNzUsIDM3NiwgMzc3LCAzNzgsIDM3OSwgMzgwLCAzODEsIDM4MiwgMzgzLCA0MDIsIDUwNiwgNTA3LCA1MDgsIDUwOSwgNTEwLCA1MTEsIDUzNiwgNTM3LCA1MzgsIDUzOSwgNzEwLCA3MTEsIDcxMywgNzI4LCA3MjksIDczMCwgNzMxLCA3MzIsIDczMywgOTAwLCA5MDEsIDkwMiwgOTAzLCA5MDQsIDkwNSwgOTA2LCA5MDgsIDkxMCwgOTExLCA5MTIsIDkxMywgOTE0LCA5MTUsIDkxNiwgOTE3LCA5MTgsIDkxOSwgOTIwLCA5MjEsIDkyMiwgOTIzLCA5MjQsIDkyNSwgOTI2LCA5MjcsIDkyOCwgOTI5LCA5MzEsIDkzMiwgOTMzLCA5MzQsIDkzNSwgOTM2LCA5MzcsIDkzOCwgOTM5LCA5NDAsIDk0MSwgOTQyLCA5NDMsIDk0NCwgOTQ1LCA5NDYsIDk0NywgOTQ4LCA5NDksIDk1MCwgOTUxLCA5NTIsIDk1MywgOTU0LCA5NTUsIDk1NiwgOTU3LCA5NTgsIDk1OSwgOTYwLCA5NjEsIDk2MiwgOTYzLCA5NjQsIDk2NSwgOTY2LCA5NjcsIDk2OCwgOTY5LCA5NzAsIDk3MSwgOTcyLCA5NzMsIDk3NCwgMTAyNCwgMTAyNSwgMTAyNiwgMTAyNywgMTAyOCwgMTAyOSwgMTAzMCwgMTAzMSwgMTAzMiwgMTAzMywgMTAzNCwgMTAzNSwgMTAzNiwgMTAzNywgMTAzOCwgMTAzOSwgMTA0MCwgMTA0MSwgMTA0MiwgMTA0MywgMTA0NCwgMTA0NSwgMTA0NiwgMTA0NywgMTA0OCwgMTA0OSwgMTA1MCwgMTA1MSwgMTA1MiwgMTA1MywgMTA1NCwgMTA1NSwgMTA1NiwgMTA1NywgMTA1OCwgMTA1OSwgMTA2MCwgMTA2MSwgMTA2MiwgMTA2MywgMTA2NCwgMTA2NSwgMTA2NiwgMTA2NywgMTA2OCwgMTA2OSwgMTA3MCwgMTA3MSwgMTA3MiwgMTA3MywgMTA3NCwgMTA3NSwgMTA3NiwgMTA3NywgMTA3OCwgMTA3OSwgMTA4MCwgMTA4MSwgMTA4MiwgMTA4MywgMTA4NCwgMTA4NSwgMTA4NiwgMTA4NywgMTA4OCwgMTA4OSwgMTA5MCwgMTA5MSwgMTA5MiwgMTA5MywgMTA5NCwgMTA5NSwgMTA5NiwgMTA5NywgMTA5OCwgMTA5OSwgMTEwMCwgMTEwMSwgMTEwMiwgMTEwMywgMTEwNCwgMTEwNSwgMTEwNiwgMTEwNywgMTEwOCwgMTEwOSwgMTExMCwgMTExMSwgMTExMiwgMTExMywgMTExNCwgMTExNSwgMTExNiwgMTExNywgMTExOCwgMTExOSwgMTEzOCwgMTEzOSwgMTE2OCwgMTE2OSwgNzgwOCwgNzgwOSwgNzgxMCwgNzgxMSwgNzgxMiwgNzgxMywgNzkyMiwgNzkyMywgODIwOCwgODIwOSwgODIxMSwgODIxMiwgODIxMywgODIxNSwgODIxNiwgODIxNywgODIxOCwgODIxOSwgODIyMCwgODIyMSwgODIyMiwgODIyNCwgODIyNSwgODIyNiwgODIzMCwgODI0MCwgODI0MiwgODI0MywgODI0OSwgODI1MCwgODI1MiwgODI1NCwgODI2MCwgODMxOSwgODM1NSwgODM1NiwgODM1OSwgODM2NCwgODQ1MywgODQ2NywgODQ3MCwgODQ4MiwgODQ4NiwgODQ5NCwgODUzOSwgODU0MCwgODU0MSwgODU0MiwgODU5MiwgODU5MywgODU5NCwgODU5NSwgODU5NiwgODU5NywgODYxNiwgODcwNiwgODcxMCwgODcxOSwgODcyMSwgODcyMiwgODczMCwgODczNCwgODczNSwgODc0NSwgODc0NywgODc3NiwgODgwMCwgODgwMSwgODgwNCwgODgwNSwgODk2MiwgODk3NiwgODk5MiwgODk5MywgOTQ3MiwgOTQ3NCwgOTQ4NCwgOTQ4OCwgOTQ5MiwgOTQ5NiwgOTUwMCwgOTUwOCwgOTUxNiwgOTUyNCwgOTUzMiwgOTU1MiwgOTU1MywgOTU1NCwgOTU1NSwgOTU1NiwgOTU1NywgOTU1OCwgOTU1OSwgOTU2MCwgOTU2MSwgOTU2MiwgOTU2MywgOTU2NCwgOTU2NSwgOTU2NiwgOTU2NywgOTU2OCwgOTU2OSwgOTU3MCwgOTU3MSwgOTU3MiwgOTU3MywgOTU3NCwgOTU3NSwgOTU3NiwgOTU3NywgOTU3OCwgOTU3OSwgOTU4MCwgOTYwMCwgOTYwNCwgOTYwOCwgOTYxMiwgOTYxNiwgOTYxNywgOTYxOCwgOTYxOSwgOTYzMiwgOTYzMywgOTY0MiwgOTY0MywgOTY0NCwgOTY1MCwgOTY1OCwgOTY2MCwgOTY2OCwgOTY3NCwgOTY3NSwgOTY3OSwgOTY4OCwgOTY4OSwgOTcwMiwgOTc4NiwgOTc4NywgOTc4OCwgOTc5MiwgOTc5NCwgOTgyNCwgOTgyNywgOTgyOSwgOTgzMCwgOTgzNCwgOTgzNSwgOTgzNiwgNjE0NDEsIDYxNDQyLCA2MTQ0NSwgLTEsIC0xLCAtMSwgLTEsIC0xLCAtMSwgLTEsIC0xLCAtMSwgLTEsIC0xLCAtMSwgLTEsIC0xLCAtMSwgLTEsIC0xXTsKZXhwb3J0cy5MaWJlcmF0aW9uU2Fuc0JvbGRJdGFsaWNNYXBwaW5nID0gTGliZXJhdGlvblNhbnNCb2xkSXRhbGljTWFwcGluZzsKY29uc3QgTGliZXJhdGlvblNhbnNJdGFsaWNXaWR0aHMgPSBbMzY1LCAwLCAzMzMsIDI3OCwgMjc4LCAzNTUsIDU1NiwgNTU2LCA4ODksIDY2NywgMTkxLCAzMzMsIDMzMywgMzg5LCA1ODQsIDI3OCwgMzMzLCAyNzgsIDI3OCwgNTU2LCA1NTYsIDU1NiwgNTU2LCA1NTYsIDU1NiwgNTU2LCA1NTYsIDU1NiwgNTU2LCAyNzgsIDI3OCwgNTg0LCA1ODQsIDU4NCwgNTU2LCAxMDE1LCA2NjcsIDY2NywgNzIyLCA3MjIsIDY2NywgNjExLCA3NzgsIDcyMiwgMjc4LCA1MDAsIDY2NywgNTU2LCA4MzMsIDcyMiwgNzc4LCA2NjcsIDc3OCwgNzIyLCA2NjcsIDYxMSwgNzIyLCA2NjcsIDk0NCwgNjY3LCA2NjcsIDYxMSwgMjc4LCAyNzgsIDI3OCwgNDY5LCA1NTYsIDMzMywgNTU2LCA1NTYsIDUwMCwgNTU2LCA1NTYsIDI3OCwgNTU2LCA1NTYsIDIyMiwgMjIyLCA1MDAsIDIyMiwgODMzLCA1NTYsIDU1NiwgNTU2LCA1NTYsIDMzMywgNTAwLCAyNzgsIDU1NiwgNTAwLCA3MjIsIDUwMCwgNTAwLCA1MDAsIDMzNCwgMjYwLCAzMzQsIDU4NCwgMzMzLCA1NTYsIDU1NiwgNTU2LCA1NTYsIDI2MCwgNTU2LCAzMzMsIDczNywgMzcwLCA1NTYsIDU4NCwgNzM3LCA1NTIsIDQwMCwgNTQ5LCAzMzMsIDMzMywgMzMzLCA1NzYsIDUzNywgMjc4LCAzMzMsIDMzMywgMzY1LCA1NTYsIDgzNCwgODM0LCA4MzQsIDYxMSwgNjY3LCA2NjcsIDY2NywgNjY3LCA2NjcsIDY2NywgMTAwMCwgNzIyLCA2NjcsIDY2NywgNjY3LCA2NjcsIDI3OCwgMjc4LCAyNzgsIDI3OCwgNzIyLCA3MjIsIDc3OCwgNzc4LCA3NzgsIDc3OCwgNzc4LCA1ODQsIDc3OCwgNzIyLCA3MjIsIDcyMiwgNzIyLCA2NjcsIDY2NywgNjExLCA1NTYsIDU1NiwgNTU2LCA1NTYsIDU1NiwgNTU2LCA4ODksIDUwMCwgNTU2LCA1NTYsIDU1NiwgNTU2LCAyNzgsIDI3OCwgMjc4LCAyNzgsIDU1NiwgNTU2LCA1NTYsIDU1NiwgNTU2LCA1NTYsIDU1NiwgNTQ5LCA2MTEsIDU1NiwgNTU2LCA1NTYsIDU1NiwgNTAwLCA1NTYsIDUwMCwgNjY3LCA1NTYsIDY2NywgNTU2LCA2NjcsIDU1NiwgNzIyLCA1MDAsIDcyMiwgNTAwLCA3MjIsIDUwMCwgNzIyLCA1MDAsIDcyMiwgNjI1LCA3MjIsIDU1NiwgNjY3LCA1NTYsIDY2NywgNTU2LCA2NjcsIDU1NiwgNjY3LCA1NTYsIDY2NywgNTU2LCA3NzgsIDU1NiwgNzc4LCA1NTYsIDc3OCwgNTU2LCA3NzgsIDU1NiwgNzIyLCA1NTYsIDcyMiwgNTU2LCAyNzgsIDI3OCwgMjc4LCAyNzgsIDI3OCwgMjc4LCAyNzgsIDIyMiwgMjc4LCAyNzgsIDczMywgNDQ0LCA1MDAsIDIyMiwgNjY3LCA1MDAsIDUwMCwgNTU2LCAyMjIsIDU1NiwgMjIyLCA1NTYsIDI4MSwgNTU2LCA0MDAsIDU1NiwgMjIyLCA3MjIsIDU1NiwgNzIyLCA1NTYsIDcyMiwgNTU2LCA2MTUsIDcyMywgNTU2LCA3NzgsIDU1NiwgNzc4LCA1NTYsIDc3OCwgNTU2LCAxMDAwLCA5NDQsIDcyMiwgMzMzLCA3MjIsIDMzMywgNzIyLCAzMzMsIDY2NywgNTAwLCA2NjcsIDUwMCwgNjY3LCA1MDAsIDY2NywgNTAwLCA2MTEsIDI3OCwgNjExLCAzNTQsIDYxMSwgMjc4LCA3MjIsIDU1NiwgNzIyLCA1NTYsIDcyMiwgNTU2LCA3MjIsIDU1NiwgNzIyLCA1NTYsIDcyMiwgNTU2LCA5NDQsIDcyMiwgNjY3LCA1MDAsIDY2NywgNjExLCA1MDAsIDYxMSwgNTAwLCA2MTEsIDUwMCwgMjIyLCA1NTYsIDY2NywgNTU2LCAxMDAwLCA4ODksIDc3OCwgNjExLCA2NjcsIDUwMCwgNjExLCAyNzgsIDMzMywgMzMzLCAzMzMsIDMzMywgMzMzLCAzMzMsIDMzMywgMzMzLCAzMzMsIDMzMywgMzMzLCA2NjcsIDI3OCwgNzg5LCA4NDYsIDM4OSwgNzk0LCA4NjUsIDc3NSwgMjIyLCA2NjcsIDY2NywgNTcwLCA2NzEsIDY2NywgNjExLCA3MjIsIDc3OCwgMjc4LCA2NjcsIDY2NywgODMzLCA3MjIsIDY0OCwgNzc4LCA3MjUsIDY2NywgNjAwLCA2MTEsIDY2NywgODM3LCA2NjcsIDgzMSwgNzYxLCAyNzgsIDY2NywgNTcwLCA0MzksIDU1NSwgMjIyLCA1NTAsIDU3MCwgNTcxLCA1MDAsIDU1NiwgNDM5LCA0NjMsIDU1NSwgNTQyLCAyMjIsIDUwMCwgNDkyLCA1NDgsIDUwMCwgNDQ3LCA1NTYsIDY3MCwgNTczLCA0ODYsIDYwMywgMzc0LCA1NTAsIDY1MiwgNTQ2LCA3MjgsIDc3OSwgMjIyLCA1NTAsIDU1NiwgNTUwLCA3NzksIDY2NywgNjY3LCA4NDMsIDU0NCwgNzA4LCA2NjcsIDI3OCwgMjc4LCA1MDAsIDEwNjYsIDk4MiwgODQ0LCA1ODksIDcxNSwgNjM5LCA3MjQsIDY2NywgNjUxLCA2NjcsIDU0NCwgNzA0LCA2NjcsIDkxNywgNjE0LCA3MTUsIDcxNSwgNTg5LCA2ODYsIDgzMywgNzIyLCA3NzgsIDcyNSwgNjY3LCA3MjIsIDYxMSwgNjM5LCA3OTUsIDY2NywgNzI3LCA2NzMsIDkyMCwgOTIzLCA4MDUsIDg4NiwgNjUxLCA2OTQsIDEwMjIsIDY4MiwgNTU2LCA1NjIsIDUyMiwgNDkzLCA1NTMsIDU1NiwgNjg4LCA0NjUsIDU1NiwgNTU2LCA0NzIsIDU2NCwgNjg2LCA1NTAsIDU1NiwgNTU2LCA1NTYsIDUwMCwgODMzLCA1MDAsIDgzNSwgNTAwLCA1NzIsIDUxOCwgODMwLCA4NTEsIDYyMSwgNzM2LCA1MjYsIDQ5MiwgNzUyLCA1MzQsIDU1NiwgNTU2LCA1NTYsIDM3OCwgNDk2LCA1MDAsIDIyMiwgMjIyLCAyMjIsIDkxMCwgODI4LCA1NTYsIDQ3MiwgNTY1LCA1MDAsIDU1NiwgNzc4LCA1NTYsIDQ5MiwgMzM5LCA5NDQsIDcyMiwgOTQ0LCA3MjIsIDk0NCwgNzIyLCA2NjcsIDUwMCwgMzMzLCAzMzMsIDU1NiwgMTAwMCwgMTAwMCwgNTUyLCAyMjIsIDIyMiwgMjIyLCAyMjIsIDMzMywgMzMzLCAzMzMsIDU1NiwgNTU2LCAzNTAsIDEwMDAsIDEwMDAsIDE4OCwgMzU0LCAzMzMsIDMzMywgNTAwLCAzMzMsIDE2NywgMzY1LCA1NTYsIDU1NiwgMTA5NCwgNTU2LCA4ODUsIDMyMywgMTA4MywgMTAwMCwgNzY4LCA2MDAsIDgzNCwgODM0LCA4MzQsIDgzNCwgMTAwMCwgNTAwLCA5OTgsIDUwMCwgMTAwMCwgNTAwLCA1MDAsIDQ5NCwgNjEyLCA4MjMsIDcxMywgNTg0LCA1NDksIDcxMywgOTc5LCA3MTksIDI3NCwgNTQ5LCA1NDksIDU4NCwgNTQ5LCA1NDksIDYwNCwgNTg0LCA2MDQsIDYwNCwgNzA4LCA2MjUsIDcwOCwgNzA4LCA3MDgsIDcwOCwgNzA4LCA3MDgsIDcwOCwgNzA4LCA3MDgsIDcwOCwgNzA4LCA3MDgsIDcwOCwgNzA4LCA3MDgsIDcwOCwgNzA4LCA3MDgsIDcwOCwgNzA4LCA3MDgsIDcwOCwgNzA4LCA3MDgsIDcwOCwgNzA4LCA3MDgsIDcwOCwgNzA4LCA3MDgsIDcwOCwgNzA4LCA3MDgsIDcwOCwgNzA4LCA3MDgsIDcwOCwgNzA4LCA3MDgsIDcwOCwgNzA4LCA3MDgsIDcwOCwgNzA4LCA3MDgsIDcyOSwgNjA0LCA2MDQsIDM1NCwgMzU0LCAxMDAwLCA5OTAsIDk5MCwgOTkwLCA5OTAsIDQ5NCwgNjA0LCA2MDQsIDYwNCwgNjA0LCAzNTQsIDEwMjEsIDEwNTIsIDkxNywgNzUwLCA3NTAsIDUzMSwgNjU2LCA1OTQsIDUxMCwgNTAwLCA3NTAsIDc1MCwgNTAwLCA1MDAsIDMzMywgMzMzLCAzMzMsIDMzMywgMzMzLCAzMzMsIDMzMywgMzMzLCAyMjIsIDIyMiwgMjk0LCAyOTQsIDMyNCwgMzI0LCAzMTYsIDMyOCwgMzk4LCAyODVdOwpleHBvcnRzLkxpYmVyYXRpb25TYW5zSXRhbGljV2lkdGhzID0gTGliZXJhdGlvblNhbnNJdGFsaWNXaWR0aHM7CmNvbnN0IExpYmVyYXRpb25TYW5zSXRhbGljTWFwcGluZyA9IFstMSwgLTEsIC0xLCAzMiwgMzMsIDM0LCAzNSwgMzYsIDM3LCAzOCwgMzksIDQwLCA0MSwgNDIsIDQzLCA0NCwgNDUsIDQ2LCA0NywgNDgsIDQ5LCA1MCwgNTEsIDUyLCA1MywgNTQsIDU1LCA1NiwgNTcsIDU4LCA1OSwgNjAsIDYxLCA2MiwgNjMsIDY0LCA2NSwgNjYsIDY3LCA2OCwgNjksIDcwLCA3MSwgNzIsIDczLCA3NCwgNzUsIDc2LCA3NywgNzgsIDc5LCA4MCwgODEsIDgyLCA4MywgODQsIDg1LCA4NiwgODcsIDg4LCA4OSwgOTAsIDkxLCA5MiwgOTMsIDk0LCA5NSwgOTYsIDk3LCA5OCwgOTksIDEwMCwgMTAxLCAxMDIsIDEwMywgMTA0LCAxMDUsIDEwNiwgMTA3LCAxMDgsIDEwOSwgMTEwLCAxMTEsIDExMiwgMTEzLCAxMTQsIDExNSwgMTE2LCAxMTcsIDExOCwgMTE5LCAxMjAsIDEyMSwgMTIyLCAxMjMsIDEyNCwgMTI1LCAxMjYsIDE2MSwgMTYyLCAxNjMsIDE2NCwgMTY1LCAxNjYsIDE2NywgMTY4LCAxNjksIDE3MCwgMTcxLCAxNzIsIDE3NCwgMTc1LCAxNzYsIDE3NywgMTc4LCAxNzksIDE4MCwgMTgxLCAxODIsIDE4MywgMTg0LCAxODUsIDE4NiwgMTg3LCAxODgsIDE4OSwgMTkwLCAxOTEsIDE5MiwgMTkzLCAxOTQsIDE5NSwgMTk2LCAxOTcsIDE5OCwgMTk5LCAyMDAsIDIwMSwgMjAyLCAyMDMsIDIwNCwgMjA1LCAyMDYsIDIwNywgMjA4LCAyMDksIDIxMCwgMjExLCAyMTIsIDIxMywgMjE0LCAyMTUsIDIxNiwgMjE3LCAyMTgsIDIxOSwgMjIwLCAyMjEsIDIyMiwgMjIzLCAyMjQsIDIyNSwgMjI2LCAyMjcsIDIyOCwgMjI5LCAyMzAsIDIzMSwgMjMyLCAyMzMsIDIzNCwgMjM1LCAyMzYsIDIzNywgMjM4LCAyMzksIDI0MCwgMjQxLCAyNDIsIDI0MywgMjQ0LCAyNDUsIDI0NiwgMjQ3LCAyNDgsIDI0OSwgMjUwLCAyNTEsIDI1MiwgMjUzLCAyNTQsIDI1NSwgMjU2LCAyNTcsIDI1OCwgMjU5LCAyNjAsIDI2MSwgMjYyLCAyNjMsIDI2NCwgMjY1LCAyNjYsIDI2NywgMjY4LCAyNjksIDI3MCwgMjcxLCAyNzIsIDI3MywgMjc0LCAyNzUsIDI3NiwgMjc3LCAyNzgsIDI3OSwgMjgwLCAyODEsIDI4MiwgMjgzLCAyODQsIDI4NSwgMjg2LCAyODcsIDI4OCwgMjg5LCAyOTAsIDI5MSwgMjkyLCAyOTMsIDI5NCwgMjk1LCAyOTYsIDI5NywgMjk4LCAyOTksIDMwMCwgMzAxLCAzMDIsIDMwMywgMzA0LCAzMDUsIDMwNiwgMzA3LCAzMDgsIDMwOSwgMzEwLCAzMTEsIDMxMiwgMzEzLCAzMTQsIDMxNSwgMzE2LCAzMTcsIDMxOCwgMzE5LCAzMjAsIDMyMSwgMzIyLCAzMjMsIDMyNCwgMzI1LCAzMjYsIDMyNywgMzI4LCAzMjksIDMzMCwgMzMxLCAzMzIsIDMzMywgMzM0LCAzMzUsIDMzNiwgMzM3LCAzMzgsIDMzOSwgMzQwLCAzNDEsIDM0MiwgMzQzLCAzNDQsIDM0NSwgMzQ2LCAzNDcsIDM0OCwgMzQ5LCAzNTAsIDM1MSwgMzUyLCAzNTMsIDM1NCwgMzU1LCAzNTYsIDM1NywgMzU4LCAzNTksIDM2MCwgMzYxLCAzNjIsIDM2MywgMzY0LCAzNjUsIDM2NiwgMzY3LCAzNjgsIDM2OSwgMzcwLCAzNzEsIDM3MiwgMzczLCAzNzQsIDM3NSwgMzc2LCAzNzcsIDM3OCwgMzc5LCAzODAsIDM4MSwgMzgyLCAzODMsIDQwMiwgNTA2LCA1MDcsIDUwOCwgNTA5LCA1MTAsIDUxMSwgNTM2LCA1MzcsIDUzOCwgNTM5LCA3MTAsIDcxMSwgNzEzLCA3MjgsIDcyOSwgNzMwLCA3MzEsIDczMiwgNzMzLCA5MDAsIDkwMSwgOTAyLCA5MDMsIDkwNCwgOTA1LCA5MDYsIDkwOCwgOTEwLCA5MTEsIDkxMiwgOTEzLCA5MTQsIDkxNSwgOTE2LCA5MTcsIDkxOCwgOTE5LCA5MjAsIDkyMSwgOTIyLCA5MjMsIDkyNCwgOTI1LCA5MjYsIDkyNywgOTI4LCA5MjksIDkzMSwgOTMyLCA5MzMsIDkzNCwgOTM1LCA5MzYsIDkzNywgOTM4LCA5MzksIDk0MCwgOTQxLCA5NDIsIDk0MywgOTQ0LCA5NDUsIDk0NiwgOTQ3LCA5NDgsIDk0OSwgOTUwLCA5NTEsIDk1MiwgOTUzLCA5NTQsIDk1NSwgOTU2LCA5NTcsIDk1OCwgOTU5LCA5NjAsIDk2MSwgOTYyLCA5NjMsIDk2NCwgOTY1LCA5NjYsIDk2NywgOTY4LCA5NjksIDk3MCwgOTcxLCA5NzIsIDk3MywgOTc0LCAxMDI0LCAxMDI1LCAxMDI2LCAxMDI3LCAxMDI4LCAxMDI5LCAxMDMwLCAxMDMxLCAxMDMyLCAxMDMzLCAxMDM0LCAxMDM1LCAxMDM2LCAxMDM3LCAxMDM4LCAxMDM5LCAxMDQwLCAxMDQxLCAxMDQyLCAxMDQzLCAxMDQ0LCAxMDQ1LCAxMDQ2LCAxMDQ3LCAxMDQ4LCAxMDQ5LCAxMDUwLCAxMDUxLCAxMDUyLCAxMDUzLCAxMDU0LCAxMDU1LCAxMDU2LCAxMDU3LCAxMDU4LCAxMDU5LCAxMDYwLCAxMDYxLCAxMDYyLCAxMDYzLCAxMDY0LCAxMDY1LCAxMDY2LCAxMDY3LCAxMDY4LCAxMDY5LCAxMDcwLCAxMDcxLCAxMDcyLCAxMDczLCAxMDc0LCAxMDc1LCAxMDc2LCAxMDc3LCAxMDc4LCAxMDc5LCAxMDgwLCAxMDgxLCAxMDgyLCAxMDgzLCAxMDg0LCAxMDg1LCAxMDg2LCAxMDg3LCAxMDg4LCAxMDg5LCAxMDkwLCAxMDkxLCAxMDkyLCAxMDkzLCAxMDk0LCAxMDk1LCAxMDk2LCAxMDk3LCAxMDk4LCAxMDk5LCAxMTAwLCAxMTAxLCAxMTAyLCAxMTAzLCAxMTA0LCAxMTA1LCAxMTA2LCAxMTA3LCAxMTA4LCAxMTA5LCAxMTEwLCAxMTExLCAxMTEyLCAxMTEzLCAxMTE0LCAxMTE1LCAxMTE2LCAxMTE3LCAxMTE4LCAxMTE5LCAxMTM4LCAxMTM5LCAxMTY4LCAxMTY5LCA3ODA4LCA3ODA5LCA3ODEwLCA3ODExLCA3ODEyLCA3ODEzLCA3OTIyLCA3OTIzLCA4MjA4LCA4MjA5LCA4MjExLCA4MjEyLCA4MjEzLCA4MjE1LCA4MjE2LCA4MjE3LCA4MjE4LCA4MjE5LCA4MjIwLCA4MjIxLCA4MjIyLCA4MjI0LCA4MjI1LCA4MjI2LCA4MjMwLCA4MjQwLCA4MjQyLCA4MjQzLCA4MjQ5LCA4MjUwLCA4MjUyLCA4MjU0LCA4MjYwLCA4MzE5LCA4MzU1LCA4MzU2LCA4MzU5LCA4MzY0LCA4NDUzLCA4NDY3LCA4NDcwLCA4NDgyLCA4NDg2LCA4NDk0LCA4NTM5LCA4NTQwLCA4NTQxLCA4NTQyLCA4NTkyLCA4NTkzLCA4NTk0LCA4NTk1LCA4NTk2LCA4NTk3LCA4NjE2LCA4NzA2LCA4NzEwLCA4NzE5LCA4NzIxLCA4NzIyLCA4NzMwLCA4NzM0LCA4NzM1LCA4NzQ1LCA4NzQ3LCA4Nzc2LCA4ODAwLCA4ODAxLCA4ODA0LCA4ODA1LCA4OTYyLCA4OTc2LCA4OTkyLCA4OTkzLCA5NDcyLCA5NDc0LCA5NDg0LCA5NDg4LCA5NDkyLCA5NDk2LCA5NTAwLCA5NTA4LCA5NTE2LCA5NTI0LCA5NTMyLCA5NTUyLCA5NTUzLCA5NTU0LCA5NTU1LCA5NTU2LCA5NTU3LCA5NTU4LCA5NTU5LCA5NTYwLCA5NTYxLCA5NTYyLCA5NTYzLCA5NTY0LCA5NTY1LCA5NTY2LCA5NTY3LCA5NTY4LCA5NTY5LCA5NTcwLCA5NTcxLCA5NTcyLCA5NTczLCA5NTc0LCA5NTc1LCA5NTc2LCA5NTc3LCA5NTc4LCA5NTc5LCA5NTgwLCA5NjAwLCA5NjA0LCA5NjA4LCA5NjEyLCA5NjE2LCA5NjE3LCA5NjE4LCA5NjE5LCA5NjMyLCA5NjMzLCA5NjQyLCA5NjQzLCA5NjQ0LCA5NjUwLCA5NjU4LCA5NjYwLCA5NjY4LCA5Njc0LCA5Njc1LCA5Njc5LCA5Njg4LCA5Njg5LCA5NzAyLCA5Nzg2LCA5Nzg3LCA5Nzg4LCA5NzkyLCA5Nzk0LCA5ODI0LCA5ODI3LCA5ODI5LCA5ODMwLCA5ODM0LCA5ODM1LCA5ODM2LCA2MTQ0MSwgNjE0NDIsIDYxNDQ1LCAtMSwgLTEsIC0xLCAtMSwgLTEsIC0xLCAtMSwgLTEsIC0xLCAtMSwgLTEsIC0xLCAtMSwgLTEsIC0xLCAtMSwgLTFdOwpleHBvcnRzLkxpYmVyYXRpb25TYW5zSXRhbGljTWFwcGluZyA9IExpYmVyYXRpb25TYW5zSXRhbGljTWFwcGluZzsKY29uc3QgTGliZXJhdGlvblNhbnNSZWd1bGFyV2lkdGhzID0gWzM2NSwgMCwgMzMzLCAyNzgsIDI3OCwgMzU1LCA1NTYsIDU1NiwgODg5LCA2NjcsIDE5MSwgMzMzLCAzMzMsIDM4OSwgNTg0LCAyNzgsIDMzMywgMjc4LCAyNzgsIDU1NiwgNTU2LCA1NTYsIDU1NiwgNTU2LCA1NTYsIDU1NiwgNTU2LCA1NTYsIDU1NiwgMjc4LCAyNzgsIDU4NCwgNTg0LCA1ODQsIDU1NiwgMTAxNSwgNjY3LCA2NjcsIDcyMiwgNzIyLCA2NjcsIDYxMSwgNzc4LCA3MjIsIDI3OCwgNTAwLCA2NjcsIDU1NiwgODMzLCA3MjIsIDc3OCwgNjY3LCA3NzgsIDcyMiwgNjY3LCA2MTEsIDcyMiwgNjY3LCA5NDQsIDY2NywgNjY3LCA2MTEsIDI3OCwgMjc4LCAyNzgsIDQ2OSwgNTU2LCAzMzMsIDU1NiwgNTU2LCA1MDAsIDU1NiwgNTU2LCAyNzgsIDU1NiwgNTU2LCAyMjIsIDIyMiwgNTAwLCAyMjIsIDgzMywgNTU2LCA1NTYsIDU1NiwgNTU2LCAzMzMsIDUwMCwgMjc4LCA1NTYsIDUwMCwgNzIyLCA1MDAsIDUwMCwgNTAwLCAzMzQsIDI2MCwgMzM0LCA1ODQsIDMzMywgNTU2LCA1NTYsIDU1NiwgNTU2LCAyNjAsIDU1NiwgMzMzLCA3MzcsIDM3MCwgNTU2LCA1ODQsIDczNywgNTUyLCA0MDAsIDU0OSwgMzMzLCAzMzMsIDMzMywgNTc2LCA1MzcsIDI3OCwgMzMzLCAzMzMsIDM2NSwgNTU2LCA4MzQsIDgzNCwgODM0LCA2MTEsIDY2NywgNjY3LCA2NjcsIDY2NywgNjY3LCA2NjcsIDEwMDAsIDcyMiwgNjY3LCA2NjcsIDY2NywgNjY3LCAyNzgsIDI3OCwgMjc4LCAyNzgsIDcyMiwgNzIyLCA3NzgsIDc3OCwgNzc4LCA3NzgsIDc3OCwgNTg0LCA3NzgsIDcyMiwgNzIyLCA3MjIsIDcyMiwgNjY3LCA2NjcsIDYxMSwgNTU2LCA1NTYsIDU1NiwgNTU2LCA1NTYsIDU1NiwgODg5LCA1MDAsIDU1NiwgNTU2LCA1NTYsIDU1NiwgMjc4LCAyNzgsIDI3OCwgMjc4LCA1NTYsIDU1NiwgNTU2LCA1NTYsIDU1NiwgNTU2LCA1NTYsIDU0OSwgNjExLCA1NTYsIDU1NiwgNTU2LCA1NTYsIDUwMCwgNTU2LCA1MDAsIDY2NywgNTU2LCA2NjcsIDU1NiwgNjY3LCA1NTYsIDcyMiwgNTAwLCA3MjIsIDUwMCwgNzIyLCA1MDAsIDcyMiwgNTAwLCA3MjIsIDYxNSwgNzIyLCA1NTYsIDY2NywgNTU2LCA2NjcsIDU1NiwgNjY3LCA1NTYsIDY2NywgNTU2LCA2NjcsIDU1NiwgNzc4LCA1NTYsIDc3OCwgNTU2LCA3NzgsIDU1NiwgNzc4LCA1NTYsIDcyMiwgNTU2LCA3MjIsIDU1NiwgMjc4LCAyNzgsIDI3OCwgMjc4LCAyNzgsIDI3OCwgMjc4LCAyMjIsIDI3OCwgMjc4LCA3MzUsIDQ0NCwgNTAwLCAyMjIsIDY2NywgNTAwLCA1MDAsIDU1NiwgMjIyLCA1NTYsIDIyMiwgNTU2LCAyOTIsIDU1NiwgMzM0LCA1NTYsIDIyMiwgNzIyLCA1NTYsIDcyMiwgNTU2LCA3MjIsIDU1NiwgNjA0LCA3MjMsIDU1NiwgNzc4LCA1NTYsIDc3OCwgNTU2LCA3NzgsIDU1NiwgMTAwMCwgOTQ0LCA3MjIsIDMzMywgNzIyLCAzMzMsIDcyMiwgMzMzLCA2NjcsIDUwMCwgNjY3LCA1MDAsIDY2NywgNTAwLCA2NjcsIDUwMCwgNjExLCAyNzgsIDYxMSwgMzc1LCA2MTEsIDI3OCwgNzIyLCA1NTYsIDcyMiwgNTU2LCA3MjIsIDU1NiwgNzIyLCA1NTYsIDcyMiwgNTU2LCA3MjIsIDU1NiwgOTQ0LCA3MjIsIDY2NywgNTAwLCA2NjcsIDYxMSwgNTAwLCA2MTEsIDUwMCwgNjExLCA1MDAsIDIyMiwgNTU2LCA2NjcsIDU1NiwgMTAwMCwgODg5LCA3NzgsIDYxMSwgNjY3LCA1MDAsIDYxMSwgMjc4LCAzMzMsIDMzMywgMzMzLCAzMzMsIDMzMywgMzMzLCAzMzMsIDMzMywgMzMzLCAzMzMsIDMzMywgNjY3LCAyNzgsIDc4NCwgODM4LCAzODQsIDc3NCwgODU1LCA3NTIsIDIyMiwgNjY3LCA2NjcsIDU1MSwgNjY4LCA2NjcsIDYxMSwgNzIyLCA3NzgsIDI3OCwgNjY3LCA2NjgsIDgzMywgNzIyLCA2NTAsIDc3OCwgNzIyLCA2NjcsIDYxOCwgNjExLCA2NjcsIDc5OCwgNjY3LCA4MzUsIDc0OCwgMjc4LCA2NjcsIDU3OCwgNDQ2LCA1NTYsIDIyMiwgNTQ3LCA1NzgsIDU3NSwgNTAwLCA1NTcsIDQ0NiwgNDQxLCA1NTYsIDU1NiwgMjIyLCA1MDAsIDUwMCwgNTc2LCA1MDAsIDQ0OCwgNTU2LCA2OTAsIDU2OSwgNDgyLCA2MTcsIDM5NSwgNTQ3LCA2NDgsIDUyNSwgNzEzLCA3ODEsIDIyMiwgNTQ3LCA1NTYsIDU0NywgNzgxLCA2NjcsIDY2NywgODY1LCA1NDIsIDcxOSwgNjY3LCAyNzgsIDI3OCwgNTAwLCAxMDU3LCAxMDEwLCA4NTQsIDU4MywgNzIyLCA2MzUsIDcxOSwgNjY3LCA2NTYsIDY2NywgNTQyLCA2NzcsIDY2NywgOTIzLCA2MDQsIDcxOSwgNzE5LCA1ODMsIDY1NiwgODMzLCA3MjIsIDc3OCwgNzE5LCA2NjcsIDcyMiwgNjExLCA2MzUsIDc2MCwgNjY3LCA3NDAsIDY2NywgOTE3LCA5MzgsIDc5MiwgODg1LCA2NTYsIDcxOSwgMTAxMCwgNzIyLCA1NTYsIDU3MywgNTMxLCAzNjUsIDU4MywgNTU2LCA2NjksIDQ1OCwgNTU5LCA1NTksIDQzOCwgNTgzLCA2ODgsIDU1MiwgNTU2LCA1NDIsIDU1NiwgNTAwLCA0NTgsIDUwMCwgODIzLCA1MDAsIDU3MywgNTIxLCA4MDIsIDgyMywgNjI1LCA3MTksIDUyMSwgNTEwLCA3NTAsIDU0MiwgNTU2LCA1NTYsIDU1NiwgMzY1LCA1MTAsIDUwMCwgMjIyLCAyNzgsIDIyMiwgOTA2LCA4MTIsIDU1NiwgNDM4LCA1NTksIDUwMCwgNTUyLCA3NzgsIDU1NiwgNDg5LCA0MTEsIDk0NCwgNzIyLCA5NDQsIDcyMiwgOTQ0LCA3MjIsIDY2NywgNTAwLCAzMzMsIDMzMywgNTU2LCAxMDAwLCAxMDAwLCA1NTIsIDIyMiwgMjIyLCAyMjIsIDIyMiwgMzMzLCAzMzMsIDMzMywgNTU2LCA1NTYsIDM1MCwgMTAwMCwgMTAwMCwgMTg4LCAzNTQsIDMzMywgMzMzLCA1MDAsIDMzMywgMTY3LCAzNjUsIDU1NiwgNTU2LCAxMDk0LCA1NTYsIDg4NSwgMzIzLCAxMDczLCAxMDAwLCA3NjgsIDYwMCwgODM0LCA4MzQsIDgzNCwgODM0LCAxMDAwLCA1MDAsIDEwMDAsIDUwMCwgMTAwMCwgNTAwLCA1MDAsIDQ5NCwgNjEyLCA4MjMsIDcxMywgNTg0LCA1NDksIDcxMywgOTc5LCA3MTksIDI3NCwgNTQ5LCA1NDksIDU4MywgNTQ5LCA1NDksIDYwNCwgNTg0LCA2MDQsIDYwNCwgNzA4LCA2MjUsIDcwOCwgNzA4LCA3MDgsIDcwOCwgNzA4LCA3MDgsIDcwOCwgNzA4LCA3MDgsIDcwOCwgNzA4LCA3MDgsIDcwOCwgNzA4LCA3MDgsIDcwOCwgNzA4LCA3MDgsIDcwOCwgNzA4LCA3MDgsIDcwOCwgNzA4LCA3MDgsIDcwOCwgNzA4LCA3MDgsIDcwOCwgNzA4LCA3MDgsIDcwOCwgNzA4LCA3MDgsIDcwOCwgNzA4LCA3MDgsIDcwOCwgNzA4LCA3MDgsIDcwOCwgNzA4LCA3MDgsIDcwOCwgNzA4LCA3MDgsIDcyOSwgNjA0LCA2MDQsIDM1NCwgMzU0LCAxMDAwLCA5OTAsIDk5MCwgOTkwLCA5OTAsIDQ5NCwgNjA0LCA2MDQsIDYwNCwgNjA0LCAzNTQsIDEwMjEsIDEwNTIsIDkxNywgNzUwLCA3NTAsIDUzMSwgNjU2LCA1OTQsIDUxMCwgNTAwLCA3NTAsIDc1MCwgNTAwLCA1MDAsIDMzMywgMzMzLCAzMzMsIDMzMywgMzMzLCAzMzMsIDMzMywgMzMzLCAyMjIsIDIyMiwgMjk0LCAyOTQsIDMyNCwgMzI0LCAzMTYsIDMyOCwgMzk4LCAyODVdOwpleHBvcnRzLkxpYmVyYXRpb25TYW5zUmVndWxhcldpZHRocyA9IExpYmVyYXRpb25TYW5zUmVndWxhcldpZHRoczsKY29uc3QgTGliZXJhdGlvblNhbnNSZWd1bGFyTWFwcGluZyA9IFstMSwgLTEsIC0xLCAzMiwgMzMsIDM0LCAzNSwgMzYsIDM3LCAzOCwgMzksIDQwLCA0MSwgNDIsIDQzLCA0NCwgNDUsIDQ2LCA0NywgNDgsIDQ5LCA1MCwgNTEsIDUyLCA1MywgNTQsIDU1LCA1NiwgNTcsIDU4LCA1OSwgNjAsIDYxLCA2MiwgNjMsIDY0LCA2NSwgNjYsIDY3LCA2OCwgNjksIDcwLCA3MSwgNzIsIDczLCA3NCwgNzUsIDc2LCA3NywgNzgsIDc5LCA4MCwgODEsIDgyLCA4MywgODQsIDg1LCA4NiwgODcsIDg4LCA4OSwgOTAsIDkxLCA5MiwgOTMsIDk0LCA5NSwgOTYsIDk3LCA5OCwgOTksIDEwMCwgMTAxLCAxMDIsIDEwMywgMTA0LCAxMDUsIDEwNiwgMTA3LCAxMDgsIDEwOSwgMTEwLCAxMTEsIDExMiwgMTEzLCAxMTQsIDExNSwgMTE2LCAxMTcsIDExOCwgMTE5LCAxMjAsIDEyMSwgMTIyLCAxMjMsIDEyNCwgMTI1LCAxMjYsIDE2MSwgMTYyLCAxNjMsIDE2NCwgMTY1LCAxNjYsIDE2NywgMTY4LCAxNjksIDE3MCwgMTcxLCAxNzIsIDE3NCwgMTc1LCAxNzYsIDE3NywgMTc4LCAxNzksIDE4MCwgMTgxLCAxODIsIDE4MywgMTg0LCAxODUsIDE4NiwgMTg3LCAxODgsIDE4OSwgMTkwLCAxOTEsIDE5MiwgMTkzLCAxOTQsIDE5NSwgMTk2LCAxOTcsIDE5OCwgMTk5LCAyMDAsIDIwMSwgMjAyLCAyMDMsIDIwNCwgMjA1LCAyMDYsIDIwNywgMjA4LCAyMDksIDIxMCwgMjExLCAyMTIsIDIxMywgMjE0LCAyMTUsIDIxNiwgMjE3LCAyMTgsIDIxOSwgMjIwLCAyMjEsIDIyMiwgMjIzLCAyMjQsIDIyNSwgMjI2LCAyMjcsIDIyOCwgMjI5LCAyMzAsIDIzMSwgMjMyLCAyMzMsIDIzNCwgMjM1LCAyMzYsIDIzNywgMjM4LCAyMzksIDI0MCwgMjQxLCAyNDIsIDI0MywgMjQ0LCAyNDUsIDI0NiwgMjQ3LCAyNDgsIDI0OSwgMjUwLCAyNTEsIDI1MiwgMjUzLCAyNTQsIDI1NSwgMjU2LCAyNTcsIDI1OCwgMjU5LCAyNjAsIDI2MSwgMjYyLCAyNjMsIDI2NCwgMjY1LCAyNjYsIDI2NywgMjY4LCAyNjksIDI3MCwgMjcxLCAyNzIsIDI3MywgMjc0LCAyNzUsIDI3NiwgMjc3LCAyNzgsIDI3OSwgMjgwLCAyODEsIDI4MiwgMjgzLCAyODQsIDI4NSwgMjg2LCAyODcsIDI4OCwgMjg5LCAyOTAsIDI5MSwgMjkyLCAyOTMsIDI5NCwgMjk1LCAyOTYsIDI5NywgMjk4LCAyOTksIDMwMCwgMzAxLCAzMDIsIDMwMywgMzA0LCAzMDUsIDMwNiwgMzA3LCAzMDgsIDMwOSwgMzEwLCAzMTEsIDMxMiwgMzEzLCAzMTQsIDMxNSwgMzE2LCAzMTcsIDMxOCwgMzE5LCAzMjAsIDMyMSwgMzIyLCAzMjMsIDMyNCwgMzI1LCAzMjYsIDMyNywgMzI4LCAzMjksIDMzMCwgMzMxLCAzMzIsIDMzMywgMzM0LCAzMzUsIDMzNiwgMzM3LCAzMzgsIDMzOSwgMzQwLCAzNDEsIDM0MiwgMzQzLCAzNDQsIDM0NSwgMzQ2LCAzNDcsIDM0OCwgMzQ5LCAzNTAsIDM1MSwgMzUyLCAzNTMsIDM1NCwgMzU1LCAzNTYsIDM1NywgMzU4LCAzNTksIDM2MCwgMzYxLCAzNjIsIDM2MywgMzY0LCAzNjUsIDM2NiwgMzY3LCAzNjgsIDM2OSwgMzcwLCAzNzEsIDM3MiwgMzczLCAzNzQsIDM3NSwgMzc2LCAzNzcsIDM3OCwgMzc5LCAzODAsIDM4MSwgMzgyLCAzODMsIDQwMiwgNTA2LCA1MDcsIDUwOCwgNTA5LCA1MTAsIDUxMSwgNTM2LCA1MzcsIDUzOCwgNTM5LCA3MTAsIDcxMSwgNzEzLCA3MjgsIDcyOSwgNzMwLCA3MzEsIDczMiwgNzMzLCA5MDAsIDkwMSwgOTAyLCA5MDMsIDkwNCwgOTA1LCA5MDYsIDkwOCwgOTEwLCA5MTEsIDkxMiwgOTEzLCA5MTQsIDkxNSwgOTE2LCA5MTcsIDkxOCwgOTE5LCA5MjAsIDkyMSwgOTIyLCA5MjMsIDkyNCwgOTI1LCA5MjYsIDkyNywgOTI4LCA5MjksIDkzMSwgOTMyLCA5MzMsIDkzNCwgOTM1LCA5MzYsIDkzNywgOTM4LCA5MzksIDk0MCwgOTQxLCA5NDIsIDk0MywgOTQ0LCA5NDUsIDk0NiwgOTQ3LCA5NDgsIDk0OSwgOTUwLCA5NTEsIDk1MiwgOTUzLCA5NTQsIDk1NSwgOTU2LCA5NTcsIDk1OCwgOTU5LCA5NjAsIDk2MSwgOTYyLCA5NjMsIDk2NCwgOTY1LCA5NjYsIDk2NywgOTY4LCA5NjksIDk3MCwgOTcxLCA5NzIsIDk3MywgOTc0LCAxMDI0LCAxMDI1LCAxMDI2LCAxMDI3LCAxMDI4LCAxMDI5LCAxMDMwLCAxMDMxLCAxMDMyLCAxMDMzLCAxMDM0LCAxMDM1LCAxMDM2LCAxMDM3LCAxMDM4LCAxMDM5LCAxMDQwLCAxMDQxLCAxMDQyLCAxMDQzLCAxMDQ0LCAxMDQ1LCAxMDQ2LCAxMDQ3LCAxMDQ4LCAxMDQ5LCAxMDUwLCAxMDUxLCAxMDUyLCAxMDUzLCAxMDU0LCAxMDU1LCAxMDU2LCAxMDU3LCAxMDU4LCAxMDU5LCAxMDYwLCAxMDYxLCAxMDYyLCAxMDYzLCAxMDY0LCAxMDY1LCAxMDY2LCAxMDY3LCAxMDY4LCAxMDY5LCAxMDcwLCAxMDcxLCAxMDcyLCAxMDczLCAxMDc0LCAxMDc1LCAxMDc2LCAxMDc3LCAxMDc4LCAxMDc5LCAxMDgwLCAxMDgxLCAxMDgyLCAxMDgzLCAxMDg0LCAxMDg1LCAxMDg2LCAxMDg3LCAxMDg4LCAxMDg5LCAxMDkwLCAxMDkxLCAxMDkyLCAxMDkzLCAxMDk0LCAxMDk1LCAxMDk2LCAxMDk3LCAxMDk4LCAxMDk5LCAxMTAwLCAxMTAxLCAxMTAyLCAxMTAzLCAxMTA0LCAxMTA1LCAxMTA2LCAxMTA3LCAxMTA4LCAxMTA5LCAxMTEwLCAxMTExLCAxMTEyLCAxMTEzLCAxMTE0LCAxMTE1LCAxMTE2LCAxMTE3LCAxMTE4LCAxMTE5LCAxMTM4LCAxMTM5LCAxMTY4LCAxMTY5LCA3ODA4LCA3ODA5LCA3ODEwLCA3ODExLCA3ODEyLCA3ODEzLCA3OTIyLCA3OTIzLCA4MjA4LCA4MjA5LCA4MjExLCA4MjEyLCA4MjEzLCA4MjE1LCA4MjE2LCA4MjE3LCA4MjE4LCA4MjE5LCA4MjIwLCA4MjIxLCA4MjIyLCA4MjI0LCA4MjI1LCA4MjI2LCA4MjMwLCA4MjQwLCA4MjQyLCA4MjQzLCA4MjQ5LCA4MjUwLCA4MjUyLCA4MjU0LCA4MjYwLCA4MzE5LCA4MzU1LCA4MzU2LCA4MzU5LCA4MzY0LCA4NDUzLCA4NDY3LCA4NDcwLCA4NDgyLCA4NDg2LCA4NDk0LCA4NTM5LCA4NTQwLCA4NTQxLCA4NTQyLCA4NTkyLCA4NTkzLCA4NTk0LCA4NTk1LCA4NTk2LCA4NTk3LCA4NjE2LCA4NzA2LCA4NzEwLCA4NzE5LCA4NzIxLCA4NzIyLCA4NzMwLCA4NzM0LCA4NzM1LCA4NzQ1LCA4NzQ3LCA4Nzc2LCA4ODAwLCA4ODAxLCA4ODA0LCA4ODA1LCA4OTYyLCA4OTc2LCA4OTkyLCA4OTkzLCA5NDcyLCA5NDc0LCA5NDg0LCA5NDg4LCA5NDkyLCA5NDk2LCA5NTAwLCA5NTA4LCA5NTE2LCA5NTI0LCA5NTMyLCA5NTUyLCA5NTUzLCA5NTU0LCA5NTU1LCA5NTU2LCA5NTU3LCA5NTU4LCA5NTU5LCA5NTYwLCA5NTYxLCA5NTYyLCA5NTYzLCA5NTY0LCA5NTY1LCA5NTY2LCA5NTY3LCA5NTY4LCA5NTY5LCA5NTcwLCA5NTcxLCA5NTcyLCA5NTczLCA5NTc0LCA5NTc1LCA5NTc2LCA5NTc3LCA5NTc4LCA5NTc5LCA5NTgwLCA5NjAwLCA5NjA0LCA5NjA4LCA5NjEyLCA5NjE2LCA5NjE3LCA5NjE4LCA5NjE5LCA5NjMyLCA5NjMzLCA5NjQyLCA5NjQzLCA5NjQ0LCA5NjUwLCA5NjU4LCA5NjYwLCA5NjY4LCA5Njc0LCA5Njc1LCA5Njc5LCA5Njg4LCA5Njg5LCA5NzAyLCA5Nzg2LCA5Nzg3LCA5Nzg4LCA5NzkyLCA5Nzk0LCA5ODI0LCA5ODI3LCA5ODI5LCA5ODMwLCA5ODM0LCA5ODM1LCA5ODM2LCA2MTQ0MSwgNjE0NDIsIDYxNDQ1LCAtMSwgLTEsIC0xLCAtMSwgLTEsIC0xLCAtMSwgLTEsIC0xLCAtMSwgLTEsIC0xLCAtMSwgLTEsIC0xLCAtMSwgLTFdOwpleHBvcnRzLkxpYmVyYXRpb25TYW5zUmVndWxhck1hcHBpbmcgPSBMaWJlcmF0aW9uU2Fuc1JlZ3VsYXJNYXBwaW5nOwoKLyoqKi8gfSksCi8qIDU1ICovCi8qKiovICgoX191bnVzZWRfd2VicGFja19tb2R1bGUsIGV4cG9ydHMpID0+IHsKCgoKT2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsICJfX2VzTW9kdWxlIiwgKHsKICB2YWx1ZTogdHJ1ZQp9KSk7CmV4cG9ydHMuTXlyaWFkUHJvUmVndWxhck1ldHJpY3MgPSBleHBvcnRzLk15cmlhZFByb1JlZ3VsYXJGYWN0b3JzID0gZXhwb3J0cy5NeXJpYWRQcm9JdGFsaWNNZXRyaWNzID0gZXhwb3J0cy5NeXJpYWRQcm9JdGFsaWNGYWN0b3JzID0gZXhwb3J0cy5NeXJpYWRQcm9Cb2xkTWV0cmljcyA9IGV4cG9ydHMuTXlyaWFkUHJvQm9sZEl0YWxpY01ldHJpY3MgPSBleHBvcnRzLk15cmlhZFByb0JvbGRJdGFsaWNGYWN0b3JzID0gZXhwb3J0cy5NeXJpYWRQcm9Cb2xkRmFjdG9ycyA9IHZvaWQgMDsKY29uc3QgTXlyaWFkUHJvQm9sZEZhY3RvcnMgPSBbMS4zNjg5OCwgMSwgMSwgMC43MjcwNiwgMC44MDQ3OSwgMC44MzczNCwgMC45ODg5NCwgMC45OTc5MywgMC45ODk3LCAwLjkzODg0LCAwLjg2MjA5LCAwLjk0MjkyLCAwLjk0MjkyLCAxLjE2NjYxLCAxLjAyMDU4LCAwLjkzNTgyLCAwLjk2Njk0LCAwLjkzNTgyLCAxLjE5MTM3LCAwLjk5NzkzLCAwLjk5NzkzLCAwLjk5NzkzLCAwLjk5NzkzLCAwLjk5NzkzLCAwLjk5NzkzLCAwLjk5NzkzLCAwLjk5NzkzLCAwLjk5NzkzLCAwLjk5NzkzLCAwLjc4MDc2LCAwLjc4MDc2LCAxLjAyMDU4LCAxLjAyMDU4LCAxLjAyMDU4LCAwLjcyODUxLCAwLjc4OTY2LCAwLjkwODM4LCAwLjgzNjM3LCAwLjgyMzkxLCAwLjk2Mzc2LCAwLjgwMDYxLCAwLjg2Mjc1LCAwLjg3NjgsIDAuOTU0MDcsIDEuMDI1OCwgMC43MzkwMSwgMC44NTAyMiwgMC44MzY1NSwgMS4wMTU2LCAwLjk1NTQ2LCAwLjkyMTc5LCAwLjg3MTA3LCAwLjkyMTc5LCAwLjgyMTE0LCAwLjgwOTYsIDAuODk3MTMsIDAuOTQ0MzgsIDAuOTUzNTMsIDAuOTQwODMsIDAuOTE5MDUsIDAuOTA0MDYsIDAuOTQ0NiwgMC45NDI5MiwgMS4xODc3NywgMC45NDI5MiwgMS4wMjA1OCwgMC44OTkwMywgMC45MDA4OCwgMC45NDkzOCwgMC45Nzg5OCwgMC44MTA5MywgMC45NzU3MSwgMC45NDkzOCwgMS4wMjQsIDAuOTU3NywgMC45NTkzMywgMC45ODYyMSwgMS4wNDc0LCAwLjk3NDU1LCAwLjk4OTgxLCAwLjk2NzIsIDAuOTU5MzMsIDAuOTQ0NiwgMC45Nzg5OCwgMC45NzQwNywgMC45NzY0NiwgMC43ODAzNiwgMS4xMDIwOCwgMC45NTQ0MiwgMC45NTI5OCwgMC45NzU3OSwgMC45MzMyLCAwLjk0MDM5LCAwLjkzOCwgMC44MDY4NywgMS4wMTE0OSwgMC44MDY4NywgMS4wMjA1OCwgMC44MDQ3OSwgMC45OTc5MywgMC45OTc5MywgMC45OTc5MywgMC45OTc5MywgMS4wMTE0OSwgMS4wMDg3MiwgMC45MDA4OCwgMC45MTg4MiwgMS4wMjEzLCAwLjgzNjEsIDEuMDIwNTgsIDAuNjIyOTUsIDAuNTQzMjQsIDAuODkwMjIsIDEuMDg1OTUsIDEsIDEsIDAuOTAwODgsIDEsIDAuOTc0NTUsIDAuOTM1ODIsIDAuOTAwODgsIDEsIDEuMDU2ODYsIDAuODM2MSwgMC45OTY0MiwgMC45OTY0MiwgMC45OTY0MiwgMC43Mjg1MSwgMC45MDgzOCwgMC45MDgzOCwgMC45MDgzOCwgMC45MDgzOCwgMC45MDgzOCwgMC45MDgzOCwgMC44NjgsIDAuODIzOTEsIDAuODAwNjEsIDAuODAwNjEsIDAuODAwNjEsIDAuODAwNjEsIDEuMDI1OCwgMS4wMjU4LCAxLjAyNTgsIDEuMDI1OCwgMC45NzQ4NCwgMC45NTU0NiwgMC45MjE3OSwgMC45MjE3OSwgMC45MjE3OSwgMC45MjE3OSwgMC45MjE3OSwgMS4wMjA1OCwgMC45MjE3OSwgMC45NDQzOCwgMC45NDQzOCwgMC45NDQzOCwgMC45NDQzOCwgMC45MDQwNiwgMC44Njk1OCwgMC45ODIyNSwgMC45NDkzOCwgMC45NDkzOCwgMC45NDkzOCwgMC45NDkzOCwgMC45NDkzOCwgMC45NDkzOCwgMC45MDMxLCAwLjgxMDkzLCAwLjk0OTM4LCAwLjk0OTM4LCAwLjk0OTM4LCAwLjk0OTM4LCAwLjk4NjIxLCAwLjk4NjIxLCAwLjk4NjIxLCAwLjk4NjIxLCAwLjkzOTY5LCAwLjk1OTMzLCAwLjk0NDYsIDAuOTQ0NiwgMC45NDQ2LCAwLjk0NDYsIDAuOTQ0NiwgMS4wODU5NSwgMC45NDQ2LCAwLjk1NDQyLCAwLjk1NDQyLCAwLjk1NDQyLCAwLjk1NDQyLCAwLjk0MDM5LCAwLjk3ODk4LCAwLjk0MDM5LCAwLjkwODM4LCAwLjk0OTM4LCAwLjkwODM4LCAwLjk0OTM4LCAwLjkwODM4LCAwLjk0OTM4LCAwLjgyMzkxLCAwLjgxMDkzLCAwLjgyMzkxLCAwLjgxMDkzLCAwLjgyMzkxLCAwLjgxMDkzLCAwLjgyMzkxLCAwLjgxMDkzLCAwLjk2Mzc2LCAwLjg0MzEzLCAwLjk3NDg0LCAwLjk3NTcxLCAwLjgwMDYxLCAwLjk0OTM4LCAwLjgwMDYxLCAwLjk0OTM4LCAwLjgwMDYxLCAwLjk0OTM4LCAwLjgwMDYxLCAwLjk0OTM4LCAwLjgwMDYxLCAwLjk0OTM4LCAwLjg3NjgsIDAuOTU3NywgMC44NzY4LCAwLjk1NzcsIDAuODc2OCwgMC45NTc3LCAxLCAxLCAwLjk1NDA3LCAwLjk1OTMzLCAwLjk3MDY5LCAwLjk1OTMzLCAxLjAyNTgsIDAuOTg2MjEsIDEuMDI1OCwgMC45ODYyMSwgMS4wMjU4LCAwLjk4NjIxLCAxLjAyNTgsIDAuOTg2MjEsIDEuMDI1OCwgMC45ODYyMSwgMC44ODcsIDEuMDE1OTEsIDAuNzM5MDEsIDEuMDQ3NCwgMSwgMSwgMC45NzQ1NSwgMC44MzY1NSwgMC45ODk4MSwgMSwgMSwgMC44MzY1NSwgMC43Mzk3NywgMC44MzY1NSwgMC43MzkwMywgMC44NDYzOCwgMS4wMzMsIDAuOTU1NDYsIDAuOTU5MzMsIDEsIDEsIDAuOTU1NDYsIDAuOTU5MzMsIDAuODI3MSwgMC45NTQxNywgMC45NTkzMywgMC45MjE3OSwgMC45NDQ2LCAwLjkyMTc5LCAwLjk0NDYsIDAuOTIxNzksIDAuOTQ0NiwgMC45MzYsIDAuOTE5NjQsIDAuODIxMTQsIDAuOTc2NDYsIDEsIDEsIDAuODIxMTQsIDAuOTc2NDYsIDAuODA5NiwgMC43ODAzNiwgMC44MDk2LCAwLjc4MDM2LCAxLCAxLCAwLjgwOTYsIDAuNzgwMzYsIDEsIDEsIDAuODk3MTMsIDAuNzc0NTIsIDAuODk3MTMsIDEuMTAyMDgsIDAuOTQ0MzgsIDAuOTU0NDIsIDAuOTQ0MzgsIDAuOTU0NDIsIDAuOTQ0MzgsIDAuOTU0NDIsIDAuOTQ0MzgsIDAuOTU0NDIsIDAuOTQ0MzgsIDAuOTU0NDIsIDAuOTQ0MzgsIDAuOTU0NDIsIDAuOTQwODMsIDAuOTc1NzksIDAuOTA0MDYsIDAuOTQwMzksIDAuOTA0MDYsIDAuOTQ0NiwgMC45MzgsIDAuOTQ0NiwgMC45MzgsIDAuOTQ0NiwgMC45MzgsIDEsIDAuOTk3OTMsIDAuOTA4MzgsIDAuOTQ5MzgsIDAuODY4LCAwLjkwMzEsIDAuOTIxNzksIDAuOTQ0NiwgMSwgMSwgMC44OTcxMywgMS4xMDIwOCwgMC45MDA4OCwgMC45MDA4OCwgMC45MDA4OCwgMC45MDA4OCwgMC45MDA4OCwgMC45MDA4OCwgMC45MDA4OCwgMC45MDA4OCwgMC45MDA4OCwgMC45MDk4OSwgMC45MzU4LCAwLjkxOTQ1LCAwLjgzMTgxLCAwLjc1MjYxLCAwLjg3OTkyLCAwLjgyOTc2LCAwLjk2MDM0LCAwLjgzNjg5LCAwLjk3MjY4LCAxLjAwNzgsIDAuOTA4MzgsIDAuODM2MzcsIDAuODAxOSwgMC45MDE1NywgMC44MDA2MSwgMC45NDQ2LCAwLjk1NDA3LCAwLjkyNDM2LCAxLjAyNTgsIDAuODUwMjIsIDAuOTcxNTMsIDEuMDE1NiwgMC45NTU0NiwgMC44OTE5MiwgMC45MjE3OSwgMC45MjM2MSwgMC44NzEwNywgMC45NjMxOCwgMC44OTcxMywgMC45MzcwNCwgMC45NTYzOCwgMC45MTkwNSwgMC45MTcwOSwgMC45Mjc5NiwgMS4wMjU4LCAwLjkzNzA0LCAwLjk0ODM2LCAxLjAzNzMsIDAuOTU5MzMsIDEuMDA3OCwgMC45NTg3MSwgMC45NDgzNiwgMC45NjE3NCwgMC45MjYwMSwgMC45NDk4LCAwLjk4NjA3LCAwLjk1Nzc2LCAwLjk1OTMzLCAxLjA1NDUzLCAxLjAwNzgsIDAuOTgyNzUsIDAuOTMxNCwgMC45NTYxNywgMC45MTcwMSwgMS4wNTk5MywgMC45NDQ2LCAwLjc4MzY3LCAwLjk1NTMsIDEsIDAuODY4MzIsIDEuMDEyOCwgMC45NTg3MSwgMC45OTM5NCwgMC44NzU0OCwgMC45NjM2MSwgMC44Njc3NCwgMS4wMDc4LCAwLjk1ODcxLCAwLjk0NDYsIDAuOTU4NzEsIDAuODY3NzQsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDAuOTQwODMsIDAuOTc1NzksIDAuOTQwODMsIDAuOTc1NzksIDAuOTQwODMsIDAuOTc1NzksIDAuOTA0MDYsIDAuOTQwMzksIDAuOTY2OTQsIDEsIDAuODk5MDMsIDEsIDEsIDEsIDAuOTM1ODIsIDAuOTM1ODIsIDAuOTM1ODIsIDEsIDAuOTA4LCAwLjkwOCwgMC45MTgsIDAuOTQyMTksIDAuOTQyMTksIDAuOTY1NDQsIDEsIDEuMjg1LCAxLCAxLCAwLjgxMDc5LCAwLjgxMDc5LCAxLCAxLCAwLjc0ODU0LCAxLCAxLCAxLCAxLCAwLjk5NzkzLCAxLCAxLCAxLCAwLjY1LCAxLCAxLjM2MTQ1LCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLjE3MTczLCAxLCAwLjgwNTM1LCAwLjc2MTY5LCAxLjAyMDU4LCAxLjA3MzIsIDEuMDU0ODYsIDEsIDEsIDEuMzA2OTIsIDEuMDg1OTUsIDEuMDg1OTUsIDEsIDEuMDg1OTUsIDEuMDg1OTUsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEuMTYxNjEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDFdOwpleHBvcnRzLk15cmlhZFByb0JvbGRGYWN0b3JzID0gTXlyaWFkUHJvQm9sZEZhY3RvcnM7CmNvbnN0IE15cmlhZFByb0JvbGRNZXRyaWNzID0gewogIGxpbmVIZWlnaHQ6IDEuMiwKICBsaW5lR2FwOiAwLjIKfTsKZXhwb3J0cy5NeXJpYWRQcm9Cb2xkTWV0cmljcyA9IE15cmlhZFByb0JvbGRNZXRyaWNzOwpjb25zdCBNeXJpYWRQcm9Cb2xkSXRhbGljRmFjdG9ycyA9IFsxLjM2ODk4LCAxLCAxLCAwLjY2MjI3LCAwLjgwNzc5LCAwLjgxNjI1LCAwLjk3Mjc2LCAwLjk3Mjc2LCAwLjk3NzMzLCAwLjkyMjIyLCAwLjgzMjY2LCAwLjk0MjkyLCAwLjk0MjkyLCAxLjE2MTQ4LCAxLjAyMDU4LCAwLjkzNTgyLCAwLjk2Njk0LCAwLjkzNTgyLCAxLjE3MzM3LCAwLjk3Mjc2LCAwLjk3Mjc2LCAwLjk3Mjc2LCAwLjk3Mjc2LCAwLjk3Mjc2LCAwLjk3Mjc2LCAwLjk3Mjc2LCAwLjk3Mjc2LCAwLjk3Mjc2LCAwLjk3Mjc2LCAwLjc4MDc2LCAwLjc4MDc2LCAxLjAyMDU4LCAxLjAyMDU4LCAxLjAyMDU4LCAwLjcxNTQxLCAwLjc2ODEzLCAwLjg1NTc2LCAwLjgwNTkxLCAwLjgwNzI5LCAwLjk0Mjk5LCAwLjc3NTEyLCAwLjgzNjU1LCAwLjg2NTIzLCAwLjkyMjIyLCAwLjk4NjIxLCAwLjcxNzQzLCAwLjgxNjk4LCAwLjc5NzI2LCAwLjk4NTU4LCAwLjkyMjIyLCAwLjkwNjM3LCAwLjgzODA5LCAwLjkwNjM3LCAwLjgwNzI5LCAwLjc2NDYzLCAwLjg2Mjc1LCAwLjkwNjk5LCAwLjkxNjA1LCAwLjkxNTQsIDAuODUzMDgsIDAuODU0NTgsIDAuOTA1MzEsIDAuOTQyOTIsIDEuMjEyOTYsIDAuOTQyOTIsIDEuMDIwNTgsIDAuODk5MDMsIDEuMTg2MTYsIDAuOTk2MTMsIDAuOTE2NzcsIDAuNzgyMTYsIDAuOTE2NzcsIDAuOTAwODMsIDAuOTg3OTYsIDAuOTEzNSwgMC45MjE2OCwgMC45NTM4MSwgMC45ODk4MSwgMC45NTI5OCwgMC45NTM4MSwgMC45MzQ1OSwgMC45MjE2OCwgMC45MTUxMywgMC45MjAwNCwgMC45MTY3NywgMC45NTA3NywgMC43NDgsIDEuMDQ1MDIsIDAuOTE2NzcsIDAuOTIwNjEsIDAuOTQyMzYsIDAuODk1NDQsIDAuODkzNjQsIDAuOSwgMC44MDY4NywgMC44NTc4LCAwLjgwNjg3LCAxLjAyMDU4LCAwLjgwNzc5LCAwLjk3Mjc2LCAwLjk3Mjc2LCAwLjk3Mjc2LCAwLjk3Mjc2LCAwLjg1NzgsIDAuOTk5NzMsIDEuMTg2MTYsIDAuOTEzMzksIDEuMDgwNzQsIDAuODI4OTEsIDEuMDIwNTgsIDAuNTU1MDksIDAuNzE1MjYsIDAuODkwMjIsIDEuMDg1OTUsIDEsIDEsIDEuMTg2MTYsIDEsIDAuOTY3MzYsIDAuOTM1ODIsIDEuMTg2MTYsIDEsIDEuMDQ4NjQsIDAuODI3MTEsIDAuOTkwNDMsIDAuOTkwNDMsIDAuOTkwNDMsIDAuNzE1NDEsIDAuODU1NzYsIDAuODU1NzYsIDAuODU1NzYsIDAuODU1NzYsIDAuODU1NzYsIDAuODU1NzYsIDAuODQ1LCAwLjgwNzI5LCAwLjc3NTEyLCAwLjc3NTEyLCAwLjc3NTEyLCAwLjc3NTEyLCAwLjk4NjIxLCAwLjk4NjIxLCAwLjk4NjIxLCAwLjk4NjIxLCAwLjk1OTYxLCAwLjkyMjIyLCAwLjkwNjM3LCAwLjkwNjM3LCAwLjkwNjM3LCAwLjkwNjM3LCAwLjkwNjM3LCAxLjAyMDU4LCAwLjkwMjUxLCAwLjkwNjk5LCAwLjkwNjk5LCAwLjkwNjk5LCAwLjkwNjk5LCAwLjg1NDU4LCAwLjgzNjU5LCAwLjk0OTUxLCAwLjk5NjEzLCAwLjk5NjEzLCAwLjk5NjEzLCAwLjk5NjEzLCAwLjk5NjEzLCAwLjk5NjEzLCAwLjg1ODExLCAwLjc4MjE2LCAwLjkwMDgzLCAwLjkwMDgzLCAwLjkwMDgzLCAwLjkwMDgzLCAwLjk1MzgxLCAwLjk1MzgxLCAwLjk1MzgxLCAwLjk1MzgxLCAwLjkxMzUsIDAuOTIxNjgsIDAuOTE1MTMsIDAuOTE1MTMsIDAuOTE1MTMsIDAuOTE1MTMsIDAuOTE1MTMsIDEuMDg1OTUsIDAuOTE2NzcsIDAuOTE2NzcsIDAuOTE2NzcsIDAuOTE2NzcsIDAuOTE2NzcsIDAuODkzNjQsIDAuOTIzMzIsIDAuODkzNjQsIDAuODU1NzYsIDAuOTk2MTMsIDAuODU1NzYsIDAuOTk2MTMsIDAuODU1NzYsIDAuOTk2MTMsIDAuODA3MjksIDAuNzgyMTYsIDAuODA3MjksIDAuNzgyMTYsIDAuODA3MjksIDAuNzgyMTYsIDAuODA3MjksIDAuNzgyMTYsIDAuOTQyOTksIDAuNzY3ODMsIDAuOTU5NjEsIDAuOTE2NzcsIDAuNzc1MTIsIDAuOTAwODMsIDAuNzc1MTIsIDAuOTAwODMsIDAuNzc1MTIsIDAuOTAwODMsIDAuNzc1MTIsIDAuOTAwODMsIDAuNzc1MTIsIDAuOTAwODMsIDAuODY1MjMsIDAuOTEzNSwgMC44NjUyMywgMC45MTM1LCAwLjg2NTIzLCAwLjkxMzUsIDEsIDEsIDAuOTIyMjIsIDAuOTIxNjgsIDAuOTIyMjIsIDAuOTIxNjgsIDAuOTg2MjEsIDAuOTUzODEsIDAuOTg2MjEsIDAuOTUzODEsIDAuOTg2MjEsIDAuOTUzODEsIDAuOTg2MjEsIDAuOTUzODEsIDAuOTg2MjEsIDAuOTUzODEsIDAuODYwMzYsIDAuOTcwOTYsIDAuNzE3NDMsIDAuOTg5ODEsIDEsIDEsIDAuOTUyOTgsIDAuNzk3MjYsIDAuOTUzODEsIDEsIDEsIDAuNzk3MjYsIDAuNjg5NCwgMC43OTcyNiwgMC43NDMyMSwgMC44MTY5MSwgMS4wMDA2LCAwLjkyMjIyLCAwLjkyMTY4LCAxLCAxLCAwLjkyMjIyLCAwLjkyMTY4LCAwLjc5NDY0LCAwLjkyMDk4LCAwLjkyMTY4LCAwLjkwNjM3LCAwLjkxNTEzLCAwLjkwNjM3LCAwLjkxNTEzLCAwLjkwNjM3LCAwLjkxNTEzLCAwLjkwOSwgMC44NzUxNCwgMC44MDcyOSwgMC45NTA3NywgMSwgMSwgMC44MDcyOSwgMC45NTA3NywgMC43NjQ2MywgMC43NDgsIDAuNzY0NjMsIDAuNzQ4LCAxLCAxLCAwLjc2NDYzLCAwLjc0OCwgMSwgMSwgMC44NjI3NSwgMC43MjY1MSwgMC44NjI3NSwgMS4wNDUwMiwgMC45MDY5OSwgMC45MTY3NywgMC45MDY5OSwgMC45MTY3NywgMC45MDY5OSwgMC45MTY3NywgMC45MDY5OSwgMC45MTY3NywgMC45MDY5OSwgMC45MTY3NywgMC45MDY5OSwgMC45MTY3NywgMC45MTU0LCAwLjk0MjM2LCAwLjg1NDU4LCAwLjg5MzY0LCAwLjg1NDU4LCAwLjkwNTMxLCAwLjksIDAuOTA1MzEsIDAuOSwgMC45MDUzMSwgMC45LCAxLCAwLjk3Mjc2LCAwLjg1NTc2LCAwLjk5NjEzLCAwLjg0NSwgMC44NTgxMSwgMC45MDI1MSwgMC45MTY3NywgMSwgMSwgMC44NjI3NSwgMS4wNDUwMiwgMS4xODYxNiwgMS4xODYxNiwgMS4xODYxNiwgMS4xODYxNiwgMS4xODYxNiwgMS4xODYxNiwgMS4xODYxNiwgMS4xODYxNiwgMS4xODYxNiwgMS4wMDg5OSwgMS4zMDYyOCwgMC44NTU3NiwgMC44MDE3OCwgMC42Njg2MiwgMC43OTI3LCAwLjY5MzIzLCAwLjg4MTI3LCAwLjcyNDU5LCAwLjg5NzExLCAwLjk1MzgxLCAwLjg1NTc2LCAwLjgwNTkxLCAwLjc4MDUsIDAuOTQ3MjksIDAuNzc1MTIsIDAuOTA1MzEsIDAuOTIyMjIsIDAuOTA2MzcsIDAuOTg2MjEsIDAuODE2OTgsIDAuOTI2NTUsIDAuOTg1NTgsIDAuOTIyMjIsIDAuODUzNTksIDAuOTA2MzcsIDAuOTA5NzYsIDAuODM4MDksIDAuOTQ1MjMsIDAuODYyNzUsIDAuODM1MDksIDAuOTMxNTcsIDAuODUzMDgsIDAuODMzOTIsIDAuOTIzNDYsIDAuOTg2MjEsIDAuODM1MDksIDAuOTI4ODYsIDAuOTEzMjQsIDAuOTIxNjgsIDAuOTUzODEsIDAuOTA2NDYsIDAuOTI4ODYsIDAuOTA1NTcsIDAuODY4NDcsIDAuOTAyNzYsIDAuOTEzMjQsIDAuODY4NDIsIDAuOTIxNjgsIDAuOTk1MzEsIDAuOTUzODEsIDAuOTIyNCwgMC44NTQwOCwgMC45MjY5OSwgMC44Njg0NywgMS4wMDUxLCAwLjkxNTEzLCAwLjgwNDg3LCAwLjkzNDgxLCAxLCAwLjg4MTU5LCAxLjA1MjE0LCAwLjkwNjQ2LCAwLjk3MzU1LCAwLjgxNTM5LCAwLjg5Mzk4LCAwLjg1OTIzLCAwLjk1MzgxLCAwLjkwNjQ2LCAwLjkxNTEzLCAwLjkwNjQ2LCAwLjg1OTIzLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAwLjkxNTQsIDAuOTQyMzYsIDAuOTE1NCwgMC45NDIzNiwgMC45MTU0LCAwLjk0MjM2LCAwLjg1NDU4LCAwLjg5MzY0LCAwLjk2Njk0LCAxLCAwLjg5OTAzLCAxLCAxLCAxLCAwLjkxNzgyLCAwLjkxNzgyLCAwLjkxNzgyLCAxLCAwLjg5NiwgMC44OTYsIDAuODk2LCAwLjkzMzIsIDAuOTMzMiwgMC45NTk3MywgMSwgMS4yNiwgMSwgMSwgMC44MDQ3OSwgMC44MDE3OCwgMSwgMSwgMC44NTYzMywgMSwgMSwgMSwgMSwgMC45NzI3NiwgMSwgMSwgMSwgMC42OTgsIDEsIDEuMzYxNDUsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEuMTQ1NDIsIDEsIDAuNzkxOTksIDAuNzg2OTQsIDEuMDIwNTgsIDEuMDM0OTMsIDEuMDU0ODYsIDEsIDEsIDEuMjMwMjYsIDEuMDg1OTUsIDEuMDg1OTUsIDEsIDEuMDg1OTUsIDEuMDg1OTUsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEuMjAwMDYsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDFdOwpleHBvcnRzLk15cmlhZFByb0JvbGRJdGFsaWNGYWN0b3JzID0gTXlyaWFkUHJvQm9sZEl0YWxpY0ZhY3RvcnM7CmNvbnN0IE15cmlhZFByb0JvbGRJdGFsaWNNZXRyaWNzID0gewogIGxpbmVIZWlnaHQ6IDEuMiwKICBsaW5lR2FwOiAwLjIKfTsKZXhwb3J0cy5NeXJpYWRQcm9Cb2xkSXRhbGljTWV0cmljcyA9IE15cmlhZFByb0JvbGRJdGFsaWNNZXRyaWNzOwpjb25zdCBNeXJpYWRQcm9JdGFsaWNGYWN0b3JzID0gWzEuMzY4OTgsIDEsIDEsIDAuNjU1MDcsIDAuODQ5NDMsIDAuODU2MzksIDAuODg0NjUsIDAuODg0NjUsIDAuODY5MzYsIDAuODgzMDcsIDAuODY5NDgsIDAuODUyODMsIDAuODUyODMsIDEuMDYzODMsIDEuMDIwNTgsIDAuNzU5NDUsIDAuOTIxOSwgMC43NTk0NSwgMS4xNzMzNywgMC44ODQ2NSwgMC44ODQ2NSwgMC44ODQ2NSwgMC44ODQ2NSwgMC44ODQ2NSwgMC44ODQ2NSwgMC44ODQ2NSwgMC44ODQ2NSwgMC44ODQ2NSwgMC44ODQ2NSwgMC43NTk0NSwgMC43NTk0NSwgMS4wMjA1OCwgMS4wMjA1OCwgMS4wMjA1OCwgMC42OTA0NiwgMC43MDkyNiwgMC44NTE1OCwgMC43NzgxMiwgMC43Njg1MiwgMC44OTU5MSwgMC43MDQ2NiwgMC43NjEyNSwgMC44MDA5NCwgMC44NjgyMiwgMC44Mzg2NCwgMC43MjgsIDAuNzcyMTIsIDAuNzk0NzUsIDAuOTM2MzcsIDAuODc1MTQsIDAuODU4OCwgMC43NjAxMywgMC44NTg4LCAwLjcyNDIxLCAwLjY5ODY2LCAwLjc3NTk4LCAwLjg1OTkxLCAwLjgwODExLCAwLjg3ODMyLCAwLjc4MTEyLCAwLjc3NTEyLCAwLjg1NjIsIDEuMDIyMiwgMS4xODQxNywgMS4wMjIyLCAxLjI3MDE0LCAwLjg5OTAzLCAxLjE1MDEyLCAwLjkzODU5LCAwLjk0Mzk5LCAwLjg0NiwgMC45NDM5OSwgMC44MTQ1MywgMS4wMTg2LCAwLjk0MjE5LCAwLjk2MDE3LCAxLjAzMDc1LCAxLjAyMTc1LCAwLjkxMiwgMS4wMzA3NSwgMC45Njk5OCwgMC45NjAxNywgMC45Mzg1OSwgMC45NDM5OSwgMC45NDM5OSwgMC45NTQ5MywgMC43NDYsIDEuMTI2NTgsIDAuOTQ1NzgsIDAuOTEsIDAuOTc5LCAwLjg4MiwgMC44ODIsIDAuODMsIDAuODUwMzQsIDAuODM1MzcsIDAuODUwMzQsIDEuMDIwNTgsIDAuNzA4NjksIDAuODg0NjUsIDAuODg0NjUsIDAuODg0NjUsIDAuODg0NjUsIDAuODM1MzcsIDAuOTAwODMsIDEuMTUwMTIsIDAuOTE2MSwgMC45NDU2NSwgMC43MzU0MSwgMS4wMjA1OCwgMC41MzYwOSwgMC42OTM1MywgMC43OTUxOSwgMS4wODU5NSwgMSwgMSwgMS4xNTAxMiwgMSwgMC45MTk3NCwgMC43NTk0NSwgMS4xNTAxMiwgMSwgMC45NDQ2LCAwLjczMzYxLCAwLjkwMDUsIDAuOTAwNSwgMC45MDA1LCAwLjYyODY0LCAwLjg1MTU4LCAwLjg1MTU4LCAwLjg1MTU4LCAwLjg1MTU4LCAwLjg1MTU4LCAwLjg1MTU4LCAwLjc3MywgMC43Njg1MiwgMC43MDQ2NiwgMC43MDQ2NiwgMC43MDQ2NiwgMC43MDQ2NiwgMC44Mzg2NCwgMC44Mzg2NCwgMC44Mzg2NCwgMC44Mzg2NCwgMC45MDU2MSwgMC44NzUxNCwgMC44NTg4LCAwLjg1ODgsIDAuODU4OCwgMC44NTg4LCAwLjg1ODgsIDEuMDIwNTgsIDAuODU3NTEsIDAuODU5OTEsIDAuODU5OTEsIDAuODU5OTEsIDAuODU5OTEsIDAuNzc1MTIsIDAuNzYwMTMsIDAuODgwNzUsIDAuOTM4NTksIDAuOTM4NTksIDAuOTM4NTksIDAuOTM4NTksIDAuOTM4NTksIDAuOTM4NTksIDAuODA3NSwgMC44NDYsIDAuODE0NTMsIDAuODE0NTMsIDAuODE0NTMsIDAuODE0NTMsIDAuODI0MjQsIDAuODI0MjQsIDAuODI0MjQsIDAuODI0MjQsIDAuOTI3OCwgMC45NjAxNywgMC45Mzg1OSwgMC45Mzg1OSwgMC45Mzg1OSwgMC45Mzg1OSwgMC45Mzg1OSwgMS4wODU5NSwgMC44NTYyLCAwLjk0NTc4LCAwLjk0NTc4LCAwLjk0NTc4LCAwLjk0NTc4LCAwLjg4MiwgMC45NDU3OCwgMC44ODIsIDAuODUxNTgsIDAuOTM4NTksIDAuODUxNTgsIDAuOTM4NTksIDAuODUxNTgsIDAuOTM4NTksIDAuNzY4NTIsIDAuODQ2LCAwLjc2ODUyLCAwLjg0NiwgMC43Njg1MiwgMC44NDYsIDAuNzY4NTIsIDAuODQ2LCAwLjg5NTkxLCAwLjg1NDQsIDAuOTA1NjEsIDAuOTQzOTksIDAuNzA0NjYsIDAuODE0NTMsIDAuNzA0NjYsIDAuODE0NTMsIDAuNzA0NjYsIDAuODE0NTMsIDAuNzA0NjYsIDAuODE0NTMsIDAuNzA0NjYsIDAuODE0NTMsIDAuODAwOTQsIDAuOTQyMTksIDAuODAwOTQsIDAuOTQyMTksIDAuODAwOTQsIDAuOTQyMTksIDEsIDEsIDAuODY4MjIsIDAuOTYwMTcsIDAuODY4MjIsIDAuOTYwMTcsIDAuODM4NjQsIDAuODI0MjQsIDAuODM4NjQsIDAuODI0MjQsIDAuODM4NjQsIDAuODI0MjQsIDAuODM4NjQsIDEuMDMwNzUsIDAuODM4NjQsIDAuODI0MjQsIDAuODE0MDIsIDEuMDI3MzgsIDAuNzI4LCAxLjAyMTc1LCAxLCAxLCAwLjkxMiwgMC43OTQ3NSwgMS4wMzA3NSwgMSwgMSwgMC43OTQ3NSwgMC44MzkxMSwgMC43OTQ3NSwgMC42NjI2NiwgMC44MDU1MywgMS4wNjY3NiwgMC44NzUxNCwgMC45NjAxNywgMSwgMSwgMC44NzUxNCwgMC45NjAxNywgMC44Njg2NSwgMC44NzM5NiwgMC45NjAxNywgMC44NTg4LCAwLjkzODU5LCAwLjg1ODgsIDAuOTM4NTksIDAuODU4OCwgMC45Mzg1OSwgMC44NjcsIDAuODQ3NTksIDAuNzI0MjEsIDAuOTU0OTMsIDEsIDEsIDAuNzI0MjEsIDAuOTU0OTMsIDAuNjk4NjYsIDAuNzQ2LCAwLjY5ODY2LCAwLjc0NiwgMSwgMSwgMC42OTg2NiwgMC43NDYsIDEsIDEsIDAuNzc1OTgsIDAuODg0MTcsIDAuNzc1OTgsIDEuMTI2NTgsIDAuODU5OTEsIDAuOTQ1NzgsIDAuODU5OTEsIDAuOTQ1NzgsIDAuODU5OTEsIDAuOTQ1NzgsIDAuODU5OTEsIDAuOTQ1NzgsIDAuODU5OTEsIDAuOTQ1NzgsIDAuODU5OTEsIDAuOTQ1NzgsIDAuODc4MzIsIDAuOTc5LCAwLjc3NTEyLCAwLjg4MiwgMC43NzUxMiwgMC44NTYyLCAwLjgzLCAwLjg1NjIsIDAuODMsIDAuODU2MiwgMC44MywgMSwgMC44ODQ2NSwgMC44NTE1OCwgMC45Mzg1OSwgMC43NzMsIDAuODA3NSwgMC44NTc1MSwgMC44NTYyLCAxLCAxLCAwLjc3NTk4LCAxLjEyNjU4LCAxLjE1MDEyLCAxLjE1MDEyLCAxLjE1MDEyLCAxLjE1MDEyLCAxLjE1MDEyLCAxLjE1MzEzLCAxLjE1MDEyLCAxLjE1MDEyLCAxLjE1MDEyLCAxLjA4MTA2LCAxLjAzOTAxLCAwLjg1MTU4LCAwLjc3MDI1LCAwLjYyMjY0LCAwLjc2NDYsIDAuNjUzNTEsIDAuODYwMjYsIDAuNjk0NjEsIDAuODk5NDcsIDEuMDMwNzUsIDAuODUxNTgsIDAuNzc4MTIsIDAuNzY0NDksIDAuODg4MzYsIDAuNzA0NjYsIDAuODU2MiwgMC44NjgyMiwgMC44NTg4LCAwLjgzODY0LCAwLjc3MjEyLCAwLjg1MzA4LCAwLjkzNjM3LCAwLjg3NTE0LCAwLjgyMzUyLCAwLjg1ODgsIDAuODU3MDEsIDAuNzYwMTMsIDAuODkwNTgsIDAuNzc1OTgsIDAuODE1NiwgMC44MjU2NSwgMC43ODExMiwgMC43Nzg5OSwgMC44OTM4NiwgMC44Mzg2NCwgMC44MTU2LCAwLjk0ODYsIDAuOTIzODgsIDAuOTYxODYsIDEuMDMwNzUsIDAuOTExMjMsIDAuOTQ4NiwgMC45MzI5OCwgMC44NzgsIDAuOTM5NDIsIDAuOTIzODgsIDAuODQ1OTYsIDAuOTYxODYsIDAuOTUxMTksIDEuMDMwNzUsIDAuOTIyLCAwLjg4Nzg3LCAwLjk1ODI5LCAwLjg4LCAwLjkzNTU5LCAwLjkzODU5LCAwLjc4ODE1LCAwLjkzNzU4LCAxLCAwLjg5MjE3LCAxLjAzNzM3LCAwLjkxMTIzLCAwLjkzOTY5LCAwLjc3NDg3LCAwLjg1NzY5LCAwLjg2Nzk5LCAxLjAzMDc1LCAwLjkxMTIzLCAwLjkzODU5LCAwLjkxMTIzLCAwLjg2Nzk5LCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAwLjg3ODMyLCAwLjk3OSwgMC44NzgzMiwgMC45NzksIDAuODc4MzIsIDAuOTc5LCAwLjc3NTEyLCAwLjg4MiwgMC45MjE5LCAxLCAwLjg5OTAzLCAxLCAxLCAxLCAwLjg3MzIxLCAwLjg3MzIxLCAwLjg3MzIxLCAxLCAxLjAyNywgMS4wMjcsIDEuMDI3LCAwLjg2ODQ3LCAwLjg2ODQ3LCAwLjc5MTIxLCAxLCAxLjEyNCwgMSwgMSwgMC43MzU3MiwgMC43MzU3MiwgMSwgMSwgMC44NTAzNCwgMSwgMSwgMSwgMSwgMC44ODQ2NSwgMSwgMSwgMSwgMC42NjksIDEsIDEuMzYxNDUsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEuMDQ4MjgsIDEsIDAuNzQ5NDgsIDAuNzUxODcsIDEuMDIwNTgsIDAuOTgzOTEsIDEuMDIxMTksIDEsIDEsIDEuMDYyMzMsIDEuMDg1OTUsIDEuMDg1OTUsIDEsIDEuMDg1OTUsIDEuMDg1OTUsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEuMDUyMzMsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDFdOwpleHBvcnRzLk15cmlhZFByb0l0YWxpY0ZhY3RvcnMgPSBNeXJpYWRQcm9JdGFsaWNGYWN0b3JzOwpjb25zdCBNeXJpYWRQcm9JdGFsaWNNZXRyaWNzID0gewogIGxpbmVIZWlnaHQ6IDEuMiwKICBsaW5lR2FwOiAwLjIKfTsKZXhwb3J0cy5NeXJpYWRQcm9JdGFsaWNNZXRyaWNzID0gTXlyaWFkUHJvSXRhbGljTWV0cmljczsKY29uc3QgTXlyaWFkUHJvUmVndWxhckZhY3RvcnMgPSBbMS4zNjg5OCwgMSwgMSwgMC43NjMwNSwgMC44Mjc4NCwgMC45NDkzNSwgMC44OTM2NCwgMC45MjI0MSwgMC44OTA3MywgMC45MDcwNiwgMC45ODQ3MiwgMC44NTI4MywgMC44NTI4MywgMS4wNjY0LCAxLjAyMDU4LCAwLjc0NTA1LCAwLjkyMTksIDAuNzQ1MDUsIDEuMjM0NTYsIDAuOTIyNDEsIDAuOTIyNDEsIDAuOTIyNDEsIDAuOTIyNDEsIDAuOTIyNDEsIDAuOTIyNDEsIDAuOTIyNDEsIDAuOTIyNDEsIDAuOTIyNDEsIDAuOTIyNDEsIDAuNzQ1MDUsIDAuNzQ1MDUsIDEuMDIwNTgsIDEuMDIwNTgsIDEuMDIwNTgsIDAuNzMwMDIsIDAuNzI2MDEsIDAuOTE3NTUsIDAuODEyNiwgMC44MDMxNCwgMC45MjIyMiwgMC43Mzc2NCwgMC43OTcyNiwgMC44MzA1MSwgMC45MDI4NCwgMC44NjAyMywgMC43NCwgMC44MTI2LCAwLjg0ODY5LCAwLjk2NTE4LCAwLjkxMTE1LCAwLjg4NTgsIDAuNzk3NjEsIDAuODg1OCwgMC43NDQ5OCwgMC43MzkxNCwgMC44MTM2MywgMC44OTU5MSwgMC44MzY1OSwgMC44OTYzMywgMC44NTYwOCwgMC44MTExLCAwLjkwNTMxLCAxLjAyMjIsIDEuMjI3MzYsIDEuMDIyMiwgMS4yNzAxNCwgMC44OTkwMywgMC45MDA4OCwgMC44NjY2NywgMS4wMjMxLCAwLjg5NiwgMS4wMTQxMSwgMC45MDA4MywgMS4wNTA5OSwgMS4wMDUxMiwgMC45OTc5MywgMS4wNTMyNiwgMS4wOTM3NywgMC45MzgsIDEuMDYyMjYsIDEuMDAxMTksIDAuOTk3OTMsIDAuOTg3MTQsIDEuMDIzMSwgMS4wMTIzMSwgMC45ODE5NiwgMC43OTIsIDEuMTkxMzcsIDAuOTkwNzQsIDAuOTYyLCAxLjAxOTE1LCAwLjkyNiwgMC45NDIsIDAuODU2LCAwLjg1MDM0LCAwLjkyMDA2LCAwLjg1MDM0LCAxLjAyMDU4LCAwLjY5MDY3LCAwLjkyMjQxLCAwLjkyMjQxLCAwLjkyMjQxLCAwLjkyMjQxLCAwLjkyMDA2LCAwLjkzMzIsIDAuOTAwODgsIDAuOTE4ODIsIDAuOTM0ODQsIDAuNzUzMzksIDEuMDIwNTgsIDAuNTY4NjYsIDAuNTQzMjQsIDAuNzk1MTksIDEuMDg1OTUsIDEsIDEsIDAuOTAwODgsIDEsIDAuOTUzMjUsIDAuNzQ1MDUsIDAuOTAwODgsIDEsIDAuOTcxOTgsIDAuNzUzMzksIDAuOTEwMDksIDAuOTEwMDksIDAuOTEwMDksIDAuNjY0NjYsIDAuOTE3NTUsIDAuOTE3NTUsIDAuOTE3NTUsIDAuOTE3NTUsIDAuOTE3NTUsIDAuOTE3NTUsIDAuNzg4LCAwLjgwMzE0LCAwLjczNzY0LCAwLjczNzY0LCAwLjczNzY0LCAwLjczNzY0LCAwLjg2MDIzLCAwLjg2MDIzLCAwLjg2MDIzLCAwLjg2MDIzLCAwLjkyOTE1LCAwLjkxMTE1LCAwLjg4NTgsIDAuODg1OCwgMC44ODU4LCAwLjg4NTgsIDAuODg1OCwgMS4wMjA1OCwgMC44ODU4LCAwLjg5NTkxLCAwLjg5NTkxLCAwLjg5NTkxLCAwLjg5NTkxLCAwLjgxMTEsIDAuNzk2MTEsIDAuODk3MTMsIDAuODY2NjcsIDAuODY2NjcsIDAuODY2NjcsIDAuODY2NjcsIDAuODY2NjcsIDAuODY2NjcsIDAuODY5MzYsIDAuODk2LCAwLjkwMDgzLCAwLjkwMDgzLCAwLjkwMDgzLCAwLjkwMDgzLCAwLjg0MjI0LCAwLjg0MjI0LCAwLjg0MjI0LCAwLjg0MjI0LCAwLjk3Mjc2LCAwLjk5NzkzLCAwLjk4NzE0LCAwLjk4NzE0LCAwLjk4NzE0LCAwLjk4NzE0LCAwLjk4NzE0LCAxLjA4NTk1LCAwLjg5ODc2LCAwLjk5MDc0LCAwLjk5MDc0LCAwLjk5MDc0LCAwLjk5MDc0LCAwLjk0MiwgMS4wMjMxLCAwLjk0MiwgMC45MTc1NSwgMC44NjY2NywgMC45MTc1NSwgMC44NjY2NywgMC45MTc1NSwgMC44NjY2NywgMC44MDMxNCwgMC44OTYsIDAuODAzMTQsIDAuODk2LCAwLjgwMzE0LCAwLjg5NiwgMC44MDMxNCwgMC44OTYsIDAuOTIyMjIsIDAuOTMzNzIsIDAuOTI5MTUsIDEuMDE0MTEsIDAuNzM3NjQsIDAuOTAwODMsIDAuNzM3NjQsIDAuOTAwODMsIDAuNzM3NjQsIDAuOTAwODMsIDAuNzM3NjQsIDAuOTAwODMsIDAuNzM3NjQsIDAuOTAwODMsIDAuODMwNTEsIDEuMDA1MTIsIDAuODMwNTEsIDEuMDA1MTIsIDAuODMwNTEsIDEuMDA1MTIsIDEsIDEsIDAuOTAyODQsIDAuOTk3OTMsIDAuOTA5NzYsIDAuOTk3OTMsIDAuODYwMjMsIDAuODQyMjQsIDAuODYwMjMsIDAuODQyMjQsIDAuODYwMjMsIDAuODQyMjQsIDAuODYwMjMsIDEuMDUzMjYsIDAuODYwMjMsIDAuODQyMjQsIDAuODI4NzMsIDEuMDc0NjksIDAuNzQsIDEuMDkzNzcsIDEsIDEsIDAuOTM4LCAwLjg0ODY5LCAxLjA2MjI2LCAxLCAxLCAwLjg0ODY5LCAwLjgzNzA0LCAwLjg0ODY5LCAwLjgxNDQxLCAwLjg1NTg4LCAxLjA4OTI3LCAwLjkxMTE1LCAwLjk5NzkzLCAxLCAxLCAwLjkxMTE1LCAwLjk5NzkzLCAwLjkxODg3LCAwLjkwOTkxLCAwLjk5NzkzLCAwLjg4NTgsIDAuOTg3MTQsIDAuODg1OCwgMC45ODcxNCwgMC44ODU4LCAwLjk4NzE0LCAwLjg5NCwgMC45MTQzNCwgMC43NDQ5OCwgMC45ODE5NiwgMSwgMSwgMC43NDQ5OCwgMC45ODE5NiwgMC43MzkxNCwgMC43OTIsIDAuNzM5MTQsIDAuNzkyLCAxLCAxLCAwLjczOTE0LCAwLjc5MiwgMSwgMSwgMC44MTM2MywgMC45MDQsIDAuODEzNjMsIDEuMTkxMzcsIDAuODk1OTEsIDAuOTkwNzQsIDAuODk1OTEsIDAuOTkwNzQsIDAuODk1OTEsIDAuOTkwNzQsIDAuODk1OTEsIDAuOTkwNzQsIDAuODk1OTEsIDAuOTkwNzQsIDAuODk1OTEsIDAuOTkwNzQsIDAuODk2MzMsIDEuMDE5MTUsIDAuODExMSwgMC45NDIsIDAuODExMSwgMC45MDUzMSwgMC44NTYsIDAuOTA1MzEsIDAuODU2LCAwLjkwNTMxLCAwLjg1NiwgMSwgMC45MjI0MSwgMC45MTc1NSwgMC44NjY2NywgMC43ODgsIDAuODY5MzYsIDAuODg1OCwgMC44OTg3NiwgMSwgMSwgMC44MTM2MywgMS4xOTEzNywgMC45MDA4OCwgMC45MDA4OCwgMC45MDA4OCwgMC45MDA4OCwgMC45MDA4OCwgMC45MDA4OCwgMC45MDA4OCwgMC45MDA4OCwgMC45MDA4OCwgMC45MDM4OCwgMS4wMzkwMSwgMC45MjEzOCwgMC43ODEwNSwgMC43MTU0LCAwLjg2MTY5LCAwLjgwNTEzLCAwLjk0MDA3LCAwLjgyNTI4LCAwLjk4NjEyLCAxLjA2MjI2LCAwLjkxNzU1LCAwLjgxMjYsIDAuODE4ODQsIDAuOTI4MTksIDAuNzM3NjQsIDAuOTA1MzEsIDAuOTAyODQsIDAuODg1OCwgMC44NjAyMywgMC44MTI2LCAwLjkxMTcyLCAwLjk2NTE4LCAwLjkxMTE1LCAwLjgzMDg5LCAwLjg4NTgsIDAuODc3OTEsIDAuNzk3NjEsIDAuODkyOTcsIDAuODEzNjMsIDAuODgxNTcsIDAuODk5OTIsIDAuODU2MDgsIDAuODE5OTIsIDAuOTQzMDcsIDAuODYwMjMsIDAuODgxNTcsIDAuOTUzMDgsIDAuOTg2OTksIDAuOTk3OTMsIDEuMDYyMjYsIDAuOTU4MTcsIDAuOTUzMDgsIDAuOTczNTgsIDAuOTI4LCAwLjk4MDg4LCAwLjk4Njk5LCAwLjkyNzYxLCAwLjk5NzkzLCAwLjk2MDE3LCAxLjA2MjI2LCAwLjk4NiwgMC45NDQsIDAuOTU5NzgsIDAuOTM4LCAwLjk2NzA1LCAwLjk4NzE0LCAwLjgwNDQyLCAwLjk4OTcyLCAxLCAwLjg5NzYyLCAxLjA0NTUyLCAwLjk1ODE3LCAwLjk5MDA3LCAwLjg3MDY0LCAwLjkxODc5LCAwLjg4ODg4LCAxLjA2MjI2LCAwLjk1ODE3LCAwLjk4NzE0LCAwLjk1ODE3LCAwLjg4ODg4LCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAwLjg5NjMzLCAxLjAxOTE1LCAwLjg5NjMzLCAxLjAxOTE1LCAwLjg5NjMzLCAxLjAxOTE1LCAwLjgxMTEsIDAuOTQyLCAwLjkyMTksIDEsIDAuODk5MDMsIDEsIDEsIDEsIDAuOTMxNzMsIDAuOTMxNzMsIDAuOTMxNzMsIDEsIDEuMDYzMDQsIDEuMDYzMDQsIDEuMDY5MDQsIDAuODk5MDMsIDAuODk5MDMsIDAuODA1NDksIDEsIDEuMTU2LCAxLCAxLCAwLjc2NTc1LCAwLjc2NTc1LCAxLCAxLCAwLjcyNDU4LCAxLCAxLCAxLCAxLCAwLjkyMjQxLCAxLCAxLCAxLCAwLjYxOSwgMSwgMS4zNjE0NSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMS4wNzI1NywgMSwgMC43NDcwNSwgMC43MTExOSwgMS4wMjA1OCwgMS4wMjQsIDEuMDIxMTksIDEsIDEsIDEuMTUzNiwgMS4wODU5NSwgMS4wODU5NSwgMSwgMS4wODU5NSwgMS4wODU5NSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMS4wNTYzOCwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMV07CmV4cG9ydHMuTXlyaWFkUHJvUmVndWxhckZhY3RvcnMgPSBNeXJpYWRQcm9SZWd1bGFyRmFjdG9yczsKY29uc3QgTXlyaWFkUHJvUmVndWxhck1ldHJpY3MgPSB7CiAgbGluZUhlaWdodDogMS4yLAogIGxpbmVHYXA6IDAuMgp9OwpleHBvcnRzLk15cmlhZFByb1JlZ3VsYXJNZXRyaWNzID0gTXlyaWFkUHJvUmVndWxhck1ldHJpY3M7CgovKioqLyB9KSwKLyogNTYgKi8KLyoqKi8gKChfX3VudXNlZF93ZWJwYWNrX21vZHVsZSwgZXhwb3J0cykgPT4gewoKCgpPYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgIl9fZXNNb2R1bGUiLCAoewogIHZhbHVlOiB0cnVlCn0pKTsKZXhwb3J0cy5TZWdvZXVpUmVndWxhck1ldHJpY3MgPSBleHBvcnRzLlNlZ29ldWlSZWd1bGFyRmFjdG9ycyA9IGV4cG9ydHMuU2Vnb2V1aUl0YWxpY01ldHJpY3MgPSBleHBvcnRzLlNlZ29ldWlJdGFsaWNGYWN0b3JzID0gZXhwb3J0cy5TZWdvZXVpQm9sZE1ldHJpY3MgPSBleHBvcnRzLlNlZ29ldWlCb2xkSXRhbGljTWV0cmljcyA9IGV4cG9ydHMuU2Vnb2V1aUJvbGRJdGFsaWNGYWN0b3JzID0gZXhwb3J0cy5TZWdvZXVpQm9sZEZhY3RvcnMgPSB2b2lkIDA7CmNvbnN0IFNlZ29ldWlCb2xkRmFjdG9ycyA9IFsxLjc2NzM4LCAxLCAxLCAwLjk5Mjk3LCAwLjk4MjQsIDEuMDQwMTYsIDEuMDY0OTcsIDEuMDM0MjQsIDAuOTc1MjksIDEuMTc2NDcsIDEuMjMyMDMsIDEuMTA4NSwgMS4xMDg1LCAxLjE2OTM5LCAxLjIxMDcsIDAuOTc1NCwgMS4yMTQwOCwgMC45NzU0LCAxLjU5NTc4LCAxLjAzNDI0LCAxLjAzNDI0LCAxLjAzNDI0LCAxLjAzNDI0LCAxLjAzNDI0LCAxLjAzNDI0LCAxLjAzNDI0LCAxLjAzNDI0LCAxLjAzNDI0LCAxLjAzNDI0LCAwLjgxMzc4LCAwLjgxMzc4LCAxLjIxMDcsIDEuMjEwNywgMS4yMTA3LCAwLjcxNzAzLCAwLjk3ODQ3LCAwLjk3MzYzLCAwLjg4Nzc2LCAwLjg2NDEsIDEuMDIwOTYsIDAuNzk3OTUsIDAuODUxMzIsIDAuOTE0LCAxLjA2MDg1LCAxLjE0MDYsIDAuODAwNywgMC44OTg1OCwgMC44MzY5MywgMS4xNDg4OSwgMS4wOTM5OCwgMC45NzQ4OSwgMC45MjA5NCwgMC45NzQ4OSwgMC45MDM5OSwgMC44NDA0MSwgMC45NTkyMywgMS4wMDEzNSwgMSwgMS4wNjQ2NywgMC45ODI0MywgMC45MDk5NiwgMC45OTM2MSwgMS4xMDg1LCAxLjU2OTQyLCAxLjEwODUsIDEuMjEwNywgMC43NDYyNywgMC45NDI4MiwgMC45Njc1MiwgMS4wMTUxOSwgMC44NjMwNCwgMS4wMTM1OSwgMC45NzI3OCwgMS4xNTEwMywgMS4wMTM1OSwgMC45ODU2MSwgMS4wMjI4NSwgMS4wMjI4NSwgMS4wMDUyNywgMS4wMjI4NSwgMS4wMzAyLCAwLjk5MDQxLCAxLjAwMDgsIDEuMDE1MTksIDEuMDEzNTksIDEuMDIyNTgsIDAuNzkxMDQsIDEuMTY4NjIsIDAuOTkwNDEsIDAuOTc0NTQsIDEuMDI1MTEsIDAuOTkyOTgsIDAuOTY3NTIsIDAuOTU4MDEsIDAuOTQ4NTYsIDEuMTY1NzksIDAuOTQ4NTYsIDEuMjEwNywgMC45ODI0LCAxLjAzNDI0LCAxLjAzNDI0LCAxLCAxLjAzNDI0LCAxLjE2NTc5LCAwLjg3MjcsIDEuMzg3MSwgMS4xODYyMiwgMS4xMDgxOCwgMS4wNDQ3OCwgMS4yMTA3LCAxLjE4NjIyLCAwLjc1MTU1LCAwLjk0OTk0LCAxLjI4ODI2LCAxLjIxNDA4LCAxLjIxNDA4LCAwLjkxMDU2LCAxLCAwLjkxNTcyLCAwLjk3NTQsIDAuNjQ2NjMsIDEuMTgzMjgsIDEuMjQ4NjYsIDEuMDQ0NzgsIDEuMTQxNjksIDEuMTU3NDksIDEuMTczODksIDAuNzE3MDMsIDAuOTczNjMsIDAuOTczNjMsIDAuOTczNjMsIDAuOTczNjMsIDAuOTczNjMsIDAuOTczNjMsIDAuOTM1MDYsIDAuODY0MSwgMC43OTc5NSwgMC43OTc5NSwgMC43OTc5NSwgMC43OTc5NSwgMS4xNDA2LCAxLjE0MDYsIDEuMTQwNiwgMS4xNDA2LCAxLjAyMDk2LCAxLjA5Mzk4LCAwLjk3NDI2LCAwLjk3NDI2LCAwLjk3NDI2LCAwLjk3NDI2LCAwLjk3NDI2LCAxLjIxMDcsIDAuOTc0ODksIDEuMDAxMzUsIDEuMDAxMzUsIDEuMDAxMzUsIDEuMDAxMzUsIDAuOTA5OTYsIDAuOTIwOTQsIDEuMDI3OTgsIDAuOTY3NTIsIDAuOTY3NTIsIDAuOTY3NTIsIDAuOTY3NTIsIDAuOTY3NTIsIDAuOTY3NTIsIDAuOTMxMzYsIDAuODYzMDQsIDAuOTcyNzgsIDAuOTcyNzgsIDAuOTcyNzgsIDAuOTcyNzgsIDEuMDIyODUsIDEuMDIyODUsIDEuMDIyODUsIDEuMDIyODUsIDAuOTcxMjIsIDAuOTkwNDEsIDEsIDEsIDEsIDEsIDEsIDEuMjg4MjYsIDEuMDAwOCwgMC45OTA0MSwgMC45OTA0MSwgMC45OTA0MSwgMC45OTA0MSwgMC45Njc1MiwgMS4wMTUxOSwgMC45Njc1MiwgMC45NzM2MywgMC45Njc1MiwgMC45NzM2MywgMC45Njc1MiwgMC45NzM2MywgMC45Njc1MiwgMC44NjQxLCAwLjg2MzA0LCAwLjg2NDEsIDAuODYzMDQsIDAuODY0MSwgMC44NjMwNCwgMC44NjQxLCAwLjg2MzA0LCAxLjAyMDk2LCAxLjAzMDU3LCAxLjAyMDk2LCAxLjAzNTE3LCAwLjc5Nzk1LCAwLjk3Mjc4LCAwLjc5Nzk1LCAwLjk3Mjc4LCAwLjc5Nzk1LCAwLjk3Mjc4LCAwLjc5Nzk1LCAwLjk3Mjc4LCAwLjc5Nzk1LCAwLjk3Mjc4LCAwLjkxNCwgMS4wMTM1OSwgMC45MTQsIDEuMDEzNTksIDAuOTE0LCAxLjAxMzU5LCAxLCAxLCAxLjA2MDg1LCAwLjk4NTYxLCAxLjA2MDg1LCAxLjAwODc5LCAxLjE0MDYsIDEuMDIyODUsIDEuMTQwNiwgMS4wMjI4NSwgMS4xNDA2LCAxLjAyMjg1LCAxLjE0MDYsIDEuMDIyODUsIDEuMTQwNiwgMS4wMjI4NSwgMC45NzEzOCwgMS4wODY5MiwgMC44MDA3LCAxLjAyMjg1LCAxLCAxLCAxLjAwNTI3LCAwLjgzNjkzLCAxLjAyMjg1LCAxLCAxLCAwLjgzNjkzLCAwLjk0NTUsIDAuODM2OTMsIDAuOTA0MTgsIDAuODM2OTMsIDEuMTMwMDUsIDEuMDkzOTgsIDAuOTkwNDEsIDEsIDEsIDEuMDkzOTgsIDAuOTkwNDEsIDAuOTY2OTIsIDEuMDkyNTEsIDAuOTkwNDEsIDAuOTc0ODksIDEuMDAwOCwgMC45NzQ4OSwgMS4wMDA4LCAwLjk3NDg5LCAxLjAwMDgsIDAuOTM5OTQsIDAuOTc5MzEsIDAuOTAzOTksIDEuMDIyNTgsIDEsIDEsIDAuOTAzOTksIDEuMDIyNTgsIDAuODQwNDEsIDAuNzkxMDQsIDAuODQwNDEsIDAuNzkxMDQsIDAuODQwNDEsIDAuNzkxMDQsIDAuODQwNDEsIDAuNzkxMDQsIDEsIDEsIDAuOTU5MjMsIDEuMDcwMzQsIDAuOTU5MjMsIDEuMTY4NjIsIDEuMDAxMzUsIDAuOTkwNDEsIDEuMDAxMzUsIDAuOTkwNDEsIDEuMDAxMzUsIDAuOTkwNDEsIDEuMDAxMzUsIDAuOTkwNDEsIDEuMDAxMzUsIDAuOTkwNDEsIDEuMDAxMzUsIDAuOTkwNDEsIDEuMDY0NjcsIDEuMDI1MTEsIDAuOTA5OTYsIDAuOTY3NTIsIDAuOTA5OTYsIDAuOTkzNjEsIDAuOTU4MDEsIDAuOTkzNjEsIDAuOTU4MDEsIDAuOTkzNjEsIDAuOTU4MDEsIDEuMDc3MzMsIDEuMDM0MjQsIDAuOTczNjMsIDAuOTY3NTIsIDAuOTM1MDYsIDAuOTMxMzYsIDAuOTc0ODksIDEuMDAwOCwgMSwgMSwgMC45NTkyMywgMS4xNjg2MiwgMS4xNTEwMywgMS4xNTEwMywgMS4wMTE3MywgMS4wMzk1OSwgMC43NTk1MywgMC44MTM3OCwgMC43OTkxMiwgMS4xNTEwMywgMS4yMTk5NCwgMC45NTE2MSwgMC44NzgxNSwgMS4wMTE0OSwgMC44MTUyNSwgMC43Njc2LCAwLjk4MTY3LCAxLjAxMTM0LCAxLjAyNTQ2LCAwLjg0MDk3LCAxLjAzMDg5LCAxLjE4MTAyLCAwLjk3MzYzLCAwLjg4Nzc2LCAwLjg1MTM0LCAwLjk3ODI2LCAwLjc5Nzk1LCAwLjk5MzYxLCAxLjA2MDg1LCAwLjk3NDg5LCAxLjE0MDYsIDAuODk4NTgsIDEuMDM4OCwgMS4xNDg4OSwgMS4wOTM5OCwgMC44NjAzOSwgMC45NzQ4OSwgMS4wNTk1LCAwLjkyMDk0LCAwLjk0NzkzLCAwLjk1OTIzLCAwLjkwOTk2LCAwLjk5MzQ2LCAwLjk4MjQzLCAxLjAyMTEyLCAwLjk1NDkzLCAxLjE0MDYsIDAuOTA5OTYsIDEuMDM1NzQsIDEuMDI1OTcsIDEuMDAwOCwgMS4xODEwMiwgMS4wNjYyOCwgMS4wMzU3NCwgMS4wMTkyLCAxLjAxOTMyLCAxLjAwODg2LCAwLjk3NTMxLCAxLjAxMDYsIDEuMDAwOCwgMS4xMzE4OSwgMS4xODEwMiwgMS4wMjI3NywgMC45ODY4MywgMS4wMDE2LCAwLjk5NTYxLCAxLjA3MjM3LCAxLjAwMDgsIDAuOTA0MzQsIDAuOTk5MjEsIDAuOTM4MDMsIDAuODk2NSwgMS4yMzA4NSwgMS4wNjYyOCwgMS4wNDk4MywgMC45NjI2OCwgMS4wNDk5LCAwLjk4NDM5LCAxLjE4MTAyLCAxLjA2NjI4LCAxLjAwMDgsIDEuMDY2MjgsIDAuOTg0MzksIDAuNzk3OTUsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEuMDk0NjYsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDAuOTcyNzgsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEuMDIwNjUsIDEsIDEsIDEsIDEsIDEsIDEsIDEuMDY0NjcsIDEuMDI1MTEsIDEuMDY0NjcsIDEuMDI1MTEsIDEuMDY0NjcsIDEuMDI1MTEsIDAuOTA5OTYsIDAuOTY3NTIsIDEsIDEuMjE0MDgsIDAuODk5MDMsIDEsIDEsIDAuNzUxNTUsIDEuMDQzOTQsIDEuMDQzOTQsIDEuMDQzOTQsIDEuMDQzOTQsIDAuOTg2MzMsIDAuOTg2MzMsIDAuOTg2MzMsIDAuNzMwNDcsIDAuNzMwNDcsIDEuMjA2NDIsIDAuOTEyMTEsIDEuMjU2MzUsIDEuMjIyLCAxLjAyOTU2LCAxLjAzMzcyLCAxLjAzMzcyLCAwLjk2MDM5LCAxLjI0NjMzLCAxLCAxLjEyNDU0LCAwLjkzNTAzLCAxLjAzNDI0LCAxLjE5Njg3LCAxLjAzNDI0LCAxLCAxLCAxLCAwLjc3MSwgMSwgMSwgMS4xNTc0OSwgMS4xNTc0OSwgMS4xNTc0OSwgMS4xMDk0OCwgMC44NjI3OSwgMC45NDQzNCwgMC44NjI3OSwgMC45NDQzNCwgMC44NjE4MiwgMSwgMSwgMS4xNjg5NywgMSwgMC45NjA4NSwgMC45MDEzNywgMS4yMTA3LCAxLjE4NDE2LCAxLjEzOTczLCAwLjY5ODI1LCAwLjk3MTYsIDIuMTAzMzksIDEuMjkwMDQsIDEuMjkwMDQsIDEuMjExNzIsIDEuMjkwMDQsIDEuMjkwMDQsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEuNDI2MDMsIDEsIDAuOTk4NjIsIDAuOTk4NjIsIDEsIDAuODcwMjUsIDAuODcwMjUsIDAuODcwMjUsIDAuODcwMjUsIDEuMTg4NzQsIDEuNDI2MDMsIDEsIDEuNDI2MDMsIDEuNDI2MDMsIDAuOTk4NjIsIDEsIDEsIDEsIDEsIDEsIDEuMjg4NiwgMS4wNDMxNSwgMS4xNTI5NiwgMS4zNDE2MywgMSwgMSwgMSwgMS4wOTE5MywgMS4wOTE5MywgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMV07CmV4cG9ydHMuU2Vnb2V1aUJvbGRGYWN0b3JzID0gU2Vnb2V1aUJvbGRGYWN0b3JzOwpjb25zdCBTZWdvZXVpQm9sZE1ldHJpY3MgPSB7CiAgbGluZUhlaWdodDogMS4zMzAwOCwKICBsaW5lR2FwOiAwCn07CmV4cG9ydHMuU2Vnb2V1aUJvbGRNZXRyaWNzID0gU2Vnb2V1aUJvbGRNZXRyaWNzOwpjb25zdCBTZWdvZXVpQm9sZEl0YWxpY0ZhY3RvcnMgPSBbMS43NjczOCwgMSwgMSwgMC45ODk0NiwgMS4wMzk1OSwgMS4wNDAxNiwgMS4wMjgwOSwgMS4wMzYsIDAuOTc2MzksIDEuMTA5NTMsIDEuMjMyMDMsIDEuMTExNDQsIDEuMTExNDQsIDEuMTY5MzksIDEuMjEyMzcsIDAuOTc1NCwgMS4yMTI2MSwgMC45NzU0LCAxLjU5NzU0LCAxLjAzNiwgMS4wMzYsIDEuMDM2LCAxLjAzNiwgMS4wMzYsIDEuMDM2LCAxLjAzNiwgMS4wMzYsIDEuMDM2LCAxLjAzNiwgMC44MTM3OCwgMC44MTM3OCwgMS4yMTIzNywgMS4yMTIzNywgMS4yMTIzNywgMC43MzU0MSwgMC45Nzg0NywgMC45NzM2MywgMC44OTcyMywgMC44Nzg5NywgMS4wNDI2LCAwLjc5NDI5LCAwLjg1MjkyLCAwLjkxMTQ5LCAxLjA1ODE1LCAxLjE0MDYsIDAuNzk2MzEsIDAuOTAxMjgsIDAuODM4NTMsIDEuMDQzOTYsIDEuMTA2MTUsIDAuOTc1NTIsIDAuOTQ0MzYsIDAuOTc1NTIsIDAuODg2NDEsIDAuODA1MjcsIDAuOTYwODMsIDEuMDAxMzUsIDEsIDEuMDY3NzcsIDAuOTgxNywgMC45MTE0MiwgMC45OTM2MSwgMS4xMTE0NCwgMS41NzI5MywgMS4xMTE0NCwgMS4yMTIzNywgMC43NDYyNywgMS4zMTgxOCwgMS4wNjU4NSwgMC45NzA0MiwgMC44MzA1NSwgMC45NzA0MiwgMC45MzUwMywgMS4xMjYxLCAwLjk3MDQyLCAwLjk3OTIyLCAxLjE0MjM2LCAwLjk0NTUyLCAxLjAxMDU0LCAxLjE0MjM2LCAxLjAyNDcxLCAwLjk3OTIyLCAwLjk0MTY1LCAwLjk3MDQyLCAwLjk3MDQyLCAxLjAyNzYsIDAuNzg5MjksIDEuMTI2MSwgMC45NzkyMiwgMC45NTg3NCwgMS4wMjE5NywgMC45ODUwNywgMC45Njc1MiwgMC45NzE2OCwgMC45NTEwNywgMS4xNjU3OSwgMC45NTEwNywgMS4yMTIzNywgMS4wMzk1OSwgMS4wMzYsIDEuMDM2LCAxLCAxLjAzNiwgMS4xNjU3OSwgMC44NzM1NywgMS4zMTgxOCwgMS4xODc1NCwgMS4yNjc4MSwgMS4wNTM1NiwgMS4yMTIzNywgMS4xODYyMiwgMC43OTQ4NywgMC45NDk5NCwgMS4yOTAwNCwgMS4yNDA0NywgMS4yNDA0NywgMS4zMTgxOCwgMSwgMC45MTQ4NCwgMC45NzU0LCAxLjMxODE4LCAxLjEzNDksIDEuMjQ4NjYsIDEuMDUzNTYsIDEuMTM5MzQsIDEuMTU1NzQsIDEuMTczODksIDAuNzM1NDEsIDAuOTczNjMsIDAuOTczNjMsIDAuOTczNjMsIDAuOTczNjMsIDAuOTczNjMsIDAuOTczNjMsIDAuOTQzODUsIDAuODc4OTcsIDAuNzk0MjksIDAuNzk0MjksIDAuNzk0MjksIDAuNzk0MjksIDEuMTQwNiwgMS4xNDA2LCAxLjE0MDYsIDEuMTQwNiwgMS4wNDI2LCAxLjEwNjE1LCAwLjk3NTUyLCAwLjk3NTUyLCAwLjk3NTUyLCAwLjk3NTUyLCAwLjk3NTUyLCAxLjIxMjM3LCAwLjk3NTUyLCAxLjAwMTM1LCAxLjAwMTM1LCAxLjAwMTM1LCAxLjAwMTM1LCAwLjkxMTQyLCAwLjk0NDM2LCAwLjk4NzIxLCAxLjA2NTg1LCAxLjA2NTg1LCAxLjA2NTg1LCAxLjA2NTg1LCAxLjA2NTg1LCAxLjA2NTg1LCAwLjk2NzA1LCAwLjgzMDU1LCAwLjkzNTAzLCAwLjkzNTAzLCAwLjkzNTAzLCAwLjkzNTAzLCAxLjE0MjM2LCAxLjE0MjM2LCAxLjE0MjM2LCAxLjE0MjM2LCAwLjkzMTI1LCAwLjk3OTIyLCAwLjk0MTY1LCAwLjk0MTY1LCAwLjk0MTY1LCAwLjk0MTY1LCAwLjk0MTY1LCAxLjI5MDA0LCAwLjk0MTY1LCAwLjk3OTIyLCAwLjk3OTIyLCAwLjk3OTIyLCAwLjk3OTIyLCAwLjk2NzUyLCAwLjk3MDQyLCAwLjk2NzUyLCAwLjk3MzYzLCAxLjA2NTg1LCAwLjk3MzYzLCAxLjA2NTg1LCAwLjk3MzYzLCAxLjA2NTg1LCAwLjg3ODk3LCAwLjgzMDU1LCAwLjg3ODk3LCAwLjgzMDU1LCAwLjg3ODk3LCAwLjgzMDU1LCAwLjg3ODk3LCAwLjgzMDU1LCAxLjA0MjYsIDEuMDAzMywgMS4wNDI2LCAwLjk3MDQyLCAwLjc5NDI5LCAwLjkzNTAzLCAwLjc5NDI5LCAwLjkzNTAzLCAwLjc5NDI5LCAwLjkzNTAzLCAwLjc5NDI5LCAwLjkzNTAzLCAwLjc5NDI5LCAwLjkzNTAzLCAwLjkxMTQ5LCAwLjk3MDQyLCAwLjkxMTQ5LCAwLjk3MDQyLCAwLjkxMTQ5LCAwLjk3MDQyLCAxLCAxLCAxLjA1ODE1LCAwLjk3OTIyLCAxLjA1ODE1LCAwLjk3OTIyLCAxLjE0MDYsIDEuMTQyMzYsIDEuMTQwNiwgMS4xNDIzNiwgMS4xNDA2LCAxLjE0MjM2LCAxLjE0MDYsIDEuMTQyMzYsIDEuMTQwNiwgMS4xNDIzNiwgMC45NzQ0MSwgMS4wNDMwMiwgMC43OTYzMSwgMS4wMTU4MiwgMSwgMSwgMS4wMTA1NCwgMC44Mzg1MywgMS4xNDIzNiwgMSwgMSwgMC44Mzg1MywgMS4wOTEyNSwgMC44Mzg1MywgMC45MDQxOCwgMC44Mzg1MywgMS4xOTUwOCwgMS4xMDYxNSwgMC45NzkyMiwgMSwgMSwgMS4xMDYxNSwgMC45NzkyMiwgMS4wMTAzNCwgMS4xMDQ2NiwgMC45NzkyMiwgMC45NzU1MiwgMC45NDE2NSwgMC45NzU1MiwgMC45NDE2NSwgMC45NzU1MiwgMC45NDE2NSwgMC45MTYwMiwgMC45MTk4MSwgMC44ODY0MSwgMS4wMjc2LCAxLCAxLCAwLjg4NjQxLCAxLjAyNzYsIDAuODA1MjcsIDAuNzg5MjksIDAuODA1MjcsIDAuNzg5MjksIDAuODA1MjcsIDAuNzg5MjksIDAuODA1MjcsIDAuNzg5MjksIDEsIDEsIDAuOTYwODMsIDEuMDU0MDMsIDAuOTU5MjMsIDEuMTY4NjIsIDEuMDAxMzUsIDAuOTc5MjIsIDEuMDAxMzUsIDAuOTc5MjIsIDEuMDAxMzUsIDAuOTc5MjIsIDEuMDAxMzUsIDAuOTc5MjIsIDEuMDAxMzUsIDAuOTc5MjIsIDEuMDAxMzUsIDAuOTc5MjIsIDEuMDY3NzcsIDEuMDIxOTcsIDAuOTExNDIsIDAuOTY3NTIsIDAuOTExNDIsIDAuOTkzNjEsIDAuOTcxNjgsIDAuOTkzNjEsIDAuOTcxNjgsIDAuOTkzNjEsIDAuOTcxNjgsIDEuMjMxOTksIDEuMDM2LCAwLjk3MzYzLCAxLjA2NTg1LCAwLjk0Mzg1LCAwLjk2NzA1LCAwLjk3NTUyLCAwLjk0MTY1LCAxLCAxLCAwLjk2MDgzLCAxLjEyNjEsIDEuMzE4MTgsIDEuMzE4MTgsIDEuMzE4MTgsIDEuMzE4MTgsIDEuMzE4MTgsIDEuMzE4MTgsIDEuMzE4MTgsIDEuMzE4MTgsIDEuMzE4MTgsIDAuOTUxNjEsIDEuMjcxMjYsIDEuMDA4MTEsIDAuODMyODQsIDAuNzc3MDIsIDAuOTkxMzcsIDAuOTUyNTMsIDEuMDM0NywgMC44NjE0MiwgMS4wNzIwNSwgMS4xNDIzNiwgMC45NzM2MywgMC44OTcyMywgMC44Njg2OSwgMS4wOTgxOCwgMC43OTQyOSwgMC45OTM2MSwgMS4wNTgxNSwgMC45NzU1MiwgMS4xNDA2LCAwLjkwMTI4LCAxLjA2NjYyLCAxLjA0Mzk2LCAxLjEwNjE1LCAwLjg0OTE4LCAwLjk3NTUyLCAxLjA0Njk0LCAwLjk0NDM2LCAwLjk4MDE1LCAwLjk2MDgzLCAwLjkxMTQyLCAxLjAwMzU2LCAwLjk4MTcsIDEuMDE5NDUsIDAuOTg5OTksIDEuMTQwNiwgMC45MTE0MiwgMS4wNDk2MSwgMC45ODk4LCAxLjAwNjM5LCAxLjE0MjM2LCAxLjA3NTE0LCAxLjA0OTYxLCAwLjk5NjA3LCAxLjAyODk3LCAxLjAwOCwgMC45ODk4LCAwLjk1MTM0LCAxLjAwNjM5LCAxLjExMTIxLCAxLjE0MjM2LCAxLjAwNTE4LCAwLjk3OTgxLCAxLjAyMTg2LCAxLCAxLjA4NTc4LCAwLjk0MTY1LCAwLjk5MzE0LCAwLjk4Mzg3LCAwLjkzMDI4LCAwLjkzMzc3LCAxLjM1MTI1LCAxLjA3NTE0LCAxLjEwNjg3LCAwLjkzNDkxLCAxLjA0MjMyLCAxLjAwMzUxLCAxLjE0MjM2LCAxLjA3NTE0LCAwLjk0MTY1LCAxLjA3NTE0LCAxLjAwMzUxLCAwLjc5NDI5LCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLjA5MDk3LCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAwLjkzNTAzLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAwLjk2NjA5LCAxLCAxLCAxLCAxLCAxLCAxLCAxLjA2Nzc3LCAxLjAyMTk3LCAxLjA2Nzc3LCAxLjAyMTk3LCAxLjA2Nzc3LCAxLjAyMTk3LCAwLjkxMTQyLCAwLjk2NzUyLCAxLCAxLjIxMjYxLCAwLjg5OTAzLCAxLCAxLCAwLjc1MTU1LCAxLjA0NzQ1LCAxLjA0NzQ1LCAxLjA0NzQ1LCAxLjA0Mzk0LCAwLjk4NjMzLCAwLjk4NjMzLCAwLjk4NjMzLCAwLjcyOTU5LCAwLjcyOTU5LCAxLjIwNTAyLCAwLjkxNDA2LCAxLjI2NTE0LCAxLjIyMiwgMS4wMjk1NiwgMS4wMzM3MiwgMS4wMzM3MiwgMC45NjAzOSwgMS4yNDYzMywgMSwgMS4wOTEyNSwgMC45MzMyNywgMS4wMzMzNiwgMS4xNjU0MSwgMS4wMzYsIDEsIDEsIDEsIDAuNzcxLCAxLCAxLCAxLjE1NTc0LCAxLjE1NTc0LCAxLjE1NTc0LCAxLjE1NTc0LCAwLjg2MzY0LCAwLjk0NDM0LCAwLjg2Mjc5LCAwLjk0NDM0LCAwLjg2MjI0LCAxLCAxLCAxLjE2Nzk4LCAxLCAwLjk2MDg1LCAwLjkwMDY4LCAxLjIxMjM3LCAxLjE4NDE2LCAxLjEzOTA0LCAwLjY5ODI1LCAwLjk3MTYsIDIuMTAzMzksIDEuMjkwMDQsIDEuMjkwMDQsIDEuMjEzMzksIDEuMjkwMDQsIDEuMjkwMDQsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEuNDI2MDMsIDEsIDAuOTk4NjIsIDAuOTk4NjIsIDEsIDAuODcwMjUsIDAuODcwMjUsIDAuODcwMjUsIDAuODcwMjUsIDEuMTg3NzUsIDEuNDI2MDMsIDEsIDEuNDI2MDMsIDEuNDI2MDMsIDAuOTk4NjIsIDEsIDEsIDEsIDEsIDEsIDEuMjg4NiwgMS4wNDMxNSwgMS4xNTI5NiwgMS4zNDE2MywgMSwgMSwgMSwgMS4xMzI2OSwgMS4xMzI2OSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMV07CmV4cG9ydHMuU2Vnb2V1aUJvbGRJdGFsaWNGYWN0b3JzID0gU2Vnb2V1aUJvbGRJdGFsaWNGYWN0b3JzOwpjb25zdCBTZWdvZXVpQm9sZEl0YWxpY01ldHJpY3MgPSB7CiAgbGluZUhlaWdodDogMS4zMzAwOCwKICBsaW5lR2FwOiAwCn07CmV4cG9ydHMuU2Vnb2V1aUJvbGRJdGFsaWNNZXRyaWNzID0gU2Vnb2V1aUJvbGRJdGFsaWNNZXRyaWNzOwpjb25zdCBTZWdvZXVpSXRhbGljRmFjdG9ycyA9IFsxLjc2NzM4LCAxLCAxLCAwLjk4OTQ2LCAxLjE0NzYzLCAxLjA1MzY1LCAxLjA2MjM0LCAwLjk2OTI3LCAwLjkyNTg2LCAxLjE1MzczLCAxLjE4NDE0LCAwLjkxMzQ5LCAwLjkxMzQ5LCAxLjA3NDAzLCAxLjE3MzA4LCAwLjc4MzgzLCAxLjIwMDg4LCAwLjc4MzgzLCAxLjQyNTMxLCAwLjk2OTI3LCAwLjk2OTI3LCAwLjk2OTI3LCAwLjk2OTI3LCAwLjk2OTI3LCAwLjk2OTI3LCAwLjk2OTI3LCAwLjk2OTI3LCAwLjk2OTI3LCAwLjk2OTI3LCAwLjc4MzgzLCAwLjc4MzgzLCAxLjE3MzA4LCAxLjE3MzA4LCAxLjE3MzA4LCAwLjc3MzQ5LCAwLjk0NTY1LCAwLjk0NzI5LCAwLjg1OTQ0LCAwLjg4NTA2LCAwLjk4NTgsIDAuNzQ4MTcsIDAuODAwMTYsIDAuODg0NDksIDAuOTgwMzksIDAuOTU3ODIsIDAuNjkyMzgsIDAuODk4OTgsIDAuODMyMzEsIDAuOTgxODMsIDEuMDM5ODksIDAuOTY5MjQsIDAuODYyMzcsIDAuOTY5MjQsIDAuODA1OTUsIDAuNzQ1MjQsIDAuODYwOTEsIDAuOTU0MDIsIDAuOTQxNDMsIDAuOTg0NDgsIDAuODg1OCwgMC44MzA4OSwgMC45MzI4NSwgMS4wOTQ5LCAxLjM5MDE2LCAxLjA5NDksIDEuNDU5OTQsIDAuNzQ2MjcsIDEuMDQ4MzksIDAuOTc0NTQsIDAuOTc0NTQsIDAuODcyMDcsIDAuOTc0NTQsIDAuODc1MzMsIDEuMDYxNTEsIDAuOTc0NTQsIDEuMDAxNzYsIDEuMTY0ODQsIDEuMDgxMzIsIDAuOTgwNDcsIDEuMTY0ODQsIDEuMDI5ODksIDEuMDEwNTQsIDAuOTYyMjUsIDAuOTc0NTQsIDAuOTc0NTQsIDEuMDY1OTgsIDAuNzkwMDQsIDEuMTYzNDQsIDEuMDAzNTEsIDAuOTQ2MjksIDAuOTk3MywgMC45MTAxNiwgMC45Njc3NywgMC45MDQzLCAwLjkxMDgyLCAwLjkyNDgxLCAwLjkxMDgyLCAxLjE3MzA4LCAwLjk1NzQ4LCAwLjk2OTI3LCAwLjk2OTI3LCAxLCAwLjk2OTI3LCAwLjkyNDgxLCAwLjgwNTk3LCAxLjA0ODM5LCAxLjIzMzkzLCAxLjE3ODEsIDAuOTI0NSwgMS4xNzMwOCwgMS4yMDgwOCwgMC42MzIxOCwgMC45NDI2MSwgMS4yNDgyMiwgMS4wOTk3MSwgMS4wOTk3MSwgMS4wNDgzOSwgMSwgMC44NTI3MywgMC43ODAzMiwgMS4wNDgzOSwgMS4wOTk3MSwgMS4yMjMyNiwgMC45MjQ1LCAxLjA5ODM2LCAxLjEzNTI1LCAxLjE1MjIyLCAwLjcwNDI0LCAwLjk0NzI5LCAwLjk0NzI5LCAwLjk0NzI5LCAwLjk0NzI5LCAwLjk0NzI5LCAwLjk0NzI5LCAwLjg1NDk4LCAwLjg4NTA2LCAwLjc0ODE3LCAwLjc0ODE3LCAwLjc0ODE3LCAwLjc0ODE3LCAwLjk1NzgyLCAwLjk1NzgyLCAwLjk1NzgyLCAwLjk1NzgyLCAwLjk4NTgsIDEuMDM5ODksIDAuOTY5MjQsIDAuOTY5MjQsIDAuOTY5MjQsIDAuOTY5MjQsIDAuOTY5MjQsIDEuMTczMDgsIDAuOTY5MjQsIDAuOTU0MDIsIDAuOTU0MDIsIDAuOTU0MDIsIDAuOTU0MDIsIDAuODMwODksIDAuODYyMzcsIDAuODg0MDksIDAuOTc0NTQsIDAuOTc0NTQsIDAuOTc0NTQsIDAuOTc0NTQsIDAuOTc0NTQsIDAuOTc0NTQsIDAuOTI5MTYsIDAuODcyMDcsIDAuODc1MzMsIDAuODc1MzMsIDAuODc1MzMsIDAuODc1MzMsIDAuOTMxNDYsIDAuOTMxNDYsIDAuOTMxNDYsIDAuOTMxNDYsIDAuOTM4NTQsIDEuMDEwNTQsIDAuOTYyMjUsIDAuOTYyMjUsIDAuOTYyMjUsIDAuOTYyMjUsIDAuOTYyMjUsIDEuMjQ4MjIsIDAuODc2MSwgMS4wMDM1MSwgMS4wMDM1MSwgMS4wMDM1MSwgMS4wMDM1MSwgMC45Njc3NywgMC45NzQ1NCwgMC45Njc3NywgMC45NDcyOSwgMC45NzQ1NCwgMC45NDcyOSwgMC45NzQ1NCwgMC45NDcyOSwgMC45NzQ1NCwgMC44ODUwNiwgMC44NzIwNywgMC44ODUwNiwgMC44NzIwNywgMC44ODUwNiwgMC44NzIwNywgMC44ODUwNiwgMC44NzIwNywgMC45ODU4LCAwLjk1MzkxLCAwLjk4NTgsIDAuOTc0NTQsIDAuNzQ4MTcsIDAuODc1MzMsIDAuNzQ4MTcsIDAuODc1MzMsIDAuNzQ4MTcsIDAuODc1MzMsIDAuNzQ4MTcsIDAuODc1MzMsIDAuNzQ4MTcsIDAuODc1MzMsIDAuODg0NDksIDAuOTc0NTQsIDAuODg0NDksIDAuOTc0NTQsIDAuODg0NDksIDAuOTc0NTQsIDEsIDEsIDAuOTgwMzksIDEuMDAxNzYsIDAuOTgwMzksIDEuMDAxNzYsIDAuOTU3ODIsIDAuOTMxNDYsIDAuOTU3ODIsIDAuOTMxNDYsIDAuOTU3ODIsIDAuOTMxNDYsIDAuOTU3ODIsIDEuMTY0ODQsIDAuOTU3ODIsIDAuOTMxNDYsIDAuODQ0MjEsIDEuMTI3NjEsIDAuNjkyMzgsIDEuMDgxMzIsIDEsIDEsIDAuOTgwNDcsIDAuODMyMzEsIDEuMTY0ODQsIDEsIDEsIDAuODQ3MjMsIDEuMDQ4NjEsIDAuODQ3MjMsIDAuNzg3NTUsIDAuODMyMzEsIDEuMjM3MzYsIDEuMDM5ODksIDEuMDEwNTQsIDEsIDEsIDEuMDM5ODksIDEuMDEwNTQsIDAuOTg1NywgMS4wMzg0OSwgMS4wMTA1NCwgMC45NjkyNCwgMC45NjIyNSwgMC45NjkyNCwgMC45NjIyNSwgMC45NjkyNCwgMC45NjIyNSwgMC45MjM4MywgMC45MDE3MSwgMC44MDU5NSwgMS4wNjU5OCwgMSwgMSwgMC44MDU5NSwgMS4wNjU5OCwgMC43NDUyNCwgMC43OTAwNCwgMC43NDUyNCwgMC43OTAwNCwgMC43NDUyNCwgMC43OTAwNCwgMC43NDUyNCwgMC43OTAwNCwgMSwgMSwgMC44NjA5MSwgMS4wMjc1OSwgMC44NTc3MSwgMS4xNjM0NCwgMC45NTQwMiwgMS4wMDM1MSwgMC45NTQwMiwgMS4wMDM1MSwgMC45NTQwMiwgMS4wMDM1MSwgMC45NTQwMiwgMS4wMDM1MSwgMC45NTQwMiwgMS4wMDM1MSwgMC45NTQwMiwgMS4wMDM1MSwgMC45ODQ0OCwgMC45OTczLCAwLjgzMDg5LCAwLjk2Nzc3LCAwLjgzMDg5LCAwLjkzMjg1LCAwLjkwNDMsIDAuOTMyODUsIDAuOTA0MywgMC45MzI4NSwgMC45MDQzLCAxLjMxODY4LCAwLjk2OTI3LCAwLjk0NzI5LCAwLjk3NDU0LCAwLjg1NDk4LCAwLjkyOTE2LCAwLjk2OTI0LCAwLjg3NjEsIDEsIDEsIDAuODYwOTEsIDEuMTYzNDQsIDEuMDQ4MzksIDEuMDQ4MzksIDEuMDQ4MzksIDEuMDQ4MzksIDEuMDQ4MzksIDEuMDQ4MzksIDEuMDQ4MzksIDEuMDQ4MzksIDEuMDQ4MzksIDAuODE5NjUsIDAuODE5NjUsIDAuOTQ3MjksIDAuNzgwMzIsIDAuNzEwMjIsIDAuOTA4ODMsIDAuODQxNzEsIDAuOTk4NzcsIDAuNzc1OTYsIDEuMDU3MzQsIDEuMiwgMC45NDcyOSwgMC44NTk0NCwgMC44Mjc5MSwgMC45NjA3LCAwLjc0ODE3LCAwLjkzMjg1LCAwLjk4MDM5LCAwLjk2OTI0LCAwLjk1NzgyLCAwLjg5ODk4LCAwLjk4MzE2LCAwLjk4MTgzLCAxLjAzOTg5LCAwLjc4NjE0LCAwLjk2OTI0LCAwLjk3NjQyLCAwLjg2MjM3LCAwLjg2MDc1LCAwLjg2MDkxLCAwLjgzMDg5LCAwLjkwMDgyLCAwLjg4NTgsIDAuOTcyOTYsIDEuMDEyODQsIDAuOTU3ODIsIDAuODMwODksIDEuMDk3NiwgMS4wNCwgMS4wMzM0MiwgMS4yLCAxLjA2NzUsIDEuMDk3NiwgMC45ODIwNSwgMS4wMzgwOSwgMS4wNTA5NywgMS4wNCwgMC45NTM2NCwgMS4wMzM0MiwgMS4wNTQwMSwgMS4yLCAxLjAyMTQ4LCAxLjAxMTksIDEuMDQ3MjQsIDEuMDEyNywgMS4wMjczMiwgMC45NjIyNSwgMC44OTY1LCAwLjk3NzgzLCAwLjkzNTc0LCAwLjk0ODE4LCAxLjMwNjc5LCAxLjA2NzUsIDEuMTE4MjYsIDAuOTk4MjEsIDEuMDU1NywgMS4wMzI2LCAxLjIsIDEuMDY3NSwgMC45NjIyNSwgMS4wNjc1LCAxLjAzMjYsIDAuNzQ4MTcsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEuMDM3NTQsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDAuODc1MzMsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDAuOTg3MDUsIDEsIDEsIDEsIDEsIDEsIDEsIDAuOTg0NDgsIDAuOTk3MywgMC45ODQ0OCwgMC45OTczLCAwLjk4NDQ4LCAwLjk5NzMsIDAuODMwODksIDAuOTY3NzcsIDEsIDEuMjAwODgsIDAuODk5MDMsIDEsIDEsIDAuNzUxNTUsIDAuOTQ5NDUsIDAuOTQ5NDUsIDAuOTQ5NDUsIDAuOTQ5NDUsIDEuMTIzMTcsIDEuMTIzMTcsIDEuMTIzMTcsIDAuNjc2MDMsIDAuNjc2MDMsIDEuMTU2MjEsIDAuNzM1ODQsIDEuMjExOTEsIDEuMjIxMzUsIDEuMDY0ODMsIDAuOTQ4NjgsIDAuOTQ4NjgsIDAuOTU5OTYsIDEuMjQ2MzMsIDEsIDEuMDc0OTcsIDAuODc3MDksIDAuOTY5MjcsIDEuMDE0NzMsIDAuOTY5MjcsIDEsIDEsIDEsIDAuNzcyOTUsIDEsIDEsIDEuMDk4MzYsIDEuMDk4MzYsIDEuMDk4MzYsIDEuMDE1MjIsIDAuODYzMjEsIDAuOTQ0MzQsIDAuODY0OSwgMC45NDQzNCwgMC44NjE4MiwgMSwgMSwgMS4wODMsIDEsIDAuOTE1NzgsIDAuODY0MzgsIDEuMTczMDgsIDEuMTg0MTYsIDEuMTQ1ODksIDAuNjk4MjUsIDAuOTc2MjIsIDEuOTY3OTEsIDEuMjQ4MjIsIDEuMjQ4MjIsIDEuMTczMDgsIDEuMjQ4MjIsIDEuMjQ4MjIsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEsIDEuNDI2MDMsIDEsIDAuOTk4NjIsIDAuOTk4NjIsIDEsIDAuODcwMjUsIDAuODcwMjUsIDAuODcwMjUsIDAuODcwMjUsIDEuMTc5ODQsIDEuNDI2MDMsIDEsIDEuNDI2MDMsIDEuNDI2MDMsIDAuOTk4NjIsIDEsIDEsIDEsIDEsIDEsIDEuMjg4NiwgMS4wNDMxNSwgMS4xNTI5NiwgMS4zNDE2MywgMSwgMSwgMSwgMS4xMDc0MiwgMS4xMDc0MiwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMV07CmV4cG9ydHMuU2Vnb2V1aUl0YWxpY0ZhY3RvcnMgPSBTZWdvZXVpSXRhbGljRmFjdG9yczsKY29uc3QgU2Vnb2V1aUl0YWxpY01ldHJpY3MgPSB7CiAgbGluZUhlaWdodDogMS4zMzAwOCwKICBsaW5lR2FwOiAwCn07CmV4cG9ydHMuU2Vnb2V1aUl0YWxpY01ldHJpY3MgPSBTZWdvZXVpSXRhbGljTWV0cmljczsKY29uc3QgU2Vnb2V1aVJlZ3VsYXJGYWN0b3JzID0gWzEuNzY3MzgsIDEsIDEsIDAuOTg1OTQsIDEuMDIyODUsIDEuMTA0NTQsIDEuMDYyMzQsIDAuOTY5MjcsIDAuOTIwMzcsIDEuMTk5ODUsIDEuMjA0NiwgMC45MDYxNiwgMC45MDYxNiwgMS4wNzE1MiwgMS4xNzE0LCAwLjc4MDMyLCAxLjIwMDg4LCAwLjc4MDMyLCAxLjQwMjQ2LCAwLjk2OTI3LCAwLjk2OTI3LCAwLjk2OTI3LCAwLjk2OTI3LCAwLjk2OTI3LCAwLjk2OTI3LCAwLjk2OTI3LCAwLjk2OTI3LCAwLjk2OTI3LCAwLjk2OTI3LCAwLjc4MDMyLCAwLjc4MDMyLCAxLjE3MTQsIDEuMTcxNCwgMS4xNzE0LCAwLjgwNTk3LCAwLjk0MDg0LCAwLjk2NzA2LCAwLjg1OTQ0LCAwLjg1NzM0LCAwLjk3MDkzLCAwLjc1ODQyLCAwLjc5OTM2LCAwLjg4MTk4LCAwLjk4MzEsIDAuOTU3ODIsIDAuNzEzODcsIDAuODY5NjksIDAuODQ2MzYsIDEuMDc3OTYsIDEuMDM1ODQsIDAuOTY5MjQsIDAuODM5NjgsIDAuOTY5MjQsIDAuODI4MjYsIDAuNzk2NDksIDAuODU3NzEsIDAuOTUxMzIsIDAuOTMxMTksIDAuOTg5NjUsIDAuODg0MzMsIDAuODI4NywgMC45MzM2NSwgMS4wODYxMiwgMS4zNjM4LCAxLjA4NjEyLCAxLjQ1Nzg2LCAwLjc0NjI3LCAwLjgwNDk5LCAwLjkxNDg0LCAxLjA1NzA3LCAwLjkyMzgzLCAxLjA1ODgyLCAwLjk0MDMsIDEuMTI2NTQsIDEuMDU4ODIsIDEuMDE3NTYsIDEuMDkwMTEsIDEuMDkwMTEsIDAuOTk0MTQsIDEuMDkwMTEsIDEuMDM0LCAxLjAxNzU2LCAxLjA1MzU2LCAxLjA1NzA3LCAxLjA1ODgyLCAxLjA0Mzk5LCAwLjg0ODYzLCAxLjIxOTY4LCAxLjAxNzU2LCAwLjk1ODAxLCAxLjAwMDY4LCAwLjkxNzk3LCAwLjk2Nzc3LCAwLjkwNDMsIDAuOTAzNTEsIDAuOTIxMDUsIDAuOTAzNTEsIDEuMTcxNCwgMC44NTMzNywgMC45NjkyNywgMC45NjkyNywgMC45OTkxMiwgMC45NjkyNywgMC45MjEwNSwgMC44MDU5NywgMS4yNDM0LCAxLjIwODA4LCAxLjA1OTM3LCAwLjkwOTU3LCAxLjE3MTQsIDEuMjA4MDgsIDAuNzUxNTUsIDAuOTQyNjEsIDEuMjQ2NDQsIDEuMDk5NzEsIDEuMDk5NzEsIDAuODQ3NTEsIDEsIDAuODUyNzMsIDAuNzgwMzIsIDAuNjE1ODQsIDEuMDU0MjUsIDEuMTc5MTQsIDAuOTA5NTcsIDEuMDg2NjUsIDEuMTE1OTMsIDEuMTQxNjksIDAuNzMzODEsIDAuOTY3MDYsIDAuOTY3MDYsIDAuOTY3MDYsIDAuOTY3MDYsIDAuOTY3MDYsIDAuOTY3MDYsIDAuODYwMzUsIDAuODU3MzQsIDAuNzU4NDIsIDAuNzU4NDIsIDAuNzU4NDIsIDAuNzU4NDIsIDAuOTU3ODIsIDAuOTU3ODIsIDAuOTU3ODIsIDAuOTU3ODIsIDAuOTcwOTMsIDEuMDM1ODQsIDAuOTY5MjQsIDAuOTY5MjQsIDAuOTY5MjQsIDAuOTY5MjQsIDAuOTY5MjQsIDEuMTcxNCwgMC45NjkyNCwgMC45NTEzMiwgMC45NTEzMiwgMC45NTEzMiwgMC45NTEzMiwgMC44Mjg3LCAwLjgzOTY4LCAwLjg5MDQ5LCAwLjkxNDg0LCAwLjkxNDg0LCAwLjkxNDg0LCAwLjkxNDg0LCAwLjkxNDg0LCAwLjkxNDg0LCAwLjkzNTc1LCAwLjkyMzgzLCAwLjk0MDMsIDAuOTQwMywgMC45NDAzLCAwLjk0MDMsIDAuODcxNywgMC44NzE3LCAwLjg3MTcsIDAuODcxNywgMS4wMDUyNywgMS4wMTc1NiwgMS4wNTM1NiwgMS4wNTM1NiwgMS4wNTM1NiwgMS4wNTM1NiwgMS4wNTM1NiwgMS4yNDY0NCwgMC45NTkyMywgMS4wMTc1NiwgMS4wMTc1NiwgMS4wMTc1NiwgMS4wMTc1NiwgMC45Njc3NywgMS4wNTcwNywgMC45Njc3NywgMC45NjcwNiwgMC45MTQ4NCwgMC45NjcwNiwgMC45MTQ4NCwgMC45NjcwNiwgMC45MTQ4NCwgMC44NTczNCwgMC45MjM4MywgMC44NTczNCwgMC45MjM4MywgMC44NTczNCwgMC45MjM4MywgMC44NTczNCwgMC45MjM4MywgMC45NzA5MywgMS4wOTY5LCAwLjk3MDkzLCAxLjA1ODgyLCAwLjc1ODQyLCAwLjk0MDMsIDAuNzU4NDIsIDAuOTQwMywgMC43NTg0MiwgMC45NDAzLCAwLjc1ODQyLCAwLjk0MDMsIDAuNzU4NDIsIDAuOTQwMywgMC44ODE5OCwgMS4wNTg4MiwgMC44ODE5OCwgMS4wNTg4MiwgMC44ODE5OCwgMS4wNTg4MiwgMSwgMSwgMC45ODMxLCAxLjAxNzU2LCAwLjk4MzEsIDEuMDE3NTYsIDAuOTU3ODIsIDAuODcxNywgMC45NTc4MiwgMC44NzE3LCAwLjk1NzgyLCAwLjg3MTcsIDAuOTU3ODIsIDEuMDkwMTEsIDAuOTU3ODIsIDAuODcxNywgMC44NDc4NCwgMS4xMTU1MSwgMC43MTM4NywgMS4wOTAxMSwgMSwgMSwgMC45OTQxNCwgMC44NDYzNiwgMS4wOTAxMSwgMSwgMSwgMC44NDYzNiwgMS4wNTM2LCAwLjg0NjM2LCAwLjk0Mjk4LCAwLjg0NjM2LCAxLjIzMjk3LCAxLjAzNTg0LCAxLjAxNzU2LCAxLCAxLCAxLjAzNTg0LCAxLjAxNzU2LCAxLjAwMzIzLCAxLjAzNDQ0LCAxLjAxNzU2LCAwLjk2OTI0LCAxLjA1MzU2LCAwLjk2OTI0LCAxLjA1MzU2LCAwLjk2OTI0LCAxLjA1MzU2LCAwLjkzMDY2LCAwLjk4MjkzLCAwLjgyODI2LCAxLjA0Mzk5LCAxLCAxLCAwLjgyODI2LCAxLjA0Mzk5LCAwLjc5NjQ5LCAwLjg0ODYzLCAwLjc5NjQ5LCAwLjg0ODYzLCAwLjc5NjQ5LCAwLjg0ODYzLCAwLjc5NjQ5LCAwLjg0ODYzLCAxLCAxLCAwLjg1NzcxLCAxLjE3MzE4LCAwLjg1NzcxLCAxLjIxOTY4LCAwLjk1MTMyLCAxLjAxNzU2LCAwLjk1MTMyLCAxLjAxNzU2LCAwLjk1MTMyLCAxLjAxNzU2LCAwLjk1MTMyLCAxLjAxNzU2LCAwLjk1MTMyLCAxLjAxNzU2LCAwLjk1MTMyLCAxLjAxNzU2LCAwLjk4OTY1LCAxLjAwMDY4LCAwLjgyODcsIDAuOTY3NzcsIDAuODI4NywgMC45MzM2NSwgMC45MDQzLCAwLjkzMzY1LCAwLjkwNDMsIDAuOTMzNjUsIDAuOTA0MywgMS4wODU3MSwgMC45NjkyNywgMC45NjcwNiwgMC45MTQ4NCwgMC44NjAzNSwgMC45MzU3NSwgMC45NjkyNCwgMC45NTkyMywgMSwgMSwgMC44NTc3MSwgMS4yMTk2OCwgMS4xMTQzNywgMS4xMTQzNywgMC45MzEwOSwgMC45MTIwMiwgMC42MDQxMSwgMC44NDE2NCwgMC41NTU3MiwgMS4wMTE3MywgMC45NzM2MSwgMC44MTgxOCwgMC44MTgxOCwgMC45NjYzNSwgMC43ODAzMiwgMC43MjcyNywgMC45MjM2NiwgMC45ODYwMSwgMS4wMzQwNSwgMC43Nzk2OCwgMS4wOTc5OSwgMS4yLCAwLjk2NzA2LCAwLjg1OTQ0LCAwLjg1NjM4LCAwLjk2NDkxLCAwLjc1ODQyLCAwLjkzMzY1LCAwLjk4MzEsIDAuOTY5MjQsIDAuOTU3ODIsIDAuODY5NjksIDAuOTQxNTIsIDEuMDc3OTYsIDEuMDM1ODQsIDAuNzg0MzcsIDAuOTY5MjQsIDAuOTg3MTUsIDAuODM5NjgsIDAuODM0OTEsIDAuODU3NzEsIDAuODI4NywgMC45NDQ5MiwgMC44ODQzMywgMC45Mjg3LCAxLjAwOTgsIDAuOTU3ODIsIDAuODI4NywgMS4wNjI1LCAwLjk4MjQ4LCAxLjAzNDI0LCAxLjIsIDEuMDEwNzEsIDEuMDYyNSwgMC45NTI0NiwgMS4wMzgwOSwgMS4wNDkxMiwgMC45ODI0OCwgMS4wMDIyMSwgMS4wMzQyNCwgMS4wNTQ0MywgMS4yLCAxLjA0Nzg1LCAwLjk5NjA5LCAxLjAwMTY5LCAxLjA1MTc2LCAwLjk5MzQ2LCAxLjA1MzU2LCAwLjkwODcsIDEuMDMwMDQsIDAuOTU1NDIsIDAuOTMxMTcsIDEuMjMzNjIsIDEuMDEwNzEsIDEuMDc4MzEsIDEuMDI1MTIsIDEuMDUyMDUsIDEuMDM1MDIsIDEuMiwgMS4wMTA3MSwgMS4wNTM1NiwgMS4wMTA3MSwgMS4wMzUwMiwgMC43NTg0MiwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMS4wMzcxOSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMC45NDAzLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLjA0MDIxLCAxLCAxLCAxLCAxLCAxLCAxLCAwLjk4OTY1LCAxLjAwMDY4LCAwLjk4OTY1LCAxLjAwMDY4LCAwLjk4OTY1LCAxLjAwMDY4LCAwLjgyODcsIDAuOTY3NzcsIDEsIDEuMjAwODgsIDAuODk5MDMsIDEsIDEsIDAuNzUxNTUsIDEuMDMwNzcsIDEuMDMwNzcsIDEuMDMwNzcsIDEuMDMwNzcsIDEuMTMxOTYsIDEuMTMxOTYsIDEuMTMxOTYsIDAuNjc0MjgsIDAuNjc0MjgsIDEuMTYwMzksIDAuNzMyOTEsIDEuMjA5OTYsIDEuMjIxMzUsIDEuMDY0ODMsIDAuOTQ4NjgsIDAuOTQ4NjgsIDAuOTU5OTYsIDEuMjQ2MzMsIDEsIDEuMDc0OTcsIDAuODc3OTYsIDAuOTY5MjcsIDEuMDE1MTgsIDAuOTY5MjcsIDEsIDEsIDEsIDAuNzcyOTUsIDEsIDEsIDEuMTA1MzksIDEuMTA1MzksIDEuMTEzNTgsIDEuMDY5NjcsIDAuODYyNzksIDAuOTQ0MzQsIDAuODYyNzksIDAuOTQ0MzQsIDAuODYxODIsIDEsIDEsIDEuMDgzLCAxLCAwLjkxNTc4LCAwLjg2NTA3LCAxLjE3MTQsIDEuMTg0MTYsIDEuMTQ1ODksIDAuNjk4MjUsIDAuOTc2MjIsIDEuOTY5NywgMS4yNDgyMiwgMS4yNDgyMiwgMS4xNzIzOCwgMS4yNDgyMiwgMS4yNDgyMiwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMSwgMS40MjYwMywgMSwgMC45OTg2MiwgMC45OTg2MiwgMSwgMC44NzAyNSwgMC44NzAyNSwgMC44NzAyNSwgMC44NzAyNSwgMS4xODA4MywgMS40MjYwMywgMSwgMS40MjYwMywgMS40MjYwMywgMC45OTg2MiwgMSwgMSwgMSwgMSwgMSwgMS4yODg2LCAxLjA0MzE1LCAxLjE1Mjk2LCAxLjM0MTYzLCAxLCAxLCAxLCAxLjEwOTM4LCAxLjEwOTM4LCAxLCAxLCAxLCAxLjA1NDI1LCAxLjA5OTcxLCAxLjA5OTcxLCAxLjA5OTcxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxLCAxXTsKZXhwb3J0cy5TZWdvZXVpUmVndWxhckZhY3RvcnMgPSBTZWdvZXVpUmVndWxhckZhY3RvcnM7CmNvbnN0IFNlZ29ldWlSZWd1bGFyTWV0cmljcyA9IHsKICBsaW5lSGVpZ2h0OiAxLjMzMDA4LAogIGxpbmVHYXA6IDAKfTsKZXhwb3J0cy5TZWdvZXVpUmVndWxhck1ldHJpY3MgPSBTZWdvZXVpUmVndWxhck1ldHJpY3M7CgovKioqLyB9KSwKLyogNTcgKi8KLyoqKi8gKChfX3VudXNlZF93ZWJwYWNrX21vZHVsZSwgZXhwb3J0cywgX193X3BkZmpzX3JlcXVpcmVfXykgPT4gewoKCgpPYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgIl9fZXNNb2R1bGUiLCAoewogIHZhbHVlOiB0cnVlCn0pKTsKZXhwb3J0cy5Qb3N0U2NyaXB0RXZhbHVhdG9yID0gZXhwb3J0cy5Qb3N0U2NyaXB0Q29tcGlsZXIgPSBleHBvcnRzLlBERkZ1bmN0aW9uRmFjdG9yeSA9IHZvaWQgMDsKZXhwb3J0cy5pc1BERkZ1bmN0aW9uID0gaXNQREZGdW5jdGlvbjsKdmFyIF9wcmltaXRpdmVzID0gX193X3BkZmpzX3JlcXVpcmVfXyg0KTsKdmFyIF91dGlsID0gX193X3BkZmpzX3JlcXVpcmVfXygyKTsKdmFyIF9wc19wYXJzZXIgPSBfX3dfcGRmanNfcmVxdWlyZV9fKDU4KTsKdmFyIF9iYXNlX3N0cmVhbSA9IF9fd19wZGZqc19yZXF1aXJlX18oNSk7CnZhciBfaW1hZ2VfdXRpbHMgPSBfX3dfcGRmanNfcmVxdWlyZV9fKDU5KTsKY2xhc3MgUERGRnVuY3Rpb25GYWN0b3J5IHsKICBjb25zdHJ1Y3Rvcih7CiAgICB4cmVmLAogICAgaXNFdmFsU3VwcG9ydGVkID0gdHJ1ZQogIH0pIHsKICAgIHRoaXMueHJlZiA9IHhyZWY7CiAgICB0aGlzLmlzRXZhbFN1cHBvcnRlZCA9IGlzRXZhbFN1cHBvcnRlZCAhPT0gZmFsc2U7CiAgfQogIGNyZWF0ZShmbikgewogICAgY29uc3QgY2FjaGVkRnVuY3Rpb24gPSB0aGlzLmdldENhY2hlZChmbik7CiAgICBpZiAoY2FjaGVkRnVuY3Rpb24pIHsKICAgICAgcmV0dXJuIGNhY2hlZEZ1bmN0aW9uOwogICAgfQogICAgY29uc3QgcGFyc2VkRnVuY3Rpb24gPSBQREZGdW5jdGlvbi5wYXJzZSh7CiAgICAgIHhyZWY6IHRoaXMueHJlZiwKICAgICAgaXNFdmFsU3VwcG9ydGVkOiB0aGlzLmlzRXZhbFN1cHBvcnRlZCwKICAgICAgZm46IGZuIGluc3RhbmNlb2YgX3ByaW1pdGl2ZXMuUmVmID8gdGhpcy54cmVmLmZldGNoKGZuKSA6IGZuCiAgICB9KTsKICAgIHRoaXMuX2NhY2hlKGZuLCBwYXJzZWRGdW5jdGlvbik7CiAgICByZXR1cm4gcGFyc2VkRnVuY3Rpb247CiAgfQogIGNyZWF0ZUZyb21BcnJheShmbk9iaikgewogICAgY29uc3QgY2FjaGVkRnVuY3Rpb24gPSB0aGlzLmdldENhY2hlZChmbk9iaik7CiAgICBpZiAoY2FjaGVkRnVuY3Rpb24pIHsKICAgICAgcmV0dXJuIGNhY2hlZEZ1bmN0aW9uOwogICAgfQogICAgY29uc3QgcGFyc2VkRnVuY3Rpb24gPSBQREZGdW5jdGlvbi5wYXJzZUFycmF5KHsKICAgICAgeHJlZjogdGhpcy54cmVmLAogICAgICBpc0V2YWxTdXBwb3J0ZWQ6IHRoaXMuaXNFdmFsU3VwcG9ydGVkLAogICAgICBmbk9iajogZm5PYmogaW5zdGFuY2VvZiBfcHJpbWl0aXZlcy5SZWYgPyB0aGlzLnhyZWYuZmV0Y2goZm5PYmopIDogZm5PYmoKICAgIH0pOwogICAgdGhpcy5fY2FjaGUoZm5PYmosIHBhcnNlZEZ1bmN0aW9uKTsKICAgIHJldHVybiBwYXJzZWRGdW5jdGlvbjsKICB9CiAgZ2V0Q2FjaGVkKGNhY2hlS2V5KSB7CiAgICBsZXQgZm5SZWY7CiAgICBpZiAoY2FjaGVLZXkgaW5zdGFuY2VvZiBfcHJpbWl0aXZlcy5SZWYpIHsKICAgICAgZm5SZWYgPSBjYWNoZUtleTsKICAgIH0gZWxzZSBpZiAoY2FjaGVLZXkgaW5zdGFuY2VvZiBfcHJpbWl0aXZlcy5EaWN0KSB7CiAgICAgIGZuUmVmID0gY2FjaGVLZXkub2JqSWQ7CiAgICB9IGVsc2UgaWYgKGNhY2hlS2V5IGluc3RhbmNlb2YgX2Jhc2Vfc3RyZWFtLkJhc2VTdHJlYW0pIHsKICAgICAgZm5SZWYgPSBjYWNoZUtleS5kaWN0Py5vYmpJZDsKICAgIH0KICAgIGlmIChmblJlZikgewogICAgICBjb25zdCBsb2NhbEZ1bmN0aW9uID0gdGhpcy5fbG9jYWxGdW5jdGlvbkNhY2hlLmdldEJ5UmVmKGZuUmVmKTsKICAgICAgaWYgKGxvY2FsRnVuY3Rpb24pIHsKICAgICAgICByZXR1cm4gbG9jYWxGdW5jdGlvbjsKICAgICAgfQogICAgfQogICAgcmV0dXJuIG51bGw7CiAgfQogIF9jYWNoZShjYWNoZUtleSwgcGFyc2VkRnVuY3Rpb24pIHsKICAgIGlmICghcGFyc2VkRnVuY3Rpb24pIHsKICAgICAgdGhyb3cgbmV3IEVycm9yKCdQREZGdW5jdGlvbkZhY3RvcnkuX2NhY2hlIC0gZXhwZWN0ZWQgInBhcnNlZEZ1bmN0aW9uIiBhcmd1bWVudC4nKTsKICAgIH0KICAgIGxldCBmblJlZjsKICAgIGlmIChjYWNoZUtleSBpbnN0YW5jZW9mIF9wcmltaXRpdmVzLlJlZikgewogICAgICBmblJlZiA9IGNhY2hlS2V5OwogICAgfSBlbHNlIGlmIChjYWNoZUtleSBpbnN0YW5jZW9mIF9wcmltaXRpdmVzLkRpY3QpIHsKICAgICAgZm5SZWYgPSBjYWNoZUtleS5vYmpJZDsKICAgIH0gZWxzZSBpZiAoY2FjaGVLZXkgaW5zdGFuY2VvZiBfYmFzZV9zdHJlYW0uQmFzZVN0cmVhbSkgewogICAgICBmblJlZiA9IGNhY2hlS2V5LmRpY3Q/Lm9iaklkOwogICAgfQogICAgaWYgKGZuUmVmKSB7CiAgICAgIHRoaXMuX2xvY2FsRnVuY3Rpb25DYWNoZS5zZXQobnVsbCwgZm5SZWYsIHBhcnNlZEZ1bmN0aW9uKTsKICAgIH0KICB9CiAgZ2V0IF9sb2NhbEZ1bmN0aW9uQ2FjaGUoKSB7CiAgICByZXR1cm4gKDAsIF91dGlsLnNoYWRvdykodGhpcywgIl9sb2NhbEZ1bmN0aW9uQ2FjaGUiLCBuZXcgX2ltYWdlX3V0aWxzLkxvY2FsRnVuY3Rpb25DYWNoZSgpKTsKICB9Cn0KZXhwb3J0cy5QREZGdW5jdGlvbkZhY3RvcnkgPSBQREZGdW5jdGlvbkZhY3Rvcnk7CmZ1bmN0aW9uIHRvTnVtYmVyQXJyYXkoYXJyKSB7CiAgaWYgKCFBcnJheS5pc0FycmF5KGFycikpIHsKICAgIHJldHVybiBudWxsOwogIH0KICBjb25zdCBsZW5ndGggPSBhcnIubGVuZ3RoOwogIGZvciAobGV0IGkgPSAwOyBpIDwgbGVuZ3RoOyBpKyspIHsKICAgIGlmICh0eXBlb2YgYXJyW2ldICE9PSAibnVtYmVyIikgewogICAgICBjb25zdCByZXN1bHQgPSBuZXcgQXJyYXkobGVuZ3RoKTsKICAgICAgZm9yIChsZXQgaiA9IDA7IGogPCBsZW5ndGg7IGorKykgewogICAgICAgIHJlc3VsdFtqXSA9ICthcnJbal07CiAgICAgIH0KICAgICAgcmV0dXJuIHJlc3VsdDsKICAgIH0KICB9CiAgcmV0dXJuIGFycjsKfQpjbGFzcyBQREZGdW5jdGlvbiB7CiAgc3RhdGljIGdldFNhbXBsZUFycmF5KHNpemUsIG91dHB1dFNpemUsIGJwcywgc3RyZWFtKSB7CiAgICBsZXQgaSwgaWk7CiAgICBsZXQgbGVuZ3RoID0gMTsKICAgIGZvciAoaSA9IDAsIGlpID0gc2l6ZS5sZW5ndGg7IGkgPCBpaTsgaSsrKSB7CiAgICAgIGxlbmd0aCAqPSBzaXplW2ldOwogICAgfQogICAgbGVuZ3RoICo9IG91dHB1dFNpemU7CiAgICBjb25zdCBhcnJheSA9IG5ldyBBcnJheShsZW5ndGgpOwogICAgbGV0IGNvZGVTaXplID0gMDsKICAgIGxldCBjb2RlQnVmID0gMDsKICAgIGNvbnN0IHNhbXBsZU11bCA9IDEuMCAvICgyLjAgKiogYnBzIC0gMSk7CiAgICBjb25zdCBzdHJCeXRlcyA9IHN0cmVhbS5nZXRCeXRlcygobGVuZ3RoICogYnBzICsgNykgLyA4KTsKICAgIGxldCBzdHJJZHggPSAwOwogICAgZm9yIChpID0gMDsgaSA8IGxlbmd0aDsgaSsrKSB7CiAgICAgIHdoaWxlIChjb2RlU2l6ZSA8IGJwcykgewogICAgICAgIGNvZGVCdWYgPDw9IDg7CiAgICAgICAgY29kZUJ1ZiB8PSBzdHJCeXRlc1tzdHJJZHgrK107CiAgICAgICAgY29kZVNpemUgKz0gODsKICAgICAgfQogICAgICBjb2RlU2l6ZSAtPSBicHM7CiAgICAgIGFycmF5W2ldID0gKGNvZGVCdWYgPj4gY29kZVNpemUpICogc2FtcGxlTXVsOwogICAgICBjb2RlQnVmICY9ICgxIDw8IGNvZGVTaXplKSAtIDE7CiAgICB9CiAgICByZXR1cm4gYXJyYXk7CiAgfQogIHN0YXRpYyBwYXJzZSh7CiAgICB4cmVmLAogICAgaXNFdmFsU3VwcG9ydGVkLAogICAgZm4KICB9KSB7CiAgICBjb25zdCBkaWN0ID0gZm4uZGljdCB8fCBmbjsKICAgIGNvbnN0IHR5cGVOdW0gPSBkaWN0LmdldCgiRnVuY3Rpb25UeXBlIik7CiAgICBzd2l0Y2ggKHR5cGVOdW0pIHsKICAgICAgY2FzZSAwOgogICAgICAgIHJldHVybiB0aGlzLmNvbnN0cnVjdFNhbXBsZWQoewogICAgICAgICAgeHJlZiwKICAgICAgICAgIGlzRXZhbFN1cHBvcnRlZCwKICAgICAgICAgIGZuLAogICAgICAgICAgZGljdAogICAgICAgIH0pOwogICAgICBjYXNlIDE6CiAgICAgICAgYnJlYWs7CiAgICAgIGNhc2UgMjoKICAgICAgICByZXR1cm4gdGhpcy5jb25zdHJ1Y3RJbnRlcnBvbGF0ZWQoewogICAgICAgICAgeHJlZiwKICAgICAgICAgIGlzRXZhbFN1cHBvcnRlZCwKICAgICAgICAgIGRpY3QKICAgICAgICB9KTsKICAgICAgY2FzZSAzOgogICAgICAgIHJldHVybiB0aGlzLmNvbnN0cnVjdFN0aWNoZWQoewogICAgICAgICAgeHJlZiwKICAgICAgICAgIGlzRXZhbFN1cHBvcnRlZCwKICAgICAgICAgIGRpY3QKICAgICAgICB9KTsKICAgICAgY2FzZSA0OgogICAgICAgIHJldHVybiB0aGlzLmNvbnN0cnVjdFBvc3RTY3JpcHQoewogICAgICAgICAgeHJlZiwKICAgICAgICAgIGlzRXZhbFN1cHBvcnRlZCwKICAgICAgICAgIGZuLAogICAgICAgICAgZGljdAogICAgICAgIH0pOwogICAgfQogICAgdGhyb3cgbmV3IF91dGlsLkZvcm1hdEVycm9yKCJVbmtub3duIHR5cGUgb2YgZnVuY3Rpb24iKTsKICB9CiAgc3RhdGljIHBhcnNlQXJyYXkoewogICAgeHJlZiwKICAgIGlzRXZhbFN1cHBvcnRlZCwKICAgIGZuT2JqCiAgfSkgewogICAgaWYgKCFBcnJheS5pc0FycmF5KGZuT2JqKSkgewogICAgICByZXR1cm4gdGhpcy5wYXJzZSh7CiAgICAgICAgeHJlZiwKICAgICAgICBpc0V2YWxTdXBwb3J0ZWQsCiAgICAgICAgZm46IGZuT2JqCiAgICAgIH0pOwogICAgfQogICAgY29uc3QgZm5BcnJheSA9IFtdOwogICAgZm9yIChjb25zdCBmbiBvZiBmbk9iaikgewogICAgICBmbkFycmF5LnB1c2godGhpcy5wYXJzZSh7CiAgICAgICAgeHJlZiwKICAgICAgICBpc0V2YWxTdXBwb3J0ZWQsCiAgICAgICAgZm46IHhyZWYuZmV0Y2hJZlJlZihmbikKICAgICAgfSkpOwogICAgfQogICAgcmV0dXJuIGZ1bmN0aW9uIChzcmMsIHNyY09mZnNldCwgZGVzdCwgZGVzdE9mZnNldCkgewogICAgICBmb3IgKGxldCBpID0gMCwgaWkgPSBmbkFycmF5Lmxlbmd0aDsgaSA8IGlpOyBpKyspIHsKICAgICAgICBmbkFycmF5W2ldKHNyYywgc3JjT2Zmc2V0LCBkZXN0LCBkZXN0T2Zmc2V0ICsgaSk7CiAgICAgIH0KICAgIH07CiAgfQogIHN0YXRpYyBjb25zdHJ1Y3RTYW1wbGVkKHsKICAgIHhyZWYsCiAgICBpc0V2YWxTdXBwb3J0ZWQsCiAgICBmbiwKICAgIGRpY3QKICB9KSB7CiAgICBmdW5jdGlvbiB0b011bHRpQXJyYXkoYXJyKSB7CiAgICAgIGNvbnN0IGlucHV0TGVuZ3RoID0gYXJyLmxlbmd0aDsKICAgICAgY29uc3Qgb3V0ID0gW107CiAgICAgIGxldCBpbmRleCA9IDA7CiAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgaW5wdXRMZW5ndGg7IGkgKz0gMikgewogICAgICAgIG91dFtpbmRleCsrXSA9IFthcnJbaV0sIGFycltpICsgMV1dOwogICAgICB9CiAgICAgIHJldHVybiBvdXQ7CiAgICB9CiAgICBmdW5jdGlvbiBpbnRlcnBvbGF0ZSh4LCB4bWluLCB4bWF4LCB5bWluLCB5bWF4KSB7CiAgICAgIHJldHVybiB5bWluICsgKHggLSB4bWluKSAqICgoeW1heCAtIHltaW4pIC8gKHhtYXggLSB4bWluKSk7CiAgICB9CiAgICBsZXQgZG9tYWluID0gdG9OdW1iZXJBcnJheShkaWN0LmdldEFycmF5KCJEb21haW4iKSk7CiAgICBsZXQgcmFuZ2UgPSB0b051bWJlckFycmF5KGRpY3QuZ2V0QXJyYXkoIlJhbmdlIikpOwogICAgaWYgKCFkb21haW4gfHwgIXJhbmdlKSB7CiAgICAgIHRocm93IG5ldyBfdXRpbC5Gb3JtYXRFcnJvcigiTm8gZG9tYWluIG9yIHJhbmdlIik7CiAgICB9CiAgICBjb25zdCBpbnB1dFNpemUgPSBkb21haW4ubGVuZ3RoIC8gMjsKICAgIGNvbnN0IG91dHB1dFNpemUgPSByYW5nZS5sZW5ndGggLyAyOwogICAgZG9tYWluID0gdG9NdWx0aUFycmF5KGRvbWFpbik7CiAgICByYW5nZSA9IHRvTXVsdGlBcnJheShyYW5nZSk7CiAgICBjb25zdCBzaXplID0gdG9OdW1iZXJBcnJheShkaWN0LmdldEFycmF5KCJTaXplIikpOwogICAgY29uc3QgYnBzID0gZGljdC5nZXQoIkJpdHNQZXJTYW1wbGUiKTsKICAgIGNvbnN0IG9yZGVyID0gZGljdC5nZXQoIk9yZGVyIikgfHwgMTsKICAgIGlmIChvcmRlciAhPT0gMSkgewogICAgICAoMCwgX3V0aWwuaW5mbykoIk5vIHN1cHBvcnQgZm9yIGN1YmljIHNwbGluZSBpbnRlcnBvbGF0aW9uOiAiICsgb3JkZXIpOwogICAgfQogICAgbGV0IGVuY29kZSA9IHRvTnVtYmVyQXJyYXkoZGljdC5nZXRBcnJheSgiRW5jb2RlIikpOwogICAgaWYgKCFlbmNvZGUpIHsKICAgICAgZW5jb2RlID0gW107CiAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgaW5wdXRTaXplOyArK2kpIHsKICAgICAgICBlbmNvZGUucHVzaChbMCwgc2l6ZVtpXSAtIDFdKTsKICAgICAgfQogICAgfSBlbHNlIHsKICAgICAgZW5jb2RlID0gdG9NdWx0aUFycmF5KGVuY29kZSk7CiAgICB9CiAgICBsZXQgZGVjb2RlID0gdG9OdW1iZXJBcnJheShkaWN0LmdldEFycmF5KCJEZWNvZGUiKSk7CiAgICBkZWNvZGUgPSAhZGVjb2RlID8gcmFuZ2UgOiB0b011bHRpQXJyYXkoZGVjb2RlKTsKICAgIGNvbnN0IHNhbXBsZXMgPSB0aGlzLmdldFNhbXBsZUFycmF5KHNpemUsIG91dHB1dFNpemUsIGJwcywgZm4pOwogICAgcmV0dXJuIGZ1bmN0aW9uIGNvbnN0cnVjdFNhbXBsZWRGbihzcmMsIHNyY09mZnNldCwgZGVzdCwgZGVzdE9mZnNldCkgewogICAgICBjb25zdCBjdWJlVmVydGljZXMgPSAxIDw8IGlucHV0U2l6ZTsKICAgICAgY29uc3QgY3ViZU4gPSBuZXcgRmxvYXQ2NEFycmF5KGN1YmVWZXJ0aWNlcyk7CiAgICAgIGNvbnN0IGN1YmVWZXJ0ZXggPSBuZXcgVWludDMyQXJyYXkoY3ViZVZlcnRpY2VzKTsKICAgICAgbGV0IGksIGo7CiAgICAgIGZvciAoaiA9IDA7IGogPCBjdWJlVmVydGljZXM7IGorKykgewogICAgICAgIGN1YmVOW2pdID0gMTsKICAgICAgfQogICAgICBsZXQgayA9IG91dHB1dFNpemUsCiAgICAgICAgcG9zID0gMTsKICAgICAgZm9yIChpID0gMDsgaSA8IGlucHV0U2l6ZTsgKytpKSB7CiAgICAgICAgY29uc3QgZG9tYWluXzJpID0gZG9tYWluW2ldWzBdOwogICAgICAgIGNvbnN0IGRvbWFpbl8yaV8xID0gZG9tYWluW2ldWzFdOwogICAgICAgIGNvbnN0IHhpID0gTWF0aC5taW4oTWF0aC5tYXgoc3JjW3NyY09mZnNldCArIGldLCBkb21haW5fMmkpLCBkb21haW5fMmlfMSk7CiAgICAgICAgbGV0IGUgPSBpbnRlcnBvbGF0ZSh4aSwgZG9tYWluXzJpLCBkb21haW5fMmlfMSwgZW5jb2RlW2ldWzBdLCBlbmNvZGVbaV1bMV0pOwogICAgICAgIGNvbnN0IHNpemVfaSA9IHNpemVbaV07CiAgICAgICAgZSA9IE1hdGgubWluKE1hdGgubWF4KGUsIDApLCBzaXplX2kgLSAxKTsKICAgICAgICBjb25zdCBlMCA9IGUgPCBzaXplX2kgLSAxID8gTWF0aC5mbG9vcihlKSA6IGUgLSAxOwogICAgICAgIGNvbnN0IG4wID0gZTAgKyAxIC0gZTsKICAgICAgICBjb25zdCBuMSA9IGUgLSBlMDsKICAgICAgICBjb25zdCBvZmZzZXQwID0gZTAgKiBrOwogICAgICAgIGNvbnN0IG9mZnNldDEgPSBvZmZzZXQwICsgazsKICAgICAgICBmb3IgKGogPSAwOyBqIDwgY3ViZVZlcnRpY2VzOyBqKyspIHsKICAgICAgICAgIGlmIChqICYgcG9zKSB7CiAgICAgICAgICAgIGN1YmVOW2pdICo9IG4xOwogICAgICAgICAgICBjdWJlVmVydGV4W2pdICs9IG9mZnNldDE7CiAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICBjdWJlTltqXSAqPSBuMDsKICAgICAgICAgICAgY3ViZVZlcnRleFtqXSArPSBvZmZzZXQwOwogICAgICAgICAgfQogICAgICAgIH0KICAgICAgICBrICo9IHNpemVfaTsKICAgICAgICBwb3MgPDw9IDE7CiAgICAgIH0KICAgICAgZm9yIChqID0gMDsgaiA8IG91dHB1dFNpemU7ICsraikgewogICAgICAgIGxldCByaiA9IDA7CiAgICAgICAgZm9yIChpID0gMDsgaSA8IGN1YmVWZXJ0aWNlczsgaSsrKSB7CiAgICAgICAgICByaiArPSBzYW1wbGVzW2N1YmVWZXJ0ZXhbaV0gKyBqXSAqIGN1YmVOW2ldOwogICAgICAgIH0KICAgICAgICByaiA9IGludGVycG9sYXRlKHJqLCAwLCAxLCBkZWNvZGVbal1bMF0sIGRlY29kZVtqXVsxXSk7CiAgICAgICAgZGVzdFtkZXN0T2Zmc2V0ICsgal0gPSBNYXRoLm1pbihNYXRoLm1heChyaiwgcmFuZ2Vbal1bMF0pLCByYW5nZVtqXVsxXSk7CiAgICAgIH0KICAgIH07CiAgfQogIHN0YXRpYyBjb25zdHJ1Y3RJbnRlcnBvbGF0ZWQoewogICAgeHJlZiwKICAgIGlzRXZhbFN1cHBvcnRlZCwKICAgIGRpY3QKICB9KSB7CiAgICBjb25zdCBjMCA9IHRvTnVtYmVyQXJyYXkoZGljdC5nZXRBcnJheSgiQzAiKSkgfHwgWzBdOwogICAgY29uc3QgYzEgPSB0b051bWJlckFycmF5KGRpY3QuZ2V0QXJyYXkoIkMxIikpIHx8IFsxXTsKICAgIGNvbnN0IG4gPSBkaWN0LmdldCgiTiIpOwogICAgY29uc3QgZGlmZiA9IFtdOwogICAgZm9yIChsZXQgaSA9IDAsIGlpID0gYzAubGVuZ3RoOyBpIDwgaWk7ICsraSkgewogICAgICBkaWZmLnB1c2goYzFbaV0gLSBjMFtpXSk7CiAgICB9CiAgICBjb25zdCBsZW5ndGggPSBkaWZmLmxlbmd0aDsKICAgIHJldHVybiBmdW5jdGlvbiBjb25zdHJ1Y3RJbnRlcnBvbGF0ZWRGbihzcmMsIHNyY09mZnNldCwgZGVzdCwgZGVzdE9mZnNldCkgewogICAgICBjb25zdCB4ID0gbiA9PT0gMSA/IHNyY1tzcmNPZmZzZXRdIDogc3JjW3NyY09mZnNldF0gKiogbjsKICAgICAgZm9yIChsZXQgaiA9IDA7IGogPCBsZW5ndGg7ICsraikgewogICAgICAgIGRlc3RbZGVzdE9mZnNldCArIGpdID0gYzBbal0gKyB4ICogZGlmZltqXTsKICAgICAgfQogICAgfTsKICB9CiAgc3RhdGljIGNvbnN0cnVjdFN0aWNoZWQoewogICAgeHJlZiwKICAgIGlzRXZhbFN1cHBvcnRlZCwKICAgIGRpY3QKICB9KSB7CiAgICBjb25zdCBkb21haW4gPSB0b051bWJlckFycmF5KGRpY3QuZ2V0QXJyYXkoIkRvbWFpbiIpKTsKICAgIGlmICghZG9tYWluKSB7CiAgICAgIHRocm93IG5ldyBfdXRpbC5Gb3JtYXRFcnJvcigiTm8gZG9tYWluIik7CiAgICB9CiAgICBjb25zdCBpbnB1dFNpemUgPSBkb21haW4ubGVuZ3RoIC8gMjsKICAgIGlmIChpbnB1dFNpemUgIT09IDEpIHsKICAgICAgdGhyb3cgbmV3IF91dGlsLkZvcm1hdEVycm9yKCJCYWQgZG9tYWluIGZvciBzdGljaGVkIGZ1bmN0aW9uIik7CiAgICB9CiAgICBjb25zdCBmbnMgPSBbXTsKICAgIGZvciAoY29uc3QgZm4gb2YgZGljdC5nZXQoIkZ1bmN0aW9ucyIpKSB7CiAgICAgIGZucy5wdXNoKHRoaXMucGFyc2UoewogICAgICAgIHhyZWYsCiAgICAgICAgaXNFdmFsU3VwcG9ydGVkLAogICAgICAgIGZuOiB4cmVmLmZldGNoSWZSZWYoZm4pCiAgICAgIH0pKTsKICAgIH0KICAgIGNvbnN0IGJvdW5kcyA9IHRvTnVtYmVyQXJyYXkoZGljdC5nZXRBcnJheSgiQm91bmRzIikpOwogICAgY29uc3QgZW5jb2RlID0gdG9OdW1iZXJBcnJheShkaWN0LmdldEFycmF5KCJFbmNvZGUiKSk7CiAgICBjb25zdCB0bXBCdWYgPSBuZXcgRmxvYXQzMkFycmF5KDEpOwogICAgcmV0dXJuIGZ1bmN0aW9uIGNvbnN0cnVjdFN0aWNoZWRGbihzcmMsIHNyY09mZnNldCwgZGVzdCwgZGVzdE9mZnNldCkgewogICAgICBjb25zdCBjbGlwID0gZnVuY3Rpb24gY29uc3RydWN0U3RpY2hlZEZyb21JUkNsaXAodiwgbWluLCBtYXgpIHsKICAgICAgICBpZiAodiA+IG1heCkgewogICAgICAgICAgdiA9IG1heDsKICAgICAgICB9IGVsc2UgaWYgKHYgPCBtaW4pIHsKICAgICAgICAgIHYgPSBtaW47CiAgICAgICAgfQogICAgICAgIHJldHVybiB2OwogICAgICB9OwogICAgICBjb25zdCB2ID0gY2xpcChzcmNbc3JjT2Zmc2V0XSwgZG9tYWluWzBdLCBkb21haW5bMV0pOwogICAgICBjb25zdCBsZW5ndGggPSBib3VuZHMubGVuZ3RoOwogICAgICBsZXQgaTsKICAgICAgZm9yIChpID0gMDsgaSA8IGxlbmd0aDsgKytpKSB7CiAgICAgICAgaWYgKHYgPCBib3VuZHNbaV0pIHsKICAgICAgICAgIGJyZWFrOwogICAgICAgIH0KICAgICAgfQogICAgICBsZXQgZG1pbiA9IGRvbWFpblswXTsKICAgICAgaWYgKGkgPiAwKSB7CiAgICAgICAgZG1pbiA9IGJvdW5kc1tpIC0gMV07CiAgICAgIH0KICAgICAgbGV0IGRtYXggPSBkb21haW5bMV07CiAgICAgIGlmIChpIDwgYm91bmRzLmxlbmd0aCkgewogICAgICAgIGRtYXggPSBib3VuZHNbaV07CiAgICAgIH0KICAgICAgY29uc3Qgcm1pbiA9IGVuY29kZVsyICogaV07CiAgICAgIGNvbnN0IHJtYXggPSBlbmNvZGVbMiAqIGkgKyAxXTsKICAgICAgdG1wQnVmWzBdID0gZG1pbiA9PT0gZG1heCA/IHJtaW4gOiBybWluICsgKHYgLSBkbWluKSAqIChybWF4IC0gcm1pbikgLyAoZG1heCAtIGRtaW4pOwogICAgICBmbnNbaV0odG1wQnVmLCAwLCBkZXN0LCBkZXN0T2Zmc2V0KTsKICAgIH07CiAgfQogIHN0YXRpYyBjb25zdHJ1Y3RQb3N0U2NyaXB0KHsKICAgIHhyZWYsCiAgICBpc0V2YWxTdXBwb3J0ZWQsCiAgICBmbiwKICAgIGRpY3QKICB9KSB7CiAgICBjb25zdCBkb21haW4gPSB0b051bWJlckFycmF5KGRpY3QuZ2V0QXJyYXkoIkRvbWFpbiIpKTsKICAgIGNvbnN0IHJhbmdlID0gdG9OdW1iZXJBcnJheShkaWN0LmdldEFycmF5KCJSYW5nZSIpKTsKICAgIGlmICghZG9tYWluKSB7CiAgICAgIHRocm93IG5ldyBfdXRpbC5Gb3JtYXRFcnJvcigiTm8gZG9tYWluLiIpOwogICAgfQogICAgaWYgKCFyYW5nZSkgewogICAgICB0aHJvdyBuZXcgX3V0aWwuRm9ybWF0RXJyb3IoIk5vIHJhbmdlLiIpOwogICAgfQogICAgY29uc3QgbGV4ZXIgPSBuZXcgX3BzX3BhcnNlci5Qb3N0U2NyaXB0TGV4ZXIoZm4pOwogICAgY29uc3QgcGFyc2VyID0gbmV3IF9wc19wYXJzZXIuUG9zdFNjcmlwdFBhcnNlcihsZXhlcik7CiAgICBjb25zdCBjb2RlID0gcGFyc2VyLnBhcnNlKCk7CiAgICBpZiAoaXNFdmFsU3VwcG9ydGVkICYmIF91dGlsLkZlYXR1cmVUZXN0LmlzRXZhbFN1cHBvcnRlZCkgewogICAgICBjb25zdCBjb21waWxlZCA9IG5ldyBQb3N0U2NyaXB0Q29tcGlsZXIoKS5jb21waWxlKGNvZGUsIGRvbWFpbiwgcmFuZ2UpOwogICAgICBpZiAoY29tcGlsZWQpIHsKICAgICAgICByZXR1cm4gbmV3IEZ1bmN0aW9uKCJzcmMiLCAic3JjT2Zmc2V0IiwgImRlc3QiLCAiZGVzdE9mZnNldCIsIGNvbXBpbGVkKTsKICAgICAgfQogICAgfQogICAgKDAsIF91dGlsLmluZm8pKCJVbmFibGUgdG8gY29tcGlsZSBQUyBmdW5jdGlvbiIpOwogICAgY29uc3QgbnVtT3V0cHV0cyA9IHJhbmdlLmxlbmd0aCA+PiAxOwogICAgY29uc3QgbnVtSW5wdXRzID0gZG9tYWluLmxlbmd0aCA+PiAxOwogICAgY29uc3QgZXZhbHVhdG9yID0gbmV3IFBvc3RTY3JpcHRFdmFsdWF0b3IoY29kZSk7CiAgICBjb25zdCBjYWNoZSA9IE9iamVjdC5jcmVhdGUobnVsbCk7CiAgICBjb25zdCBNQVhfQ0FDSEVfU0laRSA9IDIwNDggKiA0OwogICAgbGV0IGNhY2hlX2F2YWlsYWJsZSA9IE1BWF9DQUNIRV9TSVpFOwogICAgY29uc3QgdG1wQnVmID0gbmV3IEZsb2F0MzJBcnJheShudW1JbnB1dHMpOwogICAgcmV0dXJuIGZ1bmN0aW9uIGNvbnN0cnVjdFBvc3RTY3JpcHRGbihzcmMsIHNyY09mZnNldCwgZGVzdCwgZGVzdE9mZnNldCkgewogICAgICBsZXQgaSwgdmFsdWU7CiAgICAgIGxldCBrZXkgPSAiIjsKICAgICAgY29uc3QgaW5wdXQgPSB0bXBCdWY7CiAgICAgIGZvciAoaSA9IDA7IGkgPCBudW1JbnB1dHM7IGkrKykgewogICAgICAgIHZhbHVlID0gc3JjW3NyY09mZnNldCArIGldOwogICAgICAgIGlucHV0W2ldID0gdmFsdWU7CiAgICAgICAga2V5ICs9IHZhbHVlICsgIl8iOwogICAgICB9CiAgICAgIGNvbnN0IGNhY2hlZFZhbHVlID0gY2FjaGVba2V5XTsKICAgICAgaWYgKGNhY2hlZFZhbHVlICE9PSB1bmRlZmluZWQpIHsKICAgICAgICBkZXN0LnNldChjYWNoZWRWYWx1ZSwgZGVzdE9mZnNldCk7CiAgICAgICAgcmV0dXJuOwogICAgICB9CiAgICAgIGNvbnN0IG91dHB1dCA9IG5ldyBGbG9hdDMyQXJyYXkobnVtT3V0cHV0cyk7CiAgICAgIGNvbnN0IHN0YWNrID0gZXZhbHVhdG9yLmV4ZWN1dGUoaW5wdXQpOwogICAgICBjb25zdCBzdGFja0luZGV4ID0gc3RhY2subGVuZ3RoIC0gbnVtT3V0cHV0czsKICAgICAgZm9yIChpID0gMDsgaSA8IG51bU91dHB1dHM7IGkrKykgewogICAgICAgIHZhbHVlID0gc3RhY2tbc3RhY2tJbmRleCArIGldOwogICAgICAgIGxldCBib3VuZCA9IHJhbmdlW2kgKiAyXTsKICAgICAgICBpZiAodmFsdWUgPCBib3VuZCkgewogICAgICAgICAgdmFsdWUgPSBib3VuZDsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgYm91bmQgPSByYW5nZVtpICogMiArIDFdOwogICAgICAgICAgaWYgKHZhbHVlID4gYm91bmQpIHsKICAgICAgICAgICAgdmFsdWUgPSBib3VuZDsKICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgb3V0cHV0W2ldID0gdmFsdWU7CiAgICAgIH0KICAgICAgaWYgKGNhY2hlX2F2YWlsYWJsZSA+IDApIHsKICAgICAgICBjYWNoZV9hdmFpbGFibGUtLTsKICAgICAgICBjYWNoZVtrZXldID0gb3V0cHV0OwogICAgICB9CiAgICAgIGRlc3Quc2V0KG91dHB1dCwgZGVzdE9mZnNldCk7CiAgICB9OwogIH0KfQpmdW5jdGlvbiBpc1BERkZ1bmN0aW9uKHYpIHsKICBsZXQgZm5EaWN0OwogIGlmICh2IGluc3RhbmNlb2YgX3ByaW1pdGl2ZXMuRGljdCkgewogICAgZm5EaWN0ID0gdjsKICB9IGVsc2UgaWYgKHYgaW5zdGFuY2VvZiBfYmFzZV9zdHJlYW0uQmFzZVN0cmVhbSkgewogICAgZm5EaWN0ID0gdi5kaWN0OwogIH0gZWxzZSB7CiAgICByZXR1cm4gZmFsc2U7CiAgfQogIHJldHVybiBmbkRpY3QuaGFzKCJGdW5jdGlvblR5cGUiKTsKfQpjbGFzcyBQb3N0U2NyaXB0U3RhY2sgewogIHN0YXRpYyBNQVhfU1RBQ0tfU0laRSA9IDEwMDsKICBjb25zdHJ1Y3Rvcihpbml0aWFsU3RhY2spIHsKICAgIHRoaXMuc3RhY2sgPSBpbml0aWFsU3RhY2sgPyBBcnJheS5mcm9tKGluaXRpYWxTdGFjaykgOiBbXTsKICB9CiAgcHVzaCh2YWx1ZSkgewogICAgaWYgKHRoaXMuc3RhY2subGVuZ3RoID49IFBvc3RTY3JpcHRTdGFjay5NQVhfU1RBQ0tfU0laRSkgewogICAgICB0aHJvdyBuZXcgRXJyb3IoIlBvc3RTY3JpcHQgZnVuY3Rpb24gc3RhY2sgb3ZlcmZsb3cuIik7CiAgICB9CiAgICB0aGlzLnN0YWNrLnB1c2godmFsdWUpOwogIH0KICBwb3AoKSB7CiAgICBpZiAodGhpcy5zdGFjay5sZW5ndGggPD0gMCkgewogICAgICB0aHJvdyBuZXcgRXJyb3IoIlBvc3RTY3JpcHQgZnVuY3Rpb24gc3RhY2sgdW5kZXJmbG93LiIpOwogICAgfQogICAgcmV0dXJuIHRoaXMuc3RhY2sucG9wKCk7CiAgfQogIGNvcHkobikgewogICAgaWYgKHRoaXMuc3RhY2subGVuZ3RoICsgbiA+PSBQb3N0U2NyaXB0U3RhY2suTUFYX1NUQUNLX1NJWkUpIHsKICAgICAgdGhyb3cgbmV3IEVycm9yKCJQb3N0U2NyaXB0IGZ1bmN0aW9uIHN0YWNrIG92ZXJmbG93LiIpOwogICAgfQogICAgY29uc3Qgc3RhY2sgPSB0aGlzLnN0YWNrOwogICAgZm9yIChsZXQgaSA9IHN0YWNrLmxlbmd0aCAtIG4sIGogPSBuIC0gMTsgaiA+PSAwOyBqLS0sIGkrKykgewogICAgICBzdGFjay5wdXNoKHN0YWNrW2ldKTsKICAgIH0KICB9CiAgaW5kZXgobikgewogICAgdGhpcy5wdXNoKHRoaXMuc3RhY2tbdGhpcy5zdGFjay5sZW5ndGggLSBuIC0gMV0pOwogIH0KICByb2xsKG4sIHApIHsKICAgIGNvbnN0IHN0YWNrID0gdGhpcy5zdGFjazsKICAgIGNvbnN0IGwgPSBzdGFjay5sZW5ndGggLSBuOwogICAgY29uc3QgciA9IHN0YWNrLmxlbmd0aCAtIDE7CiAgICBjb25zdCBjID0gbCArIChwIC0gTWF0aC5mbG9vcihwIC8gbikgKiBuKTsKICAgIGZvciAobGV0IGkgPSBsLCBqID0gcjsgaSA8IGo7IGkrKywgai0tKSB7CiAgICAgIGNvbnN0IHQgPSBzdGFja1tpXTsKICAgICAgc3RhY2tbaV0gPSBzdGFja1tqXTsKICAgICAgc3RhY2tbal0gPSB0OwogICAgfQogICAgZm9yIChsZXQgaSA9IGwsIGogPSBjIC0gMTsgaSA8IGo7IGkrKywgai0tKSB7CiAgICAgIGNvbnN0IHQgPSBzdGFja1tpXTsKICAgICAgc3RhY2tbaV0gPSBzdGFja1tqXTsKICAgICAgc3RhY2tbal0gPSB0OwogICAgfQogICAgZm9yIChsZXQgaSA9IGMsIGogPSByOyBpIDwgajsgaSsrLCBqLS0pIHsKICAgICAgY29uc3QgdCA9IHN0YWNrW2ldOwogICAgICBzdGFja1tpXSA9IHN0YWNrW2pdOwogICAgICBzdGFja1tqXSA9IHQ7CiAgICB9CiAgfQp9CmNsYXNzIFBvc3RTY3JpcHRFdmFsdWF0b3IgewogIGNvbnN0cnVjdG9yKG9wZXJhdG9ycykgewogICAgdGhpcy5vcGVyYXRvcnMgPSBvcGVyYXRvcnM7CiAgfQogIGV4ZWN1dGUoaW5pdGlhbFN0YWNrKSB7CiAgICBjb25zdCBzdGFjayA9IG5ldyBQb3N0U2NyaXB0U3RhY2soaW5pdGlhbFN0YWNrKTsKICAgIGxldCBjb3VudGVyID0gMDsKICAgIGNvbnN0IG9wZXJhdG9ycyA9IHRoaXMub3BlcmF0b3JzOwogICAgY29uc3QgbGVuZ3RoID0gb3BlcmF0b3JzLmxlbmd0aDsKICAgIGxldCBvcGVyYXRvciwgYSwgYjsKICAgIHdoaWxlIChjb3VudGVyIDwgbGVuZ3RoKSB7CiAgICAgIG9wZXJhdG9yID0gb3BlcmF0b3JzW2NvdW50ZXIrK107CiAgICAgIGlmICh0eXBlb2Ygb3BlcmF0b3IgPT09ICJudW1iZXIiKSB7CiAgICAgICAgc3RhY2sucHVzaChvcGVyYXRvcik7CiAgICAgICAgY29udGludWU7CiAgICAgIH0KICAgICAgc3dpdGNoIChvcGVyYXRvcikgewogICAgICAgIGNhc2UgImp6IjoKICAgICAgICAgIGIgPSBzdGFjay5wb3AoKTsKICAgICAgICAgIGEgPSBzdGFjay5wb3AoKTsKICAgICAgICAgIGlmICghYSkgewogICAgICAgICAgICBjb3VudGVyID0gYjsKICAgICAgICAgIH0KICAgICAgICAgIGJyZWFrOwogICAgICAgIGNhc2UgImoiOgogICAgICAgICAgYSA9IHN0YWNrLnBvcCgpOwogICAgICAgICAgY291bnRlciA9IGE7CiAgICAgICAgICBicmVhazsKICAgICAgICBjYXNlICJhYnMiOgogICAgICAgICAgYSA9IHN0YWNrLnBvcCgpOwogICAgICAgICAgc3RhY2sucHVzaChNYXRoLmFicyhhKSk7CiAgICAgICAgICBicmVhazsKICAgICAgICBjYXNlICJhZGQiOgogICAgICAgICAgYiA9IHN0YWNrLnBvcCgpOwogICAgICAgICAgYSA9IHN0YWNrLnBvcCgpOwogICAgICAgICAgc3RhY2sucHVzaChhICsgYik7CiAgICAgICAgICBicmVhazsKICAgICAgICBjYXNlICJhbmQiOgogICAgICAgICAgYiA9IHN0YWNrLnBvcCgpOwogICAgICAgICAgYSA9IHN0YWNrLnBvcCgpOwogICAgICAgICAgaWYgKHR5cGVvZiBhID09PSAiYm9vbGVhbiIgJiYgdHlwZW9mIGIgPT09ICJib29sZWFuIikgewogICAgICAgICAgICBzdGFjay5wdXNoKGEgJiYgYik7CiAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICBzdGFjay5wdXNoKGEgJiBiKTsKICAgICAgICAgIH0KICAgICAgICAgIGJyZWFrOwogICAgICAgIGNhc2UgImF0YW4iOgogICAgICAgICAgYiA9IHN0YWNrLnBvcCgpOwogICAgICAgICAgYSA9IHN0YWNrLnBvcCgpOwogICAgICAgICAgYSA9IE1hdGguYXRhbjIoYSwgYikgLyBNYXRoLlBJICogMTgwOwogICAgICAgICAgaWYgKGEgPCAwKSB7CiAgICAgICAgICAgIGEgKz0gMzYwOwogICAgICAgICAgfQogICAgICAgICAgc3RhY2sucHVzaChhKTsKICAgICAgICAgIGJyZWFrOwogICAgICAgIGNhc2UgImJpdHNoaWZ0IjoKICAgICAgICAgIGIgPSBzdGFjay5wb3AoKTsKICAgICAgICAgIGEgPSBzdGFjay5wb3AoKTsKICAgICAgICAgIGlmIChhID4gMCkgewogICAgICAgICAgICBzdGFjay5wdXNoKGEgPDwgYik7CiAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICBzdGFjay5wdXNoKGEgPj4gYik7CiAgICAgICAgICB9CiAgICAgICAgICBicmVhazsKICAgICAgICBjYXNlICJjZWlsaW5nIjoKICAgICAgICAgIGEgPSBzdGFjay5wb3AoKTsKICAgICAgICAgIHN0YWNrLnB1c2goTWF0aC5jZWlsKGEpKTsKICAgICAgICAgIGJyZWFrOwogICAgICAgIGNhc2UgImNvcHkiOgogICAgICAgICAgYSA9IHN0YWNrLnBvcCgpOwogICAgICAgICAgc3RhY2suY29weShhKTsKICAgICAgICAgIGJyZWFrOwogICAgICAgIGNhc2UgImNvcyI6CiAgICAgICAgICBhID0gc3RhY2sucG9wKCk7CiAgICAgICAgICBzdGFjay5wdXNoKE1hdGguY29zKGEgJSAzNjAgLyAxODAgKiBNYXRoLlBJKSk7CiAgICAgICAgICBicmVhazsKICAgICAgICBjYXNlICJjdmkiOgogICAgICAgICAgYSA9IHN0YWNrLnBvcCgpIHwgMDsKICAgICAgICAgIHN0YWNrLnB1c2goYSk7CiAgICAgICAgICBicmVhazsKICAgICAgICBjYXNlICJjdnIiOgogICAgICAgICAgYnJlYWs7CiAgICAgICAgY2FzZSAiZGl2IjoKICAgICAgICAgIGIgPSBzdGFjay5wb3AoKTsKICAgICAgICAgIGEgPSBzdGFjay5wb3AoKTsKICAgICAgICAgIHN0YWNrLnB1c2goYSAvIGIpOwogICAgICAgICAgYnJlYWs7CiAgICAgICAgY2FzZSAiZHVwIjoKICAgICAgICAgIHN0YWNrLmNvcHkoMSk7CiAgICAgICAgICBicmVhazsKICAgICAgICBjYXNlICJlcSI6CiAgICAgICAgICBiID0gc3RhY2sucG9wKCk7CiAgICAgICAgICBhID0gc3RhY2sucG9wKCk7CiAgICAgICAgICBzdGFjay5wdXNoKGEgPT09IGIpOwogICAgICAgICAgYnJlYWs7CiAgICAgICAgY2FzZSAiZXhjaCI6CiAgICAgICAgICBzdGFjay5yb2xsKDIsIDEpOwogICAgICAgICAgYnJlYWs7CiAgICAgICAgY2FzZSAiZXhwIjoKICAgICAgICAgIGIgPSBzdGFjay5wb3AoKTsKICAgICAgICAgIGEgPSBzdGFjay5wb3AoKTsKICAgICAgICAgIHN0YWNrLnB1c2goYSAqKiBiKTsKICAgICAgICAgIGJyZWFrOwogICAgICAgIGNhc2UgImZhbHNlIjoKICAgICAgICAgIHN0YWNrLnB1c2goZmFsc2UpOwogICAgICAgICAgYnJlYWs7CiAgICAgICAgY2FzZSAiZmxvb3IiOgogICAgICAgICAgYSA9IHN0YWNrLnBvcCgpOwogICAgICAgICAgc3RhY2sucHVzaChNYXRoLmZsb29yKGEpKTsKICAgICAgICAgIGJyZWFrOwogICAgICAgIGNhc2UgImdlIjoKICAgICAgICAgIGIgPSBzdGFjay5wb3AoKTsKICAgICAgICAgIGEgPSBzdGFjay5wb3AoKTsKICAgICAgICAgIHN0YWNrLnB1c2goYSA+PSBiKTsKICAgICAgICAgIGJyZWFrOwogICAgICAgIGNhc2UgImd0IjoKICAgICAgICAgIGIgPSBzdGFjay5wb3AoKTsKICAgICAgICAgIGEgPSBzdGFjay5wb3AoKTsKICAgICAgICAgIHN0YWNrLnB1c2goYSA+IGIpOwogICAgICAgICAgYnJlYWs7CiAgICAgICAgY2FzZSAiaWRpdiI6CiAgICAgICAgICBiID0gc3RhY2sucG9wKCk7CiAgICAgICAgICBhID0gc3RhY2sucG9wKCk7CiAgICAgICAgICBzdGFjay5wdXNoKGEgLyBiIHwgMCk7CiAgICAgICAgICBicmVhazsKICAgICAgICBjYXNlICJpbmRleCI6CiAgICAgICAgICBhID0gc3RhY2sucG9wKCk7CiAgICAgICAgICBzdGFjay5pbmRleChhKTsKICAgICAgICAgIGJyZWFrOwogICAgICAgIGNhc2UgImxlIjoKICAgICAgICAgIGIgPSBzdGFjay5wb3AoKTsKICAgICAgICAgIGEgPSBzdGFjay5wb3AoKTsKICAgICAgICAgIHN0YWNrLnB1c2goYSA8PSBiKTsKICAgICAgICAgIGJyZWFrOwogICAgICAgIGNhc2UgImxuIjoKICAgICAgICAgIGEgPSBzdGFjay5wb3AoKTsKICAgICAgICAgIHN0YWNrLnB1c2goTWF0aC5sb2coYSkpOwogICAgICAgICAgYnJlYWs7CiAgICAgICAgY2FzZSAibG9nIjoKICAgICAgICAgIGEgPSBzdGFjay5wb3AoKTsKICAgICAgICAgIHN0YWNrLnB1c2goTWF0aC5sb2cxMChhKSk7CiAgICAgICAgICBicmVhazsKICAgICAgICBjYXNlICJsdCI6CiAgICAgICAgICBiID0gc3RhY2sucG9wKCk7CiAgICAgICAgICBhID0gc3RhY2sucG9wKCk7CiAgICAgICAgICBzdGFjay5wdXNoKGEgPCBiKTsKICAgICAgICAgIGJyZWFrOwogICAgICAgIGNhc2UgIm1vZCI6CiAgICAgICAgICBiID0gc3RhY2sucG9wKCk7CiAgICAgICAgICBhID0gc3RhY2sucG9wKCk7CiAgICAgICAgICBzdGFjay5wdXNoKGEgJSBiKTsKICAgICAgICAgIGJyZWFrOwogICAgICAgIGNhc2UgIm11bCI6CiAgICAgICAgICBiID0gc3RhY2sucG9wKCk7CiAgICAgICAgICBhID0gc3RhY2sucG9wKCk7CiAgICAgICAgICBzdGFjay5wdXNoKGEgKiBiKTsKICAgICAgICAgIGJyZWFrOwogICAgICAgIGNhc2UgIm5lIjoKICAgICAgICAgIGIgPSBzdGFjay5wb3AoKTsKICAgICAgICAgIGEgPSBzdGFjay5wb3AoKTsKICAgICAgICAgIHN0YWNrLnB1c2goYSAhPT0gYik7CiAgICAgICAgICBicmVhazsKICAgICAgICBjYXNlICJuZWciOgogICAgICAgICAgYSA9IHN0YWNrLnBvcCgpOwogICAgICAgICAgc3RhY2sucHVzaCgtYSk7CiAgICAgICAgICBicmVhazsKICAgICAgICBjYXNlICJub3QiOgogICAgICAgICAgYSA9IHN0YWNrLnBvcCgpOwogICAgICAgICAgaWYgKHR5cGVvZiBhID09PSAiYm9vbGVhbiIpIHsKICAgICAgICAgICAgc3RhY2sucHVzaCghYSk7CiAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICBzdGFjay5wdXNoKH5hKTsKICAgICAgICAgIH0KICAgICAgICAgIGJyZWFrOwogICAgICAgIGNhc2UgIm9yIjoKICAgICAgICAgIGIgPSBzdGFjay5wb3AoKTsKICAgICAgICAgIGEgPSBzdGFjay5wb3AoKTsKICAgICAgICAgIGlmICh0eXBlb2YgYSA9PT0gImJvb2xlYW4iICYmIHR5cGVvZiBiID09PSAiYm9vbGVhbiIpIHsKICAgICAgICAgICAgc3RhY2sucHVzaChhIHx8IGIpOwogICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgc3RhY2sucHVzaChhIHwgYik7CiAgICAgICAgICB9CiAgICAgICAgICBicmVhazsKICAgICAgICBjYXNlICJwb3AiOgogICAgICAgICAgc3RhY2sucG9wKCk7CiAgICAgICAgICBicmVhazsKICAgICAgICBjYXNlICJyb2xsIjoKICAgICAgICAgIGIgPSBzdGFjay5wb3AoKTsKICAgICAgICAgIGEgPSBzdGFjay5wb3AoKTsKICAgICAgICAgIHN0YWNrLnJvbGwoYSwgYik7CiAgICAgICAgICBicmVhazsKICAgICAgICBjYXNlICJyb3VuZCI6CiAgICAgICAgICBhID0gc3RhY2sucG9wKCk7CiAgICAgICAgICBzdGFjay5wdXNoKE1hdGgucm91bmQoYSkpOwogICAgICAgICAgYnJlYWs7CiAgICAgICAgY2FzZSAic2luIjoKICAgICAgICAgIGEgPSBzdGFjay5wb3AoKTsKICAgICAgICAgIHN0YWNrLnB1c2goTWF0aC5zaW4oYSAlIDM2MCAvIDE4MCAqIE1hdGguUEkpKTsKICAgICAgICAgIGJyZWFrOwogICAgICAgIGNhc2UgInNxcnQiOgogICAgICAgICAgYSA9IHN0YWNrLnBvcCgpOwogICAgICAgICAgc3RhY2sucHVzaChNYXRoLnNxcnQoYSkpOwogICAgICAgICAgYnJlYWs7CiAgICAgICAgY2FzZSAic3ViIjoKICAgICAgICAgIGIgPSBzdGFjay5wb3AoKTsKICAgICAgICAgIGEgPSBzdGFjay5wb3AoKTsKICAgICAgICAgIHN0YWNrLnB1c2goYSAtIGIpOwogICAgICAgICAgYnJlYWs7CiAgICAgICAgY2FzZSAidHJ1ZSI6CiAgICAgICAgICBzdGFjay5wdXNoKHRydWUpOwogICAgICAgICAgYnJlYWs7CiAgICAgICAgY2FzZSAidHJ1bmNhdGUiOgogICAgICAgICAgYSA9IHN0YWNrLnBvcCgpOwogICAgICAgICAgYSA9IGEgPCAwID8gTWF0aC5jZWlsKGEpIDogTWF0aC5mbG9vcihhKTsKICAgICAgICAgIHN0YWNrLnB1c2goYSk7CiAgICAgICAgICBicmVhazsKICAgICAgICBjYXNlICJ4b3IiOgogICAgICAgICAgYiA9IHN0YWNrLnBvcCgpOwogICAgICAgICAgYSA9IHN0YWNrLnBvcCgpOwogICAgICAgICAgaWYgKHR5cGVvZiBhID09PSAiYm9vbGVhbiIgJiYgdHlwZW9mIGIgPT09ICJib29sZWFuIikgewogICAgICAgICAgICBzdGFjay5wdXNoKGEgIT09IGIpOwogICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgc3RhY2sucHVzaChhIF4gYik7CiAgICAgICAgICB9CiAgICAgICAgICBicmVhazsKICAgICAgICBkZWZhdWx0OgogICAgICAgICAgdGhyb3cgbmV3IF91dGlsLkZvcm1hdEVycm9yKGBVbmtub3duIG9wZXJhdG9yICR7b3BlcmF0b3J9YCk7CiAgICAgIH0KICAgIH0KICAgIHJldHVybiBzdGFjay5zdGFjazsKICB9Cn0KZXhwb3J0cy5Qb3N0U2NyaXB0RXZhbHVhdG9yID0gUG9zdFNjcmlwdEV2YWx1YXRvcjsKY2xhc3MgQXN0Tm9kZSB7CiAgY29uc3RydWN0b3IodHlwZSkgewogICAgdGhpcy50eXBlID0gdHlwZTsKICB9CiAgdmlzaXQodmlzaXRvcikgewogICAgKDAsIF91dGlsLnVucmVhY2hhYmxlKSgiYWJzdHJhY3QgbWV0aG9kIik7CiAgfQp9CmNsYXNzIEFzdEFyZ3VtZW50IGV4dGVuZHMgQXN0Tm9kZSB7CiAgY29uc3RydWN0b3IoaW5kZXgsIG1pbiwgbWF4KSB7CiAgICBzdXBlcigiYXJncyIpOwogICAgdGhpcy5pbmRleCA9IGluZGV4OwogICAgdGhpcy5taW4gPSBtaW47CiAgICB0aGlzLm1heCA9IG1heDsKICB9CiAgdmlzaXQodmlzaXRvcikgewogICAgdmlzaXRvci52aXNpdEFyZ3VtZW50KHRoaXMpOwogIH0KfQpjbGFzcyBBc3RMaXRlcmFsIGV4dGVuZHMgQXN0Tm9kZSB7CiAgY29uc3RydWN0b3IobnVtYmVyKSB7CiAgICBzdXBlcigibGl0ZXJhbCIpOwogICAgdGhpcy5udW1iZXIgPSBudW1iZXI7CiAgICB0aGlzLm1pbiA9IG51bWJlcjsKICAgIHRoaXMubWF4ID0gbnVtYmVyOwogIH0KICB2aXNpdCh2aXNpdG9yKSB7CiAgICB2aXNpdG9yLnZpc2l0TGl0ZXJhbCh0aGlzKTsKICB9Cn0KY2xhc3MgQXN0QmluYXJ5T3BlcmF0aW9uIGV4dGVuZHMgQXN0Tm9kZSB7CiAgY29uc3RydWN0b3Iob3AsIGFyZzEsIGFyZzIsIG1pbiwgbWF4KSB7CiAgICBzdXBlcigiYmluYXJ5Iik7CiAgICB0aGlzLm9wID0gb3A7CiAgICB0aGlzLmFyZzEgPSBhcmcxOwogICAgdGhpcy5hcmcyID0gYXJnMjsKICAgIHRoaXMubWluID0gbWluOwogICAgdGhpcy5tYXggPSBtYXg7CiAgfQogIHZpc2l0KHZpc2l0b3IpIHsKICAgIHZpc2l0b3IudmlzaXRCaW5hcnlPcGVyYXRpb24odGhpcyk7CiAgfQp9CmNsYXNzIEFzdE1pbiBleHRlbmRzIEFzdE5vZGUgewogIGNvbnN0cnVjdG9yKGFyZywgbWF4KSB7CiAgICBzdXBlcigibWF4Iik7CiAgICB0aGlzLmFyZyA9IGFyZzsKICAgIHRoaXMubWluID0gYXJnLm1pbjsKICAgIHRoaXMubWF4ID0gbWF4OwogIH0KICB2aXNpdCh2aXNpdG9yKSB7CiAgICB2aXNpdG9yLnZpc2l0TWluKHRoaXMpOwogIH0KfQpjbGFzcyBBc3RWYXJpYWJsZSBleHRlbmRzIEFzdE5vZGUgewogIGNvbnN0cnVjdG9yKGluZGV4LCBtaW4sIG1heCkgewogICAgc3VwZXIoInZhciIpOwogICAgdGhpcy5pbmRleCA9IGluZGV4OwogICAgdGhpcy5taW4gPSBtaW47CiAgICB0aGlzLm1heCA9IG1heDsKICB9CiAgdmlzaXQodmlzaXRvcikgewogICAgdmlzaXRvci52aXNpdFZhcmlhYmxlKHRoaXMpOwogIH0KfQpjbGFzcyBBc3RWYXJpYWJsZURlZmluaXRpb24gZXh0ZW5kcyBBc3ROb2RlIHsKICBjb25zdHJ1Y3Rvcih2YXJpYWJsZSwgYXJnKSB7CiAgICBzdXBlcigiZGVmaW5pdGlvbiIpOwogICAgdGhpcy52YXJpYWJsZSA9IHZhcmlhYmxlOwogICAgdGhpcy5hcmcgPSBhcmc7CiAgfQogIHZpc2l0KHZpc2l0b3IpIHsKICAgIHZpc2l0b3IudmlzaXRWYXJpYWJsZURlZmluaXRpb24odGhpcyk7CiAgfQp9CmNsYXNzIEV4cHJlc3Npb25CdWlsZGVyVmlzaXRvciB7CiAgY29uc3RydWN0b3IoKSB7CiAgICB0aGlzLnBhcnRzID0gW107CiAgfQogIHZpc2l0QXJndW1lbnQoYXJnKSB7CiAgICB0aGlzLnBhcnRzLnB1c2goIk1hdGgubWF4KCIsIGFyZy5taW4sICIsIE1hdGgubWluKCIsIGFyZy5tYXgsICIsIHNyY1tzcmNPZmZzZXQgKyAiLCBhcmcuaW5kZXgsICJdKSkiKTsKICB9CiAgdmlzaXRWYXJpYWJsZSh2YXJpYWJsZSkgewogICAgdGhpcy5wYXJ0cy5wdXNoKCJ2IiwgdmFyaWFibGUuaW5kZXgpOwogIH0KICB2aXNpdExpdGVyYWwobGl0ZXJhbCkgewogICAgdGhpcy5wYXJ0cy5wdXNoKGxpdGVyYWwubnVtYmVyKTsKICB9CiAgdmlzaXRCaW5hcnlPcGVyYXRpb24ob3BlcmF0aW9uKSB7CiAgICB0aGlzLnBhcnRzLnB1c2goIigiKTsKICAgIG9wZXJhdGlvbi5hcmcxLnZpc2l0KHRoaXMpOwogICAgdGhpcy5wYXJ0cy5wdXNoKCIgIiwgb3BlcmF0aW9uLm9wLCAiICIpOwogICAgb3BlcmF0aW9uLmFyZzIudmlzaXQodGhpcyk7CiAgICB0aGlzLnBhcnRzLnB1c2goIikiKTsKICB9CiAgdmlzaXRWYXJpYWJsZURlZmluaXRpb24oZGVmaW5pdGlvbikgewogICAgdGhpcy5wYXJ0cy5wdXNoKCJ2YXIgIik7CiAgICBkZWZpbml0aW9uLnZhcmlhYmxlLnZpc2l0KHRoaXMpOwogICAgdGhpcy5wYXJ0cy5wdXNoKCIgPSAiKTsKICAgIGRlZmluaXRpb24uYXJnLnZpc2l0KHRoaXMpOwogICAgdGhpcy5wYXJ0cy5wdXNoKCI7Iik7CiAgfQogIHZpc2l0TWluKG1heCkgewogICAgdGhpcy5wYXJ0cy5wdXNoKCJNYXRoLm1pbigiKTsKICAgIG1heC5hcmcudmlzaXQodGhpcyk7CiAgICB0aGlzLnBhcnRzLnB1c2goIiwgIiwgbWF4Lm1heCwgIikiKTsKICB9CiAgdG9TdHJpbmcoKSB7CiAgICByZXR1cm4gdGhpcy5wYXJ0cy5qb2luKCIiKTsKICB9Cn0KZnVuY3Rpb24gYnVpbGRBZGRPcGVyYXRpb24obnVtMSwgbnVtMikgewogIGlmIChudW0yLnR5cGUgPT09ICJsaXRlcmFsIiAmJiBudW0yLm51bWJlciA9PT0gMCkgewogICAgcmV0dXJuIG51bTE7CiAgfQogIGlmIChudW0xLnR5cGUgPT09ICJsaXRlcmFsIiAmJiBudW0xLm51bWJlciA9PT0gMCkgewogICAgcmV0dXJuIG51bTI7CiAgfQogIGlmIChudW0yLnR5cGUgPT09ICJsaXRlcmFsIiAmJiBudW0xLnR5cGUgPT09ICJsaXRlcmFsIikgewogICAgcmV0dXJuIG5ldyBBc3RMaXRlcmFsKG51bTEubnVtYmVyICsgbnVtMi5udW1iZXIpOwogIH0KICByZXR1cm4gbmV3IEFzdEJpbmFyeU9wZXJhdGlvbigiKyIsIG51bTEsIG51bTIsIG51bTEubWluICsgbnVtMi5taW4sIG51bTEubWF4ICsgbnVtMi5tYXgpOwp9CmZ1bmN0aW9uIGJ1aWxkTXVsT3BlcmF0aW9uKG51bTEsIG51bTIpIHsKICBpZiAobnVtMi50eXBlID09PSAibGl0ZXJhbCIpIHsKICAgIGlmIChudW0yLm51bWJlciA9PT0gMCkgewogICAgICByZXR1cm4gbmV3IEFzdExpdGVyYWwoMCk7CiAgICB9IGVsc2UgaWYgKG51bTIubnVtYmVyID09PSAxKSB7CiAgICAgIHJldHVybiBudW0xOwogICAgfSBlbHNlIGlmIChudW0xLnR5cGUgPT09ICJsaXRlcmFsIikgewogICAgICByZXR1cm4gbmV3IEFzdExpdGVyYWwobnVtMS5udW1iZXIgKiBudW0yLm51bWJlcik7CiAgICB9CiAgfQogIGlmIChudW0xLnR5cGUgPT09ICJsaXRlcmFsIikgewogICAgaWYgKG51bTEubnVtYmVyID09PSAwKSB7CiAgICAgIHJldHVybiBuZXcgQXN0TGl0ZXJhbCgwKTsKICAgIH0gZWxzZSBpZiAobnVtMS5udW1iZXIgPT09IDEpIHsKICAgICAgcmV0dXJuIG51bTI7CiAgICB9CiAgfQogIGNvbnN0IG1pbiA9IE1hdGgubWluKG51bTEubWluICogbnVtMi5taW4sIG51bTEubWluICogbnVtMi5tYXgsIG51bTEubWF4ICogbnVtMi5taW4sIG51bTEubWF4ICogbnVtMi5tYXgpOwogIGNvbnN0IG1heCA9IE1hdGgubWF4KG51bTEubWluICogbnVtMi5taW4sIG51bTEubWluICogbnVtMi5tYXgsIG51bTEubWF4ICogbnVtMi5taW4sIG51bTEubWF4ICogbnVtMi5tYXgpOwogIHJldHVybiBuZXcgQXN0QmluYXJ5T3BlcmF0aW9uKCIqIiwgbnVtMSwgbnVtMiwgbWluLCBtYXgpOwp9CmZ1bmN0aW9uIGJ1aWxkU3ViT3BlcmF0aW9uKG51bTEsIG51bTIpIHsKICBpZiAobnVtMi50eXBlID09PSAibGl0ZXJhbCIpIHsKICAgIGlmIChudW0yLm51bWJlciA9PT0gMCkgewogICAgICByZXR1cm4gbnVtMTsKICAgIH0gZWxzZSBpZiAobnVtMS50eXBlID09PSAibGl0ZXJhbCIpIHsKICAgICAgcmV0dXJuIG5ldyBBc3RMaXRlcmFsKG51bTEubnVtYmVyIC0gbnVtMi5udW1iZXIpOwogICAgfQogIH0KICBpZiAobnVtMi50eXBlID09PSAiYmluYXJ5IiAmJiBudW0yLm9wID09PSAiLSIgJiYgbnVtMS50eXBlID09PSAibGl0ZXJhbCIgJiYgbnVtMS5udW1iZXIgPT09IDEgJiYgbnVtMi5hcmcxLnR5cGUgPT09ICJsaXRlcmFsIiAmJiBudW0yLmFyZzEubnVtYmVyID09PSAxKSB7CiAgICByZXR1cm4gbnVtMi5hcmcyOwogIH0KICByZXR1cm4gbmV3IEFzdEJpbmFyeU9wZXJhdGlvbigiLSIsIG51bTEsIG51bTIsIG51bTEubWluIC0gbnVtMi5tYXgsIG51bTEubWF4IC0gbnVtMi5taW4pOwp9CmZ1bmN0aW9uIGJ1aWxkTWluT3BlcmF0aW9uKG51bTEsIG1heCkgewogIGlmIChudW0xLm1pbiA+PSBtYXgpIHsKICAgIHJldHVybiBuZXcgQXN0TGl0ZXJhbChtYXgpOwogIH0gZWxzZSBpZiAobnVtMS5tYXggPD0gbWF4KSB7CiAgICByZXR1cm4gbnVtMTsKICB9CiAgcmV0dXJuIG5ldyBBc3RNaW4obnVtMSwgbWF4KTsKfQpjbGFzcyBQb3N0U2NyaXB0Q29tcGlsZXIgewogIGNvbXBpbGUoY29kZSwgZG9tYWluLCByYW5nZSkgewogICAgY29uc3Qgc3RhY2sgPSBbXTsKICAgIGNvbnN0IGluc3RydWN0aW9ucyA9IFtdOwogICAgY29uc3QgaW5wdXRTaXplID0gZG9tYWluLmxlbmd0aCA+PiAxLAogICAgICBvdXRwdXRTaXplID0gcmFuZ2UubGVuZ3RoID4+IDE7CiAgICBsZXQgbGFzdFJlZ2lzdGVyID0gMDsKICAgIGxldCBuLCBqOwogICAgbGV0IG51bTEsIG51bTIsIGFzdDEsIGFzdDIsIHRtcFZhciwgaXRlbTsKICAgIGZvciAobGV0IGkgPSAwOyBpIDwgaW5wdXRTaXplOyBpKyspIHsKICAgICAgc3RhY2sucHVzaChuZXcgQXN0QXJndW1lbnQoaSwgZG9tYWluW2kgKiAyXSwgZG9tYWluW2kgKiAyICsgMV0pKTsKICAgIH0KICAgIGZvciAobGV0IGkgPSAwLCBpaSA9IGNvZGUubGVuZ3RoOyBpIDwgaWk7IGkrKykgewogICAgICBpdGVtID0gY29kZVtpXTsKICAgICAgaWYgKHR5cGVvZiBpdGVtID09PSAibnVtYmVyIikgewogICAgICAgIHN0YWNrLnB1c2gobmV3IEFzdExpdGVyYWwoaXRlbSkpOwogICAgICAgIGNvbnRpbnVlOwogICAgICB9CiAgICAgIHN3aXRjaCAoaXRlbSkgewogICAgICAgIGNhc2UgImFkZCI6CiAgICAgICAgICBpZiAoc3RhY2subGVuZ3RoIDwgMikgewogICAgICAgICAgICByZXR1cm4gbnVsbDsKICAgICAgICAgIH0KICAgICAgICAgIG51bTIgPSBzdGFjay5wb3AoKTsKICAgICAgICAgIG51bTEgPSBzdGFjay5wb3AoKTsKICAgICAgICAgIHN0YWNrLnB1c2goYnVpbGRBZGRPcGVyYXRpb24obnVtMSwgbnVtMikpOwogICAgICAgICAgYnJlYWs7CiAgICAgICAgY2FzZSAiY3ZyIjoKICAgICAgICAgIGlmIChzdGFjay5sZW5ndGggPCAxKSB7CiAgICAgICAgICAgIHJldHVybiBudWxsOwogICAgICAgICAgfQogICAgICAgICAgYnJlYWs7CiAgICAgICAgY2FzZSAibXVsIjoKICAgICAgICAgIGlmIChzdGFjay5sZW5ndGggPCAyKSB7CiAgICAgICAgICAgIHJldHVybiBudWxsOwogICAgICAgICAgfQogICAgICAgICAgbnVtMiA9IHN0YWNrLnBvcCgpOwogICAgICAgICAgbnVtMSA9IHN0YWNrLnBvcCgpOwogICAgICAgICAgc3RhY2sucHVzaChidWlsZE11bE9wZXJhdGlvbihudW0xLCBudW0yKSk7CiAgICAgICAgICBicmVhazsKICAgICAgICBjYXNlICJzdWIiOgogICAgICAgICAgaWYgKHN0YWNrLmxlbmd0aCA8IDIpIHsKICAgICAgICAgICAgcmV0dXJuIG51bGw7CiAgICAgICAgICB9CiAgICAgICAgICBudW0yID0gc3RhY2sucG9wKCk7CiAgICAgICAgICBudW0xID0gc3RhY2sucG9wKCk7CiAgICAgICAgICBzdGFjay5wdXNoKGJ1aWxkU3ViT3BlcmF0aW9uKG51bTEsIG51bTIpKTsKICAgICAgICAgIGJyZWFrOwogICAgICAgIGNhc2UgImV4Y2giOgogICAgICAgICAgaWYgKHN0YWNrLmxlbmd0aCA8IDIpIHsKICAgICAgICAgICAgcmV0dXJuIG51bGw7CiAgICAgICAgICB9CiAgICAgICAgICBhc3QxID0gc3RhY2sucG9wKCk7CiAgICAgICAgICBhc3QyID0gc3RhY2sucG9wKCk7CiAgICAgICAgICBzdGFjay5wdXNoKGFzdDEsIGFzdDIpOwogICAgICAgICAgYnJlYWs7CiAgICAgICAgY2FzZSAicG9wIjoKICAgICAgICAgIGlmIChzdGFjay5sZW5ndGggPCAxKSB7CiAgICAgICAgICAgIHJldHVybiBudWxsOwogICAgICAgICAgfQogICAgICAgICAgc3RhY2sucG9wKCk7CiAgICAgICAgICBicmVhazsKICAgICAgICBjYXNlICJpbmRleCI6CiAgICAgICAgICBpZiAoc3RhY2subGVuZ3RoIDwgMSkgewogICAgICAgICAgICByZXR1cm4gbnVsbDsKICAgICAgICAgIH0KICAgICAgICAgIG51bTEgPSBzdGFjay5wb3AoKTsKICAgICAgICAgIGlmIChudW0xLnR5cGUgIT09ICJsaXRlcmFsIikgewogICAgICAgICAgICByZXR1cm4gbnVsbDsKICAgICAgICAgIH0KICAgICAgICAgIG4gPSBudW0xLm51bWJlcjsKICAgICAgICAgIGlmIChuIDwgMCB8fCAhTnVtYmVyLmlzSW50ZWdlcihuKSB8fCBzdGFjay5sZW5ndGggPCBuKSB7CiAgICAgICAgICAgIHJldHVybiBudWxsOwogICAgICAgICAgfQogICAgICAgICAgYXN0MSA9IHN0YWNrW3N0YWNrLmxlbmd0aCAtIG4gLSAxXTsKICAgICAgICAgIGlmIChhc3QxLnR5cGUgPT09ICJsaXRlcmFsIiB8fCBhc3QxLnR5cGUgPT09ICJ2YXIiKSB7CiAgICAgICAgICAgIHN0YWNrLnB1c2goYXN0MSk7CiAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgfQogICAgICAgICAgdG1wVmFyID0gbmV3IEFzdFZhcmlhYmxlKGxhc3RSZWdpc3RlcisrLCBhc3QxLm1pbiwgYXN0MS5tYXgpOwogICAgICAgICAgc3RhY2tbc3RhY2subGVuZ3RoIC0gbiAtIDFdID0gdG1wVmFyOwogICAgICAgICAgc3RhY2sucHVzaCh0bXBWYXIpOwogICAgICAgICAgaW5zdHJ1Y3Rpb25zLnB1c2gobmV3IEFzdFZhcmlhYmxlRGVmaW5pdGlvbih0bXBWYXIsIGFzdDEpKTsKICAgICAgICAgIGJyZWFrOwogICAgICAgIGNhc2UgImR1cCI6CiAgICAgICAgICBpZiAoc3RhY2subGVuZ3RoIDwgMSkgewogICAgICAgICAgICByZXR1cm4gbnVsbDsKICAgICAgICAgIH0KICAgICAgICAgIGlmICh0eXBlb2YgY29kZVtpICsgMV0gPT09ICJudW1iZXIiICYmIGNvZGVbaSArIDJdID09PSAiZ3QiICYmIGNvZGVbaSArIDNdID09PSBpICsgNyAmJiBjb2RlW2kgKyA0XSA9PT0gImp6IiAmJiBjb2RlW2kgKyA1XSA9PT0gInBvcCIgJiYgY29kZVtpICsgNl0gPT09IGNvZGVbaSArIDFdKSB7CiAgICAgICAgICAgIG51bTEgPSBzdGFjay5wb3AoKTsKICAgICAgICAgICAgc3RhY2sucHVzaChidWlsZE1pbk9wZXJhdGlvbihudW0xLCBjb2RlW2kgKyAxXSkpOwogICAgICAgICAgICBpICs9IDY7CiAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgfQogICAgICAgICAgYXN0MSA9IHN0YWNrLmF0KC0xKTsKICAgICAgICAgIGlmIChhc3QxLnR5cGUgPT09ICJsaXRlcmFsIiB8fCBhc3QxLnR5cGUgPT09ICJ2YXIiKSB7CiAgICAgICAgICAgIHN0YWNrLnB1c2goYXN0MSk7CiAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgfQogICAgICAgICAgdG1wVmFyID0gbmV3IEFzdFZhcmlhYmxlKGxhc3RSZWdpc3RlcisrLCBhc3QxLm1pbiwgYXN0MS5tYXgpOwogICAgICAgICAgc3RhY2tbc3RhY2subGVuZ3RoIC0gMV0gPSB0bXBWYXI7CiAgICAgICAgICBzdGFjay5wdXNoKHRtcFZhcik7CiAgICAgICAgICBpbnN0cnVjdGlvbnMucHVzaChuZXcgQXN0VmFyaWFibGVEZWZpbml0aW9uKHRtcFZhciwgYXN0MSkpOwogICAgICAgICAgYnJlYWs7CiAgICAgICAgY2FzZSAicm9sbCI6CiAgICAgICAgICBpZiAoc3RhY2subGVuZ3RoIDwgMikgewogICAgICAgICAgICByZXR1cm4gbnVsbDsKICAgICAgICAgIH0KICAgICAgICAgIG51bTIgPSBzdGFjay5wb3AoKTsKICAgICAgICAgIG51bTEgPSBzdGFjay5wb3AoKTsKICAgICAgICAgIGlmIChudW0yLnR5cGUgIT09ICJsaXRlcmFsIiB8fCBudW0xLnR5cGUgIT09ICJsaXRlcmFsIikgewogICAgICAgICAgICByZXR1cm4gbnVsbDsKICAgICAgICAgIH0KICAgICAgICAgIGogPSBudW0yLm51bWJlcjsKICAgICAgICAgIG4gPSBudW0xLm51bWJlcjsKICAgICAgICAgIGlmIChuIDw9IDAgfHwgIU51bWJlci5pc0ludGVnZXIobikgfHwgIU51bWJlci5pc0ludGVnZXIoaikgfHwgc3RhY2subGVuZ3RoIDwgbikgewogICAgICAgICAgICByZXR1cm4gbnVsbDsKICAgICAgICAgIH0KICAgICAgICAgIGogPSAoaiAlIG4gKyBuKSAlIG47CiAgICAgICAgICBpZiAoaiA9PT0gMCkgewogICAgICAgICAgICBicmVhazsKICAgICAgICAgIH0KICAgICAgICAgIHN0YWNrLnB1c2goLi4uc3RhY2suc3BsaWNlKHN0YWNrLmxlbmd0aCAtIG4sIG4gLSBqKSk7CiAgICAgICAgICBicmVhazsKICAgICAgICBkZWZhdWx0OgogICAgICAgICAgcmV0dXJuIG51bGw7CiAgICAgIH0KICAgIH0KICAgIGlmIChzdGFjay5sZW5ndGggIT09IG91dHB1dFNpemUpIHsKICAgICAgcmV0dXJuIG51bGw7CiAgICB9CiAgICBjb25zdCByZXN1bHQgPSBbXTsKICAgIGZvciAoY29uc3QgaW5zdHJ1Y3Rpb24gb2YgaW5zdHJ1Y3Rpb25zKSB7CiAgICAgIGNvbnN0IHN0YXRlbWVudEJ1aWxkZXIgPSBuZXcgRXhwcmVzc2lvbkJ1aWxkZXJWaXNpdG9yKCk7CiAgICAgIGluc3RydWN0aW9uLnZpc2l0KHN0YXRlbWVudEJ1aWxkZXIpOwogICAgICByZXN1bHQucHVzaChzdGF0ZW1lbnRCdWlsZGVyLnRvU3RyaW5nKCkpOwogICAgfQogICAgZm9yIChsZXQgaSA9IDAsIGlpID0gc3RhY2subGVuZ3RoOyBpIDwgaWk7IGkrKykgewogICAgICBjb25zdCBleHByID0gc3RhY2tbaV0sCiAgICAgICAgc3RhdGVtZW50QnVpbGRlciA9IG5ldyBFeHByZXNzaW9uQnVpbGRlclZpc2l0b3IoKTsKICAgICAgZXhwci52aXNpdChzdGF0ZW1lbnRCdWlsZGVyKTsKICAgICAgY29uc3QgbWluID0gcmFuZ2VbaSAqIDJdLAogICAgICAgIG1heCA9IHJhbmdlW2kgKiAyICsgMV07CiAgICAgIGNvbnN0IG91dCA9IFtzdGF0ZW1lbnRCdWlsZGVyLnRvU3RyaW5nKCldOwogICAgICBpZiAobWluID4gZXhwci5taW4pIHsKICAgICAgICBvdXQudW5zaGlmdCgiTWF0aC5tYXgoIiwgbWluLCAiLCAiKTsKICAgICAgICBvdXQucHVzaCgiKSIpOwogICAgICB9CiAgICAgIGlmIChtYXggPCBleHByLm1heCkgewogICAgICAgIG91dC51bnNoaWZ0KCJNYXRoLm1pbigiLCBtYXgsICIsICIpOwogICAgICAgIG91dC5wdXNoKCIpIik7CiAgICAgIH0KICAgICAgb3V0LnVuc2hpZnQoImRlc3RbZGVzdE9mZnNldCArICIsIGksICJdID0gIik7CiAgICAgIG91dC5wdXNoKCI7Iik7CiAgICAgIHJlc3VsdC5wdXNoKG91dC5qb2luKCIiKSk7CiAgICB9CiAgICByZXR1cm4gcmVzdWx0LmpvaW4oIlxuIik7CiAgfQp9CmV4cG9ydHMuUG9zdFNjcmlwdENvbXBpbGVyID0gUG9zdFNjcmlwdENvbXBpbGVyOwoKLyoqKi8gfSksCi8qIDU4ICovCi8qKiovICgoX191bnVzZWRfd2VicGFja19tb2R1bGUsIGV4cG9ydHMsIF9fd19wZGZqc19yZXF1aXJlX18pID0+IHsKCgoKT2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsICJfX2VzTW9kdWxlIiwgKHsKICB2YWx1ZTogdHJ1ZQp9KSk7CmV4cG9ydHMuUG9zdFNjcmlwdFBhcnNlciA9IGV4cG9ydHMuUG9zdFNjcmlwdExleGVyID0gdm9pZCAwOwp2YXIgX3V0aWwgPSBfX3dfcGRmanNfcmVxdWlyZV9fKDIpOwp2YXIgX3ByaW1pdGl2ZXMgPSBfX3dfcGRmanNfcmVxdWlyZV9fKDQpOwp2YXIgX2NvcmVfdXRpbHMgPSBfX3dfcGRmanNfcmVxdWlyZV9fKDMpOwpjbGFzcyBQb3N0U2NyaXB0UGFyc2VyIHsKICBjb25zdHJ1Y3RvcihsZXhlcikgewogICAgdGhpcy5sZXhlciA9IGxleGVyOwogICAgdGhpcy5vcGVyYXRvcnMgPSBbXTsKICAgIHRoaXMudG9rZW4gPSBudWxsOwogICAgdGhpcy5wcmV2ID0gbnVsbDsKICB9CiAgbmV4dFRva2VuKCkgewogICAgdGhpcy5wcmV2ID0gdGhpcy50b2tlbjsKICAgIHRoaXMudG9rZW4gPSB0aGlzLmxleGVyLmdldFRva2VuKCk7CiAgfQogIGFjY2VwdCh0eXBlKSB7CiAgICBpZiAodGhpcy50b2tlbi50eXBlID09PSB0eXBlKSB7CiAgICAgIHRoaXMubmV4dFRva2VuKCk7CiAgICAgIHJldHVybiB0cnVlOwogICAgfQogICAgcmV0dXJuIGZhbHNlOwogIH0KICBleHBlY3QodHlwZSkgewogICAgaWYgKHRoaXMuYWNjZXB0KHR5cGUpKSB7CiAgICAgIHJldHVybiB0cnVlOwogICAgfQogICAgdGhyb3cgbmV3IF91dGlsLkZvcm1hdEVycm9yKGBVbmV4cGVjdGVkIHN5bWJvbDogZm91bmQgJHt0aGlzLnRva2VuLnR5cGV9IGV4cGVjdGVkICR7dHlwZX0uYCk7CiAgfQogIHBhcnNlKCkgewogICAgdGhpcy5uZXh0VG9rZW4oKTsKICAgIHRoaXMuZXhwZWN0KFBvc3RTY3JpcHRUb2tlblR5cGVzLkxCUkFDRSk7CiAgICB0aGlzLnBhcnNlQmxvY2soKTsKICAgIHRoaXMuZXhwZWN0KFBvc3RTY3JpcHRUb2tlblR5cGVzLlJCUkFDRSk7CiAgICByZXR1cm4gdGhpcy5vcGVyYXRvcnM7CiAgfQogIHBhcnNlQmxvY2soKSB7CiAgICB3aGlsZSAodHJ1ZSkgewogICAgICBpZiAodGhpcy5hY2NlcHQoUG9zdFNjcmlwdFRva2VuVHlwZXMuTlVNQkVSKSkgewogICAgICAgIHRoaXMub3BlcmF0b3JzLnB1c2godGhpcy5wcmV2LnZhbHVlKTsKICAgICAgfSBlbHNlIGlmICh0aGlzLmFjY2VwdChQb3N0U2NyaXB0VG9rZW5UeXBlcy5PUEVSQVRPUikpIHsKICAgICAgICB0aGlzLm9wZXJhdG9ycy5wdXNoKHRoaXMucHJldi52YWx1ZSk7CiAgICAgIH0gZWxzZSBpZiAodGhpcy5hY2NlcHQoUG9zdFNjcmlwdFRva2VuVHlwZXMuTEJSQUNFKSkgewogICAgICAgIHRoaXMucGFyc2VDb25kaXRpb24oKTsKICAgICAgfSBlbHNlIHsKICAgICAgICByZXR1cm47CiAgICAgIH0KICAgIH0KICB9CiAgcGFyc2VDb25kaXRpb24oKSB7CiAgICBjb25zdCBjb25kaXRpb25Mb2NhdGlvbiA9IHRoaXMub3BlcmF0b3JzLmxlbmd0aDsKICAgIHRoaXMub3BlcmF0b3JzLnB1c2gobnVsbCwgbnVsbCk7CiAgICB0aGlzLnBhcnNlQmxvY2soKTsKICAgIHRoaXMuZXhwZWN0KFBvc3RTY3JpcHRUb2tlblR5cGVzLlJCUkFDRSk7CiAgICBpZiAodGhpcy5hY2NlcHQoUG9zdFNjcmlwdFRva2VuVHlwZXMuSUYpKSB7CiAgICAgIHRoaXMub3BlcmF0b3JzW2NvbmRpdGlvbkxvY2F0aW9uXSA9IHRoaXMub3BlcmF0b3JzLmxlbmd0aDsKICAgICAgdGhpcy5vcGVyYXRvcnNbY29uZGl0aW9uTG9jYXRpb24gKyAxXSA9ICJqeiI7CiAgICB9IGVsc2UgaWYgKHRoaXMuYWNjZXB0KFBvc3RTY3JpcHRUb2tlblR5cGVzLkxCUkFDRSkpIHsKICAgICAgY29uc3QganVtcExvY2F0aW9uID0gdGhpcy5vcGVyYXRvcnMubGVuZ3RoOwogICAgICB0aGlzLm9wZXJhdG9ycy5wdXNoKG51bGwsIG51bGwpOwogICAgICBjb25zdCBlbmRPZlRydWUgPSB0aGlzLm9wZXJhdG9ycy5sZW5ndGg7CiAgICAgIHRoaXMucGFyc2VCbG9jaygpOwogICAgICB0aGlzLmV4cGVjdChQb3N0U2NyaXB0VG9rZW5UeXBlcy5SQlJBQ0UpOwogICAgICB0aGlzLmV4cGVjdChQb3N0U2NyaXB0VG9rZW5UeXBlcy5JRkVMU0UpOwogICAgICB0aGlzLm9wZXJhdG9yc1tqdW1wTG9jYXRpb25dID0gdGhpcy5vcGVyYXRvcnMubGVuZ3RoOwogICAgICB0aGlzLm9wZXJhdG9yc1tqdW1wTG9jYXRpb24gKyAxXSA9ICJqIjsKICAgICAgdGhpcy5vcGVyYXRvcnNbY29uZGl0aW9uTG9jYXRpb25dID0gZW5kT2ZUcnVlOwogICAgICB0aGlzLm9wZXJhdG9yc1tjb25kaXRpb25Mb2NhdGlvbiArIDFdID0gImp6IjsKICAgIH0gZWxzZSB7CiAgICAgIHRocm93IG5ldyBfdXRpbC5Gb3JtYXRFcnJvcigiUFMgRnVuY3Rpb246IGVycm9yIHBhcnNpbmcgY29uZGl0aW9uYWwuIik7CiAgICB9CiAgfQp9CmV4cG9ydHMuUG9zdFNjcmlwdFBhcnNlciA9IFBvc3RTY3JpcHRQYXJzZXI7CmNvbnN0IFBvc3RTY3JpcHRUb2tlblR5cGVzID0gewogIExCUkFDRTogMCwKICBSQlJBQ0U6IDEsCiAgTlVNQkVSOiAyLAogIE9QRVJBVE9SOiAzLAogIElGOiA0LAogIElGRUxTRTogNQp9OwpjbGFzcyBQb3N0U2NyaXB0VG9rZW4gewogIHN0YXRpYyBnZXQgb3BDYWNoZSgpIHsKICAgIHJldHVybiAoMCwgX3V0aWwuc2hhZG93KSh0aGlzLCAib3BDYWNoZSIsIE9iamVjdC5jcmVhdGUobnVsbCkpOwogIH0KICBjb25zdHJ1Y3Rvcih0eXBlLCB2YWx1ZSkgewogICAgdGhpcy50eXBlID0gdHlwZTsKICAgIHRoaXMudmFsdWUgPSB2YWx1ZTsKICB9CiAgc3RhdGljIGdldE9wZXJhdG9yKG9wKSB7CiAgICByZXR1cm4gUG9zdFNjcmlwdFRva2VuLm9wQ2FjaGVbb3BdIHx8PSBuZXcgUG9zdFNjcmlwdFRva2VuKFBvc3RTY3JpcHRUb2tlblR5cGVzLk9QRVJBVE9SLCBvcCk7CiAgfQogIHN0YXRpYyBnZXQgTEJSQUNFKCkgewogICAgcmV0dXJuICgwLCBfdXRpbC5zaGFkb3cpKHRoaXMsICJMQlJBQ0UiLCBuZXcgUG9zdFNjcmlwdFRva2VuKFBvc3RTY3JpcHRUb2tlblR5cGVzLkxCUkFDRSwgInsiKSk7CiAgfQogIHN0YXRpYyBnZXQgUkJSQUNFKCkgewogICAgcmV0dXJuICgwLCBfdXRpbC5zaGFkb3cpKHRoaXMsICJSQlJBQ0UiLCBuZXcgUG9zdFNjcmlwdFRva2VuKFBvc3RTY3JpcHRUb2tlblR5cGVzLlJCUkFDRSwgIn0iKSk7CiAgfQogIHN0YXRpYyBnZXQgSUYoKSB7CiAgICByZXR1cm4gKDAsIF91dGlsLnNoYWRvdykodGhpcywgIklGIiwgbmV3IFBvc3RTY3JpcHRUb2tlbihQb3N0U2NyaXB0VG9rZW5UeXBlcy5JRiwgIklGIikpOwogIH0KICBzdGF0aWMgZ2V0IElGRUxTRSgpIHsKICAgIHJldHVybiAoMCwgX3V0aWwuc2hhZG93KSh0aGlzLCAiSUZFTFNFIiwgbmV3IFBvc3RTY3JpcHRUb2tlbihQb3N0U2NyaXB0VG9rZW5UeXBlcy5JRkVMU0UsICJJRkVMU0UiKSk7CiAgfQp9CmNsYXNzIFBvc3RTY3JpcHRMZXhlciB7CiAgY29uc3RydWN0b3Ioc3RyZWFtKSB7CiAgICB0aGlzLnN0cmVhbSA9IHN0cmVhbTsKICAgIHRoaXMubmV4dENoYXIoKTsKICAgIHRoaXMuc3RyQnVmID0gW107CiAgfQogIG5leHRDaGFyKCkgewogICAgcmV0dXJuIHRoaXMuY3VycmVudENoYXIgPSB0aGlzLnN0cmVhbS5nZXRCeXRlKCk7CiAgfQogIGdldFRva2VuKCkgewogICAgbGV0IGNvbW1lbnQgPSBmYWxzZTsKICAgIGxldCBjaCA9IHRoaXMuY3VycmVudENoYXI7CiAgICB3aGlsZSAodHJ1ZSkgewogICAgICBpZiAoY2ggPCAwKSB7CiAgICAgICAgcmV0dXJuIF9wcmltaXRpdmVzLkVPRjsKICAgICAgfQogICAgICBpZiAoY29tbWVudCkgewogICAgICAgIGlmIChjaCA9PT0gMHgwYSB8fCBjaCA9PT0gMHgwZCkgewogICAgICAgICAgY29tbWVudCA9IGZhbHNlOwogICAgICAgIH0KICAgICAgfSBlbHNlIGlmIChjaCA9PT0gMHgyNSkgewogICAgICAgIGNvbW1lbnQgPSB0cnVlOwogICAgICB9IGVsc2UgaWYgKCEoMCwgX2NvcmVfdXRpbHMuaXNXaGl0ZVNwYWNlKShjaCkpIHsKICAgICAgICBicmVhazsKICAgICAgfQogICAgICBjaCA9IHRoaXMubmV4dENoYXIoKTsKICAgIH0KICAgIHN3aXRjaCAoY2ggfCAwKSB7CiAgICAgIGNhc2UgMHgzMDoKICAgICAgY2FzZSAweDMxOgogICAgICBjYXNlIDB4MzI6CiAgICAgIGNhc2UgMHgzMzoKICAgICAgY2FzZSAweDM0OgogICAgICBjYXNlIDB4MzU6CiAgICAgIGNhc2UgMHgzNjoKICAgICAgY2FzZSAweDM3OgogICAgICBjYXNlIDB4Mzg6CiAgICAgIGNhc2UgMHgzOToKICAgICAgY2FzZSAweDJiOgogICAgICBjYXNlIDB4MmQ6CiAgICAgIGNhc2UgMHgyZToKICAgICAgICByZXR1cm4gbmV3IFBvc3RTY3JpcHRUb2tlbihQb3N0U2NyaXB0VG9rZW5UeXBlcy5OVU1CRVIsIHRoaXMuZ2V0TnVtYmVyKCkpOwogICAgICBjYXNlIDB4N2I6CiAgICAgICAgdGhpcy5uZXh0Q2hhcigpOwogICAgICAgIHJldHVybiBQb3N0U2NyaXB0VG9rZW4uTEJSQUNFOwogICAgICBjYXNlIDB4N2Q6CiAgICAgICAgdGhpcy5uZXh0Q2hhcigpOwogICAgICAgIHJldHVybiBQb3N0U2NyaXB0VG9rZW4uUkJSQUNFOwogICAgfQogICAgY29uc3Qgc3RyQnVmID0gdGhpcy5zdHJCdWY7CiAgICBzdHJCdWYubGVuZ3RoID0gMDsKICAgIHN0ckJ1ZlswXSA9IFN0cmluZy5mcm9tQ2hhckNvZGUoY2gpOwogICAgd2hpbGUgKChjaCA9IHRoaXMubmV4dENoYXIoKSkgPj0gMCAmJiAoY2ggPj0gMHg0MSAmJiBjaCA8PSAweDVhIHx8IGNoID49IDB4NjEgJiYgY2ggPD0gMHg3YSkpIHsKICAgICAgc3RyQnVmLnB1c2goU3RyaW5nLmZyb21DaGFyQ29kZShjaCkpOwogICAgfQogICAgY29uc3Qgc3RyID0gc3RyQnVmLmpvaW4oIiIpOwogICAgc3dpdGNoIChzdHIudG9Mb3dlckNhc2UoKSkgewogICAgICBjYXNlICJpZiI6CiAgICAgICAgcmV0dXJuIFBvc3RTY3JpcHRUb2tlbi5JRjsKICAgICAgY2FzZSAiaWZlbHNlIjoKICAgICAgICByZXR1cm4gUG9zdFNjcmlwdFRva2VuLklGRUxTRTsKICAgICAgZGVmYXVsdDoKICAgICAgICByZXR1cm4gUG9zdFNjcmlwdFRva2VuLmdldE9wZXJhdG9yKHN0cik7CiAgICB9CiAgfQogIGdldE51bWJlcigpIHsKICAgIGxldCBjaCA9IHRoaXMuY3VycmVudENoYXI7CiAgICBjb25zdCBzdHJCdWYgPSB0aGlzLnN0ckJ1ZjsKICAgIHN0ckJ1Zi5sZW5ndGggPSAwOwogICAgc3RyQnVmWzBdID0gU3RyaW5nLmZyb21DaGFyQ29kZShjaCk7CiAgICB3aGlsZSAoKGNoID0gdGhpcy5uZXh0Q2hhcigpKSA+PSAwKSB7CiAgICAgIGlmIChjaCA+PSAweDMwICYmIGNoIDw9IDB4MzkgfHwgY2ggPT09IDB4MmQgfHwgY2ggPT09IDB4MmUpIHsKICAgICAgICBzdHJCdWYucHVzaChTdHJpbmcuZnJvbUNoYXJDb2RlKGNoKSk7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgYnJlYWs7CiAgICAgIH0KICAgIH0KICAgIGNvbnN0IHZhbHVlID0gcGFyc2VGbG9hdChzdHJCdWYuam9pbigiIikpOwogICAgaWYgKGlzTmFOKHZhbHVlKSkgewogICAgICB0aHJvdyBuZXcgX3V0aWwuRm9ybWF0RXJyb3IoYEludmFsaWQgZmxvYXRpbmcgcG9pbnQgbnVtYmVyOiAke3ZhbHVlfWApOwogICAgfQogICAgcmV0dXJuIHZhbHVlOwogIH0KfQpleHBvcnRzLlBvc3RTY3JpcHRMZXhlciA9IFBvc3RTY3JpcHRMZXhlcjsKCi8qKiovIH0pLAovKiA1OSAqLwovKioqLyAoKF9fdW51c2VkX3dlYnBhY2tfbW9kdWxlLCBleHBvcnRzLCBfX3dfcGRmanNfcmVxdWlyZV9fKSA9PiB7CgoKCk9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCAiX19lc01vZHVsZSIsICh7CiAgdmFsdWU6IHRydWUKfSkpOwpleHBvcnRzLlJlZ2lvbmFsSW1hZ2VDYWNoZSA9IGV4cG9ydHMuTG9jYWxUaWxpbmdQYXR0ZXJuQ2FjaGUgPSBleHBvcnRzLkxvY2FsSW1hZ2VDYWNoZSA9IGV4cG9ydHMuTG9jYWxHU3RhdGVDYWNoZSA9IGV4cG9ydHMuTG9jYWxGdW5jdGlvbkNhY2hlID0gZXhwb3J0cy5Mb2NhbENvbG9yU3BhY2VDYWNoZSA9IGV4cG9ydHMuR2xvYmFsSW1hZ2VDYWNoZSA9IHZvaWQgMDsKdmFyIF91dGlsID0gX193X3BkZmpzX3JlcXVpcmVfXygyKTsKdmFyIF9wcmltaXRpdmVzID0gX193X3BkZmpzX3JlcXVpcmVfXyg0KTsKY2xhc3MgQmFzZUxvY2FsQ2FjaGUgewogIGNvbnN0cnVjdG9yKG9wdGlvbnMpIHsKICAgIGlmICh0aGlzLmNvbnN0cnVjdG9yID09PSBCYXNlTG9jYWxDYWNoZSkgewogICAgICAoMCwgX3V0aWwudW5yZWFjaGFibGUpKCJDYW5ub3QgaW5pdGlhbGl6ZSBCYXNlTG9jYWxDYWNoZS4iKTsKICAgIH0KICAgIHRoaXMuX29ubHlSZWZzID0gb3B0aW9ucz8ub25seVJlZnMgPT09IHRydWU7CiAgICBpZiAoIXRoaXMuX29ubHlSZWZzKSB7CiAgICAgIHRoaXMuX25hbWVSZWZNYXAgPSBuZXcgTWFwKCk7CiAgICAgIHRoaXMuX2ltYWdlTWFwID0gbmV3IE1hcCgpOwogICAgfQogICAgdGhpcy5faW1hZ2VDYWNoZSA9IG5ldyBfcHJpbWl0aXZlcy5SZWZTZXRDYWNoZSgpOwogIH0KICBnZXRCeU5hbWUobmFtZSkgewogICAgaWYgKHRoaXMuX29ubHlSZWZzKSB7CiAgICAgICgwLCBfdXRpbC51bnJlYWNoYWJsZSkoIlNob3VsZCBub3QgY2FsbCBgZ2V0QnlOYW1lYCBtZXRob2QuIik7CiAgICB9CiAgICBjb25zdCByZWYgPSB0aGlzLl9uYW1lUmVmTWFwLmdldChuYW1lKTsKICAgIGlmIChyZWYpIHsKICAgICAgcmV0dXJuIHRoaXMuZ2V0QnlSZWYocmVmKTsKICAgIH0KICAgIHJldHVybiB0aGlzLl9pbWFnZU1hcC5nZXQobmFtZSkgfHwgbnVsbDsKICB9CiAgZ2V0QnlSZWYocmVmKSB7CiAgICByZXR1cm4gdGhpcy5faW1hZ2VDYWNoZS5nZXQocmVmKSB8fCBudWxsOwogIH0KICBzZXQobmFtZSwgcmVmLCBkYXRhKSB7CiAgICAoMCwgX3V0aWwudW5yZWFjaGFibGUpKCJBYnN0cmFjdCBtZXRob2QgYHNldGAgY2FsbGVkLiIpOwogIH0KfQpjbGFzcyBMb2NhbEltYWdlQ2FjaGUgZXh0ZW5kcyBCYXNlTG9jYWxDYWNoZSB7CiAgc2V0KG5hbWUsIHJlZiA9IG51bGwsIGRhdGEpIHsKICAgIGlmICh0eXBlb2YgbmFtZSAhPT0gInN0cmluZyIpIHsKICAgICAgdGhyb3cgbmV3IEVycm9yKCdMb2NhbEltYWdlQ2FjaGUuc2V0IC0gZXhwZWN0ZWQgIm5hbWUiIGFyZ3VtZW50LicpOwogICAgfQogICAgaWYgKHJlZikgewogICAgICBpZiAodGhpcy5faW1hZ2VDYWNoZS5oYXMocmVmKSkgewogICAgICAgIHJldHVybjsKICAgICAgfQogICAgICB0aGlzLl9uYW1lUmVmTWFwLnNldChuYW1lLCByZWYpOwogICAgICB0aGlzLl9pbWFnZUNhY2hlLnB1dChyZWYsIGRhdGEpOwogICAgICByZXR1cm47CiAgICB9CiAgICBpZiAodGhpcy5faW1hZ2VNYXAuaGFzKG5hbWUpKSB7CiAgICAgIHJldHVybjsKICAgIH0KICAgIHRoaXMuX2ltYWdlTWFwLnNldChuYW1lLCBkYXRhKTsKICB9Cn0KZXhwb3J0cy5Mb2NhbEltYWdlQ2FjaGUgPSBMb2NhbEltYWdlQ2FjaGU7CmNsYXNzIExvY2FsQ29sb3JTcGFjZUNhY2hlIGV4dGVuZHMgQmFzZUxvY2FsQ2FjaGUgewogIHNldChuYW1lID0gbnVsbCwgcmVmID0gbnVsbCwgZGF0YSkgewogICAgaWYgKHR5cGVvZiBuYW1lICE9PSAic3RyaW5nIiAmJiAhcmVmKSB7CiAgICAgIHRocm93IG5ldyBFcnJvcignTG9jYWxDb2xvclNwYWNlQ2FjaGUuc2V0IC0gZXhwZWN0ZWQgIm5hbWUiIGFuZC9vciAicmVmIiBhcmd1bWVudC4nKTsKICAgIH0KICAgIGlmIChyZWYpIHsKICAgICAgaWYgKHRoaXMuX2ltYWdlQ2FjaGUuaGFzKHJlZikpIHsKICAgICAgICByZXR1cm47CiAgICAgIH0KICAgICAgaWYgKG5hbWUgIT09IG51bGwpIHsKICAgICAgICB0aGlzLl9uYW1lUmVmTWFwLnNldChuYW1lLCByZWYpOwogICAgICB9CiAgICAgIHRoaXMuX2ltYWdlQ2FjaGUucHV0KHJlZiwgZGF0YSk7CiAgICAgIHJldHVybjsKICAgIH0KICAgIGlmICh0aGlzLl9pbWFnZU1hcC5oYXMobmFtZSkpIHsKICAgICAgcmV0dXJuOwogICAgfQogICAgdGhpcy5faW1hZ2VNYXAuc2V0KG5hbWUsIGRhdGEpOwogIH0KfQpleHBvcnRzLkxvY2FsQ29sb3JTcGFjZUNhY2hlID0gTG9jYWxDb2xvclNwYWNlQ2FjaGU7CmNsYXNzIExvY2FsRnVuY3Rpb25DYWNoZSBleHRlbmRzIEJhc2VMb2NhbENhY2hlIHsKICBjb25zdHJ1Y3RvcihvcHRpb25zKSB7CiAgICBzdXBlcih7CiAgICAgIG9ubHlSZWZzOiB0cnVlCiAgICB9KTsKICB9CiAgc2V0KG5hbWUgPSBudWxsLCByZWYsIGRhdGEpIHsKICAgIGlmICghcmVmKSB7CiAgICAgIHRocm93IG5ldyBFcnJvcignTG9jYWxGdW5jdGlvbkNhY2hlLnNldCAtIGV4cGVjdGVkICJyZWYiIGFyZ3VtZW50LicpOwogICAgfQogICAgaWYgKHRoaXMuX2ltYWdlQ2FjaGUuaGFzKHJlZikpIHsKICAgICAgcmV0dXJuOwogICAgfQogICAgdGhpcy5faW1hZ2VDYWNoZS5wdXQocmVmLCBkYXRhKTsKICB9Cn0KZXhwb3J0cy5Mb2NhbEZ1bmN0aW9uQ2FjaGUgPSBMb2NhbEZ1bmN0aW9uQ2FjaGU7CmNsYXNzIExvY2FsR1N0YXRlQ2FjaGUgZXh0ZW5kcyBCYXNlTG9jYWxDYWNoZSB7CiAgc2V0KG5hbWUsIHJlZiA9IG51bGwsIGRhdGEpIHsKICAgIGlmICh0eXBlb2YgbmFtZSAhPT0gInN0cmluZyIpIHsKICAgICAgdGhyb3cgbmV3IEVycm9yKCdMb2NhbEdTdGF0ZUNhY2hlLnNldCAtIGV4cGVjdGVkICJuYW1lIiBhcmd1bWVudC4nKTsKICAgIH0KICAgIGlmIChyZWYpIHsKICAgICAgaWYgKHRoaXMuX2ltYWdlQ2FjaGUuaGFzKHJlZikpIHsKICAgICAgICByZXR1cm47CiAgICAgIH0KICAgICAgdGhpcy5fbmFtZVJlZk1hcC5zZXQobmFtZSwgcmVmKTsKICAgICAgdGhpcy5faW1hZ2VDYWNoZS5wdXQocmVmLCBkYXRhKTsKICAgICAgcmV0dXJuOwogICAgfQogICAgaWYgKHRoaXMuX2ltYWdlTWFwLmhhcyhuYW1lKSkgewogICAgICByZXR1cm47CiAgICB9CiAgICB0aGlzLl9pbWFnZU1hcC5zZXQobmFtZSwgZGF0YSk7CiAgfQp9CmV4cG9ydHMuTG9jYWxHU3RhdGVDYWNoZSA9IExvY2FsR1N0YXRlQ2FjaGU7CmNsYXNzIExvY2FsVGlsaW5nUGF0dGVybkNhY2hlIGV4dGVuZHMgQmFzZUxvY2FsQ2FjaGUgewogIGNvbnN0cnVjdG9yKG9wdGlvbnMpIHsKICAgIHN1cGVyKHsKICAgICAgb25seVJlZnM6IHRydWUKICAgIH0pOwogIH0KICBzZXQobmFtZSA9IG51bGwsIHJlZiwgZGF0YSkgewogICAgaWYgKCFyZWYpIHsKICAgICAgdGhyb3cgbmV3IEVycm9yKCdMb2NhbFRpbGluZ1BhdHRlcm5DYWNoZS5zZXQgLSBleHBlY3RlZCAicmVmIiBhcmd1bWVudC4nKTsKICAgIH0KICAgIGlmICh0aGlzLl9pbWFnZUNhY2hlLmhhcyhyZWYpKSB7CiAgICAgIHJldHVybjsKICAgIH0KICAgIHRoaXMuX2ltYWdlQ2FjaGUucHV0KHJlZiwgZGF0YSk7CiAgfQp9CmV4cG9ydHMuTG9jYWxUaWxpbmdQYXR0ZXJuQ2FjaGUgPSBMb2NhbFRpbGluZ1BhdHRlcm5DYWNoZTsKY2xhc3MgUmVnaW9uYWxJbWFnZUNhY2hlIGV4dGVuZHMgQmFzZUxvY2FsQ2FjaGUgewogIGNvbnN0cnVjdG9yKG9wdGlvbnMpIHsKICAgIHN1cGVyKHsKICAgICAgb25seVJlZnM6IHRydWUKICAgIH0pOwogIH0KICBzZXQobmFtZSA9IG51bGwsIHJlZiwgZGF0YSkgewogICAgaWYgKCFyZWYpIHsKICAgICAgdGhyb3cgbmV3IEVycm9yKCdSZWdpb25hbEltYWdlQ2FjaGUuc2V0IC0gZXhwZWN0ZWQgInJlZiIgYXJndW1lbnQuJyk7CiAgICB9CiAgICBpZiAodGhpcy5faW1hZ2VDYWNoZS5oYXMocmVmKSkgewogICAgICByZXR1cm47CiAgICB9CiAgICB0aGlzLl9pbWFnZUNhY2hlLnB1dChyZWYsIGRhdGEpOwogIH0KfQpleHBvcnRzLlJlZ2lvbmFsSW1hZ2VDYWNoZSA9IFJlZ2lvbmFsSW1hZ2VDYWNoZTsKY2xhc3MgR2xvYmFsSW1hZ2VDYWNoZSB7CiAgc3RhdGljIE5VTV9QQUdFU19USFJFU0hPTEQgPSAyOwogIHN0YXRpYyBNSU5fSU1BR0VTX1RPX0NBQ0hFID0gMTA7CiAgc3RhdGljIE1BWF9CWVRFX1NJWkUgPSA1ICogX3V0aWwuTUFYX0lNQUdFX1NJWkVfVE9fQ0FDSEU7CiAgY29uc3RydWN0b3IoKSB7CiAgICB0aGlzLl9yZWZDYWNoZSA9IG5ldyBfcHJpbWl0aXZlcy5SZWZTZXRDYWNoZSgpOwogICAgdGhpcy5faW1hZ2VDYWNoZSA9IG5ldyBfcHJpbWl0aXZlcy5SZWZTZXRDYWNoZSgpOwogIH0KICBnZXQgX2J5dGVTaXplKCkgewogICAgbGV0IGJ5dGVTaXplID0gMDsKICAgIGZvciAoY29uc3QgaW1hZ2VEYXRhIG9mIHRoaXMuX2ltYWdlQ2FjaGUpIHsKICAgICAgYnl0ZVNpemUgKz0gaW1hZ2VEYXRhLmJ5dGVTaXplOwogICAgfQogICAgcmV0dXJuIGJ5dGVTaXplOwogIH0KICBnZXQgX2NhY2hlTGltaXRSZWFjaGVkKCkgewogICAgaWYgKHRoaXMuX2ltYWdlQ2FjaGUuc2l6ZSA8IEdsb2JhbEltYWdlQ2FjaGUuTUlOX0lNQUdFU19UT19DQUNIRSkgewogICAgICByZXR1cm4gZmFsc2U7CiAgICB9CiAgICBpZiAodGhpcy5fYnl0ZVNpemUgPCBHbG9iYWxJbWFnZUNhY2hlLk1BWF9CWVRFX1NJWkUpIHsKICAgICAgcmV0dXJuIGZhbHNlOwogICAgfQogICAgcmV0dXJuIHRydWU7CiAgfQogIHNob3VsZENhY2hlKHJlZiwgcGFnZUluZGV4KSB7CiAgICBsZXQgcGFnZUluZGV4U2V0ID0gdGhpcy5fcmVmQ2FjaGUuZ2V0KHJlZik7CiAgICBpZiAoIXBhZ2VJbmRleFNldCkgewogICAgICBwYWdlSW5kZXhTZXQgPSBuZXcgU2V0KCk7CiAgICAgIHRoaXMuX3JlZkNhY2hlLnB1dChyZWYsIHBhZ2VJbmRleFNldCk7CiAgICB9CiAgICBwYWdlSW5kZXhTZXQuYWRkKHBhZ2VJbmRleCk7CiAgICBpZiAocGFnZUluZGV4U2V0LnNpemUgPCBHbG9iYWxJbWFnZUNhY2hlLk5VTV9QQUdFU19USFJFU0hPTEQpIHsKICAgICAgcmV0dXJuIGZhbHNlOwogICAgfQogICAgaWYgKCF0aGlzLl9pbWFnZUNhY2hlLmhhcyhyZWYpICYmIHRoaXMuX2NhY2hlTGltaXRSZWFjaGVkKSB7CiAgICAgIHJldHVybiBmYWxzZTsKICAgIH0KICAgIHJldHVybiB0cnVlOwogIH0KICBhZGRCeXRlU2l6ZShyZWYsIGJ5dGVTaXplKSB7CiAgICBjb25zdCBpbWFnZURhdGEgPSB0aGlzLl9pbWFnZUNhY2hlLmdldChyZWYpOwogICAgaWYgKCFpbWFnZURhdGEpIHsKICAgICAgcmV0dXJuOwogICAgfQogICAgaWYgKGltYWdlRGF0YS5ieXRlU2l6ZSkgewogICAgICByZXR1cm47CiAgICB9CiAgICBpbWFnZURhdGEuYnl0ZVNpemUgPSBieXRlU2l6ZTsKICB9CiAgZ2V0RGF0YShyZWYsIHBhZ2VJbmRleCkgewogICAgY29uc3QgcGFnZUluZGV4U2V0ID0gdGhpcy5fcmVmQ2FjaGUuZ2V0KHJlZik7CiAgICBpZiAoIXBhZ2VJbmRleFNldCkgewogICAgICByZXR1cm4gbnVsbDsKICAgIH0KICAgIGlmIChwYWdlSW5kZXhTZXQuc2l6ZSA8IEdsb2JhbEltYWdlQ2FjaGUuTlVNX1BBR0VTX1RIUkVTSE9MRCkgewogICAgICByZXR1cm4gbnVsbDsKICAgIH0KICAgIGNvbnN0IGltYWdlRGF0YSA9IHRoaXMuX2ltYWdlQ2FjaGUuZ2V0KHJlZik7CiAgICBpZiAoIWltYWdlRGF0YSkgewogICAgICByZXR1cm4gbnVsbDsKICAgIH0KICAgIHBhZ2VJbmRleFNldC5hZGQocGFnZUluZGV4KTsKICAgIHJldHVybiBpbWFnZURhdGE7CiAgfQogIHNldERhdGEocmVmLCBkYXRhKSB7CiAgICBpZiAoIXRoaXMuX3JlZkNhY2hlLmhhcyhyZWYpKSB7CiAgICAgIHRocm93IG5ldyBFcnJvcignR2xvYmFsSW1hZ2VDYWNoZS5zZXREYXRhIC0gZXhwZWN0ZWQgInNob3VsZENhY2hlIiB0byBoYXZlIGJlZW4gY2FsbGVkLicpOwogICAgfQogICAgaWYgKHRoaXMuX2ltYWdlQ2FjaGUuaGFzKHJlZikpIHsKICAgICAgcmV0dXJuOwogICAgfQogICAgaWYgKHRoaXMuX2NhY2hlTGltaXRSZWFjaGVkKSB7CiAgICAgICgwLCBfdXRpbC53YXJuKSgiR2xvYmFsSW1hZ2VDYWNoZS5zZXREYXRhIC0gY2FjaGUgbGltaXQgcmVhY2hlZC4iKTsKICAgICAgcmV0dXJuOwogICAgfQogICAgdGhpcy5faW1hZ2VDYWNoZS5wdXQocmVmLCBkYXRhKTsKICB9CiAgY2xlYXIob25seURhdGEgPSBmYWxzZSkgewogICAgaWYgKCFvbmx5RGF0YSkgewogICAgICB0aGlzLl9yZWZDYWNoZS5jbGVhcigpOwogICAgfQogICAgdGhpcy5faW1hZ2VDYWNoZS5jbGVhcigpOwogIH0KfQpleHBvcnRzLkdsb2JhbEltYWdlQ2FjaGUgPSBHbG9iYWxJbWFnZUNhY2hlOwoKLyoqKi8gfSksCi8qIDYwICovCi8qKiovICgoX191bnVzZWRfd2VicGFja19tb2R1bGUsIGV4cG9ydHMsIF9fd19wZGZqc19yZXF1aXJlX18pID0+IHsKCgoKT2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsICJfX2VzTW9kdWxlIiwgKHsKICB2YWx1ZTogdHJ1ZQp9KSk7CmV4cG9ydHMuYmlkaSA9IGJpZGk7CnZhciBfdXRpbCA9IF9fd19wZGZqc19yZXF1aXJlX18oMik7CmNvbnN0IGJhc2VUeXBlcyA9IFsiQk4iLCAiQk4iLCAiQk4iLCAiQk4iLCAiQk4iLCAiQk4iLCAiQk4iLCAiQk4iLCAiQk4iLCAiUyIsICJCIiwgIlMiLCAiV1MiLCAiQiIsICJCTiIsICJCTiIsICJCTiIsICJCTiIsICJCTiIsICJCTiIsICJCTiIsICJCTiIsICJCTiIsICJCTiIsICJCTiIsICJCTiIsICJCTiIsICJCTiIsICJCIiwgIkIiLCAiQiIsICJTIiwgIldTIiwgIk9OIiwgIk9OIiwgIkVUIiwgIkVUIiwgIkVUIiwgIk9OIiwgIk9OIiwgIk9OIiwgIk9OIiwgIk9OIiwgIkVTIiwgIkNTIiwgIkVTIiwgIkNTIiwgIkNTIiwgIkVOIiwgIkVOIiwgIkVOIiwgIkVOIiwgIkVOIiwgIkVOIiwgIkVOIiwgIkVOIiwgIkVOIiwgIkVOIiwgIkNTIiwgIk9OIiwgIk9OIiwgIk9OIiwgIk9OIiwgIk9OIiwgIk9OIiwgIkwiLCAiTCIsICJMIiwgIkwiLCAiTCIsICJMIiwgIkwiLCAiTCIsICJMIiwgIkwiLCAiTCIsICJMIiwgIkwiLCAiTCIsICJMIiwgIkwiLCAiTCIsICJMIiwgIkwiLCAiTCIsICJMIiwgIkwiLCAiTCIsICJMIiwgIkwiLCAiTCIsICJPTiIsICJPTiIsICJPTiIsICJPTiIsICJPTiIsICJPTiIsICJMIiwgIkwiLCAiTCIsICJMIiwgIkwiLCAiTCIsICJMIiwgIkwiLCAiTCIsICJMIiwgIkwiLCAiTCIsICJMIiwgIkwiLCAiTCIsICJMIiwgIkwiLCAiTCIsICJMIiwgIkwiLCAiTCIsICJMIiwgIkwiLCAiTCIsICJMIiwgIkwiLCAiT04iLCAiT04iLCAiT04iLCAiT04iLCAiQk4iLCAiQk4iLCAiQk4iLCAiQk4iLCAiQk4iLCAiQk4iLCAiQiIsICJCTiIsICJCTiIsICJCTiIsICJCTiIsICJCTiIsICJCTiIsICJCTiIsICJCTiIsICJCTiIsICJCTiIsICJCTiIsICJCTiIsICJCTiIsICJCTiIsICJCTiIsICJCTiIsICJCTiIsICJCTiIsICJCTiIsICJCTiIsICJCTiIsICJCTiIsICJCTiIsICJCTiIsICJCTiIsICJCTiIsICJDUyIsICJPTiIsICJFVCIsICJFVCIsICJFVCIsICJFVCIsICJPTiIsICJPTiIsICJPTiIsICJPTiIsICJMIiwgIk9OIiwgIk9OIiwgIkJOIiwgIk9OIiwgIk9OIiwgIkVUIiwgIkVUIiwgIkVOIiwgIkVOIiwgIk9OIiwgIkwiLCAiT04iLCAiT04iLCAiT04iLCAiRU4iLCAiTCIsICJPTiIsICJPTiIsICJPTiIsICJPTiIsICJPTiIsICJMIiwgIkwiLCAiTCIsICJMIiwgIkwiLCAiTCIsICJMIiwgIkwiLCAiTCIsICJMIiwgIkwiLCAiTCIsICJMIiwgIkwiLCAiTCIsICJMIiwgIkwiLCAiTCIsICJMIiwgIkwiLCAiTCIsICJMIiwgIkwiLCAiT04iLCAiTCIsICJMIiwgIkwiLCAiTCIsICJMIiwgIkwiLCAiTCIsICJMIiwgIkwiLCAiTCIsICJMIiwgIkwiLCAiTCIsICJMIiwgIkwiLCAiTCIsICJMIiwgIkwiLCAiTCIsICJMIiwgIkwiLCAiTCIsICJMIiwgIkwiLCAiTCIsICJMIiwgIkwiLCAiTCIsICJMIiwgIkwiLCAiTCIsICJPTiIsICJMIiwgIkwiLCAiTCIsICJMIiwgIkwiLCAiTCIsICJMIiwgIkwiXTsKY29uc3QgYXJhYmljVHlwZXMgPSBbIkFOIiwgIkFOIiwgIkFOIiwgIkFOIiwgIkFOIiwgIkFOIiwgIk9OIiwgIk9OIiwgIkFMIiwgIkVUIiwgIkVUIiwgIkFMIiwgIkNTIiwgIkFMIiwgIk9OIiwgIk9OIiwgIk5TTSIsICJOU00iLCAiTlNNIiwgIk5TTSIsICJOU00iLCAiTlNNIiwgIk5TTSIsICJOU00iLCAiTlNNIiwgIk5TTSIsICJOU00iLCAiQUwiLCAiQUwiLCAiIiwgIkFMIiwgIkFMIiwgIkFMIiwgIkFMIiwgIkFMIiwgIkFMIiwgIkFMIiwgIkFMIiwgIkFMIiwgIkFMIiwgIkFMIiwgIkFMIiwgIkFMIiwgIkFMIiwgIkFMIiwgIkFMIiwgIkFMIiwgIkFMIiwgIkFMIiwgIkFMIiwgIkFMIiwgIkFMIiwgIkFMIiwgIkFMIiwgIkFMIiwgIkFMIiwgIkFMIiwgIkFMIiwgIkFMIiwgIkFMIiwgIkFMIiwgIkFMIiwgIkFMIiwgIkFMIiwgIkFMIiwgIkFMIiwgIkFMIiwgIkFMIiwgIkFMIiwgIkFMIiwgIkFMIiwgIkFMIiwgIkFMIiwgIkFMIiwgIkFMIiwgIk5TTSIsICJOU00iLCAiTlNNIiwgIk5TTSIsICJOU00iLCAiTlNNIiwgIk5TTSIsICJOU00iLCAiTlNNIiwgIk5TTSIsICJOU00iLCAiTlNNIiwgIk5TTSIsICJOU00iLCAiTlNNIiwgIk5TTSIsICJOU00iLCAiTlNNIiwgIk5TTSIsICJOU00iLCAiTlNNIiwgIkFOIiwgIkFOIiwgIkFOIiwgIkFOIiwgIkFOIiwgIkFOIiwgIkFOIiwgIkFOIiwgIkFOIiwgIkFOIiwgIkVUIiwgIkFOIiwgIkFOIiwgIkFMIiwgIkFMIiwgIkFMIiwgIk5TTSIsICJBTCIsICJBTCIsICJBTCIsICJBTCIsICJBTCIsICJBTCIsICJBTCIsICJBTCIsICJBTCIsICJBTCIsICJBTCIsICJBTCIsICJBTCIsICJBTCIsICJBTCIsICJBTCIsICJBTCIsICJBTCIsICJBTCIsICJBTCIsICJBTCIsICJBTCIsICJBTCIsICJBTCIsICJBTCIsICJBTCIsICJBTCIsICJBTCIsICJBTCIsICJBTCIsICJBTCIsICJBTCIsICJBTCIsICJBTCIsICJBTCIsICJBTCIsICJBTCIsICJBTCIsICJBTCIsICJBTCIsICJBTCIsICJBTCIsICJBTCIsICJBTCIsICJBTCIsICJBTCIsICJBTCIsICJBTCIsICJBTCIsICJBTCIsICJBTCIsICJBTCIsICJBTCIsICJBTCIsICJBTCIsICJBTCIsICJBTCIsICJBTCIsICJBTCIsICJBTCIsICJBTCIsICJBTCIsICJBTCIsICJBTCIsICJBTCIsICJBTCIsICJBTCIsICJBTCIsICJBTCIsICJBTCIsICJBTCIsICJBTCIsICJBTCIsICJBTCIsICJBTCIsICJBTCIsICJBTCIsICJBTCIsICJBTCIsICJBTCIsICJBTCIsICJBTCIsICJBTCIsICJBTCIsICJBTCIsICJBTCIsICJBTCIsICJBTCIsICJBTCIsICJBTCIsICJBTCIsICJBTCIsICJBTCIsICJBTCIsICJBTCIsICJBTCIsICJBTCIsICJBTCIsICJBTCIsICJBTCIsICJBTCIsICJOU00iLCAiTlNNIiwgIk5TTSIsICJOU00iLCAiTlNNIiwgIk5TTSIsICJOU00iLCAiQU4iLCAiT04iLCAiTlNNIiwgIk5TTSIsICJOU00iLCAiTlNNIiwgIk5TTSIsICJOU00iLCAiQUwiLCAiQUwiLCAiTlNNIiwgIk5TTSIsICJPTiIsICJOU00iLCAiTlNNIiwgIk5TTSIsICJOU00iLCAiQUwiLCAiQUwiLCAiRU4iLCAiRU4iLCAiRU4iLCAiRU4iLCAiRU4iLCAiRU4iLCAiRU4iLCAiRU4iLCAiRU4iLCAiRU4iLCAiQUwiLCAiQUwiLCAiQUwiLCAiQUwiLCAiQUwiLCAiQUwiXTsKZnVuY3Rpb24gaXNPZGQoaSkgewogIHJldHVybiAoaSAmIDEpICE9PSAwOwp9CmZ1bmN0aW9uIGlzRXZlbihpKSB7CiAgcmV0dXJuIChpICYgMSkgPT09IDA7Cn0KZnVuY3Rpb24gZmluZFVuZXF1YWwoYXJyLCBzdGFydCwgdmFsdWUpIHsKICBsZXQgaiwgamo7CiAgZm9yIChqID0gc3RhcnQsIGpqID0gYXJyLmxlbmd0aDsgaiA8IGpqOyArK2opIHsKICAgIGlmIChhcnJbal0gIT09IHZhbHVlKSB7CiAgICAgIHJldHVybiBqOwogICAgfQogIH0KICByZXR1cm4gajsKfQpmdW5jdGlvbiBzZXRWYWx1ZXMoYXJyLCBzdGFydCwgZW5kLCB2YWx1ZSkgewogIGZvciAobGV0IGogPSBzdGFydDsgaiA8IGVuZDsgKytqKSB7CiAgICBhcnJbal0gPSB2YWx1ZTsKICB9Cn0KZnVuY3Rpb24gcmV2ZXJzZVZhbHVlcyhhcnIsIHN0YXJ0LCBlbmQpIHsKICBmb3IgKGxldCBpID0gc3RhcnQsIGogPSBlbmQgLSAxOyBpIDwgajsgKytpLCAtLWopIHsKICAgIGNvbnN0IHRlbXAgPSBhcnJbaV07CiAgICBhcnJbaV0gPSBhcnJbal07CiAgICBhcnJbal0gPSB0ZW1wOwogIH0KfQpmdW5jdGlvbiBjcmVhdGVCaWRpVGV4dChzdHIsIGlzTFRSLCB2ZXJ0aWNhbCA9IGZhbHNlKSB7CiAgbGV0IGRpciA9ICJsdHIiOwogIGlmICh2ZXJ0aWNhbCkgewogICAgZGlyID0gInR0YiI7CiAgfSBlbHNlIGlmICghaXNMVFIpIHsKICAgIGRpciA9ICJydGwiOwogIH0KICByZXR1cm4gewogICAgc3RyLAogICAgZGlyCiAgfTsKfQpjb25zdCBjaGFycyA9IFtdOwpjb25zdCB0eXBlcyA9IFtdOwpmdW5jdGlvbiBiaWRpKHN0ciwgc3RhcnRMZXZlbCA9IC0xLCB2ZXJ0aWNhbCA9IGZhbHNlKSB7CiAgbGV0IGlzTFRSID0gdHJ1ZTsKICBjb25zdCBzdHJMZW5ndGggPSBzdHIubGVuZ3RoOwogIGlmIChzdHJMZW5ndGggPT09IDAgfHwgdmVydGljYWwpIHsKICAgIHJldHVybiBjcmVhdGVCaWRpVGV4dChzdHIsIGlzTFRSLCB2ZXJ0aWNhbCk7CiAgfQogIGNoYXJzLmxlbmd0aCA9IHN0ckxlbmd0aDsKICB0eXBlcy5sZW5ndGggPSBzdHJMZW5ndGg7CiAgbGV0IG51bUJpZGkgPSAwOwogIGxldCBpLCBpaTsKICBmb3IgKGkgPSAwOyBpIDwgc3RyTGVuZ3RoOyArK2kpIHsKICAgIGNoYXJzW2ldID0gc3RyLmNoYXJBdChpKTsKICAgIGNvbnN0IGNoYXJDb2RlID0gc3RyLmNoYXJDb2RlQXQoaSk7CiAgICBsZXQgY2hhclR5cGUgPSAiTCI7CiAgICBpZiAoY2hhckNvZGUgPD0gMHgwMGZmKSB7CiAgICAgIGNoYXJUeXBlID0gYmFzZVR5cGVzW2NoYXJDb2RlXTsKICAgIH0gZWxzZSBpZiAoMHgwNTkwIDw9IGNoYXJDb2RlICYmIGNoYXJDb2RlIDw9IDB4MDVmNCkgewogICAgICBjaGFyVHlwZSA9ICJSIjsKICAgIH0gZWxzZSBpZiAoMHgwNjAwIDw9IGNoYXJDb2RlICYmIGNoYXJDb2RlIDw9IDB4MDZmZikgewogICAgICBjaGFyVHlwZSA9IGFyYWJpY1R5cGVzW2NoYXJDb2RlICYgMHhmZl07CiAgICAgIGlmICghY2hhclR5cGUpIHsKICAgICAgICAoMCwgX3V0aWwud2FybikoIkJpZGk6IGludmFsaWQgVW5pY29kZSBjaGFyYWN0ZXIgIiArIGNoYXJDb2RlLnRvU3RyaW5nKDE2KSk7CiAgICAgIH0KICAgIH0gZWxzZSBpZiAoMHgwNzAwIDw9IGNoYXJDb2RlICYmIGNoYXJDb2RlIDw9IDB4MDhhYyB8fCAweGZiNTAgPD0gY2hhckNvZGUgJiYgY2hhckNvZGUgPD0gMHhmZGZmIHx8IDB4ZmU3MCA8PSBjaGFyQ29kZSAmJiBjaGFyQ29kZSA8PSAweGZlZmYpIHsKICAgICAgY2hhclR5cGUgPSAiQUwiOwogICAgfQogICAgaWYgKGNoYXJUeXBlID09PSAiUiIgfHwgY2hhclR5cGUgPT09ICJBTCIgfHwgY2hhclR5cGUgPT09ICJBTiIpIHsKICAgICAgbnVtQmlkaSsrOwogICAgfQogICAgdHlwZXNbaV0gPSBjaGFyVHlwZTsKICB9CiAgaWYgKG51bUJpZGkgPT09IDApIHsKICAgIGlzTFRSID0gdHJ1ZTsKICAgIHJldHVybiBjcmVhdGVCaWRpVGV4dChzdHIsIGlzTFRSKTsKICB9CiAgaWYgKHN0YXJ0TGV2ZWwgPT09IC0xKSB7CiAgICBpZiAobnVtQmlkaSAvIHN0ckxlbmd0aCA8IDAuMyAmJiBzdHJMZW5ndGggPiA0KSB7CiAgICAgIGlzTFRSID0gdHJ1ZTsKICAgICAgc3RhcnRMZXZlbCA9IDA7CiAgICB9IGVsc2UgewogICAgICBpc0xUUiA9IGZhbHNlOwogICAgICBzdGFydExldmVsID0gMTsKICAgIH0KICB9CiAgY29uc3QgbGV2ZWxzID0gW107CiAgZm9yIChpID0gMDsgaSA8IHN0ckxlbmd0aDsgKytpKSB7CiAgICBsZXZlbHNbaV0gPSBzdGFydExldmVsOwogIH0KICBjb25zdCBlID0gaXNPZGQoc3RhcnRMZXZlbCkgPyAiUiIgOiAiTCI7CiAgY29uc3Qgc29yID0gZTsKICBjb25zdCBlb3IgPSBzb3I7CiAgbGV0IGxhc3RUeXBlID0gc29yOwogIGZvciAoaSA9IDA7IGkgPCBzdHJMZW5ndGg7ICsraSkgewogICAgaWYgKHR5cGVzW2ldID09PSAiTlNNIikgewogICAgICB0eXBlc1tpXSA9IGxhc3RUeXBlOwogICAgfSBlbHNlIHsKICAgICAgbGFzdFR5cGUgPSB0eXBlc1tpXTsKICAgIH0KICB9CiAgbGFzdFR5cGUgPSBzb3I7CiAgbGV0IHQ7CiAgZm9yIChpID0gMDsgaSA8IHN0ckxlbmd0aDsgKytpKSB7CiAgICB0ID0gdHlwZXNbaV07CiAgICBpZiAodCA9PT0gIkVOIikgewogICAgICB0eXBlc1tpXSA9IGxhc3RUeXBlID09PSAiQUwiID8gIkFOIiA6ICJFTiI7CiAgICB9IGVsc2UgaWYgKHQgPT09ICJSIiB8fCB0ID09PSAiTCIgfHwgdCA9PT0gIkFMIikgewogICAgICBsYXN0VHlwZSA9IHQ7CiAgICB9CiAgfQogIGZvciAoaSA9IDA7IGkgPCBzdHJMZW5ndGg7ICsraSkgewogICAgdCA9IHR5cGVzW2ldOwogICAgaWYgKHQgPT09ICJBTCIpIHsKICAgICAgdHlwZXNbaV0gPSAiUiI7CiAgICB9CiAgfQogIGZvciAoaSA9IDE7IGkgPCBzdHJMZW5ndGggLSAxOyArK2kpIHsKICAgIGlmICh0eXBlc1tpXSA9PT0gIkVTIiAmJiB0eXBlc1tpIC0gMV0gPT09ICJFTiIgJiYgdHlwZXNbaSArIDFdID09PSAiRU4iKSB7CiAgICAgIHR5cGVzW2ldID0gIkVOIjsKICAgIH0KICAgIGlmICh0eXBlc1tpXSA9PT0gIkNTIiAmJiAodHlwZXNbaSAtIDFdID09PSAiRU4iIHx8IHR5cGVzW2kgLSAxXSA9PT0gIkFOIikgJiYgdHlwZXNbaSArIDFdID09PSB0eXBlc1tpIC0gMV0pIHsKICAgICAgdHlwZXNbaV0gPSB0eXBlc1tpIC0gMV07CiAgICB9CiAgfQogIGZvciAoaSA9IDA7IGkgPCBzdHJMZW5ndGg7ICsraSkgewogICAgaWYgKHR5cGVzW2ldID09PSAiRU4iKSB7CiAgICAgIGZvciAobGV0IGogPSBpIC0gMTsgaiA+PSAwOyAtLWopIHsKICAgICAgICBpZiAodHlwZXNbal0gIT09ICJFVCIpIHsKICAgICAgICAgIGJyZWFrOwogICAgICAgIH0KICAgICAgICB0eXBlc1tqXSA9ICJFTiI7CiAgICAgIH0KICAgICAgZm9yIChsZXQgaiA9IGkgKyAxOyBqIDwgc3RyTGVuZ3RoOyArK2opIHsKICAgICAgICBpZiAodHlwZXNbal0gIT09ICJFVCIpIHsKICAgICAgICAgIGJyZWFrOwogICAgICAgIH0KICAgICAgICB0eXBlc1tqXSA9ICJFTiI7CiAgICAgIH0KICAgIH0KICB9CiAgZm9yIChpID0gMDsgaSA8IHN0ckxlbmd0aDsgKytpKSB7CiAgICB0ID0gdHlwZXNbaV07CiAgICBpZiAodCA9PT0gIldTIiB8fCB0ID09PSAiRVMiIHx8IHQgPT09ICJFVCIgfHwgdCA9PT0gIkNTIikgewogICAgICB0eXBlc1tpXSA9ICJPTiI7CiAgICB9CiAgfQogIGxhc3RUeXBlID0gc29yOwogIGZvciAoaSA9IDA7IGkgPCBzdHJMZW5ndGg7ICsraSkgewogICAgdCA9IHR5cGVzW2ldOwogICAgaWYgKHQgPT09ICJFTiIpIHsKICAgICAgdHlwZXNbaV0gPSBsYXN0VHlwZSA9PT0gIkwiID8gIkwiIDogIkVOIjsKICAgIH0gZWxzZSBpZiAodCA9PT0gIlIiIHx8IHQgPT09ICJMIikgewogICAgICBsYXN0VHlwZSA9IHQ7CiAgICB9CiAgfQogIGZvciAoaSA9IDA7IGkgPCBzdHJMZW5ndGg7ICsraSkgewogICAgaWYgKHR5cGVzW2ldID09PSAiT04iKSB7CiAgICAgIGNvbnN0IGVuZCA9IGZpbmRVbmVxdWFsKHR5cGVzLCBpICsgMSwgIk9OIik7CiAgICAgIGxldCBiZWZvcmUgPSBzb3I7CiAgICAgIGlmIChpID4gMCkgewogICAgICAgIGJlZm9yZSA9IHR5cGVzW2kgLSAxXTsKICAgICAgfQogICAgICBsZXQgYWZ0ZXIgPSBlb3I7CiAgICAgIGlmIChlbmQgKyAxIDwgc3RyTGVuZ3RoKSB7CiAgICAgICAgYWZ0ZXIgPSB0eXBlc1tlbmQgKyAxXTsKICAgICAgfQogICAgICBpZiAoYmVmb3JlICE9PSAiTCIpIHsKICAgICAgICBiZWZvcmUgPSAiUiI7CiAgICAgIH0KICAgICAgaWYgKGFmdGVyICE9PSAiTCIpIHsKICAgICAgICBhZnRlciA9ICJSIjsKICAgICAgfQogICAgICBpZiAoYmVmb3JlID09PSBhZnRlcikgewogICAgICAgIHNldFZhbHVlcyh0eXBlcywgaSwgZW5kLCBiZWZvcmUpOwogICAgICB9CiAgICAgIGkgPSBlbmQgLSAxOwogICAgfQogIH0KICBmb3IgKGkgPSAwOyBpIDwgc3RyTGVuZ3RoOyArK2kpIHsKICAgIGlmICh0eXBlc1tpXSA9PT0gIk9OIikgewogICAgICB0eXBlc1tpXSA9IGU7CiAgICB9CiAgfQogIGZvciAoaSA9IDA7IGkgPCBzdHJMZW5ndGg7ICsraSkgewogICAgdCA9IHR5cGVzW2ldOwogICAgaWYgKGlzRXZlbihsZXZlbHNbaV0pKSB7CiAgICAgIGlmICh0ID09PSAiUiIpIHsKICAgICAgICBsZXZlbHNbaV0gKz0gMTsKICAgICAgfSBlbHNlIGlmICh0ID09PSAiQU4iIHx8IHQgPT09ICJFTiIpIHsKICAgICAgICBsZXZlbHNbaV0gKz0gMjsKICAgICAgfQogICAgfSBlbHNlIGlmICh0ID09PSAiTCIgfHwgdCA9PT0gIkFOIiB8fCB0ID09PSAiRU4iKSB7CiAgICAgIGxldmVsc1tpXSArPSAxOwogICAgfQogIH0KICBsZXQgaGlnaGVzdExldmVsID0gLTE7CiAgbGV0IGxvd2VzdE9kZExldmVsID0gOTk7CiAgbGV0IGxldmVsOwogIGZvciAoaSA9IDAsIGlpID0gbGV2ZWxzLmxlbmd0aDsgaSA8IGlpOyArK2kpIHsKICAgIGxldmVsID0gbGV2ZWxzW2ldOwogICAgaWYgKGhpZ2hlc3RMZXZlbCA8IGxldmVsKSB7CiAgICAgIGhpZ2hlc3RMZXZlbCA9IGxldmVsOwogICAgfQogICAgaWYgKGxvd2VzdE9kZExldmVsID4gbGV2ZWwgJiYgaXNPZGQobGV2ZWwpKSB7CiAgICAgIGxvd2VzdE9kZExldmVsID0gbGV2ZWw7CiAgICB9CiAgfQogIGZvciAobGV2ZWwgPSBoaWdoZXN0TGV2ZWw7IGxldmVsID49IGxvd2VzdE9kZExldmVsOyAtLWxldmVsKSB7CiAgICBsZXQgc3RhcnQgPSAtMTsKICAgIGZvciAoaSA9IDAsIGlpID0gbGV2ZWxzLmxlbmd0aDsgaSA8IGlpOyArK2kpIHsKICAgICAgaWYgKGxldmVsc1tpXSA8IGxldmVsKSB7CiAgICAgICAgaWYgKHN0YXJ0ID49IDApIHsKICAgICAgICAgIHJldmVyc2VWYWx1ZXMoY2hhcnMsIHN0YXJ0LCBpKTsKICAgICAgICAgIHN0YXJ0ID0gLTE7CiAgICAgICAgfQogICAgICB9IGVsc2UgaWYgKHN0YXJ0IDwgMCkgewogICAgICAgIHN0YXJ0ID0gaTsKICAgICAgfQogICAgfQogICAgaWYgKHN0YXJ0ID49IDApIHsKICAgICAgcmV2ZXJzZVZhbHVlcyhjaGFycywgc3RhcnQsIGxldmVscy5sZW5ndGgpOwogICAgfQogIH0KICBmb3IgKGkgPSAwLCBpaSA9IGNoYXJzLmxlbmd0aDsgaSA8IGlpOyArK2kpIHsKICAgIGNvbnN0IGNoID0gY2hhcnNbaV07CiAgICBpZiAoY2ggPT09ICI8IiB8fCBjaCA9PT0gIj4iKSB7CiAgICAgIGNoYXJzW2ldID0gIiI7CiAgICB9CiAgfQogIHJldHVybiBjcmVhdGVCaWRpVGV4dChjaGFycy5qb2luKCIiKSwgaXNMVFIpOwp9CgovKioqLyB9KSwKLyogNjEgKi8KLyoqKi8gKChfX3VudXNlZF93ZWJwYWNrX21vZHVsZSwgZXhwb3J0cywgX193X3BkZmpzX3JlcXVpcmVfXykgPT4gewoKCgpPYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgIl9fZXNNb2R1bGUiLCAoewogIHZhbHVlOiB0cnVlCn0pKTsKZXhwb3J0cy5nZXRGb250U3Vic3RpdHV0aW9uID0gZ2V0Rm9udFN1YnN0aXR1dGlvbjsKdmFyIF9mb250c191dGlscyA9IF9fd19wZGZqc19yZXF1aXJlX18oMzgpOwp2YXIgX2NvcmVfdXRpbHMgPSBfX3dfcGRmanNfcmVxdWlyZV9fKDMpOwpjb25zdCBOT1JNQUwgPSB7CiAgc3R5bGU6ICJub3JtYWwiLAogIHdlaWdodDogIm5vcm1hbCIKfTsKY29uc3QgQk9MRCA9IHsKICBzdHlsZTogIm5vcm1hbCIsCiAgd2VpZ2h0OiAiYm9sZCIKfTsKY29uc3QgSVRBTElDID0gewogIHN0eWxlOiAiaXRhbGljIiwKICB3ZWlnaHQ6ICJub3JtYWwiCn07CmNvbnN0IEJPTERJVEFMSUMgPSB7CiAgc3R5bGU6ICJpdGFsaWMiLAogIHdlaWdodDogImJvbGQiCn07CmNvbnN0IHN1YnN0aXR1dGlvbk1hcCA9IG5ldyBNYXAoW1siVGltZXMtUm9tYW4iLCB7CiAgbG9jYWw6IFsiVGltZXMgTmV3IFJvbWFuIiwgIlRpbWVzLVJvbWFuIiwgIlRpbWVzIiwgIkxpYmVyYXRpb24gU2VyaWYiLCAiTmltYnVzIFJvbWFuIiwgIk5pbWJ1cyBSb21hbiBMIiwgIlRpbm9zIiwgIlRob3JuZGFsZSIsICJUZVggR3lyZSBUZXJtZXMiLCAiRnJlZVNlcmlmIiwgIkRlamFWdSBTZXJpZiIsICJCaXRzdHJlYW0gVmVyYSBTZXJpZiIsICJVYnVudHUiXSwKICBzdHlsZTogTk9STUFMLAogIHVsdGltYXRlOiAic2VyaWYiCn1dLCBbIlRpbWVzLUJvbGQiLCB7CiAgYWxpYXM6ICJUaW1lcy1Sb21hbiIsCiAgc3R5bGU6IEJPTEQsCiAgdWx0aW1hdGU6ICJzZXJpZiIKfV0sIFsiVGltZXMtSXRhbGljIiwgewogIGFsaWFzOiAiVGltZXMtUm9tYW4iLAogIHN0eWxlOiBJVEFMSUMsCiAgdWx0aW1hdGU6ICJzZXJpZiIKfV0sIFsiVGltZXMtQm9sZEl0YWxpYyIsIHsKICBhbGlhczogIlRpbWVzLVJvbWFuIiwKICBzdHlsZTogQk9MRElUQUxJQywKICB1bHRpbWF0ZTogInNlcmlmIgp9XSwgWyJIZWx2ZXRpY2EiLCB7CiAgbG9jYWw6IFsiSGVsdmV0aWNhIiwgIkhlbHZldGljYSBOZXVlIiwgIkFyaWFsIiwgIkFyaWFsIE5vdmEiLCAiTGliZXJhdGlvbiBTYW5zIiwgIkFyaW1vIiwgIk5pbWJ1cyBTYW5zIiwgIk5pbWJ1cyBTYW5zIEwiLCAiQTAzMCIsICJUZVggR3lyZSBIZXJvcyIsICJGcmVlU2FucyIsICJEZWphVnUgU2FucyIsICJBbGJhbnkiLCAiQml0c3RyZWFtIFZlcmEgU2FucyIsICJBcmlhbCBVbmljb2RlIE1TIiwgIk1pY3Jvc29mdCBTYW5zIFNlcmlmIiwgIkFwcGxlIFN5bWJvbHMiLCAiQ2FudGFyZWxsIl0sCiAgcGF0aDogIkxpYmVyYXRpb25TYW5zLVJlZ3VsYXIudHRmIiwKICBzdHlsZTogTk9STUFMLAogIHVsdGltYXRlOiAic2Fucy1zZXJpZiIKfV0sIFsiSGVsdmV0aWNhLUJvbGQiLCB7CiAgYWxpYXM6ICJIZWx2ZXRpY2EiLAogIHBhdGg6ICJMaWJlcmF0aW9uU2Fucy1Cb2xkLnR0ZiIsCiAgc3R5bGU6IEJPTEQsCiAgdWx0aW1hdGU6ICJzYW5zLXNlcmlmIgp9XSwgWyJIZWx2ZXRpY2EtT2JsaXF1ZSIsIHsKICBhbGlhczogIkhlbHZldGljYSIsCiAgcGF0aDogIkxpYmVyYXRpb25TYW5zLUl0YWxpYy50dGYiLAogIHN0eWxlOiBJVEFMSUMsCiAgdWx0aW1hdGU6ICJzYW5zLXNlcmlmIgp9XSwgWyJIZWx2ZXRpY2EtQm9sZE9ibGlxdWUiLCB7CiAgYWxpYXM6ICJIZWx2ZXRpY2EiLAogIHBhdGg6ICJMaWJlcmF0aW9uU2Fucy1Cb2xkSXRhbGljLnR0ZiIsCiAgc3R5bGU6IEJPTERJVEFMSUMsCiAgdWx0aW1hdGU6ICJzYW5zLXNlcmlmIgp9XSwgWyJDb3VyaWVyIiwgewogIGxvY2FsOiBbIkNvdXJpZXIiLCAiQ291cmllciBOZXciLCAiTGliZXJhdGlvbiBNb25vIiwgIk5pbWJ1cyBNb25vIiwgIk5pbWJ1cyBNb25vIEwiLCAiQ291c2luZSIsICJDdW1iZXJsYW5kIiwgIlRlWCBHeXJlIEN1cnNvciIsICJGcmVlTW9ubyJdLAogIHN0eWxlOiBOT1JNQUwsCiAgdWx0aW1hdGU6ICJtb25vc3BhY2UiCn1dLCBbIkNvdXJpZXItQm9sZCIsIHsKICBhbGlhczogIkNvdXJpZXIiLAogIHN0eWxlOiBCT0xELAogIHVsdGltYXRlOiAibW9ub3NwYWNlIgp9XSwgWyJDb3VyaWVyLU9ibGlxdWUiLCB7CiAgYWxpYXM6ICJDb3VyaWVyIiwKICBzdHlsZTogSVRBTElDLAogIHVsdGltYXRlOiAibW9ub3NwYWNlIgp9XSwgWyJDb3VyaWVyLUJvbGRPYmxpcXVlIiwgewogIGFsaWFzOiAiQ291cmllciIsCiAgc3R5bGU6IEJPTERJVEFMSUMsCiAgdWx0aW1hdGU6ICJtb25vc3BhY2UiCn1dLCBbIkFyaWFsQmxhY2siLCB7CiAgbG9jYWw6IFsiQXJpYWwgQmxhY2siXSwKICBzdHlsZTogewogICAgc3R5bGU6ICJub3JtYWwiLAogICAgd2VpZ2h0OiAiOTAwIgogIH0sCiAgZmFsbGJhY2s6ICJIZWx2ZXRpY2EtQm9sZCIKfV0sIFsiQXJpYWxCbGFjay1Cb2xkIiwgewogIGFsaWFzOiAiQXJpYWxCbGFjayIKfV0sIFsiQXJpYWxCbGFjay1JdGFsaWMiLCB7CiAgYWxpYXM6ICJBcmlhbEJsYWNrIiwKICBzdHlsZTogewogICAgc3R5bGU6ICJpdGFsaWMiLAogICAgd2VpZ2h0OiAiOTAwIgogIH0sCiAgZmFsbGJhY2s6ICJIZWx2ZXRpY2EtQm9sZE9ibGlxdWUiCn1dLCBbIkFyaWFsQmxhY2stQm9sZEl0YWxpYyIsIHsKICBhbGlhczogIkFyaWFsQmxhY2stSXRhbGljIgp9XSwgWyJBcmlhbE5hcnJvdyIsIHsKICBsb2NhbDogWyJBcmlhbCBOYXJyb3ciLCAiTGliZXJhdGlvbiBTYW5zIE5hcnJvdyIsICJIZWx2ZXRpY2EgQ29uZGVuc2VkIiwgIk5pbWJ1cyBTYW5zIE5hcnJvdyIsICJUZVggR3lyZSBIZXJvcyBDbiJdLAogIHN0eWxlOiBOT1JNQUwsCiAgZmFsbGJhY2s6ICJIZWx2ZXRpY2EiCn1dLCBbIkFyaWFsTmFycm93LUJvbGQiLCB7CiAgYWxpYXM6ICJBcmlhbE5hcnJvdyIsCiAgc3R5bGU6IEJPTEQsCiAgZmFsbGJhY2s6ICJIZWx2ZXRpY2EtQm9sZCIKfV0sIFsiQXJpYWxOYXJyb3ctSXRhbGljIiwgewogIGFsaWFzOiAiQXJpYWxOYXJyb3ciLAogIHN0eWxlOiBJVEFMSUMsCiAgZmFsbGJhY2s6ICJIZWx2ZXRpY2EtT2JsaXF1ZSIKfV0sIFsiQXJpYWxOYXJyb3ctQm9sZEl0YWxpYyIsIHsKICBhbGlhczogIkFyaWFsTmFycm93IiwKICBzdHlsZTogQk9MRElUQUxJQywKICBmYWxsYmFjazogIkhlbHZldGljYS1Cb2xkT2JsaXF1ZSIKfV0sIFsiQ2FsaWJyaSIsIHsKICBsb2NhbDogWyJDYWxpYnJpIiwgIkNhcmxpdG8iXSwKICBzdHlsZTogTk9STUFMLAogIGZhbGxiYWNrOiAiSGVsdmV0aWNhIgp9XSwgWyJDYWxpYnJpLUJvbGQiLCB7CiAgYWxpYXM6ICJDYWxpYnJpIiwKICBzdHlsZTogQk9MRCwKICBmYWxsYmFjazogIkhlbHZldGljYS1Cb2xkIgp9XSwgWyJDYWxpYnJpLUl0YWxpYyIsIHsKICBhbGlhczogIkNhbGlicmkiLAogIHN0eWxlOiBJVEFMSUMsCiAgZmFsbGJhY2s6ICJIZWx2ZXRpY2EtT2JsaXF1ZSIKfV0sIFsiQ2FsaWJyaS1Cb2xkSXRhbGljIiwgewogIGFsaWFzOiAiQ2FsaWJyaSIsCiAgc3R5bGU6IEJPTERJVEFMSUMsCiAgZmFsbGJhY2s6ICJIZWx2ZXRpY2EtQm9sZE9ibGlxdWUiCn1dLCBbIldpbmdkaW5ncyIsIHsKICBsb2NhbDogWyJXaW5nZGluZ3MiLCAiVVJXIERpbmdiYXRzIl0sCiAgc3R5bGU6IE5PUk1BTAp9XSwgWyJXaW5nZGluZ3MtUmVndWxhciIsIHsKICBhbGlhczogIldpbmdkaW5ncyIKfV0sIFsiV2luZ2RpbmdzLUJvbGQiLCB7CiAgYWxpYXM6ICJXaW5nZGluZ3MiCn1dXSk7CmNvbnN0IGZvbnRBbGlhc2VzID0gbmV3IE1hcChbWyJBcmlhbC1CbGFjayIsICJBcmlhbEJsYWNrIl1dKTsKZnVuY3Rpb24gZ2V0U3R5bGVUb0FwcGVuZChzdHlsZSkgewogIHN3aXRjaCAoc3R5bGUpIHsKICAgIGNhc2UgQk9MRDoKICAgICAgcmV0dXJuICJCb2xkIjsKICAgIGNhc2UgSVRBTElDOgogICAgICByZXR1cm4gIkl0YWxpYyI7CiAgICBjYXNlIEJPTERJVEFMSUM6CiAgICAgIHJldHVybiAiQm9sZCBJdGFsaWMiOwogICAgZGVmYXVsdDoKICAgICAgaWYgKHN0eWxlPy53ZWlnaHQgPT09ICJib2xkIikgewogICAgICAgIHJldHVybiAiQm9sZCI7CiAgICAgIH0KICAgICAgaWYgKHN0eWxlPy5zdHlsZSA9PT0gIml0YWxpYyIpIHsKICAgICAgICByZXR1cm4gIkl0YWxpYyI7CiAgICAgIH0KICB9CiAgcmV0dXJuICIiOwp9CmZ1bmN0aW9uIGdlbmVyYXRlRm9udCh7CiAgYWxpYXMsCiAgbG9jYWwsCiAgcGF0aCwKICBmYWxsYmFjaywKICBzdHlsZSwKICB1bHRpbWF0ZQp9LCBzcmMsIGxvY2FsRm9udFBhdGgsIHVzZUZhbGxiYWNrID0gdHJ1ZSwgdXNlUGF0aCA9IHRydWUsIGFwcGVuZCA9ICIiKSB7CiAgY29uc3QgcmVzdWx0ID0gewogICAgc3R5bGU6IG51bGwsCiAgICB1bHRpbWF0ZTogbnVsbAogIH07CiAgaWYgKGxvY2FsKSB7CiAgICBjb25zdCBleHRyYSA9IGFwcGVuZCA/IGAgJHthcHBlbmR9YCA6ICIiOwogICAgZm9yIChjb25zdCBuYW1lIG9mIGxvY2FsKSB7CiAgICAgIHNyYy5wdXNoKGBsb2NhbCgke25hbWV9JHtleHRyYX0pYCk7CiAgICB9CiAgfQogIGlmIChhbGlhcykgewogICAgY29uc3Qgc3Vic3RpdHV0aW9uID0gc3Vic3RpdHV0aW9uTWFwLmdldChhbGlhcyk7CiAgICBjb25zdCBhbGlhc0FwcGVuZCA9IGFwcGVuZCB8fCBnZXRTdHlsZVRvQXBwZW5kKHN0eWxlKTsKICAgIE9iamVjdC5hc3NpZ24ocmVzdWx0LCBnZW5lcmF0ZUZvbnQoc3Vic3RpdHV0aW9uLCBzcmMsIGxvY2FsRm9udFBhdGgsIHVzZUZhbGxiYWNrICYmICFmYWxsYmFjaywgdXNlUGF0aCAmJiAhcGF0aCwgYWxpYXNBcHBlbmQpKTsKICB9CiAgaWYgKHN0eWxlKSB7CiAgICByZXN1bHQuc3R5bGUgPSBzdHlsZTsKICB9CiAgaWYgKHVsdGltYXRlKSB7CiAgICByZXN1bHQudWx0aW1hdGUgPSB1bHRpbWF0ZTsKICB9CiAgaWYgKHVzZUZhbGxiYWNrICYmIGZhbGxiYWNrKSB7CiAgICBjb25zdCBmYWxsYmFja0luZm8gPSBzdWJzdGl0dXRpb25NYXAuZ2V0KGZhbGxiYWNrKTsKICAgIGNvbnN0IHsKICAgICAgdWx0aW1hdGU6IGZhbGxiYWNrVWx0aW1hdGUKICAgIH0gPSBnZW5lcmF0ZUZvbnQoZmFsbGJhY2tJbmZvLCBzcmMsIGxvY2FsRm9udFBhdGgsIHVzZUZhbGxiYWNrLCB1c2VQYXRoICYmICFwYXRoLCBhcHBlbmQpOwogICAgcmVzdWx0LnVsdGltYXRlIHx8PSBmYWxsYmFja1VsdGltYXRlOwogIH0KICBpZiAodXNlUGF0aCAmJiBwYXRoICYmIGxvY2FsRm9udFBhdGgpIHsKICAgIHNyYy5wdXNoKGB1cmwoJHtsb2NhbEZvbnRQYXRofSR7cGF0aH0pYCk7CiAgfQogIHJldHVybiByZXN1bHQ7Cn0KZnVuY3Rpb24gZ2V0Rm9udFN1YnN0aXR1dGlvbihzeXN0ZW1Gb250Q2FjaGUsIGlkRmFjdG9yeSwgbG9jYWxGb250UGF0aCwgYmFzZUZvbnROYW1lLCBzdGFuZGFyZEZvbnROYW1lKSB7CiAgYmFzZUZvbnROYW1lID0gKDAsIF9mb250c191dGlscy5ub3JtYWxpemVGb250TmFtZSkoYmFzZUZvbnROYW1lKTsKICBjb25zdCBrZXkgPSBiYXNlRm9udE5hbWU7CiAgbGV0IHN1YnN0aXR1dGlvbkluZm8gPSBzeXN0ZW1Gb250Q2FjaGUuZ2V0KGtleSk7CiAgaWYgKHN1YnN0aXR1dGlvbkluZm8pIHsKICAgIHJldHVybiBzdWJzdGl0dXRpb25JbmZvOwogIH0KICBsZXQgc3Vic3RpdHV0aW9uID0gc3Vic3RpdHV0aW9uTWFwLmdldChiYXNlRm9udE5hbWUpOwogIGlmICghc3Vic3RpdHV0aW9uKSB7CiAgICBmb3IgKGNvbnN0IFthbGlhcywgc3Vic3RdIG9mIGZvbnRBbGlhc2VzKSB7CiAgICAgIGlmIChiYXNlRm9udE5hbWUuc3RhcnRzV2l0aChhbGlhcykpIHsKICAgICAgICBiYXNlRm9udE5hbWUgPSBgJHtzdWJzdH0ke2Jhc2VGb250TmFtZS5zdWJzdHJpbmcoYWxpYXMubGVuZ3RoKX1gOwogICAgICAgIHN1YnN0aXR1dGlvbiA9IHN1YnN0aXR1dGlvbk1hcC5nZXQoYmFzZUZvbnROYW1lKTsKICAgICAgICBicmVhazsKICAgICAgfQogICAgfQogIH0KICBsZXQgbXVzdEFkZEJhc2VGb250ID0gZmFsc2U7CiAgaWYgKCFzdWJzdGl0dXRpb24pIHsKICAgIHN1YnN0aXR1dGlvbiA9IHN1YnN0aXR1dGlvbk1hcC5nZXQoc3RhbmRhcmRGb250TmFtZSk7CiAgICBtdXN0QWRkQmFzZUZvbnQgPSB0cnVlOwogIH0KICBjb25zdCBsb2FkZWROYW1lID0gYCR7aWRGYWN0b3J5LmdldERvY0lkKCl9X3Mke2lkRmFjdG9yeS5jcmVhdGVGb250SWQoKX1gOwogIGlmICghc3Vic3RpdHV0aW9uKSB7CiAgICBpZiAoISgwLCBfY29yZV91dGlscy52YWxpZGF0ZUZvbnROYW1lKShiYXNlRm9udE5hbWUpKSB7CiAgICAgIHN5c3RlbUZvbnRDYWNoZS5zZXQoa2V5LCBudWxsKTsKICAgICAgcmV0dXJuIG51bGw7CiAgICB9CiAgICBjb25zdCBib2xkID0gL2JvbGQvZ2kudGVzdChiYXNlRm9udE5hbWUpOwogICAgY29uc3QgaXRhbGljID0gL29ibGlxdWV8aXRhbGljL2dpLnRlc3QoYmFzZUZvbnROYW1lKTsKICAgIGNvbnN0IHN0eWxlID0gYm9sZCAmJiBpdGFsaWMgJiYgQk9MRElUQUxJQyB8fCBib2xkICYmIEJPTEQgfHwgaXRhbGljICYmIElUQUxJQyB8fCBOT1JNQUw7CiAgICBzdWJzdGl0dXRpb25JbmZvID0gewogICAgICBjc3M6IGxvYWRlZE5hbWUsCiAgICAgIGd1ZXNzRmFsbGJhY2s6IHRydWUsCiAgICAgIGxvYWRlZE5hbWUsCiAgICAgIGJhc2VGb250TmFtZSwKICAgICAgc3JjOiBgbG9jYWwoJHtiYXNlRm9udE5hbWV9KWAsCiAgICAgIHN0eWxlCiAgICB9OwogICAgc3lzdGVtRm9udENhY2hlLnNldChrZXksIHN1YnN0aXR1dGlvbkluZm8pOwogICAgcmV0dXJuIHN1YnN0aXR1dGlvbkluZm87CiAgfQogIGNvbnN0IHNyYyA9IFtdOwogIGlmIChtdXN0QWRkQmFzZUZvbnQgJiYgKDAsIF9jb3JlX3V0aWxzLnZhbGlkYXRlRm9udE5hbWUpKGJhc2VGb250TmFtZSkpIHsKICAgIHNyYy5wdXNoKGBsb2NhbCgke2Jhc2VGb250TmFtZX0pYCk7CiAgfQogIGNvbnN0IHsKICAgIHN0eWxlLAogICAgdWx0aW1hdGUKICB9ID0gZ2VuZXJhdGVGb250KHN1YnN0aXR1dGlvbiwgc3JjLCBsb2NhbEZvbnRQYXRoKTsKICBjb25zdCBndWVzc0ZhbGxiYWNrID0gdWx0aW1hdGUgPT09IG51bGw7CiAgY29uc3QgZmFsbGJhY2sgPSBndWVzc0ZhbGxiYWNrID8gIiIgOiBgLCR7dWx0aW1hdGV9YDsKICBzdWJzdGl0dXRpb25JbmZvID0gewogICAgY3NzOiBgJHtsb2FkZWROYW1lfSR7ZmFsbGJhY2t9YCwKICAgIGd1ZXNzRmFsbGJhY2ssCiAgICBsb2FkZWROYW1lLAogICAgYmFzZUZvbnROYW1lLAogICAgc3JjOiBzcmMuam9pbigiLCIpLAogICAgc3R5bGUKICB9OwogIHN5c3RlbUZvbnRDYWNoZS5zZXQoa2V5LCBzdWJzdGl0dXRpb25JbmZvKTsKICByZXR1cm4gc3Vic3RpdHV0aW9uSW5mbzsKfQoKLyoqKi8gfSksCi8qIDYyICovCi8qKiovICgoX191bnVzZWRfd2VicGFja19tb2R1bGUsIGV4cG9ydHMsIF9fd19wZGZqc19yZXF1aXJlX18pID0+IHsKCgoKT2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsICJfX2VzTW9kdWxlIiwgKHsKICB2YWx1ZTogdHJ1ZQp9KSk7CmV4cG9ydHMuSW1hZ2VSZXNpemVyID0gdm9pZCAwOwp2YXIgX3V0aWwgPSBfX3dfcGRmanNfcmVxdWlyZV9fKDIpOwpjb25zdCBNSU5fSU1BR0VfRElNID0gMjA0ODsKY29uc3QgTUFYX0lNQUdFX0RJTSA9IDY1NTM3Owpjb25zdCBNQVhfRVJST1IgPSAxMjg7CmNsYXNzIEltYWdlUmVzaXplciB7CiAgY29uc3RydWN0b3IoaW1nRGF0YSwgaXNNYXNrKSB7CiAgICB0aGlzLl9pbWdEYXRhID0gaW1nRGF0YTsKICAgIHRoaXMuX2lzTWFzayA9IGlzTWFzazsKICB9CiAgc3RhdGljIG5lZWRzVG9CZVJlc2l6ZWQod2lkdGgsIGhlaWdodCkgewogICAgaWYgKHdpZHRoIDw9IHRoaXMuX2dvb2RTcXVhcmVMZW5ndGggJiYgaGVpZ2h0IDw9IHRoaXMuX2dvb2RTcXVhcmVMZW5ndGgpIHsKICAgICAgcmV0dXJuIGZhbHNlOwogICAgfQogICAgY29uc3QgewogICAgICBNQVhfRElNCiAgICB9ID0gdGhpczsKICAgIGlmICh3aWR0aCA+IE1BWF9ESU0gfHwgaGVpZ2h0ID4gTUFYX0RJTSkgewogICAgICByZXR1cm4gdHJ1ZTsKICAgIH0KICAgIGNvbnN0IGFyZWEgPSB3aWR0aCAqIGhlaWdodDsKICAgIGlmICh0aGlzLl9oYXNNYXhBcmVhKSB7CiAgICAgIHJldHVybiBhcmVhID4gdGhpcy5NQVhfQVJFQTsKICAgIH0KICAgIGlmIChhcmVhIDwgdGhpcy5fZ29vZFNxdWFyZUxlbmd0aCAqKiAyKSB7CiAgICAgIHJldHVybiBmYWxzZTsKICAgIH0KICAgIGlmICh0aGlzLl9hcmVHb29kRGltcyh3aWR0aCwgaGVpZ2h0KSkgewogICAgICB0aGlzLl9nb29kU3F1YXJlTGVuZ3RoID0gTWF0aC5tYXgodGhpcy5fZ29vZFNxdWFyZUxlbmd0aCwgTWF0aC5mbG9vcihNYXRoLnNxcnQod2lkdGggKiBoZWlnaHQpKSk7CiAgICAgIHJldHVybiBmYWxzZTsKICAgIH0KICAgIHRoaXMuX2dvb2RTcXVhcmVMZW5ndGggPSB0aGlzLl9ndWVzc01heCh0aGlzLl9nb29kU3F1YXJlTGVuZ3RoLCBNQVhfRElNLCBNQVhfRVJST1IsIDApOwogICAgY29uc3QgbWF4QXJlYSA9IHRoaXMuTUFYX0FSRUEgPSB0aGlzLl9nb29kU3F1YXJlTGVuZ3RoICoqIDI7CiAgICByZXR1cm4gYXJlYSA+IG1heEFyZWE7CiAgfQogIHN0YXRpYyBnZXQgTUFYX0RJTSgpIHsKICAgIHJldHVybiAoMCwgX3V0aWwuc2hhZG93KSh0aGlzLCAiTUFYX0RJTSIsIHRoaXMuX2d1ZXNzTWF4KE1JTl9JTUFHRV9ESU0sIE1BWF9JTUFHRV9ESU0sIDAsIDEpKTsKICB9CiAgc3RhdGljIGdldCBNQVhfQVJFQSgpIHsKICAgIHRoaXMuX2hhc01heEFyZWEgPSB0cnVlOwogICAgcmV0dXJuICgwLCBfdXRpbC5zaGFkb3cpKHRoaXMsICJNQVhfQVJFQSIsIHRoaXMuX2d1ZXNzTWF4KEltYWdlUmVzaXplci5fZ29vZFNxdWFyZUxlbmd0aCwgdGhpcy5NQVhfRElNLCBNQVhfRVJST1IsIDApICoqIDIpOwogIH0KICBzdGF0aWMgc2V0IE1BWF9BUkVBKGFyZWEpIHsKICAgIGlmIChhcmVhID49IDApIHsKICAgICAgdGhpcy5faGFzTWF4QXJlYSA9IHRydWU7CiAgICAgICgwLCBfdXRpbC5zaGFkb3cpKHRoaXMsICJNQVhfQVJFQSIsIGFyZWEpOwogICAgfQogIH0KICBzdGF0aWMgc2V0TWF4QXJlYShhcmVhKSB7CiAgICBpZiAoIXRoaXMuX2hhc01heEFyZWEpIHsKICAgICAgdGhpcy5NQVhfQVJFQSA9IGFyZWEgPj4gMjsKICAgIH0KICB9CiAgc3RhdGljIF9hcmVHb29kRGltcyh3aWR0aCwgaGVpZ2h0KSB7CiAgICB0cnkgewogICAgICBjb25zdCBjYW52YXMgPSBuZXcgT2Zmc2NyZWVuQ2FudmFzKHdpZHRoLCBoZWlnaHQpOwogICAgICBjb25zdCBjdHggPSBjYW52YXMuZ2V0Q29udGV4dCgiMmQiKTsKICAgICAgY3R4LmZpbGxSZWN0KDAsIDAsIDEsIDEpOwogICAgICBjb25zdCBvcGFjaXR5ID0gY3R4LmdldEltYWdlRGF0YSgwLCAwLCAxLCAxKS5kYXRhWzNdOwogICAgICBjYW52YXMud2lkdGggPSBjYW52YXMuaGVpZ2h0ID0gMTsKICAgICAgcmV0dXJuIG9wYWNpdHkgIT09IDA7CiAgICB9IGNhdGNoIHsKICAgICAgcmV0dXJuIGZhbHNlOwogICAgfQogIH0KICBzdGF0aWMgX2d1ZXNzTWF4KHN0YXJ0LCBlbmQsIHRvbGVyYW5jZSwgZGVmYXVsdEhlaWdodCkgewogICAgd2hpbGUgKHN0YXJ0ICsgdG9sZXJhbmNlICsgMSA8IGVuZCkgewogICAgICBjb25zdCBtaWRkbGUgPSBNYXRoLmZsb29yKChzdGFydCArIGVuZCkgLyAyKTsKICAgICAgY29uc3QgaGVpZ2h0ID0gZGVmYXVsdEhlaWdodCB8fCBtaWRkbGU7CiAgICAgIGlmICh0aGlzLl9hcmVHb29kRGltcyhtaWRkbGUsIGhlaWdodCkpIHsKICAgICAgICBzdGFydCA9IG1pZGRsZTsKICAgICAgfSBlbHNlIHsKICAgICAgICBlbmQgPSBtaWRkbGU7CiAgICAgIH0KICAgIH0KICAgIHJldHVybiBzdGFydDsKICB9CiAgc3RhdGljIGFzeW5jIGNyZWF0ZUltYWdlKGltZ0RhdGEsIGlzTWFzayA9IGZhbHNlKSB7CiAgICByZXR1cm4gbmV3IEltYWdlUmVzaXplcihpbWdEYXRhLCBpc01hc2spLl9jcmVhdGVJbWFnZSgpOwogIH0KICBhc3luYyBfY3JlYXRlSW1hZ2UoKSB7CiAgICBjb25zdCBkYXRhID0gdGhpcy5fZW5jb2RlQk1QKCk7CiAgICBjb25zdCBibG9iID0gbmV3IEJsb2IoW2RhdGEuYnVmZmVyXSwgewogICAgICB0eXBlOiAiaW1hZ2UvYm1wIgogICAgfSk7CiAgICBjb25zdCBiaXRtYXBQcm9taXNlID0gY3JlYXRlSW1hZ2VCaXRtYXAoYmxvYik7CiAgICBjb25zdCB7CiAgICAgIE1BWF9BUkVBLAogICAgICBNQVhfRElNCiAgICB9ID0gSW1hZ2VSZXNpemVyOwogICAgY29uc3QgewogICAgICBfaW1nRGF0YTogaW1nRGF0YQogICAgfSA9IHRoaXM7CiAgICBjb25zdCB7CiAgICAgIHdpZHRoLAogICAgICBoZWlnaHQKICAgIH0gPSBpbWdEYXRhOwogICAgY29uc3QgbWluRmFjdG9yID0gTWF0aC5tYXgod2lkdGggLyBNQVhfRElNLCBoZWlnaHQgLyBNQVhfRElNLCBNYXRoLnNxcnQod2lkdGggKiBoZWlnaHQgLyBNQVhfQVJFQSkpOwogICAgY29uc3QgZmlyc3RGYWN0b3IgPSBNYXRoLm1heChtaW5GYWN0b3IsIDIpOwogICAgY29uc3QgZmFjdG9yID0gTWF0aC5yb3VuZCgxMCAqIChtaW5GYWN0b3IgKyAxLjI1KSkgLyAxMCAvIGZpcnN0RmFjdG9yOwogICAgY29uc3QgTiA9IE1hdGguZmxvb3IoTWF0aC5sb2cyKGZhY3RvcikpOwogICAgY29uc3Qgc3RlcHMgPSBuZXcgQXJyYXkoTiArIDIpLmZpbGwoMik7CiAgICBzdGVwc1swXSA9IGZpcnN0RmFjdG9yOwogICAgc3RlcHMuc3BsaWNlKC0xLCAxLCBmYWN0b3IgLyAoMSA8PCBOKSk7CiAgICBsZXQgbmV3V2lkdGggPSB3aWR0aDsKICAgIGxldCBuZXdIZWlnaHQgPSBoZWlnaHQ7CiAgICBsZXQgYml0bWFwID0gYXdhaXQgYml0bWFwUHJvbWlzZTsKICAgIGZvciAoY29uc3Qgc3RlcCBvZiBzdGVwcykgewogICAgICBjb25zdCBwcmV2V2lkdGggPSBuZXdXaWR0aDsKICAgICAgY29uc3QgcHJldkhlaWdodCA9IG5ld0hlaWdodDsKICAgICAgbmV3V2lkdGggPSBNYXRoLmZsb29yKG5ld1dpZHRoIC8gc3RlcCkgLSAxOwogICAgICBuZXdIZWlnaHQgPSBNYXRoLmZsb29yKG5ld0hlaWdodCAvIHN0ZXApIC0gMTsKICAgICAgY29uc3QgY2FudmFzID0gbmV3IE9mZnNjcmVlbkNhbnZhcyhuZXdXaWR0aCwgbmV3SGVpZ2h0KTsKICAgICAgY29uc3QgY3R4ID0gY2FudmFzLmdldENvbnRleHQoIjJkIik7CiAgICAgIGN0eC5kcmF3SW1hZ2UoYml0bWFwLCAwLCAwLCBwcmV2V2lkdGgsIHByZXZIZWlnaHQsIDAsIDAsIG5ld1dpZHRoLCBuZXdIZWlnaHQpOwogICAgICBiaXRtYXAgPSBjYW52YXMudHJhbnNmZXJUb0ltYWdlQml0bWFwKCk7CiAgICB9CiAgICBpbWdEYXRhLmRhdGEgPSBudWxsOwogICAgaW1nRGF0YS5iaXRtYXAgPSBiaXRtYXA7CiAgICBpbWdEYXRhLndpZHRoID0gbmV3V2lkdGg7CiAgICBpbWdEYXRhLmhlaWdodCA9IG5ld0hlaWdodDsKICAgIHJldHVybiBpbWdEYXRhOwogIH0KICBfZW5jb2RlQk1QKCkgewogICAgY29uc3QgewogICAgICB3aWR0aCwKICAgICAgaGVpZ2h0LAogICAgICBraW5kCiAgICB9ID0gdGhpcy5faW1nRGF0YTsKICAgIGxldCBkYXRhID0gdGhpcy5faW1nRGF0YS5kYXRhOwogICAgbGV0IGJpdFBlclBpeGVsOwogICAgbGV0IGNvbG9yVGFibGUgPSBuZXcgVWludDhBcnJheSgwKTsKICAgIGxldCBtYXNrVGFibGUgPSBjb2xvclRhYmxlOwogICAgbGV0IGNvbXByZXNzaW9uID0gMDsKICAgIHN3aXRjaCAoa2luZCkgewogICAgICBjYXNlIF91dGlsLkltYWdlS2luZC5HUkFZU0NBTEVfMUJQUDoKICAgICAgICB7CiAgICAgICAgICBiaXRQZXJQaXhlbCA9IDE7CiAgICAgICAgICBjb2xvclRhYmxlID0gbmV3IFVpbnQ4QXJyYXkodGhpcy5faXNNYXNrID8gWzI1NSwgMjU1LCAyNTUsIDI1NSwgMCwgMCwgMCwgMF0gOiBbMCwgMCwgMCwgMCwgMjU1LCAyNTUsIDI1NSwgMjU1XSk7CiAgICAgICAgICBjb25zdCByb3dMZW4gPSB3aWR0aCArIDcgPj4gMzsKICAgICAgICAgIGNvbnN0IHJvd1NpemUgPSByb3dMZW4gKyAzICYgLTQ7CiAgICAgICAgICBpZiAocm93TGVuICE9PSByb3dTaXplKSB7CiAgICAgICAgICAgIGNvbnN0IG5ld0RhdGEgPSBuZXcgVWludDhBcnJheShyb3dTaXplICogaGVpZ2h0KTsKICAgICAgICAgICAgbGV0IGsgPSAwOwogICAgICAgICAgICBmb3IgKGxldCBpID0gMCwgaWkgPSBoZWlnaHQgKiByb3dMZW47IGkgPCBpaTsgaSArPSByb3dMZW4sIGsgKz0gcm93U2l6ZSkgewogICAgICAgICAgICAgIG5ld0RhdGEuc2V0KGRhdGEuc3ViYXJyYXkoaSwgaSArIHJvd0xlbiksIGspOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGRhdGEgPSBuZXdEYXRhOwogICAgICAgICAgfQogICAgICAgICAgYnJlYWs7CiAgICAgICAgfQogICAgICBjYXNlIF91dGlsLkltYWdlS2luZC5SR0JfMjRCUFA6CiAgICAgICAgewogICAgICAgICAgYml0UGVyUGl4ZWwgPSAyNDsKICAgICAgICAgIGlmICh3aWR0aCAmIDMpIHsKICAgICAgICAgICAgY29uc3Qgcm93TGVuID0gMyAqIHdpZHRoOwogICAgICAgICAgICBjb25zdCByb3dTaXplID0gcm93TGVuICsgMyAmIC00OwogICAgICAgICAgICBjb25zdCBleHRyYUxlbiA9IHJvd1NpemUgLSByb3dMZW47CiAgICAgICAgICAgIGNvbnN0IG5ld0RhdGEgPSBuZXcgVWludDhBcnJheShyb3dTaXplICogaGVpZ2h0KTsKICAgICAgICAgICAgbGV0IGsgPSAwOwogICAgICAgICAgICBmb3IgKGxldCBpID0gMCwgaWkgPSBoZWlnaHQgKiByb3dMZW47IGkgPCBpaTsgaSArPSByb3dMZW4pIHsKICAgICAgICAgICAgICBjb25zdCByb3cgPSBkYXRhLnN1YmFycmF5KGksIGkgKyByb3dMZW4pOwogICAgICAgICAgICAgIGZvciAobGV0IGogPSAwOyBqIDwgcm93TGVuOyBqICs9IDMpIHsKICAgICAgICAgICAgICAgIG5ld0RhdGFbaysrXSA9IHJvd1tqICsgMl07CiAgICAgICAgICAgICAgICBuZXdEYXRhW2srK10gPSByb3dbaiArIDFdOwogICAgICAgICAgICAgICAgbmV3RGF0YVtrKytdID0gcm93W2pdOwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgICBrICs9IGV4dHJhTGVuOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGRhdGEgPSBuZXdEYXRhOwogICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgZm9yIChsZXQgaSA9IDAsIGlpID0gZGF0YS5sZW5ndGg7IGkgPCBpaTsgaSArPSAzKSB7CiAgICAgICAgICAgICAgY29uc3QgdG1wID0gZGF0YVtpXTsKICAgICAgICAgICAgICBkYXRhW2ldID0gZGF0YVtpICsgMl07CiAgICAgICAgICAgICAgZGF0YVtpICsgMl0gPSB0bXA7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICAgIGJyZWFrOwogICAgICAgIH0KICAgICAgY2FzZSBfdXRpbC5JbWFnZUtpbmQuUkdCQV8zMkJQUDoKICAgICAgICBiaXRQZXJQaXhlbCA9IDMyOwogICAgICAgIGNvbXByZXNzaW9uID0gMzsKICAgICAgICBtYXNrVGFibGUgPSBuZXcgVWludDhBcnJheSg0ICsgNCArIDQgKyA0ICsgNTIpOwogICAgICAgIGNvbnN0IHZpZXcgPSBuZXcgRGF0YVZpZXcobWFza1RhYmxlLmJ1ZmZlcik7CiAgICAgICAgaWYgKF91dGlsLkZlYXR1cmVUZXN0LmlzTGl0dGxlRW5kaWFuKSB7CiAgICAgICAgICB2aWV3LnNldFVpbnQzMigwLCAweDAwMDAwMGZmLCB0cnVlKTsKICAgICAgICAgIHZpZXcuc2V0VWludDMyKDQsIDB4MDAwMGZmMDAsIHRydWUpOwogICAgICAgICAgdmlldy5zZXRVaW50MzIoOCwgMHgwMGZmMDAwMCwgdHJ1ZSk7CiAgICAgICAgICB2aWV3LnNldFVpbnQzMigxMiwgMHhmZjAwMDAwMCwgdHJ1ZSk7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIHZpZXcuc2V0VWludDMyKDAsIDB4ZmYwMDAwMDAsIHRydWUpOwogICAgICAgICAgdmlldy5zZXRVaW50MzIoNCwgMHgwMGZmMDAwMCwgdHJ1ZSk7CiAgICAgICAgICB2aWV3LnNldFVpbnQzMig4LCAweDAwMDBmZjAwLCB0cnVlKTsKICAgICAgICAgIHZpZXcuc2V0VWludDMyKDEyLCAweDAwMDAwMGZmLCB0cnVlKTsKICAgICAgICB9CiAgICAgICAgYnJlYWs7CiAgICAgIGRlZmF1bHQ6CiAgICAgICAgdGhyb3cgbmV3IEVycm9yKCJpbnZhbGlkIGZvcm1hdCIpOwogICAgfQogICAgbGV0IGkgPSAwOwogICAgY29uc3QgaGVhZGVyTGVuZ3RoID0gNDAgKyBtYXNrVGFibGUubGVuZ3RoOwogICAgY29uc3QgZmlsZUxlbmd0aCA9IDE0ICsgaGVhZGVyTGVuZ3RoICsgY29sb3JUYWJsZS5sZW5ndGggKyBkYXRhLmxlbmd0aDsKICAgIGNvbnN0IGJtcERhdGEgPSBuZXcgVWludDhBcnJheShmaWxlTGVuZ3RoKTsKICAgIGNvbnN0IHZpZXcgPSBuZXcgRGF0YVZpZXcoYm1wRGF0YS5idWZmZXIpOwogICAgdmlldy5zZXRVaW50MTYoaSwgMHg0ZDQyLCB0cnVlKTsKICAgIGkgKz0gMjsKICAgIHZpZXcuc2V0VWludDMyKGksIGZpbGVMZW5ndGgsIHRydWUpOwogICAgaSArPSA0OwogICAgdmlldy5zZXRVaW50MzIoaSwgMCwgdHJ1ZSk7CiAgICBpICs9IDQ7CiAgICB2aWV3LnNldFVpbnQzMihpLCAxNCArIGhlYWRlckxlbmd0aCArIGNvbG9yVGFibGUubGVuZ3RoLCB0cnVlKTsKICAgIGkgKz0gNDsKICAgIHZpZXcuc2V0VWludDMyKGksIGhlYWRlckxlbmd0aCwgdHJ1ZSk7CiAgICBpICs9IDQ7CiAgICB2aWV3LnNldEludDMyKGksIHdpZHRoLCB0cnVlKTsKICAgIGkgKz0gNDsKICAgIHZpZXcuc2V0SW50MzIoaSwgLWhlaWdodCwgdHJ1ZSk7CiAgICBpICs9IDQ7CiAgICB2aWV3LnNldFVpbnQxNihpLCAxLCB0cnVlKTsKICAgIGkgKz0gMjsKICAgIHZpZXcuc2V0VWludDE2KGksIGJpdFBlclBpeGVsLCB0cnVlKTsKICAgIGkgKz0gMjsKICAgIHZpZXcuc2V0VWludDMyKGksIGNvbXByZXNzaW9uLCB0cnVlKTsKICAgIGkgKz0gNDsKICAgIHZpZXcuc2V0VWludDMyKGksIDAsIHRydWUpOwogICAgaSArPSA0OwogICAgdmlldy5zZXRJbnQzMihpLCAwLCB0cnVlKTsKICAgIGkgKz0gNDsKICAgIHZpZXcuc2V0SW50MzIoaSwgMCwgdHJ1ZSk7CiAgICBpICs9IDQ7CiAgICB2aWV3LnNldFVpbnQzMihpLCBjb2xvclRhYmxlLmxlbmd0aCAvIDQsIHRydWUpOwogICAgaSArPSA0OwogICAgdmlldy5zZXRVaW50MzIoaSwgMCwgdHJ1ZSk7CiAgICBpICs9IDQ7CiAgICBibXBEYXRhLnNldChtYXNrVGFibGUsIGkpOwogICAgaSArPSBtYXNrVGFibGUubGVuZ3RoOwogICAgYm1wRGF0YS5zZXQoY29sb3JUYWJsZSwgaSk7CiAgICBpICs9IGNvbG9yVGFibGUubGVuZ3RoOwogICAgYm1wRGF0YS5zZXQoZGF0YSwgaSk7CiAgICByZXR1cm4gYm1wRGF0YTsKICB9Cn0KZXhwb3J0cy5JbWFnZVJlc2l6ZXIgPSBJbWFnZVJlc2l6ZXI7CkltYWdlUmVzaXplci5fZ29vZFNxdWFyZUxlbmd0aCA9IE1JTl9JTUFHRV9ESU07CgovKioqLyB9KSwKLyogNjMgKi8KLyoqKi8gKChfX3VudXNlZF93ZWJwYWNrX21vZHVsZSwgZXhwb3J0cywgX193X3BkZmpzX3JlcXVpcmVfXykgPT4gewoKCgpPYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgIl9fZXNNb2R1bGUiLCAoewogIHZhbHVlOiB0cnVlCn0pKTsKZXhwb3J0cy5NdXJtdXJIYXNoM182NCA9IHZvaWQgMDsKdmFyIF91dGlsID0gX193X3BkZmpzX3JlcXVpcmVfXygyKTsKY29uc3QgU0VFRCA9IDB4YzNkMmUxZjA7CmNvbnN0IE1BU0tfSElHSCA9IDB4ZmZmZjAwMDA7CmNvbnN0IE1BU0tfTE9XID0gMHhmZmZmOwpjbGFzcyBNdXJtdXJIYXNoM182NCB7CiAgY29uc3RydWN0b3Ioc2VlZCkgewogICAgdGhpcy5oMSA9IHNlZWQgPyBzZWVkICYgMHhmZmZmZmZmZiA6IFNFRUQ7CiAgICB0aGlzLmgyID0gc2VlZCA/IHNlZWQgJiAweGZmZmZmZmZmIDogU0VFRDsKICB9CiAgdXBkYXRlKGlucHV0KSB7CiAgICBsZXQgZGF0YSwgbGVuZ3RoOwogICAgaWYgKHR5cGVvZiBpbnB1dCA9PT0gInN0cmluZyIpIHsKICAgICAgZGF0YSA9IG5ldyBVaW50OEFycmF5KGlucHV0Lmxlbmd0aCAqIDIpOwogICAgICBsZW5ndGggPSAwOwogICAgICBmb3IgKGxldCBpID0gMCwgaWkgPSBpbnB1dC5sZW5ndGg7IGkgPCBpaTsgaSsrKSB7CiAgICAgICAgY29uc3QgY29kZSA9IGlucHV0LmNoYXJDb2RlQXQoaSk7CiAgICAgICAgaWYgKGNvZGUgPD0gMHhmZikgewogICAgICAgICAgZGF0YVtsZW5ndGgrK10gPSBjb2RlOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICBkYXRhW2xlbmd0aCsrXSA9IGNvZGUgPj4+IDg7CiAgICAgICAgICBkYXRhW2xlbmd0aCsrXSA9IGNvZGUgJiAweGZmOwogICAgICAgIH0KICAgICAgfQogICAgfSBlbHNlIGlmICgoMCwgX3V0aWwuaXNBcnJheUJ1ZmZlcikoaW5wdXQpKSB7CiAgICAgIGRhdGEgPSBpbnB1dC5zbGljZSgpOwogICAgICBsZW5ndGggPSBkYXRhLmJ5dGVMZW5ndGg7CiAgICB9IGVsc2UgewogICAgICB0aHJvdyBuZXcgRXJyb3IoIldyb25nIGRhdGEgZm9ybWF0IGluIE11cm11ckhhc2gzXzY0X3VwZGF0ZS4gIiArICJJbnB1dCBtdXN0IGJlIGEgc3RyaW5nIG9yIGFycmF5LiIpOwogICAgfQogICAgY29uc3QgYmxvY2tDb3VudHMgPSBsZW5ndGggPj4gMjsKICAgIGNvbnN0IHRhaWxMZW5ndGggPSBsZW5ndGggLSBibG9ja0NvdW50cyAqIDQ7CiAgICBjb25zdCBkYXRhVWludDMyID0gbmV3IFVpbnQzMkFycmF5KGRhdGEuYnVmZmVyLCAwLCBibG9ja0NvdW50cyk7CiAgICBsZXQgazEgPSAwLAogICAgICBrMiA9IDA7CiAgICBsZXQgaDEgPSB0aGlzLmgxLAogICAgICBoMiA9IHRoaXMuaDI7CiAgICBjb25zdCBDMSA9IDB4Y2M5ZTJkNTEsCiAgICAgIEMyID0gMHgxYjg3MzU5MzsKICAgIGNvbnN0IEMxX0xPVyA9IEMxICYgTUFTS19MT1csCiAgICAgIEMyX0xPVyA9IEMyICYgTUFTS19MT1c7CiAgICBmb3IgKGxldCBpID0gMDsgaSA8IGJsb2NrQ291bnRzOyBpKyspIHsKICAgICAgaWYgKGkgJiAxKSB7CiAgICAgICAgazEgPSBkYXRhVWludDMyW2ldOwogICAgICAgIGsxID0gazEgKiBDMSAmIE1BU0tfSElHSCB8IGsxICogQzFfTE9XICYgTUFTS19MT1c7CiAgICAgICAgazEgPSBrMSA8PCAxNSB8IGsxID4+PiAxNzsKICAgICAgICBrMSA9IGsxICogQzIgJiBNQVNLX0hJR0ggfCBrMSAqIEMyX0xPVyAmIE1BU0tfTE9XOwogICAgICAgIGgxIF49IGsxOwogICAgICAgIGgxID0gaDEgPDwgMTMgfCBoMSA+Pj4gMTk7CiAgICAgICAgaDEgPSBoMSAqIDUgKyAweGU2NTQ2YjY0OwogICAgICB9IGVsc2UgewogICAgICAgIGsyID0gZGF0YVVpbnQzMltpXTsKICAgICAgICBrMiA9IGsyICogQzEgJiBNQVNLX0hJR0ggfCBrMiAqIEMxX0xPVyAmIE1BU0tfTE9XOwogICAgICAgIGsyID0gazIgPDwgMTUgfCBrMiA+Pj4gMTc7CiAgICAgICAgazIgPSBrMiAqIEMyICYgTUFTS19ISUdIIHwgazIgKiBDMl9MT1cgJiBNQVNLX0xPVzsKICAgICAgICBoMiBePSBrMjsKICAgICAgICBoMiA9IGgyIDw8IDEzIHwgaDIgPj4+IDE5OwogICAgICAgIGgyID0gaDIgKiA1ICsgMHhlNjU0NmI2NDsKICAgICAgfQogICAgfQogICAgazEgPSAwOwogICAgc3dpdGNoICh0YWlsTGVuZ3RoKSB7CiAgICAgIGNhc2UgMzoKICAgICAgICBrMSBePSBkYXRhW2Jsb2NrQ291bnRzICogNCArIDJdIDw8IDE2OwogICAgICBjYXNlIDI6CiAgICAgICAgazEgXj0gZGF0YVtibG9ja0NvdW50cyAqIDQgKyAxXSA8PCA4OwogICAgICBjYXNlIDE6CiAgICAgICAgazEgXj0gZGF0YVtibG9ja0NvdW50cyAqIDRdOwogICAgICAgIGsxID0gazEgKiBDMSAmIE1BU0tfSElHSCB8IGsxICogQzFfTE9XICYgTUFTS19MT1c7CiAgICAgICAgazEgPSBrMSA8PCAxNSB8IGsxID4+PiAxNzsKICAgICAgICBrMSA9IGsxICogQzIgJiBNQVNLX0hJR0ggfCBrMSAqIEMyX0xPVyAmIE1BU0tfTE9XOwogICAgICAgIGlmIChibG9ja0NvdW50cyAmIDEpIHsKICAgICAgICAgIGgxIF49IGsxOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICBoMiBePSBrMTsKICAgICAgICB9CiAgICB9CiAgICB0aGlzLmgxID0gaDE7CiAgICB0aGlzLmgyID0gaDI7CiAgfQogIGhleGRpZ2VzdCgpIHsKICAgIGxldCBoMSA9IHRoaXMuaDEsCiAgICAgIGgyID0gdGhpcy5oMjsKICAgIGgxIF49IGgyID4+PiAxOwogICAgaDEgPSBoMSAqIDB4ZWQ1NThjY2QgJiBNQVNLX0hJR0ggfCBoMSAqIDB4OGNjZCAmIE1BU0tfTE9XOwogICAgaDIgPSBoMiAqIDB4ZmY1MWFmZDcgJiBNQVNLX0hJR0ggfCAoKGgyIDw8IDE2IHwgaDEgPj4+IDE2KSAqIDB4YWZkN2VkNTUgJiBNQVNLX0hJR0gpID4+PiAxNjsKICAgIGgxIF49IGgyID4+PiAxOwogICAgaDEgPSBoMSAqIDB4MWE4NWVjNTMgJiBNQVNLX0hJR0ggfCBoMSAqIDB4ZWM1MyAmIE1BU0tfTE9XOwogICAgaDIgPSBoMiAqIDB4YzRjZWI5ZmUgJiBNQVNLX0hJR0ggfCAoKGgyIDw8IDE2IHwgaDEgPj4+IDE2KSAqIDB4YjlmZTFhODUgJiBNQVNLX0hJR0gpID4+PiAxNjsKICAgIGgxIF49IGgyID4+PiAxOwogICAgcmV0dXJuIChoMSA+Pj4gMCkudG9TdHJpbmcoMTYpLnBhZFN0YXJ0KDgsICIwIikgKyAoaDIgPj4+IDApLnRvU3RyaW5nKDE2KS5wYWRTdGFydCg4LCAiMCIpOwogIH0KfQpleHBvcnRzLk11cm11ckhhc2gzXzY0ID0gTXVybXVySGFzaDNfNjQ7CgovKioqLyB9KSwKLyogNjQgKi8KLyoqKi8gKChfX3VudXNlZF93ZWJwYWNrX21vZHVsZSwgZXhwb3J0cywgX193X3BkZmpzX3JlcXVpcmVfXykgPT4gewoKCgpPYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgIl9fZXNNb2R1bGUiLCAoewogIHZhbHVlOiB0cnVlCn0pKTsKZXhwb3J0cy5PcGVyYXRvckxpc3QgPSB2b2lkIDA7CnZhciBfdXRpbCA9IF9fd19wZGZqc19yZXF1aXJlX18oMik7CmZ1bmN0aW9uIGFkZFN0YXRlKHBhcmVudFN0YXRlLCBwYXR0ZXJuLCBjaGVja0ZuLCBpdGVyYXRlRm4sIHByb2Nlc3NGbikgewogIGxldCBzdGF0ZSA9IHBhcmVudFN0YXRlOwogIGZvciAobGV0IGkgPSAwLCBpaSA9IHBhdHRlcm4ubGVuZ3RoIC0gMTsgaSA8IGlpOyBpKyspIHsKICAgIGNvbnN0IGl0ZW0gPSBwYXR0ZXJuW2ldOwogICAgc3RhdGUgPSBzdGF0ZVtpdGVtXSB8fD0gW107CiAgfQogIHN0YXRlW3BhdHRlcm4uYXQoLTEpXSA9IHsKICAgIGNoZWNrRm4sCiAgICBpdGVyYXRlRm4sCiAgICBwcm9jZXNzRm4KICB9Owp9CmNvbnN0IEluaXRpYWxTdGF0ZSA9IFtdOwphZGRTdGF0ZShJbml0aWFsU3RhdGUsIFtfdXRpbC5PUFMuc2F2ZSwgX3V0aWwuT1BTLnRyYW5zZm9ybSwgX3V0aWwuT1BTLnBhaW50SW5saW5lSW1hZ2VYT2JqZWN0LCBfdXRpbC5PUFMucmVzdG9yZV0sIG51bGwsIGZ1bmN0aW9uIGl0ZXJhdGVJbmxpbmVJbWFnZUdyb3VwKGNvbnRleHQsIGkpIHsKICBjb25zdCBmbkFycmF5ID0gY29udGV4dC5mbkFycmF5OwogIGNvbnN0IGlGaXJzdFNhdmUgPSBjb250ZXh0LmlDdXJyIC0gMzsKICBjb25zdCBwb3MgPSAoaSAtIGlGaXJzdFNhdmUpICUgNDsKICBzd2l0Y2ggKHBvcykgewogICAgY2FzZSAwOgogICAgICByZXR1cm4gZm5BcnJheVtpXSA9PT0gX3V0aWwuT1BTLnNhdmU7CiAgICBjYXNlIDE6CiAgICAgIHJldHVybiBmbkFycmF5W2ldID09PSBfdXRpbC5PUFMudHJhbnNmb3JtOwogICAgY2FzZSAyOgogICAgICByZXR1cm4gZm5BcnJheVtpXSA9PT0gX3V0aWwuT1BTLnBhaW50SW5saW5lSW1hZ2VYT2JqZWN0OwogICAgY2FzZSAzOgogICAgICByZXR1cm4gZm5BcnJheVtpXSA9PT0gX3V0aWwuT1BTLnJlc3RvcmU7CiAgfQogIHRocm93IG5ldyBFcnJvcihgaXRlcmF0ZUlubGluZUltYWdlR3JvdXAgLSBpbnZhbGlkIHBvczogJHtwb3N9YCk7Cn0sIGZ1bmN0aW9uIGZvdW5kSW5saW5lSW1hZ2VHcm91cChjb250ZXh0LCBpKSB7CiAgY29uc3QgTUlOX0lNQUdFU19JTl9JTkxJTkVfSU1BR0VTX0JMT0NLID0gMTA7CiAgY29uc3QgTUFYX0lNQUdFU19JTl9JTkxJTkVfSU1BR0VTX0JMT0NLID0gMjAwOwogIGNvbnN0IE1BWF9XSURUSCA9IDEwMDA7CiAgY29uc3QgSU1BR0VfUEFERElORyA9IDE7CiAgY29uc3QgZm5BcnJheSA9IGNvbnRleHQuZm5BcnJheSwKICAgIGFyZ3NBcnJheSA9IGNvbnRleHQuYXJnc0FycmF5OwogIGNvbnN0IGN1cnIgPSBjb250ZXh0LmlDdXJyOwogIGNvbnN0IGlGaXJzdFNhdmUgPSBjdXJyIC0gMzsKICBjb25zdCBpRmlyc3RUcmFuc2Zvcm0gPSBjdXJyIC0gMjsKICBjb25zdCBpRmlyc3RQSUlYTyA9IGN1cnIgLSAxOwogIGNvbnN0IGNvdW50ID0gTWF0aC5taW4oTWF0aC5mbG9vcigoaSAtIGlGaXJzdFNhdmUpIC8gNCksIE1BWF9JTUFHRVNfSU5fSU5MSU5FX0lNQUdFU19CTE9DSyk7CiAgaWYgKGNvdW50IDwgTUlOX0lNQUdFU19JTl9JTkxJTkVfSU1BR0VTX0JMT0NLKSB7CiAgICByZXR1cm4gaSAtIChpIC0gaUZpcnN0U2F2ZSkgJSA0OwogIH0KICBsZXQgbWF4WCA9IDA7CiAgY29uc3QgbWFwID0gW107CiAgbGV0IG1heExpbmVIZWlnaHQgPSAwOwogIGxldCBjdXJyZW50WCA9IElNQUdFX1BBRERJTkcsCiAgICBjdXJyZW50WSA9IElNQUdFX1BBRERJTkc7CiAgZm9yIChsZXQgcSA9IDA7IHEgPCBjb3VudDsgcSsrKSB7CiAgICBjb25zdCB0cmFuc2Zvcm0gPSBhcmdzQXJyYXlbaUZpcnN0VHJhbnNmb3JtICsgKHEgPDwgMildOwogICAgY29uc3QgaW1nID0gYXJnc0FycmF5W2lGaXJzdFBJSVhPICsgKHEgPDwgMildWzBdOwogICAgaWYgKGN1cnJlbnRYICsgaW1nLndpZHRoID4gTUFYX1dJRFRIKSB7CiAgICAgIG1heFggPSBNYXRoLm1heChtYXhYLCBjdXJyZW50WCk7CiAgICAgIGN1cnJlbnRZICs9IG1heExpbmVIZWlnaHQgKyAyICogSU1BR0VfUEFERElORzsKICAgICAgY3VycmVudFggPSAwOwogICAgICBtYXhMaW5lSGVpZ2h0ID0gMDsKICAgIH0KICAgIG1hcC5wdXNoKHsKICAgICAgdHJhbnNmb3JtLAogICAgICB4OiBjdXJyZW50WCwKICAgICAgeTogY3VycmVudFksCiAgICAgIHc6IGltZy53aWR0aCwKICAgICAgaDogaW1nLmhlaWdodAogICAgfSk7CiAgICBjdXJyZW50WCArPSBpbWcud2lkdGggKyAyICogSU1BR0VfUEFERElORzsKICAgIG1heExpbmVIZWlnaHQgPSBNYXRoLm1heChtYXhMaW5lSGVpZ2h0LCBpbWcuaGVpZ2h0KTsKICB9CiAgY29uc3QgaW1nV2lkdGggPSBNYXRoLm1heChtYXhYLCBjdXJyZW50WCkgKyBJTUFHRV9QQURESU5HOwogIGNvbnN0IGltZ0hlaWdodCA9IGN1cnJlbnRZICsgbWF4TGluZUhlaWdodCArIElNQUdFX1BBRERJTkc7CiAgY29uc3QgaW1nRGF0YSA9IG5ldyBVaW50OEFycmF5KGltZ1dpZHRoICogaW1nSGVpZ2h0ICogNCk7CiAgY29uc3QgaW1nUm93U2l6ZSA9IGltZ1dpZHRoIDw8IDI7CiAgZm9yIChsZXQgcSA9IDA7IHEgPCBjb3VudDsgcSsrKSB7CiAgICBjb25zdCBkYXRhID0gYXJnc0FycmF5W2lGaXJzdFBJSVhPICsgKHEgPDwgMildWzBdLmRhdGE7CiAgICBjb25zdCByb3dTaXplID0gbWFwW3FdLncgPDwgMjsKICAgIGxldCBkYXRhT2Zmc2V0ID0gMDsKICAgIGxldCBvZmZzZXQgPSBtYXBbcV0ueCArIG1hcFtxXS55ICogaW1nV2lkdGggPDwgMjsKICAgIGltZ0RhdGEuc2V0KGRhdGEuc3ViYXJyYXkoMCwgcm93U2l6ZSksIG9mZnNldCAtIGltZ1Jvd1NpemUpOwogICAgZm9yIChsZXQgayA9IDAsIGtrID0gbWFwW3FdLmg7IGsgPCBrazsgaysrKSB7CiAgICAgIGltZ0RhdGEuc2V0KGRhdGEuc3ViYXJyYXkoZGF0YU9mZnNldCwgZGF0YU9mZnNldCArIHJvd1NpemUpLCBvZmZzZXQpOwogICAgICBkYXRhT2Zmc2V0ICs9IHJvd1NpemU7CiAgICAgIG9mZnNldCArPSBpbWdSb3dTaXplOwogICAgfQogICAgaW1nRGF0YS5zZXQoZGF0YS5zdWJhcnJheShkYXRhT2Zmc2V0IC0gcm93U2l6ZSwgZGF0YU9mZnNldCksIG9mZnNldCk7CiAgICB3aGlsZSAob2Zmc2V0ID49IDApIHsKICAgICAgZGF0YVtvZmZzZXQgLSA0XSA9IGRhdGFbb2Zmc2V0XTsKICAgICAgZGF0YVtvZmZzZXQgLSAzXSA9IGRhdGFbb2Zmc2V0ICsgMV07CiAgICAgIGRhdGFbb2Zmc2V0IC0gMl0gPSBkYXRhW29mZnNldCArIDJdOwogICAgICBkYXRhW29mZnNldCAtIDFdID0gZGF0YVtvZmZzZXQgKyAzXTsKICAgICAgZGF0YVtvZmZzZXQgKyByb3dTaXplXSA9IGRhdGFbb2Zmc2V0ICsgcm93U2l6ZSAtIDRdOwogICAgICBkYXRhW29mZnNldCArIHJvd1NpemUgKyAxXSA9IGRhdGFbb2Zmc2V0ICsgcm93U2l6ZSAtIDNdOwogICAgICBkYXRhW29mZnNldCArIHJvd1NpemUgKyAyXSA9IGRhdGFbb2Zmc2V0ICsgcm93U2l6ZSAtIDJdOwogICAgICBkYXRhW29mZnNldCArIHJvd1NpemUgKyAzXSA9IGRhdGFbb2Zmc2V0ICsgcm93U2l6ZSAtIDFdOwogICAgICBvZmZzZXQgLT0gaW1nUm93U2l6ZTsKICAgIH0KICB9CiAgY29uc3QgaW1nID0gewogICAgd2lkdGg6IGltZ1dpZHRoLAogICAgaGVpZ2h0OiBpbWdIZWlnaHQKICB9OwogIGlmIChjb250ZXh0LmlzT2Zmc2NyZWVuQ2FudmFzU3VwcG9ydGVkKSB7CiAgICBjb25zdCBjYW52YXMgPSBuZXcgT2Zmc2NyZWVuQ2FudmFzKGltZ1dpZHRoLCBpbWdIZWlnaHQpOwogICAgY29uc3QgY3R4ID0gY2FudmFzLmdldENvbnRleHQoIjJkIik7CiAgICBjdHgucHV0SW1hZ2VEYXRhKG5ldyBJbWFnZURhdGEobmV3IFVpbnQ4Q2xhbXBlZEFycmF5KGltZ0RhdGEuYnVmZmVyKSwgaW1nV2lkdGgsIGltZ0hlaWdodCksIDAsIDApOwogICAgaW1nLmJpdG1hcCA9IGNhbnZhcy50cmFuc2ZlclRvSW1hZ2VCaXRtYXAoKTsKICAgIGltZy5kYXRhID0gbnVsbDsKICB9IGVsc2UgewogICAgaW1nLmtpbmQgPSBfdXRpbC5JbWFnZUtpbmQuUkdCQV8zMkJQUDsKICAgIGltZy5kYXRhID0gaW1nRGF0YTsKICB9CiAgZm5BcnJheS5zcGxpY2UoaUZpcnN0U2F2ZSwgY291bnQgKiA0LCBfdXRpbC5PUFMucGFpbnRJbmxpbmVJbWFnZVhPYmplY3RHcm91cCk7CiAgYXJnc0FycmF5LnNwbGljZShpRmlyc3RTYXZlLCBjb3VudCAqIDQsIFtpbWcsIG1hcF0pOwogIHJldHVybiBpRmlyc3RTYXZlICsgMTsKfSk7CmFkZFN0YXRlKEluaXRpYWxTdGF0ZSwgW191dGlsLk9QUy5zYXZlLCBfdXRpbC5PUFMudHJhbnNmb3JtLCBfdXRpbC5PUFMucGFpbnRJbWFnZU1hc2tYT2JqZWN0LCBfdXRpbC5PUFMucmVzdG9yZV0sIG51bGwsIGZ1bmN0aW9uIGl0ZXJhdGVJbWFnZU1hc2tHcm91cChjb250ZXh0LCBpKSB7CiAgY29uc3QgZm5BcnJheSA9IGNvbnRleHQuZm5BcnJheTsKICBjb25zdCBpRmlyc3RTYXZlID0gY29udGV4dC5pQ3VyciAtIDM7CiAgY29uc3QgcG9zID0gKGkgLSBpRmlyc3RTYXZlKSAlIDQ7CiAgc3dpdGNoIChwb3MpIHsKICAgIGNhc2UgMDoKICAgICAgcmV0dXJuIGZuQXJyYXlbaV0gPT09IF91dGlsLk9QUy5zYXZlOwogICAgY2FzZSAxOgogICAgICByZXR1cm4gZm5BcnJheVtpXSA9PT0gX3V0aWwuT1BTLnRyYW5zZm9ybTsKICAgIGNhc2UgMjoKICAgICAgcmV0dXJuIGZuQXJyYXlbaV0gPT09IF91dGlsLk9QUy5wYWludEltYWdlTWFza1hPYmplY3Q7CiAgICBjYXNlIDM6CiAgICAgIHJldHVybiBmbkFycmF5W2ldID09PSBfdXRpbC5PUFMucmVzdG9yZTsKICB9CiAgdGhyb3cgbmV3IEVycm9yKGBpdGVyYXRlSW1hZ2VNYXNrR3JvdXAgLSBpbnZhbGlkIHBvczogJHtwb3N9YCk7Cn0sIGZ1bmN0aW9uIGZvdW5kSW1hZ2VNYXNrR3JvdXAoY29udGV4dCwgaSkgewogIGNvbnN0IE1JTl9JTUFHRVNfSU5fTUFTS1NfQkxPQ0sgPSAxMDsKICBjb25zdCBNQVhfSU1BR0VTX0lOX01BU0tTX0JMT0NLID0gMTAwOwogIGNvbnN0IE1BWF9TQU1FX0lNQUdFU19JTl9NQVNLU19CTE9DSyA9IDEwMDA7CiAgY29uc3QgZm5BcnJheSA9IGNvbnRleHQuZm5BcnJheSwKICAgIGFyZ3NBcnJheSA9IGNvbnRleHQuYXJnc0FycmF5OwogIGNvbnN0IGN1cnIgPSBjb250ZXh0LmlDdXJyOwogIGNvbnN0IGlGaXJzdFNhdmUgPSBjdXJyIC0gMzsKICBjb25zdCBpRmlyc3RUcmFuc2Zvcm0gPSBjdXJyIC0gMjsKICBjb25zdCBpRmlyc3RQSU1YTyA9IGN1cnIgLSAxOwogIGxldCBjb3VudCA9IE1hdGguZmxvb3IoKGkgLSBpRmlyc3RTYXZlKSAvIDQpOwogIGlmIChjb3VudCA8IE1JTl9JTUFHRVNfSU5fTUFTS1NfQkxPQ0spIHsKICAgIHJldHVybiBpIC0gKGkgLSBpRmlyc3RTYXZlKSAlIDQ7CiAgfQogIGxldCBpc1NhbWVJbWFnZSA9IGZhbHNlOwogIGxldCBpVHJhbnNmb3JtLCB0cmFuc2Zvcm1BcmdzOwogIGNvbnN0IGZpcnN0UElNWE9BcmcwID0gYXJnc0FycmF5W2lGaXJzdFBJTVhPXVswXTsKICBjb25zdCBmaXJzdFRyYW5zZm9ybUFyZzAgPSBhcmdzQXJyYXlbaUZpcnN0VHJhbnNmb3JtXVswXSwKICAgIGZpcnN0VHJhbnNmb3JtQXJnMSA9IGFyZ3NBcnJheVtpRmlyc3RUcmFuc2Zvcm1dWzFdLAogICAgZmlyc3RUcmFuc2Zvcm1BcmcyID0gYXJnc0FycmF5W2lGaXJzdFRyYW5zZm9ybV1bMl0sCiAgICBmaXJzdFRyYW5zZm9ybUFyZzMgPSBhcmdzQXJyYXlbaUZpcnN0VHJhbnNmb3JtXVszXTsKICBpZiAoZmlyc3RUcmFuc2Zvcm1BcmcxID09PSBmaXJzdFRyYW5zZm9ybUFyZzIpIHsKICAgIGlzU2FtZUltYWdlID0gdHJ1ZTsKICAgIGlUcmFuc2Zvcm0gPSBpRmlyc3RUcmFuc2Zvcm0gKyA0OwogICAgbGV0IGlQSU1YTyA9IGlGaXJzdFBJTVhPICsgNDsKICAgIGZvciAobGV0IHEgPSAxOyBxIDwgY291bnQ7IHErKywgaVRyYW5zZm9ybSArPSA0LCBpUElNWE8gKz0gNCkgewogICAgICB0cmFuc2Zvcm1BcmdzID0gYXJnc0FycmF5W2lUcmFuc2Zvcm1dOwogICAgICBpZiAoYXJnc0FycmF5W2lQSU1YT11bMF0gIT09IGZpcnN0UElNWE9BcmcwIHx8IHRyYW5zZm9ybUFyZ3NbMF0gIT09IGZpcnN0VHJhbnNmb3JtQXJnMCB8fCB0cmFuc2Zvcm1BcmdzWzFdICE9PSBmaXJzdFRyYW5zZm9ybUFyZzEgfHwgdHJhbnNmb3JtQXJnc1syXSAhPT0gZmlyc3RUcmFuc2Zvcm1BcmcyIHx8IHRyYW5zZm9ybUFyZ3NbM10gIT09IGZpcnN0VHJhbnNmb3JtQXJnMykgewogICAgICAgIGlmIChxIDwgTUlOX0lNQUdFU19JTl9NQVNLU19CTE9DSykgewogICAgICAgICAgaXNTYW1lSW1hZ2UgPSBmYWxzZTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgY291bnQgPSBxOwogICAgICAgIH0KICAgICAgICBicmVhazsKICAgICAgfQogICAgfQogIH0KICBpZiAoaXNTYW1lSW1hZ2UpIHsKICAgIGNvdW50ID0gTWF0aC5taW4oY291bnQsIE1BWF9TQU1FX0lNQUdFU19JTl9NQVNLU19CTE9DSyk7CiAgICBjb25zdCBwb3NpdGlvbnMgPSBuZXcgRmxvYXQzMkFycmF5KGNvdW50ICogMik7CiAgICBpVHJhbnNmb3JtID0gaUZpcnN0VHJhbnNmb3JtOwogICAgZm9yIChsZXQgcSA9IDA7IHEgPCBjb3VudDsgcSsrLCBpVHJhbnNmb3JtICs9IDQpIHsKICAgICAgdHJhbnNmb3JtQXJncyA9IGFyZ3NBcnJheVtpVHJhbnNmb3JtXTsKICAgICAgcG9zaXRpb25zW3EgPDwgMV0gPSB0cmFuc2Zvcm1BcmdzWzRdOwogICAgICBwb3NpdGlvbnNbKHEgPDwgMSkgKyAxXSA9IHRyYW5zZm9ybUFyZ3NbNV07CiAgICB9CiAgICBmbkFycmF5LnNwbGljZShpRmlyc3RTYXZlLCBjb3VudCAqIDQsIF91dGlsLk9QUy5wYWludEltYWdlTWFza1hPYmplY3RSZXBlYXQpOwogICAgYXJnc0FycmF5LnNwbGljZShpRmlyc3RTYXZlLCBjb3VudCAqIDQsIFtmaXJzdFBJTVhPQXJnMCwgZmlyc3RUcmFuc2Zvcm1BcmcwLCBmaXJzdFRyYW5zZm9ybUFyZzEsIGZpcnN0VHJhbnNmb3JtQXJnMiwgZmlyc3RUcmFuc2Zvcm1BcmczLCBwb3NpdGlvbnNdKTsKICB9IGVsc2UgewogICAgY291bnQgPSBNYXRoLm1pbihjb3VudCwgTUFYX0lNQUdFU19JTl9NQVNLU19CTE9DSyk7CiAgICBjb25zdCBpbWFnZXMgPSBbXTsKICAgIGZvciAobGV0IHEgPSAwOyBxIDwgY291bnQ7IHErKykgewogICAgICB0cmFuc2Zvcm1BcmdzID0gYXJnc0FycmF5W2lGaXJzdFRyYW5zZm9ybSArIChxIDw8IDIpXTsKICAgICAgY29uc3QgbWFza1BhcmFtcyA9IGFyZ3NBcnJheVtpRmlyc3RQSU1YTyArIChxIDw8IDIpXVswXTsKICAgICAgaW1hZ2VzLnB1c2goewogICAgICAgIGRhdGE6IG1hc2tQYXJhbXMuZGF0YSwKICAgICAgICB3aWR0aDogbWFza1BhcmFtcy53aWR0aCwKICAgICAgICBoZWlnaHQ6IG1hc2tQYXJhbXMuaGVpZ2h0LAogICAgICAgIGludGVycG9sYXRlOiBtYXNrUGFyYW1zLmludGVycG9sYXRlLAogICAgICAgIGNvdW50OiBtYXNrUGFyYW1zLmNvdW50LAogICAgICAgIHRyYW5zZm9ybTogdHJhbnNmb3JtQXJncwogICAgICB9KTsKICAgIH0KICAgIGZuQXJyYXkuc3BsaWNlKGlGaXJzdFNhdmUsIGNvdW50ICogNCwgX3V0aWwuT1BTLnBhaW50SW1hZ2VNYXNrWE9iamVjdEdyb3VwKTsKICAgIGFyZ3NBcnJheS5zcGxpY2UoaUZpcnN0U2F2ZSwgY291bnQgKiA0LCBbaW1hZ2VzXSk7CiAgfQogIHJldHVybiBpRmlyc3RTYXZlICsgMTsKfSk7CmFkZFN0YXRlKEluaXRpYWxTdGF0ZSwgW191dGlsLk9QUy5zYXZlLCBfdXRpbC5PUFMudHJhbnNmb3JtLCBfdXRpbC5PUFMucGFpbnRJbWFnZVhPYmplY3QsIF91dGlsLk9QUy5yZXN0b3JlXSwgZnVuY3Rpb24gKGNvbnRleHQpIHsKICBjb25zdCBhcmdzQXJyYXkgPSBjb250ZXh0LmFyZ3NBcnJheTsKICBjb25zdCBpRmlyc3RUcmFuc2Zvcm0gPSBjb250ZXh0LmlDdXJyIC0gMjsKICByZXR1cm4gYXJnc0FycmF5W2lGaXJzdFRyYW5zZm9ybV1bMV0gPT09IDAgJiYgYXJnc0FycmF5W2lGaXJzdFRyYW5zZm9ybV1bMl0gPT09IDA7Cn0sIGZ1bmN0aW9uIGl0ZXJhdGVJbWFnZUdyb3VwKGNvbnRleHQsIGkpIHsKICBjb25zdCBmbkFycmF5ID0gY29udGV4dC5mbkFycmF5LAogICAgYXJnc0FycmF5ID0gY29udGV4dC5hcmdzQXJyYXk7CiAgY29uc3QgaUZpcnN0U2F2ZSA9IGNvbnRleHQuaUN1cnIgLSAzOwogIGNvbnN0IHBvcyA9IChpIC0gaUZpcnN0U2F2ZSkgJSA0OwogIHN3aXRjaCAocG9zKSB7CiAgICBjYXNlIDA6CiAgICAgIHJldHVybiBmbkFycmF5W2ldID09PSBfdXRpbC5PUFMuc2F2ZTsKICAgIGNhc2UgMToKICAgICAgaWYgKGZuQXJyYXlbaV0gIT09IF91dGlsLk9QUy50cmFuc2Zvcm0pIHsKICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgIH0KICAgICAgY29uc3QgaUZpcnN0VHJhbnNmb3JtID0gY29udGV4dC5pQ3VyciAtIDI7CiAgICAgIGNvbnN0IGZpcnN0VHJhbnNmb3JtQXJnMCA9IGFyZ3NBcnJheVtpRmlyc3RUcmFuc2Zvcm1dWzBdOwogICAgICBjb25zdCBmaXJzdFRyYW5zZm9ybUFyZzMgPSBhcmdzQXJyYXlbaUZpcnN0VHJhbnNmb3JtXVszXTsKICAgICAgaWYgKGFyZ3NBcnJheVtpXVswXSAhPT0gZmlyc3RUcmFuc2Zvcm1BcmcwIHx8IGFyZ3NBcnJheVtpXVsxXSAhPT0gMCB8fCBhcmdzQXJyYXlbaV1bMl0gIT09IDAgfHwgYXJnc0FycmF5W2ldWzNdICE9PSBmaXJzdFRyYW5zZm9ybUFyZzMpIHsKICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgIH0KICAgICAgcmV0dXJuIHRydWU7CiAgICBjYXNlIDI6CiAgICAgIGlmIChmbkFycmF5W2ldICE9PSBfdXRpbC5PUFMucGFpbnRJbWFnZVhPYmplY3QpIHsKICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgIH0KICAgICAgY29uc3QgaUZpcnN0UElYTyA9IGNvbnRleHQuaUN1cnIgLSAxOwogICAgICBjb25zdCBmaXJzdFBJWE9BcmcwID0gYXJnc0FycmF5W2lGaXJzdFBJWE9dWzBdOwogICAgICBpZiAoYXJnc0FycmF5W2ldWzBdICE9PSBmaXJzdFBJWE9BcmcwKSB7CiAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICB9CiAgICAgIHJldHVybiB0cnVlOwogICAgY2FzZSAzOgogICAgICByZXR1cm4gZm5BcnJheVtpXSA9PT0gX3V0aWwuT1BTLnJlc3RvcmU7CiAgfQogIHRocm93IG5ldyBFcnJvcihgaXRlcmF0ZUltYWdlR3JvdXAgLSBpbnZhbGlkIHBvczogJHtwb3N9YCk7Cn0sIGZ1bmN0aW9uIChjb250ZXh0LCBpKSB7CiAgY29uc3QgTUlOX0lNQUdFU19JTl9CTE9DSyA9IDM7CiAgY29uc3QgTUFYX0lNQUdFU19JTl9CTE9DSyA9IDEwMDA7CiAgY29uc3QgZm5BcnJheSA9IGNvbnRleHQuZm5BcnJheSwKICAgIGFyZ3NBcnJheSA9IGNvbnRleHQuYXJnc0FycmF5OwogIGNvbnN0IGN1cnIgPSBjb250ZXh0LmlDdXJyOwogIGNvbnN0IGlGaXJzdFNhdmUgPSBjdXJyIC0gMzsKICBjb25zdCBpRmlyc3RUcmFuc2Zvcm0gPSBjdXJyIC0gMjsKICBjb25zdCBpRmlyc3RQSVhPID0gY3VyciAtIDE7CiAgY29uc3QgZmlyc3RQSVhPQXJnMCA9IGFyZ3NBcnJheVtpRmlyc3RQSVhPXVswXTsKICBjb25zdCBmaXJzdFRyYW5zZm9ybUFyZzAgPSBhcmdzQXJyYXlbaUZpcnN0VHJhbnNmb3JtXVswXTsKICBjb25zdCBmaXJzdFRyYW5zZm9ybUFyZzMgPSBhcmdzQXJyYXlbaUZpcnN0VHJhbnNmb3JtXVszXTsKICBjb25zdCBjb3VudCA9IE1hdGgubWluKE1hdGguZmxvb3IoKGkgLSBpRmlyc3RTYXZlKSAvIDQpLCBNQVhfSU1BR0VTX0lOX0JMT0NLKTsKICBpZiAoY291bnQgPCBNSU5fSU1BR0VTX0lOX0JMT0NLKSB7CiAgICByZXR1cm4gaSAtIChpIC0gaUZpcnN0U2F2ZSkgJSA0OwogIH0KICBjb25zdCBwb3NpdGlvbnMgPSBuZXcgRmxvYXQzMkFycmF5KGNvdW50ICogMik7CiAgbGV0IGlUcmFuc2Zvcm0gPSBpRmlyc3RUcmFuc2Zvcm07CiAgZm9yIChsZXQgcSA9IDA7IHEgPCBjb3VudDsgcSsrLCBpVHJhbnNmb3JtICs9IDQpIHsKICAgIGNvbnN0IHRyYW5zZm9ybUFyZ3MgPSBhcmdzQXJyYXlbaVRyYW5zZm9ybV07CiAgICBwb3NpdGlvbnNbcSA8PCAxXSA9IHRyYW5zZm9ybUFyZ3NbNF07CiAgICBwb3NpdGlvbnNbKHEgPDwgMSkgKyAxXSA9IHRyYW5zZm9ybUFyZ3NbNV07CiAgfQogIGNvbnN0IGFyZ3MgPSBbZmlyc3RQSVhPQXJnMCwgZmlyc3RUcmFuc2Zvcm1BcmcwLCBmaXJzdFRyYW5zZm9ybUFyZzMsIHBvc2l0aW9uc107CiAgZm5BcnJheS5zcGxpY2UoaUZpcnN0U2F2ZSwgY291bnQgKiA0LCBfdXRpbC5PUFMucGFpbnRJbWFnZVhPYmplY3RSZXBlYXQpOwogIGFyZ3NBcnJheS5zcGxpY2UoaUZpcnN0U2F2ZSwgY291bnQgKiA0LCBhcmdzKTsKICByZXR1cm4gaUZpcnN0U2F2ZSArIDE7Cn0pOwphZGRTdGF0ZShJbml0aWFsU3RhdGUsIFtfdXRpbC5PUFMuYmVnaW5UZXh0LCBfdXRpbC5PUFMuc2V0Rm9udCwgX3V0aWwuT1BTLnNldFRleHRNYXRyaXgsIF91dGlsLk9QUy5zaG93VGV4dCwgX3V0aWwuT1BTLmVuZFRleHRdLCBudWxsLCBmdW5jdGlvbiBpdGVyYXRlU2hvd1RleHRHcm91cChjb250ZXh0LCBpKSB7CiAgY29uc3QgZm5BcnJheSA9IGNvbnRleHQuZm5BcnJheSwKICAgIGFyZ3NBcnJheSA9IGNvbnRleHQuYXJnc0FycmF5OwogIGNvbnN0IGlGaXJzdFNhdmUgPSBjb250ZXh0LmlDdXJyIC0gNDsKICBjb25zdCBwb3MgPSAoaSAtIGlGaXJzdFNhdmUpICUgNTsKICBzd2l0Y2ggKHBvcykgewogICAgY2FzZSAwOgogICAgICByZXR1cm4gZm5BcnJheVtpXSA9PT0gX3V0aWwuT1BTLmJlZ2luVGV4dDsKICAgIGNhc2UgMToKICAgICAgcmV0dXJuIGZuQXJyYXlbaV0gPT09IF91dGlsLk9QUy5zZXRGb250OwogICAgY2FzZSAyOgogICAgICByZXR1cm4gZm5BcnJheVtpXSA9PT0gX3V0aWwuT1BTLnNldFRleHRNYXRyaXg7CiAgICBjYXNlIDM6CiAgICAgIGlmIChmbkFycmF5W2ldICE9PSBfdXRpbC5PUFMuc2hvd1RleHQpIHsKICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgIH0KICAgICAgY29uc3QgaUZpcnN0U2V0Rm9udCA9IGNvbnRleHQuaUN1cnIgLSAzOwogICAgICBjb25zdCBmaXJzdFNldEZvbnRBcmcwID0gYXJnc0FycmF5W2lGaXJzdFNldEZvbnRdWzBdOwogICAgICBjb25zdCBmaXJzdFNldEZvbnRBcmcxID0gYXJnc0FycmF5W2lGaXJzdFNldEZvbnRdWzFdOwogICAgICBpZiAoYXJnc0FycmF5W2ldWzBdICE9PSBmaXJzdFNldEZvbnRBcmcwIHx8IGFyZ3NBcnJheVtpXVsxXSAhPT0gZmlyc3RTZXRGb250QXJnMSkgewogICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgfQogICAgICByZXR1cm4gdHJ1ZTsKICAgIGNhc2UgNDoKICAgICAgcmV0dXJuIGZuQXJyYXlbaV0gPT09IF91dGlsLk9QUy5lbmRUZXh0OwogIH0KICB0aHJvdyBuZXcgRXJyb3IoYGl0ZXJhdGVTaG93VGV4dEdyb3VwIC0gaW52YWxpZCBwb3M6ICR7cG9zfWApOwp9LCBmdW5jdGlvbiAoY29udGV4dCwgaSkgewogIGNvbnN0IE1JTl9DSEFSU19JTl9CTE9DSyA9IDM7CiAgY29uc3QgTUFYX0NIQVJTX0lOX0JMT0NLID0gMTAwMDsKICBjb25zdCBmbkFycmF5ID0gY29udGV4dC5mbkFycmF5LAogICAgYXJnc0FycmF5ID0gY29udGV4dC5hcmdzQXJyYXk7CiAgY29uc3QgY3VyciA9IGNvbnRleHQuaUN1cnI7CiAgY29uc3QgaUZpcnN0QmVnaW5UZXh0ID0gY3VyciAtIDQ7CiAgY29uc3QgaUZpcnN0U2V0Rm9udCA9IGN1cnIgLSAzOwogIGNvbnN0IGlGaXJzdFNldFRleHRNYXRyaXggPSBjdXJyIC0gMjsKICBjb25zdCBpRmlyc3RTaG93VGV4dCA9IGN1cnIgLSAxOwogIGNvbnN0IGlGaXJzdEVuZFRleHQgPSBjdXJyOwogIGNvbnN0IGZpcnN0U2V0Rm9udEFyZzAgPSBhcmdzQXJyYXlbaUZpcnN0U2V0Rm9udF1bMF07CiAgY29uc3QgZmlyc3RTZXRGb250QXJnMSA9IGFyZ3NBcnJheVtpRmlyc3RTZXRGb250XVsxXTsKICBsZXQgY291bnQgPSBNYXRoLm1pbihNYXRoLmZsb29yKChpIC0gaUZpcnN0QmVnaW5UZXh0KSAvIDUpLCBNQVhfQ0hBUlNfSU5fQkxPQ0spOwogIGlmIChjb3VudCA8IE1JTl9DSEFSU19JTl9CTE9DSykgewogICAgcmV0dXJuIGkgLSAoaSAtIGlGaXJzdEJlZ2luVGV4dCkgJSA1OwogIH0KICBsZXQgaUZpcnN0ID0gaUZpcnN0QmVnaW5UZXh0OwogIGlmIChpRmlyc3RCZWdpblRleHQgPj0gNCAmJiBmbkFycmF5W2lGaXJzdEJlZ2luVGV4dCAtIDRdID09PSBmbkFycmF5W2lGaXJzdFNldEZvbnRdICYmIGZuQXJyYXlbaUZpcnN0QmVnaW5UZXh0IC0gM10gPT09IGZuQXJyYXlbaUZpcnN0U2V0VGV4dE1hdHJpeF0gJiYgZm5BcnJheVtpRmlyc3RCZWdpblRleHQgLSAyXSA9PT0gZm5BcnJheVtpRmlyc3RTaG93VGV4dF0gJiYgZm5BcnJheVtpRmlyc3RCZWdpblRleHQgLSAxXSA9PT0gZm5BcnJheVtpRmlyc3RFbmRUZXh0XSAmJiBhcmdzQXJyYXlbaUZpcnN0QmVnaW5UZXh0IC0gNF1bMF0gPT09IGZpcnN0U2V0Rm9udEFyZzAgJiYgYXJnc0FycmF5W2lGaXJzdEJlZ2luVGV4dCAtIDRdWzFdID09PSBmaXJzdFNldEZvbnRBcmcxKSB7CiAgICBjb3VudCsrOwogICAgaUZpcnN0IC09IDU7CiAgfQogIGxldCBpRW5kVGV4dCA9IGlGaXJzdCArIDQ7CiAgZm9yIChsZXQgcSA9IDE7IHEgPCBjb3VudDsgcSsrKSB7CiAgICBmbkFycmF5LnNwbGljZShpRW5kVGV4dCwgMyk7CiAgICBhcmdzQXJyYXkuc3BsaWNlKGlFbmRUZXh0LCAzKTsKICAgIGlFbmRUZXh0ICs9IDI7CiAgfQogIHJldHVybiBpRW5kVGV4dCArIDE7Cn0pOwpjbGFzcyBOdWxsT3B0aW1pemVyIHsKICBjb25zdHJ1Y3RvcihxdWV1ZSkgewogICAgdGhpcy5xdWV1ZSA9IHF1ZXVlOwogIH0KICBfb3B0aW1pemUoKSB7fQogIHB1c2goZm4sIGFyZ3MpIHsKICAgIHRoaXMucXVldWUuZm5BcnJheS5wdXNoKGZuKTsKICAgIHRoaXMucXVldWUuYXJnc0FycmF5LnB1c2goYXJncyk7CiAgICB0aGlzLl9vcHRpbWl6ZSgpOwogIH0KICBmbHVzaCgpIHt9CiAgcmVzZXQoKSB7fQp9CmNsYXNzIFF1ZXVlT3B0aW1pemVyIGV4dGVuZHMgTnVsbE9wdGltaXplciB7CiAgY29uc3RydWN0b3IocXVldWUpIHsKICAgIHN1cGVyKHF1ZXVlKTsKICAgIHRoaXMuc3RhdGUgPSBudWxsOwogICAgdGhpcy5jb250ZXh0ID0gewogICAgICBpQ3VycjogMCwKICAgICAgZm5BcnJheTogcXVldWUuZm5BcnJheSwKICAgICAgYXJnc0FycmF5OiBxdWV1ZS5hcmdzQXJyYXksCiAgICAgIGlzT2Zmc2NyZWVuQ2FudmFzU3VwcG9ydGVkOiBmYWxzZQogICAgfTsKICAgIHRoaXMubWF0Y2ggPSBudWxsOwogICAgdGhpcy5sYXN0UHJvY2Vzc2VkID0gMDsKICB9CiAgc2V0IGlzT2Zmc2NyZWVuQ2FudmFzU3VwcG9ydGVkKHZhbHVlKSB7CiAgICB0aGlzLmNvbnRleHQuaXNPZmZzY3JlZW5DYW52YXNTdXBwb3J0ZWQgPSB2YWx1ZTsKICB9CiAgX29wdGltaXplKCkgewogICAgY29uc3QgZm5BcnJheSA9IHRoaXMucXVldWUuZm5BcnJheTsKICAgIGxldCBpID0gdGhpcy5sYXN0UHJvY2Vzc2VkLAogICAgICBpaSA9IGZuQXJyYXkubGVuZ3RoOwogICAgbGV0IHN0YXRlID0gdGhpcy5zdGF0ZTsKICAgIGxldCBtYXRjaCA9IHRoaXMubWF0Y2g7CiAgICBpZiAoIXN0YXRlICYmICFtYXRjaCAmJiBpICsgMSA9PT0gaWkgJiYgIUluaXRpYWxTdGF0ZVtmbkFycmF5W2ldXSkgewogICAgICB0aGlzLmxhc3RQcm9jZXNzZWQgPSBpaTsKICAgICAgcmV0dXJuOwogICAgfQogICAgY29uc3QgY29udGV4dCA9IHRoaXMuY29udGV4dDsKICAgIHdoaWxlIChpIDwgaWkpIHsKICAgICAgaWYgKG1hdGNoKSB7CiAgICAgICAgY29uc3QgaXRlcmF0ZSA9ICgwLCBtYXRjaC5pdGVyYXRlRm4pKGNvbnRleHQsIGkpOwogICAgICAgIGlmIChpdGVyYXRlKSB7CiAgICAgICAgICBpKys7CiAgICAgICAgICBjb250aW51ZTsKICAgICAgICB9CiAgICAgICAgaSA9ICgwLCBtYXRjaC5wcm9jZXNzRm4pKGNvbnRleHQsIGkgKyAxKTsKICAgICAgICBpaSA9IGZuQXJyYXkubGVuZ3RoOwogICAgICAgIG1hdGNoID0gbnVsbDsKICAgICAgICBzdGF0ZSA9IG51bGw7CiAgICAgICAgaWYgKGkgPj0gaWkpIHsKICAgICAgICAgIGJyZWFrOwogICAgICAgIH0KICAgICAgfQogICAgICBzdGF0ZSA9IChzdGF0ZSB8fCBJbml0aWFsU3RhdGUpW2ZuQXJyYXlbaV1dOwogICAgICBpZiAoIXN0YXRlIHx8IEFycmF5LmlzQXJyYXkoc3RhdGUpKSB7CiAgICAgICAgaSsrOwogICAgICAgIGNvbnRpbnVlOwogICAgICB9CiAgICAgIGNvbnRleHQuaUN1cnIgPSBpOwogICAgICBpKys7CiAgICAgIGlmIChzdGF0ZS5jaGVja0ZuICYmICEoMCwgc3RhdGUuY2hlY2tGbikoY29udGV4dCkpIHsKICAgICAgICBzdGF0ZSA9IG51bGw7CiAgICAgICAgY29udGludWU7CiAgICAgIH0KICAgICAgbWF0Y2ggPSBzdGF0ZTsKICAgICAgc3RhdGUgPSBudWxsOwogICAgfQogICAgdGhpcy5zdGF0ZSA9IHN0YXRlOwogICAgdGhpcy5tYXRjaCA9IG1hdGNoOwogICAgdGhpcy5sYXN0UHJvY2Vzc2VkID0gaTsKICB9CiAgZmx1c2goKSB7CiAgICB3aGlsZSAodGhpcy5tYXRjaCkgewogICAgICBjb25zdCBsZW5ndGggPSB0aGlzLnF1ZXVlLmZuQXJyYXkubGVuZ3RoOwogICAgICB0aGlzLmxhc3RQcm9jZXNzZWQgPSAoMCwgdGhpcy5tYXRjaC5wcm9jZXNzRm4pKHRoaXMuY29udGV4dCwgbGVuZ3RoKTsKICAgICAgdGhpcy5tYXRjaCA9IG51bGw7CiAgICAgIHRoaXMuc3RhdGUgPSBudWxsOwogICAgICB0aGlzLl9vcHRpbWl6ZSgpOwogICAgfQogIH0KICByZXNldCgpIHsKICAgIHRoaXMuc3RhdGUgPSBudWxsOwogICAgdGhpcy5tYXRjaCA9IG51bGw7CiAgICB0aGlzLmxhc3RQcm9jZXNzZWQgPSAwOwogIH0KfQpjbGFzcyBPcGVyYXRvckxpc3QgewogIHN0YXRpYyBDSFVOS19TSVpFID0gMTAwMDsKICBzdGF0aWMgQ0hVTktfU0laRV9BQk9VVCA9IHRoaXMuQ0hVTktfU0laRSAtIDU7CiAgY29uc3RydWN0b3IoaW50ZW50ID0gMCwgc3RyZWFtU2luaykgewogICAgdGhpcy5fc3RyZWFtU2luayA9IHN0cmVhbVNpbms7CiAgICB0aGlzLmZuQXJyYXkgPSBbXTsKICAgIHRoaXMuYXJnc0FycmF5ID0gW107CiAgICB0aGlzLm9wdGltaXplciA9IHN0cmVhbVNpbmsgJiYgIShpbnRlbnQgJiBfdXRpbC5SZW5kZXJpbmdJbnRlbnRGbGFnLk9QTElTVCkgPyBuZXcgUXVldWVPcHRpbWl6ZXIodGhpcykgOiBuZXcgTnVsbE9wdGltaXplcih0aGlzKTsKICAgIHRoaXMuZGVwZW5kZW5jaWVzID0gbmV3IFNldCgpOwogICAgdGhpcy5fdG90YWxMZW5ndGggPSAwOwogICAgdGhpcy53ZWlnaHQgPSAwOwogICAgdGhpcy5fcmVzb2x2ZWQgPSBzdHJlYW1TaW5rID8gbnVsbCA6IFByb21pc2UucmVzb2x2ZSgpOwogIH0KICBzZXQgaXNPZmZzY3JlZW5DYW52YXNTdXBwb3J0ZWQodmFsdWUpIHsKICAgIHRoaXMub3B0aW1pemVyLmlzT2Zmc2NyZWVuQ2FudmFzU3VwcG9ydGVkID0gdmFsdWU7CiAgfQogIGdldCBsZW5ndGgoKSB7CiAgICByZXR1cm4gdGhpcy5hcmdzQXJyYXkubGVuZ3RoOwogIH0KICBnZXQgcmVhZHkoKSB7CiAgICByZXR1cm4gdGhpcy5fcmVzb2x2ZWQgfHwgdGhpcy5fc3RyZWFtU2luay5yZWFkeTsKICB9CiAgZ2V0IHRvdGFsTGVuZ3RoKCkgewogICAgcmV0dXJuIHRoaXMuX3RvdGFsTGVuZ3RoICsgdGhpcy5sZW5ndGg7CiAgfQogIGFkZE9wKGZuLCBhcmdzKSB7CiAgICB0aGlzLm9wdGltaXplci5wdXNoKGZuLCBhcmdzKTsKICAgIHRoaXMud2VpZ2h0Kys7CiAgICBpZiAodGhpcy5fc3RyZWFtU2luaykgewogICAgICBpZiAodGhpcy53ZWlnaHQgPj0gT3BlcmF0b3JMaXN0LkNIVU5LX1NJWkUpIHsKICAgICAgICB0aGlzLmZsdXNoKCk7CiAgICAgIH0gZWxzZSBpZiAodGhpcy53ZWlnaHQgPj0gT3BlcmF0b3JMaXN0LkNIVU5LX1NJWkVfQUJPVVQgJiYgKGZuID09PSBfdXRpbC5PUFMucmVzdG9yZSB8fCBmbiA9PT0gX3V0aWwuT1BTLmVuZFRleHQpKSB7CiAgICAgICAgdGhpcy5mbHVzaCgpOwogICAgICB9CiAgICB9CiAgfQogIGFkZEltYWdlT3BzKGZuLCBhcmdzLCBvcHRpb25hbENvbnRlbnQpIHsKICAgIGlmIChvcHRpb25hbENvbnRlbnQgIT09IHVuZGVmaW5lZCkgewogICAgICB0aGlzLmFkZE9wKF91dGlsLk9QUy5iZWdpbk1hcmtlZENvbnRlbnRQcm9wcywgWyJPQyIsIG9wdGlvbmFsQ29udGVudF0pOwogICAgfQogICAgdGhpcy5hZGRPcChmbiwgYXJncyk7CiAgICBpZiAob3B0aW9uYWxDb250ZW50ICE9PSB1bmRlZmluZWQpIHsKICAgICAgdGhpcy5hZGRPcChfdXRpbC5PUFMuZW5kTWFya2VkQ29udGVudCwgW10pOwogICAgfQogIH0KICBhZGREZXBlbmRlbmN5KGRlcGVuZGVuY3kpIHsKICAgIGlmICh0aGlzLmRlcGVuZGVuY2llcy5oYXMoZGVwZW5kZW5jeSkpIHsKICAgICAgcmV0dXJuOwogICAgfQogICAgdGhpcy5kZXBlbmRlbmNpZXMuYWRkKGRlcGVuZGVuY3kpOwogICAgdGhpcy5hZGRPcChfdXRpbC5PUFMuZGVwZW5kZW5jeSwgW2RlcGVuZGVuY3ldKTsKICB9CiAgYWRkRGVwZW5kZW5jaWVzKGRlcGVuZGVuY2llcykgewogICAgZm9yIChjb25zdCBkZXBlbmRlbmN5IG9mIGRlcGVuZGVuY2llcykgewogICAgICB0aGlzLmFkZERlcGVuZGVuY3koZGVwZW5kZW5jeSk7CiAgICB9CiAgfQogIGFkZE9wTGlzdChvcExpc3QpIHsKICAgIGlmICghKG9wTGlzdCBpbnN0YW5jZW9mIE9wZXJhdG9yTGlzdCkpIHsKICAgICAgKDAsIF91dGlsLndhcm4pKCdhZGRPcExpc3QgLSBpZ25vcmluZyBpbnZhbGlkICJvcExpc3QiIHBhcmFtZXRlci4nKTsKICAgICAgcmV0dXJuOwogICAgfQogICAgZm9yIChjb25zdCBkZXBlbmRlbmN5IG9mIG9wTGlzdC5kZXBlbmRlbmNpZXMpIHsKICAgICAgdGhpcy5kZXBlbmRlbmNpZXMuYWRkKGRlcGVuZGVuY3kpOwogICAgfQogICAgZm9yIChsZXQgaSA9IDAsIGlpID0gb3BMaXN0Lmxlbmd0aDsgaSA8IGlpOyBpKyspIHsKICAgICAgdGhpcy5hZGRPcChvcExpc3QuZm5BcnJheVtpXSwgb3BMaXN0LmFyZ3NBcnJheVtpXSk7CiAgICB9CiAgfQogIGdldElSKCkgewogICAgcmV0dXJuIHsKICAgICAgZm5BcnJheTogdGhpcy5mbkFycmF5LAogICAgICBhcmdzQXJyYXk6IHRoaXMuYXJnc0FycmF5LAogICAgICBsZW5ndGg6IHRoaXMubGVuZ3RoCiAgICB9OwogIH0KICBnZXQgX3RyYW5zZmVycygpIHsKICAgIGNvbnN0IHRyYW5zZmVycyA9IFtdOwogICAgY29uc3QgewogICAgICBmbkFycmF5LAogICAgICBhcmdzQXJyYXksCiAgICAgIGxlbmd0aAogICAgfSA9IHRoaXM7CiAgICBmb3IgKGxldCBpID0gMDsgaSA8IGxlbmd0aDsgaSsrKSB7CiAgICAgIHN3aXRjaCAoZm5BcnJheVtpXSkgewogICAgICAgIGNhc2UgX3V0aWwuT1BTLnBhaW50SW5saW5lSW1hZ2VYT2JqZWN0OgogICAgICAgIGNhc2UgX3V0aWwuT1BTLnBhaW50SW5saW5lSW1hZ2VYT2JqZWN0R3JvdXA6CiAgICAgICAgY2FzZSBfdXRpbC5PUFMucGFpbnRJbWFnZU1hc2tYT2JqZWN0OgogICAgICAgICAgY29uc3QgYXJnID0gYXJnc0FycmF5W2ldWzBdOwogICAgICAgICAgaWYgKCFhcmcuY2FjaGVkICYmIGFyZy5kYXRhPy5idWZmZXIgaW5zdGFuY2VvZiBBcnJheUJ1ZmZlcikgewogICAgICAgICAgICB0cmFuc2ZlcnMucHVzaChhcmcuZGF0YS5idWZmZXIpOwogICAgICAgICAgfQogICAgICAgICAgYnJlYWs7CiAgICAgIH0KICAgIH0KICAgIHJldHVybiB0cmFuc2ZlcnM7CiAgfQogIGZsdXNoKGxhc3RDaHVuayA9IGZhbHNlLCBzZXBhcmF0ZUFubm90cyA9IG51bGwpIHsKICAgIHRoaXMub3B0aW1pemVyLmZsdXNoKCk7CiAgICBjb25zdCBsZW5ndGggPSB0aGlzLmxlbmd0aDsKICAgIHRoaXMuX3RvdGFsTGVuZ3RoICs9IGxlbmd0aDsKICAgIHRoaXMuX3N0cmVhbVNpbmsuZW5xdWV1ZSh7CiAgICAgIGZuQXJyYXk6IHRoaXMuZm5BcnJheSwKICAgICAgYXJnc0FycmF5OiB0aGlzLmFyZ3NBcnJheSwKICAgICAgbGFzdENodW5rLAogICAgICBzZXBhcmF0ZUFubm90cywKICAgICAgbGVuZ3RoCiAgICB9LCAxLCB0aGlzLl90cmFuc2ZlcnMpOwogICAgdGhpcy5kZXBlbmRlbmNpZXMuY2xlYXIoKTsKICAgIHRoaXMuZm5BcnJheS5sZW5ndGggPSAwOwogICAgdGhpcy5hcmdzQXJyYXkubGVuZ3RoID0gMDsKICAgIHRoaXMud2VpZ2h0ID0gMDsKICAgIHRoaXMub3B0aW1pemVyLnJlc2V0KCk7CiAgfQp9CmV4cG9ydHMuT3BlcmF0b3JMaXN0ID0gT3BlcmF0b3JMaXN0OwoKLyoqKi8gfSksCi8qIDY1ICovCi8qKiovICgoX191bnVzZWRfd2VicGFja19tb2R1bGUsIGV4cG9ydHMsIF9fd19wZGZqc19yZXF1aXJlX18pID0+IHsKCgoKT2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsICJfX2VzTW9kdWxlIiwgKHsKICB2YWx1ZTogdHJ1ZQp9KSk7CmV4cG9ydHMuUERGSW1hZ2UgPSB2b2lkIDA7CnZhciBfdXRpbCA9IF9fd19wZGZqc19yZXF1aXJlX18oMik7CnZhciBfaW1hZ2VfdXRpbHMgPSBfX3dfcGRmanNfcmVxdWlyZV9fKDI4KTsKdmFyIF9iYXNlX3N0cmVhbSA9IF9fd19wZGZqc19yZXF1aXJlX18oNSk7CnZhciBfY29sb3JzcGFjZSA9IF9fd19wZGZqc19yZXF1aXJlX18oMTIpOwp2YXIgX2RlY29kZV9zdHJlYW0gPSBfX3dfcGRmanNfcmVxdWlyZV9fKDE4KTsKdmFyIF9pbWFnZV9yZXNpemVyID0gX193X3BkZmpzX3JlcXVpcmVfXyg2Mik7CnZhciBfanBlZ19zdHJlYW0gPSBfX3dfcGRmanNfcmVxdWlyZV9fKDI2KTsKdmFyIF9qcHggPSBfX3dfcGRmanNfcmVxdWlyZV9fKDMwKTsKdmFyIF9wcmltaXRpdmVzID0gX193X3BkZmpzX3JlcXVpcmVfXyg0KTsKZnVuY3Rpb24gZGVjb2RlQW5kQ2xhbXAodmFsdWUsIGFkZGVuZCwgY29lZmZpY2llbnQsIG1heCkgewogIHZhbHVlID0gYWRkZW5kICsgdmFsdWUgKiBjb2VmZmljaWVudDsKICBpZiAodmFsdWUgPCAwKSB7CiAgICB2YWx1ZSA9IDA7CiAgfSBlbHNlIGlmICh2YWx1ZSA+IG1heCkgewogICAgdmFsdWUgPSBtYXg7CiAgfQogIHJldHVybiB2YWx1ZTsKfQpmdW5jdGlvbiByZXNpemVJbWFnZU1hc2soc3JjLCBicGMsIHcxLCBoMSwgdzIsIGgyKSB7CiAgY29uc3QgbGVuZ3RoID0gdzIgKiBoMjsKICBsZXQgZGVzdDsKICBpZiAoYnBjIDw9IDgpIHsKICAgIGRlc3QgPSBuZXcgVWludDhBcnJheShsZW5ndGgpOwogIH0gZWxzZSBpZiAoYnBjIDw9IDE2KSB7CiAgICBkZXN0ID0gbmV3IFVpbnQxNkFycmF5KGxlbmd0aCk7CiAgfSBlbHNlIHsKICAgIGRlc3QgPSBuZXcgVWludDMyQXJyYXkobGVuZ3RoKTsKICB9CiAgY29uc3QgeFJhdGlvID0gdzEgLyB3MjsKICBjb25zdCB5UmF0aW8gPSBoMSAvIGgyOwogIGxldCBpLAogICAgaiwKICAgIHB5LAogICAgbmV3SW5kZXggPSAwLAogICAgb2xkSW5kZXg7CiAgY29uc3QgeFNjYWxlZCA9IG5ldyBVaW50MTZBcnJheSh3Mik7CiAgY29uc3QgdzFTY2FubGluZSA9IHcxOwogIGZvciAoaSA9IDA7IGkgPCB3MjsgaSsrKSB7CiAgICB4U2NhbGVkW2ldID0gTWF0aC5mbG9vcihpICogeFJhdGlvKTsKICB9CiAgZm9yIChpID0gMDsgaSA8IGgyOyBpKyspIHsKICAgIHB5ID0gTWF0aC5mbG9vcihpICogeVJhdGlvKSAqIHcxU2NhbmxpbmU7CiAgICBmb3IgKGogPSAwOyBqIDwgdzI7IGorKykgewogICAgICBvbGRJbmRleCA9IHB5ICsgeFNjYWxlZFtqXTsKICAgICAgZGVzdFtuZXdJbmRleCsrXSA9IHNyY1tvbGRJbmRleF07CiAgICB9CiAgfQogIHJldHVybiBkZXN0Owp9CmNsYXNzIFBERkltYWdlIHsKICBjb25zdHJ1Y3Rvcih7CiAgICB4cmVmLAogICAgcmVzLAogICAgaW1hZ2UsCiAgICBpc0lubGluZSA9IGZhbHNlLAogICAgc21hc2sgPSBudWxsLAogICAgbWFzayA9IG51bGwsCiAgICBpc01hc2sgPSBmYWxzZSwKICAgIHBkZkZ1bmN0aW9uRmFjdG9yeSwKICAgIGxvY2FsQ29sb3JTcGFjZUNhY2hlCiAgfSkgewogICAgdGhpcy5pbWFnZSA9IGltYWdlOwogICAgY29uc3QgZGljdCA9IGltYWdlLmRpY3Q7CiAgICBjb25zdCBmaWx0ZXIgPSBkaWN0LmdldCgiRiIsICJGaWx0ZXIiKTsKICAgIGxldCBmaWx0ZXJOYW1lOwogICAgaWYgKGZpbHRlciBpbnN0YW5jZW9mIF9wcmltaXRpdmVzLk5hbWUpIHsKICAgICAgZmlsdGVyTmFtZSA9IGZpbHRlci5uYW1lOwogICAgfSBlbHNlIGlmIChBcnJheS5pc0FycmF5KGZpbHRlcikpIHsKICAgICAgY29uc3QgZmlsdGVyWmVybyA9IHhyZWYuZmV0Y2hJZlJlZihmaWx0ZXJbMF0pOwogICAgICBpZiAoZmlsdGVyWmVybyBpbnN0YW5jZW9mIF9wcmltaXRpdmVzLk5hbWUpIHsKICAgICAgICBmaWx0ZXJOYW1lID0gZmlsdGVyWmVyby5uYW1lOwogICAgICB9CiAgICB9CiAgICBzd2l0Y2ggKGZpbHRlck5hbWUpIHsKICAgICAgY2FzZSAiSlBYRGVjb2RlIjoKICAgICAgICBjb25zdCBqcHhJbWFnZSA9IG5ldyBfanB4LkpweEltYWdlKCk7CiAgICAgICAganB4SW1hZ2UucGFyc2VJbWFnZVByb3BlcnRpZXMoaW1hZ2Uuc3RyZWFtKTsKICAgICAgICBpbWFnZS5zdHJlYW0ucmVzZXQoKTsKICAgICAgICBpbWFnZS53aWR0aCA9IGpweEltYWdlLndpZHRoOwogICAgICAgIGltYWdlLmhlaWdodCA9IGpweEltYWdlLmhlaWdodDsKICAgICAgICBpbWFnZS5iaXRzUGVyQ29tcG9uZW50ID0ganB4SW1hZ2UuYml0c1BlckNvbXBvbmVudDsKICAgICAgICBpbWFnZS5udW1Db21wcyA9IGpweEltYWdlLmNvbXBvbmVudHNDb3VudDsKICAgICAgICBicmVhazsKICAgICAgY2FzZSAiSkJJRzJEZWNvZGUiOgogICAgICAgIGltYWdlLmJpdHNQZXJDb21wb25lbnQgPSAxOwogICAgICAgIGltYWdlLm51bUNvbXBzID0gMTsKICAgICAgICBicmVhazsKICAgIH0KICAgIGxldCB3aWR0aCA9IGRpY3QuZ2V0KCJXIiwgIldpZHRoIik7CiAgICBsZXQgaGVpZ2h0ID0gZGljdC5nZXQoIkgiLCAiSGVpZ2h0Iik7CiAgICBpZiAoTnVtYmVyLmlzSW50ZWdlcihpbWFnZS53aWR0aCkgJiYgaW1hZ2Uud2lkdGggPiAwICYmIE51bWJlci5pc0ludGVnZXIoaW1hZ2UuaGVpZ2h0KSAmJiBpbWFnZS5oZWlnaHQgPiAwICYmIChpbWFnZS53aWR0aCAhPT0gd2lkdGggfHwgaW1hZ2UuaGVpZ2h0ICE9PSBoZWlnaHQpKSB7CiAgICAgICgwLCBfdXRpbC53YXJuKSgiUERGSW1hZ2UgLSB1c2luZyB0aGUgV2lkdGgvSGVpZ2h0IG9mIHRoZSBpbWFnZSBkYXRhLCAiICsgInJhdGhlciB0aGFuIHRoZSBpbWFnZSBkaWN0aW9uYXJ5LiIpOwogICAgICB3aWR0aCA9IGltYWdlLndpZHRoOwogICAgICBoZWlnaHQgPSBpbWFnZS5oZWlnaHQ7CiAgICB9CiAgICBpZiAod2lkdGggPCAxIHx8IGhlaWdodCA8IDEpIHsKICAgICAgdGhyb3cgbmV3IF91dGlsLkZvcm1hdEVycm9yKGBJbnZhbGlkIGltYWdlIHdpZHRoOiAke3dpZHRofSBvciBoZWlnaHQ6ICR7aGVpZ2h0fWApOwogICAgfQogICAgdGhpcy53aWR0aCA9IHdpZHRoOwogICAgdGhpcy5oZWlnaHQgPSBoZWlnaHQ7CiAgICB0aGlzLmludGVycG9sYXRlID0gZGljdC5nZXQoIkkiLCAiSW50ZXJwb2xhdGUiKTsKICAgIHRoaXMuaW1hZ2VNYXNrID0gZGljdC5nZXQoIklNIiwgIkltYWdlTWFzayIpIHx8IGZhbHNlOwogICAgdGhpcy5tYXR0ZSA9IGRpY3QuZ2V0KCJNYXR0ZSIpIHx8IGZhbHNlOwogICAgbGV0IGJpdHNQZXJDb21wb25lbnQgPSBpbWFnZS5iaXRzUGVyQ29tcG9uZW50OwogICAgaWYgKCFiaXRzUGVyQ29tcG9uZW50KSB7CiAgICAgIGJpdHNQZXJDb21wb25lbnQgPSBkaWN0LmdldCgiQlBDIiwgIkJpdHNQZXJDb21wb25lbnQiKTsKICAgICAgaWYgKCFiaXRzUGVyQ29tcG9uZW50KSB7CiAgICAgICAgaWYgKHRoaXMuaW1hZ2VNYXNrKSB7CiAgICAgICAgICBiaXRzUGVyQ29tcG9uZW50ID0gMTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgdGhyb3cgbmV3IF91dGlsLkZvcm1hdEVycm9yKGBCaXRzIHBlciBjb21wb25lbnQgbWlzc2luZyBpbiBpbWFnZTogJHt0aGlzLmltYWdlTWFza31gKTsKICAgICAgICB9CiAgICAgIH0KICAgIH0KICAgIHRoaXMuYnBjID0gYml0c1BlckNvbXBvbmVudDsKICAgIGlmICghdGhpcy5pbWFnZU1hc2spIHsKICAgICAgbGV0IGNvbG9yU3BhY2UgPSBkaWN0LmdldFJhdygiQ1MiKSB8fCBkaWN0LmdldFJhdygiQ29sb3JTcGFjZSIpOwogICAgICBpZiAoIWNvbG9yU3BhY2UpIHsKICAgICAgICAoMCwgX3V0aWwuaW5mbykoIkpQWCBpbWFnZXMgKHdoaWNoIGRvIG5vdCByZXF1aXJlIGNvbG9yIHNwYWNlcykiKTsKICAgICAgICBzd2l0Y2ggKGltYWdlLm51bUNvbXBzKSB7CiAgICAgICAgICBjYXNlIDE6CiAgICAgICAgICAgIGNvbG9yU3BhY2UgPSBfcHJpbWl0aXZlcy5OYW1lLmdldCgiRGV2aWNlR3JheSIpOwogICAgICAgICAgICBicmVhazsKICAgICAgICAgIGNhc2UgMzoKICAgICAgICAgICAgY29sb3JTcGFjZSA9IF9wcmltaXRpdmVzLk5hbWUuZ2V0KCJEZXZpY2VSR0IiKTsKICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICBjYXNlIDQ6CiAgICAgICAgICAgIGNvbG9yU3BhY2UgPSBfcHJpbWl0aXZlcy5OYW1lLmdldCgiRGV2aWNlQ01ZSyIpOwogICAgICAgICAgICBicmVhazsKICAgICAgICAgIGRlZmF1bHQ6CiAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcihgSlBYIGltYWdlcyB3aXRoICR7aW1hZ2UubnVtQ29tcHN9IGNvbG9yIGNvbXBvbmVudHMgbm90IHN1cHBvcnRlZC5gKTsKICAgICAgICB9CiAgICAgIH0KICAgICAgdGhpcy5jb2xvclNwYWNlID0gX2NvbG9yc3BhY2UuQ29sb3JTcGFjZS5wYXJzZSh7CiAgICAgICAgY3M6IGNvbG9yU3BhY2UsCiAgICAgICAgeHJlZiwKICAgICAgICByZXNvdXJjZXM6IGlzSW5saW5lID8gcmVzIDogbnVsbCwKICAgICAgICBwZGZGdW5jdGlvbkZhY3RvcnksCiAgICAgICAgbG9jYWxDb2xvclNwYWNlQ2FjaGUKICAgICAgfSk7CiAgICAgIHRoaXMubnVtQ29tcHMgPSB0aGlzLmNvbG9yU3BhY2UubnVtQ29tcHM7CiAgICB9CiAgICB0aGlzLmRlY29kZSA9IGRpY3QuZ2V0QXJyYXkoIkQiLCAiRGVjb2RlIik7CiAgICB0aGlzLm5lZWRzRGVjb2RlID0gZmFsc2U7CiAgICBpZiAodGhpcy5kZWNvZGUgJiYgKHRoaXMuY29sb3JTcGFjZSAmJiAhdGhpcy5jb2xvclNwYWNlLmlzRGVmYXVsdERlY29kZSh0aGlzLmRlY29kZSwgYml0c1BlckNvbXBvbmVudCkgfHwgaXNNYXNrICYmICFfY29sb3JzcGFjZS5Db2xvclNwYWNlLmlzRGVmYXVsdERlY29kZSh0aGlzLmRlY29kZSwgMSkpKSB7CiAgICAgIHRoaXMubmVlZHNEZWNvZGUgPSB0cnVlOwogICAgICBjb25zdCBtYXggPSAoMSA8PCBiaXRzUGVyQ29tcG9uZW50KSAtIDE7CiAgICAgIHRoaXMuZGVjb2RlQ29lZmZpY2llbnRzID0gW107CiAgICAgIHRoaXMuZGVjb2RlQWRkZW5kcyA9IFtdOwogICAgICBjb25zdCBpc0luZGV4ZWQgPSB0aGlzLmNvbG9yU3BhY2U/Lm5hbWUgPT09ICJJbmRleGVkIjsKICAgICAgZm9yIChsZXQgaSA9IDAsIGogPSAwOyBpIDwgdGhpcy5kZWNvZGUubGVuZ3RoOyBpICs9IDIsICsraikgewogICAgICAgIGNvbnN0IGRtaW4gPSB0aGlzLmRlY29kZVtpXTsKICAgICAgICBjb25zdCBkbWF4ID0gdGhpcy5kZWNvZGVbaSArIDFdOwogICAgICAgIHRoaXMuZGVjb2RlQ29lZmZpY2llbnRzW2pdID0gaXNJbmRleGVkID8gKGRtYXggLSBkbWluKSAvIG1heCA6IGRtYXggLSBkbWluOwogICAgICAgIHRoaXMuZGVjb2RlQWRkZW5kc1tqXSA9IGlzSW5kZXhlZCA/IGRtaW4gOiBtYXggKiBkbWluOwogICAgICB9CiAgICB9CiAgICBpZiAoc21hc2spIHsKICAgICAgdGhpcy5zbWFzayA9IG5ldyBQREZJbWFnZSh7CiAgICAgICAgeHJlZiwKICAgICAgICByZXMsCiAgICAgICAgaW1hZ2U6IHNtYXNrLAogICAgICAgIGlzSW5saW5lLAogICAgICAgIHBkZkZ1bmN0aW9uRmFjdG9yeSwKICAgICAgICBsb2NhbENvbG9yU3BhY2VDYWNoZQogICAgICB9KTsKICAgIH0gZWxzZSBpZiAobWFzaykgewogICAgICBpZiAobWFzayBpbnN0YW5jZW9mIF9iYXNlX3N0cmVhbS5CYXNlU3RyZWFtKSB7CiAgICAgICAgY29uc3QgbWFza0RpY3QgPSBtYXNrLmRpY3QsCiAgICAgICAgICBpbWFnZU1hc2sgPSBtYXNrRGljdC5nZXQoIklNIiwgIkltYWdlTWFzayIpOwogICAgICAgIGlmICghaW1hZ2VNYXNrKSB7CiAgICAgICAgICAoMCwgX3V0aWwud2FybikoIklnbm9yaW5nIC9NYXNrIGluIGltYWdlIHdpdGhvdXQgL0ltYWdlTWFzay4iKTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgdGhpcy5tYXNrID0gbmV3IFBERkltYWdlKHsKICAgICAgICAgICAgeHJlZiwKICAgICAgICAgICAgcmVzLAogICAgICAgICAgICBpbWFnZTogbWFzaywKICAgICAgICAgICAgaXNJbmxpbmUsCiAgICAgICAgICAgIGlzTWFzazogdHJ1ZSwKICAgICAgICAgICAgcGRmRnVuY3Rpb25GYWN0b3J5LAogICAgICAgICAgICBsb2NhbENvbG9yU3BhY2VDYWNoZQogICAgICAgICAgfSk7CiAgICAgICAgfQogICAgICB9IGVsc2UgewogICAgICAgIHRoaXMubWFzayA9IG1hc2s7CiAgICAgIH0KICAgIH0KICB9CiAgc3RhdGljIGFzeW5jIGJ1aWxkSW1hZ2UoewogICAgeHJlZiwKICAgIHJlcywKICAgIGltYWdlLAogICAgaXNJbmxpbmUgPSBmYWxzZSwKICAgIHBkZkZ1bmN0aW9uRmFjdG9yeSwKICAgIGxvY2FsQ29sb3JTcGFjZUNhY2hlCiAgfSkgewogICAgY29uc3QgaW1hZ2VEYXRhID0gaW1hZ2U7CiAgICBsZXQgc21hc2tEYXRhID0gbnVsbDsKICAgIGxldCBtYXNrRGF0YSA9IG51bGw7CiAgICBjb25zdCBzbWFzayA9IGltYWdlLmRpY3QuZ2V0KCJTTWFzayIpOwogICAgY29uc3QgbWFzayA9IGltYWdlLmRpY3QuZ2V0KCJNYXNrIik7CiAgICBpZiAoc21hc2spIHsKICAgICAgaWYgKHNtYXNrIGluc3RhbmNlb2YgX2Jhc2Vfc3RyZWFtLkJhc2VTdHJlYW0pIHsKICAgICAgICBzbWFza0RhdGEgPSBzbWFzazsKICAgICAgfSBlbHNlIHsKICAgICAgICAoMCwgX3V0aWwud2FybikoIlVuc3VwcG9ydGVkIC9TTWFzayBmb3JtYXQuIik7CiAgICAgIH0KICAgIH0gZWxzZSBpZiAobWFzaykgewogICAgICBpZiAobWFzayBpbnN0YW5jZW9mIF9iYXNlX3N0cmVhbS5CYXNlU3RyZWFtIHx8IEFycmF5LmlzQXJyYXkobWFzaykpIHsKICAgICAgICBtYXNrRGF0YSA9IG1hc2s7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgKDAsIF91dGlsLndhcm4pKCJVbnN1cHBvcnRlZCAvTWFzayBmb3JtYXQuIik7CiAgICAgIH0KICAgIH0KICAgIHJldHVybiBuZXcgUERGSW1hZ2UoewogICAgICB4cmVmLAogICAgICByZXMsCiAgICAgIGltYWdlOiBpbWFnZURhdGEsCiAgICAgIGlzSW5saW5lLAogICAgICBzbWFzazogc21hc2tEYXRhLAogICAgICBtYXNrOiBtYXNrRGF0YSwKICAgICAgcGRmRnVuY3Rpb25GYWN0b3J5LAogICAgICBsb2NhbENvbG9yU3BhY2VDYWNoZQogICAgfSk7CiAgfQogIHN0YXRpYyBjcmVhdGVSYXdNYXNrKHsKICAgIGltZ0FycmF5LAogICAgd2lkdGgsCiAgICBoZWlnaHQsCiAgICBpbWFnZUlzRnJvbURlY29kZVN0cmVhbSwKICAgIGludmVyc2VEZWNvZGUsCiAgICBpbnRlcnBvbGF0ZQogIH0pIHsKICAgIGNvbnN0IGNvbXB1dGVkTGVuZ3RoID0gKHdpZHRoICsgNyA+PiAzKSAqIGhlaWdodDsKICAgIGNvbnN0IGFjdHVhbExlbmd0aCA9IGltZ0FycmF5LmJ5dGVMZW5ndGg7CiAgICBjb25zdCBoYXZlRnVsbERhdGEgPSBjb21wdXRlZExlbmd0aCA9PT0gYWN0dWFsTGVuZ3RoOwogICAgbGV0IGRhdGEsIGk7CiAgICBpZiAoaW1hZ2VJc0Zyb21EZWNvZGVTdHJlYW0gJiYgKCFpbnZlcnNlRGVjb2RlIHx8IGhhdmVGdWxsRGF0YSkpIHsKICAgICAgZGF0YSA9IGltZ0FycmF5OwogICAgfSBlbHNlIGlmICghaW52ZXJzZURlY29kZSkgewogICAgICBkYXRhID0gbmV3IFVpbnQ4QXJyYXkoaW1nQXJyYXkpOwogICAgfSBlbHNlIHsKICAgICAgZGF0YSA9IG5ldyBVaW50OEFycmF5KGNvbXB1dGVkTGVuZ3RoKTsKICAgICAgZGF0YS5zZXQoaW1nQXJyYXkpOwogICAgICBkYXRhLmZpbGwoMHhmZiwgYWN0dWFsTGVuZ3RoKTsKICAgIH0KICAgIGlmIChpbnZlcnNlRGVjb2RlKSB7CiAgICAgIGZvciAoaSA9IDA7IGkgPCBhY3R1YWxMZW5ndGg7IGkrKykgewogICAgICAgIGRhdGFbaV0gXj0gMHhmZjsKICAgICAgfQogICAgfQogICAgcmV0dXJuIHsKICAgICAgZGF0YSwKICAgICAgd2lkdGgsCiAgICAgIGhlaWdodCwKICAgICAgaW50ZXJwb2xhdGUKICAgIH07CiAgfQogIHN0YXRpYyBhc3luYyBjcmVhdGVNYXNrKHsKICAgIGltZ0FycmF5LAogICAgd2lkdGgsCiAgICBoZWlnaHQsCiAgICBpbWFnZUlzRnJvbURlY29kZVN0cmVhbSwKICAgIGludmVyc2VEZWNvZGUsCiAgICBpbnRlcnBvbGF0ZSwKICAgIGlzT2Zmc2NyZWVuQ2FudmFzU3VwcG9ydGVkID0gZmFsc2UKICB9KSB7CiAgICBjb25zdCBpc1NpbmdsZU9wYXF1ZVBpeGVsID0gd2lkdGggPT09IDEgJiYgaGVpZ2h0ID09PSAxICYmIGludmVyc2VEZWNvZGUgPT09IChpbWdBcnJheS5sZW5ndGggPT09IDAgfHwgISEoaW1nQXJyYXlbMF0gJiAxMjgpKTsKICAgIGlmIChpc1NpbmdsZU9wYXF1ZVBpeGVsKSB7CiAgICAgIHJldHVybiB7CiAgICAgICAgaXNTaW5nbGVPcGFxdWVQaXhlbAogICAgICB9OwogICAgfQogICAgaWYgKGlzT2Zmc2NyZWVuQ2FudmFzU3VwcG9ydGVkKSB7CiAgICAgIGlmIChfaW1hZ2VfcmVzaXplci5JbWFnZVJlc2l6ZXIubmVlZHNUb0JlUmVzaXplZCh3aWR0aCwgaGVpZ2h0KSkgewogICAgICAgIGNvbnN0IGRhdGEgPSBuZXcgVWludDhDbGFtcGVkQXJyYXkod2lkdGggKiBoZWlnaHQgKiA0KTsKICAgICAgICAoMCwgX2ltYWdlX3V0aWxzLmNvbnZlcnRCbGFja0FuZFdoaXRlVG9SR0JBKSh7CiAgICAgICAgICBzcmM6IGltZ0FycmF5LAogICAgICAgICAgZGVzdDogZGF0YSwKICAgICAgICAgIHdpZHRoLAogICAgICAgICAgaGVpZ2h0LAogICAgICAgICAgbm9uQmxhY2tDb2xvcjogMCwKICAgICAgICAgIGludmVyc2VEZWNvZGUKICAgICAgICB9KTsKICAgICAgICByZXR1cm4gX2ltYWdlX3Jlc2l6ZXIuSW1hZ2VSZXNpemVyLmNyZWF0ZUltYWdlKHsKICAgICAgICAgIGtpbmQ6IF91dGlsLkltYWdlS2luZC5SR0JBXzMyQlBQLAogICAgICAgICAgZGF0YSwKICAgICAgICAgIHdpZHRoLAogICAgICAgICAgaGVpZ2h0LAogICAgICAgICAgaW50ZXJwb2xhdGUKICAgICAgICB9KTsKICAgICAgfQogICAgICBjb25zdCBjYW52YXMgPSBuZXcgT2Zmc2NyZWVuQ2FudmFzKHdpZHRoLCBoZWlnaHQpOwogICAgICBjb25zdCBjdHggPSBjYW52YXMuZ2V0Q29udGV4dCgiMmQiKTsKICAgICAgY29uc3QgaW1nRGF0YSA9IGN0eC5jcmVhdGVJbWFnZURhdGEod2lkdGgsIGhlaWdodCk7CiAgICAgICgwLCBfaW1hZ2VfdXRpbHMuY29udmVydEJsYWNrQW5kV2hpdGVUb1JHQkEpKHsKICAgICAgICBzcmM6IGltZ0FycmF5LAogICAgICAgIGRlc3Q6IGltZ0RhdGEuZGF0YSwKICAgICAgICB3aWR0aCwKICAgICAgICBoZWlnaHQsCiAgICAgICAgbm9uQmxhY2tDb2xvcjogMCwKICAgICAgICBpbnZlcnNlRGVjb2RlCiAgICAgIH0pOwogICAgICBjdHgucHV0SW1hZ2VEYXRhKGltZ0RhdGEsIDAsIDApOwogICAgICBjb25zdCBiaXRtYXAgPSBjYW52YXMudHJhbnNmZXJUb0ltYWdlQml0bWFwKCk7CiAgICAgIHJldHVybiB7CiAgICAgICAgZGF0YTogbnVsbCwKICAgICAgICB3aWR0aCwKICAgICAgICBoZWlnaHQsCiAgICAgICAgaW50ZXJwb2xhdGUsCiAgICAgICAgYml0bWFwCiAgICAgIH07CiAgICB9CiAgICByZXR1cm4gdGhpcy5jcmVhdGVSYXdNYXNrKHsKICAgICAgaW1nQXJyYXksCiAgICAgIHdpZHRoLAogICAgICBoZWlnaHQsCiAgICAgIGludmVyc2VEZWNvZGUsCiAgICAgIGltYWdlSXNGcm9tRGVjb2RlU3RyZWFtLAogICAgICBpbnRlcnBvbGF0ZQogICAgfSk7CiAgfQogIGdldCBkcmF3V2lkdGgoKSB7CiAgICByZXR1cm4gTWF0aC5tYXgodGhpcy53aWR0aCwgdGhpcy5zbWFzaz8ud2lkdGggfHwgMCwgdGhpcy5tYXNrPy53aWR0aCB8fCAwKTsKICB9CiAgZ2V0IGRyYXdIZWlnaHQoKSB7CiAgICByZXR1cm4gTWF0aC5tYXgodGhpcy5oZWlnaHQsIHRoaXMuc21hc2s/LmhlaWdodCB8fCAwLCB0aGlzLm1hc2s/LmhlaWdodCB8fCAwKTsKICB9CiAgZGVjb2RlQnVmZmVyKGJ1ZmZlcikgewogICAgY29uc3QgYnBjID0gdGhpcy5icGM7CiAgICBjb25zdCBudW1Db21wcyA9IHRoaXMubnVtQ29tcHM7CiAgICBjb25zdCBkZWNvZGVBZGRlbmRzID0gdGhpcy5kZWNvZGVBZGRlbmRzOwogICAgY29uc3QgZGVjb2RlQ29lZmZpY2llbnRzID0gdGhpcy5kZWNvZGVDb2VmZmljaWVudHM7CiAgICBjb25zdCBtYXggPSAoMSA8PCBicGMpIC0gMTsKICAgIGxldCBpLCBpaTsKICAgIGlmIChicGMgPT09IDEpIHsKICAgICAgZm9yIChpID0gMCwgaWkgPSBidWZmZXIubGVuZ3RoOyBpIDwgaWk7IGkrKykgewogICAgICAgIGJ1ZmZlcltpXSA9ICshYnVmZmVyW2ldOwogICAgICB9CiAgICAgIHJldHVybjsKICAgIH0KICAgIGxldCBpbmRleCA9IDA7CiAgICBmb3IgKGkgPSAwLCBpaSA9IHRoaXMud2lkdGggKiB0aGlzLmhlaWdodDsgaSA8IGlpOyBpKyspIHsKICAgICAgZm9yIChsZXQgaiA9IDA7IGogPCBudW1Db21wczsgaisrKSB7CiAgICAgICAgYnVmZmVyW2luZGV4XSA9IGRlY29kZUFuZENsYW1wKGJ1ZmZlcltpbmRleF0sIGRlY29kZUFkZGVuZHNbal0sIGRlY29kZUNvZWZmaWNpZW50c1tqXSwgbWF4KTsKICAgICAgICBpbmRleCsrOwogICAgICB9CiAgICB9CiAgfQogIGdldENvbXBvbmVudHMoYnVmZmVyKSB7CiAgICBjb25zdCBicGMgPSB0aGlzLmJwYzsKICAgIGlmIChicGMgPT09IDgpIHsKICAgICAgcmV0dXJuIGJ1ZmZlcjsKICAgIH0KICAgIGNvbnN0IHdpZHRoID0gdGhpcy53aWR0aDsKICAgIGNvbnN0IGhlaWdodCA9IHRoaXMuaGVpZ2h0OwogICAgY29uc3QgbnVtQ29tcHMgPSB0aGlzLm51bUNvbXBzOwogICAgY29uc3QgbGVuZ3RoID0gd2lkdGggKiBoZWlnaHQgKiBudW1Db21wczsKICAgIGxldCBidWZmZXJQb3MgPSAwOwogICAgbGV0IG91dHB1dDsKICAgIGlmIChicGMgPD0gOCkgewogICAgICBvdXRwdXQgPSBuZXcgVWludDhBcnJheShsZW5ndGgpOwogICAgfSBlbHNlIGlmIChicGMgPD0gMTYpIHsKICAgICAgb3V0cHV0ID0gbmV3IFVpbnQxNkFycmF5KGxlbmd0aCk7CiAgICB9IGVsc2UgewogICAgICBvdXRwdXQgPSBuZXcgVWludDMyQXJyYXkobGVuZ3RoKTsKICAgIH0KICAgIGNvbnN0IHJvd0NvbXBzID0gd2lkdGggKiBudW1Db21wczsKICAgIGNvbnN0IG1heCA9ICgxIDw8IGJwYykgLSAxOwogICAgbGV0IGkgPSAwLAogICAgICBpaSwKICAgICAgYnVmOwogICAgaWYgKGJwYyA9PT0gMSkgewogICAgICBsZXQgbWFzaywgbG9vcDFFbmQsIGxvb3AyRW5kOwogICAgICBmb3IgKGxldCBqID0gMDsgaiA8IGhlaWdodDsgaisrKSB7CiAgICAgICAgbG9vcDFFbmQgPSBpICsgKHJvd0NvbXBzICYgfjcpOwogICAgICAgIGxvb3AyRW5kID0gaSArIHJvd0NvbXBzOwogICAgICAgIHdoaWxlIChpIDwgbG9vcDFFbmQpIHsKICAgICAgICAgIGJ1ZiA9IGJ1ZmZlcltidWZmZXJQb3MrK107CiAgICAgICAgICBvdXRwdXRbaV0gPSBidWYgPj4gNyAmIDE7CiAgICAgICAgICBvdXRwdXRbaSArIDFdID0gYnVmID4+IDYgJiAxOwogICAgICAgICAgb3V0cHV0W2kgKyAyXSA9IGJ1ZiA+PiA1ICYgMTsKICAgICAgICAgIG91dHB1dFtpICsgM10gPSBidWYgPj4gNCAmIDE7CiAgICAgICAgICBvdXRwdXRbaSArIDRdID0gYnVmID4+IDMgJiAxOwogICAgICAgICAgb3V0cHV0W2kgKyA1XSA9IGJ1ZiA+PiAyICYgMTsKICAgICAgICAgIG91dHB1dFtpICsgNl0gPSBidWYgPj4gMSAmIDE7CiAgICAgICAgICBvdXRwdXRbaSArIDddID0gYnVmICYgMTsKICAgICAgICAgIGkgKz0gODsKICAgICAgICB9CiAgICAgICAgaWYgKGkgPCBsb29wMkVuZCkgewogICAgICAgICAgYnVmID0gYnVmZmVyW2J1ZmZlclBvcysrXTsKICAgICAgICAgIG1hc2sgPSAxMjg7CiAgICAgICAgICB3aGlsZSAoaSA8IGxvb3AyRW5kKSB7CiAgICAgICAgICAgIG91dHB1dFtpKytdID0gKyEhKGJ1ZiAmIG1hc2spOwogICAgICAgICAgICBtYXNrID4+PSAxOwogICAgICAgICAgfQogICAgICAgIH0KICAgICAgfQogICAgfSBlbHNlIHsKICAgICAgbGV0IGJpdHMgPSAwOwogICAgICBidWYgPSAwOwogICAgICBmb3IgKGkgPSAwLCBpaSA9IGxlbmd0aDsgaSA8IGlpOyArK2kpIHsKICAgICAgICBpZiAoaSAlIHJvd0NvbXBzID09PSAwKSB7CiAgICAgICAgICBidWYgPSAwOwogICAgICAgICAgYml0cyA9IDA7CiAgICAgICAgfQogICAgICAgIHdoaWxlIChiaXRzIDwgYnBjKSB7CiAgICAgICAgICBidWYgPSBidWYgPDwgOCB8IGJ1ZmZlcltidWZmZXJQb3MrK107CiAgICAgICAgICBiaXRzICs9IDg7CiAgICAgICAgfQogICAgICAgIGNvbnN0IHJlbWFpbmluZ0JpdHMgPSBiaXRzIC0gYnBjOwogICAgICAgIGxldCB2YWx1ZSA9IGJ1ZiA+PiByZW1haW5pbmdCaXRzOwogICAgICAgIGlmICh2YWx1ZSA8IDApIHsKICAgICAgICAgIHZhbHVlID0gMDsKICAgICAgICB9IGVsc2UgaWYgKHZhbHVlID4gbWF4KSB7CiAgICAgICAgICB2YWx1ZSA9IG1heDsKICAgICAgICB9CiAgICAgICAgb3V0cHV0W2ldID0gdmFsdWU7CiAgICAgICAgYnVmICY9ICgxIDw8IHJlbWFpbmluZ0JpdHMpIC0gMTsKICAgICAgICBiaXRzID0gcmVtYWluaW5nQml0czsKICAgICAgfQogICAgfQogICAgcmV0dXJuIG91dHB1dDsKICB9CiAgZmlsbE9wYWNpdHkocmdiYUJ1Ziwgd2lkdGgsIGhlaWdodCwgYWN0dWFsSGVpZ2h0LCBpbWFnZSkgewogICAgY29uc3Qgc21hc2sgPSB0aGlzLnNtYXNrOwogICAgY29uc3QgbWFzayA9IHRoaXMubWFzazsKICAgIGxldCBhbHBoYUJ1Ziwgc3csIHNoLCBpLCBpaSwgajsKICAgIGlmIChzbWFzaykgewogICAgICBzdyA9IHNtYXNrLndpZHRoOwogICAgICBzaCA9IHNtYXNrLmhlaWdodDsKICAgICAgYWxwaGFCdWYgPSBuZXcgVWludDhDbGFtcGVkQXJyYXkoc3cgKiBzaCk7CiAgICAgIHNtYXNrLmZpbGxHcmF5QnVmZmVyKGFscGhhQnVmKTsKICAgICAgaWYgKHN3ICE9PSB3aWR0aCB8fCBzaCAhPT0gaGVpZ2h0KSB7CiAgICAgICAgYWxwaGFCdWYgPSByZXNpemVJbWFnZU1hc2soYWxwaGFCdWYsIHNtYXNrLmJwYywgc3csIHNoLCB3aWR0aCwgaGVpZ2h0KTsKICAgICAgfQogICAgfSBlbHNlIGlmIChtYXNrKSB7CiAgICAgIGlmIChtYXNrIGluc3RhbmNlb2YgUERGSW1hZ2UpIHsKICAgICAgICBzdyA9IG1hc2sud2lkdGg7CiAgICAgICAgc2ggPSBtYXNrLmhlaWdodDsKICAgICAgICBhbHBoYUJ1ZiA9IG5ldyBVaW50OENsYW1wZWRBcnJheShzdyAqIHNoKTsKICAgICAgICBtYXNrLm51bUNvbXBzID0gMTsKICAgICAgICBtYXNrLmZpbGxHcmF5QnVmZmVyKGFscGhhQnVmKTsKICAgICAgICBmb3IgKGkgPSAwLCBpaSA9IHN3ICogc2g7IGkgPCBpaTsgKytpKSB7CiAgICAgICAgICBhbHBoYUJ1ZltpXSA9IDI1NSAtIGFscGhhQnVmW2ldOwogICAgICAgIH0KICAgICAgICBpZiAoc3cgIT09IHdpZHRoIHx8IHNoICE9PSBoZWlnaHQpIHsKICAgICAgICAgIGFscGhhQnVmID0gcmVzaXplSW1hZ2VNYXNrKGFscGhhQnVmLCBtYXNrLmJwYywgc3csIHNoLCB3aWR0aCwgaGVpZ2h0KTsKICAgICAgICB9CiAgICAgIH0gZWxzZSBpZiAoQXJyYXkuaXNBcnJheShtYXNrKSkgewogICAgICAgIGFscGhhQnVmID0gbmV3IFVpbnQ4Q2xhbXBlZEFycmF5KHdpZHRoICogaGVpZ2h0KTsKICAgICAgICBjb25zdCBudW1Db21wcyA9IHRoaXMubnVtQ29tcHM7CiAgICAgICAgZm9yIChpID0gMCwgaWkgPSB3aWR0aCAqIGhlaWdodDsgaSA8IGlpOyArK2kpIHsKICAgICAgICAgIGxldCBvcGFjaXR5ID0gMDsKICAgICAgICAgIGNvbnN0IGltYWdlT2Zmc2V0ID0gaSAqIG51bUNvbXBzOwogICAgICAgICAgZm9yIChqID0gMDsgaiA8IG51bUNvbXBzOyArK2opIHsKICAgICAgICAgICAgY29uc3QgY29sb3IgPSBpbWFnZVtpbWFnZU9mZnNldCArIGpdOwogICAgICAgICAgICBjb25zdCBtYXNrT2Zmc2V0ID0gaiAqIDI7CiAgICAgICAgICAgIGlmIChjb2xvciA8IG1hc2tbbWFza09mZnNldF0gfHwgY29sb3IgPiBtYXNrW21hc2tPZmZzZXQgKyAxXSkgewogICAgICAgICAgICAgIG9wYWNpdHkgPSAyNTU7CiAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICAgIGFscGhhQnVmW2ldID0gb3BhY2l0eTsKICAgICAgICB9CiAgICAgIH0gZWxzZSB7CiAgICAgICAgdGhyb3cgbmV3IF91dGlsLkZvcm1hdEVycm9yKCJVbmtub3duIG1hc2sgZm9ybWF0LiIpOwogICAgICB9CiAgICB9CiAgICBpZiAoYWxwaGFCdWYpIHsKICAgICAgZm9yIChpID0gMCwgaiA9IDMsIGlpID0gd2lkdGggKiBhY3R1YWxIZWlnaHQ7IGkgPCBpaTsgKytpLCBqICs9IDQpIHsKICAgICAgICByZ2JhQnVmW2pdID0gYWxwaGFCdWZbaV07CiAgICAgIH0KICAgIH0gZWxzZSB7CiAgICAgIGZvciAoaSA9IDAsIGogPSAzLCBpaSA9IHdpZHRoICogYWN0dWFsSGVpZ2h0OyBpIDwgaWk7ICsraSwgaiArPSA0KSB7CiAgICAgICAgcmdiYUJ1ZltqXSA9IDI1NTsKICAgICAgfQogICAgfQogIH0KICB1bmRvUHJlYmxlbmQoYnVmZmVyLCB3aWR0aCwgaGVpZ2h0KSB7CiAgICBjb25zdCBtYXR0ZSA9IHRoaXMuc21hc2s/Lm1hdHRlOwogICAgaWYgKCFtYXR0ZSkgewogICAgICByZXR1cm47CiAgICB9CiAgICBjb25zdCBtYXR0ZVJnYiA9IHRoaXMuY29sb3JTcGFjZS5nZXRSZ2IobWF0dGUsIDApOwogICAgY29uc3QgbWF0dGVSID0gbWF0dGVSZ2JbMF07CiAgICBjb25zdCBtYXR0ZUcgPSBtYXR0ZVJnYlsxXTsKICAgIGNvbnN0IG1hdHRlQiA9IG1hdHRlUmdiWzJdOwogICAgY29uc3QgbGVuZ3RoID0gd2lkdGggKiBoZWlnaHQgKiA0OwogICAgZm9yIChsZXQgaSA9IDA7IGkgPCBsZW5ndGg7IGkgKz0gNCkgewogICAgICBjb25zdCBhbHBoYSA9IGJ1ZmZlcltpICsgM107CiAgICAgIGlmIChhbHBoYSA9PT0gMCkgewogICAgICAgIGJ1ZmZlcltpXSA9IDI1NTsKICAgICAgICBidWZmZXJbaSArIDFdID0gMjU1OwogICAgICAgIGJ1ZmZlcltpICsgMl0gPSAyNTU7CiAgICAgICAgY29udGludWU7CiAgICAgIH0KICAgICAgY29uc3QgayA9IDI1NSAvIGFscGhhOwogICAgICBidWZmZXJbaV0gPSAoYnVmZmVyW2ldIC0gbWF0dGVSKSAqIGsgKyBtYXR0ZVI7CiAgICAgIGJ1ZmZlcltpICsgMV0gPSAoYnVmZmVyW2kgKyAxXSAtIG1hdHRlRykgKiBrICsgbWF0dGVHOwogICAgICBidWZmZXJbaSArIDJdID0gKGJ1ZmZlcltpICsgMl0gLSBtYXR0ZUIpICogayArIG1hdHRlQjsKICAgIH0KICB9CiAgYXN5bmMgY3JlYXRlSW1hZ2VEYXRhKGZvcmNlUkdCQSA9IGZhbHNlLCBpc09mZnNjcmVlbkNhbnZhc1N1cHBvcnRlZCA9IGZhbHNlKSB7CiAgICBjb25zdCBkcmF3V2lkdGggPSB0aGlzLmRyYXdXaWR0aDsKICAgIGNvbnN0IGRyYXdIZWlnaHQgPSB0aGlzLmRyYXdIZWlnaHQ7CiAgICBjb25zdCBpbWdEYXRhID0gewogICAgICB3aWR0aDogZHJhd1dpZHRoLAogICAgICBoZWlnaHQ6IGRyYXdIZWlnaHQsCiAgICAgIGludGVycG9sYXRlOiB0aGlzLmludGVycG9sYXRlLAogICAgICBraW5kOiAwLAogICAgICBkYXRhOiBudWxsCiAgICB9OwogICAgY29uc3QgbnVtQ29tcHMgPSB0aGlzLm51bUNvbXBzOwogICAgY29uc3Qgb3JpZ2luYWxXaWR0aCA9IHRoaXMud2lkdGg7CiAgICBjb25zdCBvcmlnaW5hbEhlaWdodCA9IHRoaXMuaGVpZ2h0OwogICAgY29uc3QgYnBjID0gdGhpcy5icGM7CiAgICBjb25zdCByb3dCeXRlcyA9IG9yaWdpbmFsV2lkdGggKiBudW1Db21wcyAqIGJwYyArIDcgPj4gMzsKICAgIGNvbnN0IG11c3RCZVJlc2l6ZWQgPSBpc09mZnNjcmVlbkNhbnZhc1N1cHBvcnRlZCAmJiBfaW1hZ2VfcmVzaXplci5JbWFnZVJlc2l6ZXIubmVlZHNUb0JlUmVzaXplZChkcmF3V2lkdGgsIGRyYXdIZWlnaHQpOwogICAgaWYgKCFmb3JjZVJHQkEpIHsKICAgICAgbGV0IGtpbmQ7CiAgICAgIGlmICh0aGlzLmNvbG9yU3BhY2UubmFtZSA9PT0gIkRldmljZUdyYXkiICYmIGJwYyA9PT0gMSkgewogICAgICAgIGtpbmQgPSBfdXRpbC5JbWFnZUtpbmQuR1JBWVNDQUxFXzFCUFA7CiAgICAgIH0gZWxzZSBpZiAodGhpcy5jb2xvclNwYWNlLm5hbWUgPT09ICJEZXZpY2VSR0IiICYmIGJwYyA9PT0gOCAmJiAhdGhpcy5uZWVkc0RlY29kZSkgewogICAgICAgIGtpbmQgPSBfdXRpbC5JbWFnZUtpbmQuUkdCXzI0QlBQOwogICAgICB9CiAgICAgIGlmIChraW5kICYmICF0aGlzLnNtYXNrICYmICF0aGlzLm1hc2sgJiYgZHJhd1dpZHRoID09PSBvcmlnaW5hbFdpZHRoICYmIGRyYXdIZWlnaHQgPT09IG9yaWdpbmFsSGVpZ2h0KSB7CiAgICAgICAgY29uc3QgZGF0YSA9IHRoaXMuZ2V0SW1hZ2VCeXRlcyhvcmlnaW5hbEhlaWdodCAqIHJvd0J5dGVzLCB7fSk7CiAgICAgICAgaWYgKGlzT2Zmc2NyZWVuQ2FudmFzU3VwcG9ydGVkKSB7CiAgICAgICAgICBpZiAobXVzdEJlUmVzaXplZCkgewogICAgICAgICAgICByZXR1cm4gX2ltYWdlX3Jlc2l6ZXIuSW1hZ2VSZXNpemVyLmNyZWF0ZUltYWdlKHsKICAgICAgICAgICAgICBkYXRhLAogICAgICAgICAgICAgIGtpbmQsCiAgICAgICAgICAgICAgd2lkdGg6IGRyYXdXaWR0aCwKICAgICAgICAgICAgICBoZWlnaHQ6IGRyYXdIZWlnaHQsCiAgICAgICAgICAgICAgaW50ZXJwb2xhdGU6IHRoaXMuaW50ZXJwb2xhdGUKICAgICAgICAgICAgfSwgdGhpcy5uZWVkc0RlY29kZSk7CiAgICAgICAgICB9CiAgICAgICAgICByZXR1cm4gdGhpcy5jcmVhdGVCaXRtYXAoa2luZCwgb3JpZ2luYWxXaWR0aCwgb3JpZ2luYWxIZWlnaHQsIGRhdGEpOwogICAgICAgIH0KICAgICAgICBpbWdEYXRhLmtpbmQgPSBraW5kOwogICAgICAgIGltZ0RhdGEuZGF0YSA9IGRhdGE7CiAgICAgICAgaWYgKHRoaXMubmVlZHNEZWNvZGUpIHsKICAgICAgICAgICgwLCBfdXRpbC5hc3NlcnQpKGtpbmQgPT09IF91dGlsLkltYWdlS2luZC5HUkFZU0NBTEVfMUJQUCwgIlBERkltYWdlLmNyZWF0ZUltYWdlRGF0YTogVGhlIGltYWdlIG11c3QgYmUgZ3JheXNjYWxlLiIpOwogICAgICAgICAgY29uc3QgYnVmZmVyID0gaW1nRGF0YS5kYXRhOwogICAgICAgICAgZm9yIChsZXQgaSA9IDAsIGlpID0gYnVmZmVyLmxlbmd0aDsgaSA8IGlpOyBpKyspIHsKICAgICAgICAgICAgYnVmZmVyW2ldIF49IDB4ZmY7CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIHJldHVybiBpbWdEYXRhOwogICAgICB9CiAgICAgIGlmICh0aGlzLmltYWdlIGluc3RhbmNlb2YgX2pwZWdfc3RyZWFtLkpwZWdTdHJlYW0gJiYgIXRoaXMuc21hc2sgJiYgIXRoaXMubWFzayAmJiAhdGhpcy5uZWVkc0RlY29kZSkgewogICAgICAgIGxldCBpbWFnZUxlbmd0aCA9IG9yaWdpbmFsSGVpZ2h0ICogcm93Qnl0ZXM7CiAgICAgICAgaWYgKGlzT2Zmc2NyZWVuQ2FudmFzU3VwcG9ydGVkICYmICFtdXN0QmVSZXNpemVkKSB7CiAgICAgICAgICBsZXQgaXNIYW5kbGVkID0gZmFsc2U7CiAgICAgICAgICBzd2l0Y2ggKHRoaXMuY29sb3JTcGFjZS5uYW1lKSB7CiAgICAgICAgICAgIGNhc2UgIkRldmljZUdyYXkiOgogICAgICAgICAgICAgIGltYWdlTGVuZ3RoICo9IDQ7CiAgICAgICAgICAgICAgaXNIYW5kbGVkID0gdHJ1ZTsKICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgY2FzZSAiRGV2aWNlUkdCIjoKICAgICAgICAgICAgICBpbWFnZUxlbmd0aCA9IGltYWdlTGVuZ3RoIC8gMyAqIDQ7CiAgICAgICAgICAgICAgaXNIYW5kbGVkID0gdHJ1ZTsKICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgY2FzZSAiRGV2aWNlQ01ZSyI6CiAgICAgICAgICAgICAgaXNIYW5kbGVkID0gdHJ1ZTsKICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgIH0KICAgICAgICAgIGlmIChpc0hhbmRsZWQpIHsKICAgICAgICAgICAgY29uc3QgcmdiYSA9IHRoaXMuZ2V0SW1hZ2VCeXRlcyhpbWFnZUxlbmd0aCwgewogICAgICAgICAgICAgIGRyYXdXaWR0aCwKICAgICAgICAgICAgICBkcmF3SGVpZ2h0LAogICAgICAgICAgICAgIGZvcmNlUkdCQTogdHJ1ZQogICAgICAgICAgICB9KTsKICAgICAgICAgICAgcmV0dXJuIHRoaXMuY3JlYXRlQml0bWFwKF91dGlsLkltYWdlS2luZC5SR0JBXzMyQlBQLCBkcmF3V2lkdGgsIGRyYXdIZWlnaHQsIHJnYmEpOwogICAgICAgICAgfQogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICBzd2l0Y2ggKHRoaXMuY29sb3JTcGFjZS5uYW1lKSB7CiAgICAgICAgICAgIGNhc2UgIkRldmljZUdyYXkiOgogICAgICAgICAgICAgIGltYWdlTGVuZ3RoICo9IDM7CiAgICAgICAgICAgIGNhc2UgIkRldmljZVJHQiI6CiAgICAgICAgICAgIGNhc2UgIkRldmljZUNNWUsiOgogICAgICAgICAgICAgIGltZ0RhdGEua2luZCA9IF91dGlsLkltYWdlS2luZC5SR0JfMjRCUFA7CiAgICAgICAgICAgICAgaW1nRGF0YS5kYXRhID0gdGhpcy5nZXRJbWFnZUJ5dGVzKGltYWdlTGVuZ3RoLCB7CiAgICAgICAgICAgICAgICBkcmF3V2lkdGgsCiAgICAgICAgICAgICAgICBkcmF3SGVpZ2h0LAogICAgICAgICAgICAgICAgZm9yY2VSR0I6IHRydWUKICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICBpZiAobXVzdEJlUmVzaXplZCkgewogICAgICAgICAgICAgICAgcmV0dXJuIF9pbWFnZV9yZXNpemVyLkltYWdlUmVzaXplci5jcmVhdGVJbWFnZShpbWdEYXRhKTsKICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgcmV0dXJuIGltZ0RhdGE7CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICB9CiAgICB9CiAgICBjb25zdCBpbWdBcnJheSA9IHRoaXMuZ2V0SW1hZ2VCeXRlcyhvcmlnaW5hbEhlaWdodCAqIHJvd0J5dGVzLCB7CiAgICAgIGludGVybmFsOiB0cnVlCiAgICB9KTsKICAgIGNvbnN0IGFjdHVhbEhlaWdodCA9IDAgfCBpbWdBcnJheS5sZW5ndGggLyByb3dCeXRlcyAqIGRyYXdIZWlnaHQgLyBvcmlnaW5hbEhlaWdodDsKICAgIGNvbnN0IGNvbXBzID0gdGhpcy5nZXRDb21wb25lbnRzKGltZ0FycmF5KTsKICAgIGxldCBhbHBoYTAxLCBtYXliZVVuZG9QcmVibGVuZDsKICAgIGxldCBjYW52YXMsIGN0eCwgY2FudmFzSW1nRGF0YSwgZGF0YTsKICAgIGlmIChpc09mZnNjcmVlbkNhbnZhc1N1cHBvcnRlZCAmJiAhbXVzdEJlUmVzaXplZCkgewogICAgICBjYW52YXMgPSBuZXcgT2Zmc2NyZWVuQ2FudmFzKGRyYXdXaWR0aCwgZHJhd0hlaWdodCk7CiAgICAgIGN0eCA9IGNhbnZhcy5nZXRDb250ZXh0KCIyZCIpOwogICAgICBjYW52YXNJbWdEYXRhID0gY3R4LmNyZWF0ZUltYWdlRGF0YShkcmF3V2lkdGgsIGRyYXdIZWlnaHQpOwogICAgICBkYXRhID0gY2FudmFzSW1nRGF0YS5kYXRhOwogICAgfQogICAgaW1nRGF0YS5raW5kID0gX3V0aWwuSW1hZ2VLaW5kLlJHQkFfMzJCUFA7CiAgICBpZiAoIWZvcmNlUkdCQSAmJiAhdGhpcy5zbWFzayAmJiAhdGhpcy5tYXNrKSB7CiAgICAgIGlmICghaXNPZmZzY3JlZW5DYW52YXNTdXBwb3J0ZWQgfHwgbXVzdEJlUmVzaXplZCkgewogICAgICAgIGltZ0RhdGEua2luZCA9IF91dGlsLkltYWdlS2luZC5SR0JfMjRCUFA7CiAgICAgICAgZGF0YSA9IG5ldyBVaW50OENsYW1wZWRBcnJheShkcmF3V2lkdGggKiBkcmF3SGVpZ2h0ICogMyk7CiAgICAgICAgYWxwaGEwMSA9IDA7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgY29uc3QgYXJyID0gbmV3IFVpbnQzMkFycmF5KGRhdGEuYnVmZmVyKTsKICAgICAgICBhcnIuZmlsbChfdXRpbC5GZWF0dXJlVGVzdC5pc0xpdHRsZUVuZGlhbiA/IDB4ZmYwMDAwMDAgOiAweDAwMDAwMGZmKTsKICAgICAgICBhbHBoYTAxID0gMTsKICAgICAgfQogICAgICBtYXliZVVuZG9QcmVibGVuZCA9IGZhbHNlOwogICAgfSBlbHNlIHsKICAgICAgaWYgKCFpc09mZnNjcmVlbkNhbnZhc1N1cHBvcnRlZCB8fCBtdXN0QmVSZXNpemVkKSB7CiAgICAgICAgZGF0YSA9IG5ldyBVaW50OENsYW1wZWRBcnJheShkcmF3V2lkdGggKiBkcmF3SGVpZ2h0ICogNCk7CiAgICAgIH0KICAgICAgYWxwaGEwMSA9IDE7CiAgICAgIG1heWJlVW5kb1ByZWJsZW5kID0gdHJ1ZTsKICAgICAgdGhpcy5maWxsT3BhY2l0eShkYXRhLCBkcmF3V2lkdGgsIGRyYXdIZWlnaHQsIGFjdHVhbEhlaWdodCwgY29tcHMpOwogICAgfQogICAgaWYgKHRoaXMubmVlZHNEZWNvZGUpIHsKICAgICAgdGhpcy5kZWNvZGVCdWZmZXIoY29tcHMpOwogICAgfQogICAgdGhpcy5jb2xvclNwYWNlLmZpbGxSZ2IoZGF0YSwgb3JpZ2luYWxXaWR0aCwgb3JpZ2luYWxIZWlnaHQsIGRyYXdXaWR0aCwgZHJhd0hlaWdodCwgYWN0dWFsSGVpZ2h0LCBicGMsIGNvbXBzLCBhbHBoYTAxKTsKICAgIGlmIChtYXliZVVuZG9QcmVibGVuZCkgewogICAgICB0aGlzLnVuZG9QcmVibGVuZChkYXRhLCBkcmF3V2lkdGgsIGFjdHVhbEhlaWdodCk7CiAgICB9CiAgICBpZiAoaXNPZmZzY3JlZW5DYW52YXNTdXBwb3J0ZWQgJiYgIW11c3RCZVJlc2l6ZWQpIHsKICAgICAgY3R4LnB1dEltYWdlRGF0YShjYW52YXNJbWdEYXRhLCAwLCAwKTsKICAgICAgY29uc3QgYml0bWFwID0gY2FudmFzLnRyYW5zZmVyVG9JbWFnZUJpdG1hcCgpOwogICAgICByZXR1cm4gewogICAgICAgIGRhdGE6IG51bGwsCiAgICAgICAgd2lkdGg6IGRyYXdXaWR0aCwKICAgICAgICBoZWlnaHQ6IGRyYXdIZWlnaHQsCiAgICAgICAgYml0bWFwLAogICAgICAgIGludGVycG9sYXRlOiB0aGlzLmludGVycG9sYXRlCiAgICAgIH07CiAgICB9CiAgICBpbWdEYXRhLmRhdGEgPSBkYXRhOwogICAgaWYgKG11c3RCZVJlc2l6ZWQpIHsKICAgICAgcmV0dXJuIF9pbWFnZV9yZXNpemVyLkltYWdlUmVzaXplci5jcmVhdGVJbWFnZShpbWdEYXRhKTsKICAgIH0KICAgIHJldHVybiBpbWdEYXRhOwogIH0KICBmaWxsR3JheUJ1ZmZlcihidWZmZXIpIHsKICAgIGNvbnN0IG51bUNvbXBzID0gdGhpcy5udW1Db21wczsKICAgIGlmIChudW1Db21wcyAhPT0gMSkgewogICAgICB0aHJvdyBuZXcgX3V0aWwuRm9ybWF0RXJyb3IoYFJlYWRpbmcgZ3JheSBzY2FsZSBmcm9tIGEgY29sb3IgaW1hZ2U6ICR7bnVtQ29tcHN9YCk7CiAgICB9CiAgICBjb25zdCB3aWR0aCA9IHRoaXMud2lkdGg7CiAgICBjb25zdCBoZWlnaHQgPSB0aGlzLmhlaWdodDsKICAgIGNvbnN0IGJwYyA9IHRoaXMuYnBjOwogICAgY29uc3Qgcm93Qnl0ZXMgPSB3aWR0aCAqIG51bUNvbXBzICogYnBjICsgNyA+PiAzOwogICAgY29uc3QgaW1nQXJyYXkgPSB0aGlzLmdldEltYWdlQnl0ZXMoaGVpZ2h0ICogcm93Qnl0ZXMsIHsKICAgICAgaW50ZXJuYWw6IHRydWUKICAgIH0pOwogICAgY29uc3QgY29tcHMgPSB0aGlzLmdldENvbXBvbmVudHMoaW1nQXJyYXkpOwogICAgbGV0IGksIGxlbmd0aDsKICAgIGlmIChicGMgPT09IDEpIHsKICAgICAgbGVuZ3RoID0gd2lkdGggKiBoZWlnaHQ7CiAgICAgIGlmICh0aGlzLm5lZWRzRGVjb2RlKSB7CiAgICAgICAgZm9yIChpID0gMDsgaSA8IGxlbmd0aDsgKytpKSB7CiAgICAgICAgICBidWZmZXJbaV0gPSBjb21wc1tpXSAtIDEgJiAyNTU7CiAgICAgICAgfQogICAgICB9IGVsc2UgewogICAgICAgIGZvciAoaSA9IDA7IGkgPCBsZW5ndGg7ICsraSkgewogICAgICAgICAgYnVmZmVyW2ldID0gLWNvbXBzW2ldICYgMjU1OwogICAgICAgIH0KICAgICAgfQogICAgICByZXR1cm47CiAgICB9CiAgICBpZiAodGhpcy5uZWVkc0RlY29kZSkgewogICAgICB0aGlzLmRlY29kZUJ1ZmZlcihjb21wcyk7CiAgICB9CiAgICBsZW5ndGggPSB3aWR0aCAqIGhlaWdodDsKICAgIGNvbnN0IHNjYWxlID0gMjU1IC8gKCgxIDw8IGJwYykgLSAxKTsKICAgIGZvciAoaSA9IDA7IGkgPCBsZW5ndGg7ICsraSkgewogICAgICBidWZmZXJbaV0gPSBzY2FsZSAqIGNvbXBzW2ldOwogICAgfQogIH0KICBjcmVhdGVCaXRtYXAoa2luZCwgd2lkdGgsIGhlaWdodCwgc3JjKSB7CiAgICBjb25zdCBjYW52YXMgPSBuZXcgT2Zmc2NyZWVuQ2FudmFzKHdpZHRoLCBoZWlnaHQpOwogICAgY29uc3QgY3R4ID0gY2FudmFzLmdldENvbnRleHQoIjJkIik7CiAgICBsZXQgaW1nRGF0YTsKICAgIGlmIChraW5kID09PSBfdXRpbC5JbWFnZUtpbmQuUkdCQV8zMkJQUCkgewogICAgICBpbWdEYXRhID0gbmV3IEltYWdlRGF0YShzcmMsIHdpZHRoLCBoZWlnaHQpOwogICAgfSBlbHNlIHsKICAgICAgaW1nRGF0YSA9IGN0eC5jcmVhdGVJbWFnZURhdGEod2lkdGgsIGhlaWdodCk7CiAgICAgICgwLCBfaW1hZ2VfdXRpbHMuY29udmVydFRvUkdCQSkoewogICAgICAgIGtpbmQsCiAgICAgICAgc3JjLAogICAgICAgIGRlc3Q6IG5ldyBVaW50MzJBcnJheShpbWdEYXRhLmRhdGEuYnVmZmVyKSwKICAgICAgICB3aWR0aCwKICAgICAgICBoZWlnaHQsCiAgICAgICAgaW52ZXJzZURlY29kZTogdGhpcy5uZWVkc0RlY29kZQogICAgICB9KTsKICAgIH0KICAgIGN0eC5wdXRJbWFnZURhdGEoaW1nRGF0YSwgMCwgMCk7CiAgICBjb25zdCBiaXRtYXAgPSBjYW52YXMudHJhbnNmZXJUb0ltYWdlQml0bWFwKCk7CiAgICByZXR1cm4gewogICAgICBkYXRhOiBudWxsLAogICAgICB3aWR0aCwKICAgICAgaGVpZ2h0LAogICAgICBiaXRtYXAsCiAgICAgIGludGVycG9sYXRlOiB0aGlzLmludGVycG9sYXRlCiAgICB9OwogIH0KICBnZXRJbWFnZUJ5dGVzKGxlbmd0aCwgewogICAgZHJhd1dpZHRoLAogICAgZHJhd0hlaWdodCwKICAgIGZvcmNlUkdCQSA9IGZhbHNlLAogICAgZm9yY2VSR0IgPSBmYWxzZSwKICAgIGludGVybmFsID0gZmFsc2UKICB9KSB7CiAgICB0aGlzLmltYWdlLnJlc2V0KCk7CiAgICB0aGlzLmltYWdlLmRyYXdXaWR0aCA9IGRyYXdXaWR0aCB8fCB0aGlzLndpZHRoOwogICAgdGhpcy5pbWFnZS5kcmF3SGVpZ2h0ID0gZHJhd0hlaWdodCB8fCB0aGlzLmhlaWdodDsKICAgIHRoaXMuaW1hZ2UuZm9yY2VSR0JBID0gISFmb3JjZVJHQkE7CiAgICB0aGlzLmltYWdlLmZvcmNlUkdCID0gISFmb3JjZVJHQjsKICAgIGNvbnN0IGltYWdlQnl0ZXMgPSB0aGlzLmltYWdlLmdldEJ5dGVzKGxlbmd0aCk7CiAgICBpZiAoaW50ZXJuYWwgfHwgdGhpcy5pbWFnZSBpbnN0YW5jZW9mIF9kZWNvZGVfc3RyZWFtLkRlY29kZVN0cmVhbSkgewogICAgICByZXR1cm4gaW1hZ2VCeXRlczsKICAgIH0KICAgICgwLCBfdXRpbC5hc3NlcnQpKGltYWdlQnl0ZXMgaW5zdGFuY2VvZiBVaW50OEFycmF5LCAnUERGSW1hZ2UuZ2V0SW1hZ2VCeXRlczogVW5zdXBwb3J0ZWQgImltYWdlQnl0ZXMiIHR5cGUuJyk7CiAgICByZXR1cm4gbmV3IFVpbnQ4QXJyYXkoaW1hZ2VCeXRlcyk7CiAgfQp9CmV4cG9ydHMuUERGSW1hZ2UgPSBQREZJbWFnZTsKCi8qKiovIH0pLAovKiA2NiAqLwovKioqLyAoKF9fdW51c2VkX3dlYnBhY2tfbW9kdWxlLCBleHBvcnRzLCBfX3dfcGRmanNfcmVxdWlyZV9fKSA9PiB7CgoKCk9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCAiX19lc01vZHVsZSIsICh7CiAgdmFsdWU6IHRydWUKfSkpOwpleHBvcnRzLkNhdGFsb2cgPSB2b2lkIDA7CnZhciBfY29yZV91dGlscyA9IF9fd19wZGZqc19yZXF1aXJlX18oMyk7CnZhciBfdXRpbCA9IF9fd19wZGZqc19yZXF1aXJlX18oMik7CnZhciBfcHJpbWl0aXZlcyA9IF9fd19wZGZqc19yZXF1aXJlX18oNCk7CnZhciBfbmFtZV9udW1iZXJfdHJlZSA9IF9fd19wZGZqc19yZXF1aXJlX18oNjcpOwp2YXIgX2Jhc2Vfc3RyZWFtID0gX193X3BkZmpzX3JlcXVpcmVfXyg1KTsKdmFyIF9jbGVhbnVwX2hlbHBlciA9IF9fd19wZGZqc19yZXF1aXJlX18oNjgpOwp2YXIgX2NvbG9yc3BhY2UgPSBfX3dfcGRmanNfcmVxdWlyZV9fKDEyKTsKdmFyIF9maWxlX3NwZWMgPSBfX3dfcGRmanNfcmVxdWlyZV9fKDY5KTsKdmFyIF9pbWFnZV91dGlscyA9IF9fd19wZGZqc19yZXF1aXJlX18oNTkpOwp2YXIgX21ldGFkYXRhX3BhcnNlciA9IF9fd19wZGZqc19yZXF1aXJlX18oNzApOwp2YXIgX3N0cnVjdF90cmVlID0gX193X3BkZmpzX3JlcXVpcmVfXyg3Mik7CmZ1bmN0aW9uIGZldGNoRGVzdGluYXRpb24oZGVzdCkgewogIGlmIChkZXN0IGluc3RhbmNlb2YgX3ByaW1pdGl2ZXMuRGljdCkgewogICAgZGVzdCA9IGRlc3QuZ2V0KCJEIik7CiAgfQogIHJldHVybiBBcnJheS5pc0FycmF5KGRlc3QpID8gZGVzdCA6IG51bGw7Cn0KY2xhc3MgQ2F0YWxvZyB7CiAgY29uc3RydWN0b3IocGRmTWFuYWdlciwgeHJlZikgewogICAgdGhpcy5wZGZNYW5hZ2VyID0gcGRmTWFuYWdlcjsKICAgIHRoaXMueHJlZiA9IHhyZWY7CiAgICB0aGlzLl9jYXREaWN0ID0geHJlZi5nZXRDYXRhbG9nT2JqKCk7CiAgICBpZiAoISh0aGlzLl9jYXREaWN0IGluc3RhbmNlb2YgX3ByaW1pdGl2ZXMuRGljdCkpIHsKICAgICAgdGhyb3cgbmV3IF91dGlsLkZvcm1hdEVycm9yKCJDYXRhbG9nIG9iamVjdCBpcyBub3QgYSBkaWN0aW9uYXJ5LiIpOwogICAgfQogICAgdGhpcy50b3BsZXZlbFBhZ2VzRGljdDsKICAgIHRoaXMuX2FjdHVhbE51bVBhZ2VzID0gbnVsbDsKICAgIHRoaXMuZm9udENhY2hlID0gbmV3IF9wcmltaXRpdmVzLlJlZlNldENhY2hlKCk7CiAgICB0aGlzLmJ1aWx0SW5DTWFwQ2FjaGUgPSBuZXcgTWFwKCk7CiAgICB0aGlzLnN0YW5kYXJkRm9udERhdGFDYWNoZSA9IG5ldyBNYXAoKTsKICAgIHRoaXMuZ2xvYmFsSW1hZ2VDYWNoZSA9IG5ldyBfaW1hZ2VfdXRpbHMuR2xvYmFsSW1hZ2VDYWNoZSgpOwogICAgdGhpcy5wYWdlS2lkc0NvdW50Q2FjaGUgPSBuZXcgX3ByaW1pdGl2ZXMuUmVmU2V0Q2FjaGUoKTsKICAgIHRoaXMucGFnZUluZGV4Q2FjaGUgPSBuZXcgX3ByaW1pdGl2ZXMuUmVmU2V0Q2FjaGUoKTsKICAgIHRoaXMubm9uQmxlbmRNb2Rlc1NldCA9IG5ldyBfcHJpbWl0aXZlcy5SZWZTZXQoKTsKICAgIHRoaXMuc3lzdGVtRm9udENhY2hlID0gbmV3IE1hcCgpOwogIH0KICBjbG9uZURpY3QoKSB7CiAgICByZXR1cm4gdGhpcy5fY2F0RGljdC5jbG9uZSgpOwogIH0KICBnZXQgdmVyc2lvbigpIHsKICAgIGNvbnN0IHZlcnNpb24gPSB0aGlzLl9jYXREaWN0LmdldCgiVmVyc2lvbiIpOwogICAgaWYgKHZlcnNpb24gaW5zdGFuY2VvZiBfcHJpbWl0aXZlcy5OYW1lKSB7CiAgICAgIGlmIChfY29yZV91dGlscy5QREZfVkVSU0lPTl9SRUdFWFAudGVzdCh2ZXJzaW9uLm5hbWUpKSB7CiAgICAgICAgcmV0dXJuICgwLCBfdXRpbC5zaGFkb3cpKHRoaXMsICJ2ZXJzaW9uIiwgdmVyc2lvbi5uYW1lKTsKICAgICAgfQogICAgICAoMCwgX3V0aWwud2FybikoYEludmFsaWQgUERGIGNhdGFsb2cgdmVyc2lvbjogJHt2ZXJzaW9uLm5hbWV9YCk7CiAgICB9CiAgICByZXR1cm4gKDAsIF91dGlsLnNoYWRvdykodGhpcywgInZlcnNpb24iLCBudWxsKTsKICB9CiAgZ2V0IGxhbmcoKSB7CiAgICBjb25zdCBsYW5nID0gdGhpcy5fY2F0RGljdC5nZXQoIkxhbmciKTsKICAgIHJldHVybiAoMCwgX3V0aWwuc2hhZG93KSh0aGlzLCAibGFuZyIsIHR5cGVvZiBsYW5nID09PSAic3RyaW5nIiA/ICgwLCBfdXRpbC5zdHJpbmdUb1BERlN0cmluZykobGFuZykgOiBudWxsKTsKICB9CiAgZ2V0IG5lZWRzUmVuZGVyaW5nKCkgewogICAgY29uc3QgbmVlZHNSZW5kZXJpbmcgPSB0aGlzLl9jYXREaWN0LmdldCgiTmVlZHNSZW5kZXJpbmciKTsKICAgIHJldHVybiAoMCwgX3V0aWwuc2hhZG93KSh0aGlzLCAibmVlZHNSZW5kZXJpbmciLCB0eXBlb2YgbmVlZHNSZW5kZXJpbmcgPT09ICJib29sZWFuIiA/IG5lZWRzUmVuZGVyaW5nIDogZmFsc2UpOwogIH0KICBnZXQgY29sbGVjdGlvbigpIHsKICAgIGxldCBjb2xsZWN0aW9uID0gbnVsbDsKICAgIHRyeSB7CiAgICAgIGNvbnN0IG9iaiA9IHRoaXMuX2NhdERpY3QuZ2V0KCJDb2xsZWN0aW9uIik7CiAgICAgIGlmIChvYmogaW5zdGFuY2VvZiBfcHJpbWl0aXZlcy5EaWN0ICYmIG9iai5zaXplID4gMCkgewogICAgICAgIGNvbGxlY3Rpb24gPSBvYmo7CiAgICAgIH0KICAgIH0gY2F0Y2ggKGV4KSB7CiAgICAgIGlmIChleCBpbnN0YW5jZW9mIF9jb3JlX3V0aWxzLk1pc3NpbmdEYXRhRXhjZXB0aW9uKSB7CiAgICAgICAgdGhyb3cgZXg7CiAgICAgIH0KICAgICAgKDAsIF91dGlsLmluZm8pKCJDYW5ub3QgZmV0Y2ggQ29sbGVjdGlvbiBlbnRyeTsgYXNzdW1pbmcgbm8gY29sbGVjdGlvbiBpcyBwcmVzZW50LiIpOwogICAgfQogICAgcmV0dXJuICgwLCBfdXRpbC5zaGFkb3cpKHRoaXMsICJjb2xsZWN0aW9uIiwgY29sbGVjdGlvbik7CiAgfQogIGdldCBhY3JvRm9ybSgpIHsKICAgIGxldCBhY3JvRm9ybSA9IG51bGw7CiAgICB0cnkgewogICAgICBjb25zdCBvYmogPSB0aGlzLl9jYXREaWN0LmdldCgiQWNyb0Zvcm0iKTsKICAgICAgaWYgKG9iaiBpbnN0YW5jZW9mIF9wcmltaXRpdmVzLkRpY3QgJiYgb2JqLnNpemUgPiAwKSB7CiAgICAgICAgYWNyb0Zvcm0gPSBvYmo7CiAgICAgIH0KICAgIH0gY2F0Y2ggKGV4KSB7CiAgICAgIGlmIChleCBpbnN0YW5jZW9mIF9jb3JlX3V0aWxzLk1pc3NpbmdEYXRhRXhjZXB0aW9uKSB7CiAgICAgICAgdGhyb3cgZXg7CiAgICAgIH0KICAgICAgKDAsIF91dGlsLmluZm8pKCJDYW5ub3QgZmV0Y2ggQWNyb0Zvcm0gZW50cnk7IGFzc3VtaW5nIG5vIGZvcm1zIGFyZSBwcmVzZW50LiIpOwogICAgfQogICAgcmV0dXJuICgwLCBfdXRpbC5zaGFkb3cpKHRoaXMsICJhY3JvRm9ybSIsIGFjcm9Gb3JtKTsKICB9CiAgZ2V0IGFjcm9Gb3JtUmVmKCkgewogICAgY29uc3QgdmFsdWUgPSB0aGlzLl9jYXREaWN0LmdldFJhdygiQWNyb0Zvcm0iKTsKICAgIHJldHVybiAoMCwgX3V0aWwuc2hhZG93KSh0aGlzLCAiYWNyb0Zvcm1SZWYiLCB2YWx1ZSBpbnN0YW5jZW9mIF9wcmltaXRpdmVzLlJlZiA/IHZhbHVlIDogbnVsbCk7CiAgfQogIGdldCBtZXRhZGF0YSgpIHsKICAgIGNvbnN0IHN0cmVhbVJlZiA9IHRoaXMuX2NhdERpY3QuZ2V0UmF3KCJNZXRhZGF0YSIpOwogICAgaWYgKCEoc3RyZWFtUmVmIGluc3RhbmNlb2YgX3ByaW1pdGl2ZXMuUmVmKSkgewogICAgICByZXR1cm4gKDAsIF91dGlsLnNoYWRvdykodGhpcywgIm1ldGFkYXRhIiwgbnVsbCk7CiAgICB9CiAgICBsZXQgbWV0YWRhdGEgPSBudWxsOwogICAgdHJ5IHsKICAgICAgY29uc3Qgc3RyZWFtID0gdGhpcy54cmVmLmZldGNoKHN0cmVhbVJlZiwgIXRoaXMueHJlZi5lbmNyeXB0Py5lbmNyeXB0TWV0YWRhdGEpOwogICAgICBpZiAoc3RyZWFtIGluc3RhbmNlb2YgX2Jhc2Vfc3RyZWFtLkJhc2VTdHJlYW0gJiYgc3RyZWFtLmRpY3QgaW5zdGFuY2VvZiBfcHJpbWl0aXZlcy5EaWN0KSB7CiAgICAgICAgY29uc3QgdHlwZSA9IHN0cmVhbS5kaWN0LmdldCgiVHlwZSIpOwogICAgICAgIGNvbnN0IHN1YnR5cGUgPSBzdHJlYW0uZGljdC5nZXQoIlN1YnR5cGUiKTsKICAgICAgICBpZiAoKDAsIF9wcmltaXRpdmVzLmlzTmFtZSkodHlwZSwgIk1ldGFkYXRhIikgJiYgKDAsIF9wcmltaXRpdmVzLmlzTmFtZSkoc3VidHlwZSwgIlhNTCIpKSB7CiAgICAgICAgICBjb25zdCBkYXRhID0gKDAsIF91dGlsLnN0cmluZ1RvVVRGOFN0cmluZykoc3RyZWFtLmdldFN0cmluZygpKTsKICAgICAgICAgIGlmIChkYXRhKSB7CiAgICAgICAgICAgIG1ldGFkYXRhID0gbmV3IF9tZXRhZGF0YV9wYXJzZXIuTWV0YWRhdGFQYXJzZXIoZGF0YSkuc2VyaWFsaXphYmxlOwogICAgICAgICAgfQogICAgICAgIH0KICAgICAgfQogICAgfSBjYXRjaCAoZXgpIHsKICAgICAgaWYgKGV4IGluc3RhbmNlb2YgX2NvcmVfdXRpbHMuTWlzc2luZ0RhdGFFeGNlcHRpb24pIHsKICAgICAgICB0aHJvdyBleDsKICAgICAgfQogICAgICAoMCwgX3V0aWwuaW5mbykoYFNraXBwaW5nIGludmFsaWQgTWV0YWRhdGE6ICIke2V4fSIuYCk7CiAgICB9CiAgICByZXR1cm4gKDAsIF91dGlsLnNoYWRvdykodGhpcywgIm1ldGFkYXRhIiwgbWV0YWRhdGEpOwogIH0KICBnZXQgbWFya0luZm8oKSB7CiAgICBsZXQgbWFya0luZm8gPSBudWxsOwogICAgdHJ5IHsKICAgICAgbWFya0luZm8gPSB0aGlzLl9yZWFkTWFya0luZm8oKTsKICAgIH0gY2F0Y2ggKGV4KSB7CiAgICAgIGlmIChleCBpbnN0YW5jZW9mIF9jb3JlX3V0aWxzLk1pc3NpbmdEYXRhRXhjZXB0aW9uKSB7CiAgICAgICAgdGhyb3cgZXg7CiAgICAgIH0KICAgICAgKDAsIF91dGlsLndhcm4pKCJVbmFibGUgdG8gcmVhZCBtYXJrIGluZm8uIik7CiAgICB9CiAgICByZXR1cm4gKDAsIF91dGlsLnNoYWRvdykodGhpcywgIm1hcmtJbmZvIiwgbWFya0luZm8pOwogIH0KICBfcmVhZE1hcmtJbmZvKCkgewogICAgY29uc3Qgb2JqID0gdGhpcy5fY2F0RGljdC5nZXQoIk1hcmtJbmZvIik7CiAgICBpZiAoIShvYmogaW5zdGFuY2VvZiBfcHJpbWl0aXZlcy5EaWN0KSkgewogICAgICByZXR1cm4gbnVsbDsKICAgIH0KICAgIGNvbnN0IG1hcmtJbmZvID0gewogICAgICBNYXJrZWQ6IGZhbHNlLAogICAgICBVc2VyUHJvcGVydGllczogZmFsc2UsCiAgICAgIFN1c3BlY3RzOiBmYWxzZQogICAgfTsKICAgIGZvciAoY29uc3Qga2V5IGluIG1hcmtJbmZvKSB7CiAgICAgIGNvbnN0IHZhbHVlID0gb2JqLmdldChrZXkpOwogICAgICBpZiAodHlwZW9mIHZhbHVlID09PSAiYm9vbGVhbiIpIHsKICAgICAgICBtYXJrSW5mb1trZXldID0gdmFsdWU7CiAgICAgIH0KICAgIH0KICAgIHJldHVybiBtYXJrSW5mbzsKICB9CiAgZ2V0IHN0cnVjdFRyZWVSb290KCkgewogICAgbGV0IHN0cnVjdFRyZWUgPSBudWxsOwogICAgdHJ5IHsKICAgICAgc3RydWN0VHJlZSA9IHRoaXMuX3JlYWRTdHJ1Y3RUcmVlUm9vdCgpOwogICAgfSBjYXRjaCAoZXgpIHsKICAgICAgaWYgKGV4IGluc3RhbmNlb2YgX2NvcmVfdXRpbHMuTWlzc2luZ0RhdGFFeGNlcHRpb24pIHsKICAgICAgICB0aHJvdyBleDsKICAgICAgfQogICAgICAoMCwgX3V0aWwud2FybikoIlVuYWJsZSByZWFkIHRvIHN0cnVjdFRyZWVSb290IGluZm8uIik7CiAgICB9CiAgICByZXR1cm4gKDAsIF91dGlsLnNoYWRvdykodGhpcywgInN0cnVjdFRyZWVSb290Iiwgc3RydWN0VHJlZSk7CiAgfQogIF9yZWFkU3RydWN0VHJlZVJvb3QoKSB7CiAgICBjb25zdCByYXdPYmogPSB0aGlzLl9jYXREaWN0LmdldFJhdygiU3RydWN0VHJlZVJvb3QiKTsKICAgIGNvbnN0IG9iaiA9IHRoaXMueHJlZi5mZXRjaElmUmVmKHJhd09iaik7CiAgICBpZiAoIShvYmogaW5zdGFuY2VvZiBfcHJpbWl0aXZlcy5EaWN0KSkgewogICAgICByZXR1cm4gbnVsbDsKICAgIH0KICAgIGNvbnN0IHJvb3QgPSBuZXcgX3N0cnVjdF90cmVlLlN0cnVjdFRyZWVSb290KG9iaiwgcmF3T2JqKTsKICAgIHJvb3QuaW5pdCgpOwogICAgcmV0dXJuIHJvb3Q7CiAgfQogIGdldCB0b3BsZXZlbFBhZ2VzRGljdCgpIHsKICAgIGNvbnN0IHBhZ2VzT2JqID0gdGhpcy5fY2F0RGljdC5nZXQoIlBhZ2VzIik7CiAgICBpZiAoIShwYWdlc09iaiBpbnN0YW5jZW9mIF9wcmltaXRpdmVzLkRpY3QpKSB7CiAgICAgIHRocm93IG5ldyBfdXRpbC5Gb3JtYXRFcnJvcigiSW52YWxpZCB0b3AtbGV2ZWwgcGFnZXMgZGljdGlvbmFyeS4iKTsKICAgIH0KICAgIHJldHVybiAoMCwgX3V0aWwuc2hhZG93KSh0aGlzLCAidG9wbGV2ZWxQYWdlc0RpY3QiLCBwYWdlc09iaik7CiAgfQogIGdldCBkb2N1bWVudE91dGxpbmUoKSB7CiAgICBsZXQgb2JqID0gbnVsbDsKICAgIHRyeSB7CiAgICAgIG9iaiA9IHRoaXMuX3JlYWREb2N1bWVudE91dGxpbmUoKTsKICAgIH0gY2F0Y2ggKGV4KSB7CiAgICAgIGlmIChleCBpbnN0YW5jZW9mIF9jb3JlX3V0aWxzLk1pc3NpbmdEYXRhRXhjZXB0aW9uKSB7CiAgICAgICAgdGhyb3cgZXg7CiAgICAgIH0KICAgICAgKDAsIF91dGlsLndhcm4pKCJVbmFibGUgdG8gcmVhZCBkb2N1bWVudCBvdXRsaW5lLiIpOwogICAgfQogICAgcmV0dXJuICgwLCBfdXRpbC5zaGFkb3cpKHRoaXMsICJkb2N1bWVudE91dGxpbmUiLCBvYmopOwogIH0KICBfcmVhZERvY3VtZW50T3V0bGluZSgpIHsKICAgIGxldCBvYmogPSB0aGlzLl9jYXREaWN0LmdldCgiT3V0bGluZXMiKTsKICAgIGlmICghKG9iaiBpbnN0YW5jZW9mIF9wcmltaXRpdmVzLkRpY3QpKSB7CiAgICAgIHJldHVybiBudWxsOwogICAgfQogICAgb2JqID0gb2JqLmdldFJhdygiRmlyc3QiKTsKICAgIGlmICghKG9iaiBpbnN0YW5jZW9mIF9wcmltaXRpdmVzLlJlZikpIHsKICAgICAgcmV0dXJuIG51bGw7CiAgICB9CiAgICBjb25zdCByb290ID0gewogICAgICBpdGVtczogW10KICAgIH07CiAgICBjb25zdCBxdWV1ZSA9IFt7CiAgICAgIG9iaiwKICAgICAgcGFyZW50OiByb290CiAgICB9XTsKICAgIGNvbnN0IHByb2Nlc3NlZCA9IG5ldyBfcHJpbWl0aXZlcy5SZWZTZXQoKTsKICAgIHByb2Nlc3NlZC5wdXQob2JqKTsKICAgIGNvbnN0IHhyZWYgPSB0aGlzLnhyZWYsCiAgICAgIGJsYWNrQ29sb3IgPSBuZXcgVWludDhDbGFtcGVkQXJyYXkoMyk7CiAgICB3aGlsZSAocXVldWUubGVuZ3RoID4gMCkgewogICAgICBjb25zdCBpID0gcXVldWUuc2hpZnQoKTsKICAgICAgY29uc3Qgb3V0bGluZURpY3QgPSB4cmVmLmZldGNoSWZSZWYoaS5vYmopOwogICAgICBpZiAob3V0bGluZURpY3QgPT09IG51bGwpIHsKICAgICAgICBjb250aW51ZTsKICAgICAgfQogICAgICBpZiAoIW91dGxpbmVEaWN0LmhhcygiVGl0bGUiKSkgewogICAgICAgIHRocm93IG5ldyBfdXRpbC5Gb3JtYXRFcnJvcigiSW52YWxpZCBvdXRsaW5lIGl0ZW0gZW5jb3VudGVyZWQuIik7CiAgICAgIH0KICAgICAgY29uc3QgZGF0YSA9IHsKICAgICAgICB1cmw6IG51bGwsCiAgICAgICAgZGVzdDogbnVsbCwKICAgICAgICBhY3Rpb246IG51bGwKICAgICAgfTsKICAgICAgQ2F0YWxvZy5wYXJzZURlc3REaWN0aW9uYXJ5KHsKICAgICAgICBkZXN0RGljdDogb3V0bGluZURpY3QsCiAgICAgICAgcmVzdWx0T2JqOiBkYXRhLAogICAgICAgIGRvY0Jhc2VVcmw6IHRoaXMuYmFzZVVybCwKICAgICAgICBkb2NBdHRhY2htZW50czogdGhpcy5hdHRhY2htZW50cwogICAgICB9KTsKICAgICAgY29uc3QgdGl0bGUgPSBvdXRsaW5lRGljdC5nZXQoIlRpdGxlIik7CiAgICAgIGNvbnN0IGZsYWdzID0gb3V0bGluZURpY3QuZ2V0KCJGIikgfHwgMDsKICAgICAgY29uc3QgY29sb3IgPSBvdXRsaW5lRGljdC5nZXRBcnJheSgiQyIpOwogICAgICBjb25zdCBjb3VudCA9IG91dGxpbmVEaWN0LmdldCgiQ291bnQiKTsKICAgICAgbGV0IHJnYkNvbG9yID0gYmxhY2tDb2xvcjsKICAgICAgaWYgKEFycmF5LmlzQXJyYXkoY29sb3IpICYmIGNvbG9yLmxlbmd0aCA9PT0gMyAmJiAoY29sb3JbMF0gIT09IDAgfHwgY29sb3JbMV0gIT09IDAgfHwgY29sb3JbMl0gIT09IDApKSB7CiAgICAgICAgcmdiQ29sb3IgPSBfY29sb3JzcGFjZS5Db2xvclNwYWNlLnNpbmdsZXRvbnMucmdiLmdldFJnYihjb2xvciwgMCk7CiAgICAgIH0KICAgICAgY29uc3Qgb3V0bGluZUl0ZW0gPSB7CiAgICAgICAgYWN0aW9uOiBkYXRhLmFjdGlvbiwKICAgICAgICBhdHRhY2htZW50OiBkYXRhLmF0dGFjaG1lbnQsCiAgICAgICAgZGVzdDogZGF0YS5kZXN0LAogICAgICAgIHVybDogZGF0YS51cmwsCiAgICAgICAgdW5zYWZlVXJsOiBkYXRhLnVuc2FmZVVybCwKICAgICAgICBuZXdXaW5kb3c6IGRhdGEubmV3V2luZG93LAogICAgICAgIHNldE9DR1N0YXRlOiBkYXRhLnNldE9DR1N0YXRlLAogICAgICAgIHRpdGxlOiAoMCwgX3V0aWwuc3RyaW5nVG9QREZTdHJpbmcpKHRpdGxlKSwKICAgICAgICBjb2xvcjogcmdiQ29sb3IsCiAgICAgICAgY291bnQ6IE51bWJlci5pc0ludGVnZXIoY291bnQpID8gY291bnQgOiB1bmRlZmluZWQsCiAgICAgICAgYm9sZDogISEoZmxhZ3MgJiAyKSwKICAgICAgICBpdGFsaWM6ICEhKGZsYWdzICYgMSksCiAgICAgICAgaXRlbXM6IFtdCiAgICAgIH07CiAgICAgIGkucGFyZW50Lml0ZW1zLnB1c2gob3V0bGluZUl0ZW0pOwogICAgICBvYmogPSBvdXRsaW5lRGljdC5nZXRSYXcoIkZpcnN0Iik7CiAgICAgIGlmIChvYmogaW5zdGFuY2VvZiBfcHJpbWl0aXZlcy5SZWYgJiYgIXByb2Nlc3NlZC5oYXMob2JqKSkgewogICAgICAgIHF1ZXVlLnB1c2goewogICAgICAgICAgb2JqLAogICAgICAgICAgcGFyZW50OiBvdXRsaW5lSXRlbQogICAgICAgIH0pOwogICAgICAgIHByb2Nlc3NlZC5wdXQob2JqKTsKICAgICAgfQogICAgICBvYmogPSBvdXRsaW5lRGljdC5nZXRSYXcoIk5leHQiKTsKICAgICAgaWYgKG9iaiBpbnN0YW5jZW9mIF9wcmltaXRpdmVzLlJlZiAmJiAhcHJvY2Vzc2VkLmhhcyhvYmopKSB7CiAgICAgICAgcXVldWUucHVzaCh7CiAgICAgICAgICBvYmosCiAgICAgICAgICBwYXJlbnQ6IGkucGFyZW50CiAgICAgICAgfSk7CiAgICAgICAgcHJvY2Vzc2VkLnB1dChvYmopOwogICAgICB9CiAgICB9CiAgICByZXR1cm4gcm9vdC5pdGVtcy5sZW5ndGggPiAwID8gcm9vdC5pdGVtcyA6IG51bGw7CiAgfQogIGdldCBwZXJtaXNzaW9ucygpIHsKICAgIGxldCBwZXJtaXNzaW9ucyA9IG51bGw7CiAgICB0cnkgewogICAgICBwZXJtaXNzaW9ucyA9IHRoaXMuX3JlYWRQZXJtaXNzaW9ucygpOwogICAgfSBjYXRjaCAoZXgpIHsKICAgICAgaWYgKGV4IGluc3RhbmNlb2YgX2NvcmVfdXRpbHMuTWlzc2luZ0RhdGFFeGNlcHRpb24pIHsKICAgICAgICB0aHJvdyBleDsKICAgICAgfQogICAgICAoMCwgX3V0aWwud2FybikoIlVuYWJsZSB0byByZWFkIHBlcm1pc3Npb25zLiIpOwogICAgfQogICAgcmV0dXJuICgwLCBfdXRpbC5zaGFkb3cpKHRoaXMsICJwZXJtaXNzaW9ucyIsIHBlcm1pc3Npb25zKTsKICB9CiAgX3JlYWRQZXJtaXNzaW9ucygpIHsKICAgIGNvbnN0IGVuY3J5cHQgPSB0aGlzLnhyZWYudHJhaWxlci5nZXQoIkVuY3J5cHQiKTsKICAgIGlmICghKGVuY3J5cHQgaW5zdGFuY2VvZiBfcHJpbWl0aXZlcy5EaWN0KSkgewogICAgICByZXR1cm4gbnVsbDsKICAgIH0KICAgIGxldCBmbGFncyA9IGVuY3J5cHQuZ2V0KCJQIik7CiAgICBpZiAodHlwZW9mIGZsYWdzICE9PSAibnVtYmVyIikgewogICAgICByZXR1cm4gbnVsbDsKICAgIH0KICAgIGZsYWdzICs9IDIgKiogMzI7CiAgICBjb25zdCBwZXJtaXNzaW9ucyA9IFtdOwogICAgZm9yIChjb25zdCBrZXkgaW4gX3V0aWwuUGVybWlzc2lvbkZsYWcpIHsKICAgICAgY29uc3QgdmFsdWUgPSBfdXRpbC5QZXJtaXNzaW9uRmxhZ1trZXldOwogICAgICBpZiAoZmxhZ3MgJiB2YWx1ZSkgewogICAgICAgIHBlcm1pc3Npb25zLnB1c2godmFsdWUpOwogICAgICB9CiAgICB9CiAgICByZXR1cm4gcGVybWlzc2lvbnM7CiAgfQogIGdldCBvcHRpb25hbENvbnRlbnRDb25maWcoKSB7CiAgICBsZXQgY29uZmlnID0gbnVsbDsKICAgIHRyeSB7CiAgICAgIGNvbnN0IHByb3BlcnRpZXMgPSB0aGlzLl9jYXREaWN0LmdldCgiT0NQcm9wZXJ0aWVzIik7CiAgICAgIGlmICghcHJvcGVydGllcykgewogICAgICAgIHJldHVybiAoMCwgX3V0aWwuc2hhZG93KSh0aGlzLCAib3B0aW9uYWxDb250ZW50Q29uZmlnIiwgbnVsbCk7CiAgICAgIH0KICAgICAgY29uc3QgZGVmYXVsdENvbmZpZyA9IHByb3BlcnRpZXMuZ2V0KCJEIik7CiAgICAgIGlmICghZGVmYXVsdENvbmZpZykgewogICAgICAgIHJldHVybiAoMCwgX3V0aWwuc2hhZG93KSh0aGlzLCAib3B0aW9uYWxDb250ZW50Q29uZmlnIiwgbnVsbCk7CiAgICAgIH0KICAgICAgY29uc3QgZ3JvdXBzRGF0YSA9IHByb3BlcnRpZXMuZ2V0KCJPQ0dzIik7CiAgICAgIGlmICghQXJyYXkuaXNBcnJheShncm91cHNEYXRhKSkgewogICAgICAgIHJldHVybiAoMCwgX3V0aWwuc2hhZG93KSh0aGlzLCAib3B0aW9uYWxDb250ZW50Q29uZmlnIiwgbnVsbCk7CiAgICAgIH0KICAgICAgY29uc3QgZ3JvdXBzID0gW107CiAgICAgIGNvbnN0IGdyb3VwUmVmcyA9IFtdOwogICAgICBmb3IgKGNvbnN0IGdyb3VwUmVmIG9mIGdyb3Vwc0RhdGEpIHsKICAgICAgICBpZiAoIShncm91cFJlZiBpbnN0YW5jZW9mIF9wcmltaXRpdmVzLlJlZikpIHsKICAgICAgICAgIGNvbnRpbnVlOwogICAgICAgIH0KICAgICAgICBncm91cFJlZnMucHVzaChncm91cFJlZik7CiAgICAgICAgY29uc3QgZ3JvdXAgPSB0aGlzLnhyZWYuZmV0Y2hJZlJlZihncm91cFJlZik7CiAgICAgICAgZ3JvdXBzLnB1c2goewogICAgICAgICAgaWQ6IGdyb3VwUmVmLnRvU3RyaW5nKCksCiAgICAgICAgICBuYW1lOiB0eXBlb2YgZ3JvdXAuZ2V0KCJOYW1lIikgPT09ICJzdHJpbmciID8gKDAsIF91dGlsLnN0cmluZ1RvUERGU3RyaW5nKShncm91cC5nZXQoIk5hbWUiKSkgOiBudWxsLAogICAgICAgICAgaW50ZW50OiB0eXBlb2YgZ3JvdXAuZ2V0KCJJbnRlbnQiKSA9PT0gInN0cmluZyIgPyAoMCwgX3V0aWwuc3RyaW5nVG9QREZTdHJpbmcpKGdyb3VwLmdldCgiSW50ZW50IikpIDogbnVsbAogICAgICAgIH0pOwogICAgICB9CiAgICAgIGNvbmZpZyA9IHRoaXMuX3JlYWRPcHRpb25hbENvbnRlbnRDb25maWcoZGVmYXVsdENvbmZpZywgZ3JvdXBSZWZzKTsKICAgICAgY29uZmlnLmdyb3VwcyA9IGdyb3VwczsKICAgIH0gY2F0Y2ggKGV4KSB7CiAgICAgIGlmIChleCBpbnN0YW5jZW9mIF9jb3JlX3V0aWxzLk1pc3NpbmdEYXRhRXhjZXB0aW9uKSB7CiAgICAgICAgdGhyb3cgZXg7CiAgICAgIH0KICAgICAgKDAsIF91dGlsLndhcm4pKGBVbmFibGUgdG8gcmVhZCBvcHRpb25hbCBjb250ZW50IGNvbmZpZzogJHtleH1gKTsKICAgIH0KICAgIHJldHVybiAoMCwgX3V0aWwuc2hhZG93KSh0aGlzLCAib3B0aW9uYWxDb250ZW50Q29uZmlnIiwgY29uZmlnKTsKICB9CiAgX3JlYWRPcHRpb25hbENvbnRlbnRDb25maWcoY29uZmlnLCBjb250ZW50R3JvdXBSZWZzKSB7CiAgICBmdW5jdGlvbiBwYXJzZU9uT2ZmKHJlZnMpIHsKICAgICAgY29uc3Qgb25QYXJzZWQgPSBbXTsKICAgICAgaWYgKEFycmF5LmlzQXJyYXkocmVmcykpIHsKICAgICAgICBmb3IgKGNvbnN0IHZhbHVlIG9mIHJlZnMpIHsKICAgICAgICAgIGlmICghKHZhbHVlIGluc3RhbmNlb2YgX3ByaW1pdGl2ZXMuUmVmKSkgewogICAgICAgICAgICBjb250aW51ZTsKICAgICAgICAgIH0KICAgICAgICAgIGlmIChjb250ZW50R3JvdXBSZWZzLmluY2x1ZGVzKHZhbHVlKSkgewogICAgICAgICAgICBvblBhcnNlZC5wdXNoKHZhbHVlLnRvU3RyaW5nKCkpOwogICAgICAgICAgfQogICAgICAgIH0KICAgICAgfQogICAgICByZXR1cm4gb25QYXJzZWQ7CiAgICB9CiAgICBmdW5jdGlvbiBwYXJzZU9yZGVyKHJlZnMsIG5lc3RlZExldmVscyA9IDApIHsKICAgICAgaWYgKCFBcnJheS5pc0FycmF5KHJlZnMpKSB7CiAgICAgICAgcmV0dXJuIG51bGw7CiAgICAgIH0KICAgICAgY29uc3Qgb3JkZXIgPSBbXTsKICAgICAgZm9yIChjb25zdCB2YWx1ZSBvZiByZWZzKSB7CiAgICAgICAgaWYgKHZhbHVlIGluc3RhbmNlb2YgX3ByaW1pdGl2ZXMuUmVmICYmIGNvbnRlbnRHcm91cFJlZnMuaW5jbHVkZXModmFsdWUpKSB7CiAgICAgICAgICBwYXJzZWRPcmRlclJlZnMucHV0KHZhbHVlKTsKICAgICAgICAgIG9yZGVyLnB1c2godmFsdWUudG9TdHJpbmcoKSk7CiAgICAgICAgICBjb250aW51ZTsKICAgICAgICB9CiAgICAgICAgY29uc3QgbmVzdGVkT3JkZXIgPSBwYXJzZU5lc3RlZE9yZGVyKHZhbHVlLCBuZXN0ZWRMZXZlbHMpOwogICAgICAgIGlmIChuZXN0ZWRPcmRlcikgewogICAgICAgICAgb3JkZXIucHVzaChuZXN0ZWRPcmRlcik7CiAgICAgICAgfQogICAgICB9CiAgICAgIGlmIChuZXN0ZWRMZXZlbHMgPiAwKSB7CiAgICAgICAgcmV0dXJuIG9yZGVyOwogICAgICB9CiAgICAgIGNvbnN0IGhpZGRlbkdyb3VwcyA9IFtdOwogICAgICBmb3IgKGNvbnN0IGdyb3VwUmVmIG9mIGNvbnRlbnRHcm91cFJlZnMpIHsKICAgICAgICBpZiAocGFyc2VkT3JkZXJSZWZzLmhhcyhncm91cFJlZikpIHsKICAgICAgICAgIGNvbnRpbnVlOwogICAgICAgIH0KICAgICAgICBoaWRkZW5Hcm91cHMucHVzaChncm91cFJlZi50b1N0cmluZygpKTsKICAgICAgfQogICAgICBpZiAoaGlkZGVuR3JvdXBzLmxlbmd0aCkgewogICAgICAgIG9yZGVyLnB1c2goewogICAgICAgICAgbmFtZTogbnVsbCwKICAgICAgICAgIG9yZGVyOiBoaWRkZW5Hcm91cHMKICAgICAgICB9KTsKICAgICAgfQogICAgICByZXR1cm4gb3JkZXI7CiAgICB9CiAgICBmdW5jdGlvbiBwYXJzZU5lc3RlZE9yZGVyKHJlZiwgbmVzdGVkTGV2ZWxzKSB7CiAgICAgIGlmICgrK25lc3RlZExldmVscyA+IE1BWF9ORVNURURfTEVWRUxTKSB7CiAgICAgICAgKDAsIF91dGlsLndhcm4pKCJwYXJzZU5lc3RlZE9yZGVyIC0gcmVhY2hlZCBNQVhfTkVTVEVEX0xFVkVMUy4iKTsKICAgICAgICByZXR1cm4gbnVsbDsKICAgICAgfQogICAgICBjb25zdCB2YWx1ZSA9IHhyZWYuZmV0Y2hJZlJlZihyZWYpOwogICAgICBpZiAoIUFycmF5LmlzQXJyYXkodmFsdWUpKSB7CiAgICAgICAgcmV0dXJuIG51bGw7CiAgICAgIH0KICAgICAgY29uc3QgbmVzdGVkTmFtZSA9IHhyZWYuZmV0Y2hJZlJlZih2YWx1ZVswXSk7CiAgICAgIGlmICh0eXBlb2YgbmVzdGVkTmFtZSAhPT0gInN0cmluZyIpIHsKICAgICAgICByZXR1cm4gbnVsbDsKICAgICAgfQogICAgICBjb25zdCBuZXN0ZWRPcmRlciA9IHBhcnNlT3JkZXIodmFsdWUuc2xpY2UoMSksIG5lc3RlZExldmVscyk7CiAgICAgIGlmICghbmVzdGVkT3JkZXIgfHwgIW5lc3RlZE9yZGVyLmxlbmd0aCkgewogICAgICAgIHJldHVybiBudWxsOwogICAgICB9CiAgICAgIHJldHVybiB7CiAgICAgICAgbmFtZTogKDAsIF91dGlsLnN0cmluZ1RvUERGU3RyaW5nKShuZXN0ZWROYW1lKSwKICAgICAgICBvcmRlcjogbmVzdGVkT3JkZXIKICAgICAgfTsKICAgIH0KICAgIGNvbnN0IHhyZWYgPSB0aGlzLnhyZWYsCiAgICAgIHBhcnNlZE9yZGVyUmVmcyA9IG5ldyBfcHJpbWl0aXZlcy5SZWZTZXQoKSwKICAgICAgTUFYX05FU1RFRF9MRVZFTFMgPSAxMDsKICAgIHJldHVybiB7CiAgICAgIG5hbWU6IHR5cGVvZiBjb25maWcuZ2V0KCJOYW1lIikgPT09ICJzdHJpbmciID8gKDAsIF91dGlsLnN0cmluZ1RvUERGU3RyaW5nKShjb25maWcuZ2V0KCJOYW1lIikpIDogbnVsbCwKICAgICAgY3JlYXRvcjogdHlwZW9mIGNvbmZpZy5nZXQoIkNyZWF0b3IiKSA9PT0gInN0cmluZyIgPyAoMCwgX3V0aWwuc3RyaW5nVG9QREZTdHJpbmcpKGNvbmZpZy5nZXQoIkNyZWF0b3IiKSkgOiBudWxsLAogICAgICBiYXNlU3RhdGU6IGNvbmZpZy5nZXQoIkJhc2VTdGF0ZSIpIGluc3RhbmNlb2YgX3ByaW1pdGl2ZXMuTmFtZSA/IGNvbmZpZy5nZXQoIkJhc2VTdGF0ZSIpLm5hbWUgOiBudWxsLAogICAgICBvbjogcGFyc2VPbk9mZihjb25maWcuZ2V0KCJPTiIpKSwKICAgICAgb2ZmOiBwYXJzZU9uT2ZmKGNvbmZpZy5nZXQoIk9GRiIpKSwKICAgICAgb3JkZXI6IHBhcnNlT3JkZXIoY29uZmlnLmdldCgiT3JkZXIiKSksCiAgICAgIGdyb3VwczogbnVsbAogICAgfTsKICB9CiAgc2V0QWN0dWFsTnVtUGFnZXMobnVtID0gbnVsbCkgewogICAgdGhpcy5fYWN0dWFsTnVtUGFnZXMgPSBudW07CiAgfQogIGdldCBoYXNBY3R1YWxOdW1QYWdlcygpIHsKICAgIHJldHVybiB0aGlzLl9hY3R1YWxOdW1QYWdlcyAhPT0gbnVsbDsKICB9CiAgZ2V0IF9wYWdlc0NvdW50KCkgewogICAgY29uc3Qgb2JqID0gdGhpcy50b3BsZXZlbFBhZ2VzRGljdC5nZXQoIkNvdW50Iik7CiAgICBpZiAoIU51bWJlci5pc0ludGVnZXIob2JqKSkgewogICAgICB0aHJvdyBuZXcgX3V0aWwuRm9ybWF0RXJyb3IoIlBhZ2UgY291bnQgaW4gdG9wLWxldmVsIHBhZ2VzIGRpY3Rpb25hcnkgaXMgbm90IGFuIGludGVnZXIuIik7CiAgICB9CiAgICByZXR1cm4gKDAsIF91dGlsLnNoYWRvdykodGhpcywgIl9wYWdlc0NvdW50Iiwgb2JqKTsKICB9CiAgZ2V0IG51bVBhZ2VzKCkgewogICAgcmV0dXJuIHRoaXMuaGFzQWN0dWFsTnVtUGFnZXMgPyB0aGlzLl9hY3R1YWxOdW1QYWdlcyA6IHRoaXMuX3BhZ2VzQ291bnQ7CiAgfQogIGdldCBkZXN0aW5hdGlvbnMoKSB7CiAgICBjb25zdCBvYmogPSB0aGlzLl9yZWFkRGVzdHMoKSwKICAgICAgZGVzdHMgPSBPYmplY3QuY3JlYXRlKG51bGwpOwogICAgaWYgKG9iaiBpbnN0YW5jZW9mIF9uYW1lX251bWJlcl90cmVlLk5hbWVUcmVlKSB7CiAgICAgIGZvciAoY29uc3QgW2tleSwgdmFsdWVdIG9mIG9iai5nZXRBbGwoKSkgewogICAgICAgIGNvbnN0IGRlc3QgPSBmZXRjaERlc3RpbmF0aW9uKHZhbHVlKTsKICAgICAgICBpZiAoZGVzdCkgewogICAgICAgICAgZGVzdHNbKDAsIF91dGlsLnN0cmluZ1RvUERGU3RyaW5nKShrZXkpXSA9IGRlc3Q7CiAgICAgICAgfQogICAgICB9CiAgICB9IGVsc2UgaWYgKG9iaiBpbnN0YW5jZW9mIF9wcmltaXRpdmVzLkRpY3QpIHsKICAgICAgb2JqLmZvckVhY2goZnVuY3Rpb24gKGtleSwgdmFsdWUpIHsKICAgICAgICBjb25zdCBkZXN0ID0gZmV0Y2hEZXN0aW5hdGlvbih2YWx1ZSk7CiAgICAgICAgaWYgKGRlc3QpIHsKICAgICAgICAgIGRlc3RzW2tleV0gPSBkZXN0OwogICAgICAgIH0KICAgICAgfSk7CiAgICB9CiAgICByZXR1cm4gKDAsIF91dGlsLnNoYWRvdykodGhpcywgImRlc3RpbmF0aW9ucyIsIGRlc3RzKTsKICB9CiAgZ2V0RGVzdGluYXRpb24oaWQpIHsKICAgIGNvbnN0IG9iaiA9IHRoaXMuX3JlYWREZXN0cygpOwogICAgaWYgKG9iaiBpbnN0YW5jZW9mIF9uYW1lX251bWJlcl90cmVlLk5hbWVUcmVlKSB7CiAgICAgIGNvbnN0IGRlc3QgPSBmZXRjaERlc3RpbmF0aW9uKG9iai5nZXQoaWQpKTsKICAgICAgaWYgKGRlc3QpIHsKICAgICAgICByZXR1cm4gZGVzdDsKICAgICAgfQogICAgICBjb25zdCBhbGxEZXN0ID0gdGhpcy5kZXN0aW5hdGlvbnNbaWRdOwogICAgICBpZiAoYWxsRGVzdCkgewogICAgICAgICgwLCBfdXRpbC53YXJuKShgRm91bmQgIiR7aWR9IiBhdCBhbiBpbmNvcnJlY3QgcG9zaXRpb24gaW4gdGhlIE5hbWVUcmVlLmApOwogICAgICAgIHJldHVybiBhbGxEZXN0OwogICAgICB9CiAgICB9IGVsc2UgaWYgKG9iaiBpbnN0YW5jZW9mIF9wcmltaXRpdmVzLkRpY3QpIHsKICAgICAgY29uc3QgZGVzdCA9IGZldGNoRGVzdGluYXRpb24ob2JqLmdldChpZCkpOwogICAgICBpZiAoZGVzdCkgewogICAgICAgIHJldHVybiBkZXN0OwogICAgICB9CiAgICB9CiAgICByZXR1cm4gbnVsbDsKICB9CiAgX3JlYWREZXN0cygpIHsKICAgIGNvbnN0IG9iaiA9IHRoaXMuX2NhdERpY3QuZ2V0KCJOYW1lcyIpOwogICAgaWYgKG9iaj8uaGFzKCJEZXN0cyIpKSB7CiAgICAgIHJldHVybiBuZXcgX25hbWVfbnVtYmVyX3RyZWUuTmFtZVRyZWUob2JqLmdldFJhdygiRGVzdHMiKSwgdGhpcy54cmVmKTsKICAgIH0gZWxzZSBpZiAodGhpcy5fY2F0RGljdC5oYXMoIkRlc3RzIikpIHsKICAgICAgcmV0dXJuIHRoaXMuX2NhdERpY3QuZ2V0KCJEZXN0cyIpOwogICAgfQogICAgcmV0dXJuIHVuZGVmaW5lZDsKICB9CiAgZ2V0IHBhZ2VMYWJlbHMoKSB7CiAgICBsZXQgb2JqID0gbnVsbDsKICAgIHRyeSB7CiAgICAgIG9iaiA9IHRoaXMuX3JlYWRQYWdlTGFiZWxzKCk7CiAgICB9IGNhdGNoIChleCkgewogICAgICBpZiAoZXggaW5zdGFuY2VvZiBfY29yZV91dGlscy5NaXNzaW5nRGF0YUV4Y2VwdGlvbikgewogICAgICAgIHRocm93IGV4OwogICAgICB9CiAgICAgICgwLCBfdXRpbC53YXJuKSgiVW5hYmxlIHRvIHJlYWQgcGFnZSBsYWJlbHMuIik7CiAgICB9CiAgICByZXR1cm4gKDAsIF91dGlsLnNoYWRvdykodGhpcywgInBhZ2VMYWJlbHMiLCBvYmopOwogIH0KICBfcmVhZFBhZ2VMYWJlbHMoKSB7CiAgICBjb25zdCBvYmogPSB0aGlzLl9jYXREaWN0LmdldFJhdygiUGFnZUxhYmVscyIpOwogICAgaWYgKCFvYmopIHsKICAgICAgcmV0dXJuIG51bGw7CiAgICB9CiAgICBjb25zdCBwYWdlTGFiZWxzID0gbmV3IEFycmF5KHRoaXMubnVtUGFnZXMpOwogICAgbGV0IHN0eWxlID0gbnVsbCwKICAgICAgcHJlZml4ID0gIiI7CiAgICBjb25zdCBudW1iZXJUcmVlID0gbmV3IF9uYW1lX251bWJlcl90cmVlLk51bWJlclRyZWUob2JqLCB0aGlzLnhyZWYpOwogICAgY29uc3QgbnVtcyA9IG51bWJlclRyZWUuZ2V0QWxsKCk7CiAgICBsZXQgY3VycmVudExhYmVsID0gIiIsCiAgICAgIGN1cnJlbnRJbmRleCA9IDE7CiAgICBmb3IgKGxldCBpID0gMCwgaWkgPSB0aGlzLm51bVBhZ2VzOyBpIDwgaWk7IGkrKykgewogICAgICBjb25zdCBsYWJlbERpY3QgPSBudW1zLmdldChpKTsKICAgICAgaWYgKGxhYmVsRGljdCAhPT0gdW5kZWZpbmVkKSB7CiAgICAgICAgaWYgKCEobGFiZWxEaWN0IGluc3RhbmNlb2YgX3ByaW1pdGl2ZXMuRGljdCkpIHsKICAgICAgICAgIHRocm93IG5ldyBfdXRpbC5Gb3JtYXRFcnJvcigiUGFnZUxhYmVsIGlzIG5vdCBhIGRpY3Rpb25hcnkuIik7CiAgICAgICAgfQogICAgICAgIGlmIChsYWJlbERpY3QuaGFzKCJUeXBlIikgJiYgISgwLCBfcHJpbWl0aXZlcy5pc05hbWUpKGxhYmVsRGljdC5nZXQoIlR5cGUiKSwgIlBhZ2VMYWJlbCIpKSB7CiAgICAgICAgICB0aHJvdyBuZXcgX3V0aWwuRm9ybWF0RXJyb3IoIkludmFsaWQgdHlwZSBpbiBQYWdlTGFiZWwgZGljdGlvbmFyeS4iKTsKICAgICAgICB9CiAgICAgICAgaWYgKGxhYmVsRGljdC5oYXMoIlMiKSkgewogICAgICAgICAgY29uc3QgcyA9IGxhYmVsRGljdC5nZXQoIlMiKTsKICAgICAgICAgIGlmICghKHMgaW5zdGFuY2VvZiBfcHJpbWl0aXZlcy5OYW1lKSkgewogICAgICAgICAgICB0aHJvdyBuZXcgX3V0aWwuRm9ybWF0RXJyb3IoIkludmFsaWQgc3R5bGUgaW4gUGFnZUxhYmVsIGRpY3Rpb25hcnkuIik7CiAgICAgICAgICB9CiAgICAgICAgICBzdHlsZSA9IHMubmFtZTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgc3R5bGUgPSBudWxsOwogICAgICAgIH0KICAgICAgICBpZiAobGFiZWxEaWN0LmhhcygiUCIpKSB7CiAgICAgICAgICBjb25zdCBwID0gbGFiZWxEaWN0LmdldCgiUCIpOwogICAgICAgICAgaWYgKHR5cGVvZiBwICE9PSAic3RyaW5nIikgewogICAgICAgICAgICB0aHJvdyBuZXcgX3V0aWwuRm9ybWF0RXJyb3IoIkludmFsaWQgcHJlZml4IGluIFBhZ2VMYWJlbCBkaWN0aW9uYXJ5LiIpOwogICAgICAgICAgfQogICAgICAgICAgcHJlZml4ID0gKDAsIF91dGlsLnN0cmluZ1RvUERGU3RyaW5nKShwKTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgcHJlZml4ID0gIiI7CiAgICAgICAgfQogICAgICAgIGlmIChsYWJlbERpY3QuaGFzKCJTdCIpKSB7CiAgICAgICAgICBjb25zdCBzdCA9IGxhYmVsRGljdC5nZXQoIlN0Iik7CiAgICAgICAgICBpZiAoIShOdW1iZXIuaXNJbnRlZ2VyKHN0KSAmJiBzdCA+PSAxKSkgewogICAgICAgICAgICB0aHJvdyBuZXcgX3V0aWwuRm9ybWF0RXJyb3IoIkludmFsaWQgc3RhcnQgaW4gUGFnZUxhYmVsIGRpY3Rpb25hcnkuIik7CiAgICAgICAgICB9CiAgICAgICAgICBjdXJyZW50SW5kZXggPSBzdDsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgY3VycmVudEluZGV4ID0gMTsKICAgICAgICB9CiAgICAgIH0KICAgICAgc3dpdGNoIChzdHlsZSkgewogICAgICAgIGNhc2UgIkQiOgogICAgICAgICAgY3VycmVudExhYmVsID0gY3VycmVudEluZGV4OwogICAgICAgICAgYnJlYWs7CiAgICAgICAgY2FzZSAiUiI6CiAgICAgICAgY2FzZSAiciI6CiAgICAgICAgICBjdXJyZW50TGFiZWwgPSAoMCwgX2NvcmVfdXRpbHMudG9Sb21hbk51bWVyYWxzKShjdXJyZW50SW5kZXgsIHN0eWxlID09PSAiciIpOwogICAgICAgICAgYnJlYWs7CiAgICAgICAgY2FzZSAiQSI6CiAgICAgICAgY2FzZSAiYSI6CiAgICAgICAgICBjb25zdCBMSU1JVCA9IDI2OwogICAgICAgICAgY29uc3QgQV9VUFBFUl9DQVNFID0gMHg0MSwKICAgICAgICAgICAgQV9MT1dFUl9DQVNFID0gMHg2MTsKICAgICAgICAgIGNvbnN0IGJhc2VDaGFyQ29kZSA9IHN0eWxlID09PSAiYSIgPyBBX0xPV0VSX0NBU0UgOiBBX1VQUEVSX0NBU0U7CiAgICAgICAgICBjb25zdCBsZXR0ZXJJbmRleCA9IGN1cnJlbnRJbmRleCAtIDE7CiAgICAgICAgICBjb25zdCBjaGFyYWN0ZXIgPSBTdHJpbmcuZnJvbUNoYXJDb2RlKGJhc2VDaGFyQ29kZSArIGxldHRlckluZGV4ICUgTElNSVQpOwogICAgICAgICAgY3VycmVudExhYmVsID0gY2hhcmFjdGVyLnJlcGVhdChNYXRoLmZsb29yKGxldHRlckluZGV4IC8gTElNSVQpICsgMSk7CiAgICAgICAgICBicmVhazsKICAgICAgICBkZWZhdWx0OgogICAgICAgICAgaWYgKHN0eWxlKSB7CiAgICAgICAgICAgIHRocm93IG5ldyBfdXRpbC5Gb3JtYXRFcnJvcihgSW52YWxpZCBzdHlsZSAiJHtzdHlsZX0iIGluIFBhZ2VMYWJlbCBkaWN0aW9uYXJ5LmApOwogICAgICAgICAgfQogICAgICAgICAgY3VycmVudExhYmVsID0gIiI7CiAgICAgIH0KICAgICAgcGFnZUxhYmVsc1tpXSA9IHByZWZpeCArIGN1cnJlbnRMYWJlbDsKICAgICAgY3VycmVudEluZGV4Kys7CiAgICB9CiAgICByZXR1cm4gcGFnZUxhYmVsczsKICB9CiAgZ2V0IHBhZ2VMYXlvdXQoKSB7CiAgICBjb25zdCBvYmogPSB0aGlzLl9jYXREaWN0LmdldCgiUGFnZUxheW91dCIpOwogICAgbGV0IHBhZ2VMYXlvdXQgPSAiIjsKICAgIGlmIChvYmogaW5zdGFuY2VvZiBfcHJpbWl0aXZlcy5OYW1lKSB7CiAgICAgIHN3aXRjaCAob2JqLm5hbWUpIHsKICAgICAgICBjYXNlICJTaW5nbGVQYWdlIjoKICAgICAgICBjYXNlICJPbmVDb2x1bW4iOgogICAgICAgIGNhc2UgIlR3b0NvbHVtbkxlZnQiOgogICAgICAgIGNhc2UgIlR3b0NvbHVtblJpZ2h0IjoKICAgICAgICBjYXNlICJUd29QYWdlTGVmdCI6CiAgICAgICAgY2FzZSAiVHdvUGFnZVJpZ2h0IjoKICAgICAgICAgIHBhZ2VMYXlvdXQgPSBvYmoubmFtZTsKICAgICAgfQogICAgfQogICAgcmV0dXJuICgwLCBfdXRpbC5zaGFkb3cpKHRoaXMsICJwYWdlTGF5b3V0IiwgcGFnZUxheW91dCk7CiAgfQogIGdldCBwYWdlTW9kZSgpIHsKICAgIGNvbnN0IG9iaiA9IHRoaXMuX2NhdERpY3QuZ2V0KCJQYWdlTW9kZSIpOwogICAgbGV0IHBhZ2VNb2RlID0gIlVzZU5vbmUiOwogICAgaWYgKG9iaiBpbnN0YW5jZW9mIF9wcmltaXRpdmVzLk5hbWUpIHsKICAgICAgc3dpdGNoIChvYmoubmFtZSkgewogICAgICAgIGNhc2UgIlVzZU5vbmUiOgogICAgICAgIGNhc2UgIlVzZU91dGxpbmVzIjoKICAgICAgICBjYXNlICJVc2VUaHVtYnMiOgogICAgICAgIGNhc2UgIkZ1bGxTY3JlZW4iOgogICAgICAgIGNhc2UgIlVzZU9DIjoKICAgICAgICBjYXNlICJVc2VBdHRhY2htZW50cyI6CiAgICAgICAgICBwYWdlTW9kZSA9IG9iai5uYW1lOwogICAgICB9CiAgICB9CiAgICByZXR1cm4gKDAsIF91dGlsLnNoYWRvdykodGhpcywgInBhZ2VNb2RlIiwgcGFnZU1vZGUpOwogIH0KICBnZXQgdmlld2VyUHJlZmVyZW5jZXMoKSB7CiAgICBjb25zdCBvYmogPSB0aGlzLl9jYXREaWN0LmdldCgiVmlld2VyUHJlZmVyZW5jZXMiKTsKICAgIGlmICghKG9iaiBpbnN0YW5jZW9mIF9wcmltaXRpdmVzLkRpY3QpKSB7CiAgICAgIHJldHVybiAoMCwgX3V0aWwuc2hhZG93KSh0aGlzLCAidmlld2VyUHJlZmVyZW5jZXMiLCBudWxsKTsKICAgIH0KICAgIGxldCBwcmVmcyA9IG51bGw7CiAgICBmb3IgKGNvbnN0IGtleSBvZiBvYmouZ2V0S2V5cygpKSB7CiAgICAgIGNvbnN0IHZhbHVlID0gb2JqLmdldChrZXkpOwogICAgICBsZXQgcHJlZlZhbHVlOwogICAgICBzd2l0Y2ggKGtleSkgewogICAgICAgIGNhc2UgIkhpZGVUb29sYmFyIjoKICAgICAgICBjYXNlICJIaWRlTWVudWJhciI6CiAgICAgICAgY2FzZSAiSGlkZVdpbmRvd1VJIjoKICAgICAgICBjYXNlICJGaXRXaW5kb3ciOgogICAgICAgIGNhc2UgIkNlbnRlcldpbmRvdyI6CiAgICAgICAgY2FzZSAiRGlzcGxheURvY1RpdGxlIjoKICAgICAgICBjYXNlICJQaWNrVHJheUJ5UERGU2l6ZSI6CiAgICAgICAgICBpZiAodHlwZW9mIHZhbHVlID09PSAiYm9vbGVhbiIpIHsKICAgICAgICAgICAgcHJlZlZhbHVlID0gdmFsdWU7CiAgICAgICAgICB9CiAgICAgICAgICBicmVhazsKICAgICAgICBjYXNlICJOb25GdWxsU2NyZWVuUGFnZU1vZGUiOgogICAgICAgICAgaWYgKHZhbHVlIGluc3RhbmNlb2YgX3ByaW1pdGl2ZXMuTmFtZSkgewogICAgICAgICAgICBzd2l0Y2ggKHZhbHVlLm5hbWUpIHsKICAgICAgICAgICAgICBjYXNlICJVc2VOb25lIjoKICAgICAgICAgICAgICBjYXNlICJVc2VPdXRsaW5lcyI6CiAgICAgICAgICAgICAgY2FzZSAiVXNlVGh1bWJzIjoKICAgICAgICAgICAgICBjYXNlICJVc2VPQyI6CiAgICAgICAgICAgICAgICBwcmVmVmFsdWUgPSB2YWx1ZS5uYW1lOwogICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgZGVmYXVsdDoKICAgICAgICAgICAgICAgIHByZWZWYWx1ZSA9ICJVc2VOb25lIjsKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgICAgYnJlYWs7CiAgICAgICAgY2FzZSAiRGlyZWN0aW9uIjoKICAgICAgICAgIGlmICh2YWx1ZSBpbnN0YW5jZW9mIF9wcmltaXRpdmVzLk5hbWUpIHsKICAgICAgICAgICAgc3dpdGNoICh2YWx1ZS5uYW1lKSB7CiAgICAgICAgICAgICAgY2FzZSAiTDJSIjoKICAgICAgICAgICAgICBjYXNlICJSMkwiOgogICAgICAgICAgICAgICAgcHJlZlZhbHVlID0gdmFsdWUubmFtZTsKICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgIGRlZmF1bHQ6CiAgICAgICAgICAgICAgICBwcmVmVmFsdWUgPSAiTDJSIjsKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgICAgYnJlYWs7CiAgICAgICAgY2FzZSAiVmlld0FyZWEiOgogICAgICAgIGNhc2UgIlZpZXdDbGlwIjoKICAgICAgICBjYXNlICJQcmludEFyZWEiOgogICAgICAgIGNhc2UgIlByaW50Q2xpcCI6CiAgICAgICAgICBpZiAodmFsdWUgaW5zdGFuY2VvZiBfcHJpbWl0aXZlcy5OYW1lKSB7CiAgICAgICAgICAgIHN3aXRjaCAodmFsdWUubmFtZSkgewogICAgICAgICAgICAgIGNhc2UgIk1lZGlhQm94IjoKICAgICAgICAgICAgICBjYXNlICJDcm9wQm94IjoKICAgICAgICAgICAgICBjYXNlICJCbGVlZEJveCI6CiAgICAgICAgICAgICAgY2FzZSAiVHJpbUJveCI6CiAgICAgICAgICAgICAgY2FzZSAiQXJ0Qm94IjoKICAgICAgICAgICAgICAgIHByZWZWYWx1ZSA9IHZhbHVlLm5hbWU7CiAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICBkZWZhdWx0OgogICAgICAgICAgICAgICAgcHJlZlZhbHVlID0gIkNyb3BCb3giOwogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgICBicmVhazsKICAgICAgICBjYXNlICJQcmludFNjYWxpbmciOgogICAgICAgICAgaWYgKHZhbHVlIGluc3RhbmNlb2YgX3ByaW1pdGl2ZXMuTmFtZSkgewogICAgICAgICAgICBzd2l0Y2ggKHZhbHVlLm5hbWUpIHsKICAgICAgICAgICAgICBjYXNlICJOb25lIjoKICAgICAgICAgICAgICBjYXNlICJBcHBEZWZhdWx0IjoKICAgICAgICAgICAgICAgIHByZWZWYWx1ZSA9IHZhbHVlLm5hbWU7CiAgICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgICBkZWZhdWx0OgogICAgICAgICAgICAgICAgcHJlZlZhbHVlID0gIkFwcERlZmF1bHQiOwogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgICBicmVhazsKICAgICAgICBjYXNlICJEdXBsZXgiOgogICAgICAgICAgaWYgKHZhbHVlIGluc3RhbmNlb2YgX3ByaW1pdGl2ZXMuTmFtZSkgewogICAgICAgICAgICBzd2l0Y2ggKHZhbHVlLm5hbWUpIHsKICAgICAgICAgICAgICBjYXNlICJTaW1wbGV4IjoKICAgICAgICAgICAgICBjYXNlICJEdXBsZXhGbGlwU2hvcnRFZGdlIjoKICAgICAgICAgICAgICBjYXNlICJEdXBsZXhGbGlwTG9uZ0VkZ2UiOgogICAgICAgICAgICAgICAgcHJlZlZhbHVlID0gdmFsdWUubmFtZTsKICAgICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICAgIGRlZmF1bHQ6CiAgICAgICAgICAgICAgICBwcmVmVmFsdWUgPSAiTm9uZSI7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICAgIGJyZWFrOwogICAgICAgIGNhc2UgIlByaW50UGFnZVJhbmdlIjoKICAgICAgICAgIGlmIChBcnJheS5pc0FycmF5KHZhbHVlKSAmJiB2YWx1ZS5sZW5ndGggJSAyID09PSAwKSB7CiAgICAgICAgICAgIGNvbnN0IGlzVmFsaWQgPSB2YWx1ZS5ldmVyeSgocGFnZSwgaSwgYXJyKSA9PiB7CiAgICAgICAgICAgICAgcmV0dXJuIE51bWJlci5pc0ludGVnZXIocGFnZSkgJiYgcGFnZSA+IDAgJiYgKGkgPT09IDAgfHwgcGFnZSA+PSBhcnJbaSAtIDFdKSAmJiBwYWdlIDw9IHRoaXMubnVtUGFnZXM7CiAgICAgICAgICAgIH0pOwogICAgICAgICAgICBpZiAoaXNWYWxpZCkgewogICAgICAgICAgICAgIHByZWZWYWx1ZSA9IHZhbHVlOwogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgICBicmVhazsKICAgICAgICBjYXNlICJOdW1Db3BpZXMiOgogICAgICAgICAgaWYgKE51bWJlci5pc0ludGVnZXIodmFsdWUpICYmIHZhbHVlID4gMCkgewogICAgICAgICAgICBwcmVmVmFsdWUgPSB2YWx1ZTsKICAgICAgICAgIH0KICAgICAgICAgIGJyZWFrOwogICAgICAgIGRlZmF1bHQ6CiAgICAgICAgICAoMCwgX3V0aWwud2FybikoYElnbm9yaW5nIG5vbi1zdGFuZGFyZCBrZXkgaW4gVmlld2VyUHJlZmVyZW5jZXM6ICR7a2V5fS5gKTsKICAgICAgICAgIGNvbnRpbnVlOwogICAgICB9CiAgICAgIGlmIChwcmVmVmFsdWUgPT09IHVuZGVmaW5lZCkgewogICAgICAgICgwLCBfdXRpbC53YXJuKShgQmFkIHZhbHVlLCBmb3Iga2V5ICIke2tleX0iLCBpbiBWaWV3ZXJQcmVmZXJlbmNlczogJHt2YWx1ZX0uYCk7CiAgICAgICAgY29udGludWU7CiAgICAgIH0KICAgICAgaWYgKCFwcmVmcykgewogICAgICAgIHByZWZzID0gT2JqZWN0LmNyZWF0ZShudWxsKTsKICAgICAgfQogICAgICBwcmVmc1trZXldID0gcHJlZlZhbHVlOwogICAgfQogICAgcmV0dXJuICgwLCBfdXRpbC5zaGFkb3cpKHRoaXMsICJ2aWV3ZXJQcmVmZXJlbmNlcyIsIHByZWZzKTsKICB9CiAgZ2V0IG9wZW5BY3Rpb24oKSB7CiAgICBjb25zdCBvYmogPSB0aGlzLl9jYXREaWN0LmdldCgiT3BlbkFjdGlvbiIpOwogICAgY29uc3Qgb3BlbkFjdGlvbiA9IE9iamVjdC5jcmVhdGUobnVsbCk7CiAgICBpZiAob2JqIGluc3RhbmNlb2YgX3ByaW1pdGl2ZXMuRGljdCkgewogICAgICBjb25zdCBkZXN0RGljdCA9IG5ldyBfcHJpbWl0aXZlcy5EaWN0KHRoaXMueHJlZik7CiAgICAgIGRlc3REaWN0LnNldCgiQSIsIG9iaik7CiAgICAgIGNvbnN0IHJlc3VsdE9iaiA9IHsKICAgICAgICB1cmw6IG51bGwsCiAgICAgICAgZGVzdDogbnVsbCwKICAgICAgICBhY3Rpb246IG51bGwKICAgICAgfTsKICAgICAgQ2F0YWxvZy5wYXJzZURlc3REaWN0aW9uYXJ5KHsKICAgICAgICBkZXN0RGljdCwKICAgICAgICByZXN1bHRPYmoKICAgICAgfSk7CiAgICAgIGlmIChBcnJheS5pc0FycmF5KHJlc3VsdE9iai5kZXN0KSkgewogICAgICAgIG9wZW5BY3Rpb24uZGVzdCA9IHJlc3VsdE9iai5kZXN0OwogICAgICB9IGVsc2UgaWYgKHJlc3VsdE9iai5hY3Rpb24pIHsKICAgICAgICBvcGVuQWN0aW9uLmFjdGlvbiA9IHJlc3VsdE9iai5hY3Rpb247CiAgICAgIH0KICAgIH0gZWxzZSBpZiAoQXJyYXkuaXNBcnJheShvYmopKSB7CiAgICAgIG9wZW5BY3Rpb24uZGVzdCA9IG9iajsKICAgIH0KICAgIHJldHVybiAoMCwgX3V0aWwuc2hhZG93KSh0aGlzLCAib3BlbkFjdGlvbiIsICgwLCBfdXRpbC5vYmplY3RTaXplKShvcGVuQWN0aW9uKSA+IDAgPyBvcGVuQWN0aW9uIDogbnVsbCk7CiAgfQogIGdldCBhdHRhY2htZW50cygpIHsKICAgIGNvbnN0IG9iaiA9IHRoaXMuX2NhdERpY3QuZ2V0KCJOYW1lcyIpOwogICAgbGV0IGF0dGFjaG1lbnRzID0gbnVsbDsKICAgIGlmIChvYmogaW5zdGFuY2VvZiBfcHJpbWl0aXZlcy5EaWN0ICYmIG9iai5oYXMoIkVtYmVkZGVkRmlsZXMiKSkgewogICAgICBjb25zdCBuYW1lVHJlZSA9IG5ldyBfbmFtZV9udW1iZXJfdHJlZS5OYW1lVHJlZShvYmouZ2V0UmF3KCJFbWJlZGRlZEZpbGVzIiksIHRoaXMueHJlZik7CiAgICAgIGZvciAoY29uc3QgW2tleSwgdmFsdWVdIG9mIG5hbWVUcmVlLmdldEFsbCgpKSB7CiAgICAgICAgY29uc3QgZnMgPSBuZXcgX2ZpbGVfc3BlYy5GaWxlU3BlYyh2YWx1ZSwgdGhpcy54cmVmKTsKICAgICAgICBpZiAoIWF0dGFjaG1lbnRzKSB7CiAgICAgICAgICBhdHRhY2htZW50cyA9IE9iamVjdC5jcmVhdGUobnVsbCk7CiAgICAgICAgfQogICAgICAgIGF0dGFjaG1lbnRzWygwLCBfdXRpbC5zdHJpbmdUb1BERlN0cmluZykoa2V5KV0gPSBmcy5zZXJpYWxpemFibGU7CiAgICAgIH0KICAgIH0KICAgIHJldHVybiAoMCwgX3V0aWwuc2hhZG93KSh0aGlzLCAiYXR0YWNobWVudHMiLCBhdHRhY2htZW50cyk7CiAgfQogIGdldCB4ZmFJbWFnZXMoKSB7CiAgICBjb25zdCBvYmogPSB0aGlzLl9jYXREaWN0LmdldCgiTmFtZXMiKTsKICAgIGxldCB4ZmFJbWFnZXMgPSBudWxsOwogICAgaWYgKG9iaiBpbnN0YW5jZW9mIF9wcmltaXRpdmVzLkRpY3QgJiYgb2JqLmhhcygiWEZBSW1hZ2VzIikpIHsKICAgICAgY29uc3QgbmFtZVRyZWUgPSBuZXcgX25hbWVfbnVtYmVyX3RyZWUuTmFtZVRyZWUob2JqLmdldFJhdygiWEZBSW1hZ2VzIiksIHRoaXMueHJlZik7CiAgICAgIGZvciAoY29uc3QgW2tleSwgdmFsdWVdIG9mIG5hbWVUcmVlLmdldEFsbCgpKSB7CiAgICAgICAgaWYgKCF4ZmFJbWFnZXMpIHsKICAgICAgICAgIHhmYUltYWdlcyA9IG5ldyBfcHJpbWl0aXZlcy5EaWN0KHRoaXMueHJlZik7CiAgICAgICAgfQogICAgICAgIHhmYUltYWdlcy5zZXQoKDAsIF91dGlsLnN0cmluZ1RvUERGU3RyaW5nKShrZXkpLCB2YWx1ZSk7CiAgICAgIH0KICAgIH0KICAgIHJldHVybiAoMCwgX3V0aWwuc2hhZG93KSh0aGlzLCAieGZhSW1hZ2VzIiwgeGZhSW1hZ2VzKTsKICB9CiAgX2NvbGxlY3RKYXZhU2NyaXB0KCkgewogICAgY29uc3Qgb2JqID0gdGhpcy5fY2F0RGljdC5nZXQoIk5hbWVzIik7CiAgICBsZXQgamF2YVNjcmlwdCA9IG51bGw7CiAgICBmdW5jdGlvbiBhcHBlbmRJZkphdmFTY3JpcHREaWN0KG5hbWUsIGpzRGljdCkgewogICAgICBpZiAoIShqc0RpY3QgaW5zdGFuY2VvZiBfcHJpbWl0aXZlcy5EaWN0KSkgewogICAgICAgIHJldHVybjsKICAgICAgfQogICAgICBpZiAoISgwLCBfcHJpbWl0aXZlcy5pc05hbWUpKGpzRGljdC5nZXQoIlMiKSwgIkphdmFTY3JpcHQiKSkgewogICAgICAgIHJldHVybjsKICAgICAgfQogICAgICBsZXQganMgPSBqc0RpY3QuZ2V0KCJKUyIpOwogICAgICBpZiAoanMgaW5zdGFuY2VvZiBfYmFzZV9zdHJlYW0uQmFzZVN0cmVhbSkgewogICAgICAgIGpzID0ganMuZ2V0U3RyaW5nKCk7CiAgICAgIH0gZWxzZSBpZiAodHlwZW9mIGpzICE9PSAic3RyaW5nIikgewogICAgICAgIHJldHVybjsKICAgICAgfQogICAgICBqcyA9ICgwLCBfdXRpbC5zdHJpbmdUb1BERlN0cmluZykoanMpLnJlcGxhY2VBbGwoIlx4MDAiLCAiIik7CiAgICAgIGlmIChqcykgewogICAgICAgIChqYXZhU2NyaXB0IHx8PSBuZXcgTWFwKCkpLnNldChuYW1lLCBqcyk7CiAgICAgIH0KICAgIH0KICAgIGlmIChvYmogaW5zdGFuY2VvZiBfcHJpbWl0aXZlcy5EaWN0ICYmIG9iai5oYXMoIkphdmFTY3JpcHQiKSkgewogICAgICBjb25zdCBuYW1lVHJlZSA9IG5ldyBfbmFtZV9udW1iZXJfdHJlZS5OYW1lVHJlZShvYmouZ2V0UmF3KCJKYXZhU2NyaXB0IiksIHRoaXMueHJlZik7CiAgICAgIGZvciAoY29uc3QgW2tleSwgdmFsdWVdIG9mIG5hbWVUcmVlLmdldEFsbCgpKSB7CiAgICAgICAgYXBwZW5kSWZKYXZhU2NyaXB0RGljdCgoMCwgX3V0aWwuc3RyaW5nVG9QREZTdHJpbmcpKGtleSksIHZhbHVlKTsKICAgICAgfQogICAgfQogICAgY29uc3Qgb3BlbkFjdGlvbiA9IHRoaXMuX2NhdERpY3QuZ2V0KCJPcGVuQWN0aW9uIik7CiAgICBpZiAob3BlbkFjdGlvbikgewogICAgICBhcHBlbmRJZkphdmFTY3JpcHREaWN0KCJPcGVuQWN0aW9uIiwgb3BlbkFjdGlvbik7CiAgICB9CiAgICByZXR1cm4gamF2YVNjcmlwdDsKICB9CiAgZ2V0IGpzQWN0aW9ucygpIHsKICAgIGNvbnN0IGphdmFTY3JpcHQgPSB0aGlzLl9jb2xsZWN0SmF2YVNjcmlwdCgpOwogICAgbGV0IGFjdGlvbnMgPSAoMCwgX2NvcmVfdXRpbHMuY29sbGVjdEFjdGlvbnMpKHRoaXMueHJlZiwgdGhpcy5fY2F0RGljdCwgX3V0aWwuRG9jdW1lbnRBY3Rpb25FdmVudFR5cGUpOwogICAgaWYgKGphdmFTY3JpcHQpIHsKICAgICAgYWN0aW9ucyB8fD0gT2JqZWN0LmNyZWF0ZShudWxsKTsKICAgICAgZm9yIChjb25zdCBba2V5LCB2YWxdIG9mIGphdmFTY3JpcHQpIHsKICAgICAgICBpZiAoa2V5IGluIGFjdGlvbnMpIHsKICAgICAgICAgIGFjdGlvbnNba2V5XS5wdXNoKHZhbCk7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIGFjdGlvbnNba2V5XSA9IFt2YWxdOwogICAgICAgIH0KICAgICAgfQogICAgfQogICAgcmV0dXJuICgwLCBfdXRpbC5zaGFkb3cpKHRoaXMsICJqc0FjdGlvbnMiLCBhY3Rpb25zKTsKICB9CiAgYXN5bmMgZm9udEZhbGxiYWNrKGlkLCBoYW5kbGVyKSB7CiAgICBjb25zdCB0cmFuc2xhdGVkRm9udHMgPSBhd2FpdCBQcm9taXNlLmFsbCh0aGlzLmZvbnRDYWNoZSk7CiAgICBmb3IgKGNvbnN0IHRyYW5zbGF0ZWRGb250IG9mIHRyYW5zbGF0ZWRGb250cykgewogICAgICBpZiAodHJhbnNsYXRlZEZvbnQubG9hZGVkTmFtZSA9PT0gaWQpIHsKICAgICAgICB0cmFuc2xhdGVkRm9udC5mYWxsYmFjayhoYW5kbGVyKTsKICAgICAgICByZXR1cm47CiAgICAgIH0KICAgIH0KICB9CiAgYXN5bmMgY2xlYW51cChtYW51YWxseVRyaWdnZXJlZCA9IGZhbHNlKSB7CiAgICAoMCwgX2NsZWFudXBfaGVscGVyLmNsZWFyR2xvYmFsQ2FjaGVzKSgpOwogICAgdGhpcy5nbG9iYWxJbWFnZUNhY2hlLmNsZWFyKG1hbnVhbGx5VHJpZ2dlcmVkKTsKICAgIHRoaXMucGFnZUtpZHNDb3VudENhY2hlLmNsZWFyKCk7CiAgICB0aGlzLnBhZ2VJbmRleENhY2hlLmNsZWFyKCk7CiAgICB0aGlzLm5vbkJsZW5kTW9kZXNTZXQuY2xlYXIoKTsKICAgIGNvbnN0IHRyYW5zbGF0ZWRGb250cyA9IGF3YWl0IFByb21pc2UuYWxsKHRoaXMuZm9udENhY2hlKTsKICAgIGZvciAoY29uc3QgewogICAgICBkaWN0CiAgICB9IG9mIHRyYW5zbGF0ZWRGb250cykgewogICAgICBkZWxldGUgZGljdC5jYWNoZUtleTsKICAgIH0KICAgIHRoaXMuZm9udENhY2hlLmNsZWFyKCk7CiAgICB0aGlzLmJ1aWx0SW5DTWFwQ2FjaGUuY2xlYXIoKTsKICAgIHRoaXMuc3RhbmRhcmRGb250RGF0YUNhY2hlLmNsZWFyKCk7CiAgICB0aGlzLnN5c3RlbUZvbnRDYWNoZS5jbGVhcigpOwogIH0KICBhc3luYyBnZXRQYWdlRGljdChwYWdlSW5kZXgpIHsKICAgIGNvbnN0IG5vZGVzVG9WaXNpdCA9IFt0aGlzLnRvcGxldmVsUGFnZXNEaWN0XTsKICAgIGNvbnN0IHZpc2l0ZWROb2RlcyA9IG5ldyBfcHJpbWl0aXZlcy5SZWZTZXQoKTsKICAgIGNvbnN0IHBhZ2VzUmVmID0gdGhpcy5fY2F0RGljdC5nZXRSYXcoIlBhZ2VzIik7CiAgICBpZiAocGFnZXNSZWYgaW5zdGFuY2VvZiBfcHJpbWl0aXZlcy5SZWYpIHsKICAgICAgdmlzaXRlZE5vZGVzLnB1dChwYWdlc1JlZik7CiAgICB9CiAgICBjb25zdCB4cmVmID0gdGhpcy54cmVmLAogICAgICBwYWdlS2lkc0NvdW50Q2FjaGUgPSB0aGlzLnBhZ2VLaWRzQ291bnRDYWNoZSwKICAgICAgcGFnZUluZGV4Q2FjaGUgPSB0aGlzLnBhZ2VJbmRleENhY2hlOwogICAgbGV0IGN1cnJlbnRQYWdlSW5kZXggPSAwOwogICAgd2hpbGUgKG5vZGVzVG9WaXNpdC5sZW5ndGgpIHsKICAgICAgY29uc3QgY3VycmVudE5vZGUgPSBub2Rlc1RvVmlzaXQucG9wKCk7CiAgICAgIGlmIChjdXJyZW50Tm9kZSBpbnN0YW5jZW9mIF9wcmltaXRpdmVzLlJlZikgewogICAgICAgIGNvbnN0IGNvdW50ID0gcGFnZUtpZHNDb3VudENhY2hlLmdldChjdXJyZW50Tm9kZSk7CiAgICAgICAgaWYgKGNvdW50ID49IDAgJiYgY3VycmVudFBhZ2VJbmRleCArIGNvdW50IDw9IHBhZ2VJbmRleCkgewogICAgICAgICAgY3VycmVudFBhZ2VJbmRleCArPSBjb3VudDsKICAgICAgICAgIGNvbnRpbnVlOwogICAgICAgIH0KICAgICAgICBpZiAodmlzaXRlZE5vZGVzLmhhcyhjdXJyZW50Tm9kZSkpIHsKICAgICAgICAgIHRocm93IG5ldyBfdXRpbC5Gb3JtYXRFcnJvcigiUGFnZXMgdHJlZSBjb250YWlucyBjaXJjdWxhciByZWZlcmVuY2UuIik7CiAgICAgICAgfQogICAgICAgIHZpc2l0ZWROb2Rlcy5wdXQoY3VycmVudE5vZGUpOwogICAgICAgIGNvbnN0IG9iaiA9IGF3YWl0IHhyZWYuZmV0Y2hBc3luYyhjdXJyZW50Tm9kZSk7CiAgICAgICAgaWYgKG9iaiBpbnN0YW5jZW9mIF9wcmltaXRpdmVzLkRpY3QpIHsKICAgICAgICAgIGxldCB0eXBlID0gb2JqLmdldFJhdygiVHlwZSIpOwogICAgICAgICAgaWYgKHR5cGUgaW5zdGFuY2VvZiBfcHJpbWl0aXZlcy5SZWYpIHsKICAgICAgICAgICAgdHlwZSA9IGF3YWl0IHhyZWYuZmV0Y2hBc3luYyh0eXBlKTsKICAgICAgICAgIH0KICAgICAgICAgIGlmICgoMCwgX3ByaW1pdGl2ZXMuaXNOYW1lKSh0eXBlLCAiUGFnZSIpIHx8ICFvYmouaGFzKCJLaWRzIikpIHsKICAgICAgICAgICAgaWYgKCFwYWdlS2lkc0NvdW50Q2FjaGUuaGFzKGN1cnJlbnROb2RlKSkgewogICAgICAgICAgICAgIHBhZ2VLaWRzQ291bnRDYWNoZS5wdXQoY3VycmVudE5vZGUsIDEpOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGlmICghcGFnZUluZGV4Q2FjaGUuaGFzKGN1cnJlbnROb2RlKSkgewogICAgICAgICAgICAgIHBhZ2VJbmRleENhY2hlLnB1dChjdXJyZW50Tm9kZSwgY3VycmVudFBhZ2VJbmRleCk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgaWYgKGN1cnJlbnRQYWdlSW5kZXggPT09IHBhZ2VJbmRleCkgewogICAgICAgICAgICAgIHJldHVybiBbb2JqLCBjdXJyZW50Tm9kZV07CiAgICAgICAgICAgIH0KICAgICAgICAgICAgY3VycmVudFBhZ2VJbmRleCsrOwogICAgICAgICAgICBjb250aW51ZTsKICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgbm9kZXNUb1Zpc2l0LnB1c2gob2JqKTsKICAgICAgICBjb250aW51ZTsKICAgICAgfQogICAgICBpZiAoIShjdXJyZW50Tm9kZSBpbnN0YW5jZW9mIF9wcmltaXRpdmVzLkRpY3QpKSB7CiAgICAgICAgdGhyb3cgbmV3IF91dGlsLkZvcm1hdEVycm9yKCJQYWdlIGRpY3Rpb25hcnkga2lkIHJlZmVyZW5jZSBwb2ludHMgdG8gd3JvbmcgdHlwZSBvZiBvYmplY3QuIik7CiAgICAgIH0KICAgICAgY29uc3QgewogICAgICAgIG9iaklkCiAgICAgIH0gPSBjdXJyZW50Tm9kZTsKICAgICAgbGV0IGNvdW50ID0gY3VycmVudE5vZGUuZ2V0UmF3KCJDb3VudCIpOwogICAgICBpZiAoY291bnQgaW5zdGFuY2VvZiBfcHJpbWl0aXZlcy5SZWYpIHsKICAgICAgICBjb3VudCA9IGF3YWl0IHhyZWYuZmV0Y2hBc3luYyhjb3VudCk7CiAgICAgIH0KICAgICAgaWYgKE51bWJlci5pc0ludGVnZXIoY291bnQpICYmIGNvdW50ID49IDApIHsKICAgICAgICBpZiAob2JqSWQgJiYgIXBhZ2VLaWRzQ291bnRDYWNoZS5oYXMob2JqSWQpKSB7CiAgICAgICAgICBwYWdlS2lkc0NvdW50Q2FjaGUucHV0KG9iaklkLCBjb3VudCk7CiAgICAgICAgfQogICAgICAgIGlmIChjdXJyZW50UGFnZUluZGV4ICsgY291bnQgPD0gcGFnZUluZGV4KSB7CiAgICAgICAgICBjdXJyZW50UGFnZUluZGV4ICs9IGNvdW50OwogICAgICAgICAgY29udGludWU7CiAgICAgICAgfQogICAgICB9CiAgICAgIGxldCBraWRzID0gY3VycmVudE5vZGUuZ2V0UmF3KCJLaWRzIik7CiAgICAgIGlmIChraWRzIGluc3RhbmNlb2YgX3ByaW1pdGl2ZXMuUmVmKSB7CiAgICAgICAga2lkcyA9IGF3YWl0IHhyZWYuZmV0Y2hBc3luYyhraWRzKTsKICAgICAgfQogICAgICBpZiAoIUFycmF5LmlzQXJyYXkoa2lkcykpIHsKICAgICAgICBsZXQgdHlwZSA9IGN1cnJlbnROb2RlLmdldFJhdygiVHlwZSIpOwogICAgICAgIGlmICh0eXBlIGluc3RhbmNlb2YgX3ByaW1pdGl2ZXMuUmVmKSB7CiAgICAgICAgICB0eXBlID0gYXdhaXQgeHJlZi5mZXRjaEFzeW5jKHR5cGUpOwogICAgICAgIH0KICAgICAgICBpZiAoKDAsIF9wcmltaXRpdmVzLmlzTmFtZSkodHlwZSwgIlBhZ2UiKSB8fCAhY3VycmVudE5vZGUuaGFzKCJLaWRzIikpIHsKICAgICAgICAgIGlmIChjdXJyZW50UGFnZUluZGV4ID09PSBwYWdlSW5kZXgpIHsKICAgICAgICAgICAgcmV0dXJuIFtjdXJyZW50Tm9kZSwgbnVsbF07CiAgICAgICAgICB9CiAgICAgICAgICBjdXJyZW50UGFnZUluZGV4Kys7CiAgICAgICAgICBjb250aW51ZTsKICAgICAgICB9CiAgICAgICAgdGhyb3cgbmV3IF91dGlsLkZvcm1hdEVycm9yKCJQYWdlIGRpY3Rpb25hcnkga2lkcyBvYmplY3QgaXMgbm90IGFuIGFycmF5LiIpOwogICAgICB9CiAgICAgIGZvciAobGV0IGxhc3QgPSBraWRzLmxlbmd0aCAtIDE7IGxhc3QgPj0gMDsgbGFzdC0tKSB7CiAgICAgICAgbm9kZXNUb1Zpc2l0LnB1c2goa2lkc1tsYXN0XSk7CiAgICAgIH0KICAgIH0KICAgIHRocm93IG5ldyBFcnJvcihgUGFnZSBpbmRleCAke3BhZ2VJbmRleH0gbm90IGZvdW5kLmApOwogIH0KICBhc3luYyBnZXRBbGxQYWdlRGljdHMocmVjb3ZlcnlNb2RlID0gZmFsc2UpIHsKICAgIGNvbnN0IHsKICAgICAgaWdub3JlRXJyb3JzCiAgICB9ID0gdGhpcy5wZGZNYW5hZ2VyLmV2YWx1YXRvck9wdGlvbnM7CiAgICBjb25zdCBxdWV1ZSA9IFt7CiAgICAgIGN1cnJlbnROb2RlOiB0aGlzLnRvcGxldmVsUGFnZXNEaWN0LAogICAgICBwb3NJbktpZHM6IDAKICAgIH1dOwogICAgY29uc3QgdmlzaXRlZE5vZGVzID0gbmV3IF9wcmltaXRpdmVzLlJlZlNldCgpOwogICAgY29uc3QgcGFnZXNSZWYgPSB0aGlzLl9jYXREaWN0LmdldFJhdygiUGFnZXMiKTsKICAgIGlmIChwYWdlc1JlZiBpbnN0YW5jZW9mIF9wcmltaXRpdmVzLlJlZikgewogICAgICB2aXNpdGVkTm9kZXMucHV0KHBhZ2VzUmVmKTsKICAgIH0KICAgIGNvbnN0IG1hcCA9IG5ldyBNYXAoKSwKICAgICAgeHJlZiA9IHRoaXMueHJlZiwKICAgICAgcGFnZUluZGV4Q2FjaGUgPSB0aGlzLnBhZ2VJbmRleENhY2hlOwogICAgbGV0IHBhZ2VJbmRleCA9IDA7CiAgICBmdW5jdGlvbiBhZGRQYWdlRGljdChwYWdlRGljdCwgcGFnZVJlZikgewogICAgICBpZiAocGFnZVJlZiAmJiAhcGFnZUluZGV4Q2FjaGUuaGFzKHBhZ2VSZWYpKSB7CiAgICAgICAgcGFnZUluZGV4Q2FjaGUucHV0KHBhZ2VSZWYsIHBhZ2VJbmRleCk7CiAgICAgIH0KICAgICAgbWFwLnNldChwYWdlSW5kZXgrKywgW3BhZ2VEaWN0LCBwYWdlUmVmXSk7CiAgICB9CiAgICBmdW5jdGlvbiBhZGRQYWdlRXJyb3IoZXJyb3IpIHsKICAgICAgaWYgKGVycm9yIGluc3RhbmNlb2YgX2NvcmVfdXRpbHMuWFJlZkVudHJ5RXhjZXB0aW9uICYmICFyZWNvdmVyeU1vZGUpIHsKICAgICAgICB0aHJvdyBlcnJvcjsKICAgICAgfQogICAgICBpZiAocmVjb3ZlcnlNb2RlICYmIGlnbm9yZUVycm9ycyAmJiBwYWdlSW5kZXggPT09IDApIHsKICAgICAgICAoMCwgX3V0aWwud2FybikoYGdldEFsbFBhZ2VEaWN0cyAtIFNraXBwaW5nIGludmFsaWQgZmlyc3QgcGFnZTogIiR7ZXJyb3J9Ii5gKTsKICAgICAgICBlcnJvciA9IF9wcmltaXRpdmVzLkRpY3QuZW1wdHk7CiAgICAgIH0KICAgICAgbWFwLnNldChwYWdlSW5kZXgrKywgW2Vycm9yLCBudWxsXSk7CiAgICB9CiAgICB3aGlsZSAocXVldWUubGVuZ3RoID4gMCkgewogICAgICBjb25zdCBxdWV1ZUl0ZW0gPSBxdWV1ZS5hdCgtMSk7CiAgICAgIGNvbnN0IHsKICAgICAgICBjdXJyZW50Tm9kZSwKICAgICAgICBwb3NJbktpZHMKICAgICAgfSA9IHF1ZXVlSXRlbTsKICAgICAgbGV0IGtpZHMgPSBjdXJyZW50Tm9kZS5nZXRSYXcoIktpZHMiKTsKICAgICAgaWYgKGtpZHMgaW5zdGFuY2VvZiBfcHJpbWl0aXZlcy5SZWYpIHsKICAgICAgICB0cnkgewogICAgICAgICAga2lkcyA9IGF3YWl0IHhyZWYuZmV0Y2hBc3luYyhraWRzKTsKICAgICAgICB9IGNhdGNoIChleCkgewogICAgICAgICAgYWRkUGFnZUVycm9yKGV4KTsKICAgICAgICAgIGJyZWFrOwogICAgICAgIH0KICAgICAgfQogICAgICBpZiAoIUFycmF5LmlzQXJyYXkoa2lkcykpIHsKICAgICAgICBhZGRQYWdlRXJyb3IobmV3IF91dGlsLkZvcm1hdEVycm9yKCJQYWdlIGRpY3Rpb25hcnkga2lkcyBvYmplY3QgaXMgbm90IGFuIGFycmF5LiIpKTsKICAgICAgICBicmVhazsKICAgICAgfQogICAgICBpZiAocG9zSW5LaWRzID49IGtpZHMubGVuZ3RoKSB7CiAgICAgICAgcXVldWUucG9wKCk7CiAgICAgICAgY29udGludWU7CiAgICAgIH0KICAgICAgY29uc3Qga2lkT2JqID0ga2lkc1twb3NJbktpZHNdOwogICAgICBsZXQgb2JqOwogICAgICBpZiAoa2lkT2JqIGluc3RhbmNlb2YgX3ByaW1pdGl2ZXMuUmVmKSB7CiAgICAgICAgaWYgKHZpc2l0ZWROb2Rlcy5oYXMoa2lkT2JqKSkgewogICAgICAgICAgYWRkUGFnZUVycm9yKG5ldyBfdXRpbC5Gb3JtYXRFcnJvcigiUGFnZXMgdHJlZSBjb250YWlucyBjaXJjdWxhciByZWZlcmVuY2UuIikpOwogICAgICAgICAgYnJlYWs7CiAgICAgICAgfQogICAgICAgIHZpc2l0ZWROb2Rlcy5wdXQoa2lkT2JqKTsKICAgICAgICB0cnkgewogICAgICAgICAgb2JqID0gYXdhaXQgeHJlZi5mZXRjaEFzeW5jKGtpZE9iaik7CiAgICAgICAgfSBjYXRjaCAoZXgpIHsKICAgICAgICAgIGFkZFBhZ2VFcnJvcihleCk7CiAgICAgICAgICBicmVhazsKICAgICAgICB9CiAgICAgIH0gZWxzZSB7CiAgICAgICAgb2JqID0ga2lkT2JqOwogICAgICB9CiAgICAgIGlmICghKG9iaiBpbnN0YW5jZW9mIF9wcmltaXRpdmVzLkRpY3QpKSB7CiAgICAgICAgYWRkUGFnZUVycm9yKG5ldyBfdXRpbC5Gb3JtYXRFcnJvcigiUGFnZSBkaWN0aW9uYXJ5IGtpZCByZWZlcmVuY2UgcG9pbnRzIHRvIHdyb25nIHR5cGUgb2Ygb2JqZWN0LiIpKTsKICAgICAgICBicmVhazsKICAgICAgfQogICAgICBsZXQgdHlwZSA9IG9iai5nZXRSYXcoIlR5cGUiKTsKICAgICAgaWYgKHR5cGUgaW5zdGFuY2VvZiBfcHJpbWl0aXZlcy5SZWYpIHsKICAgICAgICB0cnkgewogICAgICAgICAgdHlwZSA9IGF3YWl0IHhyZWYuZmV0Y2hBc3luYyh0eXBlKTsKICAgICAgICB9IGNhdGNoIChleCkgewogICAgICAgICAgYWRkUGFnZUVycm9yKGV4KTsKICAgICAgICAgIGJyZWFrOwogICAgICAgIH0KICAgICAgfQogICAgICBpZiAoKDAsIF9wcmltaXRpdmVzLmlzTmFtZSkodHlwZSwgIlBhZ2UiKSB8fCAhb2JqLmhhcygiS2lkcyIpKSB7CiAgICAgICAgYWRkUGFnZURpY3Qob2JqLCBraWRPYmogaW5zdGFuY2VvZiBfcHJpbWl0aXZlcy5SZWYgPyBraWRPYmogOiBudWxsKTsKICAgICAgfSBlbHNlIHsKICAgICAgICBxdWV1ZS5wdXNoKHsKICAgICAgICAgIGN1cnJlbnROb2RlOiBvYmosCiAgICAgICAgICBwb3NJbktpZHM6IDAKICAgICAgICB9KTsKICAgICAgfQogICAgICBxdWV1ZUl0ZW0ucG9zSW5LaWRzKys7CiAgICB9CiAgICByZXR1cm4gbWFwOwogIH0KICBnZXRQYWdlSW5kZXgocGFnZVJlZikgewogICAgY29uc3QgY2FjaGVkUGFnZUluZGV4ID0gdGhpcy5wYWdlSW5kZXhDYWNoZS5nZXQocGFnZVJlZik7CiAgICBpZiAoY2FjaGVkUGFnZUluZGV4ICE9PSB1bmRlZmluZWQpIHsKICAgICAgcmV0dXJuIFByb21pc2UucmVzb2x2ZShjYWNoZWRQYWdlSW5kZXgpOwogICAgfQogICAgY29uc3QgeHJlZiA9IHRoaXMueHJlZjsKICAgIGZ1bmN0aW9uIHBhZ2VzQmVmb3JlUmVmKGtpZFJlZikgewogICAgICBsZXQgdG90YWwgPSAwLAogICAgICAgIHBhcmVudFJlZjsKICAgICAgcmV0dXJuIHhyZWYuZmV0Y2hBc3luYyhraWRSZWYpLnRoZW4oZnVuY3Rpb24gKG5vZGUpIHsKICAgICAgICBpZiAoKDAsIF9wcmltaXRpdmVzLmlzUmVmc0VxdWFsKShraWRSZWYsIHBhZ2VSZWYpICYmICEoMCwgX3ByaW1pdGl2ZXMuaXNEaWN0KShub2RlLCAiUGFnZSIpICYmICEobm9kZSBpbnN0YW5jZW9mIF9wcmltaXRpdmVzLkRpY3QgJiYgIW5vZGUuaGFzKCJUeXBlIikgJiYgbm9kZS5oYXMoIkNvbnRlbnRzIikpKSB7CiAgICAgICAgICB0aHJvdyBuZXcgX3V0aWwuRm9ybWF0RXJyb3IoIlRoZSByZWZlcmVuY2UgZG9lcyBub3QgcG9pbnQgdG8gYSAvUGFnZSBkaWN0aW9uYXJ5LiIpOwogICAgICAgIH0KICAgICAgICBpZiAoIW5vZGUpIHsKICAgICAgICAgIHJldHVybiBudWxsOwogICAgICAgIH0KICAgICAgICBpZiAoIShub2RlIGluc3RhbmNlb2YgX3ByaW1pdGl2ZXMuRGljdCkpIHsKICAgICAgICAgIHRocm93IG5ldyBfdXRpbC5Gb3JtYXRFcnJvcigiTm9kZSBtdXN0IGJlIGEgZGljdGlvbmFyeS4iKTsKICAgICAgICB9CiAgICAgICAgcGFyZW50UmVmID0gbm9kZS5nZXRSYXcoIlBhcmVudCIpOwogICAgICAgIHJldHVybiBub2RlLmdldEFzeW5jKCJQYXJlbnQiKTsKICAgICAgfSkudGhlbihmdW5jdGlvbiAocGFyZW50KSB7CiAgICAgICAgaWYgKCFwYXJlbnQpIHsKICAgICAgICAgIHJldHVybiBudWxsOwogICAgICAgIH0KICAgICAgICBpZiAoIShwYXJlbnQgaW5zdGFuY2VvZiBfcHJpbWl0aXZlcy5EaWN0KSkgewogICAgICAgICAgdGhyb3cgbmV3IF91dGlsLkZvcm1hdEVycm9yKCJQYXJlbnQgbXVzdCBiZSBhIGRpY3Rpb25hcnkuIik7CiAgICAgICAgfQogICAgICAgIHJldHVybiBwYXJlbnQuZ2V0QXN5bmMoIktpZHMiKTsKICAgICAgfSkudGhlbihmdW5jdGlvbiAoa2lkcykgewogICAgICAgIGlmICgha2lkcykgewogICAgICAgICAgcmV0dXJuIG51bGw7CiAgICAgICAgfQogICAgICAgIGNvbnN0IGtpZFByb21pc2VzID0gW107CiAgICAgICAgbGV0IGZvdW5kID0gZmFsc2U7CiAgICAgICAgZm9yIChjb25zdCBraWQgb2Yga2lkcykgewogICAgICAgICAgaWYgKCEoa2lkIGluc3RhbmNlb2YgX3ByaW1pdGl2ZXMuUmVmKSkgewogICAgICAgICAgICB0aHJvdyBuZXcgX3V0aWwuRm9ybWF0RXJyb3IoIktpZCBtdXN0IGJlIGEgcmVmZXJlbmNlLiIpOwogICAgICAgICAgfQogICAgICAgICAgaWYgKCgwLCBfcHJpbWl0aXZlcy5pc1JlZnNFcXVhbCkoa2lkLCBraWRSZWYpKSB7CiAgICAgICAgICAgIGZvdW5kID0gdHJ1ZTsKICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICB9CiAgICAgICAgICBraWRQcm9taXNlcy5wdXNoKHhyZWYuZmV0Y2hBc3luYyhraWQpLnRoZW4oZnVuY3Rpb24gKG9iaikgewogICAgICAgICAgICBpZiAoIShvYmogaW5zdGFuY2VvZiBfcHJpbWl0aXZlcy5EaWN0KSkgewogICAgICAgICAgICAgIHRocm93IG5ldyBfdXRpbC5Gb3JtYXRFcnJvcigiS2lkIG5vZGUgbXVzdCBiZSBhIGRpY3Rpb25hcnkuIik7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgaWYgKG9iai5oYXMoIkNvdW50IikpIHsKICAgICAgICAgICAgICB0b3RhbCArPSBvYmouZ2V0KCJDb3VudCIpOwogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgIHRvdGFsKys7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0pKTsKICAgICAgICB9CiAgICAgICAgaWYgKCFmb3VuZCkgewogICAgICAgICAgdGhyb3cgbmV3IF91dGlsLkZvcm1hdEVycm9yKCJLaWQgcmVmZXJlbmNlIG5vdCBmb3VuZCBpbiBwYXJlbnQncyBraWRzLiIpOwogICAgICAgIH0KICAgICAgICByZXR1cm4gUHJvbWlzZS5hbGwoa2lkUHJvbWlzZXMpLnRoZW4oZnVuY3Rpb24gKCkgewogICAgICAgICAgcmV0dXJuIFt0b3RhbCwgcGFyZW50UmVmXTsKICAgICAgICB9KTsKICAgICAgfSk7CiAgICB9CiAgICBsZXQgdG90YWwgPSAwOwogICAgY29uc3QgbmV4dCA9IHJlZiA9PiBwYWdlc0JlZm9yZVJlZihyZWYpLnRoZW4oYXJncyA9PiB7CiAgICAgIGlmICghYXJncykgewogICAgICAgIHRoaXMucGFnZUluZGV4Q2FjaGUucHV0KHBhZ2VSZWYsIHRvdGFsKTsKICAgICAgICByZXR1cm4gdG90YWw7CiAgICAgIH0KICAgICAgY29uc3QgW2NvdW50LCBwYXJlbnRSZWZdID0gYXJnczsKICAgICAgdG90YWwgKz0gY291bnQ7CiAgICAgIHJldHVybiBuZXh0KHBhcmVudFJlZik7CiAgICB9KTsKICAgIHJldHVybiBuZXh0KHBhZ2VSZWYpOwogIH0KICBnZXQgYmFzZVVybCgpIHsKICAgIGNvbnN0IHVyaSA9IHRoaXMuX2NhdERpY3QuZ2V0KCJVUkkiKTsKICAgIGlmICh1cmkgaW5zdGFuY2VvZiBfcHJpbWl0aXZlcy5EaWN0KSB7CiAgICAgIGNvbnN0IGJhc2UgPSB1cmkuZ2V0KCJCYXNlIik7CiAgICAgIGlmICh0eXBlb2YgYmFzZSA9PT0gInN0cmluZyIpIHsKICAgICAgICBjb25zdCBhYnNvbHV0ZVVybCA9ICgwLCBfdXRpbC5jcmVhdGVWYWxpZEFic29sdXRlVXJsKShiYXNlLCBudWxsLCB7CiAgICAgICAgICB0cnlDb252ZXJ0RW5jb2Rpbmc6IHRydWUKICAgICAgICB9KTsKICAgICAgICBpZiAoYWJzb2x1dGVVcmwpIHsKICAgICAgICAgIHJldHVybiAoMCwgX3V0aWwuc2hhZG93KSh0aGlzLCAiYmFzZVVybCIsIGFic29sdXRlVXJsLmhyZWYpOwogICAgICAgIH0KICAgICAgfQogICAgfQogICAgcmV0dXJuICgwLCBfdXRpbC5zaGFkb3cpKHRoaXMsICJiYXNlVXJsIiwgdGhpcy5wZGZNYW5hZ2VyLmRvY0Jhc2VVcmwpOwogIH0KICBzdGF0aWMgcGFyc2VEZXN0RGljdGlvbmFyeSh7CiAgICBkZXN0RGljdCwKICAgIHJlc3VsdE9iaiwKICAgIGRvY0Jhc2VVcmwgPSBudWxsLAogICAgZG9jQXR0YWNobWVudHMgPSBudWxsCiAgfSkgewogICAgaWYgKCEoZGVzdERpY3QgaW5zdGFuY2VvZiBfcHJpbWl0aXZlcy5EaWN0KSkgewogICAgICAoMCwgX3V0aWwud2FybikoInBhcnNlRGVzdERpY3Rpb25hcnk6IGBkZXN0RGljdGAgbXVzdCBiZSBhIGRpY3Rpb25hcnkuIik7CiAgICAgIHJldHVybjsKICAgIH0KICAgIGxldCBhY3Rpb24gPSBkZXN0RGljdC5nZXQoIkEiKSwKICAgICAgdXJsLAogICAgICBkZXN0OwogICAgaWYgKCEoYWN0aW9uIGluc3RhbmNlb2YgX3ByaW1pdGl2ZXMuRGljdCkpIHsKICAgICAgaWYgKGRlc3REaWN0LmhhcygiRGVzdCIpKSB7CiAgICAgICAgYWN0aW9uID0gZGVzdERpY3QuZ2V0KCJEZXN0Iik7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgYWN0aW9uID0gZGVzdERpY3QuZ2V0KCJBQSIpOwogICAgICAgIGlmIChhY3Rpb24gaW5zdGFuY2VvZiBfcHJpbWl0aXZlcy5EaWN0KSB7CiAgICAgICAgICBpZiAoYWN0aW9uLmhhcygiRCIpKSB7CiAgICAgICAgICAgIGFjdGlvbiA9IGFjdGlvbi5nZXQoIkQiKTsKICAgICAgICAgIH0gZWxzZSBpZiAoYWN0aW9uLmhhcygiVSIpKSB7CiAgICAgICAgICAgIGFjdGlvbiA9IGFjdGlvbi5nZXQoIlUiKTsKICAgICAgICAgIH0KICAgICAgICB9CiAgICAgIH0KICAgIH0KICAgIGlmIChhY3Rpb24gaW5zdGFuY2VvZiBfcHJpbWl0aXZlcy5EaWN0KSB7CiAgICAgIGNvbnN0IGFjdGlvblR5cGUgPSBhY3Rpb24uZ2V0KCJTIik7CiAgICAgIGlmICghKGFjdGlvblR5cGUgaW5zdGFuY2VvZiBfcHJpbWl0aXZlcy5OYW1lKSkgewogICAgICAgICgwLCBfdXRpbC53YXJuKSgicGFyc2VEZXN0RGljdGlvbmFyeTogSW52YWxpZCB0eXBlIGluIEFjdGlvbiBkaWN0aW9uYXJ5LiIpOwogICAgICAgIHJldHVybjsKICAgICAgfQogICAgICBjb25zdCBhY3Rpb25OYW1lID0gYWN0aW9uVHlwZS5uYW1lOwogICAgICBzd2l0Y2ggKGFjdGlvbk5hbWUpIHsKICAgICAgICBjYXNlICJSZXNldEZvcm0iOgogICAgICAgICAgY29uc3QgZmxhZ3MgPSBhY3Rpb24uZ2V0KCJGbGFncyIpOwogICAgICAgICAgY29uc3QgaW5jbHVkZSA9ICgodHlwZW9mIGZsYWdzID09PSAibnVtYmVyIiA/IGZsYWdzIDogMCkgJiAxKSA9PT0gMDsKICAgICAgICAgIGNvbnN0IGZpZWxkcyA9IFtdOwogICAgICAgICAgY29uc3QgcmVmcyA9IFtdOwogICAgICAgICAgZm9yIChjb25zdCBvYmogb2YgYWN0aW9uLmdldCgiRmllbGRzIikgfHwgW10pIHsKICAgICAgICAgICAgaWYgKG9iaiBpbnN0YW5jZW9mIF9wcmltaXRpdmVzLlJlZikgewogICAgICAgICAgICAgIHJlZnMucHVzaChvYmoudG9TdHJpbmcoKSk7CiAgICAgICAgICAgIH0gZWxzZSBpZiAodHlwZW9mIG9iaiA9PT0gInN0cmluZyIpIHsKICAgICAgICAgICAgICBmaWVsZHMucHVzaCgoMCwgX3V0aWwuc3RyaW5nVG9QREZTdHJpbmcpKG9iaikpOwogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgICByZXN1bHRPYmoucmVzZXRGb3JtID0gewogICAgICAgICAgICBmaWVsZHMsCiAgICAgICAgICAgIHJlZnMsCiAgICAgICAgICAgIGluY2x1ZGUKICAgICAgICAgIH07CiAgICAgICAgICBicmVhazsKICAgICAgICBjYXNlICJVUkkiOgogICAgICAgICAgdXJsID0gYWN0aW9uLmdldCgiVVJJIik7CiAgICAgICAgICBpZiAodXJsIGluc3RhbmNlb2YgX3ByaW1pdGl2ZXMuTmFtZSkgewogICAgICAgICAgICB1cmwgPSAiLyIgKyB1cmwubmFtZTsKICAgICAgICAgIH0KICAgICAgICAgIGJyZWFrOwogICAgICAgIGNhc2UgIkdvVG8iOgogICAgICAgICAgZGVzdCA9IGFjdGlvbi5nZXQoIkQiKTsKICAgICAgICAgIGJyZWFrOwogICAgICAgIGNhc2UgIkxhdW5jaCI6CiAgICAgICAgY2FzZSAiR29Ub1IiOgogICAgICAgICAgY29uc3QgdXJsRGljdCA9IGFjdGlvbi5nZXQoIkYiKTsKICAgICAgICAgIGlmICh1cmxEaWN0IGluc3RhbmNlb2YgX3ByaW1pdGl2ZXMuRGljdCkgewogICAgICAgICAgICB1cmwgPSB1cmxEaWN0LmdldCgiRiIpIHx8IG51bGw7CiAgICAgICAgICB9IGVsc2UgaWYgKHR5cGVvZiB1cmxEaWN0ID09PSAic3RyaW5nIikgewogICAgICAgICAgICB1cmwgPSB1cmxEaWN0OwogICAgICAgICAgfQogICAgICAgICAgbGV0IHJlbW90ZURlc3QgPSBhY3Rpb24uZ2V0KCJEIik7CiAgICAgICAgICBpZiAocmVtb3RlRGVzdCkgewogICAgICAgICAgICBpZiAocmVtb3RlRGVzdCBpbnN0YW5jZW9mIF9wcmltaXRpdmVzLk5hbWUpIHsKICAgICAgICAgICAgICByZW1vdGVEZXN0ID0gcmVtb3RlRGVzdC5uYW1lOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGlmICh0eXBlb2YgdXJsID09PSAic3RyaW5nIikgewogICAgICAgICAgICAgIGNvbnN0IGJhc2VVcmwgPSB1cmwuc3BsaXQoIiMiKVswXTsKICAgICAgICAgICAgICBpZiAodHlwZW9mIHJlbW90ZURlc3QgPT09ICJzdHJpbmciKSB7CiAgICAgICAgICAgICAgICB1cmwgPSBiYXNlVXJsICsgIiMiICsgcmVtb3RlRGVzdDsKICAgICAgICAgICAgICB9IGVsc2UgaWYgKEFycmF5LmlzQXJyYXkocmVtb3RlRGVzdCkpIHsKICAgICAgICAgICAgICAgIHVybCA9IGJhc2VVcmwgKyAiIyIgKyBKU09OLnN0cmluZ2lmeShyZW1vdGVEZXN0KTsKICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICAgIGNvbnN0IG5ld1dpbmRvdyA9IGFjdGlvbi5nZXQoIk5ld1dpbmRvdyIpOwogICAgICAgICAgaWYgKHR5cGVvZiBuZXdXaW5kb3cgPT09ICJib29sZWFuIikgewogICAgICAgICAgICByZXN1bHRPYmoubmV3V2luZG93ID0gbmV3V2luZG93OwogICAgICAgICAgfQogICAgICAgICAgYnJlYWs7CiAgICAgICAgY2FzZSAiR29Ub0UiOgogICAgICAgICAgY29uc3QgdGFyZ2V0ID0gYWN0aW9uLmdldCgiVCIpOwogICAgICAgICAgbGV0IGF0dGFjaG1lbnQ7CiAgICAgICAgICBpZiAoZG9jQXR0YWNobWVudHMgJiYgdGFyZ2V0IGluc3RhbmNlb2YgX3ByaW1pdGl2ZXMuRGljdCkgewogICAgICAgICAgICBjb25zdCByZWxhdGlvbnNoaXAgPSB0YXJnZXQuZ2V0KCJSIik7CiAgICAgICAgICAgIGNvbnN0IG5hbWUgPSB0YXJnZXQuZ2V0KCJOIik7CiAgICAgICAgICAgIGlmICgoMCwgX3ByaW1pdGl2ZXMuaXNOYW1lKShyZWxhdGlvbnNoaXAsICJDIikgJiYgdHlwZW9mIG5hbWUgPT09ICJzdHJpbmciKSB7CiAgICAgICAgICAgICAgYXR0YWNobWVudCA9IGRvY0F0dGFjaG1lbnRzWygwLCBfdXRpbC5zdHJpbmdUb1BERlN0cmluZykobmFtZSldOwogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgICBpZiAoYXR0YWNobWVudCkgewogICAgICAgICAgICByZXN1bHRPYmouYXR0YWNobWVudCA9IGF0dGFjaG1lbnQ7CiAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAoMCwgX3V0aWwud2FybikoYHBhcnNlRGVzdERpY3Rpb25hcnkgLSB1bmltcGxlbWVudGVkICJHb1RvRSIgYWN0aW9uLmApOwogICAgICAgICAgfQogICAgICAgICAgYnJlYWs7CiAgICAgICAgY2FzZSAiTmFtZWQiOgogICAgICAgICAgY29uc3QgbmFtZWRBY3Rpb24gPSBhY3Rpb24uZ2V0KCJOIik7CiAgICAgICAgICBpZiAobmFtZWRBY3Rpb24gaW5zdGFuY2VvZiBfcHJpbWl0aXZlcy5OYW1lKSB7CiAgICAgICAgICAgIHJlc3VsdE9iai5hY3Rpb24gPSBuYW1lZEFjdGlvbi5uYW1lOwogICAgICAgICAgfQogICAgICAgICAgYnJlYWs7CiAgICAgICAgY2FzZSAiU2V0T0NHU3RhdGUiOgogICAgICAgICAgY29uc3Qgc3RhdGUgPSBhY3Rpb24uZ2V0KCJTdGF0ZSIpOwogICAgICAgICAgY29uc3QgcHJlc2VydmVSQiA9IGFjdGlvbi5nZXQoIlByZXNlcnZlUkIiKTsKICAgICAgICAgIGlmICghQXJyYXkuaXNBcnJheShzdGF0ZSkgfHwgc3RhdGUubGVuZ3RoID09PSAwKSB7CiAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgfQogICAgICAgICAgY29uc3Qgc3RhdGVBcnIgPSBbXTsKICAgICAgICAgIGZvciAoY29uc3QgZWxlbSBvZiBzdGF0ZSkgewogICAgICAgICAgICBpZiAoZWxlbSBpbnN0YW5jZW9mIF9wcmltaXRpdmVzLk5hbWUpIHsKICAgICAgICAgICAgICBzd2l0Y2ggKGVsZW0ubmFtZSkgewogICAgICAgICAgICAgICAgY2FzZSAiT04iOgogICAgICAgICAgICAgICAgY2FzZSAiT0ZGIjoKICAgICAgICAgICAgICAgIGNhc2UgIlRvZ2dsZSI6CiAgICAgICAgICAgICAgICAgIHN0YXRlQXJyLnB1c2goZWxlbS5uYW1lKTsKICAgICAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgICAgfQogICAgICAgICAgICB9IGVsc2UgaWYgKGVsZW0gaW5zdGFuY2VvZiBfcHJpbWl0aXZlcy5SZWYpIHsKICAgICAgICAgICAgICBzdGF0ZUFyci5wdXNoKGVsZW0udG9TdHJpbmcoKSk7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICAgIGlmIChzdGF0ZUFyci5sZW5ndGggIT09IHN0YXRlLmxlbmd0aCkgewogICAgICAgICAgICBicmVhazsKICAgICAgICAgIH0KICAgICAgICAgIHJlc3VsdE9iai5zZXRPQ0dTdGF0ZSA9IHsKICAgICAgICAgICAgc3RhdGU6IHN0YXRlQXJyLAogICAgICAgICAgICBwcmVzZXJ2ZVJCOiB0eXBlb2YgcHJlc2VydmVSQiA9PT0gImJvb2xlYW4iID8gcHJlc2VydmVSQiA6IHRydWUKICAgICAgICAgIH07CiAgICAgICAgICBicmVhazsKICAgICAgICBjYXNlICJKYXZhU2NyaXB0IjoKICAgICAgICAgIGNvbnN0IGpzQWN0aW9uID0gYWN0aW9uLmdldCgiSlMiKTsKICAgICAgICAgIGxldCBqczsKICAgICAgICAgIGlmIChqc0FjdGlvbiBpbnN0YW5jZW9mIF9iYXNlX3N0cmVhbS5CYXNlU3RyZWFtKSB7CiAgICAgICAgICAgIGpzID0ganNBY3Rpb24uZ2V0U3RyaW5nKCk7CiAgICAgICAgICB9IGVsc2UgaWYgKHR5cGVvZiBqc0FjdGlvbiA9PT0gInN0cmluZyIpIHsKICAgICAgICAgICAganMgPSBqc0FjdGlvbjsKICAgICAgICAgIH0KICAgICAgICAgIGNvbnN0IGpzVVJMID0ganMgJiYgKDAsIF9jb3JlX3V0aWxzLnJlY292ZXJKc1VSTCkoKDAsIF91dGlsLnN0cmluZ1RvUERGU3RyaW5nKShqcykpOwogICAgICAgICAgaWYgKGpzVVJMKSB7CiAgICAgICAgICAgIHVybCA9IGpzVVJMLnVybDsKICAgICAgICAgICAgcmVzdWx0T2JqLm5ld1dpbmRvdyA9IGpzVVJMLm5ld1dpbmRvdzsKICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICB9CiAgICAgICAgZGVmYXVsdDoKICAgICAgICAgIGlmIChhY3Rpb25OYW1lID09PSAiSmF2YVNjcmlwdCIgfHwgYWN0aW9uTmFtZSA9PT0gIlN1Ym1pdEZvcm0iKSB7CiAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgfQogICAgICAgICAgKDAsIF91dGlsLndhcm4pKGBwYXJzZURlc3REaWN0aW9uYXJ5IC0gdW5zdXBwb3J0ZWQgYWN0aW9uOiAiJHthY3Rpb25OYW1lfSIuYCk7CiAgICAgICAgICBicmVhazsKICAgICAgfQogICAgfSBlbHNlIGlmIChkZXN0RGljdC5oYXMoIkRlc3QiKSkgewogICAgICBkZXN0ID0gZGVzdERpY3QuZ2V0KCJEZXN0Iik7CiAgICB9CiAgICBpZiAodHlwZW9mIHVybCA9PT0gInN0cmluZyIpIHsKICAgICAgY29uc3QgYWJzb2x1dGVVcmwgPSAoMCwgX3V0aWwuY3JlYXRlVmFsaWRBYnNvbHV0ZVVybCkodXJsLCBkb2NCYXNlVXJsLCB7CiAgICAgICAgYWRkRGVmYXVsdFByb3RvY29sOiB0cnVlLAogICAgICAgIHRyeUNvbnZlcnRFbmNvZGluZzogdHJ1ZQogICAgICB9KTsKICAgICAgaWYgKGFic29sdXRlVXJsKSB7CiAgICAgICAgcmVzdWx0T2JqLnVybCA9IGFic29sdXRlVXJsLmhyZWY7CiAgICAgIH0KICAgICAgcmVzdWx0T2JqLnVuc2FmZVVybCA9IHVybDsKICAgIH0KICAgIGlmIChkZXN0KSB7CiAgICAgIGlmIChkZXN0IGluc3RhbmNlb2YgX3ByaW1pdGl2ZXMuTmFtZSkgewogICAgICAgIGRlc3QgPSBkZXN0Lm5hbWU7CiAgICAgIH0KICAgICAgaWYgKHR5cGVvZiBkZXN0ID09PSAic3RyaW5nIikgewogICAgICAgIHJlc3VsdE9iai5kZXN0ID0gKDAsIF91dGlsLnN0cmluZ1RvUERGU3RyaW5nKShkZXN0KTsKICAgICAgfSBlbHNlIGlmIChBcnJheS5pc0FycmF5KGRlc3QpKSB7CiAgICAgICAgcmVzdWx0T2JqLmRlc3QgPSBkZXN0OwogICAgICB9CiAgICB9CiAgfQp9CmV4cG9ydHMuQ2F0YWxvZyA9IENhdGFsb2c7CgovKioqLyB9KSwKLyogNjcgKi8KLyoqKi8gKChfX3VudXNlZF93ZWJwYWNrX21vZHVsZSwgZXhwb3J0cywgX193X3BkZmpzX3JlcXVpcmVfXykgPT4gewoKCgpPYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgIl9fZXNNb2R1bGUiLCAoewogIHZhbHVlOiB0cnVlCn0pKTsKZXhwb3J0cy5OdW1iZXJUcmVlID0gZXhwb3J0cy5OYW1lVHJlZSA9IHZvaWQgMDsKdmFyIF9wcmltaXRpdmVzID0gX193X3BkZmpzX3JlcXVpcmVfXyg0KTsKdmFyIF91dGlsID0gX193X3BkZmpzX3JlcXVpcmVfXygyKTsKY2xhc3MgTmFtZU9yTnVtYmVyVHJlZSB7CiAgY29uc3RydWN0b3Iocm9vdCwgeHJlZiwgdHlwZSkgewogICAgaWYgKHRoaXMuY29uc3RydWN0b3IgPT09IE5hbWVPck51bWJlclRyZWUpIHsKICAgICAgKDAsIF91dGlsLnVucmVhY2hhYmxlKSgiQ2Fubm90IGluaXRpYWxpemUgTmFtZU9yTnVtYmVyVHJlZS4iKTsKICAgIH0KICAgIHRoaXMucm9vdCA9IHJvb3Q7CiAgICB0aGlzLnhyZWYgPSB4cmVmOwogICAgdGhpcy5fdHlwZSA9IHR5cGU7CiAgfQogIGdldEFsbCgpIHsKICAgIGNvbnN0IG1hcCA9IG5ldyBNYXAoKTsKICAgIGlmICghdGhpcy5yb290KSB7CiAgICAgIHJldHVybiBtYXA7CiAgICB9CiAgICBjb25zdCB4cmVmID0gdGhpcy54cmVmOwogICAgY29uc3QgcHJvY2Vzc2VkID0gbmV3IF9wcmltaXRpdmVzLlJlZlNldCgpOwogICAgcHJvY2Vzc2VkLnB1dCh0aGlzLnJvb3QpOwogICAgY29uc3QgcXVldWUgPSBbdGhpcy5yb290XTsKICAgIHdoaWxlIChxdWV1ZS5sZW5ndGggPiAwKSB7CiAgICAgIGNvbnN0IG9iaiA9IHhyZWYuZmV0Y2hJZlJlZihxdWV1ZS5zaGlmdCgpKTsKICAgICAgaWYgKCEob2JqIGluc3RhbmNlb2YgX3ByaW1pdGl2ZXMuRGljdCkpIHsKICAgICAgICBjb250aW51ZTsKICAgICAgfQogICAgICBpZiAob2JqLmhhcygiS2lkcyIpKSB7CiAgICAgICAgY29uc3Qga2lkcyA9IG9iai5nZXQoIktpZHMiKTsKICAgICAgICBpZiAoIUFycmF5LmlzQXJyYXkoa2lkcykpIHsKICAgICAgICAgIGNvbnRpbnVlOwogICAgICAgIH0KICAgICAgICBmb3IgKGNvbnN0IGtpZCBvZiBraWRzKSB7CiAgICAgICAgICBpZiAocHJvY2Vzc2VkLmhhcyhraWQpKSB7CiAgICAgICAgICAgIHRocm93IG5ldyBfdXRpbC5Gb3JtYXRFcnJvcihgRHVwbGljYXRlIGVudHJ5IGluICIke3RoaXMuX3R5cGV9IiB0cmVlLmApOwogICAgICAgICAgfQogICAgICAgICAgcXVldWUucHVzaChraWQpOwogICAgICAgICAgcHJvY2Vzc2VkLnB1dChraWQpOwogICAgICAgIH0KICAgICAgICBjb250aW51ZTsKICAgICAgfQogICAgICBjb25zdCBlbnRyaWVzID0gb2JqLmdldCh0aGlzLl90eXBlKTsKICAgICAgaWYgKCFBcnJheS5pc0FycmF5KGVudHJpZXMpKSB7CiAgICAgICAgY29udGludWU7CiAgICAgIH0KICAgICAgZm9yIChsZXQgaSA9IDAsIGlpID0gZW50cmllcy5sZW5ndGg7IGkgPCBpaTsgaSArPSAyKSB7CiAgICAgICAgbWFwLnNldCh4cmVmLmZldGNoSWZSZWYoZW50cmllc1tpXSksIHhyZWYuZmV0Y2hJZlJlZihlbnRyaWVzW2kgKyAxXSkpOwogICAgICB9CiAgICB9CiAgICByZXR1cm4gbWFwOwogIH0KICBnZXQoa2V5KSB7CiAgICBpZiAoIXRoaXMucm9vdCkgewogICAgICByZXR1cm4gbnVsbDsKICAgIH0KICAgIGNvbnN0IHhyZWYgPSB0aGlzLnhyZWY7CiAgICBsZXQga2lkc09yRW50cmllcyA9IHhyZWYuZmV0Y2hJZlJlZih0aGlzLnJvb3QpOwogICAgbGV0IGxvb3BDb3VudCA9IDA7CiAgICBjb25zdCBNQVhfTEVWRUxTID0gMTA7CiAgICB3aGlsZSAoa2lkc09yRW50cmllcy5oYXMoIktpZHMiKSkgewogICAgICBpZiAoKytsb29wQ291bnQgPiBNQVhfTEVWRUxTKSB7CiAgICAgICAgKDAsIF91dGlsLndhcm4pKGBTZWFyY2ggZGVwdGggbGltaXQgcmVhY2hlZCBmb3IgIiR7dGhpcy5fdHlwZX0iIHRyZWUuYCk7CiAgICAgICAgcmV0dXJuIG51bGw7CiAgICAgIH0KICAgICAgY29uc3Qga2lkcyA9IGtpZHNPckVudHJpZXMuZ2V0KCJLaWRzIik7CiAgICAgIGlmICghQXJyYXkuaXNBcnJheShraWRzKSkgewogICAgICAgIHJldHVybiBudWxsOwogICAgICB9CiAgICAgIGxldCBsID0gMCwKICAgICAgICByID0ga2lkcy5sZW5ndGggLSAxOwogICAgICB3aGlsZSAobCA8PSByKSB7CiAgICAgICAgY29uc3QgbSA9IGwgKyByID4+IDE7CiAgICAgICAgY29uc3Qga2lkID0geHJlZi5mZXRjaElmUmVmKGtpZHNbbV0pOwogICAgICAgIGNvbnN0IGxpbWl0cyA9IGtpZC5nZXQoIkxpbWl0cyIpOwogICAgICAgIGlmIChrZXkgPCB4cmVmLmZldGNoSWZSZWYobGltaXRzWzBdKSkgewogICAgICAgICAgciA9IG0gLSAxOwogICAgICAgIH0gZWxzZSBpZiAoa2V5ID4geHJlZi5mZXRjaElmUmVmKGxpbWl0c1sxXSkpIHsKICAgICAgICAgIGwgPSBtICsgMTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAga2lkc09yRW50cmllcyA9IGtpZDsKICAgICAgICAgIGJyZWFrOwogICAgICAgIH0KICAgICAgfQogICAgICBpZiAobCA+IHIpIHsKICAgICAgICByZXR1cm4gbnVsbDsKICAgICAgfQogICAgfQogICAgY29uc3QgZW50cmllcyA9IGtpZHNPckVudHJpZXMuZ2V0KHRoaXMuX3R5cGUpOwogICAgaWYgKEFycmF5LmlzQXJyYXkoZW50cmllcykpIHsKICAgICAgbGV0IGwgPSAwLAogICAgICAgIHIgPSBlbnRyaWVzLmxlbmd0aCAtIDI7CiAgICAgIHdoaWxlIChsIDw9IHIpIHsKICAgICAgICBjb25zdCB0bXAgPSBsICsgciA+PiAxLAogICAgICAgICAgbSA9IHRtcCArICh0bXAgJiAxKTsKICAgICAgICBjb25zdCBjdXJyZW50S2V5ID0geHJlZi5mZXRjaElmUmVmKGVudHJpZXNbbV0pOwogICAgICAgIGlmIChrZXkgPCBjdXJyZW50S2V5KSB7CiAgICAgICAgICByID0gbSAtIDI7CiAgICAgICAgfSBlbHNlIGlmIChrZXkgPiBjdXJyZW50S2V5KSB7CiAgICAgICAgICBsID0gbSArIDI7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIHJldHVybiB4cmVmLmZldGNoSWZSZWYoZW50cmllc1ttICsgMV0pOwogICAgICAgIH0KICAgICAgfQogICAgfQogICAgcmV0dXJuIG51bGw7CiAgfQp9CmNsYXNzIE5hbWVUcmVlIGV4dGVuZHMgTmFtZU9yTnVtYmVyVHJlZSB7CiAgY29uc3RydWN0b3Iocm9vdCwgeHJlZikgewogICAgc3VwZXIocm9vdCwgeHJlZiwgIk5hbWVzIik7CiAgfQp9CmV4cG9ydHMuTmFtZVRyZWUgPSBOYW1lVHJlZTsKY2xhc3MgTnVtYmVyVHJlZSBleHRlbmRzIE5hbWVPck51bWJlclRyZWUgewogIGNvbnN0cnVjdG9yKHJvb3QsIHhyZWYpIHsKICAgIHN1cGVyKHJvb3QsIHhyZWYsICJOdW1zIik7CiAgfQp9CmV4cG9ydHMuTnVtYmVyVHJlZSA9IE51bWJlclRyZWU7CgovKioqLyB9KSwKLyogNjggKi8KLyoqKi8gKChfX3VudXNlZF93ZWJwYWNrX21vZHVsZSwgZXhwb3J0cywgX193X3BkZmpzX3JlcXVpcmVfXykgPT4gewoKCgpPYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgIl9fZXNNb2R1bGUiLCAoewogIHZhbHVlOiB0cnVlCn0pKTsKZXhwb3J0cy5jbGVhckdsb2JhbENhY2hlcyA9IGNsZWFyR2xvYmFsQ2FjaGVzOwp2YXIgX3BhdHRlcm4gPSBfX3dfcGRmanNfcmVxdWlyZV9fKDUwKTsKdmFyIF9wcmltaXRpdmVzID0gX193X3BkZmpzX3JlcXVpcmVfXyg0KTsKdmFyIF91bmljb2RlID0gX193X3BkZmpzX3JlcXVpcmVfXyg0MCk7CmZ1bmN0aW9uIGNsZWFyR2xvYmFsQ2FjaGVzKCkgewogICgwLCBfcGF0dGVybi5jbGVhclBhdHRlcm5DYWNoZXMpKCk7CiAgKDAsIF9wcmltaXRpdmVzLmNsZWFyUHJpbWl0aXZlQ2FjaGVzKSgpOwogICgwLCBfdW5pY29kZS5jbGVhclVuaWNvZGVDYWNoZXMpKCk7Cn0KCi8qKiovIH0pLAovKiA2OSAqLwovKioqLyAoKF9fdW51c2VkX3dlYnBhY2tfbW9kdWxlLCBleHBvcnRzLCBfX3dfcGRmanNfcmVxdWlyZV9fKSA9PiB7CgoKCk9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCAiX19lc01vZHVsZSIsICh7CiAgdmFsdWU6IHRydWUKfSkpOwpleHBvcnRzLkZpbGVTcGVjID0gdm9pZCAwOwp2YXIgX3V0aWwgPSBfX3dfcGRmanNfcmVxdWlyZV9fKDIpOwp2YXIgX2Jhc2Vfc3RyZWFtID0gX193X3BkZmpzX3JlcXVpcmVfXyg1KTsKdmFyIF9wcmltaXRpdmVzID0gX193X3BkZmpzX3JlcXVpcmVfXyg0KTsKZnVuY3Rpb24gcGlja1BsYXRmb3JtSXRlbShkaWN0KSB7CiAgaWYgKGRpY3QuaGFzKCJVRiIpKSB7CiAgICByZXR1cm4gZGljdC5nZXQoIlVGIik7CiAgfSBlbHNlIGlmIChkaWN0LmhhcygiRiIpKSB7CiAgICByZXR1cm4gZGljdC5nZXQoIkYiKTsKICB9IGVsc2UgaWYgKGRpY3QuaGFzKCJVbml4IikpIHsKICAgIHJldHVybiBkaWN0LmdldCgiVW5peCIpOwogIH0gZWxzZSBpZiAoZGljdC5oYXMoIk1hYyIpKSB7CiAgICByZXR1cm4gZGljdC5nZXQoIk1hYyIpOwogIH0gZWxzZSBpZiAoZGljdC5oYXMoIkRPUyIpKSB7CiAgICByZXR1cm4gZGljdC5nZXQoIkRPUyIpOwogIH0KICByZXR1cm4gbnVsbDsKfQpjbGFzcyBGaWxlU3BlYyB7CiAgY29uc3RydWN0b3Iocm9vdCwgeHJlZikgewogICAgaWYgKCEocm9vdCBpbnN0YW5jZW9mIF9wcmltaXRpdmVzLkRpY3QpKSB7CiAgICAgIHJldHVybjsKICAgIH0KICAgIHRoaXMueHJlZiA9IHhyZWY7CiAgICB0aGlzLnJvb3QgPSByb290OwogICAgaWYgKHJvb3QuaGFzKCJGUyIpKSB7CiAgICAgIHRoaXMuZnMgPSByb290LmdldCgiRlMiKTsKICAgIH0KICAgIHRoaXMuZGVzY3JpcHRpb24gPSByb290LmhhcygiRGVzYyIpID8gKDAsIF91dGlsLnN0cmluZ1RvUERGU3RyaW5nKShyb290LmdldCgiRGVzYyIpKSA6ICIiOwogICAgaWYgKHJvb3QuaGFzKCJSRiIpKSB7CiAgICAgICgwLCBfdXRpbC53YXJuKSgiUmVsYXRlZCBmaWxlIHNwZWNpZmljYXRpb25zIGFyZSBub3Qgc3VwcG9ydGVkIik7CiAgICB9CiAgICB0aGlzLmNvbnRlbnRBdmFpbGFibGUgPSB0cnVlOwogICAgaWYgKCFyb290LmhhcygiRUYiKSkgewogICAgICB0aGlzLmNvbnRlbnRBdmFpbGFibGUgPSBmYWxzZTsKICAgICAgKDAsIF91dGlsLndhcm4pKCJOb24tZW1iZWRkZWQgZmlsZSBzcGVjaWZpY2F0aW9ucyBhcmUgbm90IHN1cHBvcnRlZCIpOwogICAgfQogIH0KICBnZXQgZmlsZW5hbWUoKSB7CiAgICBpZiAoIXRoaXMuX2ZpbGVuYW1lICYmIHRoaXMucm9vdCkgewogICAgICBjb25zdCBmaWxlbmFtZSA9IHBpY2tQbGF0Zm9ybUl0ZW0odGhpcy5yb290KSB8fCAidW5uYW1lZCI7CiAgICAgIHRoaXMuX2ZpbGVuYW1lID0gKDAsIF91dGlsLnN0cmluZ1RvUERGU3RyaW5nKShmaWxlbmFtZSkucmVwbGFjZUFsbCgiXFxcXCIsICJcXCIpLnJlcGxhY2VBbGwoIlxcLyIsICIvIikucmVwbGFjZUFsbCgiXFwiLCAiLyIpOwogICAgfQogICAgcmV0dXJuIHRoaXMuX2ZpbGVuYW1lOwogIH0KICBnZXQgY29udGVudCgpIHsKICAgIGlmICghdGhpcy5jb250ZW50QXZhaWxhYmxlKSB7CiAgICAgIHJldHVybiBudWxsOwogICAgfQogICAgaWYgKCF0aGlzLmNvbnRlbnRSZWYgJiYgdGhpcy5yb290KSB7CiAgICAgIHRoaXMuY29udGVudFJlZiA9IHBpY2tQbGF0Zm9ybUl0ZW0odGhpcy5yb290LmdldCgiRUYiKSk7CiAgICB9CiAgICBsZXQgY29udGVudCA9IG51bGw7CiAgICBpZiAodGhpcy5jb250ZW50UmVmKSB7CiAgICAgIGNvbnN0IGZpbGVPYmogPSB0aGlzLnhyZWYuZmV0Y2hJZlJlZih0aGlzLmNvbnRlbnRSZWYpOwogICAgICBpZiAoZmlsZU9iaiBpbnN0YW5jZW9mIF9iYXNlX3N0cmVhbS5CYXNlU3RyZWFtKSB7CiAgICAgICAgY29udGVudCA9IGZpbGVPYmouZ2V0Qnl0ZXMoKTsKICAgICAgfSBlbHNlIHsKICAgICAgICAoMCwgX3V0aWwud2FybikoIkVtYmVkZGVkIGZpbGUgc3BlY2lmaWNhdGlvbiBwb2ludHMgdG8gbm9uLWV4aXN0aW5nL2ludmFsaWQgY29udGVudCIpOwogICAgICB9CiAgICB9IGVsc2UgewogICAgICAoMCwgX3V0aWwud2FybikoIkVtYmVkZGVkIGZpbGUgc3BlY2lmaWNhdGlvbiBkb2VzIG5vdCBoYXZlIGEgY29udGVudCIpOwogICAgfQogICAgcmV0dXJuIGNvbnRlbnQ7CiAgfQogIGdldCBzZXJpYWxpemFibGUoKSB7CiAgICByZXR1cm4gewogICAgICBmaWxlbmFtZTogdGhpcy5maWxlbmFtZSwKICAgICAgY29udGVudDogdGhpcy5jb250ZW50CiAgICB9OwogIH0KfQpleHBvcnRzLkZpbGVTcGVjID0gRmlsZVNwZWM7CgovKioqLyB9KSwKLyogNzAgKi8KLyoqKi8gKChfX3VudXNlZF93ZWJwYWNrX21vZHVsZSwgZXhwb3J0cywgX193X3BkZmpzX3JlcXVpcmVfXykgPT4gewoKCgpPYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgIl9fZXNNb2R1bGUiLCAoewogIHZhbHVlOiB0cnVlCn0pKTsKZXhwb3J0cy5NZXRhZGF0YVBhcnNlciA9IHZvaWQgMDsKdmFyIF94bWxfcGFyc2VyID0gX193X3BkZmpzX3JlcXVpcmVfXyg3MSk7CmNsYXNzIE1ldGFkYXRhUGFyc2VyIHsKICBjb25zdHJ1Y3RvcihkYXRhKSB7CiAgICBkYXRhID0gdGhpcy5fcmVwYWlyKGRhdGEpOwogICAgY29uc3QgcGFyc2VyID0gbmV3IF94bWxfcGFyc2VyLlNpbXBsZVhNTFBhcnNlcih7CiAgICAgIGxvd2VyQ2FzZU5hbWU6IHRydWUKICAgIH0pOwogICAgY29uc3QgeG1sRG9jdW1lbnQgPSBwYXJzZXIucGFyc2VGcm9tU3RyaW5nKGRhdGEpOwogICAgdGhpcy5fbWV0YWRhdGFNYXAgPSBuZXcgTWFwKCk7CiAgICB0aGlzLl9kYXRhID0gZGF0YTsKICAgIGlmICh4bWxEb2N1bWVudCkgewogICAgICB0aGlzLl9wYXJzZSh4bWxEb2N1bWVudCk7CiAgICB9CiAgfQogIF9yZXBhaXIoZGF0YSkgewogICAgcmV0dXJuIGRhdGEucmVwbGFjZSgvXltePF0rLywgIiIpLnJlcGxhY2VBbGwoLz5cXDM3NlxcMzc3KFtePF0rKS9nLCBmdW5jdGlvbiAoYWxsLCBjb2RlcykgewogICAgICBjb25zdCBieXRlcyA9IGNvZGVzLnJlcGxhY2VBbGwoL1xcKFswLTNdKShbMC03XSkoWzAtN10pL2csIGZ1bmN0aW9uIChjb2RlLCBkMSwgZDIsIGQzKSB7CiAgICAgICAgcmV0dXJuIFN0cmluZy5mcm9tQ2hhckNvZGUoZDEgKiA2NCArIGQyICogOCArIGQzICogMSk7CiAgICAgIH0pLnJlcGxhY2VBbGwoLyYoYW1wfGFwb3N8Z3R8bHR8cXVvdCk7L2csIGZ1bmN0aW9uIChzdHIsIG5hbWUpIHsKICAgICAgICBzd2l0Y2ggKG5hbWUpIHsKICAgICAgICAgIGNhc2UgImFtcCI6CiAgICAgICAgICAgIHJldHVybiAiJiI7CiAgICAgICAgICBjYXNlICJhcG9zIjoKICAgICAgICAgICAgcmV0dXJuICInIjsKICAgICAgICAgIGNhc2UgImd0IjoKICAgICAgICAgICAgcmV0dXJuICI+IjsKICAgICAgICAgIGNhc2UgImx0IjoKICAgICAgICAgICAgcmV0dXJuICI8IjsKICAgICAgICAgIGNhc2UgInF1b3QiOgogICAgICAgICAgICByZXR1cm4gJyInOwogICAgICAgIH0KICAgICAgICB0aHJvdyBuZXcgRXJyb3IoYF9yZXBhaXI6ICR7bmFtZX0gaXNuJ3QgZGVmaW5lZC5gKTsKICAgICAgfSk7CiAgICAgIGNvbnN0IGNoYXJCdWYgPSBbIj4iXTsKICAgICAgZm9yIChsZXQgaSA9IDAsIGlpID0gYnl0ZXMubGVuZ3RoOyBpIDwgaWk7IGkgKz0gMikgewogICAgICAgIGNvbnN0IGNvZGUgPSBieXRlcy5jaGFyQ29kZUF0KGkpICogMjU2ICsgYnl0ZXMuY2hhckNvZGVBdChpICsgMSk7CiAgICAgICAgaWYgKGNvZGUgPj0gMzIgJiYgY29kZSA8IDEyNyAmJiBjb2RlICE9PSA2MCAmJiBjb2RlICE9PSA2MiAmJiBjb2RlICE9PSAzOCkgewogICAgICAgICAgY2hhckJ1Zi5wdXNoKFN0cmluZy5mcm9tQ2hhckNvZGUoY29kZSkpOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICBjaGFyQnVmLnB1c2goIiYjeCIgKyAoMHgxMDAwMCArIGNvZGUpLnRvU3RyaW5nKDE2KS5zdWJzdHJpbmcoMSkgKyAiOyIpOwogICAgICAgIH0KICAgICAgfQogICAgICByZXR1cm4gY2hhckJ1Zi5qb2luKCIiKTsKICAgIH0pOwogIH0KICBfZ2V0U2VxdWVuY2UoZW50cnkpIHsKICAgIGNvbnN0IG5hbWUgPSBlbnRyeS5ub2RlTmFtZTsKICAgIGlmIChuYW1lICE9PSAicmRmOmJhZyIgJiYgbmFtZSAhPT0gInJkZjpzZXEiICYmIG5hbWUgIT09ICJyZGY6YWx0IikgewogICAgICByZXR1cm4gbnVsbDsKICAgIH0KICAgIHJldHVybiBlbnRyeS5jaGlsZE5vZGVzLmZpbHRlcihub2RlID0+IG5vZGUubm9kZU5hbWUgPT09ICJyZGY6bGkiKTsKICB9CiAgX3BhcnNlQXJyYXkoZW50cnkpIHsKICAgIGlmICghZW50cnkuaGFzQ2hpbGROb2RlcygpKSB7CiAgICAgIHJldHVybjsKICAgIH0KICAgIGNvbnN0IFtzZXFOb2RlXSA9IGVudHJ5LmNoaWxkTm9kZXM7CiAgICBjb25zdCBzZXF1ZW5jZSA9IHRoaXMuX2dldFNlcXVlbmNlKHNlcU5vZGUpIHx8IFtdOwogICAgdGhpcy5fbWV0YWRhdGFNYXAuc2V0KGVudHJ5Lm5vZGVOYW1lLCBzZXF1ZW5jZS5tYXAobm9kZSA9PiBub2RlLnRleHRDb250ZW50LnRyaW0oKSkpOwogIH0KICBfcGFyc2UoeG1sRG9jdW1lbnQpIHsKICAgIGxldCByZGYgPSB4bWxEb2N1bWVudC5kb2N1bWVudEVsZW1lbnQ7CiAgICBpZiAocmRmLm5vZGVOYW1lICE9PSAicmRmOnJkZiIpIHsKICAgICAgcmRmID0gcmRmLmZpcnN0Q2hpbGQ7CiAgICAgIHdoaWxlIChyZGYgJiYgcmRmLm5vZGVOYW1lICE9PSAicmRmOnJkZiIpIHsKICAgICAgICByZGYgPSByZGYubmV4dFNpYmxpbmc7CiAgICAgIH0KICAgIH0KICAgIGlmICghcmRmIHx8IHJkZi5ub2RlTmFtZSAhPT0gInJkZjpyZGYiIHx8ICFyZGYuaGFzQ2hpbGROb2RlcygpKSB7CiAgICAgIHJldHVybjsKICAgIH0KICAgIGZvciAoY29uc3QgZGVzYyBvZiByZGYuY2hpbGROb2RlcykgewogICAgICBpZiAoZGVzYy5ub2RlTmFtZSAhPT0gInJkZjpkZXNjcmlwdGlvbiIpIHsKICAgICAgICBjb250aW51ZTsKICAgICAgfQogICAgICBmb3IgKGNvbnN0IGVudHJ5IG9mIGRlc2MuY2hpbGROb2RlcykgewogICAgICAgIGNvbnN0IG5hbWUgPSBlbnRyeS5ub2RlTmFtZTsKICAgICAgICBzd2l0Y2ggKG5hbWUpIHsKICAgICAgICAgIGNhc2UgIiN0ZXh0IjoKICAgICAgICAgICAgY29udGludWU7CiAgICAgICAgICBjYXNlICJkYzpjcmVhdG9yIjoKICAgICAgICAgIGNhc2UgImRjOnN1YmplY3QiOgogICAgICAgICAgICB0aGlzLl9wYXJzZUFycmF5KGVudHJ5KTsKICAgICAgICAgICAgY29udGludWU7CiAgICAgICAgfQogICAgICAgIHRoaXMuX21ldGFkYXRhTWFwLnNldChuYW1lLCBlbnRyeS50ZXh0Q29udGVudC50cmltKCkpOwogICAgICB9CiAgICB9CiAgfQogIGdldCBzZXJpYWxpemFibGUoKSB7CiAgICByZXR1cm4gewogICAgICBwYXJzZWREYXRhOiB0aGlzLl9tZXRhZGF0YU1hcCwKICAgICAgcmF3RGF0YTogdGhpcy5fZGF0YQogICAgfTsKICB9Cn0KZXhwb3J0cy5NZXRhZGF0YVBhcnNlciA9IE1ldGFkYXRhUGFyc2VyOwoKLyoqKi8gfSksCi8qIDcxICovCi8qKiovICgoX191bnVzZWRfd2VicGFja19tb2R1bGUsIGV4cG9ydHMsIF9fd19wZGZqc19yZXF1aXJlX18pID0+IHsKCgoKT2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsICJfX2VzTW9kdWxlIiwgKHsKICB2YWx1ZTogdHJ1ZQp9KSk7CmV4cG9ydHMuWE1MUGFyc2VyRXJyb3JDb2RlID0gZXhwb3J0cy5YTUxQYXJzZXJCYXNlID0gZXhwb3J0cy5TaW1wbGVYTUxQYXJzZXIgPSBleHBvcnRzLlNpbXBsZURPTU5vZGUgPSB2b2lkIDA7CnZhciBfY29yZV91dGlscyA9IF9fd19wZGZqc19yZXF1aXJlX18oMyk7CmNvbnN0IFhNTFBhcnNlckVycm9yQ29kZSA9IHsKICBOb0Vycm9yOiAwLAogIEVuZE9mRG9jdW1lbnQ6IC0xLAogIFVudGVybWluYXRlZENkYXQ6IC0yLAogIFVudGVybWluYXRlZFhtbERlY2xhcmF0aW9uOiAtMywKICBVbnRlcm1pbmF0ZWREb2N0eXBlRGVjbGFyYXRpb246IC00LAogIFVudGVybWluYXRlZENvbW1lbnQ6IC01LAogIE1hbGZvcm1lZEVsZW1lbnQ6IC02LAogIE91dE9mTWVtb3J5OiAtNywKICBVbnRlcm1pbmF0ZWRBdHRyaWJ1dGVWYWx1ZTogLTgsCiAgVW50ZXJtaW5hdGVkRWxlbWVudDogLTksCiAgRWxlbWVudE5ldmVyQmVndW46IC0xMAp9OwpleHBvcnRzLlhNTFBhcnNlckVycm9yQ29kZSA9IFhNTFBhcnNlckVycm9yQ29kZTsKZnVuY3Rpb24gaXNXaGl0ZXNwYWNlKHMsIGluZGV4KSB7CiAgY29uc3QgY2ggPSBzW2luZGV4XTsKICByZXR1cm4gY2ggPT09ICIgIiB8fCBjaCA9PT0gIlxuIiB8fCBjaCA9PT0gIlxyIiB8fCBjaCA9PT0gIlx0IjsKfQpmdW5jdGlvbiBpc1doaXRlc3BhY2VTdHJpbmcocykgewogIGZvciAobGV0IGkgPSAwLCBpaSA9IHMubGVuZ3RoOyBpIDwgaWk7IGkrKykgewogICAgaWYgKCFpc1doaXRlc3BhY2UocywgaSkpIHsKICAgICAgcmV0dXJuIGZhbHNlOwogICAgfQogIH0KICByZXR1cm4gdHJ1ZTsKfQpjbGFzcyBYTUxQYXJzZXJCYXNlIHsKICBfcmVzb2x2ZUVudGl0aWVzKHMpIHsKICAgIHJldHVybiBzLnJlcGxhY2VBbGwoLyYoW147XSspOy9nLCAoYWxsLCBlbnRpdHkpID0+IHsKICAgICAgaWYgKGVudGl0eS5zdWJzdHJpbmcoMCwgMikgPT09ICIjeCIpIHsKICAgICAgICByZXR1cm4gU3RyaW5nLmZyb21Db2RlUG9pbnQocGFyc2VJbnQoZW50aXR5LnN1YnN0cmluZygyKSwgMTYpKTsKICAgICAgfSBlbHNlIGlmIChlbnRpdHkuc3Vic3RyaW5nKDAsIDEpID09PSAiIyIpIHsKICAgICAgICByZXR1cm4gU3RyaW5nLmZyb21Db2RlUG9pbnQocGFyc2VJbnQoZW50aXR5LnN1YnN0cmluZygxKSwgMTApKTsKICAgICAgfQogICAgICBzd2l0Y2ggKGVudGl0eSkgewogICAgICAgIGNhc2UgImx0IjoKICAgICAgICAgIHJldHVybiAiPCI7CiAgICAgICAgY2FzZSAiZ3QiOgogICAgICAgICAgcmV0dXJuICI+IjsKICAgICAgICBjYXNlICJhbXAiOgogICAgICAgICAgcmV0dXJuICImIjsKICAgICAgICBjYXNlICJxdW90IjoKICAgICAgICAgIHJldHVybiAnIic7CiAgICAgICAgY2FzZSAiYXBvcyI6CiAgICAgICAgICByZXR1cm4gIiciOwogICAgICB9CiAgICAgIHJldHVybiB0aGlzLm9uUmVzb2x2ZUVudGl0eShlbnRpdHkpOwogICAgfSk7CiAgfQogIF9wYXJzZUNvbnRlbnQocywgc3RhcnQpIHsKICAgIGNvbnN0IGF0dHJpYnV0ZXMgPSBbXTsKICAgIGxldCBwb3MgPSBzdGFydDsKICAgIGZ1bmN0aW9uIHNraXBXcygpIHsKICAgICAgd2hpbGUgKHBvcyA8IHMubGVuZ3RoICYmIGlzV2hpdGVzcGFjZShzLCBwb3MpKSB7CiAgICAgICAgKytwb3M7CiAgICAgIH0KICAgIH0KICAgIHdoaWxlIChwb3MgPCBzLmxlbmd0aCAmJiAhaXNXaGl0ZXNwYWNlKHMsIHBvcykgJiYgc1twb3NdICE9PSAiPiIgJiYgc1twb3NdICE9PSAiLyIpIHsKICAgICAgKytwb3M7CiAgICB9CiAgICBjb25zdCBuYW1lID0gcy5zdWJzdHJpbmcoc3RhcnQsIHBvcyk7CiAgICBza2lwV3MoKTsKICAgIHdoaWxlIChwb3MgPCBzLmxlbmd0aCAmJiBzW3Bvc10gIT09ICI+IiAmJiBzW3Bvc10gIT09ICIvIiAmJiBzW3Bvc10gIT09ICI/IikgewogICAgICBza2lwV3MoKTsKICAgICAgbGV0IGF0dHJOYW1lID0gIiIsCiAgICAgICAgYXR0clZhbHVlID0gIiI7CiAgICAgIHdoaWxlIChwb3MgPCBzLmxlbmd0aCAmJiAhaXNXaGl0ZXNwYWNlKHMsIHBvcykgJiYgc1twb3NdICE9PSAiPSIpIHsKICAgICAgICBhdHRyTmFtZSArPSBzW3Bvc107CiAgICAgICAgKytwb3M7CiAgICAgIH0KICAgICAgc2tpcFdzKCk7CiAgICAgIGlmIChzW3Bvc10gIT09ICI9IikgewogICAgICAgIHJldHVybiBudWxsOwogICAgICB9CiAgICAgICsrcG9zOwogICAgICBza2lwV3MoKTsKICAgICAgY29uc3QgYXR0ckVuZENoYXIgPSBzW3Bvc107CiAgICAgIGlmIChhdHRyRW5kQ2hhciAhPT0gJyInICYmIGF0dHJFbmRDaGFyICE9PSAiJyIpIHsKICAgICAgICByZXR1cm4gbnVsbDsKICAgICAgfQogICAgICBjb25zdCBhdHRyRW5kSW5kZXggPSBzLmluZGV4T2YoYXR0ckVuZENoYXIsICsrcG9zKTsKICAgICAgaWYgKGF0dHJFbmRJbmRleCA8IDApIHsKICAgICAgICByZXR1cm4gbnVsbDsKICAgICAgfQogICAgICBhdHRyVmFsdWUgPSBzLnN1YnN0cmluZyhwb3MsIGF0dHJFbmRJbmRleCk7CiAgICAgIGF0dHJpYnV0ZXMucHVzaCh7CiAgICAgICAgbmFtZTogYXR0ck5hbWUsCiAgICAgICAgdmFsdWU6IHRoaXMuX3Jlc29sdmVFbnRpdGllcyhhdHRyVmFsdWUpCiAgICAgIH0pOwogICAgICBwb3MgPSBhdHRyRW5kSW5kZXggKyAxOwogICAgICBza2lwV3MoKTsKICAgIH0KICAgIHJldHVybiB7CiAgICAgIG5hbWUsCiAgICAgIGF0dHJpYnV0ZXMsCiAgICAgIHBhcnNlZDogcG9zIC0gc3RhcnQKICAgIH07CiAgfQogIF9wYXJzZVByb2Nlc3NpbmdJbnN0cnVjdGlvbihzLCBzdGFydCkgewogICAgbGV0IHBvcyA9IHN0YXJ0OwogICAgZnVuY3Rpb24gc2tpcFdzKCkgewogICAgICB3aGlsZSAocG9zIDwgcy5sZW5ndGggJiYgaXNXaGl0ZXNwYWNlKHMsIHBvcykpIHsKICAgICAgICArK3BvczsKICAgICAgfQogICAgfQogICAgd2hpbGUgKHBvcyA8IHMubGVuZ3RoICYmICFpc1doaXRlc3BhY2UocywgcG9zKSAmJiBzW3Bvc10gIT09ICI+IiAmJiBzW3Bvc10gIT09ICI/IiAmJiBzW3Bvc10gIT09ICIvIikgewogICAgICArK3BvczsKICAgIH0KICAgIGNvbnN0IG5hbWUgPSBzLnN1YnN0cmluZyhzdGFydCwgcG9zKTsKICAgIHNraXBXcygpOwogICAgY29uc3QgYXR0clN0YXJ0ID0gcG9zOwogICAgd2hpbGUgKHBvcyA8IHMubGVuZ3RoICYmIChzW3Bvc10gIT09ICI/IiB8fCBzW3BvcyArIDFdICE9PSAiPiIpKSB7CiAgICAgICsrcG9zOwogICAgfQogICAgY29uc3QgdmFsdWUgPSBzLnN1YnN0cmluZyhhdHRyU3RhcnQsIHBvcyk7CiAgICByZXR1cm4gewogICAgICBuYW1lLAogICAgICB2YWx1ZSwKICAgICAgcGFyc2VkOiBwb3MgLSBzdGFydAogICAgfTsKICB9CiAgcGFyc2VYbWwocykgewogICAgbGV0IGkgPSAwOwogICAgd2hpbGUgKGkgPCBzLmxlbmd0aCkgewogICAgICBjb25zdCBjaCA9IHNbaV07CiAgICAgIGxldCBqID0gaTsKICAgICAgaWYgKGNoID09PSAiPCIpIHsKICAgICAgICArK2o7CiAgICAgICAgY29uc3QgY2gyID0gc1tqXTsKICAgICAgICBsZXQgcTsKICAgICAgICBzd2l0Y2ggKGNoMikgewogICAgICAgICAgY2FzZSAiLyI6CiAgICAgICAgICAgICsrajsKICAgICAgICAgICAgcSA9IHMuaW5kZXhPZigiPiIsIGopOwogICAgICAgICAgICBpZiAocSA8IDApIHsKICAgICAgICAgICAgICB0aGlzLm9uRXJyb3IoWE1MUGFyc2VyRXJyb3JDb2RlLlVudGVybWluYXRlZEVsZW1lbnQpOwogICAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgICAgfQogICAgICAgICAgICB0aGlzLm9uRW5kRWxlbWVudChzLnN1YnN0cmluZyhqLCBxKSk7CiAgICAgICAgICAgIGogPSBxICsgMTsKICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICBjYXNlICI/IjoKICAgICAgICAgICAgKytqOwogICAgICAgICAgICBjb25zdCBwaSA9IHRoaXMuX3BhcnNlUHJvY2Vzc2luZ0luc3RydWN0aW9uKHMsIGopOwogICAgICAgICAgICBpZiAocy5zdWJzdHJpbmcoaiArIHBpLnBhcnNlZCwgaiArIHBpLnBhcnNlZCArIDIpICE9PSAiPz4iKSB7CiAgICAgICAgICAgICAgdGhpcy5vbkVycm9yKFhNTFBhcnNlckVycm9yQ29kZS5VbnRlcm1pbmF0ZWRYbWxEZWNsYXJhdGlvbik7CiAgICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgICB9CiAgICAgICAgICAgIHRoaXMub25QaShwaS5uYW1lLCBwaS52YWx1ZSk7CiAgICAgICAgICAgIGogKz0gcGkucGFyc2VkICsgMjsKICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICBjYXNlICIhIjoKICAgICAgICAgICAgaWYgKHMuc3Vic3RyaW5nKGogKyAxLCBqICsgMykgPT09ICItLSIpIHsKICAgICAgICAgICAgICBxID0gcy5pbmRleE9mKCItLT4iLCBqICsgMyk7CiAgICAgICAgICAgICAgaWYgKHEgPCAwKSB7CiAgICAgICAgICAgICAgICB0aGlzLm9uRXJyb3IoWE1MUGFyc2VyRXJyb3JDb2RlLlVudGVybWluYXRlZENvbW1lbnQpOwogICAgICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgICB0aGlzLm9uQ29tbWVudChzLnN1YnN0cmluZyhqICsgMywgcSkpOwogICAgICAgICAgICAgIGogPSBxICsgMzsKICAgICAgICAgICAgfSBlbHNlIGlmIChzLnN1YnN0cmluZyhqICsgMSwgaiArIDgpID09PSAiW0NEQVRBWyIpIHsKICAgICAgICAgICAgICBxID0gcy5pbmRleE9mKCJdXT4iLCBqICsgOCk7CiAgICAgICAgICAgICAgaWYgKHEgPCAwKSB7CiAgICAgICAgICAgICAgICB0aGlzLm9uRXJyb3IoWE1MUGFyc2VyRXJyb3JDb2RlLlVudGVybWluYXRlZENkYXQpOwogICAgICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgICB0aGlzLm9uQ2RhdGEocy5zdWJzdHJpbmcoaiArIDgsIHEpKTsKICAgICAgICAgICAgICBqID0gcSArIDM7CiAgICAgICAgICAgIH0gZWxzZSBpZiAocy5zdWJzdHJpbmcoaiArIDEsIGogKyA4KSA9PT0gIkRPQ1RZUEUiKSB7CiAgICAgICAgICAgICAgY29uc3QgcTIgPSBzLmluZGV4T2YoIlsiLCBqICsgOCk7CiAgICAgICAgICAgICAgbGV0IGNvbXBsZXhEb2N0eXBlID0gZmFsc2U7CiAgICAgICAgICAgICAgcSA9IHMuaW5kZXhPZigiPiIsIGogKyA4KTsKICAgICAgICAgICAgICBpZiAocSA8IDApIHsKICAgICAgICAgICAgICAgIHRoaXMub25FcnJvcihYTUxQYXJzZXJFcnJvckNvZGUuVW50ZXJtaW5hdGVkRG9jdHlwZURlY2xhcmF0aW9uKTsKICAgICAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgaWYgKHEyID4gMCAmJiBxID4gcTIpIHsKICAgICAgICAgICAgICAgIHEgPSBzLmluZGV4T2YoIl0+IiwgaiArIDgpOwogICAgICAgICAgICAgICAgaWYgKHEgPCAwKSB7CiAgICAgICAgICAgICAgICAgIHRoaXMub25FcnJvcihYTUxQYXJzZXJFcnJvckNvZGUuVW50ZXJtaW5hdGVkRG9jdHlwZURlY2xhcmF0aW9uKTsKICAgICAgICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgY29tcGxleERvY3R5cGUgPSB0cnVlOwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgICBjb25zdCBkb2N0eXBlQ29udGVudCA9IHMuc3Vic3RyaW5nKGogKyA4LCBxICsgKGNvbXBsZXhEb2N0eXBlID8gMSA6IDApKTsKICAgICAgICAgICAgICB0aGlzLm9uRG9jdHlwZShkb2N0eXBlQ29udGVudCk7CiAgICAgICAgICAgICAgaiA9IHEgKyAoY29tcGxleERvY3R5cGUgPyAyIDogMSk7CiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgdGhpcy5vbkVycm9yKFhNTFBhcnNlckVycm9yQ29kZS5NYWxmb3JtZWRFbGVtZW50KTsKICAgICAgICAgICAgICByZXR1cm47CiAgICAgICAgICAgIH0KICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICBkZWZhdWx0OgogICAgICAgICAgICBjb25zdCBjb250ZW50ID0gdGhpcy5fcGFyc2VDb250ZW50KHMsIGopOwogICAgICAgICAgICBpZiAoY29udGVudCA9PT0gbnVsbCkgewogICAgICAgICAgICAgIHRoaXMub25FcnJvcihYTUxQYXJzZXJFcnJvckNvZGUuTWFsZm9ybWVkRWxlbWVudCk7CiAgICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGxldCBpc0Nsb3NlZCA9IGZhbHNlOwogICAgICAgICAgICBpZiAocy5zdWJzdHJpbmcoaiArIGNvbnRlbnQucGFyc2VkLCBqICsgY29udGVudC5wYXJzZWQgKyAyKSA9PT0gIi8+IikgewogICAgICAgICAgICAgIGlzQ2xvc2VkID0gdHJ1ZTsKICAgICAgICAgICAgfSBlbHNlIGlmIChzLnN1YnN0cmluZyhqICsgY29udGVudC5wYXJzZWQsIGogKyBjb250ZW50LnBhcnNlZCArIDEpICE9PSAiPiIpIHsKICAgICAgICAgICAgICB0aGlzLm9uRXJyb3IoWE1MUGFyc2VyRXJyb3JDb2RlLlVudGVybWluYXRlZEVsZW1lbnQpOwogICAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgICAgfQogICAgICAgICAgICB0aGlzLm9uQmVnaW5FbGVtZW50KGNvbnRlbnQubmFtZSwgY29udGVudC5hdHRyaWJ1dGVzLCBpc0Nsb3NlZCk7CiAgICAgICAgICAgIGogKz0gY29udGVudC5wYXJzZWQgKyAoaXNDbG9zZWQgPyAyIDogMSk7CiAgICAgICAgICAgIGJyZWFrOwogICAgICAgIH0KICAgICAgfSBlbHNlIHsKICAgICAgICB3aGlsZSAoaiA8IHMubGVuZ3RoICYmIHNbal0gIT09ICI8IikgewogICAgICAgICAgaisrOwogICAgICAgIH0KICAgICAgICBjb25zdCB0ZXh0ID0gcy5zdWJzdHJpbmcoaSwgaik7CiAgICAgICAgdGhpcy5vblRleHQodGhpcy5fcmVzb2x2ZUVudGl0aWVzKHRleHQpKTsKICAgICAgfQogICAgICBpID0gajsKICAgIH0KICB9CiAgb25SZXNvbHZlRW50aXR5KG5hbWUpIHsKICAgIHJldHVybiBgJiR7bmFtZX07YDsKICB9CiAgb25QaShuYW1lLCB2YWx1ZSkge30KICBvbkNvbW1lbnQodGV4dCkge30KICBvbkNkYXRhKHRleHQpIHt9CiAgb25Eb2N0eXBlKGRvY3R5cGVDb250ZW50KSB7fQogIG9uVGV4dCh0ZXh0KSB7fQogIG9uQmVnaW5FbGVtZW50KG5hbWUsIGF0dHJpYnV0ZXMsIGlzRW1wdHkpIHt9CiAgb25FbmRFbGVtZW50KG5hbWUpIHt9CiAgb25FcnJvcihjb2RlKSB7fQp9CmV4cG9ydHMuWE1MUGFyc2VyQmFzZSA9IFhNTFBhcnNlckJhc2U7CmNsYXNzIFNpbXBsZURPTU5vZGUgewogIGNvbnN0cnVjdG9yKG5vZGVOYW1lLCBub2RlVmFsdWUpIHsKICAgIHRoaXMubm9kZU5hbWUgPSBub2RlTmFtZTsKICAgIHRoaXMubm9kZVZhbHVlID0gbm9kZVZhbHVlOwogICAgT2JqZWN0LmRlZmluZVByb3BlcnR5KHRoaXMsICJwYXJlbnROb2RlIiwgewogICAgICB2YWx1ZTogbnVsbCwKICAgICAgd3JpdGFibGU6IHRydWUKICAgIH0pOwogIH0KICBnZXQgZmlyc3RDaGlsZCgpIHsKICAgIHJldHVybiB0aGlzLmNoaWxkTm9kZXM/LlswXTsKICB9CiAgZ2V0IG5leHRTaWJsaW5nKCkgewogICAgY29uc3QgY2hpbGROb2RlcyA9IHRoaXMucGFyZW50Tm9kZS5jaGlsZE5vZGVzOwogICAgaWYgKCFjaGlsZE5vZGVzKSB7CiAgICAgIHJldHVybiB1bmRlZmluZWQ7CiAgICB9CiAgICBjb25zdCBpbmRleCA9IGNoaWxkTm9kZXMuaW5kZXhPZih0aGlzKTsKICAgIGlmIChpbmRleCA9PT0gLTEpIHsKICAgICAgcmV0dXJuIHVuZGVmaW5lZDsKICAgIH0KICAgIHJldHVybiBjaGlsZE5vZGVzW2luZGV4ICsgMV07CiAgfQogIGdldCB0ZXh0Q29udGVudCgpIHsKICAgIGlmICghdGhpcy5jaGlsZE5vZGVzKSB7CiAgICAgIHJldHVybiB0aGlzLm5vZGVWYWx1ZSB8fCAiIjsKICAgIH0KICAgIHJldHVybiB0aGlzLmNoaWxkTm9kZXMubWFwKGZ1bmN0aW9uIChjaGlsZCkgewogICAgICByZXR1cm4gY2hpbGQudGV4dENvbnRlbnQ7CiAgICB9KS5qb2luKCIiKTsKICB9CiAgZ2V0IGNoaWxkcmVuKCkgewogICAgcmV0dXJuIHRoaXMuY2hpbGROb2RlcyB8fCBbXTsKICB9CiAgaGFzQ2hpbGROb2RlcygpIHsKICAgIHJldHVybiB0aGlzLmNoaWxkTm9kZXM/Lmxlbmd0aCA+IDA7CiAgfQogIHNlYXJjaE5vZGUocGF0aHMsIHBvcykgewogICAgaWYgKHBvcyA+PSBwYXRocy5sZW5ndGgpIHsKICAgICAgcmV0dXJuIHRoaXM7CiAgICB9CiAgICBjb25zdCBjb21wb25lbnQgPSBwYXRoc1twb3NdOwogICAgaWYgKGNvbXBvbmVudC5uYW1lLnN0YXJ0c1dpdGgoIiMiKSAmJiBwb3MgPCBwYXRocy5sZW5ndGggLSAxKSB7CiAgICAgIHJldHVybiB0aGlzLnNlYXJjaE5vZGUocGF0aHMsIHBvcyArIDEpOwogICAgfQogICAgY29uc3Qgc3RhY2sgPSBbXTsKICAgIGxldCBub2RlID0gdGhpczsKICAgIHdoaWxlICh0cnVlKSB7CiAgICAgIGlmIChjb21wb25lbnQubmFtZSA9PT0gbm9kZS5ub2RlTmFtZSkgewogICAgICAgIGlmIChjb21wb25lbnQucG9zID09PSAwKSB7CiAgICAgICAgICBjb25zdCByZXMgPSBub2RlLnNlYXJjaE5vZGUocGF0aHMsIHBvcyArIDEpOwogICAgICAgICAgaWYgKHJlcyAhPT0gbnVsbCkgewogICAgICAgICAgICByZXR1cm4gcmVzOwogICAgICAgICAgfQogICAgICAgIH0gZWxzZSBpZiAoc3RhY2subGVuZ3RoID09PSAwKSB7CiAgICAgICAgICByZXR1cm4gbnVsbDsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgY29uc3QgW3BhcmVudF0gPSBzdGFjay5wb3AoKTsKICAgICAgICAgIGxldCBzaWJsaW5nUG9zID0gMDsKICAgICAgICAgIGZvciAoY29uc3QgY2hpbGQgb2YgcGFyZW50LmNoaWxkTm9kZXMpIHsKICAgICAgICAgICAgaWYgKGNvbXBvbmVudC5uYW1lID09PSBjaGlsZC5ub2RlTmFtZSkgewogICAgICAgICAgICAgIGlmIChzaWJsaW5nUG9zID09PSBjb21wb25lbnQucG9zKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gY2hpbGQuc2VhcmNoTm9kZShwYXRocywgcG9zICsgMSk7CiAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIHNpYmxpbmdQb3MrKzsKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgICAgcmV0dXJuIG5vZGUuc2VhcmNoTm9kZShwYXRocywgcG9zICsgMSk7CiAgICAgICAgfQogICAgICB9CiAgICAgIGlmIChub2RlLmNoaWxkTm9kZXM/Lmxlbmd0aCA+IDApIHsKICAgICAgICBzdGFjay5wdXNoKFtub2RlLCAwXSk7CiAgICAgICAgbm9kZSA9IG5vZGUuY2hpbGROb2Rlc1swXTsKICAgICAgfSBlbHNlIGlmIChzdGFjay5sZW5ndGggPT09IDApIHsKICAgICAgICByZXR1cm4gbnVsbDsKICAgICAgfSBlbHNlIHsKICAgICAgICB3aGlsZSAoc3RhY2subGVuZ3RoICE9PSAwKSB7CiAgICAgICAgICBjb25zdCBbcGFyZW50LCBjdXJyZW50UG9zXSA9IHN0YWNrLnBvcCgpOwogICAgICAgICAgY29uc3QgbmV3UG9zID0gY3VycmVudFBvcyArIDE7CiAgICAgICAgICBpZiAobmV3UG9zIDwgcGFyZW50LmNoaWxkTm9kZXMubGVuZ3RoKSB7CiAgICAgICAgICAgIHN0YWNrLnB1c2goW3BhcmVudCwgbmV3UG9zXSk7CiAgICAgICAgICAgIG5vZGUgPSBwYXJlbnQuY2hpbGROb2Rlc1tuZXdQb3NdOwogICAgICAgICAgICBicmVhazsKICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgaWYgKHN0YWNrLmxlbmd0aCA9PT0gMCkgewogICAgICAgICAgcmV0dXJuIG51bGw7CiAgICAgICAgfQogICAgICB9CiAgICB9CiAgfQogIGR1bXAoYnVmZmVyKSB7CiAgICBpZiAodGhpcy5ub2RlTmFtZSA9PT0gIiN0ZXh0IikgewogICAgICBidWZmZXIucHVzaCgoMCwgX2NvcmVfdXRpbHMuZW5jb2RlVG9YbWxTdHJpbmcpKHRoaXMubm9kZVZhbHVlKSk7CiAgICAgIHJldHVybjsKICAgIH0KICAgIGJ1ZmZlci5wdXNoKGA8JHt0aGlzLm5vZGVOYW1lfWApOwogICAgaWYgKHRoaXMuYXR0cmlidXRlcykgewogICAgICBmb3IgKGNvbnN0IGF0dHJpYnV0ZSBvZiB0aGlzLmF0dHJpYnV0ZXMpIHsKICAgICAgICBidWZmZXIucHVzaChgICR7YXR0cmlidXRlLm5hbWV9PSIkeygwLCBfY29yZV91dGlscy5lbmNvZGVUb1htbFN0cmluZykoYXR0cmlidXRlLnZhbHVlKX0iYCk7CiAgICAgIH0KICAgIH0KICAgIGlmICh0aGlzLmhhc0NoaWxkTm9kZXMoKSkgewogICAgICBidWZmZXIucHVzaCgiPiIpOwogICAgICBmb3IgKGNvbnN0IGNoaWxkIG9mIHRoaXMuY2hpbGROb2RlcykgewogICAgICAgIGNoaWxkLmR1bXAoYnVmZmVyKTsKICAgICAgfQogICAgICBidWZmZXIucHVzaChgPC8ke3RoaXMubm9kZU5hbWV9PmApOwogICAgfSBlbHNlIGlmICh0aGlzLm5vZGVWYWx1ZSkgewogICAgICBidWZmZXIucHVzaChgPiR7KDAsIF9jb3JlX3V0aWxzLmVuY29kZVRvWG1sU3RyaW5nKSh0aGlzLm5vZGVWYWx1ZSl9PC8ke3RoaXMubm9kZU5hbWV9PmApOwogICAgfSBlbHNlIHsKICAgICAgYnVmZmVyLnB1c2goIi8+Iik7CiAgICB9CiAgfQp9CmV4cG9ydHMuU2ltcGxlRE9NTm9kZSA9IFNpbXBsZURPTU5vZGU7CmNsYXNzIFNpbXBsZVhNTFBhcnNlciBleHRlbmRzIFhNTFBhcnNlckJhc2UgewogIGNvbnN0cnVjdG9yKHsKICAgIGhhc0F0dHJpYnV0ZXMgPSBmYWxzZSwKICAgIGxvd2VyQ2FzZU5hbWUgPSBmYWxzZQogIH0pIHsKICAgIHN1cGVyKCk7CiAgICB0aGlzLl9jdXJyZW50RnJhZ21lbnQgPSBudWxsOwogICAgdGhpcy5fc3RhY2sgPSBudWxsOwogICAgdGhpcy5fZXJyb3JDb2RlID0gWE1MUGFyc2VyRXJyb3JDb2RlLk5vRXJyb3I7CiAgICB0aGlzLl9oYXNBdHRyaWJ1dGVzID0gaGFzQXR0cmlidXRlczsKICAgIHRoaXMuX2xvd2VyQ2FzZU5hbWUgPSBsb3dlckNhc2VOYW1lOwogIH0KICBwYXJzZUZyb21TdHJpbmcoZGF0YSkgewogICAgdGhpcy5fY3VycmVudEZyYWdtZW50ID0gW107CiAgICB0aGlzLl9zdGFjayA9IFtdOwogICAgdGhpcy5fZXJyb3JDb2RlID0gWE1MUGFyc2VyRXJyb3JDb2RlLk5vRXJyb3I7CiAgICB0aGlzLnBhcnNlWG1sKGRhdGEpOwogICAgaWYgKHRoaXMuX2Vycm9yQ29kZSAhPT0gWE1MUGFyc2VyRXJyb3JDb2RlLk5vRXJyb3IpIHsKICAgICAgcmV0dXJuIHVuZGVmaW5lZDsKICAgIH0KICAgIGNvbnN0IFtkb2N1bWVudEVsZW1lbnRdID0gdGhpcy5fY3VycmVudEZyYWdtZW50OwogICAgaWYgKCFkb2N1bWVudEVsZW1lbnQpIHsKICAgICAgcmV0dXJuIHVuZGVmaW5lZDsKICAgIH0KICAgIHJldHVybiB7CiAgICAgIGRvY3VtZW50RWxlbWVudAogICAgfTsKICB9CiAgb25UZXh0KHRleHQpIHsKICAgIGlmIChpc1doaXRlc3BhY2VTdHJpbmcodGV4dCkpIHsKICAgICAgcmV0dXJuOwogICAgfQogICAgY29uc3Qgbm9kZSA9IG5ldyBTaW1wbGVET01Ob2RlKCIjdGV4dCIsIHRleHQpOwogICAgdGhpcy5fY3VycmVudEZyYWdtZW50LnB1c2gobm9kZSk7CiAgfQogIG9uQ2RhdGEodGV4dCkgewogICAgY29uc3Qgbm9kZSA9IG5ldyBTaW1wbGVET01Ob2RlKCIjdGV4dCIsIHRleHQpOwogICAgdGhpcy5fY3VycmVudEZyYWdtZW50LnB1c2gobm9kZSk7CiAgfQogIG9uQmVnaW5FbGVtZW50KG5hbWUsIGF0dHJpYnV0ZXMsIGlzRW1wdHkpIHsKICAgIGlmICh0aGlzLl9sb3dlckNhc2VOYW1lKSB7CiAgICAgIG5hbWUgPSBuYW1lLnRvTG93ZXJDYXNlKCk7CiAgICB9CiAgICBjb25zdCBub2RlID0gbmV3IFNpbXBsZURPTU5vZGUobmFtZSk7CiAgICBub2RlLmNoaWxkTm9kZXMgPSBbXTsKICAgIGlmICh0aGlzLl9oYXNBdHRyaWJ1dGVzKSB7CiAgICAgIG5vZGUuYXR0cmlidXRlcyA9IGF0dHJpYnV0ZXM7CiAgICB9CiAgICB0aGlzLl9jdXJyZW50RnJhZ21lbnQucHVzaChub2RlKTsKICAgIGlmIChpc0VtcHR5KSB7CiAgICAgIHJldHVybjsKICAgIH0KICAgIHRoaXMuX3N0YWNrLnB1c2godGhpcy5fY3VycmVudEZyYWdtZW50KTsKICAgIHRoaXMuX2N1cnJlbnRGcmFnbWVudCA9IG5vZGUuY2hpbGROb2RlczsKICB9CiAgb25FbmRFbGVtZW50KG5hbWUpIHsKICAgIHRoaXMuX2N1cnJlbnRGcmFnbWVudCA9IHRoaXMuX3N0YWNrLnBvcCgpIHx8IFtdOwogICAgY29uc3QgbGFzdEVsZW1lbnQgPSB0aGlzLl9jdXJyZW50RnJhZ21lbnQuYXQoLTEpOwogICAgaWYgKCFsYXN0RWxlbWVudCkgewogICAgICByZXR1cm4gbnVsbDsKICAgIH0KICAgIGZvciAoY29uc3QgY2hpbGROb2RlIG9mIGxhc3RFbGVtZW50LmNoaWxkTm9kZXMpIHsKICAgICAgY2hpbGROb2RlLnBhcmVudE5vZGUgPSBsYXN0RWxlbWVudDsKICAgIH0KICAgIHJldHVybiBsYXN0RWxlbWVudDsKICB9CiAgb25FcnJvcihjb2RlKSB7CiAgICB0aGlzLl9lcnJvckNvZGUgPSBjb2RlOwogIH0KfQpleHBvcnRzLlNpbXBsZVhNTFBhcnNlciA9IFNpbXBsZVhNTFBhcnNlcjsKCi8qKiovIH0pLAovKiA3MiAqLwovKioqLyAoKF9fdW51c2VkX3dlYnBhY2tfbW9kdWxlLCBleHBvcnRzLCBfX3dfcGRmanNfcmVxdWlyZV9fKSA9PiB7CgoKCk9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCAiX19lc01vZHVsZSIsICh7CiAgdmFsdWU6IHRydWUKfSkpOwpleHBvcnRzLlN0cnVjdFRyZWVSb290ID0gZXhwb3J0cy5TdHJ1Y3RUcmVlUGFnZSA9IHZvaWQgMDsKdmFyIF91dGlsID0gX193X3BkZmpzX3JlcXVpcmVfXygyKTsKdmFyIF9wcmltaXRpdmVzID0gX193X3BkZmpzX3JlcXVpcmVfXyg0KTsKdmFyIF9uYW1lX251bWJlcl90cmVlID0gX193X3BkZmpzX3JlcXVpcmVfXyg2Nyk7CnZhciBfd3JpdGVyID0gX193X3BkZmpzX3JlcXVpcmVfXyg3Myk7CmNvbnN0IE1BWF9ERVBUSCA9IDQwOwpjb25zdCBTdHJ1Y3RFbGVtZW50VHlwZSA9IHsKICBQQUdFX0NPTlRFTlQ6IDEsCiAgU1RSRUFNX0NPTlRFTlQ6IDIsCiAgT0JKRUNUOiAzLAogIEFOTk9UQVRJT046IDQsCiAgRUxFTUVOVDogNQp9OwpjbGFzcyBTdHJ1Y3RUcmVlUm9vdCB7CiAgY29uc3RydWN0b3Iocm9vdERpY3QsIHJvb3RSZWYpIHsKICAgIHRoaXMuZGljdCA9IHJvb3REaWN0OwogICAgdGhpcy5yZWYgPSByb290UmVmIGluc3RhbmNlb2YgX3ByaW1pdGl2ZXMuUmVmID8gcm9vdFJlZiA6IG51bGw7CiAgICB0aGlzLnJvbGVNYXAgPSBuZXcgTWFwKCk7CiAgICB0aGlzLnN0cnVjdFBhcmVudElkcyA9IG51bGw7CiAgfQogIGluaXQoKSB7CiAgICB0aGlzLnJlYWRSb2xlTWFwKCk7CiAgfQogICNhZGRJZFRvUGFnZShwYWdlUmVmLCBpZCwgdHlwZSkgewogICAgaWYgKCEocGFnZVJlZiBpbnN0YW5jZW9mIF9wcmltaXRpdmVzLlJlZikgfHwgaWQgPCAwKSB7CiAgICAgIHJldHVybjsKICAgIH0KICAgIHRoaXMuc3RydWN0UGFyZW50SWRzIHx8PSBuZXcgX3ByaW1pdGl2ZXMuUmVmU2V0Q2FjaGUoKTsKICAgIGxldCBpZHMgPSB0aGlzLnN0cnVjdFBhcmVudElkcy5nZXQocGFnZVJlZik7CiAgICBpZiAoIWlkcykgewogICAgICBpZHMgPSBbXTsKICAgICAgdGhpcy5zdHJ1Y3RQYXJlbnRJZHMucHV0KHBhZ2VSZWYsIGlkcyk7CiAgICB9CiAgICBpZHMucHVzaChbaWQsIHR5cGVdKTsKICB9CiAgYWRkQW5ub3RhdGlvbklkVG9QYWdlKHBhZ2VSZWYsIGlkKSB7CiAgICB0aGlzLiNhZGRJZFRvUGFnZShwYWdlUmVmLCBpZCwgU3RydWN0RWxlbWVudFR5cGUuQU5OT1RBVElPTik7CiAgfQogIHJlYWRSb2xlTWFwKCkgewogICAgY29uc3Qgcm9sZU1hcERpY3QgPSB0aGlzLmRpY3QuZ2V0KCJSb2xlTWFwIik7CiAgICBpZiAoIShyb2xlTWFwRGljdCBpbnN0YW5jZW9mIF9wcmltaXRpdmVzLkRpY3QpKSB7CiAgICAgIHJldHVybjsKICAgIH0KICAgIHJvbGVNYXBEaWN0LmZvckVhY2goKGtleSwgdmFsdWUpID0+IHsKICAgICAgaWYgKCEodmFsdWUgaW5zdGFuY2VvZiBfcHJpbWl0aXZlcy5OYW1lKSkgewogICAgICAgIHJldHVybjsKICAgICAgfQogICAgICB0aGlzLnJvbGVNYXAuc2V0KGtleSwgdmFsdWUubmFtZSk7CiAgICB9KTsKICB9CiAgc3RhdGljIGFzeW5jIGNhbkNyZWF0ZVN0cnVjdHVyZVRyZWUoewogICAgY2F0YWxvZ1JlZiwKICAgIHBkZk1hbmFnZXIsCiAgICBuZXdBbm5vdGF0aW9uc0J5UGFnZQogIH0pIHsKICAgIGlmICghKGNhdGFsb2dSZWYgaW5zdGFuY2VvZiBfcHJpbWl0aXZlcy5SZWYpKSB7CiAgICAgICgwLCBfdXRpbC53YXJuKSgiQ2Fubm90IHNhdmUgdGhlIHN0cnVjdCB0cmVlOiBubyBjYXRhbG9nIHJlZmVyZW5jZS4iKTsKICAgICAgcmV0dXJuIGZhbHNlOwogICAgfQogICAgbGV0IG5leHRLZXkgPSAwOwogICAgbGV0IGhhc05vdGhpbmdUb1VwZGF0ZSA9IHRydWU7CiAgICBmb3IgKGNvbnN0IFtwYWdlSW5kZXgsIGVsZW1lbnRzXSBvZiBuZXdBbm5vdGF0aW9uc0J5UGFnZSkgewogICAgICBjb25zdCB7CiAgICAgICAgcmVmOiBwYWdlUmVmCiAgICAgIH0gPSBhd2FpdCBwZGZNYW5hZ2VyLmdldFBhZ2UocGFnZUluZGV4KTsKICAgICAgaWYgKCEocGFnZVJlZiBpbnN0YW5jZW9mIF9wcmltaXRpdmVzLlJlZikpIHsKICAgICAgICAoMCwgX3V0aWwud2FybikoYENhbm5vdCBzYXZlIHRoZSBzdHJ1Y3QgdHJlZTogcGFnZSAke3BhZ2VJbmRleH0gaGFzIG5vIHJlZi5gKTsKICAgICAgICBoYXNOb3RoaW5nVG9VcGRhdGUgPSB0cnVlOwogICAgICAgIGJyZWFrOwogICAgICB9CiAgICAgIGZvciAoY29uc3QgZWxlbWVudCBvZiBlbGVtZW50cykgewogICAgICAgIGlmIChlbGVtZW50LmFjY2Vzc2liaWxpdHlEYXRhPy50eXBlKSB7CiAgICAgICAgICBlbGVtZW50LnBhcmVudFRyZWVJZCA9IG5leHRLZXkrKzsKICAgICAgICAgIGhhc05vdGhpbmdUb1VwZGF0ZSA9IGZhbHNlOwogICAgICAgIH0KICAgICAgfQogICAgfQogICAgaWYgKGhhc05vdGhpbmdUb1VwZGF0ZSkgewogICAgICBmb3IgKGNvbnN0IGVsZW1lbnRzIG9mIG5ld0Fubm90YXRpb25zQnlQYWdlLnZhbHVlcygpKSB7CiAgICAgICAgZm9yIChjb25zdCBlbGVtZW50IG9mIGVsZW1lbnRzKSB7CiAgICAgICAgICBkZWxldGUgZWxlbWVudC5wYXJlbnRUcmVlSWQ7CiAgICAgICAgfQogICAgICB9CiAgICAgIHJldHVybiBmYWxzZTsKICAgIH0KICAgIHJldHVybiB0cnVlOwogIH0KICBzdGF0aWMgYXN5bmMgY3JlYXRlU3RydWN0dXJlVHJlZSh7CiAgICBuZXdBbm5vdGF0aW9uc0J5UGFnZSwKICAgIHhyZWYsCiAgICBjYXRhbG9nUmVmLAogICAgcGRmTWFuYWdlciwKICAgIG5ld1JlZnMKICB9KSB7CiAgICBjb25zdCByb290ID0gcGRmTWFuYWdlci5jYXRhbG9nLmNsb25lRGljdCgpOwogICAgY29uc3Qgc3RydWN0VHJlZVJvb3RSZWYgPSB4cmVmLmdldE5ld1RlbXBvcmFyeVJlZigpOwogICAgcm9vdC5zZXQoIlN0cnVjdFRyZWVSb290Iiwgc3RydWN0VHJlZVJvb3RSZWYpOwogICAgY29uc3QgYnVmZmVyID0gW107CiAgICBhd2FpdCAoMCwgX3dyaXRlci53cml0ZU9iamVjdCkoY2F0YWxvZ1JlZiwgcm9vdCwgYnVmZmVyLCB4cmVmKTsKICAgIG5ld1JlZnMucHVzaCh7CiAgICAgIHJlZjogY2F0YWxvZ1JlZiwKICAgICAgZGF0YTogYnVmZmVyLmpvaW4oIiIpCiAgICB9KTsKICAgIGNvbnN0IHN0cnVjdFRyZWVSb290ID0gbmV3IF9wcmltaXRpdmVzLkRpY3QoeHJlZik7CiAgICBzdHJ1Y3RUcmVlUm9vdC5zZXQoIlR5cGUiLCBfcHJpbWl0aXZlcy5OYW1lLmdldCgiU3RydWN0VHJlZVJvb3QiKSk7CiAgICBjb25zdCBwYXJlbnRUcmVlUmVmID0geHJlZi5nZXROZXdUZW1wb3JhcnlSZWYoKTsKICAgIHN0cnVjdFRyZWVSb290LnNldCgiUGFyZW50VHJlZSIsIHBhcmVudFRyZWVSZWYpOwogICAgY29uc3Qga2lkcyA9IFtdOwogICAgc3RydWN0VHJlZVJvb3Quc2V0KCJLIiwga2lkcyk7CiAgICBjb25zdCBwYXJlbnRUcmVlID0gbmV3IF9wcmltaXRpdmVzLkRpY3QoeHJlZik7CiAgICBjb25zdCBudW1zID0gW107CiAgICBwYXJlbnRUcmVlLnNldCgiTnVtcyIsIG51bXMpOwogICAgY29uc3QgbmV4dEtleSA9IGF3YWl0IHRoaXMuI3dyaXRlS2lkcyh7CiAgICAgIG5ld0Fubm90YXRpb25zQnlQYWdlLAogICAgICBzdHJ1Y3RUcmVlUm9vdFJlZiwKICAgICAga2lkcywKICAgICAgbnVtcywKICAgICAgeHJlZiwKICAgICAgcGRmTWFuYWdlciwKICAgICAgbmV3UmVmcywKICAgICAgYnVmZmVyCiAgICB9KTsKICAgIHN0cnVjdFRyZWVSb290LnNldCgiUGFyZW50VHJlZU5leHRLZXkiLCBuZXh0S2V5KTsKICAgIGJ1ZmZlci5sZW5ndGggPSAwOwogICAgYXdhaXQgKDAsIF93cml0ZXIud3JpdGVPYmplY3QpKHBhcmVudFRyZWVSZWYsIHBhcmVudFRyZWUsIGJ1ZmZlciwgeHJlZik7CiAgICBuZXdSZWZzLnB1c2goewogICAgICByZWY6IHBhcmVudFRyZWVSZWYsCiAgICAgIGRhdGE6IGJ1ZmZlci5qb2luKCIiKQogICAgfSk7CiAgICBidWZmZXIubGVuZ3RoID0gMDsKICAgIGF3YWl0ICgwLCBfd3JpdGVyLndyaXRlT2JqZWN0KShzdHJ1Y3RUcmVlUm9vdFJlZiwgc3RydWN0VHJlZVJvb3QsIGJ1ZmZlciwgeHJlZik7CiAgICBuZXdSZWZzLnB1c2goewogICAgICByZWY6IHN0cnVjdFRyZWVSb290UmVmLAogICAgICBkYXRhOiBidWZmZXIuam9pbigiIikKICAgIH0pOwogIH0KICBhc3luYyBjYW5VcGRhdGVTdHJ1Y3RUcmVlKHsKICAgIHBkZk1hbmFnZXIsCiAgICBuZXdBbm5vdGF0aW9uc0J5UGFnZQogIH0pIHsKICAgIGlmICghdGhpcy5yZWYpIHsKICAgICAgKDAsIF91dGlsLndhcm4pKCJDYW5ub3QgdXBkYXRlIHRoZSBzdHJ1Y3QgdHJlZTogbm8gcm9vdCByZWZlcmVuY2UuIik7CiAgICAgIHJldHVybiBmYWxzZTsKICAgIH0KICAgIGxldCBuZXh0S2V5ID0gdGhpcy5kaWN0LmdldCgiUGFyZW50VHJlZU5leHRLZXkiKTsKICAgIGlmICghTnVtYmVyLmlzSW50ZWdlcihuZXh0S2V5KSB8fCBuZXh0S2V5IDwgMCkgewogICAgICAoMCwgX3V0aWwud2FybikoIkNhbm5vdCB1cGRhdGUgdGhlIHN0cnVjdCB0cmVlOiBpbnZhbGlkIG5leHQga2V5LiIpOwogICAgICByZXR1cm4gZmFsc2U7CiAgICB9CiAgICBjb25zdCBwYXJlbnRUcmVlID0gdGhpcy5kaWN0LmdldCgiUGFyZW50VHJlZSIpOwogICAgaWYgKCEocGFyZW50VHJlZSBpbnN0YW5jZW9mIF9wcmltaXRpdmVzLkRpY3QpKSB7CiAgICAgICgwLCBfdXRpbC53YXJuKSgiQ2Fubm90IHVwZGF0ZSB0aGUgc3RydWN0IHRyZWU6IFBhcmVudFRyZWUgaXNuJ3QgYSBkaWN0LiIpOwogICAgICByZXR1cm4gZmFsc2U7CiAgICB9CiAgICBjb25zdCBudW1zID0gcGFyZW50VHJlZS5nZXQoIk51bXMiKTsKICAgIGlmICghQXJyYXkuaXNBcnJheShudW1zKSkgewogICAgICAoMCwgX3V0aWwud2FybikoIkNhbm5vdCB1cGRhdGUgdGhlIHN0cnVjdCB0cmVlOiBudW1zIGlzbid0IGFuIGFycmF5LiIpOwogICAgICByZXR1cm4gZmFsc2U7CiAgICB9CiAgICBjb25zdCB7CiAgICAgIG51bVBhZ2VzCiAgICB9ID0gcGRmTWFuYWdlci5jYXRhbG9nOwogICAgZm9yIChjb25zdCBwYWdlSW5kZXggb2YgbmV3QW5ub3RhdGlvbnNCeVBhZ2Uua2V5cygpKSB7CiAgICAgIGNvbnN0IHsKICAgICAgICBwYWdlRGljdCwKICAgICAgICByZWY6IHBhZ2VSZWYKICAgICAgfSA9IGF3YWl0IHBkZk1hbmFnZXIuZ2V0UGFnZShwYWdlSW5kZXgpOwogICAgICBpZiAoIShwYWdlUmVmIGluc3RhbmNlb2YgX3ByaW1pdGl2ZXMuUmVmKSkgewogICAgICAgICgwLCBfdXRpbC53YXJuKShgQ2Fubm90IHNhdmUgdGhlIHN0cnVjdCB0cmVlOiBwYWdlICR7cGFnZUluZGV4fSBoYXMgbm8gcmVmLmApOwogICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgfQogICAgICBjb25zdCBpZCA9IHBhZ2VEaWN0LmdldCgiU3RydWN0UGFyZW50cyIpOwogICAgICBpZiAoIU51bWJlci5pc0ludGVnZXIoaWQpIHx8IGlkIDwgMCB8fCBpZCA+PSBudW1QYWdlcykgewogICAgICAgICgwLCBfdXRpbC53YXJuKShgQ2Fubm90IHNhdmUgdGhlIHN0cnVjdCB0cmVlOiBwYWdlICR7cGFnZUluZGV4fSBoYXMgbm8gaWQuYCk7CiAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICB9CiAgICB9CiAgICBsZXQgaGFzTm90aGluZ1RvVXBkYXRlID0gdHJ1ZTsKICAgIGZvciAoY29uc3QgW3BhZ2VJbmRleCwgZWxlbWVudHNdIG9mIG5ld0Fubm90YXRpb25zQnlQYWdlKSB7CiAgICAgIGNvbnN0IHsKICAgICAgICBwYWdlRGljdAogICAgICB9ID0gYXdhaXQgcGRmTWFuYWdlci5nZXRQYWdlKHBhZ2VJbmRleCk7CiAgICAgIFN0cnVjdFRyZWVSb290LiNjb2xsZWN0UGFyZW50cyh7CiAgICAgICAgZWxlbWVudHMsCiAgICAgICAgeHJlZjogdGhpcy5kaWN0LnhyZWYsCiAgICAgICAgcGFnZURpY3QsCiAgICAgICAgcGFyZW50VHJlZQogICAgICB9KTsKICAgICAgZm9yIChjb25zdCBlbGVtZW50IG9mIGVsZW1lbnRzKSB7CiAgICAgICAgaWYgKGVsZW1lbnQuYWNjZXNzaWJpbGl0eURhdGE/LnR5cGUpIHsKICAgICAgICAgIGVsZW1lbnQucGFyZW50VHJlZUlkID0gbmV4dEtleSsrOwogICAgICAgICAgaGFzTm90aGluZ1RvVXBkYXRlID0gZmFsc2U7CiAgICAgICAgfQogICAgICB9CiAgICB9CiAgICBpZiAoaGFzTm90aGluZ1RvVXBkYXRlKSB7CiAgICAgIGZvciAoY29uc3QgZWxlbWVudHMgb2YgbmV3QW5ub3RhdGlvbnNCeVBhZ2UudmFsdWVzKCkpIHsKICAgICAgICBmb3IgKGNvbnN0IGVsZW1lbnQgb2YgZWxlbWVudHMpIHsKICAgICAgICAgIGRlbGV0ZSBlbGVtZW50LnBhcmVudFRyZWVJZDsKICAgICAgICAgIGRlbGV0ZSBlbGVtZW50LnN0cnVjdFRyZWVQYXJlbnQ7CiAgICAgICAgfQogICAgICB9CiAgICAgIHJldHVybiBmYWxzZTsKICAgIH0KICAgIHJldHVybiB0cnVlOwogIH0KICBhc3luYyB1cGRhdGVTdHJ1Y3R1cmVUcmVlKHsKICAgIG5ld0Fubm90YXRpb25zQnlQYWdlLAogICAgcGRmTWFuYWdlciwKICAgIG5ld1JlZnMKICB9KSB7CiAgICBjb25zdCB4cmVmID0gdGhpcy5kaWN0LnhyZWY7CiAgICBjb25zdCBzdHJ1Y3RUcmVlUm9vdCA9IHRoaXMuZGljdC5jbG9uZSgpOwogICAgY29uc3Qgc3RydWN0VHJlZVJvb3RSZWYgPSB0aGlzLnJlZjsKICAgIGxldCBwYXJlbnRUcmVlUmVmID0gc3RydWN0VHJlZVJvb3QuZ2V0UmF3KCJQYXJlbnRUcmVlIik7CiAgICBsZXQgcGFyZW50VHJlZTsKICAgIGlmIChwYXJlbnRUcmVlUmVmIGluc3RhbmNlb2YgX3ByaW1pdGl2ZXMuUmVmKSB7CiAgICAgIHBhcmVudFRyZWUgPSB4cmVmLmZldGNoKHBhcmVudFRyZWVSZWYpOwogICAgfSBlbHNlIHsKICAgICAgcGFyZW50VHJlZSA9IHBhcmVudFRyZWVSZWY7CiAgICAgIHBhcmVudFRyZWVSZWYgPSB4cmVmLmdldE5ld1RlbXBvcmFyeVJlZigpOwogICAgICBzdHJ1Y3RUcmVlUm9vdC5zZXQoIlBhcmVudFRyZWUiLCBwYXJlbnRUcmVlUmVmKTsKICAgIH0KICAgIHBhcmVudFRyZWUgPSBwYXJlbnRUcmVlLmNsb25lKCk7CiAgICBsZXQgbnVtcyA9IHBhcmVudFRyZWUuZ2V0UmF3KCJOdW1zIik7CiAgICBsZXQgbnVtc1JlZiA9IG51bGw7CiAgICBpZiAobnVtcyBpbnN0YW5jZW9mIF9wcmltaXRpdmVzLlJlZikgewogICAgICBudW1zUmVmID0gbnVtczsKICAgICAgbnVtcyA9IHhyZWYuZmV0Y2gobnVtc1JlZik7CiAgICB9CiAgICBudW1zID0gbnVtcy5zbGljZSgpOwogICAgaWYgKCFudW1zUmVmKSB7CiAgICAgIHBhcmVudFRyZWUuc2V0KCJOdW1zIiwgbnVtcyk7CiAgICB9CiAgICBsZXQga2lkcyA9IHN0cnVjdFRyZWVSb290LmdldFJhdygiSyIpOwogICAgbGV0IGtpZHNSZWYgPSBudWxsOwogICAgaWYgKGtpZHMgaW5zdGFuY2VvZiBfcHJpbWl0aXZlcy5SZWYpIHsKICAgICAga2lkc1JlZiA9IGtpZHM7CiAgICAgIGtpZHMgPSB4cmVmLmZldGNoKGtpZHNSZWYpOwogICAgfSBlbHNlIHsKICAgICAga2lkc1JlZiA9IHhyZWYuZ2V0TmV3VGVtcG9yYXJ5UmVmKCk7CiAgICAgIHN0cnVjdFRyZWVSb290LnNldCgiSyIsIGtpZHNSZWYpOwogICAgfQogICAga2lkcyA9IEFycmF5LmlzQXJyYXkoa2lkcykgPyBraWRzLnNsaWNlKCkgOiBba2lkc107CiAgICBjb25zdCBidWZmZXIgPSBbXTsKICAgIGNvbnN0IG5ld05leHRrZXkgPSBhd2FpdCBTdHJ1Y3RUcmVlUm9vdC4jd3JpdGVLaWRzKHsKICAgICAgbmV3QW5ub3RhdGlvbnNCeVBhZ2UsCiAgICAgIHN0cnVjdFRyZWVSb290UmVmLAogICAgICBraWRzLAogICAgICBudW1zLAogICAgICB4cmVmLAogICAgICBwZGZNYW5hZ2VyLAogICAgICBuZXdSZWZzLAogICAgICBidWZmZXIKICAgIH0pOwogICAgc3RydWN0VHJlZVJvb3Quc2V0KCJQYXJlbnRUcmVlTmV4dEtleSIsIG5ld05leHRrZXkpOwogICAgYnVmZmVyLmxlbmd0aCA9IDA7CiAgICBhd2FpdCAoMCwgX3dyaXRlci53cml0ZU9iamVjdCkoa2lkc1JlZiwga2lkcywgYnVmZmVyLCB4cmVmKTsKICAgIG5ld1JlZnMucHVzaCh7CiAgICAgIHJlZjoga2lkc1JlZiwKICAgICAgZGF0YTogYnVmZmVyLmpvaW4oIiIpCiAgICB9KTsKICAgIGlmIChudW1zUmVmKSB7CiAgICAgIGJ1ZmZlci5sZW5ndGggPSAwOwogICAgICBhd2FpdCAoMCwgX3dyaXRlci53cml0ZU9iamVjdCkobnVtc1JlZiwgbnVtcywgYnVmZmVyLCB4cmVmKTsKICAgICAgbmV3UmVmcy5wdXNoKHsKICAgICAgICByZWY6IG51bXNSZWYsCiAgICAgICAgZGF0YTogYnVmZmVyLmpvaW4oIiIpCiAgICAgIH0pOwogICAgfQogICAgYnVmZmVyLmxlbmd0aCA9IDA7CiAgICBhd2FpdCAoMCwgX3dyaXRlci53cml0ZU9iamVjdCkocGFyZW50VHJlZVJlZiwgcGFyZW50VHJlZSwgYnVmZmVyLCB4cmVmKTsKICAgIG5ld1JlZnMucHVzaCh7CiAgICAgIHJlZjogcGFyZW50VHJlZVJlZiwKICAgICAgZGF0YTogYnVmZmVyLmpvaW4oIiIpCiAgICB9KTsKICAgIGJ1ZmZlci5sZW5ndGggPSAwOwogICAgYXdhaXQgKDAsIF93cml0ZXIud3JpdGVPYmplY3QpKHN0cnVjdFRyZWVSb290UmVmLCBzdHJ1Y3RUcmVlUm9vdCwgYnVmZmVyLCB4cmVmKTsKICAgIG5ld1JlZnMucHVzaCh7CiAgICAgIHJlZjogc3RydWN0VHJlZVJvb3RSZWYsCiAgICAgIGRhdGE6IGJ1ZmZlci5qb2luKCIiKQogICAgfSk7CiAgfQogIHN0YXRpYyBhc3luYyAjd3JpdGVLaWRzKHsKICAgIG5ld0Fubm90YXRpb25zQnlQYWdlLAogICAgc3RydWN0VHJlZVJvb3RSZWYsCiAgICBraWRzLAogICAgbnVtcywKICAgIHhyZWYsCiAgICBwZGZNYW5hZ2VyLAogICAgbmV3UmVmcywKICAgIGJ1ZmZlcgogIH0pIHsKICAgIGNvbnN0IG9ianIgPSBfcHJpbWl0aXZlcy5OYW1lLmdldCgiT0JKUiIpOwogICAgbGV0IG5leHRLZXkgPSAtSW5maW5pdHk7CiAgICBmb3IgKGNvbnN0IFtwYWdlSW5kZXgsIGVsZW1lbnRzXSBvZiBuZXdBbm5vdGF0aW9uc0J5UGFnZSkgewogICAgICBjb25zdCB7CiAgICAgICAgcmVmOiBwYWdlUmVmCiAgICAgIH0gPSBhd2FpdCBwZGZNYW5hZ2VyLmdldFBhZ2UocGFnZUluZGV4KTsKICAgICAgZm9yIChjb25zdCB7CiAgICAgICAgYWNjZXNzaWJpbGl0eURhdGE6IHsKICAgICAgICAgIHR5cGUsCiAgICAgICAgICB0aXRsZSwKICAgICAgICAgIGxhbmcsCiAgICAgICAgICBhbHQsCiAgICAgICAgICBleHBhbmRlZCwKICAgICAgICAgIGFjdHVhbFRleHQKICAgICAgICB9LAogICAgICAgIHJlZiwKICAgICAgICBwYXJlbnRUcmVlSWQsCiAgICAgICAgc3RydWN0VHJlZVBhcmVudAogICAgICB9IG9mIGVsZW1lbnRzKSB7CiAgICAgICAgbmV4dEtleSA9IE1hdGgubWF4KG5leHRLZXksIHBhcmVudFRyZWVJZCk7CiAgICAgICAgY29uc3QgdGFnUmVmID0geHJlZi5nZXROZXdUZW1wb3JhcnlSZWYoKTsKICAgICAgICBjb25zdCB0YWdEaWN0ID0gbmV3IF9wcmltaXRpdmVzLkRpY3QoeHJlZik7CiAgICAgICAgdGFnRGljdC5zZXQoIlMiLCBfcHJpbWl0aXZlcy5OYW1lLmdldCh0eXBlKSk7CiAgICAgICAgaWYgKHRpdGxlKSB7CiAgICAgICAgICB0YWdEaWN0LnNldCgiVCIsIHRpdGxlKTsKICAgICAgICB9CiAgICAgICAgaWYgKGxhbmcpIHsKICAgICAgICAgIHRhZ0RpY3Quc2V0KCJMYW5nIiwgbGFuZyk7CiAgICAgICAgfQogICAgICAgIGlmIChhbHQpIHsKICAgICAgICAgIHRhZ0RpY3Quc2V0KCJBbHQiLCBhbHQpOwogICAgICAgIH0KICAgICAgICBpZiAoZXhwYW5kZWQpIHsKICAgICAgICAgIHRhZ0RpY3Quc2V0KCJFIiwgZXhwYW5kZWQpOwogICAgICAgIH0KICAgICAgICBpZiAoYWN0dWFsVGV4dCkgewogICAgICAgICAgdGFnRGljdC5zZXQoIkFjdHVhbFRleHQiLCBhY3R1YWxUZXh0KTsKICAgICAgICB9CiAgICAgICAgaWYgKHN0cnVjdFRyZWVQYXJlbnQpIHsKICAgICAgICAgIGF3YWl0IHRoaXMuI3VwZGF0ZVBhcmVudFRhZyh7CiAgICAgICAgICAgIHN0cnVjdFRyZWVQYXJlbnQsCiAgICAgICAgICAgIHRhZ0RpY3QsCiAgICAgICAgICAgIG5ld1RhZ1JlZjogdGFnUmVmLAogICAgICAgICAgICBmYWxsYmFja1JlZjogc3RydWN0VHJlZVJvb3RSZWYsCiAgICAgICAgICAgIHhyZWYsCiAgICAgICAgICAgIG5ld1JlZnMsCiAgICAgICAgICAgIGJ1ZmZlcgogICAgICAgICAgfSk7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIHRhZ0RpY3Quc2V0KCJQIiwgc3RydWN0VHJlZVJvb3RSZWYpOwogICAgICAgIH0KICAgICAgICBjb25zdCBvYmpEaWN0ID0gbmV3IF9wcmltaXRpdmVzLkRpY3QoeHJlZik7CiAgICAgICAgdGFnRGljdC5zZXQoIksiLCBvYmpEaWN0KTsKICAgICAgICBvYmpEaWN0LnNldCgiVHlwZSIsIG9ianIpOwogICAgICAgIG9iakRpY3Quc2V0KCJQZyIsIHBhZ2VSZWYpOwogICAgICAgIG9iakRpY3Quc2V0KCJPYmoiLCByZWYpOwogICAgICAgIGJ1ZmZlci5sZW5ndGggPSAwOwogICAgICAgIGF3YWl0ICgwLCBfd3JpdGVyLndyaXRlT2JqZWN0KSh0YWdSZWYsIHRhZ0RpY3QsIGJ1ZmZlciwgeHJlZik7CiAgICAgICAgbmV3UmVmcy5wdXNoKHsKICAgICAgICAgIHJlZjogdGFnUmVmLAogICAgICAgICAgZGF0YTogYnVmZmVyLmpvaW4oIiIpCiAgICAgICAgfSk7CiAgICAgICAgbnVtcy5wdXNoKHBhcmVudFRyZWVJZCwgdGFnUmVmKTsKICAgICAgICBraWRzLnB1c2godGFnUmVmKTsKICAgICAgfQogICAgfQogICAgcmV0dXJuIG5leHRLZXkgKyAxOwogIH0KICBzdGF0aWMgI2NvbGxlY3RQYXJlbnRzKHsKICAgIGVsZW1lbnRzLAogICAgeHJlZiwKICAgIHBhZ2VEaWN0LAogICAgcGFyZW50VHJlZQogIH0pIHsKICAgIGNvbnN0IGlkVG9FbGVtZW50ID0gbmV3IE1hcCgpOwogICAgZm9yIChjb25zdCBlbGVtZW50IG9mIGVsZW1lbnRzKSB7CiAgICAgIGlmIChlbGVtZW50LnN0cnVjdFRyZWVQYXJlbnRJZCkgewogICAgICAgIGNvbnN0IGlkID0gcGFyc2VJbnQoZWxlbWVudC5zdHJ1Y3RUcmVlUGFyZW50SWQuc3BsaXQoIl9tYyIpWzFdLCAxMCk7CiAgICAgICAgaWRUb0VsZW1lbnQuc2V0KGlkLCBlbGVtZW50KTsKICAgICAgfQogICAgfQogICAgY29uc3QgaWQgPSBwYWdlRGljdC5nZXQoIlN0cnVjdFBhcmVudHMiKTsKICAgIGNvbnN0IG51bWJlclRyZWUgPSBuZXcgX25hbWVfbnVtYmVyX3RyZWUuTnVtYmVyVHJlZShwYXJlbnRUcmVlLCB4cmVmKTsKICAgIGNvbnN0IHBhcmVudEFycmF5ID0gbnVtYmVyVHJlZS5nZXQoaWQpOwogICAgaWYgKCFBcnJheS5pc0FycmF5KHBhcmVudEFycmF5KSkgewogICAgICByZXR1cm47CiAgICB9CiAgICBjb25zdCB1cGRhdGVFbGVtZW50ID0gKGtpZCwgcGFnZUtpZCwga2lkUmVmKSA9PiB7CiAgICAgIGNvbnN0IGVsZW1lbnQgPSBpZFRvRWxlbWVudC5nZXQoa2lkKTsKICAgICAgaWYgKGVsZW1lbnQpIHsKICAgICAgICBjb25zdCBwYXJlbnRSZWYgPSBwYWdlS2lkLmdldFJhdygiUCIpOwogICAgICAgIGNvbnN0IHBhcmVudERpY3QgPSB4cmVmLmZldGNoSWZSZWYocGFyZW50UmVmKTsKICAgICAgICBpZiAocGFyZW50UmVmIGluc3RhbmNlb2YgX3ByaW1pdGl2ZXMuUmVmICYmIHBhcmVudERpY3QgaW5zdGFuY2VvZiBfcHJpbWl0aXZlcy5EaWN0KSB7CiAgICAgICAgICBlbGVtZW50LnN0cnVjdFRyZWVQYXJlbnQgPSB7CiAgICAgICAgICAgIHJlZjoga2lkUmVmLAogICAgICAgICAgICBkaWN0OiBwYWdlS2lkCiAgICAgICAgICB9OwogICAgICAgIH0KICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgfQogICAgICByZXR1cm4gZmFsc2U7CiAgICB9OwogICAgZm9yIChjb25zdCBraWRSZWYgb2YgcGFyZW50QXJyYXkpIHsKICAgICAgaWYgKCEoa2lkUmVmIGluc3RhbmNlb2YgX3ByaW1pdGl2ZXMuUmVmKSkgewogICAgICAgIGNvbnRpbnVlOwogICAgICB9CiAgICAgIGNvbnN0IHBhZ2VLaWQgPSB4cmVmLmZldGNoKGtpZFJlZik7CiAgICAgIGNvbnN0IGsgPSBwYWdlS2lkLmdldCgiSyIpOwogICAgICBpZiAoTnVtYmVyLmlzSW50ZWdlcihrKSkgewogICAgICAgIHVwZGF0ZUVsZW1lbnQoaywgcGFnZUtpZCwga2lkUmVmKTsKICAgICAgICBjb250aW51ZTsKICAgICAgfQogICAgICBpZiAoIUFycmF5LmlzQXJyYXkoaykpIHsKICAgICAgICBjb250aW51ZTsKICAgICAgfQogICAgICBmb3IgKGxldCBraWQgb2YgaykgewogICAgICAgIGtpZCA9IHhyZWYuZmV0Y2hJZlJlZihraWQpOwogICAgICAgIGlmIChOdW1iZXIuaXNJbnRlZ2VyKGtpZCkgJiYgdXBkYXRlRWxlbWVudChraWQsIHBhZ2VLaWQsIGtpZFJlZikpIHsKICAgICAgICAgIGJyZWFrOwogICAgICAgIH0KICAgICAgfQogICAgfQogIH0KICBzdGF0aWMgYXN5bmMgI3VwZGF0ZVBhcmVudFRhZyh7CiAgICBzdHJ1Y3RUcmVlUGFyZW50OiB7CiAgICAgIHJlZiwKICAgICAgZGljdAogICAgfSwKICAgIHRhZ0RpY3QsCiAgICBuZXdUYWdSZWYsCiAgICBmYWxsYmFja1JlZiwKICAgIHhyZWYsCiAgICBuZXdSZWZzLAogICAgYnVmZmVyCiAgfSkgewogICAgY29uc3QgcGFyZW50UmVmID0gZGljdC5nZXRSYXcoIlAiKTsKICAgIGxldCBwYXJlbnREaWN0ID0geHJlZi5mZXRjaElmUmVmKHBhcmVudFJlZik7CiAgICB0YWdEaWN0LnNldCgiUCIsIHBhcmVudFJlZik7CiAgICBsZXQgc2F2ZVBhcmVudERpY3QgPSBmYWxzZTsKICAgIGxldCBwYXJlbnRLaWRzOwogICAgbGV0IHBhcmVudEtpZHNSZWYgPSBwYXJlbnREaWN0LmdldFJhdygiSyIpOwogICAgaWYgKCEocGFyZW50S2lkc1JlZiBpbnN0YW5jZW9mIF9wcmltaXRpdmVzLlJlZikpIHsKICAgICAgcGFyZW50S2lkcyA9IHBhcmVudEtpZHNSZWY7CiAgICAgIHBhcmVudEtpZHNSZWYgPSB4cmVmLmdldE5ld1RlbXBvcmFyeVJlZigpOwogICAgICBwYXJlbnREaWN0ID0gcGFyZW50RGljdC5jbG9uZSgpOwogICAgICBwYXJlbnREaWN0LnNldCgiSyIsIHBhcmVudEtpZHNSZWYpOwogICAgICBzYXZlUGFyZW50RGljdCA9IHRydWU7CiAgICB9IGVsc2UgewogICAgICBwYXJlbnRLaWRzID0geHJlZi5mZXRjaChwYXJlbnRLaWRzUmVmKTsKICAgIH0KICAgIGlmIChBcnJheS5pc0FycmF5KHBhcmVudEtpZHMpKSB7CiAgICAgIGNvbnN0IGluZGV4ID0gcGFyZW50S2lkcy5pbmRleE9mKHJlZik7CiAgICAgIGlmIChpbmRleCA+PSAwKSB7CiAgICAgICAgcGFyZW50S2lkcyA9IHBhcmVudEtpZHMuc2xpY2UoKTsKICAgICAgICBwYXJlbnRLaWRzLnNwbGljZShpbmRleCArIDEsIDAsIG5ld1RhZ1JlZik7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgKDAsIF91dGlsLndhcm4pKCJDYW5ub3QgdXBkYXRlIHRoZSBzdHJ1Y3QgdHJlZTogcGFyZW50IGtpZCBub3QgZm91bmQuIik7CiAgICAgICAgdGFnRGljdC5zZXQoIlAiLCBmYWxsYmFja1JlZik7CiAgICAgICAgcmV0dXJuOwogICAgICB9CiAgICB9IGVsc2UgaWYgKHBhcmVudEtpZHMgaW5zdGFuY2VvZiBfcHJpbWl0aXZlcy5EaWN0KSB7CiAgICAgIHBhcmVudEtpZHMgPSBbcGFyZW50S2lkc1JlZiwgbmV3VGFnUmVmXTsKICAgICAgcGFyZW50S2lkc1JlZiA9IHhyZWYuZ2V0TmV3VGVtcG9yYXJ5UmVmKCk7CiAgICAgIHBhcmVudERpY3Quc2V0KCJLIiwgcGFyZW50S2lkc1JlZik7CiAgICAgIHNhdmVQYXJlbnREaWN0ID0gdHJ1ZTsKICAgIH0KICAgIGJ1ZmZlci5sZW5ndGggPSAwOwogICAgYXdhaXQgKDAsIF93cml0ZXIud3JpdGVPYmplY3QpKHBhcmVudEtpZHNSZWYsIHBhcmVudEtpZHMsIGJ1ZmZlciwgeHJlZik7CiAgICBuZXdSZWZzLnB1c2goewogICAgICByZWY6IHBhcmVudEtpZHNSZWYsCiAgICAgIGRhdGE6IGJ1ZmZlci5qb2luKCIiKQogICAgfSk7CiAgICBpZiAoIXNhdmVQYXJlbnREaWN0KSB7CiAgICAgIHJldHVybjsKICAgIH0KICAgIGJ1ZmZlci5sZW5ndGggPSAwOwogICAgYXdhaXQgKDAsIF93cml0ZXIud3JpdGVPYmplY3QpKHBhcmVudFJlZiwgcGFyZW50RGljdCwgYnVmZmVyLCB4cmVmKTsKICAgIG5ld1JlZnMucHVzaCh7CiAgICAgIHJlZjogcGFyZW50UmVmLAogICAgICBkYXRhOiBidWZmZXIuam9pbigiIikKICAgIH0pOwogIH0KfQpleHBvcnRzLlN0cnVjdFRyZWVSb290ID0gU3RydWN0VHJlZVJvb3Q7CmNsYXNzIFN0cnVjdEVsZW1lbnROb2RlIHsKICBjb25zdHJ1Y3Rvcih0cmVlLCBkaWN0KSB7CiAgICB0aGlzLnRyZWUgPSB0cmVlOwogICAgdGhpcy5kaWN0ID0gZGljdDsKICAgIHRoaXMua2lkcyA9IFtdOwogICAgdGhpcy5wYXJzZUtpZHMoKTsKICB9CiAgZ2V0IHJvbGUoKSB7CiAgICBjb25zdCBuYW1lT2JqID0gdGhpcy5kaWN0LmdldCgiUyIpOwogICAgY29uc3QgbmFtZSA9IG5hbWVPYmogaW5zdGFuY2VvZiBfcHJpbWl0aXZlcy5OYW1lID8gbmFtZU9iai5uYW1lIDogIiI7CiAgICBjb25zdCB7CiAgICAgIHJvb3QKICAgIH0gPSB0aGlzLnRyZWU7CiAgICBpZiAocm9vdC5yb2xlTWFwLmhhcyhuYW1lKSkgewogICAgICByZXR1cm4gcm9vdC5yb2xlTWFwLmdldChuYW1lKTsKICAgIH0KICAgIHJldHVybiBuYW1lOwogIH0KICBwYXJzZUtpZHMoKSB7CiAgICBsZXQgcGFnZU9iaklkID0gbnVsbDsKICAgIGNvbnN0IG9ialJlZiA9IHRoaXMuZGljdC5nZXRSYXcoIlBnIik7CiAgICBpZiAob2JqUmVmIGluc3RhbmNlb2YgX3ByaW1pdGl2ZXMuUmVmKSB7CiAgICAgIHBhZ2VPYmpJZCA9IG9ialJlZi50b1N0cmluZygpOwogICAgfQogICAgY29uc3Qga2lkcyA9IHRoaXMuZGljdC5nZXQoIksiKTsKICAgIGlmIChBcnJheS5pc0FycmF5KGtpZHMpKSB7CiAgICAgIGZvciAoY29uc3Qga2lkIG9mIGtpZHMpIHsKICAgICAgICBjb25zdCBlbGVtZW50ID0gdGhpcy5wYXJzZUtpZChwYWdlT2JqSWQsIGtpZCk7CiAgICAgICAgaWYgKGVsZW1lbnQpIHsKICAgICAgICAgIHRoaXMua2lkcy5wdXNoKGVsZW1lbnQpOwogICAgICAgIH0KICAgICAgfQogICAgfSBlbHNlIHsKICAgICAgY29uc3QgZWxlbWVudCA9IHRoaXMucGFyc2VLaWQocGFnZU9iaklkLCBraWRzKTsKICAgICAgaWYgKGVsZW1lbnQpIHsKICAgICAgICB0aGlzLmtpZHMucHVzaChlbGVtZW50KTsKICAgICAgfQogICAgfQogIH0KICBwYXJzZUtpZChwYWdlT2JqSWQsIGtpZCkgewogICAgaWYgKE51bWJlci5pc0ludGVnZXIoa2lkKSkgewogICAgICBpZiAodGhpcy50cmVlLnBhZ2VEaWN0Lm9iaklkICE9PSBwYWdlT2JqSWQpIHsKICAgICAgICByZXR1cm4gbnVsbDsKICAgICAgfQogICAgICByZXR1cm4gbmV3IFN0cnVjdEVsZW1lbnQoewogICAgICAgIHR5cGU6IFN0cnVjdEVsZW1lbnRUeXBlLlBBR0VfQ09OVEVOVCwKICAgICAgICBtY2lkOiBraWQsCiAgICAgICAgcGFnZU9iaklkCiAgICAgIH0pOwogICAgfQogICAgbGV0IGtpZERpY3QgPSBudWxsOwogICAgaWYgKGtpZCBpbnN0YW5jZW9mIF9wcmltaXRpdmVzLlJlZikgewogICAgICBraWREaWN0ID0gdGhpcy5kaWN0LnhyZWYuZmV0Y2goa2lkKTsKICAgIH0gZWxzZSBpZiAoa2lkIGluc3RhbmNlb2YgX3ByaW1pdGl2ZXMuRGljdCkgewogICAgICBraWREaWN0ID0ga2lkOwogICAgfQogICAgaWYgKCFraWREaWN0KSB7CiAgICAgIHJldHVybiBudWxsOwogICAgfQogICAgY29uc3QgcGFnZVJlZiA9IGtpZERpY3QuZ2V0UmF3KCJQZyIpOwogICAgaWYgKHBhZ2VSZWYgaW5zdGFuY2VvZiBfcHJpbWl0aXZlcy5SZWYpIHsKICAgICAgcGFnZU9iaklkID0gcGFnZVJlZi50b1N0cmluZygpOwogICAgfQogICAgY29uc3QgdHlwZSA9IGtpZERpY3QuZ2V0KCJUeXBlIikgaW5zdGFuY2VvZiBfcHJpbWl0aXZlcy5OYW1lID8ga2lkRGljdC5nZXQoIlR5cGUiKS5uYW1lIDogbnVsbDsKICAgIGlmICh0eXBlID09PSAiTUNSIikgewogICAgICBpZiAodGhpcy50cmVlLnBhZ2VEaWN0Lm9iaklkICE9PSBwYWdlT2JqSWQpIHsKICAgICAgICByZXR1cm4gbnVsbDsKICAgICAgfQogICAgICBjb25zdCBraWRSZWYgPSBraWREaWN0LmdldFJhdygiU3RtIik7CiAgICAgIHJldHVybiBuZXcgU3RydWN0RWxlbWVudCh7CiAgICAgICAgdHlwZTogU3RydWN0RWxlbWVudFR5cGUuU1RSRUFNX0NPTlRFTlQsCiAgICAgICAgcmVmT2JqSWQ6IGtpZFJlZiBpbnN0YW5jZW9mIF9wcmltaXRpdmVzLlJlZiA/IGtpZFJlZi50b1N0cmluZygpIDogbnVsbCwKICAgICAgICBwYWdlT2JqSWQsCiAgICAgICAgbWNpZDoga2lkRGljdC5nZXQoIk1DSUQiKQogICAgICB9KTsKICAgIH0KICAgIGlmICh0eXBlID09PSAiT0JKUiIpIHsKICAgICAgaWYgKHRoaXMudHJlZS5wYWdlRGljdC5vYmpJZCAhPT0gcGFnZU9iaklkKSB7CiAgICAgICAgcmV0dXJuIG51bGw7CiAgICAgIH0KICAgICAgY29uc3Qga2lkUmVmID0ga2lkRGljdC5nZXRSYXcoIk9iaiIpOwogICAgICByZXR1cm4gbmV3IFN0cnVjdEVsZW1lbnQoewogICAgICAgIHR5cGU6IFN0cnVjdEVsZW1lbnRUeXBlLk9CSkVDVCwKICAgICAgICByZWZPYmpJZDoga2lkUmVmIGluc3RhbmNlb2YgX3ByaW1pdGl2ZXMuUmVmID8ga2lkUmVmLnRvU3RyaW5nKCkgOiBudWxsLAogICAgICAgIHBhZ2VPYmpJZAogICAgICB9KTsKICAgIH0KICAgIHJldHVybiBuZXcgU3RydWN0RWxlbWVudCh7CiAgICAgIHR5cGU6IFN0cnVjdEVsZW1lbnRUeXBlLkVMRU1FTlQsCiAgICAgIGRpY3Q6IGtpZERpY3QKICAgIH0pOwogIH0KfQpjbGFzcyBTdHJ1Y3RFbGVtZW50IHsKICBjb25zdHJ1Y3Rvcih7CiAgICB0eXBlLAogICAgZGljdCA9IG51bGwsCiAgICBtY2lkID0gbnVsbCwKICAgIHBhZ2VPYmpJZCA9IG51bGwsCiAgICByZWZPYmpJZCA9IG51bGwKICB9KSB7CiAgICB0aGlzLnR5cGUgPSB0eXBlOwogICAgdGhpcy5kaWN0ID0gZGljdDsKICAgIHRoaXMubWNpZCA9IG1jaWQ7CiAgICB0aGlzLnBhZ2VPYmpJZCA9IHBhZ2VPYmpJZDsKICAgIHRoaXMucmVmT2JqSWQgPSByZWZPYmpJZDsKICAgIHRoaXMucGFyZW50Tm9kZSA9IG51bGw7CiAgfQp9CmNsYXNzIFN0cnVjdFRyZWVQYWdlIHsKICBjb25zdHJ1Y3RvcihzdHJ1Y3RUcmVlUm9vdCwgcGFnZURpY3QpIHsKICAgIHRoaXMucm9vdCA9IHN0cnVjdFRyZWVSb290OwogICAgdGhpcy5yb290RGljdCA9IHN0cnVjdFRyZWVSb290ID8gc3RydWN0VHJlZVJvb3QuZGljdCA6IG51bGw7CiAgICB0aGlzLnBhZ2VEaWN0ID0gcGFnZURpY3Q7CiAgICB0aGlzLm5vZGVzID0gW107CiAgfQogIHBhcnNlKHBhZ2VSZWYpIHsKICAgIGlmICghdGhpcy5yb290IHx8ICF0aGlzLnJvb3REaWN0KSB7CiAgICAgIHJldHVybjsKICAgIH0KICAgIGNvbnN0IHBhcmVudFRyZWUgPSB0aGlzLnJvb3REaWN0LmdldCgiUGFyZW50VHJlZSIpOwogICAgaWYgKCFwYXJlbnRUcmVlKSB7CiAgICAgIHJldHVybjsKICAgIH0KICAgIGNvbnN0IGlkID0gdGhpcy5wYWdlRGljdC5nZXQoIlN0cnVjdFBhcmVudHMiKTsKICAgIGNvbnN0IGlkcyA9IHBhZ2VSZWYgaW5zdGFuY2VvZiBfcHJpbWl0aXZlcy5SZWYgJiYgdGhpcy5yb290LnN0cnVjdFBhcmVudElkcz8uZ2V0KHBhZ2VSZWYpOwogICAgaWYgKCFOdW1iZXIuaXNJbnRlZ2VyKGlkKSAmJiAhaWRzKSB7CiAgICAgIHJldHVybjsKICAgIH0KICAgIGNvbnN0IG1hcCA9IG5ldyBNYXAoKTsKICAgIGNvbnN0IG51bWJlclRyZWUgPSBuZXcgX25hbWVfbnVtYmVyX3RyZWUuTnVtYmVyVHJlZShwYXJlbnRUcmVlLCB0aGlzLnJvb3REaWN0LnhyZWYpOwogICAgaWYgKE51bWJlci5pc0ludGVnZXIoaWQpKSB7CiAgICAgIGNvbnN0IHBhcmVudEFycmF5ID0gbnVtYmVyVHJlZS5nZXQoaWQpOwogICAgICBpZiAoQXJyYXkuaXNBcnJheShwYXJlbnRBcnJheSkpIHsKICAgICAgICBmb3IgKGNvbnN0IHJlZiBvZiBwYXJlbnRBcnJheSkgewogICAgICAgICAgaWYgKHJlZiBpbnN0YW5jZW9mIF9wcmltaXRpdmVzLlJlZikgewogICAgICAgICAgICB0aGlzLmFkZE5vZGUodGhpcy5yb290RGljdC54cmVmLmZldGNoKHJlZiksIG1hcCk7CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICB9CiAgICB9CiAgICBpZiAoIWlkcykgewogICAgICByZXR1cm47CiAgICB9CiAgICBmb3IgKGNvbnN0IFtlbGVtSWQsIHR5cGVdIG9mIGlkcykgewogICAgICBjb25zdCBvYmogPSBudW1iZXJUcmVlLmdldChlbGVtSWQpOwogICAgICBpZiAob2JqKSB7CiAgICAgICAgY29uc3QgZWxlbSA9IHRoaXMuYWRkTm9kZSh0aGlzLnJvb3REaWN0LnhyZWYuZmV0Y2hJZlJlZihvYmopLCBtYXApOwogICAgICAgIGlmIChlbGVtPy5raWRzPy5sZW5ndGggPT09IDEgJiYgZWxlbS5raWRzWzBdLnR5cGUgPT09IFN0cnVjdEVsZW1lbnRUeXBlLk9CSkVDVCkgewogICAgICAgICAgZWxlbS5raWRzWzBdLnR5cGUgPSB0eXBlOwogICAgICAgIH0KICAgICAgfQogICAgfQogIH0KICBhZGROb2RlKGRpY3QsIG1hcCwgbGV2ZWwgPSAwKSB7CiAgICBpZiAobGV2ZWwgPiBNQVhfREVQVEgpIHsKICAgICAgKDAsIF91dGlsLndhcm4pKCJTdHJ1Y3RUcmVlIE1BWF9ERVBUSCByZWFjaGVkLiIpOwogICAgICByZXR1cm4gbnVsbDsKICAgIH0KICAgIGlmIChtYXAuaGFzKGRpY3QpKSB7CiAgICAgIHJldHVybiBtYXAuZ2V0KGRpY3QpOwogICAgfQogICAgY29uc3QgZWxlbWVudCA9IG5ldyBTdHJ1Y3RFbGVtZW50Tm9kZSh0aGlzLCBkaWN0KTsKICAgIG1hcC5zZXQoZGljdCwgZWxlbWVudCk7CiAgICBjb25zdCBwYXJlbnQgPSBkaWN0LmdldCgiUCIpOwogICAgaWYgKCFwYXJlbnQgfHwgKDAsIF9wcmltaXRpdmVzLmlzTmFtZSkocGFyZW50LmdldCgiVHlwZSIpLCAiU3RydWN0VHJlZVJvb3QiKSkgewogICAgICBpZiAoIXRoaXMuYWRkVG9wTGV2ZWxOb2RlKGRpY3QsIGVsZW1lbnQpKSB7CiAgICAgICAgbWFwLmRlbGV0ZShkaWN0KTsKICAgICAgfQogICAgICByZXR1cm4gZWxlbWVudDsKICAgIH0KICAgIGNvbnN0IHBhcmVudE5vZGUgPSB0aGlzLmFkZE5vZGUocGFyZW50LCBtYXAsIGxldmVsICsgMSk7CiAgICBpZiAoIXBhcmVudE5vZGUpIHsKICAgICAgcmV0dXJuIGVsZW1lbnQ7CiAgICB9CiAgICBsZXQgc2F2ZSA9IGZhbHNlOwogICAgZm9yIChjb25zdCBraWQgb2YgcGFyZW50Tm9kZS5raWRzKSB7CiAgICAgIGlmIChraWQudHlwZSA9PT0gU3RydWN0RWxlbWVudFR5cGUuRUxFTUVOVCAmJiBraWQuZGljdCA9PT0gZGljdCkgewogICAgICAgIGtpZC5wYXJlbnROb2RlID0gZWxlbWVudDsKICAgICAgICBzYXZlID0gdHJ1ZTsKICAgICAgfQogICAgfQogICAgaWYgKCFzYXZlKSB7CiAgICAgIG1hcC5kZWxldGUoZGljdCk7CiAgICB9CiAgICByZXR1cm4gZWxlbWVudDsKICB9CiAgYWRkVG9wTGV2ZWxOb2RlKGRpY3QsIGVsZW1lbnQpIHsKICAgIGNvbnN0IG9iaiA9IHRoaXMucm9vdERpY3QuZ2V0KCJLIik7CiAgICBpZiAoIW9iaikgewogICAgICByZXR1cm4gZmFsc2U7CiAgICB9CiAgICBpZiAob2JqIGluc3RhbmNlb2YgX3ByaW1pdGl2ZXMuRGljdCkgewogICAgICBpZiAob2JqLm9iaklkICE9PSBkaWN0Lm9iaklkKSB7CiAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICB9CiAgICAgIHRoaXMubm9kZXNbMF0gPSBlbGVtZW50OwogICAgICByZXR1cm4gdHJ1ZTsKICAgIH0KICAgIGlmICghQXJyYXkuaXNBcnJheShvYmopKSB7CiAgICAgIHJldHVybiB0cnVlOwogICAgfQogICAgbGV0IHNhdmUgPSBmYWxzZTsKICAgIGZvciAobGV0IGkgPSAwOyBpIDwgb2JqLmxlbmd0aDsgaSsrKSB7CiAgICAgIGNvbnN0IGtpZFJlZiA9IG9ialtpXTsKICAgICAgaWYgKGtpZFJlZj8udG9TdHJpbmcoKSA9PT0gZGljdC5vYmpJZCkgewogICAgICAgIHRoaXMubm9kZXNbaV0gPSBlbGVtZW50OwogICAgICAgIHNhdmUgPSB0cnVlOwogICAgICB9CiAgICB9CiAgICByZXR1cm4gc2F2ZTsKICB9CiAgZ2V0IHNlcmlhbGl6YWJsZSgpIHsKICAgIGZ1bmN0aW9uIG5vZGVUb1NlcmlhbGl6YWJsZShub2RlLCBwYXJlbnQsIGxldmVsID0gMCkgewogICAgICBpZiAobGV2ZWwgPiBNQVhfREVQVEgpIHsKICAgICAgICAoMCwgX3V0aWwud2FybikoIlN0cnVjdFRyZWUgdG9vIGRlZXAgdG8gYmUgZnVsbHkgc2VyaWFsaXplZC4iKTsKICAgICAgICByZXR1cm47CiAgICAgIH0KICAgICAgY29uc3Qgb2JqID0gT2JqZWN0LmNyZWF0ZShudWxsKTsKICAgICAgb2JqLnJvbGUgPSBub2RlLnJvbGU7CiAgICAgIG9iai5jaGlsZHJlbiA9IFtdOwogICAgICBwYXJlbnQuY2hpbGRyZW4ucHVzaChvYmopOwogICAgICBjb25zdCBhbHQgPSBub2RlLmRpY3QuZ2V0KCJBbHQiKTsKICAgICAgaWYgKHR5cGVvZiBhbHQgPT09ICJzdHJpbmciKSB7CiAgICAgICAgb2JqLmFsdCA9ICgwLCBfdXRpbC5zdHJpbmdUb1BERlN0cmluZykoYWx0KTsKICAgICAgfQogICAgICBjb25zdCBsYW5nID0gbm9kZS5kaWN0LmdldCgiTGFuZyIpOwogICAgICBpZiAodHlwZW9mIGxhbmcgPT09ICJzdHJpbmciKSB7CiAgICAgICAgb2JqLmxhbmcgPSAoMCwgX3V0aWwuc3RyaW5nVG9QREZTdHJpbmcpKGxhbmcpOwogICAgICB9CiAgICAgIGZvciAoY29uc3Qga2lkIG9mIG5vZGUua2lkcykgewogICAgICAgIGNvbnN0IGtpZEVsZW1lbnQgPSBraWQudHlwZSA9PT0gU3RydWN0RWxlbWVudFR5cGUuRUxFTUVOVCA/IGtpZC5wYXJlbnROb2RlIDogbnVsbDsKICAgICAgICBpZiAoa2lkRWxlbWVudCkgewogICAgICAgICAgbm9kZVRvU2VyaWFsaXphYmxlKGtpZEVsZW1lbnQsIG9iaiwgbGV2ZWwgKyAxKTsKICAgICAgICAgIGNvbnRpbnVlOwogICAgICAgIH0gZWxzZSBpZiAoa2lkLnR5cGUgPT09IFN0cnVjdEVsZW1lbnRUeXBlLlBBR0VfQ09OVEVOVCB8fCBraWQudHlwZSA9PT0gU3RydWN0RWxlbWVudFR5cGUuU1RSRUFNX0NPTlRFTlQpIHsKICAgICAgICAgIG9iai5jaGlsZHJlbi5wdXNoKHsKICAgICAgICAgICAgdHlwZTogImNvbnRlbnQiLAogICAgICAgICAgICBpZDogYHAke2tpZC5wYWdlT2JqSWR9X21jJHtraWQubWNpZH1gCiAgICAgICAgICB9KTsKICAgICAgICB9IGVsc2UgaWYgKGtpZC50eXBlID09PSBTdHJ1Y3RFbGVtZW50VHlwZS5PQkpFQ1QpIHsKICAgICAgICAgIG9iai5jaGlsZHJlbi5wdXNoKHsKICAgICAgICAgICAgdHlwZTogIm9iamVjdCIsCiAgICAgICAgICAgIGlkOiBraWQucmVmT2JqSWQKICAgICAgICAgIH0pOwogICAgICAgIH0gZWxzZSBpZiAoa2lkLnR5cGUgPT09IFN0cnVjdEVsZW1lbnRUeXBlLkFOTk9UQVRJT04pIHsKICAgICAgICAgIG9iai5jaGlsZHJlbi5wdXNoKHsKICAgICAgICAgICAgdHlwZTogImFubm90YXRpb24iLAogICAgICAgICAgICBpZDogYCR7X3V0aWwuQW5ub3RhdGlvblByZWZpeH0ke2tpZC5yZWZPYmpJZH1gCiAgICAgICAgICB9KTsKICAgICAgICB9CiAgICAgIH0KICAgIH0KICAgIGNvbnN0IHJvb3QgPSBPYmplY3QuY3JlYXRlKG51bGwpOwogICAgcm9vdC5jaGlsZHJlbiA9IFtdOwogICAgcm9vdC5yb2xlID0gIlJvb3QiOwogICAgZm9yIChjb25zdCBjaGlsZCBvZiB0aGlzLm5vZGVzKSB7CiAgICAgIGlmICghY2hpbGQpIHsKICAgICAgICBjb250aW51ZTsKICAgICAgfQogICAgICBub2RlVG9TZXJpYWxpemFibGUoY2hpbGQsIHJvb3QpOwogICAgfQogICAgcmV0dXJuIHJvb3Q7CiAgfQp9CmV4cG9ydHMuU3RydWN0VHJlZVBhZ2UgPSBTdHJ1Y3RUcmVlUGFnZTsKCi8qKiovIH0pLAovKiA3MyAqLwovKioqLyAoKF9fdW51c2VkX3dlYnBhY2tfbW9kdWxlLCBleHBvcnRzLCBfX3dfcGRmanNfcmVxdWlyZV9fKSA9PiB7CgoKCk9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCAiX19lc01vZHVsZSIsICh7CiAgdmFsdWU6IHRydWUKfSkpOwpleHBvcnRzLmluY3JlbWVudGFsVXBkYXRlID0gaW5jcmVtZW50YWxVcGRhdGU7CmV4cG9ydHMud3JpdGVEaWN0ID0gd3JpdGVEaWN0OwpleHBvcnRzLndyaXRlT2JqZWN0ID0gd3JpdGVPYmplY3Q7CnZhciBfdXRpbCA9IF9fd19wZGZqc19yZXF1aXJlX18oMik7CnZhciBfcHJpbWl0aXZlcyA9IF9fd19wZGZqc19yZXF1aXJlX18oNCk7CnZhciBfY29yZV91dGlscyA9IF9fd19wZGZqc19yZXF1aXJlX18oMyk7CnZhciBfeG1sX3BhcnNlciA9IF9fd19wZGZqc19yZXF1aXJlX18oNzEpOwp2YXIgX2Jhc2Vfc3RyZWFtID0gX193X3BkZmpzX3JlcXVpcmVfXyg1KTsKdmFyIF9jcnlwdG8gPSBfX3dfcGRmanNfcmVxdWlyZV9fKDc0KTsKYXN5bmMgZnVuY3Rpb24gd3JpdGVPYmplY3QocmVmLCBvYmosIGJ1ZmZlciwgewogIGVuY3J5cHQgPSBudWxsCn0pIHsKICBjb25zdCB0cmFuc2Zvcm0gPSBlbmNyeXB0Py5jcmVhdGVDaXBoZXJUcmFuc2Zvcm0ocmVmLm51bSwgcmVmLmdlbik7CiAgYnVmZmVyLnB1c2goYCR7cmVmLm51bX0gJHtyZWYuZ2VufSBvYmpcbmApOwogIGlmIChvYmogaW5zdGFuY2VvZiBfcHJpbWl0aXZlcy5EaWN0KSB7CiAgICBhd2FpdCB3cml0ZURpY3Qob2JqLCBidWZmZXIsIHRyYW5zZm9ybSk7CiAgfSBlbHNlIGlmIChvYmogaW5zdGFuY2VvZiBfYmFzZV9zdHJlYW0uQmFzZVN0cmVhbSkgewogICAgYXdhaXQgd3JpdGVTdHJlYW0ob2JqLCBidWZmZXIsIHRyYW5zZm9ybSk7CiAgfSBlbHNlIGlmIChBcnJheS5pc0FycmF5KG9iaikpIHsKICAgIGF3YWl0IHdyaXRlQXJyYXkob2JqLCBidWZmZXIsIHRyYW5zZm9ybSk7CiAgfQogIGJ1ZmZlci5wdXNoKCJcbmVuZG9ialxuIik7Cn0KYXN5bmMgZnVuY3Rpb24gd3JpdGVEaWN0KGRpY3QsIGJ1ZmZlciwgdHJhbnNmb3JtKSB7CiAgYnVmZmVyLnB1c2goIjw8Iik7CiAgZm9yIChjb25zdCBrZXkgb2YgZGljdC5nZXRLZXlzKCkpIHsKICAgIGJ1ZmZlci5wdXNoKGAgLyR7KDAsIF9jb3JlX3V0aWxzLmVzY2FwZVBERk5hbWUpKGtleSl9IGApOwogICAgYXdhaXQgd3JpdGVWYWx1ZShkaWN0LmdldFJhdyhrZXkpLCBidWZmZXIsIHRyYW5zZm9ybSk7CiAgfQogIGJ1ZmZlci5wdXNoKCI+PiIpOwp9CmFzeW5jIGZ1bmN0aW9uIHdyaXRlU3RyZWFtKHN0cmVhbSwgYnVmZmVyLCB0cmFuc2Zvcm0pIHsKICBsZXQgc3RyaW5nID0gc3RyZWFtLmdldFN0cmluZygpOwogIGNvbnN0IHsKICAgIGRpY3QKICB9ID0gc3RyZWFtOwogIGNvbnN0IFtmaWx0ZXIsIHBhcmFtc10gPSBhd2FpdCBQcm9taXNlLmFsbChbZGljdC5nZXRBc3luYygiRmlsdGVyIiksIGRpY3QuZ2V0QXN5bmMoIkRlY29kZVBhcm1zIildKTsKICBjb25zdCBmaWx0ZXJaZXJvID0gQXJyYXkuaXNBcnJheShmaWx0ZXIpID8gYXdhaXQgZGljdC54cmVmLmZldGNoSWZSZWZBc3luYyhmaWx0ZXJbMF0pIDogZmlsdGVyOwogIGNvbnN0IGlzRmlsdGVyWmVyb0ZsYXRlRGVjb2RlID0gKDAsIF9wcmltaXRpdmVzLmlzTmFtZSkoZmlsdGVyWmVybywgIkZsYXRlRGVjb2RlIik7CiAgY29uc3QgTUlOX0xFTkdUSF9GT1JfQ09NUFJFU1NJTkcgPSAyNTY7CiAgaWYgKHR5cGVvZiBDb21wcmVzc2lvblN0cmVhbSAhPT0gInVuZGVmaW5lZCIgJiYgKHN0cmluZy5sZW5ndGggPj0gTUlOX0xFTkdUSF9GT1JfQ09NUFJFU1NJTkcgfHwgaXNGaWx0ZXJaZXJvRmxhdGVEZWNvZGUpKSB7CiAgICB0cnkgewogICAgICBjb25zdCBieXRlQXJyYXkgPSAoMCwgX3V0aWwuc3RyaW5nVG9CeXRlcykoc3RyaW5nKTsKICAgICAgY29uc3QgY3MgPSBuZXcgQ29tcHJlc3Npb25TdHJlYW0oImRlZmxhdGUiKTsKICAgICAgY29uc3Qgd3JpdGVyID0gY3Mud3JpdGFibGUuZ2V0V3JpdGVyKCk7CiAgICAgIHdyaXRlci53cml0ZShieXRlQXJyYXkpOwogICAgICB3cml0ZXIuY2xvc2UoKTsKICAgICAgY29uc3QgYnVmID0gYXdhaXQgbmV3IFJlc3BvbnNlKGNzLnJlYWRhYmxlKS5hcnJheUJ1ZmZlcigpOwogICAgICBzdHJpbmcgPSAoMCwgX3V0aWwuYnl0ZXNUb1N0cmluZykobmV3IFVpbnQ4QXJyYXkoYnVmKSk7CiAgICAgIGxldCBuZXdGaWx0ZXIsIG5ld1BhcmFtczsKICAgICAgaWYgKCFmaWx0ZXIpIHsKICAgICAgICBuZXdGaWx0ZXIgPSBfcHJpbWl0aXZlcy5OYW1lLmdldCgiRmxhdGVEZWNvZGUiKTsKICAgICAgfSBlbHNlIGlmICghaXNGaWx0ZXJaZXJvRmxhdGVEZWNvZGUpIHsKICAgICAgICBuZXdGaWx0ZXIgPSBBcnJheS5pc0FycmF5KGZpbHRlcikgPyBbX3ByaW1pdGl2ZXMuTmFtZS5nZXQoIkZsYXRlRGVjb2RlIiksIC4uLmZpbHRlcl0gOiBbX3ByaW1pdGl2ZXMuTmFtZS5nZXQoIkZsYXRlRGVjb2RlIiksIGZpbHRlcl07CiAgICAgICAgaWYgKHBhcmFtcykgewogICAgICAgICAgbmV3UGFyYW1zID0gQXJyYXkuaXNBcnJheShwYXJhbXMpID8gW251bGwsIC4uLnBhcmFtc10gOiBbbnVsbCwgcGFyYW1zXTsKICAgICAgICB9CiAgICAgIH0KICAgICAgaWYgKG5ld0ZpbHRlcikgewogICAgICAgIGRpY3Quc2V0KCJGaWx0ZXIiLCBuZXdGaWx0ZXIpOwogICAgICB9CiAgICAgIGlmIChuZXdQYXJhbXMpIHsKICAgICAgICBkaWN0LnNldCgiRGVjb2RlUGFybXMiLCBuZXdQYXJhbXMpOwogICAgICB9CiAgICB9IGNhdGNoIChleCkgewogICAgICAoMCwgX3V0aWwuaW5mbykoYHdyaXRlU3RyZWFtIC0gY2Fubm90IGNvbXByZXNzIGRhdGE6ICIke2V4fSIuYCk7CiAgICB9CiAgfQogIGlmICh0cmFuc2Zvcm0pIHsKICAgIHN0cmluZyA9IHRyYW5zZm9ybS5lbmNyeXB0U3RyaW5nKHN0cmluZyk7CiAgfQogIGRpY3Quc2V0KCJMZW5ndGgiLCBzdHJpbmcubGVuZ3RoKTsKICBhd2FpdCB3cml0ZURpY3QoZGljdCwgYnVmZmVyLCB0cmFuc2Zvcm0pOwogIGJ1ZmZlci5wdXNoKCIgc3RyZWFtXG4iLCBzdHJpbmcsICJcbmVuZHN0cmVhbSIpOwp9CmFzeW5jIGZ1bmN0aW9uIHdyaXRlQXJyYXkoYXJyYXksIGJ1ZmZlciwgdHJhbnNmb3JtKSB7CiAgYnVmZmVyLnB1c2goIlsiKTsKICBsZXQgZmlyc3QgPSB0cnVlOwogIGZvciAoY29uc3QgdmFsIG9mIGFycmF5KSB7CiAgICBpZiAoIWZpcnN0KSB7CiAgICAgIGJ1ZmZlci5wdXNoKCIgIik7CiAgICB9IGVsc2UgewogICAgICBmaXJzdCA9IGZhbHNlOwogICAgfQogICAgYXdhaXQgd3JpdGVWYWx1ZSh2YWwsIGJ1ZmZlciwgdHJhbnNmb3JtKTsKICB9CiAgYnVmZmVyLnB1c2goIl0iKTsKfQphc3luYyBmdW5jdGlvbiB3cml0ZVZhbHVlKHZhbHVlLCBidWZmZXIsIHRyYW5zZm9ybSkgewogIGlmICh2YWx1ZSBpbnN0YW5jZW9mIF9wcmltaXRpdmVzLk5hbWUpIHsKICAgIGJ1ZmZlci5wdXNoKGAvJHsoMCwgX2NvcmVfdXRpbHMuZXNjYXBlUERGTmFtZSkodmFsdWUubmFtZSl9YCk7CiAgfSBlbHNlIGlmICh2YWx1ZSBpbnN0YW5jZW9mIF9wcmltaXRpdmVzLlJlZikgewogICAgYnVmZmVyLnB1c2goYCR7dmFsdWUubnVtfSAke3ZhbHVlLmdlbn0gUmApOwogIH0gZWxzZSBpZiAoQXJyYXkuaXNBcnJheSh2YWx1ZSkpIHsKICAgIGF3YWl0IHdyaXRlQXJyYXkodmFsdWUsIGJ1ZmZlciwgdHJhbnNmb3JtKTsKICB9IGVsc2UgaWYgKHR5cGVvZiB2YWx1ZSA9PT0gInN0cmluZyIpIHsKICAgIGlmICh0cmFuc2Zvcm0pIHsKICAgICAgdmFsdWUgPSB0cmFuc2Zvcm0uZW5jcnlwdFN0cmluZyh2YWx1ZSk7CiAgICB9CiAgICBidWZmZXIucHVzaChgKCR7KDAsIF9jb3JlX3V0aWxzLmVzY2FwZVN0cmluZykodmFsdWUpfSlgKTsKICB9IGVsc2UgaWYgKHR5cGVvZiB2YWx1ZSA9PT0gIm51bWJlciIpIHsKICAgIGJ1ZmZlci5wdXNoKCgwLCBfY29yZV91dGlscy5udW1iZXJUb1N0cmluZykodmFsdWUpKTsKICB9IGVsc2UgaWYgKHR5cGVvZiB2YWx1ZSA9PT0gImJvb2xlYW4iKSB7CiAgICBidWZmZXIucHVzaCh2YWx1ZS50b1N0cmluZygpKTsKICB9IGVsc2UgaWYgKHZhbHVlIGluc3RhbmNlb2YgX3ByaW1pdGl2ZXMuRGljdCkgewogICAgYXdhaXQgd3JpdGVEaWN0KHZhbHVlLCBidWZmZXIsIHRyYW5zZm9ybSk7CiAgfSBlbHNlIGlmICh2YWx1ZSBpbnN0YW5jZW9mIF9iYXNlX3N0cmVhbS5CYXNlU3RyZWFtKSB7CiAgICBhd2FpdCB3cml0ZVN0cmVhbSh2YWx1ZSwgYnVmZmVyLCB0cmFuc2Zvcm0pOwogIH0gZWxzZSBpZiAodmFsdWUgPT09IG51bGwpIHsKICAgIGJ1ZmZlci5wdXNoKCJudWxsIik7CiAgfSBlbHNlIHsKICAgICgwLCBfdXRpbC53YXJuKShgVW5oYW5kbGVkIHZhbHVlIGluIHdyaXRlcjogJHt0eXBlb2YgdmFsdWV9LCBwbGVhc2UgZmlsZSBhIGJ1Zy5gKTsKICB9Cn0KZnVuY3Rpb24gd3JpdGVJbnQobnVtYmVyLCBzaXplLCBvZmZzZXQsIGJ1ZmZlcikgewogIGZvciAobGV0IGkgPSBzaXplICsgb2Zmc2V0IC0gMTsgaSA+IG9mZnNldCAtIDE7IGktLSkgewogICAgYnVmZmVyW2ldID0gbnVtYmVyICYgMHhmZjsKICAgIG51bWJlciA+Pj0gODsKICB9CiAgcmV0dXJuIG9mZnNldCArIHNpemU7Cn0KZnVuY3Rpb24gd3JpdGVTdHJpbmcoc3RyaW5nLCBvZmZzZXQsIGJ1ZmZlcikgewogIGZvciAobGV0IGkgPSAwLCBsZW4gPSBzdHJpbmcubGVuZ3RoOyBpIDwgbGVuOyBpKyspIHsKICAgIGJ1ZmZlcltvZmZzZXQgKyBpXSA9IHN0cmluZy5jaGFyQ29kZUF0KGkpICYgMHhmZjsKICB9Cn0KZnVuY3Rpb24gY29tcHV0ZU1ENShmaWxlc2l6ZSwgeHJlZkluZm8pIHsKICBjb25zdCB0aW1lID0gTWF0aC5mbG9vcihEYXRlLm5vdygpIC8gMTAwMCk7CiAgY29uc3QgZmlsZW5hbWUgPSB4cmVmSW5mby5maWxlbmFtZSB8fCAiIjsKICBjb25zdCBtZDVCdWZmZXIgPSBbdGltZS50b1N0cmluZygpLCBmaWxlbmFtZSwgZmlsZXNpemUudG9TdHJpbmcoKV07CiAgbGV0IG1kNUJ1ZmZlckxlbiA9IG1kNUJ1ZmZlci5yZWR1Y2UoKGEsIHN0cikgPT4gYSArIHN0ci5sZW5ndGgsIDApOwogIGZvciAoY29uc3QgdmFsdWUgb2YgT2JqZWN0LnZhbHVlcyh4cmVmSW5mby5pbmZvKSkgewogICAgbWQ1QnVmZmVyLnB1c2godmFsdWUpOwogICAgbWQ1QnVmZmVyTGVuICs9IHZhbHVlLmxlbmd0aDsKICB9CiAgY29uc3QgYXJyYXkgPSBuZXcgVWludDhBcnJheShtZDVCdWZmZXJMZW4pOwogIGxldCBvZmZzZXQgPSAwOwogIGZvciAoY29uc3Qgc3RyIG9mIG1kNUJ1ZmZlcikgewogICAgd3JpdGVTdHJpbmcoc3RyLCBvZmZzZXQsIGFycmF5KTsKICAgIG9mZnNldCArPSBzdHIubGVuZ3RoOwogIH0KICByZXR1cm4gKDAsIF91dGlsLmJ5dGVzVG9TdHJpbmcpKCgwLCBfY3J5cHRvLmNhbGN1bGF0ZU1ENSkoYXJyYXkpKTsKfQpmdW5jdGlvbiB3cml0ZVhGQURhdGFGb3JBY3JvZm9ybShzdHIsIG5ld1JlZnMpIHsKICBjb25zdCB4bWwgPSBuZXcgX3htbF9wYXJzZXIuU2ltcGxlWE1MUGFyc2VyKHsKICAgIGhhc0F0dHJpYnV0ZXM6IHRydWUKICB9KS5wYXJzZUZyb21TdHJpbmcoc3RyKTsKICBmb3IgKGNvbnN0IHsKICAgIHhmYQogIH0gb2YgbmV3UmVmcykgewogICAgaWYgKCF4ZmEpIHsKICAgICAgY29udGludWU7CiAgICB9CiAgICBjb25zdCB7CiAgICAgIHBhdGgsCiAgICAgIHZhbHVlCiAgICB9ID0geGZhOwogICAgaWYgKCFwYXRoKSB7CiAgICAgIGNvbnRpbnVlOwogICAgfQogICAgY29uc3Qgbm9kZVBhdGggPSAoMCwgX2NvcmVfdXRpbHMucGFyc2VYRkFQYXRoKShwYXRoKTsKICAgIGxldCBub2RlID0geG1sLmRvY3VtZW50RWxlbWVudC5zZWFyY2hOb2RlKG5vZGVQYXRoLCAwKTsKICAgIGlmICghbm9kZSAmJiBub2RlUGF0aC5sZW5ndGggPiAxKSB7CiAgICAgIG5vZGUgPSB4bWwuZG9jdW1lbnRFbGVtZW50LnNlYXJjaE5vZGUoW25vZGVQYXRoLmF0KC0xKV0sIDApOwogICAgfQogICAgaWYgKG5vZGUpIHsKICAgICAgbm9kZS5jaGlsZE5vZGVzID0gQXJyYXkuaXNBcnJheSh2YWx1ZSkgPyB2YWx1ZS5tYXAodmFsID0+IG5ldyBfeG1sX3BhcnNlci5TaW1wbGVET01Ob2RlKCJ2YWx1ZSIsIHZhbCkpIDogW25ldyBfeG1sX3BhcnNlci5TaW1wbGVET01Ob2RlKCIjdGV4dCIsIHZhbHVlKV07CiAgICB9IGVsc2UgewogICAgICAoMCwgX3V0aWwud2FybikoYE5vZGUgbm90IGZvdW5kIGZvciBwYXRoOiAke3BhdGh9YCk7CiAgICB9CiAgfQogIGNvbnN0IGJ1ZmZlciA9IFtdOwogIHhtbC5kb2N1bWVudEVsZW1lbnQuZHVtcChidWZmZXIpOwogIHJldHVybiBidWZmZXIuam9pbigiIik7Cn0KYXN5bmMgZnVuY3Rpb24gdXBkYXRlQWNyb2Zvcm0oewogIHhyZWYsCiAgYWNyb0Zvcm0sCiAgYWNyb0Zvcm1SZWYsCiAgaGFzWGZhLAogIGhhc1hmYURhdGFzZXRzRW50cnksCiAgeGZhRGF0YXNldHNSZWYsCiAgbmVlZEFwcGVhcmFuY2VzLAogIG5ld1JlZnMKfSkgewogIGlmIChoYXNYZmEgJiYgIWhhc1hmYURhdGFzZXRzRW50cnkgJiYgIXhmYURhdGFzZXRzUmVmKSB7CiAgICAoMCwgX3V0aWwud2FybikoIlhGQSAtIENhbm5vdCBzYXZlIGl0Iik7CiAgfQogIGlmICghbmVlZEFwcGVhcmFuY2VzICYmICghaGFzWGZhIHx8ICF4ZmFEYXRhc2V0c1JlZiB8fCBoYXNYZmFEYXRhc2V0c0VudHJ5KSkgewogICAgcmV0dXJuOwogIH0KICBjb25zdCBkaWN0ID0gYWNyb0Zvcm0uY2xvbmUoKTsKICBpZiAoaGFzWGZhICYmICFoYXNYZmFEYXRhc2V0c0VudHJ5KSB7CiAgICBjb25zdCBuZXdYZmEgPSBhY3JvRm9ybS5nZXQoIlhGQSIpLnNsaWNlKCk7CiAgICBuZXdYZmEuc3BsaWNlKDIsIDAsICJkYXRhc2V0cyIpOwogICAgbmV3WGZhLnNwbGljZSgzLCAwLCB4ZmFEYXRhc2V0c1JlZik7CiAgICBkaWN0LnNldCgiWEZBIiwgbmV3WGZhKTsKICB9CiAgaWYgKG5lZWRBcHBlYXJhbmNlcykgewogICAgZGljdC5zZXQoIk5lZWRBcHBlYXJhbmNlcyIsIHRydWUpOwogIH0KICBjb25zdCBidWZmZXIgPSBbXTsKICBhd2FpdCB3cml0ZU9iamVjdChhY3JvRm9ybVJlZiwgZGljdCwgYnVmZmVyLCB4cmVmKTsKICBuZXdSZWZzLnB1c2goewogICAgcmVmOiBhY3JvRm9ybVJlZiwKICAgIGRhdGE6IGJ1ZmZlci5qb2luKCIiKQogIH0pOwp9CmZ1bmN0aW9uIHVwZGF0ZVhGQSh7CiAgeGZhRGF0YSwKICB4ZmFEYXRhc2V0c1JlZiwKICBuZXdSZWZzLAogIHhyZWYKfSkgewogIGlmICh4ZmFEYXRhID09PSBudWxsKSB7CiAgICBjb25zdCBkYXRhc2V0cyA9IHhyZWYuZmV0Y2hJZlJlZih4ZmFEYXRhc2V0c1JlZik7CiAgICB4ZmFEYXRhID0gd3JpdGVYRkFEYXRhRm9yQWNyb2Zvcm0oZGF0YXNldHMuZ2V0U3RyaW5nKCksIG5ld1JlZnMpOwogIH0KICBjb25zdCBlbmNyeXB0ID0geHJlZi5lbmNyeXB0OwogIGlmIChlbmNyeXB0KSB7CiAgICBjb25zdCB0cmFuc2Zvcm0gPSBlbmNyeXB0LmNyZWF0ZUNpcGhlclRyYW5zZm9ybSh4ZmFEYXRhc2V0c1JlZi5udW0sIHhmYURhdGFzZXRzUmVmLmdlbik7CiAgICB4ZmFEYXRhID0gdHJhbnNmb3JtLmVuY3J5cHRTdHJpbmcoeGZhRGF0YSk7CiAgfQogIGNvbnN0IGRhdGEgPSBgJHt4ZmFEYXRhc2V0c1JlZi5udW19ICR7eGZhRGF0YXNldHNSZWYuZ2VufSBvYmpcbmAgKyBgPDwgL1R5cGUgL0VtYmVkZGVkRmlsZSAvTGVuZ3RoICR7eGZhRGF0YS5sZW5ndGh9Pj5cbnN0cmVhbVxuYCArIHhmYURhdGEgKyAiXG5lbmRzdHJlYW1cbmVuZG9ialxuIjsKICBuZXdSZWZzLnB1c2goewogICAgcmVmOiB4ZmFEYXRhc2V0c1JlZiwKICAgIGRhdGEKICB9KTsKfQphc3luYyBmdW5jdGlvbiBpbmNyZW1lbnRhbFVwZGF0ZSh7CiAgb3JpZ2luYWxEYXRhLAogIHhyZWZJbmZvLAogIG5ld1JlZnMsCiAgeHJlZiA9IG51bGwsCiAgaGFzWGZhID0gZmFsc2UsCiAgeGZhRGF0YXNldHNSZWYgPSBudWxsLAogIGhhc1hmYURhdGFzZXRzRW50cnkgPSBmYWxzZSwKICBuZWVkQXBwZWFyYW5jZXMsCiAgYWNyb0Zvcm1SZWYgPSBudWxsLAogIGFjcm9Gb3JtID0gbnVsbCwKICB4ZmFEYXRhID0gbnVsbAp9KSB7CiAgYXdhaXQgdXBkYXRlQWNyb2Zvcm0oewogICAgeHJlZiwKICAgIGFjcm9Gb3JtLAogICAgYWNyb0Zvcm1SZWYsCiAgICBoYXNYZmEsCiAgICBoYXNYZmFEYXRhc2V0c0VudHJ5LAogICAgeGZhRGF0YXNldHNSZWYsCiAgICBuZWVkQXBwZWFyYW5jZXMsCiAgICBuZXdSZWZzCiAgfSk7CiAgaWYgKGhhc1hmYSkgewogICAgdXBkYXRlWEZBKHsKICAgICAgeGZhRGF0YSwKICAgICAgeGZhRGF0YXNldHNSZWYsCiAgICAgIG5ld1JlZnMsCiAgICAgIHhyZWYKICAgIH0pOwogIH0KICBjb25zdCBuZXdYcmVmID0gbmV3IF9wcmltaXRpdmVzLkRpY3QobnVsbCk7CiAgY29uc3QgcmVmRm9yWHJlZlRhYmxlID0geHJlZkluZm8ubmV3UmVmOwogIGxldCBidWZmZXIsIGJhc2VPZmZzZXQ7CiAgY29uc3QgbGFzdEJ5dGUgPSBvcmlnaW5hbERhdGEuYXQoLTEpOwogIGlmIChsYXN0Qnl0ZSA9PT0gMHgwYSB8fCBsYXN0Qnl0ZSA9PT0gMHgwZCkgewogICAgYnVmZmVyID0gW107CiAgICBiYXNlT2Zmc2V0ID0gb3JpZ2luYWxEYXRhLmxlbmd0aDsKICB9IGVsc2UgewogICAgYnVmZmVyID0gWyJcbiJdOwogICAgYmFzZU9mZnNldCA9IG9yaWdpbmFsRGF0YS5sZW5ndGggKyAxOwogIH0KICBuZXdYcmVmLnNldCgiU2l6ZSIsIHJlZkZvclhyZWZUYWJsZS5udW0gKyAxKTsKICBuZXdYcmVmLnNldCgiUHJldiIsIHhyZWZJbmZvLnN0YXJ0WFJlZik7CiAgbmV3WHJlZi5zZXQoIlR5cGUiLCBfcHJpbWl0aXZlcy5OYW1lLmdldCgiWFJlZiIpKTsKICBpZiAoeHJlZkluZm8ucm9vdFJlZiAhPT0gbnVsbCkgewogICAgbmV3WHJlZi5zZXQoIlJvb3QiLCB4cmVmSW5mby5yb290UmVmKTsKICB9CiAgaWYgKHhyZWZJbmZvLmluZm9SZWYgIT09IG51bGwpIHsKICAgIG5ld1hyZWYuc2V0KCJJbmZvIiwgeHJlZkluZm8uaW5mb1JlZik7CiAgfQogIGlmICh4cmVmSW5mby5lbmNyeXB0UmVmICE9PSBudWxsKSB7CiAgICBuZXdYcmVmLnNldCgiRW5jcnlwdCIsIHhyZWZJbmZvLmVuY3J5cHRSZWYpOwogIH0KICBuZXdSZWZzLnB1c2goewogICAgcmVmOiByZWZGb3JYcmVmVGFibGUsCiAgICBkYXRhOiAiIgogIH0pOwogIG5ld1JlZnMgPSBuZXdSZWZzLnNvcnQoKGEsIGIpID0+IHsKICAgIHJldHVybiBhLnJlZi5udW0gLSBiLnJlZi5udW07CiAgfSk7CiAgY29uc3QgeHJlZlRhYmxlRGF0YSA9IFtbMCwgMSwgMHhmZmZmXV07CiAgY29uc3QgaW5kZXhlcyA9IFswLCAxXTsKICBsZXQgbWF4T2Zmc2V0ID0gMDsKICBmb3IgKGNvbnN0IHsKICAgIHJlZiwKICAgIGRhdGEKICB9IG9mIG5ld1JlZnMpIHsKICAgIG1heE9mZnNldCA9IE1hdGgubWF4KG1heE9mZnNldCwgYmFzZU9mZnNldCk7CiAgICB4cmVmVGFibGVEYXRhLnB1c2goWzEsIGJhc2VPZmZzZXQsIE1hdGgubWluKHJlZi5nZW4sIDB4ZmZmZildKTsKICAgIGJhc2VPZmZzZXQgKz0gZGF0YS5sZW5ndGg7CiAgICBpbmRleGVzLnB1c2gocmVmLm51bSwgMSk7CiAgICBidWZmZXIucHVzaChkYXRhKTsKICB9CiAgbmV3WHJlZi5zZXQoIkluZGV4IiwgaW5kZXhlcyk7CiAgaWYgKEFycmF5LmlzQXJyYXkoeHJlZkluZm8uZmlsZUlkcykgJiYgeHJlZkluZm8uZmlsZUlkcy5sZW5ndGggPiAwKSB7CiAgICBjb25zdCBtZDUgPSBjb21wdXRlTUQ1KGJhc2VPZmZzZXQsIHhyZWZJbmZvKTsKICAgIG5ld1hyZWYuc2V0KCJJRCIsIFt4cmVmSW5mby5maWxlSWRzWzBdLCBtZDVdKTsKICB9CiAgY29uc3Qgb2Zmc2V0U2l6ZSA9IE1hdGguY2VpbChNYXRoLmxvZzIobWF4T2Zmc2V0KSAvIDgpOwogIGNvbnN0IHNpemVzID0gWzEsIG9mZnNldFNpemUsIDJdOwogIGNvbnN0IHN0cnVjdFNpemUgPSBzaXplc1swXSArIHNpemVzWzFdICsgc2l6ZXNbMl07CiAgY29uc3QgdGFibGVMZW5ndGggPSBzdHJ1Y3RTaXplICogeHJlZlRhYmxlRGF0YS5sZW5ndGg7CiAgbmV3WHJlZi5zZXQoIlciLCBzaXplcyk7CiAgbmV3WHJlZi5zZXQoIkxlbmd0aCIsIHRhYmxlTGVuZ3RoKTsKICBidWZmZXIucHVzaChgJHtyZWZGb3JYcmVmVGFibGUubnVtfSAke3JlZkZvclhyZWZUYWJsZS5nZW59IG9ialxuYCk7CiAgYXdhaXQgd3JpdGVEaWN0KG5ld1hyZWYsIGJ1ZmZlciwgbnVsbCk7CiAgYnVmZmVyLnB1c2goIiBzdHJlYW1cbiIpOwogIGNvbnN0IGJ1ZmZlckxlbiA9IGJ1ZmZlci5yZWR1Y2UoKGEsIHN0cikgPT4gYSArIHN0ci5sZW5ndGgsIDApOwogIGNvbnN0IGZvb3RlciA9IGBcbmVuZHN0cmVhbVxuZW5kb2JqXG5zdGFydHhyZWZcbiR7YmFzZU9mZnNldH1cbiUlRU9GXG5gOwogIGNvbnN0IGFycmF5ID0gbmV3IFVpbnQ4QXJyYXkob3JpZ2luYWxEYXRhLmxlbmd0aCArIGJ1ZmZlckxlbiArIHRhYmxlTGVuZ3RoICsgZm9vdGVyLmxlbmd0aCk7CiAgYXJyYXkuc2V0KG9yaWdpbmFsRGF0YSk7CiAgbGV0IG9mZnNldCA9IG9yaWdpbmFsRGF0YS5sZW5ndGg7CiAgZm9yIChjb25zdCBzdHIgb2YgYnVmZmVyKSB7CiAgICB3cml0ZVN0cmluZyhzdHIsIG9mZnNldCwgYXJyYXkpOwogICAgb2Zmc2V0ICs9IHN0ci5sZW5ndGg7CiAgfQogIGZvciAoY29uc3QgW3R5cGUsIG9iak9mZnNldCwgZ2VuXSBvZiB4cmVmVGFibGVEYXRhKSB7CiAgICBvZmZzZXQgPSB3cml0ZUludCh0eXBlLCBzaXplc1swXSwgb2Zmc2V0LCBhcnJheSk7CiAgICBvZmZzZXQgPSB3cml0ZUludChvYmpPZmZzZXQsIHNpemVzWzFdLCBvZmZzZXQsIGFycmF5KTsKICAgIG9mZnNldCA9IHdyaXRlSW50KGdlbiwgc2l6ZXNbMl0sIG9mZnNldCwgYXJyYXkpOwogIH0KICB3cml0ZVN0cmluZyhmb290ZXIsIG9mZnNldCwgYXJyYXkpOwogIHJldHVybiBhcnJheTsKfQoKLyoqKi8gfSksCi8qIDc0ICovCi8qKiovICgoX191bnVzZWRfd2VicGFja19tb2R1bGUsIGV4cG9ydHMsIF9fd19wZGZqc19yZXF1aXJlX18pID0+IHsKCgoKT2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsICJfX2VzTW9kdWxlIiwgKHsKICB2YWx1ZTogdHJ1ZQp9KSk7CmV4cG9ydHMuY2FsY3VsYXRlU0hBMjU2ID0gZXhwb3J0cy5jYWxjdWxhdGVNRDUgPSBleHBvcnRzLlBERjIwID0gZXhwb3J0cy5QREYxNyA9IGV4cG9ydHMuQ2lwaGVyVHJhbnNmb3JtRmFjdG9yeSA9IGV4cG9ydHMuQVJDRm91ckNpcGhlciA9IGV4cG9ydHMuQUVTMjU2Q2lwaGVyID0gZXhwb3J0cy5BRVMxMjhDaXBoZXIgPSB2b2lkIDA7CmV4cG9ydHMuY2FsY3VsYXRlU0hBMzg0ID0gY2FsY3VsYXRlU0hBMzg0OwpleHBvcnRzLmNhbGN1bGF0ZVNIQTUxMiA9IHZvaWQgMDsKdmFyIF91dGlsID0gX193X3BkZmpzX3JlcXVpcmVfXygyKTsKdmFyIF9wcmltaXRpdmVzID0gX193X3BkZmpzX3JlcXVpcmVfXyg0KTsKdmFyIF9kZWNyeXB0X3N0cmVhbSA9IF9fd19wZGZqc19yZXF1aXJlX18oNzUpOwpjbGFzcyBBUkNGb3VyQ2lwaGVyIHsKICBjb25zdHJ1Y3RvcihrZXkpIHsKICAgIHRoaXMuYSA9IDA7CiAgICB0aGlzLmIgPSAwOwogICAgY29uc3QgcyA9IG5ldyBVaW50OEFycmF5KDI1Nik7CiAgICBjb25zdCBrZXlMZW5ndGggPSBrZXkubGVuZ3RoOwogICAgZm9yIChsZXQgaSA9IDA7IGkgPCAyNTY7ICsraSkgewogICAgICBzW2ldID0gaTsKICAgIH0KICAgIGZvciAobGV0IGkgPSAwLCBqID0gMDsgaSA8IDI1NjsgKytpKSB7CiAgICAgIGNvbnN0IHRtcCA9IHNbaV07CiAgICAgIGogPSBqICsgdG1wICsga2V5W2kgJSBrZXlMZW5ndGhdICYgMHhmZjsKICAgICAgc1tpXSA9IHNbal07CiAgICAgIHNbal0gPSB0bXA7CiAgICB9CiAgICB0aGlzLnMgPSBzOwogIH0KICBlbmNyeXB0QmxvY2soZGF0YSkgewogICAgbGV0IGEgPSB0aGlzLmEsCiAgICAgIGIgPSB0aGlzLmI7CiAgICBjb25zdCBzID0gdGhpcy5zOwogICAgY29uc3QgbiA9IGRhdGEubGVuZ3RoOwogICAgY29uc3Qgb3V0cHV0ID0gbmV3IFVpbnQ4QXJyYXkobik7CiAgICBmb3IgKGxldCBpID0gMDsgaSA8IG47ICsraSkgewogICAgICBhID0gYSArIDEgJiAweGZmOwogICAgICBjb25zdCB0bXAgPSBzW2FdOwogICAgICBiID0gYiArIHRtcCAmIDB4ZmY7CiAgICAgIGNvbnN0IHRtcDIgPSBzW2JdOwogICAgICBzW2FdID0gdG1wMjsKICAgICAgc1tiXSA9IHRtcDsKICAgICAgb3V0cHV0W2ldID0gZGF0YVtpXSBeIHNbdG1wICsgdG1wMiAmIDB4ZmZdOwogICAgfQogICAgdGhpcy5hID0gYTsKICAgIHRoaXMuYiA9IGI7CiAgICByZXR1cm4gb3V0cHV0OwogIH0KICBkZWNyeXB0QmxvY2soZGF0YSkgewogICAgcmV0dXJuIHRoaXMuZW5jcnlwdEJsb2NrKGRhdGEpOwogIH0KICBlbmNyeXB0KGRhdGEpIHsKICAgIHJldHVybiB0aGlzLmVuY3J5cHRCbG9jayhkYXRhKTsKICB9Cn0KZXhwb3J0cy5BUkNGb3VyQ2lwaGVyID0gQVJDRm91ckNpcGhlcjsKY29uc3QgY2FsY3VsYXRlTUQ1ID0gZnVuY3Rpb24gY2FsY3VsYXRlTUQ1Q2xvc3VyZSgpIHsKICBjb25zdCByID0gbmV3IFVpbnQ4QXJyYXkoWzcsIDEyLCAxNywgMjIsIDcsIDEyLCAxNywgMjIsIDcsIDEyLCAxNywgMjIsIDcsIDEyLCAxNywgMjIsIDUsIDksIDE0LCAyMCwgNSwgOSwgMTQsIDIwLCA1LCA5LCAxNCwgMjAsIDUsIDksIDE0LCAyMCwgNCwgMTEsIDE2LCAyMywgNCwgMTEsIDE2LCAyMywgNCwgMTEsIDE2LCAyMywgNCwgMTEsIDE2LCAyMywgNiwgMTAsIDE1LCAyMSwgNiwgMTAsIDE1LCAyMSwgNiwgMTAsIDE1LCAyMSwgNiwgMTAsIDE1LCAyMV0pOwogIGNvbnN0IGsgPSBuZXcgSW50MzJBcnJheShbLTY4MDg3NjkzNiwgLTM4OTU2NDU4NiwgNjA2MTA1ODE5LCAtMTA0NDUyNTMzMCwgLTE3NjQxODg5NywgMTIwMDA4MDQyNiwgLTE0NzMyMzEzNDEsIC00NTcwNTk4MywgMTc3MDAzNTQxNiwgLTE5NTg0MTQ0MTcsIC00MjA2MywgLTE5OTA0MDQxNjIsIDE4MDQ2MDM2ODIsIC00MDM0MTEwMSwgLTE1MDIwMDIyOTAsIDEyMzY1MzUzMjksIC0xNjU3OTY1MTAsIC0xMDY5NTAxNjMyLCA2NDM3MTc3MTMsIC0zNzM4OTczMDIsIC03MDE1NTg2OTEsIDM4MDE2MDgzLCAtNjYwNDc4MzM1LCAtNDA1NTM3ODQ4LCA1Njg0NDY0MzgsIC0xMDE5ODAzNjkwLCAtMTg3MzYzOTYxLCAxMTYzNTMxNTAxLCAtMTQ0NDY4MTQ2NywgLTUxNDAzNzg0LCAxNzM1MzI4NDczLCAtMTkyNjYwNzczNCwgLTM3ODU1OCwgLTIwMjI1NzQ0NjMsIDE4MzkwMzA1NjIsIC0zNTMwOTU1NiwgLTE1MzA5OTIwNjAsIDEyNzI4OTMzNTMsIC0xNTU0OTc2MzIsIC0xMDk0NzMwNjQwLCA2ODEyNzkxNzQsIC0zNTg1MzcyMjIsIC03MjI1MjE5NzksIDc2MDI5MTg5LCAtNjQwMzY0NDg3LCAtNDIxODE1ODM1LCA1MzA3NDI1MjAsIC05OTUzMzg2NTEsIC0xOTg2MzA4NDQsIDExMjY4OTE0MTUsIC0xNDE2MzU0OTA1LCAtNTc0MzQwNTUsIDE3MDA0ODU1NzEsIC0xODk0OTg2NjA2LCAtMTA1MTUyMywgLTIwNTQ5MjI3OTksIDE4NzMzMTMzNTksIC0zMDYxMTc0NCwgLTE1NjAxOTgzODAsIDEzMDkxNTE2NDksIC0xNDU1MjMwNzAsIC0xMTIwMjEwMzc5LCA3MTg3ODcyNTksIC0zNDM0ODU1NTFdKTsKICBmdW5jdGlvbiBoYXNoKGRhdGEsIG9mZnNldCwgbGVuZ3RoKSB7CiAgICBsZXQgaDAgPSAxNzMyNTg0MTkzLAogICAgICBoMSA9IC0yNzE3MzM4NzksCiAgICAgIGgyID0gLTE3MzI1ODQxOTQsCiAgICAgIGgzID0gMjcxNzMzODc4OwogICAgY29uc3QgcGFkZGVkTGVuZ3RoID0gbGVuZ3RoICsgNzIgJiB+NjM7CiAgICBjb25zdCBwYWRkZWQgPSBuZXcgVWludDhBcnJheShwYWRkZWRMZW5ndGgpOwogICAgbGV0IGksIGo7CiAgICBmb3IgKGkgPSAwOyBpIDwgbGVuZ3RoOyArK2kpIHsKICAgICAgcGFkZGVkW2ldID0gZGF0YVtvZmZzZXQrK107CiAgICB9CiAgICBwYWRkZWRbaSsrXSA9IDB4ODA7CiAgICBjb25zdCBuID0gcGFkZGVkTGVuZ3RoIC0gODsKICAgIHdoaWxlIChpIDwgbikgewogICAgICBwYWRkZWRbaSsrXSA9IDA7CiAgICB9CiAgICBwYWRkZWRbaSsrXSA9IGxlbmd0aCA8PCAzICYgMHhmZjsKICAgIHBhZGRlZFtpKytdID0gbGVuZ3RoID4+IDUgJiAweGZmOwogICAgcGFkZGVkW2krK10gPSBsZW5ndGggPj4gMTMgJiAweGZmOwogICAgcGFkZGVkW2krK10gPSBsZW5ndGggPj4gMjEgJiAweGZmOwogICAgcGFkZGVkW2krK10gPSBsZW5ndGggPj4+IDI5ICYgMHhmZjsKICAgIHBhZGRlZFtpKytdID0gMDsKICAgIHBhZGRlZFtpKytdID0gMDsKICAgIHBhZGRlZFtpKytdID0gMDsKICAgIGNvbnN0IHcgPSBuZXcgSW50MzJBcnJheSgxNik7CiAgICBmb3IgKGkgPSAwOyBpIDwgcGFkZGVkTGVuZ3RoOykgewogICAgICBmb3IgKGogPSAwOyBqIDwgMTY7ICsraiwgaSArPSA0KSB7CiAgICAgICAgd1tqXSA9IHBhZGRlZFtpXSB8IHBhZGRlZFtpICsgMV0gPDwgOCB8IHBhZGRlZFtpICsgMl0gPDwgMTYgfCBwYWRkZWRbaSArIDNdIDw8IDI0OwogICAgICB9CiAgICAgIGxldCBhID0gaDAsCiAgICAgICAgYiA9IGgxLAogICAgICAgIGMgPSBoMiwKICAgICAgICBkID0gaDMsCiAgICAgICAgZiwKICAgICAgICBnOwogICAgICBmb3IgKGogPSAwOyBqIDwgNjQ7ICsraikgewogICAgICAgIGlmIChqIDwgMTYpIHsKICAgICAgICAgIGYgPSBiICYgYyB8IH5iICYgZDsKICAgICAgICAgIGcgPSBqOwogICAgICAgIH0gZWxzZSBpZiAoaiA8IDMyKSB7CiAgICAgICAgICBmID0gZCAmIGIgfCB+ZCAmIGM7CiAgICAgICAgICBnID0gNSAqIGogKyAxICYgMTU7CiAgICAgICAgfSBlbHNlIGlmIChqIDwgNDgpIHsKICAgICAgICAgIGYgPSBiIF4gYyBeIGQ7CiAgICAgICAgICBnID0gMyAqIGogKyA1ICYgMTU7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIGYgPSBjIF4gKGIgfCB+ZCk7CiAgICAgICAgICBnID0gNyAqIGogJiAxNTsKICAgICAgICB9CiAgICAgICAgY29uc3QgdG1wID0gZCwKICAgICAgICAgIHJvdGF0ZUFyZyA9IGEgKyBmICsga1tqXSArIHdbZ10gfCAwLAogICAgICAgICAgcm90YXRlID0gcltqXTsKICAgICAgICBkID0gYzsKICAgICAgICBjID0gYjsKICAgICAgICBiID0gYiArIChyb3RhdGVBcmcgPDwgcm90YXRlIHwgcm90YXRlQXJnID4+PiAzMiAtIHJvdGF0ZSkgfCAwOwogICAgICAgIGEgPSB0bXA7CiAgICAgIH0KICAgICAgaDAgPSBoMCArIGEgfCAwOwogICAgICBoMSA9IGgxICsgYiB8IDA7CiAgICAgIGgyID0gaDIgKyBjIHwgMDsKICAgICAgaDMgPSBoMyArIGQgfCAwOwogICAgfQogICAgcmV0dXJuIG5ldyBVaW50OEFycmF5KFtoMCAmIDB4RkYsIGgwID4+IDggJiAweEZGLCBoMCA+PiAxNiAmIDB4RkYsIGgwID4+PiAyNCAmIDB4RkYsIGgxICYgMHhGRiwgaDEgPj4gOCAmIDB4RkYsIGgxID4+IDE2ICYgMHhGRiwgaDEgPj4+IDI0ICYgMHhGRiwgaDIgJiAweEZGLCBoMiA+PiA4ICYgMHhGRiwgaDIgPj4gMTYgJiAweEZGLCBoMiA+Pj4gMjQgJiAweEZGLCBoMyAmIDB4RkYsIGgzID4+IDggJiAweEZGLCBoMyA+PiAxNiAmIDB4RkYsIGgzID4+PiAyNCAmIDB4RkZdKTsKICB9CiAgcmV0dXJuIGhhc2g7Cn0oKTsKZXhwb3J0cy5jYWxjdWxhdGVNRDUgPSBjYWxjdWxhdGVNRDU7CmNsYXNzIFdvcmQ2NCB7CiAgY29uc3RydWN0b3IoaGlnaEludGVnZXIsIGxvd0ludGVnZXIpIHsKICAgIHRoaXMuaGlnaCA9IGhpZ2hJbnRlZ2VyIHwgMDsKICAgIHRoaXMubG93ID0gbG93SW50ZWdlciB8IDA7CiAgfQogIGFuZCh3b3JkKSB7CiAgICB0aGlzLmhpZ2ggJj0gd29yZC5oaWdoOwogICAgdGhpcy5sb3cgJj0gd29yZC5sb3c7CiAgfQogIHhvcih3b3JkKSB7CiAgICB0aGlzLmhpZ2ggXj0gd29yZC5oaWdoOwogICAgdGhpcy5sb3cgXj0gd29yZC5sb3c7CiAgfQogIG9yKHdvcmQpIHsKICAgIHRoaXMuaGlnaCB8PSB3b3JkLmhpZ2g7CiAgICB0aGlzLmxvdyB8PSB3b3JkLmxvdzsKICB9CiAgc2hpZnRSaWdodChwbGFjZXMpIHsKICAgIGlmIChwbGFjZXMgPj0gMzIpIHsKICAgICAgdGhpcy5sb3cgPSB0aGlzLmhpZ2ggPj4+IHBsYWNlcyAtIDMyIHwgMDsKICAgICAgdGhpcy5oaWdoID0gMDsKICAgIH0gZWxzZSB7CiAgICAgIHRoaXMubG93ID0gdGhpcy5sb3cgPj4+IHBsYWNlcyB8IHRoaXMuaGlnaCA8PCAzMiAtIHBsYWNlczsKICAgICAgdGhpcy5oaWdoID0gdGhpcy5oaWdoID4+PiBwbGFjZXMgfCAwOwogICAgfQogIH0KICBzaGlmdExlZnQocGxhY2VzKSB7CiAgICBpZiAocGxhY2VzID49IDMyKSB7CiAgICAgIHRoaXMuaGlnaCA9IHRoaXMubG93IDw8IHBsYWNlcyAtIDMyOwogICAgICB0aGlzLmxvdyA9IDA7CiAgICB9IGVsc2UgewogICAgICB0aGlzLmhpZ2ggPSB0aGlzLmhpZ2ggPDwgcGxhY2VzIHwgdGhpcy5sb3cgPj4+IDMyIC0gcGxhY2VzOwogICAgICB0aGlzLmxvdyA8PD0gcGxhY2VzOwogICAgfQogIH0KICByb3RhdGVSaWdodChwbGFjZXMpIHsKICAgIGxldCBsb3csIGhpZ2g7CiAgICBpZiAocGxhY2VzICYgMzIpIHsKICAgICAgaGlnaCA9IHRoaXMubG93OwogICAgICBsb3cgPSB0aGlzLmhpZ2g7CiAgICB9IGVsc2UgewogICAgICBsb3cgPSB0aGlzLmxvdzsKICAgICAgaGlnaCA9IHRoaXMuaGlnaDsKICAgIH0KICAgIHBsYWNlcyAmPSAzMTsKICAgIHRoaXMubG93ID0gbG93ID4+PiBwbGFjZXMgfCBoaWdoIDw8IDMyIC0gcGxhY2VzOwogICAgdGhpcy5oaWdoID0gaGlnaCA+Pj4gcGxhY2VzIHwgbG93IDw8IDMyIC0gcGxhY2VzOwogIH0KICBub3QoKSB7CiAgICB0aGlzLmhpZ2ggPSB+dGhpcy5oaWdoOwogICAgdGhpcy5sb3cgPSB+dGhpcy5sb3c7CiAgfQogIGFkZCh3b3JkKSB7CiAgICBjb25zdCBsb3dBZGQgPSAodGhpcy5sb3cgPj4+IDApICsgKHdvcmQubG93ID4+PiAwKTsKICAgIGxldCBoaWdoQWRkID0gKHRoaXMuaGlnaCA+Pj4gMCkgKyAod29yZC5oaWdoID4+PiAwKTsKICAgIGlmIChsb3dBZGQgPiAweGZmZmZmZmZmKSB7CiAgICAgIGhpZ2hBZGQgKz0gMTsKICAgIH0KICAgIHRoaXMubG93ID0gbG93QWRkIHwgMDsKICAgIHRoaXMuaGlnaCA9IGhpZ2hBZGQgfCAwOwogIH0KICBjb3B5VG8oYnl0ZXMsIG9mZnNldCkgewogICAgYnl0ZXNbb2Zmc2V0XSA9IHRoaXMuaGlnaCA+Pj4gMjQgJiAweGZmOwogICAgYnl0ZXNbb2Zmc2V0ICsgMV0gPSB0aGlzLmhpZ2ggPj4gMTYgJiAweGZmOwogICAgYnl0ZXNbb2Zmc2V0ICsgMl0gPSB0aGlzLmhpZ2ggPj4gOCAmIDB4ZmY7CiAgICBieXRlc1tvZmZzZXQgKyAzXSA9IHRoaXMuaGlnaCAmIDB4ZmY7CiAgICBieXRlc1tvZmZzZXQgKyA0XSA9IHRoaXMubG93ID4+PiAyNCAmIDB4ZmY7CiAgICBieXRlc1tvZmZzZXQgKyA1XSA9IHRoaXMubG93ID4+IDE2ICYgMHhmZjsKICAgIGJ5dGVzW29mZnNldCArIDZdID0gdGhpcy5sb3cgPj4gOCAmIDB4ZmY7CiAgICBieXRlc1tvZmZzZXQgKyA3XSA9IHRoaXMubG93ICYgMHhmZjsKICB9CiAgYXNzaWduKHdvcmQpIHsKICAgIHRoaXMuaGlnaCA9IHdvcmQuaGlnaDsKICAgIHRoaXMubG93ID0gd29yZC5sb3c7CiAgfQp9CmNvbnN0IGNhbGN1bGF0ZVNIQTI1NiA9IGZ1bmN0aW9uIGNhbGN1bGF0ZVNIQTI1NkNsb3N1cmUoKSB7CiAgZnVuY3Rpb24gcm90cih4LCBuKSB7CiAgICByZXR1cm4geCA+Pj4gbiB8IHggPDwgMzIgLSBuOwogIH0KICBmdW5jdGlvbiBjaCh4LCB5LCB6KSB7CiAgICByZXR1cm4geCAmIHkgXiB+eCAmIHo7CiAgfQogIGZ1bmN0aW9uIG1haih4LCB5LCB6KSB7CiAgICByZXR1cm4geCAmIHkgXiB4ICYgeiBeIHkgJiB6OwogIH0KICBmdW5jdGlvbiBzaWdtYSh4KSB7CiAgICByZXR1cm4gcm90cih4LCAyKSBeIHJvdHIoeCwgMTMpIF4gcm90cih4LCAyMik7CiAgfQogIGZ1bmN0aW9uIHNpZ21hUHJpbWUoeCkgewogICAgcmV0dXJuIHJvdHIoeCwgNikgXiByb3RyKHgsIDExKSBeIHJvdHIoeCwgMjUpOwogIH0KICBmdW5jdGlvbiBsaXR0bGVTaWdtYSh4KSB7CiAgICByZXR1cm4gcm90cih4LCA3KSBeIHJvdHIoeCwgMTgpIF4geCA+Pj4gMzsKICB9CiAgZnVuY3Rpb24gbGl0dGxlU2lnbWFQcmltZSh4KSB7CiAgICByZXR1cm4gcm90cih4LCAxNykgXiByb3RyKHgsIDE5KSBeIHggPj4+IDEwOwogIH0KICBjb25zdCBrID0gWzB4NDI4YTJmOTgsIDB4NzEzNzQ0OTEsIDB4YjVjMGZiY2YsIDB4ZTliNWRiYTUsIDB4Mzk1NmMyNWIsIDB4NTlmMTExZjEsIDB4OTIzZjgyYTQsIDB4YWIxYzVlZDUsIDB4ZDgwN2FhOTgsIDB4MTI4MzViMDEsIDB4MjQzMTg1YmUsIDB4NTUwYzdkYzMsIDB4NzJiZTVkNzQsIDB4ODBkZWIxZmUsIDB4OWJkYzA2YTcsIDB4YzE5YmYxNzQsIDB4ZTQ5YjY5YzEsIDB4ZWZiZTQ3ODYsIDB4MGZjMTlkYzYsIDB4MjQwY2ExY2MsIDB4MmRlOTJjNmYsIDB4NGE3NDg0YWEsIDB4NWNiMGE5ZGMsIDB4NzZmOTg4ZGEsIDB4OTgzZTUxNTIsIDB4YTgzMWM2NmQsIDB4YjAwMzI3YzgsIDB4YmY1OTdmYzcsIDB4YzZlMDBiZjMsIDB4ZDVhNzkxNDcsIDB4MDZjYTYzNTEsIDB4MTQyOTI5NjcsIDB4MjdiNzBhODUsIDB4MmUxYjIxMzgsIDB4NGQyYzZkZmMsIDB4NTMzODBkMTMsIDB4NjUwYTczNTQsIDB4NzY2YTBhYmIsIDB4ODFjMmM5MmUsIDB4OTI3MjJjODUsIDB4YTJiZmU4YTEsIDB4YTgxYTY2NGIsIDB4YzI0YjhiNzAsIDB4Yzc2YzUxYTMsIDB4ZDE5MmU4MTksIDB4ZDY5OTA2MjQsIDB4ZjQwZTM1ODUsIDB4MTA2YWEwNzAsIDB4MTlhNGMxMTYsIDB4MWUzNzZjMDgsIDB4Mjc0ODc3NGMsIDB4MzRiMGJjYjUsIDB4MzkxYzBjYjMsIDB4NGVkOGFhNGEsIDB4NWI5Y2NhNGYsIDB4NjgyZTZmZjMsIDB4NzQ4ZjgyZWUsIDB4NzhhNTYzNmYsIDB4ODRjODc4MTQsIDB4OGNjNzAyMDgsIDB4OTBiZWZmZmEsIDB4YTQ1MDZjZWIsIDB4YmVmOWEzZjcsIDB4YzY3MTc4ZjJdOwogIGZ1bmN0aW9uIGhhc2goZGF0YSwgb2Zmc2V0LCBsZW5ndGgpIHsKICAgIGxldCBoMCA9IDB4NmEwOWU2NjcsCiAgICAgIGgxID0gMHhiYjY3YWU4NSwKICAgICAgaDIgPSAweDNjNmVmMzcyLAogICAgICBoMyA9IDB4YTU0ZmY1M2EsCiAgICAgIGg0ID0gMHg1MTBlNTI3ZiwKICAgICAgaDUgPSAweDliMDU2ODhjLAogICAgICBoNiA9IDB4MWY4M2Q5YWIsCiAgICAgIGg3ID0gMHg1YmUwY2QxOTsKICAgIGNvbnN0IHBhZGRlZExlbmd0aCA9IE1hdGguY2VpbCgobGVuZ3RoICsgOSkgLyA2NCkgKiA2NDsKICAgIGNvbnN0IHBhZGRlZCA9IG5ldyBVaW50OEFycmF5KHBhZGRlZExlbmd0aCk7CiAgICBsZXQgaSwgajsKICAgIGZvciAoaSA9IDA7IGkgPCBsZW5ndGg7ICsraSkgewogICAgICBwYWRkZWRbaV0gPSBkYXRhW29mZnNldCsrXTsKICAgIH0KICAgIHBhZGRlZFtpKytdID0gMHg4MDsKICAgIGNvbnN0IG4gPSBwYWRkZWRMZW5ndGggLSA4OwogICAgd2hpbGUgKGkgPCBuKSB7CiAgICAgIHBhZGRlZFtpKytdID0gMDsKICAgIH0KICAgIHBhZGRlZFtpKytdID0gMDsKICAgIHBhZGRlZFtpKytdID0gMDsKICAgIHBhZGRlZFtpKytdID0gMDsKICAgIHBhZGRlZFtpKytdID0gbGVuZ3RoID4+PiAyOSAmIDB4ZmY7CiAgICBwYWRkZWRbaSsrXSA9IGxlbmd0aCA+PiAyMSAmIDB4ZmY7CiAgICBwYWRkZWRbaSsrXSA9IGxlbmd0aCA+PiAxMyAmIDB4ZmY7CiAgICBwYWRkZWRbaSsrXSA9IGxlbmd0aCA+PiA1ICYgMHhmZjsKICAgIHBhZGRlZFtpKytdID0gbGVuZ3RoIDw8IDMgJiAweGZmOwogICAgY29uc3QgdyA9IG5ldyBVaW50MzJBcnJheSg2NCk7CiAgICBmb3IgKGkgPSAwOyBpIDwgcGFkZGVkTGVuZ3RoOykgewogICAgICBmb3IgKGogPSAwOyBqIDwgMTY7ICsraikgewogICAgICAgIHdbal0gPSBwYWRkZWRbaV0gPDwgMjQgfCBwYWRkZWRbaSArIDFdIDw8IDE2IHwgcGFkZGVkW2kgKyAyXSA8PCA4IHwgcGFkZGVkW2kgKyAzXTsKICAgICAgICBpICs9IDQ7CiAgICAgIH0KICAgICAgZm9yIChqID0gMTY7IGogPCA2NDsgKytqKSB7CiAgICAgICAgd1tqXSA9IGxpdHRsZVNpZ21hUHJpbWUod1tqIC0gMl0pICsgd1tqIC0gN10gKyBsaXR0bGVTaWdtYSh3W2ogLSAxNV0pICsgd1tqIC0gMTZdIHwgMDsKICAgICAgfQogICAgICBsZXQgYSA9IGgwLAogICAgICAgIGIgPSBoMSwKICAgICAgICBjID0gaDIsCiAgICAgICAgZCA9IGgzLAogICAgICAgIGUgPSBoNCwKICAgICAgICBmID0gaDUsCiAgICAgICAgZyA9IGg2LAogICAgICAgIGggPSBoNywKICAgICAgICB0MSwKICAgICAgICB0MjsKICAgICAgZm9yIChqID0gMDsgaiA8IDY0OyArK2opIHsKICAgICAgICB0MSA9IGggKyBzaWdtYVByaW1lKGUpICsgY2goZSwgZiwgZykgKyBrW2pdICsgd1tqXTsKICAgICAgICB0MiA9IHNpZ21hKGEpICsgbWFqKGEsIGIsIGMpOwogICAgICAgIGggPSBnOwogICAgICAgIGcgPSBmOwogICAgICAgIGYgPSBlOwogICAgICAgIGUgPSBkICsgdDEgfCAwOwogICAgICAgIGQgPSBjOwogICAgICAgIGMgPSBiOwogICAgICAgIGIgPSBhOwogICAgICAgIGEgPSB0MSArIHQyIHwgMDsKICAgICAgfQogICAgICBoMCA9IGgwICsgYSB8IDA7CiAgICAgIGgxID0gaDEgKyBiIHwgMDsKICAgICAgaDIgPSBoMiArIGMgfCAwOwogICAgICBoMyA9IGgzICsgZCB8IDA7CiAgICAgIGg0ID0gaDQgKyBlIHwgMDsKICAgICAgaDUgPSBoNSArIGYgfCAwOwogICAgICBoNiA9IGg2ICsgZyB8IDA7CiAgICAgIGg3ID0gaDcgKyBoIHwgMDsKICAgIH0KICAgIHJldHVybiBuZXcgVWludDhBcnJheShbaDAgPj4gMjQgJiAweEZGLCBoMCA+PiAxNiAmIDB4RkYsIGgwID4+IDggJiAweEZGLCBoMCAmIDB4RkYsIGgxID4+IDI0ICYgMHhGRiwgaDEgPj4gMTYgJiAweEZGLCBoMSA+PiA4ICYgMHhGRiwgaDEgJiAweEZGLCBoMiA+PiAyNCAmIDB4RkYsIGgyID4+IDE2ICYgMHhGRiwgaDIgPj4gOCAmIDB4RkYsIGgyICYgMHhGRiwgaDMgPj4gMjQgJiAweEZGLCBoMyA+PiAxNiAmIDB4RkYsIGgzID4+IDggJiAweEZGLCBoMyAmIDB4RkYsIGg0ID4+IDI0ICYgMHhGRiwgaDQgPj4gMTYgJiAweEZGLCBoNCA+PiA4ICYgMHhGRiwgaDQgJiAweEZGLCBoNSA+PiAyNCAmIDB4RkYsIGg1ID4+IDE2ICYgMHhGRiwgaDUgPj4gOCAmIDB4RkYsIGg1ICYgMHhGRiwgaDYgPj4gMjQgJiAweEZGLCBoNiA+PiAxNiAmIDB4RkYsIGg2ID4+IDggJiAweEZGLCBoNiAmIDB4RkYsIGg3ID4+IDI0ICYgMHhGRiwgaDcgPj4gMTYgJiAweEZGLCBoNyA+PiA4ICYgMHhGRiwgaDcgJiAweEZGXSk7CiAgfQogIHJldHVybiBoYXNoOwp9KCk7CmV4cG9ydHMuY2FsY3VsYXRlU0hBMjU2ID0gY2FsY3VsYXRlU0hBMjU2Owpjb25zdCBjYWxjdWxhdGVTSEE1MTIgPSBmdW5jdGlvbiBjYWxjdWxhdGVTSEE1MTJDbG9zdXJlKCkgewogIGZ1bmN0aW9uIGNoKHJlc3VsdCwgeCwgeSwgeiwgdG1wKSB7CiAgICByZXN1bHQuYXNzaWduKHgpOwogICAgcmVzdWx0LmFuZCh5KTsKICAgIHRtcC5hc3NpZ24oeCk7CiAgICB0bXAubm90KCk7CiAgICB0bXAuYW5kKHopOwogICAgcmVzdWx0Lnhvcih0bXApOwogIH0KICBmdW5jdGlvbiBtYWoocmVzdWx0LCB4LCB5LCB6LCB0bXApIHsKICAgIHJlc3VsdC5hc3NpZ24oeCk7CiAgICByZXN1bHQuYW5kKHkpOwogICAgdG1wLmFzc2lnbih4KTsKICAgIHRtcC5hbmQoeik7CiAgICByZXN1bHQueG9yKHRtcCk7CiAgICB0bXAuYXNzaWduKHkpOwogICAgdG1wLmFuZCh6KTsKICAgIHJlc3VsdC54b3IodG1wKTsKICB9CiAgZnVuY3Rpb24gc2lnbWEocmVzdWx0LCB4LCB0bXApIHsKICAgIHJlc3VsdC5hc3NpZ24oeCk7CiAgICByZXN1bHQucm90YXRlUmlnaHQoMjgpOwogICAgdG1wLmFzc2lnbih4KTsKICAgIHRtcC5yb3RhdGVSaWdodCgzNCk7CiAgICByZXN1bHQueG9yKHRtcCk7CiAgICB0bXAuYXNzaWduKHgpOwogICAgdG1wLnJvdGF0ZVJpZ2h0KDM5KTsKICAgIHJlc3VsdC54b3IodG1wKTsKICB9CiAgZnVuY3Rpb24gc2lnbWFQcmltZShyZXN1bHQsIHgsIHRtcCkgewogICAgcmVzdWx0LmFzc2lnbih4KTsKICAgIHJlc3VsdC5yb3RhdGVSaWdodCgxNCk7CiAgICB0bXAuYXNzaWduKHgpOwogICAgdG1wLnJvdGF0ZVJpZ2h0KDE4KTsKICAgIHJlc3VsdC54b3IodG1wKTsKICAgIHRtcC5hc3NpZ24oeCk7CiAgICB0bXAucm90YXRlUmlnaHQoNDEpOwogICAgcmVzdWx0Lnhvcih0bXApOwogIH0KICBmdW5jdGlvbiBsaXR0bGVTaWdtYShyZXN1bHQsIHgsIHRtcCkgewogICAgcmVzdWx0LmFzc2lnbih4KTsKICAgIHJlc3VsdC5yb3RhdGVSaWdodCgxKTsKICAgIHRtcC5hc3NpZ24oeCk7CiAgICB0bXAucm90YXRlUmlnaHQoOCk7CiAgICByZXN1bHQueG9yKHRtcCk7CiAgICB0bXAuYXNzaWduKHgpOwogICAgdG1wLnNoaWZ0UmlnaHQoNyk7CiAgICByZXN1bHQueG9yKHRtcCk7CiAgfQogIGZ1bmN0aW9uIGxpdHRsZVNpZ21hUHJpbWUocmVzdWx0LCB4LCB0bXApIHsKICAgIHJlc3VsdC5hc3NpZ24oeCk7CiAgICByZXN1bHQucm90YXRlUmlnaHQoMTkpOwogICAgdG1wLmFzc2lnbih4KTsKICAgIHRtcC5yb3RhdGVSaWdodCg2MSk7CiAgICByZXN1bHQueG9yKHRtcCk7CiAgICB0bXAuYXNzaWduKHgpOwogICAgdG1wLnNoaWZ0UmlnaHQoNik7CiAgICByZXN1bHQueG9yKHRtcCk7CiAgfQogIGNvbnN0IGsgPSBbbmV3IFdvcmQ2NCgweDQyOGEyZjk4LCAweGQ3MjhhZTIyKSwgbmV3IFdvcmQ2NCgweDcxMzc0NDkxLCAweDIzZWY2NWNkKSwgbmV3IFdvcmQ2NCgweGI1YzBmYmNmLCAweGVjNGQzYjJmKSwgbmV3IFdvcmQ2NCgweGU5YjVkYmE1LCAweDgxODlkYmJjKSwgbmV3IFdvcmQ2NCgweDM5NTZjMjViLCAweGYzNDhiNTM4KSwgbmV3IFdvcmQ2NCgweDU5ZjExMWYxLCAweGI2MDVkMDE5KSwgbmV3IFdvcmQ2NCgweDkyM2Y4MmE0LCAweGFmMTk0ZjliKSwgbmV3IFdvcmQ2NCgweGFiMWM1ZWQ1LCAweGRhNmQ4MTE4KSwgbmV3IFdvcmQ2NCgweGQ4MDdhYTk4LCAweGEzMDMwMjQyKSwgbmV3IFdvcmQ2NCgweDEyODM1YjAxLCAweDQ1NzA2ZmJlKSwgbmV3IFdvcmQ2NCgweDI0MzE4NWJlLCAweDRlZTRiMjhjKSwgbmV3IFdvcmQ2NCgweDU1MGM3ZGMzLCAweGQ1ZmZiNGUyKSwgbmV3IFdvcmQ2NCgweDcyYmU1ZDc0LCAweGYyN2I4OTZmKSwgbmV3IFdvcmQ2NCgweDgwZGViMWZlLCAweDNiMTY5NmIxKSwgbmV3IFdvcmQ2NCgweDliZGMwNmE3LCAweDI1YzcxMjM1KSwgbmV3IFdvcmQ2NCgweGMxOWJmMTc0LCAweGNmNjkyNjk0KSwgbmV3IFdvcmQ2NCgweGU0OWI2OWMxLCAweDllZjE0YWQyKSwgbmV3IFdvcmQ2NCgweGVmYmU0Nzg2LCAweDM4NGYyNWUzKSwgbmV3IFdvcmQ2NCgweDBmYzE5ZGM2LCAweDhiOGNkNWI1KSwgbmV3IFdvcmQ2NCgweDI0MGNhMWNjLCAweDc3YWM5YzY1KSwgbmV3IFdvcmQ2NCgweDJkZTkyYzZmLCAweDU5MmIwMjc1KSwgbmV3IFdvcmQ2NCgweDRhNzQ4NGFhLCAweDZlYTZlNDgzKSwgbmV3IFdvcmQ2NCgweDVjYjBhOWRjLCAweGJkNDFmYmQ0KSwgbmV3IFdvcmQ2NCgweDc2Zjk4OGRhLCAweDgzMTE1M2I1KSwgbmV3IFdvcmQ2NCgweDk4M2U1MTUyLCAweGVlNjZkZmFiKSwgbmV3IFdvcmQ2NCgweGE4MzFjNjZkLCAweDJkYjQzMjEwKSwgbmV3IFdvcmQ2NCgweGIwMDMyN2M4LCAweDk4ZmIyMTNmKSwgbmV3IFdvcmQ2NCgweGJmNTk3ZmM3LCAweGJlZWYwZWU0KSwgbmV3IFdvcmQ2NCgweGM2ZTAwYmYzLCAweDNkYTg4ZmMyKSwgbmV3IFdvcmQ2NCgweGQ1YTc5MTQ3LCAweDkzMGFhNzI1KSwgbmV3IFdvcmQ2NCgweDA2Y2E2MzUxLCAweGUwMDM4MjZmKSwgbmV3IFdvcmQ2NCgweDE0MjkyOTY3LCAweDBhMGU2ZTcwKSwgbmV3IFdvcmQ2NCgweDI3YjcwYTg1LCAweDQ2ZDIyZmZjKSwgbmV3IFdvcmQ2NCgweDJlMWIyMTM4LCAweDVjMjZjOTI2KSwgbmV3IFdvcmQ2NCgweDRkMmM2ZGZjLCAweDVhYzQyYWVkKSwgbmV3IFdvcmQ2NCgweDUzMzgwZDEzLCAweDlkOTViM2RmKSwgbmV3IFdvcmQ2NCgweDY1MGE3MzU0LCAweDhiYWY2M2RlKSwgbmV3IFdvcmQ2NCgweDc2NmEwYWJiLCAweDNjNzdiMmE4KSwgbmV3IFdvcmQ2NCgweDgxYzJjOTJlLCAweDQ3ZWRhZWU2KSwgbmV3IFdvcmQ2NCgweDkyNzIyYzg1LCAweDE0ODIzNTNiKSwgbmV3IFdvcmQ2NCgweGEyYmZlOGExLCAweDRjZjEwMzY0KSwgbmV3IFdvcmQ2NCgweGE4MWE2NjRiLCAweGJjNDIzMDAxKSwgbmV3IFdvcmQ2NCgweGMyNGI4YjcwLCAweGQwZjg5NzkxKSwgbmV3IFdvcmQ2NCgweGM3NmM1MWEzLCAweDA2NTRiZTMwKSwgbmV3IFdvcmQ2NCgweGQxOTJlODE5LCAweGQ2ZWY1MjE4KSwgbmV3IFdvcmQ2NCgweGQ2OTkwNjI0LCAweDU1NjVhOTEwKSwgbmV3IFdvcmQ2NCgweGY0MGUzNTg1LCAweDU3NzEyMDJhKSwgbmV3IFdvcmQ2NCgweDEwNmFhMDcwLCAweDMyYmJkMWI4KSwgbmV3IFdvcmQ2NCgweDE5YTRjMTE2LCAweGI4ZDJkMGM4KSwgbmV3IFdvcmQ2NCgweDFlMzc2YzA4LCAweDUxNDFhYjUzKSwgbmV3IFdvcmQ2NCgweDI3NDg3NzRjLCAweGRmOGVlYjk5KSwgbmV3IFdvcmQ2NCgweDM0YjBiY2I1LCAweGUxOWI0OGE4KSwgbmV3IFdvcmQ2NCgweDM5MWMwY2IzLCAweGM1Yzk1YTYzKSwgbmV3IFdvcmQ2NCgweDRlZDhhYTRhLCAweGUzNDE4YWNiKSwgbmV3IFdvcmQ2NCgweDViOWNjYTRmLCAweDc3NjNlMzczKSwgbmV3IFdvcmQ2NCgweDY4MmU2ZmYzLCAweGQ2YjJiOGEzKSwgbmV3IFdvcmQ2NCgweDc0OGY4MmVlLCAweDVkZWZiMmZjKSwgbmV3IFdvcmQ2NCgweDc4YTU2MzZmLCAweDQzMTcyZjYwKSwgbmV3IFdvcmQ2NCgweDg0Yzg3ODE0LCAweGExZjBhYjcyKSwgbmV3IFdvcmQ2NCgweDhjYzcwMjA4LCAweDFhNjQzOWVjKSwgbmV3IFdvcmQ2NCgweDkwYmVmZmZhLCAweDIzNjMxZTI4KSwgbmV3IFdvcmQ2NCgweGE0NTA2Y2ViLCAweGRlODJiZGU5KSwgbmV3IFdvcmQ2NCgweGJlZjlhM2Y3LCAweGIyYzY3OTE1KSwgbmV3IFdvcmQ2NCgweGM2NzE3OGYyLCAweGUzNzI1MzJiKSwgbmV3IFdvcmQ2NCgweGNhMjczZWNlLCAweGVhMjY2MTljKSwgbmV3IFdvcmQ2NCgweGQxODZiOGM3LCAweDIxYzBjMjA3KSwgbmV3IFdvcmQ2NCgweGVhZGE3ZGQ2LCAweGNkZTBlYjFlKSwgbmV3IFdvcmQ2NCgweGY1N2Q0ZjdmLCAweGVlNmVkMTc4KSwgbmV3IFdvcmQ2NCgweDA2ZjA2N2FhLCAweDcyMTc2ZmJhKSwgbmV3IFdvcmQ2NCgweDBhNjM3ZGM1LCAweGEyYzg5OGE2KSwgbmV3IFdvcmQ2NCgweDExM2Y5ODA0LCAweGJlZjkwZGFlKSwgbmV3IFdvcmQ2NCgweDFiNzEwYjM1LCAweDEzMWM0NzFiKSwgbmV3IFdvcmQ2NCgweDI4ZGI3N2Y1LCAweDIzMDQ3ZDg0KSwgbmV3IFdvcmQ2NCgweDMyY2FhYjdiLCAweDQwYzcyNDkzKSwgbmV3IFdvcmQ2NCgweDNjOWViZTBhLCAweDE1YzliZWJjKSwgbmV3IFdvcmQ2NCgweDQzMWQ2N2M0LCAweDljMTAwZDRjKSwgbmV3IFdvcmQ2NCgweDRjYzVkNGJlLCAweGNiM2U0MmI2KSwgbmV3IFdvcmQ2NCgweDU5N2YyOTljLCAweGZjNjU3ZTJhKSwgbmV3IFdvcmQ2NCgweDVmY2I2ZmFiLCAweDNhZDZmYWVjKSwgbmV3IFdvcmQ2NCgweDZjNDQxOThjLCAweDRhNDc1ODE3KV07CiAgZnVuY3Rpb24gaGFzaChkYXRhLCBvZmZzZXQsIGxlbmd0aCwgbW9kZTM4NCA9IGZhbHNlKSB7CiAgICBsZXQgaDAsIGgxLCBoMiwgaDMsIGg0LCBoNSwgaDYsIGg3OwogICAgaWYgKCFtb2RlMzg0KSB7CiAgICAgIGgwID0gbmV3IFdvcmQ2NCgweDZhMDllNjY3LCAweGYzYmNjOTA4KTsKICAgICAgaDEgPSBuZXcgV29yZDY0KDB4YmI2N2FlODUsIDB4ODRjYWE3M2IpOwogICAgICBoMiA9IG5ldyBXb3JkNjQoMHgzYzZlZjM3MiwgMHhmZTk0ZjgyYik7CiAgICAgIGgzID0gbmV3IFdvcmQ2NCgweGE1NGZmNTNhLCAweDVmMWQzNmYxKTsKICAgICAgaDQgPSBuZXcgV29yZDY0KDB4NTEwZTUyN2YsIDB4YWRlNjgyZDEpOwogICAgICBoNSA9IG5ldyBXb3JkNjQoMHg5YjA1Njg4YywgMHgyYjNlNmMxZik7CiAgICAgIGg2ID0gbmV3IFdvcmQ2NCgweDFmODNkOWFiLCAweGZiNDFiZDZiKTsKICAgICAgaDcgPSBuZXcgV29yZDY0KDB4NWJlMGNkMTksIDB4MTM3ZTIxNzkpOwogICAgfSBlbHNlIHsKICAgICAgaDAgPSBuZXcgV29yZDY0KDB4Y2JiYjlkNWQsIDB4YzEwNTllZDgpOwogICAgICBoMSA9IG5ldyBXb3JkNjQoMHg2MjlhMjkyYSwgMHgzNjdjZDUwNyk7CiAgICAgIGgyID0gbmV3IFdvcmQ2NCgweDkxNTkwMTVhLCAweDMwNzBkZDE3KTsKICAgICAgaDMgPSBuZXcgV29yZDY0KDB4MTUyZmVjZDgsIDB4ZjcwZTU5MzkpOwogICAgICBoNCA9IG5ldyBXb3JkNjQoMHg2NzMzMjY2NywgMHhmZmMwMGIzMSk7CiAgICAgIGg1ID0gbmV3IFdvcmQ2NCgweDhlYjQ0YTg3LCAweDY4NTgxNTExKTsKICAgICAgaDYgPSBuZXcgV29yZDY0KDB4ZGIwYzJlMGQsIDB4NjRmOThmYTcpOwogICAgICBoNyA9IG5ldyBXb3JkNjQoMHg0N2I1NDgxZCwgMHhiZWZhNGZhNCk7CiAgICB9CiAgICBjb25zdCBwYWRkZWRMZW5ndGggPSBNYXRoLmNlaWwoKGxlbmd0aCArIDE3KSAvIDEyOCkgKiAxMjg7CiAgICBjb25zdCBwYWRkZWQgPSBuZXcgVWludDhBcnJheShwYWRkZWRMZW5ndGgpOwogICAgbGV0IGksIGo7CiAgICBmb3IgKGkgPSAwOyBpIDwgbGVuZ3RoOyArK2kpIHsKICAgICAgcGFkZGVkW2ldID0gZGF0YVtvZmZzZXQrK107CiAgICB9CiAgICBwYWRkZWRbaSsrXSA9IDB4ODA7CiAgICBjb25zdCBuID0gcGFkZGVkTGVuZ3RoIC0gMTY7CiAgICB3aGlsZSAoaSA8IG4pIHsKICAgICAgcGFkZGVkW2krK10gPSAwOwogICAgfQogICAgcGFkZGVkW2krK10gPSAwOwogICAgcGFkZGVkW2krK10gPSAwOwogICAgcGFkZGVkW2krK10gPSAwOwogICAgcGFkZGVkW2krK10gPSAwOwogICAgcGFkZGVkW2krK10gPSAwOwogICAgcGFkZGVkW2krK10gPSAwOwogICAgcGFkZGVkW2krK10gPSAwOwogICAgcGFkZGVkW2krK10gPSAwOwogICAgcGFkZGVkW2krK10gPSAwOwogICAgcGFkZGVkW2krK10gPSAwOwogICAgcGFkZGVkW2krK10gPSAwOwogICAgcGFkZGVkW2krK10gPSBsZW5ndGggPj4+IDI5ICYgMHhmZjsKICAgIHBhZGRlZFtpKytdID0gbGVuZ3RoID4+IDIxICYgMHhmZjsKICAgIHBhZGRlZFtpKytdID0gbGVuZ3RoID4+IDEzICYgMHhmZjsKICAgIHBhZGRlZFtpKytdID0gbGVuZ3RoID4+IDUgJiAweGZmOwogICAgcGFkZGVkW2krK10gPSBsZW5ndGggPDwgMyAmIDB4ZmY7CiAgICBjb25zdCB3ID0gbmV3IEFycmF5KDgwKTsKICAgIGZvciAoaSA9IDA7IGkgPCA4MDsgaSsrKSB7CiAgICAgIHdbaV0gPSBuZXcgV29yZDY0KDAsIDApOwogICAgfQogICAgbGV0IGEgPSBuZXcgV29yZDY0KDAsIDApLAogICAgICBiID0gbmV3IFdvcmQ2NCgwLCAwKSwKICAgICAgYyA9IG5ldyBXb3JkNjQoMCwgMCk7CiAgICBsZXQgZCA9IG5ldyBXb3JkNjQoMCwgMCksCiAgICAgIGUgPSBuZXcgV29yZDY0KDAsIDApLAogICAgICBmID0gbmV3IFdvcmQ2NCgwLCAwKTsKICAgIGxldCBnID0gbmV3IFdvcmQ2NCgwLCAwKSwKICAgICAgaCA9IG5ldyBXb3JkNjQoMCwgMCk7CiAgICBjb25zdCB0MSA9IG5ldyBXb3JkNjQoMCwgMCksCiAgICAgIHQyID0gbmV3IFdvcmQ2NCgwLCAwKTsKICAgIGNvbnN0IHRtcDEgPSBuZXcgV29yZDY0KDAsIDApLAogICAgICB0bXAyID0gbmV3IFdvcmQ2NCgwLCAwKTsKICAgIGxldCB0bXAzOwogICAgZm9yIChpID0gMDsgaSA8IHBhZGRlZExlbmd0aDspIHsKICAgICAgZm9yIChqID0gMDsgaiA8IDE2OyArK2opIHsKICAgICAgICB3W2pdLmhpZ2ggPSBwYWRkZWRbaV0gPDwgMjQgfCBwYWRkZWRbaSArIDFdIDw8IDE2IHwgcGFkZGVkW2kgKyAyXSA8PCA4IHwgcGFkZGVkW2kgKyAzXTsKICAgICAgICB3W2pdLmxvdyA9IHBhZGRlZFtpICsgNF0gPDwgMjQgfCBwYWRkZWRbaSArIDVdIDw8IDE2IHwgcGFkZGVkW2kgKyA2XSA8PCA4IHwgcGFkZGVkW2kgKyA3XTsKICAgICAgICBpICs9IDg7CiAgICAgIH0KICAgICAgZm9yIChqID0gMTY7IGogPCA4MDsgKytqKSB7CiAgICAgICAgdG1wMyA9IHdbal07CiAgICAgICAgbGl0dGxlU2lnbWFQcmltZSh0bXAzLCB3W2ogLSAyXSwgdG1wMik7CiAgICAgICAgdG1wMy5hZGQod1tqIC0gN10pOwogICAgICAgIGxpdHRsZVNpZ21hKHRtcDEsIHdbaiAtIDE1XSwgdG1wMik7CiAgICAgICAgdG1wMy5hZGQodG1wMSk7CiAgICAgICAgdG1wMy5hZGQod1tqIC0gMTZdKTsKICAgICAgfQogICAgICBhLmFzc2lnbihoMCk7CiAgICAgIGIuYXNzaWduKGgxKTsKICAgICAgYy5hc3NpZ24oaDIpOwogICAgICBkLmFzc2lnbihoMyk7CiAgICAgIGUuYXNzaWduKGg0KTsKICAgICAgZi5hc3NpZ24oaDUpOwogICAgICBnLmFzc2lnbihoNik7CiAgICAgIGguYXNzaWduKGg3KTsKICAgICAgZm9yIChqID0gMDsgaiA8IDgwOyArK2opIHsKICAgICAgICB0MS5hc3NpZ24oaCk7CiAgICAgICAgc2lnbWFQcmltZSh0bXAxLCBlLCB0bXAyKTsKICAgICAgICB0MS5hZGQodG1wMSk7CiAgICAgICAgY2godG1wMSwgZSwgZiwgZywgdG1wMik7CiAgICAgICAgdDEuYWRkKHRtcDEpOwogICAgICAgIHQxLmFkZChrW2pdKTsKICAgICAgICB0MS5hZGQod1tqXSk7CiAgICAgICAgc2lnbWEodDIsIGEsIHRtcDIpOwogICAgICAgIG1haih0bXAxLCBhLCBiLCBjLCB0bXAyKTsKICAgICAgICB0Mi5hZGQodG1wMSk7CiAgICAgICAgdG1wMyA9IGg7CiAgICAgICAgaCA9IGc7CiAgICAgICAgZyA9IGY7CiAgICAgICAgZiA9IGU7CiAgICAgICAgZC5hZGQodDEpOwogICAgICAgIGUgPSBkOwogICAgICAgIGQgPSBjOwogICAgICAgIGMgPSBiOwogICAgICAgIGIgPSBhOwogICAgICAgIHRtcDMuYXNzaWduKHQxKTsKICAgICAgICB0bXAzLmFkZCh0Mik7CiAgICAgICAgYSA9IHRtcDM7CiAgICAgIH0KICAgICAgaDAuYWRkKGEpOwogICAgICBoMS5hZGQoYik7CiAgICAgIGgyLmFkZChjKTsKICAgICAgaDMuYWRkKGQpOwogICAgICBoNC5hZGQoZSk7CiAgICAgIGg1LmFkZChmKTsKICAgICAgaDYuYWRkKGcpOwogICAgICBoNy5hZGQoaCk7CiAgICB9CiAgICBsZXQgcmVzdWx0OwogICAgaWYgKCFtb2RlMzg0KSB7CiAgICAgIHJlc3VsdCA9IG5ldyBVaW50OEFycmF5KDY0KTsKICAgICAgaDAuY29weVRvKHJlc3VsdCwgMCk7CiAgICAgIGgxLmNvcHlUbyhyZXN1bHQsIDgpOwogICAgICBoMi5jb3B5VG8ocmVzdWx0LCAxNik7CiAgICAgIGgzLmNvcHlUbyhyZXN1bHQsIDI0KTsKICAgICAgaDQuY29weVRvKHJlc3VsdCwgMzIpOwogICAgICBoNS5jb3B5VG8ocmVzdWx0LCA0MCk7CiAgICAgIGg2LmNvcHlUbyhyZXN1bHQsIDQ4KTsKICAgICAgaDcuY29weVRvKHJlc3VsdCwgNTYpOwogICAgfSBlbHNlIHsKICAgICAgcmVzdWx0ID0gbmV3IFVpbnQ4QXJyYXkoNDgpOwogICAgICBoMC5jb3B5VG8ocmVzdWx0LCAwKTsKICAgICAgaDEuY29weVRvKHJlc3VsdCwgOCk7CiAgICAgIGgyLmNvcHlUbyhyZXN1bHQsIDE2KTsKICAgICAgaDMuY29weVRvKHJlc3VsdCwgMjQpOwogICAgICBoNC5jb3B5VG8ocmVzdWx0LCAzMik7CiAgICAgIGg1LmNvcHlUbyhyZXN1bHQsIDQwKTsKICAgIH0KICAgIHJldHVybiByZXN1bHQ7CiAgfQogIHJldHVybiBoYXNoOwp9KCk7CmV4cG9ydHMuY2FsY3VsYXRlU0hBNTEyID0gY2FsY3VsYXRlU0hBNTEyOwpmdW5jdGlvbiBjYWxjdWxhdGVTSEEzODQoZGF0YSwgb2Zmc2V0LCBsZW5ndGgpIHsKICByZXR1cm4gY2FsY3VsYXRlU0hBNTEyKGRhdGEsIG9mZnNldCwgbGVuZ3RoLCB0cnVlKTsKfQpjbGFzcyBOdWxsQ2lwaGVyIHsKICBkZWNyeXB0QmxvY2soZGF0YSkgewogICAgcmV0dXJuIGRhdGE7CiAgfQogIGVuY3J5cHQoZGF0YSkgewogICAgcmV0dXJuIGRhdGE7CiAgfQp9CmNsYXNzIEFFU0Jhc2VDaXBoZXIgewogIGNvbnN0cnVjdG9yKCkgewogICAgaWYgKHRoaXMuY29uc3RydWN0b3IgPT09IEFFU0Jhc2VDaXBoZXIpIHsKICAgICAgKDAsIF91dGlsLnVucmVhY2hhYmxlKSgiQ2Fubm90IGluaXRpYWxpemUgQUVTQmFzZUNpcGhlci4iKTsKICAgIH0KICAgIHRoaXMuX3MgPSBuZXcgVWludDhBcnJheShbMHg2MywgMHg3YywgMHg3NywgMHg3YiwgMHhmMiwgMHg2YiwgMHg2ZiwgMHhjNSwgMHgzMCwgMHgwMSwgMHg2NywgMHgyYiwgMHhmZSwgMHhkNywgMHhhYiwgMHg3NiwgMHhjYSwgMHg4MiwgMHhjOSwgMHg3ZCwgMHhmYSwgMHg1OSwgMHg0NywgMHhmMCwgMHhhZCwgMHhkNCwgMHhhMiwgMHhhZiwgMHg5YywgMHhhNCwgMHg3MiwgMHhjMCwgMHhiNywgMHhmZCwgMHg5MywgMHgyNiwgMHgzNiwgMHgzZiwgMHhmNywgMHhjYywgMHgzNCwgMHhhNSwgMHhlNSwgMHhmMSwgMHg3MSwgMHhkOCwgMHgzMSwgMHgxNSwgMHgwNCwgMHhjNywgMHgyMywgMHhjMywgMHgxOCwgMHg5NiwgMHgwNSwgMHg5YSwgMHgwNywgMHgxMiwgMHg4MCwgMHhlMiwgMHhlYiwgMHgyNywgMHhiMiwgMHg3NSwgMHgwOSwgMHg4MywgMHgyYywgMHgxYSwgMHgxYiwgMHg2ZSwgMHg1YSwgMHhhMCwgMHg1MiwgMHgzYiwgMHhkNiwgMHhiMywgMHgyOSwgMHhlMywgMHgyZiwgMHg4NCwgMHg1MywgMHhkMSwgMHgwMCwgMHhlZCwgMHgyMCwgMHhmYywgMHhiMSwgMHg1YiwgMHg2YSwgMHhjYiwgMHhiZSwgMHgzOSwgMHg0YSwgMHg0YywgMHg1OCwgMHhjZiwgMHhkMCwgMHhlZiwgMHhhYSwgMHhmYiwgMHg0MywgMHg0ZCwgMHgzMywgMHg4NSwgMHg0NSwgMHhmOSwgMHgwMiwgMHg3ZiwgMHg1MCwgMHgzYywgMHg5ZiwgMHhhOCwgMHg1MSwgMHhhMywgMHg0MCwgMHg4ZiwgMHg5MiwgMHg5ZCwgMHgzOCwgMHhmNSwgMHhiYywgMHhiNiwgMHhkYSwgMHgyMSwgMHgxMCwgMHhmZiwgMHhmMywgMHhkMiwgMHhjZCwgMHgwYywgMHgxMywgMHhlYywgMHg1ZiwgMHg5NywgMHg0NCwgMHgxNywgMHhjNCwgMHhhNywgMHg3ZSwgMHgzZCwgMHg2NCwgMHg1ZCwgMHgxOSwgMHg3MywgMHg2MCwgMHg4MSwgMHg0ZiwgMHhkYywgMHgyMiwgMHgyYSwgMHg5MCwgMHg4OCwgMHg0NiwgMHhlZSwgMHhiOCwgMHgxNCwgMHhkZSwgMHg1ZSwgMHgwYiwgMHhkYiwgMHhlMCwgMHgzMiwgMHgzYSwgMHgwYSwgMHg0OSwgMHgwNiwgMHgyNCwgMHg1YywgMHhjMiwgMHhkMywgMHhhYywgMHg2MiwgMHg5MSwgMHg5NSwgMHhlNCwgMHg3OSwgMHhlNywgMHhjOCwgMHgzNywgMHg2ZCwgMHg4ZCwgMHhkNSwgMHg0ZSwgMHhhOSwgMHg2YywgMHg1NiwgMHhmNCwgMHhlYSwgMHg2NSwgMHg3YSwgMHhhZSwgMHgwOCwgMHhiYSwgMHg3OCwgMHgyNSwgMHgyZSwgMHgxYywgMHhhNiwgMHhiNCwgMHhjNiwgMHhlOCwgMHhkZCwgMHg3NCwgMHgxZiwgMHg0YiwgMHhiZCwgMHg4YiwgMHg4YSwgMHg3MCwgMHgzZSwgMHhiNSwgMHg2NiwgMHg0OCwgMHgwMywgMHhmNiwgMHgwZSwgMHg2MSwgMHgzNSwgMHg1NywgMHhiOSwgMHg4NiwgMHhjMSwgMHgxZCwgMHg5ZSwgMHhlMSwgMHhmOCwgMHg5OCwgMHgxMSwgMHg2OSwgMHhkOSwgMHg4ZSwgMHg5NCwgMHg5YiwgMHgxZSwgMHg4NywgMHhlOSwgMHhjZSwgMHg1NSwgMHgyOCwgMHhkZiwgMHg4YywgMHhhMSwgMHg4OSwgMHgwZCwgMHhiZiwgMHhlNiwgMHg0MiwgMHg2OCwgMHg0MSwgMHg5OSwgMHgyZCwgMHgwZiwgMHhiMCwgMHg1NCwgMHhiYiwgMHgxNl0pOwogICAgdGhpcy5faW52X3MgPSBuZXcgVWludDhBcnJheShbMHg1MiwgMHgwOSwgMHg2YSwgMHhkNSwgMHgzMCwgMHgzNiwgMHhhNSwgMHgzOCwgMHhiZiwgMHg0MCwgMHhhMywgMHg5ZSwgMHg4MSwgMHhmMywgMHhkNywgMHhmYiwgMHg3YywgMHhlMywgMHgzOSwgMHg4MiwgMHg5YiwgMHgyZiwgMHhmZiwgMHg4NywgMHgzNCwgMHg4ZSwgMHg0MywgMHg0NCwgMHhjNCwgMHhkZSwgMHhlOSwgMHhjYiwgMHg1NCwgMHg3YiwgMHg5NCwgMHgzMiwgMHhhNiwgMHhjMiwgMHgyMywgMHgzZCwgMHhlZSwgMHg0YywgMHg5NSwgMHgwYiwgMHg0MiwgMHhmYSwgMHhjMywgMHg0ZSwgMHgwOCwgMHgyZSwgMHhhMSwgMHg2NiwgMHgyOCwgMHhkOSwgMHgyNCwgMHhiMiwgMHg3NiwgMHg1YiwgMHhhMiwgMHg0OSwgMHg2ZCwgMHg4YiwgMHhkMSwgMHgyNSwgMHg3MiwgMHhmOCwgMHhmNiwgMHg2NCwgMHg4NiwgMHg2OCwgMHg5OCwgMHgxNiwgMHhkNCwgMHhhNCwgMHg1YywgMHhjYywgMHg1ZCwgMHg2NSwgMHhiNiwgMHg5MiwgMHg2YywgMHg3MCwgMHg0OCwgMHg1MCwgMHhmZCwgMHhlZCwgMHhiOSwgMHhkYSwgMHg1ZSwgMHgxNSwgMHg0NiwgMHg1NywgMHhhNywgMHg4ZCwgMHg5ZCwgMHg4NCwgMHg5MCwgMHhkOCwgMHhhYiwgMHgwMCwgMHg4YywgMHhiYywgMHhkMywgMHgwYSwgMHhmNywgMHhlNCwgMHg1OCwgMHgwNSwgMHhiOCwgMHhiMywgMHg0NSwgMHgwNiwgMHhkMCwgMHgyYywgMHgxZSwgMHg4ZiwgMHhjYSwgMHgzZiwgMHgwZiwgMHgwMiwgMHhjMSwgMHhhZiwgMHhiZCwgMHgwMywgMHgwMSwgMHgxMywgMHg4YSwgMHg2YiwgMHgzYSwgMHg5MSwgMHgxMSwgMHg0MSwgMHg0ZiwgMHg2NywgMHhkYywgMHhlYSwgMHg5NywgMHhmMiwgMHhjZiwgMHhjZSwgMHhmMCwgMHhiNCwgMHhlNiwgMHg3MywgMHg5NiwgMHhhYywgMHg3NCwgMHgyMiwgMHhlNywgMHhhZCwgMHgzNSwgMHg4NSwgMHhlMiwgMHhmOSwgMHgzNywgMHhlOCwgMHgxYywgMHg3NSwgMHhkZiwgMHg2ZSwgMHg0NywgMHhmMSwgMHgxYSwgMHg3MSwgMHgxZCwgMHgyOSwgMHhjNSwgMHg4OSwgMHg2ZiwgMHhiNywgMHg2MiwgMHgwZSwgMHhhYSwgMHgxOCwgMHhiZSwgMHgxYiwgMHhmYywgMHg1NiwgMHgzZSwgMHg0YiwgMHhjNiwgMHhkMiwgMHg3OSwgMHgyMCwgMHg5YSwgMHhkYiwgMHhjMCwgMHhmZSwgMHg3OCwgMHhjZCwgMHg1YSwgMHhmNCwgMHgxZiwgMHhkZCwgMHhhOCwgMHgzMywgMHg4OCwgMHgwNywgMHhjNywgMHgzMSwgMHhiMSwgMHgxMiwgMHgxMCwgMHg1OSwgMHgyNywgMHg4MCwgMHhlYywgMHg1ZiwgMHg2MCwgMHg1MSwgMHg3ZiwgMHhhOSwgMHgxOSwgMHhiNSwgMHg0YSwgMHgwZCwgMHgyZCwgMHhlNSwgMHg3YSwgMHg5ZiwgMHg5MywgMHhjOSwgMHg5YywgMHhlZiwgMHhhMCwgMHhlMCwgMHgzYiwgMHg0ZCwgMHhhZSwgMHgyYSwgMHhmNSwgMHhiMCwgMHhjOCwgMHhlYiwgMHhiYiwgMHgzYywgMHg4MywgMHg1MywgMHg5OSwgMHg2MSwgMHgxNywgMHgyYiwgMHgwNCwgMHg3ZSwgMHhiYSwgMHg3NywgMHhkNiwgMHgyNiwgMHhlMSwgMHg2OSwgMHgxNCwgMHg2MywgMHg1NSwgMHgyMSwgMHgwYywgMHg3ZF0pOwogICAgdGhpcy5fbWl4ID0gbmV3IFVpbnQzMkFycmF5KFsweDAwMDAwMDAwLCAweDBlMDkwZDBiLCAweDFjMTIxYTE2LCAweDEyMWIxNzFkLCAweDM4MjQzNDJjLCAweDM2MmQzOTI3LCAweDI0MzYyZTNhLCAweDJhM2YyMzMxLCAweDcwNDg2ODU4LCAweDdlNDE2NTUzLCAweDZjNWE3MjRlLCAweDYyNTM3ZjQ1LCAweDQ4NmM1Yzc0LCAweDQ2NjU1MTdmLCAweDU0N2U0NjYyLCAweDVhNzc0YjY5LCAweGUwOTBkMGIwLCAweGVlOTlkZGJiLCAweGZjODJjYWE2LCAweGYyOGJjN2FkLCAweGQ4YjRlNDljLCAweGQ2YmRlOTk3LCAweGM0YTZmZThhLCAweGNhYWZmMzgxLCAweDkwZDhiOGU4LCAweDllZDFiNWUzLCAweDhjY2FhMmZlLCAweDgyYzNhZmY1LCAweGE4ZmM4Y2M0LCAweGE2ZjU4MWNmLCAweGI0ZWU5NmQyLCAweGJhZTc5YmQ5LCAweGRiM2JiYjdiLCAweGQ1MzJiNjcwLCAweGM3MjlhMTZkLCAweGM5MjBhYzY2LCAweGUzMWY4ZjU3LCAweGVkMTY4MjVjLCAweGZmMGQ5NTQxLCAweGYxMDQ5ODRhLCAweGFiNzNkMzIzLCAweGE1N2FkZTI4LCAweGI3NjFjOTM1LCAweGI5NjhjNDNlLCAweDkzNTdlNzBmLCAweDlkNWVlYTA0LCAweDhmNDVmZDE5LCAweDgxNGNmMDEyLCAweDNiYWI2YmNiLCAweDM1YTI2NmMwLCAweDI3Yjk3MWRkLCAweDI5YjA3Y2Q2LCAweDAzOGY1ZmU3LCAweDBkODY1MmVjLCAweDFmOWQ0NWYxLCAweDExOTQ0OGZhLCAweDRiZTMwMzkzLCAweDQ1ZWEwZTk4LCAweDU3ZjExOTg1LCAweDU5ZjgxNDhlLCAweDczYzczN2JmLCAweDdkY2UzYWI0LCAweDZmZDUyZGE5LCAweDYxZGMyMGEyLCAweGFkNzY2ZGY2LCAweGEzN2Y2MGZkLCAweGIxNjQ3N2UwLCAweGJmNmQ3YWViLCAweDk1NTI1OWRhLCAweDliNWI1NGQxLCAweDg5NDA0M2NjLCAweDg3NDk0ZWM3LCAweGRkM2UwNWFlLCAweGQzMzcwOGE1LCAweGMxMmMxZmI4LCAweGNmMjUxMmIzLCAweGU1MWEzMTgyLCAweGViMTMzYzg5LCAweGY5MDgyYjk0LCAweGY3MDEyNjlmLCAweDRkZTZiZDQ2LCAweDQzZWZiMDRkLCAweDUxZjRhNzUwLCAweDVmZmRhYTViLCAweDc1YzI4OTZhLCAweDdiY2I4NDYxLCAweDY5ZDA5MzdjLCAweDY3ZDk5ZTc3LCAweDNkYWVkNTFlLCAweDMzYTdkODE1LCAweDIxYmNjZjA4LCAweDJmYjVjMjAzLCAweDA1OGFlMTMyLCAweDBiODNlYzM5LCAweDE5OThmYjI0LCAweDE3OTFmNjJmLCAweDc2NGRkNjhkLCAweDc4NDRkYjg2LCAweDZhNWZjYzliLCAweDY0NTZjMTkwLCAweDRlNjllMmExLCAweDQwNjBlZmFhLCAweDUyN2JmOGI3LCAweDVjNzJmNWJjLCAweDA2MDViZWQ1LCAweDA4MGNiM2RlLCAweDFhMTdhNGMzLCAweDE0MWVhOWM4LCAweDNlMjE4YWY5LCAweDMwMjg4N2YyLCAweDIyMzM5MGVmLCAweDJjM2E5ZGU0LCAweDk2ZGQwNjNkLCAweDk4ZDQwYjM2LCAweDhhY2YxYzJiLCAweDg0YzYxMTIwLCAweGFlZjkzMjExLCAweGEwZjAzZjFhLCAweGIyZWIyODA3LCAweGJjZTIyNTBjLCAweGU2OTU2ZTY1LCAweGU4OWM2MzZlLCAweGZhODc3NDczLCAweGY0OGU3OTc4LCAweGRlYjE1YTQ5LCAweGQwYjg1NzQyLCAweGMyYTM0MDVmLCAweGNjYWE0ZDU0LCAweDQxZWNkYWY3LCAweDRmZTVkN2ZjLCAweDVkZmVjMGUxLCAweDUzZjdjZGVhLCAweDc5YzhlZWRiLCAweDc3YzFlM2QwLCAweDY1ZGFmNGNkLCAweDZiZDNmOWM2LCAweDMxYTRiMmFmLCAweDNmYWRiZmE0LCAweDJkYjZhOGI5LCAweDIzYmZhNWIyLCAweDA5ODA4NjgzLCAweDA3ODk4Yjg4LCAweDE1OTI5Yzk1LCAweDFiOWI5MTllLCAweGExN2MwYTQ3LCAweGFmNzUwNzRjLCAweGJkNmUxMDUxLCAweGIzNjcxZDVhLCAweDk5NTgzZTZiLCAweDk3NTEzMzYwLCAweDg1NGEyNDdkLCAweDhiNDMyOTc2LCAweGQxMzQ2MjFmLCAweGRmM2Q2ZjE0LCAweGNkMjY3ODA5LCAweGMzMmY3NTAyLCAweGU5MTA1NjMzLCAweGU3MTk1YjM4LCAweGY1MDI0YzI1LCAweGZiMGI0MTJlLCAweDlhZDc2MThjLCAweDk0ZGU2Yzg3LCAweDg2YzU3YjlhLCAweDg4Y2M3NjkxLCAweGEyZjM1NWEwLCAweGFjZmE1OGFiLCAweGJlZTE0ZmI2LCAweGIwZTg0MmJkLCAweGVhOWYwOWQ0LCAweGU0OTYwNGRmLCAweGY2OGQxM2MyLCAweGY4ODQxZWM5LCAweGQyYmIzZGY4LCAweGRjYjIzMGYzLCAweGNlYTkyN2VlLCAweGMwYTAyYWU1LCAweDdhNDdiMTNjLCAweDc0NGViYzM3LCAweDY2NTVhYjJhLCAweDY4NWNhNjIxLCAweDQyNjM4NTEwLCAweDRjNmE4ODFiLCAweDVlNzE5ZjA2LCAweDUwNzg5MjBkLCAweDBhMGZkOTY0LCAweDA0MDZkNDZmLCAweDE2MWRjMzcyLCAweDE4MTRjZTc5LCAweDMyMmJlZDQ4LCAweDNjMjJlMDQzLCAweDJlMzlmNzVlLCAweDIwMzBmYTU1LCAweGVjOWFiNzAxLCAweGUyOTNiYTBhLCAweGYwODhhZDE3LCAweGZlODFhMDFjLCAweGQ0YmU4MzJkLCAweGRhYjc4ZTI2LCAweGM4YWM5OTNiLCAweGM2YTU5NDMwLCAweDljZDJkZjU5LCAweDkyZGJkMjUyLCAweDgwYzBjNTRmLCAweDhlYzljODQ0LCAweGE0ZjZlYjc1LCAweGFhZmZlNjdlLCAweGI4ZTRmMTYzLCAweGI2ZWRmYzY4LCAweDBjMGE2N2IxLCAweDAyMDM2YWJhLCAweDEwMTg3ZGE3LCAweDFlMTE3MGFjLCAweDM0MmU1MzlkLCAweDNhMjc1ZTk2LCAweDI4M2M0OThiLCAweDI2MzU0NDgwLCAweDdjNDIwZmU5LCAweDcyNGIwMmUyLCAweDYwNTAxNWZmLCAweDZlNTkxOGY0LCAweDQ0NjYzYmM1LCAweDRhNmYzNmNlLCAweDU4NzQyMWQzLCAweDU2N2QyY2Q4LCAweDM3YTEwYzdhLCAweDM5YTgwMTcxLCAweDJiYjMxNjZjLCAweDI1YmExYjY3LCAweDBmODUzODU2LCAweDAxOGMzNTVkLCAweDEzOTcyMjQwLCAweDFkOWUyZjRiLCAweDQ3ZTk2NDIyLCAweDQ5ZTA2OTI5LCAweDViZmI3ZTM0LCAweDU1ZjI3MzNmLCAweDdmY2Q1MDBlLCAweDcxYzQ1ZDA1LCAweDYzZGY0YTE4LCAweDZkZDY0NzEzLCAweGQ3MzFkY2NhLCAweGQ5MzhkMWMxLCAweGNiMjNjNmRjLCAweGM1MmFjYmQ3LCAweGVmMTVlOGU2LCAweGUxMWNlNWVkLCAweGYzMDdmMmYwLCAweGZkMGVmZmZiLCAweGE3NzliNDkyLCAweGE5NzBiOTk5LCAweGJiNmJhZTg0LCAweGI1NjJhMzhmLCAweDlmNWQ4MGJlLCAweDkxNTQ4ZGI1LCAweDgzNGY5YWE4LCAweDhkNDY5N2EzXSk7CiAgICB0aGlzLl9taXhDb2wgPSBuZXcgVWludDhBcnJheSgyNTYpOwogICAgZm9yIChsZXQgaSA9IDA7IGkgPCAyNTY7IGkrKykgewogICAgICB0aGlzLl9taXhDb2xbaV0gPSBpIDwgMTI4ID8gaSA8PCAxIDogaSA8PCAxIF4gMHgxYjsKICAgIH0KICAgIHRoaXMuYnVmZmVyID0gbmV3IFVpbnQ4QXJyYXkoMTYpOwogICAgdGhpcy5idWZmZXJQb3NpdGlvbiA9IDA7CiAgfQogIF9leHBhbmRLZXkoY2lwaGVyS2V5KSB7CiAgICAoMCwgX3V0aWwudW5yZWFjaGFibGUpKCJDYW5ub3QgY2FsbCBgX2V4cGFuZEtleWAgb24gdGhlIGJhc2UgY2xhc3MiKTsKICB9CiAgX2RlY3J5cHQoaW5wdXQsIGtleSkgewogICAgbGV0IHQsIHUsIHY7CiAgICBjb25zdCBzdGF0ZSA9IG5ldyBVaW50OEFycmF5KDE2KTsKICAgIHN0YXRlLnNldChpbnB1dCk7CiAgICBmb3IgKGxldCBqID0gMCwgayA9IHRoaXMuX2tleVNpemU7IGogPCAxNjsgKytqLCArK2spIHsKICAgICAgc3RhdGVbal0gXj0ga2V5W2tdOwogICAgfQogICAgZm9yIChsZXQgaSA9IHRoaXMuX2N5Y2xlc09mUmVwZXRpdGlvbiAtIDE7IGkgPj0gMTsgLS1pKSB7CiAgICAgIHQgPSBzdGF0ZVsxM107CiAgICAgIHN0YXRlWzEzXSA9IHN0YXRlWzldOwogICAgICBzdGF0ZVs5XSA9IHN0YXRlWzVdOwogICAgICBzdGF0ZVs1XSA9IHN0YXRlWzFdOwogICAgICBzdGF0ZVsxXSA9IHQ7CiAgICAgIHQgPSBzdGF0ZVsxNF07CiAgICAgIHUgPSBzdGF0ZVsxMF07CiAgICAgIHN0YXRlWzE0XSA9IHN0YXRlWzZdOwogICAgICBzdGF0ZVsxMF0gPSBzdGF0ZVsyXTsKICAgICAgc3RhdGVbNl0gPSB0OwogICAgICBzdGF0ZVsyXSA9IHU7CiAgICAgIHQgPSBzdGF0ZVsxNV07CiAgICAgIHUgPSBzdGF0ZVsxMV07CiAgICAgIHYgPSBzdGF0ZVs3XTsKICAgICAgc3RhdGVbMTVdID0gc3RhdGVbM107CiAgICAgIHN0YXRlWzExXSA9IHQ7CiAgICAgIHN0YXRlWzddID0gdTsKICAgICAgc3RhdGVbM10gPSB2OwogICAgICBmb3IgKGxldCBqID0gMDsgaiA8IDE2OyArK2opIHsKICAgICAgICBzdGF0ZVtqXSA9IHRoaXMuX2ludl9zW3N0YXRlW2pdXTsKICAgICAgfQogICAgICBmb3IgKGxldCBqID0gMCwgayA9IGkgKiAxNjsgaiA8IDE2OyArK2osICsraykgewogICAgICAgIHN0YXRlW2pdIF49IGtleVtrXTsKICAgICAgfQogICAgICBmb3IgKGxldCBqID0gMDsgaiA8IDE2OyBqICs9IDQpIHsKICAgICAgICBjb25zdCBzMCA9IHRoaXMuX21peFtzdGF0ZVtqXV07CiAgICAgICAgY29uc3QgczEgPSB0aGlzLl9taXhbc3RhdGVbaiArIDFdXTsKICAgICAgICBjb25zdCBzMiA9IHRoaXMuX21peFtzdGF0ZVtqICsgMl1dOwogICAgICAgIGNvbnN0IHMzID0gdGhpcy5fbWl4W3N0YXRlW2ogKyAzXV07CiAgICAgICAgdCA9IHMwIF4gczEgPj4+IDggXiBzMSA8PCAyNCBeIHMyID4+PiAxNiBeIHMyIDw8IDE2IF4gczMgPj4+IDI0IF4gczMgPDwgODsKICAgICAgICBzdGF0ZVtqXSA9IHQgPj4+IDI0ICYgMHhmZjsKICAgICAgICBzdGF0ZVtqICsgMV0gPSB0ID4+IDE2ICYgMHhmZjsKICAgICAgICBzdGF0ZVtqICsgMl0gPSB0ID4+IDggJiAweGZmOwogICAgICAgIHN0YXRlW2ogKyAzXSA9IHQgJiAweGZmOwogICAgICB9CiAgICB9CiAgICB0ID0gc3RhdGVbMTNdOwogICAgc3RhdGVbMTNdID0gc3RhdGVbOV07CiAgICBzdGF0ZVs5XSA9IHN0YXRlWzVdOwogICAgc3RhdGVbNV0gPSBzdGF0ZVsxXTsKICAgIHN0YXRlWzFdID0gdDsKICAgIHQgPSBzdGF0ZVsxNF07CiAgICB1ID0gc3RhdGVbMTBdOwogICAgc3RhdGVbMTRdID0gc3RhdGVbNl07CiAgICBzdGF0ZVsxMF0gPSBzdGF0ZVsyXTsKICAgIHN0YXRlWzZdID0gdDsKICAgIHN0YXRlWzJdID0gdTsKICAgIHQgPSBzdGF0ZVsxNV07CiAgICB1ID0gc3RhdGVbMTFdOwogICAgdiA9IHN0YXRlWzddOwogICAgc3RhdGVbMTVdID0gc3RhdGVbM107CiAgICBzdGF0ZVsxMV0gPSB0OwogICAgc3RhdGVbN10gPSB1OwogICAgc3RhdGVbM10gPSB2OwogICAgZm9yIChsZXQgaiA9IDA7IGogPCAxNjsgKytqKSB7CiAgICAgIHN0YXRlW2pdID0gdGhpcy5faW52X3Nbc3RhdGVbal1dOwogICAgICBzdGF0ZVtqXSBePSBrZXlbal07CiAgICB9CiAgICByZXR1cm4gc3RhdGU7CiAgfQogIF9lbmNyeXB0KGlucHV0LCBrZXkpIHsKICAgIGNvbnN0IHMgPSB0aGlzLl9zOwogICAgbGV0IHQsIHUsIHY7CiAgICBjb25zdCBzdGF0ZSA9IG5ldyBVaW50OEFycmF5KDE2KTsKICAgIHN0YXRlLnNldChpbnB1dCk7CiAgICBmb3IgKGxldCBqID0gMDsgaiA8IDE2OyArK2opIHsKICAgICAgc3RhdGVbal0gXj0ga2V5W2pdOwogICAgfQogICAgZm9yIChsZXQgaSA9IDE7IGkgPCB0aGlzLl9jeWNsZXNPZlJlcGV0aXRpb247IGkrKykgewogICAgICBmb3IgKGxldCBqID0gMDsgaiA8IDE2OyArK2opIHsKICAgICAgICBzdGF0ZVtqXSA9IHNbc3RhdGVbal1dOwogICAgICB9CiAgICAgIHYgPSBzdGF0ZVsxXTsKICAgICAgc3RhdGVbMV0gPSBzdGF0ZVs1XTsKICAgICAgc3RhdGVbNV0gPSBzdGF0ZVs5XTsKICAgICAgc3RhdGVbOV0gPSBzdGF0ZVsxM107CiAgICAgIHN0YXRlWzEzXSA9IHY7CiAgICAgIHYgPSBzdGF0ZVsyXTsKICAgICAgdSA9IHN0YXRlWzZdOwogICAgICBzdGF0ZVsyXSA9IHN0YXRlWzEwXTsKICAgICAgc3RhdGVbNl0gPSBzdGF0ZVsxNF07CiAgICAgIHN0YXRlWzEwXSA9IHY7CiAgICAgIHN0YXRlWzE0XSA9IHU7CiAgICAgIHYgPSBzdGF0ZVszXTsKICAgICAgdSA9IHN0YXRlWzddOwogICAgICB0ID0gc3RhdGVbMTFdOwogICAgICBzdGF0ZVszXSA9IHN0YXRlWzE1XTsKICAgICAgc3RhdGVbN10gPSB2OwogICAgICBzdGF0ZVsxMV0gPSB1OwogICAgICBzdGF0ZVsxNV0gPSB0OwogICAgICBmb3IgKGxldCBqID0gMDsgaiA8IDE2OyBqICs9IDQpIHsKICAgICAgICBjb25zdCBzMCA9IHN0YXRlW2ogKyAwXTsKICAgICAgICBjb25zdCBzMSA9IHN0YXRlW2ogKyAxXTsKICAgICAgICBjb25zdCBzMiA9IHN0YXRlW2ogKyAyXTsKICAgICAgICBjb25zdCBzMyA9IHN0YXRlW2ogKyAzXTsKICAgICAgICB0ID0gczAgXiBzMSBeIHMyIF4gczM7CiAgICAgICAgc3RhdGVbaiArIDBdIF49IHQgXiB0aGlzLl9taXhDb2xbczAgXiBzMV07CiAgICAgICAgc3RhdGVbaiArIDFdIF49IHQgXiB0aGlzLl9taXhDb2xbczEgXiBzMl07CiAgICAgICAgc3RhdGVbaiArIDJdIF49IHQgXiB0aGlzLl9taXhDb2xbczIgXiBzM107CiAgICAgICAgc3RhdGVbaiArIDNdIF49IHQgXiB0aGlzLl9taXhDb2xbczMgXiBzMF07CiAgICAgIH0KICAgICAgZm9yIChsZXQgaiA9IDAsIGsgPSBpICogMTY7IGogPCAxNjsgKytqLCArK2spIHsKICAgICAgICBzdGF0ZVtqXSBePSBrZXlba107CiAgICAgIH0KICAgIH0KICAgIGZvciAobGV0IGogPSAwOyBqIDwgMTY7ICsraikgewogICAgICBzdGF0ZVtqXSA9IHNbc3RhdGVbal1dOwogICAgfQogICAgdiA9IHN0YXRlWzFdOwogICAgc3RhdGVbMV0gPSBzdGF0ZVs1XTsKICAgIHN0YXRlWzVdID0gc3RhdGVbOV07CiAgICBzdGF0ZVs5XSA9IHN0YXRlWzEzXTsKICAgIHN0YXRlWzEzXSA9IHY7CiAgICB2ID0gc3RhdGVbMl07CiAgICB1ID0gc3RhdGVbNl07CiAgICBzdGF0ZVsyXSA9IHN0YXRlWzEwXTsKICAgIHN0YXRlWzZdID0gc3RhdGVbMTRdOwogICAgc3RhdGVbMTBdID0gdjsKICAgIHN0YXRlWzE0XSA9IHU7CiAgICB2ID0gc3RhdGVbM107CiAgICB1ID0gc3RhdGVbN107CiAgICB0ID0gc3RhdGVbMTFdOwogICAgc3RhdGVbM10gPSBzdGF0ZVsxNV07CiAgICBzdGF0ZVs3XSA9IHY7CiAgICBzdGF0ZVsxMV0gPSB1OwogICAgc3RhdGVbMTVdID0gdDsKICAgIGZvciAobGV0IGogPSAwLCBrID0gdGhpcy5fa2V5U2l6ZTsgaiA8IDE2OyArK2osICsraykgewogICAgICBzdGF0ZVtqXSBePSBrZXlba107CiAgICB9CiAgICByZXR1cm4gc3RhdGU7CiAgfQogIF9kZWNyeXB0QmxvY2syKGRhdGEsIGZpbmFsaXplKSB7CiAgICBjb25zdCBzb3VyY2VMZW5ndGggPSBkYXRhLmxlbmd0aDsKICAgIGxldCBidWZmZXIgPSB0aGlzLmJ1ZmZlciwKICAgICAgYnVmZmVyTGVuZ3RoID0gdGhpcy5idWZmZXJQb3NpdGlvbjsKICAgIGNvbnN0IHJlc3VsdCA9IFtdOwogICAgbGV0IGl2ID0gdGhpcy5pdjsKICAgIGZvciAobGV0IGkgPSAwOyBpIDwgc291cmNlTGVuZ3RoOyArK2kpIHsKICAgICAgYnVmZmVyW2J1ZmZlckxlbmd0aF0gPSBkYXRhW2ldOwogICAgICArK2J1ZmZlckxlbmd0aDsKICAgICAgaWYgKGJ1ZmZlckxlbmd0aCA8IDE2KSB7CiAgICAgICAgY29udGludWU7CiAgICAgIH0KICAgICAgY29uc3QgcGxhaW4gPSB0aGlzLl9kZWNyeXB0KGJ1ZmZlciwgdGhpcy5fa2V5KTsKICAgICAgZm9yIChsZXQgaiA9IDA7IGogPCAxNjsgKytqKSB7CiAgICAgICAgcGxhaW5bal0gXj0gaXZbal07CiAgICAgIH0KICAgICAgaXYgPSBidWZmZXI7CiAgICAgIHJlc3VsdC5wdXNoKHBsYWluKTsKICAgICAgYnVmZmVyID0gbmV3IFVpbnQ4QXJyYXkoMTYpOwogICAgICBidWZmZXJMZW5ndGggPSAwOwogICAgfQogICAgdGhpcy5idWZmZXIgPSBidWZmZXI7CiAgICB0aGlzLmJ1ZmZlckxlbmd0aCA9IGJ1ZmZlckxlbmd0aDsKICAgIHRoaXMuaXYgPSBpdjsKICAgIGlmIChyZXN1bHQubGVuZ3RoID09PSAwKSB7CiAgICAgIHJldHVybiBuZXcgVWludDhBcnJheSgwKTsKICAgIH0KICAgIGxldCBvdXRwdXRMZW5ndGggPSAxNiAqIHJlc3VsdC5sZW5ndGg7CiAgICBpZiAoZmluYWxpemUpIHsKICAgICAgY29uc3QgbGFzdEJsb2NrID0gcmVzdWx0LmF0KC0xKTsKICAgICAgbGV0IHBzTGVuID0gbGFzdEJsb2NrWzE1XTsKICAgICAgaWYgKHBzTGVuIDw9IDE2KSB7CiAgICAgICAgZm9yIChsZXQgaSA9IDE1LCBpaSA9IDE2IC0gcHNMZW47IGkgPj0gaWk7IC0taSkgewogICAgICAgICAgaWYgKGxhc3RCbG9ja1tpXSAhPT0gcHNMZW4pIHsKICAgICAgICAgICAgcHNMZW4gPSAwOwogICAgICAgICAgICBicmVhazsKICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgb3V0cHV0TGVuZ3RoIC09IHBzTGVuOwogICAgICAgIHJlc3VsdFtyZXN1bHQubGVuZ3RoIC0gMV0gPSBsYXN0QmxvY2suc3ViYXJyYXkoMCwgMTYgLSBwc0xlbik7CiAgICAgIH0KICAgIH0KICAgIGNvbnN0IG91dHB1dCA9IG5ldyBVaW50OEFycmF5KG91dHB1dExlbmd0aCk7CiAgICBmb3IgKGxldCBpID0gMCwgaiA9IDAsIGlpID0gcmVzdWx0Lmxlbmd0aDsgaSA8IGlpOyArK2ksIGogKz0gMTYpIHsKICAgICAgb3V0cHV0LnNldChyZXN1bHRbaV0sIGopOwogICAgfQogICAgcmV0dXJuIG91dHB1dDsKICB9CiAgZGVjcnlwdEJsb2NrKGRhdGEsIGZpbmFsaXplLCBpdiA9IG51bGwpIHsKICAgIGNvbnN0IHNvdXJjZUxlbmd0aCA9IGRhdGEubGVuZ3RoOwogICAgY29uc3QgYnVmZmVyID0gdGhpcy5idWZmZXI7CiAgICBsZXQgYnVmZmVyTGVuZ3RoID0gdGhpcy5idWZmZXJQb3NpdGlvbjsKICAgIGlmIChpdikgewogICAgICB0aGlzLml2ID0gaXY7CiAgICB9IGVsc2UgewogICAgICBmb3IgKGxldCBpID0gMDsgYnVmZmVyTGVuZ3RoIDwgMTYgJiYgaSA8IHNvdXJjZUxlbmd0aDsgKytpLCArK2J1ZmZlckxlbmd0aCkgewogICAgICAgIGJ1ZmZlcltidWZmZXJMZW5ndGhdID0gZGF0YVtpXTsKICAgICAgfQogICAgICBpZiAoYnVmZmVyTGVuZ3RoIDwgMTYpIHsKICAgICAgICB0aGlzLmJ1ZmZlckxlbmd0aCA9IGJ1ZmZlckxlbmd0aDsKICAgICAgICByZXR1cm4gbmV3IFVpbnQ4QXJyYXkoMCk7CiAgICAgIH0KICAgICAgdGhpcy5pdiA9IGJ1ZmZlcjsKICAgICAgZGF0YSA9IGRhdGEuc3ViYXJyYXkoMTYpOwogICAgfQogICAgdGhpcy5idWZmZXIgPSBuZXcgVWludDhBcnJheSgxNik7CiAgICB0aGlzLmJ1ZmZlckxlbmd0aCA9IDA7CiAgICB0aGlzLmRlY3J5cHRCbG9jayA9IHRoaXMuX2RlY3J5cHRCbG9jazI7CiAgICByZXR1cm4gdGhpcy5kZWNyeXB0QmxvY2soZGF0YSwgZmluYWxpemUpOwogIH0KICBlbmNyeXB0KGRhdGEsIGl2KSB7CiAgICBjb25zdCBzb3VyY2VMZW5ndGggPSBkYXRhLmxlbmd0aDsKICAgIGxldCBidWZmZXIgPSB0aGlzLmJ1ZmZlciwKICAgICAgYnVmZmVyTGVuZ3RoID0gdGhpcy5idWZmZXJQb3NpdGlvbjsKICAgIGNvbnN0IHJlc3VsdCA9IFtdOwogICAgaWYgKCFpdikgewogICAgICBpdiA9IG5ldyBVaW50OEFycmF5KDE2KTsKICAgIH0KICAgIGZvciAobGV0IGkgPSAwOyBpIDwgc291cmNlTGVuZ3RoOyArK2kpIHsKICAgICAgYnVmZmVyW2J1ZmZlckxlbmd0aF0gPSBkYXRhW2ldOwogICAgICArK2J1ZmZlckxlbmd0aDsKICAgICAgaWYgKGJ1ZmZlckxlbmd0aCA8IDE2KSB7CiAgICAgICAgY29udGludWU7CiAgICAgIH0KICAgICAgZm9yIChsZXQgaiA9IDA7IGogPCAxNjsgKytqKSB7CiAgICAgICAgYnVmZmVyW2pdIF49IGl2W2pdOwogICAgICB9CiAgICAgIGNvbnN0IGNpcGhlciA9IHRoaXMuX2VuY3J5cHQoYnVmZmVyLCB0aGlzLl9rZXkpOwogICAgICBpdiA9IGNpcGhlcjsKICAgICAgcmVzdWx0LnB1c2goY2lwaGVyKTsKICAgICAgYnVmZmVyID0gbmV3IFVpbnQ4QXJyYXkoMTYpOwogICAgICBidWZmZXJMZW5ndGggPSAwOwogICAgfQogICAgdGhpcy5idWZmZXIgPSBidWZmZXI7CiAgICB0aGlzLmJ1ZmZlckxlbmd0aCA9IGJ1ZmZlckxlbmd0aDsKICAgIHRoaXMuaXYgPSBpdjsKICAgIGlmIChyZXN1bHQubGVuZ3RoID09PSAwKSB7CiAgICAgIHJldHVybiBuZXcgVWludDhBcnJheSgwKTsKICAgIH0KICAgIGNvbnN0IG91dHB1dExlbmd0aCA9IDE2ICogcmVzdWx0Lmxlbmd0aDsKICAgIGNvbnN0IG91dHB1dCA9IG5ldyBVaW50OEFycmF5KG91dHB1dExlbmd0aCk7CiAgICBmb3IgKGxldCBpID0gMCwgaiA9IDAsIGlpID0gcmVzdWx0Lmxlbmd0aDsgaSA8IGlpOyArK2ksIGogKz0gMTYpIHsKICAgICAgb3V0cHV0LnNldChyZXN1bHRbaV0sIGopOwogICAgfQogICAgcmV0dXJuIG91dHB1dDsKICB9Cn0KY2xhc3MgQUVTMTI4Q2lwaGVyIGV4dGVuZHMgQUVTQmFzZUNpcGhlciB7CiAgY29uc3RydWN0b3Ioa2V5KSB7CiAgICBzdXBlcigpOwogICAgdGhpcy5fY3ljbGVzT2ZSZXBldGl0aW9uID0gMTA7CiAgICB0aGlzLl9rZXlTaXplID0gMTYwOwogICAgdGhpcy5fcmNvbiA9IG5ldyBVaW50OEFycmF5KFsweDhkLCAweDAxLCAweDAyLCAweDA0LCAweDA4LCAweDEwLCAweDIwLCAweDQwLCAweDgwLCAweDFiLCAweDM2LCAweDZjLCAweGQ4LCAweGFiLCAweDRkLCAweDlhLCAweDJmLCAweDVlLCAweGJjLCAweDYzLCAweGM2LCAweDk3LCAweDM1LCAweDZhLCAweGQ0LCAweGIzLCAweDdkLCAweGZhLCAweGVmLCAweGM1LCAweDkxLCAweDM5LCAweDcyLCAweGU0LCAweGQzLCAweGJkLCAweDYxLCAweGMyLCAweDlmLCAweDI1LCAweDRhLCAweDk0LCAweDMzLCAweDY2LCAweGNjLCAweDgzLCAweDFkLCAweDNhLCAweDc0LCAweGU4LCAweGNiLCAweDhkLCAweDAxLCAweDAyLCAweDA0LCAweDA4LCAweDEwLCAweDIwLCAweDQwLCAweDgwLCAweDFiLCAweDM2LCAweDZjLCAweGQ4LCAweGFiLCAweDRkLCAweDlhLCAweDJmLCAweDVlLCAweGJjLCAweDYzLCAweGM2LCAweDk3LCAweDM1LCAweDZhLCAweGQ0LCAweGIzLCAweDdkLCAweGZhLCAweGVmLCAweGM1LCAweDkxLCAweDM5LCAweDcyLCAweGU0LCAweGQzLCAweGJkLCAweDYxLCAweGMyLCAweDlmLCAweDI1LCAweDRhLCAweDk0LCAweDMzLCAweDY2LCAweGNjLCAweDgzLCAweDFkLCAweDNhLCAweDc0LCAweGU4LCAweGNiLCAweDhkLCAweDAxLCAweDAyLCAweDA0LCAweDA4LCAweDEwLCAweDIwLCAweDQwLCAweDgwLCAweDFiLCAweDM2LCAweDZjLCAweGQ4LCAweGFiLCAweDRkLCAweDlhLCAweDJmLCAweDVlLCAweGJjLCAweDYzLCAweGM2LCAweDk3LCAweDM1LCAweDZhLCAweGQ0LCAweGIzLCAweDdkLCAweGZhLCAweGVmLCAweGM1LCAweDkxLCAweDM5LCAweDcyLCAweGU0LCAweGQzLCAweGJkLCAweDYxLCAweGMyLCAweDlmLCAweDI1LCAweDRhLCAweDk0LCAweDMzLCAweDY2LCAweGNjLCAweDgzLCAweDFkLCAweDNhLCAweDc0LCAweGU4LCAweGNiLCAweDhkLCAweDAxLCAweDAyLCAweDA0LCAweDA4LCAweDEwLCAweDIwLCAweDQwLCAweDgwLCAweDFiLCAweDM2LCAweDZjLCAweGQ4LCAweGFiLCAweDRkLCAweDlhLCAweDJmLCAweDVlLCAweGJjLCAweDYzLCAweGM2LCAweDk3LCAweDM1LCAweDZhLCAweGQ0LCAweGIzLCAweDdkLCAweGZhLCAweGVmLCAweGM1LCAweDkxLCAweDM5LCAweDcyLCAweGU0LCAweGQzLCAweGJkLCAweDYxLCAweGMyLCAweDlmLCAweDI1LCAweDRhLCAweDk0LCAweDMzLCAweDY2LCAweGNjLCAweDgzLCAweDFkLCAweDNhLCAweDc0LCAweGU4LCAweGNiLCAweDhkLCAweDAxLCAweDAyLCAweDA0LCAweDA4LCAweDEwLCAweDIwLCAweDQwLCAweDgwLCAweDFiLCAweDM2LCAweDZjLCAweGQ4LCAweGFiLCAweDRkLCAweDlhLCAweDJmLCAweDVlLCAweGJjLCAweDYzLCAweGM2LCAweDk3LCAweDM1LCAweDZhLCAweGQ0LCAweGIzLCAweDdkLCAweGZhLCAweGVmLCAweGM1LCAweDkxLCAweDM5LCAweDcyLCAweGU0LCAweGQzLCAweGJkLCAweDYxLCAweGMyLCAweDlmLCAweDI1LCAweDRhLCAweDk0LCAweDMzLCAweDY2LCAweGNjLCAweDgzLCAweDFkLCAweDNhLCAweDc0LCAweGU4LCAweGNiLCAweDhkXSk7CiAgICB0aGlzLl9rZXkgPSB0aGlzLl9leHBhbmRLZXkoa2V5KTsKICB9CiAgX2V4cGFuZEtleShjaXBoZXJLZXkpIHsKICAgIGNvbnN0IGIgPSAxNzY7CiAgICBjb25zdCBzID0gdGhpcy5fczsKICAgIGNvbnN0IHJjb24gPSB0aGlzLl9yY29uOwogICAgY29uc3QgcmVzdWx0ID0gbmV3IFVpbnQ4QXJyYXkoYik7CiAgICByZXN1bHQuc2V0KGNpcGhlcktleSk7CiAgICBmb3IgKGxldCBqID0gMTYsIGkgPSAxOyBqIDwgYjsgKytpKSB7CiAgICAgIGxldCB0MSA9IHJlc3VsdFtqIC0gM107CiAgICAgIGxldCB0MiA9IHJlc3VsdFtqIC0gMl07CiAgICAgIGxldCB0MyA9IHJlc3VsdFtqIC0gMV07CiAgICAgIGxldCB0NCA9IHJlc3VsdFtqIC0gNF07CiAgICAgIHQxID0gc1t0MV07CiAgICAgIHQyID0gc1t0Ml07CiAgICAgIHQzID0gc1t0M107CiAgICAgIHQ0ID0gc1t0NF07CiAgICAgIHQxIF49IHJjb25baV07CiAgICAgIGZvciAobGV0IG4gPSAwOyBuIDwgNDsgKytuKSB7CiAgICAgICAgcmVzdWx0W2pdID0gdDEgXj0gcmVzdWx0W2ogLSAxNl07CiAgICAgICAgaisrOwogICAgICAgIHJlc3VsdFtqXSA9IHQyIF49IHJlc3VsdFtqIC0gMTZdOwogICAgICAgIGorKzsKICAgICAgICByZXN1bHRbal0gPSB0MyBePSByZXN1bHRbaiAtIDE2XTsKICAgICAgICBqKys7CiAgICAgICAgcmVzdWx0W2pdID0gdDQgXj0gcmVzdWx0W2ogLSAxNl07CiAgICAgICAgaisrOwogICAgICB9CiAgICB9CiAgICByZXR1cm4gcmVzdWx0OwogIH0KfQpleHBvcnRzLkFFUzEyOENpcGhlciA9IEFFUzEyOENpcGhlcjsKY2xhc3MgQUVTMjU2Q2lwaGVyIGV4dGVuZHMgQUVTQmFzZUNpcGhlciB7CiAgY29uc3RydWN0b3Ioa2V5KSB7CiAgICBzdXBlcigpOwogICAgdGhpcy5fY3ljbGVzT2ZSZXBldGl0aW9uID0gMTQ7CiAgICB0aGlzLl9rZXlTaXplID0gMjI0OwogICAgdGhpcy5fa2V5ID0gdGhpcy5fZXhwYW5kS2V5KGtleSk7CiAgfQogIF9leHBhbmRLZXkoY2lwaGVyS2V5KSB7CiAgICBjb25zdCBiID0gMjQwOwogICAgY29uc3QgcyA9IHRoaXMuX3M7CiAgICBjb25zdCByZXN1bHQgPSBuZXcgVWludDhBcnJheShiKTsKICAgIHJlc3VsdC5zZXQoY2lwaGVyS2V5KTsKICAgIGxldCByID0gMTsKICAgIGxldCB0MSwgdDIsIHQzLCB0NDsKICAgIGZvciAobGV0IGogPSAzMiwgaSA9IDE7IGogPCBiOyArK2kpIHsKICAgICAgaWYgKGogJSAzMiA9PT0gMTYpIHsKICAgICAgICB0MSA9IHNbdDFdOwogICAgICAgIHQyID0gc1t0Ml07CiAgICAgICAgdDMgPSBzW3QzXTsKICAgICAgICB0NCA9IHNbdDRdOwogICAgICB9IGVsc2UgaWYgKGogJSAzMiA9PT0gMCkgewogICAgICAgIHQxID0gcmVzdWx0W2ogLSAzXTsKICAgICAgICB0MiA9IHJlc3VsdFtqIC0gMl07CiAgICAgICAgdDMgPSByZXN1bHRbaiAtIDFdOwogICAgICAgIHQ0ID0gcmVzdWx0W2ogLSA0XTsKICAgICAgICB0MSA9IHNbdDFdOwogICAgICAgIHQyID0gc1t0Ml07CiAgICAgICAgdDMgPSBzW3QzXTsKICAgICAgICB0NCA9IHNbdDRdOwogICAgICAgIHQxIF49IHI7CiAgICAgICAgaWYgKChyIDw8PSAxKSA+PSAyNTYpIHsKICAgICAgICAgIHIgPSAociBeIDB4MWIpICYgMHhmZjsKICAgICAgICB9CiAgICAgIH0KICAgICAgZm9yIChsZXQgbiA9IDA7IG4gPCA0OyArK24pIHsKICAgICAgICByZXN1bHRbal0gPSB0MSBePSByZXN1bHRbaiAtIDMyXTsKICAgICAgICBqKys7CiAgICAgICAgcmVzdWx0W2pdID0gdDIgXj0gcmVzdWx0W2ogLSAzMl07CiAgICAgICAgaisrOwogICAgICAgIHJlc3VsdFtqXSA9IHQzIF49IHJlc3VsdFtqIC0gMzJdOwogICAgICAgIGorKzsKICAgICAgICByZXN1bHRbal0gPSB0NCBePSByZXN1bHRbaiAtIDMyXTsKICAgICAgICBqKys7CiAgICAgIH0KICAgIH0KICAgIHJldHVybiByZXN1bHQ7CiAgfQp9CmV4cG9ydHMuQUVTMjU2Q2lwaGVyID0gQUVTMjU2Q2lwaGVyOwpjbGFzcyBQREYxNyB7CiAgY2hlY2tPd25lclBhc3N3b3JkKHBhc3N3b3JkLCBvd25lclZhbGlkYXRpb25TYWx0LCB1c2VyQnl0ZXMsIG93bmVyUGFzc3dvcmQpIHsKICAgIGNvbnN0IGhhc2hEYXRhID0gbmV3IFVpbnQ4QXJyYXkocGFzc3dvcmQubGVuZ3RoICsgNTYpOwogICAgaGFzaERhdGEuc2V0KHBhc3N3b3JkLCAwKTsKICAgIGhhc2hEYXRhLnNldChvd25lclZhbGlkYXRpb25TYWx0LCBwYXNzd29yZC5sZW5ndGgpOwogICAgaGFzaERhdGEuc2V0KHVzZXJCeXRlcywgcGFzc3dvcmQubGVuZ3RoICsgb3duZXJWYWxpZGF0aW9uU2FsdC5sZW5ndGgpOwogICAgY29uc3QgcmVzdWx0ID0gY2FsY3VsYXRlU0hBMjU2KGhhc2hEYXRhLCAwLCBoYXNoRGF0YS5sZW5ndGgpOwogICAgcmV0dXJuICgwLCBfdXRpbC5pc0FycmF5RXF1YWwpKHJlc3VsdCwgb3duZXJQYXNzd29yZCk7CiAgfQogIGNoZWNrVXNlclBhc3N3b3JkKHBhc3N3b3JkLCB1c2VyVmFsaWRhdGlvblNhbHQsIHVzZXJQYXNzd29yZCkgewogICAgY29uc3QgaGFzaERhdGEgPSBuZXcgVWludDhBcnJheShwYXNzd29yZC5sZW5ndGggKyA4KTsKICAgIGhhc2hEYXRhLnNldChwYXNzd29yZCwgMCk7CiAgICBoYXNoRGF0YS5zZXQodXNlclZhbGlkYXRpb25TYWx0LCBwYXNzd29yZC5sZW5ndGgpOwogICAgY29uc3QgcmVzdWx0ID0gY2FsY3VsYXRlU0hBMjU2KGhhc2hEYXRhLCAwLCBoYXNoRGF0YS5sZW5ndGgpOwogICAgcmV0dXJuICgwLCBfdXRpbC5pc0FycmF5RXF1YWwpKHJlc3VsdCwgdXNlclBhc3N3b3JkKTsKICB9CiAgZ2V0T3duZXJLZXkocGFzc3dvcmQsIG93bmVyS2V5U2FsdCwgdXNlckJ5dGVzLCBvd25lckVuY3J5cHRpb24pIHsKICAgIGNvbnN0IGhhc2hEYXRhID0gbmV3IFVpbnQ4QXJyYXkocGFzc3dvcmQubGVuZ3RoICsgNTYpOwogICAgaGFzaERhdGEuc2V0KHBhc3N3b3JkLCAwKTsKICAgIGhhc2hEYXRhLnNldChvd25lcktleVNhbHQsIHBhc3N3b3JkLmxlbmd0aCk7CiAgICBoYXNoRGF0YS5zZXQodXNlckJ5dGVzLCBwYXNzd29yZC5sZW5ndGggKyBvd25lcktleVNhbHQubGVuZ3RoKTsKICAgIGNvbnN0IGtleSA9IGNhbGN1bGF0ZVNIQTI1NihoYXNoRGF0YSwgMCwgaGFzaERhdGEubGVuZ3RoKTsKICAgIGNvbnN0IGNpcGhlciA9IG5ldyBBRVMyNTZDaXBoZXIoa2V5KTsKICAgIHJldHVybiBjaXBoZXIuZGVjcnlwdEJsb2NrKG93bmVyRW5jcnlwdGlvbiwgZmFsc2UsIG5ldyBVaW50OEFycmF5KDE2KSk7CiAgfQogIGdldFVzZXJLZXkocGFzc3dvcmQsIHVzZXJLZXlTYWx0LCB1c2VyRW5jcnlwdGlvbikgewogICAgY29uc3QgaGFzaERhdGEgPSBuZXcgVWludDhBcnJheShwYXNzd29yZC5sZW5ndGggKyA4KTsKICAgIGhhc2hEYXRhLnNldChwYXNzd29yZCwgMCk7CiAgICBoYXNoRGF0YS5zZXQodXNlcktleVNhbHQsIHBhc3N3b3JkLmxlbmd0aCk7CiAgICBjb25zdCBrZXkgPSBjYWxjdWxhdGVTSEEyNTYoaGFzaERhdGEsIDAsIGhhc2hEYXRhLmxlbmd0aCk7CiAgICBjb25zdCBjaXBoZXIgPSBuZXcgQUVTMjU2Q2lwaGVyKGtleSk7CiAgICByZXR1cm4gY2lwaGVyLmRlY3J5cHRCbG9jayh1c2VyRW5jcnlwdGlvbiwgZmFsc2UsIG5ldyBVaW50OEFycmF5KDE2KSk7CiAgfQp9CmV4cG9ydHMuUERGMTcgPSBQREYxNzsKY2xhc3MgUERGMjAgewogIF9oYXNoKHBhc3N3b3JkLCBpbnB1dCwgdXNlckJ5dGVzKSB7CiAgICBsZXQgayA9IGNhbGN1bGF0ZVNIQTI1NihpbnB1dCwgMCwgaW5wdXQubGVuZ3RoKS5zdWJhcnJheSgwLCAzMik7CiAgICBsZXQgZSA9IFswXTsKICAgIGxldCBpID0gMDsKICAgIHdoaWxlIChpIDwgNjQgfHwgZS5hdCgtMSkgPiBpIC0gMzIpIHsKICAgICAgY29uc3QgY29tYmluZWRMZW5ndGggPSBwYXNzd29yZC5sZW5ndGggKyBrLmxlbmd0aCArIHVzZXJCeXRlcy5sZW5ndGgsCiAgICAgICAgY29tYmluZWRBcnJheSA9IG5ldyBVaW50OEFycmF5KGNvbWJpbmVkTGVuZ3RoKTsKICAgICAgbGV0IHdyaXRlT2Zmc2V0ID0gMDsKICAgICAgY29tYmluZWRBcnJheS5zZXQocGFzc3dvcmQsIHdyaXRlT2Zmc2V0KTsKICAgICAgd3JpdGVPZmZzZXQgKz0gcGFzc3dvcmQubGVuZ3RoOwogICAgICBjb21iaW5lZEFycmF5LnNldChrLCB3cml0ZU9mZnNldCk7CiAgICAgIHdyaXRlT2Zmc2V0ICs9IGsubGVuZ3RoOwogICAgICBjb21iaW5lZEFycmF5LnNldCh1c2VyQnl0ZXMsIHdyaXRlT2Zmc2V0KTsKICAgICAgY29uc3QgazEgPSBuZXcgVWludDhBcnJheShjb21iaW5lZExlbmd0aCAqIDY0KTsKICAgICAgZm9yIChsZXQgaiA9IDAsIHBvcyA9IDA7IGogPCA2NDsgaisrLCBwb3MgKz0gY29tYmluZWRMZW5ndGgpIHsKICAgICAgICBrMS5zZXQoY29tYmluZWRBcnJheSwgcG9zKTsKICAgICAgfQogICAgICBjb25zdCBjaXBoZXIgPSBuZXcgQUVTMTI4Q2lwaGVyKGsuc3ViYXJyYXkoMCwgMTYpKTsKICAgICAgZSA9IGNpcGhlci5lbmNyeXB0KGsxLCBrLnN1YmFycmF5KDE2LCAzMikpOwogICAgICBjb25zdCByZW1haW5kZXIgPSBlLnNsaWNlKDAsIDE2KS5yZWR1Y2UoKGEsIGIpID0+IGEgKyBiLCAwKSAlIDM7CiAgICAgIGlmIChyZW1haW5kZXIgPT09IDApIHsKICAgICAgICBrID0gY2FsY3VsYXRlU0hBMjU2KGUsIDAsIGUubGVuZ3RoKTsKICAgICAgfSBlbHNlIGlmIChyZW1haW5kZXIgPT09IDEpIHsKICAgICAgICBrID0gY2FsY3VsYXRlU0hBMzg0KGUsIDAsIGUubGVuZ3RoKTsKICAgICAgfSBlbHNlIGlmIChyZW1haW5kZXIgPT09IDIpIHsKICAgICAgICBrID0gY2FsY3VsYXRlU0hBNTEyKGUsIDAsIGUubGVuZ3RoKTsKICAgICAgfQogICAgICBpKys7CiAgICB9CiAgICByZXR1cm4gay5zdWJhcnJheSgwLCAzMik7CiAgfQogIGNoZWNrT3duZXJQYXNzd29yZChwYXNzd29yZCwgb3duZXJWYWxpZGF0aW9uU2FsdCwgdXNlckJ5dGVzLCBvd25lclBhc3N3b3JkKSB7CiAgICBjb25zdCBoYXNoRGF0YSA9IG5ldyBVaW50OEFycmF5KHBhc3N3b3JkLmxlbmd0aCArIDU2KTsKICAgIGhhc2hEYXRhLnNldChwYXNzd29yZCwgMCk7CiAgICBoYXNoRGF0YS5zZXQob3duZXJWYWxpZGF0aW9uU2FsdCwgcGFzc3dvcmQubGVuZ3RoKTsKICAgIGhhc2hEYXRhLnNldCh1c2VyQnl0ZXMsIHBhc3N3b3JkLmxlbmd0aCArIG93bmVyVmFsaWRhdGlvblNhbHQubGVuZ3RoKTsKICAgIGNvbnN0IHJlc3VsdCA9IHRoaXMuX2hhc2gocGFzc3dvcmQsIGhhc2hEYXRhLCB1c2VyQnl0ZXMpOwogICAgcmV0dXJuICgwLCBfdXRpbC5pc0FycmF5RXF1YWwpKHJlc3VsdCwgb3duZXJQYXNzd29yZCk7CiAgfQogIGNoZWNrVXNlclBhc3N3b3JkKHBhc3N3b3JkLCB1c2VyVmFsaWRhdGlvblNhbHQsIHVzZXJQYXNzd29yZCkgewogICAgY29uc3QgaGFzaERhdGEgPSBuZXcgVWludDhBcnJheShwYXNzd29yZC5sZW5ndGggKyA4KTsKICAgIGhhc2hEYXRhLnNldChwYXNzd29yZCwgMCk7CiAgICBoYXNoRGF0YS5zZXQodXNlclZhbGlkYXRpb25TYWx0LCBwYXNzd29yZC5sZW5ndGgpOwogICAgY29uc3QgcmVzdWx0ID0gdGhpcy5faGFzaChwYXNzd29yZCwgaGFzaERhdGEsIFtdKTsKICAgIHJldHVybiAoMCwgX3V0aWwuaXNBcnJheUVxdWFsKShyZXN1bHQsIHVzZXJQYXNzd29yZCk7CiAgfQogIGdldE93bmVyS2V5KHBhc3N3b3JkLCBvd25lcktleVNhbHQsIHVzZXJCeXRlcywgb3duZXJFbmNyeXB0aW9uKSB7CiAgICBjb25zdCBoYXNoRGF0YSA9IG5ldyBVaW50OEFycmF5KHBhc3N3b3JkLmxlbmd0aCArIDU2KTsKICAgIGhhc2hEYXRhLnNldChwYXNzd29yZCwgMCk7CiAgICBoYXNoRGF0YS5zZXQob3duZXJLZXlTYWx0LCBwYXNzd29yZC5sZW5ndGgpOwogICAgaGFzaERhdGEuc2V0KHVzZXJCeXRlcywgcGFzc3dvcmQubGVuZ3RoICsgb3duZXJLZXlTYWx0Lmxlbmd0aCk7CiAgICBjb25zdCBrZXkgPSB0aGlzLl9oYXNoKHBhc3N3b3JkLCBoYXNoRGF0YSwgdXNlckJ5dGVzKTsKICAgIGNvbnN0IGNpcGhlciA9IG5ldyBBRVMyNTZDaXBoZXIoa2V5KTsKICAgIHJldHVybiBjaXBoZXIuZGVjcnlwdEJsb2NrKG93bmVyRW5jcnlwdGlvbiwgZmFsc2UsIG5ldyBVaW50OEFycmF5KDE2KSk7CiAgfQogIGdldFVzZXJLZXkocGFzc3dvcmQsIHVzZXJLZXlTYWx0LCB1c2VyRW5jcnlwdGlvbikgewogICAgY29uc3QgaGFzaERhdGEgPSBuZXcgVWludDhBcnJheShwYXNzd29yZC5sZW5ndGggKyA4KTsKICAgIGhhc2hEYXRhLnNldChwYXNzd29yZCwgMCk7CiAgICBoYXNoRGF0YS5zZXQodXNlcktleVNhbHQsIHBhc3N3b3JkLmxlbmd0aCk7CiAgICBjb25zdCBrZXkgPSB0aGlzLl9oYXNoKHBhc3N3b3JkLCBoYXNoRGF0YSwgW10pOwogICAgY29uc3QgY2lwaGVyID0gbmV3IEFFUzI1NkNpcGhlcihrZXkpOwogICAgcmV0dXJuIGNpcGhlci5kZWNyeXB0QmxvY2sodXNlckVuY3J5cHRpb24sIGZhbHNlLCBuZXcgVWludDhBcnJheSgxNikpOwogIH0KfQpleHBvcnRzLlBERjIwID0gUERGMjA7CmNsYXNzIENpcGhlclRyYW5zZm9ybSB7CiAgY29uc3RydWN0b3Ioc3RyaW5nQ2lwaGVyQ29uc3RydWN0b3IsIHN0cmVhbUNpcGhlckNvbnN0cnVjdG9yKSB7CiAgICB0aGlzLlN0cmluZ0NpcGhlckNvbnN0cnVjdG9yID0gc3RyaW5nQ2lwaGVyQ29uc3RydWN0b3I7CiAgICB0aGlzLlN0cmVhbUNpcGhlckNvbnN0cnVjdG9yID0gc3RyZWFtQ2lwaGVyQ29uc3RydWN0b3I7CiAgfQogIGNyZWF0ZVN0cmVhbShzdHJlYW0sIGxlbmd0aCkgewogICAgY29uc3QgY2lwaGVyID0gbmV3IHRoaXMuU3RyZWFtQ2lwaGVyQ29uc3RydWN0b3IoKTsKICAgIHJldHVybiBuZXcgX2RlY3J5cHRfc3RyZWFtLkRlY3J5cHRTdHJlYW0oc3RyZWFtLCBsZW5ndGgsIGZ1bmN0aW9uIGNpcGhlclRyYW5zZm9ybURlY3J5cHRTdHJlYW0oZGF0YSwgZmluYWxpemUpIHsKICAgICAgcmV0dXJuIGNpcGhlci5kZWNyeXB0QmxvY2soZGF0YSwgZmluYWxpemUpOwogICAgfSk7CiAgfQogIGRlY3J5cHRTdHJpbmcocykgewogICAgY29uc3QgY2lwaGVyID0gbmV3IHRoaXMuU3RyaW5nQ2lwaGVyQ29uc3RydWN0b3IoKTsKICAgIGxldCBkYXRhID0gKDAsIF91dGlsLnN0cmluZ1RvQnl0ZXMpKHMpOwogICAgZGF0YSA9IGNpcGhlci5kZWNyeXB0QmxvY2soZGF0YSwgdHJ1ZSk7CiAgICByZXR1cm4gKDAsIF91dGlsLmJ5dGVzVG9TdHJpbmcpKGRhdGEpOwogIH0KICBlbmNyeXB0U3RyaW5nKHMpIHsKICAgIGNvbnN0IGNpcGhlciA9IG5ldyB0aGlzLlN0cmluZ0NpcGhlckNvbnN0cnVjdG9yKCk7CiAgICBpZiAoY2lwaGVyIGluc3RhbmNlb2YgQUVTQmFzZUNpcGhlcikgewogICAgICBjb25zdCBzdHJMZW4gPSBzLmxlbmd0aDsKICAgICAgY29uc3QgcGFkID0gMTYgLSBzdHJMZW4gJSAxNjsKICAgICAgcyArPSBTdHJpbmcuZnJvbUNoYXJDb2RlKHBhZCkucmVwZWF0KHBhZCk7CiAgICAgIGNvbnN0IGl2ID0gbmV3IFVpbnQ4QXJyYXkoMTYpOwogICAgICBpZiAodHlwZW9mIGNyeXB0byAhPT0gInVuZGVmaW5lZCIpIHsKICAgICAgICBjcnlwdG8uZ2V0UmFuZG9tVmFsdWVzKGl2KTsKICAgICAgfSBlbHNlIHsKICAgICAgICBmb3IgKGxldCBpID0gMDsgaSA8IDE2OyBpKyspIHsKICAgICAgICAgIGl2W2ldID0gTWF0aC5mbG9vcigyNTYgKiBNYXRoLnJhbmRvbSgpKTsKICAgICAgICB9CiAgICAgIH0KICAgICAgbGV0IGRhdGEgPSAoMCwgX3V0aWwuc3RyaW5nVG9CeXRlcykocyk7CiAgICAgIGRhdGEgPSBjaXBoZXIuZW5jcnlwdChkYXRhLCBpdik7CiAgICAgIGNvbnN0IGJ1ZiA9IG5ldyBVaW50OEFycmF5KDE2ICsgZGF0YS5sZW5ndGgpOwogICAgICBidWYuc2V0KGl2KTsKICAgICAgYnVmLnNldChkYXRhLCAxNik7CiAgICAgIHJldHVybiAoMCwgX3V0aWwuYnl0ZXNUb1N0cmluZykoYnVmKTsKICAgIH0KICAgIGxldCBkYXRhID0gKDAsIF91dGlsLnN0cmluZ1RvQnl0ZXMpKHMpOwogICAgZGF0YSA9IGNpcGhlci5lbmNyeXB0KGRhdGEpOwogICAgcmV0dXJuICgwLCBfdXRpbC5ieXRlc1RvU3RyaW5nKShkYXRhKTsKICB9Cn0KY2xhc3MgQ2lwaGVyVHJhbnNmb3JtRmFjdG9yeSB7CiAgc3RhdGljICNkZWZhdWx0UGFzc3dvcmRCeXRlcyA9IG5ldyBVaW50OEFycmF5KFsweDI4LCAweGJmLCAweDRlLCAweDVlLCAweDRlLCAweDc1LCAweDhhLCAweDQxLCAweDY0LCAweDAwLCAweDRlLCAweDU2LCAweGZmLCAweGZhLCAweDAxLCAweDA4LCAweDJlLCAweDJlLCAweDAwLCAweGI2LCAweGQwLCAweDY4LCAweDNlLCAweDgwLCAweDJmLCAweDBjLCAweGE5LCAweGZlLCAweDY0LCAweDUzLCAweDY5LCAweDdhXSk7CiAgI2NyZWF0ZUVuY3J5cHRpb25LZXkyMChyZXZpc2lvbiwgcGFzc3dvcmQsIG93bmVyUGFzc3dvcmQsIG93bmVyVmFsaWRhdGlvblNhbHQsIG93bmVyS2V5U2FsdCwgdUJ5dGVzLCB1c2VyUGFzc3dvcmQsIHVzZXJWYWxpZGF0aW9uU2FsdCwgdXNlcktleVNhbHQsIG93bmVyRW5jcnlwdGlvbiwgdXNlckVuY3J5cHRpb24sIHBlcm1zKSB7CiAgICBpZiAocGFzc3dvcmQpIHsKICAgICAgY29uc3QgcGFzc3dvcmRMZW5ndGggPSBNYXRoLm1pbigxMjcsIHBhc3N3b3JkLmxlbmd0aCk7CiAgICAgIHBhc3N3b3JkID0gcGFzc3dvcmQuc3ViYXJyYXkoMCwgcGFzc3dvcmRMZW5ndGgpOwogICAgfSBlbHNlIHsKICAgICAgcGFzc3dvcmQgPSBbXTsKICAgIH0KICAgIGNvbnN0IHBkZkFsZ29yaXRobSA9IHJldmlzaW9uID09PSA2ID8gbmV3IFBERjIwKCkgOiBuZXcgUERGMTcoKTsKICAgIGlmIChwZGZBbGdvcml0aG0uY2hlY2tVc2VyUGFzc3dvcmQocGFzc3dvcmQsIHVzZXJWYWxpZGF0aW9uU2FsdCwgdXNlclBhc3N3b3JkKSkgewogICAgICByZXR1cm4gcGRmQWxnb3JpdGhtLmdldFVzZXJLZXkocGFzc3dvcmQsIHVzZXJLZXlTYWx0LCB1c2VyRW5jcnlwdGlvbik7CiAgICB9IGVsc2UgaWYgKHBhc3N3b3JkLmxlbmd0aCAmJiBwZGZBbGdvcml0aG0uY2hlY2tPd25lclBhc3N3b3JkKHBhc3N3b3JkLCBvd25lclZhbGlkYXRpb25TYWx0LCB1Qnl0ZXMsIG93bmVyUGFzc3dvcmQpKSB7CiAgICAgIHJldHVybiBwZGZBbGdvcml0aG0uZ2V0T3duZXJLZXkocGFzc3dvcmQsIG93bmVyS2V5U2FsdCwgdUJ5dGVzLCBvd25lckVuY3J5cHRpb24pOwogICAgfQogICAgcmV0dXJuIG51bGw7CiAgfQogICNwcmVwYXJlS2V5RGF0YShmaWxlSWQsIHBhc3N3b3JkLCBvd25lclBhc3N3b3JkLCB1c2VyUGFzc3dvcmQsIGZsYWdzLCByZXZpc2lvbiwga2V5TGVuZ3RoLCBlbmNyeXB0TWV0YWRhdGEpIHsKICAgIGNvbnN0IGhhc2hEYXRhU2l6ZSA9IDQwICsgb3duZXJQYXNzd29yZC5sZW5ndGggKyBmaWxlSWQubGVuZ3RoOwogICAgY29uc3QgaGFzaERhdGEgPSBuZXcgVWludDhBcnJheShoYXNoRGF0YVNpemUpOwogICAgbGV0IGkgPSAwLAogICAgICBqLAogICAgICBuOwogICAgaWYgKHBhc3N3b3JkKSB7CiAgICAgIG4gPSBNYXRoLm1pbigzMiwgcGFzc3dvcmQubGVuZ3RoKTsKICAgICAgZm9yICg7IGkgPCBuOyArK2kpIHsKICAgICAgICBoYXNoRGF0YVtpXSA9IHBhc3N3b3JkW2ldOwogICAgICB9CiAgICB9CiAgICBqID0gMDsKICAgIHdoaWxlIChpIDwgMzIpIHsKICAgICAgaGFzaERhdGFbaSsrXSA9IENpcGhlclRyYW5zZm9ybUZhY3RvcnkuI2RlZmF1bHRQYXNzd29yZEJ5dGVzW2orK107CiAgICB9CiAgICBmb3IgKGogPSAwLCBuID0gb3duZXJQYXNzd29yZC5sZW5ndGg7IGogPCBuOyArK2opIHsKICAgICAgaGFzaERhdGFbaSsrXSA9IG93bmVyUGFzc3dvcmRbal07CiAgICB9CiAgICBoYXNoRGF0YVtpKytdID0gZmxhZ3MgJiAweGZmOwogICAgaGFzaERhdGFbaSsrXSA9IGZsYWdzID4+IDggJiAweGZmOwogICAgaGFzaERhdGFbaSsrXSA9IGZsYWdzID4+IDE2ICYgMHhmZjsKICAgIGhhc2hEYXRhW2krK10gPSBmbGFncyA+Pj4gMjQgJiAweGZmOwogICAgZm9yIChqID0gMCwgbiA9IGZpbGVJZC5sZW5ndGg7IGogPCBuOyArK2opIHsKICAgICAgaGFzaERhdGFbaSsrXSA9IGZpbGVJZFtqXTsKICAgIH0KICAgIGlmIChyZXZpc2lvbiA+PSA0ICYmICFlbmNyeXB0TWV0YWRhdGEpIHsKICAgICAgaGFzaERhdGFbaSsrXSA9IDB4ZmY7CiAgICAgIGhhc2hEYXRhW2krK10gPSAweGZmOwogICAgICBoYXNoRGF0YVtpKytdID0gMHhmZjsKICAgICAgaGFzaERhdGFbaSsrXSA9IDB4ZmY7CiAgICB9CiAgICBsZXQgaGFzaCA9IGNhbGN1bGF0ZU1ENShoYXNoRGF0YSwgMCwgaSk7CiAgICBjb25zdCBrZXlMZW5ndGhJbkJ5dGVzID0ga2V5TGVuZ3RoID4+IDM7CiAgICBpZiAocmV2aXNpb24gPj0gMykgewogICAgICBmb3IgKGogPSAwOyBqIDwgNTA7ICsraikgewogICAgICAgIGhhc2ggPSBjYWxjdWxhdGVNRDUoaGFzaCwgMCwga2V5TGVuZ3RoSW5CeXRlcyk7CiAgICAgIH0KICAgIH0KICAgIGNvbnN0IGVuY3J5cHRpb25LZXkgPSBoYXNoLnN1YmFycmF5KDAsIGtleUxlbmd0aEluQnl0ZXMpOwogICAgbGV0IGNpcGhlciwgY2hlY2tEYXRhOwogICAgaWYgKHJldmlzaW9uID49IDMpIHsKICAgICAgZm9yIChpID0gMDsgaSA8IDMyOyArK2kpIHsKICAgICAgICBoYXNoRGF0YVtpXSA9IENpcGhlclRyYW5zZm9ybUZhY3RvcnkuI2RlZmF1bHRQYXNzd29yZEJ5dGVzW2ldOwogICAgICB9CiAgICAgIGZvciAoaiA9IDAsIG4gPSBmaWxlSWQubGVuZ3RoOyBqIDwgbjsgKytqKSB7CiAgICAgICAgaGFzaERhdGFbaSsrXSA9IGZpbGVJZFtqXTsKICAgICAgfQogICAgICBjaXBoZXIgPSBuZXcgQVJDRm91ckNpcGhlcihlbmNyeXB0aW9uS2V5KTsKICAgICAgY2hlY2tEYXRhID0gY2lwaGVyLmVuY3J5cHRCbG9jayhjYWxjdWxhdGVNRDUoaGFzaERhdGEsIDAsIGkpKTsKICAgICAgbiA9IGVuY3J5cHRpb25LZXkubGVuZ3RoOwogICAgICBjb25zdCBkZXJpdmVkS2V5ID0gbmV3IFVpbnQ4QXJyYXkobik7CiAgICAgIGZvciAoaiA9IDE7IGogPD0gMTk7ICsraikgewogICAgICAgIGZvciAobGV0IGsgPSAwOyBrIDwgbjsgKytrKSB7CiAgICAgICAgICBkZXJpdmVkS2V5W2tdID0gZW5jcnlwdGlvbktleVtrXSBeIGo7CiAgICAgICAgfQogICAgICAgIGNpcGhlciA9IG5ldyBBUkNGb3VyQ2lwaGVyKGRlcml2ZWRLZXkpOwogICAgICAgIGNoZWNrRGF0YSA9IGNpcGhlci5lbmNyeXB0QmxvY2soY2hlY2tEYXRhKTsKICAgICAgfQogICAgICBmb3IgKGogPSAwLCBuID0gY2hlY2tEYXRhLmxlbmd0aDsgaiA8IG47ICsraikgewogICAgICAgIGlmICh1c2VyUGFzc3dvcmRbal0gIT09IGNoZWNrRGF0YVtqXSkgewogICAgICAgICAgcmV0dXJuIG51bGw7CiAgICAgICAgfQogICAgICB9CiAgICB9IGVsc2UgewogICAgICBjaXBoZXIgPSBuZXcgQVJDRm91ckNpcGhlcihlbmNyeXB0aW9uS2V5KTsKICAgICAgY2hlY2tEYXRhID0gY2lwaGVyLmVuY3J5cHRCbG9jayhDaXBoZXJUcmFuc2Zvcm1GYWN0b3J5LiNkZWZhdWx0UGFzc3dvcmRCeXRlcyk7CiAgICAgIGZvciAoaiA9IDAsIG4gPSBjaGVja0RhdGEubGVuZ3RoOyBqIDwgbjsgKytqKSB7CiAgICAgICAgaWYgKHVzZXJQYXNzd29yZFtqXSAhPT0gY2hlY2tEYXRhW2pdKSB7CiAgICAgICAgICByZXR1cm4gbnVsbDsKICAgICAgICB9CiAgICAgIH0KICAgIH0KICAgIHJldHVybiBlbmNyeXB0aW9uS2V5OwogIH0KICAjZGVjb2RlVXNlclBhc3N3b3JkKHBhc3N3b3JkLCBvd25lclBhc3N3b3JkLCByZXZpc2lvbiwga2V5TGVuZ3RoKSB7CiAgICBjb25zdCBoYXNoRGF0YSA9IG5ldyBVaW50OEFycmF5KDMyKTsKICAgIGxldCBpID0gMDsKICAgIGNvbnN0IG4gPSBNYXRoLm1pbigzMiwgcGFzc3dvcmQubGVuZ3RoKTsKICAgIGZvciAoOyBpIDwgbjsgKytpKSB7CiAgICAgIGhhc2hEYXRhW2ldID0gcGFzc3dvcmRbaV07CiAgICB9CiAgICBsZXQgaiA9IDA7CiAgICB3aGlsZSAoaSA8IDMyKSB7CiAgICAgIGhhc2hEYXRhW2krK10gPSBDaXBoZXJUcmFuc2Zvcm1GYWN0b3J5LiNkZWZhdWx0UGFzc3dvcmRCeXRlc1tqKytdOwogICAgfQogICAgbGV0IGhhc2ggPSBjYWxjdWxhdGVNRDUoaGFzaERhdGEsIDAsIGkpOwogICAgY29uc3Qga2V5TGVuZ3RoSW5CeXRlcyA9IGtleUxlbmd0aCA+PiAzOwogICAgaWYgKHJldmlzaW9uID49IDMpIHsKICAgICAgZm9yIChqID0gMDsgaiA8IDUwOyArK2opIHsKICAgICAgICBoYXNoID0gY2FsY3VsYXRlTUQ1KGhhc2gsIDAsIGhhc2gubGVuZ3RoKTsKICAgICAgfQogICAgfQogICAgbGV0IGNpcGhlciwgdXNlclBhc3N3b3JkOwogICAgaWYgKHJldmlzaW9uID49IDMpIHsKICAgICAgdXNlclBhc3N3b3JkID0gb3duZXJQYXNzd29yZDsKICAgICAgY29uc3QgZGVyaXZlZEtleSA9IG5ldyBVaW50OEFycmF5KGtleUxlbmd0aEluQnl0ZXMpOwogICAgICBmb3IgKGogPSAxOTsgaiA+PSAwOyBqLS0pIHsKICAgICAgICBmb3IgKGxldCBrID0gMDsgayA8IGtleUxlbmd0aEluQnl0ZXM7ICsraykgewogICAgICAgICAgZGVyaXZlZEtleVtrXSA9IGhhc2hba10gXiBqOwogICAgICAgIH0KICAgICAgICBjaXBoZXIgPSBuZXcgQVJDRm91ckNpcGhlcihkZXJpdmVkS2V5KTsKICAgICAgICB1c2VyUGFzc3dvcmQgPSBjaXBoZXIuZW5jcnlwdEJsb2NrKHVzZXJQYXNzd29yZCk7CiAgICAgIH0KICAgIH0gZWxzZSB7CiAgICAgIGNpcGhlciA9IG5ldyBBUkNGb3VyQ2lwaGVyKGhhc2guc3ViYXJyYXkoMCwga2V5TGVuZ3RoSW5CeXRlcykpOwogICAgICB1c2VyUGFzc3dvcmQgPSBjaXBoZXIuZW5jcnlwdEJsb2NrKG93bmVyUGFzc3dvcmQpOwogICAgfQogICAgcmV0dXJuIHVzZXJQYXNzd29yZDsKICB9CiAgI2J1aWxkT2JqZWN0S2V5KG51bSwgZ2VuLCBlbmNyeXB0aW9uS2V5LCBpc0FlcyA9IGZhbHNlKSB7CiAgICBjb25zdCBrZXkgPSBuZXcgVWludDhBcnJheShlbmNyeXB0aW9uS2V5Lmxlbmd0aCArIDkpOwogICAgY29uc3QgbiA9IGVuY3J5cHRpb25LZXkubGVuZ3RoOwogICAgbGV0IGk7CiAgICBmb3IgKGkgPSAwOyBpIDwgbjsgKytpKSB7CiAgICAgIGtleVtpXSA9IGVuY3J5cHRpb25LZXlbaV07CiAgICB9CiAgICBrZXlbaSsrXSA9IG51bSAmIDB4ZmY7CiAgICBrZXlbaSsrXSA9IG51bSA+PiA4ICYgMHhmZjsKICAgIGtleVtpKytdID0gbnVtID4+IDE2ICYgMHhmZjsKICAgIGtleVtpKytdID0gZ2VuICYgMHhmZjsKICAgIGtleVtpKytdID0gZ2VuID4+IDggJiAweGZmOwogICAgaWYgKGlzQWVzKSB7CiAgICAgIGtleVtpKytdID0gMHg3MzsKICAgICAga2V5W2krK10gPSAweDQxOwogICAgICBrZXlbaSsrXSA9IDB4NmM7CiAgICAgIGtleVtpKytdID0gMHg1NDsKICAgIH0KICAgIGNvbnN0IGhhc2ggPSBjYWxjdWxhdGVNRDUoa2V5LCAwLCBpKTsKICAgIHJldHVybiBoYXNoLnN1YmFycmF5KDAsIE1hdGgubWluKGVuY3J5cHRpb25LZXkubGVuZ3RoICsgNSwgMTYpKTsKICB9CiAgI2J1aWxkQ2lwaGVyQ29uc3RydWN0b3IoY2YsIG5hbWUsIG51bSwgZ2VuLCBrZXkpIHsKICAgIGlmICghKG5hbWUgaW5zdGFuY2VvZiBfcHJpbWl0aXZlcy5OYW1lKSkgewogICAgICB0aHJvdyBuZXcgX3V0aWwuRm9ybWF0RXJyb3IoIkludmFsaWQgY3J5cHQgZmlsdGVyIG5hbWUuIik7CiAgICB9CiAgICBjb25zdCBzZWxmID0gdGhpczsKICAgIGNvbnN0IGNyeXB0RmlsdGVyID0gY2YuZ2V0KG5hbWUubmFtZSk7CiAgICBjb25zdCBjZm0gPSBjcnlwdEZpbHRlcj8uZ2V0KCJDRk0iKTsKICAgIGlmICghY2ZtIHx8IGNmbS5uYW1lID09PSAiTm9uZSIpIHsKICAgICAgcmV0dXJuIGZ1bmN0aW9uICgpIHsKICAgICAgICByZXR1cm4gbmV3IE51bGxDaXBoZXIoKTsKICAgICAgfTsKICAgIH0KICAgIGlmIChjZm0ubmFtZSA9PT0gIlYyIikgewogICAgICByZXR1cm4gZnVuY3Rpb24gKCkgewogICAgICAgIHJldHVybiBuZXcgQVJDRm91ckNpcGhlcihzZWxmLiNidWlsZE9iamVjdEtleShudW0sIGdlbiwga2V5LCBmYWxzZSkpOwogICAgICB9OwogICAgfQogICAgaWYgKGNmbS5uYW1lID09PSAiQUVTVjIiKSB7CiAgICAgIHJldHVybiBmdW5jdGlvbiAoKSB7CiAgICAgICAgcmV0dXJuIG5ldyBBRVMxMjhDaXBoZXIoc2VsZi4jYnVpbGRPYmplY3RLZXkobnVtLCBnZW4sIGtleSwgdHJ1ZSkpOwogICAgICB9OwogICAgfQogICAgaWYgKGNmbS5uYW1lID09PSAiQUVTVjMiKSB7CiAgICAgIHJldHVybiBmdW5jdGlvbiAoKSB7CiAgICAgICAgcmV0dXJuIG5ldyBBRVMyNTZDaXBoZXIoa2V5KTsKICAgICAgfTsKICAgIH0KICAgIHRocm93IG5ldyBfdXRpbC5Gb3JtYXRFcnJvcigiVW5rbm93biBjcnlwdG8gbWV0aG9kIik7CiAgfQogIGNvbnN0cnVjdG9yKGRpY3QsIGZpbGVJZCwgcGFzc3dvcmQpIHsKICAgIGNvbnN0IGZpbHRlciA9IGRpY3QuZ2V0KCJGaWx0ZXIiKTsKICAgIGlmICghKDAsIF9wcmltaXRpdmVzLmlzTmFtZSkoZmlsdGVyLCAiU3RhbmRhcmQiKSkgewogICAgICB0aHJvdyBuZXcgX3V0aWwuRm9ybWF0RXJyb3IoInVua25vd24gZW5jcnlwdGlvbiBtZXRob2QiKTsKICAgIH0KICAgIHRoaXMuZmlsdGVyTmFtZSA9IGZpbHRlci5uYW1lOwogICAgdGhpcy5kaWN0ID0gZGljdDsKICAgIGNvbnN0IGFsZ29yaXRobSA9IGRpY3QuZ2V0KCJWIik7CiAgICBpZiAoIU51bWJlci5pc0ludGVnZXIoYWxnb3JpdGhtKSB8fCBhbGdvcml0aG0gIT09IDEgJiYgYWxnb3JpdGhtICE9PSAyICYmIGFsZ29yaXRobSAhPT0gNCAmJiBhbGdvcml0aG0gIT09IDUpIHsKICAgICAgdGhyb3cgbmV3IF91dGlsLkZvcm1hdEVycm9yKCJ1bnN1cHBvcnRlZCBlbmNyeXB0aW9uIGFsZ29yaXRobSIpOwogICAgfQogICAgdGhpcy5hbGdvcml0aG0gPSBhbGdvcml0aG07CiAgICBsZXQga2V5TGVuZ3RoID0gZGljdC5nZXQoIkxlbmd0aCIpOwogICAgaWYgKCFrZXlMZW5ndGgpIHsKICAgICAgaWYgKGFsZ29yaXRobSA8PSAzKSB7CiAgICAgICAga2V5TGVuZ3RoID0gNDA7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgY29uc3QgY2ZEaWN0ID0gZGljdC5nZXQoIkNGIik7CiAgICAgICAgY29uc3Qgc3RyZWFtQ3J5cHRvTmFtZSA9IGRpY3QuZ2V0KCJTdG1GIik7CiAgICAgICAgaWYgKGNmRGljdCBpbnN0YW5jZW9mIF9wcmltaXRpdmVzLkRpY3QgJiYgc3RyZWFtQ3J5cHRvTmFtZSBpbnN0YW5jZW9mIF9wcmltaXRpdmVzLk5hbWUpIHsKICAgICAgICAgIGNmRGljdC5zdXBwcmVzc0VuY3J5cHRpb24gPSB0cnVlOwogICAgICAgICAgY29uc3QgaGFuZGxlckRpY3QgPSBjZkRpY3QuZ2V0KHN0cmVhbUNyeXB0b05hbWUubmFtZSk7CiAgICAgICAgICBrZXlMZW5ndGggPSBoYW5kbGVyRGljdD8uZ2V0KCJMZW5ndGgiKSB8fCAxMjg7CiAgICAgICAgICBpZiAoa2V5TGVuZ3RoIDwgNDApIHsKICAgICAgICAgICAga2V5TGVuZ3RoIDw8PSAzOwogICAgICAgICAgfQogICAgICAgIH0KICAgICAgfQogICAgfQogICAgaWYgKCFOdW1iZXIuaXNJbnRlZ2VyKGtleUxlbmd0aCkgfHwga2V5TGVuZ3RoIDwgNDAgfHwga2V5TGVuZ3RoICUgOCAhPT0gMCkgewogICAgICB0aHJvdyBuZXcgX3V0aWwuRm9ybWF0RXJyb3IoImludmFsaWQga2V5IGxlbmd0aCIpOwogICAgfQogICAgY29uc3Qgb3duZXJCeXRlcyA9ICgwLCBfdXRpbC5zdHJpbmdUb0J5dGVzKShkaWN0LmdldCgiTyIpKSwKICAgICAgdXNlckJ5dGVzID0gKDAsIF91dGlsLnN0cmluZ1RvQnl0ZXMpKGRpY3QuZ2V0KCJVIikpOwogICAgY29uc3Qgb3duZXJQYXNzd29yZCA9IG93bmVyQnl0ZXMuc3ViYXJyYXkoMCwgMzIpOwogICAgY29uc3QgdXNlclBhc3N3b3JkID0gdXNlckJ5dGVzLnN1YmFycmF5KDAsIDMyKTsKICAgIGNvbnN0IGZsYWdzID0gZGljdC5nZXQoIlAiKTsKICAgIGNvbnN0IHJldmlzaW9uID0gZGljdC5nZXQoIlIiKTsKICAgIGNvbnN0IGVuY3J5cHRNZXRhZGF0YSA9IChhbGdvcml0aG0gPT09IDQgfHwgYWxnb3JpdGhtID09PSA1KSAmJiBkaWN0LmdldCgiRW5jcnlwdE1ldGFkYXRhIikgIT09IGZhbHNlOwogICAgdGhpcy5lbmNyeXB0TWV0YWRhdGEgPSBlbmNyeXB0TWV0YWRhdGE7CiAgICBjb25zdCBmaWxlSWRCeXRlcyA9ICgwLCBfdXRpbC5zdHJpbmdUb0J5dGVzKShmaWxlSWQpOwogICAgbGV0IHBhc3N3b3JkQnl0ZXM7CiAgICBpZiAocGFzc3dvcmQpIHsKICAgICAgaWYgKHJldmlzaW9uID09PSA2KSB7CiAgICAgICAgdHJ5IHsKICAgICAgICAgIHBhc3N3b3JkID0gKDAsIF91dGlsLnV0ZjhTdHJpbmdUb1N0cmluZykocGFzc3dvcmQpOwogICAgICAgIH0gY2F0Y2ggewogICAgICAgICAgKDAsIF91dGlsLndhcm4pKCJDaXBoZXJUcmFuc2Zvcm1GYWN0b3J5OiBVbmFibGUgdG8gY29udmVydCBVVEY4IGVuY29kZWQgcGFzc3dvcmQuIik7CiAgICAgICAgfQogICAgICB9CiAgICAgIHBhc3N3b3JkQnl0ZXMgPSAoMCwgX3V0aWwuc3RyaW5nVG9CeXRlcykocGFzc3dvcmQpOwogICAgfQogICAgbGV0IGVuY3J5cHRpb25LZXk7CiAgICBpZiAoYWxnb3JpdGhtICE9PSA1KSB7CiAgICAgIGVuY3J5cHRpb25LZXkgPSB0aGlzLiNwcmVwYXJlS2V5RGF0YShmaWxlSWRCeXRlcywgcGFzc3dvcmRCeXRlcywgb3duZXJQYXNzd29yZCwgdXNlclBhc3N3b3JkLCBmbGFncywgcmV2aXNpb24sIGtleUxlbmd0aCwgZW5jcnlwdE1ldGFkYXRhKTsKICAgIH0gZWxzZSB7CiAgICAgIGNvbnN0IG93bmVyVmFsaWRhdGlvblNhbHQgPSBvd25lckJ5dGVzLnN1YmFycmF5KDMyLCA0MCk7CiAgICAgIGNvbnN0IG93bmVyS2V5U2FsdCA9IG93bmVyQnl0ZXMuc3ViYXJyYXkoNDAsIDQ4KTsKICAgICAgY29uc3QgdUJ5dGVzID0gdXNlckJ5dGVzLnN1YmFycmF5KDAsIDQ4KTsKICAgICAgY29uc3QgdXNlclZhbGlkYXRpb25TYWx0ID0gdXNlckJ5dGVzLnN1YmFycmF5KDMyLCA0MCk7CiAgICAgIGNvbnN0IHVzZXJLZXlTYWx0ID0gdXNlckJ5dGVzLnN1YmFycmF5KDQwLCA0OCk7CiAgICAgIGNvbnN0IG93bmVyRW5jcnlwdGlvbiA9ICgwLCBfdXRpbC5zdHJpbmdUb0J5dGVzKShkaWN0LmdldCgiT0UiKSk7CiAgICAgIGNvbnN0IHVzZXJFbmNyeXB0aW9uID0gKDAsIF91dGlsLnN0cmluZ1RvQnl0ZXMpKGRpY3QuZ2V0KCJVRSIpKTsKICAgICAgY29uc3QgcGVybXMgPSAoMCwgX3V0aWwuc3RyaW5nVG9CeXRlcykoZGljdC5nZXQoIlBlcm1zIikpOwogICAgICBlbmNyeXB0aW9uS2V5ID0gdGhpcy4jY3JlYXRlRW5jcnlwdGlvbktleTIwKHJldmlzaW9uLCBwYXNzd29yZEJ5dGVzLCBvd25lclBhc3N3b3JkLCBvd25lclZhbGlkYXRpb25TYWx0LCBvd25lcktleVNhbHQsIHVCeXRlcywgdXNlclBhc3N3b3JkLCB1c2VyVmFsaWRhdGlvblNhbHQsIHVzZXJLZXlTYWx0LCBvd25lckVuY3J5cHRpb24sIHVzZXJFbmNyeXB0aW9uLCBwZXJtcyk7CiAgICB9CiAgICBpZiAoIWVuY3J5cHRpb25LZXkgJiYgIXBhc3N3b3JkKSB7CiAgICAgIHRocm93IG5ldyBfdXRpbC5QYXNzd29yZEV4Y2VwdGlvbigiTm8gcGFzc3dvcmQgZ2l2ZW4iLCBfdXRpbC5QYXNzd29yZFJlc3BvbnNlcy5ORUVEX1BBU1NXT1JEKTsKICAgIH0gZWxzZSBpZiAoIWVuY3J5cHRpb25LZXkgJiYgcGFzc3dvcmQpIHsKICAgICAgY29uc3QgZGVjb2RlZFBhc3N3b3JkID0gdGhpcy4jZGVjb2RlVXNlclBhc3N3b3JkKHBhc3N3b3JkQnl0ZXMsIG93bmVyUGFzc3dvcmQsIHJldmlzaW9uLCBrZXlMZW5ndGgpOwogICAgICBlbmNyeXB0aW9uS2V5ID0gdGhpcy4jcHJlcGFyZUtleURhdGEoZmlsZUlkQnl0ZXMsIGRlY29kZWRQYXNzd29yZCwgb3duZXJQYXNzd29yZCwgdXNlclBhc3N3b3JkLCBmbGFncywgcmV2aXNpb24sIGtleUxlbmd0aCwgZW5jcnlwdE1ldGFkYXRhKTsKICAgIH0KICAgIGlmICghZW5jcnlwdGlvbktleSkgewogICAgICB0aHJvdyBuZXcgX3V0aWwuUGFzc3dvcmRFeGNlcHRpb24oIkluY29ycmVjdCBQYXNzd29yZCIsIF91dGlsLlBhc3N3b3JkUmVzcG9uc2VzLklOQ09SUkVDVF9QQVNTV09SRCk7CiAgICB9CiAgICB0aGlzLmVuY3J5cHRpb25LZXkgPSBlbmNyeXB0aW9uS2V5OwogICAgaWYgKGFsZ29yaXRobSA+PSA0KSB7CiAgICAgIGNvbnN0IGNmID0gZGljdC5nZXQoIkNGIik7CiAgICAgIGlmIChjZiBpbnN0YW5jZW9mIF9wcmltaXRpdmVzLkRpY3QpIHsKICAgICAgICBjZi5zdXBwcmVzc0VuY3J5cHRpb24gPSB0cnVlOwogICAgICB9CiAgICAgIHRoaXMuY2YgPSBjZjsKICAgICAgdGhpcy5zdG1mID0gZGljdC5nZXQoIlN0bUYiKSB8fCBfcHJpbWl0aXZlcy5OYW1lLmdldCgiSWRlbnRpdHkiKTsKICAgICAgdGhpcy5zdHJmID0gZGljdC5nZXQoIlN0ckYiKSB8fCBfcHJpbWl0aXZlcy5OYW1lLmdldCgiSWRlbnRpdHkiKTsKICAgICAgdGhpcy5lZmYgPSBkaWN0LmdldCgiRUZGIikgfHwgdGhpcy5zdG1mOwogICAgfQogIH0KICBjcmVhdGVDaXBoZXJUcmFuc2Zvcm0obnVtLCBnZW4pIHsKICAgIGlmICh0aGlzLmFsZ29yaXRobSA9PT0gNCB8fCB0aGlzLmFsZ29yaXRobSA9PT0gNSkgewogICAgICByZXR1cm4gbmV3IENpcGhlclRyYW5zZm9ybSh0aGlzLiNidWlsZENpcGhlckNvbnN0cnVjdG9yKHRoaXMuY2YsIHRoaXMuc3RyZiwgbnVtLCBnZW4sIHRoaXMuZW5jcnlwdGlvbktleSksIHRoaXMuI2J1aWxkQ2lwaGVyQ29uc3RydWN0b3IodGhpcy5jZiwgdGhpcy5zdG1mLCBudW0sIGdlbiwgdGhpcy5lbmNyeXB0aW9uS2V5KSk7CiAgICB9CiAgICBjb25zdCBrZXkgPSB0aGlzLiNidWlsZE9iamVjdEtleShudW0sIGdlbiwgdGhpcy5lbmNyeXB0aW9uS2V5LCBmYWxzZSk7CiAgICBjb25zdCBjaXBoZXJDb25zdHJ1Y3RvciA9IGZ1bmN0aW9uICgpIHsKICAgICAgcmV0dXJuIG5ldyBBUkNGb3VyQ2lwaGVyKGtleSk7CiAgICB9OwogICAgcmV0dXJuIG5ldyBDaXBoZXJUcmFuc2Zvcm0oY2lwaGVyQ29uc3RydWN0b3IsIGNpcGhlckNvbnN0cnVjdG9yKTsKICB9Cn0KZXhwb3J0cy5DaXBoZXJUcmFuc2Zvcm1GYWN0b3J5ID0gQ2lwaGVyVHJhbnNmb3JtRmFjdG9yeTsKCi8qKiovIH0pLAovKiA3NSAqLwovKioqLyAoKF9fdW51c2VkX3dlYnBhY2tfbW9kdWxlLCBleHBvcnRzLCBfX3dfcGRmanNfcmVxdWlyZV9fKSA9PiB7CgoKCk9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCAiX19lc01vZHVsZSIsICh7CiAgdmFsdWU6IHRydWUKfSkpOwpleHBvcnRzLkRlY3J5cHRTdHJlYW0gPSB2b2lkIDA7CnZhciBfZGVjb2RlX3N0cmVhbSA9IF9fd19wZGZqc19yZXF1aXJlX18oMTgpOwpjb25zdCBjaHVua1NpemUgPSA1MTI7CmNsYXNzIERlY3J5cHRTdHJlYW0gZXh0ZW5kcyBfZGVjb2RlX3N0cmVhbS5EZWNvZGVTdHJlYW0gewogIGNvbnN0cnVjdG9yKHN0ciwgbWF5YmVMZW5ndGgsIGRlY3J5cHQpIHsKICAgIHN1cGVyKG1heWJlTGVuZ3RoKTsKICAgIHRoaXMuc3RyID0gc3RyOwogICAgdGhpcy5kaWN0ID0gc3RyLmRpY3Q7CiAgICB0aGlzLmRlY3J5cHQgPSBkZWNyeXB0OwogICAgdGhpcy5uZXh0Q2h1bmsgPSBudWxsOwogICAgdGhpcy5pbml0aWFsaXplZCA9IGZhbHNlOwogIH0KICByZWFkQmxvY2soKSB7CiAgICBsZXQgY2h1bms7CiAgICBpZiAodGhpcy5pbml0aWFsaXplZCkgewogICAgICBjaHVuayA9IHRoaXMubmV4dENodW5rOwogICAgfSBlbHNlIHsKICAgICAgY2h1bmsgPSB0aGlzLnN0ci5nZXRCeXRlcyhjaHVua1NpemUpOwogICAgICB0aGlzLmluaXRpYWxpemVkID0gdHJ1ZTsKICAgIH0KICAgIGlmICghY2h1bmsgfHwgY2h1bmsubGVuZ3RoID09PSAwKSB7CiAgICAgIHRoaXMuZW9mID0gdHJ1ZTsKICAgICAgcmV0dXJuOwogICAgfQogICAgdGhpcy5uZXh0Q2h1bmsgPSB0aGlzLnN0ci5nZXRCeXRlcyhjaHVua1NpemUpOwogICAgY29uc3QgaGFzTW9yZURhdGEgPSB0aGlzLm5leHRDaHVuaz8ubGVuZ3RoID4gMDsKICAgIGNvbnN0IGRlY3J5cHQgPSB0aGlzLmRlY3J5cHQ7CiAgICBjaHVuayA9IGRlY3J5cHQoY2h1bmssICFoYXNNb3JlRGF0YSk7CiAgICBjb25zdCBidWZmZXJMZW5ndGggPSB0aGlzLmJ1ZmZlckxlbmd0aCwKICAgICAgbmV3TGVuZ3RoID0gYnVmZmVyTGVuZ3RoICsgY2h1bmsubGVuZ3RoLAogICAgICBidWZmZXIgPSB0aGlzLmVuc3VyZUJ1ZmZlcihuZXdMZW5ndGgpOwogICAgYnVmZmVyLnNldChjaHVuaywgYnVmZmVyTGVuZ3RoKTsKICAgIHRoaXMuYnVmZmVyTGVuZ3RoID0gbmV3TGVuZ3RoOwogIH0KfQpleHBvcnRzLkRlY3J5cHRTdHJlYW0gPSBEZWNyeXB0U3RyZWFtOwoKLyoqKi8gfSksCi8qIDc2ICovCi8qKiovICgoX191bnVzZWRfd2VicGFja19tb2R1bGUsIGV4cG9ydHMsIF9fd19wZGZqc19yZXF1aXJlX18pID0+IHsKCgoKT2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsICJfX2VzTW9kdWxlIiwgKHsKICB2YWx1ZTogdHJ1ZQp9KSk7CmV4cG9ydHMuT2JqZWN0TG9hZGVyID0gdm9pZCAwOwp2YXIgX3ByaW1pdGl2ZXMgPSBfX3dfcGRmanNfcmVxdWlyZV9fKDQpOwp2YXIgX2Jhc2Vfc3RyZWFtID0gX193X3BkZmpzX3JlcXVpcmVfXyg1KTsKdmFyIF9jb3JlX3V0aWxzID0gX193X3BkZmpzX3JlcXVpcmVfXygzKTsKdmFyIF91dGlsID0gX193X3BkZmpzX3JlcXVpcmVfXygyKTsKZnVuY3Rpb24gbWF5SGF2ZUNoaWxkcmVuKHZhbHVlKSB7CiAgcmV0dXJuIHZhbHVlIGluc3RhbmNlb2YgX3ByaW1pdGl2ZXMuUmVmIHx8IHZhbHVlIGluc3RhbmNlb2YgX3ByaW1pdGl2ZXMuRGljdCB8fCB2YWx1ZSBpbnN0YW5jZW9mIF9iYXNlX3N0cmVhbS5CYXNlU3RyZWFtIHx8IEFycmF5LmlzQXJyYXkodmFsdWUpOwp9CmZ1bmN0aW9uIGFkZENoaWxkcmVuKG5vZGUsIG5vZGVzVG9WaXNpdCkgewogIGlmIChub2RlIGluc3RhbmNlb2YgX3ByaW1pdGl2ZXMuRGljdCkgewogICAgbm9kZSA9IG5vZGUuZ2V0UmF3VmFsdWVzKCk7CiAgfSBlbHNlIGlmIChub2RlIGluc3RhbmNlb2YgX2Jhc2Vfc3RyZWFtLkJhc2VTdHJlYW0pIHsKICAgIG5vZGUgPSBub2RlLmRpY3QuZ2V0UmF3VmFsdWVzKCk7CiAgfSBlbHNlIGlmICghQXJyYXkuaXNBcnJheShub2RlKSkgewogICAgcmV0dXJuOwogIH0KICBmb3IgKGNvbnN0IHJhd1ZhbHVlIG9mIG5vZGUpIHsKICAgIGlmIChtYXlIYXZlQ2hpbGRyZW4ocmF3VmFsdWUpKSB7CiAgICAgIG5vZGVzVG9WaXNpdC5wdXNoKHJhd1ZhbHVlKTsKICAgIH0KICB9Cn0KY2xhc3MgT2JqZWN0TG9hZGVyIHsKICBjb25zdHJ1Y3RvcihkaWN0LCBrZXlzLCB4cmVmKSB7CiAgICB0aGlzLmRpY3QgPSBkaWN0OwogICAgdGhpcy5rZXlzID0ga2V5czsKICAgIHRoaXMueHJlZiA9IHhyZWY7CiAgICB0aGlzLnJlZlNldCA9IG51bGw7CiAgfQogIGFzeW5jIGxvYWQoKSB7CiAgICBpZiAodGhpcy54cmVmLnN0cmVhbS5pc0RhdGFMb2FkZWQpIHsKICAgICAgcmV0dXJuIHVuZGVmaW5lZDsKICAgIH0KICAgIGNvbnN0IHsKICAgICAga2V5cywKICAgICAgZGljdAogICAgfSA9IHRoaXM7CiAgICB0aGlzLnJlZlNldCA9IG5ldyBfcHJpbWl0aXZlcy5SZWZTZXQoKTsKICAgIGNvbnN0IG5vZGVzVG9WaXNpdCA9IFtdOwogICAgZm9yIChjb25zdCBrZXkgb2Yga2V5cykgewogICAgICBjb25zdCByYXdWYWx1ZSA9IGRpY3QuZ2V0UmF3KGtleSk7CiAgICAgIGlmIChyYXdWYWx1ZSAhPT0gdW5kZWZpbmVkKSB7CiAgICAgICAgbm9kZXNUb1Zpc2l0LnB1c2gocmF3VmFsdWUpOwogICAgICB9CiAgICB9CiAgICByZXR1cm4gdGhpcy5fd2Fsayhub2Rlc1RvVmlzaXQpOwogIH0KICBhc3luYyBfd2Fsayhub2Rlc1RvVmlzaXQpIHsKICAgIGNvbnN0IG5vZGVzVG9SZXZpc2l0ID0gW107CiAgICBjb25zdCBwZW5kaW5nUmVxdWVzdHMgPSBbXTsKICAgIHdoaWxlIChub2Rlc1RvVmlzaXQubGVuZ3RoKSB7CiAgICAgIGxldCBjdXJyZW50Tm9kZSA9IG5vZGVzVG9WaXNpdC5wb3AoKTsKICAgICAgaWYgKGN1cnJlbnROb2RlIGluc3RhbmNlb2YgX3ByaW1pdGl2ZXMuUmVmKSB7CiAgICAgICAgaWYgKHRoaXMucmVmU2V0LmhhcyhjdXJyZW50Tm9kZSkpIHsKICAgICAgICAgIGNvbnRpbnVlOwogICAgICAgIH0KICAgICAgICB0cnkgewogICAgICAgICAgdGhpcy5yZWZTZXQucHV0KGN1cnJlbnROb2RlKTsKICAgICAgICAgIGN1cnJlbnROb2RlID0gdGhpcy54cmVmLmZldGNoKGN1cnJlbnROb2RlKTsKICAgICAgICB9IGNhdGNoIChleCkgewogICAgICAgICAgaWYgKCEoZXggaW5zdGFuY2VvZiBfY29yZV91dGlscy5NaXNzaW5nRGF0YUV4Y2VwdGlvbikpIHsKICAgICAgICAgICAgKDAsIF91dGlsLndhcm4pKGBPYmplY3RMb2FkZXIuX3dhbGsgLSByZXF1ZXN0aW5nIGFsbCBkYXRhOiAiJHtleH0iLmApOwogICAgICAgICAgICB0aGlzLnJlZlNldCA9IG51bGw7CiAgICAgICAgICAgIGNvbnN0IHsKICAgICAgICAgICAgICBtYW5hZ2VyCiAgICAgICAgICAgIH0gPSB0aGlzLnhyZWYuc3RyZWFtOwogICAgICAgICAgICByZXR1cm4gbWFuYWdlci5yZXF1ZXN0QWxsQ2h1bmtzKCk7CiAgICAgICAgICB9CiAgICAgICAgICBub2Rlc1RvUmV2aXNpdC5wdXNoKGN1cnJlbnROb2RlKTsKICAgICAgICAgIHBlbmRpbmdSZXF1ZXN0cy5wdXNoKHsKICAgICAgICAgICAgYmVnaW46IGV4LmJlZ2luLAogICAgICAgICAgICBlbmQ6IGV4LmVuZAogICAgICAgICAgfSk7CiAgICAgICAgfQogICAgICB9CiAgICAgIGlmIChjdXJyZW50Tm9kZSBpbnN0YW5jZW9mIF9iYXNlX3N0cmVhbS5CYXNlU3RyZWFtKSB7CiAgICAgICAgY29uc3QgYmFzZVN0cmVhbXMgPSBjdXJyZW50Tm9kZS5nZXRCYXNlU3RyZWFtcygpOwogICAgICAgIGlmIChiYXNlU3RyZWFtcykgewogICAgICAgICAgbGV0IGZvdW5kTWlzc2luZ0RhdGEgPSBmYWxzZTsKICAgICAgICAgIGZvciAoY29uc3Qgc3RyZWFtIG9mIGJhc2VTdHJlYW1zKSB7CiAgICAgICAgICAgIGlmIChzdHJlYW0uaXNEYXRhTG9hZGVkKSB7CiAgICAgICAgICAgICAgY29udGludWU7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgZm91bmRNaXNzaW5nRGF0YSA9IHRydWU7CiAgICAgICAgICAgIHBlbmRpbmdSZXF1ZXN0cy5wdXNoKHsKICAgICAgICAgICAgICBiZWdpbjogc3RyZWFtLnN0YXJ0LAogICAgICAgICAgICAgIGVuZDogc3RyZWFtLmVuZAogICAgICAgICAgICB9KTsKICAgICAgICAgIH0KICAgICAgICAgIGlmIChmb3VuZE1pc3NpbmdEYXRhKSB7CiAgICAgICAgICAgIG5vZGVzVG9SZXZpc2l0LnB1c2goY3VycmVudE5vZGUpOwogICAgICAgICAgfQogICAgICAgIH0KICAgICAgfQogICAgICBhZGRDaGlsZHJlbihjdXJyZW50Tm9kZSwgbm9kZXNUb1Zpc2l0KTsKICAgIH0KICAgIGlmIChwZW5kaW5nUmVxdWVzdHMubGVuZ3RoKSB7CiAgICAgIGF3YWl0IHRoaXMueHJlZi5zdHJlYW0ubWFuYWdlci5yZXF1ZXN0UmFuZ2VzKHBlbmRpbmdSZXF1ZXN0cyk7CiAgICAgIGZvciAoY29uc3Qgbm9kZSBvZiBub2Rlc1RvUmV2aXNpdCkgewogICAgICAgIGlmIChub2RlIGluc3RhbmNlb2YgX3ByaW1pdGl2ZXMuUmVmKSB7CiAgICAgICAgICB0aGlzLnJlZlNldC5yZW1vdmUobm9kZSk7CiAgICAgICAgfQogICAgICB9CiAgICAgIHJldHVybiB0aGlzLl93YWxrKG5vZGVzVG9SZXZpc2l0KTsKICAgIH0KICAgIHRoaXMucmVmU2V0ID0gbnVsbDsKICAgIHJldHVybiB1bmRlZmluZWQ7CiAgfQp9CmV4cG9ydHMuT2JqZWN0TG9hZGVyID0gT2JqZWN0TG9hZGVyOwoKLyoqKi8gfSksCi8qIDc3ICovCi8qKiovICgoX191bnVzZWRfd2VicGFja19tb2R1bGUsIGV4cG9ydHMsIF9fd19wZGZqc19yZXF1aXJlX18pID0+IHsKCgoKT2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsICJfX2VzTW9kdWxlIiwgKHsKICB2YWx1ZTogdHJ1ZQp9KSk7CmV4cG9ydHMuWEZBRmFjdG9yeSA9IHZvaWQgMDsKdmFyIF9zeW1ib2xfdXRpbHMgPSBfX3dfcGRmanNfcmVxdWlyZV9fKDc4KTsKdmFyIF9iaW5kID0gX193X3BkZmpzX3JlcXVpcmVfXyg3OSk7CnZhciBfZGF0YSA9IF9fd19wZGZqc19yZXF1aXJlX18oODkpOwp2YXIgX2ZvbnRzID0gX193X3BkZmpzX3JlcXVpcmVfXyg4NSk7CnZhciBfdXRpbHMgPSBfX3dfcGRmanNfcmVxdWlyZV9fKDg0KTsKdmFyIF91dGlsID0gX193X3BkZmpzX3JlcXVpcmVfXygyKTsKdmFyIF9wYXJzZXIgPSBfX3dfcGRmanNfcmVxdWlyZV9fKDkwKTsKdmFyIF94aHRtbCA9IF9fd19wZGZqc19yZXF1aXJlX18oMTAwKTsKY2xhc3MgWEZBRmFjdG9yeSB7CiAgY29uc3RydWN0b3IoZGF0YSkgewogICAgdHJ5IHsKICAgICAgdGhpcy5yb290ID0gbmV3IF9wYXJzZXIuWEZBUGFyc2VyKCkucGFyc2UoWEZBRmFjdG9yeS5fY3JlYXRlRG9jdW1lbnQoZGF0YSkpOwogICAgICBjb25zdCBiaW5kZXIgPSBuZXcgX2JpbmQuQmluZGVyKHRoaXMucm9vdCk7CiAgICAgIHRoaXMuZm9ybSA9IGJpbmRlci5iaW5kKCk7CiAgICAgIHRoaXMuZGF0YUhhbmRsZXIgPSBuZXcgX2RhdGEuRGF0YUhhbmRsZXIodGhpcy5yb290LCBiaW5kZXIuZ2V0RGF0YSgpKTsKICAgICAgdGhpcy5mb3JtW19zeW1ib2xfdXRpbHMuJGdsb2JhbERhdGFdLnRlbXBsYXRlID0gdGhpcy5mb3JtOwogICAgfSBjYXRjaCAoZSkgewogICAgICAoMCwgX3V0aWwud2FybikoYFhGQSAtIGFuIGVycm9yIG9jY3VycmVkIGR1cmluZyBwYXJzaW5nIGFuZCBiaW5kaW5nOiAke2V9YCk7CiAgICB9CiAgfQogIGlzVmFsaWQoKSB7CiAgICByZXR1cm4gdGhpcy5yb290ICYmIHRoaXMuZm9ybTsKICB9CiAgX2NyZWF0ZVBhZ2VzSGVscGVyKCkgewogICAgY29uc3QgaXRlcmF0b3IgPSB0aGlzLmZvcm1bX3N5bWJvbF91dGlscy4kdG9QYWdlc10oKTsKICAgIHJldHVybiBuZXcgUHJvbWlzZSgocmVzb2x2ZSwgcmVqZWN0KSA9PiB7CiAgICAgIGNvbnN0IG5leHRJdGVyYXRpb24gPSAoKSA9PiB7CiAgICAgICAgdHJ5IHsKICAgICAgICAgIGNvbnN0IHZhbHVlID0gaXRlcmF0b3IubmV4dCgpOwogICAgICAgICAgaWYgKHZhbHVlLmRvbmUpIHsKICAgICAgICAgICAgcmVzb2x2ZSh2YWx1ZS52YWx1ZSk7CiAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICBzZXRUaW1lb3V0KG5leHRJdGVyYXRpb24sIDApOwogICAgICAgICAgfQogICAgICAgIH0gY2F0Y2ggKGUpIHsKICAgICAgICAgIHJlamVjdChlKTsKICAgICAgICB9CiAgICAgIH07CiAgICAgIHNldFRpbWVvdXQobmV4dEl0ZXJhdGlvbiwgMCk7CiAgICB9KTsKICB9CiAgYXN5bmMgX2NyZWF0ZVBhZ2VzKCkgewogICAgdHJ5IHsKICAgICAgdGhpcy5wYWdlcyA9IGF3YWl0IHRoaXMuX2NyZWF0ZVBhZ2VzSGVscGVyKCk7CiAgICAgIHRoaXMuZGltcyA9IHRoaXMucGFnZXMuY2hpbGRyZW4ubWFwKGMgPT4gewogICAgICAgIGNvbnN0IHsKICAgICAgICAgIHdpZHRoLAogICAgICAgICAgaGVpZ2h0CiAgICAgICAgfSA9IGMuYXR0cmlidXRlcy5zdHlsZTsKICAgICAgICByZXR1cm4gWzAsIDAsIHBhcnNlSW50KHdpZHRoKSwgcGFyc2VJbnQoaGVpZ2h0KV07CiAgICAgIH0pOwogICAgfSBjYXRjaCAoZSkgewogICAgICAoMCwgX3V0aWwud2FybikoYFhGQSAtIGFuIGVycm9yIG9jY3VycmVkIGR1cmluZyBsYXlvdXQ6ICR7ZX1gKTsKICAgIH0KICB9CiAgZ2V0Qm91bmRpbmdCb3gocGFnZUluZGV4KSB7CiAgICByZXR1cm4gdGhpcy5kaW1zW3BhZ2VJbmRleF07CiAgfQogIGFzeW5jIGdldE51bVBhZ2VzKCkgewogICAgaWYgKCF0aGlzLnBhZ2VzKSB7CiAgICAgIGF3YWl0IHRoaXMuX2NyZWF0ZVBhZ2VzKCk7CiAgICB9CiAgICByZXR1cm4gdGhpcy5kaW1zLmxlbmd0aDsKICB9CiAgc2V0SW1hZ2VzKGltYWdlcykgewogICAgdGhpcy5mb3JtW19zeW1ib2xfdXRpbHMuJGdsb2JhbERhdGFdLmltYWdlcyA9IGltYWdlczsKICB9CiAgc2V0Rm9udHMoZm9udHMpIHsKICAgIHRoaXMuZm9ybVtfc3ltYm9sX3V0aWxzLiRnbG9iYWxEYXRhXS5mb250RmluZGVyID0gbmV3IF9mb250cy5Gb250RmluZGVyKGZvbnRzKTsKICAgIGNvbnN0IG1pc3NpbmdGb250cyA9IFtdOwogICAgZm9yIChsZXQgdHlwZWZhY2Ugb2YgdGhpcy5mb3JtW19zeW1ib2xfdXRpbHMuJGdsb2JhbERhdGFdLnVzZWRUeXBlZmFjZXMpIHsKICAgICAgdHlwZWZhY2UgPSAoMCwgX3V0aWxzLnN0cmlwUXVvdGVzKSh0eXBlZmFjZSk7CiAgICAgIGNvbnN0IGZvbnQgPSB0aGlzLmZvcm1bX3N5bWJvbF91dGlscy4kZ2xvYmFsRGF0YV0uZm9udEZpbmRlci5maW5kKHR5cGVmYWNlKTsKICAgICAgaWYgKCFmb250KSB7CiAgICAgICAgbWlzc2luZ0ZvbnRzLnB1c2godHlwZWZhY2UpOwogICAgICB9CiAgICB9CiAgICBpZiAobWlzc2luZ0ZvbnRzLmxlbmd0aCA+IDApIHsKICAgICAgcmV0dXJuIG1pc3NpbmdGb250czsKICAgIH0KICAgIHJldHVybiBudWxsOwogIH0KICBhcHBlbmRGb250cyhmb250cywgcmVhbGx5TWlzc2luZ0ZvbnRzKSB7CiAgICB0aGlzLmZvcm1bX3N5bWJvbF91dGlscy4kZ2xvYmFsRGF0YV0uZm9udEZpbmRlci5hZGQoZm9udHMsIHJlYWxseU1pc3NpbmdGb250cyk7CiAgfQogIGFzeW5jIGdldFBhZ2VzKCkgewogICAgaWYgKCF0aGlzLnBhZ2VzKSB7CiAgICAgIGF3YWl0IHRoaXMuX2NyZWF0ZVBhZ2VzKCk7CiAgICB9CiAgICBjb25zdCBwYWdlcyA9IHRoaXMucGFnZXM7CiAgICB0aGlzLnBhZ2VzID0gbnVsbDsKICAgIHJldHVybiBwYWdlczsKICB9CiAgc2VyaWFsaXplRGF0YShzdG9yYWdlKSB7CiAgICByZXR1cm4gdGhpcy5kYXRhSGFuZGxlci5zZXJpYWxpemUoc3RvcmFnZSk7CiAgfQogIHN0YXRpYyBfY3JlYXRlRG9jdW1lbnQoZGF0YSkgewogICAgaWYgKCFkYXRhWyIveGRwOnhkcCJdKSB7CiAgICAgIHJldHVybiBkYXRhWyJ4ZHA6eGRwIl07CiAgICB9CiAgICByZXR1cm4gT2JqZWN0LnZhbHVlcyhkYXRhKS5qb2luKCIiKTsKICB9CiAgc3RhdGljIGdldFJpY2hUZXh0QXNIdG1sKHJjKSB7CiAgICBpZiAoIXJjIHx8IHR5cGVvZiByYyAhPT0gInN0cmluZyIpIHsKICAgICAgcmV0dXJuIG51bGw7CiAgICB9CiAgICB0cnkgewogICAgICBsZXQgcm9vdCA9IG5ldyBfcGFyc2VyLlhGQVBhcnNlcihfeGh0bWwuWGh0bWxOYW1lc3BhY2UsIHRydWUpLnBhcnNlKHJjKTsKICAgICAgaWYgKCFbImJvZHkiLCAieGh0bWwiXS5pbmNsdWRlcyhyb290W19zeW1ib2xfdXRpbHMuJG5vZGVOYW1lXSkpIHsKICAgICAgICBjb25zdCBuZXdSb290ID0gX3hodG1sLlhodG1sTmFtZXNwYWNlLmJvZHkoe30pOwogICAgICAgIG5ld1Jvb3RbX3N5bWJvbF91dGlscy4kYXBwZW5kQ2hpbGRdKHJvb3QpOwogICAgICAgIHJvb3QgPSBuZXdSb290OwogICAgICB9CiAgICAgIGNvbnN0IHJlc3VsdCA9IHJvb3RbX3N5bWJvbF91dGlscy4kdG9IVE1MXSgpOwogICAgICBpZiAoIXJlc3VsdC5zdWNjZXNzKSB7CiAgICAgICAgcmV0dXJuIG51bGw7CiAgICAgIH0KICAgICAgY29uc3QgewogICAgICAgIGh0bWwKICAgICAgfSA9IHJlc3VsdDsKICAgICAgY29uc3QgewogICAgICAgIGF0dHJpYnV0ZXMKICAgICAgfSA9IGh0bWw7CiAgICAgIGlmIChhdHRyaWJ1dGVzKSB7CiAgICAgICAgaWYgKGF0dHJpYnV0ZXMuY2xhc3MpIHsKICAgICAgICAgIGF0dHJpYnV0ZXMuY2xhc3MgPSBhdHRyaWJ1dGVzLmNsYXNzLmZpbHRlcihhdHRyID0+ICFhdHRyLnN0YXJ0c1dpdGgoInhmYSIpKTsKICAgICAgICB9CiAgICAgICAgYXR0cmlidXRlcy5kaXIgPSAiYXV0byI7CiAgICAgIH0KICAgICAgcmV0dXJuIHsKICAgICAgICBodG1sLAogICAgICAgIHN0cjogcm9vdFtfc3ltYm9sX3V0aWxzLiR0ZXh0XSgpCiAgICAgIH07CiAgICB9IGNhdGNoIChlKSB7CiAgICAgICgwLCBfdXRpbC53YXJuKShgWEZBIC0gYW4gZXJyb3Igb2NjdXJyZWQgZHVyaW5nIHBhcnNpbmcgb2YgcmljaCB0ZXh0OiAke2V9YCk7CiAgICB9CiAgICByZXR1cm4gbnVsbDsKICB9Cn0KZXhwb3J0cy5YRkFGYWN0b3J5ID0gWEZBRmFjdG9yeTsKCi8qKiovIH0pLAovKiA3OCAqLwovKioqLyAoKF9fdW51c2VkX3dlYnBhY2tfbW9kdWxlLCBleHBvcnRzKSA9PiB7CgoKCk9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCAiX19lc01vZHVsZSIsICh7CiAgdmFsdWU6IHRydWUKfSkpOwpleHBvcnRzLiR1aWQgPSBleHBvcnRzLiR0b1N0eWxlID0gZXhwb3J0cy4kdG9TdHJpbmcgPSBleHBvcnRzLiR0b1BhZ2VzID0gZXhwb3J0cy4kdG9IVE1MID0gZXhwb3J0cy4kdGV4dCA9IGV4cG9ydHMuJHRhYkluZGV4ID0gZXhwb3J0cy4kc2V0VmFsdWUgPSBleHBvcnRzLiRzZXRTZXRBdHRyaWJ1dGVzID0gZXhwb3J0cy4kc2V0SWQgPSBleHBvcnRzLiRzZWFyY2hOb2RlID0gZXhwb3J0cy4kcm9vdCA9IGV4cG9ydHMuJHJlc29sdmVQcm90b3R5cGVzID0gZXhwb3J0cy4kcmVtb3ZlQ2hpbGQgPSBleHBvcnRzLiRwdXNoUGFyYSA9IGV4cG9ydHMuJHB1c2hHbHlwaHMgPSBleHBvcnRzLiRwb3BQYXJhID0gZXhwb3J0cy4kb25UZXh0ID0gZXhwb3J0cy4kb25DaGlsZENoZWNrID0gZXhwb3J0cy4kb25DaGlsZCA9IGV4cG9ydHMuJG5zQXR0cmlidXRlcyA9IGV4cG9ydHMuJG5vZGVOYW1lID0gZXhwb3J0cy4kbmFtZXNwYWNlSWQgPSBleHBvcnRzLiRsYXN0QXR0cmlidXRlID0gZXhwb3J0cy4kaXNVc2FibGUgPSBleHBvcnRzLiRpc1RyYW5zcGFyZW50ID0gZXhwb3J0cy4kaXNUaGVyZU1vcmVXaWR0aCA9IGV4cG9ydHMuJGlzU3BsaXR0YWJsZSA9IGV4cG9ydHMuJGlzTnNBZ25vc3RpYyA9IGV4cG9ydHMuJGlzRGVzY2VuZGVudCA9IGV4cG9ydHMuJGlzRGF0YVZhbHVlID0gZXhwb3J0cy4kaXNDREFUQVhtbCA9IGV4cG9ydHMuJGlzQmluZGFibGUgPSBleHBvcnRzLiRpbnNlcnRBdCA9IGV4cG9ydHMuJGluZGV4T2YgPSBleHBvcnRzLiRpZHMgPSBleHBvcnRzLiRoYXNTZXR0YWJsZVZhbHVlID0gZXhwb3J0cy4kZ2xvYmFsRGF0YSA9IGV4cG9ydHMuJGdldFRlbXBsYXRlUm9vdCA9IGV4cG9ydHMuJGdldFN1YmZvcm1QYXJlbnQgPSBleHBvcnRzLiRnZXRSZWFsQ2hpbGRyZW5CeU5hbWVJdCA9IGV4cG9ydHMuJGdldFBhcmVudCA9IGV4cG9ydHMuJGdldE5leHRQYWdlID0gZXhwb3J0cy4kZ2V0RXh0cmEgPSBleHBvcnRzLiRnZXREYXRhVmFsdWUgPSBleHBvcnRzLiRnZXRDb250YWluZWRDaGlsZHJlbiA9IGV4cG9ydHMuJGdldENoaWxkcmVuQnlOYW1lSXQgPSBleHBvcnRzLiRnZXRDaGlsZHJlbkJ5TmFtZSA9IGV4cG9ydHMuJGdldENoaWxkcmVuQnlDbGFzcyA9IGV4cG9ydHMuJGdldENoaWxkcmVuID0gZXhwb3J0cy4kZ2V0QXZhaWxhYmxlU3BhY2UgPSBleHBvcnRzLiRnZXRBdHRyaWJ1dGVzID0gZXhwb3J0cy4kZ2V0QXR0cmlidXRlSXQgPSBleHBvcnRzLiRmbHVzaEhUTUwgPSBleHBvcnRzLiRmaW5hbGl6ZSA9IGV4cG9ydHMuJGV4dHJhID0gZXhwb3J0cy4kZHVtcCA9IGV4cG9ydHMuJGRhdGEgPSBleHBvcnRzLiRjb250ZW50ID0gZXhwb3J0cy4kY29uc3VtZWQgPSBleHBvcnRzLiRjbG9uZSA9IGV4cG9ydHMuJGNsZWFudXAgPSBleHBvcnRzLiRjbGVhblBhZ2UgPSBleHBvcnRzLiRjbGVhbiA9IGV4cG9ydHMuJGNoaWxkcmVuVG9IVE1MID0gZXhwb3J0cy4kYXBwZW5kQ2hpbGQgPSBleHBvcnRzLiRhZGRIVE1MID0gZXhwb3J0cy4kYWNjZXB0V2hpdGVzcGFjZSA9IHZvaWQgMDsKY29uc3QgJGFjY2VwdFdoaXRlc3BhY2UgPSBTeW1ib2woKTsKZXhwb3J0cy4kYWNjZXB0V2hpdGVzcGFjZSA9ICRhY2NlcHRXaGl0ZXNwYWNlOwpjb25zdCAkYWRkSFRNTCA9IFN5bWJvbCgpOwpleHBvcnRzLiRhZGRIVE1MID0gJGFkZEhUTUw7CmNvbnN0ICRhcHBlbmRDaGlsZCA9IFN5bWJvbCgpOwpleHBvcnRzLiRhcHBlbmRDaGlsZCA9ICRhcHBlbmRDaGlsZDsKY29uc3QgJGNoaWxkcmVuVG9IVE1MID0gU3ltYm9sKCk7CmV4cG9ydHMuJGNoaWxkcmVuVG9IVE1MID0gJGNoaWxkcmVuVG9IVE1MOwpjb25zdCAkY2xlYW4gPSBTeW1ib2woKTsKZXhwb3J0cy4kY2xlYW4gPSAkY2xlYW47CmNvbnN0ICRjbGVhblBhZ2UgPSBTeW1ib2woKTsKZXhwb3J0cy4kY2xlYW5QYWdlID0gJGNsZWFuUGFnZTsKY29uc3QgJGNsZWFudXAgPSBTeW1ib2woKTsKZXhwb3J0cy4kY2xlYW51cCA9ICRjbGVhbnVwOwpjb25zdCAkY2xvbmUgPSBTeW1ib2woKTsKZXhwb3J0cy4kY2xvbmUgPSAkY2xvbmU7CmNvbnN0ICRjb25zdW1lZCA9IFN5bWJvbCgpOwpleHBvcnRzLiRjb25zdW1lZCA9ICRjb25zdW1lZDsKY29uc3QgJGNvbnRlbnQgPSBTeW1ib2woImNvbnRlbnQiKTsKZXhwb3J0cy4kY29udGVudCA9ICRjb250ZW50Owpjb25zdCAkZGF0YSA9IFN5bWJvbCgiZGF0YSIpOwpleHBvcnRzLiRkYXRhID0gJGRhdGE7CmNvbnN0ICRkdW1wID0gU3ltYm9sKCk7CmV4cG9ydHMuJGR1bXAgPSAkZHVtcDsKY29uc3QgJGV4dHJhID0gU3ltYm9sKCJleHRyYSIpOwpleHBvcnRzLiRleHRyYSA9ICRleHRyYTsKY29uc3QgJGZpbmFsaXplID0gU3ltYm9sKCk7CmV4cG9ydHMuJGZpbmFsaXplID0gJGZpbmFsaXplOwpjb25zdCAkZmx1c2hIVE1MID0gU3ltYm9sKCk7CmV4cG9ydHMuJGZsdXNoSFRNTCA9ICRmbHVzaEhUTUw7CmNvbnN0ICRnZXRBdHRyaWJ1dGVJdCA9IFN5bWJvbCgpOwpleHBvcnRzLiRnZXRBdHRyaWJ1dGVJdCA9ICRnZXRBdHRyaWJ1dGVJdDsKY29uc3QgJGdldEF0dHJpYnV0ZXMgPSBTeW1ib2woKTsKZXhwb3J0cy4kZ2V0QXR0cmlidXRlcyA9ICRnZXRBdHRyaWJ1dGVzOwpjb25zdCAkZ2V0QXZhaWxhYmxlU3BhY2UgPSBTeW1ib2woKTsKZXhwb3J0cy4kZ2V0QXZhaWxhYmxlU3BhY2UgPSAkZ2V0QXZhaWxhYmxlU3BhY2U7CmNvbnN0ICRnZXRDaGlsZHJlbkJ5Q2xhc3MgPSBTeW1ib2woKTsKZXhwb3J0cy4kZ2V0Q2hpbGRyZW5CeUNsYXNzID0gJGdldENoaWxkcmVuQnlDbGFzczsKY29uc3QgJGdldENoaWxkcmVuQnlOYW1lID0gU3ltYm9sKCk7CmV4cG9ydHMuJGdldENoaWxkcmVuQnlOYW1lID0gJGdldENoaWxkcmVuQnlOYW1lOwpjb25zdCAkZ2V0Q2hpbGRyZW5CeU5hbWVJdCA9IFN5bWJvbCgpOwpleHBvcnRzLiRnZXRDaGlsZHJlbkJ5TmFtZUl0ID0gJGdldENoaWxkcmVuQnlOYW1lSXQ7CmNvbnN0ICRnZXREYXRhVmFsdWUgPSBTeW1ib2woKTsKZXhwb3J0cy4kZ2V0RGF0YVZhbHVlID0gJGdldERhdGFWYWx1ZTsKY29uc3QgJGdldEV4dHJhID0gU3ltYm9sKCk7CmV4cG9ydHMuJGdldEV4dHJhID0gJGdldEV4dHJhOwpjb25zdCAkZ2V0UmVhbENoaWxkcmVuQnlOYW1lSXQgPSBTeW1ib2woKTsKZXhwb3J0cy4kZ2V0UmVhbENoaWxkcmVuQnlOYW1lSXQgPSAkZ2V0UmVhbENoaWxkcmVuQnlOYW1lSXQ7CmNvbnN0ICRnZXRDaGlsZHJlbiA9IFN5bWJvbCgpOwpleHBvcnRzLiRnZXRDaGlsZHJlbiA9ICRnZXRDaGlsZHJlbjsKY29uc3QgJGdldENvbnRhaW5lZENoaWxkcmVuID0gU3ltYm9sKCk7CmV4cG9ydHMuJGdldENvbnRhaW5lZENoaWxkcmVuID0gJGdldENvbnRhaW5lZENoaWxkcmVuOwpjb25zdCAkZ2V0TmV4dFBhZ2UgPSBTeW1ib2woKTsKZXhwb3J0cy4kZ2V0TmV4dFBhZ2UgPSAkZ2V0TmV4dFBhZ2U7CmNvbnN0ICRnZXRTdWJmb3JtUGFyZW50ID0gU3ltYm9sKCk7CmV4cG9ydHMuJGdldFN1YmZvcm1QYXJlbnQgPSAkZ2V0U3ViZm9ybVBhcmVudDsKY29uc3QgJGdldFBhcmVudCA9IFN5bWJvbCgpOwpleHBvcnRzLiRnZXRQYXJlbnQgPSAkZ2V0UGFyZW50Owpjb25zdCAkZ2V0VGVtcGxhdGVSb290ID0gU3ltYm9sKCk7CmV4cG9ydHMuJGdldFRlbXBsYXRlUm9vdCA9ICRnZXRUZW1wbGF0ZVJvb3Q7CmNvbnN0ICRnbG9iYWxEYXRhID0gU3ltYm9sKCk7CmV4cG9ydHMuJGdsb2JhbERhdGEgPSAkZ2xvYmFsRGF0YTsKY29uc3QgJGhhc1NldHRhYmxlVmFsdWUgPSBTeW1ib2woKTsKZXhwb3J0cy4kaGFzU2V0dGFibGVWYWx1ZSA9ICRoYXNTZXR0YWJsZVZhbHVlOwpjb25zdCAkaWRzID0gU3ltYm9sKCk7CmV4cG9ydHMuJGlkcyA9ICRpZHM7CmNvbnN0ICRpbmRleE9mID0gU3ltYm9sKCk7CmV4cG9ydHMuJGluZGV4T2YgPSAkaW5kZXhPZjsKY29uc3QgJGluc2VydEF0ID0gU3ltYm9sKCk7CmV4cG9ydHMuJGluc2VydEF0ID0gJGluc2VydEF0Owpjb25zdCAkaXNDREFUQVhtbCA9IFN5bWJvbCgpOwpleHBvcnRzLiRpc0NEQVRBWG1sID0gJGlzQ0RBVEFYbWw7CmNvbnN0ICRpc0JpbmRhYmxlID0gU3ltYm9sKCk7CmV4cG9ydHMuJGlzQmluZGFibGUgPSAkaXNCaW5kYWJsZTsKY29uc3QgJGlzRGF0YVZhbHVlID0gU3ltYm9sKCk7CmV4cG9ydHMuJGlzRGF0YVZhbHVlID0gJGlzRGF0YVZhbHVlOwpjb25zdCAkaXNEZXNjZW5kZW50ID0gU3ltYm9sKCk7CmV4cG9ydHMuJGlzRGVzY2VuZGVudCA9ICRpc0Rlc2NlbmRlbnQ7CmNvbnN0ICRpc05zQWdub3N0aWMgPSBTeW1ib2woKTsKZXhwb3J0cy4kaXNOc0Fnbm9zdGljID0gJGlzTnNBZ25vc3RpYzsKY29uc3QgJGlzU3BsaXR0YWJsZSA9IFN5bWJvbCgpOwpleHBvcnRzLiRpc1NwbGl0dGFibGUgPSAkaXNTcGxpdHRhYmxlOwpjb25zdCAkaXNUaGVyZU1vcmVXaWR0aCA9IFN5bWJvbCgpOwpleHBvcnRzLiRpc1RoZXJlTW9yZVdpZHRoID0gJGlzVGhlcmVNb3JlV2lkdGg7CmNvbnN0ICRpc1RyYW5zcGFyZW50ID0gU3ltYm9sKCk7CmV4cG9ydHMuJGlzVHJhbnNwYXJlbnQgPSAkaXNUcmFuc3BhcmVudDsKY29uc3QgJGlzVXNhYmxlID0gU3ltYm9sKCk7CmV4cG9ydHMuJGlzVXNhYmxlID0gJGlzVXNhYmxlOwpjb25zdCAkbGFzdEF0dHJpYnV0ZSA9IFN5bWJvbCgpOwpleHBvcnRzLiRsYXN0QXR0cmlidXRlID0gJGxhc3RBdHRyaWJ1dGU7CmNvbnN0ICRuYW1lc3BhY2VJZCA9IFN5bWJvbCgibmFtZXNwYWNlSWQiKTsKZXhwb3J0cy4kbmFtZXNwYWNlSWQgPSAkbmFtZXNwYWNlSWQ7CmNvbnN0ICRub2RlTmFtZSA9IFN5bWJvbCgibm9kZU5hbWUiKTsKZXhwb3J0cy4kbm9kZU5hbWUgPSAkbm9kZU5hbWU7CmNvbnN0ICRuc0F0dHJpYnV0ZXMgPSBTeW1ib2woKTsKZXhwb3J0cy4kbnNBdHRyaWJ1dGVzID0gJG5zQXR0cmlidXRlczsKY29uc3QgJG9uQ2hpbGQgPSBTeW1ib2woKTsKZXhwb3J0cy4kb25DaGlsZCA9ICRvbkNoaWxkOwpjb25zdCAkb25DaGlsZENoZWNrID0gU3ltYm9sKCk7CmV4cG9ydHMuJG9uQ2hpbGRDaGVjayA9ICRvbkNoaWxkQ2hlY2s7CmNvbnN0ICRvblRleHQgPSBTeW1ib2woKTsKZXhwb3J0cy4kb25UZXh0ID0gJG9uVGV4dDsKY29uc3QgJHB1c2hHbHlwaHMgPSBTeW1ib2woKTsKZXhwb3J0cy4kcHVzaEdseXBocyA9ICRwdXNoR2x5cGhzOwpjb25zdCAkcG9wUGFyYSA9IFN5bWJvbCgpOwpleHBvcnRzLiRwb3BQYXJhID0gJHBvcFBhcmE7CmNvbnN0ICRwdXNoUGFyYSA9IFN5bWJvbCgpOwpleHBvcnRzLiRwdXNoUGFyYSA9ICRwdXNoUGFyYTsKY29uc3QgJHJlbW92ZUNoaWxkID0gU3ltYm9sKCk7CmV4cG9ydHMuJHJlbW92ZUNoaWxkID0gJHJlbW92ZUNoaWxkOwpjb25zdCAkcm9vdCA9IFN5bWJvbCgicm9vdCIpOwpleHBvcnRzLiRyb290ID0gJHJvb3Q7CmNvbnN0ICRyZXNvbHZlUHJvdG90eXBlcyA9IFN5bWJvbCgpOwpleHBvcnRzLiRyZXNvbHZlUHJvdG90eXBlcyA9ICRyZXNvbHZlUHJvdG90eXBlczsKY29uc3QgJHNlYXJjaE5vZGUgPSBTeW1ib2woKTsKZXhwb3J0cy4kc2VhcmNoTm9kZSA9ICRzZWFyY2hOb2RlOwpjb25zdCAkc2V0SWQgPSBTeW1ib2woKTsKZXhwb3J0cy4kc2V0SWQgPSAkc2V0SWQ7CmNvbnN0ICRzZXRTZXRBdHRyaWJ1dGVzID0gU3ltYm9sKCk7CmV4cG9ydHMuJHNldFNldEF0dHJpYnV0ZXMgPSAkc2V0U2V0QXR0cmlidXRlczsKY29uc3QgJHNldFZhbHVlID0gU3ltYm9sKCk7CmV4cG9ydHMuJHNldFZhbHVlID0gJHNldFZhbHVlOwpjb25zdCAkdGFiSW5kZXggPSBTeW1ib2woKTsKZXhwb3J0cy4kdGFiSW5kZXggPSAkdGFiSW5kZXg7CmNvbnN0ICR0ZXh0ID0gU3ltYm9sKCk7CmV4cG9ydHMuJHRleHQgPSAkdGV4dDsKY29uc3QgJHRvUGFnZXMgPSBTeW1ib2woKTsKZXhwb3J0cy4kdG9QYWdlcyA9ICR0b1BhZ2VzOwpjb25zdCAkdG9IVE1MID0gU3ltYm9sKCk7CmV4cG9ydHMuJHRvSFRNTCA9ICR0b0hUTUw7CmNvbnN0ICR0b1N0cmluZyA9IFN5bWJvbCgpOwpleHBvcnRzLiR0b1N0cmluZyA9ICR0b1N0cmluZzsKY29uc3QgJHRvU3R5bGUgPSBTeW1ib2woKTsKZXhwb3J0cy4kdG9TdHlsZSA9ICR0b1N0eWxlOwpjb25zdCAkdWlkID0gU3ltYm9sKCJ1aWQiKTsKZXhwb3J0cy4kdWlkID0gJHVpZDsKCi8qKiovIH0pLAovKiA3OSAqLwovKioqLyAoKF9fdW51c2VkX3dlYnBhY2tfbW9kdWxlLCBleHBvcnRzLCBfX3dfcGRmanNfcmVxdWlyZV9fKSA9PiB7CgoKCk9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCAiX19lc01vZHVsZSIsICh7CiAgdmFsdWU6IHRydWUKfSkpOwpleHBvcnRzLkJpbmRlciA9IHZvaWQgMDsKdmFyIF9zeW1ib2xfdXRpbHMgPSBfX3dfcGRmanNfcmVxdWlyZV9fKDc4KTsKdmFyIF90ZW1wbGF0ZSA9IF9fd19wZGZqc19yZXF1aXJlX18oODApOwp2YXIgX3NvbSA9IF9fd19wZGZqc19yZXF1aXJlX18oODgpOwp2YXIgX3hmYV9vYmplY3QgPSBfX3dfcGRmanNfcmVxdWlyZV9fKDg3KTsKdmFyIF9uYW1lc3BhY2VzID0gX193X3BkZmpzX3JlcXVpcmVfXyg4MSk7CnZhciBfdXRpbCA9IF9fd19wZGZqc19yZXF1aXJlX18oMik7CmNvbnN0IE5TX0RBVEFTRVRTID0gX25hbWVzcGFjZXMuTmFtZXNwYWNlSWRzLmRhdGFzZXRzLmlkOwpmdW5jdGlvbiBjcmVhdGVUZXh0KGNvbnRlbnQpIHsKICBjb25zdCBub2RlID0gbmV3IF90ZW1wbGF0ZS5UZXh0KHt9KTsKICBub2RlW19zeW1ib2xfdXRpbHMuJGNvbnRlbnRdID0gY29udGVudDsKICByZXR1cm4gbm9kZTsKfQpjbGFzcyBCaW5kZXIgewogIGNvbnN0cnVjdG9yKHJvb3QpIHsKICAgIHRoaXMucm9vdCA9IHJvb3Q7CiAgICB0aGlzLmRhdGFzZXRzID0gcm9vdC5kYXRhc2V0czsKICAgIHRoaXMuZGF0YSA9IHJvb3QuZGF0YXNldHM/LmRhdGEgfHwgbmV3IF94ZmFfb2JqZWN0LlhtbE9iamVjdChfbmFtZXNwYWNlcy5OYW1lc3BhY2VJZHMuZGF0YXNldHMuaWQsICJkYXRhIik7CiAgICB0aGlzLmVtcHR5TWVyZ2UgPSB0aGlzLmRhdGFbX3N5bWJvbF91dGlscy4kZ2V0Q2hpbGRyZW5dKCkubGVuZ3RoID09PSAwOwogICAgdGhpcy5yb290LmZvcm0gPSB0aGlzLmZvcm0gPSByb290LnRlbXBsYXRlW19zeW1ib2xfdXRpbHMuJGNsb25lXSgpOwogIH0KICBfaXNDb25zdW1lRGF0YSgpIHsKICAgIHJldHVybiAhdGhpcy5lbXB0eU1lcmdlICYmIHRoaXMuX21lcmdlTW9kZTsKICB9CiAgX2lzTWF0Y2hUZW1wbGF0ZSgpIHsKICAgIHJldHVybiAhdGhpcy5faXNDb25zdW1lRGF0YSgpOwogIH0KICBiaW5kKCkgewogICAgdGhpcy5fYmluZEVsZW1lbnQodGhpcy5mb3JtLCB0aGlzLmRhdGEpOwogICAgcmV0dXJuIHRoaXMuZm9ybTsKICB9CiAgZ2V0RGF0YSgpIHsKICAgIHJldHVybiB0aGlzLmRhdGE7CiAgfQogIF9iaW5kVmFsdWUoZm9ybU5vZGUsIGRhdGEsIHBpY3R1cmUpIHsKICAgIGZvcm1Ob2RlW19zeW1ib2xfdXRpbHMuJGRhdGFdID0gZGF0YTsKICAgIGlmIChmb3JtTm9kZVtfc3ltYm9sX3V0aWxzLiRoYXNTZXR0YWJsZVZhbHVlXSgpKSB7CiAgICAgIGlmIChkYXRhW19zeW1ib2xfdXRpbHMuJGlzRGF0YVZhbHVlXSgpKSB7CiAgICAgICAgY29uc3QgdmFsdWUgPSBkYXRhW19zeW1ib2xfdXRpbHMuJGdldERhdGFWYWx1ZV0oKTsKICAgICAgICBmb3JtTm9kZVtfc3ltYm9sX3V0aWxzLiRzZXRWYWx1ZV0oY3JlYXRlVGV4dCh2YWx1ZSkpOwogICAgICB9IGVsc2UgaWYgKGZvcm1Ob2RlIGluc3RhbmNlb2YgX3RlbXBsYXRlLkZpZWxkICYmIGZvcm1Ob2RlLnVpPy5jaG9pY2VMaXN0Py5vcGVuID09PSAibXVsdGlTZWxlY3QiKSB7CiAgICAgICAgY29uc3QgdmFsdWUgPSBkYXRhW19zeW1ib2xfdXRpbHMuJGdldENoaWxkcmVuXSgpLm1hcChjaGlsZCA9PiBjaGlsZFtfc3ltYm9sX3V0aWxzLiRjb250ZW50XS50cmltKCkpLmpvaW4oIlxuIik7CiAgICAgICAgZm9ybU5vZGVbX3N5bWJvbF91dGlscy4kc2V0VmFsdWVdKGNyZWF0ZVRleHQodmFsdWUpKTsKICAgICAgfSBlbHNlIGlmICh0aGlzLl9pc0NvbnN1bWVEYXRhKCkpIHsKICAgICAgICAoMCwgX3V0aWwud2FybikoYFhGQSAtIE5vZGVzIGhhdmVuJ3QgdGhlIHNhbWUgdHlwZS5gKTsKICAgICAgfQogICAgfSBlbHNlIGlmICghZGF0YVtfc3ltYm9sX3V0aWxzLiRpc0RhdGFWYWx1ZV0oKSB8fCB0aGlzLl9pc01hdGNoVGVtcGxhdGUoKSkgewogICAgICB0aGlzLl9iaW5kRWxlbWVudChmb3JtTm9kZSwgZGF0YSk7CiAgICB9IGVsc2UgewogICAgICAoMCwgX3V0aWwud2FybikoYFhGQSAtIE5vZGVzIGhhdmVuJ3QgdGhlIHNhbWUgdHlwZS5gKTsKICAgIH0KICB9CiAgX2ZpbmREYXRhQnlOYW1lVG9Db25zdW1lKG5hbWUsIGlzVmFsdWUsIGRhdGFOb2RlLCBnbG9iYWwpIHsKICAgIGlmICghbmFtZSkgewogICAgICByZXR1cm4gbnVsbDsKICAgIH0KICAgIGxldCBnZW5lcmF0b3IsIG1hdGNoOwogICAgZm9yIChsZXQgaSA9IDA7IGkgPCAzOyBpKyspIHsKICAgICAgZ2VuZXJhdG9yID0gZGF0YU5vZGVbX3N5bWJvbF91dGlscy4kZ2V0UmVhbENoaWxkcmVuQnlOYW1lSXRdKG5hbWUsIGZhbHNlLCB0cnVlKTsKICAgICAgd2hpbGUgKHRydWUpIHsKICAgICAgICBtYXRjaCA9IGdlbmVyYXRvci5uZXh0KCkudmFsdWU7CiAgICAgICAgaWYgKCFtYXRjaCkgewogICAgICAgICAgYnJlYWs7CiAgICAgICAgfQogICAgICAgIGlmIChpc1ZhbHVlID09PSBtYXRjaFtfc3ltYm9sX3V0aWxzLiRpc0RhdGFWYWx1ZV0oKSkgewogICAgICAgICAgcmV0dXJuIG1hdGNoOwogICAgICAgIH0KICAgICAgfQogICAgICBpZiAoZGF0YU5vZGVbX3N5bWJvbF91dGlscy4kbmFtZXNwYWNlSWRdID09PSBfbmFtZXNwYWNlcy5OYW1lc3BhY2VJZHMuZGF0YXNldHMuaWQgJiYgZGF0YU5vZGVbX3N5bWJvbF91dGlscy4kbm9kZU5hbWVdID09PSAiZGF0YSIpIHsKICAgICAgICBicmVhazsKICAgICAgfQogICAgICBkYXRhTm9kZSA9IGRhdGFOb2RlW19zeW1ib2xfdXRpbHMuJGdldFBhcmVudF0oKTsKICAgIH0KICAgIGlmICghZ2xvYmFsKSB7CiAgICAgIHJldHVybiBudWxsOwogICAgfQogICAgZ2VuZXJhdG9yID0gdGhpcy5kYXRhW19zeW1ib2xfdXRpbHMuJGdldFJlYWxDaGlsZHJlbkJ5TmFtZUl0XShuYW1lLCB0cnVlLCBmYWxzZSk7CiAgICBtYXRjaCA9IGdlbmVyYXRvci5uZXh0KCkudmFsdWU7CiAgICBpZiAobWF0Y2gpIHsKICAgICAgcmV0dXJuIG1hdGNoOwogICAgfQogICAgZ2VuZXJhdG9yID0gdGhpcy5kYXRhW19zeW1ib2xfdXRpbHMuJGdldEF0dHJpYnV0ZUl0XShuYW1lLCB0cnVlKTsKICAgIG1hdGNoID0gZ2VuZXJhdG9yLm5leHQoKS52YWx1ZTsKICAgIGlmIChtYXRjaD8uW19zeW1ib2xfdXRpbHMuJGlzRGF0YVZhbHVlXSgpKSB7CiAgICAgIHJldHVybiBtYXRjaDsKICAgIH0KICAgIHJldHVybiBudWxsOwogIH0KICBfc2V0UHJvcGVydGllcyhmb3JtTm9kZSwgZGF0YU5vZGUpIHsKICAgIGlmICghZm9ybU5vZGUuaGFzT3duUHJvcGVydHkoInNldFByb3BlcnR5IikpIHsKICAgICAgcmV0dXJuOwogICAgfQogICAgZm9yIChjb25zdCB7CiAgICAgIHJlZiwKICAgICAgdGFyZ2V0LAogICAgICBjb25uZWN0aW9uCiAgICB9IG9mIGZvcm1Ob2RlLnNldFByb3BlcnR5LmNoaWxkcmVuKSB7CiAgICAgIGlmIChjb25uZWN0aW9uKSB7CiAgICAgICAgY29udGludWU7CiAgICAgIH0KICAgICAgaWYgKCFyZWYpIHsKICAgICAgICBjb250aW51ZTsKICAgICAgfQogICAgICBjb25zdCBub2RlcyA9ICgwLCBfc29tLnNlYXJjaE5vZGUpKHRoaXMucm9vdCwgZGF0YU5vZGUsIHJlZiwgZmFsc2UsIGZhbHNlKTsKICAgICAgaWYgKCFub2RlcykgewogICAgICAgICgwLCBfdXRpbC53YXJuKShgWEZBIC0gSW52YWxpZCByZWZlcmVuY2U6ICR7cmVmfS5gKTsKICAgICAgICBjb250aW51ZTsKICAgICAgfQogICAgICBjb25zdCBbbm9kZV0gPSBub2RlczsKICAgICAgaWYgKCFub2RlW19zeW1ib2xfdXRpbHMuJGlzRGVzY2VuZGVudF0odGhpcy5kYXRhKSkgewogICAgICAgICgwLCBfdXRpbC53YXJuKShgWEZBIC0gSW52YWxpZCBub2RlOiBtdXN0IGJlIGEgZGF0YSBub2RlLmApOwogICAgICAgIGNvbnRpbnVlOwogICAgICB9CiAgICAgIGNvbnN0IHRhcmdldE5vZGVzID0gKDAsIF9zb20uc2VhcmNoTm9kZSkodGhpcy5yb290LCBmb3JtTm9kZSwgdGFyZ2V0LCBmYWxzZSwgZmFsc2UpOwogICAgICBpZiAoIXRhcmdldE5vZGVzKSB7CiAgICAgICAgKDAsIF91dGlsLndhcm4pKGBYRkEgLSBJbnZhbGlkIHRhcmdldDogJHt0YXJnZXR9LmApOwogICAgICAgIGNvbnRpbnVlOwogICAgICB9CiAgICAgIGNvbnN0IFt0YXJnZXROb2RlXSA9IHRhcmdldE5vZGVzOwogICAgICBpZiAoIXRhcmdldE5vZGVbX3N5bWJvbF91dGlscy4kaXNEZXNjZW5kZW50XShmb3JtTm9kZSkpIHsKICAgICAgICAoMCwgX3V0aWwud2FybikoYFhGQSAtIEludmFsaWQgdGFyZ2V0OiBtdXN0IGJlIGEgcHJvcGVydHkgb3Igc3VicHJvcGVydHkuYCk7CiAgICAgICAgY29udGludWU7CiAgICAgIH0KICAgICAgY29uc3QgdGFyZ2V0UGFyZW50ID0gdGFyZ2V0Tm9kZVtfc3ltYm9sX3V0aWxzLiRnZXRQYXJlbnRdKCk7CiAgICAgIGlmICh0YXJnZXROb2RlIGluc3RhbmNlb2YgX3RlbXBsYXRlLlNldFByb3BlcnR5IHx8IHRhcmdldFBhcmVudCBpbnN0YW5jZW9mIF90ZW1wbGF0ZS5TZXRQcm9wZXJ0eSkgewogICAgICAgICgwLCBfdXRpbC53YXJuKShgWEZBIC0gSW52YWxpZCB0YXJnZXQ6IGNhbm5vdCBiZSBhIHNldFByb3BlcnR5IG9yIG9uZSBvZiBpdHMgcHJvcGVydGllcy5gKTsKICAgICAgICBjb250aW51ZTsKICAgICAgfQogICAgICBpZiAodGFyZ2V0Tm9kZSBpbnN0YW5jZW9mIF90ZW1wbGF0ZS5CaW5kSXRlbXMgfHwgdGFyZ2V0UGFyZW50IGluc3RhbmNlb2YgX3RlbXBsYXRlLkJpbmRJdGVtcykgewogICAgICAgICgwLCBfdXRpbC53YXJuKShgWEZBIC0gSW52YWxpZCB0YXJnZXQ6IGNhbm5vdCBiZSBhIGJpbmRJdGVtcyBvciBvbmUgb2YgaXRzIHByb3BlcnRpZXMuYCk7CiAgICAgICAgY29udGludWU7CiAgICAgIH0KICAgICAgY29uc3QgY29udGVudCA9IG5vZGVbX3N5bWJvbF91dGlscy4kdGV4dF0oKTsKICAgICAgY29uc3QgbmFtZSA9IHRhcmdldE5vZGVbX3N5bWJvbF91dGlscy4kbm9kZU5hbWVdOwogICAgICBpZiAodGFyZ2V0Tm9kZSBpbnN0YW5jZW9mIF94ZmFfb2JqZWN0LlhGQUF0dHJpYnV0ZSkgewogICAgICAgIGNvbnN0IGF0dHJzID0gT2JqZWN0LmNyZWF0ZShudWxsKTsKICAgICAgICBhdHRyc1tuYW1lXSA9IGNvbnRlbnQ7CiAgICAgICAgY29uc3Qgb2JqID0gUmVmbGVjdC5jb25zdHJ1Y3QoT2JqZWN0LmdldFByb3RvdHlwZU9mKHRhcmdldFBhcmVudCkuY29uc3RydWN0b3IsIFthdHRyc10pOwogICAgICAgIHRhcmdldFBhcmVudFtuYW1lXSA9IG9ialtuYW1lXTsKICAgICAgICBjb250aW51ZTsKICAgICAgfQogICAgICBpZiAoIXRhcmdldE5vZGUuaGFzT3duUHJvcGVydHkoX3N5bWJvbF91dGlscy4kY29udGVudCkpIHsKICAgICAgICAoMCwgX3V0aWwud2FybikoYFhGQSAtIEludmFsaWQgbm9kZSB0byB1c2UgaW4gc2V0UHJvcGVydHlgKTsKICAgICAgICBjb250aW51ZTsKICAgICAgfQogICAgICB0YXJnZXROb2RlW19zeW1ib2xfdXRpbHMuJGRhdGFdID0gbm9kZTsKICAgICAgdGFyZ2V0Tm9kZVtfc3ltYm9sX3V0aWxzLiRjb250ZW50XSA9IGNvbnRlbnQ7CiAgICAgIHRhcmdldE5vZGVbX3N5bWJvbF91dGlscy4kZmluYWxpemVdKCk7CiAgICB9CiAgfQogIF9iaW5kSXRlbXMoZm9ybU5vZGUsIGRhdGFOb2RlKSB7CiAgICBpZiAoIWZvcm1Ob2RlLmhhc093blByb3BlcnR5KCJpdGVtcyIpIHx8ICFmb3JtTm9kZS5oYXNPd25Qcm9wZXJ0eSgiYmluZEl0ZW1zIikgfHwgZm9ybU5vZGUuYmluZEl0ZW1zLmlzRW1wdHkoKSkgewogICAgICByZXR1cm47CiAgICB9CiAgICBmb3IgKGNvbnN0IGl0ZW0gb2YgZm9ybU5vZGUuaXRlbXMuY2hpbGRyZW4pIHsKICAgICAgZm9ybU5vZGVbX3N5bWJvbF91dGlscy4kcmVtb3ZlQ2hpbGRdKGl0ZW0pOwogICAgfQogICAgZm9ybU5vZGUuaXRlbXMuY2xlYXIoKTsKICAgIGNvbnN0IGxhYmVscyA9IG5ldyBfdGVtcGxhdGUuSXRlbXMoe30pOwogICAgY29uc3QgdmFsdWVzID0gbmV3IF90ZW1wbGF0ZS5JdGVtcyh7fSk7CiAgICBmb3JtTm9kZVtfc3ltYm9sX3V0aWxzLiRhcHBlbmRDaGlsZF0obGFiZWxzKTsKICAgIGZvcm1Ob2RlLml0ZW1zLnB1c2gobGFiZWxzKTsKICAgIGZvcm1Ob2RlW19zeW1ib2xfdXRpbHMuJGFwcGVuZENoaWxkXSh2YWx1ZXMpOwogICAgZm9ybU5vZGUuaXRlbXMucHVzaCh2YWx1ZXMpOwogICAgZm9yIChjb25zdCB7CiAgICAgIHJlZiwKICAgICAgbGFiZWxSZWYsCiAgICAgIHZhbHVlUmVmLAogICAgICBjb25uZWN0aW9uCiAgICB9IG9mIGZvcm1Ob2RlLmJpbmRJdGVtcy5jaGlsZHJlbikgewogICAgICBpZiAoY29ubmVjdGlvbikgewogICAgICAgIGNvbnRpbnVlOwogICAgICB9CiAgICAgIGlmICghcmVmKSB7CiAgICAgICAgY29udGludWU7CiAgICAgIH0KICAgICAgY29uc3Qgbm9kZXMgPSAoMCwgX3NvbS5zZWFyY2hOb2RlKSh0aGlzLnJvb3QsIGRhdGFOb2RlLCByZWYsIGZhbHNlLCBmYWxzZSk7CiAgICAgIGlmICghbm9kZXMpIHsKICAgICAgICAoMCwgX3V0aWwud2FybikoYFhGQSAtIEludmFsaWQgcmVmZXJlbmNlOiAke3JlZn0uYCk7CiAgICAgICAgY29udGludWU7CiAgICAgIH0KICAgICAgZm9yIChjb25zdCBub2RlIG9mIG5vZGVzKSB7CiAgICAgICAgaWYgKCFub2RlW19zeW1ib2xfdXRpbHMuJGlzRGVzY2VuZGVudF0odGhpcy5kYXRhc2V0cykpIHsKICAgICAgICAgICgwLCBfdXRpbC53YXJuKShgWEZBIC0gSW52YWxpZCByZWYgKCR7cmVmfSk6IG11c3QgYmUgYSBkYXRhc2V0cyBjaGlsZC5gKTsKICAgICAgICAgIGNvbnRpbnVlOwogICAgICAgIH0KICAgICAgICBjb25zdCBsYWJlbE5vZGVzID0gKDAsIF9zb20uc2VhcmNoTm9kZSkodGhpcy5yb290LCBub2RlLCBsYWJlbFJlZiwgdHJ1ZSwgZmFsc2UpOwogICAgICAgIGlmICghbGFiZWxOb2RlcykgewogICAgICAgICAgKDAsIF91dGlsLndhcm4pKGBYRkEgLSBJbnZhbGlkIGxhYmVsOiAke2xhYmVsUmVmfS5gKTsKICAgICAgICAgIGNvbnRpbnVlOwogICAgICAgIH0KICAgICAgICBjb25zdCBbbGFiZWxOb2RlXSA9IGxhYmVsTm9kZXM7CiAgICAgICAgaWYgKCFsYWJlbE5vZGVbX3N5bWJvbF91dGlscy4kaXNEZXNjZW5kZW50XSh0aGlzLmRhdGFzZXRzKSkgewogICAgICAgICAgKDAsIF91dGlsLndhcm4pKGBYRkEgLSBJbnZhbGlkIGxhYmVsOiBtdXN0IGJlIGEgZGF0YXNldHMgY2hpbGQuYCk7CiAgICAgICAgICBjb250aW51ZTsKICAgICAgICB9CiAgICAgICAgY29uc3QgdmFsdWVOb2RlcyA9ICgwLCBfc29tLnNlYXJjaE5vZGUpKHRoaXMucm9vdCwgbm9kZSwgdmFsdWVSZWYsIHRydWUsIGZhbHNlKTsKICAgICAgICBpZiAoIXZhbHVlTm9kZXMpIHsKICAgICAgICAgICgwLCBfdXRpbC53YXJuKShgWEZBIC0gSW52YWxpZCB2YWx1ZTogJHt2YWx1ZVJlZn0uYCk7CiAgICAgICAgICBjb250aW51ZTsKICAgICAgICB9CiAgICAgICAgY29uc3QgW3ZhbHVlTm9kZV0gPSB2YWx1ZU5vZGVzOwogICAgICAgIGlmICghdmFsdWVOb2RlW19zeW1ib2xfdXRpbHMuJGlzRGVzY2VuZGVudF0odGhpcy5kYXRhc2V0cykpIHsKICAgICAgICAgICgwLCBfdXRpbC53YXJuKShgWEZBIC0gSW52YWxpZCB2YWx1ZTogbXVzdCBiZSBhIGRhdGFzZXRzIGNoaWxkLmApOwogICAgICAgICAgY29udGludWU7CiAgICAgICAgfQogICAgICAgIGNvbnN0IGxhYmVsID0gY3JlYXRlVGV4dChsYWJlbE5vZGVbX3N5bWJvbF91dGlscy4kdGV4dF0oKSk7CiAgICAgICAgY29uc3QgdmFsdWUgPSBjcmVhdGVUZXh0KHZhbHVlTm9kZVtfc3ltYm9sX3V0aWxzLiR0ZXh0XSgpKTsKICAgICAgICBsYWJlbHNbX3N5bWJvbF91dGlscy4kYXBwZW5kQ2hpbGRdKGxhYmVsKTsKICAgICAgICBsYWJlbHMudGV4dC5wdXNoKGxhYmVsKTsKICAgICAgICB2YWx1ZXNbX3N5bWJvbF91dGlscy4kYXBwZW5kQ2hpbGRdKHZhbHVlKTsKICAgICAgICB2YWx1ZXMudGV4dC5wdXNoKHZhbHVlKTsKICAgICAgfQogICAgfQogIH0KICBfYmluZE9jY3VycmVuY2VzKGZvcm1Ob2RlLCBtYXRjaGVzLCBwaWN0dXJlKSB7CiAgICBsZXQgYmFzZUNsb25lOwogICAgaWYgKG1hdGNoZXMubGVuZ3RoID4gMSkgewogICAgICBiYXNlQ2xvbmUgPSBmb3JtTm9kZVtfc3ltYm9sX3V0aWxzLiRjbG9uZV0oKTsKICAgICAgYmFzZUNsb25lW19zeW1ib2xfdXRpbHMuJHJlbW92ZUNoaWxkXShiYXNlQ2xvbmUub2NjdXIpOwogICAgICBiYXNlQ2xvbmUub2NjdXIgPSBudWxsOwogICAgfQogICAgdGhpcy5fYmluZFZhbHVlKGZvcm1Ob2RlLCBtYXRjaGVzWzBdLCBwaWN0dXJlKTsKICAgIHRoaXMuX3NldFByb3BlcnRpZXMoZm9ybU5vZGUsIG1hdGNoZXNbMF0pOwogICAgdGhpcy5fYmluZEl0ZW1zKGZvcm1Ob2RlLCBtYXRjaGVzWzBdKTsKICAgIGlmIChtYXRjaGVzLmxlbmd0aCA9PT0gMSkgewogICAgICByZXR1cm47CiAgICB9CiAgICBjb25zdCBwYXJlbnQgPSBmb3JtTm9kZVtfc3ltYm9sX3V0aWxzLiRnZXRQYXJlbnRdKCk7CiAgICBjb25zdCBuYW1lID0gZm9ybU5vZGVbX3N5bWJvbF91dGlscy4kbm9kZU5hbWVdOwogICAgY29uc3QgcG9zID0gcGFyZW50W19zeW1ib2xfdXRpbHMuJGluZGV4T2ZdKGZvcm1Ob2RlKTsKICAgIGZvciAobGV0IGkgPSAxLCBpaSA9IG1hdGNoZXMubGVuZ3RoOyBpIDwgaWk7IGkrKykgewogICAgICBjb25zdCBtYXRjaCA9IG1hdGNoZXNbaV07CiAgICAgIGNvbnN0IGNsb25lID0gYmFzZUNsb25lW19zeW1ib2xfdXRpbHMuJGNsb25lXSgpOwogICAgICBwYXJlbnRbbmFtZV0ucHVzaChjbG9uZSk7CiAgICAgIHBhcmVudFtfc3ltYm9sX3V0aWxzLiRpbnNlcnRBdF0ocG9zICsgaSwgY2xvbmUpOwogICAgICB0aGlzLl9iaW5kVmFsdWUoY2xvbmUsIG1hdGNoLCBwaWN0dXJlKTsKICAgICAgdGhpcy5fc2V0UHJvcGVydGllcyhjbG9uZSwgbWF0Y2gpOwogICAgICB0aGlzLl9iaW5kSXRlbXMoY2xvbmUsIG1hdGNoKTsKICAgIH0KICB9CiAgX2NyZWF0ZU9jY3VycmVuY2VzKGZvcm1Ob2RlKSB7CiAgICBpZiAoIXRoaXMuZW1wdHlNZXJnZSkgewogICAgICByZXR1cm47CiAgICB9CiAgICBjb25zdCB7CiAgICAgIG9jY3VyCiAgICB9ID0gZm9ybU5vZGU7CiAgICBpZiAoIW9jY3VyIHx8IG9jY3VyLmluaXRpYWwgPD0gMSkgewogICAgICByZXR1cm47CiAgICB9CiAgICBjb25zdCBwYXJlbnQgPSBmb3JtTm9kZVtfc3ltYm9sX3V0aWxzLiRnZXRQYXJlbnRdKCk7CiAgICBjb25zdCBuYW1lID0gZm9ybU5vZGVbX3N5bWJvbF91dGlscy4kbm9kZU5hbWVdOwogICAgaWYgKCEocGFyZW50W25hbWVdIGluc3RhbmNlb2YgX3hmYV9vYmplY3QuWEZBT2JqZWN0QXJyYXkpKSB7CiAgICAgIHJldHVybjsKICAgIH0KICAgIGxldCBjdXJyZW50TnVtYmVyOwogICAgaWYgKGZvcm1Ob2RlLm5hbWUpIHsKICAgICAgY3VycmVudE51bWJlciA9IHBhcmVudFtuYW1lXS5jaGlsZHJlbi5maWx0ZXIoZSA9PiBlLm5hbWUgPT09IGZvcm1Ob2RlLm5hbWUpLmxlbmd0aDsKICAgIH0gZWxzZSB7CiAgICAgIGN1cnJlbnROdW1iZXIgPSBwYXJlbnRbbmFtZV0uY2hpbGRyZW4ubGVuZ3RoOwogICAgfQogICAgY29uc3QgcG9zID0gcGFyZW50W19zeW1ib2xfdXRpbHMuJGluZGV4T2ZdKGZvcm1Ob2RlKSArIDE7CiAgICBjb25zdCBpaSA9IG9jY3VyLmluaXRpYWwgLSBjdXJyZW50TnVtYmVyOwogICAgaWYgKGlpKSB7CiAgICAgIGNvbnN0IG5vZGVDbG9uZSA9IGZvcm1Ob2RlW19zeW1ib2xfdXRpbHMuJGNsb25lXSgpOwogICAgICBub2RlQ2xvbmVbX3N5bWJvbF91dGlscy4kcmVtb3ZlQ2hpbGRdKG5vZGVDbG9uZS5vY2N1cik7CiAgICAgIG5vZGVDbG9uZS5vY2N1ciA9IG51bGw7CiAgICAgIHBhcmVudFtuYW1lXS5wdXNoKG5vZGVDbG9uZSk7CiAgICAgIHBhcmVudFtfc3ltYm9sX3V0aWxzLiRpbnNlcnRBdF0ocG9zLCBub2RlQ2xvbmUpOwogICAgICBmb3IgKGxldCBpID0gMTsgaSA8IGlpOyBpKyspIHsKICAgICAgICBjb25zdCBjbG9uZSA9IG5vZGVDbG9uZVtfc3ltYm9sX3V0aWxzLiRjbG9uZV0oKTsKICAgICAgICBwYXJlbnRbbmFtZV0ucHVzaChjbG9uZSk7CiAgICAgICAgcGFyZW50W19zeW1ib2xfdXRpbHMuJGluc2VydEF0XShwb3MgKyBpLCBjbG9uZSk7CiAgICAgIH0KICAgIH0KICB9CiAgX2dldE9jY3VySW5mbyhmb3JtTm9kZSkgewogICAgY29uc3QgewogICAgICBuYW1lLAogICAgICBvY2N1cgogICAgfSA9IGZvcm1Ob2RlOwogICAgaWYgKCFvY2N1ciB8fCAhbmFtZSkgewogICAgICByZXR1cm4gWzEsIDFdOwogICAgfQogICAgY29uc3QgbWF4ID0gb2NjdXIubWF4ID09PSAtMSA/IEluZmluaXR5IDogb2NjdXIubWF4OwogICAgcmV0dXJuIFtvY2N1ci5taW4sIG1heF07CiAgfQogIF9zZXRBbmRCaW5kKGZvcm1Ob2RlLCBkYXRhTm9kZSkgewogICAgdGhpcy5fc2V0UHJvcGVydGllcyhmb3JtTm9kZSwgZGF0YU5vZGUpOwogICAgdGhpcy5fYmluZEl0ZW1zKGZvcm1Ob2RlLCBkYXRhTm9kZSk7CiAgICB0aGlzLl9iaW5kRWxlbWVudChmb3JtTm9kZSwgZGF0YU5vZGUpOwogIH0KICBfYmluZEVsZW1lbnQoZm9ybU5vZGUsIGRhdGFOb2RlKSB7CiAgICBjb25zdCB1c2VsZXNzTm9kZXMgPSBbXTsKICAgIHRoaXMuX2NyZWF0ZU9jY3VycmVuY2VzKGZvcm1Ob2RlKTsKICAgIGZvciAoY29uc3QgY2hpbGQgb2YgZm9ybU5vZGVbX3N5bWJvbF91dGlscy4kZ2V0Q2hpbGRyZW5dKCkpIHsKICAgICAgaWYgKGNoaWxkW19zeW1ib2xfdXRpbHMuJGRhdGFdKSB7CiAgICAgICAgY29udGludWU7CiAgICAgIH0KICAgICAgaWYgKHRoaXMuX21lcmdlTW9kZSA9PT0gdW5kZWZpbmVkICYmIGNoaWxkW19zeW1ib2xfdXRpbHMuJG5vZGVOYW1lXSA9PT0gInN1YmZvcm0iKSB7CiAgICAgICAgdGhpcy5fbWVyZ2VNb2RlID0gY2hpbGQubWVyZ2VNb2RlID09PSAiY29uc3VtZURhdGEiOwogICAgICAgIGNvbnN0IGRhdGFDaGlsZHJlbiA9IGRhdGFOb2RlW19zeW1ib2xfdXRpbHMuJGdldENoaWxkcmVuXSgpOwogICAgICAgIGlmIChkYXRhQ2hpbGRyZW4ubGVuZ3RoID4gMCkgewogICAgICAgICAgdGhpcy5fYmluZE9jY3VycmVuY2VzKGNoaWxkLCBbZGF0YUNoaWxkcmVuWzBdXSwgbnVsbCk7CiAgICAgICAgfSBlbHNlIGlmICh0aGlzLmVtcHR5TWVyZ2UpIHsKICAgICAgICAgIGNvbnN0IG5zSWQgPSBkYXRhTm9kZVtfc3ltYm9sX3V0aWxzLiRuYW1lc3BhY2VJZF0gPT09IE5TX0RBVEFTRVRTID8gLTEgOiBkYXRhTm9kZVtfc3ltYm9sX3V0aWxzLiRuYW1lc3BhY2VJZF07CiAgICAgICAgICBjb25zdCBkYXRhQ2hpbGQgPSBjaGlsZFtfc3ltYm9sX3V0aWxzLiRkYXRhXSA9IG5ldyBfeGZhX29iamVjdC5YbWxPYmplY3QobnNJZCwgY2hpbGQubmFtZSB8fCAicm9vdCIpOwogICAgICAgICAgZGF0YU5vZGVbX3N5bWJvbF91dGlscy4kYXBwZW5kQ2hpbGRdKGRhdGFDaGlsZCk7CiAgICAgICAgICB0aGlzLl9iaW5kRWxlbWVudChjaGlsZCwgZGF0YUNoaWxkKTsKICAgICAgICB9CiAgICAgICAgY29udGludWU7CiAgICAgIH0KICAgICAgaWYgKCFjaGlsZFtfc3ltYm9sX3V0aWxzLiRpc0JpbmRhYmxlXSgpKSB7CiAgICAgICAgY29udGludWU7CiAgICAgIH0KICAgICAgbGV0IGdsb2JhbCA9IGZhbHNlOwogICAgICBsZXQgcGljdHVyZSA9IG51bGw7CiAgICAgIGxldCByZWYgPSBudWxsOwogICAgICBsZXQgbWF0Y2ggPSBudWxsOwogICAgICBpZiAoY2hpbGQuYmluZCkgewogICAgICAgIHN3aXRjaCAoY2hpbGQuYmluZC5tYXRjaCkgewogICAgICAgICAgY2FzZSAibm9uZSI6CiAgICAgICAgICAgIHRoaXMuX3NldEFuZEJpbmQoY2hpbGQsIGRhdGFOb2RlKTsKICAgICAgICAgICAgY29udGludWU7CiAgICAgICAgICBjYXNlICJnbG9iYWwiOgogICAgICAgICAgICBnbG9iYWwgPSB0cnVlOwogICAgICAgICAgICBicmVhazsKICAgICAgICAgIGNhc2UgImRhdGFSZWYiOgogICAgICAgICAgICBpZiAoIWNoaWxkLmJpbmQucmVmKSB7CiAgICAgICAgICAgICAgKDAsIF91dGlsLndhcm4pKGBYRkEgLSByZWYgaXMgZW1wdHkgaW4gbm9kZSAke2NoaWxkW19zeW1ib2xfdXRpbHMuJG5vZGVOYW1lXX0uYCk7CiAgICAgICAgICAgICAgdGhpcy5fc2V0QW5kQmluZChjaGlsZCwgZGF0YU5vZGUpOwogICAgICAgICAgICAgIGNvbnRpbnVlOwogICAgICAgICAgICB9CiAgICAgICAgICAgIHJlZiA9IGNoaWxkLmJpbmQucmVmOwogICAgICAgICAgICBicmVhazsKICAgICAgICAgIGRlZmF1bHQ6CiAgICAgICAgICAgIGJyZWFrOwogICAgICAgIH0KICAgICAgICBpZiAoY2hpbGQuYmluZC5waWN0dXJlKSB7CiAgICAgICAgICBwaWN0dXJlID0gY2hpbGQuYmluZC5waWN0dXJlW19zeW1ib2xfdXRpbHMuJGNvbnRlbnRdOwogICAgICAgIH0KICAgICAgfQogICAgICBjb25zdCBbbWluLCBtYXhdID0gdGhpcy5fZ2V0T2NjdXJJbmZvKGNoaWxkKTsKICAgICAgaWYgKHJlZikgewogICAgICAgIG1hdGNoID0gKDAsIF9zb20uc2VhcmNoTm9kZSkodGhpcy5yb290LCBkYXRhTm9kZSwgcmVmLCB0cnVlLCBmYWxzZSk7CiAgICAgICAgaWYgKG1hdGNoID09PSBudWxsKSB7CiAgICAgICAgICBtYXRjaCA9ICgwLCBfc29tLmNyZWF0ZURhdGFOb2RlKSh0aGlzLmRhdGEsIGRhdGFOb2RlLCByZWYpOwogICAgICAgICAgaWYgKCFtYXRjaCkgewogICAgICAgICAgICBjb250aW51ZTsKICAgICAgICAgIH0KICAgICAgICAgIGlmICh0aGlzLl9pc0NvbnN1bWVEYXRhKCkpIHsKICAgICAgICAgICAgbWF0Y2hbX3N5bWJvbF91dGlscy4kY29uc3VtZWRdID0gdHJ1ZTsKICAgICAgICAgIH0KICAgICAgICAgIHRoaXMuX3NldEFuZEJpbmQoY2hpbGQsIG1hdGNoKTsKICAgICAgICAgIGNvbnRpbnVlOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICBpZiAodGhpcy5faXNDb25zdW1lRGF0YSgpKSB7CiAgICAgICAgICAgIG1hdGNoID0gbWF0Y2guZmlsdGVyKG5vZGUgPT4gIW5vZGVbX3N5bWJvbF91dGlscy4kY29uc3VtZWRdKTsKICAgICAgICAgIH0KICAgICAgICAgIGlmIChtYXRjaC5sZW5ndGggPiBtYXgpIHsKICAgICAgICAgICAgbWF0Y2ggPSBtYXRjaC5zbGljZSgwLCBtYXgpOwogICAgICAgICAgfSBlbHNlIGlmIChtYXRjaC5sZW5ndGggPT09IDApIHsKICAgICAgICAgICAgbWF0Y2ggPSBudWxsOwogICAgICAgICAgfQogICAgICAgICAgaWYgKG1hdGNoICYmIHRoaXMuX2lzQ29uc3VtZURhdGEoKSkgewogICAgICAgICAgICBtYXRjaC5mb3JFYWNoKG5vZGUgPT4gewogICAgICAgICAgICAgIG5vZGVbX3N5bWJvbF91dGlscy4kY29uc3VtZWRdID0gdHJ1ZTsKICAgICAgICAgICAgfSk7CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICB9IGVsc2UgewogICAgICAgIGlmICghY2hpbGQubmFtZSkgewogICAgICAgICAgdGhpcy5fc2V0QW5kQmluZChjaGlsZCwgZGF0YU5vZGUpOwogICAgICAgICAgY29udGludWU7CiAgICAgICAgfQogICAgICAgIGlmICh0aGlzLl9pc0NvbnN1bWVEYXRhKCkpIHsKICAgICAgICAgIGNvbnN0IG1hdGNoZXMgPSBbXTsKICAgICAgICAgIHdoaWxlIChtYXRjaGVzLmxlbmd0aCA8IG1heCkgewogICAgICAgICAgICBjb25zdCBmb3VuZCA9IHRoaXMuX2ZpbmREYXRhQnlOYW1lVG9Db25zdW1lKGNoaWxkLm5hbWUsIGNoaWxkW19zeW1ib2xfdXRpbHMuJGhhc1NldHRhYmxlVmFsdWVdKCksIGRhdGFOb2RlLCBnbG9iYWwpOwogICAgICAgICAgICBpZiAoIWZvdW5kKSB7CiAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgZm91bmRbX3N5bWJvbF91dGlscy4kY29uc3VtZWRdID0gdHJ1ZTsKICAgICAgICAgICAgbWF0Y2hlcy5wdXNoKGZvdW5kKTsKICAgICAgICAgIH0KICAgICAgICAgIG1hdGNoID0gbWF0Y2hlcy5sZW5ndGggPiAwID8gbWF0Y2hlcyA6IG51bGw7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIG1hdGNoID0gZGF0YU5vZGVbX3N5bWJvbF91dGlscy4kZ2V0UmVhbENoaWxkcmVuQnlOYW1lSXRdKGNoaWxkLm5hbWUsIGZhbHNlLCB0aGlzLmVtcHR5TWVyZ2UpLm5leHQoKS52YWx1ZTsKICAgICAgICAgIGlmICghbWF0Y2gpIHsKICAgICAgICAgICAgaWYgKG1pbiA9PT0gMCkgewogICAgICAgICAgICAgIHVzZWxlc3NOb2Rlcy5wdXNoKGNoaWxkKTsKICAgICAgICAgICAgICBjb250aW51ZTsKICAgICAgICAgICAgfQogICAgICAgICAgICBjb25zdCBuc0lkID0gZGF0YU5vZGVbX3N5bWJvbF91dGlscy4kbmFtZXNwYWNlSWRdID09PSBOU19EQVRBU0VUUyA/IC0xIDogZGF0YU5vZGVbX3N5bWJvbF91dGlscy4kbmFtZXNwYWNlSWRdOwogICAgICAgICAgICBtYXRjaCA9IGNoaWxkW19zeW1ib2xfdXRpbHMuJGRhdGFdID0gbmV3IF94ZmFfb2JqZWN0LlhtbE9iamVjdChuc0lkLCBjaGlsZC5uYW1lKTsKICAgICAgICAgICAgaWYgKHRoaXMuZW1wdHlNZXJnZSkgewogICAgICAgICAgICAgIG1hdGNoW19zeW1ib2xfdXRpbHMuJGNvbnN1bWVkXSA9IHRydWU7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgZGF0YU5vZGVbX3N5bWJvbF91dGlscy4kYXBwZW5kQ2hpbGRdKG1hdGNoKTsKICAgICAgICAgICAgdGhpcy5fc2V0QW5kQmluZChjaGlsZCwgbWF0Y2gpOwogICAgICAgICAgICBjb250aW51ZTsKICAgICAgICAgIH0KICAgICAgICAgIGlmICh0aGlzLmVtcHR5TWVyZ2UpIHsKICAgICAgICAgICAgbWF0Y2hbX3N5bWJvbF91dGlscy4kY29uc3VtZWRdID0gdHJ1ZTsKICAgICAgICAgIH0KICAgICAgICAgIG1hdGNoID0gW21hdGNoXTsKICAgICAgICB9CiAgICAgIH0KICAgICAgaWYgKG1hdGNoKSB7CiAgICAgICAgdGhpcy5fYmluZE9jY3VycmVuY2VzKGNoaWxkLCBtYXRjaCwgcGljdHVyZSk7CiAgICAgIH0gZWxzZSBpZiAobWluID4gMCkgewogICAgICAgIHRoaXMuX3NldEFuZEJpbmQoY2hpbGQsIGRhdGFOb2RlKTsKICAgICAgfSBlbHNlIHsKICAgICAgICB1c2VsZXNzTm9kZXMucHVzaChjaGlsZCk7CiAgICAgIH0KICAgIH0KICAgIHVzZWxlc3NOb2Rlcy5mb3JFYWNoKG5vZGUgPT4gbm9kZVtfc3ltYm9sX3V0aWxzLiRnZXRQYXJlbnRdKClbX3N5bWJvbF91dGlscy4kcmVtb3ZlQ2hpbGRdKG5vZGUpKTsKICB9Cn0KZXhwb3J0cy5CaW5kZXIgPSBCaW5kZXI7CgovKioqLyB9KSwKLyogODAgKi8KLyoqKi8gKChfX3VudXNlZF93ZWJwYWNrX21vZHVsZSwgZXhwb3J0cywgX193X3BkZmpzX3JlcXVpcmVfXykgPT4gewoKCgpPYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgIl9fZXNNb2R1bGUiLCAoewogIHZhbHVlOiB0cnVlCn0pKTsKZXhwb3J0cy5WYWx1ZSA9IGV4cG9ydHMuVGV4dCA9IGV4cG9ydHMuVGVtcGxhdGVOYW1lc3BhY2UgPSBleHBvcnRzLlRlbXBsYXRlID0gZXhwb3J0cy5TZXRQcm9wZXJ0eSA9IGV4cG9ydHMuSXRlbXMgPSBleHBvcnRzLkZpZWxkID0gZXhwb3J0cy5CaW5kSXRlbXMgPSB2b2lkIDA7CnZhciBfc3ltYm9sX3V0aWxzID0gX193X3BkZmpzX3JlcXVpcmVfXyg3OCk7CnZhciBfbmFtZXNwYWNlcyA9IF9fd19wZGZqc19yZXF1aXJlX18oODEpOwp2YXIgX2xheW91dCA9IF9fd19wZGZqc19yZXF1aXJlX18oODIpOwp2YXIgX2h0bWxfdXRpbHMgPSBfX3dfcGRmanNfcmVxdWlyZV9fKDgzKTsKdmFyIF94ZmFfb2JqZWN0ID0gX193X3BkZmpzX3JlcXVpcmVfXyg4Nyk7CnZhciBfdXRpbHMgPSBfX3dfcGRmanNfcmVxdWlyZV9fKDg0KTsKdmFyIF91dGlsID0gX193X3BkZmpzX3JlcXVpcmVfXygyKTsKdmFyIF9mb250cyA9IF9fd19wZGZqc19yZXF1aXJlX18oODUpOwp2YXIgX2NvcmVfdXRpbHMgPSBfX3dfcGRmanNfcmVxdWlyZV9fKDMpOwp2YXIgX3NvbSA9IF9fd19wZGZqc19yZXF1aXJlX18oODgpOwpjb25zdCBURU1QTEFURV9OU19JRCA9IF9uYW1lc3BhY2VzLk5hbWVzcGFjZUlkcy50ZW1wbGF0ZS5pZDsKY29uc3QgU1ZHX05TID0gImh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIjsKY29uc3QgTUFYX0FUVEVNUFRTX0ZPUl9MUlRCX0xBWU9VVCA9IDI7CmNvbnN0IE1BWF9FTVBUWV9QQUdFUyA9IDM7CmNvbnN0IERFRkFVTFRfVEFCX0lOREVYID0gNTAwMDsKY29uc3QgSEVBRElOR19QQVRURVJOID0gL15IKFxkKykkLzsKY29uc3QgTUlNRVMgPSBuZXcgU2V0KFsiaW1hZ2UvZ2lmIiwgImltYWdlL2pwZWciLCAiaW1hZ2UvanBnIiwgImltYWdlL3BqcGVnIiwgImltYWdlL3BuZyIsICJpbWFnZS9hcG5nIiwgImltYWdlL3gtcG5nIiwgImltYWdlL2JtcCIsICJpbWFnZS94LW1zLWJtcCIsICJpbWFnZS90aWZmIiwgImltYWdlL3RpZiIsICJhcHBsaWNhdGlvbi9vY3RldC1zdHJlYW0iXSk7CmNvbnN0IElNQUdFU19IRUFERVJTID0gW1tbMHg0MiwgMHg0ZF0sICJpbWFnZS9ibXAiXSwgW1sweGZmLCAweGQ4LCAweGZmXSwgImltYWdlL2pwZWciXSwgW1sweDQ5LCAweDQ5LCAweDJhLCAweDAwXSwgImltYWdlL3RpZmYiXSwgW1sweDRkLCAweDRkLCAweDAwLCAweDJhXSwgImltYWdlL3RpZmYiXSwgW1sweDQ3LCAweDQ5LCAweDQ2LCAweDM4LCAweDM5LCAweDYxXSwgImltYWdlL2dpZiJdLCBbWzB4ODksIDB4NTAsIDB4NGUsIDB4NDcsIDB4MGQsIDB4MGEsIDB4MWEsIDB4MGFdLCAiaW1hZ2UvcG5nIl1dOwpmdW5jdGlvbiBnZXRCb3JkZXJEaW1zKG5vZGUpIHsKICBpZiAoIW5vZGUgfHwgIW5vZGUuYm9yZGVyKSB7CiAgICByZXR1cm4gewogICAgICB3OiAwLAogICAgICBoOiAwCiAgICB9OwogIH0KICBjb25zdCBib3JkZXJFeHRyYSA9IG5vZGUuYm9yZGVyW19zeW1ib2xfdXRpbHMuJGdldEV4dHJhXSgpOwogIGlmICghYm9yZGVyRXh0cmEpIHsKICAgIHJldHVybiB7CiAgICAgIHc6IDAsCiAgICAgIGg6IDAKICAgIH07CiAgfQogIHJldHVybiB7CiAgICB3OiBib3JkZXJFeHRyYS53aWR0aHNbMF0gKyBib3JkZXJFeHRyYS53aWR0aHNbMl0gKyBib3JkZXJFeHRyYS5pbnNldHNbMF0gKyBib3JkZXJFeHRyYS5pbnNldHNbMl0sCiAgICBoOiBib3JkZXJFeHRyYS53aWR0aHNbMV0gKyBib3JkZXJFeHRyYS53aWR0aHNbM10gKyBib3JkZXJFeHRyYS5pbnNldHNbMV0gKyBib3JkZXJFeHRyYS5pbnNldHNbM10KICB9Owp9CmZ1bmN0aW9uIGhhc01hcmdpbihub2RlKSB7CiAgcmV0dXJuIG5vZGUubWFyZ2luICYmIChub2RlLm1hcmdpbi50b3BJbnNldCB8fCBub2RlLm1hcmdpbi5yaWdodEluc2V0IHx8IG5vZGUubWFyZ2luLmJvdHRvbUluc2V0IHx8IG5vZGUubWFyZ2luLmxlZnRJbnNldCk7Cn0KZnVuY3Rpb24gX3NldFZhbHVlKHRlbXBsYXRlTm9kZSwgdmFsdWUpIHsKICBpZiAoIXRlbXBsYXRlTm9kZS52YWx1ZSkgewogICAgY29uc3Qgbm9kZVZhbHVlID0gbmV3IFZhbHVlKHt9KTsKICAgIHRlbXBsYXRlTm9kZVtfc3ltYm9sX3V0aWxzLiRhcHBlbmRDaGlsZF0obm9kZVZhbHVlKTsKICAgIHRlbXBsYXRlTm9kZS52YWx1ZSA9IG5vZGVWYWx1ZTsKICB9CiAgdGVtcGxhdGVOb2RlLnZhbHVlW19zeW1ib2xfdXRpbHMuJHNldFZhbHVlXSh2YWx1ZSk7Cn0KZnVuY3Rpb24qIGdldENvbnRhaW5lZENoaWxkcmVuKG5vZGUpIHsKICBmb3IgKGNvbnN0IGNoaWxkIG9mIG5vZGVbX3N5bWJvbF91dGlscy4kZ2V0Q2hpbGRyZW5dKCkpIHsKICAgIGlmIChjaGlsZCBpbnN0YW5jZW9mIFN1YmZvcm1TZXQpIHsKICAgICAgeWllbGQqIGNoaWxkW19zeW1ib2xfdXRpbHMuJGdldENvbnRhaW5lZENoaWxkcmVuXSgpOwogICAgICBjb250aW51ZTsKICAgIH0KICAgIHlpZWxkIGNoaWxkOwogIH0KfQpmdW5jdGlvbiBpc1JlcXVpcmVkKG5vZGUpIHsKICByZXR1cm4gbm9kZS52YWxpZGF0ZT8ubnVsbFRlc3QgPT09ICJlcnJvciI7Cn0KZnVuY3Rpb24gc2V0VGFiSW5kZXgobm9kZSkgewogIHdoaWxlIChub2RlKSB7CiAgICBpZiAoIW5vZGUudHJhdmVyc2FsKSB7CiAgICAgIG5vZGVbX3N5bWJvbF91dGlscy4kdGFiSW5kZXhdID0gbm9kZVtfc3ltYm9sX3V0aWxzLiRnZXRQYXJlbnRdKClbX3N5bWJvbF91dGlscy4kdGFiSW5kZXhdOwogICAgICByZXR1cm47CiAgICB9CiAgICBpZiAobm9kZVtfc3ltYm9sX3V0aWxzLiR0YWJJbmRleF0pIHsKICAgICAgcmV0dXJuOwogICAgfQogICAgbGV0IG5leHQgPSBudWxsOwogICAgZm9yIChjb25zdCBjaGlsZCBvZiBub2RlLnRyYXZlcnNhbFtfc3ltYm9sX3V0aWxzLiRnZXRDaGlsZHJlbl0oKSkgewogICAgICBpZiAoY2hpbGQub3BlcmF0aW9uID09PSAibmV4dCIpIHsKICAgICAgICBuZXh0ID0gY2hpbGQ7CiAgICAgICAgYnJlYWs7CiAgICAgIH0KICAgIH0KICAgIGlmICghbmV4dCB8fCAhbmV4dC5yZWYpIHsKICAgICAgbm9kZVtfc3ltYm9sX3V0aWxzLiR0YWJJbmRleF0gPSBub2RlW19zeW1ib2xfdXRpbHMuJGdldFBhcmVudF0oKVtfc3ltYm9sX3V0aWxzLiR0YWJJbmRleF07CiAgICAgIHJldHVybjsKICAgIH0KICAgIGNvbnN0IHJvb3QgPSBub2RlW19zeW1ib2xfdXRpbHMuJGdldFRlbXBsYXRlUm9vdF0oKTsKICAgIG5vZGVbX3N5bWJvbF91dGlscy4kdGFiSW5kZXhdID0gKytyb290W19zeW1ib2xfdXRpbHMuJHRhYkluZGV4XTsKICAgIGNvbnN0IHJlZiA9IHJvb3RbX3N5bWJvbF91dGlscy4kc2VhcmNoTm9kZV0obmV4dC5yZWYsIG5vZGUpOwogICAgaWYgKCFyZWYpIHsKICAgICAgcmV0dXJuOwogICAgfQogICAgbm9kZSA9IHJlZlswXTsKICB9Cn0KZnVuY3Rpb24gYXBwbHlBc3Npc3Qob2JqLCBhdHRyaWJ1dGVzKSB7CiAgY29uc3QgYXNzaXN0ID0gb2JqLmFzc2lzdDsKICBpZiAoYXNzaXN0KSB7CiAgICBjb25zdCBhc3Npc3RUaXRsZSA9IGFzc2lzdFtfc3ltYm9sX3V0aWxzLiR0b0hUTUxdKCk7CiAgICBpZiAoYXNzaXN0VGl0bGUpIHsKICAgICAgYXR0cmlidXRlcy50aXRsZSA9IGFzc2lzdFRpdGxlOwogICAgfQogICAgY29uc3Qgcm9sZSA9IGFzc2lzdC5yb2xlOwogICAgY29uc3QgbWF0Y2ggPSByb2xlLm1hdGNoKEhFQURJTkdfUEFUVEVSTik7CiAgICBpZiAobWF0Y2gpIHsKICAgICAgY29uc3QgYXJpYVJvbGUgPSAiaGVhZGluZyI7CiAgICAgIGNvbnN0IGFyaWFMZXZlbCA9IG1hdGNoWzFdOwogICAgICBhdHRyaWJ1dGVzLnJvbGUgPSBhcmlhUm9sZTsKICAgICAgYXR0cmlidXRlc1siYXJpYS1sZXZlbCJdID0gYXJpYUxldmVsOwogICAgfQogIH0KICBpZiAob2JqLmxheW91dCA9PT0gInRhYmxlIikgewogICAgYXR0cmlidXRlcy5yb2xlID0gInRhYmxlIjsKICB9IGVsc2UgaWYgKG9iai5sYXlvdXQgPT09ICJyb3ciKSB7CiAgICBhdHRyaWJ1dGVzLnJvbGUgPSAicm93IjsKICB9IGVsc2UgewogICAgY29uc3QgcGFyZW50ID0gb2JqW19zeW1ib2xfdXRpbHMuJGdldFBhcmVudF0oKTsKICAgIGlmIChwYXJlbnQubGF5b3V0ID09PSAicm93IikgewogICAgICBhdHRyaWJ1dGVzLnJvbGUgPSBwYXJlbnQuYXNzaXN0Py5yb2xlID09PSAiVEgiID8gImNvbHVtbmhlYWRlciIgOiAiY2VsbCI7CiAgICB9CiAgfQp9CmZ1bmN0aW9uIGFyaWFMYWJlbChvYmopIHsKICBpZiAoIW9iai5hc3Npc3QpIHsKICAgIHJldHVybiBudWxsOwogIH0KICBjb25zdCBhc3Npc3QgPSBvYmouYXNzaXN0OwogIGlmIChhc3Npc3Quc3BlYWsgJiYgYXNzaXN0LnNwZWFrW19zeW1ib2xfdXRpbHMuJGNvbnRlbnRdICE9PSAiIikgewogICAgcmV0dXJuIGFzc2lzdC5zcGVha1tfc3ltYm9sX3V0aWxzLiRjb250ZW50XTsKICB9CiAgaWYgKGFzc2lzdC50b29sVGlwKSB7CiAgICByZXR1cm4gYXNzaXN0LnRvb2xUaXBbX3N5bWJvbF91dGlscy4kY29udGVudF07CiAgfQogIHJldHVybiBudWxsOwp9CmZ1bmN0aW9uIHZhbHVlVG9IdG1sKHZhbHVlKSB7CiAgcmV0dXJuIF91dGlscy5IVE1MUmVzdWx0LnN1Y2Nlc3MoewogICAgbmFtZTogImRpdiIsCiAgICBhdHRyaWJ1dGVzOiB7CiAgICAgIGNsYXNzOiBbInhmYVJpY2giXSwKICAgICAgc3R5bGU6IE9iamVjdC5jcmVhdGUobnVsbCkKICAgIH0sCiAgICBjaGlsZHJlbjogW3sKICAgICAgbmFtZTogInNwYW4iLAogICAgICBhdHRyaWJ1dGVzOiB7CiAgICAgICAgc3R5bGU6IE9iamVjdC5jcmVhdGUobnVsbCkKICAgICAgfSwKICAgICAgdmFsdWUKICAgIH1dCiAgfSk7Cn0KZnVuY3Rpb24gc2V0Rmlyc3RVbnNwbGl0dGFibGUobm9kZSkgewogIGNvbnN0IHJvb3QgPSBub2RlW19zeW1ib2xfdXRpbHMuJGdldFRlbXBsYXRlUm9vdF0oKTsKICBpZiAocm9vdFtfc3ltYm9sX3V0aWxzLiRleHRyYV0uZmlyc3RVbnNwbGl0dGFibGUgPT09IG51bGwpIHsKICAgIHJvb3RbX3N5bWJvbF91dGlscy4kZXh0cmFdLmZpcnN0VW5zcGxpdHRhYmxlID0gbm9kZTsKICAgIHJvb3RbX3N5bWJvbF91dGlscy4kZXh0cmFdLm5vTGF5b3V0RmFpbHVyZSA9IHRydWU7CiAgfQp9CmZ1bmN0aW9uIHVuc2V0Rmlyc3RVbnNwbGl0dGFibGUobm9kZSkgewogIGNvbnN0IHJvb3QgPSBub2RlW19zeW1ib2xfdXRpbHMuJGdldFRlbXBsYXRlUm9vdF0oKTsKICBpZiAocm9vdFtfc3ltYm9sX3V0aWxzLiRleHRyYV0uZmlyc3RVbnNwbGl0dGFibGUgPT09IG5vZGUpIHsKICAgIHJvb3RbX3N5bWJvbF91dGlscy4kZXh0cmFdLm5vTGF5b3V0RmFpbHVyZSA9IGZhbHNlOwogIH0KfQpmdW5jdGlvbiBoYW5kbGVCcmVhayhub2RlKSB7CiAgaWYgKG5vZGVbX3N5bWJvbF91dGlscy4kZXh0cmFdKSB7CiAgICByZXR1cm4gZmFsc2U7CiAgfQogIG5vZGVbX3N5bWJvbF91dGlscy4kZXh0cmFdID0gT2JqZWN0LmNyZWF0ZShudWxsKTsKICBpZiAobm9kZS50YXJnZXRUeXBlID09PSAiYXV0byIpIHsKICAgIHJldHVybiBmYWxzZTsKICB9CiAgY29uc3Qgcm9vdCA9IG5vZGVbX3N5bWJvbF91dGlscy4kZ2V0VGVtcGxhdGVSb290XSgpOwogIGxldCB0YXJnZXQgPSBudWxsOwogIGlmIChub2RlLnRhcmdldCkgewogICAgdGFyZ2V0ID0gcm9vdFtfc3ltYm9sX3V0aWxzLiRzZWFyY2hOb2RlXShub2RlLnRhcmdldCwgbm9kZVtfc3ltYm9sX3V0aWxzLiRnZXRQYXJlbnRdKCkpOwogICAgaWYgKCF0YXJnZXQpIHsKICAgICAgcmV0dXJuIGZhbHNlOwogICAgfQogICAgdGFyZ2V0ID0gdGFyZ2V0WzBdOwogIH0KICBjb25zdCB7CiAgICBjdXJyZW50UGFnZUFyZWEsCiAgICBjdXJyZW50Q29udGVudEFyZWEKICB9ID0gcm9vdFtfc3ltYm9sX3V0aWxzLiRleHRyYV07CiAgaWYgKG5vZGUudGFyZ2V0VHlwZSA9PT0gInBhZ2VBcmVhIikgewogICAgaWYgKCEodGFyZ2V0IGluc3RhbmNlb2YgUGFnZUFyZWEpKSB7CiAgICAgIHRhcmdldCA9IG51bGw7CiAgICB9CiAgICBpZiAobm9kZS5zdGFydE5ldykgewogICAgICBub2RlW19zeW1ib2xfdXRpbHMuJGV4dHJhXS50YXJnZXQgPSB0YXJnZXQgfHwgY3VycmVudFBhZ2VBcmVhOwogICAgICByZXR1cm4gdHJ1ZTsKICAgIH0gZWxzZSBpZiAodGFyZ2V0ICYmIHRhcmdldCAhPT0gY3VycmVudFBhZ2VBcmVhKSB7CiAgICAgIG5vZGVbX3N5bWJvbF91dGlscy4kZXh0cmFdLnRhcmdldCA9IHRhcmdldDsKICAgICAgcmV0dXJuIHRydWU7CiAgICB9CiAgICByZXR1cm4gZmFsc2U7CiAgfQogIGlmICghKHRhcmdldCBpbnN0YW5jZW9mIENvbnRlbnRBcmVhKSkgewogICAgdGFyZ2V0ID0gbnVsbDsKICB9CiAgY29uc3QgcGFnZUFyZWEgPSB0YXJnZXQgJiYgdGFyZ2V0W19zeW1ib2xfdXRpbHMuJGdldFBhcmVudF0oKTsKICBsZXQgaW5kZXg7CiAgbGV0IG5leHRQYWdlQXJlYSA9IHBhZ2VBcmVhOwogIGlmIChub2RlLnN0YXJ0TmV3KSB7CiAgICBpZiAodGFyZ2V0KSB7CiAgICAgIGNvbnN0IGNvbnRlbnRBcmVhcyA9IHBhZ2VBcmVhLmNvbnRlbnRBcmVhLmNoaWxkcmVuOwogICAgICBjb25zdCBpbmRleEZvckN1cnJlbnQgPSBjb250ZW50QXJlYXMuaW5kZXhPZihjdXJyZW50Q29udGVudEFyZWEpOwogICAgICBjb25zdCBpbmRleEZvclRhcmdldCA9IGNvbnRlbnRBcmVhcy5pbmRleE9mKHRhcmdldCk7CiAgICAgIGlmIChpbmRleEZvckN1cnJlbnQgIT09IC0xICYmIGluZGV4Rm9yQ3VycmVudCA8IGluZGV4Rm9yVGFyZ2V0KSB7CiAgICAgICAgbmV4dFBhZ2VBcmVhID0gbnVsbDsKICAgICAgfQogICAgICBpbmRleCA9IGluZGV4Rm9yVGFyZ2V0IC0gMTsKICAgIH0gZWxzZSB7CiAgICAgIGluZGV4ID0gY3VycmVudFBhZ2VBcmVhLmNvbnRlbnRBcmVhLmNoaWxkcmVuLmluZGV4T2YoY3VycmVudENvbnRlbnRBcmVhKTsKICAgIH0KICB9IGVsc2UgaWYgKHRhcmdldCAmJiB0YXJnZXQgIT09IGN1cnJlbnRDb250ZW50QXJlYSkgewogICAgY29uc3QgY29udGVudEFyZWFzID0gcGFnZUFyZWEuY29udGVudEFyZWEuY2hpbGRyZW47CiAgICBpbmRleCA9IGNvbnRlbnRBcmVhcy5pbmRleE9mKHRhcmdldCkgLSAxOwogICAgbmV4dFBhZ2VBcmVhID0gcGFnZUFyZWEgPT09IGN1cnJlbnRQYWdlQXJlYSA/IG51bGwgOiBwYWdlQXJlYTsKICB9IGVsc2UgewogICAgcmV0dXJuIGZhbHNlOwogIH0KICBub2RlW19zeW1ib2xfdXRpbHMuJGV4dHJhXS50YXJnZXQgPSBuZXh0UGFnZUFyZWE7CiAgbm9kZVtfc3ltYm9sX3V0aWxzLiRleHRyYV0uaW5kZXggPSBpbmRleDsKICByZXR1cm4gdHJ1ZTsKfQpmdW5jdGlvbiBoYW5kbGVPdmVyZmxvdyhub2RlLCBleHRyYU5vZGUsIHNwYWNlKSB7CiAgY29uc3Qgcm9vdCA9IG5vZGVbX3N5bWJvbF91dGlscy4kZ2V0VGVtcGxhdGVSb290XSgpOwogIGNvbnN0IHNhdmVkID0gcm9vdFtfc3ltYm9sX3V0aWxzLiRleHRyYV0ubm9MYXlvdXRGYWlsdXJlOwogIGNvbnN0IHNhdmVkTWV0aG9kID0gZXh0cmFOb2RlW19zeW1ib2xfdXRpbHMuJGdldFN1YmZvcm1QYXJlbnRdOwogIGV4dHJhTm9kZVtfc3ltYm9sX3V0aWxzLiRnZXRTdWJmb3JtUGFyZW50XSA9ICgpID0+IG5vZGU7CiAgcm9vdFtfc3ltYm9sX3V0aWxzLiRleHRyYV0ubm9MYXlvdXRGYWlsdXJlID0gdHJ1ZTsKICBjb25zdCByZXMgPSBleHRyYU5vZGVbX3N5bWJvbF91dGlscy4kdG9IVE1MXShzcGFjZSk7CiAgbm9kZVtfc3ltYm9sX3V0aWxzLiRhZGRIVE1MXShyZXMuaHRtbCwgcmVzLmJib3gpOwogIHJvb3RbX3N5bWJvbF91dGlscy4kZXh0cmFdLm5vTGF5b3V0RmFpbHVyZSA9IHNhdmVkOwogIGV4dHJhTm9kZVtfc3ltYm9sX3V0aWxzLiRnZXRTdWJmb3JtUGFyZW50XSA9IHNhdmVkTWV0aG9kOwp9CmNsYXNzIEFwcGVhcmFuY2VGaWx0ZXIgZXh0ZW5kcyBfeGZhX29iamVjdC5TdHJpbmdPYmplY3QgewogIGNvbnN0cnVjdG9yKGF0dHJpYnV0ZXMpIHsKICAgIHN1cGVyKFRFTVBMQVRFX05TX0lELCAiYXBwZWFyYW5jZUZpbHRlciIpOwogICAgdGhpcy5pZCA9IGF0dHJpYnV0ZXMuaWQgfHwgIiI7CiAgICB0aGlzLnR5cGUgPSAoMCwgX3V0aWxzLmdldFN0cmluZ09wdGlvbikoYXR0cmlidXRlcy50eXBlLCBbIm9wdGlvbmFsIiwgInJlcXVpcmVkIl0pOwogICAgdGhpcy51c2UgPSBhdHRyaWJ1dGVzLnVzZSB8fCAiIjsKICAgIHRoaXMudXNlaHJlZiA9IGF0dHJpYnV0ZXMudXNlaHJlZiB8fCAiIjsKICB9Cn0KY2xhc3MgQXJjIGV4dGVuZHMgX3hmYV9vYmplY3QuWEZBT2JqZWN0IHsKICBjb25zdHJ1Y3RvcihhdHRyaWJ1dGVzKSB7CiAgICBzdXBlcihURU1QTEFURV9OU19JRCwgImFyYyIsIHRydWUpOwogICAgdGhpcy5jaXJjdWxhciA9ICgwLCBfdXRpbHMuZ2V0SW50ZWdlcikoewogICAgICBkYXRhOiBhdHRyaWJ1dGVzLmNpcmN1bGFyLAogICAgICBkZWZhdWx0VmFsdWU6IDAsCiAgICAgIHZhbGlkYXRlOiB4ID0+IHggPT09IDEKICAgIH0pOwogICAgdGhpcy5oYW5kID0gKDAsIF91dGlscy5nZXRTdHJpbmdPcHRpb24pKGF0dHJpYnV0ZXMuaGFuZCwgWyJldmVuIiwgImxlZnQiLCAicmlnaHQiXSk7CiAgICB0aGlzLmlkID0gYXR0cmlidXRlcy5pZCB8fCAiIjsKICAgIHRoaXMuc3RhcnRBbmdsZSA9ICgwLCBfdXRpbHMuZ2V0RmxvYXQpKHsKICAgICAgZGF0YTogYXR0cmlidXRlcy5zdGFydEFuZ2xlLAogICAgICBkZWZhdWx0VmFsdWU6IDAsCiAgICAgIHZhbGlkYXRlOiB4ID0+IHRydWUKICAgIH0pOwogICAgdGhpcy5zd2VlcEFuZ2xlID0gKDAsIF91dGlscy5nZXRGbG9hdCkoewogICAgICBkYXRhOiBhdHRyaWJ1dGVzLnN3ZWVwQW5nbGUsCiAgICAgIGRlZmF1bHRWYWx1ZTogMzYwLAogICAgICB2YWxpZGF0ZTogeCA9PiB0cnVlCiAgICB9KTsKICAgIHRoaXMudXNlID0gYXR0cmlidXRlcy51c2UgfHwgIiI7CiAgICB0aGlzLnVzZWhyZWYgPSBhdHRyaWJ1dGVzLnVzZWhyZWYgfHwgIiI7CiAgICB0aGlzLmVkZ2UgPSBudWxsOwogICAgdGhpcy5maWxsID0gbnVsbDsKICB9CiAgW19zeW1ib2xfdXRpbHMuJHRvSFRNTF0oKSB7CiAgICBjb25zdCBlZGdlID0gdGhpcy5lZGdlIHx8IG5ldyBFZGdlKHt9KTsKICAgIGNvbnN0IGVkZ2VTdHlsZSA9IGVkZ2VbX3N5bWJvbF91dGlscy4kdG9TdHlsZV0oKTsKICAgIGNvbnN0IHN0eWxlID0gT2JqZWN0LmNyZWF0ZShudWxsKTsKICAgIGlmICh0aGlzLmZpbGw/LnByZXNlbmNlID09PSAidmlzaWJsZSIpIHsKICAgICAgT2JqZWN0LmFzc2lnbihzdHlsZSwgdGhpcy5maWxsW19zeW1ib2xfdXRpbHMuJHRvU3R5bGVdKCkpOwogICAgfSBlbHNlIHsKICAgICAgc3R5bGUuZmlsbCA9ICJ0cmFuc3BhcmVudCI7CiAgICB9CiAgICBzdHlsZS5zdHJva2VXaWR0aCA9ICgwLCBfaHRtbF91dGlscy5tZWFzdXJlVG9TdHJpbmcpKGVkZ2UucHJlc2VuY2UgPT09ICJ2aXNpYmxlIiA/IGVkZ2UudGhpY2tuZXNzIDogMCk7CiAgICBzdHlsZS5zdHJva2UgPSBlZGdlU3R5bGUuY29sb3I7CiAgICBsZXQgYXJjOwogICAgY29uc3QgYXR0cmlidXRlcyA9IHsKICAgICAgeG1sbnM6IFNWR19OUywKICAgICAgc3R5bGU6IHsKICAgICAgICB3aWR0aDogIjEwMCUiLAogICAgICAgIGhlaWdodDogIjEwMCUiLAogICAgICAgIG92ZXJmbG93OiAidmlzaWJsZSIKICAgICAgfQogICAgfTsKICAgIGlmICh0aGlzLnN3ZWVwQW5nbGUgPT09IDM2MCkgewogICAgICBhcmMgPSB7CiAgICAgICAgbmFtZTogImVsbGlwc2UiLAogICAgICAgIGF0dHJpYnV0ZXM6IHsKICAgICAgICAgIHhtbG5zOiBTVkdfTlMsCiAgICAgICAgICBjeDogIjUwJSIsCiAgICAgICAgICBjeTogIjUwJSIsCiAgICAgICAgICByeDogIjUwJSIsCiAgICAgICAgICByeTogIjUwJSIsCiAgICAgICAgICBzdHlsZQogICAgICAgIH0KICAgICAgfTsKICAgIH0gZWxzZSB7CiAgICAgIGNvbnN0IHN0YXJ0QW5nbGUgPSB0aGlzLnN0YXJ0QW5nbGUgKiBNYXRoLlBJIC8gMTgwOwogICAgICBjb25zdCBzd2VlcEFuZ2xlID0gdGhpcy5zd2VlcEFuZ2xlICogTWF0aC5QSSAvIDE4MDsKICAgICAgY29uc3QgbGFyZ2VBcmMgPSB0aGlzLnN3ZWVwQW5nbGUgPiAxODAgPyAxIDogMDsKICAgICAgY29uc3QgW3gxLCB5MSwgeDIsIHkyXSA9IFs1MCAqICgxICsgTWF0aC5jb3Moc3RhcnRBbmdsZSkpLCA1MCAqICgxIC0gTWF0aC5zaW4oc3RhcnRBbmdsZSkpLCA1MCAqICgxICsgTWF0aC5jb3Moc3RhcnRBbmdsZSArIHN3ZWVwQW5nbGUpKSwgNTAgKiAoMSAtIE1hdGguc2luKHN0YXJ0QW5nbGUgKyBzd2VlcEFuZ2xlKSldOwogICAgICBhcmMgPSB7CiAgICAgICAgbmFtZTogInBhdGgiLAogICAgICAgIGF0dHJpYnV0ZXM6IHsKICAgICAgICAgIHhtbG5zOiBTVkdfTlMsCiAgICAgICAgICBkOiBgTSAke3gxfSAke3kxfSBBIDUwIDUwIDAgJHtsYXJnZUFyY30gMCAke3gyfSAke3kyfWAsCiAgICAgICAgICB2ZWN0b3JFZmZlY3Q6ICJub24tc2NhbGluZy1zdHJva2UiLAogICAgICAgICAgc3R5bGUKICAgICAgICB9CiAgICAgIH07CiAgICAgIE9iamVjdC5hc3NpZ24oYXR0cmlidXRlcywgewogICAgICAgIHZpZXdCb3g6ICIwIDAgMTAwIDEwMCIsCiAgICAgICAgcHJlc2VydmVBc3BlY3RSYXRpbzogIm5vbmUiCiAgICAgIH0pOwogICAgfQogICAgY29uc3Qgc3ZnID0gewogICAgICBuYW1lOiAic3ZnIiwKICAgICAgY2hpbGRyZW46IFthcmNdLAogICAgICBhdHRyaWJ1dGVzCiAgICB9OwogICAgY29uc3QgcGFyZW50ID0gdGhpc1tfc3ltYm9sX3V0aWxzLiRnZXRQYXJlbnRdKClbX3N5bWJvbF91dGlscy4kZ2V0UGFyZW50XSgpOwogICAgaWYgKGhhc01hcmdpbihwYXJlbnQpKSB7CiAgICAgIHJldHVybiBfdXRpbHMuSFRNTFJlc3VsdC5zdWNjZXNzKHsKICAgICAgICBuYW1lOiAiZGl2IiwKICAgICAgICBhdHRyaWJ1dGVzOiB7CiAgICAgICAgICBzdHlsZTogewogICAgICAgICAgICBkaXNwbGF5OiAiaW5saW5lIiwKICAgICAgICAgICAgd2lkdGg6ICIxMDAlIiwKICAgICAgICAgICAgaGVpZ2h0OiAiMTAwJSIKICAgICAgICAgIH0KICAgICAgICB9LAogICAgICAgIGNoaWxkcmVuOiBbc3ZnXQogICAgICB9KTsKICAgIH0KICAgIHN2Zy5hdHRyaWJ1dGVzLnN0eWxlLnBvc2l0aW9uID0gImFic29sdXRlIjsKICAgIHJldHVybiBfdXRpbHMuSFRNTFJlc3VsdC5zdWNjZXNzKHN2Zyk7CiAgfQp9CmNsYXNzIEFyZWEgZXh0ZW5kcyBfeGZhX29iamVjdC5YRkFPYmplY3QgewogIGNvbnN0cnVjdG9yKGF0dHJpYnV0ZXMpIHsKICAgIHN1cGVyKFRFTVBMQVRFX05TX0lELCAiYXJlYSIsIHRydWUpOwogICAgdGhpcy5jb2xTcGFuID0gKDAsIF91dGlscy5nZXRJbnRlZ2VyKSh7CiAgICAgIGRhdGE6IGF0dHJpYnV0ZXMuY29sU3BhbiwKICAgICAgZGVmYXVsdFZhbHVlOiAxLAogICAgICB2YWxpZGF0ZTogbiA9PiBuID49IDEgfHwgbiA9PT0gLTEKICAgIH0pOwogICAgdGhpcy5pZCA9IGF0dHJpYnV0ZXMuaWQgfHwgIiI7CiAgICB0aGlzLm5hbWUgPSBhdHRyaWJ1dGVzLm5hbWUgfHwgIiI7CiAgICB0aGlzLnJlbGV2YW50ID0gKDAsIF91dGlscy5nZXRSZWxldmFudCkoYXR0cmlidXRlcy5yZWxldmFudCk7CiAgICB0aGlzLnVzZSA9IGF0dHJpYnV0ZXMudXNlIHx8ICIiOwogICAgdGhpcy51c2VocmVmID0gYXR0cmlidXRlcy51c2VocmVmIHx8ICIiOwogICAgdGhpcy54ID0gKDAsIF91dGlscy5nZXRNZWFzdXJlbWVudCkoYXR0cmlidXRlcy54LCAiMHB0Iik7CiAgICB0aGlzLnkgPSAoMCwgX3V0aWxzLmdldE1lYXN1cmVtZW50KShhdHRyaWJ1dGVzLnksICIwcHQiKTsKICAgIHRoaXMuZGVzYyA9IG51bGw7CiAgICB0aGlzLmV4dHJhcyA9IG51bGw7CiAgICB0aGlzLmFyZWEgPSBuZXcgX3hmYV9vYmplY3QuWEZBT2JqZWN0QXJyYXkoKTsKICAgIHRoaXMuZHJhdyA9IG5ldyBfeGZhX29iamVjdC5YRkFPYmplY3RBcnJheSgpOwogICAgdGhpcy5leE9iamVjdCA9IG5ldyBfeGZhX29iamVjdC5YRkFPYmplY3RBcnJheSgpOwogICAgdGhpcy5leGNsR3JvdXAgPSBuZXcgX3hmYV9vYmplY3QuWEZBT2JqZWN0QXJyYXkoKTsKICAgIHRoaXMuZmllbGQgPSBuZXcgX3hmYV9vYmplY3QuWEZBT2JqZWN0QXJyYXkoKTsKICAgIHRoaXMuc3ViZm9ybSA9IG5ldyBfeGZhX29iamVjdC5YRkFPYmplY3RBcnJheSgpOwogICAgdGhpcy5zdWJmb3JtU2V0ID0gbmV3IF94ZmFfb2JqZWN0LlhGQU9iamVjdEFycmF5KCk7CiAgfQogICpbX3N5bWJvbF91dGlscy4kZ2V0Q29udGFpbmVkQ2hpbGRyZW5dKCkgewogICAgeWllbGQqIGdldENvbnRhaW5lZENoaWxkcmVuKHRoaXMpOwogIH0KICBbX3N5bWJvbF91dGlscy4kaXNUcmFuc3BhcmVudF0oKSB7CiAgICByZXR1cm4gdHJ1ZTsKICB9CiAgW19zeW1ib2xfdXRpbHMuJGlzQmluZGFibGVdKCkgewogICAgcmV0dXJuIHRydWU7CiAgfQogIFtfc3ltYm9sX3V0aWxzLiRhZGRIVE1MXShodG1sLCBiYm94KSB7CiAgICBjb25zdCBbeCwgeSwgdywgaF0gPSBiYm94OwogICAgdGhpc1tfc3ltYm9sX3V0aWxzLiRleHRyYV0ud2lkdGggPSBNYXRoLm1heCh0aGlzW19zeW1ib2xfdXRpbHMuJGV4dHJhXS53aWR0aCwgeCArIHcpOwogICAgdGhpc1tfc3ltYm9sX3V0aWxzLiRleHRyYV0uaGVpZ2h0ID0gTWF0aC5tYXgodGhpc1tfc3ltYm9sX3V0aWxzLiRleHRyYV0uaGVpZ2h0LCB5ICsgaCk7CiAgICB0aGlzW19zeW1ib2xfdXRpbHMuJGV4dHJhXS5jaGlsZHJlbi5wdXNoKGh0bWwpOwogIH0KICBbX3N5bWJvbF91dGlscy4kZ2V0QXZhaWxhYmxlU3BhY2VdKCkgewogICAgcmV0dXJuIHRoaXNbX3N5bWJvbF91dGlscy4kZXh0cmFdLmF2YWlsYWJsZVNwYWNlOwogIH0KICBbX3N5bWJvbF91dGlscy4kdG9IVE1MXShhdmFpbGFibGVTcGFjZSkgewogICAgY29uc3Qgc3R5bGUgPSAoMCwgX2h0bWxfdXRpbHMudG9TdHlsZSkodGhpcywgInBvc2l0aW9uIik7CiAgICBjb25zdCBhdHRyaWJ1dGVzID0gewogICAgICBzdHlsZSwKICAgICAgaWQ6IHRoaXNbX3N5bWJvbF91dGlscy4kdWlkXSwKICAgICAgY2xhc3M6IFsieGZhQXJlYSJdCiAgICB9OwogICAgaWYgKCgwLCBfaHRtbF91dGlscy5pc1ByaW50T25seSkodGhpcykpIHsKICAgICAgYXR0cmlidXRlcy5jbGFzcy5wdXNoKCJ4ZmFQcmludE9ubHkiKTsKICAgIH0KICAgIGlmICh0aGlzLm5hbWUpIHsKICAgICAgYXR0cmlidXRlcy54ZmFOYW1lID0gdGhpcy5uYW1lOwogICAgfQogICAgY29uc3QgY2hpbGRyZW4gPSBbXTsKICAgIHRoaXNbX3N5bWJvbF91dGlscy4kZXh0cmFdID0gewogICAgICBjaGlsZHJlbiwKICAgICAgd2lkdGg6IDAsCiAgICAgIGhlaWdodDogMCwKICAgICAgYXZhaWxhYmxlU3BhY2UKICAgIH07CiAgICBjb25zdCByZXN1bHQgPSB0aGlzW19zeW1ib2xfdXRpbHMuJGNoaWxkcmVuVG9IVE1MXSh7CiAgICAgIGZpbHRlcjogbmV3IFNldChbImFyZWEiLCAiZHJhdyIsICJmaWVsZCIsICJleGNsR3JvdXAiLCAic3ViZm9ybSIsICJzdWJmb3JtU2V0Il0pLAogICAgICBpbmNsdWRlOiB0cnVlCiAgICB9KTsKICAgIGlmICghcmVzdWx0LnN1Y2Nlc3MpIHsKICAgICAgaWYgKHJlc3VsdC5pc0JyZWFrKCkpIHsKICAgICAgICByZXR1cm4gcmVzdWx0OwogICAgICB9CiAgICAgIGRlbGV0ZSB0aGlzW19zeW1ib2xfdXRpbHMuJGV4dHJhXTsKICAgICAgcmV0dXJuIF91dGlscy5IVE1MUmVzdWx0LkZBSUxVUkU7CiAgICB9CiAgICBzdHlsZS53aWR0aCA9ICgwLCBfaHRtbF91dGlscy5tZWFzdXJlVG9TdHJpbmcpKHRoaXNbX3N5bWJvbF91dGlscy4kZXh0cmFdLndpZHRoKTsKICAgIHN0eWxlLmhlaWdodCA9ICgwLCBfaHRtbF91dGlscy5tZWFzdXJlVG9TdHJpbmcpKHRoaXNbX3N5bWJvbF91dGlscy4kZXh0cmFdLmhlaWdodCk7CiAgICBjb25zdCBodG1sID0gewogICAgICBuYW1lOiAiZGl2IiwKICAgICAgYXR0cmlidXRlcywKICAgICAgY2hpbGRyZW4KICAgIH07CiAgICBjb25zdCBiYm94ID0gW3RoaXMueCwgdGhpcy55LCB0aGlzW19zeW1ib2xfdXRpbHMuJGV4dHJhXS53aWR0aCwgdGhpc1tfc3ltYm9sX3V0aWxzLiRleHRyYV0uaGVpZ2h0XTsKICAgIGRlbGV0ZSB0aGlzW19zeW1ib2xfdXRpbHMuJGV4dHJhXTsKICAgIHJldHVybiBfdXRpbHMuSFRNTFJlc3VsdC5zdWNjZXNzKGh0bWwsIGJib3gpOwogIH0KfQpjbGFzcyBBc3Npc3QgZXh0ZW5kcyBfeGZhX29iamVjdC5YRkFPYmplY3QgewogIGNvbnN0cnVjdG9yKGF0dHJpYnV0ZXMpIHsKICAgIHN1cGVyKFRFTVBMQVRFX05TX0lELCAiYXNzaXN0IiwgdHJ1ZSk7CiAgICB0aGlzLmlkID0gYXR0cmlidXRlcy5pZCB8fCAiIjsKICAgIHRoaXMucm9sZSA9IGF0dHJpYnV0ZXMucm9sZSB8fCAiIjsKICAgIHRoaXMudXNlID0gYXR0cmlidXRlcy51c2UgfHwgIiI7CiAgICB0aGlzLnVzZWhyZWYgPSBhdHRyaWJ1dGVzLnVzZWhyZWYgfHwgIiI7CiAgICB0aGlzLnNwZWFrID0gbnVsbDsKICAgIHRoaXMudG9vbFRpcCA9IG51bGw7CiAgfQogIFtfc3ltYm9sX3V0aWxzLiR0b0hUTUxdKCkgewogICAgcmV0dXJuIHRoaXMudG9vbFRpcD8uW19zeW1ib2xfdXRpbHMuJGNvbnRlbnRdIHx8IG51bGw7CiAgfQp9CmNsYXNzIEJhcmNvZGUgZXh0ZW5kcyBfeGZhX29iamVjdC5YRkFPYmplY3QgewogIGNvbnN0cnVjdG9yKGF0dHJpYnV0ZXMpIHsKICAgIHN1cGVyKFRFTVBMQVRFX05TX0lELCAiYmFyY29kZSIsIHRydWUpOwogICAgdGhpcy5jaGFyRW5jb2RpbmcgPSAoMCwgX3V0aWxzLmdldEtleXdvcmQpKHsKICAgICAgZGF0YTogYXR0cmlidXRlcy5jaGFyRW5jb2RpbmcgPyBhdHRyaWJ1dGVzLmNoYXJFbmNvZGluZy50b0xvd2VyQ2FzZSgpIDogIiIsCiAgICAgIGRlZmF1bHRWYWx1ZTogIiIsCiAgICAgIHZhbGlkYXRlOiBrID0+IFsidXRmLTgiLCAiYmlnLWZpdmUiLCAiZm9udHNwZWNpZmljIiwgImdiayIsICJnYi0xODAzMCIsICJnYi0yMzEyIiwgImtzYy01NjAxIiwgIm5vbmUiLCAic2hpZnQtamlzIiwgInVjcy0yIiwgInV0Zi0xNiJdLmluY2x1ZGVzKGspIHx8IGsubWF0Y2goL2lzby04ODU5LVxkezJ9LykKICAgIH0pOwogICAgdGhpcy5jaGVja3N1bSA9ICgwLCBfdXRpbHMuZ2V0U3RyaW5nT3B0aW9uKShhdHRyaWJ1dGVzLmNoZWNrc3VtLCBbIm5vbmUiLCAiMW1vZDEwIiwgIjFtb2QxMF8xbW9kMTEiLCAiMm1vZDEwIiwgImF1dG8iXSk7CiAgICB0aGlzLmRhdGFDb2x1bW5Db3VudCA9ICgwLCBfdXRpbHMuZ2V0SW50ZWdlcikoewogICAgICBkYXRhOiBhdHRyaWJ1dGVzLmRhdGFDb2x1bW5Db3VudCwKICAgICAgZGVmYXVsdFZhbHVlOiAtMSwKICAgICAgdmFsaWRhdGU6IHggPT4geCA+PSAwCiAgICB9KTsKICAgIHRoaXMuZGF0YUxlbmd0aCA9ICgwLCBfdXRpbHMuZ2V0SW50ZWdlcikoewogICAgICBkYXRhOiBhdHRyaWJ1dGVzLmRhdGFMZW5ndGgsCiAgICAgIGRlZmF1bHRWYWx1ZTogLTEsCiAgICAgIHZhbGlkYXRlOiB4ID0+IHggPj0gMAogICAgfSk7CiAgICB0aGlzLmRhdGFQcmVwID0gKDAsIF91dGlscy5nZXRTdHJpbmdPcHRpb24pKGF0dHJpYnV0ZXMuZGF0YVByZXAsIFsibm9uZSIsICJmbGF0ZUNvbXByZXNzIl0pOwogICAgdGhpcy5kYXRhUm93Q291bnQgPSAoMCwgX3V0aWxzLmdldEludGVnZXIpKHsKICAgICAgZGF0YTogYXR0cmlidXRlcy5kYXRhUm93Q291bnQsCiAgICAgIGRlZmF1bHRWYWx1ZTogLTEsCiAgICAgIHZhbGlkYXRlOiB4ID0+IHggPj0gMAogICAgfSk7CiAgICB0aGlzLmVuZENoYXIgPSBhdHRyaWJ1dGVzLmVuZENoYXIgfHwgIiI7CiAgICB0aGlzLmVycm9yQ29ycmVjdGlvbkxldmVsID0gKDAsIF91dGlscy5nZXRJbnRlZ2VyKSh7CiAgICAgIGRhdGE6IGF0dHJpYnV0ZXMuZXJyb3JDb3JyZWN0aW9uTGV2ZWwsCiAgICAgIGRlZmF1bHRWYWx1ZTogLTEsCiAgICAgIHZhbGlkYXRlOiB4ID0+IHggPj0gMCAmJiB4IDw9IDgKICAgIH0pOwogICAgdGhpcy5pZCA9IGF0dHJpYnV0ZXMuaWQgfHwgIiI7CiAgICB0aGlzLm1vZHVsZUhlaWdodCA9ICgwLCBfdXRpbHMuZ2V0TWVhc3VyZW1lbnQpKGF0dHJpYnV0ZXMubW9kdWxlSGVpZ2h0LCAiNW1tIik7CiAgICB0aGlzLm1vZHVsZVdpZHRoID0gKDAsIF91dGlscy5nZXRNZWFzdXJlbWVudCkoYXR0cmlidXRlcy5tb2R1bGVXaWR0aCwgIjAuMjVtbSIpOwogICAgdGhpcy5wcmludENoZWNrRGlnaXQgPSAoMCwgX3V0aWxzLmdldEludGVnZXIpKHsKICAgICAgZGF0YTogYXR0cmlidXRlcy5wcmludENoZWNrRGlnaXQsCiAgICAgIGRlZmF1bHRWYWx1ZTogMCwKICAgICAgdmFsaWRhdGU6IHggPT4geCA9PT0gMQogICAgfSk7CiAgICB0aGlzLnJvd0NvbHVtblJhdGlvID0gKDAsIF91dGlscy5nZXRSYXRpbykoYXR0cmlidXRlcy5yb3dDb2x1bW5SYXRpbyk7CiAgICB0aGlzLnN0YXJ0Q2hhciA9IGF0dHJpYnV0ZXMuc3RhcnRDaGFyIHx8ICIiOwogICAgdGhpcy50ZXh0TG9jYXRpb24gPSAoMCwgX3V0aWxzLmdldFN0cmluZ09wdGlvbikoYXR0cmlidXRlcy50ZXh0TG9jYXRpb24sIFsiYmVsb3ciLCAiYWJvdmUiLCAiYWJvdmVFbWJlZGRlZCIsICJiZWxvd0VtYmVkZGVkIiwgIm5vbmUiXSk7CiAgICB0aGlzLnRydW5jYXRlID0gKDAsIF91dGlscy5nZXRJbnRlZ2VyKSh7CiAgICAgIGRhdGE6IGF0dHJpYnV0ZXMudHJ1bmNhdGUsCiAgICAgIGRlZmF1bHRWYWx1ZTogMCwKICAgICAgdmFsaWRhdGU6IHggPT4geCA9PT0gMQogICAgfSk7CiAgICB0aGlzLnR5cGUgPSAoMCwgX3V0aWxzLmdldFN0cmluZ09wdGlvbikoYXR0cmlidXRlcy50eXBlID8gYXR0cmlidXRlcy50eXBlLnRvTG93ZXJDYXNlKCkgOiAiIiwgWyJhenRlYyIsICJjb2RhYmFyIiwgImNvZGUyb2Y1aW5kdXN0cmlhbCIsICJjb2RlMm9mNWludGVybGVhdmVkIiwgImNvZGUyb2Y1bWF0cml4IiwgImNvZGUyb2Y1c3RhbmRhcmQiLCAiY29kZTNvZjkiLCAiY29kZTNvZjlleHRlbmRlZCIsICJjb2RlMTEiLCAiY29kZTQ5IiwgImNvZGU5MyIsICJjb2RlMTI4IiwgImNvZGUxMjhhIiwgImNvZGUxMjhiIiwgImNvZGUxMjhjIiwgImNvZGUxMjhzc2NjIiwgImRhdGFtYXRyaXgiLCAiZWFuOCIsICJlYW44YWRkMiIsICJlYW44YWRkNSIsICJlYW4xMyIsICJlYW4xM2FkZDIiLCAiZWFuMTNhZGQ1IiwgImVhbjEzcHdjZCIsICJmaW0iLCAibG9nbWFycyIsICJtYXhpY29kZSIsICJtc2kiLCAicGRmNDE3IiwgInBkZjQxN21hY3JvIiwgInBsZXNzZXkiLCAicG9zdGF1c2N1c3QyIiwgInBvc3RhdXNjdXN0MyIsICJwb3N0YXVzcmVwbHlwYWlkIiwgInBvc3RhdXNzdGFuZGFyZCIsICJwb3N0dWtybTRzY2MiLCAicG9zdHVzZHBiYyIsICJwb3N0dXNpbWIiLCAicG9zdHVzc3RhbmRhcmQiLCAicG9zdHVzNXppcCIsICJxcmNvZGUiLCAicmZpZCIsICJyc3MxNCIsICJyc3MxNGV4cGFuZGVkIiwgInJzczE0bGltaXRlZCIsICJyc3MxNHN0YWNrZWQiLCAicnNzMTRzdGFja2Vkb21uaSIsICJyc3MxNHRydW5jYXRlZCIsICJ0ZWxlcGVuIiwgInVjYzEyOCIsICJ1Y2MxMjhyYW5kb20iLCAidWNjMTI4c3NjYyIsICJ1cGNhIiwgInVwY2FhZGQyIiwgInVwY2FhZGQ1IiwgInVwY2Fwd2NkIiwgInVwY2UiLCAidXBjZWFkZDIiLCAidXBjZWFkZDUiLCAidXBjZWFuMiIsICJ1cGNlYW41IiwgInVwc21heGljb2RlIl0pOwogICAgdGhpcy51cHNNb2RlID0gKDAsIF91dGlscy5nZXRTdHJpbmdPcHRpb24pKGF0dHJpYnV0ZXMudXBzTW9kZSwgWyJ1c0NhcnJpZXIiLCAiaW50ZXJuYXRpb25hbENhcnJpZXIiLCAic2VjdXJlU3ltYm9sIiwgInN0YW5kYXJkU3ltYm9sIl0pOwogICAgdGhpcy51c2UgPSBhdHRyaWJ1dGVzLnVzZSB8fCAiIjsKICAgIHRoaXMudXNlaHJlZiA9IGF0dHJpYnV0ZXMudXNlaHJlZiB8fCAiIjsKICAgIHRoaXMud2lkZU5hcnJvd1JhdGlvID0gKDAsIF91dGlscy5nZXRSYXRpbykoYXR0cmlidXRlcy53aWRlTmFycm93UmF0aW8pOwogICAgdGhpcy5lbmNyeXB0ID0gbnVsbDsKICAgIHRoaXMuZXh0cmFzID0gbnVsbDsKICB9Cn0KY2xhc3MgQmluZCBleHRlbmRzIF94ZmFfb2JqZWN0LlhGQU9iamVjdCB7CiAgY29uc3RydWN0b3IoYXR0cmlidXRlcykgewogICAgc3VwZXIoVEVNUExBVEVfTlNfSUQsICJiaW5kIiwgdHJ1ZSk7CiAgICB0aGlzLm1hdGNoID0gKDAsIF91dGlscy5nZXRTdHJpbmdPcHRpb24pKGF0dHJpYnV0ZXMubWF0Y2gsIFsib25jZSIsICJkYXRhUmVmIiwgImdsb2JhbCIsICJub25lIl0pOwogICAgdGhpcy5yZWYgPSBhdHRyaWJ1dGVzLnJlZiB8fCAiIjsKICAgIHRoaXMucGljdHVyZSA9IG51bGw7CiAgfQp9CmNsYXNzIEJpbmRJdGVtcyBleHRlbmRzIF94ZmFfb2JqZWN0LlhGQU9iamVjdCB7CiAgY29uc3RydWN0b3IoYXR0cmlidXRlcykgewogICAgc3VwZXIoVEVNUExBVEVfTlNfSUQsICJiaW5kSXRlbXMiKTsKICAgIHRoaXMuY29ubmVjdGlvbiA9IGF0dHJpYnV0ZXMuY29ubmVjdGlvbiB8fCAiIjsKICAgIHRoaXMubGFiZWxSZWYgPSBhdHRyaWJ1dGVzLmxhYmVsUmVmIHx8ICIiOwogICAgdGhpcy5yZWYgPSBhdHRyaWJ1dGVzLnJlZiB8fCAiIjsKICAgIHRoaXMudmFsdWVSZWYgPSBhdHRyaWJ1dGVzLnZhbHVlUmVmIHx8ICIiOwogIH0KfQpleHBvcnRzLkJpbmRJdGVtcyA9IEJpbmRJdGVtczsKY2xhc3MgQm9va2VuZCBleHRlbmRzIF94ZmFfb2JqZWN0LlhGQU9iamVjdCB7CiAgY29uc3RydWN0b3IoYXR0cmlidXRlcykgewogICAgc3VwZXIoVEVNUExBVEVfTlNfSUQsICJib29rZW5kIik7CiAgICB0aGlzLmlkID0gYXR0cmlidXRlcy5pZCB8fCAiIjsKICAgIHRoaXMubGVhZGVyID0gYXR0cmlidXRlcy5sZWFkZXIgfHwgIiI7CiAgICB0aGlzLnRyYWlsZXIgPSBhdHRyaWJ1dGVzLnRyYWlsZXIgfHwgIiI7CiAgICB0aGlzLnVzZSA9IGF0dHJpYnV0ZXMudXNlIHx8ICIiOwogICAgdGhpcy51c2VocmVmID0gYXR0cmlidXRlcy51c2VocmVmIHx8ICIiOwogIH0KfQpjbGFzcyBCb29sZWFuRWxlbWVudCBleHRlbmRzIF94ZmFfb2JqZWN0Lk9wdGlvbjAxIHsKICBjb25zdHJ1Y3RvcihhdHRyaWJ1dGVzKSB7CiAgICBzdXBlcihURU1QTEFURV9OU19JRCwgImJvb2xlYW4iKTsKICAgIHRoaXMuaWQgPSBhdHRyaWJ1dGVzLmlkIHx8ICIiOwogICAgdGhpcy5uYW1lID0gYXR0cmlidXRlcy5uYW1lIHx8ICIiOwogICAgdGhpcy51c2UgPSBhdHRyaWJ1dGVzLnVzZSB8fCAiIjsKICAgIHRoaXMudXNlaHJlZiA9IGF0dHJpYnV0ZXMudXNlaHJlZiB8fCAiIjsKICB9CiAgW19zeW1ib2xfdXRpbHMuJHRvSFRNTF0oYXZhaWxhYmxlU3BhY2UpIHsKICAgIHJldHVybiB2YWx1ZVRvSHRtbCh0aGlzW19zeW1ib2xfdXRpbHMuJGNvbnRlbnRdID09PSAxID8gIjEiIDogIjAiKTsKICB9Cn0KY2xhc3MgQm9yZGVyIGV4dGVuZHMgX3hmYV9vYmplY3QuWEZBT2JqZWN0IHsKICBjb25zdHJ1Y3RvcihhdHRyaWJ1dGVzKSB7CiAgICBzdXBlcihURU1QTEFURV9OU19JRCwgImJvcmRlciIsIHRydWUpOwogICAgdGhpcy5icmVhayA9ICgwLCBfdXRpbHMuZ2V0U3RyaW5nT3B0aW9uKShhdHRyaWJ1dGVzLmJyZWFrLCBbImNsb3NlIiwgIm9wZW4iXSk7CiAgICB0aGlzLmhhbmQgPSAoMCwgX3V0aWxzLmdldFN0cmluZ09wdGlvbikoYXR0cmlidXRlcy5oYW5kLCBbImV2ZW4iLCAibGVmdCIsICJyaWdodCJdKTsKICAgIHRoaXMuaWQgPSBhdHRyaWJ1dGVzLmlkIHx8ICIiOwogICAgdGhpcy5wcmVzZW5jZSA9ICgwLCBfdXRpbHMuZ2V0U3RyaW5nT3B0aW9uKShhdHRyaWJ1dGVzLnByZXNlbmNlLCBbInZpc2libGUiLCAiaGlkZGVuIiwgImluYWN0aXZlIiwgImludmlzaWJsZSJdKTsKICAgIHRoaXMucmVsZXZhbnQgPSAoMCwgX3V0aWxzLmdldFJlbGV2YW50KShhdHRyaWJ1dGVzLnJlbGV2YW50KTsKICAgIHRoaXMudXNlID0gYXR0cmlidXRlcy51c2UgfHwgIiI7CiAgICB0aGlzLnVzZWhyZWYgPSBhdHRyaWJ1dGVzLnVzZWhyZWYgfHwgIiI7CiAgICB0aGlzLmNvcm5lciA9IG5ldyBfeGZhX29iamVjdC5YRkFPYmplY3RBcnJheSg0KTsKICAgIHRoaXMuZWRnZSA9IG5ldyBfeGZhX29iamVjdC5YRkFPYmplY3RBcnJheSg0KTsKICAgIHRoaXMuZXh0cmFzID0gbnVsbDsKICAgIHRoaXMuZmlsbCA9IG51bGw7CiAgICB0aGlzLm1hcmdpbiA9IG51bGw7CiAgfQogIFtfc3ltYm9sX3V0aWxzLiRnZXRFeHRyYV0oKSB7CiAgICBpZiAoIXRoaXNbX3N5bWJvbF91dGlscy4kZXh0cmFdKSB7CiAgICAgIGNvbnN0IGVkZ2VzID0gdGhpcy5lZGdlLmNoaWxkcmVuLnNsaWNlKCk7CiAgICAgIGlmIChlZGdlcy5sZW5ndGggPCA0KSB7CiAgICAgICAgY29uc3QgZGVmYXVsdEVkZ2UgPSBlZGdlcy5hdCgtMSkgfHwgbmV3IEVkZ2Uoe30pOwogICAgICAgIGZvciAobGV0IGkgPSBlZGdlcy5sZW5ndGg7IGkgPCA0OyBpKyspIHsKICAgICAgICAgIGVkZ2VzLnB1c2goZGVmYXVsdEVkZ2UpOwogICAgICAgIH0KICAgICAgfQogICAgICBjb25zdCB3aWR0aHMgPSBlZGdlcy5tYXAoZWRnZSA9PiBlZGdlLnRoaWNrbmVzcyk7CiAgICAgIGNvbnN0IGluc2V0cyA9IFswLCAwLCAwLCAwXTsKICAgICAgaWYgKHRoaXMubWFyZ2luKSB7CiAgICAgICAgaW5zZXRzWzBdID0gdGhpcy5tYXJnaW4udG9wSW5zZXQ7CiAgICAgICAgaW5zZXRzWzFdID0gdGhpcy5tYXJnaW4ucmlnaHRJbnNldDsKICAgICAgICBpbnNldHNbMl0gPSB0aGlzLm1hcmdpbi5ib3R0b21JbnNldDsKICAgICAgICBpbnNldHNbM10gPSB0aGlzLm1hcmdpbi5sZWZ0SW5zZXQ7CiAgICAgIH0KICAgICAgdGhpc1tfc3ltYm9sX3V0aWxzLiRleHRyYV0gPSB7CiAgICAgICAgd2lkdGhzLAogICAgICAgIGluc2V0cywKICAgICAgICBlZGdlcwogICAgICB9OwogICAgfQogICAgcmV0dXJuIHRoaXNbX3N5bWJvbF91dGlscy4kZXh0cmFdOwogIH0KICBbX3N5bWJvbF91dGlscy4kdG9TdHlsZV0oKSB7CiAgICBjb25zdCB7CiAgICAgIGVkZ2VzCiAgICB9ID0gdGhpc1tfc3ltYm9sX3V0aWxzLiRnZXRFeHRyYV0oKTsKICAgIGNvbnN0IGVkZ2VTdHlsZXMgPSBlZGdlcy5tYXAobm9kZSA9PiB7CiAgICAgIGNvbnN0IHN0eWxlID0gbm9kZVtfc3ltYm9sX3V0aWxzLiR0b1N0eWxlXSgpOwogICAgICBzdHlsZS5jb2xvciB8fD0gIiMwMDAwMDAiOwogICAgICByZXR1cm4gc3R5bGU7CiAgICB9KTsKICAgIGNvbnN0IHN0eWxlID0gT2JqZWN0LmNyZWF0ZShudWxsKTsKICAgIGlmICh0aGlzLm1hcmdpbikgewogICAgICBPYmplY3QuYXNzaWduKHN0eWxlLCB0aGlzLm1hcmdpbltfc3ltYm9sX3V0aWxzLiR0b1N0eWxlXSgpKTsKICAgIH0KICAgIGlmICh0aGlzLmZpbGw/LnByZXNlbmNlID09PSAidmlzaWJsZSIpIHsKICAgICAgT2JqZWN0LmFzc2lnbihzdHlsZSwgdGhpcy5maWxsW19zeW1ib2xfdXRpbHMuJHRvU3R5bGVdKCkpOwogICAgfQogICAgaWYgKHRoaXMuY29ybmVyLmNoaWxkcmVuLnNvbWUobm9kZSA9PiBub2RlLnJhZGl1cyAhPT0gMCkpIHsKICAgICAgY29uc3QgY29ybmVyU3R5bGVzID0gdGhpcy5jb3JuZXIuY2hpbGRyZW4ubWFwKG5vZGUgPT4gbm9kZVtfc3ltYm9sX3V0aWxzLiR0b1N0eWxlXSgpKTsKICAgICAgaWYgKGNvcm5lclN0eWxlcy5sZW5ndGggPT09IDIgfHwgY29ybmVyU3R5bGVzLmxlbmd0aCA9PT0gMykgewogICAgICAgIGNvbnN0IGxhc3QgPSBjb3JuZXJTdHlsZXMuYXQoLTEpOwogICAgICAgIGZvciAobGV0IGkgPSBjb3JuZXJTdHlsZXMubGVuZ3RoOyBpIDwgNDsgaSsrKSB7CiAgICAgICAgICBjb3JuZXJTdHlsZXMucHVzaChsYXN0KTsKICAgICAgICB9CiAgICAgIH0KICAgICAgc3R5bGUuYm9yZGVyUmFkaXVzID0gY29ybmVyU3R5bGVzLm1hcChzID0+IHMucmFkaXVzKS5qb2luKCIgIik7CiAgICB9CiAgICBzd2l0Y2ggKHRoaXMucHJlc2VuY2UpIHsKICAgICAgY2FzZSAiaW52aXNpYmxlIjoKICAgICAgY2FzZSAiaGlkZGVuIjoKICAgICAgICBzdHlsZS5ib3JkZXJTdHlsZSA9ICIiOwogICAgICAgIGJyZWFrOwogICAgICBjYXNlICJpbmFjdGl2ZSI6CiAgICAgICAgc3R5bGUuYm9yZGVyU3R5bGUgPSAibm9uZSI7CiAgICAgICAgYnJlYWs7CiAgICAgIGRlZmF1bHQ6CiAgICAgICAgc3R5bGUuYm9yZGVyU3R5bGUgPSBlZGdlU3R5bGVzLm1hcChzID0+IHMuc3R5bGUpLmpvaW4oIiAiKTsKICAgICAgICBicmVhazsKICAgIH0KICAgIHN0eWxlLmJvcmRlcldpZHRoID0gZWRnZVN0eWxlcy5tYXAocyA9PiBzLndpZHRoKS5qb2luKCIgIik7CiAgICBzdHlsZS5ib3JkZXJDb2xvciA9IGVkZ2VTdHlsZXMubWFwKHMgPT4gcy5jb2xvcikuam9pbigiICIpOwogICAgcmV0dXJuIHN0eWxlOwogIH0KfQpjbGFzcyBCcmVhayBleHRlbmRzIF94ZmFfb2JqZWN0LlhGQU9iamVjdCB7CiAgY29uc3RydWN0b3IoYXR0cmlidXRlcykgewogICAgc3VwZXIoVEVNUExBVEVfTlNfSUQsICJicmVhayIsIHRydWUpOwogICAgdGhpcy5hZnRlciA9ICgwLCBfdXRpbHMuZ2V0U3RyaW5nT3B0aW9uKShhdHRyaWJ1dGVzLmFmdGVyLCBbImF1dG8iLCAiY29udGVudEFyZWEiLCAicGFnZUFyZWEiLCAicGFnZUV2ZW4iLCAicGFnZU9kZCJdKTsKICAgIHRoaXMuYWZ0ZXJUYXJnZXQgPSBhdHRyaWJ1dGVzLmFmdGVyVGFyZ2V0IHx8ICIiOwogICAgdGhpcy5iZWZvcmUgPSAoMCwgX3V0aWxzLmdldFN0cmluZ09wdGlvbikoYXR0cmlidXRlcy5iZWZvcmUsIFsiYXV0byIsICJjb250ZW50QXJlYSIsICJwYWdlQXJlYSIsICJwYWdlRXZlbiIsICJwYWdlT2RkIl0pOwogICAgdGhpcy5iZWZvcmVUYXJnZXQgPSBhdHRyaWJ1dGVzLmJlZm9yZVRhcmdldCB8fCAiIjsKICAgIHRoaXMuYm9va2VuZExlYWRlciA9IGF0dHJpYnV0ZXMuYm9va2VuZExlYWRlciB8fCAiIjsKICAgIHRoaXMuYm9va2VuZFRyYWlsZXIgPSBhdHRyaWJ1dGVzLmJvb2tlbmRUcmFpbGVyIHx8ICIiOwogICAgdGhpcy5pZCA9IGF0dHJpYnV0ZXMuaWQgfHwgIiI7CiAgICB0aGlzLm92ZXJmbG93TGVhZGVyID0gYXR0cmlidXRlcy5vdmVyZmxvd0xlYWRlciB8fCAiIjsKICAgIHRoaXMub3ZlcmZsb3dUYXJnZXQgPSBhdHRyaWJ1dGVzLm92ZXJmbG93VGFyZ2V0IHx8ICIiOwogICAgdGhpcy5vdmVyZmxvd1RyYWlsZXIgPSBhdHRyaWJ1dGVzLm92ZXJmbG93VHJhaWxlciB8fCAiIjsKICAgIHRoaXMuc3RhcnROZXcgPSAoMCwgX3V0aWxzLmdldEludGVnZXIpKHsKICAgICAgZGF0YTogYXR0cmlidXRlcy5zdGFydE5ldywKICAgICAgZGVmYXVsdFZhbHVlOiAwLAogICAgICB2YWxpZGF0ZTogeCA9PiB4ID09PSAxCiAgICB9KTsKICAgIHRoaXMudXNlID0gYXR0cmlidXRlcy51c2UgfHwgIiI7CiAgICB0aGlzLnVzZWhyZWYgPSBhdHRyaWJ1dGVzLnVzZWhyZWYgfHwgIiI7CiAgICB0aGlzLmV4dHJhcyA9IG51bGw7CiAgfQp9CmNsYXNzIEJyZWFrQWZ0ZXIgZXh0ZW5kcyBfeGZhX29iamVjdC5YRkFPYmplY3QgewogIGNvbnN0cnVjdG9yKGF0dHJpYnV0ZXMpIHsKICAgIHN1cGVyKFRFTVBMQVRFX05TX0lELCAiYnJlYWtBZnRlciIsIHRydWUpOwogICAgdGhpcy5pZCA9IGF0dHJpYnV0ZXMuaWQgfHwgIiI7CiAgICB0aGlzLmxlYWRlciA9IGF0dHJpYnV0ZXMubGVhZGVyIHx8ICIiOwogICAgdGhpcy5zdGFydE5ldyA9ICgwLCBfdXRpbHMuZ2V0SW50ZWdlcikoewogICAgICBkYXRhOiBhdHRyaWJ1dGVzLnN0YXJ0TmV3LAogICAgICBkZWZhdWx0VmFsdWU6IDAsCiAgICAgIHZhbGlkYXRlOiB4ID0+IHggPT09IDEKICAgIH0pOwogICAgdGhpcy50YXJnZXQgPSBhdHRyaWJ1dGVzLnRhcmdldCB8fCAiIjsKICAgIHRoaXMudGFyZ2V0VHlwZSA9ICgwLCBfdXRpbHMuZ2V0U3RyaW5nT3B0aW9uKShhdHRyaWJ1dGVzLnRhcmdldFR5cGUsIFsiYXV0byIsICJjb250ZW50QXJlYSIsICJwYWdlQXJlYSJdKTsKICAgIHRoaXMudHJhaWxlciA9IGF0dHJpYnV0ZXMudHJhaWxlciB8fCAiIjsKICAgIHRoaXMudXNlID0gYXR0cmlidXRlcy51c2UgfHwgIiI7CiAgICB0aGlzLnVzZWhyZWYgPSBhdHRyaWJ1dGVzLnVzZWhyZWYgfHwgIiI7CiAgICB0aGlzLnNjcmlwdCA9IG51bGw7CiAgfQp9CmNsYXNzIEJyZWFrQmVmb3JlIGV4dGVuZHMgX3hmYV9vYmplY3QuWEZBT2JqZWN0IHsKICBjb25zdHJ1Y3RvcihhdHRyaWJ1dGVzKSB7CiAgICBzdXBlcihURU1QTEFURV9OU19JRCwgImJyZWFrQmVmb3JlIiwgdHJ1ZSk7CiAgICB0aGlzLmlkID0gYXR0cmlidXRlcy5pZCB8fCAiIjsKICAgIHRoaXMubGVhZGVyID0gYXR0cmlidXRlcy5sZWFkZXIgfHwgIiI7CiAgICB0aGlzLnN0YXJ0TmV3ID0gKDAsIF91dGlscy5nZXRJbnRlZ2VyKSh7CiAgICAgIGRhdGE6IGF0dHJpYnV0ZXMuc3RhcnROZXcsCiAgICAgIGRlZmF1bHRWYWx1ZTogMCwKICAgICAgdmFsaWRhdGU6IHggPT4geCA9PT0gMQogICAgfSk7CiAgICB0aGlzLnRhcmdldCA9IGF0dHJpYnV0ZXMudGFyZ2V0IHx8ICIiOwogICAgdGhpcy50YXJnZXRUeXBlID0gKDAsIF91dGlscy5nZXRTdHJpbmdPcHRpb24pKGF0dHJpYnV0ZXMudGFyZ2V0VHlwZSwgWyJhdXRvIiwgImNvbnRlbnRBcmVhIiwgInBhZ2VBcmVhIl0pOwogICAgdGhpcy50cmFpbGVyID0gYXR0cmlidXRlcy50cmFpbGVyIHx8ICIiOwogICAgdGhpcy51c2UgPSBhdHRyaWJ1dGVzLnVzZSB8fCAiIjsKICAgIHRoaXMudXNlaHJlZiA9IGF0dHJpYnV0ZXMudXNlaHJlZiB8fCAiIjsKICAgIHRoaXMuc2NyaXB0ID0gbnVsbDsKICB9CiAgW19zeW1ib2xfdXRpbHMuJHRvSFRNTF0oYXZhaWxhYmxlU3BhY2UpIHsKICAgIHRoaXNbX3N5bWJvbF91dGlscy4kZXh0cmFdID0ge307CiAgICByZXR1cm4gX3V0aWxzLkhUTUxSZXN1bHQuRkFJTFVSRTsKICB9Cn0KY2xhc3MgQnV0dG9uIGV4dGVuZHMgX3hmYV9vYmplY3QuWEZBT2JqZWN0IHsKICBjb25zdHJ1Y3RvcihhdHRyaWJ1dGVzKSB7CiAgICBzdXBlcihURU1QTEFURV9OU19JRCwgImJ1dHRvbiIsIHRydWUpOwogICAgdGhpcy5oaWdobGlnaHQgPSAoMCwgX3V0aWxzLmdldFN0cmluZ09wdGlvbikoYXR0cmlidXRlcy5oaWdobGlnaHQsIFsiaW52ZXJ0ZWQiLCAibm9uZSIsICJvdXRsaW5lIiwgInB1c2giXSk7CiAgICB0aGlzLmlkID0gYXR0cmlidXRlcy5pZCB8fCAiIjsKICAgIHRoaXMudXNlID0gYXR0cmlidXRlcy51c2UgfHwgIiI7CiAgICB0aGlzLnVzZWhyZWYgPSBhdHRyaWJ1dGVzLnVzZWhyZWYgfHwgIiI7CiAgICB0aGlzLmV4dHJhcyA9IG51bGw7CiAgfQogIFtfc3ltYm9sX3V0aWxzLiR0b0hUTUxdKGF2YWlsYWJsZVNwYWNlKSB7CiAgICBjb25zdCBwYXJlbnQgPSB0aGlzW19zeW1ib2xfdXRpbHMuJGdldFBhcmVudF0oKTsKICAgIGNvbnN0IGdyYW5kcGEgPSBwYXJlbnRbX3N5bWJvbF91dGlscy4kZ2V0UGFyZW50XSgpOwogICAgY29uc3QgaHRtbEJ1dHRvbiA9IHsKICAgICAgbmFtZTogImJ1dHRvbiIsCiAgICAgIGF0dHJpYnV0ZXM6IHsKICAgICAgICBpZDogdGhpc1tfc3ltYm9sX3V0aWxzLiR1aWRdLAogICAgICAgIGNsYXNzOiBbInhmYUJ1dHRvbiJdLAogICAgICAgIHN0eWxlOiB7fQogICAgICB9LAogICAgICBjaGlsZHJlbjogW10KICAgIH07CiAgICBmb3IgKGNvbnN0IGV2ZW50IG9mIGdyYW5kcGEuZXZlbnQuY2hpbGRyZW4pIHsKICAgICAgaWYgKGV2ZW50LmFjdGl2aXR5ICE9PSAiY2xpY2siIHx8ICFldmVudC5zY3JpcHQpIHsKICAgICAgICBjb250aW51ZTsKICAgICAgfQogICAgICBjb25zdCBqc1VSTCA9ICgwLCBfY29yZV91dGlscy5yZWNvdmVySnNVUkwpKGV2ZW50LnNjcmlwdFtfc3ltYm9sX3V0aWxzLiRjb250ZW50XSk7CiAgICAgIGlmICghanNVUkwpIHsKICAgICAgICBjb250aW51ZTsKICAgICAgfQogICAgICBjb25zdCBocmVmID0gKDAsIF9odG1sX3V0aWxzLmZpeFVSTCkoanNVUkwudXJsKTsKICAgICAgaWYgKCFocmVmKSB7CiAgICAgICAgY29udGludWU7CiAgICAgIH0KICAgICAgaHRtbEJ1dHRvbi5jaGlsZHJlbi5wdXNoKHsKICAgICAgICBuYW1lOiAiYSIsCiAgICAgICAgYXR0cmlidXRlczogewogICAgICAgICAgaWQ6ICJsaW5rIiArIHRoaXNbX3N5bWJvbF91dGlscy4kdWlkXSwKICAgICAgICAgIGhyZWYsCiAgICAgICAgICBuZXdXaW5kb3c6IGpzVVJMLm5ld1dpbmRvdywKICAgICAgICAgIGNsYXNzOiBbInhmYUxpbmsiXSwKICAgICAgICAgIHN0eWxlOiB7fQogICAgICAgIH0sCiAgICAgICAgY2hpbGRyZW46IFtdCiAgICAgIH0pOwogICAgfQogICAgcmV0dXJuIF91dGlscy5IVE1MUmVzdWx0LnN1Y2Nlc3MoaHRtbEJ1dHRvbik7CiAgfQp9CmNsYXNzIENhbGN1bGF0ZSBleHRlbmRzIF94ZmFfb2JqZWN0LlhGQU9iamVjdCB7CiAgY29uc3RydWN0b3IoYXR0cmlidXRlcykgewogICAgc3VwZXIoVEVNUExBVEVfTlNfSUQsICJjYWxjdWxhdGUiLCB0cnVlKTsKICAgIHRoaXMuaWQgPSBhdHRyaWJ1dGVzLmlkIHx8ICIiOwogICAgdGhpcy5vdmVycmlkZSA9ICgwLCBfdXRpbHMuZ2V0U3RyaW5nT3B0aW9uKShhdHRyaWJ1dGVzLm92ZXJyaWRlLCBbImRpc2FibGVkIiwgImVycm9yIiwgImlnbm9yZSIsICJ3YXJuaW5nIl0pOwogICAgdGhpcy51c2UgPSBhdHRyaWJ1dGVzLnVzZSB8fCAiIjsKICAgIHRoaXMudXNlaHJlZiA9IGF0dHJpYnV0ZXMudXNlaHJlZiB8fCAiIjsKICAgIHRoaXMuZXh0cmFzID0gbnVsbDsKICAgIHRoaXMubWVzc2FnZSA9IG51bGw7CiAgICB0aGlzLnNjcmlwdCA9IG51bGw7CiAgfQp9CmNsYXNzIENhcHRpb24gZXh0ZW5kcyBfeGZhX29iamVjdC5YRkFPYmplY3QgewogIGNvbnN0cnVjdG9yKGF0dHJpYnV0ZXMpIHsKICAgIHN1cGVyKFRFTVBMQVRFX05TX0lELCAiY2FwdGlvbiIsIHRydWUpOwogICAgdGhpcy5pZCA9IGF0dHJpYnV0ZXMuaWQgfHwgIiI7CiAgICB0aGlzLnBsYWNlbWVudCA9ICgwLCBfdXRpbHMuZ2V0U3RyaW5nT3B0aW9uKShhdHRyaWJ1dGVzLnBsYWNlbWVudCwgWyJsZWZ0IiwgImJvdHRvbSIsICJpbmxpbmUiLCAicmlnaHQiLCAidG9wIl0pOwogICAgdGhpcy5wcmVzZW5jZSA9ICgwLCBfdXRpbHMuZ2V0U3RyaW5nT3B0aW9uKShhdHRyaWJ1dGVzLnByZXNlbmNlLCBbInZpc2libGUiLCAiaGlkZGVuIiwgImluYWN0aXZlIiwgImludmlzaWJsZSJdKTsKICAgIHRoaXMucmVzZXJ2ZSA9IE1hdGguY2VpbCgoMCwgX3V0aWxzLmdldE1lYXN1cmVtZW50KShhdHRyaWJ1dGVzLnJlc2VydmUpKTsKICAgIHRoaXMudXNlID0gYXR0cmlidXRlcy51c2UgfHwgIiI7CiAgICB0aGlzLnVzZWhyZWYgPSBhdHRyaWJ1dGVzLnVzZWhyZWYgfHwgIiI7CiAgICB0aGlzLmV4dHJhcyA9IG51bGw7CiAgICB0aGlzLmZvbnQgPSBudWxsOwogICAgdGhpcy5tYXJnaW4gPSBudWxsOwogICAgdGhpcy5wYXJhID0gbnVsbDsKICAgIHRoaXMudmFsdWUgPSBudWxsOwogIH0KICBbX3N5bWJvbF91dGlscy4kc2V0VmFsdWVdKHZhbHVlKSB7CiAgICBfc2V0VmFsdWUodGhpcywgdmFsdWUpOwogIH0KICBbX3N5bWJvbF91dGlscy4kZ2V0RXh0cmFdKGF2YWlsYWJsZVNwYWNlKSB7CiAgICBpZiAoIXRoaXNbX3N5bWJvbF91dGlscy4kZXh0cmFdKSB7CiAgICAgIGxldCB7CiAgICAgICAgd2lkdGgsCiAgICAgICAgaGVpZ2h0CiAgICAgIH0gPSBhdmFpbGFibGVTcGFjZTsKICAgICAgc3dpdGNoICh0aGlzLnBsYWNlbWVudCkgewogICAgICAgIGNhc2UgImxlZnQiOgogICAgICAgIGNhc2UgInJpZ2h0IjoKICAgICAgICBjYXNlICJpbmxpbmUiOgogICAgICAgICAgd2lkdGggPSB0aGlzLnJlc2VydmUgPD0gMCA/IHdpZHRoIDogdGhpcy5yZXNlcnZlOwogICAgICAgICAgYnJlYWs7CiAgICAgICAgY2FzZSAidG9wIjoKICAgICAgICBjYXNlICJib3R0b20iOgogICAgICAgICAgaGVpZ2h0ID0gdGhpcy5yZXNlcnZlIDw9IDAgPyBoZWlnaHQgOiB0aGlzLnJlc2VydmU7CiAgICAgICAgICBicmVhazsKICAgICAgfQogICAgICB0aGlzW19zeW1ib2xfdXRpbHMuJGV4dHJhXSA9ICgwLCBfaHRtbF91dGlscy5sYXlvdXROb2RlKSh0aGlzLCB7CiAgICAgICAgd2lkdGgsCiAgICAgICAgaGVpZ2h0CiAgICAgIH0pOwogICAgfQogICAgcmV0dXJuIHRoaXNbX3N5bWJvbF91dGlscy4kZXh0cmFdOwogIH0KICBbX3N5bWJvbF91dGlscy4kdG9IVE1MXShhdmFpbGFibGVTcGFjZSkgewogICAgaWYgKCF0aGlzLnZhbHVlKSB7CiAgICAgIHJldHVybiBfdXRpbHMuSFRNTFJlc3VsdC5FTVBUWTsKICAgIH0KICAgIHRoaXNbX3N5bWJvbF91dGlscy4kcHVzaFBhcmFdKCk7CiAgICBjb25zdCB2YWx1ZSA9IHRoaXMudmFsdWVbX3N5bWJvbF91dGlscy4kdG9IVE1MXShhdmFpbGFibGVTcGFjZSkuaHRtbDsKICAgIGlmICghdmFsdWUpIHsKICAgICAgdGhpc1tfc3ltYm9sX3V0aWxzLiRwb3BQYXJhXSgpOwogICAgICByZXR1cm4gX3V0aWxzLkhUTUxSZXN1bHQuRU1QVFk7CiAgICB9CiAgICBjb25zdCBzYXZlZFJlc2VydmUgPSB0aGlzLnJlc2VydmU7CiAgICBpZiAodGhpcy5yZXNlcnZlIDw9IDApIHsKICAgICAgY29uc3QgewogICAgICAgIHcsCiAgICAgICAgaAogICAgICB9ID0gdGhpc1tfc3ltYm9sX3V0aWxzLiRnZXRFeHRyYV0oYXZhaWxhYmxlU3BhY2UpOwogICAgICBzd2l0Y2ggKHRoaXMucGxhY2VtZW50KSB7CiAgICAgICAgY2FzZSAibGVmdCI6CiAgICAgICAgY2FzZSAicmlnaHQiOgogICAgICAgIGNhc2UgImlubGluZSI6CiAgICAgICAgICB0aGlzLnJlc2VydmUgPSB3OwogICAgICAgICAgYnJlYWs7CiAgICAgICAgY2FzZSAidG9wIjoKICAgICAgICBjYXNlICJib3R0b20iOgogICAgICAgICAgdGhpcy5yZXNlcnZlID0gaDsKICAgICAgICAgIGJyZWFrOwogICAgICB9CiAgICB9CiAgICBjb25zdCBjaGlsZHJlbiA9IFtdOwogICAgaWYgKHR5cGVvZiB2YWx1ZSA9PT0gInN0cmluZyIpIHsKICAgICAgY2hpbGRyZW4ucHVzaCh7CiAgICAgICAgbmFtZTogIiN0ZXh0IiwKICAgICAgICB2YWx1ZQogICAgICB9KTsKICAgIH0gZWxzZSB7CiAgICAgIGNoaWxkcmVuLnB1c2godmFsdWUpOwogICAgfQogICAgY29uc3Qgc3R5bGUgPSAoMCwgX2h0bWxfdXRpbHMudG9TdHlsZSkodGhpcywgImZvbnQiLCAibWFyZ2luIiwgInZpc2liaWxpdHkiKTsKICAgIHN3aXRjaCAodGhpcy5wbGFjZW1lbnQpIHsKICAgICAgY2FzZSAibGVmdCI6CiAgICAgIGNhc2UgInJpZ2h0IjoKICAgICAgICBpZiAodGhpcy5yZXNlcnZlID4gMCkgewogICAgICAgICAgc3R5bGUud2lkdGggPSAoMCwgX2h0bWxfdXRpbHMubWVhc3VyZVRvU3RyaW5nKSh0aGlzLnJlc2VydmUpOwogICAgICAgIH0KICAgICAgICBicmVhazsKICAgICAgY2FzZSAidG9wIjoKICAgICAgY2FzZSAiYm90dG9tIjoKICAgICAgICBpZiAodGhpcy5yZXNlcnZlID4gMCkgewogICAgICAgICAgc3R5bGUuaGVpZ2h0ID0gKDAsIF9odG1sX3V0aWxzLm1lYXN1cmVUb1N0cmluZykodGhpcy5yZXNlcnZlKTsKICAgICAgICB9CiAgICAgICAgYnJlYWs7CiAgICB9CiAgICAoMCwgX2h0bWxfdXRpbHMuc2V0UGFyYSkodGhpcywgbnVsbCwgdmFsdWUpOwogICAgdGhpc1tfc3ltYm9sX3V0aWxzLiRwb3BQYXJhXSgpOwogICAgdGhpcy5yZXNlcnZlID0gc2F2ZWRSZXNlcnZlOwogICAgcmV0dXJuIF91dGlscy5IVE1MUmVzdWx0LnN1Y2Nlc3MoewogICAgICBuYW1lOiAiZGl2IiwKICAgICAgYXR0cmlidXRlczogewogICAgICAgIHN0eWxlLAogICAgICAgIGNsYXNzOiBbInhmYUNhcHRpb24iXQogICAgICB9LAogICAgICBjaGlsZHJlbgogICAgfSk7CiAgfQp9CmNsYXNzIENlcnRpZmljYXRlIGV4dGVuZHMgX3hmYV9vYmplY3QuU3RyaW5nT2JqZWN0IHsKICBjb25zdHJ1Y3RvcihhdHRyaWJ1dGVzKSB7CiAgICBzdXBlcihURU1QTEFURV9OU19JRCwgImNlcnRpZmljYXRlIik7CiAgICB0aGlzLmlkID0gYXR0cmlidXRlcy5pZCB8fCAiIjsKICAgIHRoaXMubmFtZSA9IGF0dHJpYnV0ZXMubmFtZSB8fCAiIjsKICAgIHRoaXMudXNlID0gYXR0cmlidXRlcy51c2UgfHwgIiI7CiAgICB0aGlzLnVzZWhyZWYgPSBhdHRyaWJ1dGVzLnVzZWhyZWYgfHwgIiI7CiAgfQp9CmNsYXNzIENlcnRpZmljYXRlcyBleHRlbmRzIF94ZmFfb2JqZWN0LlhGQU9iamVjdCB7CiAgY29uc3RydWN0b3IoYXR0cmlidXRlcykgewogICAgc3VwZXIoVEVNUExBVEVfTlNfSUQsICJjZXJ0aWZpY2F0ZXMiLCB0cnVlKTsKICAgIHRoaXMuY3JlZGVudGlhbFNlcnZlclBvbGljeSA9ICgwLCBfdXRpbHMuZ2V0U3RyaW5nT3B0aW9uKShhdHRyaWJ1dGVzLmNyZWRlbnRpYWxTZXJ2ZXJQb2xpY3ksIFsib3B0aW9uYWwiLCAicmVxdWlyZWQiXSk7CiAgICB0aGlzLmlkID0gYXR0cmlidXRlcy5pZCB8fCAiIjsKICAgIHRoaXMudXJsID0gYXR0cmlidXRlcy51cmwgfHwgIiI7CiAgICB0aGlzLnVybFBvbGljeSA9IGF0dHJpYnV0ZXMudXJsUG9saWN5IHx8ICIiOwogICAgdGhpcy51c2UgPSBhdHRyaWJ1dGVzLnVzZSB8fCAiIjsKICAgIHRoaXMudXNlaHJlZiA9IGF0dHJpYnV0ZXMudXNlaHJlZiB8fCAiIjsKICAgIHRoaXMuZW5jcnlwdGlvbiA9IG51bGw7CiAgICB0aGlzLmlzc3VlcnMgPSBudWxsOwogICAgdGhpcy5rZXlVc2FnZSA9IG51bGw7CiAgICB0aGlzLm9pZHMgPSBudWxsOwogICAgdGhpcy5zaWduaW5nID0gbnVsbDsKICAgIHRoaXMuc3ViamVjdEROcyA9IG51bGw7CiAgfQp9CmNsYXNzIENoZWNrQnV0dG9uIGV4dGVuZHMgX3hmYV9vYmplY3QuWEZBT2JqZWN0IHsKICBjb25zdHJ1Y3RvcihhdHRyaWJ1dGVzKSB7CiAgICBzdXBlcihURU1QTEFURV9OU19JRCwgImNoZWNrQnV0dG9uIiwgdHJ1ZSk7CiAgICB0aGlzLmlkID0gYXR0cmlidXRlcy5pZCB8fCAiIjsKICAgIHRoaXMubWFyayA9ICgwLCBfdXRpbHMuZ2V0U3RyaW5nT3B0aW9uKShhdHRyaWJ1dGVzLm1hcmssIFsiZGVmYXVsdCIsICJjaGVjayIsICJjaXJjbGUiLCAiY3Jvc3MiLCAiZGlhbW9uZCIsICJzcXVhcmUiLCAic3RhciJdKTsKICAgIHRoaXMuc2hhcGUgPSAoMCwgX3V0aWxzLmdldFN0cmluZ09wdGlvbikoYXR0cmlidXRlcy5zaGFwZSwgWyJzcXVhcmUiLCAicm91bmQiXSk7CiAgICB0aGlzLnNpemUgPSAoMCwgX3V0aWxzLmdldE1lYXN1cmVtZW50KShhdHRyaWJ1dGVzLnNpemUsICIxMHB0Iik7CiAgICB0aGlzLnVzZSA9IGF0dHJpYnV0ZXMudXNlIHx8ICIiOwogICAgdGhpcy51c2VocmVmID0gYXR0cmlidXRlcy51c2VocmVmIHx8ICIiOwogICAgdGhpcy5ib3JkZXIgPSBudWxsOwogICAgdGhpcy5leHRyYXMgPSBudWxsOwogICAgdGhpcy5tYXJnaW4gPSBudWxsOwogIH0KICBbX3N5bWJvbF91dGlscy4kdG9IVE1MXShhdmFpbGFibGVTcGFjZSkgewogICAgY29uc3Qgc3R5bGUgPSAoMCwgX2h0bWxfdXRpbHMudG9TdHlsZSkoIm1hcmdpbiIpOwogICAgY29uc3Qgc2l6ZSA9ICgwLCBfaHRtbF91dGlscy5tZWFzdXJlVG9TdHJpbmcpKHRoaXMuc2l6ZSk7CiAgICBzdHlsZS53aWR0aCA9IHN0eWxlLmhlaWdodCA9IHNpemU7CiAgICBsZXQgdHlwZTsKICAgIGxldCBjbGFzc05hbWU7CiAgICBsZXQgZ3JvdXBJZDsKICAgIGNvbnN0IGZpZWxkID0gdGhpc1tfc3ltYm9sX3V0aWxzLiRnZXRQYXJlbnRdKClbX3N5bWJvbF91dGlscy4kZ2V0UGFyZW50XSgpOwogICAgY29uc3QgaXRlbXMgPSBmaWVsZC5pdGVtcy5jaGlsZHJlbi5sZW5ndGggJiYgZmllbGQuaXRlbXMuY2hpbGRyZW5bMF1bX3N5bWJvbF91dGlscy4kdG9IVE1MXSgpLmh0bWwgfHwgW107CiAgICBjb25zdCBleHBvcnRlZFZhbHVlID0gewogICAgICBvbjogKGl0ZW1zWzBdICE9PSB1bmRlZmluZWQgPyBpdGVtc1swXSA6ICJvbiIpLnRvU3RyaW5nKCksCiAgICAgIG9mZjogKGl0ZW1zWzFdICE9PSB1bmRlZmluZWQgPyBpdGVtc1sxXSA6ICJvZmYiKS50b1N0cmluZygpCiAgICB9OwogICAgY29uc3QgdmFsdWUgPSBmaWVsZC52YWx1ZT8uW19zeW1ib2xfdXRpbHMuJHRleHRdKCkgfHwgIm9mZiI7CiAgICBjb25zdCBjaGVja2VkID0gdmFsdWUgPT09IGV4cG9ydGVkVmFsdWUub24gfHwgdW5kZWZpbmVkOwogICAgY29uc3QgY29udGFpbmVyID0gZmllbGRbX3N5bWJvbF91dGlscy4kZ2V0U3ViZm9ybVBhcmVudF0oKTsKICAgIGNvbnN0IGZpZWxkSWQgPSBmaWVsZFtfc3ltYm9sX3V0aWxzLiR1aWRdOwogICAgbGV0IGRhdGFJZDsKICAgIGlmIChjb250YWluZXIgaW5zdGFuY2VvZiBFeGNsR3JvdXApIHsKICAgICAgZ3JvdXBJZCA9IGNvbnRhaW5lcltfc3ltYm9sX3V0aWxzLiR1aWRdOwogICAgICB0eXBlID0gInJhZGlvIjsKICAgICAgY2xhc3NOYW1lID0gInhmYVJhZGlvIjsKICAgICAgZGF0YUlkID0gY29udGFpbmVyW19zeW1ib2xfdXRpbHMuJGRhdGFdPy5bX3N5bWJvbF91dGlscy4kdWlkXSB8fCBjb250YWluZXJbX3N5bWJvbF91dGlscy4kdWlkXTsKICAgIH0gZWxzZSB7CiAgICAgIHR5cGUgPSAiY2hlY2tib3giOwogICAgICBjbGFzc05hbWUgPSAieGZhQ2hlY2tib3giOwogICAgICBkYXRhSWQgPSBmaWVsZFtfc3ltYm9sX3V0aWxzLiRkYXRhXT8uW19zeW1ib2xfdXRpbHMuJHVpZF0gfHwgZmllbGRbX3N5bWJvbF91dGlscy4kdWlkXTsKICAgIH0KICAgIGNvbnN0IGlucHV0ID0gewogICAgICBuYW1lOiAiaW5wdXQiLAogICAgICBhdHRyaWJ1dGVzOiB7CiAgICAgICAgY2xhc3M6IFtjbGFzc05hbWVdLAogICAgICAgIHN0eWxlLAogICAgICAgIGZpZWxkSWQsCiAgICAgICAgZGF0YUlkLAogICAgICAgIHR5cGUsCiAgICAgICAgY2hlY2tlZCwKICAgICAgICB4ZmFPbjogZXhwb3J0ZWRWYWx1ZS5vbiwKICAgICAgICB4ZmFPZmY6IGV4cG9ydGVkVmFsdWUub2ZmLAogICAgICAgICJhcmlhLWxhYmVsIjogYXJpYUxhYmVsKGZpZWxkKSwKICAgICAgICAiYXJpYS1yZXF1aXJlZCI6IGZhbHNlCiAgICAgIH0KICAgIH07CiAgICBpZiAoZ3JvdXBJZCkgewogICAgICBpbnB1dC5hdHRyaWJ1dGVzLm5hbWUgPSBncm91cElkOwogICAgfQogICAgaWYgKGlzUmVxdWlyZWQoZmllbGQpKSB7CiAgICAgIGlucHV0LmF0dHJpYnV0ZXNbImFyaWEtcmVxdWlyZWQiXSA9IHRydWU7CiAgICAgIGlucHV0LmF0dHJpYnV0ZXMucmVxdWlyZWQgPSB0cnVlOwogICAgfQogICAgcmV0dXJuIF91dGlscy5IVE1MUmVzdWx0LnN1Y2Nlc3MoewogICAgICBuYW1lOiAibGFiZWwiLAogICAgICBhdHRyaWJ1dGVzOiB7CiAgICAgICAgY2xhc3M6IFsieGZhTGFiZWwiXQogICAgICB9LAogICAgICBjaGlsZHJlbjogW2lucHV0XQogICAgfSk7CiAgfQp9CmNsYXNzIENob2ljZUxpc3QgZXh0ZW5kcyBfeGZhX29iamVjdC5YRkFPYmplY3QgewogIGNvbnN0cnVjdG9yKGF0dHJpYnV0ZXMpIHsKICAgIHN1cGVyKFRFTVBMQVRFX05TX0lELCAiY2hvaWNlTGlzdCIsIHRydWUpOwogICAgdGhpcy5jb21taXRPbiA9ICgwLCBfdXRpbHMuZ2V0U3RyaW5nT3B0aW9uKShhdHRyaWJ1dGVzLmNvbW1pdE9uLCBbInNlbGVjdCIsICJleGl0Il0pOwogICAgdGhpcy5pZCA9IGF0dHJpYnV0ZXMuaWQgfHwgIiI7CiAgICB0aGlzLm9wZW4gPSAoMCwgX3V0aWxzLmdldFN0cmluZ09wdGlvbikoYXR0cmlidXRlcy5vcGVuLCBbInVzZXJDb250cm9sIiwgImFsd2F5cyIsICJtdWx0aVNlbGVjdCIsICJvbkVudHJ5Il0pOwogICAgdGhpcy50ZXh0RW50cnkgPSAoMCwgX3V0aWxzLmdldEludGVnZXIpKHsKICAgICAgZGF0YTogYXR0cmlidXRlcy50ZXh0RW50cnksCiAgICAgIGRlZmF1bHRWYWx1ZTogMCwKICAgICAgdmFsaWRhdGU6IHggPT4geCA9PT0gMQogICAgfSk7CiAgICB0aGlzLnVzZSA9IGF0dHJpYnV0ZXMudXNlIHx8ICIiOwogICAgdGhpcy51c2VocmVmID0gYXR0cmlidXRlcy51c2VocmVmIHx8ICIiOwogICAgdGhpcy5ib3JkZXIgPSBudWxsOwogICAgdGhpcy5leHRyYXMgPSBudWxsOwogICAgdGhpcy5tYXJnaW4gPSBudWxsOwogIH0KICBbX3N5bWJvbF91dGlscy4kdG9IVE1MXShhdmFpbGFibGVTcGFjZSkgewogICAgY29uc3Qgc3R5bGUgPSAoMCwgX2h0bWxfdXRpbHMudG9TdHlsZSkodGhpcywgImJvcmRlciIsICJtYXJnaW4iKTsKICAgIGNvbnN0IHVpID0gdGhpc1tfc3ltYm9sX3V0aWxzLiRnZXRQYXJlbnRdKCk7CiAgICBjb25zdCBmaWVsZCA9IHVpW19zeW1ib2xfdXRpbHMuJGdldFBhcmVudF0oKTsKICAgIGNvbnN0IGZvbnRTaXplID0gZmllbGQuZm9udD8uc2l6ZSB8fCAxMDsKICAgIGNvbnN0IG9wdGlvblN0eWxlID0gewogICAgICBmb250U2l6ZTogYGNhbGMoJHtmb250U2l6ZX1weCAqIHZhcigtLXNjYWxlLWZhY3RvcikpYAogICAgfTsKICAgIGNvbnN0IGNoaWxkcmVuID0gW107CiAgICBpZiAoZmllbGQuaXRlbXMuY2hpbGRyZW4ubGVuZ3RoID4gMCkgewogICAgICBjb25zdCBpdGVtcyA9IGZpZWxkLml0ZW1zOwogICAgICBsZXQgZGlzcGxheWVkSW5kZXggPSAwOwogICAgICBsZXQgc2F2ZUluZGV4ID0gMDsKICAgICAgaWYgKGl0ZW1zLmNoaWxkcmVuLmxlbmd0aCA9PT0gMikgewogICAgICAgIGRpc3BsYXllZEluZGV4ID0gaXRlbXMuY2hpbGRyZW5bMF0uc2F2ZTsKICAgICAgICBzYXZlSW5kZXggPSAxIC0gZGlzcGxheWVkSW5kZXg7CiAgICAgIH0KICAgICAgY29uc3QgZGlzcGxheWVkID0gaXRlbXMuY2hpbGRyZW5bZGlzcGxheWVkSW5kZXhdW19zeW1ib2xfdXRpbHMuJHRvSFRNTF0oKS5odG1sOwogICAgICBjb25zdCB2YWx1ZXMgPSBpdGVtcy5jaGlsZHJlbltzYXZlSW5kZXhdW19zeW1ib2xfdXRpbHMuJHRvSFRNTF0oKS5odG1sOwogICAgICBsZXQgc2VsZWN0ZWQgPSBmYWxzZTsKICAgICAgY29uc3QgdmFsdWUgPSBmaWVsZC52YWx1ZT8uW19zeW1ib2xfdXRpbHMuJHRleHRdKCkgfHwgIiI7CiAgICAgIGZvciAobGV0IGkgPSAwLCBpaSA9IGRpc3BsYXllZC5sZW5ndGg7IGkgPCBpaTsgaSsrKSB7CiAgICAgICAgY29uc3Qgb3B0aW9uID0gewogICAgICAgICAgbmFtZTogIm9wdGlvbiIsCiAgICAgICAgICBhdHRyaWJ1dGVzOiB7CiAgICAgICAgICAgIHZhbHVlOiB2YWx1ZXNbaV0gfHwgZGlzcGxheWVkW2ldLAogICAgICAgICAgICBzdHlsZTogb3B0aW9uU3R5bGUKICAgICAgICAgIH0sCiAgICAgICAgICB2YWx1ZTogZGlzcGxheWVkW2ldCiAgICAgICAgfTsKICAgICAgICBpZiAodmFsdWVzW2ldID09PSB2YWx1ZSkgewogICAgICAgICAgb3B0aW9uLmF0dHJpYnV0ZXMuc2VsZWN0ZWQgPSBzZWxlY3RlZCA9IHRydWU7CiAgICAgICAgfQogICAgICAgIGNoaWxkcmVuLnB1c2gob3B0aW9uKTsKICAgICAgfQogICAgICBpZiAoIXNlbGVjdGVkKSB7CiAgICAgICAgY2hpbGRyZW4uc3BsaWNlKDAsIDAsIHsKICAgICAgICAgIG5hbWU6ICJvcHRpb24iLAogICAgICAgICAgYXR0cmlidXRlczogewogICAgICAgICAgICBoaWRkZW46IHRydWUsCiAgICAgICAgICAgIHNlbGVjdGVkOiB0cnVlCiAgICAgICAgICB9LAogICAgICAgICAgdmFsdWU6ICIgIgogICAgICAgIH0pOwogICAgICB9CiAgICB9CiAgICBjb25zdCBzZWxlY3RBdHRyaWJ1dGVzID0gewogICAgICBjbGFzczogWyJ4ZmFTZWxlY3QiXSwKICAgICAgZmllbGRJZDogZmllbGRbX3N5bWJvbF91dGlscy4kdWlkXSwKICAgICAgZGF0YUlkOiBmaWVsZFtfc3ltYm9sX3V0aWxzLiRkYXRhXT8uW19zeW1ib2xfdXRpbHMuJHVpZF0gfHwgZmllbGRbX3N5bWJvbF91dGlscy4kdWlkXSwKICAgICAgc3R5bGUsCiAgICAgICJhcmlhLWxhYmVsIjogYXJpYUxhYmVsKGZpZWxkKSwKICAgICAgImFyaWEtcmVxdWlyZWQiOiBmYWxzZQogICAgfTsKICAgIGlmIChpc1JlcXVpcmVkKGZpZWxkKSkgewogICAgICBzZWxlY3RBdHRyaWJ1dGVzWyJhcmlhLXJlcXVpcmVkIl0gPSB0cnVlOwogICAgICBzZWxlY3RBdHRyaWJ1dGVzLnJlcXVpcmVkID0gdHJ1ZTsKICAgIH0KICAgIGlmICh0aGlzLm9wZW4gPT09ICJtdWx0aVNlbGVjdCIpIHsKICAgICAgc2VsZWN0QXR0cmlidXRlcy5tdWx0aXBsZSA9IHRydWU7CiAgICB9CiAgICByZXR1cm4gX3V0aWxzLkhUTUxSZXN1bHQuc3VjY2Vzcyh7CiAgICAgIG5hbWU6ICJsYWJlbCIsCiAgICAgIGF0dHJpYnV0ZXM6IHsKICAgICAgICBjbGFzczogWyJ4ZmFMYWJlbCJdCiAgICAgIH0sCiAgICAgIGNoaWxkcmVuOiBbewogICAgICAgIG5hbWU6ICJzZWxlY3QiLAogICAgICAgIGNoaWxkcmVuLAogICAgICAgIGF0dHJpYnV0ZXM6IHNlbGVjdEF0dHJpYnV0ZXMKICAgICAgfV0KICAgIH0pOwogIH0KfQpjbGFzcyBDb2xvciBleHRlbmRzIF94ZmFfb2JqZWN0LlhGQU9iamVjdCB7CiAgY29uc3RydWN0b3IoYXR0cmlidXRlcykgewogICAgc3VwZXIoVEVNUExBVEVfTlNfSUQsICJjb2xvciIsIHRydWUpOwogICAgdGhpcy5jU3BhY2UgPSAoMCwgX3V0aWxzLmdldFN0cmluZ09wdGlvbikoYXR0cmlidXRlcy5jU3BhY2UsIFsiU1JHQiJdKTsKICAgIHRoaXMuaWQgPSBhdHRyaWJ1dGVzLmlkIHx8ICIiOwogICAgdGhpcy51c2UgPSBhdHRyaWJ1dGVzLnVzZSB8fCAiIjsKICAgIHRoaXMudXNlaHJlZiA9IGF0dHJpYnV0ZXMudXNlaHJlZiB8fCAiIjsKICAgIHRoaXMudmFsdWUgPSBhdHRyaWJ1dGVzLnZhbHVlID8gKDAsIF91dGlscy5nZXRDb2xvcikoYXR0cmlidXRlcy52YWx1ZSkgOiAiIjsKICAgIHRoaXMuZXh0cmFzID0gbnVsbDsKICB9CiAgW19zeW1ib2xfdXRpbHMuJGhhc1NldHRhYmxlVmFsdWVdKCkgewogICAgcmV0dXJuIGZhbHNlOwogIH0KICBbX3N5bWJvbF91dGlscy4kdG9TdHlsZV0oKSB7CiAgICByZXR1cm4gdGhpcy52YWx1ZSA/IF91dGlsLlV0aWwubWFrZUhleENvbG9yKHRoaXMudmFsdWUuciwgdGhpcy52YWx1ZS5nLCB0aGlzLnZhbHVlLmIpIDogbnVsbDsKICB9Cn0KY2xhc3MgQ29tYiBleHRlbmRzIF94ZmFfb2JqZWN0LlhGQU9iamVjdCB7CiAgY29uc3RydWN0b3IoYXR0cmlidXRlcykgewogICAgc3VwZXIoVEVNUExBVEVfTlNfSUQsICJjb21iIik7CiAgICB0aGlzLmlkID0gYXR0cmlidXRlcy5pZCB8fCAiIjsKICAgIHRoaXMubnVtYmVyT2ZDZWxscyA9ICgwLCBfdXRpbHMuZ2V0SW50ZWdlcikoewogICAgICBkYXRhOiBhdHRyaWJ1dGVzLm51bWJlck9mQ2VsbHMsCiAgICAgIGRlZmF1bHRWYWx1ZTogMCwKICAgICAgdmFsaWRhdGU6IHggPT4geCA+PSAwCiAgICB9KTsKICAgIHRoaXMudXNlID0gYXR0cmlidXRlcy51c2UgfHwgIiI7CiAgICB0aGlzLnVzZWhyZWYgPSBhdHRyaWJ1dGVzLnVzZWhyZWYgfHwgIiI7CiAgfQp9CmNsYXNzIENvbm5lY3QgZXh0ZW5kcyBfeGZhX29iamVjdC5YRkFPYmplY3QgewogIGNvbnN0cnVjdG9yKGF0dHJpYnV0ZXMpIHsKICAgIHN1cGVyKFRFTVBMQVRFX05TX0lELCAiY29ubmVjdCIsIHRydWUpOwogICAgdGhpcy5jb25uZWN0aW9uID0gYXR0cmlidXRlcy5jb25uZWN0aW9uIHx8ICIiOwogICAgdGhpcy5pZCA9IGF0dHJpYnV0ZXMuaWQgfHwgIiI7CiAgICB0aGlzLnJlZiA9IGF0dHJpYnV0ZXMucmVmIHx8ICIiOwogICAgdGhpcy51c2FnZSA9ICgwLCBfdXRpbHMuZ2V0U3RyaW5nT3B0aW9uKShhdHRyaWJ1dGVzLnVzYWdlLCBbImV4cG9ydEFuZEltcG9ydCIsICJleHBvcnRPbmx5IiwgImltcG9ydE9ubHkiXSk7CiAgICB0aGlzLnVzZSA9IGF0dHJpYnV0ZXMudXNlIHx8ICIiOwogICAgdGhpcy51c2VocmVmID0gYXR0cmlidXRlcy51c2VocmVmIHx8ICIiOwogICAgdGhpcy5waWN0dXJlID0gbnVsbDsKICB9Cn0KY2xhc3MgQ29udGVudEFyZWEgZXh0ZW5kcyBfeGZhX29iamVjdC5YRkFPYmplY3QgewogIGNvbnN0cnVjdG9yKGF0dHJpYnV0ZXMpIHsKICAgIHN1cGVyKFRFTVBMQVRFX05TX0lELCAiY29udGVudEFyZWEiLCB0cnVlKTsKICAgIHRoaXMuaCA9ICgwLCBfdXRpbHMuZ2V0TWVhc3VyZW1lbnQpKGF0dHJpYnV0ZXMuaCk7CiAgICB0aGlzLmlkID0gYXR0cmlidXRlcy5pZCB8fCAiIjsKICAgIHRoaXMubmFtZSA9IGF0dHJpYnV0ZXMubmFtZSB8fCAiIjsKICAgIHRoaXMucmVsZXZhbnQgPSAoMCwgX3V0aWxzLmdldFJlbGV2YW50KShhdHRyaWJ1dGVzLnJlbGV2YW50KTsKICAgIHRoaXMudXNlID0gYXR0cmlidXRlcy51c2UgfHwgIiI7CiAgICB0aGlzLnVzZWhyZWYgPSBhdHRyaWJ1dGVzLnVzZWhyZWYgfHwgIiI7CiAgICB0aGlzLncgPSAoMCwgX3V0aWxzLmdldE1lYXN1cmVtZW50KShhdHRyaWJ1dGVzLncpOwogICAgdGhpcy54ID0gKDAsIF91dGlscy5nZXRNZWFzdXJlbWVudCkoYXR0cmlidXRlcy54LCAiMHB0Iik7CiAgICB0aGlzLnkgPSAoMCwgX3V0aWxzLmdldE1lYXN1cmVtZW50KShhdHRyaWJ1dGVzLnksICIwcHQiKTsKICAgIHRoaXMuZGVzYyA9IG51bGw7CiAgICB0aGlzLmV4dHJhcyA9IG51bGw7CiAgfQogIFtfc3ltYm9sX3V0aWxzLiR0b0hUTUxdKGF2YWlsYWJsZVNwYWNlKSB7CiAgICBjb25zdCBsZWZ0ID0gKDAsIF9odG1sX3V0aWxzLm1lYXN1cmVUb1N0cmluZykodGhpcy54KTsKICAgIGNvbnN0IHRvcCA9ICgwLCBfaHRtbF91dGlscy5tZWFzdXJlVG9TdHJpbmcpKHRoaXMueSk7CiAgICBjb25zdCBzdHlsZSA9IHsKICAgICAgbGVmdCwKICAgICAgdG9wLAogICAgICB3aWR0aDogKDAsIF9odG1sX3V0aWxzLm1lYXN1cmVUb1N0cmluZykodGhpcy53KSwKICAgICAgaGVpZ2h0OiAoMCwgX2h0bWxfdXRpbHMubWVhc3VyZVRvU3RyaW5nKSh0aGlzLmgpCiAgICB9OwogICAgY29uc3QgY2xhc3NOYW1lcyA9IFsieGZhQ29udGVudGFyZWEiXTsKICAgIGlmICgoMCwgX2h0bWxfdXRpbHMuaXNQcmludE9ubHkpKHRoaXMpKSB7CiAgICAgIGNsYXNzTmFtZXMucHVzaCgieGZhUHJpbnRPbmx5Iik7CiAgICB9CiAgICByZXR1cm4gX3V0aWxzLkhUTUxSZXN1bHQuc3VjY2Vzcyh7CiAgICAgIG5hbWU6ICJkaXYiLAogICAgICBjaGlsZHJlbjogW10sCiAgICAgIGF0dHJpYnV0ZXM6IHsKICAgICAgICBzdHlsZSwKICAgICAgICBjbGFzczogY2xhc3NOYW1lcywKICAgICAgICBpZDogdGhpc1tfc3ltYm9sX3V0aWxzLiR1aWRdCiAgICAgIH0KICAgIH0pOwogIH0KfQpjbGFzcyBDb3JuZXIgZXh0ZW5kcyBfeGZhX29iamVjdC5YRkFPYmplY3QgewogIGNvbnN0cnVjdG9yKGF0dHJpYnV0ZXMpIHsKICAgIHN1cGVyKFRFTVBMQVRFX05TX0lELCAiY29ybmVyIiwgdHJ1ZSk7CiAgICB0aGlzLmlkID0gYXR0cmlidXRlcy5pZCB8fCAiIjsKICAgIHRoaXMuaW52ZXJ0ZWQgPSAoMCwgX3V0aWxzLmdldEludGVnZXIpKHsKICAgICAgZGF0YTogYXR0cmlidXRlcy5pbnZlcnRlZCwKICAgICAgZGVmYXVsdFZhbHVlOiAwLAogICAgICB2YWxpZGF0ZTogeCA9PiB4ID09PSAxCiAgICB9KTsKICAgIHRoaXMuam9pbiA9ICgwLCBfdXRpbHMuZ2V0U3RyaW5nT3B0aW9uKShhdHRyaWJ1dGVzLmpvaW4sIFsic3F1YXJlIiwgInJvdW5kIl0pOwogICAgdGhpcy5wcmVzZW5jZSA9ICgwLCBfdXRpbHMuZ2V0U3RyaW5nT3B0aW9uKShhdHRyaWJ1dGVzLnByZXNlbmNlLCBbInZpc2libGUiLCAiaGlkZGVuIiwgImluYWN0aXZlIiwgImludmlzaWJsZSJdKTsKICAgIHRoaXMucmFkaXVzID0gKDAsIF91dGlscy5nZXRNZWFzdXJlbWVudCkoYXR0cmlidXRlcy5yYWRpdXMpOwogICAgdGhpcy5zdHJva2UgPSAoMCwgX3V0aWxzLmdldFN0cmluZ09wdGlvbikoYXR0cmlidXRlcy5zdHJva2UsIFsic29saWQiLCAiZGFzaERvdCIsICJkYXNoRG90RG90IiwgImRhc2hlZCIsICJkb3R0ZWQiLCAiZW1ib3NzZWQiLCAiZXRjaGVkIiwgImxvd2VyZWQiLCAicmFpc2VkIl0pOwogICAgdGhpcy50aGlja25lc3MgPSAoMCwgX3V0aWxzLmdldE1lYXN1cmVtZW50KShhdHRyaWJ1dGVzLnRoaWNrbmVzcywgIjAuNXB0Iik7CiAgICB0aGlzLnVzZSA9IGF0dHJpYnV0ZXMudXNlIHx8ICIiOwogICAgdGhpcy51c2VocmVmID0gYXR0cmlidXRlcy51c2VocmVmIHx8ICIiOwogICAgdGhpcy5jb2xvciA9IG51bGw7CiAgICB0aGlzLmV4dHJhcyA9IG51bGw7CiAgfQogIFtfc3ltYm9sX3V0aWxzLiR0b1N0eWxlXSgpIHsKICAgIGNvbnN0IHN0eWxlID0gKDAsIF9odG1sX3V0aWxzLnRvU3R5bGUpKHRoaXMsICJ2aXNpYmlsaXR5Iik7CiAgICBzdHlsZS5yYWRpdXMgPSAoMCwgX2h0bWxfdXRpbHMubWVhc3VyZVRvU3RyaW5nKSh0aGlzLmpvaW4gPT09ICJzcXVhcmUiID8gMCA6IHRoaXMucmFkaXVzKTsKICAgIHJldHVybiBzdHlsZTsKICB9Cn0KY2xhc3MgRGF0ZUVsZW1lbnQgZXh0ZW5kcyBfeGZhX29iamVjdC5Db250ZW50T2JqZWN0IHsKICBjb25zdHJ1Y3RvcihhdHRyaWJ1dGVzKSB7CiAgICBzdXBlcihURU1QTEFURV9OU19JRCwgImRhdGUiKTsKICAgIHRoaXMuaWQgPSBhdHRyaWJ1dGVzLmlkIHx8ICIiOwogICAgdGhpcy5uYW1lID0gYXR0cmlidXRlcy5uYW1lIHx8ICIiOwogICAgdGhpcy51c2UgPSBhdHRyaWJ1dGVzLnVzZSB8fCAiIjsKICAgIHRoaXMudXNlaHJlZiA9IGF0dHJpYnV0ZXMudXNlaHJlZiB8fCAiIjsKICB9CiAgW19zeW1ib2xfdXRpbHMuJGZpbmFsaXplXSgpIHsKICAgIGNvbnN0IGRhdGUgPSB0aGlzW19zeW1ib2xfdXRpbHMuJGNvbnRlbnRdLnRyaW0oKTsKICAgIHRoaXNbX3N5bWJvbF91dGlscy4kY29udGVudF0gPSBkYXRlID8gbmV3IERhdGUoZGF0ZSkgOiBudWxsOwogIH0KICBbX3N5bWJvbF91dGlscy4kdG9IVE1MXShhdmFpbGFibGVTcGFjZSkgewogICAgcmV0dXJuIHZhbHVlVG9IdG1sKHRoaXNbX3N5bWJvbF91dGlscy4kY29udGVudF0gPyB0aGlzW19zeW1ib2xfdXRpbHMuJGNvbnRlbnRdLnRvU3RyaW5nKCkgOiAiIik7CiAgfQp9CmNsYXNzIERhdGVUaW1lIGV4dGVuZHMgX3hmYV9vYmplY3QuQ29udGVudE9iamVjdCB7CiAgY29uc3RydWN0b3IoYXR0cmlidXRlcykgewogICAgc3VwZXIoVEVNUExBVEVfTlNfSUQsICJkYXRlVGltZSIpOwogICAgdGhpcy5pZCA9IGF0dHJpYnV0ZXMuaWQgfHwgIiI7CiAgICB0aGlzLm5hbWUgPSBhdHRyaWJ1dGVzLm5hbWUgfHwgIiI7CiAgICB0aGlzLnVzZSA9IGF0dHJpYnV0ZXMudXNlIHx8ICIiOwogICAgdGhpcy51c2VocmVmID0gYXR0cmlidXRlcy51c2VocmVmIHx8ICIiOwogIH0KICBbX3N5bWJvbF91dGlscy4kZmluYWxpemVdKCkgewogICAgY29uc3QgZGF0ZSA9IHRoaXNbX3N5bWJvbF91dGlscy4kY29udGVudF0udHJpbSgpOwogICAgdGhpc1tfc3ltYm9sX3V0aWxzLiRjb250ZW50XSA9IGRhdGUgPyBuZXcgRGF0ZShkYXRlKSA6IG51bGw7CiAgfQogIFtfc3ltYm9sX3V0aWxzLiR0b0hUTUxdKGF2YWlsYWJsZVNwYWNlKSB7CiAgICByZXR1cm4gdmFsdWVUb0h0bWwodGhpc1tfc3ltYm9sX3V0aWxzLiRjb250ZW50XSA/IHRoaXNbX3N5bWJvbF91dGlscy4kY29udGVudF0udG9TdHJpbmcoKSA6ICIiKTsKICB9Cn0KY2xhc3MgRGF0ZVRpbWVFZGl0IGV4dGVuZHMgX3hmYV9vYmplY3QuWEZBT2JqZWN0IHsKICBjb25zdHJ1Y3RvcihhdHRyaWJ1dGVzKSB7CiAgICBzdXBlcihURU1QTEFURV9OU19JRCwgImRhdGVUaW1lRWRpdCIsIHRydWUpOwogICAgdGhpcy5oU2Nyb2xsUG9saWN5ID0gKDAsIF91dGlscy5nZXRTdHJpbmdPcHRpb24pKGF0dHJpYnV0ZXMuaFNjcm9sbFBvbGljeSwgWyJhdXRvIiwgIm9mZiIsICJvbiJdKTsKICAgIHRoaXMuaWQgPSBhdHRyaWJ1dGVzLmlkIHx8ICIiOwogICAgdGhpcy5waWNrZXIgPSAoMCwgX3V0aWxzLmdldFN0cmluZ09wdGlvbikoYXR0cmlidXRlcy5waWNrZXIsIFsiaG9zdCIsICJub25lIl0pOwogICAgdGhpcy51c2UgPSBhdHRyaWJ1dGVzLnVzZSB8fCAiIjsKICAgIHRoaXMudXNlaHJlZiA9IGF0dHJpYnV0ZXMudXNlaHJlZiB8fCAiIjsKICAgIHRoaXMuYm9yZGVyID0gbnVsbDsKICAgIHRoaXMuY29tYiA9IG51bGw7CiAgICB0aGlzLmV4dHJhcyA9IG51bGw7CiAgICB0aGlzLm1hcmdpbiA9IG51bGw7CiAgfQogIFtfc3ltYm9sX3V0aWxzLiR0b0hUTUxdKGF2YWlsYWJsZVNwYWNlKSB7CiAgICBjb25zdCBzdHlsZSA9ICgwLCBfaHRtbF91dGlscy50b1N0eWxlKSh0aGlzLCAiYm9yZGVyIiwgImZvbnQiLCAibWFyZ2luIik7CiAgICBjb25zdCBmaWVsZCA9IHRoaXNbX3N5bWJvbF91dGlscy4kZ2V0UGFyZW50XSgpW19zeW1ib2xfdXRpbHMuJGdldFBhcmVudF0oKTsKICAgIGNvbnN0IGh0bWwgPSB7CiAgICAgIG5hbWU6ICJpbnB1dCIsCiAgICAgIGF0dHJpYnV0ZXM6IHsKICAgICAgICB0eXBlOiAidGV4dCIsCiAgICAgICAgZmllbGRJZDogZmllbGRbX3N5bWJvbF91dGlscy4kdWlkXSwKICAgICAgICBkYXRhSWQ6IGZpZWxkW19zeW1ib2xfdXRpbHMuJGRhdGFdPy5bX3N5bWJvbF91dGlscy4kdWlkXSB8fCBmaWVsZFtfc3ltYm9sX3V0aWxzLiR1aWRdLAogICAgICAgIGNsYXNzOiBbInhmYVRleHRmaWVsZCJdLAogICAgICAgIHN0eWxlLAogICAgICAgICJhcmlhLWxhYmVsIjogYXJpYUxhYmVsKGZpZWxkKSwKICAgICAgICAiYXJpYS1yZXF1aXJlZCI6IGZhbHNlCiAgICAgIH0KICAgIH07CiAgICBpZiAoaXNSZXF1aXJlZChmaWVsZCkpIHsKICAgICAgaHRtbC5hdHRyaWJ1dGVzWyJhcmlhLXJlcXVpcmVkIl0gPSB0cnVlOwogICAgICBodG1sLmF0dHJpYnV0ZXMucmVxdWlyZWQgPSB0cnVlOwogICAgfQogICAgcmV0dXJuIF91dGlscy5IVE1MUmVzdWx0LnN1Y2Nlc3MoewogICAgICBuYW1lOiAibGFiZWwiLAogICAgICBhdHRyaWJ1dGVzOiB7CiAgICAgICAgY2xhc3M6IFsieGZhTGFiZWwiXQogICAgICB9LAogICAgICBjaGlsZHJlbjogW2h0bWxdCiAgICB9KTsKICB9Cn0KY2xhc3MgRGVjaW1hbCBleHRlbmRzIF94ZmFfb2JqZWN0LkNvbnRlbnRPYmplY3QgewogIGNvbnN0cnVjdG9yKGF0dHJpYnV0ZXMpIHsKICAgIHN1cGVyKFRFTVBMQVRFX05TX0lELCAiZGVjaW1hbCIpOwogICAgdGhpcy5mcmFjRGlnaXRzID0gKDAsIF91dGlscy5nZXRJbnRlZ2VyKSh7CiAgICAgIGRhdGE6IGF0dHJpYnV0ZXMuZnJhY0RpZ2l0cywKICAgICAgZGVmYXVsdFZhbHVlOiAyLAogICAgICB2YWxpZGF0ZTogeCA9PiB0cnVlCiAgICB9KTsKICAgIHRoaXMuaWQgPSBhdHRyaWJ1dGVzLmlkIHx8ICIiOwogICAgdGhpcy5sZWFkRGlnaXRzID0gKDAsIF91dGlscy5nZXRJbnRlZ2VyKSh7CiAgICAgIGRhdGE6IGF0dHJpYnV0ZXMubGVhZERpZ2l0cywKICAgICAgZGVmYXVsdFZhbHVlOiAtMSwKICAgICAgdmFsaWRhdGU6IHggPT4gdHJ1ZQogICAgfSk7CiAgICB0aGlzLm5hbWUgPSBhdHRyaWJ1dGVzLm5hbWUgfHwgIiI7CiAgICB0aGlzLnVzZSA9IGF0dHJpYnV0ZXMudXNlIHx8ICIiOwogICAgdGhpcy51c2VocmVmID0gYXR0cmlidXRlcy51c2VocmVmIHx8ICIiOwogIH0KICBbX3N5bWJvbF91dGlscy4kZmluYWxpemVdKCkgewogICAgY29uc3QgbnVtYmVyID0gcGFyc2VGbG9hdCh0aGlzW19zeW1ib2xfdXRpbHMuJGNvbnRlbnRdLnRyaW0oKSk7CiAgICB0aGlzW19zeW1ib2xfdXRpbHMuJGNvbnRlbnRdID0gaXNOYU4obnVtYmVyKSA/IG51bGwgOiBudW1iZXI7CiAgfQogIFtfc3ltYm9sX3V0aWxzLiR0b0hUTUxdKGF2YWlsYWJsZVNwYWNlKSB7CiAgICByZXR1cm4gdmFsdWVUb0h0bWwodGhpc1tfc3ltYm9sX3V0aWxzLiRjb250ZW50XSAhPT0gbnVsbCA/IHRoaXNbX3N5bWJvbF91dGlscy4kY29udGVudF0udG9TdHJpbmcoKSA6ICIiKTsKICB9Cn0KY2xhc3MgRGVmYXVsdFVpIGV4dGVuZHMgX3hmYV9vYmplY3QuWEZBT2JqZWN0IHsKICBjb25zdHJ1Y3RvcihhdHRyaWJ1dGVzKSB7CiAgICBzdXBlcihURU1QTEFURV9OU19JRCwgImRlZmF1bHRVaSIsIHRydWUpOwogICAgdGhpcy5pZCA9IGF0dHJpYnV0ZXMuaWQgfHwgIiI7CiAgICB0aGlzLnVzZSA9IGF0dHJpYnV0ZXMudXNlIHx8ICIiOwogICAgdGhpcy51c2VocmVmID0gYXR0cmlidXRlcy51c2VocmVmIHx8ICIiOwogICAgdGhpcy5leHRyYXMgPSBudWxsOwogIH0KfQpjbGFzcyBEZXNjIGV4dGVuZHMgX3hmYV9vYmplY3QuWEZBT2JqZWN0IHsKICBjb25zdHJ1Y3RvcihhdHRyaWJ1dGVzKSB7CiAgICBzdXBlcihURU1QTEFURV9OU19JRCwgImRlc2MiLCB0cnVlKTsKICAgIHRoaXMuaWQgPSBhdHRyaWJ1dGVzLmlkIHx8ICIiOwogICAgdGhpcy51c2UgPSBhdHRyaWJ1dGVzLnVzZSB8fCAiIjsKICAgIHRoaXMudXNlaHJlZiA9IGF0dHJpYnV0ZXMudXNlaHJlZiB8fCAiIjsKICAgIHRoaXMuYm9vbGVhbiA9IG5ldyBfeGZhX29iamVjdC5YRkFPYmplY3RBcnJheSgpOwogICAgdGhpcy5kYXRlID0gbmV3IF94ZmFfb2JqZWN0LlhGQU9iamVjdEFycmF5KCk7CiAgICB0aGlzLmRhdGVUaW1lID0gbmV3IF94ZmFfb2JqZWN0LlhGQU9iamVjdEFycmF5KCk7CiAgICB0aGlzLmRlY2ltYWwgPSBuZXcgX3hmYV9vYmplY3QuWEZBT2JqZWN0QXJyYXkoKTsKICAgIHRoaXMuZXhEYXRhID0gbmV3IF94ZmFfb2JqZWN0LlhGQU9iamVjdEFycmF5KCk7CiAgICB0aGlzLmZsb2F0ID0gbmV3IF94ZmFfb2JqZWN0LlhGQU9iamVjdEFycmF5KCk7CiAgICB0aGlzLmltYWdlID0gbmV3IF94ZmFfb2JqZWN0LlhGQU9iamVjdEFycmF5KCk7CiAgICB0aGlzLmludGVnZXIgPSBuZXcgX3hmYV9vYmplY3QuWEZBT2JqZWN0QXJyYXkoKTsKICAgIHRoaXMudGV4dCA9IG5ldyBfeGZhX29iamVjdC5YRkFPYmplY3RBcnJheSgpOwogICAgdGhpcy50aW1lID0gbmV3IF94ZmFfb2JqZWN0LlhGQU9iamVjdEFycmF5KCk7CiAgfQp9CmNsYXNzIERpZ2VzdE1ldGhvZCBleHRlbmRzIF94ZmFfb2JqZWN0Lk9wdGlvbk9iamVjdCB7CiAgY29uc3RydWN0b3IoYXR0cmlidXRlcykgewogICAgc3VwZXIoVEVNUExBVEVfTlNfSUQsICJkaWdlc3RNZXRob2QiLCBbIiIsICJTSEExIiwgIlNIQTI1NiIsICJTSEE1MTIiLCAiUklQRU1EMTYwIl0pOwogICAgdGhpcy5pZCA9IGF0dHJpYnV0ZXMuaWQgfHwgIiI7CiAgICB0aGlzLnVzZSA9IGF0dHJpYnV0ZXMudXNlIHx8ICIiOwogICAgdGhpcy51c2VocmVmID0gYXR0cmlidXRlcy51c2VocmVmIHx8ICIiOwogIH0KfQpjbGFzcyBEaWdlc3RNZXRob2RzIGV4dGVuZHMgX3hmYV9vYmplY3QuWEZBT2JqZWN0IHsKICBjb25zdHJ1Y3RvcihhdHRyaWJ1dGVzKSB7CiAgICBzdXBlcihURU1QTEFURV9OU19JRCwgImRpZ2VzdE1ldGhvZHMiLCB0cnVlKTsKICAgIHRoaXMuaWQgPSBhdHRyaWJ1dGVzLmlkIHx8ICIiOwogICAgdGhpcy50eXBlID0gKDAsIF91dGlscy5nZXRTdHJpbmdPcHRpb24pKGF0dHJpYnV0ZXMudHlwZSwgWyJvcHRpb25hbCIsICJyZXF1aXJlZCJdKTsKICAgIHRoaXMudXNlID0gYXR0cmlidXRlcy51c2UgfHwgIiI7CiAgICB0aGlzLnVzZWhyZWYgPSBhdHRyaWJ1dGVzLnVzZWhyZWYgfHwgIiI7CiAgICB0aGlzLmRpZ2VzdE1ldGhvZCA9IG5ldyBfeGZhX29iamVjdC5YRkFPYmplY3RBcnJheSgpOwogIH0KfQpjbGFzcyBEcmF3IGV4dGVuZHMgX3hmYV9vYmplY3QuWEZBT2JqZWN0IHsKICBjb25zdHJ1Y3RvcihhdHRyaWJ1dGVzKSB7CiAgICBzdXBlcihURU1QTEFURV9OU19JRCwgImRyYXciLCB0cnVlKTsKICAgIHRoaXMuYW5jaG9yVHlwZSA9ICgwLCBfdXRpbHMuZ2V0U3RyaW5nT3B0aW9uKShhdHRyaWJ1dGVzLmFuY2hvclR5cGUsIFsidG9wTGVmdCIsICJib3R0b21DZW50ZXIiLCAiYm90dG9tTGVmdCIsICJib3R0b21SaWdodCIsICJtaWRkbGVDZW50ZXIiLCAibWlkZGxlTGVmdCIsICJtaWRkbGVSaWdodCIsICJ0b3BDZW50ZXIiLCAidG9wUmlnaHQiXSk7CiAgICB0aGlzLmNvbFNwYW4gPSAoMCwgX3V0aWxzLmdldEludGVnZXIpKHsKICAgICAgZGF0YTogYXR0cmlidXRlcy5jb2xTcGFuLAogICAgICBkZWZhdWx0VmFsdWU6IDEsCiAgICAgIHZhbGlkYXRlOiBuID0+IG4gPj0gMSB8fCBuID09PSAtMQogICAgfSk7CiAgICB0aGlzLmggPSBhdHRyaWJ1dGVzLmggPyAoMCwgX3V0aWxzLmdldE1lYXN1cmVtZW50KShhdHRyaWJ1dGVzLmgpIDogIiI7CiAgICB0aGlzLmhBbGlnbiA9ICgwLCBfdXRpbHMuZ2V0U3RyaW5nT3B0aW9uKShhdHRyaWJ1dGVzLmhBbGlnbiwgWyJsZWZ0IiwgImNlbnRlciIsICJqdXN0aWZ5IiwgImp1c3RpZnlBbGwiLCAicmFkaXgiLCAicmlnaHQiXSk7CiAgICB0aGlzLmlkID0gYXR0cmlidXRlcy5pZCB8fCAiIjsKICAgIHRoaXMubG9jYWxlID0gYXR0cmlidXRlcy5sb2NhbGUgfHwgIiI7CiAgICB0aGlzLm1heEggPSAoMCwgX3V0aWxzLmdldE1lYXN1cmVtZW50KShhdHRyaWJ1dGVzLm1heEgsICIwcHQiKTsKICAgIHRoaXMubWF4VyA9ICgwLCBfdXRpbHMuZ2V0TWVhc3VyZW1lbnQpKGF0dHJpYnV0ZXMubWF4VywgIjBwdCIpOwogICAgdGhpcy5taW5IID0gKDAsIF91dGlscy5nZXRNZWFzdXJlbWVudCkoYXR0cmlidXRlcy5taW5ILCAiMHB0Iik7CiAgICB0aGlzLm1pblcgPSAoMCwgX3V0aWxzLmdldE1lYXN1cmVtZW50KShhdHRyaWJ1dGVzLm1pblcsICIwcHQiKTsKICAgIHRoaXMubmFtZSA9IGF0dHJpYnV0ZXMubmFtZSB8fCAiIjsKICAgIHRoaXMucHJlc2VuY2UgPSAoMCwgX3V0aWxzLmdldFN0cmluZ09wdGlvbikoYXR0cmlidXRlcy5wcmVzZW5jZSwgWyJ2aXNpYmxlIiwgImhpZGRlbiIsICJpbmFjdGl2ZSIsICJpbnZpc2libGUiXSk7CiAgICB0aGlzLnJlbGV2YW50ID0gKDAsIF91dGlscy5nZXRSZWxldmFudCkoYXR0cmlidXRlcy5yZWxldmFudCk7CiAgICB0aGlzLnJvdGF0ZSA9ICgwLCBfdXRpbHMuZ2V0SW50ZWdlcikoewogICAgICBkYXRhOiBhdHRyaWJ1dGVzLnJvdGF0ZSwKICAgICAgZGVmYXVsdFZhbHVlOiAwLAogICAgICB2YWxpZGF0ZTogeCA9PiB4ICUgOTAgPT09IDAKICAgIH0pOwogICAgdGhpcy51c2UgPSBhdHRyaWJ1dGVzLnVzZSB8fCAiIjsKICAgIHRoaXMudXNlaHJlZiA9IGF0dHJpYnV0ZXMudXNlaHJlZiB8fCAiIjsKICAgIHRoaXMudyA9IGF0dHJpYnV0ZXMudyA/ICgwLCBfdXRpbHMuZ2V0TWVhc3VyZW1lbnQpKGF0dHJpYnV0ZXMudykgOiAiIjsKICAgIHRoaXMueCA9ICgwLCBfdXRpbHMuZ2V0TWVhc3VyZW1lbnQpKGF0dHJpYnV0ZXMueCwgIjBwdCIpOwogICAgdGhpcy55ID0gKDAsIF91dGlscy5nZXRNZWFzdXJlbWVudCkoYXR0cmlidXRlcy55LCAiMHB0Iik7CiAgICB0aGlzLmFzc2lzdCA9IG51bGw7CiAgICB0aGlzLmJvcmRlciA9IG51bGw7CiAgICB0aGlzLmNhcHRpb24gPSBudWxsOwogICAgdGhpcy5kZXNjID0gbnVsbDsKICAgIHRoaXMuZXh0cmFzID0gbnVsbDsKICAgIHRoaXMuZm9udCA9IG51bGw7CiAgICB0aGlzLmtlZXAgPSBudWxsOwogICAgdGhpcy5tYXJnaW4gPSBudWxsOwogICAgdGhpcy5wYXJhID0gbnVsbDsKICAgIHRoaXMudHJhdmVyc2FsID0gbnVsbDsKICAgIHRoaXMudWkgPSBudWxsOwogICAgdGhpcy52YWx1ZSA9IG51bGw7CiAgICB0aGlzLnNldFByb3BlcnR5ID0gbmV3IF94ZmFfb2JqZWN0LlhGQU9iamVjdEFycmF5KCk7CiAgfQogIFtfc3ltYm9sX3V0aWxzLiRzZXRWYWx1ZV0odmFsdWUpIHsKICAgIF9zZXRWYWx1ZSh0aGlzLCB2YWx1ZSk7CiAgfQogIFtfc3ltYm9sX3V0aWxzLiR0b0hUTUxdKGF2YWlsYWJsZVNwYWNlKSB7CiAgICBzZXRUYWJJbmRleCh0aGlzKTsKICAgIGlmICh0aGlzLnByZXNlbmNlID09PSAiaGlkZGVuIiB8fCB0aGlzLnByZXNlbmNlID09PSAiaW5hY3RpdmUiKSB7CiAgICAgIHJldHVybiBfdXRpbHMuSFRNTFJlc3VsdC5FTVBUWTsKICAgIH0KICAgICgwLCBfaHRtbF91dGlscy5maXhEaW1lbnNpb25zKSh0aGlzKTsKICAgIHRoaXNbX3N5bWJvbF91dGlscy4kcHVzaFBhcmFdKCk7CiAgICBjb25zdCBzYXZlZFcgPSB0aGlzLnc7CiAgICBjb25zdCBzYXZlZEggPSB0aGlzLmg7CiAgICBjb25zdCB7CiAgICAgIHcsCiAgICAgIGgsCiAgICAgIGlzQnJva2VuCiAgICB9ID0gKDAsIF9odG1sX3V0aWxzLmxheW91dE5vZGUpKHRoaXMsIGF2YWlsYWJsZVNwYWNlKTsKICAgIGlmICh3ICYmIHRoaXMudyA9PT0gIiIpIHsKICAgICAgaWYgKGlzQnJva2VuICYmIHRoaXNbX3N5bWJvbF91dGlscy4kZ2V0U3ViZm9ybVBhcmVudF0oKVtfc3ltYm9sX3V0aWxzLiRpc1RoZXJlTW9yZVdpZHRoXSgpKSB7CiAgICAgICAgdGhpc1tfc3ltYm9sX3V0aWxzLiRwb3BQYXJhXSgpOwogICAgICAgIHJldHVybiBfdXRpbHMuSFRNTFJlc3VsdC5GQUlMVVJFOwogICAgICB9CiAgICAgIHRoaXMudyA9IHc7CiAgICB9CiAgICBpZiAoaCAmJiB0aGlzLmggPT09ICIiKSB7CiAgICAgIHRoaXMuaCA9IGg7CiAgICB9CiAgICBzZXRGaXJzdFVuc3BsaXR0YWJsZSh0aGlzKTsKICAgIGlmICghKDAsIF9sYXlvdXQuY2hlY2tEaW1lbnNpb25zKSh0aGlzLCBhdmFpbGFibGVTcGFjZSkpIHsKICAgICAgdGhpcy53ID0gc2F2ZWRXOwogICAgICB0aGlzLmggPSBzYXZlZEg7CiAgICAgIHRoaXNbX3N5bWJvbF91dGlscy4kcG9wUGFyYV0oKTsKICAgICAgcmV0dXJuIF91dGlscy5IVE1MUmVzdWx0LkZBSUxVUkU7CiAgICB9CiAgICB1bnNldEZpcnN0VW5zcGxpdHRhYmxlKHRoaXMpOwogICAgY29uc3Qgc3R5bGUgPSAoMCwgX2h0bWxfdXRpbHMudG9TdHlsZSkodGhpcywgImZvbnQiLCAiaEFsaWduIiwgImRpbWVuc2lvbnMiLCAicG9zaXRpb24iLCAicHJlc2VuY2UiLCAicm90YXRlIiwgImFuY2hvclR5cGUiLCAiYm9yZGVyIiwgIm1hcmdpbiIpOwogICAgKDAsIF9odG1sX3V0aWxzLnNldE1pbk1heERpbWVuc2lvbnMpKHRoaXMsIHN0eWxlKTsKICAgIGlmIChzdHlsZS5tYXJnaW4pIHsKICAgICAgc3R5bGUucGFkZGluZyA9IHN0eWxlLm1hcmdpbjsKICAgICAgZGVsZXRlIHN0eWxlLm1hcmdpbjsKICAgIH0KICAgIGNvbnN0IGNsYXNzTmFtZXMgPSBbInhmYURyYXciXTsKICAgIGlmICh0aGlzLmZvbnQpIHsKICAgICAgY2xhc3NOYW1lcy5wdXNoKCJ4ZmFGb250Iik7CiAgICB9CiAgICBpZiAoKDAsIF9odG1sX3V0aWxzLmlzUHJpbnRPbmx5KSh0aGlzKSkgewogICAgICBjbGFzc05hbWVzLnB1c2goInhmYVByaW50T25seSIpOwogICAgfQogICAgY29uc3QgYXR0cmlidXRlcyA9IHsKICAgICAgc3R5bGUsCiAgICAgIGlkOiB0aGlzW19zeW1ib2xfdXRpbHMuJHVpZF0sCiAgICAgIGNsYXNzOiBjbGFzc05hbWVzCiAgICB9OwogICAgaWYgKHRoaXMubmFtZSkgewogICAgICBhdHRyaWJ1dGVzLnhmYU5hbWUgPSB0aGlzLm5hbWU7CiAgICB9CiAgICBjb25zdCBodG1sID0gewogICAgICBuYW1lOiAiZGl2IiwKICAgICAgYXR0cmlidXRlcywKICAgICAgY2hpbGRyZW46IFtdCiAgICB9OwogICAgYXBwbHlBc3Npc3QodGhpcywgYXR0cmlidXRlcyk7CiAgICBjb25zdCBiYm94ID0gKDAsIF9odG1sX3V0aWxzLmNvbXB1dGVCYm94KSh0aGlzLCBodG1sLCBhdmFpbGFibGVTcGFjZSk7CiAgICBjb25zdCB2YWx1ZSA9IHRoaXMudmFsdWUgPyB0aGlzLnZhbHVlW19zeW1ib2xfdXRpbHMuJHRvSFRNTF0oYXZhaWxhYmxlU3BhY2UpLmh0bWwgOiBudWxsOwogICAgaWYgKHZhbHVlID09PSBudWxsKSB7CiAgICAgIHRoaXMudyA9IHNhdmVkVzsKICAgICAgdGhpcy5oID0gc2F2ZWRIOwogICAgICB0aGlzW19zeW1ib2xfdXRpbHMuJHBvcFBhcmFdKCk7CiAgICAgIHJldHVybiBfdXRpbHMuSFRNTFJlc3VsdC5zdWNjZXNzKCgwLCBfaHRtbF91dGlscy5jcmVhdGVXcmFwcGVyKSh0aGlzLCBodG1sKSwgYmJveCk7CiAgICB9CiAgICBodG1sLmNoaWxkcmVuLnB1c2godmFsdWUpOwogICAgKDAsIF9odG1sX3V0aWxzLnNldFBhcmEpKHRoaXMsIHN0eWxlLCB2YWx1ZSk7CiAgICB0aGlzLncgPSBzYXZlZFc7CiAgICB0aGlzLmggPSBzYXZlZEg7CiAgICB0aGlzW19zeW1ib2xfdXRpbHMuJHBvcFBhcmFdKCk7CiAgICByZXR1cm4gX3V0aWxzLkhUTUxSZXN1bHQuc3VjY2VzcygoMCwgX2h0bWxfdXRpbHMuY3JlYXRlV3JhcHBlcikodGhpcywgaHRtbCksIGJib3gpOwogIH0KfQpjbGFzcyBFZGdlIGV4dGVuZHMgX3hmYV9vYmplY3QuWEZBT2JqZWN0IHsKICBjb25zdHJ1Y3RvcihhdHRyaWJ1dGVzKSB7CiAgICBzdXBlcihURU1QTEFURV9OU19JRCwgImVkZ2UiLCB0cnVlKTsKICAgIHRoaXMuY2FwID0gKDAsIF91dGlscy5nZXRTdHJpbmdPcHRpb24pKGF0dHJpYnV0ZXMuY2FwLCBbInNxdWFyZSIsICJidXR0IiwgInJvdW5kIl0pOwogICAgdGhpcy5pZCA9IGF0dHJpYnV0ZXMuaWQgfHwgIiI7CiAgICB0aGlzLnByZXNlbmNlID0gKDAsIF91dGlscy5nZXRTdHJpbmdPcHRpb24pKGF0dHJpYnV0ZXMucHJlc2VuY2UsIFsidmlzaWJsZSIsICJoaWRkZW4iLCAiaW5hY3RpdmUiLCAiaW52aXNpYmxlIl0pOwogICAgdGhpcy5zdHJva2UgPSAoMCwgX3V0aWxzLmdldFN0cmluZ09wdGlvbikoYXR0cmlidXRlcy5zdHJva2UsIFsic29saWQiLCAiZGFzaERvdCIsICJkYXNoRG90RG90IiwgImRhc2hlZCIsICJkb3R0ZWQiLCAiZW1ib3NzZWQiLCAiZXRjaGVkIiwgImxvd2VyZWQiLCAicmFpc2VkIl0pOwogICAgdGhpcy50aGlja25lc3MgPSAoMCwgX3V0aWxzLmdldE1lYXN1cmVtZW50KShhdHRyaWJ1dGVzLnRoaWNrbmVzcywgIjAuNXB0Iik7CiAgICB0aGlzLnVzZSA9IGF0dHJpYnV0ZXMudXNlIHx8ICIiOwogICAgdGhpcy51c2VocmVmID0gYXR0cmlidXRlcy51c2VocmVmIHx8ICIiOwogICAgdGhpcy5jb2xvciA9IG51bGw7CiAgICB0aGlzLmV4dHJhcyA9IG51bGw7CiAgfQogIFtfc3ltYm9sX3V0aWxzLiR0b1N0eWxlXSgpIHsKICAgIGNvbnN0IHN0eWxlID0gKDAsIF9odG1sX3V0aWxzLnRvU3R5bGUpKHRoaXMsICJ2aXNpYmlsaXR5Iik7CiAgICBPYmplY3QuYXNzaWduKHN0eWxlLCB7CiAgICAgIGxpbmVjYXA6IHRoaXMuY2FwLAogICAgICB3aWR0aDogKDAsIF9odG1sX3V0aWxzLm1lYXN1cmVUb1N0cmluZykodGhpcy50aGlja25lc3MpLAogICAgICBjb2xvcjogdGhpcy5jb2xvciA/IHRoaXMuY29sb3JbX3N5bWJvbF91dGlscy4kdG9TdHlsZV0oKSA6ICIjMDAwMDAwIiwKICAgICAgc3R5bGU6ICIiCiAgICB9KTsKICAgIGlmICh0aGlzLnByZXNlbmNlICE9PSAidmlzaWJsZSIpIHsKICAgICAgc3R5bGUuc3R5bGUgPSAibm9uZSI7CiAgICB9IGVsc2UgewogICAgICBzd2l0Y2ggKHRoaXMuc3Ryb2tlKSB7CiAgICAgICAgY2FzZSAic29saWQiOgogICAgICAgICAgc3R5bGUuc3R5bGUgPSAic29saWQiOwogICAgICAgICAgYnJlYWs7CiAgICAgICAgY2FzZSAiZGFzaERvdCI6CiAgICAgICAgICBzdHlsZS5zdHlsZSA9ICJkYXNoZWQiOwogICAgICAgICAgYnJlYWs7CiAgICAgICAgY2FzZSAiZGFzaERvdERvdCI6CiAgICAgICAgICBzdHlsZS5zdHlsZSA9ICJkYXNoZWQiOwogICAgICAgICAgYnJlYWs7CiAgICAgICAgY2FzZSAiZGFzaGVkIjoKICAgICAgICAgIHN0eWxlLnN0eWxlID0gImRhc2hlZCI7CiAgICAgICAgICBicmVhazsKICAgICAgICBjYXNlICJkb3R0ZWQiOgogICAgICAgICAgc3R5bGUuc3R5bGUgPSAiZG90dGVkIjsKICAgICAgICAgIGJyZWFrOwogICAgICAgIGNhc2UgImVtYm9zc2VkIjoKICAgICAgICAgIHN0eWxlLnN0eWxlID0gInJpZGdlIjsKICAgICAgICAgIGJyZWFrOwogICAgICAgIGNhc2UgImV0Y2hlZCI6CiAgICAgICAgICBzdHlsZS5zdHlsZSA9ICJncm9vdmUiOwogICAgICAgICAgYnJlYWs7CiAgICAgICAgY2FzZSAibG93ZXJlZCI6CiAgICAgICAgICBzdHlsZS5zdHlsZSA9ICJpbnNldCI7CiAgICAgICAgICBicmVhazsKICAgICAgICBjYXNlICJyYWlzZWQiOgogICAgICAgICAgc3R5bGUuc3R5bGUgPSAib3V0c2V0IjsKICAgICAgICAgIGJyZWFrOwogICAgICB9CiAgICB9CiAgICByZXR1cm4gc3R5bGU7CiAgfQp9CmNsYXNzIEVuY29kaW5nIGV4dGVuZHMgX3hmYV9vYmplY3QuT3B0aW9uT2JqZWN0IHsKICBjb25zdHJ1Y3RvcihhdHRyaWJ1dGVzKSB7CiAgICBzdXBlcihURU1QTEFURV9OU19JRCwgImVuY29kaW5nIiwgWyJhZGJlLng1MDkucnNhX3NoYTEiLCAiYWRiZS5wa2NzNy5kZXRhY2hlZCIsICJhZGJlLnBrY3M3LnNoYTEiXSk7CiAgICB0aGlzLmlkID0gYXR0cmlidXRlcy5pZCB8fCAiIjsKICAgIHRoaXMudXNlID0gYXR0cmlidXRlcy51c2UgfHwgIiI7CiAgICB0aGlzLnVzZWhyZWYgPSBhdHRyaWJ1dGVzLnVzZWhyZWYgfHwgIiI7CiAgfQp9CmNsYXNzIEVuY29kaW5ncyBleHRlbmRzIF94ZmFfb2JqZWN0LlhGQU9iamVjdCB7CiAgY29uc3RydWN0b3IoYXR0cmlidXRlcykgewogICAgc3VwZXIoVEVNUExBVEVfTlNfSUQsICJlbmNvZGluZ3MiLCB0cnVlKTsKICAgIHRoaXMuaWQgPSBhdHRyaWJ1dGVzLmlkIHx8ICIiOwogICAgdGhpcy50eXBlID0gKDAsIF91dGlscy5nZXRTdHJpbmdPcHRpb24pKGF0dHJpYnV0ZXMudHlwZSwgWyJvcHRpb25hbCIsICJyZXF1aXJlZCJdKTsKICAgIHRoaXMudXNlID0gYXR0cmlidXRlcy51c2UgfHwgIiI7CiAgICB0aGlzLnVzZWhyZWYgPSBhdHRyaWJ1dGVzLnVzZWhyZWYgfHwgIiI7CiAgICB0aGlzLmVuY29kaW5nID0gbmV3IF94ZmFfb2JqZWN0LlhGQU9iamVjdEFycmF5KCk7CiAgfQp9CmNsYXNzIEVuY3J5cHQgZXh0ZW5kcyBfeGZhX29iamVjdC5YRkFPYmplY3QgewogIGNvbnN0cnVjdG9yKGF0dHJpYnV0ZXMpIHsKICAgIHN1cGVyKFRFTVBMQVRFX05TX0lELCAiZW5jcnlwdCIsIHRydWUpOwogICAgdGhpcy5pZCA9IGF0dHJpYnV0ZXMuaWQgfHwgIiI7CiAgICB0aGlzLnVzZSA9IGF0dHJpYnV0ZXMudXNlIHx8ICIiOwogICAgdGhpcy51c2VocmVmID0gYXR0cmlidXRlcy51c2VocmVmIHx8ICIiOwogICAgdGhpcy5jZXJ0aWZpY2F0ZSA9IG51bGw7CiAgfQp9CmNsYXNzIEVuY3J5cHREYXRhIGV4dGVuZHMgX3hmYV9vYmplY3QuWEZBT2JqZWN0IHsKICBjb25zdHJ1Y3RvcihhdHRyaWJ1dGVzKSB7CiAgICBzdXBlcihURU1QTEFURV9OU19JRCwgImVuY3J5cHREYXRhIiwgdHJ1ZSk7CiAgICB0aGlzLmlkID0gYXR0cmlidXRlcy5pZCB8fCAiIjsKICAgIHRoaXMub3BlcmF0aW9uID0gKDAsIF91dGlscy5nZXRTdHJpbmdPcHRpb24pKGF0dHJpYnV0ZXMub3BlcmF0aW9uLCBbImVuY3J5cHQiLCAiZGVjcnlwdCJdKTsKICAgIHRoaXMudGFyZ2V0ID0gYXR0cmlidXRlcy50YXJnZXQgfHwgIiI7CiAgICB0aGlzLnVzZSA9IGF0dHJpYnV0ZXMudXNlIHx8ICIiOwogICAgdGhpcy51c2VocmVmID0gYXR0cmlidXRlcy51c2VocmVmIHx8ICIiOwogICAgdGhpcy5maWx0ZXIgPSBudWxsOwogICAgdGhpcy5tYW5pZmVzdCA9IG51bGw7CiAgfQp9CmNsYXNzIEVuY3J5cHRpb24gZXh0ZW5kcyBfeGZhX29iamVjdC5YRkFPYmplY3QgewogIGNvbnN0cnVjdG9yKGF0dHJpYnV0ZXMpIHsKICAgIHN1cGVyKFRFTVBMQVRFX05TX0lELCAiZW5jcnlwdGlvbiIsIHRydWUpOwogICAgdGhpcy5pZCA9IGF0dHJpYnV0ZXMuaWQgfHwgIiI7CiAgICB0aGlzLnR5cGUgPSAoMCwgX3V0aWxzLmdldFN0cmluZ09wdGlvbikoYXR0cmlidXRlcy50eXBlLCBbIm9wdGlvbmFsIiwgInJlcXVpcmVkIl0pOwogICAgdGhpcy51c2UgPSBhdHRyaWJ1dGVzLnVzZSB8fCAiIjsKICAgIHRoaXMudXNlaHJlZiA9IGF0dHJpYnV0ZXMudXNlaHJlZiB8fCAiIjsKICAgIHRoaXMuY2VydGlmaWNhdGUgPSBuZXcgX3hmYV9vYmplY3QuWEZBT2JqZWN0QXJyYXkoKTsKICB9Cn0KY2xhc3MgRW5jcnlwdGlvbk1ldGhvZCBleHRlbmRzIF94ZmFfb2JqZWN0Lk9wdGlvbk9iamVjdCB7CiAgY29uc3RydWN0b3IoYXR0cmlidXRlcykgewogICAgc3VwZXIoVEVNUExBVEVfTlNfSUQsICJlbmNyeXB0aW9uTWV0aG9kIiwgWyIiLCAiQUVTMjU2LUNCQyIsICJUUklQTEVERVMtQ0JDIiwgIkFFUzEyOC1DQkMiLCAiQUVTMTkyLUNCQyJdKTsKICAgIHRoaXMuaWQgPSBhdHRyaWJ1dGVzLmlkIHx8ICIiOwogICAgdGhpcy51c2UgPSBhdHRyaWJ1dGVzLnVzZSB8fCAiIjsKICAgIHRoaXMudXNlaHJlZiA9IGF0dHJpYnV0ZXMudXNlaHJlZiB8fCAiIjsKICB9Cn0KY2xhc3MgRW5jcnlwdGlvbk1ldGhvZHMgZXh0ZW5kcyBfeGZhX29iamVjdC5YRkFPYmplY3QgewogIGNvbnN0cnVjdG9yKGF0dHJpYnV0ZXMpIHsKICAgIHN1cGVyKFRFTVBMQVRFX05TX0lELCAiZW5jcnlwdGlvbk1ldGhvZHMiLCB0cnVlKTsKICAgIHRoaXMuaWQgPSBhdHRyaWJ1dGVzLmlkIHx8ICIiOwogICAgdGhpcy50eXBlID0gKDAsIF91dGlscy5nZXRTdHJpbmdPcHRpb24pKGF0dHJpYnV0ZXMudHlwZSwgWyJvcHRpb25hbCIsICJyZXF1aXJlZCJdKTsKICAgIHRoaXMudXNlID0gYXR0cmlidXRlcy51c2UgfHwgIiI7CiAgICB0aGlzLnVzZWhyZWYgPSBhdHRyaWJ1dGVzLnVzZWhyZWYgfHwgIiI7CiAgICB0aGlzLmVuY3J5cHRpb25NZXRob2QgPSBuZXcgX3hmYV9vYmplY3QuWEZBT2JqZWN0QXJyYXkoKTsKICB9Cn0KY2xhc3MgRXZlbnQgZXh0ZW5kcyBfeGZhX29iamVjdC5YRkFPYmplY3QgewogIGNvbnN0cnVjdG9yKGF0dHJpYnV0ZXMpIHsKICAgIHN1cGVyKFRFTVBMQVRFX05TX0lELCAiZXZlbnQiLCB0cnVlKTsKICAgIHRoaXMuYWN0aXZpdHkgPSAoMCwgX3V0aWxzLmdldFN0cmluZ09wdGlvbikoYXR0cmlidXRlcy5hY3Rpdml0eSwgWyJjbGljayIsICJjaGFuZ2UiLCAiZG9jQ2xvc2UiLCAiZG9jUmVhZHkiLCAiZW50ZXIiLCAiZXhpdCIsICJmdWxsIiwgImluZGV4Q2hhbmdlIiwgImluaXRpYWxpemUiLCAibW91c2VEb3duIiwgIm1vdXNlRW50ZXIiLCAibW91c2VFeGl0IiwgIm1vdXNlVXAiLCAicG9zdEV4ZWN1dGUiLCAicG9zdE9wZW4iLCAicG9zdFByaW50IiwgInBvc3RTYXZlIiwgInBvc3RTaWduIiwgInBvc3RTdWJtaXQiLCAicHJlRXhlY3V0ZSIsICJwcmVPcGVuIiwgInByZVByaW50IiwgInByZVNhdmUiLCAicHJlU2lnbiIsICJwcmVTdWJtaXQiLCAicmVhZHkiLCAidmFsaWRhdGlvblN0YXRlIl0pOwogICAgdGhpcy5pZCA9IGF0dHJpYnV0ZXMuaWQgfHwgIiI7CiAgICB0aGlzLmxpc3RlbiA9ICgwLCBfdXRpbHMuZ2V0U3RyaW5nT3B0aW9uKShhdHRyaWJ1dGVzLmxpc3RlbiwgWyJyZWZPbmx5IiwgInJlZkFuZERlc2NlbmRlbnRzIl0pOwogICAgdGhpcy5uYW1lID0gYXR0cmlidXRlcy5uYW1lIHx8ICIiOwogICAgdGhpcy5yZWYgPSBhdHRyaWJ1dGVzLnJlZiB8fCAiIjsKICAgIHRoaXMudXNlID0gYXR0cmlidXRlcy51c2UgfHwgIiI7CiAgICB0aGlzLnVzZWhyZWYgPSBhdHRyaWJ1dGVzLnVzZWhyZWYgfHwgIiI7CiAgICB0aGlzLmV4dHJhcyA9IG51bGw7CiAgICB0aGlzLmVuY3J5cHREYXRhID0gbnVsbDsKICAgIHRoaXMuZXhlY3V0ZSA9IG51bGw7CiAgICB0aGlzLnNjcmlwdCA9IG51bGw7CiAgICB0aGlzLnNpZ25EYXRhID0gbnVsbDsKICAgIHRoaXMuc3VibWl0ID0gbnVsbDsKICB9Cn0KY2xhc3MgRXhEYXRhIGV4dGVuZHMgX3hmYV9vYmplY3QuQ29udGVudE9iamVjdCB7CiAgY29uc3RydWN0b3IoYXR0cmlidXRlcykgewogICAgc3VwZXIoVEVNUExBVEVfTlNfSUQsICJleERhdGEiKTsKICAgIHRoaXMuY29udGVudFR5cGUgPSBhdHRyaWJ1dGVzLmNvbnRlbnRUeXBlIHx8ICIiOwogICAgdGhpcy5ocmVmID0gYXR0cmlidXRlcy5ocmVmIHx8ICIiOwogICAgdGhpcy5pZCA9IGF0dHJpYnV0ZXMuaWQgfHwgIiI7CiAgICB0aGlzLm1heExlbmd0aCA9ICgwLCBfdXRpbHMuZ2V0SW50ZWdlcikoewogICAgICBkYXRhOiBhdHRyaWJ1dGVzLm1heExlbmd0aCwKICAgICAgZGVmYXVsdFZhbHVlOiAtMSwKICAgICAgdmFsaWRhdGU6IHggPT4geCA+PSAtMQogICAgfSk7CiAgICB0aGlzLm5hbWUgPSBhdHRyaWJ1dGVzLm5hbWUgfHwgIiI7CiAgICB0aGlzLnJpZCA9IGF0dHJpYnV0ZXMucmlkIHx8ICIiOwogICAgdGhpcy50cmFuc2ZlckVuY29kaW5nID0gKDAsIF91dGlscy5nZXRTdHJpbmdPcHRpb24pKGF0dHJpYnV0ZXMudHJhbnNmZXJFbmNvZGluZywgWyJub25lIiwgImJhc2U2NCIsICJwYWNrYWdlIl0pOwogICAgdGhpcy51c2UgPSBhdHRyaWJ1dGVzLnVzZSB8fCAiIjsKICAgIHRoaXMudXNlaHJlZiA9IGF0dHJpYnV0ZXMudXNlaHJlZiB8fCAiIjsKICB9CiAgW19zeW1ib2xfdXRpbHMuJGlzQ0RBVEFYbWxdKCkgewogICAgcmV0dXJuIHRoaXMuY29udGVudFR5cGUgPT09ICJ0ZXh0L2h0bWwiOwogIH0KICBbX3N5bWJvbF91dGlscy4kb25DaGlsZF0oY2hpbGQpIHsKICAgIGlmICh0aGlzLmNvbnRlbnRUeXBlID09PSAidGV4dC9odG1sIiAmJiBjaGlsZFtfc3ltYm9sX3V0aWxzLiRuYW1lc3BhY2VJZF0gPT09IF9uYW1lc3BhY2VzLk5hbWVzcGFjZUlkcy54aHRtbC5pZCkgewogICAgICB0aGlzW19zeW1ib2xfdXRpbHMuJGNvbnRlbnRdID0gY2hpbGQ7CiAgICAgIHJldHVybiB0cnVlOwogICAgfQogICAgaWYgKHRoaXMuY29udGVudFR5cGUgPT09ICJ0ZXh0L3htbCIpIHsKICAgICAgdGhpc1tfc3ltYm9sX3V0aWxzLiRjb250ZW50XSA9IGNoaWxkOwogICAgICByZXR1cm4gdHJ1ZTsKICAgIH0KICAgIHJldHVybiBmYWxzZTsKICB9CiAgW19zeW1ib2xfdXRpbHMuJHRvSFRNTF0oYXZhaWxhYmxlU3BhY2UpIHsKICAgIGlmICh0aGlzLmNvbnRlbnRUeXBlICE9PSAidGV4dC9odG1sIiB8fCAhdGhpc1tfc3ltYm9sX3V0aWxzLiRjb250ZW50XSkgewogICAgICByZXR1cm4gX3V0aWxzLkhUTUxSZXN1bHQuRU1QVFk7CiAgICB9CiAgICByZXR1cm4gdGhpc1tfc3ltYm9sX3V0aWxzLiRjb250ZW50XVtfc3ltYm9sX3V0aWxzLiR0b0hUTUxdKGF2YWlsYWJsZVNwYWNlKTsKICB9Cn0KY2xhc3MgRXhPYmplY3QgZXh0ZW5kcyBfeGZhX29iamVjdC5YRkFPYmplY3QgewogIGNvbnN0cnVjdG9yKGF0dHJpYnV0ZXMpIHsKICAgIHN1cGVyKFRFTVBMQVRFX05TX0lELCAiZXhPYmplY3QiLCB0cnVlKTsKICAgIHRoaXMuYXJjaGl2ZSA9IGF0dHJpYnV0ZXMuYXJjaGl2ZSB8fCAiIjsKICAgIHRoaXMuY2xhc3NJZCA9IGF0dHJpYnV0ZXMuY2xhc3NJZCB8fCAiIjsKICAgIHRoaXMuY29kZUJhc2UgPSBhdHRyaWJ1dGVzLmNvZGVCYXNlIHx8ICIiOwogICAgdGhpcy5jb2RlVHlwZSA9IGF0dHJpYnV0ZXMuY29kZVR5cGUgfHwgIiI7CiAgICB0aGlzLmlkID0gYXR0cmlidXRlcy5pZCB8fCAiIjsKICAgIHRoaXMubmFtZSA9IGF0dHJpYnV0ZXMubmFtZSB8fCAiIjsKICAgIHRoaXMudXNlID0gYXR0cmlidXRlcy51c2UgfHwgIiI7CiAgICB0aGlzLnVzZWhyZWYgPSBhdHRyaWJ1dGVzLnVzZWhyZWYgfHwgIiI7CiAgICB0aGlzLmV4dHJhcyA9IG51bGw7CiAgICB0aGlzLmJvb2xlYW4gPSBuZXcgX3hmYV9vYmplY3QuWEZBT2JqZWN0QXJyYXkoKTsKICAgIHRoaXMuZGF0ZSA9IG5ldyBfeGZhX29iamVjdC5YRkFPYmplY3RBcnJheSgpOwogICAgdGhpcy5kYXRlVGltZSA9IG5ldyBfeGZhX29iamVjdC5YRkFPYmplY3RBcnJheSgpOwogICAgdGhpcy5kZWNpbWFsID0gbmV3IF94ZmFfb2JqZWN0LlhGQU9iamVjdEFycmF5KCk7CiAgICB0aGlzLmV4RGF0YSA9IG5ldyBfeGZhX29iamVjdC5YRkFPYmplY3RBcnJheSgpOwogICAgdGhpcy5leE9iamVjdCA9IG5ldyBfeGZhX29iamVjdC5YRkFPYmplY3RBcnJheSgpOwogICAgdGhpcy5mbG9hdCA9IG5ldyBfeGZhX29iamVjdC5YRkFPYmplY3RBcnJheSgpOwogICAgdGhpcy5pbWFnZSA9IG5ldyBfeGZhX29iamVjdC5YRkFPYmplY3RBcnJheSgpOwogICAgdGhpcy5pbnRlZ2VyID0gbmV3IF94ZmFfb2JqZWN0LlhGQU9iamVjdEFycmF5KCk7CiAgICB0aGlzLnRleHQgPSBuZXcgX3hmYV9vYmplY3QuWEZBT2JqZWN0QXJyYXkoKTsKICAgIHRoaXMudGltZSA9IG5ldyBfeGZhX29iamVjdC5YRkFPYmplY3RBcnJheSgpOwogIH0KfQpjbGFzcyBFeGNsR3JvdXAgZXh0ZW5kcyBfeGZhX29iamVjdC5YRkFPYmplY3QgewogIGNvbnN0cnVjdG9yKGF0dHJpYnV0ZXMpIHsKICAgIHN1cGVyKFRFTVBMQVRFX05TX0lELCAiZXhjbEdyb3VwIiwgdHJ1ZSk7CiAgICB0aGlzLmFjY2VzcyA9ICgwLCBfdXRpbHMuZ2V0U3RyaW5nT3B0aW9uKShhdHRyaWJ1dGVzLmFjY2VzcywgWyJvcGVuIiwgIm5vbkludGVyYWN0aXZlIiwgInByb3RlY3RlZCIsICJyZWFkT25seSJdKTsKICAgIHRoaXMuYWNjZXNzS2V5ID0gYXR0cmlidXRlcy5hY2Nlc3NLZXkgfHwgIiI7CiAgICB0aGlzLmFuY2hvclR5cGUgPSAoMCwgX3V0aWxzLmdldFN0cmluZ09wdGlvbikoYXR0cmlidXRlcy5hbmNob3JUeXBlLCBbInRvcExlZnQiLCAiYm90dG9tQ2VudGVyIiwgImJvdHRvbUxlZnQiLCAiYm90dG9tUmlnaHQiLCAibWlkZGxlQ2VudGVyIiwgIm1pZGRsZUxlZnQiLCAibWlkZGxlUmlnaHQiLCAidG9wQ2VudGVyIiwgInRvcFJpZ2h0Il0pOwogICAgdGhpcy5jb2xTcGFuID0gKDAsIF91dGlscy5nZXRJbnRlZ2VyKSh7CiAgICAgIGRhdGE6IGF0dHJpYnV0ZXMuY29sU3BhbiwKICAgICAgZGVmYXVsdFZhbHVlOiAxLAogICAgICB2YWxpZGF0ZTogbiA9PiBuID49IDEgfHwgbiA9PT0gLTEKICAgIH0pOwogICAgdGhpcy5oID0gYXR0cmlidXRlcy5oID8gKDAsIF91dGlscy5nZXRNZWFzdXJlbWVudCkoYXR0cmlidXRlcy5oKSA6ICIiOwogICAgdGhpcy5oQWxpZ24gPSAoMCwgX3V0aWxzLmdldFN0cmluZ09wdGlvbikoYXR0cmlidXRlcy5oQWxpZ24sIFsibGVmdCIsICJjZW50ZXIiLCAianVzdGlmeSIsICJqdXN0aWZ5QWxsIiwgInJhZGl4IiwgInJpZ2h0Il0pOwogICAgdGhpcy5pZCA9IGF0dHJpYnV0ZXMuaWQgfHwgIiI7CiAgICB0aGlzLmxheW91dCA9ICgwLCBfdXRpbHMuZ2V0U3RyaW5nT3B0aW9uKShhdHRyaWJ1dGVzLmxheW91dCwgWyJwb3NpdGlvbiIsICJsci10YiIsICJybC1yb3ciLCAicmwtdGIiLCAicm93IiwgInRhYmxlIiwgInRiIl0pOwogICAgdGhpcy5tYXhIID0gKDAsIF91dGlscy5nZXRNZWFzdXJlbWVudCkoYXR0cmlidXRlcy5tYXhILCAiMHB0Iik7CiAgICB0aGlzLm1heFcgPSAoMCwgX3V0aWxzLmdldE1lYXN1cmVtZW50KShhdHRyaWJ1dGVzLm1heFcsICIwcHQiKTsKICAgIHRoaXMubWluSCA9ICgwLCBfdXRpbHMuZ2V0TWVhc3VyZW1lbnQpKGF0dHJpYnV0ZXMubWluSCwgIjBwdCIpOwogICAgdGhpcy5taW5XID0gKDAsIF91dGlscy5nZXRNZWFzdXJlbWVudCkoYXR0cmlidXRlcy5taW5XLCAiMHB0Iik7CiAgICB0aGlzLm5hbWUgPSBhdHRyaWJ1dGVzLm5hbWUgfHwgIiI7CiAgICB0aGlzLnByZXNlbmNlID0gKDAsIF91dGlscy5nZXRTdHJpbmdPcHRpb24pKGF0dHJpYnV0ZXMucHJlc2VuY2UsIFsidmlzaWJsZSIsICJoaWRkZW4iLCAiaW5hY3RpdmUiLCAiaW52aXNpYmxlIl0pOwogICAgdGhpcy5yZWxldmFudCA9ICgwLCBfdXRpbHMuZ2V0UmVsZXZhbnQpKGF0dHJpYnV0ZXMucmVsZXZhbnQpOwogICAgdGhpcy51c2UgPSBhdHRyaWJ1dGVzLnVzZSB8fCAiIjsKICAgIHRoaXMudXNlaHJlZiA9IGF0dHJpYnV0ZXMudXNlaHJlZiB8fCAiIjsKICAgIHRoaXMudyA9IGF0dHJpYnV0ZXMudyA/ICgwLCBfdXRpbHMuZ2V0TWVhc3VyZW1lbnQpKGF0dHJpYnV0ZXMudykgOiAiIjsKICAgIHRoaXMueCA9ICgwLCBfdXRpbHMuZ2V0TWVhc3VyZW1lbnQpKGF0dHJpYnV0ZXMueCwgIjBwdCIpOwogICAgdGhpcy55ID0gKDAsIF91dGlscy5nZXRNZWFzdXJlbWVudCkoYXR0cmlidXRlcy55LCAiMHB0Iik7CiAgICB0aGlzLmFzc2lzdCA9IG51bGw7CiAgICB0aGlzLmJpbmQgPSBudWxsOwogICAgdGhpcy5ib3JkZXIgPSBudWxsOwogICAgdGhpcy5jYWxjdWxhdGUgPSBudWxsOwogICAgdGhpcy5jYXB0aW9uID0gbnVsbDsKICAgIHRoaXMuZGVzYyA9IG51bGw7CiAgICB0aGlzLmV4dHJhcyA9IG51bGw7CiAgICB0aGlzLm1hcmdpbiA9IG51bGw7CiAgICB0aGlzLnBhcmEgPSBudWxsOwogICAgdGhpcy50cmF2ZXJzYWwgPSBudWxsOwogICAgdGhpcy52YWxpZGF0ZSA9IG51bGw7CiAgICB0aGlzLmNvbm5lY3QgPSBuZXcgX3hmYV9vYmplY3QuWEZBT2JqZWN0QXJyYXkoKTsKICAgIHRoaXMuZXZlbnQgPSBuZXcgX3hmYV9vYmplY3QuWEZBT2JqZWN0QXJyYXkoKTsKICAgIHRoaXMuZmllbGQgPSBuZXcgX3hmYV9vYmplY3QuWEZBT2JqZWN0QXJyYXkoKTsKICAgIHRoaXMuc2V0UHJvcGVydHkgPSBuZXcgX3hmYV9vYmplY3QuWEZBT2JqZWN0QXJyYXkoKTsKICB9CiAgW19zeW1ib2xfdXRpbHMuJGlzQmluZGFibGVdKCkgewogICAgcmV0dXJuIHRydWU7CiAgfQogIFtfc3ltYm9sX3V0aWxzLiRoYXNTZXR0YWJsZVZhbHVlXSgpIHsKICAgIHJldHVybiB0cnVlOwogIH0KICBbX3N5bWJvbF91dGlscy4kc2V0VmFsdWVdKHZhbHVlKSB7CiAgICBmb3IgKGNvbnN0IGZpZWxkIG9mIHRoaXMuZmllbGQuY2hpbGRyZW4pIHsKICAgICAgaWYgKCFmaWVsZC52YWx1ZSkgewogICAgICAgIGNvbnN0IG5vZGVWYWx1ZSA9IG5ldyBWYWx1ZSh7fSk7CiAgICAgICAgZmllbGRbX3N5bWJvbF91dGlscy4kYXBwZW5kQ2hpbGRdKG5vZGVWYWx1ZSk7CiAgICAgICAgZmllbGQudmFsdWUgPSBub2RlVmFsdWU7CiAgICAgIH0KICAgICAgZmllbGQudmFsdWVbX3N5bWJvbF91dGlscy4kc2V0VmFsdWVdKHZhbHVlKTsKICAgIH0KICB9CiAgW19zeW1ib2xfdXRpbHMuJGlzVGhlcmVNb3JlV2lkdGhdKCkgewogICAgcmV0dXJuIHRoaXMubGF5b3V0LmVuZHNXaXRoKCItdGIiKSAmJiB0aGlzW19zeW1ib2xfdXRpbHMuJGV4dHJhXS5hdHRlbXB0ID09PSAwICYmIHRoaXNbX3N5bWJvbF91dGlscy4kZXh0cmFdLm51bWJlckluTGluZSA+IDAgfHwgdGhpc1tfc3ltYm9sX3V0aWxzLiRnZXRQYXJlbnRdKClbX3N5bWJvbF91dGlscy4kaXNUaGVyZU1vcmVXaWR0aF0oKTsKICB9CiAgW19zeW1ib2xfdXRpbHMuJGlzU3BsaXR0YWJsZV0oKSB7CiAgICBjb25zdCBwYXJlbnQgPSB0aGlzW19zeW1ib2xfdXRpbHMuJGdldFN1YmZvcm1QYXJlbnRdKCk7CiAgICBpZiAoIXBhcmVudFtfc3ltYm9sX3V0aWxzLiRpc1NwbGl0dGFibGVdKCkpIHsKICAgICAgcmV0dXJuIGZhbHNlOwogICAgfQogICAgaWYgKHRoaXNbX3N5bWJvbF91dGlscy4kZXh0cmFdLl9pc1NwbGl0dGFibGUgIT09IHVuZGVmaW5lZCkgewogICAgICByZXR1cm4gdGhpc1tfc3ltYm9sX3V0aWxzLiRleHRyYV0uX2lzU3BsaXR0YWJsZTsKICAgIH0KICAgIGlmICh0aGlzLmxheW91dCA9PT0gInBvc2l0aW9uIiB8fCB0aGlzLmxheW91dC5pbmNsdWRlcygicm93IikpIHsKICAgICAgdGhpc1tfc3ltYm9sX3V0aWxzLiRleHRyYV0uX2lzU3BsaXR0YWJsZSA9IGZhbHNlOwogICAgICByZXR1cm4gZmFsc2U7CiAgICB9CiAgICBpZiAocGFyZW50LmxheW91dD8uZW5kc1dpdGgoIi10YiIpICYmIHBhcmVudFtfc3ltYm9sX3V0aWxzLiRleHRyYV0ubnVtYmVySW5MaW5lICE9PSAwKSB7CiAgICAgIHJldHVybiBmYWxzZTsKICAgIH0KICAgIHRoaXNbX3N5bWJvbF91dGlscy4kZXh0cmFdLl9pc1NwbGl0dGFibGUgPSB0cnVlOwogICAgcmV0dXJuIHRydWU7CiAgfQogIFtfc3ltYm9sX3V0aWxzLiRmbHVzaEhUTUxdKCkgewogICAgcmV0dXJuICgwLCBfbGF5b3V0LmZsdXNoSFRNTCkodGhpcyk7CiAgfQogIFtfc3ltYm9sX3V0aWxzLiRhZGRIVE1MXShodG1sLCBiYm94KSB7CiAgICAoMCwgX2xheW91dC5hZGRIVE1MKSh0aGlzLCBodG1sLCBiYm94KTsKICB9CiAgW19zeW1ib2xfdXRpbHMuJGdldEF2YWlsYWJsZVNwYWNlXSgpIHsKICAgIHJldHVybiAoMCwgX2xheW91dC5nZXRBdmFpbGFibGVTcGFjZSkodGhpcyk7CiAgfQogIFtfc3ltYm9sX3V0aWxzLiR0b0hUTUxdKGF2YWlsYWJsZVNwYWNlKSB7CiAgICBzZXRUYWJJbmRleCh0aGlzKTsKICAgIGlmICh0aGlzLnByZXNlbmNlID09PSAiaGlkZGVuIiB8fCB0aGlzLnByZXNlbmNlID09PSAiaW5hY3RpdmUiIHx8IHRoaXMuaCA9PT0gMCB8fCB0aGlzLncgPT09IDApIHsKICAgICAgcmV0dXJuIF91dGlscy5IVE1MUmVzdWx0LkVNUFRZOwogICAgfQogICAgKDAsIF9odG1sX3V0aWxzLmZpeERpbWVuc2lvbnMpKHRoaXMpOwogICAgY29uc3QgY2hpbGRyZW4gPSBbXTsKICAgIGNvbnN0IGF0dHJpYnV0ZXMgPSB7CiAgICAgIGlkOiB0aGlzW19zeW1ib2xfdXRpbHMuJHVpZF0sCiAgICAgIGNsYXNzOiBbXQogICAgfTsKICAgICgwLCBfaHRtbF91dGlscy5zZXRBY2Nlc3MpKHRoaXMsIGF0dHJpYnV0ZXMuY2xhc3MpOwogICAgaWYgKCF0aGlzW19zeW1ib2xfdXRpbHMuJGV4dHJhXSkgewogICAgICB0aGlzW19zeW1ib2xfdXRpbHMuJGV4dHJhXSA9IE9iamVjdC5jcmVhdGUobnVsbCk7CiAgICB9CiAgICBPYmplY3QuYXNzaWduKHRoaXNbX3N5bWJvbF91dGlscy4kZXh0cmFdLCB7CiAgICAgIGNoaWxkcmVuLAogICAgICBhdHRyaWJ1dGVzLAogICAgICBhdHRlbXB0OiAwLAogICAgICBsaW5lOiBudWxsLAogICAgICBudW1iZXJJbkxpbmU6IDAsCiAgICAgIGF2YWlsYWJsZVNwYWNlOiB7CiAgICAgICAgd2lkdGg6IE1hdGgubWluKHRoaXMudyB8fCBJbmZpbml0eSwgYXZhaWxhYmxlU3BhY2Uud2lkdGgpLAogICAgICAgIGhlaWdodDogTWF0aC5taW4odGhpcy5oIHx8IEluZmluaXR5LCBhdmFpbGFibGVTcGFjZS5oZWlnaHQpCiAgICAgIH0sCiAgICAgIHdpZHRoOiAwLAogICAgICBoZWlnaHQ6IDAsCiAgICAgIHByZXZIZWlnaHQ6IDAsCiAgICAgIGN1cnJlbnRXaWR0aDogMAogICAgfSk7CiAgICBjb25zdCBpc1NwbGl0dGFibGUgPSB0aGlzW19zeW1ib2xfdXRpbHMuJGlzU3BsaXR0YWJsZV0oKTsKICAgIGlmICghaXNTcGxpdHRhYmxlKSB7CiAgICAgIHNldEZpcnN0VW5zcGxpdHRhYmxlKHRoaXMpOwogICAgfQogICAgaWYgKCEoMCwgX2xheW91dC5jaGVja0RpbWVuc2lvbnMpKHRoaXMsIGF2YWlsYWJsZVNwYWNlKSkgewogICAgICByZXR1cm4gX3V0aWxzLkhUTUxSZXN1bHQuRkFJTFVSRTsKICAgIH0KICAgIGNvbnN0IGZpbHRlciA9IG5ldyBTZXQoWyJmaWVsZCJdKTsKICAgIGlmICh0aGlzLmxheW91dC5pbmNsdWRlcygicm93IikpIHsKICAgICAgY29uc3QgY29sdW1uV2lkdGhzID0gdGhpc1tfc3ltYm9sX3V0aWxzLiRnZXRTdWJmb3JtUGFyZW50XSgpLmNvbHVtbldpZHRoczsKICAgICAgaWYgKEFycmF5LmlzQXJyYXkoY29sdW1uV2lkdGhzKSAmJiBjb2x1bW5XaWR0aHMubGVuZ3RoID4gMCkgewogICAgICAgIHRoaXNbX3N5bWJvbF91dGlscy4kZXh0cmFdLmNvbHVtbldpZHRocyA9IGNvbHVtbldpZHRoczsKICAgICAgICB0aGlzW19zeW1ib2xfdXRpbHMuJGV4dHJhXS5jdXJyZW50Q29sdW1uID0gMDsKICAgICAgfQogICAgfQogICAgY29uc3Qgc3R5bGUgPSAoMCwgX2h0bWxfdXRpbHMudG9TdHlsZSkodGhpcywgImFuY2hvclR5cGUiLCAiZGltZW5zaW9ucyIsICJwb3NpdGlvbiIsICJwcmVzZW5jZSIsICJib3JkZXIiLCAibWFyZ2luIiwgImhBbGlnbiIpOwogICAgY29uc3QgY2xhc3NOYW1lcyA9IFsieGZhRXhjbGdyb3VwIl07CiAgICBjb25zdCBjbCA9ICgwLCBfaHRtbF91dGlscy5sYXlvdXRDbGFzcykodGhpcyk7CiAgICBpZiAoY2wpIHsKICAgICAgY2xhc3NOYW1lcy5wdXNoKGNsKTsKICAgIH0KICAgIGlmICgoMCwgX2h0bWxfdXRpbHMuaXNQcmludE9ubHkpKHRoaXMpKSB7CiAgICAgIGNsYXNzTmFtZXMucHVzaCgieGZhUHJpbnRPbmx5Iik7CiAgICB9CiAgICBhdHRyaWJ1dGVzLnN0eWxlID0gc3R5bGU7CiAgICBhdHRyaWJ1dGVzLmNsYXNzID0gY2xhc3NOYW1lczsKICAgIGlmICh0aGlzLm5hbWUpIHsKICAgICAgYXR0cmlidXRlcy54ZmFOYW1lID0gdGhpcy5uYW1lOwogICAgfQogICAgdGhpc1tfc3ltYm9sX3V0aWxzLiRwdXNoUGFyYV0oKTsKICAgIGNvbnN0IGlzTHJUYiA9IHRoaXMubGF5b3V0ID09PSAibHItdGIiIHx8IHRoaXMubGF5b3V0ID09PSAicmwtdGIiOwogICAgY29uc3QgbWF4UnVuID0gaXNMclRiID8gTUFYX0FUVEVNUFRTX0ZPUl9MUlRCX0xBWU9VVCA6IDE7CiAgICBmb3IgKDsgdGhpc1tfc3ltYm9sX3V0aWxzLiRleHRyYV0uYXR0ZW1wdCA8IG1heFJ1bjsgdGhpc1tfc3ltYm9sX3V0aWxzLiRleHRyYV0uYXR0ZW1wdCsrKSB7CiAgICAgIGlmIChpc0xyVGIgJiYgdGhpc1tfc3ltYm9sX3V0aWxzLiRleHRyYV0uYXR0ZW1wdCA9PT0gTUFYX0FUVEVNUFRTX0ZPUl9MUlRCX0xBWU9VVCAtIDEpIHsKICAgICAgICB0aGlzW19zeW1ib2xfdXRpbHMuJGV4dHJhXS5udW1iZXJJbkxpbmUgPSAwOwogICAgICB9CiAgICAgIGNvbnN0IHJlc3VsdCA9IHRoaXNbX3N5bWJvbF91dGlscy4kY2hpbGRyZW5Ub0hUTUxdKHsKICAgICAgICBmaWx0ZXIsCiAgICAgICAgaW5jbHVkZTogdHJ1ZQogICAgICB9KTsKICAgICAgaWYgKHJlc3VsdC5zdWNjZXNzKSB7CiAgICAgICAgYnJlYWs7CiAgICAgIH0KICAgICAgaWYgKHJlc3VsdC5pc0JyZWFrKCkpIHsKICAgICAgICB0aGlzW19zeW1ib2xfdXRpbHMuJHBvcFBhcmFdKCk7CiAgICAgICAgcmV0dXJuIHJlc3VsdDsKICAgICAgfQogICAgICBpZiAoaXNMclRiICYmIHRoaXNbX3N5bWJvbF91dGlscy4kZXh0cmFdLmF0dGVtcHQgPT09IDAgJiYgdGhpc1tfc3ltYm9sX3V0aWxzLiRleHRyYV0ubnVtYmVySW5MaW5lID09PSAwICYmICF0aGlzW19zeW1ib2xfdXRpbHMuJGdldFRlbXBsYXRlUm9vdF0oKVtfc3ltYm9sX3V0aWxzLiRleHRyYV0ubm9MYXlvdXRGYWlsdXJlKSB7CiAgICAgICAgdGhpc1tfc3ltYm9sX3V0aWxzLiRleHRyYV0uYXR0ZW1wdCA9IG1heFJ1bjsKICAgICAgICBicmVhazsKICAgICAgfQogICAgfQogICAgdGhpc1tfc3ltYm9sX3V0aWxzLiRwb3BQYXJhXSgpOwogICAgaWYgKCFpc1NwbGl0dGFibGUpIHsKICAgICAgdW5zZXRGaXJzdFVuc3BsaXR0YWJsZSh0aGlzKTsKICAgIH0KICAgIGlmICh0aGlzW19zeW1ib2xfdXRpbHMuJGV4dHJhXS5hdHRlbXB0ID09PSBtYXhSdW4pIHsKICAgICAgaWYgKCFpc1NwbGl0dGFibGUpIHsKICAgICAgICBkZWxldGUgdGhpc1tfc3ltYm9sX3V0aWxzLiRleHRyYV07CiAgICAgIH0KICAgICAgcmV0dXJuIF91dGlscy5IVE1MUmVzdWx0LkZBSUxVUkU7CiAgICB9CiAgICBsZXQgbWFyZ2luSCA9IDA7CiAgICBsZXQgbWFyZ2luViA9IDA7CiAgICBpZiAodGhpcy5tYXJnaW4pIHsKICAgICAgbWFyZ2luSCA9IHRoaXMubWFyZ2luLmxlZnRJbnNldCArIHRoaXMubWFyZ2luLnJpZ2h0SW5zZXQ7CiAgICAgIG1hcmdpblYgPSB0aGlzLm1hcmdpbi50b3BJbnNldCArIHRoaXMubWFyZ2luLmJvdHRvbUluc2V0OwogICAgfQogICAgY29uc3Qgd2lkdGggPSBNYXRoLm1heCh0aGlzW19zeW1ib2xfdXRpbHMuJGV4dHJhXS53aWR0aCArIG1hcmdpbkgsIHRoaXMudyB8fCAwKTsKICAgIGNvbnN0IGhlaWdodCA9IE1hdGgubWF4KHRoaXNbX3N5bWJvbF91dGlscy4kZXh0cmFdLmhlaWdodCArIG1hcmdpblYsIHRoaXMuaCB8fCAwKTsKICAgIGNvbnN0IGJib3ggPSBbdGhpcy54LCB0aGlzLnksIHdpZHRoLCBoZWlnaHRdOwogICAgaWYgKHRoaXMudyA9PT0gIiIpIHsKICAgICAgc3R5bGUud2lkdGggPSAoMCwgX2h0bWxfdXRpbHMubWVhc3VyZVRvU3RyaW5nKSh3aWR0aCk7CiAgICB9CiAgICBpZiAodGhpcy5oID09PSAiIikgewogICAgICBzdHlsZS5oZWlnaHQgPSAoMCwgX2h0bWxfdXRpbHMubWVhc3VyZVRvU3RyaW5nKShoZWlnaHQpOwogICAgfQogICAgY29uc3QgaHRtbCA9IHsKICAgICAgbmFtZTogImRpdiIsCiAgICAgIGF0dHJpYnV0ZXMsCiAgICAgIGNoaWxkcmVuCiAgICB9OwogICAgYXBwbHlBc3Npc3QodGhpcywgYXR0cmlidXRlcyk7CiAgICBkZWxldGUgdGhpc1tfc3ltYm9sX3V0aWxzLiRleHRyYV07CiAgICByZXR1cm4gX3V0aWxzLkhUTUxSZXN1bHQuc3VjY2VzcygoMCwgX2h0bWxfdXRpbHMuY3JlYXRlV3JhcHBlcikodGhpcywgaHRtbCksIGJib3gpOwogIH0KfQpjbGFzcyBFeGVjdXRlIGV4dGVuZHMgX3hmYV9vYmplY3QuWEZBT2JqZWN0IHsKICBjb25zdHJ1Y3RvcihhdHRyaWJ1dGVzKSB7CiAgICBzdXBlcihURU1QTEFURV9OU19JRCwgImV4ZWN1dGUiKTsKICAgIHRoaXMuY29ubmVjdGlvbiA9IGF0dHJpYnV0ZXMuY29ubmVjdGlvbiB8fCAiIjsKICAgIHRoaXMuZXhlY3V0ZVR5cGUgPSAoMCwgX3V0aWxzLmdldFN0cmluZ09wdGlvbikoYXR0cmlidXRlcy5leGVjdXRlVHlwZSwgWyJpbXBvcnQiLCAicmVtZXJnZSJdKTsKICAgIHRoaXMuaWQgPSBhdHRyaWJ1dGVzLmlkIHx8ICIiOwogICAgdGhpcy5ydW5BdCA9ICgwLCBfdXRpbHMuZ2V0U3RyaW5nT3B0aW9uKShhdHRyaWJ1dGVzLnJ1bkF0LCBbImNsaWVudCIsICJib3RoIiwgInNlcnZlciJdKTsKICAgIHRoaXMudXNlID0gYXR0cmlidXRlcy51c2UgfHwgIiI7CiAgICB0aGlzLnVzZWhyZWYgPSBhdHRyaWJ1dGVzLnVzZWhyZWYgfHwgIiI7CiAgfQp9CmNsYXNzIEV4dHJhcyBleHRlbmRzIF94ZmFfb2JqZWN0LlhGQU9iamVjdCB7CiAgY29uc3RydWN0b3IoYXR0cmlidXRlcykgewogICAgc3VwZXIoVEVNUExBVEVfTlNfSUQsICJleHRyYXMiLCB0cnVlKTsKICAgIHRoaXMuaWQgPSBhdHRyaWJ1dGVzLmlkIHx8ICIiOwogICAgdGhpcy5uYW1lID0gYXR0cmlidXRlcy5uYW1lIHx8ICIiOwogICAgdGhpcy51c2UgPSBhdHRyaWJ1dGVzLnVzZSB8fCAiIjsKICAgIHRoaXMudXNlaHJlZiA9IGF0dHJpYnV0ZXMudXNlaHJlZiB8fCAiIjsKICAgIHRoaXMuYm9vbGVhbiA9IG5ldyBfeGZhX29iamVjdC5YRkFPYmplY3RBcnJheSgpOwogICAgdGhpcy5kYXRlID0gbmV3IF94ZmFfb2JqZWN0LlhGQU9iamVjdEFycmF5KCk7CiAgICB0aGlzLmRhdGVUaW1lID0gbmV3IF94ZmFfb2JqZWN0LlhGQU9iamVjdEFycmF5KCk7CiAgICB0aGlzLmRlY2ltYWwgPSBuZXcgX3hmYV9vYmplY3QuWEZBT2JqZWN0QXJyYXkoKTsKICAgIHRoaXMuZXhEYXRhID0gbmV3IF94ZmFfb2JqZWN0LlhGQU9iamVjdEFycmF5KCk7CiAgICB0aGlzLmV4dHJhcyA9IG5ldyBfeGZhX29iamVjdC5YRkFPYmplY3RBcnJheSgpOwogICAgdGhpcy5mbG9hdCA9IG5ldyBfeGZhX29iamVjdC5YRkFPYmplY3RBcnJheSgpOwogICAgdGhpcy5pbWFnZSA9IG5ldyBfeGZhX29iamVjdC5YRkFPYmplY3RBcnJheSgpOwogICAgdGhpcy5pbnRlZ2VyID0gbmV3IF94ZmFfb2JqZWN0LlhGQU9iamVjdEFycmF5KCk7CiAgICB0aGlzLnRleHQgPSBuZXcgX3hmYV9vYmplY3QuWEZBT2JqZWN0QXJyYXkoKTsKICAgIHRoaXMudGltZSA9IG5ldyBfeGZhX29iamVjdC5YRkFPYmplY3RBcnJheSgpOwogIH0KfQpjbGFzcyBGaWVsZCBleHRlbmRzIF94ZmFfb2JqZWN0LlhGQU9iamVjdCB7CiAgY29uc3RydWN0b3IoYXR0cmlidXRlcykgewogICAgc3VwZXIoVEVNUExBVEVfTlNfSUQsICJmaWVsZCIsIHRydWUpOwogICAgdGhpcy5hY2Nlc3MgPSAoMCwgX3V0aWxzLmdldFN0cmluZ09wdGlvbikoYXR0cmlidXRlcy5hY2Nlc3MsIFsib3BlbiIsICJub25JbnRlcmFjdGl2ZSIsICJwcm90ZWN0ZWQiLCAicmVhZE9ubHkiXSk7CiAgICB0aGlzLmFjY2Vzc0tleSA9IGF0dHJpYnV0ZXMuYWNjZXNzS2V5IHx8ICIiOwogICAgdGhpcy5hbmNob3JUeXBlID0gKDAsIF91dGlscy5nZXRTdHJpbmdPcHRpb24pKGF0dHJpYnV0ZXMuYW5jaG9yVHlwZSwgWyJ0b3BMZWZ0IiwgImJvdHRvbUNlbnRlciIsICJib3R0b21MZWZ0IiwgImJvdHRvbVJpZ2h0IiwgIm1pZGRsZUNlbnRlciIsICJtaWRkbGVMZWZ0IiwgIm1pZGRsZVJpZ2h0IiwgInRvcENlbnRlciIsICJ0b3BSaWdodCJdKTsKICAgIHRoaXMuY29sU3BhbiA9ICgwLCBfdXRpbHMuZ2V0SW50ZWdlcikoewogICAgICBkYXRhOiBhdHRyaWJ1dGVzLmNvbFNwYW4sCiAgICAgIGRlZmF1bHRWYWx1ZTogMSwKICAgICAgdmFsaWRhdGU6IG4gPT4gbiA+PSAxIHx8IG4gPT09IC0xCiAgICB9KTsKICAgIHRoaXMuaCA9IGF0dHJpYnV0ZXMuaCA/ICgwLCBfdXRpbHMuZ2V0TWVhc3VyZW1lbnQpKGF0dHJpYnV0ZXMuaCkgOiAiIjsKICAgIHRoaXMuaEFsaWduID0gKDAsIF91dGlscy5nZXRTdHJpbmdPcHRpb24pKGF0dHJpYnV0ZXMuaEFsaWduLCBbImxlZnQiLCAiY2VudGVyIiwgImp1c3RpZnkiLCAianVzdGlmeUFsbCIsICJyYWRpeCIsICJyaWdodCJdKTsKICAgIHRoaXMuaWQgPSBhdHRyaWJ1dGVzLmlkIHx8ICIiOwogICAgdGhpcy5sb2NhbGUgPSBhdHRyaWJ1dGVzLmxvY2FsZSB8fCAiIjsKICAgIHRoaXMubWF4SCA9ICgwLCBfdXRpbHMuZ2V0TWVhc3VyZW1lbnQpKGF0dHJpYnV0ZXMubWF4SCwgIjBwdCIpOwogICAgdGhpcy5tYXhXID0gKDAsIF91dGlscy5nZXRNZWFzdXJlbWVudCkoYXR0cmlidXRlcy5tYXhXLCAiMHB0Iik7CiAgICB0aGlzLm1pbkggPSAoMCwgX3V0aWxzLmdldE1lYXN1cmVtZW50KShhdHRyaWJ1dGVzLm1pbkgsICIwcHQiKTsKICAgIHRoaXMubWluVyA9ICgwLCBfdXRpbHMuZ2V0TWVhc3VyZW1lbnQpKGF0dHJpYnV0ZXMubWluVywgIjBwdCIpOwogICAgdGhpcy5uYW1lID0gYXR0cmlidXRlcy5uYW1lIHx8ICIiOwogICAgdGhpcy5wcmVzZW5jZSA9ICgwLCBfdXRpbHMuZ2V0U3RyaW5nT3B0aW9uKShhdHRyaWJ1dGVzLnByZXNlbmNlLCBbInZpc2libGUiLCAiaGlkZGVuIiwgImluYWN0aXZlIiwgImludmlzaWJsZSJdKTsKICAgIHRoaXMucmVsZXZhbnQgPSAoMCwgX3V0aWxzLmdldFJlbGV2YW50KShhdHRyaWJ1dGVzLnJlbGV2YW50KTsKICAgIHRoaXMucm90YXRlID0gKDAsIF91dGlscy5nZXRJbnRlZ2VyKSh7CiAgICAgIGRhdGE6IGF0dHJpYnV0ZXMucm90YXRlLAogICAgICBkZWZhdWx0VmFsdWU6IDAsCiAgICAgIHZhbGlkYXRlOiB4ID0+IHggJSA5MCA9PT0gMAogICAgfSk7CiAgICB0aGlzLnVzZSA9IGF0dHJpYnV0ZXMudXNlIHx8ICIiOwogICAgdGhpcy51c2VocmVmID0gYXR0cmlidXRlcy51c2VocmVmIHx8ICIiOwogICAgdGhpcy53ID0gYXR0cmlidXRlcy53ID8gKDAsIF91dGlscy5nZXRNZWFzdXJlbWVudCkoYXR0cmlidXRlcy53KSA6ICIiOwogICAgdGhpcy54ID0gKDAsIF91dGlscy5nZXRNZWFzdXJlbWVudCkoYXR0cmlidXRlcy54LCAiMHB0Iik7CiAgICB0aGlzLnkgPSAoMCwgX3V0aWxzLmdldE1lYXN1cmVtZW50KShhdHRyaWJ1dGVzLnksICIwcHQiKTsKICAgIHRoaXMuYXNzaXN0ID0gbnVsbDsKICAgIHRoaXMuYmluZCA9IG51bGw7CiAgICB0aGlzLmJvcmRlciA9IG51bGw7CiAgICB0aGlzLmNhbGN1bGF0ZSA9IG51bGw7CiAgICB0aGlzLmNhcHRpb24gPSBudWxsOwogICAgdGhpcy5kZXNjID0gbnVsbDsKICAgIHRoaXMuZXh0cmFzID0gbnVsbDsKICAgIHRoaXMuZm9udCA9IG51bGw7CiAgICB0aGlzLmZvcm1hdCA9IG51bGw7CiAgICB0aGlzLml0ZW1zID0gbmV3IF94ZmFfb2JqZWN0LlhGQU9iamVjdEFycmF5KDIpOwogICAgdGhpcy5rZWVwID0gbnVsbDsKICAgIHRoaXMubWFyZ2luID0gbnVsbDsKICAgIHRoaXMucGFyYSA9IG51bGw7CiAgICB0aGlzLnRyYXZlcnNhbCA9IG51bGw7CiAgICB0aGlzLnVpID0gbnVsbDsKICAgIHRoaXMudmFsaWRhdGUgPSBudWxsOwogICAgdGhpcy52YWx1ZSA9IG51bGw7CiAgICB0aGlzLmJpbmRJdGVtcyA9IG5ldyBfeGZhX29iamVjdC5YRkFPYmplY3RBcnJheSgpOwogICAgdGhpcy5jb25uZWN0ID0gbmV3IF94ZmFfb2JqZWN0LlhGQU9iamVjdEFycmF5KCk7CiAgICB0aGlzLmV2ZW50ID0gbmV3IF94ZmFfb2JqZWN0LlhGQU9iamVjdEFycmF5KCk7CiAgICB0aGlzLnNldFByb3BlcnR5ID0gbmV3IF94ZmFfb2JqZWN0LlhGQU9iamVjdEFycmF5KCk7CiAgfQogIFtfc3ltYm9sX3V0aWxzLiRpc0JpbmRhYmxlXSgpIHsKICAgIHJldHVybiB0cnVlOwogIH0KICBbX3N5bWJvbF91dGlscy4kc2V0VmFsdWVdKHZhbHVlKSB7CiAgICBfc2V0VmFsdWUodGhpcywgdmFsdWUpOwogIH0KICBbX3N5bWJvbF91dGlscy4kdG9IVE1MXShhdmFpbGFibGVTcGFjZSkgewogICAgc2V0VGFiSW5kZXgodGhpcyk7CiAgICBpZiAoIXRoaXMudWkpIHsKICAgICAgdGhpcy51aSA9IG5ldyBVaSh7fSk7CiAgICAgIHRoaXMudWlbX3N5bWJvbF91dGlscy4kZ2xvYmFsRGF0YV0gPSB0aGlzW19zeW1ib2xfdXRpbHMuJGdsb2JhbERhdGFdOwogICAgICB0aGlzW19zeW1ib2xfdXRpbHMuJGFwcGVuZENoaWxkXSh0aGlzLnVpKTsKICAgICAgbGV0IG5vZGU7CiAgICAgIHN3aXRjaCAodGhpcy5pdGVtcy5jaGlsZHJlbi5sZW5ndGgpIHsKICAgICAgICBjYXNlIDA6CiAgICAgICAgICBub2RlID0gbmV3IFRleHRFZGl0KHt9KTsKICAgICAgICAgIHRoaXMudWkudGV4dEVkaXQgPSBub2RlOwogICAgICAgICAgYnJlYWs7CiAgICAgICAgY2FzZSAxOgogICAgICAgICAgbm9kZSA9IG5ldyBDaGVja0J1dHRvbih7fSk7CiAgICAgICAgICB0aGlzLnVpLmNoZWNrQnV0dG9uID0gbm9kZTsKICAgICAgICAgIGJyZWFrOwogICAgICAgIGNhc2UgMjoKICAgICAgICAgIG5vZGUgPSBuZXcgQ2hvaWNlTGlzdCh7fSk7CiAgICAgICAgICB0aGlzLnVpLmNob2ljZUxpc3QgPSBub2RlOwogICAgICAgICAgYnJlYWs7CiAgICAgIH0KICAgICAgdGhpcy51aVtfc3ltYm9sX3V0aWxzLiRhcHBlbmRDaGlsZF0obm9kZSk7CiAgICB9CiAgICBpZiAoIXRoaXMudWkgfHwgdGhpcy5wcmVzZW5jZSA9PT0gImhpZGRlbiIgfHwgdGhpcy5wcmVzZW5jZSA9PT0gImluYWN0aXZlIiB8fCB0aGlzLmggPT09IDAgfHwgdGhpcy53ID09PSAwKSB7CiAgICAgIHJldHVybiBfdXRpbHMuSFRNTFJlc3VsdC5FTVBUWTsKICAgIH0KICAgIGlmICh0aGlzLmNhcHRpb24pIHsKICAgICAgZGVsZXRlIHRoaXMuY2FwdGlvbltfc3ltYm9sX3V0aWxzLiRleHRyYV07CiAgICB9CiAgICB0aGlzW19zeW1ib2xfdXRpbHMuJHB1c2hQYXJhXSgpOwogICAgY29uc3QgY2FwdGlvbiA9IHRoaXMuY2FwdGlvbiA/IHRoaXMuY2FwdGlvbltfc3ltYm9sX3V0aWxzLiR0b0hUTUxdKGF2YWlsYWJsZVNwYWNlKS5odG1sIDogbnVsbDsKICAgIGNvbnN0IHNhdmVkVyA9IHRoaXMudzsKICAgIGNvbnN0IHNhdmVkSCA9IHRoaXMuaDsKICAgIGxldCBtYXJnaW5IID0gMDsKICAgIGxldCBtYXJnaW5WID0gMDsKICAgIGlmICh0aGlzLm1hcmdpbikgewogICAgICBtYXJnaW5IID0gdGhpcy5tYXJnaW4ubGVmdEluc2V0ICsgdGhpcy5tYXJnaW4ucmlnaHRJbnNldDsKICAgICAgbWFyZ2luViA9IHRoaXMubWFyZ2luLnRvcEluc2V0ICsgdGhpcy5tYXJnaW4uYm90dG9tSW5zZXQ7CiAgICB9CiAgICBsZXQgYm9yZGVyRGltcyA9IG51bGw7CiAgICBpZiAodGhpcy53ID09PSAiIiB8fCB0aGlzLmggPT09ICIiKSB7CiAgICAgIGxldCB3aWR0aCA9IG51bGw7CiAgICAgIGxldCBoZWlnaHQgPSBudWxsOwogICAgICBsZXQgdWlXID0gMDsKICAgICAgbGV0IHVpSCA9IDA7CiAgICAgIGlmICh0aGlzLnVpLmNoZWNrQnV0dG9uKSB7CiAgICAgICAgdWlXID0gdWlIID0gdGhpcy51aS5jaGVja0J1dHRvbi5zaXplOwogICAgICB9IGVsc2UgewogICAgICAgIGNvbnN0IHsKICAgICAgICAgIHcsCiAgICAgICAgICBoCiAgICAgICAgfSA9ICgwLCBfaHRtbF91dGlscy5sYXlvdXROb2RlKSh0aGlzLCBhdmFpbGFibGVTcGFjZSk7CiAgICAgICAgaWYgKHcgIT09IG51bGwpIHsKICAgICAgICAgIHVpVyA9IHc7CiAgICAgICAgICB1aUggPSBoOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICB1aUggPSAoMCwgX2ZvbnRzLmdldE1ldHJpY3MpKHRoaXMuZm9udCwgdHJ1ZSkubGluZU5vR2FwOwogICAgICAgIH0KICAgICAgfQogICAgICBib3JkZXJEaW1zID0gZ2V0Qm9yZGVyRGltcyh0aGlzLnVpW19zeW1ib2xfdXRpbHMuJGdldEV4dHJhXSgpKTsKICAgICAgdWlXICs9IGJvcmRlckRpbXMudzsKICAgICAgdWlIICs9IGJvcmRlckRpbXMuaDsKICAgICAgaWYgKHRoaXMuY2FwdGlvbikgewogICAgICAgIGNvbnN0IHsKICAgICAgICAgIHcsCiAgICAgICAgICBoLAogICAgICAgICAgaXNCcm9rZW4KICAgICAgICB9ID0gdGhpcy5jYXB0aW9uW19zeW1ib2xfdXRpbHMuJGdldEV4dHJhXShhdmFpbGFibGVTcGFjZSk7CiAgICAgICAgaWYgKGlzQnJva2VuICYmIHRoaXNbX3N5bWJvbF91dGlscy4kZ2V0U3ViZm9ybVBhcmVudF0oKVtfc3ltYm9sX3V0aWxzLiRpc1RoZXJlTW9yZVdpZHRoXSgpKSB7CiAgICAgICAgICB0aGlzW19zeW1ib2xfdXRpbHMuJHBvcFBhcmFdKCk7CiAgICAgICAgICByZXR1cm4gX3V0aWxzLkhUTUxSZXN1bHQuRkFJTFVSRTsKICAgICAgICB9CiAgICAgICAgd2lkdGggPSB3OwogICAgICAgIGhlaWdodCA9IGg7CiAgICAgICAgc3dpdGNoICh0aGlzLmNhcHRpb24ucGxhY2VtZW50KSB7CiAgICAgICAgICBjYXNlICJsZWZ0IjoKICAgICAgICAgIGNhc2UgInJpZ2h0IjoKICAgICAgICAgIGNhc2UgImlubGluZSI6CiAgICAgICAgICAgIHdpZHRoICs9IHVpVzsKICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICBjYXNlICJ0b3AiOgogICAgICAgICAgY2FzZSAiYm90dG9tIjoKICAgICAgICAgICAgaGVpZ2h0ICs9IHVpSDsKICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgfQogICAgICB9IGVsc2UgewogICAgICAgIHdpZHRoID0gdWlXOwogICAgICAgIGhlaWdodCA9IHVpSDsKICAgICAgfQogICAgICBpZiAod2lkdGggJiYgdGhpcy53ID09PSAiIikgewogICAgICAgIHdpZHRoICs9IG1hcmdpbkg7CiAgICAgICAgdGhpcy53ID0gTWF0aC5taW4odGhpcy5tYXhXIDw9IDAgPyBJbmZpbml0eSA6IHRoaXMubWF4VywgdGhpcy5taW5XICsgMSA8IHdpZHRoID8gd2lkdGggOiB0aGlzLm1pblcpOwogICAgICB9CiAgICAgIGlmIChoZWlnaHQgJiYgdGhpcy5oID09PSAiIikgewogICAgICAgIGhlaWdodCArPSBtYXJnaW5WOwogICAgICAgIHRoaXMuaCA9IE1hdGgubWluKHRoaXMubWF4SCA8PSAwID8gSW5maW5pdHkgOiB0aGlzLm1heEgsIHRoaXMubWluSCArIDEgPCBoZWlnaHQgPyBoZWlnaHQgOiB0aGlzLm1pbkgpOwogICAgICB9CiAgICB9CiAgICB0aGlzW19zeW1ib2xfdXRpbHMuJHBvcFBhcmFdKCk7CiAgICAoMCwgX2h0bWxfdXRpbHMuZml4RGltZW5zaW9ucykodGhpcyk7CiAgICBzZXRGaXJzdFVuc3BsaXR0YWJsZSh0aGlzKTsKICAgIGlmICghKDAsIF9sYXlvdXQuY2hlY2tEaW1lbnNpb25zKSh0aGlzLCBhdmFpbGFibGVTcGFjZSkpIHsKICAgICAgdGhpcy53ID0gc2F2ZWRXOwogICAgICB0aGlzLmggPSBzYXZlZEg7CiAgICAgIHRoaXNbX3N5bWJvbF91dGlscy4kcG9wUGFyYV0oKTsKICAgICAgcmV0dXJuIF91dGlscy5IVE1MUmVzdWx0LkZBSUxVUkU7CiAgICB9CiAgICB1bnNldEZpcnN0VW5zcGxpdHRhYmxlKHRoaXMpOwogICAgY29uc3Qgc3R5bGUgPSAoMCwgX2h0bWxfdXRpbHMudG9TdHlsZSkodGhpcywgImZvbnQiLCAiZGltZW5zaW9ucyIsICJwb3NpdGlvbiIsICJyb3RhdGUiLCAiYW5jaG9yVHlwZSIsICJwcmVzZW5jZSIsICJtYXJnaW4iLCAiaEFsaWduIik7CiAgICAoMCwgX2h0bWxfdXRpbHMuc2V0TWluTWF4RGltZW5zaW9ucykodGhpcywgc3R5bGUpOwogICAgY29uc3QgY2xhc3NOYW1lcyA9IFsieGZhRmllbGQiXTsKICAgIGlmICh0aGlzLmZvbnQpIHsKICAgICAgY2xhc3NOYW1lcy5wdXNoKCJ4ZmFGb250Iik7CiAgICB9CiAgICBpZiAoKDAsIF9odG1sX3V0aWxzLmlzUHJpbnRPbmx5KSh0aGlzKSkgewogICAgICBjbGFzc05hbWVzLnB1c2goInhmYVByaW50T25seSIpOwogICAgfQogICAgY29uc3QgYXR0cmlidXRlcyA9IHsKICAgICAgc3R5bGUsCiAgICAgIGlkOiB0aGlzW19zeW1ib2xfdXRpbHMuJHVpZF0sCiAgICAgIGNsYXNzOiBjbGFzc05hbWVzCiAgICB9OwogICAgaWYgKHN0eWxlLm1hcmdpbikgewogICAgICBzdHlsZS5wYWRkaW5nID0gc3R5bGUubWFyZ2luOwogICAgICBkZWxldGUgc3R5bGUubWFyZ2luOwogICAgfQogICAgKDAsIF9odG1sX3V0aWxzLnNldEFjY2VzcykodGhpcywgY2xhc3NOYW1lcyk7CiAgICBpZiAodGhpcy5uYW1lKSB7CiAgICAgIGF0dHJpYnV0ZXMueGZhTmFtZSA9IHRoaXMubmFtZTsKICAgIH0KICAgIGNvbnN0IGNoaWxkcmVuID0gW107CiAgICBjb25zdCBodG1sID0gewogICAgICBuYW1lOiAiZGl2IiwKICAgICAgYXR0cmlidXRlcywKICAgICAgY2hpbGRyZW4KICAgIH07CiAgICBhcHBseUFzc2lzdCh0aGlzLCBhdHRyaWJ1dGVzKTsKICAgIGNvbnN0IGJvcmRlclN0eWxlID0gdGhpcy5ib3JkZXIgPyB0aGlzLmJvcmRlcltfc3ltYm9sX3V0aWxzLiR0b1N0eWxlXSgpIDogbnVsbDsKICAgIGNvbnN0IGJib3ggPSAoMCwgX2h0bWxfdXRpbHMuY29tcHV0ZUJib3gpKHRoaXMsIGh0bWwsIGF2YWlsYWJsZVNwYWNlKTsKICAgIGNvbnN0IHVpID0gdGhpcy51aVtfc3ltYm9sX3V0aWxzLiR0b0hUTUxdKCkuaHRtbDsKICAgIGlmICghdWkpIHsKICAgICAgT2JqZWN0LmFzc2lnbihzdHlsZSwgYm9yZGVyU3R5bGUpOwogICAgICByZXR1cm4gX3V0aWxzLkhUTUxSZXN1bHQuc3VjY2VzcygoMCwgX2h0bWxfdXRpbHMuY3JlYXRlV3JhcHBlcikodGhpcywgaHRtbCksIGJib3gpOwogICAgfQogICAgaWYgKHRoaXNbX3N5bWJvbF91dGlscy4kdGFiSW5kZXhdKSB7CiAgICAgIGlmICh1aS5jaGlsZHJlbj8uWzBdKSB7CiAgICAgICAgdWkuY2hpbGRyZW5bMF0uYXR0cmlidXRlcy50YWJpbmRleCA9IHRoaXNbX3N5bWJvbF91dGlscy4kdGFiSW5kZXhdOwogICAgICB9IGVsc2UgewogICAgICAgIHVpLmF0dHJpYnV0ZXMudGFiaW5kZXggPSB0aGlzW19zeW1ib2xfdXRpbHMuJHRhYkluZGV4XTsKICAgICAgfQogICAgfQogICAgaWYgKCF1aS5hdHRyaWJ1dGVzLnN0eWxlKSB7CiAgICAgIHVpLmF0dHJpYnV0ZXMuc3R5bGUgPSBPYmplY3QuY3JlYXRlKG51bGwpOwogICAgfQogICAgbGV0IGFFbGVtZW50ID0gbnVsbDsKICAgIGlmICh0aGlzLnVpLmJ1dHRvbikgewogICAgICBpZiAodWkuY2hpbGRyZW4ubGVuZ3RoID09PSAxKSB7CiAgICAgICAgW2FFbGVtZW50XSA9IHVpLmNoaWxkcmVuLnNwbGljZSgwLCAxKTsKICAgICAgfQogICAgICBPYmplY3QuYXNzaWduKHVpLmF0dHJpYnV0ZXMuc3R5bGUsIGJvcmRlclN0eWxlKTsKICAgIH0gZWxzZSB7CiAgICAgIE9iamVjdC5hc3NpZ24oc3R5bGUsIGJvcmRlclN0eWxlKTsKICAgIH0KICAgIGNoaWxkcmVuLnB1c2godWkpOwogICAgaWYgKHRoaXMudmFsdWUpIHsKICAgICAgaWYgKHRoaXMudWkuaW1hZ2VFZGl0KSB7CiAgICAgICAgdWkuY2hpbGRyZW4ucHVzaCh0aGlzLnZhbHVlW19zeW1ib2xfdXRpbHMuJHRvSFRNTF0oKS5odG1sKTsKICAgICAgfSBlbHNlIGlmICghdGhpcy51aS5idXR0b24pIHsKICAgICAgICBsZXQgdmFsdWUgPSAiIjsKICAgICAgICBpZiAodGhpcy52YWx1ZS5leERhdGEpIHsKICAgICAgICAgIHZhbHVlID0gdGhpcy52YWx1ZS5leERhdGFbX3N5bWJvbF91dGlscy4kdGV4dF0oKTsKICAgICAgICB9IGVsc2UgaWYgKHRoaXMudmFsdWUudGV4dCkgewogICAgICAgICAgdmFsdWUgPSB0aGlzLnZhbHVlLnRleHRbX3N5bWJvbF91dGlscy4kZ2V0RXh0cmFdKCk7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIGNvbnN0IGh0bWxWYWx1ZSA9IHRoaXMudmFsdWVbX3N5bWJvbF91dGlscy4kdG9IVE1MXSgpLmh0bWw7CiAgICAgICAgICBpZiAoaHRtbFZhbHVlICE9PSBudWxsKSB7CiAgICAgICAgICAgIHZhbHVlID0gaHRtbFZhbHVlLmNoaWxkcmVuWzBdLnZhbHVlOwogICAgICAgICAgfQogICAgICAgIH0KICAgICAgICBpZiAodGhpcy51aS50ZXh0RWRpdCAmJiB0aGlzLnZhbHVlLnRleHQ/Lm1heENoYXJzKSB7CiAgICAgICAgICB1aS5jaGlsZHJlblswXS5hdHRyaWJ1dGVzLm1heExlbmd0aCA9IHRoaXMudmFsdWUudGV4dC5tYXhDaGFyczsKICAgICAgICB9CiAgICAgICAgaWYgKHZhbHVlKSB7CiAgICAgICAgICBpZiAodGhpcy51aS5udW1lcmljRWRpdCkgewogICAgICAgICAgICB2YWx1ZSA9IHBhcnNlRmxvYXQodmFsdWUpOwogICAgICAgICAgICB2YWx1ZSA9IGlzTmFOKHZhbHVlKSA/ICIiIDogdmFsdWUudG9TdHJpbmcoKTsKICAgICAgICAgIH0KICAgICAgICAgIGlmICh1aS5jaGlsZHJlblswXS5uYW1lID09PSAidGV4dGFyZWEiKSB7CiAgICAgICAgICAgIHVpLmNoaWxkcmVuWzBdLmF0dHJpYnV0ZXMudGV4dENvbnRlbnQgPSB2YWx1ZTsKICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIHVpLmNoaWxkcmVuWzBdLmF0dHJpYnV0ZXMudmFsdWUgPSB2YWx1ZTsKICAgICAgICAgIH0KICAgICAgICB9CiAgICAgIH0KICAgIH0KICAgIGlmICghdGhpcy51aS5pbWFnZUVkaXQgJiYgdWkuY2hpbGRyZW4/LlswXSAmJiB0aGlzLmgpIHsKICAgICAgYm9yZGVyRGltcyA9IGJvcmRlckRpbXMgfHwgZ2V0Qm9yZGVyRGltcyh0aGlzLnVpW19zeW1ib2xfdXRpbHMuJGdldEV4dHJhXSgpKTsKICAgICAgbGV0IGNhcHRpb25IZWlnaHQgPSAwOwogICAgICBpZiAodGhpcy5jYXB0aW9uICYmIFsidG9wIiwgImJvdHRvbSJdLmluY2x1ZGVzKHRoaXMuY2FwdGlvbi5wbGFjZW1lbnQpKSB7CiAgICAgICAgY2FwdGlvbkhlaWdodCA9IHRoaXMuY2FwdGlvbi5yZXNlcnZlOwogICAgICAgIGlmIChjYXB0aW9uSGVpZ2h0IDw9IDApIHsKICAgICAgICAgIGNhcHRpb25IZWlnaHQgPSB0aGlzLmNhcHRpb25bX3N5bWJvbF91dGlscy4kZ2V0RXh0cmFdKGF2YWlsYWJsZVNwYWNlKS5oOwogICAgICAgIH0KICAgICAgICBjb25zdCBpbnB1dEhlaWdodCA9IHRoaXMuaCAtIGNhcHRpb25IZWlnaHQgLSBtYXJnaW5WIC0gYm9yZGVyRGltcy5oOwogICAgICAgIHVpLmNoaWxkcmVuWzBdLmF0dHJpYnV0ZXMuc3R5bGUuaGVpZ2h0ID0gKDAsIF9odG1sX3V0aWxzLm1lYXN1cmVUb1N0cmluZykoaW5wdXRIZWlnaHQpOwogICAgICB9IGVsc2UgewogICAgICAgIHVpLmNoaWxkcmVuWzBdLmF0dHJpYnV0ZXMuc3R5bGUuaGVpZ2h0ID0gIjEwMCUiOwogICAgICB9CiAgICB9CiAgICBpZiAoYUVsZW1lbnQpIHsKICAgICAgdWkuY2hpbGRyZW4ucHVzaChhRWxlbWVudCk7CiAgICB9CiAgICBpZiAoIWNhcHRpb24pIHsKICAgICAgaWYgKHVpLmF0dHJpYnV0ZXMuY2xhc3MpIHsKICAgICAgICB1aS5hdHRyaWJ1dGVzLmNsYXNzLnB1c2goInhmYUxlZnQiKTsKICAgICAgfQogICAgICB0aGlzLncgPSBzYXZlZFc7CiAgICAgIHRoaXMuaCA9IHNhdmVkSDsKICAgICAgcmV0dXJuIF91dGlscy5IVE1MUmVzdWx0LnN1Y2Nlc3MoKDAsIF9odG1sX3V0aWxzLmNyZWF0ZVdyYXBwZXIpKHRoaXMsIGh0bWwpLCBiYm94KTsKICAgIH0KICAgIGlmICh0aGlzLnVpLmJ1dHRvbikgewogICAgICBpZiAoc3R5bGUucGFkZGluZykgewogICAgICAgIGRlbGV0ZSBzdHlsZS5wYWRkaW5nOwogICAgICB9CiAgICAgIGlmIChjYXB0aW9uLm5hbWUgPT09ICJkaXYiKSB7CiAgICAgICAgY2FwdGlvbi5uYW1lID0gInNwYW4iOwogICAgICB9CiAgICAgIHVpLmNoaWxkcmVuLnB1c2goY2FwdGlvbik7CiAgICAgIHJldHVybiBfdXRpbHMuSFRNTFJlc3VsdC5zdWNjZXNzKGh0bWwsIGJib3gpOwogICAgfSBlbHNlIGlmICh0aGlzLnVpLmNoZWNrQnV0dG9uKSB7CiAgICAgIGNhcHRpb24uYXR0cmlidXRlcy5jbGFzc1swXSA9ICJ4ZmFDYXB0aW9uRm9yQ2hlY2tCdXR0b24iOwogICAgfQogICAgaWYgKCF1aS5hdHRyaWJ1dGVzLmNsYXNzKSB7CiAgICAgIHVpLmF0dHJpYnV0ZXMuY2xhc3MgPSBbXTsKICAgIH0KICAgIHVpLmNoaWxkcmVuLnNwbGljZSgwLCAwLCBjYXB0aW9uKTsKICAgIHN3aXRjaCAodGhpcy5jYXB0aW9uLnBsYWNlbWVudCkgewogICAgICBjYXNlICJsZWZ0IjoKICAgICAgICB1aS5hdHRyaWJ1dGVzLmNsYXNzLnB1c2goInhmYUxlZnQiKTsKICAgICAgICBicmVhazsKICAgICAgY2FzZSAicmlnaHQiOgogICAgICAgIHVpLmF0dHJpYnV0ZXMuY2xhc3MucHVzaCgieGZhUmlnaHQiKTsKICAgICAgICBicmVhazsKICAgICAgY2FzZSAidG9wIjoKICAgICAgICB1aS5hdHRyaWJ1dGVzLmNsYXNzLnB1c2goInhmYVRvcCIpOwogICAgICAgIGJyZWFrOwogICAgICBjYXNlICJib3R0b20iOgogICAgICAgIHVpLmF0dHJpYnV0ZXMuY2xhc3MucHVzaCgieGZhQm90dG9tIik7CiAgICAgICAgYnJlYWs7CiAgICAgIGNhc2UgImlubGluZSI6CiAgICAgICAgdWkuYXR0cmlidXRlcy5jbGFzcy5wdXNoKCJ4ZmFMZWZ0Iik7CiAgICAgICAgYnJlYWs7CiAgICB9CiAgICB0aGlzLncgPSBzYXZlZFc7CiAgICB0aGlzLmggPSBzYXZlZEg7CiAgICByZXR1cm4gX3V0aWxzLkhUTUxSZXN1bHQuc3VjY2VzcygoMCwgX2h0bWxfdXRpbHMuY3JlYXRlV3JhcHBlcikodGhpcywgaHRtbCksIGJib3gpOwogIH0KfQpleHBvcnRzLkZpZWxkID0gRmllbGQ7CmNsYXNzIEZpbGwgZXh0ZW5kcyBfeGZhX29iamVjdC5YRkFPYmplY3QgewogIGNvbnN0cnVjdG9yKGF0dHJpYnV0ZXMpIHsKICAgIHN1cGVyKFRFTVBMQVRFX05TX0lELCAiZmlsbCIsIHRydWUpOwogICAgdGhpcy5pZCA9IGF0dHJpYnV0ZXMuaWQgfHwgIiI7CiAgICB0aGlzLnByZXNlbmNlID0gKDAsIF91dGlscy5nZXRTdHJpbmdPcHRpb24pKGF0dHJpYnV0ZXMucHJlc2VuY2UsIFsidmlzaWJsZSIsICJoaWRkZW4iLCAiaW5hY3RpdmUiLCAiaW52aXNpYmxlIl0pOwogICAgdGhpcy51c2UgPSBhdHRyaWJ1dGVzLnVzZSB8fCAiIjsKICAgIHRoaXMudXNlaHJlZiA9IGF0dHJpYnV0ZXMudXNlaHJlZiB8fCAiIjsKICAgIHRoaXMuY29sb3IgPSBudWxsOwogICAgdGhpcy5leHRyYXMgPSBudWxsOwogICAgdGhpcy5saW5lYXIgPSBudWxsOwogICAgdGhpcy5wYXR0ZXJuID0gbnVsbDsKICAgIHRoaXMucmFkaWFsID0gbnVsbDsKICAgIHRoaXMuc29saWQgPSBudWxsOwogICAgdGhpcy5zdGlwcGxlID0gbnVsbDsKICB9CiAgW19zeW1ib2xfdXRpbHMuJHRvU3R5bGVdKCkgewogICAgY29uc3QgcGFyZW50ID0gdGhpc1tfc3ltYm9sX3V0aWxzLiRnZXRQYXJlbnRdKCk7CiAgICBjb25zdCBncmFuZHBhID0gcGFyZW50W19zeW1ib2xfdXRpbHMuJGdldFBhcmVudF0oKTsKICAgIGNvbnN0IGdncmFuZHBhID0gZ3JhbmRwYVtfc3ltYm9sX3V0aWxzLiRnZXRQYXJlbnRdKCk7CiAgICBjb25zdCBzdHlsZSA9IE9iamVjdC5jcmVhdGUobnVsbCk7CiAgICBsZXQgcHJvcE5hbWUgPSAiY29sb3IiOwogICAgbGV0IGFsdFByb3BOYW1lID0gcHJvcE5hbWU7CiAgICBpZiAocGFyZW50IGluc3RhbmNlb2YgQm9yZGVyKSB7CiAgICAgIHByb3BOYW1lID0gImJhY2tncm91bmQtY29sb3IiOwogICAgICBhbHRQcm9wTmFtZSA9ICJiYWNrZ3JvdW5kIjsKICAgICAgaWYgKGdncmFuZHBhIGluc3RhbmNlb2YgVWkpIHsKICAgICAgICBzdHlsZS5iYWNrZ3JvdW5kQ29sb3IgPSAid2hpdGUiOwogICAgICB9CiAgICB9CiAgICBpZiAocGFyZW50IGluc3RhbmNlb2YgUmVjdGFuZ2xlIHx8IHBhcmVudCBpbnN0YW5jZW9mIEFyYykgewogICAgICBwcm9wTmFtZSA9IGFsdFByb3BOYW1lID0gImZpbGwiOwogICAgICBzdHlsZS5maWxsID0gIndoaXRlIjsKICAgIH0KICAgIGZvciAoY29uc3QgbmFtZSBvZiBPYmplY3QuZ2V0T3duUHJvcGVydHlOYW1lcyh0aGlzKSkgewogICAgICBpZiAobmFtZSA9PT0gImV4dHJhcyIgfHwgbmFtZSA9PT0gImNvbG9yIikgewogICAgICAgIGNvbnRpbnVlOwogICAgICB9CiAgICAgIGNvbnN0IG9iaiA9IHRoaXNbbmFtZV07CiAgICAgIGlmICghKG9iaiBpbnN0YW5jZW9mIF94ZmFfb2JqZWN0LlhGQU9iamVjdCkpIHsKICAgICAgICBjb250aW51ZTsKICAgICAgfQogICAgICBjb25zdCBjb2xvciA9IG9ialtfc3ltYm9sX3V0aWxzLiR0b1N0eWxlXSh0aGlzLmNvbG9yKTsKICAgICAgaWYgKGNvbG9yKSB7CiAgICAgICAgc3R5bGVbY29sb3Iuc3RhcnRzV2l0aCgiIyIpID8gcHJvcE5hbWUgOiBhbHRQcm9wTmFtZV0gPSBjb2xvcjsKICAgICAgfQogICAgICByZXR1cm4gc3R5bGU7CiAgICB9CiAgICBpZiAodGhpcy5jb2xvcj8udmFsdWUpIHsKICAgICAgY29uc3QgY29sb3IgPSB0aGlzLmNvbG9yW19zeW1ib2xfdXRpbHMuJHRvU3R5bGVdKCk7CiAgICAgIHN0eWxlW2NvbG9yLnN0YXJ0c1dpdGgoIiMiKSA/IHByb3BOYW1lIDogYWx0UHJvcE5hbWVdID0gY29sb3I7CiAgICB9CiAgICByZXR1cm4gc3R5bGU7CiAgfQp9CmNsYXNzIEZpbHRlciBleHRlbmRzIF94ZmFfb2JqZWN0LlhGQU9iamVjdCB7CiAgY29uc3RydWN0b3IoYXR0cmlidXRlcykgewogICAgc3VwZXIoVEVNUExBVEVfTlNfSUQsICJmaWx0ZXIiLCB0cnVlKTsKICAgIHRoaXMuYWRkUmV2b2NhdGlvbkluZm8gPSAoMCwgX3V0aWxzLmdldFN0cmluZ09wdGlvbikoYXR0cmlidXRlcy5hZGRSZXZvY2F0aW9uSW5mbywgWyIiLCAicmVxdWlyZWQiLCAib3B0aW9uYWwiLCAibm9uZSJdKTsKICAgIHRoaXMuaWQgPSBhdHRyaWJ1dGVzLmlkIHx8ICIiOwogICAgdGhpcy5uYW1lID0gYXR0cmlidXRlcy5uYW1lIHx8ICIiOwogICAgdGhpcy51c2UgPSBhdHRyaWJ1dGVzLnVzZSB8fCAiIjsKICAgIHRoaXMudXNlaHJlZiA9IGF0dHJpYnV0ZXMudXNlaHJlZiB8fCAiIjsKICAgIHRoaXMudmVyc2lvbiA9ICgwLCBfdXRpbHMuZ2V0SW50ZWdlcikoewogICAgICBkYXRhOiB0aGlzLnZlcnNpb24sCiAgICAgIGRlZmF1bHRWYWx1ZTogNSwKICAgICAgdmFsaWRhdGU6IHggPT4geCA+PSAxICYmIHggPD0gNQogICAgfSk7CiAgICB0aGlzLmFwcGVhcmFuY2VGaWx0ZXIgPSBudWxsOwogICAgdGhpcy5jZXJ0aWZpY2F0ZXMgPSBudWxsOwogICAgdGhpcy5kaWdlc3RNZXRob2RzID0gbnVsbDsKICAgIHRoaXMuZW5jb2RpbmdzID0gbnVsbDsKICAgIHRoaXMuZW5jcnlwdGlvbk1ldGhvZHMgPSBudWxsOwogICAgdGhpcy5oYW5kbGVyID0gbnVsbDsKICAgIHRoaXMubG9ja0RvY3VtZW50ID0gbnVsbDsKICAgIHRoaXMubWRwID0gbnVsbDsKICAgIHRoaXMucmVhc29ucyA9IG51bGw7CiAgICB0aGlzLnRpbWVTdGFtcCA9IG51bGw7CiAgfQp9CmNsYXNzIEZsb2F0IGV4dGVuZHMgX3hmYV9vYmplY3QuQ29udGVudE9iamVjdCB7CiAgY29uc3RydWN0b3IoYXR0cmlidXRlcykgewogICAgc3VwZXIoVEVNUExBVEVfTlNfSUQsICJmbG9hdCIpOwogICAgdGhpcy5pZCA9IGF0dHJpYnV0ZXMuaWQgfHwgIiI7CiAgICB0aGlzLm5hbWUgPSBhdHRyaWJ1dGVzLm5hbWUgfHwgIiI7CiAgICB0aGlzLnVzZSA9IGF0dHJpYnV0ZXMudXNlIHx8ICIiOwogICAgdGhpcy51c2VocmVmID0gYXR0cmlidXRlcy51c2VocmVmIHx8ICIiOwogIH0KICBbX3N5bWJvbF91dGlscy4kZmluYWxpemVdKCkgewogICAgY29uc3QgbnVtYmVyID0gcGFyc2VGbG9hdCh0aGlzW19zeW1ib2xfdXRpbHMuJGNvbnRlbnRdLnRyaW0oKSk7CiAgICB0aGlzW19zeW1ib2xfdXRpbHMuJGNvbnRlbnRdID0gaXNOYU4obnVtYmVyKSA/IG51bGwgOiBudW1iZXI7CiAgfQogIFtfc3ltYm9sX3V0aWxzLiR0b0hUTUxdKGF2YWlsYWJsZVNwYWNlKSB7CiAgICByZXR1cm4gdmFsdWVUb0h0bWwodGhpc1tfc3ltYm9sX3V0aWxzLiRjb250ZW50XSAhPT0gbnVsbCA/IHRoaXNbX3N5bWJvbF91dGlscy4kY29udGVudF0udG9TdHJpbmcoKSA6ICIiKTsKICB9Cn0KY2xhc3MgRm9udCBleHRlbmRzIF94ZmFfb2JqZWN0LlhGQU9iamVjdCB7CiAgY29uc3RydWN0b3IoYXR0cmlidXRlcykgewogICAgc3VwZXIoVEVNUExBVEVfTlNfSUQsICJmb250IiwgdHJ1ZSk7CiAgICB0aGlzLmJhc2VsaW5lU2hpZnQgPSAoMCwgX3V0aWxzLmdldE1lYXN1cmVtZW50KShhdHRyaWJ1dGVzLmJhc2VsaW5lU2hpZnQpOwogICAgdGhpcy5mb250SG9yaXpvbnRhbFNjYWxlID0gKDAsIF91dGlscy5nZXRGbG9hdCkoewogICAgICBkYXRhOiBhdHRyaWJ1dGVzLmZvbnRIb3Jpem9udGFsU2NhbGUsCiAgICAgIGRlZmF1bHRWYWx1ZTogMTAwLAogICAgICB2YWxpZGF0ZTogeCA9PiB4ID49IDAKICAgIH0pOwogICAgdGhpcy5mb250VmVydGljYWxTY2FsZSA9ICgwLCBfdXRpbHMuZ2V0RmxvYXQpKHsKICAgICAgZGF0YTogYXR0cmlidXRlcy5mb250VmVydGljYWxTY2FsZSwKICAgICAgZGVmYXVsdFZhbHVlOiAxMDAsCiAgICAgIHZhbGlkYXRlOiB4ID0+IHggPj0gMAogICAgfSk7CiAgICB0aGlzLmlkID0gYXR0cmlidXRlcy5pZCB8fCAiIjsKICAgIHRoaXMua2VybmluZ01vZGUgPSAoMCwgX3V0aWxzLmdldFN0cmluZ09wdGlvbikoYXR0cmlidXRlcy5rZXJuaW5nTW9kZSwgWyJub25lIiwgInBhaXIiXSk7CiAgICB0aGlzLmxldHRlclNwYWNpbmcgPSAoMCwgX3V0aWxzLmdldE1lYXN1cmVtZW50KShhdHRyaWJ1dGVzLmxldHRlclNwYWNpbmcsICIwIik7CiAgICB0aGlzLmxpbmVUaHJvdWdoID0gKDAsIF91dGlscy5nZXRJbnRlZ2VyKSh7CiAgICAgIGRhdGE6IGF0dHJpYnV0ZXMubGluZVRocm91Z2gsCiAgICAgIGRlZmF1bHRWYWx1ZTogMCwKICAgICAgdmFsaWRhdGU6IHggPT4geCA9PT0gMSB8fCB4ID09PSAyCiAgICB9KTsKICAgIHRoaXMubGluZVRocm91Z2hQZXJpb2QgPSAoMCwgX3V0aWxzLmdldFN0cmluZ09wdGlvbikoYXR0cmlidXRlcy5saW5lVGhyb3VnaFBlcmlvZCwgWyJhbGwiLCAid29yZCJdKTsKICAgIHRoaXMub3ZlcmxpbmUgPSAoMCwgX3V0aWxzLmdldEludGVnZXIpKHsKICAgICAgZGF0YTogYXR0cmlidXRlcy5vdmVybGluZSwKICAgICAgZGVmYXVsdFZhbHVlOiAwLAogICAgICB2YWxpZGF0ZTogeCA9PiB4ID09PSAxIHx8IHggPT09IDIKICAgIH0pOwogICAgdGhpcy5vdmVybGluZVBlcmlvZCA9ICgwLCBfdXRpbHMuZ2V0U3RyaW5nT3B0aW9uKShhdHRyaWJ1dGVzLm92ZXJsaW5lUGVyaW9kLCBbImFsbCIsICJ3b3JkIl0pOwogICAgdGhpcy5wb3N0dXJlID0gKDAsIF91dGlscy5nZXRTdHJpbmdPcHRpb24pKGF0dHJpYnV0ZXMucG9zdHVyZSwgWyJub3JtYWwiLCAiaXRhbGljIl0pOwogICAgdGhpcy5zaXplID0gKDAsIF91dGlscy5nZXRNZWFzdXJlbWVudCkoYXR0cmlidXRlcy5zaXplLCAiMTBwdCIpOwogICAgdGhpcy50eXBlZmFjZSA9IGF0dHJpYnV0ZXMudHlwZWZhY2UgfHwgIkNvdXJpZXIiOwogICAgdGhpcy51bmRlcmxpbmUgPSAoMCwgX3V0aWxzLmdldEludGVnZXIpKHsKICAgICAgZGF0YTogYXR0cmlidXRlcy51bmRlcmxpbmUsCiAgICAgIGRlZmF1bHRWYWx1ZTogMCwKICAgICAgdmFsaWRhdGU6IHggPT4geCA9PT0gMSB8fCB4ID09PSAyCiAgICB9KTsKICAgIHRoaXMudW5kZXJsaW5lUGVyaW9kID0gKDAsIF91dGlscy5nZXRTdHJpbmdPcHRpb24pKGF0dHJpYnV0ZXMudW5kZXJsaW5lUGVyaW9kLCBbImFsbCIsICJ3b3JkIl0pOwogICAgdGhpcy51c2UgPSBhdHRyaWJ1dGVzLnVzZSB8fCAiIjsKICAgIHRoaXMudXNlaHJlZiA9IGF0dHJpYnV0ZXMudXNlaHJlZiB8fCAiIjsKICAgIHRoaXMud2VpZ2h0ID0gKDAsIF91dGlscy5nZXRTdHJpbmdPcHRpb24pKGF0dHJpYnV0ZXMud2VpZ2h0LCBbIm5vcm1hbCIsICJib2xkIl0pOwogICAgdGhpcy5leHRyYXMgPSBudWxsOwogICAgdGhpcy5maWxsID0gbnVsbDsKICB9CiAgW19zeW1ib2xfdXRpbHMuJGNsZWFuXShidWlsZGVyKSB7CiAgICBzdXBlcltfc3ltYm9sX3V0aWxzLiRjbGVhbl0oYnVpbGRlcik7CiAgICB0aGlzW19zeW1ib2xfdXRpbHMuJGdsb2JhbERhdGFdLnVzZWRUeXBlZmFjZXMuYWRkKHRoaXMudHlwZWZhY2UpOwogIH0KICBbX3N5bWJvbF91dGlscy4kdG9TdHlsZV0oKSB7CiAgICBjb25zdCBzdHlsZSA9ICgwLCBfaHRtbF91dGlscy50b1N0eWxlKSh0aGlzLCAiZmlsbCIpOwogICAgY29uc3QgY29sb3IgPSBzdHlsZS5jb2xvcjsKICAgIGlmIChjb2xvcikgewogICAgICBpZiAoY29sb3IgPT09ICIjMDAwMDAwIikgewogICAgICAgIGRlbGV0ZSBzdHlsZS5jb2xvcjsKICAgICAgfSBlbHNlIGlmICghY29sb3Iuc3RhcnRzV2l0aCgiIyIpKSB7CiAgICAgICAgc3R5bGUuYmFja2dyb3VuZCA9IGNvbG9yOwogICAgICAgIHN0eWxlLmJhY2tncm91bmRDbGlwID0gInRleHQiOwogICAgICAgIHN0eWxlLmNvbG9yID0gInRyYW5zcGFyZW50IjsKICAgICAgfQogICAgfQogICAgaWYgKHRoaXMuYmFzZWxpbmVTaGlmdCkgewogICAgICBzdHlsZS52ZXJ0aWNhbEFsaWduID0gKDAsIF9odG1sX3V0aWxzLm1lYXN1cmVUb1N0cmluZykodGhpcy5iYXNlbGluZVNoaWZ0KTsKICAgIH0KICAgIHN0eWxlLmZvbnRLZXJuaW5nID0gdGhpcy5rZXJuaW5nTW9kZSA9PT0gIm5vbmUiID8gIm5vbmUiIDogIm5vcm1hbCI7CiAgICBzdHlsZS5sZXR0ZXJTcGFjaW5nID0gKDAsIF9odG1sX3V0aWxzLm1lYXN1cmVUb1N0cmluZykodGhpcy5sZXR0ZXJTcGFjaW5nKTsKICAgIGlmICh0aGlzLmxpbmVUaHJvdWdoICE9PSAwKSB7CiAgICAgIHN0eWxlLnRleHREZWNvcmF0aW9uID0gImxpbmUtdGhyb3VnaCI7CiAgICAgIGlmICh0aGlzLmxpbmVUaHJvdWdoID09PSAyKSB7CiAgICAgICAgc3R5bGUudGV4dERlY29yYXRpb25TdHlsZSA9ICJkb3VibGUiOwogICAgICB9CiAgICB9CiAgICBpZiAodGhpcy5vdmVybGluZSAhPT0gMCkgewogICAgICBzdHlsZS50ZXh0RGVjb3JhdGlvbiA9ICJvdmVybGluZSI7CiAgICAgIGlmICh0aGlzLm92ZXJsaW5lID09PSAyKSB7CiAgICAgICAgc3R5bGUudGV4dERlY29yYXRpb25TdHlsZSA9ICJkb3VibGUiOwogICAgICB9CiAgICB9CiAgICBzdHlsZS5mb250U3R5bGUgPSB0aGlzLnBvc3R1cmU7CiAgICBzdHlsZS5mb250U2l6ZSA9ICgwLCBfaHRtbF91dGlscy5tZWFzdXJlVG9TdHJpbmcpKDAuOTkgKiB0aGlzLnNpemUpOwogICAgKDAsIF9odG1sX3V0aWxzLnNldEZvbnRGYW1pbHkpKHRoaXMsIHRoaXMsIHRoaXNbX3N5bWJvbF91dGlscy4kZ2xvYmFsRGF0YV0uZm9udEZpbmRlciwgc3R5bGUpOwogICAgaWYgKHRoaXMudW5kZXJsaW5lICE9PSAwKSB7CiAgICAgIHN0eWxlLnRleHREZWNvcmF0aW9uID0gInVuZGVybGluZSI7CiAgICAgIGlmICh0aGlzLnVuZGVybGluZSA9PT0gMikgewogICAgICAgIHN0eWxlLnRleHREZWNvcmF0aW9uU3R5bGUgPSAiZG91YmxlIjsKICAgICAgfQogICAgfQogICAgc3R5bGUuZm9udFdlaWdodCA9IHRoaXMud2VpZ2h0OwogICAgcmV0dXJuIHN0eWxlOwogIH0KfQpjbGFzcyBGb3JtYXQgZXh0ZW5kcyBfeGZhX29iamVjdC5YRkFPYmplY3QgewogIGNvbnN0cnVjdG9yKGF0dHJpYnV0ZXMpIHsKICAgIHN1cGVyKFRFTVBMQVRFX05TX0lELCAiZm9ybWF0IiwgdHJ1ZSk7CiAgICB0aGlzLmlkID0gYXR0cmlidXRlcy5pZCB8fCAiIjsKICAgIHRoaXMudXNlID0gYXR0cmlidXRlcy51c2UgfHwgIiI7CiAgICB0aGlzLnVzZWhyZWYgPSBhdHRyaWJ1dGVzLnVzZWhyZWYgfHwgIiI7CiAgICB0aGlzLmV4dHJhcyA9IG51bGw7CiAgICB0aGlzLnBpY3R1cmUgPSBudWxsOwogIH0KfQpjbGFzcyBIYW5kbGVyIGV4dGVuZHMgX3hmYV9vYmplY3QuU3RyaW5nT2JqZWN0IHsKICBjb25zdHJ1Y3RvcihhdHRyaWJ1dGVzKSB7CiAgICBzdXBlcihURU1QTEFURV9OU19JRCwgImhhbmRsZXIiKTsKICAgIHRoaXMuaWQgPSBhdHRyaWJ1dGVzLmlkIHx8ICIiOwogICAgdGhpcy50eXBlID0gKDAsIF91dGlscy5nZXRTdHJpbmdPcHRpb24pKGF0dHJpYnV0ZXMudHlwZSwgWyJvcHRpb25hbCIsICJyZXF1aXJlZCJdKTsKICAgIHRoaXMudXNlID0gYXR0cmlidXRlcy51c2UgfHwgIiI7CiAgICB0aGlzLnVzZWhyZWYgPSBhdHRyaWJ1dGVzLnVzZWhyZWYgfHwgIiI7CiAgfQp9CmNsYXNzIEh5cGhlbmF0aW9uIGV4dGVuZHMgX3hmYV9vYmplY3QuWEZBT2JqZWN0IHsKICBjb25zdHJ1Y3RvcihhdHRyaWJ1dGVzKSB7CiAgICBzdXBlcihURU1QTEFURV9OU19JRCwgImh5cGhlbmF0aW9uIik7CiAgICB0aGlzLmV4Y2x1ZGVBbGxDYXBzID0gKDAsIF91dGlscy5nZXRJbnRlZ2VyKSh7CiAgICAgIGRhdGE6IGF0dHJpYnV0ZXMuZXhjbHVkZUFsbENhcHMsCiAgICAgIGRlZmF1bHRWYWx1ZTogMCwKICAgICAgdmFsaWRhdGU6IHggPT4geCA9PT0gMQogICAgfSk7CiAgICB0aGlzLmV4Y2x1ZGVJbml0aWFsQ2FwID0gKDAsIF91dGlscy5nZXRJbnRlZ2VyKSh7CiAgICAgIGRhdGE6IGF0dHJpYnV0ZXMuZXhjbHVkZUluaXRpYWxDYXAsCiAgICAgIGRlZmF1bHRWYWx1ZTogMCwKICAgICAgdmFsaWRhdGU6IHggPT4geCA9PT0gMQogICAgfSk7CiAgICB0aGlzLmh5cGhlbmF0ZSA9ICgwLCBfdXRpbHMuZ2V0SW50ZWdlcikoewogICAgICBkYXRhOiBhdHRyaWJ1dGVzLmh5cGhlbmF0ZSwKICAgICAgZGVmYXVsdFZhbHVlOiAwLAogICAgICB2YWxpZGF0ZTogeCA9PiB4ID09PSAxCiAgICB9KTsKICAgIHRoaXMuaWQgPSBhdHRyaWJ1dGVzLmlkIHx8ICIiOwogICAgdGhpcy5wdXNoQ2hhcmFjdGVyQ291bnQgPSAoMCwgX3V0aWxzLmdldEludGVnZXIpKHsKICAgICAgZGF0YTogYXR0cmlidXRlcy5wdXNoQ2hhcmFjdGVyQ291bnQsCiAgICAgIGRlZmF1bHRWYWx1ZTogMywKICAgICAgdmFsaWRhdGU6IHggPT4geCA+PSAwCiAgICB9KTsKICAgIHRoaXMucmVtYWluQ2hhcmFjdGVyQ291bnQgPSAoMCwgX3V0aWxzLmdldEludGVnZXIpKHsKICAgICAgZGF0YTogYXR0cmlidXRlcy5yZW1haW5DaGFyYWN0ZXJDb3VudCwKICAgICAgZGVmYXVsdFZhbHVlOiAzLAogICAgICB2YWxpZGF0ZTogeCA9PiB4ID49IDAKICAgIH0pOwogICAgdGhpcy51c2UgPSBhdHRyaWJ1dGVzLnVzZSB8fCAiIjsKICAgIHRoaXMudXNlaHJlZiA9IGF0dHJpYnV0ZXMudXNlaHJlZiB8fCAiIjsKICAgIHRoaXMud29yZENoYXJhY3RlckNvdW50ID0gKDAsIF91dGlscy5nZXRJbnRlZ2VyKSh7CiAgICAgIGRhdGE6IGF0dHJpYnV0ZXMud29yZENoYXJhY3RlckNvdW50LAogICAgICBkZWZhdWx0VmFsdWU6IDcsCiAgICAgIHZhbGlkYXRlOiB4ID0+IHggPj0gMAogICAgfSk7CiAgfQp9CmNsYXNzIEltYWdlIGV4dGVuZHMgX3hmYV9vYmplY3QuU3RyaW5nT2JqZWN0IHsKICBjb25zdHJ1Y3RvcihhdHRyaWJ1dGVzKSB7CiAgICBzdXBlcihURU1QTEFURV9OU19JRCwgImltYWdlIik7CiAgICB0aGlzLmFzcGVjdCA9ICgwLCBfdXRpbHMuZ2V0U3RyaW5nT3B0aW9uKShhdHRyaWJ1dGVzLmFzcGVjdCwgWyJmaXQiLCAiYWN0dWFsIiwgImhlaWdodCIsICJub25lIiwgIndpZHRoIl0pOwogICAgdGhpcy5jb250ZW50VHlwZSA9IGF0dHJpYnV0ZXMuY29udGVudFR5cGUgfHwgIiI7CiAgICB0aGlzLmhyZWYgPSBhdHRyaWJ1dGVzLmhyZWYgfHwgIiI7CiAgICB0aGlzLmlkID0gYXR0cmlidXRlcy5pZCB8fCAiIjsKICAgIHRoaXMubmFtZSA9IGF0dHJpYnV0ZXMubmFtZSB8fCAiIjsKICAgIHRoaXMudHJhbnNmZXJFbmNvZGluZyA9ICgwLCBfdXRpbHMuZ2V0U3RyaW5nT3B0aW9uKShhdHRyaWJ1dGVzLnRyYW5zZmVyRW5jb2RpbmcsIFsiYmFzZTY0IiwgIm5vbmUiLCAicGFja2FnZSJdKTsKICAgIHRoaXMudXNlID0gYXR0cmlidXRlcy51c2UgfHwgIiI7CiAgICB0aGlzLnVzZWhyZWYgPSBhdHRyaWJ1dGVzLnVzZWhyZWYgfHwgIiI7CiAgfQogIFtfc3ltYm9sX3V0aWxzLiR0b0hUTUxdKCkgewogICAgaWYgKHRoaXMuY29udGVudFR5cGUgJiYgIU1JTUVTLmhhcyh0aGlzLmNvbnRlbnRUeXBlLnRvTG93ZXJDYXNlKCkpKSB7CiAgICAgIHJldHVybiBfdXRpbHMuSFRNTFJlc3VsdC5FTVBUWTsKICAgIH0KICAgIGxldCBidWZmZXIgPSB0aGlzW19zeW1ib2xfdXRpbHMuJGdsb2JhbERhdGFdLmltYWdlcyAmJiB0aGlzW19zeW1ib2xfdXRpbHMuJGdsb2JhbERhdGFdLmltYWdlcy5nZXQodGhpcy5ocmVmKTsKICAgIGlmICghYnVmZmVyICYmICh0aGlzLmhyZWYgfHwgIXRoaXNbX3N5bWJvbF91dGlscy4kY29udGVudF0pKSB7CiAgICAgIHJldHVybiBfdXRpbHMuSFRNTFJlc3VsdC5FTVBUWTsKICAgIH0KICAgIGlmICghYnVmZmVyICYmIHRoaXMudHJhbnNmZXJFbmNvZGluZyA9PT0gImJhc2U2NCIpIHsKICAgICAgYnVmZmVyID0gKDAsIF91dGlsLnN0cmluZ1RvQnl0ZXMpKGF0b2IodGhpc1tfc3ltYm9sX3V0aWxzLiRjb250ZW50XSkpOwogICAgfQogICAgaWYgKCFidWZmZXIpIHsKICAgICAgcmV0dXJuIF91dGlscy5IVE1MUmVzdWx0LkVNUFRZOwogICAgfQogICAgaWYgKCF0aGlzLmNvbnRlbnRUeXBlKSB7CiAgICAgIGZvciAoY29uc3QgW2hlYWRlciwgdHlwZV0gb2YgSU1BR0VTX0hFQURFUlMpIHsKICAgICAgICBpZiAoYnVmZmVyLmxlbmd0aCA+IGhlYWRlci5sZW5ndGggJiYgaGVhZGVyLmV2ZXJ5KCh4LCBpKSA9PiB4ID09PSBidWZmZXJbaV0pKSB7CiAgICAgICAgICB0aGlzLmNvbnRlbnRUeXBlID0gdHlwZTsKICAgICAgICAgIGJyZWFrOwogICAgICAgIH0KICAgICAgfQogICAgICBpZiAoIXRoaXMuY29udGVudFR5cGUpIHsKICAgICAgICByZXR1cm4gX3V0aWxzLkhUTUxSZXN1bHQuRU1QVFk7CiAgICAgIH0KICAgIH0KICAgIGNvbnN0IGJsb2IgPSBuZXcgQmxvYihbYnVmZmVyXSwgewogICAgICB0eXBlOiB0aGlzLmNvbnRlbnRUeXBlCiAgICB9KTsKICAgIGxldCBzdHlsZTsKICAgIHN3aXRjaCAodGhpcy5hc3BlY3QpIHsKICAgICAgY2FzZSAiZml0IjoKICAgICAgY2FzZSAiYWN0dWFsIjoKICAgICAgICBicmVhazsKICAgICAgY2FzZSAiaGVpZ2h0IjoKICAgICAgICBzdHlsZSA9IHsKICAgICAgICAgIGhlaWdodDogIjEwMCUiLAogICAgICAgICAgb2JqZWN0Rml0OiAiZmlsbCIKICAgICAgICB9OwogICAgICAgIGJyZWFrOwogICAgICBjYXNlICJub25lIjoKICAgICAgICBzdHlsZSA9IHsKICAgICAgICAgIHdpZHRoOiAiMTAwJSIsCiAgICAgICAgICBoZWlnaHQ6ICIxMDAlIiwKICAgICAgICAgIG9iamVjdEZpdDogImZpbGwiCiAgICAgICAgfTsKICAgICAgICBicmVhazsKICAgICAgY2FzZSAid2lkdGgiOgogICAgICAgIHN0eWxlID0gewogICAgICAgICAgd2lkdGg6ICIxMDAlIiwKICAgICAgICAgIG9iamVjdEZpdDogImZpbGwiCiAgICAgICAgfTsKICAgICAgICBicmVhazsKICAgIH0KICAgIGNvbnN0IHBhcmVudCA9IHRoaXNbX3N5bWJvbF91dGlscy4kZ2V0UGFyZW50XSgpOwogICAgcmV0dXJuIF91dGlscy5IVE1MUmVzdWx0LnN1Y2Nlc3MoewogICAgICBuYW1lOiAiaW1nIiwKICAgICAgYXR0cmlidXRlczogewogICAgICAgIGNsYXNzOiBbInhmYUltYWdlIl0sCiAgICAgICAgc3R5bGUsCiAgICAgICAgc3JjOiBVUkwuY3JlYXRlT2JqZWN0VVJMKGJsb2IpLAogICAgICAgIGFsdDogcGFyZW50ID8gYXJpYUxhYmVsKHBhcmVudFtfc3ltYm9sX3V0aWxzLiRnZXRQYXJlbnRdKCkpIDogbnVsbAogICAgICB9CiAgICB9KTsKICB9Cn0KY2xhc3MgSW1hZ2VFZGl0IGV4dGVuZHMgX3hmYV9vYmplY3QuWEZBT2JqZWN0IHsKICBjb25zdHJ1Y3RvcihhdHRyaWJ1dGVzKSB7CiAgICBzdXBlcihURU1QTEFURV9OU19JRCwgImltYWdlRWRpdCIsIHRydWUpOwogICAgdGhpcy5kYXRhID0gKDAsIF91dGlscy5nZXRTdHJpbmdPcHRpb24pKGF0dHJpYnV0ZXMuZGF0YSwgWyJsaW5rIiwgImVtYmVkIl0pOwogICAgdGhpcy5pZCA9IGF0dHJpYnV0ZXMuaWQgfHwgIiI7CiAgICB0aGlzLnVzZSA9IGF0dHJpYnV0ZXMudXNlIHx8ICIiOwogICAgdGhpcy51c2VocmVmID0gYXR0cmlidXRlcy51c2VocmVmIHx8ICIiOwogICAgdGhpcy5ib3JkZXIgPSBudWxsOwogICAgdGhpcy5leHRyYXMgPSBudWxsOwogICAgdGhpcy5tYXJnaW4gPSBudWxsOwogIH0KICBbX3N5bWJvbF91dGlscy4kdG9IVE1MXShhdmFpbGFibGVTcGFjZSkgewogICAgaWYgKHRoaXMuZGF0YSA9PT0gImVtYmVkIikgewogICAgICByZXR1cm4gX3V0aWxzLkhUTUxSZXN1bHQuc3VjY2Vzcyh7CiAgICAgICAgbmFtZTogImRpdiIsCiAgICAgICAgY2hpbGRyZW46IFtdLAogICAgICAgIGF0dHJpYnV0ZXM6IHt9CiAgICAgIH0pOwogICAgfQogICAgcmV0dXJuIF91dGlscy5IVE1MUmVzdWx0LkVNUFRZOwogIH0KfQpjbGFzcyBJbnRlZ2VyIGV4dGVuZHMgX3hmYV9vYmplY3QuQ29udGVudE9iamVjdCB7CiAgY29uc3RydWN0b3IoYXR0cmlidXRlcykgewogICAgc3VwZXIoVEVNUExBVEVfTlNfSUQsICJpbnRlZ2VyIik7CiAgICB0aGlzLmlkID0gYXR0cmlidXRlcy5pZCB8fCAiIjsKICAgIHRoaXMubmFtZSA9IGF0dHJpYnV0ZXMubmFtZSB8fCAiIjsKICAgIHRoaXMudXNlID0gYXR0cmlidXRlcy51c2UgfHwgIiI7CiAgICB0aGlzLnVzZWhyZWYgPSBhdHRyaWJ1dGVzLnVzZWhyZWYgfHwgIiI7CiAgfQogIFtfc3ltYm9sX3V0aWxzLiRmaW5hbGl6ZV0oKSB7CiAgICBjb25zdCBudW1iZXIgPSBwYXJzZUludCh0aGlzW19zeW1ib2xfdXRpbHMuJGNvbnRlbnRdLnRyaW0oKSwgMTApOwogICAgdGhpc1tfc3ltYm9sX3V0aWxzLiRjb250ZW50XSA9IGlzTmFOKG51bWJlcikgPyBudWxsIDogbnVtYmVyOwogIH0KICBbX3N5bWJvbF91dGlscy4kdG9IVE1MXShhdmFpbGFibGVTcGFjZSkgewogICAgcmV0dXJuIHZhbHVlVG9IdG1sKHRoaXNbX3N5bWJvbF91dGlscy4kY29udGVudF0gIT09IG51bGwgPyB0aGlzW19zeW1ib2xfdXRpbHMuJGNvbnRlbnRdLnRvU3RyaW5nKCkgOiAiIik7CiAgfQp9CmNsYXNzIElzc3VlcnMgZXh0ZW5kcyBfeGZhX29iamVjdC5YRkFPYmplY3QgewogIGNvbnN0cnVjdG9yKGF0dHJpYnV0ZXMpIHsKICAgIHN1cGVyKFRFTVBMQVRFX05TX0lELCAiaXNzdWVycyIsIHRydWUpOwogICAgdGhpcy5pZCA9IGF0dHJpYnV0ZXMuaWQgfHwgIiI7CiAgICB0aGlzLnR5cGUgPSAoMCwgX3V0aWxzLmdldFN0cmluZ09wdGlvbikoYXR0cmlidXRlcy50eXBlLCBbIm9wdGlvbmFsIiwgInJlcXVpcmVkIl0pOwogICAgdGhpcy51c2UgPSBhdHRyaWJ1dGVzLnVzZSB8fCAiIjsKICAgIHRoaXMudXNlaHJlZiA9IGF0dHJpYnV0ZXMudXNlaHJlZiB8fCAiIjsKICAgIHRoaXMuY2VydGlmaWNhdGUgPSBuZXcgX3hmYV9vYmplY3QuWEZBT2JqZWN0QXJyYXkoKTsKICB9Cn0KY2xhc3MgSXRlbXMgZXh0ZW5kcyBfeGZhX29iamVjdC5YRkFPYmplY3QgewogIGNvbnN0cnVjdG9yKGF0dHJpYnV0ZXMpIHsKICAgIHN1cGVyKFRFTVBMQVRFX05TX0lELCAiaXRlbXMiLCB0cnVlKTsKICAgIHRoaXMuaWQgPSBhdHRyaWJ1dGVzLmlkIHx8ICIiOwogICAgdGhpcy5uYW1lID0gYXR0cmlidXRlcy5uYW1lIHx8ICIiOwogICAgdGhpcy5wcmVzZW5jZSA9ICgwLCBfdXRpbHMuZ2V0U3RyaW5nT3B0aW9uKShhdHRyaWJ1dGVzLnByZXNlbmNlLCBbInZpc2libGUiLCAiaGlkZGVuIiwgImluYWN0aXZlIiwgImludmlzaWJsZSJdKTsKICAgIHRoaXMucmVmID0gYXR0cmlidXRlcy5yZWYgfHwgIiI7CiAgICB0aGlzLnNhdmUgPSAoMCwgX3V0aWxzLmdldEludGVnZXIpKHsKICAgICAgZGF0YTogYXR0cmlidXRlcy5zYXZlLAogICAgICBkZWZhdWx0VmFsdWU6IDAsCiAgICAgIHZhbGlkYXRlOiB4ID0+IHggPT09IDEKICAgIH0pOwogICAgdGhpcy51c2UgPSBhdHRyaWJ1dGVzLnVzZSB8fCAiIjsKICAgIHRoaXMudXNlaHJlZiA9IGF0dHJpYnV0ZXMudXNlaHJlZiB8fCAiIjsKICAgIHRoaXMuYm9vbGVhbiA9IG5ldyBfeGZhX29iamVjdC5YRkFPYmplY3RBcnJheSgpOwogICAgdGhpcy5kYXRlID0gbmV3IF94ZmFfb2JqZWN0LlhGQU9iamVjdEFycmF5KCk7CiAgICB0aGlzLmRhdGVUaW1lID0gbmV3IF94ZmFfb2JqZWN0LlhGQU9iamVjdEFycmF5KCk7CiAgICB0aGlzLmRlY2ltYWwgPSBuZXcgX3hmYV9vYmplY3QuWEZBT2JqZWN0QXJyYXkoKTsKICAgIHRoaXMuZXhEYXRhID0gbmV3IF94ZmFfb2JqZWN0LlhGQU9iamVjdEFycmF5KCk7CiAgICB0aGlzLmZsb2F0ID0gbmV3IF94ZmFfb2JqZWN0LlhGQU9iamVjdEFycmF5KCk7CiAgICB0aGlzLmltYWdlID0gbmV3IF94ZmFfb2JqZWN0LlhGQU9iamVjdEFycmF5KCk7CiAgICB0aGlzLmludGVnZXIgPSBuZXcgX3hmYV9vYmplY3QuWEZBT2JqZWN0QXJyYXkoKTsKICAgIHRoaXMudGV4dCA9IG5ldyBfeGZhX29iamVjdC5YRkFPYmplY3RBcnJheSgpOwogICAgdGhpcy50aW1lID0gbmV3IF94ZmFfb2JqZWN0LlhGQU9iamVjdEFycmF5KCk7CiAgfQogIFtfc3ltYm9sX3V0aWxzLiR0b0hUTUxdKCkgewogICAgY29uc3Qgb3V0cHV0ID0gW107CiAgICBmb3IgKGNvbnN0IGNoaWxkIG9mIHRoaXNbX3N5bWJvbF91dGlscy4kZ2V0Q2hpbGRyZW5dKCkpIHsKICAgICAgb3V0cHV0LnB1c2goY2hpbGRbX3N5bWJvbF91dGlscy4kdGV4dF0oKSk7CiAgICB9CiAgICByZXR1cm4gX3V0aWxzLkhUTUxSZXN1bHQuc3VjY2VzcyhvdXRwdXQpOwogIH0KfQpleHBvcnRzLkl0ZW1zID0gSXRlbXM7CmNsYXNzIEtlZXAgZXh0ZW5kcyBfeGZhX29iamVjdC5YRkFPYmplY3QgewogIGNvbnN0cnVjdG9yKGF0dHJpYnV0ZXMpIHsKICAgIHN1cGVyKFRFTVBMQVRFX05TX0lELCAia2VlcCIsIHRydWUpOwogICAgdGhpcy5pZCA9IGF0dHJpYnV0ZXMuaWQgfHwgIiI7CiAgICBjb25zdCBvcHRpb25zID0gWyJub25lIiwgImNvbnRlbnRBcmVhIiwgInBhZ2VBcmVhIl07CiAgICB0aGlzLmludGFjdCA9ICgwLCBfdXRpbHMuZ2V0U3RyaW5nT3B0aW9uKShhdHRyaWJ1dGVzLmludGFjdCwgb3B0aW9ucyk7CiAgICB0aGlzLm5leHQgPSAoMCwgX3V0aWxzLmdldFN0cmluZ09wdGlvbikoYXR0cmlidXRlcy5uZXh0LCBvcHRpb25zKTsKICAgIHRoaXMucHJldmlvdXMgPSAoMCwgX3V0aWxzLmdldFN0cmluZ09wdGlvbikoYXR0cmlidXRlcy5wcmV2aW91cywgb3B0aW9ucyk7CiAgICB0aGlzLnVzZSA9IGF0dHJpYnV0ZXMudXNlIHx8ICIiOwogICAgdGhpcy51c2VocmVmID0gYXR0cmlidXRlcy51c2VocmVmIHx8ICIiOwogICAgdGhpcy5leHRyYXMgPSBudWxsOwogIH0KfQpjbGFzcyBLZXlVc2FnZSBleHRlbmRzIF94ZmFfb2JqZWN0LlhGQU9iamVjdCB7CiAgY29uc3RydWN0b3IoYXR0cmlidXRlcykgewogICAgc3VwZXIoVEVNUExBVEVfTlNfSUQsICJrZXlVc2FnZSIpOwogICAgY29uc3Qgb3B0aW9ucyA9IFsiIiwgInllcyIsICJubyJdOwogICAgdGhpcy5jcmxTaWduID0gKDAsIF91dGlscy5nZXRTdHJpbmdPcHRpb24pKGF0dHJpYnV0ZXMuY3JsU2lnbiwgb3B0aW9ucyk7CiAgICB0aGlzLmRhdGFFbmNpcGhlcm1lbnQgPSAoMCwgX3V0aWxzLmdldFN0cmluZ09wdGlvbikoYXR0cmlidXRlcy5kYXRhRW5jaXBoZXJtZW50LCBvcHRpb25zKTsKICAgIHRoaXMuZGVjaXBoZXJPbmx5ID0gKDAsIF91dGlscy5nZXRTdHJpbmdPcHRpb24pKGF0dHJpYnV0ZXMuZGVjaXBoZXJPbmx5LCBvcHRpb25zKTsKICAgIHRoaXMuZGlnaXRhbFNpZ25hdHVyZSA9ICgwLCBfdXRpbHMuZ2V0U3RyaW5nT3B0aW9uKShhdHRyaWJ1dGVzLmRpZ2l0YWxTaWduYXR1cmUsIG9wdGlvbnMpOwogICAgdGhpcy5lbmNpcGhlck9ubHkgPSAoMCwgX3V0aWxzLmdldFN0cmluZ09wdGlvbikoYXR0cmlidXRlcy5lbmNpcGhlck9ubHksIG9wdGlvbnMpOwogICAgdGhpcy5pZCA9IGF0dHJpYnV0ZXMuaWQgfHwgIiI7CiAgICB0aGlzLmtleUFncmVlbWVudCA9ICgwLCBfdXRpbHMuZ2V0U3RyaW5nT3B0aW9uKShhdHRyaWJ1dGVzLmtleUFncmVlbWVudCwgb3B0aW9ucyk7CiAgICB0aGlzLmtleUNlcnRTaWduID0gKDAsIF91dGlscy5nZXRTdHJpbmdPcHRpb24pKGF0dHJpYnV0ZXMua2V5Q2VydFNpZ24sIG9wdGlvbnMpOwogICAgdGhpcy5rZXlFbmNpcGhlcm1lbnQgPSAoMCwgX3V0aWxzLmdldFN0cmluZ09wdGlvbikoYXR0cmlidXRlcy5rZXlFbmNpcGhlcm1lbnQsIG9wdGlvbnMpOwogICAgdGhpcy5ub25SZXB1ZGlhdGlvbiA9ICgwLCBfdXRpbHMuZ2V0U3RyaW5nT3B0aW9uKShhdHRyaWJ1dGVzLm5vblJlcHVkaWF0aW9uLCBvcHRpb25zKTsKICAgIHRoaXMudHlwZSA9ICgwLCBfdXRpbHMuZ2V0U3RyaW5nT3B0aW9uKShhdHRyaWJ1dGVzLnR5cGUsIFsib3B0aW9uYWwiLCAicmVxdWlyZWQiXSk7CiAgICB0aGlzLnVzZSA9IGF0dHJpYnV0ZXMudXNlIHx8ICIiOwogICAgdGhpcy51c2VocmVmID0gYXR0cmlidXRlcy51c2VocmVmIHx8ICIiOwogIH0KfQpjbGFzcyBMaW5lIGV4dGVuZHMgX3hmYV9vYmplY3QuWEZBT2JqZWN0IHsKICBjb25zdHJ1Y3RvcihhdHRyaWJ1dGVzKSB7CiAgICBzdXBlcihURU1QTEFURV9OU19JRCwgImxpbmUiLCB0cnVlKTsKICAgIHRoaXMuaGFuZCA9ICgwLCBfdXRpbHMuZ2V0U3RyaW5nT3B0aW9uKShhdHRyaWJ1dGVzLmhhbmQsIFsiZXZlbiIsICJsZWZ0IiwgInJpZ2h0Il0pOwogICAgdGhpcy5pZCA9IGF0dHJpYnV0ZXMuaWQgfHwgIiI7CiAgICB0aGlzLnNsb3BlID0gKDAsIF91dGlscy5nZXRTdHJpbmdPcHRpb24pKGF0dHJpYnV0ZXMuc2xvcGUsIFsiXFwiLCAiLyJdKTsKICAgIHRoaXMudXNlID0gYXR0cmlidXRlcy51c2UgfHwgIiI7CiAgICB0aGlzLnVzZWhyZWYgPSBhdHRyaWJ1dGVzLnVzZWhyZWYgfHwgIiI7CiAgICB0aGlzLmVkZ2UgPSBudWxsOwogIH0KICBbX3N5bWJvbF91dGlscy4kdG9IVE1MXSgpIHsKICAgIGNvbnN0IHBhcmVudCA9IHRoaXNbX3N5bWJvbF91dGlscy4kZ2V0UGFyZW50XSgpW19zeW1ib2xfdXRpbHMuJGdldFBhcmVudF0oKTsKICAgIGNvbnN0IGVkZ2UgPSB0aGlzLmVkZ2UgfHwgbmV3IEVkZ2Uoe30pOwogICAgY29uc3QgZWRnZVN0eWxlID0gZWRnZVtfc3ltYm9sX3V0aWxzLiR0b1N0eWxlXSgpOwogICAgY29uc3Qgc3R5bGUgPSBPYmplY3QuY3JlYXRlKG51bGwpOwogICAgY29uc3QgdGhpY2tuZXNzID0gZWRnZS5wcmVzZW5jZSA9PT0gInZpc2libGUiID8gZWRnZS50aGlja25lc3MgOiAwOwogICAgc3R5bGUuc3Ryb2tlV2lkdGggPSAoMCwgX2h0bWxfdXRpbHMubWVhc3VyZVRvU3RyaW5nKSh0aGlja25lc3MpOwogICAgc3R5bGUuc3Ryb2tlID0gZWRnZVN0eWxlLmNvbG9yOwogICAgbGV0IHgxLCB5MSwgeDIsIHkyOwogICAgbGV0IHdpZHRoID0gIjEwMCUiOwogICAgbGV0IGhlaWdodCA9ICIxMDAlIjsKICAgIGlmIChwYXJlbnQudyA8PSB0aGlja25lc3MpIHsKICAgICAgW3gxLCB5MSwgeDIsIHkyXSA9IFsiNTAlIiwgMCwgIjUwJSIsICIxMDAlIl07CiAgICAgIHdpZHRoID0gc3R5bGUuc3Ryb2tlV2lkdGg7CiAgICB9IGVsc2UgaWYgKHBhcmVudC5oIDw9IHRoaWNrbmVzcykgewogICAgICBbeDEsIHkxLCB4MiwgeTJdID0gWzAsICI1MCUiLCAiMTAwJSIsICI1MCUiXTsKICAgICAgaGVpZ2h0ID0gc3R5bGUuc3Ryb2tlV2lkdGg7CiAgICB9IGVsc2UgaWYgKHRoaXMuc2xvcGUgPT09ICJcXCIpIHsKICAgICAgW3gxLCB5MSwgeDIsIHkyXSA9IFswLCAwLCAiMTAwJSIsICIxMDAlIl07CiAgICB9IGVsc2UgewogICAgICBbeDEsIHkxLCB4MiwgeTJdID0gWzAsICIxMDAlIiwgIjEwMCUiLCAwXTsKICAgIH0KICAgIGNvbnN0IGxpbmUgPSB7CiAgICAgIG5hbWU6ICJsaW5lIiwKICAgICAgYXR0cmlidXRlczogewogICAgICAgIHhtbG5zOiBTVkdfTlMsCiAgICAgICAgeDEsCiAgICAgICAgeTEsCiAgICAgICAgeDIsCiAgICAgICAgeTIsCiAgICAgICAgc3R5bGUKICAgICAgfQogICAgfTsKICAgIGNvbnN0IHN2ZyA9IHsKICAgICAgbmFtZTogInN2ZyIsCiAgICAgIGNoaWxkcmVuOiBbbGluZV0sCiAgICAgIGF0dHJpYnV0ZXM6IHsKICAgICAgICB4bWxuczogU1ZHX05TLAogICAgICAgIHdpZHRoLAogICAgICAgIGhlaWdodCwKICAgICAgICBzdHlsZTogewogICAgICAgICAgb3ZlcmZsb3c6ICJ2aXNpYmxlIgogICAgICAgIH0KICAgICAgfQogICAgfTsKICAgIGlmIChoYXNNYXJnaW4ocGFyZW50KSkgewogICAgICByZXR1cm4gX3V0aWxzLkhUTUxSZXN1bHQuc3VjY2Vzcyh7CiAgICAgICAgbmFtZTogImRpdiIsCiAgICAgICAgYXR0cmlidXRlczogewogICAgICAgICAgc3R5bGU6IHsKICAgICAgICAgICAgZGlzcGxheTogImlubGluZSIsCiAgICAgICAgICAgIHdpZHRoOiAiMTAwJSIsCiAgICAgICAgICAgIGhlaWdodDogIjEwMCUiCiAgICAgICAgICB9CiAgICAgICAgfSwKICAgICAgICBjaGlsZHJlbjogW3N2Z10KICAgICAgfSk7CiAgICB9CiAgICBzdmcuYXR0cmlidXRlcy5zdHlsZS5wb3NpdGlvbiA9ICJhYnNvbHV0ZSI7CiAgICByZXR1cm4gX3V0aWxzLkhUTUxSZXN1bHQuc3VjY2VzcyhzdmcpOwogIH0KfQpjbGFzcyBMaW5lYXIgZXh0ZW5kcyBfeGZhX29iamVjdC5YRkFPYmplY3QgewogIGNvbnN0cnVjdG9yKGF0dHJpYnV0ZXMpIHsKICAgIHN1cGVyKFRFTVBMQVRFX05TX0lELCAibGluZWFyIiwgdHJ1ZSk7CiAgICB0aGlzLmlkID0gYXR0cmlidXRlcy5pZCB8fCAiIjsKICAgIHRoaXMudHlwZSA9ICgwLCBfdXRpbHMuZ2V0U3RyaW5nT3B0aW9uKShhdHRyaWJ1dGVzLnR5cGUsIFsidG9SaWdodCIsICJ0b0JvdHRvbSIsICJ0b0xlZnQiLCAidG9Ub3AiXSk7CiAgICB0aGlzLnVzZSA9IGF0dHJpYnV0ZXMudXNlIHx8ICIiOwogICAgdGhpcy51c2VocmVmID0gYXR0cmlidXRlcy51c2VocmVmIHx8ICIiOwogICAgdGhpcy5jb2xvciA9IG51bGw7CiAgICB0aGlzLmV4dHJhcyA9IG51bGw7CiAgfQogIFtfc3ltYm9sX3V0aWxzLiR0b1N0eWxlXShzdGFydENvbG9yKSB7CiAgICBzdGFydENvbG9yID0gc3RhcnRDb2xvciA/IHN0YXJ0Q29sb3JbX3N5bWJvbF91dGlscy4kdG9TdHlsZV0oKSA6ICIjRkZGRkZGIjsKICAgIGNvbnN0IHRyYW5zZiA9IHRoaXMudHlwZS5yZXBsYWNlKC8oW1JCTFRdKS8sICIgJDEiKS50b0xvd2VyQ2FzZSgpOwogICAgY29uc3QgZW5kQ29sb3IgPSB0aGlzLmNvbG9yID8gdGhpcy5jb2xvcltfc3ltYm9sX3V0aWxzLiR0b1N0eWxlXSgpIDogIiMwMDAwMDAiOwogICAgcmV0dXJuIGBsaW5lYXItZ3JhZGllbnQoJHt0cmFuc2Z9LCAke3N0YXJ0Q29sb3J9LCAke2VuZENvbG9yfSlgOwogIH0KfQpjbGFzcyBMb2NrRG9jdW1lbnQgZXh0ZW5kcyBfeGZhX29iamVjdC5Db250ZW50T2JqZWN0IHsKICBjb25zdHJ1Y3RvcihhdHRyaWJ1dGVzKSB7CiAgICBzdXBlcihURU1QTEFURV9OU19JRCwgImxvY2tEb2N1bWVudCIpOwogICAgdGhpcy5pZCA9IGF0dHJpYnV0ZXMuaWQgfHwgIiI7CiAgICB0aGlzLnR5cGUgPSAoMCwgX3V0aWxzLmdldFN0cmluZ09wdGlvbikoYXR0cmlidXRlcy50eXBlLCBbIm9wdGlvbmFsIiwgInJlcXVpcmVkIl0pOwogICAgdGhpcy51c2UgPSBhdHRyaWJ1dGVzLnVzZSB8fCAiIjsKICAgIHRoaXMudXNlaHJlZiA9IGF0dHJpYnV0ZXMudXNlaHJlZiB8fCAiIjsKICB9CiAgW19zeW1ib2xfdXRpbHMuJGZpbmFsaXplXSgpIHsKICAgIHRoaXNbX3N5bWJvbF91dGlscy4kY29udGVudF0gPSAoMCwgX3V0aWxzLmdldFN0cmluZ09wdGlvbikodGhpc1tfc3ltYm9sX3V0aWxzLiRjb250ZW50XSwgWyJhdXRvIiwgIjAiLCAiMSJdKTsKICB9Cn0KY2xhc3MgTWFuaWZlc3QgZXh0ZW5kcyBfeGZhX29iamVjdC5YRkFPYmplY3QgewogIGNvbnN0cnVjdG9yKGF0dHJpYnV0ZXMpIHsKICAgIHN1cGVyKFRFTVBMQVRFX05TX0lELCAibWFuaWZlc3QiLCB0cnVlKTsKICAgIHRoaXMuYWN0aW9uID0gKDAsIF91dGlscy5nZXRTdHJpbmdPcHRpb24pKGF0dHJpYnV0ZXMuYWN0aW9uLCBbImluY2x1ZGUiLCAiYWxsIiwgImV4Y2x1ZGUiXSk7CiAgICB0aGlzLmlkID0gYXR0cmlidXRlcy5pZCB8fCAiIjsKICAgIHRoaXMubmFtZSA9IGF0dHJpYnV0ZXMubmFtZSB8fCAiIjsKICAgIHRoaXMudXNlID0gYXR0cmlidXRlcy51c2UgfHwgIiI7CiAgICB0aGlzLnVzZWhyZWYgPSBhdHRyaWJ1dGVzLnVzZWhyZWYgfHwgIiI7CiAgICB0aGlzLmV4dHJhcyA9IG51bGw7CiAgICB0aGlzLnJlZiA9IG5ldyBfeGZhX29iamVjdC5YRkFPYmplY3RBcnJheSgpOwogIH0KfQpjbGFzcyBNYXJnaW4gZXh0ZW5kcyBfeGZhX29iamVjdC5YRkFPYmplY3QgewogIGNvbnN0cnVjdG9yKGF0dHJpYnV0ZXMpIHsKICAgIHN1cGVyKFRFTVBMQVRFX05TX0lELCAibWFyZ2luIiwgdHJ1ZSk7CiAgICB0aGlzLmJvdHRvbUluc2V0ID0gKDAsIF91dGlscy5nZXRNZWFzdXJlbWVudCkoYXR0cmlidXRlcy5ib3R0b21JbnNldCwgIjAiKTsKICAgIHRoaXMuaWQgPSBhdHRyaWJ1dGVzLmlkIHx8ICIiOwogICAgdGhpcy5sZWZ0SW5zZXQgPSAoMCwgX3V0aWxzLmdldE1lYXN1cmVtZW50KShhdHRyaWJ1dGVzLmxlZnRJbnNldCwgIjAiKTsKICAgIHRoaXMucmlnaHRJbnNldCA9ICgwLCBfdXRpbHMuZ2V0TWVhc3VyZW1lbnQpKGF0dHJpYnV0ZXMucmlnaHRJbnNldCwgIjAiKTsKICAgIHRoaXMudG9wSW5zZXQgPSAoMCwgX3V0aWxzLmdldE1lYXN1cmVtZW50KShhdHRyaWJ1dGVzLnRvcEluc2V0LCAiMCIpOwogICAgdGhpcy51c2UgPSBhdHRyaWJ1dGVzLnVzZSB8fCAiIjsKICAgIHRoaXMudXNlaHJlZiA9IGF0dHJpYnV0ZXMudXNlaHJlZiB8fCAiIjsKICAgIHRoaXMuZXh0cmFzID0gbnVsbDsKICB9CiAgW19zeW1ib2xfdXRpbHMuJHRvU3R5bGVdKCkgewogICAgcmV0dXJuIHsKICAgICAgbWFyZ2luOiAoMCwgX2h0bWxfdXRpbHMubWVhc3VyZVRvU3RyaW5nKSh0aGlzLnRvcEluc2V0KSArICIgIiArICgwLCBfaHRtbF91dGlscy5tZWFzdXJlVG9TdHJpbmcpKHRoaXMucmlnaHRJbnNldCkgKyAiICIgKyAoMCwgX2h0bWxfdXRpbHMubWVhc3VyZVRvU3RyaW5nKSh0aGlzLmJvdHRvbUluc2V0KSArICIgIiArICgwLCBfaHRtbF91dGlscy5tZWFzdXJlVG9TdHJpbmcpKHRoaXMubGVmdEluc2V0KQogICAgfTsKICB9Cn0KY2xhc3MgTWRwIGV4dGVuZHMgX3hmYV9vYmplY3QuWEZBT2JqZWN0IHsKICBjb25zdHJ1Y3RvcihhdHRyaWJ1dGVzKSB7CiAgICBzdXBlcihURU1QTEFURV9OU19JRCwgIm1kcCIpOwogICAgdGhpcy5pZCA9IGF0dHJpYnV0ZXMuaWQgfHwgIiI7CiAgICB0aGlzLnBlcm1pc3Npb25zID0gKDAsIF91dGlscy5nZXRJbnRlZ2VyKSh7CiAgICAgIGRhdGE6IGF0dHJpYnV0ZXMucGVybWlzc2lvbnMsCiAgICAgIGRlZmF1bHRWYWx1ZTogMiwKICAgICAgdmFsaWRhdGU6IHggPT4geCA9PT0gMSB8fCB4ID09PSAzCiAgICB9KTsKICAgIHRoaXMuc2lnbmF0dXJlVHlwZSA9ICgwLCBfdXRpbHMuZ2V0U3RyaW5nT3B0aW9uKShhdHRyaWJ1dGVzLnNpZ25hdHVyZVR5cGUsIFsiZmlsbGVyIiwgImF1dGhvciJdKTsKICAgIHRoaXMudXNlID0gYXR0cmlidXRlcy51c2UgfHwgIiI7CiAgICB0aGlzLnVzZWhyZWYgPSBhdHRyaWJ1dGVzLnVzZWhyZWYgfHwgIiI7CiAgfQp9CmNsYXNzIE1lZGl1bSBleHRlbmRzIF94ZmFfb2JqZWN0LlhGQU9iamVjdCB7CiAgY29uc3RydWN0b3IoYXR0cmlidXRlcykgewogICAgc3VwZXIoVEVNUExBVEVfTlNfSUQsICJtZWRpdW0iKTsKICAgIHRoaXMuaWQgPSBhdHRyaWJ1dGVzLmlkIHx8ICIiOwogICAgdGhpcy5pbWFnaW5nQkJveCA9ICgwLCBfdXRpbHMuZ2V0QkJveCkoYXR0cmlidXRlcy5pbWFnaW5nQkJveCk7CiAgICB0aGlzLmxvbmcgPSAoMCwgX3V0aWxzLmdldE1lYXN1cmVtZW50KShhdHRyaWJ1dGVzLmxvbmcpOwogICAgdGhpcy5vcmllbnRhdGlvbiA9ICgwLCBfdXRpbHMuZ2V0U3RyaW5nT3B0aW9uKShhdHRyaWJ1dGVzLm9yaWVudGF0aW9uLCBbInBvcnRyYWl0IiwgImxhbmRzY2FwZSJdKTsKICAgIHRoaXMuc2hvcnQgPSAoMCwgX3V0aWxzLmdldE1lYXN1cmVtZW50KShhdHRyaWJ1dGVzLnNob3J0KTsKICAgIHRoaXMuc3RvY2sgPSBhdHRyaWJ1dGVzLnN0b2NrIHx8ICIiOwogICAgdGhpcy50cmF5SW4gPSAoMCwgX3V0aWxzLmdldFN0cmluZ09wdGlvbikoYXR0cmlidXRlcy50cmF5SW4sIFsiYXV0byIsICJkZWxlZ2F0ZSIsICJwYWdlRnJvbnQiXSk7CiAgICB0aGlzLnRyYXlPdXQgPSAoMCwgX3V0aWxzLmdldFN0cmluZ09wdGlvbikoYXR0cmlidXRlcy50cmF5T3V0LCBbImF1dG8iLCAiZGVsZWdhdGUiXSk7CiAgICB0aGlzLnVzZSA9IGF0dHJpYnV0ZXMudXNlIHx8ICIiOwogICAgdGhpcy51c2VocmVmID0gYXR0cmlidXRlcy51c2VocmVmIHx8ICIiOwogIH0KfQpjbGFzcyBNZXNzYWdlIGV4dGVuZHMgX3hmYV9vYmplY3QuWEZBT2JqZWN0IHsKICBjb25zdHJ1Y3RvcihhdHRyaWJ1dGVzKSB7CiAgICBzdXBlcihURU1QTEFURV9OU19JRCwgIm1lc3NhZ2UiLCB0cnVlKTsKICAgIHRoaXMuaWQgPSBhdHRyaWJ1dGVzLmlkIHx8ICIiOwogICAgdGhpcy51c2UgPSBhdHRyaWJ1dGVzLnVzZSB8fCAiIjsKICAgIHRoaXMudXNlaHJlZiA9IGF0dHJpYnV0ZXMudXNlaHJlZiB8fCAiIjsKICAgIHRoaXMudGV4dCA9IG5ldyBfeGZhX29iamVjdC5YRkFPYmplY3RBcnJheSgpOwogIH0KfQpjbGFzcyBOdW1lcmljRWRpdCBleHRlbmRzIF94ZmFfb2JqZWN0LlhGQU9iamVjdCB7CiAgY29uc3RydWN0b3IoYXR0cmlidXRlcykgewogICAgc3VwZXIoVEVNUExBVEVfTlNfSUQsICJudW1lcmljRWRpdCIsIHRydWUpOwogICAgdGhpcy5oU2Nyb2xsUG9saWN5ID0gKDAsIF91dGlscy5nZXRTdHJpbmdPcHRpb24pKGF0dHJpYnV0ZXMuaFNjcm9sbFBvbGljeSwgWyJhdXRvIiwgIm9mZiIsICJvbiJdKTsKICAgIHRoaXMuaWQgPSBhdHRyaWJ1dGVzLmlkIHx8ICIiOwogICAgdGhpcy51c2UgPSBhdHRyaWJ1dGVzLnVzZSB8fCAiIjsKICAgIHRoaXMudXNlaHJlZiA9IGF0dHJpYnV0ZXMudXNlaHJlZiB8fCAiIjsKICAgIHRoaXMuYm9yZGVyID0gbnVsbDsKICAgIHRoaXMuY29tYiA9IG51bGw7CiAgICB0aGlzLmV4dHJhcyA9IG51bGw7CiAgICB0aGlzLm1hcmdpbiA9IG51bGw7CiAgfQogIFtfc3ltYm9sX3V0aWxzLiR0b0hUTUxdKGF2YWlsYWJsZVNwYWNlKSB7CiAgICBjb25zdCBzdHlsZSA9ICgwLCBfaHRtbF91dGlscy50b1N0eWxlKSh0aGlzLCAiYm9yZGVyIiwgImZvbnQiLCAibWFyZ2luIik7CiAgICBjb25zdCBmaWVsZCA9IHRoaXNbX3N5bWJvbF91dGlscy4kZ2V0UGFyZW50XSgpW19zeW1ib2xfdXRpbHMuJGdldFBhcmVudF0oKTsKICAgIGNvbnN0IGh0bWwgPSB7CiAgICAgIG5hbWU6ICJpbnB1dCIsCiAgICAgIGF0dHJpYnV0ZXM6IHsKICAgICAgICB0eXBlOiAidGV4dCIsCiAgICAgICAgZmllbGRJZDogZmllbGRbX3N5bWJvbF91dGlscy4kdWlkXSwKICAgICAgICBkYXRhSWQ6IGZpZWxkW19zeW1ib2xfdXRpbHMuJGRhdGFdPy5bX3N5bWJvbF91dGlscy4kdWlkXSB8fCBmaWVsZFtfc3ltYm9sX3V0aWxzLiR1aWRdLAogICAgICAgIGNsYXNzOiBbInhmYVRleHRmaWVsZCJdLAogICAgICAgIHN0eWxlLAogICAgICAgICJhcmlhLWxhYmVsIjogYXJpYUxhYmVsKGZpZWxkKSwKICAgICAgICAiYXJpYS1yZXF1aXJlZCI6IGZhbHNlCiAgICAgIH0KICAgIH07CiAgICBpZiAoaXNSZXF1aXJlZChmaWVsZCkpIHsKICAgICAgaHRtbC5hdHRyaWJ1dGVzWyJhcmlhLXJlcXVpcmVkIl0gPSB0cnVlOwogICAgICBodG1sLmF0dHJpYnV0ZXMucmVxdWlyZWQgPSB0cnVlOwogICAgfQogICAgcmV0dXJuIF91dGlscy5IVE1MUmVzdWx0LnN1Y2Nlc3MoewogICAgICBuYW1lOiAibGFiZWwiLAogICAgICBhdHRyaWJ1dGVzOiB7CiAgICAgICAgY2xhc3M6IFsieGZhTGFiZWwiXQogICAgICB9LAogICAgICBjaGlsZHJlbjogW2h0bWxdCiAgICB9KTsKICB9Cn0KY2xhc3MgT2NjdXIgZXh0ZW5kcyBfeGZhX29iamVjdC5YRkFPYmplY3QgewogIGNvbnN0cnVjdG9yKGF0dHJpYnV0ZXMpIHsKICAgIHN1cGVyKFRFTVBMQVRFX05TX0lELCAib2NjdXIiLCB0cnVlKTsKICAgIHRoaXMuaWQgPSBhdHRyaWJ1dGVzLmlkIHx8ICIiOwogICAgdGhpcy5pbml0aWFsID0gYXR0cmlidXRlcy5pbml0aWFsICE9PSAiIiA/ICgwLCBfdXRpbHMuZ2V0SW50ZWdlcikoewogICAgICBkYXRhOiBhdHRyaWJ1dGVzLmluaXRpYWwsCiAgICAgIGRlZmF1bHRWYWx1ZTogIiIsCiAgICAgIHZhbGlkYXRlOiB4ID0+IHRydWUKICAgIH0pIDogIiI7CiAgICB0aGlzLm1heCA9IGF0dHJpYnV0ZXMubWF4ICE9PSAiIiA/ICgwLCBfdXRpbHMuZ2V0SW50ZWdlcikoewogICAgICBkYXRhOiBhdHRyaWJ1dGVzLm1heCwKICAgICAgZGVmYXVsdFZhbHVlOiAxLAogICAgICB2YWxpZGF0ZTogeCA9PiB0cnVlCiAgICB9KSA6ICIiOwogICAgdGhpcy5taW4gPSBhdHRyaWJ1dGVzLm1pbiAhPT0gIiIgPyAoMCwgX3V0aWxzLmdldEludGVnZXIpKHsKICAgICAgZGF0YTogYXR0cmlidXRlcy5taW4sCiAgICAgIGRlZmF1bHRWYWx1ZTogMSwKICAgICAgdmFsaWRhdGU6IHggPT4gdHJ1ZQogICAgfSkgOiAiIjsKICAgIHRoaXMudXNlID0gYXR0cmlidXRlcy51c2UgfHwgIiI7CiAgICB0aGlzLnVzZWhyZWYgPSBhdHRyaWJ1dGVzLnVzZWhyZWYgfHwgIiI7CiAgICB0aGlzLmV4dHJhcyA9IG51bGw7CiAgfQogIFtfc3ltYm9sX3V0aWxzLiRjbGVhbl0oKSB7CiAgICBjb25zdCBwYXJlbnQgPSB0aGlzW19zeW1ib2xfdXRpbHMuJGdldFBhcmVudF0oKTsKICAgIGNvbnN0IG9yaWdpbmFsTWluID0gdGhpcy5taW47CiAgICBpZiAodGhpcy5taW4gPT09ICIiKSB7CiAgICAgIHRoaXMubWluID0gcGFyZW50IGluc3RhbmNlb2YgUGFnZUFyZWEgfHwgcGFyZW50IGluc3RhbmNlb2YgUGFnZVNldCA/IDAgOiAxOwogICAgfQogICAgaWYgKHRoaXMubWF4ID09PSAiIikgewogICAgICBpZiAob3JpZ2luYWxNaW4gPT09ICIiKSB7CiAgICAgICAgdGhpcy5tYXggPSBwYXJlbnQgaW5zdGFuY2VvZiBQYWdlQXJlYSB8fCBwYXJlbnQgaW5zdGFuY2VvZiBQYWdlU2V0ID8gLTEgOiAxOwogICAgICB9IGVsc2UgewogICAgICAgIHRoaXMubWF4ID0gdGhpcy5taW47CiAgICAgIH0KICAgIH0KICAgIGlmICh0aGlzLm1heCAhPT0gLTEgJiYgdGhpcy5tYXggPCB0aGlzLm1pbikgewogICAgICB0aGlzLm1heCA9IHRoaXMubWluOwogICAgfQogICAgaWYgKHRoaXMuaW5pdGlhbCA9PT0gIiIpIHsKICAgICAgdGhpcy5pbml0aWFsID0gcGFyZW50IGluc3RhbmNlb2YgVGVtcGxhdGUgPyAxIDogdGhpcy5taW47CiAgICB9CiAgfQp9CmNsYXNzIE9pZCBleHRlbmRzIF94ZmFfb2JqZWN0LlN0cmluZ09iamVjdCB7CiAgY29uc3RydWN0b3IoYXR0cmlidXRlcykgewogICAgc3VwZXIoVEVNUExBVEVfTlNfSUQsICJvaWQiKTsKICAgIHRoaXMuaWQgPSBhdHRyaWJ1dGVzLmlkIHx8ICIiOwogICAgdGhpcy5uYW1lID0gYXR0cmlidXRlcy5uYW1lIHx8ICIiOwogICAgdGhpcy51c2UgPSBhdHRyaWJ1dGVzLnVzZSB8fCAiIjsKICAgIHRoaXMudXNlaHJlZiA9IGF0dHJpYnV0ZXMudXNlaHJlZiB8fCAiIjsKICB9Cn0KY2xhc3MgT2lkcyBleHRlbmRzIF94ZmFfb2JqZWN0LlhGQU9iamVjdCB7CiAgY29uc3RydWN0b3IoYXR0cmlidXRlcykgewogICAgc3VwZXIoVEVNUExBVEVfTlNfSUQsICJvaWRzIiwgdHJ1ZSk7CiAgICB0aGlzLmlkID0gYXR0cmlidXRlcy5pZCB8fCAiIjsKICAgIHRoaXMudHlwZSA9ICgwLCBfdXRpbHMuZ2V0U3RyaW5nT3B0aW9uKShhdHRyaWJ1dGVzLnR5cGUsIFsib3B0aW9uYWwiLCAicmVxdWlyZWQiXSk7CiAgICB0aGlzLnVzZSA9IGF0dHJpYnV0ZXMudXNlIHx8ICIiOwogICAgdGhpcy51c2VocmVmID0gYXR0cmlidXRlcy51c2VocmVmIHx8ICIiOwogICAgdGhpcy5vaWQgPSBuZXcgX3hmYV9vYmplY3QuWEZBT2JqZWN0QXJyYXkoKTsKICB9Cn0KY2xhc3MgT3ZlcmZsb3cgZXh0ZW5kcyBfeGZhX29iamVjdC5YRkFPYmplY3QgewogIGNvbnN0cnVjdG9yKGF0dHJpYnV0ZXMpIHsKICAgIHN1cGVyKFRFTVBMQVRFX05TX0lELCAib3ZlcmZsb3ciKTsKICAgIHRoaXMuaWQgPSBhdHRyaWJ1dGVzLmlkIHx8ICIiOwogICAgdGhpcy5sZWFkZXIgPSBhdHRyaWJ1dGVzLmxlYWRlciB8fCAiIjsKICAgIHRoaXMudGFyZ2V0ID0gYXR0cmlidXRlcy50YXJnZXQgfHwgIiI7CiAgICB0aGlzLnRyYWlsZXIgPSBhdHRyaWJ1dGVzLnRyYWlsZXIgfHwgIiI7CiAgICB0aGlzLnVzZSA9IGF0dHJpYnV0ZXMudXNlIHx8ICIiOwogICAgdGhpcy51c2VocmVmID0gYXR0cmlidXRlcy51c2VocmVmIHx8ICIiOwogIH0KICBbX3N5bWJvbF91dGlscy4kZ2V0RXh0cmFdKCkgewogICAgaWYgKCF0aGlzW19zeW1ib2xfdXRpbHMuJGV4dHJhXSkgewogICAgICBjb25zdCBwYXJlbnQgPSB0aGlzW19zeW1ib2xfdXRpbHMuJGdldFBhcmVudF0oKTsKICAgICAgY29uc3Qgcm9vdCA9IHRoaXNbX3N5bWJvbF91dGlscy4kZ2V0VGVtcGxhdGVSb290XSgpOwogICAgICBjb25zdCB0YXJnZXQgPSByb290W19zeW1ib2xfdXRpbHMuJHNlYXJjaE5vZGVdKHRoaXMudGFyZ2V0LCBwYXJlbnQpOwogICAgICBjb25zdCBsZWFkZXIgPSByb290W19zeW1ib2xfdXRpbHMuJHNlYXJjaE5vZGVdKHRoaXMubGVhZGVyLCBwYXJlbnQpOwogICAgICBjb25zdCB0cmFpbGVyID0gcm9vdFtfc3ltYm9sX3V0aWxzLiRzZWFyY2hOb2RlXSh0aGlzLnRyYWlsZXIsIHBhcmVudCk7CiAgICAgIHRoaXNbX3N5bWJvbF91dGlscy4kZXh0cmFdID0gewogICAgICAgIHRhcmdldDogdGFyZ2V0Py5bMF0gfHwgbnVsbCwKICAgICAgICBsZWFkZXI6IGxlYWRlcj8uWzBdIHx8IG51bGwsCiAgICAgICAgdHJhaWxlcjogdHJhaWxlcj8uWzBdIHx8IG51bGwsCiAgICAgICAgYWRkTGVhZGVyOiBmYWxzZSwKICAgICAgICBhZGRUcmFpbGVyOiBmYWxzZQogICAgICB9OwogICAgfQogICAgcmV0dXJuIHRoaXNbX3N5bWJvbF91dGlscy4kZXh0cmFdOwogIH0KfQpjbGFzcyBQYWdlQXJlYSBleHRlbmRzIF94ZmFfb2JqZWN0LlhGQU9iamVjdCB7CiAgY29uc3RydWN0b3IoYXR0cmlidXRlcykgewogICAgc3VwZXIoVEVNUExBVEVfTlNfSUQsICJwYWdlQXJlYSIsIHRydWUpOwogICAgdGhpcy5ibGFua09yTm90QmxhbmsgPSAoMCwgX3V0aWxzLmdldFN0cmluZ09wdGlvbikoYXR0cmlidXRlcy5ibGFua09yTm90QmxhbmssIFsiYW55IiwgImJsYW5rIiwgIm5vdEJsYW5rIl0pOwogICAgdGhpcy5pZCA9IGF0dHJpYnV0ZXMuaWQgfHwgIiI7CiAgICB0aGlzLmluaXRpYWxOdW1iZXIgPSAoMCwgX3V0aWxzLmdldEludGVnZXIpKHsKICAgICAgZGF0YTogYXR0cmlidXRlcy5pbml0aWFsTnVtYmVyLAogICAgICBkZWZhdWx0VmFsdWU6IDEsCiAgICAgIHZhbGlkYXRlOiB4ID0+IHRydWUKICAgIH0pOwogICAgdGhpcy5uYW1lID0gYXR0cmlidXRlcy5uYW1lIHx8ICIiOwogICAgdGhpcy5udW1iZXJlZCA9ICgwLCBfdXRpbHMuZ2V0SW50ZWdlcikoewogICAgICBkYXRhOiBhdHRyaWJ1dGVzLm51bWJlcmVkLAogICAgICBkZWZhdWx0VmFsdWU6IDEsCiAgICAgIHZhbGlkYXRlOiB4ID0+IHRydWUKICAgIH0pOwogICAgdGhpcy5vZGRPckV2ZW4gPSAoMCwgX3V0aWxzLmdldFN0cmluZ09wdGlvbikoYXR0cmlidXRlcy5vZGRPckV2ZW4sIFsiYW55IiwgImV2ZW4iLCAib2RkIl0pOwogICAgdGhpcy5wYWdlUG9zaXRpb24gPSAoMCwgX3V0aWxzLmdldFN0cmluZ09wdGlvbikoYXR0cmlidXRlcy5wYWdlUG9zaXRpb24sIFsiYW55IiwgImZpcnN0IiwgImxhc3QiLCAib25seSIsICJyZXN0Il0pOwogICAgdGhpcy5yZWxldmFudCA9ICgwLCBfdXRpbHMuZ2V0UmVsZXZhbnQpKGF0dHJpYnV0ZXMucmVsZXZhbnQpOwogICAgdGhpcy51c2UgPSBhdHRyaWJ1dGVzLnVzZSB8fCAiIjsKICAgIHRoaXMudXNlaHJlZiA9IGF0dHJpYnV0ZXMudXNlaHJlZiB8fCAiIjsKICAgIHRoaXMuZGVzYyA9IG51bGw7CiAgICB0aGlzLmV4dHJhcyA9IG51bGw7CiAgICB0aGlzLm1lZGl1bSA9IG51bGw7CiAgICB0aGlzLm9jY3VyID0gbnVsbDsKICAgIHRoaXMuYXJlYSA9IG5ldyBfeGZhX29iamVjdC5YRkFPYmplY3RBcnJheSgpOwogICAgdGhpcy5jb250ZW50QXJlYSA9IG5ldyBfeGZhX29iamVjdC5YRkFPYmplY3RBcnJheSgpOwogICAgdGhpcy5kcmF3ID0gbmV3IF94ZmFfb2JqZWN0LlhGQU9iamVjdEFycmF5KCk7CiAgICB0aGlzLmV4Y2xHcm91cCA9IG5ldyBfeGZhX29iamVjdC5YRkFPYmplY3RBcnJheSgpOwogICAgdGhpcy5maWVsZCA9IG5ldyBfeGZhX29iamVjdC5YRkFPYmplY3RBcnJheSgpOwogICAgdGhpcy5zdWJmb3JtID0gbmV3IF94ZmFfb2JqZWN0LlhGQU9iamVjdEFycmF5KCk7CiAgfQogIFtfc3ltYm9sX3V0aWxzLiRpc1VzYWJsZV0oKSB7CiAgICBpZiAoIXRoaXNbX3N5bWJvbF91dGlscy4kZXh0cmFdKSB7CiAgICAgIHRoaXNbX3N5bWJvbF91dGlscy4kZXh0cmFdID0gewogICAgICAgIG51bWJlck9mVXNlOiAwCiAgICAgIH07CiAgICAgIHJldHVybiB0cnVlOwogICAgfQogICAgcmV0dXJuICF0aGlzLm9jY3VyIHx8IHRoaXMub2NjdXIubWF4ID09PSAtMSB8fCB0aGlzW19zeW1ib2xfdXRpbHMuJGV4dHJhXS5udW1iZXJPZlVzZSA8IHRoaXMub2NjdXIubWF4OwogIH0KICBbX3N5bWJvbF91dGlscy4kY2xlYW5QYWdlXSgpIHsKICAgIGRlbGV0ZSB0aGlzW19zeW1ib2xfdXRpbHMuJGV4dHJhXTsKICB9CiAgW19zeW1ib2xfdXRpbHMuJGdldE5leHRQYWdlXSgpIHsKICAgIGlmICghdGhpc1tfc3ltYm9sX3V0aWxzLiRleHRyYV0pIHsKICAgICAgdGhpc1tfc3ltYm9sX3V0aWxzLiRleHRyYV0gPSB7CiAgICAgICAgbnVtYmVyT2ZVc2U6IDAKICAgICAgfTsKICAgIH0KICAgIGNvbnN0IHBhcmVudCA9IHRoaXNbX3N5bWJvbF91dGlscy4kZ2V0UGFyZW50XSgpOwogICAgaWYgKHBhcmVudC5yZWxhdGlvbiA9PT0gIm9yZGVyZWRPY2N1cnJlbmNlIikgewogICAgICBpZiAodGhpc1tfc3ltYm9sX3V0aWxzLiRpc1VzYWJsZV0oKSkgewogICAgICAgIHRoaXNbX3N5bWJvbF91dGlscy4kZXh0cmFdLm51bWJlck9mVXNlICs9IDE7CiAgICAgICAgcmV0dXJuIHRoaXM7CiAgICAgIH0KICAgIH0KICAgIHJldHVybiBwYXJlbnRbX3N5bWJvbF91dGlscy4kZ2V0TmV4dFBhZ2VdKCk7CiAgfQogIFtfc3ltYm9sX3V0aWxzLiRnZXRBdmFpbGFibGVTcGFjZV0oKSB7CiAgICByZXR1cm4gdGhpc1tfc3ltYm9sX3V0aWxzLiRleHRyYV0uc3BhY2UgfHwgewogICAgICB3aWR0aDogMCwKICAgICAgaGVpZ2h0OiAwCiAgICB9OwogIH0KICBbX3N5bWJvbF91dGlscy4kdG9IVE1MXSgpIHsKICAgIGlmICghdGhpc1tfc3ltYm9sX3V0aWxzLiRleHRyYV0pIHsKICAgICAgdGhpc1tfc3ltYm9sX3V0aWxzLiRleHRyYV0gPSB7CiAgICAgICAgbnVtYmVyT2ZVc2U6IDEKICAgICAgfTsKICAgIH0KICAgIGNvbnN0IGNoaWxkcmVuID0gW107CiAgICB0aGlzW19zeW1ib2xfdXRpbHMuJGV4dHJhXS5jaGlsZHJlbiA9IGNoaWxkcmVuOwogICAgY29uc3Qgc3R5bGUgPSBPYmplY3QuY3JlYXRlKG51bGwpOwogICAgaWYgKHRoaXMubWVkaXVtICYmIHRoaXMubWVkaXVtLnNob3J0ICYmIHRoaXMubWVkaXVtLmxvbmcpIHsKICAgICAgc3R5bGUud2lkdGggPSAoMCwgX2h0bWxfdXRpbHMubWVhc3VyZVRvU3RyaW5nKSh0aGlzLm1lZGl1bS5zaG9ydCk7CiAgICAgIHN0eWxlLmhlaWdodCA9ICgwLCBfaHRtbF91dGlscy5tZWFzdXJlVG9TdHJpbmcpKHRoaXMubWVkaXVtLmxvbmcpOwogICAgICB0aGlzW19zeW1ib2xfdXRpbHMuJGV4dHJhXS5zcGFjZSA9IHsKICAgICAgICB3aWR0aDogdGhpcy5tZWRpdW0uc2hvcnQsCiAgICAgICAgaGVpZ2h0OiB0aGlzLm1lZGl1bS5sb25nCiAgICAgIH07CiAgICAgIGlmICh0aGlzLm1lZGl1bS5vcmllbnRhdGlvbiA9PT0gImxhbmRzY2FwZSIpIHsKICAgICAgICBjb25zdCB4ID0gc3R5bGUud2lkdGg7CiAgICAgICAgc3R5bGUud2lkdGggPSBzdHlsZS5oZWlnaHQ7CiAgICAgICAgc3R5bGUuaGVpZ2h0ID0geDsKICAgICAgICB0aGlzW19zeW1ib2xfdXRpbHMuJGV4dHJhXS5zcGFjZSA9IHsKICAgICAgICAgIHdpZHRoOiB0aGlzLm1lZGl1bS5sb25nLAogICAgICAgICAgaGVpZ2h0OiB0aGlzLm1lZGl1bS5zaG9ydAogICAgICAgIH07CiAgICAgIH0KICAgIH0gZWxzZSB7CiAgICAgICgwLCBfdXRpbC53YXJuKSgiWEZBIC0gTm8gbWVkaXVtIHNwZWNpZmllZCBpbiBwYWdlQXJlYTogcGxlYXNlIGZpbGUgYSBidWcuIik7CiAgICB9CiAgICB0aGlzW19zeW1ib2xfdXRpbHMuJGNoaWxkcmVuVG9IVE1MXSh7CiAgICAgIGZpbHRlcjogbmV3IFNldChbImFyZWEiLCAiZHJhdyIsICJmaWVsZCIsICJzdWJmb3JtIl0pLAogICAgICBpbmNsdWRlOiB0cnVlCiAgICB9KTsKICAgIHRoaXNbX3N5bWJvbF91dGlscy4kY2hpbGRyZW5Ub0hUTUxdKHsKICAgICAgZmlsdGVyOiBuZXcgU2V0KFsiY29udGVudEFyZWEiXSksCiAgICAgIGluY2x1ZGU6IHRydWUKICAgIH0pOwogICAgcmV0dXJuIF91dGlscy5IVE1MUmVzdWx0LnN1Y2Nlc3MoewogICAgICBuYW1lOiAiZGl2IiwKICAgICAgY2hpbGRyZW4sCiAgICAgIGF0dHJpYnV0ZXM6IHsKICAgICAgICBjbGFzczogWyJ4ZmFQYWdlIl0sCiAgICAgICAgaWQ6IHRoaXNbX3N5bWJvbF91dGlscy4kdWlkXSwKICAgICAgICBzdHlsZSwKICAgICAgICB4ZmFOYW1lOiB0aGlzLm5hbWUKICAgICAgfQogICAgfSk7CiAgfQp9CmNsYXNzIFBhZ2VTZXQgZXh0ZW5kcyBfeGZhX29iamVjdC5YRkFPYmplY3QgewogIGNvbnN0cnVjdG9yKGF0dHJpYnV0ZXMpIHsKICAgIHN1cGVyKFRFTVBMQVRFX05TX0lELCAicGFnZVNldCIsIHRydWUpOwogICAgdGhpcy5kdXBsZXhJbXBvc2l0aW9uID0gKDAsIF91dGlscy5nZXRTdHJpbmdPcHRpb24pKGF0dHJpYnV0ZXMuZHVwbGV4SW1wb3NpdGlvbiwgWyJsb25nRWRnZSIsICJzaG9ydEVkZ2UiXSk7CiAgICB0aGlzLmlkID0gYXR0cmlidXRlcy5pZCB8fCAiIjsKICAgIHRoaXMubmFtZSA9IGF0dHJpYnV0ZXMubmFtZSB8fCAiIjsKICAgIHRoaXMucmVsYXRpb24gPSAoMCwgX3V0aWxzLmdldFN0cmluZ09wdGlvbikoYXR0cmlidXRlcy5yZWxhdGlvbiwgWyJvcmRlcmVkT2NjdXJyZW5jZSIsICJkdXBsZXhQYWdpbmF0ZWQiLCAic2ltcGxleFBhZ2luYXRlZCJdKTsKICAgIHRoaXMucmVsZXZhbnQgPSAoMCwgX3V0aWxzLmdldFJlbGV2YW50KShhdHRyaWJ1dGVzLnJlbGV2YW50KTsKICAgIHRoaXMudXNlID0gYXR0cmlidXRlcy51c2UgfHwgIiI7CiAgICB0aGlzLnVzZWhyZWYgPSBhdHRyaWJ1dGVzLnVzZWhyZWYgfHwgIiI7CiAgICB0aGlzLmV4dHJhcyA9IG51bGw7CiAgICB0aGlzLm9jY3VyID0gbnVsbDsKICAgIHRoaXMucGFnZUFyZWEgPSBuZXcgX3hmYV9vYmplY3QuWEZBT2JqZWN0QXJyYXkoKTsKICAgIHRoaXMucGFnZVNldCA9IG5ldyBfeGZhX29iamVjdC5YRkFPYmplY3RBcnJheSgpOwogIH0KICBbX3N5bWJvbF91dGlscy4kY2xlYW5QYWdlXSgpIHsKICAgIGZvciAoY29uc3QgcGFnZSBvZiB0aGlzLnBhZ2VBcmVhLmNoaWxkcmVuKSB7CiAgICAgIHBhZ2VbX3N5bWJvbF91dGlscy4kY2xlYW5QYWdlXSgpOwogICAgfQogICAgZm9yIChjb25zdCBwYWdlIG9mIHRoaXMucGFnZVNldC5jaGlsZHJlbikgewogICAgICBwYWdlW19zeW1ib2xfdXRpbHMuJGNsZWFuUGFnZV0oKTsKICAgIH0KICB9CiAgW19zeW1ib2xfdXRpbHMuJGlzVXNhYmxlXSgpIHsKICAgIHJldHVybiAhdGhpcy5vY2N1ciB8fCB0aGlzLm9jY3VyLm1heCA9PT0gLTEgfHwgdGhpc1tfc3ltYm9sX3V0aWxzLiRleHRyYV0ubnVtYmVyT2ZVc2UgPCB0aGlzLm9jY3VyLm1heDsKICB9CiAgW19zeW1ib2xfdXRpbHMuJGdldE5leHRQYWdlXSgpIHsKICAgIGlmICghdGhpc1tfc3ltYm9sX3V0aWxzLiRleHRyYV0pIHsKICAgICAgdGhpc1tfc3ltYm9sX3V0aWxzLiRleHRyYV0gPSB7CiAgICAgICAgbnVtYmVyT2ZVc2U6IDEsCiAgICAgICAgcGFnZUluZGV4OiAtMSwKICAgICAgICBwYWdlU2V0SW5kZXg6IC0xCiAgICAgIH07CiAgICB9CiAgICBpZiAodGhpcy5yZWxhdGlvbiA9PT0gIm9yZGVyZWRPY2N1cnJlbmNlIikgewogICAgICBpZiAodGhpc1tfc3ltYm9sX3V0aWxzLiRleHRyYV0ucGFnZUluZGV4ICsgMSA8IHRoaXMucGFnZUFyZWEuY2hpbGRyZW4ubGVuZ3RoKSB7CiAgICAgICAgdGhpc1tfc3ltYm9sX3V0aWxzLiRleHRyYV0ucGFnZUluZGV4ICs9IDE7CiAgICAgICAgY29uc3QgcGFnZUFyZWEgPSB0aGlzLnBhZ2VBcmVhLmNoaWxkcmVuW3RoaXNbX3N5bWJvbF91dGlscy4kZXh0cmFdLnBhZ2VJbmRleF07CiAgICAgICAgcmV0dXJuIHBhZ2VBcmVhW19zeW1ib2xfdXRpbHMuJGdldE5leHRQYWdlXSgpOwogICAgICB9CiAgICAgIGlmICh0aGlzW19zeW1ib2xfdXRpbHMuJGV4dHJhXS5wYWdlU2V0SW5kZXggKyAxIDwgdGhpcy5wYWdlU2V0LmNoaWxkcmVuLmxlbmd0aCkgewogICAgICAgIHRoaXNbX3N5bWJvbF91dGlscy4kZXh0cmFdLnBhZ2VTZXRJbmRleCArPSAxOwogICAgICAgIHJldHVybiB0aGlzLnBhZ2VTZXQuY2hpbGRyZW5bdGhpc1tfc3ltYm9sX3V0aWxzLiRleHRyYV0ucGFnZVNldEluZGV4XVtfc3ltYm9sX3V0aWxzLiRnZXROZXh0UGFnZV0oKTsKICAgICAgfQogICAgICBpZiAodGhpc1tfc3ltYm9sX3V0aWxzLiRpc1VzYWJsZV0oKSkgewogICAgICAgIHRoaXNbX3N5bWJvbF91dGlscy4kZXh0cmFdLm51bWJlck9mVXNlICs9IDE7CiAgICAgICAgdGhpc1tfc3ltYm9sX3V0aWxzLiRleHRyYV0ucGFnZUluZGV4ID0gLTE7CiAgICAgICAgdGhpc1tfc3ltYm9sX3V0aWxzLiRleHRyYV0ucGFnZVNldEluZGV4ID0gLTE7CiAgICAgICAgcmV0dXJuIHRoaXNbX3N5bWJvbF91dGlscy4kZ2V0TmV4dFBhZ2VdKCk7CiAgICAgIH0KICAgICAgY29uc3QgcGFyZW50ID0gdGhpc1tfc3ltYm9sX3V0aWxzLiRnZXRQYXJlbnRdKCk7CiAgICAgIGlmIChwYXJlbnQgaW5zdGFuY2VvZiBQYWdlU2V0KSB7CiAgICAgICAgcmV0dXJuIHBhcmVudFtfc3ltYm9sX3V0aWxzLiRnZXROZXh0UGFnZV0oKTsKICAgICAgfQogICAgICB0aGlzW19zeW1ib2xfdXRpbHMuJGNsZWFuUGFnZV0oKTsKICAgICAgcmV0dXJuIHRoaXNbX3N5bWJvbF91dGlscy4kZ2V0TmV4dFBhZ2VdKCk7CiAgICB9CiAgICBjb25zdCBwYWdlTnVtYmVyID0gdGhpc1tfc3ltYm9sX3V0aWxzLiRnZXRUZW1wbGF0ZVJvb3RdKClbX3N5bWJvbF91dGlscy4kZXh0cmFdLnBhZ2VOdW1iZXI7CiAgICBjb25zdCBwYXJpdHkgPSBwYWdlTnVtYmVyICUgMiA9PT0gMCA/ICJldmVuIiA6ICJvZGQiOwogICAgY29uc3QgcG9zaXRpb24gPSBwYWdlTnVtYmVyID09PSAwID8gImZpcnN0IiA6ICJyZXN0IjsKICAgIGxldCBwYWdlID0gdGhpcy5wYWdlQXJlYS5jaGlsZHJlbi5maW5kKHAgPT4gcC5vZGRPckV2ZW4gPT09IHBhcml0eSAmJiBwLnBhZ2VQb3NpdGlvbiA9PT0gcG9zaXRpb24pOwogICAgaWYgKHBhZ2UpIHsKICAgICAgcmV0dXJuIHBhZ2U7CiAgICB9CiAgICBwYWdlID0gdGhpcy5wYWdlQXJlYS5jaGlsZHJlbi5maW5kKHAgPT4gcC5vZGRPckV2ZW4gPT09ICJhbnkiICYmIHAucGFnZVBvc2l0aW9uID09PSBwb3NpdGlvbik7CiAgICBpZiAocGFnZSkgewogICAgICByZXR1cm4gcGFnZTsKICAgIH0KICAgIHBhZ2UgPSB0aGlzLnBhZ2VBcmVhLmNoaWxkcmVuLmZpbmQocCA9PiBwLm9kZE9yRXZlbiA9PT0gImFueSIgJiYgcC5wYWdlUG9zaXRpb24gPT09ICJhbnkiKTsKICAgIGlmIChwYWdlKSB7CiAgICAgIHJldHVybiBwYWdlOwogICAgfQogICAgcmV0dXJuIHRoaXMucGFnZUFyZWEuY2hpbGRyZW5bMF07CiAgfQp9CmNsYXNzIFBhcmEgZXh0ZW5kcyBfeGZhX29iamVjdC5YRkFPYmplY3QgewogIGNvbnN0cnVjdG9yKGF0dHJpYnV0ZXMpIHsKICAgIHN1cGVyKFRFTVBMQVRFX05TX0lELCAicGFyYSIsIHRydWUpOwogICAgdGhpcy5oQWxpZ24gPSAoMCwgX3V0aWxzLmdldFN0cmluZ09wdGlvbikoYXR0cmlidXRlcy5oQWxpZ24sIFsibGVmdCIsICJjZW50ZXIiLCAianVzdGlmeSIsICJqdXN0aWZ5QWxsIiwgInJhZGl4IiwgInJpZ2h0Il0pOwogICAgdGhpcy5pZCA9IGF0dHJpYnV0ZXMuaWQgfHwgIiI7CiAgICB0aGlzLmxpbmVIZWlnaHQgPSBhdHRyaWJ1dGVzLmxpbmVIZWlnaHQgPyAoMCwgX3V0aWxzLmdldE1lYXN1cmVtZW50KShhdHRyaWJ1dGVzLmxpbmVIZWlnaHQsICIwcHQiKSA6ICIiOwogICAgdGhpcy5tYXJnaW5MZWZ0ID0gYXR0cmlidXRlcy5tYXJnaW5MZWZ0ID8gKDAsIF91dGlscy5nZXRNZWFzdXJlbWVudCkoYXR0cmlidXRlcy5tYXJnaW5MZWZ0LCAiMHB0IikgOiAiIjsKICAgIHRoaXMubWFyZ2luUmlnaHQgPSBhdHRyaWJ1dGVzLm1hcmdpblJpZ2h0ID8gKDAsIF91dGlscy5nZXRNZWFzdXJlbWVudCkoYXR0cmlidXRlcy5tYXJnaW5SaWdodCwgIjBwdCIpIDogIiI7CiAgICB0aGlzLm9ycGhhbnMgPSAoMCwgX3V0aWxzLmdldEludGVnZXIpKHsKICAgICAgZGF0YTogYXR0cmlidXRlcy5vcnBoYW5zLAogICAgICBkZWZhdWx0VmFsdWU6IDAsCiAgICAgIHZhbGlkYXRlOiB4ID0+IHggPj0gMAogICAgfSk7CiAgICB0aGlzLnByZXNlcnZlID0gYXR0cmlidXRlcy5wcmVzZXJ2ZSB8fCAiIjsKICAgIHRoaXMucmFkaXhPZmZzZXQgPSBhdHRyaWJ1dGVzLnJhZGl4T2Zmc2V0ID8gKDAsIF91dGlscy5nZXRNZWFzdXJlbWVudCkoYXR0cmlidXRlcy5yYWRpeE9mZnNldCwgIjBwdCIpIDogIiI7CiAgICB0aGlzLnNwYWNlQWJvdmUgPSBhdHRyaWJ1dGVzLnNwYWNlQWJvdmUgPyAoMCwgX3V0aWxzLmdldE1lYXN1cmVtZW50KShhdHRyaWJ1dGVzLnNwYWNlQWJvdmUsICIwcHQiKSA6ICIiOwogICAgdGhpcy5zcGFjZUJlbG93ID0gYXR0cmlidXRlcy5zcGFjZUJlbG93ID8gKDAsIF91dGlscy5nZXRNZWFzdXJlbWVudCkoYXR0cmlidXRlcy5zcGFjZUJlbG93LCAiMHB0IikgOiAiIjsKICAgIHRoaXMudGFiRGVmYXVsdCA9IGF0dHJpYnV0ZXMudGFiRGVmYXVsdCA/ICgwLCBfdXRpbHMuZ2V0TWVhc3VyZW1lbnQpKHRoaXMudGFiRGVmYXVsdCkgOiAiIjsKICAgIHRoaXMudGFiU3RvcHMgPSAoYXR0cmlidXRlcy50YWJTdG9wcyB8fCAiIikudHJpbSgpLnNwbGl0KC9ccysvKS5tYXAoKHgsIGkpID0+IGkgJSAyID09PSAxID8gKDAsIF91dGlscy5nZXRNZWFzdXJlbWVudCkoeCkgOiB4KTsKICAgIHRoaXMudGV4dEluZGVudCA9IGF0dHJpYnV0ZXMudGV4dEluZGVudCA/ICgwLCBfdXRpbHMuZ2V0TWVhc3VyZW1lbnQpKGF0dHJpYnV0ZXMudGV4dEluZGVudCwgIjBwdCIpIDogIiI7CiAgICB0aGlzLnVzZSA9IGF0dHJpYnV0ZXMudXNlIHx8ICIiOwogICAgdGhpcy51c2VocmVmID0gYXR0cmlidXRlcy51c2VocmVmIHx8ICIiOwogICAgdGhpcy52QWxpZ24gPSAoMCwgX3V0aWxzLmdldFN0cmluZ09wdGlvbikoYXR0cmlidXRlcy52QWxpZ24sIFsidG9wIiwgImJvdHRvbSIsICJtaWRkbGUiXSk7CiAgICB0aGlzLndpZG93cyA9ICgwLCBfdXRpbHMuZ2V0SW50ZWdlcikoewogICAgICBkYXRhOiBhdHRyaWJ1dGVzLndpZG93cywKICAgICAgZGVmYXVsdFZhbHVlOiAwLAogICAgICB2YWxpZGF0ZTogeCA9PiB4ID49IDAKICAgIH0pOwogICAgdGhpcy5oeXBoZW5hdGlvbiA9IG51bGw7CiAgfQogIFtfc3ltYm9sX3V0aWxzLiR0b1N0eWxlXSgpIHsKICAgIGNvbnN0IHN0eWxlID0gKDAsIF9odG1sX3V0aWxzLnRvU3R5bGUpKHRoaXMsICJoQWxpZ24iKTsKICAgIGlmICh0aGlzLm1hcmdpbkxlZnQgIT09ICIiKSB7CiAgICAgIHN0eWxlLnBhZGRpbmdMZWZ0ID0gKDAsIF9odG1sX3V0aWxzLm1lYXN1cmVUb1N0cmluZykodGhpcy5tYXJnaW5MZWZ0KTsKICAgIH0KICAgIGlmICh0aGlzLm1hcmdpblJpZ2h0ICE9PSAiIikgewogICAgICBzdHlsZS5wYWRkaW5naWdodCA9ICgwLCBfaHRtbF91dGlscy5tZWFzdXJlVG9TdHJpbmcpKHRoaXMubWFyZ2luUmlnaHQpOwogICAgfQogICAgaWYgKHRoaXMuc3BhY2VBYm92ZSAhPT0gIiIpIHsKICAgICAgc3R5bGUucGFkZGluZ1RvcCA9ICgwLCBfaHRtbF91dGlscy5tZWFzdXJlVG9TdHJpbmcpKHRoaXMuc3BhY2VBYm92ZSk7CiAgICB9CiAgICBpZiAodGhpcy5zcGFjZUJlbG93ICE9PSAiIikgewogICAgICBzdHlsZS5wYWRkaW5nQm90dG9tID0gKDAsIF9odG1sX3V0aWxzLm1lYXN1cmVUb1N0cmluZykodGhpcy5zcGFjZUJlbG93KTsKICAgIH0KICAgIGlmICh0aGlzLnRleHRJbmRlbnQgIT09ICIiKSB7CiAgICAgIHN0eWxlLnRleHRJbmRlbnQgPSAoMCwgX2h0bWxfdXRpbHMubWVhc3VyZVRvU3RyaW5nKSh0aGlzLnRleHRJbmRlbnQpOwogICAgICAoMCwgX2h0bWxfdXRpbHMuZml4VGV4dEluZGVudCkoc3R5bGUpOwogICAgfQogICAgaWYgKHRoaXMubGluZUhlaWdodCA+IDApIHsKICAgICAgc3R5bGUubGluZUhlaWdodCA9ICgwLCBfaHRtbF91dGlscy5tZWFzdXJlVG9TdHJpbmcpKHRoaXMubGluZUhlaWdodCk7CiAgICB9CiAgICBpZiAodGhpcy50YWJEZWZhdWx0ICE9PSAiIikgewogICAgICBzdHlsZS50YWJTaXplID0gKDAsIF9odG1sX3V0aWxzLm1lYXN1cmVUb1N0cmluZykodGhpcy50YWJEZWZhdWx0KTsKICAgIH0KICAgIGlmICh0aGlzLnRhYlN0b3BzLmxlbmd0aCA+IDApIHt9CiAgICBpZiAodGhpcy5oeXBoZW5hdGF0aW9uKSB7CiAgICAgIE9iamVjdC5hc3NpZ24oc3R5bGUsIHRoaXMuaHlwaGVuYXRhdGlvbltfc3ltYm9sX3V0aWxzLiR0b1N0eWxlXSgpKTsKICAgIH0KICAgIHJldHVybiBzdHlsZTsKICB9Cn0KY2xhc3MgUGFzc3dvcmRFZGl0IGV4dGVuZHMgX3hmYV9vYmplY3QuWEZBT2JqZWN0IHsKICBjb25zdHJ1Y3RvcihhdHRyaWJ1dGVzKSB7CiAgICBzdXBlcihURU1QTEFURV9OU19JRCwgInBhc3N3b3JkRWRpdCIsIHRydWUpOwogICAgdGhpcy5oU2Nyb2xsUG9saWN5ID0gKDAsIF91dGlscy5nZXRTdHJpbmdPcHRpb24pKGF0dHJpYnV0ZXMuaFNjcm9sbFBvbGljeSwgWyJhdXRvIiwgIm9mZiIsICJvbiJdKTsKICAgIHRoaXMuaWQgPSBhdHRyaWJ1dGVzLmlkIHx8ICIiOwogICAgdGhpcy5wYXNzd29yZENoYXIgPSBhdHRyaWJ1dGVzLnBhc3N3b3JkQ2hhciB8fCAiKiI7CiAgICB0aGlzLnVzZSA9IGF0dHJpYnV0ZXMudXNlIHx8ICIiOwogICAgdGhpcy51c2VocmVmID0gYXR0cmlidXRlcy51c2VocmVmIHx8ICIiOwogICAgdGhpcy5ib3JkZXIgPSBudWxsOwogICAgdGhpcy5leHRyYXMgPSBudWxsOwogICAgdGhpcy5tYXJnaW4gPSBudWxsOwogIH0KfQpjbGFzcyBQYXR0ZXJuIGV4dGVuZHMgX3hmYV9vYmplY3QuWEZBT2JqZWN0IHsKICBjb25zdHJ1Y3RvcihhdHRyaWJ1dGVzKSB7CiAgICBzdXBlcihURU1QTEFURV9OU19JRCwgInBhdHRlcm4iLCB0cnVlKTsKICAgIHRoaXMuaWQgPSBhdHRyaWJ1dGVzLmlkIHx8ICIiOwogICAgdGhpcy50eXBlID0gKDAsIF91dGlscy5nZXRTdHJpbmdPcHRpb24pKGF0dHJpYnV0ZXMudHlwZSwgWyJjcm9zc0hhdGNoIiwgImNyb3NzRGlhZ29uYWwiLCAiZGlhZ29uYWxMZWZ0IiwgImRpYWdvbmFsUmlnaHQiLCAiaG9yaXpvbnRhbCIsICJ2ZXJ0aWNhbCJdKTsKICAgIHRoaXMudXNlID0gYXR0cmlidXRlcy51c2UgfHwgIiI7CiAgICB0aGlzLnVzZWhyZWYgPSBhdHRyaWJ1dGVzLnVzZWhyZWYgfHwgIiI7CiAgICB0aGlzLmNvbG9yID0gbnVsbDsKICAgIHRoaXMuZXh0cmFzID0gbnVsbDsKICB9CiAgW19zeW1ib2xfdXRpbHMuJHRvU3R5bGVdKHN0YXJ0Q29sb3IpIHsKICAgIHN0YXJ0Q29sb3IgPSBzdGFydENvbG9yID8gc3RhcnRDb2xvcltfc3ltYm9sX3V0aWxzLiR0b1N0eWxlXSgpIDogIiNGRkZGRkYiOwogICAgY29uc3QgZW5kQ29sb3IgPSB0aGlzLmNvbG9yID8gdGhpcy5jb2xvcltfc3ltYm9sX3V0aWxzLiR0b1N0eWxlXSgpIDogIiMwMDAwMDAiOwogICAgY29uc3Qgd2lkdGggPSA1OwogICAgY29uc3QgY21kID0gInJlcGVhdGluZy1saW5lYXItZ3JhZGllbnQiOwogICAgY29uc3QgY29sb3JzID0gYCR7c3RhcnRDb2xvcn0sJHtzdGFydENvbG9yfSAke3dpZHRofXB4LCR7ZW5kQ29sb3J9ICR7d2lkdGh9cHgsJHtlbmRDb2xvcn0gJHsyICogd2lkdGh9cHhgOwogICAgc3dpdGNoICh0aGlzLnR5cGUpIHsKICAgICAgY2FzZSAiY3Jvc3NIYXRjaCI6CiAgICAgICAgcmV0dXJuIGAke2NtZH0odG8gdG9wLCR7Y29sb3JzfSkgJHtjbWR9KHRvIHJpZ2h0LCR7Y29sb3JzfSlgOwogICAgICBjYXNlICJjcm9zc0RpYWdvbmFsIjoKICAgICAgICByZXR1cm4gYCR7Y21kfSg0NWRlZywke2NvbG9yc30pICR7Y21kfSgtNDVkZWcsJHtjb2xvcnN9KWA7CiAgICAgIGNhc2UgImRpYWdvbmFsTGVmdCI6CiAgICAgICAgcmV0dXJuIGAke2NtZH0oNDVkZWcsJHtjb2xvcnN9KWA7CiAgICAgIGNhc2UgImRpYWdvbmFsUmlnaHQiOgogICAgICAgIHJldHVybiBgJHtjbWR9KC00NWRlZywke2NvbG9yc30pYDsKICAgICAgY2FzZSAiaG9yaXpvbnRhbCI6CiAgICAgICAgcmV0dXJuIGAke2NtZH0odG8gdG9wLCR7Y29sb3JzfSlgOwogICAgICBjYXNlICJ2ZXJ0aWNhbCI6CiAgICAgICAgcmV0dXJuIGAke2NtZH0odG8gcmlnaHQsJHtjb2xvcnN9KWA7CiAgICB9CiAgICByZXR1cm4gIiI7CiAgfQp9CmNsYXNzIFBpY3R1cmUgZXh0ZW5kcyBfeGZhX29iamVjdC5TdHJpbmdPYmplY3QgewogIGNvbnN0cnVjdG9yKGF0dHJpYnV0ZXMpIHsKICAgIHN1cGVyKFRFTVBMQVRFX05TX0lELCAicGljdHVyZSIpOwogICAgdGhpcy5pZCA9IGF0dHJpYnV0ZXMuaWQgfHwgIiI7CiAgICB0aGlzLnVzZSA9IGF0dHJpYnV0ZXMudXNlIHx8ICIiOwogICAgdGhpcy51c2VocmVmID0gYXR0cmlidXRlcy51c2VocmVmIHx8ICIiOwogIH0KfQpjbGFzcyBQcm90byBleHRlbmRzIF94ZmFfb2JqZWN0LlhGQU9iamVjdCB7CiAgY29uc3RydWN0b3IoYXR0cmlidXRlcykgewogICAgc3VwZXIoVEVNUExBVEVfTlNfSUQsICJwcm90byIsIHRydWUpOwogICAgdGhpcy5hcHBlYXJhbmNlRmlsdGVyID0gbmV3IF94ZmFfb2JqZWN0LlhGQU9iamVjdEFycmF5KCk7CiAgICB0aGlzLmFyYyA9IG5ldyBfeGZhX29iamVjdC5YRkFPYmplY3RBcnJheSgpOwogICAgdGhpcy5hcmVhID0gbmV3IF94ZmFfb2JqZWN0LlhGQU9iamVjdEFycmF5KCk7CiAgICB0aGlzLmFzc2lzdCA9IG5ldyBfeGZhX29iamVjdC5YRkFPYmplY3RBcnJheSgpOwogICAgdGhpcy5iYXJjb2RlID0gbmV3IF94ZmFfb2JqZWN0LlhGQU9iamVjdEFycmF5KCk7CiAgICB0aGlzLmJpbmRJdGVtcyA9IG5ldyBfeGZhX29iamVjdC5YRkFPYmplY3RBcnJheSgpOwogICAgdGhpcy5ib29rZW5kID0gbmV3IF94ZmFfb2JqZWN0LlhGQU9iamVjdEFycmF5KCk7CiAgICB0aGlzLmJvb2xlYW4gPSBuZXcgX3hmYV9vYmplY3QuWEZBT2JqZWN0QXJyYXkoKTsKICAgIHRoaXMuYm9yZGVyID0gbmV3IF94ZmFfb2JqZWN0LlhGQU9iamVjdEFycmF5KCk7CiAgICB0aGlzLmJyZWFrID0gbmV3IF94ZmFfb2JqZWN0LlhGQU9iamVjdEFycmF5KCk7CiAgICB0aGlzLmJyZWFrQWZ0ZXIgPSBuZXcgX3hmYV9vYmplY3QuWEZBT2JqZWN0QXJyYXkoKTsKICAgIHRoaXMuYnJlYWtCZWZvcmUgPSBuZXcgX3hmYV9vYmplY3QuWEZBT2JqZWN0QXJyYXkoKTsKICAgIHRoaXMuYnV0dG9uID0gbmV3IF94ZmFfb2JqZWN0LlhGQU9iamVjdEFycmF5KCk7CiAgICB0aGlzLmNhbGN1bGF0ZSA9IG5ldyBfeGZhX29iamVjdC5YRkFPYmplY3RBcnJheSgpOwogICAgdGhpcy5jYXB0aW9uID0gbmV3IF94ZmFfb2JqZWN0LlhGQU9iamVjdEFycmF5KCk7CiAgICB0aGlzLmNlcnRpZmljYXRlID0gbmV3IF94ZmFfb2JqZWN0LlhGQU9iamVjdEFycmF5KCk7CiAgICB0aGlzLmNlcnRpZmljYXRlcyA9IG5ldyBfeGZhX29iamVjdC5YRkFPYmplY3RBcnJheSgpOwogICAgdGhpcy5jaGVja0J1dHRvbiA9IG5ldyBfeGZhX29iamVjdC5YRkFPYmplY3RBcnJheSgpOwogICAgdGhpcy5jaG9pY2VMaXN0ID0gbmV3IF94ZmFfb2JqZWN0LlhGQU9iamVjdEFycmF5KCk7CiAgICB0aGlzLmNvbG9yID0gbmV3IF94ZmFfb2JqZWN0LlhGQU9iamVjdEFycmF5KCk7CiAgICB0aGlzLmNvbWIgPSBuZXcgX3hmYV9vYmplY3QuWEZBT2JqZWN0QXJyYXkoKTsKICAgIHRoaXMuY29ubmVjdCA9IG5ldyBfeGZhX29iamVjdC5YRkFPYmplY3RBcnJheSgpOwogICAgdGhpcy5jb250ZW50QXJlYSA9IG5ldyBfeGZhX29iamVjdC5YRkFPYmplY3RBcnJheSgpOwogICAgdGhpcy5jb3JuZXIgPSBuZXcgX3hmYV9vYmplY3QuWEZBT2JqZWN0QXJyYXkoKTsKICAgIHRoaXMuZGF0ZSA9IG5ldyBfeGZhX29iamVjdC5YRkFPYmplY3RBcnJheSgpOwogICAgdGhpcy5kYXRlVGltZSA9IG5ldyBfeGZhX29iamVjdC5YRkFPYmplY3RBcnJheSgpOwogICAgdGhpcy5kYXRlVGltZUVkaXQgPSBuZXcgX3hmYV9vYmplY3QuWEZBT2JqZWN0QXJyYXkoKTsKICAgIHRoaXMuZGVjaW1hbCA9IG5ldyBfeGZhX29iamVjdC5YRkFPYmplY3RBcnJheSgpOwogICAgdGhpcy5kZWZhdWx0VWkgPSBuZXcgX3hmYV9vYmplY3QuWEZBT2JqZWN0QXJyYXkoKTsKICAgIHRoaXMuZGVzYyA9IG5ldyBfeGZhX29iamVjdC5YRkFPYmplY3RBcnJheSgpOwogICAgdGhpcy5kaWdlc3RNZXRob2QgPSBuZXcgX3hmYV9vYmplY3QuWEZBT2JqZWN0QXJyYXkoKTsKICAgIHRoaXMuZGlnZXN0TWV0aG9kcyA9IG5ldyBfeGZhX29iamVjdC5YRkFPYmplY3RBcnJheSgpOwogICAgdGhpcy5kcmF3ID0gbmV3IF94ZmFfb2JqZWN0LlhGQU9iamVjdEFycmF5KCk7CiAgICB0aGlzLmVkZ2UgPSBuZXcgX3hmYV9vYmplY3QuWEZBT2JqZWN0QXJyYXkoKTsKICAgIHRoaXMuZW5jb2RpbmcgPSBuZXcgX3hmYV9vYmplY3QuWEZBT2JqZWN0QXJyYXkoKTsKICAgIHRoaXMuZW5jb2RpbmdzID0gbmV3IF94ZmFfb2JqZWN0LlhGQU9iamVjdEFycmF5KCk7CiAgICB0aGlzLmVuY3J5cHQgPSBuZXcgX3hmYV9vYmplY3QuWEZBT2JqZWN0QXJyYXkoKTsKICAgIHRoaXMuZW5jcnlwdERhdGEgPSBuZXcgX3hmYV9vYmplY3QuWEZBT2JqZWN0QXJyYXkoKTsKICAgIHRoaXMuZW5jcnlwdGlvbiA9IG5ldyBfeGZhX29iamVjdC5YRkFPYmplY3RBcnJheSgpOwogICAgdGhpcy5lbmNyeXB0aW9uTWV0aG9kID0gbmV3IF94ZmFfb2JqZWN0LlhGQU9iamVjdEFycmF5KCk7CiAgICB0aGlzLmVuY3J5cHRpb25NZXRob2RzID0gbmV3IF94ZmFfb2JqZWN0LlhGQU9iamVjdEFycmF5KCk7CiAgICB0aGlzLmV2ZW50ID0gbmV3IF94ZmFfb2JqZWN0LlhGQU9iamVjdEFycmF5KCk7CiAgICB0aGlzLmV4RGF0YSA9IG5ldyBfeGZhX29iamVjdC5YRkFPYmplY3RBcnJheSgpOwogICAgdGhpcy5leE9iamVjdCA9IG5ldyBfeGZhX29iamVjdC5YRkFPYmplY3RBcnJheSgpOwogICAgdGhpcy5leGNsR3JvdXAgPSBuZXcgX3hmYV9vYmplY3QuWEZBT2JqZWN0QXJyYXkoKTsKICAgIHRoaXMuZXhlY3V0ZSA9IG5ldyBfeGZhX29iamVjdC5YRkFPYmplY3RBcnJheSgpOwogICAgdGhpcy5leHRyYXMgPSBuZXcgX3hmYV9vYmplY3QuWEZBT2JqZWN0QXJyYXkoKTsKICAgIHRoaXMuZmllbGQgPSBuZXcgX3hmYV9vYmplY3QuWEZBT2JqZWN0QXJyYXkoKTsKICAgIHRoaXMuZmlsbCA9IG5ldyBfeGZhX29iamVjdC5YRkFPYmplY3RBcnJheSgpOwogICAgdGhpcy5maWx0ZXIgPSBuZXcgX3hmYV9vYmplY3QuWEZBT2JqZWN0QXJyYXkoKTsKICAgIHRoaXMuZmxvYXQgPSBuZXcgX3hmYV9vYmplY3QuWEZBT2JqZWN0QXJyYXkoKTsKICAgIHRoaXMuZm9udCA9IG5ldyBfeGZhX29iamVjdC5YRkFPYmplY3RBcnJheSgpOwogICAgdGhpcy5mb3JtYXQgPSBuZXcgX3hmYV9vYmplY3QuWEZBT2JqZWN0QXJyYXkoKTsKICAgIHRoaXMuaGFuZGxlciA9IG5ldyBfeGZhX29iamVjdC5YRkFPYmplY3RBcnJheSgpOwogICAgdGhpcy5oeXBoZW5hdGlvbiA9IG5ldyBfeGZhX29iamVjdC5YRkFPYmplY3RBcnJheSgpOwogICAgdGhpcy5pbWFnZSA9IG5ldyBfeGZhX29iamVjdC5YRkFPYmplY3RBcnJheSgpOwogICAgdGhpcy5pbWFnZUVkaXQgPSBuZXcgX3hmYV9vYmplY3QuWEZBT2JqZWN0QXJyYXkoKTsKICAgIHRoaXMuaW50ZWdlciA9IG5ldyBfeGZhX29iamVjdC5YRkFPYmplY3RBcnJheSgpOwogICAgdGhpcy5pc3N1ZXJzID0gbmV3IF94ZmFfb2JqZWN0LlhGQU9iamVjdEFycmF5KCk7CiAgICB0aGlzLml0ZW1zID0gbmV3IF94ZmFfb2JqZWN0LlhGQU9iamVjdEFycmF5KCk7CiAgICB0aGlzLmtlZXAgPSBuZXcgX3hmYV9vYmplY3QuWEZBT2JqZWN0QXJyYXkoKTsKICAgIHRoaXMua2V5VXNhZ2UgPSBuZXcgX3hmYV9vYmplY3QuWEZBT2JqZWN0QXJyYXkoKTsKICAgIHRoaXMubGluZSA9IG5ldyBfeGZhX29iamVjdC5YRkFPYmplY3RBcnJheSgpOwogICAgdGhpcy5saW5lYXIgPSBuZXcgX3hmYV9vYmplY3QuWEZBT2JqZWN0QXJyYXkoKTsKICAgIHRoaXMubG9ja0RvY3VtZW50ID0gbmV3IF94ZmFfb2JqZWN0LlhGQU9iamVjdEFycmF5KCk7CiAgICB0aGlzLm1hbmlmZXN0ID0gbmV3IF94ZmFfb2JqZWN0LlhGQU9iamVjdEFycmF5KCk7CiAgICB0aGlzLm1hcmdpbiA9IG5ldyBfeGZhX29iamVjdC5YRkFPYmplY3RBcnJheSgpOwogICAgdGhpcy5tZHAgPSBuZXcgX3hmYV9vYmplY3QuWEZBT2JqZWN0QXJyYXkoKTsKICAgIHRoaXMubWVkaXVtID0gbmV3IF94ZmFfb2JqZWN0LlhGQU9iamVjdEFycmF5KCk7CiAgICB0aGlzLm1lc3NhZ2UgPSBuZXcgX3hmYV9vYmplY3QuWEZBT2JqZWN0QXJyYXkoKTsKICAgIHRoaXMubnVtZXJpY0VkaXQgPSBuZXcgX3hmYV9vYmplY3QuWEZBT2JqZWN0QXJyYXkoKTsKICAgIHRoaXMub2NjdXIgPSBuZXcgX3hmYV9vYmplY3QuWEZBT2JqZWN0QXJyYXkoKTsKICAgIHRoaXMub2lkID0gbmV3IF94ZmFfb2JqZWN0LlhGQU9iamVjdEFycmF5KCk7CiAgICB0aGlzLm9pZHMgPSBuZXcgX3hmYV9vYmplY3QuWEZBT2JqZWN0QXJyYXkoKTsKICAgIHRoaXMub3ZlcmZsb3cgPSBuZXcgX3hmYV9vYmplY3QuWEZBT2JqZWN0QXJyYXkoKTsKICAgIHRoaXMucGFnZUFyZWEgPSBuZXcgX3hmYV9vYmplY3QuWEZBT2JqZWN0QXJyYXkoKTsKICAgIHRoaXMucGFnZVNldCA9IG5ldyBfeGZhX29iamVjdC5YRkFPYmplY3RBcnJheSgpOwogICAgdGhpcy5wYXJhID0gbmV3IF94ZmFfb2JqZWN0LlhGQU9iamVjdEFycmF5KCk7CiAgICB0aGlzLnBhc3N3b3JkRWRpdCA9IG5ldyBfeGZhX29iamVjdC5YRkFPYmplY3RBcnJheSgpOwogICAgdGhpcy5wYXR0ZXJuID0gbmV3IF94ZmFfb2JqZWN0LlhGQU9iamVjdEFycmF5KCk7CiAgICB0aGlzLnBpY3R1cmUgPSBuZXcgX3hmYV9vYmplY3QuWEZBT2JqZWN0QXJyYXkoKTsKICAgIHRoaXMucmFkaWFsID0gbmV3IF94ZmFfb2JqZWN0LlhGQU9iamVjdEFycmF5KCk7CiAgICB0aGlzLnJlYXNvbiA9IG5ldyBfeGZhX29iamVjdC5YRkFPYmplY3RBcnJheSgpOwogICAgdGhpcy5yZWFzb25zID0gbmV3IF94ZmFfb2JqZWN0LlhGQU9iamVjdEFycmF5KCk7CiAgICB0aGlzLnJlY3RhbmdsZSA9IG5ldyBfeGZhX29iamVjdC5YRkFPYmplY3RBcnJheSgpOwogICAgdGhpcy5yZWYgPSBuZXcgX3hmYV9vYmplY3QuWEZBT2JqZWN0QXJyYXkoKTsKICAgIHRoaXMuc2NyaXB0ID0gbmV3IF94ZmFfb2JqZWN0LlhGQU9iamVjdEFycmF5KCk7CiAgICB0aGlzLnNldFByb3BlcnR5ID0gbmV3IF94ZmFfb2JqZWN0LlhGQU9iamVjdEFycmF5KCk7CiAgICB0aGlzLnNpZ25EYXRhID0gbmV3IF94ZmFfb2JqZWN0LlhGQU9iamVjdEFycmF5KCk7CiAgICB0aGlzLnNpZ25hdHVyZSA9IG5ldyBfeGZhX29iamVjdC5YRkFPYmplY3RBcnJheSgpOwogICAgdGhpcy5zaWduaW5nID0gbmV3IF94ZmFfb2JqZWN0LlhGQU9iamVjdEFycmF5KCk7CiAgICB0aGlzLnNvbGlkID0gbmV3IF94ZmFfb2JqZWN0LlhGQU9iamVjdEFycmF5KCk7CiAgICB0aGlzLnNwZWFrID0gbmV3IF94ZmFfb2JqZWN0LlhGQU9iamVjdEFycmF5KCk7CiAgICB0aGlzLnN0aXBwbGUgPSBuZXcgX3hmYV9vYmplY3QuWEZBT2JqZWN0QXJyYXkoKTsKICAgIHRoaXMuc3ViZm9ybSA9IG5ldyBfeGZhX29iamVjdC5YRkFPYmplY3RBcnJheSgpOwogICAgdGhpcy5zdWJmb3JtU2V0ID0gbmV3IF94ZmFfb2JqZWN0LlhGQU9iamVjdEFycmF5KCk7CiAgICB0aGlzLnN1YmplY3RETiA9IG5ldyBfeGZhX29iamVjdC5YRkFPYmplY3RBcnJheSgpOwogICAgdGhpcy5zdWJqZWN0RE5zID0gbmV3IF94ZmFfb2JqZWN0LlhGQU9iamVjdEFycmF5KCk7CiAgICB0aGlzLnN1Ym1pdCA9IG5ldyBfeGZhX29iamVjdC5YRkFPYmplY3RBcnJheSgpOwogICAgdGhpcy50ZXh0ID0gbmV3IF94ZmFfb2JqZWN0LlhGQU9iamVjdEFycmF5KCk7CiAgICB0aGlzLnRleHRFZGl0ID0gbmV3IF94ZmFfb2JqZWN0LlhGQU9iamVjdEFycmF5KCk7CiAgICB0aGlzLnRpbWUgPSBuZXcgX3hmYV9vYmplY3QuWEZBT2JqZWN0QXJyYXkoKTsKICAgIHRoaXMudGltZVN0YW1wID0gbmV3IF94ZmFfb2JqZWN0LlhGQU9iamVjdEFycmF5KCk7CiAgICB0aGlzLnRvb2xUaXAgPSBuZXcgX3hmYV9vYmplY3QuWEZBT2JqZWN0QXJyYXkoKTsKICAgIHRoaXMudHJhdmVyc2FsID0gbmV3IF94ZmFfb2JqZWN0LlhGQU9iamVjdEFycmF5KCk7CiAgICB0aGlzLnRyYXZlcnNlID0gbmV3IF94ZmFfb2JqZWN0LlhGQU9iamVjdEFycmF5KCk7CiAgICB0aGlzLnVpID0gbmV3IF94ZmFfb2JqZWN0LlhGQU9iamVjdEFycmF5KCk7CiAgICB0aGlzLnZhbGlkYXRlID0gbmV3IF94ZmFfb2JqZWN0LlhGQU9iamVjdEFycmF5KCk7CiAgICB0aGlzLnZhbHVlID0gbmV3IF94ZmFfb2JqZWN0LlhGQU9iamVjdEFycmF5KCk7CiAgICB0aGlzLnZhcmlhYmxlcyA9IG5ldyBfeGZhX29iamVjdC5YRkFPYmplY3RBcnJheSgpOwogIH0KfQpjbGFzcyBSYWRpYWwgZXh0ZW5kcyBfeGZhX29iamVjdC5YRkFPYmplY3QgewogIGNvbnN0cnVjdG9yKGF0dHJpYnV0ZXMpIHsKICAgIHN1cGVyKFRFTVBMQVRFX05TX0lELCAicmFkaWFsIiwgdHJ1ZSk7CiAgICB0aGlzLmlkID0gYXR0cmlidXRlcy5pZCB8fCAiIjsKICAgIHRoaXMudHlwZSA9ICgwLCBfdXRpbHMuZ2V0U3RyaW5nT3B0aW9uKShhdHRyaWJ1dGVzLnR5cGUsIFsidG9FZGdlIiwgInRvQ2VudGVyIl0pOwogICAgdGhpcy51c2UgPSBhdHRyaWJ1dGVzLnVzZSB8fCAiIjsKICAgIHRoaXMudXNlaHJlZiA9IGF0dHJpYnV0ZXMudXNlaHJlZiB8fCAiIjsKICAgIHRoaXMuY29sb3IgPSBudWxsOwogICAgdGhpcy5leHRyYXMgPSBudWxsOwogIH0KICBbX3N5bWJvbF91dGlscy4kdG9TdHlsZV0oc3RhcnRDb2xvcikgewogICAgc3RhcnRDb2xvciA9IHN0YXJ0Q29sb3IgPyBzdGFydENvbG9yW19zeW1ib2xfdXRpbHMuJHRvU3R5bGVdKCkgOiAiI0ZGRkZGRiI7CiAgICBjb25zdCBlbmRDb2xvciA9IHRoaXMuY29sb3IgPyB0aGlzLmNvbG9yW19zeW1ib2xfdXRpbHMuJHRvU3R5bGVdKCkgOiAiIzAwMDAwMCI7CiAgICBjb25zdCBjb2xvcnMgPSB0aGlzLnR5cGUgPT09ICJ0b0VkZ2UiID8gYCR7c3RhcnRDb2xvcn0sJHtlbmRDb2xvcn1gIDogYCR7ZW5kQ29sb3J9LCR7c3RhcnRDb2xvcn1gOwogICAgcmV0dXJuIGByYWRpYWwtZ3JhZGllbnQoY2lyY2xlIGF0IGNlbnRlciwgJHtjb2xvcnN9KWA7CiAgfQp9CmNsYXNzIFJlYXNvbiBleHRlbmRzIF94ZmFfb2JqZWN0LlN0cmluZ09iamVjdCB7CiAgY29uc3RydWN0b3IoYXR0cmlidXRlcykgewogICAgc3VwZXIoVEVNUExBVEVfTlNfSUQsICJyZWFzb24iKTsKICAgIHRoaXMuaWQgPSBhdHRyaWJ1dGVzLmlkIHx8ICIiOwogICAgdGhpcy5uYW1lID0gYXR0cmlidXRlcy5uYW1lIHx8ICIiOwogICAgdGhpcy51c2UgPSBhdHRyaWJ1dGVzLnVzZSB8fCAiIjsKICAgIHRoaXMudXNlaHJlZiA9IGF0dHJpYnV0ZXMudXNlaHJlZiB8fCAiIjsKICB9Cn0KY2xhc3MgUmVhc29ucyBleHRlbmRzIF94ZmFfb2JqZWN0LlhGQU9iamVjdCB7CiAgY29uc3RydWN0b3IoYXR0cmlidXRlcykgewogICAgc3VwZXIoVEVNUExBVEVfTlNfSUQsICJyZWFzb25zIiwgdHJ1ZSk7CiAgICB0aGlzLmlkID0gYXR0cmlidXRlcy5pZCB8fCAiIjsKICAgIHRoaXMudHlwZSA9ICgwLCBfdXRpbHMuZ2V0U3RyaW5nT3B0aW9uKShhdHRyaWJ1dGVzLnR5cGUsIFsib3B0aW9uYWwiLCAicmVxdWlyZWQiXSk7CiAgICB0aGlzLnVzZSA9IGF0dHJpYnV0ZXMudXNlIHx8ICIiOwogICAgdGhpcy51c2VocmVmID0gYXR0cmlidXRlcy51c2VocmVmIHx8ICIiOwogICAgdGhpcy5yZWFzb24gPSBuZXcgX3hmYV9vYmplY3QuWEZBT2JqZWN0QXJyYXkoKTsKICB9Cn0KY2xhc3MgUmVjdGFuZ2xlIGV4dGVuZHMgX3hmYV9vYmplY3QuWEZBT2JqZWN0IHsKICBjb25zdHJ1Y3RvcihhdHRyaWJ1dGVzKSB7CiAgICBzdXBlcihURU1QTEFURV9OU19JRCwgInJlY3RhbmdsZSIsIHRydWUpOwogICAgdGhpcy5oYW5kID0gKDAsIF91dGlscy5nZXRTdHJpbmdPcHRpb24pKGF0dHJpYnV0ZXMuaGFuZCwgWyJldmVuIiwgImxlZnQiLCAicmlnaHQiXSk7CiAgICB0aGlzLmlkID0gYXR0cmlidXRlcy5pZCB8fCAiIjsKICAgIHRoaXMudXNlID0gYXR0cmlidXRlcy51c2UgfHwgIiI7CiAgICB0aGlzLnVzZWhyZWYgPSBhdHRyaWJ1dGVzLnVzZWhyZWYgfHwgIiI7CiAgICB0aGlzLmNvcm5lciA9IG5ldyBfeGZhX29iamVjdC5YRkFPYmplY3RBcnJheSg0KTsKICAgIHRoaXMuZWRnZSA9IG5ldyBfeGZhX29iamVjdC5YRkFPYmplY3RBcnJheSg0KTsKICAgIHRoaXMuZmlsbCA9IG51bGw7CiAgfQogIFtfc3ltYm9sX3V0aWxzLiR0b0hUTUxdKCkgewogICAgY29uc3QgZWRnZSA9IHRoaXMuZWRnZS5jaGlsZHJlbi5sZW5ndGggPyB0aGlzLmVkZ2UuY2hpbGRyZW5bMF0gOiBuZXcgRWRnZSh7fSk7CiAgICBjb25zdCBlZGdlU3R5bGUgPSBlZGdlW19zeW1ib2xfdXRpbHMuJHRvU3R5bGVdKCk7CiAgICBjb25zdCBzdHlsZSA9IE9iamVjdC5jcmVhdGUobnVsbCk7CiAgICBpZiAodGhpcy5maWxsPy5wcmVzZW5jZSA9PT0gInZpc2libGUiKSB7CiAgICAgIE9iamVjdC5hc3NpZ24oc3R5bGUsIHRoaXMuZmlsbFtfc3ltYm9sX3V0aWxzLiR0b1N0eWxlXSgpKTsKICAgIH0gZWxzZSB7CiAgICAgIHN0eWxlLmZpbGwgPSAidHJhbnNwYXJlbnQiOwogICAgfQogICAgc3R5bGUuc3Ryb2tlV2lkdGggPSAoMCwgX2h0bWxfdXRpbHMubWVhc3VyZVRvU3RyaW5nKShlZGdlLnByZXNlbmNlID09PSAidmlzaWJsZSIgPyBlZGdlLnRoaWNrbmVzcyA6IDApOwogICAgc3R5bGUuc3Ryb2tlID0gZWRnZVN0eWxlLmNvbG9yOwogICAgY29uc3QgY29ybmVyID0gdGhpcy5jb3JuZXIuY2hpbGRyZW4ubGVuZ3RoID8gdGhpcy5jb3JuZXIuY2hpbGRyZW5bMF0gOiBuZXcgQ29ybmVyKHt9KTsKICAgIGNvbnN0IGNvcm5lclN0eWxlID0gY29ybmVyW19zeW1ib2xfdXRpbHMuJHRvU3R5bGVdKCk7CiAgICBjb25zdCByZWN0ID0gewogICAgICBuYW1lOiAicmVjdCIsCiAgICAgIGF0dHJpYnV0ZXM6IHsKICAgICAgICB4bWxuczogU1ZHX05TLAogICAgICAgIHdpZHRoOiAiMTAwJSIsCiAgICAgICAgaGVpZ2h0OiAiMTAwJSIsCiAgICAgICAgeDogMCwKICAgICAgICB5OiAwLAogICAgICAgIHJ4OiBjb3JuZXJTdHlsZS5yYWRpdXMsCiAgICAgICAgcnk6IGNvcm5lclN0eWxlLnJhZGl1cywKICAgICAgICBzdHlsZQogICAgICB9CiAgICB9OwogICAgY29uc3Qgc3ZnID0gewogICAgICBuYW1lOiAic3ZnIiwKICAgICAgY2hpbGRyZW46IFtyZWN0XSwKICAgICAgYXR0cmlidXRlczogewogICAgICAgIHhtbG5zOiBTVkdfTlMsCiAgICAgICAgc3R5bGU6IHsKICAgICAgICAgIG92ZXJmbG93OiAidmlzaWJsZSIKICAgICAgICB9LAogICAgICAgIHdpZHRoOiAiMTAwJSIsCiAgICAgICAgaGVpZ2h0OiAiMTAwJSIKICAgICAgfQogICAgfTsKICAgIGNvbnN0IHBhcmVudCA9IHRoaXNbX3N5bWJvbF91dGlscy4kZ2V0UGFyZW50XSgpW19zeW1ib2xfdXRpbHMuJGdldFBhcmVudF0oKTsKICAgIGlmIChoYXNNYXJnaW4ocGFyZW50KSkgewogICAgICByZXR1cm4gX3V0aWxzLkhUTUxSZXN1bHQuc3VjY2Vzcyh7CiAgICAgICAgbmFtZTogImRpdiIsCiAgICAgICAgYXR0cmlidXRlczogewogICAgICAgICAgc3R5bGU6IHsKICAgICAgICAgICAgZGlzcGxheTogImlubGluZSIsCiAgICAgICAgICAgIHdpZHRoOiAiMTAwJSIsCiAgICAgICAgICAgIGhlaWdodDogIjEwMCUiCiAgICAgICAgICB9CiAgICAgICAgfSwKICAgICAgICBjaGlsZHJlbjogW3N2Z10KICAgICAgfSk7CiAgICB9CiAgICBzdmcuYXR0cmlidXRlcy5zdHlsZS5wb3NpdGlvbiA9ICJhYnNvbHV0ZSI7CiAgICByZXR1cm4gX3V0aWxzLkhUTUxSZXN1bHQuc3VjY2VzcyhzdmcpOwogIH0KfQpjbGFzcyBSZWZFbGVtZW50IGV4dGVuZHMgX3hmYV9vYmplY3QuU3RyaW5nT2JqZWN0IHsKICBjb25zdHJ1Y3RvcihhdHRyaWJ1dGVzKSB7CiAgICBzdXBlcihURU1QTEFURV9OU19JRCwgInJlZiIpOwogICAgdGhpcy5pZCA9IGF0dHJpYnV0ZXMuaWQgfHwgIiI7CiAgICB0aGlzLnVzZSA9IGF0dHJpYnV0ZXMudXNlIHx8ICIiOwogICAgdGhpcy51c2VocmVmID0gYXR0cmlidXRlcy51c2VocmVmIHx8ICIiOwogIH0KfQpjbGFzcyBTY3JpcHQgZXh0ZW5kcyBfeGZhX29iamVjdC5TdHJpbmdPYmplY3QgewogIGNvbnN0cnVjdG9yKGF0dHJpYnV0ZXMpIHsKICAgIHN1cGVyKFRFTVBMQVRFX05TX0lELCAic2NyaXB0Iik7CiAgICB0aGlzLmJpbmRpbmcgPSBhdHRyaWJ1dGVzLmJpbmRpbmcgfHwgIiI7CiAgICB0aGlzLmNvbnRlbnRUeXBlID0gYXR0cmlidXRlcy5jb250ZW50VHlwZSB8fCAiIjsKICAgIHRoaXMuaWQgPSBhdHRyaWJ1dGVzLmlkIHx8ICIiOwogICAgdGhpcy5uYW1lID0gYXR0cmlidXRlcy5uYW1lIHx8ICIiOwogICAgdGhpcy5ydW5BdCA9ICgwLCBfdXRpbHMuZ2V0U3RyaW5nT3B0aW9uKShhdHRyaWJ1dGVzLnJ1bkF0LCBbImNsaWVudCIsICJib3RoIiwgInNlcnZlciJdKTsKICAgIHRoaXMudXNlID0gYXR0cmlidXRlcy51c2UgfHwgIiI7CiAgICB0aGlzLnVzZWhyZWYgPSBhdHRyaWJ1dGVzLnVzZWhyZWYgfHwgIiI7CiAgfQp9CmNsYXNzIFNldFByb3BlcnR5IGV4dGVuZHMgX3hmYV9vYmplY3QuWEZBT2JqZWN0IHsKICBjb25zdHJ1Y3RvcihhdHRyaWJ1dGVzKSB7CiAgICBzdXBlcihURU1QTEFURV9OU19JRCwgInNldFByb3BlcnR5Iik7CiAgICB0aGlzLmNvbm5lY3Rpb24gPSBhdHRyaWJ1dGVzLmNvbm5lY3Rpb24gfHwgIiI7CiAgICB0aGlzLnJlZiA9IGF0dHJpYnV0ZXMucmVmIHx8ICIiOwogICAgdGhpcy50YXJnZXQgPSBhdHRyaWJ1dGVzLnRhcmdldCB8fCAiIjsKICB9Cn0KZXhwb3J0cy5TZXRQcm9wZXJ0eSA9IFNldFByb3BlcnR5OwpjbGFzcyBTaWduRGF0YSBleHRlbmRzIF94ZmFfb2JqZWN0LlhGQU9iamVjdCB7CiAgY29uc3RydWN0b3IoYXR0cmlidXRlcykgewogICAgc3VwZXIoVEVNUExBVEVfTlNfSUQsICJzaWduRGF0YSIsIHRydWUpOwogICAgdGhpcy5pZCA9IGF0dHJpYnV0ZXMuaWQgfHwgIiI7CiAgICB0aGlzLm9wZXJhdGlvbiA9ICgwLCBfdXRpbHMuZ2V0U3RyaW5nT3B0aW9uKShhdHRyaWJ1dGVzLm9wZXJhdGlvbiwgWyJzaWduIiwgImNsZWFyIiwgInZlcmlmeSJdKTsKICAgIHRoaXMucmVmID0gYXR0cmlidXRlcy5yZWYgfHwgIiI7CiAgICB0aGlzLnRhcmdldCA9IGF0dHJpYnV0ZXMudGFyZ2V0IHx8ICIiOwogICAgdGhpcy51c2UgPSBhdHRyaWJ1dGVzLnVzZSB8fCAiIjsKICAgIHRoaXMudXNlaHJlZiA9IGF0dHJpYnV0ZXMudXNlaHJlZiB8fCAiIjsKICAgIHRoaXMuZmlsdGVyID0gbnVsbDsKICAgIHRoaXMubWFuaWZlc3QgPSBudWxsOwogIH0KfQpjbGFzcyBTaWduYXR1cmUgZXh0ZW5kcyBfeGZhX29iamVjdC5YRkFPYmplY3QgewogIGNvbnN0cnVjdG9yKGF0dHJpYnV0ZXMpIHsKICAgIHN1cGVyKFRFTVBMQVRFX05TX0lELCAic2lnbmF0dXJlIiwgdHJ1ZSk7CiAgICB0aGlzLmlkID0gYXR0cmlidXRlcy5pZCB8fCAiIjsKICAgIHRoaXMudHlwZSA9ICgwLCBfdXRpbHMuZ2V0U3RyaW5nT3B0aW9uKShhdHRyaWJ1dGVzLnR5cGUsIFsiUERGMS4zIiwgIlBERjEuNiJdKTsKICAgIHRoaXMudXNlID0gYXR0cmlidXRlcy51c2UgfHwgIiI7CiAgICB0aGlzLnVzZWhyZWYgPSBhdHRyaWJ1dGVzLnVzZWhyZWYgfHwgIiI7CiAgICB0aGlzLmJvcmRlciA9IG51bGw7CiAgICB0aGlzLmV4dHJhcyA9IG51bGw7CiAgICB0aGlzLmZpbHRlciA9IG51bGw7CiAgICB0aGlzLm1hbmlmZXN0ID0gbnVsbDsKICAgIHRoaXMubWFyZ2luID0gbnVsbDsKICB9Cn0KY2xhc3MgU2lnbmluZyBleHRlbmRzIF94ZmFfb2JqZWN0LlhGQU9iamVjdCB7CiAgY29uc3RydWN0b3IoYXR0cmlidXRlcykgewogICAgc3VwZXIoVEVNUExBVEVfTlNfSUQsICJzaWduaW5nIiwgdHJ1ZSk7CiAgICB0aGlzLmlkID0gYXR0cmlidXRlcy5pZCB8fCAiIjsKICAgIHRoaXMudHlwZSA9ICgwLCBfdXRpbHMuZ2V0U3RyaW5nT3B0aW9uKShhdHRyaWJ1dGVzLnR5cGUsIFsib3B0aW9uYWwiLCAicmVxdWlyZWQiXSk7CiAgICB0aGlzLnVzZSA9IGF0dHJpYnV0ZXMudXNlIHx8ICIiOwogICAgdGhpcy51c2VocmVmID0gYXR0cmlidXRlcy51c2VocmVmIHx8ICIiOwogICAgdGhpcy5jZXJ0aWZpY2F0ZSA9IG5ldyBfeGZhX29iamVjdC5YRkFPYmplY3RBcnJheSgpOwogIH0KfQpjbGFzcyBTb2xpZCBleHRlbmRzIF94ZmFfb2JqZWN0LlhGQU9iamVjdCB7CiAgY29uc3RydWN0b3IoYXR0cmlidXRlcykgewogICAgc3VwZXIoVEVNUExBVEVfTlNfSUQsICJzb2xpZCIsIHRydWUpOwogICAgdGhpcy5pZCA9IGF0dHJpYnV0ZXMuaWQgfHwgIiI7CiAgICB0aGlzLnVzZSA9IGF0dHJpYnV0ZXMudXNlIHx8ICIiOwogICAgdGhpcy51c2VocmVmID0gYXR0cmlidXRlcy51c2VocmVmIHx8ICIiOwogICAgdGhpcy5leHRyYXMgPSBudWxsOwogIH0KICBbX3N5bWJvbF91dGlscy4kdG9TdHlsZV0oc3RhcnRDb2xvcikgewogICAgcmV0dXJuIHN0YXJ0Q29sb3IgPyBzdGFydENvbG9yW19zeW1ib2xfdXRpbHMuJHRvU3R5bGVdKCkgOiAiI0ZGRkZGRiI7CiAgfQp9CmNsYXNzIFNwZWFrIGV4dGVuZHMgX3hmYV9vYmplY3QuU3RyaW5nT2JqZWN0IHsKICBjb25zdHJ1Y3RvcihhdHRyaWJ1dGVzKSB7CiAgICBzdXBlcihURU1QTEFURV9OU19JRCwgInNwZWFrIik7CiAgICB0aGlzLmRpc2FibGUgPSAoMCwgX3V0aWxzLmdldEludGVnZXIpKHsKICAgICAgZGF0YTogYXR0cmlidXRlcy5kaXNhYmxlLAogICAgICBkZWZhdWx0VmFsdWU6IDAsCiAgICAgIHZhbGlkYXRlOiB4ID0+IHggPT09IDEKICAgIH0pOwogICAgdGhpcy5pZCA9IGF0dHJpYnV0ZXMuaWQgfHwgIiI7CiAgICB0aGlzLnByaW9yaXR5ID0gKDAsIF91dGlscy5nZXRTdHJpbmdPcHRpb24pKGF0dHJpYnV0ZXMucHJpb3JpdHksIFsiY3VzdG9tIiwgImNhcHRpb24iLCAibmFtZSIsICJ0b29sVGlwIl0pOwogICAgdGhpcy5yaWQgPSBhdHRyaWJ1dGVzLnJpZCB8fCAiIjsKICAgIHRoaXMudXNlID0gYXR0cmlidXRlcy51c2UgfHwgIiI7CiAgICB0aGlzLnVzZWhyZWYgPSBhdHRyaWJ1dGVzLnVzZWhyZWYgfHwgIiI7CiAgfQp9CmNsYXNzIFN0aXBwbGUgZXh0ZW5kcyBfeGZhX29iamVjdC5YRkFPYmplY3QgewogIGNvbnN0cnVjdG9yKGF0dHJpYnV0ZXMpIHsKICAgIHN1cGVyKFRFTVBMQVRFX05TX0lELCAic3RpcHBsZSIsIHRydWUpOwogICAgdGhpcy5pZCA9IGF0dHJpYnV0ZXMuaWQgfHwgIiI7CiAgICB0aGlzLnJhdGUgPSAoMCwgX3V0aWxzLmdldEludGVnZXIpKHsKICAgICAgZGF0YTogYXR0cmlidXRlcy5yYXRlLAogICAgICBkZWZhdWx0VmFsdWU6IDUwLAogICAgICB2YWxpZGF0ZTogeCA9PiB4ID49IDAgJiYgeCA8PSAxMDAKICAgIH0pOwogICAgdGhpcy51c2UgPSBhdHRyaWJ1dGVzLnVzZSB8fCAiIjsKICAgIHRoaXMudXNlaHJlZiA9IGF0dHJpYnV0ZXMudXNlaHJlZiB8fCAiIjsKICAgIHRoaXMuY29sb3IgPSBudWxsOwogICAgdGhpcy5leHRyYXMgPSBudWxsOwogIH0KICBbX3N5bWJvbF91dGlscy4kdG9TdHlsZV0oYmdDb2xvcikgewogICAgY29uc3QgYWxwaGEgPSB0aGlzLnJhdGUgLyAxMDA7CiAgICByZXR1cm4gX3V0aWwuVXRpbC5tYWtlSGV4Q29sb3IoTWF0aC5yb3VuZChiZ0NvbG9yLnZhbHVlLnIgKiAoMSAtIGFscGhhKSArIHRoaXMudmFsdWUuciAqIGFscGhhKSwgTWF0aC5yb3VuZChiZ0NvbG9yLnZhbHVlLmcgKiAoMSAtIGFscGhhKSArIHRoaXMudmFsdWUuZyAqIGFscGhhKSwgTWF0aC5yb3VuZChiZ0NvbG9yLnZhbHVlLmIgKiAoMSAtIGFscGhhKSArIHRoaXMudmFsdWUuYiAqIGFscGhhKSk7CiAgfQp9CmNsYXNzIFN1YmZvcm0gZXh0ZW5kcyBfeGZhX29iamVjdC5YRkFPYmplY3QgewogIGNvbnN0cnVjdG9yKGF0dHJpYnV0ZXMpIHsKICAgIHN1cGVyKFRFTVBMQVRFX05TX0lELCAic3ViZm9ybSIsIHRydWUpOwogICAgdGhpcy5hY2Nlc3MgPSAoMCwgX3V0aWxzLmdldFN0cmluZ09wdGlvbikoYXR0cmlidXRlcy5hY2Nlc3MsIFsib3BlbiIsICJub25JbnRlcmFjdGl2ZSIsICJwcm90ZWN0ZWQiLCAicmVhZE9ubHkiXSk7CiAgICB0aGlzLmFsbG93TWFjcm8gPSAoMCwgX3V0aWxzLmdldEludGVnZXIpKHsKICAgICAgZGF0YTogYXR0cmlidXRlcy5hbGxvd01hY3JvLAogICAgICBkZWZhdWx0VmFsdWU6IDAsCiAgICAgIHZhbGlkYXRlOiB4ID0+IHggPT09IDEKICAgIH0pOwogICAgdGhpcy5hbmNob3JUeXBlID0gKDAsIF91dGlscy5nZXRTdHJpbmdPcHRpb24pKGF0dHJpYnV0ZXMuYW5jaG9yVHlwZSwgWyJ0b3BMZWZ0IiwgImJvdHRvbUNlbnRlciIsICJib3R0b21MZWZ0IiwgImJvdHRvbVJpZ2h0IiwgIm1pZGRsZUNlbnRlciIsICJtaWRkbGVMZWZ0IiwgIm1pZGRsZVJpZ2h0IiwgInRvcENlbnRlciIsICJ0b3BSaWdodCJdKTsKICAgIHRoaXMuY29sU3BhbiA9ICgwLCBfdXRpbHMuZ2V0SW50ZWdlcikoewogICAgICBkYXRhOiBhdHRyaWJ1dGVzLmNvbFNwYW4sCiAgICAgIGRlZmF1bHRWYWx1ZTogMSwKICAgICAgdmFsaWRhdGU6IG4gPT4gbiA+PSAxIHx8IG4gPT09IC0xCiAgICB9KTsKICAgIHRoaXMuY29sdW1uV2lkdGhzID0gKGF0dHJpYnV0ZXMuY29sdW1uV2lkdGhzIHx8ICIiKS50cmltKCkuc3BsaXQoL1xzKy8pLm1hcCh4ID0+IHggPT09ICItMSIgPyAtMSA6ICgwLCBfdXRpbHMuZ2V0TWVhc3VyZW1lbnQpKHgpKTsKICAgIHRoaXMuaCA9IGF0dHJpYnV0ZXMuaCA/ICgwLCBfdXRpbHMuZ2V0TWVhc3VyZW1lbnQpKGF0dHJpYnV0ZXMuaCkgOiAiIjsKICAgIHRoaXMuaEFsaWduID0gKDAsIF91dGlscy5nZXRTdHJpbmdPcHRpb24pKGF0dHJpYnV0ZXMuaEFsaWduLCBbImxlZnQiLCAiY2VudGVyIiwgImp1c3RpZnkiLCAianVzdGlmeUFsbCIsICJyYWRpeCIsICJyaWdodCJdKTsKICAgIHRoaXMuaWQgPSBhdHRyaWJ1dGVzLmlkIHx8ICIiOwogICAgdGhpcy5sYXlvdXQgPSAoMCwgX3V0aWxzLmdldFN0cmluZ09wdGlvbikoYXR0cmlidXRlcy5sYXlvdXQsIFsicG9zaXRpb24iLCAibHItdGIiLCAicmwtcm93IiwgInJsLXRiIiwgInJvdyIsICJ0YWJsZSIsICJ0YiJdKTsKICAgIHRoaXMubG9jYWxlID0gYXR0cmlidXRlcy5sb2NhbGUgfHwgIiI7CiAgICB0aGlzLm1heEggPSAoMCwgX3V0aWxzLmdldE1lYXN1cmVtZW50KShhdHRyaWJ1dGVzLm1heEgsICIwcHQiKTsKICAgIHRoaXMubWF4VyA9ICgwLCBfdXRpbHMuZ2V0TWVhc3VyZW1lbnQpKGF0dHJpYnV0ZXMubWF4VywgIjBwdCIpOwogICAgdGhpcy5tZXJnZU1vZGUgPSAoMCwgX3V0aWxzLmdldFN0cmluZ09wdGlvbikoYXR0cmlidXRlcy5tZXJnZU1vZGUsIFsiY29uc3VtZURhdGEiLCAibWF0Y2hUZW1wbGF0ZSJdKTsKICAgIHRoaXMubWluSCA9ICgwLCBfdXRpbHMuZ2V0TWVhc3VyZW1lbnQpKGF0dHJpYnV0ZXMubWluSCwgIjBwdCIpOwogICAgdGhpcy5taW5XID0gKDAsIF91dGlscy5nZXRNZWFzdXJlbWVudCkoYXR0cmlidXRlcy5taW5XLCAiMHB0Iik7CiAgICB0aGlzLm5hbWUgPSBhdHRyaWJ1dGVzLm5hbWUgfHwgIiI7CiAgICB0aGlzLnByZXNlbmNlID0gKDAsIF91dGlscy5nZXRTdHJpbmdPcHRpb24pKGF0dHJpYnV0ZXMucHJlc2VuY2UsIFsidmlzaWJsZSIsICJoaWRkZW4iLCAiaW5hY3RpdmUiLCAiaW52aXNpYmxlIl0pOwogICAgdGhpcy5yZWxldmFudCA9ICgwLCBfdXRpbHMuZ2V0UmVsZXZhbnQpKGF0dHJpYnV0ZXMucmVsZXZhbnQpOwogICAgdGhpcy5yZXN0b3JlU3RhdGUgPSAoMCwgX3V0aWxzLmdldFN0cmluZ09wdGlvbikoYXR0cmlidXRlcy5yZXN0b3JlU3RhdGUsIFsibWFudWFsIiwgImF1dG8iXSk7CiAgICB0aGlzLnNjb3BlID0gKDAsIF91dGlscy5nZXRTdHJpbmdPcHRpb24pKGF0dHJpYnV0ZXMuc2NvcGUsIFsibmFtZSIsICJub25lIl0pOwogICAgdGhpcy51c2UgPSBhdHRyaWJ1dGVzLnVzZSB8fCAiIjsKICAgIHRoaXMudXNlaHJlZiA9IGF0dHJpYnV0ZXMudXNlaHJlZiB8fCAiIjsKICAgIHRoaXMudyA9IGF0dHJpYnV0ZXMudyA/ICgwLCBfdXRpbHMuZ2V0TWVhc3VyZW1lbnQpKGF0dHJpYnV0ZXMudykgOiAiIjsKICAgIHRoaXMueCA9ICgwLCBfdXRpbHMuZ2V0TWVhc3VyZW1lbnQpKGF0dHJpYnV0ZXMueCwgIjBwdCIpOwogICAgdGhpcy55ID0gKDAsIF91dGlscy5nZXRNZWFzdXJlbWVudCkoYXR0cmlidXRlcy55LCAiMHB0Iik7CiAgICB0aGlzLmFzc2lzdCA9IG51bGw7CiAgICB0aGlzLmJpbmQgPSBudWxsOwogICAgdGhpcy5ib29rZW5kID0gbnVsbDsKICAgIHRoaXMuYm9yZGVyID0gbnVsbDsKICAgIHRoaXMuYnJlYWsgPSBudWxsOwogICAgdGhpcy5jYWxjdWxhdGUgPSBudWxsOwogICAgdGhpcy5kZXNjID0gbnVsbDsKICAgIHRoaXMuZXh0cmFzID0gbnVsbDsKICAgIHRoaXMua2VlcCA9IG51bGw7CiAgICB0aGlzLm1hcmdpbiA9IG51bGw7CiAgICB0aGlzLm9jY3VyID0gbnVsbDsKICAgIHRoaXMub3ZlcmZsb3cgPSBudWxsOwogICAgdGhpcy5wYWdlU2V0ID0gbnVsbDsKICAgIHRoaXMucGFyYSA9IG51bGw7CiAgICB0aGlzLnRyYXZlcnNhbCA9IG51bGw7CiAgICB0aGlzLnZhbGlkYXRlID0gbnVsbDsKICAgIHRoaXMudmFyaWFibGVzID0gbnVsbDsKICAgIHRoaXMuYXJlYSA9IG5ldyBfeGZhX29iamVjdC5YRkFPYmplY3RBcnJheSgpOwogICAgdGhpcy5icmVha0FmdGVyID0gbmV3IF94ZmFfb2JqZWN0LlhGQU9iamVjdEFycmF5KCk7CiAgICB0aGlzLmJyZWFrQmVmb3JlID0gbmV3IF94ZmFfb2JqZWN0LlhGQU9iamVjdEFycmF5KCk7CiAgICB0aGlzLmNvbm5lY3QgPSBuZXcgX3hmYV9vYmplY3QuWEZBT2JqZWN0QXJyYXkoKTsKICAgIHRoaXMuZHJhdyA9IG5ldyBfeGZhX29iamVjdC5YRkFPYmplY3RBcnJheSgpOwogICAgdGhpcy5ldmVudCA9IG5ldyBfeGZhX29iamVjdC5YRkFPYmplY3RBcnJheSgpOwogICAgdGhpcy5leE9iamVjdCA9IG5ldyBfeGZhX29iamVjdC5YRkFPYmplY3RBcnJheSgpOwogICAgdGhpcy5leGNsR3JvdXAgPSBuZXcgX3hmYV9vYmplY3QuWEZBT2JqZWN0QXJyYXkoKTsKICAgIHRoaXMuZmllbGQgPSBuZXcgX3hmYV9vYmplY3QuWEZBT2JqZWN0QXJyYXkoKTsKICAgIHRoaXMucHJvdG8gPSBuZXcgX3hmYV9vYmplY3QuWEZBT2JqZWN0QXJyYXkoKTsKICAgIHRoaXMuc2V0UHJvcGVydHkgPSBuZXcgX3hmYV9vYmplY3QuWEZBT2JqZWN0QXJyYXkoKTsKICAgIHRoaXMuc3ViZm9ybSA9IG5ldyBfeGZhX29iamVjdC5YRkFPYmplY3RBcnJheSgpOwogICAgdGhpcy5zdWJmb3JtU2V0ID0gbmV3IF94ZmFfb2JqZWN0LlhGQU9iamVjdEFycmF5KCk7CiAgfQogIFtfc3ltYm9sX3V0aWxzLiRnZXRTdWJmb3JtUGFyZW50XSgpIHsKICAgIGNvbnN0IHBhcmVudCA9IHRoaXNbX3N5bWJvbF91dGlscy4kZ2V0UGFyZW50XSgpOwogICAgaWYgKHBhcmVudCBpbnN0YW5jZW9mIFN1YmZvcm1TZXQpIHsKICAgICAgcmV0dXJuIHBhcmVudFtfc3ltYm9sX3V0aWxzLiRnZXRTdWJmb3JtUGFyZW50XSgpOwogICAgfQogICAgcmV0dXJuIHBhcmVudDsKICB9CiAgW19zeW1ib2xfdXRpbHMuJGlzQmluZGFibGVdKCkgewogICAgcmV0dXJuIHRydWU7CiAgfQogIFtfc3ltYm9sX3V0aWxzLiRpc1RoZXJlTW9yZVdpZHRoXSgpIHsKICAgIHJldHVybiB0aGlzLmxheW91dC5lbmRzV2l0aCgiLXRiIikgJiYgdGhpc1tfc3ltYm9sX3V0aWxzLiRleHRyYV0uYXR0ZW1wdCA9PT0gMCAmJiB0aGlzW19zeW1ib2xfdXRpbHMuJGV4dHJhXS5udW1iZXJJbkxpbmUgPiAwIHx8IHRoaXNbX3N5bWJvbF91dGlscy4kZ2V0UGFyZW50XSgpW19zeW1ib2xfdXRpbHMuJGlzVGhlcmVNb3JlV2lkdGhdKCk7CiAgfQogICpbX3N5bWJvbF91dGlscy4kZ2V0Q29udGFpbmVkQ2hpbGRyZW5dKCkgewogICAgeWllbGQqIGdldENvbnRhaW5lZENoaWxkcmVuKHRoaXMpOwogIH0KICBbX3N5bWJvbF91dGlscy4kZmx1c2hIVE1MXSgpIHsKICAgIHJldHVybiAoMCwgX2xheW91dC5mbHVzaEhUTUwpKHRoaXMpOwogIH0KICBbX3N5bWJvbF91dGlscy4kYWRkSFRNTF0oaHRtbCwgYmJveCkgewogICAgKDAsIF9sYXlvdXQuYWRkSFRNTCkodGhpcywgaHRtbCwgYmJveCk7CiAgfQogIFtfc3ltYm9sX3V0aWxzLiRnZXRBdmFpbGFibGVTcGFjZV0oKSB7CiAgICByZXR1cm4gKDAsIF9sYXlvdXQuZ2V0QXZhaWxhYmxlU3BhY2UpKHRoaXMpOwogIH0KICBbX3N5bWJvbF91dGlscy4kaXNTcGxpdHRhYmxlXSgpIHsKICAgIGNvbnN0IHBhcmVudCA9IHRoaXNbX3N5bWJvbF91dGlscy4kZ2V0U3ViZm9ybVBhcmVudF0oKTsKICAgIGlmICghcGFyZW50W19zeW1ib2xfdXRpbHMuJGlzU3BsaXR0YWJsZV0oKSkgewogICAgICByZXR1cm4gZmFsc2U7CiAgICB9CiAgICBpZiAodGhpc1tfc3ltYm9sX3V0aWxzLiRleHRyYV0uX2lzU3BsaXR0YWJsZSAhPT0gdW5kZWZpbmVkKSB7CiAgICAgIHJldHVybiB0aGlzW19zeW1ib2xfdXRpbHMuJGV4dHJhXS5faXNTcGxpdHRhYmxlOwogICAgfQogICAgaWYgKHRoaXMubGF5b3V0ID09PSAicG9zaXRpb24iIHx8IHRoaXMubGF5b3V0LmluY2x1ZGVzKCJyb3ciKSkgewogICAgICB0aGlzW19zeW1ib2xfdXRpbHMuJGV4dHJhXS5faXNTcGxpdHRhYmxlID0gZmFsc2U7CiAgICAgIHJldHVybiBmYWxzZTsKICAgIH0KICAgIGlmICh0aGlzLmtlZXAgJiYgdGhpcy5rZWVwLmludGFjdCAhPT0gIm5vbmUiKSB7CiAgICAgIHRoaXNbX3N5bWJvbF91dGlscy4kZXh0cmFdLl9pc1NwbGl0dGFibGUgPSBmYWxzZTsKICAgICAgcmV0dXJuIGZhbHNlOwogICAgfQogICAgaWYgKHBhcmVudC5sYXlvdXQ/LmVuZHNXaXRoKCItdGIiKSAmJiBwYXJlbnRbX3N5bWJvbF91dGlscy4kZXh0cmFdLm51bWJlckluTGluZSAhPT0gMCkgewogICAgICByZXR1cm4gZmFsc2U7CiAgICB9CiAgICB0aGlzW19zeW1ib2xfdXRpbHMuJGV4dHJhXS5faXNTcGxpdHRhYmxlID0gdHJ1ZTsKICAgIHJldHVybiB0cnVlOwogIH0KICBbX3N5bWJvbF91dGlscy4kdG9IVE1MXShhdmFpbGFibGVTcGFjZSkgewogICAgc2V0VGFiSW5kZXgodGhpcyk7CiAgICBpZiAodGhpcy5icmVhaykgewogICAgICBpZiAodGhpcy5icmVhay5hZnRlciAhPT0gImF1dG8iIHx8IHRoaXMuYnJlYWsuYWZ0ZXJUYXJnZXQgIT09ICIiKSB7CiAgICAgICAgY29uc3Qgbm9kZSA9IG5ldyBCcmVha0FmdGVyKHsKICAgICAgICAgIHRhcmdldFR5cGU6IHRoaXMuYnJlYWsuYWZ0ZXIsCiAgICAgICAgICB0YXJnZXQ6IHRoaXMuYnJlYWsuYWZ0ZXJUYXJnZXQsCiAgICAgICAgICBzdGFydE5ldzogdGhpcy5icmVhay5zdGFydE5ldy50b1N0cmluZygpCiAgICAgICAgfSk7CiAgICAgICAgbm9kZVtfc3ltYm9sX3V0aWxzLiRnbG9iYWxEYXRhXSA9IHRoaXNbX3N5bWJvbF91dGlscy4kZ2xvYmFsRGF0YV07CiAgICAgICAgdGhpc1tfc3ltYm9sX3V0aWxzLiRhcHBlbmRDaGlsZF0obm9kZSk7CiAgICAgICAgdGhpcy5icmVha0FmdGVyLnB1c2gobm9kZSk7CiAgICAgIH0KICAgICAgaWYgKHRoaXMuYnJlYWsuYmVmb3JlICE9PSAiYXV0byIgfHwgdGhpcy5icmVhay5iZWZvcmVUYXJnZXQgIT09ICIiKSB7CiAgICAgICAgY29uc3Qgbm9kZSA9IG5ldyBCcmVha0JlZm9yZSh7CiAgICAgICAgICB0YXJnZXRUeXBlOiB0aGlzLmJyZWFrLmJlZm9yZSwKICAgICAgICAgIHRhcmdldDogdGhpcy5icmVhay5iZWZvcmVUYXJnZXQsCiAgICAgICAgICBzdGFydE5ldzogdGhpcy5icmVhay5zdGFydE5ldy50b1N0cmluZygpCiAgICAgICAgfSk7CiAgICAgICAgbm9kZVtfc3ltYm9sX3V0aWxzLiRnbG9iYWxEYXRhXSA9IHRoaXNbX3N5bWJvbF91dGlscy4kZ2xvYmFsRGF0YV07CiAgICAgICAgdGhpc1tfc3ltYm9sX3V0aWxzLiRhcHBlbmRDaGlsZF0obm9kZSk7CiAgICAgICAgdGhpcy5icmVha0JlZm9yZS5wdXNoKG5vZGUpOwogICAgICB9CiAgICAgIGlmICh0aGlzLmJyZWFrLm92ZXJmbG93VGFyZ2V0ICE9PSAiIikgewogICAgICAgIGNvbnN0IG5vZGUgPSBuZXcgT3ZlcmZsb3coewogICAgICAgICAgdGFyZ2V0OiB0aGlzLmJyZWFrLm92ZXJmbG93VGFyZ2V0LAogICAgICAgICAgbGVhZGVyOiB0aGlzLmJyZWFrLm92ZXJmbG93TGVhZGVyLAogICAgICAgICAgdHJhaWxlcjogdGhpcy5icmVhay5vdmVyZmxvd1RyYWlsZXIKICAgICAgICB9KTsKICAgICAgICBub2RlW19zeW1ib2xfdXRpbHMuJGdsb2JhbERhdGFdID0gdGhpc1tfc3ltYm9sX3V0aWxzLiRnbG9iYWxEYXRhXTsKICAgICAgICB0aGlzW19zeW1ib2xfdXRpbHMuJGFwcGVuZENoaWxkXShub2RlKTsKICAgICAgICB0aGlzLm92ZXJmbG93LnB1c2gobm9kZSk7CiAgICAgIH0KICAgICAgdGhpc1tfc3ltYm9sX3V0aWxzLiRyZW1vdmVDaGlsZF0odGhpcy5icmVhayk7CiAgICAgIHRoaXMuYnJlYWsgPSBudWxsOwogICAgfQogICAgaWYgKHRoaXMucHJlc2VuY2UgPT09ICJoaWRkZW4iIHx8IHRoaXMucHJlc2VuY2UgPT09ICJpbmFjdGl2ZSIpIHsKICAgICAgcmV0dXJuIF91dGlscy5IVE1MUmVzdWx0LkVNUFRZOwogICAgfQogICAgaWYgKHRoaXMuYnJlYWtCZWZvcmUuY2hpbGRyZW4ubGVuZ3RoID4gMSB8fCB0aGlzLmJyZWFrQWZ0ZXIuY2hpbGRyZW4ubGVuZ3RoID4gMSkgewogICAgICAoMCwgX3V0aWwud2FybikoIlhGQSAtIFNldmVyYWwgYnJlYWtCZWZvcmUgb3IgYnJlYWtBZnRlciBpbiBzdWJmb3JtczogcGxlYXNlIGZpbGUgYSBidWcuIik7CiAgICB9CiAgICBpZiAodGhpcy5icmVha0JlZm9yZS5jaGlsZHJlbi5sZW5ndGggPj0gMSkgewogICAgICBjb25zdCBicmVha0JlZm9yZSA9IHRoaXMuYnJlYWtCZWZvcmUuY2hpbGRyZW5bMF07CiAgICAgIGlmIChoYW5kbGVCcmVhayhicmVha0JlZm9yZSkpIHsKICAgICAgICByZXR1cm4gX3V0aWxzLkhUTUxSZXN1bHQuYnJlYWtOb2RlKGJyZWFrQmVmb3JlKTsKICAgICAgfQogICAgfQogICAgaWYgKHRoaXNbX3N5bWJvbF91dGlscy4kZXh0cmFdPy5hZnRlckJyZWFrQWZ0ZXIpIHsKICAgICAgcmV0dXJuIF91dGlscy5IVE1MUmVzdWx0LkVNUFRZOwogICAgfQogICAgKDAsIF9odG1sX3V0aWxzLmZpeERpbWVuc2lvbnMpKHRoaXMpOwogICAgY29uc3QgY2hpbGRyZW4gPSBbXTsKICAgIGNvbnN0IGF0dHJpYnV0ZXMgPSB7CiAgICAgIGlkOiB0aGlzW19zeW1ib2xfdXRpbHMuJHVpZF0sCiAgICAgIGNsYXNzOiBbXQogICAgfTsKICAgICgwLCBfaHRtbF91dGlscy5zZXRBY2Nlc3MpKHRoaXMsIGF0dHJpYnV0ZXMuY2xhc3MpOwogICAgaWYgKCF0aGlzW19zeW1ib2xfdXRpbHMuJGV4dHJhXSkgewogICAgICB0aGlzW19zeW1ib2xfdXRpbHMuJGV4dHJhXSA9IE9iamVjdC5jcmVhdGUobnVsbCk7CiAgICB9CiAgICBPYmplY3QuYXNzaWduKHRoaXNbX3N5bWJvbF91dGlscy4kZXh0cmFdLCB7CiAgICAgIGNoaWxkcmVuLAogICAgICBsaW5lOiBudWxsLAogICAgICBhdHRyaWJ1dGVzLAogICAgICBhdHRlbXB0OiAwLAogICAgICBudW1iZXJJbkxpbmU6IDAsCiAgICAgIGF2YWlsYWJsZVNwYWNlOiB7CiAgICAgICAgd2lkdGg6IE1hdGgubWluKHRoaXMudyB8fCBJbmZpbml0eSwgYXZhaWxhYmxlU3BhY2Uud2lkdGgpLAogICAgICAgIGhlaWdodDogTWF0aC5taW4odGhpcy5oIHx8IEluZmluaXR5LCBhdmFpbGFibGVTcGFjZS5oZWlnaHQpCiAgICAgIH0sCiAgICAgIHdpZHRoOiAwLAogICAgICBoZWlnaHQ6IDAsCiAgICAgIHByZXZIZWlnaHQ6IDAsCiAgICAgIGN1cnJlbnRXaWR0aDogMAogICAgfSk7CiAgICBjb25zdCByb290ID0gdGhpc1tfc3ltYm9sX3V0aWxzLiRnZXRUZW1wbGF0ZVJvb3RdKCk7CiAgICBjb25zdCBzYXZlZE5vTGF5b3V0RmFpbHVyZSA9IHJvb3RbX3N5bWJvbF91dGlscy4kZXh0cmFdLm5vTGF5b3V0RmFpbHVyZTsKICAgIGNvbnN0IGlzU3BsaXR0YWJsZSA9IHRoaXNbX3N5bWJvbF91dGlscy4kaXNTcGxpdHRhYmxlXSgpOwogICAgaWYgKCFpc1NwbGl0dGFibGUpIHsKICAgICAgc2V0Rmlyc3RVbnNwbGl0dGFibGUodGhpcyk7CiAgICB9CiAgICBpZiAoISgwLCBfbGF5b3V0LmNoZWNrRGltZW5zaW9ucykodGhpcywgYXZhaWxhYmxlU3BhY2UpKSB7CiAgICAgIHJldHVybiBfdXRpbHMuSFRNTFJlc3VsdC5GQUlMVVJFOwogICAgfQogICAgY29uc3QgZmlsdGVyID0gbmV3IFNldChbImFyZWEiLCAiZHJhdyIsICJleGNsR3JvdXAiLCAiZmllbGQiLCAic3ViZm9ybSIsICJzdWJmb3JtU2V0Il0pOwogICAgaWYgKHRoaXMubGF5b3V0LmluY2x1ZGVzKCJyb3ciKSkgewogICAgICBjb25zdCBjb2x1bW5XaWR0aHMgPSB0aGlzW19zeW1ib2xfdXRpbHMuJGdldFN1YmZvcm1QYXJlbnRdKCkuY29sdW1uV2lkdGhzOwogICAgICBpZiAoQXJyYXkuaXNBcnJheShjb2x1bW5XaWR0aHMpICYmIGNvbHVtbldpZHRocy5sZW5ndGggPiAwKSB7CiAgICAgICAgdGhpc1tfc3ltYm9sX3V0aWxzLiRleHRyYV0uY29sdW1uV2lkdGhzID0gY29sdW1uV2lkdGhzOwogICAgICAgIHRoaXNbX3N5bWJvbF91dGlscy4kZXh0cmFdLmN1cnJlbnRDb2x1bW4gPSAwOwogICAgICB9CiAgICB9CiAgICBjb25zdCBzdHlsZSA9ICgwLCBfaHRtbF91dGlscy50b1N0eWxlKSh0aGlzLCAiYW5jaG9yVHlwZSIsICJkaW1lbnNpb25zIiwgInBvc2l0aW9uIiwgInByZXNlbmNlIiwgImJvcmRlciIsICJtYXJnaW4iLCAiaEFsaWduIik7CiAgICBjb25zdCBjbGFzc05hbWVzID0gWyJ4ZmFTdWJmb3JtIl07CiAgICBjb25zdCBjbCA9ICgwLCBfaHRtbF91dGlscy5sYXlvdXRDbGFzcykodGhpcyk7CiAgICBpZiAoY2wpIHsKICAgICAgY2xhc3NOYW1lcy5wdXNoKGNsKTsKICAgIH0KICAgIGF0dHJpYnV0ZXMuc3R5bGUgPSBzdHlsZTsKICAgIGF0dHJpYnV0ZXMuY2xhc3MgPSBjbGFzc05hbWVzOwogICAgaWYgKHRoaXMubmFtZSkgewogICAgICBhdHRyaWJ1dGVzLnhmYU5hbWUgPSB0aGlzLm5hbWU7CiAgICB9CiAgICBpZiAodGhpcy5vdmVyZmxvdykgewogICAgICBjb25zdCBvdmVyZmxvd0V4dHJhID0gdGhpcy5vdmVyZmxvd1tfc3ltYm9sX3V0aWxzLiRnZXRFeHRyYV0oKTsKICAgICAgaWYgKG92ZXJmbG93RXh0cmEuYWRkTGVhZGVyKSB7CiAgICAgICAgb3ZlcmZsb3dFeHRyYS5hZGRMZWFkZXIgPSBmYWxzZTsKICAgICAgICBoYW5kbGVPdmVyZmxvdyh0aGlzLCBvdmVyZmxvd0V4dHJhLmxlYWRlciwgYXZhaWxhYmxlU3BhY2UpOwogICAgICB9CiAgICB9CiAgICB0aGlzW19zeW1ib2xfdXRpbHMuJHB1c2hQYXJhXSgpOwogICAgY29uc3QgaXNMclRiID0gdGhpcy5sYXlvdXQgPT09ICJsci10YiIgfHwgdGhpcy5sYXlvdXQgPT09ICJybC10YiI7CiAgICBjb25zdCBtYXhSdW4gPSBpc0xyVGIgPyBNQVhfQVRURU1QVFNfRk9SX0xSVEJfTEFZT1VUIDogMTsKICAgIGZvciAoOyB0aGlzW19zeW1ib2xfdXRpbHMuJGV4dHJhXS5hdHRlbXB0IDwgbWF4UnVuOyB0aGlzW19zeW1ib2xfdXRpbHMuJGV4dHJhXS5hdHRlbXB0KyspIHsKICAgICAgaWYgKGlzTHJUYiAmJiB0aGlzW19zeW1ib2xfdXRpbHMuJGV4dHJhXS5hdHRlbXB0ID09PSBNQVhfQVRURU1QVFNfRk9SX0xSVEJfTEFZT1VUIC0gMSkgewogICAgICAgIHRoaXNbX3N5bWJvbF91dGlscy4kZXh0cmFdLm51bWJlckluTGluZSA9IDA7CiAgICAgIH0KICAgICAgY29uc3QgcmVzdWx0ID0gdGhpc1tfc3ltYm9sX3V0aWxzLiRjaGlsZHJlblRvSFRNTF0oewogICAgICAgIGZpbHRlciwKICAgICAgICBpbmNsdWRlOiB0cnVlCiAgICAgIH0pOwogICAgICBpZiAocmVzdWx0LnN1Y2Nlc3MpIHsKICAgICAgICBicmVhazsKICAgICAgfQogICAgICBpZiAocmVzdWx0LmlzQnJlYWsoKSkgewogICAgICAgIHRoaXNbX3N5bWJvbF91dGlscy4kcG9wUGFyYV0oKTsKICAgICAgICByZXR1cm4gcmVzdWx0OwogICAgICB9CiAgICAgIGlmIChpc0xyVGIgJiYgdGhpc1tfc3ltYm9sX3V0aWxzLiRleHRyYV0uYXR0ZW1wdCA9PT0gMCAmJiB0aGlzW19zeW1ib2xfdXRpbHMuJGV4dHJhXS5udW1iZXJJbkxpbmUgPT09IDAgJiYgIXJvb3RbX3N5bWJvbF91dGlscy4kZXh0cmFdLm5vTGF5b3V0RmFpbHVyZSkgewogICAgICAgIHRoaXNbX3N5bWJvbF91dGlscy4kZXh0cmFdLmF0dGVtcHQgPSBtYXhSdW47CiAgICAgICAgYnJlYWs7CiAgICAgIH0KICAgIH0KICAgIHRoaXNbX3N5bWJvbF91dGlscy4kcG9wUGFyYV0oKTsKICAgIGlmICghaXNTcGxpdHRhYmxlKSB7CiAgICAgIHVuc2V0Rmlyc3RVbnNwbGl0dGFibGUodGhpcyk7CiAgICB9CiAgICByb290W19zeW1ib2xfdXRpbHMuJGV4dHJhXS5ub0xheW91dEZhaWx1cmUgPSBzYXZlZE5vTGF5b3V0RmFpbHVyZTsKICAgIGlmICh0aGlzW19zeW1ib2xfdXRpbHMuJGV4dHJhXS5hdHRlbXB0ID09PSBtYXhSdW4pIHsKICAgICAgaWYgKHRoaXMub3ZlcmZsb3cpIHsKICAgICAgICB0aGlzW19zeW1ib2xfdXRpbHMuJGdldFRlbXBsYXRlUm9vdF0oKVtfc3ltYm9sX3V0aWxzLiRleHRyYV0ub3ZlcmZsb3dOb2RlID0gdGhpcy5vdmVyZmxvdzsKICAgICAgfQogICAgICBpZiAoIWlzU3BsaXR0YWJsZSkgewogICAgICAgIGRlbGV0ZSB0aGlzW19zeW1ib2xfdXRpbHMuJGV4dHJhXTsKICAgICAgfQogICAgICByZXR1cm4gX3V0aWxzLkhUTUxSZXN1bHQuRkFJTFVSRTsKICAgIH0KICAgIGlmICh0aGlzLm92ZXJmbG93KSB7CiAgICAgIGNvbnN0IG92ZXJmbG93RXh0cmEgPSB0aGlzLm92ZXJmbG93W19zeW1ib2xfdXRpbHMuJGdldEV4dHJhXSgpOwogICAgICBpZiAob3ZlcmZsb3dFeHRyYS5hZGRUcmFpbGVyKSB7CiAgICAgICAgb3ZlcmZsb3dFeHRyYS5hZGRUcmFpbGVyID0gZmFsc2U7CiAgICAgICAgaGFuZGxlT3ZlcmZsb3codGhpcywgb3ZlcmZsb3dFeHRyYS50cmFpbGVyLCBhdmFpbGFibGVTcGFjZSk7CiAgICAgIH0KICAgIH0KICAgIGxldCBtYXJnaW5IID0gMDsKICAgIGxldCBtYXJnaW5WID0gMDsKICAgIGlmICh0aGlzLm1hcmdpbikgewogICAgICBtYXJnaW5IID0gdGhpcy5tYXJnaW4ubGVmdEluc2V0ICsgdGhpcy5tYXJnaW4ucmlnaHRJbnNldDsKICAgICAgbWFyZ2luViA9IHRoaXMubWFyZ2luLnRvcEluc2V0ICsgdGhpcy5tYXJnaW4uYm90dG9tSW5zZXQ7CiAgICB9CiAgICBjb25zdCB3aWR0aCA9IE1hdGgubWF4KHRoaXNbX3N5bWJvbF91dGlscy4kZXh0cmFdLndpZHRoICsgbWFyZ2luSCwgdGhpcy53IHx8IDApOwogICAgY29uc3QgaGVpZ2h0ID0gTWF0aC5tYXgodGhpc1tfc3ltYm9sX3V0aWxzLiRleHRyYV0uaGVpZ2h0ICsgbWFyZ2luViwgdGhpcy5oIHx8IDApOwogICAgY29uc3QgYmJveCA9IFt0aGlzLngsIHRoaXMueSwgd2lkdGgsIGhlaWdodF07CiAgICBpZiAodGhpcy53ID09PSAiIikgewogICAgICBzdHlsZS53aWR0aCA9ICgwLCBfaHRtbF91dGlscy5tZWFzdXJlVG9TdHJpbmcpKHdpZHRoKTsKICAgIH0KICAgIGlmICh0aGlzLmggPT09ICIiKSB7CiAgICAgIHN0eWxlLmhlaWdodCA9ICgwLCBfaHRtbF91dGlscy5tZWFzdXJlVG9TdHJpbmcpKGhlaWdodCk7CiAgICB9CiAgICBpZiAoKHN0eWxlLndpZHRoID09PSAiMHB4IiB8fCBzdHlsZS5oZWlnaHQgPT09ICIwcHgiKSAmJiBjaGlsZHJlbi5sZW5ndGggPT09IDApIHsKICAgICAgcmV0dXJuIF91dGlscy5IVE1MUmVzdWx0LkVNUFRZOwogICAgfQogICAgY29uc3QgaHRtbCA9IHsKICAgICAgbmFtZTogImRpdiIsCiAgICAgIGF0dHJpYnV0ZXMsCiAgICAgIGNoaWxkcmVuCiAgICB9OwogICAgYXBwbHlBc3Npc3QodGhpcywgYXR0cmlidXRlcyk7CiAgICBjb25zdCByZXN1bHQgPSBfdXRpbHMuSFRNTFJlc3VsdC5zdWNjZXNzKCgwLCBfaHRtbF91dGlscy5jcmVhdGVXcmFwcGVyKSh0aGlzLCBodG1sKSwgYmJveCk7CiAgICBpZiAodGhpcy5icmVha0FmdGVyLmNoaWxkcmVuLmxlbmd0aCA+PSAxKSB7CiAgICAgIGNvbnN0IGJyZWFrQWZ0ZXIgPSB0aGlzLmJyZWFrQWZ0ZXIuY2hpbGRyZW5bMF07CiAgICAgIGlmIChoYW5kbGVCcmVhayhicmVha0FmdGVyKSkgewogICAgICAgIHRoaXNbX3N5bWJvbF91dGlscy4kZXh0cmFdLmFmdGVyQnJlYWtBZnRlciA9IHJlc3VsdDsKICAgICAgICByZXR1cm4gX3V0aWxzLkhUTUxSZXN1bHQuYnJlYWtOb2RlKGJyZWFrQWZ0ZXIpOwogICAgICB9CiAgICB9CiAgICBkZWxldGUgdGhpc1tfc3ltYm9sX3V0aWxzLiRleHRyYV07CiAgICByZXR1cm4gcmVzdWx0OwogIH0KfQpjbGFzcyBTdWJmb3JtU2V0IGV4dGVuZHMgX3hmYV9vYmplY3QuWEZBT2JqZWN0IHsKICBjb25zdHJ1Y3RvcihhdHRyaWJ1dGVzKSB7CiAgICBzdXBlcihURU1QTEFURV9OU19JRCwgInN1YmZvcm1TZXQiLCB0cnVlKTsKICAgIHRoaXMuaWQgPSBhdHRyaWJ1dGVzLmlkIHx8ICIiOwogICAgdGhpcy5uYW1lID0gYXR0cmlidXRlcy5uYW1lIHx8ICIiOwogICAgdGhpcy5yZWxhdGlvbiA9ICgwLCBfdXRpbHMuZ2V0U3RyaW5nT3B0aW9uKShhdHRyaWJ1dGVzLnJlbGF0aW9uLCBbIm9yZGVyZWQiLCAiY2hvaWNlIiwgInVub3JkZXJlZCJdKTsKICAgIHRoaXMucmVsZXZhbnQgPSAoMCwgX3V0aWxzLmdldFJlbGV2YW50KShhdHRyaWJ1dGVzLnJlbGV2YW50KTsKICAgIHRoaXMudXNlID0gYXR0cmlidXRlcy51c2UgfHwgIiI7CiAgICB0aGlzLnVzZWhyZWYgPSBhdHRyaWJ1dGVzLnVzZWhyZWYgfHwgIiI7CiAgICB0aGlzLmJvb2tlbmQgPSBudWxsOwogICAgdGhpcy5icmVhayA9IG51bGw7CiAgICB0aGlzLmRlc2MgPSBudWxsOwogICAgdGhpcy5leHRyYXMgPSBudWxsOwogICAgdGhpcy5vY2N1ciA9IG51bGw7CiAgICB0aGlzLm92ZXJmbG93ID0gbnVsbDsKICAgIHRoaXMuYnJlYWtBZnRlciA9IG5ldyBfeGZhX29iamVjdC5YRkFPYmplY3RBcnJheSgpOwogICAgdGhpcy5icmVha0JlZm9yZSA9IG5ldyBfeGZhX29iamVjdC5YRkFPYmplY3RBcnJheSgpOwogICAgdGhpcy5zdWJmb3JtID0gbmV3IF94ZmFfb2JqZWN0LlhGQU9iamVjdEFycmF5KCk7CiAgICB0aGlzLnN1YmZvcm1TZXQgPSBuZXcgX3hmYV9vYmplY3QuWEZBT2JqZWN0QXJyYXkoKTsKICB9CiAgKltfc3ltYm9sX3V0aWxzLiRnZXRDb250YWluZWRDaGlsZHJlbl0oKSB7CiAgICB5aWVsZCogZ2V0Q29udGFpbmVkQ2hpbGRyZW4odGhpcyk7CiAgfQogIFtfc3ltYm9sX3V0aWxzLiRnZXRTdWJmb3JtUGFyZW50XSgpIHsKICAgIGxldCBwYXJlbnQgPSB0aGlzW19zeW1ib2xfdXRpbHMuJGdldFBhcmVudF0oKTsKICAgIHdoaWxlICghKHBhcmVudCBpbnN0YW5jZW9mIFN1YmZvcm0pKSB7CiAgICAgIHBhcmVudCA9IHBhcmVudFtfc3ltYm9sX3V0aWxzLiRnZXRQYXJlbnRdKCk7CiAgICB9CiAgICByZXR1cm4gcGFyZW50OwogIH0KICBbX3N5bWJvbF91dGlscy4kaXNCaW5kYWJsZV0oKSB7CiAgICByZXR1cm4gdHJ1ZTsKICB9Cn0KY2xhc3MgU3ViamVjdEROIGV4dGVuZHMgX3hmYV9vYmplY3QuQ29udGVudE9iamVjdCB7CiAgY29uc3RydWN0b3IoYXR0cmlidXRlcykgewogICAgc3VwZXIoVEVNUExBVEVfTlNfSUQsICJzdWJqZWN0RE4iKTsKICAgIHRoaXMuZGVsaW1pdGVyID0gYXR0cmlidXRlcy5kZWxpbWl0ZXIgfHwgIiwiOwogICAgdGhpcy5pZCA9IGF0dHJpYnV0ZXMuaWQgfHwgIiI7CiAgICB0aGlzLm5hbWUgPSBhdHRyaWJ1dGVzLm5hbWUgfHwgIiI7CiAgICB0aGlzLnVzZSA9IGF0dHJpYnV0ZXMudXNlIHx8ICIiOwogICAgdGhpcy51c2VocmVmID0gYXR0cmlidXRlcy51c2VocmVmIHx8ICIiOwogIH0KICBbX3N5bWJvbF91dGlscy4kZmluYWxpemVdKCkgewogICAgdGhpc1tfc3ltYm9sX3V0aWxzLiRjb250ZW50XSA9IG5ldyBNYXAodGhpc1tfc3ltYm9sX3V0aWxzLiRjb250ZW50XS5zcGxpdCh0aGlzLmRlbGltaXRlcikubWFwKGt2ID0+IHsKICAgICAga3YgPSBrdi5zcGxpdCgiPSIsIDIpOwogICAgICBrdlswXSA9IGt2WzBdLnRyaW0oKTsKICAgICAgcmV0dXJuIGt2OwogICAgfSkpOwogIH0KfQpjbGFzcyBTdWJqZWN0RE5zIGV4dGVuZHMgX3hmYV9vYmplY3QuWEZBT2JqZWN0IHsKICBjb25zdHJ1Y3RvcihhdHRyaWJ1dGVzKSB7CiAgICBzdXBlcihURU1QTEFURV9OU19JRCwgInN1YmplY3RETnMiLCB0cnVlKTsKICAgIHRoaXMuaWQgPSBhdHRyaWJ1dGVzLmlkIHx8ICIiOwogICAgdGhpcy50eXBlID0gKDAsIF91dGlscy5nZXRTdHJpbmdPcHRpb24pKGF0dHJpYnV0ZXMudHlwZSwgWyJvcHRpb25hbCIsICJyZXF1aXJlZCJdKTsKICAgIHRoaXMudXNlID0gYXR0cmlidXRlcy51c2UgfHwgIiI7CiAgICB0aGlzLnVzZWhyZWYgPSBhdHRyaWJ1dGVzLnVzZWhyZWYgfHwgIiI7CiAgICB0aGlzLnN1YmplY3RETiA9IG5ldyBfeGZhX29iamVjdC5YRkFPYmplY3RBcnJheSgpOwogIH0KfQpjbGFzcyBTdWJtaXQgZXh0ZW5kcyBfeGZhX29iamVjdC5YRkFPYmplY3QgewogIGNvbnN0cnVjdG9yKGF0dHJpYnV0ZXMpIHsKICAgIHN1cGVyKFRFTVBMQVRFX05TX0lELCAic3VibWl0IiwgdHJ1ZSk7CiAgICB0aGlzLmVtYmVkUERGID0gKDAsIF91dGlscy5nZXRJbnRlZ2VyKSh7CiAgICAgIGRhdGE6IGF0dHJpYnV0ZXMuZW1iZWRQREYsCiAgICAgIGRlZmF1bHRWYWx1ZTogMCwKICAgICAgdmFsaWRhdGU6IHggPT4geCA9PT0gMQogICAgfSk7CiAgICB0aGlzLmZvcm1hdCA9ICgwLCBfdXRpbHMuZ2V0U3RyaW5nT3B0aW9uKShhdHRyaWJ1dGVzLmZvcm1hdCwgWyJ4ZHAiLCAiZm9ybWRhdGEiLCAicGRmIiwgInVybGVuY29kZWQiLCAieGZkIiwgInhtbCJdKTsKICAgIHRoaXMuaWQgPSBhdHRyaWJ1dGVzLmlkIHx8ICIiOwogICAgdGhpcy50YXJnZXQgPSBhdHRyaWJ1dGVzLnRhcmdldCB8fCAiIjsKICAgIHRoaXMudGV4dEVuY29kaW5nID0gKDAsIF91dGlscy5nZXRLZXl3b3JkKSh7CiAgICAgIGRhdGE6IGF0dHJpYnV0ZXMudGV4dEVuY29kaW5nID8gYXR0cmlidXRlcy50ZXh0RW5jb2RpbmcudG9Mb3dlckNhc2UoKSA6ICIiLAogICAgICBkZWZhdWx0VmFsdWU6ICIiLAogICAgICB2YWxpZGF0ZTogayA9PiBbInV0Zi04IiwgImJpZy1maXZlIiwgImZvbnRzcGVjaWZpYyIsICJnYmsiLCAiZ2ItMTgwMzAiLCAiZ2ItMjMxMiIsICJrc2MtNTYwMSIsICJub25lIiwgInNoaWZ0LWppcyIsICJ1Y3MtMiIsICJ1dGYtMTYiXS5pbmNsdWRlcyhrKSB8fCBrLm1hdGNoKC9pc28tODg1OS1cZHsyfS8pCiAgICB9KTsKICAgIHRoaXMudXNlID0gYXR0cmlidXRlcy51c2UgfHwgIiI7CiAgICB0aGlzLnVzZWhyZWYgPSBhdHRyaWJ1dGVzLnVzZWhyZWYgfHwgIiI7CiAgICB0aGlzLnhkcENvbnRlbnQgPSBhdHRyaWJ1dGVzLnhkcENvbnRlbnQgfHwgIiI7CiAgICB0aGlzLmVuY3J5cHQgPSBudWxsOwogICAgdGhpcy5lbmNyeXB0RGF0YSA9IG5ldyBfeGZhX29iamVjdC5YRkFPYmplY3RBcnJheSgpOwogICAgdGhpcy5zaWduRGF0YSA9IG5ldyBfeGZhX29iamVjdC5YRkFPYmplY3RBcnJheSgpOwogIH0KfQpjbGFzcyBUZW1wbGF0ZSBleHRlbmRzIF94ZmFfb2JqZWN0LlhGQU9iamVjdCB7CiAgY29uc3RydWN0b3IoYXR0cmlidXRlcykgewogICAgc3VwZXIoVEVNUExBVEVfTlNfSUQsICJ0ZW1wbGF0ZSIsIHRydWUpOwogICAgdGhpcy5iYXNlUHJvZmlsZSA9ICgwLCBfdXRpbHMuZ2V0U3RyaW5nT3B0aW9uKShhdHRyaWJ1dGVzLmJhc2VQcm9maWxlLCBbImZ1bGwiLCAiaW50ZXJhY3RpdmVGb3JtcyJdKTsKICAgIHRoaXMuZXh0cmFzID0gbnVsbDsKICAgIHRoaXMuc3ViZm9ybSA9IG5ldyBfeGZhX29iamVjdC5YRkFPYmplY3RBcnJheSgpOwogIH0KICBbX3N5bWJvbF91dGlscy4kZmluYWxpemVdKCkgewogICAgaWYgKHRoaXMuc3ViZm9ybS5jaGlsZHJlbi5sZW5ndGggPT09IDApIHsKICAgICAgKDAsIF91dGlsLndhcm4pKCJYRkEgLSBObyBzdWJmb3JtcyBpbiB0ZW1wbGF0ZSBub2RlLiIpOwogICAgfQogICAgaWYgKHRoaXMuc3ViZm9ybS5jaGlsZHJlbi5sZW5ndGggPj0gMikgewogICAgICAoMCwgX3V0aWwud2FybikoIlhGQSAtIFNldmVyYWwgc3ViZm9ybXMgaW4gdGVtcGxhdGUgbm9kZTogcGxlYXNlIGZpbGUgYSBidWcuIik7CiAgICB9CiAgICB0aGlzW19zeW1ib2xfdXRpbHMuJHRhYkluZGV4XSA9IERFRkFVTFRfVEFCX0lOREVYOwogIH0KICBbX3N5bWJvbF91dGlscy4kaXNTcGxpdHRhYmxlXSgpIHsKICAgIHJldHVybiB0cnVlOwogIH0KICBbX3N5bWJvbF91dGlscy4kc2VhcmNoTm9kZV0oZXhwciwgY29udGFpbmVyKSB7CiAgICBpZiAoZXhwci5zdGFydHNXaXRoKCIjIikpIHsKICAgICAgcmV0dXJuIFt0aGlzW19zeW1ib2xfdXRpbHMuJGlkc10uZ2V0KGV4cHIuc2xpY2UoMSkpXTsKICAgIH0KICAgIHJldHVybiAoMCwgX3NvbS5zZWFyY2hOb2RlKSh0aGlzLCBjb250YWluZXIsIGV4cHIsIHRydWUsIHRydWUpOwogIH0KICAqW19zeW1ib2xfdXRpbHMuJHRvUGFnZXNdKCkgewogICAgaWYgKCF0aGlzLnN1YmZvcm0uY2hpbGRyZW4ubGVuZ3RoKSB7CiAgICAgIHJldHVybiBfdXRpbHMuSFRNTFJlc3VsdC5zdWNjZXNzKHsKICAgICAgICBuYW1lOiAiZGl2IiwKICAgICAgICBjaGlsZHJlbjogW10KICAgICAgfSk7CiAgICB9CiAgICB0aGlzW19zeW1ib2xfdXRpbHMuJGV4dHJhXSA9IHsKICAgICAgb3ZlcmZsb3dOb2RlOiBudWxsLAogICAgICBmaXJzdFVuc3BsaXR0YWJsZTogbnVsbCwKICAgICAgY3VycmVudENvbnRlbnRBcmVhOiBudWxsLAogICAgICBjdXJyZW50UGFnZUFyZWE6IG51bGwsCiAgICAgIG5vTGF5b3V0RmFpbHVyZTogZmFsc2UsCiAgICAgIHBhZ2VOdW1iZXI6IDEsCiAgICAgIHBhZ2VQb3NpdGlvbjogImZpcnN0IiwKICAgICAgb2RkT3JFdmVuOiAib2RkIiwKICAgICAgYmxhbmtPck5vdEJsYW5rOiAibm9uQmxhbmsiLAogICAgICBwYXJhU3RhY2s6IFtdCiAgICB9OwogICAgY29uc3Qgcm9vdCA9IHRoaXMuc3ViZm9ybS5jaGlsZHJlblswXTsKICAgIHJvb3QucGFnZVNldFtfc3ltYm9sX3V0aWxzLiRjbGVhblBhZ2VdKCk7CiAgICBjb25zdCBwYWdlQXJlYXMgPSByb290LnBhZ2VTZXQucGFnZUFyZWEuY2hpbGRyZW47CiAgICBjb25zdCBtYWluSHRtbCA9IHsKICAgICAgbmFtZTogImRpdiIsCiAgICAgIGNoaWxkcmVuOiBbXQogICAgfTsKICAgIGxldCBwYWdlQXJlYSA9IG51bGw7CiAgICBsZXQgYnJlYWtCZWZvcmUgPSBudWxsOwogICAgbGV0IGJyZWFrQmVmb3JlVGFyZ2V0ID0gbnVsbDsKICAgIGlmIChyb290LmJyZWFrQmVmb3JlLmNoaWxkcmVuLmxlbmd0aCA+PSAxKSB7CiAgICAgIGJyZWFrQmVmb3JlID0gcm9vdC5icmVha0JlZm9yZS5jaGlsZHJlblswXTsKICAgICAgYnJlYWtCZWZvcmVUYXJnZXQgPSBicmVha0JlZm9yZS50YXJnZXQ7CiAgICB9IGVsc2UgaWYgKHJvb3Quc3ViZm9ybS5jaGlsZHJlbi5sZW5ndGggPj0gMSAmJiByb290LnN1YmZvcm0uY2hpbGRyZW5bMF0uYnJlYWtCZWZvcmUuY2hpbGRyZW4ubGVuZ3RoID49IDEpIHsKICAgICAgYnJlYWtCZWZvcmUgPSByb290LnN1YmZvcm0uY2hpbGRyZW5bMF0uYnJlYWtCZWZvcmUuY2hpbGRyZW5bMF07CiAgICAgIGJyZWFrQmVmb3JlVGFyZ2V0ID0gYnJlYWtCZWZvcmUudGFyZ2V0OwogICAgfSBlbHNlIGlmIChyb290LmJyZWFrPy5iZWZvcmVUYXJnZXQpIHsKICAgICAgYnJlYWtCZWZvcmUgPSByb290LmJyZWFrOwogICAgICBicmVha0JlZm9yZVRhcmdldCA9IGJyZWFrQmVmb3JlLmJlZm9yZVRhcmdldDsKICAgIH0gZWxzZSBpZiAocm9vdC5zdWJmb3JtLmNoaWxkcmVuLmxlbmd0aCA+PSAxICYmIHJvb3Quc3ViZm9ybS5jaGlsZHJlblswXS5icmVhaz8uYmVmb3JlVGFyZ2V0KSB7CiAgICAgIGJyZWFrQmVmb3JlID0gcm9vdC5zdWJmb3JtLmNoaWxkcmVuWzBdLmJyZWFrOwogICAgICBicmVha0JlZm9yZVRhcmdldCA9IGJyZWFrQmVmb3JlLmJlZm9yZVRhcmdldDsKICAgIH0KICAgIGlmIChicmVha0JlZm9yZSkgewogICAgICBjb25zdCB0YXJnZXQgPSB0aGlzW19zeW1ib2xfdXRpbHMuJHNlYXJjaE5vZGVdKGJyZWFrQmVmb3JlVGFyZ2V0LCBicmVha0JlZm9yZVtfc3ltYm9sX3V0aWxzLiRnZXRQYXJlbnRdKCkpOwogICAgICBpZiAodGFyZ2V0IGluc3RhbmNlb2YgUGFnZUFyZWEpIHsKICAgICAgICBwYWdlQXJlYSA9IHRhcmdldDsKICAgICAgICBicmVha0JlZm9yZVtfc3ltYm9sX3V0aWxzLiRleHRyYV0gPSB7fTsKICAgICAgfQogICAgfQogICAgaWYgKCFwYWdlQXJlYSkgewogICAgICBwYWdlQXJlYSA9IHBhZ2VBcmVhc1swXTsKICAgIH0KICAgIHBhZ2VBcmVhW19zeW1ib2xfdXRpbHMuJGV4dHJhXSA9IHsKICAgICAgbnVtYmVyT2ZVc2U6IDEKICAgIH07CiAgICBjb25zdCBwYWdlQXJlYVBhcmVudCA9IHBhZ2VBcmVhW19zeW1ib2xfdXRpbHMuJGdldFBhcmVudF0oKTsKICAgIHBhZ2VBcmVhUGFyZW50W19zeW1ib2xfdXRpbHMuJGV4dHJhXSA9IHsKICAgICAgbnVtYmVyT2ZVc2U6IDEsCiAgICAgIHBhZ2VJbmRleDogcGFnZUFyZWFQYXJlbnQucGFnZUFyZWEuY2hpbGRyZW4uaW5kZXhPZihwYWdlQXJlYSksCiAgICAgIHBhZ2VTZXRJbmRleDogMAogICAgfTsKICAgIGxldCB0YXJnZXRQYWdlQXJlYTsKICAgIGxldCBsZWFkZXIgPSBudWxsOwogICAgbGV0IHRyYWlsZXIgPSBudWxsOwogICAgbGV0IGhhc1NvbWV0aGluZyA9IHRydWU7CiAgICBsZXQgaGFzU29tZXRoaW5nQ291bnRlciA9IDA7CiAgICBsZXQgc3RhcnRJbmRleCA9IDA7CiAgICB3aGlsZSAodHJ1ZSkgewogICAgICBpZiAoIWhhc1NvbWV0aGluZykgewogICAgICAgIG1haW5IdG1sLmNoaWxkcmVuLnBvcCgpOwogICAgICAgIGlmICgrK2hhc1NvbWV0aGluZ0NvdW50ZXIgPT09IE1BWF9FTVBUWV9QQUdFUykgewogICAgICAgICAgKDAsIF91dGlsLndhcm4pKCJYRkEgLSBTb21ldGhpbmcgZ29lcyB3cm9uZzogcGxlYXNlIGZpbGUgYSBidWcuIik7CiAgICAgICAgICByZXR1cm4gbWFpbkh0bWw7CiAgICAgICAgfQogICAgICB9IGVsc2UgewogICAgICAgIGhhc1NvbWV0aGluZ0NvdW50ZXIgPSAwOwogICAgICB9CiAgICAgIHRhcmdldFBhZ2VBcmVhID0gbnVsbDsKICAgICAgdGhpc1tfc3ltYm9sX3V0aWxzLiRleHRyYV0uY3VycmVudFBhZ2VBcmVhID0gcGFnZUFyZWE7CiAgICAgIGNvbnN0IHBhZ2UgPSBwYWdlQXJlYVtfc3ltYm9sX3V0aWxzLiR0b0hUTUxdKCkuaHRtbDsKICAgICAgbWFpbkh0bWwuY2hpbGRyZW4ucHVzaChwYWdlKTsKICAgICAgaWYgKGxlYWRlcikgewogICAgICAgIHRoaXNbX3N5bWJvbF91dGlscy4kZXh0cmFdLm5vTGF5b3V0RmFpbHVyZSA9IHRydWU7CiAgICAgICAgcGFnZS5jaGlsZHJlbi5wdXNoKGxlYWRlcltfc3ltYm9sX3V0aWxzLiR0b0hUTUxdKHBhZ2VBcmVhW19zeW1ib2xfdXRpbHMuJGV4dHJhXS5zcGFjZSkuaHRtbCk7CiAgICAgICAgbGVhZGVyID0gbnVsbDsKICAgICAgfQogICAgICBpZiAodHJhaWxlcikgewogICAgICAgIHRoaXNbX3N5bWJvbF91dGlscy4kZXh0cmFdLm5vTGF5b3V0RmFpbHVyZSA9IHRydWU7CiAgICAgICAgcGFnZS5jaGlsZHJlbi5wdXNoKHRyYWlsZXJbX3N5bWJvbF91dGlscy4kdG9IVE1MXShwYWdlQXJlYVtfc3ltYm9sX3V0aWxzLiRleHRyYV0uc3BhY2UpLmh0bWwpOwogICAgICAgIHRyYWlsZXIgPSBudWxsOwogICAgICB9CiAgICAgIGNvbnN0IGNvbnRlbnRBcmVhcyA9IHBhZ2VBcmVhLmNvbnRlbnRBcmVhLmNoaWxkcmVuOwogICAgICBjb25zdCBodG1sQ29udGVudEFyZWFzID0gcGFnZS5jaGlsZHJlbi5maWx0ZXIobm9kZSA9PiBub2RlLmF0dHJpYnV0ZXMuY2xhc3MuaW5jbHVkZXMoInhmYUNvbnRlbnRhcmVhIikpOwogICAgICBoYXNTb21ldGhpbmcgPSBmYWxzZTsKICAgICAgdGhpc1tfc3ltYm9sX3V0aWxzLiRleHRyYV0uZmlyc3RVbnNwbGl0dGFibGUgPSBudWxsOwogICAgICB0aGlzW19zeW1ib2xfdXRpbHMuJGV4dHJhXS5ub0xheW91dEZhaWx1cmUgPSBmYWxzZTsKICAgICAgY29uc3QgZmx1c2ggPSBpbmRleCA9PiB7CiAgICAgICAgY29uc3QgaHRtbCA9IHJvb3RbX3N5bWJvbF91dGlscy4kZmx1c2hIVE1MXSgpOwogICAgICAgIGlmIChodG1sKSB7CiAgICAgICAgICBoYXNTb21ldGhpbmcgfHw9IGh0bWwuY2hpbGRyZW4/Lmxlbmd0aCA+IDA7CiAgICAgICAgICBodG1sQ29udGVudEFyZWFzW2luZGV4XS5jaGlsZHJlbi5wdXNoKGh0bWwpOwogICAgICAgIH0KICAgICAgfTsKICAgICAgZm9yIChsZXQgaSA9IHN0YXJ0SW5kZXgsIGlpID0gY29udGVudEFyZWFzLmxlbmd0aDsgaSA8IGlpOyBpKyspIHsKICAgICAgICBjb25zdCBjb250ZW50QXJlYSA9IHRoaXNbX3N5bWJvbF91dGlscy4kZXh0cmFdLmN1cnJlbnRDb250ZW50QXJlYSA9IGNvbnRlbnRBcmVhc1tpXTsKICAgICAgICBjb25zdCBzcGFjZSA9IHsKICAgICAgICAgIHdpZHRoOiBjb250ZW50QXJlYS53LAogICAgICAgICAgaGVpZ2h0OiBjb250ZW50QXJlYS5oCiAgICAgICAgfTsKICAgICAgICBzdGFydEluZGV4ID0gMDsKICAgICAgICBpZiAobGVhZGVyKSB7CiAgICAgICAgICBodG1sQ29udGVudEFyZWFzW2ldLmNoaWxkcmVuLnB1c2gobGVhZGVyW19zeW1ib2xfdXRpbHMuJHRvSFRNTF0oc3BhY2UpLmh0bWwpOwogICAgICAgICAgbGVhZGVyID0gbnVsbDsKICAgICAgICB9CiAgICAgICAgaWYgKHRyYWlsZXIpIHsKICAgICAgICAgIGh0bWxDb250ZW50QXJlYXNbaV0uY2hpbGRyZW4ucHVzaCh0cmFpbGVyW19zeW1ib2xfdXRpbHMuJHRvSFRNTF0oc3BhY2UpLmh0bWwpOwogICAgICAgICAgdHJhaWxlciA9IG51bGw7CiAgICAgICAgfQogICAgICAgIGNvbnN0IGh0bWwgPSByb290W19zeW1ib2xfdXRpbHMuJHRvSFRNTF0oc3BhY2UpOwogICAgICAgIGlmIChodG1sLnN1Y2Nlc3MpIHsKICAgICAgICAgIGlmIChodG1sLmh0bWwpIHsKICAgICAgICAgICAgaGFzU29tZXRoaW5nIHx8PSBodG1sLmh0bWwuY2hpbGRyZW4/Lmxlbmd0aCA+IDA7CiAgICAgICAgICAgIGh0bWxDb250ZW50QXJlYXNbaV0uY2hpbGRyZW4ucHVzaChodG1sLmh0bWwpOwogICAgICAgICAgfSBlbHNlIGlmICghaGFzU29tZXRoaW5nICYmIG1haW5IdG1sLmNoaWxkcmVuLmxlbmd0aCA+IDEpIHsKICAgICAgICAgICAgbWFpbkh0bWwuY2hpbGRyZW4ucG9wKCk7CiAgICAgICAgICB9CiAgICAgICAgICByZXR1cm4gbWFpbkh0bWw7CiAgICAgICAgfQogICAgICAgIGlmIChodG1sLmlzQnJlYWsoKSkgewogICAgICAgICAgY29uc3Qgbm9kZSA9IGh0bWwuYnJlYWtOb2RlOwogICAgICAgICAgZmx1c2goaSk7CiAgICAgICAgICBpZiAobm9kZS50YXJnZXRUeXBlID09PSAiYXV0byIpIHsKICAgICAgICAgICAgY29udGludWU7CiAgICAgICAgICB9CiAgICAgICAgICBpZiAobm9kZS5sZWFkZXIpIHsKICAgICAgICAgICAgbGVhZGVyID0gdGhpc1tfc3ltYm9sX3V0aWxzLiRzZWFyY2hOb2RlXShub2RlLmxlYWRlciwgbm9kZVtfc3ltYm9sX3V0aWxzLiRnZXRQYXJlbnRdKCkpOwogICAgICAgICAgICBsZWFkZXIgPSBsZWFkZXIgPyBsZWFkZXJbMF0gOiBudWxsOwogICAgICAgICAgfQogICAgICAgICAgaWYgKG5vZGUudHJhaWxlcikgewogICAgICAgICAgICB0cmFpbGVyID0gdGhpc1tfc3ltYm9sX3V0aWxzLiRzZWFyY2hOb2RlXShub2RlLnRyYWlsZXIsIG5vZGVbX3N5bWJvbF91dGlscy4kZ2V0UGFyZW50XSgpKTsKICAgICAgICAgICAgdHJhaWxlciA9IHRyYWlsZXIgPyB0cmFpbGVyWzBdIDogbnVsbDsKICAgICAgICAgIH0KICAgICAgICAgIGlmIChub2RlLnRhcmdldFR5cGUgPT09ICJwYWdlQXJlYSIpIHsKICAgICAgICAgICAgdGFyZ2V0UGFnZUFyZWEgPSBub2RlW19zeW1ib2xfdXRpbHMuJGV4dHJhXS50YXJnZXQ7CiAgICAgICAgICAgIGkgPSBJbmZpbml0eTsKICAgICAgICAgIH0gZWxzZSBpZiAoIW5vZGVbX3N5bWJvbF91dGlscy4kZXh0cmFdLnRhcmdldCkgewogICAgICAgICAgICBpID0gbm9kZVtfc3ltYm9sX3V0aWxzLiRleHRyYV0uaW5kZXg7CiAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICB0YXJnZXRQYWdlQXJlYSA9IG5vZGVbX3N5bWJvbF91dGlscy4kZXh0cmFdLnRhcmdldDsKICAgICAgICAgICAgc3RhcnRJbmRleCA9IG5vZGVbX3N5bWJvbF91dGlscy4kZXh0cmFdLmluZGV4ICsgMTsKICAgICAgICAgICAgaSA9IEluZmluaXR5OwogICAgICAgICAgfQogICAgICAgICAgY29udGludWU7CiAgICAgICAgfQogICAgICAgIGlmICh0aGlzW19zeW1ib2xfdXRpbHMuJGV4dHJhXS5vdmVyZmxvd05vZGUpIHsKICAgICAgICAgIGNvbnN0IG5vZGUgPSB0aGlzW19zeW1ib2xfdXRpbHMuJGV4dHJhXS5vdmVyZmxvd05vZGU7CiAgICAgICAgICB0aGlzW19zeW1ib2xfdXRpbHMuJGV4dHJhXS5vdmVyZmxvd05vZGUgPSBudWxsOwogICAgICAgICAgY29uc3Qgb3ZlcmZsb3dFeHRyYSA9IG5vZGVbX3N5bWJvbF91dGlscy4kZ2V0RXh0cmFdKCk7CiAgICAgICAgICBjb25zdCB0YXJnZXQgPSBvdmVyZmxvd0V4dHJhLnRhcmdldDsKICAgICAgICAgIG92ZXJmbG93RXh0cmEuYWRkTGVhZGVyID0gb3ZlcmZsb3dFeHRyYS5sZWFkZXIgIT09IG51bGw7CiAgICAgICAgICBvdmVyZmxvd0V4dHJhLmFkZFRyYWlsZXIgPSBvdmVyZmxvd0V4dHJhLnRyYWlsZXIgIT09IG51bGw7CiAgICAgICAgICBmbHVzaChpKTsKICAgICAgICAgIGNvbnN0IGN1cnJlbnRJbmRleCA9IGk7CiAgICAgICAgICBpID0gSW5maW5pdHk7CiAgICAgICAgICBpZiAodGFyZ2V0IGluc3RhbmNlb2YgUGFnZUFyZWEpIHsKICAgICAgICAgICAgdGFyZ2V0UGFnZUFyZWEgPSB0YXJnZXQ7CiAgICAgICAgICB9IGVsc2UgaWYgKHRhcmdldCBpbnN0YW5jZW9mIENvbnRlbnRBcmVhKSB7CiAgICAgICAgICAgIGNvbnN0IGluZGV4ID0gY29udGVudEFyZWFzLmluZGV4T2YodGFyZ2V0KTsKICAgICAgICAgICAgaWYgKGluZGV4ICE9PSAtMSkgewogICAgICAgICAgICAgIGlmIChpbmRleCA+IGN1cnJlbnRJbmRleCkgewogICAgICAgICAgICAgICAgaSA9IGluZGV4IC0gMTsKICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgc3RhcnRJbmRleCA9IGluZGV4OwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICB0YXJnZXRQYWdlQXJlYSA9IHRhcmdldFtfc3ltYm9sX3V0aWxzLiRnZXRQYXJlbnRdKCk7CiAgICAgICAgICAgICAgc3RhcnRJbmRleCA9IHRhcmdldFBhZ2VBcmVhLmNvbnRlbnRBcmVhLmNoaWxkcmVuLmluZGV4T2YodGFyZ2V0KTsKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgICAgY29udGludWU7CiAgICAgICAgfQogICAgICAgIGZsdXNoKGkpOwogICAgICB9CiAgICAgIHRoaXNbX3N5bWJvbF91dGlscy4kZXh0cmFdLnBhZ2VOdW1iZXIgKz0gMTsKICAgICAgaWYgKHRhcmdldFBhZ2VBcmVhKSB7CiAgICAgICAgaWYgKHRhcmdldFBhZ2VBcmVhW19zeW1ib2xfdXRpbHMuJGlzVXNhYmxlXSgpKSB7CiAgICAgICAgICB0YXJnZXRQYWdlQXJlYVtfc3ltYm9sX3V0aWxzLiRleHRyYV0ubnVtYmVyT2ZVc2UgKz0gMTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgdGFyZ2V0UGFnZUFyZWEgPSBudWxsOwogICAgICAgIH0KICAgICAgfQogICAgICBwYWdlQXJlYSA9IHRhcmdldFBhZ2VBcmVhIHx8IHBhZ2VBcmVhW19zeW1ib2xfdXRpbHMuJGdldE5leHRQYWdlXSgpOwogICAgICB5aWVsZCBudWxsOwogICAgfQogIH0KfQpleHBvcnRzLlRlbXBsYXRlID0gVGVtcGxhdGU7CmNsYXNzIFRleHQgZXh0ZW5kcyBfeGZhX29iamVjdC5Db250ZW50T2JqZWN0IHsKICBjb25zdHJ1Y3RvcihhdHRyaWJ1dGVzKSB7CiAgICBzdXBlcihURU1QTEFURV9OU19JRCwgInRleHQiKTsKICAgIHRoaXMuaWQgPSBhdHRyaWJ1dGVzLmlkIHx8ICIiOwogICAgdGhpcy5tYXhDaGFycyA9ICgwLCBfdXRpbHMuZ2V0SW50ZWdlcikoewogICAgICBkYXRhOiBhdHRyaWJ1dGVzLm1heENoYXJzLAogICAgICBkZWZhdWx0VmFsdWU6IDAsCiAgICAgIHZhbGlkYXRlOiB4ID0+IHggPj0gMAogICAgfSk7CiAgICB0aGlzLm5hbWUgPSBhdHRyaWJ1dGVzLm5hbWUgfHwgIiI7CiAgICB0aGlzLnJpZCA9IGF0dHJpYnV0ZXMucmlkIHx8ICIiOwogICAgdGhpcy51c2UgPSBhdHRyaWJ1dGVzLnVzZSB8fCAiIjsKICAgIHRoaXMudXNlaHJlZiA9IGF0dHJpYnV0ZXMudXNlaHJlZiB8fCAiIjsKICB9CiAgW19zeW1ib2xfdXRpbHMuJGFjY2VwdFdoaXRlc3BhY2VdKCkgewogICAgcmV0dXJuIHRydWU7CiAgfQogIFtfc3ltYm9sX3V0aWxzLiRvbkNoaWxkXShjaGlsZCkgewogICAgaWYgKGNoaWxkW19zeW1ib2xfdXRpbHMuJG5hbWVzcGFjZUlkXSA9PT0gX25hbWVzcGFjZXMuTmFtZXNwYWNlSWRzLnhodG1sLmlkKSB7CiAgICAgIHRoaXNbX3N5bWJvbF91dGlscy4kY29udGVudF0gPSBjaGlsZDsKICAgICAgcmV0dXJuIHRydWU7CiAgICB9CiAgICAoMCwgX3V0aWwud2FybikoYFhGQSAtIEludmFsaWQgY29udGVudCBpbiBUZXh0OiAke2NoaWxkW19zeW1ib2xfdXRpbHMuJG5vZGVOYW1lXX0uYCk7CiAgICByZXR1cm4gZmFsc2U7CiAgfQogIFtfc3ltYm9sX3V0aWxzLiRvblRleHRdKHN0cikgewogICAgaWYgKHRoaXNbX3N5bWJvbF91dGlscy4kY29udGVudF0gaW5zdGFuY2VvZiBfeGZhX29iamVjdC5YRkFPYmplY3QpIHsKICAgICAgcmV0dXJuOwogICAgfQogICAgc3VwZXJbX3N5bWJvbF91dGlscy4kb25UZXh0XShzdHIpOwogIH0KICBbX3N5bWJvbF91dGlscy4kZmluYWxpemVdKCkgewogICAgaWYgKHR5cGVvZiB0aGlzW19zeW1ib2xfdXRpbHMuJGNvbnRlbnRdID09PSAic3RyaW5nIikgewogICAgICB0aGlzW19zeW1ib2xfdXRpbHMuJGNvbnRlbnRdID0gdGhpc1tfc3ltYm9sX3V0aWxzLiRjb250ZW50XS5yZXBsYWNlQWxsKCJcclxuIiwgIlxuIik7CiAgICB9CiAgfQogIFtfc3ltYm9sX3V0aWxzLiRnZXRFeHRyYV0oKSB7CiAgICBpZiAodHlwZW9mIHRoaXNbX3N5bWJvbF91dGlscy4kY29udGVudF0gPT09ICJzdHJpbmciKSB7CiAgICAgIHJldHVybiB0aGlzW19zeW1ib2xfdXRpbHMuJGNvbnRlbnRdLnNwbGl0KC9bXHUyMDI5XHUyMDI4XG5dLykucmVkdWNlKChhY2MsIGxpbmUpID0+IHsKICAgICAgICBpZiAobGluZSkgewogICAgICAgICAgYWNjLnB1c2gobGluZSk7CiAgICAgICAgfQogICAgICAgIHJldHVybiBhY2M7CiAgICAgIH0sIFtdKS5qb2luKCJcbiIpOwogICAgfQogICAgcmV0dXJuIHRoaXNbX3N5bWJvbF91dGlscy4kY29udGVudF1bX3N5bWJvbF91dGlscy4kdGV4dF0oKTsKICB9CiAgW19zeW1ib2xfdXRpbHMuJHRvSFRNTF0oYXZhaWxhYmxlU3BhY2UpIHsKICAgIGlmICh0eXBlb2YgdGhpc1tfc3ltYm9sX3V0aWxzLiRjb250ZW50XSA9PT0gInN0cmluZyIpIHsKICAgICAgY29uc3QgaHRtbCA9IHZhbHVlVG9IdG1sKHRoaXNbX3N5bWJvbF91dGlscy4kY29udGVudF0pLmh0bWw7CiAgICAgIGlmICh0aGlzW19zeW1ib2xfdXRpbHMuJGNvbnRlbnRdLmluY2x1ZGVzKCJcdTIwMjkiKSkgewogICAgICAgIGh0bWwubmFtZSA9ICJkaXYiOwogICAgICAgIGh0bWwuY2hpbGRyZW4gPSBbXTsKICAgICAgICB0aGlzW19zeW1ib2xfdXRpbHMuJGNvbnRlbnRdLnNwbGl0KCJcdTIwMjkiKS5tYXAocGFyYSA9PiBwYXJhLnNwbGl0KC9bXHUyMDI4XG5dLykucmVkdWNlKChhY2MsIGxpbmUpID0+IHsKICAgICAgICAgIGFjYy5wdXNoKHsKICAgICAgICAgICAgbmFtZTogInNwYW4iLAogICAgICAgICAgICB2YWx1ZTogbGluZQogICAgICAgICAgfSwgewogICAgICAgICAgICBuYW1lOiAiYnIiCiAgICAgICAgICB9KTsKICAgICAgICAgIHJldHVybiBhY2M7CiAgICAgICAgfSwgW10pKS5mb3JFYWNoKGxpbmVzID0+IHsKICAgICAgICAgIGh0bWwuY2hpbGRyZW4ucHVzaCh7CiAgICAgICAgICAgIG5hbWU6ICJwIiwKICAgICAgICAgICAgY2hpbGRyZW46IGxpbmVzCiAgICAgICAgICB9KTsKICAgICAgICB9KTsKICAgICAgfSBlbHNlIGlmICgvW1x1MjAyOFxuXS8udGVzdCh0aGlzW19zeW1ib2xfdXRpbHMuJGNvbnRlbnRdKSkgewogICAgICAgIGh0bWwubmFtZSA9ICJkaXYiOwogICAgICAgIGh0bWwuY2hpbGRyZW4gPSBbXTsKICAgICAgICB0aGlzW19zeW1ib2xfdXRpbHMuJGNvbnRlbnRdLnNwbGl0KC9bXHUyMDI4XG5dLykuZm9yRWFjaChsaW5lID0+IHsKICAgICAgICAgIGh0bWwuY2hpbGRyZW4ucHVzaCh7CiAgICAgICAgICAgIG5hbWU6ICJzcGFuIiwKICAgICAgICAgICAgdmFsdWU6IGxpbmUKICAgICAgICAgIH0sIHsKICAgICAgICAgICAgbmFtZTogImJyIgogICAgICAgICAgfSk7CiAgICAgICAgfSk7CiAgICAgIH0KICAgICAgcmV0dXJuIF91dGlscy5IVE1MUmVzdWx0LnN1Y2Nlc3MoaHRtbCk7CiAgICB9CiAgICByZXR1cm4gdGhpc1tfc3ltYm9sX3V0aWxzLiRjb250ZW50XVtfc3ltYm9sX3V0aWxzLiR0b0hUTUxdKGF2YWlsYWJsZVNwYWNlKTsKICB9Cn0KZXhwb3J0cy5UZXh0ID0gVGV4dDsKY2xhc3MgVGV4dEVkaXQgZXh0ZW5kcyBfeGZhX29iamVjdC5YRkFPYmplY3QgewogIGNvbnN0cnVjdG9yKGF0dHJpYnV0ZXMpIHsKICAgIHN1cGVyKFRFTVBMQVRFX05TX0lELCAidGV4dEVkaXQiLCB0cnVlKTsKICAgIHRoaXMuYWxsb3dSaWNoVGV4dCA9ICgwLCBfdXRpbHMuZ2V0SW50ZWdlcikoewogICAgICBkYXRhOiBhdHRyaWJ1dGVzLmFsbG93UmljaFRleHQsCiAgICAgIGRlZmF1bHRWYWx1ZTogMCwKICAgICAgdmFsaWRhdGU6IHggPT4geCA9PT0gMQogICAgfSk7CiAgICB0aGlzLmhTY3JvbGxQb2xpY3kgPSAoMCwgX3V0aWxzLmdldFN0cmluZ09wdGlvbikoYXR0cmlidXRlcy5oU2Nyb2xsUG9saWN5LCBbImF1dG8iLCAib2ZmIiwgIm9uIl0pOwogICAgdGhpcy5pZCA9IGF0dHJpYnV0ZXMuaWQgfHwgIiI7CiAgICB0aGlzLm11bHRpTGluZSA9ICgwLCBfdXRpbHMuZ2V0SW50ZWdlcikoewogICAgICBkYXRhOiBhdHRyaWJ1dGVzLm11bHRpTGluZSwKICAgICAgZGVmYXVsdFZhbHVlOiAiIiwKICAgICAgdmFsaWRhdGU6IHggPT4geCA9PT0gMCB8fCB4ID09PSAxCiAgICB9KTsKICAgIHRoaXMudXNlID0gYXR0cmlidXRlcy51c2UgfHwgIiI7CiAgICB0aGlzLnVzZWhyZWYgPSBhdHRyaWJ1dGVzLnVzZWhyZWYgfHwgIiI7CiAgICB0aGlzLnZTY3JvbGxQb2xpY3kgPSAoMCwgX3V0aWxzLmdldFN0cmluZ09wdGlvbikoYXR0cmlidXRlcy52U2Nyb2xsUG9saWN5LCBbImF1dG8iLCAib2ZmIiwgIm9uIl0pOwogICAgdGhpcy5ib3JkZXIgPSBudWxsOwogICAgdGhpcy5jb21iID0gbnVsbDsKICAgIHRoaXMuZXh0cmFzID0gbnVsbDsKICAgIHRoaXMubWFyZ2luID0gbnVsbDsKICB9CiAgW19zeW1ib2xfdXRpbHMuJHRvSFRNTF0oYXZhaWxhYmxlU3BhY2UpIHsKICAgIGNvbnN0IHN0eWxlID0gKDAsIF9odG1sX3V0aWxzLnRvU3R5bGUpKHRoaXMsICJib3JkZXIiLCAiZm9udCIsICJtYXJnaW4iKTsKICAgIGxldCBodG1sOwogICAgY29uc3QgZmllbGQgPSB0aGlzW19zeW1ib2xfdXRpbHMuJGdldFBhcmVudF0oKVtfc3ltYm9sX3V0aWxzLiRnZXRQYXJlbnRdKCk7CiAgICBpZiAodGhpcy5tdWx0aUxpbmUgPT09ICIiKSB7CiAgICAgIHRoaXMubXVsdGlMaW5lID0gZmllbGQgaW5zdGFuY2VvZiBEcmF3ID8gMSA6IDA7CiAgICB9CiAgICBpZiAodGhpcy5tdWx0aUxpbmUgPT09IDEpIHsKICAgICAgaHRtbCA9IHsKICAgICAgICBuYW1lOiAidGV4dGFyZWEiLAogICAgICAgIGF0dHJpYnV0ZXM6IHsKICAgICAgICAgIGRhdGFJZDogZmllbGRbX3N5bWJvbF91dGlscy4kZGF0YV0/Lltfc3ltYm9sX3V0aWxzLiR1aWRdIHx8IGZpZWxkW19zeW1ib2xfdXRpbHMuJHVpZF0sCiAgICAgICAgICBmaWVsZElkOiBmaWVsZFtfc3ltYm9sX3V0aWxzLiR1aWRdLAogICAgICAgICAgY2xhc3M6IFsieGZhVGV4dGZpZWxkIl0sCiAgICAgICAgICBzdHlsZSwKICAgICAgICAgICJhcmlhLWxhYmVsIjogYXJpYUxhYmVsKGZpZWxkKSwKICAgICAgICAgICJhcmlhLXJlcXVpcmVkIjogZmFsc2UKICAgICAgICB9CiAgICAgIH07CiAgICB9IGVsc2UgewogICAgICBodG1sID0gewogICAgICAgIG5hbWU6ICJpbnB1dCIsCiAgICAgICAgYXR0cmlidXRlczogewogICAgICAgICAgdHlwZTogInRleHQiLAogICAgICAgICAgZGF0YUlkOiBmaWVsZFtfc3ltYm9sX3V0aWxzLiRkYXRhXT8uW19zeW1ib2xfdXRpbHMuJHVpZF0gfHwgZmllbGRbX3N5bWJvbF91dGlscy4kdWlkXSwKICAgICAgICAgIGZpZWxkSWQ6IGZpZWxkW19zeW1ib2xfdXRpbHMuJHVpZF0sCiAgICAgICAgICBjbGFzczogWyJ4ZmFUZXh0ZmllbGQiXSwKICAgICAgICAgIHN0eWxlLAogICAgICAgICAgImFyaWEtbGFiZWwiOiBhcmlhTGFiZWwoZmllbGQpLAogICAgICAgICAgImFyaWEtcmVxdWlyZWQiOiBmYWxzZQogICAgICAgIH0KICAgICAgfTsKICAgIH0KICAgIGlmIChpc1JlcXVpcmVkKGZpZWxkKSkgewogICAgICBodG1sLmF0dHJpYnV0ZXNbImFyaWEtcmVxdWlyZWQiXSA9IHRydWU7CiAgICAgIGh0bWwuYXR0cmlidXRlcy5yZXF1aXJlZCA9IHRydWU7CiAgICB9CiAgICByZXR1cm4gX3V0aWxzLkhUTUxSZXN1bHQuc3VjY2Vzcyh7CiAgICAgIG5hbWU6ICJsYWJlbCIsCiAgICAgIGF0dHJpYnV0ZXM6IHsKICAgICAgICBjbGFzczogWyJ4ZmFMYWJlbCJdCiAgICAgIH0sCiAgICAgIGNoaWxkcmVuOiBbaHRtbF0KICAgIH0pOwogIH0KfQpjbGFzcyBUaW1lIGV4dGVuZHMgX3hmYV9vYmplY3QuU3RyaW5nT2JqZWN0IHsKICBjb25zdHJ1Y3RvcihhdHRyaWJ1dGVzKSB7CiAgICBzdXBlcihURU1QTEFURV9OU19JRCwgInRpbWUiKTsKICAgIHRoaXMuaWQgPSBhdHRyaWJ1dGVzLmlkIHx8ICIiOwogICAgdGhpcy5uYW1lID0gYXR0cmlidXRlcy5uYW1lIHx8ICIiOwogICAgdGhpcy51c2UgPSBhdHRyaWJ1dGVzLnVzZSB8fCAiIjsKICAgIHRoaXMudXNlaHJlZiA9IGF0dHJpYnV0ZXMudXNlaHJlZiB8fCAiIjsKICB9CiAgW19zeW1ib2xfdXRpbHMuJGZpbmFsaXplXSgpIHsKICAgIGNvbnN0IGRhdGUgPSB0aGlzW19zeW1ib2xfdXRpbHMuJGNvbnRlbnRdLnRyaW0oKTsKICAgIHRoaXNbX3N5bWJvbF91dGlscy4kY29udGVudF0gPSBkYXRlID8gbmV3IERhdGUoZGF0ZSkgOiBudWxsOwogIH0KICBbX3N5bWJvbF91dGlscy4kdG9IVE1MXShhdmFpbGFibGVTcGFjZSkgewogICAgcmV0dXJuIHZhbHVlVG9IdG1sKHRoaXNbX3N5bWJvbF91dGlscy4kY29udGVudF0gPyB0aGlzW19zeW1ib2xfdXRpbHMuJGNvbnRlbnRdLnRvU3RyaW5nKCkgOiAiIik7CiAgfQp9CmNsYXNzIFRpbWVTdGFtcCBleHRlbmRzIF94ZmFfb2JqZWN0LlhGQU9iamVjdCB7CiAgY29uc3RydWN0b3IoYXR0cmlidXRlcykgewogICAgc3VwZXIoVEVNUExBVEVfTlNfSUQsICJ0aW1lU3RhbXAiKTsKICAgIHRoaXMuaWQgPSBhdHRyaWJ1dGVzLmlkIHx8ICIiOwogICAgdGhpcy5zZXJ2ZXIgPSBhdHRyaWJ1dGVzLnNlcnZlciB8fCAiIjsKICAgIHRoaXMudHlwZSA9ICgwLCBfdXRpbHMuZ2V0U3RyaW5nT3B0aW9uKShhdHRyaWJ1dGVzLnR5cGUsIFsib3B0aW9uYWwiLCAicmVxdWlyZWQiXSk7CiAgICB0aGlzLnVzZSA9IGF0dHJpYnV0ZXMudXNlIHx8ICIiOwogICAgdGhpcy51c2VocmVmID0gYXR0cmlidXRlcy51c2VocmVmIHx8ICIiOwogIH0KfQpjbGFzcyBUb29sVGlwIGV4dGVuZHMgX3hmYV9vYmplY3QuU3RyaW5nT2JqZWN0IHsKICBjb25zdHJ1Y3RvcihhdHRyaWJ1dGVzKSB7CiAgICBzdXBlcihURU1QTEFURV9OU19JRCwgInRvb2xUaXAiKTsKICAgIHRoaXMuaWQgPSBhdHRyaWJ1dGVzLmlkIHx8ICIiOwogICAgdGhpcy5yaWQgPSBhdHRyaWJ1dGVzLnJpZCB8fCAiIjsKICAgIHRoaXMudXNlID0gYXR0cmlidXRlcy51c2UgfHwgIiI7CiAgICB0aGlzLnVzZWhyZWYgPSBhdHRyaWJ1dGVzLnVzZWhyZWYgfHwgIiI7CiAgfQp9CmNsYXNzIFRyYXZlcnNhbCBleHRlbmRzIF94ZmFfb2JqZWN0LlhGQU9iamVjdCB7CiAgY29uc3RydWN0b3IoYXR0cmlidXRlcykgewogICAgc3VwZXIoVEVNUExBVEVfTlNfSUQsICJ0cmF2ZXJzYWwiLCB0cnVlKTsKICAgIHRoaXMuaWQgPSBhdHRyaWJ1dGVzLmlkIHx8ICIiOwogICAgdGhpcy51c2UgPSBhdHRyaWJ1dGVzLnVzZSB8fCAiIjsKICAgIHRoaXMudXNlaHJlZiA9IGF0dHJpYnV0ZXMudXNlaHJlZiB8fCAiIjsKICAgIHRoaXMuZXh0cmFzID0gbnVsbDsKICAgIHRoaXMudHJhdmVyc2UgPSBuZXcgX3hmYV9vYmplY3QuWEZBT2JqZWN0QXJyYXkoKTsKICB9Cn0KY2xhc3MgVHJhdmVyc2UgZXh0ZW5kcyBfeGZhX29iamVjdC5YRkFPYmplY3QgewogIGNvbnN0cnVjdG9yKGF0dHJpYnV0ZXMpIHsKICAgIHN1cGVyKFRFTVBMQVRFX05TX0lELCAidHJhdmVyc2UiLCB0cnVlKTsKICAgIHRoaXMuaWQgPSBhdHRyaWJ1dGVzLmlkIHx8ICIiOwogICAgdGhpcy5vcGVyYXRpb24gPSAoMCwgX3V0aWxzLmdldFN0cmluZ09wdGlvbikoYXR0cmlidXRlcy5vcGVyYXRpb24sIFsibmV4dCIsICJiYWNrIiwgImRvd24iLCAiZmlyc3QiLCAibGVmdCIsICJyaWdodCIsICJ1cCJdKTsKICAgIHRoaXMucmVmID0gYXR0cmlidXRlcy5yZWYgfHwgIiI7CiAgICB0aGlzLnVzZSA9IGF0dHJpYnV0ZXMudXNlIHx8ICIiOwogICAgdGhpcy51c2VocmVmID0gYXR0cmlidXRlcy51c2VocmVmIHx8ICIiOwogICAgdGhpcy5leHRyYXMgPSBudWxsOwogICAgdGhpcy5zY3JpcHQgPSBudWxsOwogIH0KICBnZXQgbmFtZSgpIHsKICAgIHJldHVybiB0aGlzLm9wZXJhdGlvbjsKICB9CiAgW19zeW1ib2xfdXRpbHMuJGlzVHJhbnNwYXJlbnRdKCkgewogICAgcmV0dXJuIGZhbHNlOwogIH0KfQpjbGFzcyBVaSBleHRlbmRzIF94ZmFfb2JqZWN0LlhGQU9iamVjdCB7CiAgY29uc3RydWN0b3IoYXR0cmlidXRlcykgewogICAgc3VwZXIoVEVNUExBVEVfTlNfSUQsICJ1aSIsIHRydWUpOwogICAgdGhpcy5pZCA9IGF0dHJpYnV0ZXMuaWQgfHwgIiI7CiAgICB0aGlzLnVzZSA9IGF0dHJpYnV0ZXMudXNlIHx8ICIiOwogICAgdGhpcy51c2VocmVmID0gYXR0cmlidXRlcy51c2VocmVmIHx8ICIiOwogICAgdGhpcy5leHRyYXMgPSBudWxsOwogICAgdGhpcy5waWN0dXJlID0gbnVsbDsKICAgIHRoaXMuYmFyY29kZSA9IG51bGw7CiAgICB0aGlzLmJ1dHRvbiA9IG51bGw7CiAgICB0aGlzLmNoZWNrQnV0dG9uID0gbnVsbDsKICAgIHRoaXMuY2hvaWNlTGlzdCA9IG51bGw7CiAgICB0aGlzLmRhdGVUaW1lRWRpdCA9IG51bGw7CiAgICB0aGlzLmRlZmF1bHRVaSA9IG51bGw7CiAgICB0aGlzLmltYWdlRWRpdCA9IG51bGw7CiAgICB0aGlzLm51bWVyaWNFZGl0ID0gbnVsbDsKICAgIHRoaXMucGFzc3dvcmRFZGl0ID0gbnVsbDsKICAgIHRoaXMuc2lnbmF0dXJlID0gbnVsbDsKICAgIHRoaXMudGV4dEVkaXQgPSBudWxsOwogIH0KICBbX3N5bWJvbF91dGlscy4kZ2V0RXh0cmFdKCkgewogICAgaWYgKHRoaXNbX3N5bWJvbF91dGlscy4kZXh0cmFdID09PSB1bmRlZmluZWQpIHsKICAgICAgZm9yIChjb25zdCBuYW1lIG9mIE9iamVjdC5nZXRPd25Qcm9wZXJ0eU5hbWVzKHRoaXMpKSB7CiAgICAgICAgaWYgKG5hbWUgPT09ICJleHRyYXMiIHx8IG5hbWUgPT09ICJwaWN0dXJlIikgewogICAgICAgICAgY29udGludWU7CiAgICAgICAgfQogICAgICAgIGNvbnN0IG9iaiA9IHRoaXNbbmFtZV07CiAgICAgICAgaWYgKCEob2JqIGluc3RhbmNlb2YgX3hmYV9vYmplY3QuWEZBT2JqZWN0KSkgewogICAgICAgICAgY29udGludWU7CiAgICAgICAgfQogICAgICAgIHRoaXNbX3N5bWJvbF91dGlscy4kZXh0cmFdID0gb2JqOwogICAgICAgIHJldHVybiBvYmo7CiAgICAgIH0KICAgICAgdGhpc1tfc3ltYm9sX3V0aWxzLiRleHRyYV0gPSBudWxsOwogICAgfQogICAgcmV0dXJuIHRoaXNbX3N5bWJvbF91dGlscy4kZXh0cmFdOwogIH0KICBbX3N5bWJvbF91dGlscy4kdG9IVE1MXShhdmFpbGFibGVTcGFjZSkgewogICAgY29uc3Qgb2JqID0gdGhpc1tfc3ltYm9sX3V0aWxzLiRnZXRFeHRyYV0oKTsKICAgIGlmIChvYmopIHsKICAgICAgcmV0dXJuIG9ialtfc3ltYm9sX3V0aWxzLiR0b0hUTUxdKGF2YWlsYWJsZVNwYWNlKTsKICAgIH0KICAgIHJldHVybiBfdXRpbHMuSFRNTFJlc3VsdC5FTVBUWTsKICB9Cn0KY2xhc3MgVmFsaWRhdGUgZXh0ZW5kcyBfeGZhX29iamVjdC5YRkFPYmplY3QgewogIGNvbnN0cnVjdG9yKGF0dHJpYnV0ZXMpIHsKICAgIHN1cGVyKFRFTVBMQVRFX05TX0lELCAidmFsaWRhdGUiLCB0cnVlKTsKICAgIHRoaXMuZm9ybWF0VGVzdCA9ICgwLCBfdXRpbHMuZ2V0U3RyaW5nT3B0aW9uKShhdHRyaWJ1dGVzLmZvcm1hdFRlc3QsIFsid2FybmluZyIsICJkaXNhYmxlZCIsICJlcnJvciJdKTsKICAgIHRoaXMuaWQgPSBhdHRyaWJ1dGVzLmlkIHx8ICIiOwogICAgdGhpcy5udWxsVGVzdCA9ICgwLCBfdXRpbHMuZ2V0U3RyaW5nT3B0aW9uKShhdHRyaWJ1dGVzLm51bGxUZXN0LCBbImRpc2FibGVkIiwgImVycm9yIiwgIndhcm5pbmciXSk7CiAgICB0aGlzLnNjcmlwdFRlc3QgPSAoMCwgX3V0aWxzLmdldFN0cmluZ09wdGlvbikoYXR0cmlidXRlcy5zY3JpcHRUZXN0LCBbImVycm9yIiwgImRpc2FibGVkIiwgIndhcm5pbmciXSk7CiAgICB0aGlzLnVzZSA9IGF0dHJpYnV0ZXMudXNlIHx8ICIiOwogICAgdGhpcy51c2VocmVmID0gYXR0cmlidXRlcy51c2VocmVmIHx8ICIiOwogICAgdGhpcy5leHRyYXMgPSBudWxsOwogICAgdGhpcy5tZXNzYWdlID0gbnVsbDsKICAgIHRoaXMucGljdHVyZSA9IG51bGw7CiAgICB0aGlzLnNjcmlwdCA9IG51bGw7CiAgfQp9CmNsYXNzIFZhbHVlIGV4dGVuZHMgX3hmYV9vYmplY3QuWEZBT2JqZWN0IHsKICBjb25zdHJ1Y3RvcihhdHRyaWJ1dGVzKSB7CiAgICBzdXBlcihURU1QTEFURV9OU19JRCwgInZhbHVlIiwgdHJ1ZSk7CiAgICB0aGlzLmlkID0gYXR0cmlidXRlcy5pZCB8fCAiIjsKICAgIHRoaXMub3ZlcnJpZGUgPSAoMCwgX3V0aWxzLmdldEludGVnZXIpKHsKICAgICAgZGF0YTogYXR0cmlidXRlcy5vdmVycmlkZSwKICAgICAgZGVmYXVsdFZhbHVlOiAwLAogICAgICB2YWxpZGF0ZTogeCA9PiB4ID09PSAxCiAgICB9KTsKICAgIHRoaXMucmVsZXZhbnQgPSAoMCwgX3V0aWxzLmdldFJlbGV2YW50KShhdHRyaWJ1dGVzLnJlbGV2YW50KTsKICAgIHRoaXMudXNlID0gYXR0cmlidXRlcy51c2UgfHwgIiI7CiAgICB0aGlzLnVzZWhyZWYgPSBhdHRyaWJ1dGVzLnVzZWhyZWYgfHwgIiI7CiAgICB0aGlzLmFyYyA9IG51bGw7CiAgICB0aGlzLmJvb2xlYW4gPSBudWxsOwogICAgdGhpcy5kYXRlID0gbnVsbDsKICAgIHRoaXMuZGF0ZVRpbWUgPSBudWxsOwogICAgdGhpcy5kZWNpbWFsID0gbnVsbDsKICAgIHRoaXMuZXhEYXRhID0gbnVsbDsKICAgIHRoaXMuZmxvYXQgPSBudWxsOwogICAgdGhpcy5pbWFnZSA9IG51bGw7CiAgICB0aGlzLmludGVnZXIgPSBudWxsOwogICAgdGhpcy5saW5lID0gbnVsbDsKICAgIHRoaXMucmVjdGFuZ2xlID0gbnVsbDsKICAgIHRoaXMudGV4dCA9IG51bGw7CiAgICB0aGlzLnRpbWUgPSBudWxsOwogIH0KICBbX3N5bWJvbF91dGlscy4kc2V0VmFsdWVdKHZhbHVlKSB7CiAgICBjb25zdCBwYXJlbnQgPSB0aGlzW19zeW1ib2xfdXRpbHMuJGdldFBhcmVudF0oKTsKICAgIGlmIChwYXJlbnQgaW5zdGFuY2VvZiBGaWVsZCkgewogICAgICBpZiAocGFyZW50LnVpPy5pbWFnZUVkaXQpIHsKICAgICAgICBpZiAoIXRoaXMuaW1hZ2UpIHsKICAgICAgICAgIHRoaXMuaW1hZ2UgPSBuZXcgSW1hZ2Uoe30pOwogICAgICAgICAgdGhpc1tfc3ltYm9sX3V0aWxzLiRhcHBlbmRDaGlsZF0odGhpcy5pbWFnZSk7CiAgICAgICAgfQogICAgICAgIHRoaXMuaW1hZ2VbX3N5bWJvbF91dGlscy4kY29udGVudF0gPSB2YWx1ZVtfc3ltYm9sX3V0aWxzLiRjb250ZW50XTsKICAgICAgICByZXR1cm47CiAgICAgIH0KICAgIH0KICAgIGNvbnN0IHZhbHVlTmFtZSA9IHZhbHVlW19zeW1ib2xfdXRpbHMuJG5vZGVOYW1lXTsKICAgIGlmICh0aGlzW3ZhbHVlTmFtZV0gIT09IG51bGwpIHsKICAgICAgdGhpc1t2YWx1ZU5hbWVdW19zeW1ib2xfdXRpbHMuJGNvbnRlbnRdID0gdmFsdWVbX3N5bWJvbF91dGlscy4kY29udGVudF07CiAgICAgIHJldHVybjsKICAgIH0KICAgIGZvciAoY29uc3QgbmFtZSBvZiBPYmplY3QuZ2V0T3duUHJvcGVydHlOYW1lcyh0aGlzKSkgewogICAgICBjb25zdCBvYmogPSB0aGlzW25hbWVdOwogICAgICBpZiAob2JqIGluc3RhbmNlb2YgX3hmYV9vYmplY3QuWEZBT2JqZWN0KSB7CiAgICAgICAgdGhpc1tuYW1lXSA9IG51bGw7CiAgICAgICAgdGhpc1tfc3ltYm9sX3V0aWxzLiRyZW1vdmVDaGlsZF0ob2JqKTsKICAgICAgfQogICAgfQogICAgdGhpc1t2YWx1ZVtfc3ltYm9sX3V0aWxzLiRub2RlTmFtZV1dID0gdmFsdWU7CiAgICB0aGlzW19zeW1ib2xfdXRpbHMuJGFwcGVuZENoaWxkXSh2YWx1ZSk7CiAgfQogIFtfc3ltYm9sX3V0aWxzLiR0ZXh0XSgpIHsKICAgIGlmICh0aGlzLmV4RGF0YSkgewogICAgICBpZiAodHlwZW9mIHRoaXMuZXhEYXRhW19zeW1ib2xfdXRpbHMuJGNvbnRlbnRdID09PSAic3RyaW5nIikgewogICAgICAgIHJldHVybiB0aGlzLmV4RGF0YVtfc3ltYm9sX3V0aWxzLiRjb250ZW50XS50cmltKCk7CiAgICAgIH0KICAgICAgcmV0dXJuIHRoaXMuZXhEYXRhW19zeW1ib2xfdXRpbHMuJGNvbnRlbnRdW19zeW1ib2xfdXRpbHMuJHRleHRdKCkudHJpbSgpOwogICAgfQogICAgZm9yIChjb25zdCBuYW1lIG9mIE9iamVjdC5nZXRPd25Qcm9wZXJ0eU5hbWVzKHRoaXMpKSB7CiAgICAgIGlmIChuYW1lID09PSAiaW1hZ2UiKSB7CiAgICAgICAgY29udGludWU7CiAgICAgIH0KICAgICAgY29uc3Qgb2JqID0gdGhpc1tuYW1lXTsKICAgICAgaWYgKG9iaiBpbnN0YW5jZW9mIF94ZmFfb2JqZWN0LlhGQU9iamVjdCkgewogICAgICAgIHJldHVybiAob2JqW19zeW1ib2xfdXRpbHMuJGNvbnRlbnRdIHx8ICIiKS50b1N0cmluZygpLnRyaW0oKTsKICAgICAgfQogICAgfQogICAgcmV0dXJuIG51bGw7CiAgfQogIFtfc3ltYm9sX3V0aWxzLiR0b0hUTUxdKGF2YWlsYWJsZVNwYWNlKSB7CiAgICBmb3IgKGNvbnN0IG5hbWUgb2YgT2JqZWN0LmdldE93blByb3BlcnR5TmFtZXModGhpcykpIHsKICAgICAgY29uc3Qgb2JqID0gdGhpc1tuYW1lXTsKICAgICAgaWYgKCEob2JqIGluc3RhbmNlb2YgX3hmYV9vYmplY3QuWEZBT2JqZWN0KSkgewogICAgICAgIGNvbnRpbnVlOwogICAgICB9CiAgICAgIHJldHVybiBvYmpbX3N5bWJvbF91dGlscy4kdG9IVE1MXShhdmFpbGFibGVTcGFjZSk7CiAgICB9CiAgICByZXR1cm4gX3V0aWxzLkhUTUxSZXN1bHQuRU1QVFk7CiAgfQp9CmV4cG9ydHMuVmFsdWUgPSBWYWx1ZTsKY2xhc3MgVmFyaWFibGVzIGV4dGVuZHMgX3hmYV9vYmplY3QuWEZBT2JqZWN0IHsKICBjb25zdHJ1Y3RvcihhdHRyaWJ1dGVzKSB7CiAgICBzdXBlcihURU1QTEFURV9OU19JRCwgInZhcmlhYmxlcyIsIHRydWUpOwogICAgdGhpcy5pZCA9IGF0dHJpYnV0ZXMuaWQgfHwgIiI7CiAgICB0aGlzLnVzZSA9IGF0dHJpYnV0ZXMudXNlIHx8ICIiOwogICAgdGhpcy51c2VocmVmID0gYXR0cmlidXRlcy51c2VocmVmIHx8ICIiOwogICAgdGhpcy5ib29sZWFuID0gbmV3IF94ZmFfb2JqZWN0LlhGQU9iamVjdEFycmF5KCk7CiAgICB0aGlzLmRhdGUgPSBuZXcgX3hmYV9vYmplY3QuWEZBT2JqZWN0QXJyYXkoKTsKICAgIHRoaXMuZGF0ZVRpbWUgPSBuZXcgX3hmYV9vYmplY3QuWEZBT2JqZWN0QXJyYXkoKTsKICAgIHRoaXMuZGVjaW1hbCA9IG5ldyBfeGZhX29iamVjdC5YRkFPYmplY3RBcnJheSgpOwogICAgdGhpcy5leERhdGEgPSBuZXcgX3hmYV9vYmplY3QuWEZBT2JqZWN0QXJyYXkoKTsKICAgIHRoaXMuZmxvYXQgPSBuZXcgX3hmYV9vYmplY3QuWEZBT2JqZWN0QXJyYXkoKTsKICAgIHRoaXMuaW1hZ2UgPSBuZXcgX3hmYV9vYmplY3QuWEZBT2JqZWN0QXJyYXkoKTsKICAgIHRoaXMuaW50ZWdlciA9IG5ldyBfeGZhX29iamVjdC5YRkFPYmplY3RBcnJheSgpOwogICAgdGhpcy5tYW5pZmVzdCA9IG5ldyBfeGZhX29iamVjdC5YRkFPYmplY3RBcnJheSgpOwogICAgdGhpcy5zY3JpcHQgPSBuZXcgX3hmYV9vYmplY3QuWEZBT2JqZWN0QXJyYXkoKTsKICAgIHRoaXMudGV4dCA9IG5ldyBfeGZhX29iamVjdC5YRkFPYmplY3RBcnJheSgpOwogICAgdGhpcy50aW1lID0gbmV3IF94ZmFfb2JqZWN0LlhGQU9iamVjdEFycmF5KCk7CiAgfQogIFtfc3ltYm9sX3V0aWxzLiRpc1RyYW5zcGFyZW50XSgpIHsKICAgIHJldHVybiB0cnVlOwogIH0KfQpjbGFzcyBUZW1wbGF0ZU5hbWVzcGFjZSB7CiAgc3RhdGljIFtfbmFtZXNwYWNlcy4kYnVpbGRYRkFPYmplY3RdKG5hbWUsIGF0dHJpYnV0ZXMpIHsKICAgIGlmIChUZW1wbGF0ZU5hbWVzcGFjZS5oYXNPd25Qcm9wZXJ0eShuYW1lKSkgewogICAgICBjb25zdCBub2RlID0gVGVtcGxhdGVOYW1lc3BhY2VbbmFtZV0oYXR0cmlidXRlcyk7CiAgICAgIG5vZGVbX3N5bWJvbF91dGlscy4kc2V0U2V0QXR0cmlidXRlc10oYXR0cmlidXRlcyk7CiAgICAgIHJldHVybiBub2RlOwogICAgfQogICAgcmV0dXJuIHVuZGVmaW5lZDsKICB9CiAgc3RhdGljIGFwcGVhcmFuY2VGaWx0ZXIoYXR0cnMpIHsKICAgIHJldHVybiBuZXcgQXBwZWFyYW5jZUZpbHRlcihhdHRycyk7CiAgfQogIHN0YXRpYyBhcmMoYXR0cnMpIHsKICAgIHJldHVybiBuZXcgQXJjKGF0dHJzKTsKICB9CiAgc3RhdGljIGFyZWEoYXR0cnMpIHsKICAgIHJldHVybiBuZXcgQXJlYShhdHRycyk7CiAgfQogIHN0YXRpYyBhc3Npc3QoYXR0cnMpIHsKICAgIHJldHVybiBuZXcgQXNzaXN0KGF0dHJzKTsKICB9CiAgc3RhdGljIGJhcmNvZGUoYXR0cnMpIHsKICAgIHJldHVybiBuZXcgQmFyY29kZShhdHRycyk7CiAgfQogIHN0YXRpYyBiaW5kKGF0dHJzKSB7CiAgICByZXR1cm4gbmV3IEJpbmQoYXR0cnMpOwogIH0KICBzdGF0aWMgYmluZEl0ZW1zKGF0dHJzKSB7CiAgICByZXR1cm4gbmV3IEJpbmRJdGVtcyhhdHRycyk7CiAgfQogIHN0YXRpYyBib29rZW5kKGF0dHJzKSB7CiAgICByZXR1cm4gbmV3IEJvb2tlbmQoYXR0cnMpOwogIH0KICBzdGF0aWMgYm9vbGVhbihhdHRycykgewogICAgcmV0dXJuIG5ldyBCb29sZWFuRWxlbWVudChhdHRycyk7CiAgfQogIHN0YXRpYyBib3JkZXIoYXR0cnMpIHsKICAgIHJldHVybiBuZXcgQm9yZGVyKGF0dHJzKTsKICB9CiAgc3RhdGljIGJyZWFrKGF0dHJzKSB7CiAgICByZXR1cm4gbmV3IEJyZWFrKGF0dHJzKTsKICB9CiAgc3RhdGljIGJyZWFrQWZ0ZXIoYXR0cnMpIHsKICAgIHJldHVybiBuZXcgQnJlYWtBZnRlcihhdHRycyk7CiAgfQogIHN0YXRpYyBicmVha0JlZm9yZShhdHRycykgewogICAgcmV0dXJuIG5ldyBCcmVha0JlZm9yZShhdHRycyk7CiAgfQogIHN0YXRpYyBidXR0b24oYXR0cnMpIHsKICAgIHJldHVybiBuZXcgQnV0dG9uKGF0dHJzKTsKICB9CiAgc3RhdGljIGNhbGN1bGF0ZShhdHRycykgewogICAgcmV0dXJuIG5ldyBDYWxjdWxhdGUoYXR0cnMpOwogIH0KICBzdGF0aWMgY2FwdGlvbihhdHRycykgewogICAgcmV0dXJuIG5ldyBDYXB0aW9uKGF0dHJzKTsKICB9CiAgc3RhdGljIGNlcnRpZmljYXRlKGF0dHJzKSB7CiAgICByZXR1cm4gbmV3IENlcnRpZmljYXRlKGF0dHJzKTsKICB9CiAgc3RhdGljIGNlcnRpZmljYXRlcyhhdHRycykgewogICAgcmV0dXJuIG5ldyBDZXJ0aWZpY2F0ZXMoYXR0cnMpOwogIH0KICBzdGF0aWMgY2hlY2tCdXR0b24oYXR0cnMpIHsKICAgIHJldHVybiBuZXcgQ2hlY2tCdXR0b24oYXR0cnMpOwogIH0KICBzdGF0aWMgY2hvaWNlTGlzdChhdHRycykgewogICAgcmV0dXJuIG5ldyBDaG9pY2VMaXN0KGF0dHJzKTsKICB9CiAgc3RhdGljIGNvbG9yKGF0dHJzKSB7CiAgICByZXR1cm4gbmV3IENvbG9yKGF0dHJzKTsKICB9CiAgc3RhdGljIGNvbWIoYXR0cnMpIHsKICAgIHJldHVybiBuZXcgQ29tYihhdHRycyk7CiAgfQogIHN0YXRpYyBjb25uZWN0KGF0dHJzKSB7CiAgICByZXR1cm4gbmV3IENvbm5lY3QoYXR0cnMpOwogIH0KICBzdGF0aWMgY29udGVudEFyZWEoYXR0cnMpIHsKICAgIHJldHVybiBuZXcgQ29udGVudEFyZWEoYXR0cnMpOwogIH0KICBzdGF0aWMgY29ybmVyKGF0dHJzKSB7CiAgICByZXR1cm4gbmV3IENvcm5lcihhdHRycyk7CiAgfQogIHN0YXRpYyBkYXRlKGF0dHJzKSB7CiAgICByZXR1cm4gbmV3IERhdGVFbGVtZW50KGF0dHJzKTsKICB9CiAgc3RhdGljIGRhdGVUaW1lKGF0dHJzKSB7CiAgICByZXR1cm4gbmV3IERhdGVUaW1lKGF0dHJzKTsKICB9CiAgc3RhdGljIGRhdGVUaW1lRWRpdChhdHRycykgewogICAgcmV0dXJuIG5ldyBEYXRlVGltZUVkaXQoYXR0cnMpOwogIH0KICBzdGF0aWMgZGVjaW1hbChhdHRycykgewogICAgcmV0dXJuIG5ldyBEZWNpbWFsKGF0dHJzKTsKICB9CiAgc3RhdGljIGRlZmF1bHRVaShhdHRycykgewogICAgcmV0dXJuIG5ldyBEZWZhdWx0VWkoYXR0cnMpOwogIH0KICBzdGF0aWMgZGVzYyhhdHRycykgewogICAgcmV0dXJuIG5ldyBEZXNjKGF0dHJzKTsKICB9CiAgc3RhdGljIGRpZ2VzdE1ldGhvZChhdHRycykgewogICAgcmV0dXJuIG5ldyBEaWdlc3RNZXRob2QoYXR0cnMpOwogIH0KICBzdGF0aWMgZGlnZXN0TWV0aG9kcyhhdHRycykgewogICAgcmV0dXJuIG5ldyBEaWdlc3RNZXRob2RzKGF0dHJzKTsKICB9CiAgc3RhdGljIGRyYXcoYXR0cnMpIHsKICAgIHJldHVybiBuZXcgRHJhdyhhdHRycyk7CiAgfQogIHN0YXRpYyBlZGdlKGF0dHJzKSB7CiAgICByZXR1cm4gbmV3IEVkZ2UoYXR0cnMpOwogIH0KICBzdGF0aWMgZW5jb2RpbmcoYXR0cnMpIHsKICAgIHJldHVybiBuZXcgRW5jb2RpbmcoYXR0cnMpOwogIH0KICBzdGF0aWMgZW5jb2RpbmdzKGF0dHJzKSB7CiAgICByZXR1cm4gbmV3IEVuY29kaW5ncyhhdHRycyk7CiAgfQogIHN0YXRpYyBlbmNyeXB0KGF0dHJzKSB7CiAgICByZXR1cm4gbmV3IEVuY3J5cHQoYXR0cnMpOwogIH0KICBzdGF0aWMgZW5jcnlwdERhdGEoYXR0cnMpIHsKICAgIHJldHVybiBuZXcgRW5jcnlwdERhdGEoYXR0cnMpOwogIH0KICBzdGF0aWMgZW5jcnlwdGlvbihhdHRycykgewogICAgcmV0dXJuIG5ldyBFbmNyeXB0aW9uKGF0dHJzKTsKICB9CiAgc3RhdGljIGVuY3J5cHRpb25NZXRob2QoYXR0cnMpIHsKICAgIHJldHVybiBuZXcgRW5jcnlwdGlvbk1ldGhvZChhdHRycyk7CiAgfQogIHN0YXRpYyBlbmNyeXB0aW9uTWV0aG9kcyhhdHRycykgewogICAgcmV0dXJuIG5ldyBFbmNyeXB0aW9uTWV0aG9kcyhhdHRycyk7CiAgfQogIHN0YXRpYyBldmVudChhdHRycykgewogICAgcmV0dXJuIG5ldyBFdmVudChhdHRycyk7CiAgfQogIHN0YXRpYyBleERhdGEoYXR0cnMpIHsKICAgIHJldHVybiBuZXcgRXhEYXRhKGF0dHJzKTsKICB9CiAgc3RhdGljIGV4T2JqZWN0KGF0dHJzKSB7CiAgICByZXR1cm4gbmV3IEV4T2JqZWN0KGF0dHJzKTsKICB9CiAgc3RhdGljIGV4Y2xHcm91cChhdHRycykgewogICAgcmV0dXJuIG5ldyBFeGNsR3JvdXAoYXR0cnMpOwogIH0KICBzdGF0aWMgZXhlY3V0ZShhdHRycykgewogICAgcmV0dXJuIG5ldyBFeGVjdXRlKGF0dHJzKTsKICB9CiAgc3RhdGljIGV4dHJhcyhhdHRycykgewogICAgcmV0dXJuIG5ldyBFeHRyYXMoYXR0cnMpOwogIH0KICBzdGF0aWMgZmllbGQoYXR0cnMpIHsKICAgIHJldHVybiBuZXcgRmllbGQoYXR0cnMpOwogIH0KICBzdGF0aWMgZmlsbChhdHRycykgewogICAgcmV0dXJuIG5ldyBGaWxsKGF0dHJzKTsKICB9CiAgc3RhdGljIGZpbHRlcihhdHRycykgewogICAgcmV0dXJuIG5ldyBGaWx0ZXIoYXR0cnMpOwogIH0KICBzdGF0aWMgZmxvYXQoYXR0cnMpIHsKICAgIHJldHVybiBuZXcgRmxvYXQoYXR0cnMpOwogIH0KICBzdGF0aWMgZm9udChhdHRycykgewogICAgcmV0dXJuIG5ldyBGb250KGF0dHJzKTsKICB9CiAgc3RhdGljIGZvcm1hdChhdHRycykgewogICAgcmV0dXJuIG5ldyBGb3JtYXQoYXR0cnMpOwogIH0KICBzdGF0aWMgaGFuZGxlcihhdHRycykgewogICAgcmV0dXJuIG5ldyBIYW5kbGVyKGF0dHJzKTsKICB9CiAgc3RhdGljIGh5cGhlbmF0aW9uKGF0dHJzKSB7CiAgICByZXR1cm4gbmV3IEh5cGhlbmF0aW9uKGF0dHJzKTsKICB9CiAgc3RhdGljIGltYWdlKGF0dHJzKSB7CiAgICByZXR1cm4gbmV3IEltYWdlKGF0dHJzKTsKICB9CiAgc3RhdGljIGltYWdlRWRpdChhdHRycykgewogICAgcmV0dXJuIG5ldyBJbWFnZUVkaXQoYXR0cnMpOwogIH0KICBzdGF0aWMgaW50ZWdlcihhdHRycykgewogICAgcmV0dXJuIG5ldyBJbnRlZ2VyKGF0dHJzKTsKICB9CiAgc3RhdGljIGlzc3VlcnMoYXR0cnMpIHsKICAgIHJldHVybiBuZXcgSXNzdWVycyhhdHRycyk7CiAgfQogIHN0YXRpYyBpdGVtcyhhdHRycykgewogICAgcmV0dXJuIG5ldyBJdGVtcyhhdHRycyk7CiAgfQogIHN0YXRpYyBrZWVwKGF0dHJzKSB7CiAgICByZXR1cm4gbmV3IEtlZXAoYXR0cnMpOwogIH0KICBzdGF0aWMga2V5VXNhZ2UoYXR0cnMpIHsKICAgIHJldHVybiBuZXcgS2V5VXNhZ2UoYXR0cnMpOwogIH0KICBzdGF0aWMgbGluZShhdHRycykgewogICAgcmV0dXJuIG5ldyBMaW5lKGF0dHJzKTsKICB9CiAgc3RhdGljIGxpbmVhcihhdHRycykgewogICAgcmV0dXJuIG5ldyBMaW5lYXIoYXR0cnMpOwogIH0KICBzdGF0aWMgbG9ja0RvY3VtZW50KGF0dHJzKSB7CiAgICByZXR1cm4gbmV3IExvY2tEb2N1bWVudChhdHRycyk7CiAgfQogIHN0YXRpYyBtYW5pZmVzdChhdHRycykgewogICAgcmV0dXJuIG5ldyBNYW5pZmVzdChhdHRycyk7CiAgfQogIHN0YXRpYyBtYXJnaW4oYXR0cnMpIHsKICAgIHJldHVybiBuZXcgTWFyZ2luKGF0dHJzKTsKICB9CiAgc3RhdGljIG1kcChhdHRycykgewogICAgcmV0dXJuIG5ldyBNZHAoYXR0cnMpOwogIH0KICBzdGF0aWMgbWVkaXVtKGF0dHJzKSB7CiAgICByZXR1cm4gbmV3IE1lZGl1bShhdHRycyk7CiAgfQogIHN0YXRpYyBtZXNzYWdlKGF0dHJzKSB7CiAgICByZXR1cm4gbmV3IE1lc3NhZ2UoYXR0cnMpOwogIH0KICBzdGF0aWMgbnVtZXJpY0VkaXQoYXR0cnMpIHsKICAgIHJldHVybiBuZXcgTnVtZXJpY0VkaXQoYXR0cnMpOwogIH0KICBzdGF0aWMgb2NjdXIoYXR0cnMpIHsKICAgIHJldHVybiBuZXcgT2NjdXIoYXR0cnMpOwogIH0KICBzdGF0aWMgb2lkKGF0dHJzKSB7CiAgICByZXR1cm4gbmV3IE9pZChhdHRycyk7CiAgfQogIHN0YXRpYyBvaWRzKGF0dHJzKSB7CiAgICByZXR1cm4gbmV3IE9pZHMoYXR0cnMpOwogIH0KICBzdGF0aWMgb3ZlcmZsb3coYXR0cnMpIHsKICAgIHJldHVybiBuZXcgT3ZlcmZsb3coYXR0cnMpOwogIH0KICBzdGF0aWMgcGFnZUFyZWEoYXR0cnMpIHsKICAgIHJldHVybiBuZXcgUGFnZUFyZWEoYXR0cnMpOwogIH0KICBzdGF0aWMgcGFnZVNldChhdHRycykgewogICAgcmV0dXJuIG5ldyBQYWdlU2V0KGF0dHJzKTsKICB9CiAgc3RhdGljIHBhcmEoYXR0cnMpIHsKICAgIHJldHVybiBuZXcgUGFyYShhdHRycyk7CiAgfQogIHN0YXRpYyBwYXNzd29yZEVkaXQoYXR0cnMpIHsKICAgIHJldHVybiBuZXcgUGFzc3dvcmRFZGl0KGF0dHJzKTsKICB9CiAgc3RhdGljIHBhdHRlcm4oYXR0cnMpIHsKICAgIHJldHVybiBuZXcgUGF0dGVybihhdHRycyk7CiAgfQogIHN0YXRpYyBwaWN0dXJlKGF0dHJzKSB7CiAgICByZXR1cm4gbmV3IFBpY3R1cmUoYXR0cnMpOwogIH0KICBzdGF0aWMgcHJvdG8oYXR0cnMpIHsKICAgIHJldHVybiBuZXcgUHJvdG8oYXR0cnMpOwogIH0KICBzdGF0aWMgcmFkaWFsKGF0dHJzKSB7CiAgICByZXR1cm4gbmV3IFJhZGlhbChhdHRycyk7CiAgfQogIHN0YXRpYyByZWFzb24oYXR0cnMpIHsKICAgIHJldHVybiBuZXcgUmVhc29uKGF0dHJzKTsKICB9CiAgc3RhdGljIHJlYXNvbnMoYXR0cnMpIHsKICAgIHJldHVybiBuZXcgUmVhc29ucyhhdHRycyk7CiAgfQogIHN0YXRpYyByZWN0YW5nbGUoYXR0cnMpIHsKICAgIHJldHVybiBuZXcgUmVjdGFuZ2xlKGF0dHJzKTsKICB9CiAgc3RhdGljIHJlZihhdHRycykgewogICAgcmV0dXJuIG5ldyBSZWZFbGVtZW50KGF0dHJzKTsKICB9CiAgc3RhdGljIHNjcmlwdChhdHRycykgewogICAgcmV0dXJuIG5ldyBTY3JpcHQoYXR0cnMpOwogIH0KICBzdGF0aWMgc2V0UHJvcGVydHkoYXR0cnMpIHsKICAgIHJldHVybiBuZXcgU2V0UHJvcGVydHkoYXR0cnMpOwogIH0KICBzdGF0aWMgc2lnbkRhdGEoYXR0cnMpIHsKICAgIHJldHVybiBuZXcgU2lnbkRhdGEoYXR0cnMpOwogIH0KICBzdGF0aWMgc2lnbmF0dXJlKGF0dHJzKSB7CiAgICByZXR1cm4gbmV3IFNpZ25hdHVyZShhdHRycyk7CiAgfQogIHN0YXRpYyBzaWduaW5nKGF0dHJzKSB7CiAgICByZXR1cm4gbmV3IFNpZ25pbmcoYXR0cnMpOwogIH0KICBzdGF0aWMgc29saWQoYXR0cnMpIHsKICAgIHJldHVybiBuZXcgU29saWQoYXR0cnMpOwogIH0KICBzdGF0aWMgc3BlYWsoYXR0cnMpIHsKICAgIHJldHVybiBuZXcgU3BlYWsoYXR0cnMpOwogIH0KICBzdGF0aWMgc3RpcHBsZShhdHRycykgewogICAgcmV0dXJuIG5ldyBTdGlwcGxlKGF0dHJzKTsKICB9CiAgc3RhdGljIHN1YmZvcm0oYXR0cnMpIHsKICAgIHJldHVybiBuZXcgU3ViZm9ybShhdHRycyk7CiAgfQogIHN0YXRpYyBzdWJmb3JtU2V0KGF0dHJzKSB7CiAgICByZXR1cm4gbmV3IFN1YmZvcm1TZXQoYXR0cnMpOwogIH0KICBzdGF0aWMgc3ViamVjdEROKGF0dHJzKSB7CiAgICByZXR1cm4gbmV3IFN1YmplY3RETihhdHRycyk7CiAgfQogIHN0YXRpYyBzdWJqZWN0RE5zKGF0dHJzKSB7CiAgICByZXR1cm4gbmV3IFN1YmplY3RETnMoYXR0cnMpOwogIH0KICBzdGF0aWMgc3VibWl0KGF0dHJzKSB7CiAgICByZXR1cm4gbmV3IFN1Ym1pdChhdHRycyk7CiAgfQogIHN0YXRpYyB0ZW1wbGF0ZShhdHRycykgewogICAgcmV0dXJuIG5ldyBUZW1wbGF0ZShhdHRycyk7CiAgfQogIHN0YXRpYyB0ZXh0KGF0dHJzKSB7CiAgICByZXR1cm4gbmV3IFRleHQoYXR0cnMpOwogIH0KICBzdGF0aWMgdGV4dEVkaXQoYXR0cnMpIHsKICAgIHJldHVybiBuZXcgVGV4dEVkaXQoYXR0cnMpOwogIH0KICBzdGF0aWMgdGltZShhdHRycykgewogICAgcmV0dXJuIG5ldyBUaW1lKGF0dHJzKTsKICB9CiAgc3RhdGljIHRpbWVTdGFtcChhdHRycykgewogICAgcmV0dXJuIG5ldyBUaW1lU3RhbXAoYXR0cnMpOwogIH0KICBzdGF0aWMgdG9vbFRpcChhdHRycykgewogICAgcmV0dXJuIG5ldyBUb29sVGlwKGF0dHJzKTsKICB9CiAgc3RhdGljIHRyYXZlcnNhbChhdHRycykgewogICAgcmV0dXJuIG5ldyBUcmF2ZXJzYWwoYXR0cnMpOwogIH0KICBzdGF0aWMgdHJhdmVyc2UoYXR0cnMpIHsKICAgIHJldHVybiBuZXcgVHJhdmVyc2UoYXR0cnMpOwogIH0KICBzdGF0aWMgdWkoYXR0cnMpIHsKICAgIHJldHVybiBuZXcgVWkoYXR0cnMpOwogIH0KICBzdGF0aWMgdmFsaWRhdGUoYXR0cnMpIHsKICAgIHJldHVybiBuZXcgVmFsaWRhdGUoYXR0cnMpOwogIH0KICBzdGF0aWMgdmFsdWUoYXR0cnMpIHsKICAgIHJldHVybiBuZXcgVmFsdWUoYXR0cnMpOwogIH0KICBzdGF0aWMgdmFyaWFibGVzKGF0dHJzKSB7CiAgICByZXR1cm4gbmV3IFZhcmlhYmxlcyhhdHRycyk7CiAgfQp9CmV4cG9ydHMuVGVtcGxhdGVOYW1lc3BhY2UgPSBUZW1wbGF0ZU5hbWVzcGFjZTsKCi8qKiovIH0pLAovKiA4MSAqLwovKioqLyAoKF9fdW51c2VkX3dlYnBhY2tfbW9kdWxlLCBleHBvcnRzKSA9PiB7CgoKCk9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCAiX19lc01vZHVsZSIsICh7CiAgdmFsdWU6IHRydWUKfSkpOwpleHBvcnRzLk5hbWVzcGFjZUlkcyA9IGV4cG9ydHMuJGJ1aWxkWEZBT2JqZWN0ID0gdm9pZCAwOwpjb25zdCAkYnVpbGRYRkFPYmplY3QgPSBTeW1ib2woKTsKZXhwb3J0cy4kYnVpbGRYRkFPYmplY3QgPSAkYnVpbGRYRkFPYmplY3Q7CmNvbnN0IE5hbWVzcGFjZUlkcyA9IHsKICBjb25maWc6IHsKICAgIGlkOiAwLAogICAgY2hlY2s6IG5zID0+IG5zLnN0YXJ0c1dpdGgoImh0dHA6Ly93d3cueGZhLm9yZy9zY2hlbWEveGNpLyIpCiAgfSwKICBjb25uZWN0aW9uU2V0OiB7CiAgICBpZDogMSwKICAgIGNoZWNrOiBucyA9PiBucy5zdGFydHNXaXRoKCJodHRwOi8vd3d3LnhmYS5vcmcvc2NoZW1hL3hmYS1jb25uZWN0aW9uLXNldC8iKQogIH0sCiAgZGF0YXNldHM6IHsKICAgIGlkOiAyLAogICAgY2hlY2s6IG5zID0+IG5zLnN0YXJ0c1dpdGgoImh0dHA6Ly93d3cueGZhLm9yZy9zY2hlbWEveGZhLWRhdGEvIikKICB9LAogIGZvcm06IHsKICAgIGlkOiAzLAogICAgY2hlY2s6IG5zID0+IG5zLnN0YXJ0c1dpdGgoImh0dHA6Ly93d3cueGZhLm9yZy9zY2hlbWEveGZhLWZvcm0vIikKICB9LAogIGxvY2FsZVNldDogewogICAgaWQ6IDQsCiAgICBjaGVjazogbnMgPT4gbnMuc3RhcnRzV2l0aCgiaHR0cDovL3d3dy54ZmEub3JnL3NjaGVtYS94ZmEtbG9jYWxlLXNldC8iKQogIH0sCiAgcGRmOiB7CiAgICBpZDogNSwKICAgIGNoZWNrOiBucyA9PiBucyA9PT0gImh0dHA6Ly9ucy5hZG9iZS5jb20veGRwL3BkZi8iCiAgfSwKICBzaWduYXR1cmU6IHsKICAgIGlkOiA2LAogICAgY2hlY2s6IG5zID0+IG5zID09PSAiaHR0cDovL3d3dy53My5vcmcvMjAwMC8wOS94bWxkc2lnIyIKICB9LAogIHNvdXJjZVNldDogewogICAgaWQ6IDcsCiAgICBjaGVjazogbnMgPT4gbnMuc3RhcnRzV2l0aCgiaHR0cDovL3d3dy54ZmEub3JnL3NjaGVtYS94ZmEtc291cmNlLXNldC8iKQogIH0sCiAgc3R5bGVzaGVldDogewogICAgaWQ6IDgsCiAgICBjaGVjazogbnMgPT4gbnMgPT09ICJodHRwOi8vd3d3LnczLm9yZy8xOTk5L1hTTC9UcmFuc2Zvcm0iCiAgfSwKICB0ZW1wbGF0ZTogewogICAgaWQ6IDksCiAgICBjaGVjazogbnMgPT4gbnMuc3RhcnRzV2l0aCgiaHR0cDovL3d3dy54ZmEub3JnL3NjaGVtYS94ZmEtdGVtcGxhdGUvIikKICB9LAogIHhkYzogewogICAgaWQ6IDEwLAogICAgY2hlY2s6IG5zID0+IG5zLnN0YXJ0c1dpdGgoImh0dHA6Ly93d3cueGZhLm9yZy9zY2hlbWEveGRjLyIpCiAgfSwKICB4ZHA6IHsKICAgIGlkOiAxMSwKICAgIGNoZWNrOiBucyA9PiBucyA9PT0gImh0dHA6Ly9ucy5hZG9iZS5jb20veGRwLyIKICB9LAogIHhmZGY6IHsKICAgIGlkOiAxMiwKICAgIGNoZWNrOiBucyA9PiBucyA9PT0gImh0dHA6Ly9ucy5hZG9iZS5jb20veGZkZi8iCiAgfSwKICB4aHRtbDogewogICAgaWQ6IDEzLAogICAgY2hlY2s6IG5zID0+IG5zID09PSAiaHR0cDovL3d3dy53My5vcmcvMTk5OS94aHRtbCIKICB9LAogIHhtcG1ldGE6IHsKICAgIGlkOiAxNCwKICAgIGNoZWNrOiBucyA9PiBucyA9PT0gImh0dHA6Ly9ucy5hZG9iZS5jb20veG1wbWV0YS8iCiAgfQp9OwpleHBvcnRzLk5hbWVzcGFjZUlkcyA9IE5hbWVzcGFjZUlkczsKCi8qKiovIH0pLAovKiA4MiAqLwovKioqLyAoKF9fdW51c2VkX3dlYnBhY2tfbW9kdWxlLCBleHBvcnRzLCBfX3dfcGRmanNfcmVxdWlyZV9fKSA9PiB7CgoKCk9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCAiX19lc01vZHVsZSIsICh7CiAgdmFsdWU6IHRydWUKfSkpOwpleHBvcnRzLmFkZEhUTUwgPSBhZGRIVE1MOwpleHBvcnRzLmNoZWNrRGltZW5zaW9ucyA9IGNoZWNrRGltZW5zaW9uczsKZXhwb3J0cy5mbHVzaEhUTUwgPSBmbHVzaEhUTUw7CmV4cG9ydHMuZ2V0QXZhaWxhYmxlU3BhY2UgPSBnZXRBdmFpbGFibGVTcGFjZTsKdmFyIF9zeW1ib2xfdXRpbHMgPSBfX3dfcGRmanNfcmVxdWlyZV9fKDc4KTsKdmFyIF9odG1sX3V0aWxzID0gX193X3BkZmpzX3JlcXVpcmVfXyg4Myk7CmZ1bmN0aW9uIGNyZWF0ZUxpbmUobm9kZSwgY2hpbGRyZW4pIHsKICByZXR1cm4gewogICAgbmFtZTogImRpdiIsCiAgICBhdHRyaWJ1dGVzOiB7CiAgICAgIGNsYXNzOiBbbm9kZS5sYXlvdXQgPT09ICJsci10YiIgPyAieGZhTHIiIDogInhmYVJsIl0KICAgIH0sCiAgICBjaGlsZHJlbgogIH07Cn0KZnVuY3Rpb24gZmx1c2hIVE1MKG5vZGUpIHsKICBpZiAoIW5vZGVbX3N5bWJvbF91dGlscy4kZXh0cmFdKSB7CiAgICByZXR1cm4gbnVsbDsKICB9CiAgY29uc3QgYXR0cmlidXRlcyA9IG5vZGVbX3N5bWJvbF91dGlscy4kZXh0cmFdLmF0dHJpYnV0ZXM7CiAgY29uc3QgaHRtbCA9IHsKICAgIG5hbWU6ICJkaXYiLAogICAgYXR0cmlidXRlcywKICAgIGNoaWxkcmVuOiBub2RlW19zeW1ib2xfdXRpbHMuJGV4dHJhXS5jaGlsZHJlbgogIH07CiAgaWYgKG5vZGVbX3N5bWJvbF91dGlscy4kZXh0cmFdLmZhaWxpbmdOb2RlKSB7CiAgICBjb25zdCBodG1sRnJvbUZhaWxpbmcgPSBub2RlW19zeW1ib2xfdXRpbHMuJGV4dHJhXS5mYWlsaW5nTm9kZVtfc3ltYm9sX3V0aWxzLiRmbHVzaEhUTUxdKCk7CiAgICBpZiAoaHRtbEZyb21GYWlsaW5nKSB7CiAgICAgIGlmIChub2RlLmxheW91dC5lbmRzV2l0aCgiLXRiIikpIHsKICAgICAgICBodG1sLmNoaWxkcmVuLnB1c2goY3JlYXRlTGluZShub2RlLCBbaHRtbEZyb21GYWlsaW5nXSkpOwogICAgICB9IGVsc2UgewogICAgICAgIGh0bWwuY2hpbGRyZW4ucHVzaChodG1sRnJvbUZhaWxpbmcpOwogICAgICB9CiAgICB9CiAgfQogIGlmIChodG1sLmNoaWxkcmVuLmxlbmd0aCA9PT0gMCkgewogICAgcmV0dXJuIG51bGw7CiAgfQogIHJldHVybiBodG1sOwp9CmZ1bmN0aW9uIGFkZEhUTUwobm9kZSwgaHRtbCwgYmJveCkgewogIGNvbnN0IGV4dHJhID0gbm9kZVtfc3ltYm9sX3V0aWxzLiRleHRyYV07CiAgY29uc3QgYXZhaWxhYmxlU3BhY2UgPSBleHRyYS5hdmFpbGFibGVTcGFjZTsKICBjb25zdCBbeCwgeSwgdywgaF0gPSBiYm94OwogIHN3aXRjaCAobm9kZS5sYXlvdXQpIHsKICAgIGNhc2UgInBvc2l0aW9uIjoKICAgICAgewogICAgICAgIGV4dHJhLndpZHRoID0gTWF0aC5tYXgoZXh0cmEud2lkdGgsIHggKyB3KTsKICAgICAgICBleHRyYS5oZWlnaHQgPSBNYXRoLm1heChleHRyYS5oZWlnaHQsIHkgKyBoKTsKICAgICAgICBleHRyYS5jaGlsZHJlbi5wdXNoKGh0bWwpOwogICAgICAgIGJyZWFrOwogICAgICB9CiAgICBjYXNlICJsci10YiI6CiAgICBjYXNlICJybC10YiI6CiAgICAgIGlmICghZXh0cmEubGluZSB8fCBleHRyYS5hdHRlbXB0ID09PSAxKSB7CiAgICAgICAgZXh0cmEubGluZSA9IGNyZWF0ZUxpbmUobm9kZSwgW10pOwogICAgICAgIGV4dHJhLmNoaWxkcmVuLnB1c2goZXh0cmEubGluZSk7CiAgICAgICAgZXh0cmEubnVtYmVySW5MaW5lID0gMDsKICAgICAgfQogICAgICBleHRyYS5udW1iZXJJbkxpbmUgKz0gMTsKICAgICAgZXh0cmEubGluZS5jaGlsZHJlbi5wdXNoKGh0bWwpOwogICAgICBpZiAoZXh0cmEuYXR0ZW1wdCA9PT0gMCkgewogICAgICAgIGV4dHJhLmN1cnJlbnRXaWR0aCArPSB3OwogICAgICAgIGV4dHJhLmhlaWdodCA9IE1hdGgubWF4KGV4dHJhLmhlaWdodCwgZXh0cmEucHJldkhlaWdodCArIGgpOwogICAgICB9IGVsc2UgewogICAgICAgIGV4dHJhLmN1cnJlbnRXaWR0aCA9IHc7CiAgICAgICAgZXh0cmEucHJldkhlaWdodCA9IGV4dHJhLmhlaWdodDsKICAgICAgICBleHRyYS5oZWlnaHQgKz0gaDsKICAgICAgICBleHRyYS5hdHRlbXB0ID0gMDsKICAgICAgfQogICAgICBleHRyYS53aWR0aCA9IE1hdGgubWF4KGV4dHJhLndpZHRoLCBleHRyYS5jdXJyZW50V2lkdGgpOwogICAgICBicmVhazsKICAgIGNhc2UgInJsLXJvdyI6CiAgICBjYXNlICJyb3ciOgogICAgICB7CiAgICAgICAgZXh0cmEuY2hpbGRyZW4ucHVzaChodG1sKTsKICAgICAgICBleHRyYS53aWR0aCArPSB3OwogICAgICAgIGV4dHJhLmhlaWdodCA9IE1hdGgubWF4KGV4dHJhLmhlaWdodCwgaCk7CiAgICAgICAgY29uc3QgaGVpZ2h0ID0gKDAsIF9odG1sX3V0aWxzLm1lYXN1cmVUb1N0cmluZykoZXh0cmEuaGVpZ2h0KTsKICAgICAgICBmb3IgKGNvbnN0IGNoaWxkIG9mIGV4dHJhLmNoaWxkcmVuKSB7CiAgICAgICAgICBjaGlsZC5hdHRyaWJ1dGVzLnN0eWxlLmhlaWdodCA9IGhlaWdodDsKICAgICAgICB9CiAgICAgICAgYnJlYWs7CiAgICAgIH0KICAgIGNhc2UgInRhYmxlIjoKICAgICAgewogICAgICAgIGV4dHJhLndpZHRoID0gTWF0aC5taW4oYXZhaWxhYmxlU3BhY2Uud2lkdGgsIE1hdGgubWF4KGV4dHJhLndpZHRoLCB3KSk7CiAgICAgICAgZXh0cmEuaGVpZ2h0ICs9IGg7CiAgICAgICAgZXh0cmEuY2hpbGRyZW4ucHVzaChodG1sKTsKICAgICAgICBicmVhazsKICAgICAgfQogICAgY2FzZSAidGIiOgogICAgICB7CiAgICAgICAgZXh0cmEud2lkdGggPSBNYXRoLm1pbihhdmFpbGFibGVTcGFjZS53aWR0aCwgTWF0aC5tYXgoZXh0cmEud2lkdGgsIHcpKTsKICAgICAgICBleHRyYS5oZWlnaHQgKz0gaDsKICAgICAgICBleHRyYS5jaGlsZHJlbi5wdXNoKGh0bWwpOwogICAgICAgIGJyZWFrOwogICAgICB9CiAgfQp9CmZ1bmN0aW9uIGdldEF2YWlsYWJsZVNwYWNlKG5vZGUpIHsKICBjb25zdCBhdmFpbGFibGVTcGFjZSA9IG5vZGVbX3N5bWJvbF91dGlscy4kZXh0cmFdLmF2YWlsYWJsZVNwYWNlOwogIGNvbnN0IG1hcmdpblYgPSBub2RlLm1hcmdpbiA/IG5vZGUubWFyZ2luLnRvcEluc2V0ICsgbm9kZS5tYXJnaW4uYm90dG9tSW5zZXQgOiAwOwogIGNvbnN0IG1hcmdpbkggPSBub2RlLm1hcmdpbiA/IG5vZGUubWFyZ2luLmxlZnRJbnNldCArIG5vZGUubWFyZ2luLnJpZ2h0SW5zZXQgOiAwOwogIHN3aXRjaCAobm9kZS5sYXlvdXQpIHsKICAgIGNhc2UgImxyLXRiIjoKICAgIGNhc2UgInJsLXRiIjoKICAgICAgaWYgKG5vZGVbX3N5bWJvbF91dGlscy4kZXh0cmFdLmF0dGVtcHQgPT09IDApIHsKICAgICAgICByZXR1cm4gewogICAgICAgICAgd2lkdGg6IGF2YWlsYWJsZVNwYWNlLndpZHRoIC0gbWFyZ2luSCAtIG5vZGVbX3N5bWJvbF91dGlscy4kZXh0cmFdLmN1cnJlbnRXaWR0aCwKICAgICAgICAgIGhlaWdodDogYXZhaWxhYmxlU3BhY2UuaGVpZ2h0IC0gbWFyZ2luViAtIG5vZGVbX3N5bWJvbF91dGlscy4kZXh0cmFdLnByZXZIZWlnaHQKICAgICAgICB9OwogICAgICB9CiAgICAgIHJldHVybiB7CiAgICAgICAgd2lkdGg6IGF2YWlsYWJsZVNwYWNlLndpZHRoIC0gbWFyZ2luSCwKICAgICAgICBoZWlnaHQ6IGF2YWlsYWJsZVNwYWNlLmhlaWdodCAtIG1hcmdpblYgLSBub2RlW19zeW1ib2xfdXRpbHMuJGV4dHJhXS5oZWlnaHQKICAgICAgfTsKICAgIGNhc2UgInJsLXJvdyI6CiAgICBjYXNlICJyb3ciOgogICAgICBjb25zdCB3aWR0aCA9IG5vZGVbX3N5bWJvbF91dGlscy4kZXh0cmFdLmNvbHVtbldpZHRocy5zbGljZShub2RlW19zeW1ib2xfdXRpbHMuJGV4dHJhXS5jdXJyZW50Q29sdW1uKS5yZWR1Y2UoKGEsIHgpID0+IGEgKyB4KTsKICAgICAgcmV0dXJuIHsKICAgICAgICB3aWR0aCwKICAgICAgICBoZWlnaHQ6IGF2YWlsYWJsZVNwYWNlLmhlaWdodCAtIG1hcmdpbkgKICAgICAgfTsKICAgIGNhc2UgInRhYmxlIjoKICAgIGNhc2UgInRiIjoKICAgICAgcmV0dXJuIHsKICAgICAgICB3aWR0aDogYXZhaWxhYmxlU3BhY2Uud2lkdGggLSBtYXJnaW5ILAogICAgICAgIGhlaWdodDogYXZhaWxhYmxlU3BhY2UuaGVpZ2h0IC0gbWFyZ2luViAtIG5vZGVbX3N5bWJvbF91dGlscy4kZXh0cmFdLmhlaWdodAogICAgICB9OwogICAgY2FzZSAicG9zaXRpb24iOgogICAgZGVmYXVsdDoKICAgICAgcmV0dXJuIGF2YWlsYWJsZVNwYWNlOwogIH0KfQpmdW5jdGlvbiBnZXRUcmFuc2Zvcm1lZEJCb3gobm9kZSkgewogIGxldCB3ID0gbm9kZS53ID09PSAiIiA/IE5hTiA6IG5vZGUudzsKICBsZXQgaCA9IG5vZGUuaCA9PT0gIiIgPyBOYU4gOiBub2RlLmg7CiAgbGV0IFtjZW50ZXJYLCBjZW50ZXJZXSA9IFswLCAwXTsKICBzd2l0Y2ggKG5vZGUuYW5jaG9yVHlwZSB8fCAiIikgewogICAgY2FzZSAiYm90dG9tQ2VudGVyIjoKICAgICAgW2NlbnRlclgsIGNlbnRlclldID0gW3cgLyAyLCBoXTsKICAgICAgYnJlYWs7CiAgICBjYXNlICJib3R0b21MZWZ0IjoKICAgICAgW2NlbnRlclgsIGNlbnRlclldID0gWzAsIGhdOwogICAgICBicmVhazsKICAgIGNhc2UgImJvdHRvbVJpZ2h0IjoKICAgICAgW2NlbnRlclgsIGNlbnRlclldID0gW3csIGhdOwogICAgICBicmVhazsKICAgIGNhc2UgIm1pZGRsZUNlbnRlciI6CiAgICAgIFtjZW50ZXJYLCBjZW50ZXJZXSA9IFt3IC8gMiwgaCAvIDJdOwogICAgICBicmVhazsKICAgIGNhc2UgIm1pZGRsZUxlZnQiOgogICAgICBbY2VudGVyWCwgY2VudGVyWV0gPSBbMCwgaCAvIDJdOwogICAgICBicmVhazsKICAgIGNhc2UgIm1pZGRsZVJpZ2h0IjoKICAgICAgW2NlbnRlclgsIGNlbnRlclldID0gW3csIGggLyAyXTsKICAgICAgYnJlYWs7CiAgICBjYXNlICJ0b3BDZW50ZXIiOgogICAgICBbY2VudGVyWCwgY2VudGVyWV0gPSBbdyAvIDIsIDBdOwogICAgICBicmVhazsKICAgIGNhc2UgInRvcFJpZ2h0IjoKICAgICAgW2NlbnRlclgsIGNlbnRlclldID0gW3csIDBdOwogICAgICBicmVhazsKICB9CiAgbGV0IHgsIHk7CiAgc3dpdGNoIChub2RlLnJvdGF0ZSB8fCAwKSB7CiAgICBjYXNlIDA6CiAgICAgIFt4LCB5XSA9IFstY2VudGVyWCwgLWNlbnRlclldOwogICAgICBicmVhazsKICAgIGNhc2UgOTA6CiAgICAgIFt4LCB5XSA9IFstY2VudGVyWSwgY2VudGVyWF07CiAgICAgIFt3LCBoXSA9IFtoLCAtd107CiAgICAgIGJyZWFrOwogICAgY2FzZSAxODA6CiAgICAgIFt4LCB5XSA9IFtjZW50ZXJYLCBjZW50ZXJZXTsKICAgICAgW3csIGhdID0gWy13LCAtaF07CiAgICAgIGJyZWFrOwogICAgY2FzZSAyNzA6CiAgICAgIFt4LCB5XSA9IFtjZW50ZXJZLCAtY2VudGVyWF07CiAgICAgIFt3LCBoXSA9IFstaCwgd107CiAgICAgIGJyZWFrOwogIH0KICByZXR1cm4gW25vZGUueCArIHggKyBNYXRoLm1pbigwLCB3KSwgbm9kZS55ICsgeSArIE1hdGgubWluKDAsIGgpLCBNYXRoLmFicyh3KSwgTWF0aC5hYnMoaCldOwp9CmZ1bmN0aW9uIGNoZWNrRGltZW5zaW9ucyhub2RlLCBzcGFjZSkgewogIGlmIChub2RlW19zeW1ib2xfdXRpbHMuJGdldFRlbXBsYXRlUm9vdF0oKVtfc3ltYm9sX3V0aWxzLiRleHRyYV0uZmlyc3RVbnNwbGl0dGFibGUgPT09IG51bGwpIHsKICAgIHJldHVybiB0cnVlOwogIH0KICBpZiAobm9kZS53ID09PSAwIHx8IG5vZGUuaCA9PT0gMCkgewogICAgcmV0dXJuIHRydWU7CiAgfQogIGNvbnN0IEVSUk9SID0gMjsKICBjb25zdCBwYXJlbnQgPSBub2RlW19zeW1ib2xfdXRpbHMuJGdldFN1YmZvcm1QYXJlbnRdKCk7CiAgY29uc3QgYXR0ZW1wdCA9IHBhcmVudFtfc3ltYm9sX3V0aWxzLiRleHRyYV0/LmF0dGVtcHQgfHwgMDsKICBjb25zdCBbLCB5LCB3LCBoXSA9IGdldFRyYW5zZm9ybWVkQkJveChub2RlKTsKICBzd2l0Y2ggKHBhcmVudC5sYXlvdXQpIHsKICAgIGNhc2UgImxyLXRiIjoKICAgIGNhc2UgInJsLXRiIjoKICAgICAgaWYgKGF0dGVtcHQgPT09IDApIHsKICAgICAgICBpZiAoIW5vZGVbX3N5bWJvbF91dGlscy4kZ2V0VGVtcGxhdGVSb290XSgpW19zeW1ib2xfdXRpbHMuJGV4dHJhXS5ub0xheW91dEZhaWx1cmUpIHsKICAgICAgICAgIGlmIChub2RlLmggIT09ICIiICYmIE1hdGgucm91bmQoaCAtIHNwYWNlLmhlaWdodCkgPiBFUlJPUikgewogICAgICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgICAgICB9CiAgICAgICAgICBpZiAobm9kZS53ICE9PSAiIikgewogICAgICAgICAgICBpZiAoTWF0aC5yb3VuZCh3IC0gc3BhY2Uud2lkdGgpIDw9IEVSUk9SKSB7CiAgICAgICAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgaWYgKHBhcmVudFtfc3ltYm9sX3V0aWxzLiRleHRyYV0ubnVtYmVySW5MaW5lID09PSAwKSB7CiAgICAgICAgICAgICAgcmV0dXJuIHNwYWNlLmhlaWdodCA+IEVSUk9SOwogICAgICAgICAgICB9CiAgICAgICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgICAgIH0KICAgICAgICAgIHJldHVybiBzcGFjZS53aWR0aCA+IEVSUk9SOwogICAgICAgIH0KICAgICAgICBpZiAobm9kZS53ICE9PSAiIikgewogICAgICAgICAgcmV0dXJuIE1hdGgucm91bmQodyAtIHNwYWNlLndpZHRoKSA8PSBFUlJPUjsKICAgICAgICB9CiAgICAgICAgcmV0dXJuIHNwYWNlLndpZHRoID4gRVJST1I7CiAgICAgIH0KICAgICAgaWYgKG5vZGVbX3N5bWJvbF91dGlscy4kZ2V0VGVtcGxhdGVSb290XSgpW19zeW1ib2xfdXRpbHMuJGV4dHJhXS5ub0xheW91dEZhaWx1cmUpIHsKICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgfQogICAgICBpZiAobm9kZS5oICE9PSAiIiAmJiBNYXRoLnJvdW5kKGggLSBzcGFjZS5oZWlnaHQpID4gRVJST1IpIHsKICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgIH0KICAgICAgaWYgKG5vZGUudyA9PT0gIiIgfHwgTWF0aC5yb3VuZCh3IC0gc3BhY2Uud2lkdGgpIDw9IEVSUk9SKSB7CiAgICAgICAgcmV0dXJuIHNwYWNlLmhlaWdodCA+IEVSUk9SOwogICAgICB9CiAgICAgIGlmIChwYXJlbnRbX3N5bWJvbF91dGlscy4kaXNUaGVyZU1vcmVXaWR0aF0oKSkgewogICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgfQogICAgICByZXR1cm4gc3BhY2UuaGVpZ2h0ID4gRVJST1I7CiAgICBjYXNlICJ0YWJsZSI6CiAgICBjYXNlICJ0YiI6CiAgICAgIGlmIChub2RlW19zeW1ib2xfdXRpbHMuJGdldFRlbXBsYXRlUm9vdF0oKVtfc3ltYm9sX3V0aWxzLiRleHRyYV0ubm9MYXlvdXRGYWlsdXJlKSB7CiAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgIH0KICAgICAgaWYgKG5vZGUuaCAhPT0gIiIgJiYgIW5vZGVbX3N5bWJvbF91dGlscy4kaXNTcGxpdHRhYmxlXSgpKSB7CiAgICAgICAgcmV0dXJuIE1hdGgucm91bmQoaCAtIHNwYWNlLmhlaWdodCkgPD0gRVJST1I7CiAgICAgIH0KICAgICAgaWYgKG5vZGUudyA9PT0gIiIgfHwgTWF0aC5yb3VuZCh3IC0gc3BhY2Uud2lkdGgpIDw9IEVSUk9SKSB7CiAgICAgICAgcmV0dXJuIHNwYWNlLmhlaWdodCA+IEVSUk9SOwogICAgICB9CiAgICAgIGlmIChwYXJlbnRbX3N5bWJvbF91dGlscy4kaXNUaGVyZU1vcmVXaWR0aF0oKSkgewogICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgfQogICAgICByZXR1cm4gc3BhY2UuaGVpZ2h0ID4gRVJST1I7CiAgICBjYXNlICJwb3NpdGlvbiI6CiAgICAgIGlmIChub2RlW19zeW1ib2xfdXRpbHMuJGdldFRlbXBsYXRlUm9vdF0oKVtfc3ltYm9sX3V0aWxzLiRleHRyYV0ubm9MYXlvdXRGYWlsdXJlKSB7CiAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgIH0KICAgICAgaWYgKG5vZGUuaCA9PT0gIiIgfHwgTWF0aC5yb3VuZChoICsgeSAtIHNwYWNlLmhlaWdodCkgPD0gRVJST1IpIHsKICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgfQogICAgICBjb25zdCBhcmVhID0gbm9kZVtfc3ltYm9sX3V0aWxzLiRnZXRUZW1wbGF0ZVJvb3RdKClbX3N5bWJvbF91dGlscy4kZXh0cmFdLmN1cnJlbnRDb250ZW50QXJlYTsKICAgICAgcmV0dXJuIGggKyB5ID4gYXJlYS5oOwogICAgY2FzZSAicmwtcm93IjoKICAgIGNhc2UgInJvdyI6CiAgICAgIGlmIChub2RlW19zeW1ib2xfdXRpbHMuJGdldFRlbXBsYXRlUm9vdF0oKVtfc3ltYm9sX3V0aWxzLiRleHRyYV0ubm9MYXlvdXRGYWlsdXJlKSB7CiAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgIH0KICAgICAgaWYgKG5vZGUuaCAhPT0gIiIpIHsKICAgICAgICByZXR1cm4gTWF0aC5yb3VuZChoIC0gc3BhY2UuaGVpZ2h0KSA8PSBFUlJPUjsKICAgICAgfQogICAgICByZXR1cm4gdHJ1ZTsKICAgIGRlZmF1bHQ6CiAgICAgIHJldHVybiB0cnVlOwogIH0KfQoKLyoqKi8gfSksCi8qIDgzICovCi8qKiovICgoX191bnVzZWRfd2VicGFja19tb2R1bGUsIGV4cG9ydHMsIF9fd19wZGZqc19yZXF1aXJlX18pID0+IHsKCgoKT2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsICJfX2VzTW9kdWxlIiwgKHsKICB2YWx1ZTogdHJ1ZQp9KSk7CmV4cG9ydHMuY29tcHV0ZUJib3ggPSBjb21wdXRlQmJveDsKZXhwb3J0cy5jcmVhdGVXcmFwcGVyID0gY3JlYXRlV3JhcHBlcjsKZXhwb3J0cy5maXhEaW1lbnNpb25zID0gZml4RGltZW5zaW9uczsKZXhwb3J0cy5maXhUZXh0SW5kZW50ID0gZml4VGV4dEluZGVudDsKZXhwb3J0cy5maXhVUkwgPSBmaXhVUkw7CmV4cG9ydHMuaXNQcmludE9ubHkgPSBpc1ByaW50T25seTsKZXhwb3J0cy5sYXlvdXRDbGFzcyA9IGxheW91dENsYXNzOwpleHBvcnRzLmxheW91dE5vZGUgPSBsYXlvdXROb2RlOwpleHBvcnRzLm1lYXN1cmVUb1N0cmluZyA9IG1lYXN1cmVUb1N0cmluZzsKZXhwb3J0cy5zZXRBY2Nlc3MgPSBzZXRBY2Nlc3M7CmV4cG9ydHMuc2V0Rm9udEZhbWlseSA9IHNldEZvbnRGYW1pbHk7CmV4cG9ydHMuc2V0TWluTWF4RGltZW5zaW9ucyA9IHNldE1pbk1heERpbWVuc2lvbnM7CmV4cG9ydHMuc2V0UGFyYSA9IHNldFBhcmE7CmV4cG9ydHMudG9TdHlsZSA9IHRvU3R5bGU7CnZhciBfc3ltYm9sX3V0aWxzID0gX193X3BkZmpzX3JlcXVpcmVfXyg3OCk7CnZhciBfdXRpbCA9IF9fd19wZGZqc19yZXF1aXJlX18oMik7CnZhciBfdXRpbHMgPSBfX3dfcGRmanNfcmVxdWlyZV9fKDg0KTsKdmFyIF9mb250cyA9IF9fd19wZGZqc19yZXF1aXJlX18oODUpOwp2YXIgX3RleHQgPSBfX3dfcGRmanNfcmVxdWlyZV9fKDg2KTsKdmFyIF94ZmFfb2JqZWN0ID0gX193X3BkZmpzX3JlcXVpcmVfXyg4Nyk7CmZ1bmN0aW9uIG1lYXN1cmVUb1N0cmluZyhtKSB7CiAgaWYgKHR5cGVvZiBtID09PSAic3RyaW5nIikgewogICAgcmV0dXJuICIwcHgiOwogIH0KICByZXR1cm4gTnVtYmVyLmlzSW50ZWdlcihtKSA/IGAke219cHhgIDogYCR7bS50b0ZpeGVkKDIpfXB4YDsKfQpjb25zdCBjb252ZXJ0ZXJzID0gewogIGFuY2hvclR5cGUobm9kZSwgc3R5bGUpIHsKICAgIGNvbnN0IHBhcmVudCA9IG5vZGVbX3N5bWJvbF91dGlscy4kZ2V0U3ViZm9ybVBhcmVudF0oKTsKICAgIGlmICghcGFyZW50IHx8IHBhcmVudC5sYXlvdXQgJiYgcGFyZW50LmxheW91dCAhPT0gInBvc2l0aW9uIikgewogICAgICByZXR1cm47CiAgICB9CiAgICBpZiAoISgidHJhbnNmb3JtIiBpbiBzdHlsZSkpIHsKICAgICAgc3R5bGUudHJhbnNmb3JtID0gIiI7CiAgICB9CiAgICBzd2l0Y2ggKG5vZGUuYW5jaG9yVHlwZSkgewogICAgICBjYXNlICJib3R0b21DZW50ZXIiOgogICAgICAgIHN0eWxlLnRyYW5zZm9ybSArPSAidHJhbnNsYXRlKC01MCUsIC0xMDAlKSI7CiAgICAgICAgYnJlYWs7CiAgICAgIGNhc2UgImJvdHRvbUxlZnQiOgogICAgICAgIHN0eWxlLnRyYW5zZm9ybSArPSAidHJhbnNsYXRlKDAsLTEwMCUpIjsKICAgICAgICBicmVhazsKICAgICAgY2FzZSAiYm90dG9tUmlnaHQiOgogICAgICAgIHN0eWxlLnRyYW5zZm9ybSArPSAidHJhbnNsYXRlKC0xMDAlLC0xMDAlKSI7CiAgICAgICAgYnJlYWs7CiAgICAgIGNhc2UgIm1pZGRsZUNlbnRlciI6CiAgICAgICAgc3R5bGUudHJhbnNmb3JtICs9ICJ0cmFuc2xhdGUoLTUwJSwtNTAlKSI7CiAgICAgICAgYnJlYWs7CiAgICAgIGNhc2UgIm1pZGRsZUxlZnQiOgogICAgICAgIHN0eWxlLnRyYW5zZm9ybSArPSAidHJhbnNsYXRlKDAsLTUwJSkiOwogICAgICAgIGJyZWFrOwogICAgICBjYXNlICJtaWRkbGVSaWdodCI6CiAgICAgICAgc3R5bGUudHJhbnNmb3JtICs9ICJ0cmFuc2xhdGUoLTEwMCUsLTUwJSkiOwogICAgICAgIGJyZWFrOwogICAgICBjYXNlICJ0b3BDZW50ZXIiOgogICAgICAgIHN0eWxlLnRyYW5zZm9ybSArPSAidHJhbnNsYXRlKC01MCUsMCkiOwogICAgICAgIGJyZWFrOwogICAgICBjYXNlICJ0b3BSaWdodCI6CiAgICAgICAgc3R5bGUudHJhbnNmb3JtICs9ICJ0cmFuc2xhdGUoLTEwMCUsMCkiOwogICAgICAgIGJyZWFrOwogICAgfQogIH0sCiAgZGltZW5zaW9ucyhub2RlLCBzdHlsZSkgewogICAgY29uc3QgcGFyZW50ID0gbm9kZVtfc3ltYm9sX3V0aWxzLiRnZXRTdWJmb3JtUGFyZW50XSgpOwogICAgbGV0IHdpZHRoID0gbm9kZS53OwogICAgY29uc3QgaGVpZ2h0ID0gbm9kZS5oOwogICAgaWYgKHBhcmVudC5sYXlvdXQ/LmluY2x1ZGVzKCJyb3ciKSkgewogICAgICBjb25zdCBleHRyYSA9IHBhcmVudFtfc3ltYm9sX3V0aWxzLiRleHRyYV07CiAgICAgIGNvbnN0IGNvbFNwYW4gPSBub2RlLmNvbFNwYW47CiAgICAgIGxldCB3OwogICAgICBpZiAoY29sU3BhbiA9PT0gLTEpIHsKICAgICAgICB3ID0gZXh0cmEuY29sdW1uV2lkdGhzLnNsaWNlKGV4dHJhLmN1cnJlbnRDb2x1bW4pLnJlZHVjZSgoYSwgeCkgPT4gYSArIHgsIDApOwogICAgICAgIGV4dHJhLmN1cnJlbnRDb2x1bW4gPSAwOwogICAgICB9IGVsc2UgewogICAgICAgIHcgPSBleHRyYS5jb2x1bW5XaWR0aHMuc2xpY2UoZXh0cmEuY3VycmVudENvbHVtbiwgZXh0cmEuY3VycmVudENvbHVtbiArIGNvbFNwYW4pLnJlZHVjZSgoYSwgeCkgPT4gYSArIHgsIDApOwogICAgICAgIGV4dHJhLmN1cnJlbnRDb2x1bW4gPSAoZXh0cmEuY3VycmVudENvbHVtbiArIG5vZGUuY29sU3BhbikgJSBleHRyYS5jb2x1bW5XaWR0aHMubGVuZ3RoOwogICAgICB9CiAgICAgIGlmICghaXNOYU4odykpIHsKICAgICAgICB3aWR0aCA9IG5vZGUudyA9IHc7CiAgICAgIH0KICAgIH0KICAgIHN0eWxlLndpZHRoID0gd2lkdGggIT09ICIiID8gbWVhc3VyZVRvU3RyaW5nKHdpZHRoKSA6ICJhdXRvIjsKICAgIHN0eWxlLmhlaWdodCA9IGhlaWdodCAhPT0gIiIgPyBtZWFzdXJlVG9TdHJpbmcoaGVpZ2h0KSA6ICJhdXRvIjsKICB9LAogIHBvc2l0aW9uKG5vZGUsIHN0eWxlKSB7CiAgICBjb25zdCBwYXJlbnQgPSBub2RlW19zeW1ib2xfdXRpbHMuJGdldFN1YmZvcm1QYXJlbnRdKCk7CiAgICBpZiAocGFyZW50Py5sYXlvdXQgJiYgcGFyZW50LmxheW91dCAhPT0gInBvc2l0aW9uIikgewogICAgICByZXR1cm47CiAgICB9CiAgICBzdHlsZS5wb3NpdGlvbiA9ICJhYnNvbHV0ZSI7CiAgICBzdHlsZS5sZWZ0ID0gbWVhc3VyZVRvU3RyaW5nKG5vZGUueCk7CiAgICBzdHlsZS50b3AgPSBtZWFzdXJlVG9TdHJpbmcobm9kZS55KTsKICB9LAogIHJvdGF0ZShub2RlLCBzdHlsZSkgewogICAgaWYgKG5vZGUucm90YXRlKSB7CiAgICAgIGlmICghKCJ0cmFuc2Zvcm0iIGluIHN0eWxlKSkgewogICAgICAgIHN0eWxlLnRyYW5zZm9ybSA9ICIiOwogICAgICB9CiAgICAgIHN0eWxlLnRyYW5zZm9ybSArPSBgcm90YXRlKC0ke25vZGUucm90YXRlfWRlZylgOwogICAgICBzdHlsZS50cmFuc2Zvcm1PcmlnaW4gPSAidG9wIGxlZnQiOwogICAgfQogIH0sCiAgcHJlc2VuY2Uobm9kZSwgc3R5bGUpIHsKICAgIHN3aXRjaCAobm9kZS5wcmVzZW5jZSkgewogICAgICBjYXNlICJpbnZpc2libGUiOgogICAgICAgIHN0eWxlLnZpc2liaWxpdHkgPSAiaGlkZGVuIjsKICAgICAgICBicmVhazsKICAgICAgY2FzZSAiaGlkZGVuIjoKICAgICAgY2FzZSAiaW5hY3RpdmUiOgogICAgICAgIHN0eWxlLmRpc3BsYXkgPSAibm9uZSI7CiAgICAgICAgYnJlYWs7CiAgICB9CiAgfSwKICBoQWxpZ24obm9kZSwgc3R5bGUpIHsKICAgIGlmIChub2RlW19zeW1ib2xfdXRpbHMuJG5vZGVOYW1lXSA9PT0gInBhcmEiKSB7CiAgICAgIHN3aXRjaCAobm9kZS5oQWxpZ24pIHsKICAgICAgICBjYXNlICJqdXN0aWZ5QWxsIjoKICAgICAgICAgIHN0eWxlLnRleHRBbGlnbiA9ICJqdXN0aWZ5LWFsbCI7CiAgICAgICAgICBicmVhazsKICAgICAgICBjYXNlICJyYWRpeCI6CiAgICAgICAgICBzdHlsZS50ZXh0QWxpZ24gPSAibGVmdCI7CiAgICAgICAgICBicmVhazsKICAgICAgICBkZWZhdWx0OgogICAgICAgICAgc3R5bGUudGV4dEFsaWduID0gbm9kZS5oQWxpZ247CiAgICAgIH0KICAgIH0gZWxzZSB7CiAgICAgIHN3aXRjaCAobm9kZS5oQWxpZ24pIHsKICAgICAgICBjYXNlICJsZWZ0IjoKICAgICAgICAgIHN0eWxlLmFsaWduU2VsZiA9ICJzdGFydCI7CiAgICAgICAgICBicmVhazsKICAgICAgICBjYXNlICJjZW50ZXIiOgogICAgICAgICAgc3R5bGUuYWxpZ25TZWxmID0gImNlbnRlciI7CiAgICAgICAgICBicmVhazsKICAgICAgICBjYXNlICJyaWdodCI6CiAgICAgICAgICBzdHlsZS5hbGlnblNlbGYgPSAiZW5kIjsKICAgICAgICAgIGJyZWFrOwogICAgICB9CiAgICB9CiAgfSwKICBtYXJnaW4obm9kZSwgc3R5bGUpIHsKICAgIGlmIChub2RlLm1hcmdpbikgewogICAgICBzdHlsZS5tYXJnaW4gPSBub2RlLm1hcmdpbltfc3ltYm9sX3V0aWxzLiR0b1N0eWxlXSgpLm1hcmdpbjsKICAgIH0KICB9Cn07CmZ1bmN0aW9uIHNldE1pbk1heERpbWVuc2lvbnMobm9kZSwgc3R5bGUpIHsKICBjb25zdCBwYXJlbnQgPSBub2RlW19zeW1ib2xfdXRpbHMuJGdldFN1YmZvcm1QYXJlbnRdKCk7CiAgaWYgKHBhcmVudC5sYXlvdXQgPT09ICJwb3NpdGlvbiIpIHsKICAgIGlmIChub2RlLm1pblcgPiAwKSB7CiAgICAgIHN0eWxlLm1pbldpZHRoID0gbWVhc3VyZVRvU3RyaW5nKG5vZGUubWluVyk7CiAgICB9CiAgICBpZiAobm9kZS5tYXhXID4gMCkgewogICAgICBzdHlsZS5tYXhXaWR0aCA9IG1lYXN1cmVUb1N0cmluZyhub2RlLm1heFcpOwogICAgfQogICAgaWYgKG5vZGUubWluSCA+IDApIHsKICAgICAgc3R5bGUubWluSGVpZ2h0ID0gbWVhc3VyZVRvU3RyaW5nKG5vZGUubWluSCk7CiAgICB9CiAgICBpZiAobm9kZS5tYXhIID4gMCkgewogICAgICBzdHlsZS5tYXhIZWlnaHQgPSBtZWFzdXJlVG9TdHJpbmcobm9kZS5tYXhIKTsKICAgIH0KICB9Cn0KZnVuY3Rpb24gbGF5b3V0VGV4dCh0ZXh0LCB4ZmFGb250LCBtYXJnaW4sIGxpbmVIZWlnaHQsIGZvbnRGaW5kZXIsIHdpZHRoKSB7CiAgY29uc3QgbWVhc3VyZSA9IG5ldyBfdGV4dC5UZXh0TWVhc3VyZSh4ZmFGb250LCBtYXJnaW4sIGxpbmVIZWlnaHQsIGZvbnRGaW5kZXIpOwogIGlmICh0eXBlb2YgdGV4dCA9PT0gInN0cmluZyIpIHsKICAgIG1lYXN1cmUuYWRkU3RyaW5nKHRleHQpOwogIH0gZWxzZSB7CiAgICB0ZXh0W19zeW1ib2xfdXRpbHMuJHB1c2hHbHlwaHNdKG1lYXN1cmUpOwogIH0KICByZXR1cm4gbWVhc3VyZS5jb21wdXRlKHdpZHRoKTsKfQpmdW5jdGlvbiBsYXlvdXROb2RlKG5vZGUsIGF2YWlsYWJsZVNwYWNlKSB7CiAgbGV0IGhlaWdodCA9IG51bGw7CiAgbGV0IHdpZHRoID0gbnVsbDsKICBsZXQgaXNCcm9rZW4gPSBmYWxzZTsKICBpZiAoKCFub2RlLncgfHwgIW5vZGUuaCkgJiYgbm9kZS52YWx1ZSkgewogICAgbGV0IG1hcmdpbkggPSAwOwogICAgbGV0IG1hcmdpblYgPSAwOwogICAgaWYgKG5vZGUubWFyZ2luKSB7CiAgICAgIG1hcmdpbkggPSBub2RlLm1hcmdpbi5sZWZ0SW5zZXQgKyBub2RlLm1hcmdpbi5yaWdodEluc2V0OwogICAgICBtYXJnaW5WID0gbm9kZS5tYXJnaW4udG9wSW5zZXQgKyBub2RlLm1hcmdpbi5ib3R0b21JbnNldDsKICAgIH0KICAgIGxldCBsaW5lSGVpZ2h0ID0gbnVsbDsKICAgIGxldCBtYXJnaW4gPSBudWxsOwogICAgaWYgKG5vZGUucGFyYSkgewogICAgICBtYXJnaW4gPSBPYmplY3QuY3JlYXRlKG51bGwpOwogICAgICBsaW5lSGVpZ2h0ID0gbm9kZS5wYXJhLmxpbmVIZWlnaHQgPT09ICIiID8gbnVsbCA6IG5vZGUucGFyYS5saW5lSGVpZ2h0OwogICAgICBtYXJnaW4udG9wID0gbm9kZS5wYXJhLnNwYWNlQWJvdmUgPT09ICIiID8gMCA6IG5vZGUucGFyYS5zcGFjZUFib3ZlOwogICAgICBtYXJnaW4uYm90dG9tID0gbm9kZS5wYXJhLnNwYWNlQmVsb3cgPT09ICIiID8gMCA6IG5vZGUucGFyYS5zcGFjZUJlbG93OwogICAgICBtYXJnaW4ubGVmdCA9IG5vZGUucGFyYS5tYXJnaW5MZWZ0ID09PSAiIiA/IDAgOiBub2RlLnBhcmEubWFyZ2luTGVmdDsKICAgICAgbWFyZ2luLnJpZ2h0ID0gbm9kZS5wYXJhLm1hcmdpblJpZ2h0ID09PSAiIiA/IDAgOiBub2RlLnBhcmEubWFyZ2luUmlnaHQ7CiAgICB9CiAgICBsZXQgZm9udCA9IG5vZGUuZm9udDsKICAgIGlmICghZm9udCkgewogICAgICBjb25zdCByb290ID0gbm9kZVtfc3ltYm9sX3V0aWxzLiRnZXRUZW1wbGF0ZVJvb3RdKCk7CiAgICAgIGxldCBwYXJlbnQgPSBub2RlW19zeW1ib2xfdXRpbHMuJGdldFBhcmVudF0oKTsKICAgICAgd2hpbGUgKHBhcmVudCAmJiBwYXJlbnQgIT09IHJvb3QpIHsKICAgICAgICBpZiAocGFyZW50LmZvbnQpIHsKICAgICAgICAgIGZvbnQgPSBwYXJlbnQuZm9udDsKICAgICAgICAgIGJyZWFrOwogICAgICAgIH0KICAgICAgICBwYXJlbnQgPSBwYXJlbnRbX3N5bWJvbF91dGlscy4kZ2V0UGFyZW50XSgpOwogICAgICB9CiAgICB9CiAgICBjb25zdCBtYXhXaWR0aCA9IChub2RlLncgfHwgYXZhaWxhYmxlU3BhY2Uud2lkdGgpIC0gbWFyZ2luSDsKICAgIGNvbnN0IGZvbnRGaW5kZXIgPSBub2RlW19zeW1ib2xfdXRpbHMuJGdsb2JhbERhdGFdLmZvbnRGaW5kZXI7CiAgICBpZiAobm9kZS52YWx1ZS5leERhdGEgJiYgbm9kZS52YWx1ZS5leERhdGFbX3N5bWJvbF91dGlscy4kY29udGVudF0gJiYgbm9kZS52YWx1ZS5leERhdGEuY29udGVudFR5cGUgPT09ICJ0ZXh0L2h0bWwiKSB7CiAgICAgIGNvbnN0IHJlcyA9IGxheW91dFRleHQobm9kZS52YWx1ZS5leERhdGFbX3N5bWJvbF91dGlscy4kY29udGVudF0sIGZvbnQsIG1hcmdpbiwgbGluZUhlaWdodCwgZm9udEZpbmRlciwgbWF4V2lkdGgpOwogICAgICB3aWR0aCA9IHJlcy53aWR0aDsKICAgICAgaGVpZ2h0ID0gcmVzLmhlaWdodDsKICAgICAgaXNCcm9rZW4gPSByZXMuaXNCcm9rZW47CiAgICB9IGVsc2UgewogICAgICBjb25zdCB0ZXh0ID0gbm9kZS52YWx1ZVtfc3ltYm9sX3V0aWxzLiR0ZXh0XSgpOwogICAgICBpZiAodGV4dCkgewogICAgICAgIGNvbnN0IHJlcyA9IGxheW91dFRleHQodGV4dCwgZm9udCwgbWFyZ2luLCBsaW5lSGVpZ2h0LCBmb250RmluZGVyLCBtYXhXaWR0aCk7CiAgICAgICAgd2lkdGggPSByZXMud2lkdGg7CiAgICAgICAgaGVpZ2h0ID0gcmVzLmhlaWdodDsKICAgICAgICBpc0Jyb2tlbiA9IHJlcy5pc0Jyb2tlbjsKICAgICAgfQogICAgfQogICAgaWYgKHdpZHRoICE9PSBudWxsICYmICFub2RlLncpIHsKICAgICAgd2lkdGggKz0gbWFyZ2luSDsKICAgIH0KICAgIGlmIChoZWlnaHQgIT09IG51bGwgJiYgIW5vZGUuaCkgewogICAgICBoZWlnaHQgKz0gbWFyZ2luVjsKICAgIH0KICB9CiAgcmV0dXJuIHsKICAgIHc6IHdpZHRoLAogICAgaDogaGVpZ2h0LAogICAgaXNCcm9rZW4KICB9Owp9CmZ1bmN0aW9uIGNvbXB1dGVCYm94KG5vZGUsIGh0bWwsIGF2YWlsYWJsZVNwYWNlKSB7CiAgbGV0IGJib3g7CiAgaWYgKG5vZGUudyAhPT0gIiIgJiYgbm9kZS5oICE9PSAiIikgewogICAgYmJveCA9IFtub2RlLngsIG5vZGUueSwgbm9kZS53LCBub2RlLmhdOwogIH0gZWxzZSB7CiAgICBpZiAoIWF2YWlsYWJsZVNwYWNlKSB7CiAgICAgIHJldHVybiBudWxsOwogICAgfQogICAgbGV0IHdpZHRoID0gbm9kZS53OwogICAgaWYgKHdpZHRoID09PSAiIikgewogICAgICBpZiAobm9kZS5tYXhXID09PSAwKSB7CiAgICAgICAgY29uc3QgcGFyZW50ID0gbm9kZVtfc3ltYm9sX3V0aWxzLiRnZXRTdWJmb3JtUGFyZW50XSgpOwogICAgICAgIHdpZHRoID0gcGFyZW50LmxheW91dCA9PT0gInBvc2l0aW9uIiAmJiBwYXJlbnQudyAhPT0gIiIgPyAwIDogbm9kZS5taW5XOwogICAgICB9IGVsc2UgewogICAgICAgIHdpZHRoID0gTWF0aC5taW4obm9kZS5tYXhXLCBhdmFpbGFibGVTcGFjZS53aWR0aCk7CiAgICAgIH0KICAgICAgaHRtbC5hdHRyaWJ1dGVzLnN0eWxlLndpZHRoID0gbWVhc3VyZVRvU3RyaW5nKHdpZHRoKTsKICAgIH0KICAgIGxldCBoZWlnaHQgPSBub2RlLmg7CiAgICBpZiAoaGVpZ2h0ID09PSAiIikgewogICAgICBpZiAobm9kZS5tYXhIID09PSAwKSB7CiAgICAgICAgY29uc3QgcGFyZW50ID0gbm9kZVtfc3ltYm9sX3V0aWxzLiRnZXRTdWJmb3JtUGFyZW50XSgpOwogICAgICAgIGhlaWdodCA9IHBhcmVudC5sYXlvdXQgPT09ICJwb3NpdGlvbiIgJiYgcGFyZW50LmggIT09ICIiID8gMCA6IG5vZGUubWluSDsKICAgICAgfSBlbHNlIHsKICAgICAgICBoZWlnaHQgPSBNYXRoLm1pbihub2RlLm1heEgsIGF2YWlsYWJsZVNwYWNlLmhlaWdodCk7CiAgICAgIH0KICAgICAgaHRtbC5hdHRyaWJ1dGVzLnN0eWxlLmhlaWdodCA9IG1lYXN1cmVUb1N0cmluZyhoZWlnaHQpOwogICAgfQogICAgYmJveCA9IFtub2RlLngsIG5vZGUueSwgd2lkdGgsIGhlaWdodF07CiAgfQogIHJldHVybiBiYm94Owp9CmZ1bmN0aW9uIGZpeERpbWVuc2lvbnMobm9kZSkgewogIGNvbnN0IHBhcmVudCA9IG5vZGVbX3N5bWJvbF91dGlscy4kZ2V0U3ViZm9ybVBhcmVudF0oKTsKICBpZiAocGFyZW50LmxheW91dD8uaW5jbHVkZXMoInJvdyIpKSB7CiAgICBjb25zdCBleHRyYSA9IHBhcmVudFtfc3ltYm9sX3V0aWxzLiRleHRyYV07CiAgICBjb25zdCBjb2xTcGFuID0gbm9kZS5jb2xTcGFuOwogICAgbGV0IHdpZHRoOwogICAgaWYgKGNvbFNwYW4gPT09IC0xKSB7CiAgICAgIHdpZHRoID0gZXh0cmEuY29sdW1uV2lkdGhzLnNsaWNlKGV4dHJhLmN1cnJlbnRDb2x1bW4pLnJlZHVjZSgoYSwgdykgPT4gYSArIHcsIDApOwogICAgfSBlbHNlIHsKICAgICAgd2lkdGggPSBleHRyYS5jb2x1bW5XaWR0aHMuc2xpY2UoZXh0cmEuY3VycmVudENvbHVtbiwgZXh0cmEuY3VycmVudENvbHVtbiArIGNvbFNwYW4pLnJlZHVjZSgoYSwgdykgPT4gYSArIHcsIDApOwogICAgfQogICAgaWYgKCFpc05hTih3aWR0aCkpIHsKICAgICAgbm9kZS53ID0gd2lkdGg7CiAgICB9CiAgfQogIGlmIChwYXJlbnQubGF5b3V0ICYmIHBhcmVudC5sYXlvdXQgIT09ICJwb3NpdGlvbiIpIHsKICAgIG5vZGUueCA9IG5vZGUueSA9IDA7CiAgfQogIGlmIChub2RlLmxheW91dCA9PT0gInRhYmxlIikgewogICAgaWYgKG5vZGUudyA9PT0gIiIgJiYgQXJyYXkuaXNBcnJheShub2RlLmNvbHVtbldpZHRocykpIHsKICAgICAgbm9kZS53ID0gbm9kZS5jb2x1bW5XaWR0aHMucmVkdWNlKChhLCB4KSA9PiBhICsgeCwgMCk7CiAgICB9CiAgfQp9CmZ1bmN0aW9uIGxheW91dENsYXNzKG5vZGUpIHsKICBzd2l0Y2ggKG5vZGUubGF5b3V0KSB7CiAgICBjYXNlICJwb3NpdGlvbiI6CiAgICAgIHJldHVybiAieGZhUG9zaXRpb24iOwogICAgY2FzZSAibHItdGIiOgogICAgICByZXR1cm4gInhmYUxyVGIiOwogICAgY2FzZSAicmwtcm93IjoKICAgICAgcmV0dXJuICJ4ZmFSbFJvdyI7CiAgICBjYXNlICJybC10YiI6CiAgICAgIHJldHVybiAieGZhUmxUYiI7CiAgICBjYXNlICJyb3ciOgogICAgICByZXR1cm4gInhmYVJvdyI7CiAgICBjYXNlICJ0YWJsZSI6CiAgICAgIHJldHVybiAieGZhVGFibGUiOwogICAgY2FzZSAidGIiOgogICAgICByZXR1cm4gInhmYVRiIjsKICAgIGRlZmF1bHQ6CiAgICAgIHJldHVybiAieGZhUG9zaXRpb24iOwogIH0KfQpmdW5jdGlvbiB0b1N0eWxlKG5vZGUsIC4uLm5hbWVzKSB7CiAgY29uc3Qgc3R5bGUgPSBPYmplY3QuY3JlYXRlKG51bGwpOwogIGZvciAoY29uc3QgbmFtZSBvZiBuYW1lcykgewogICAgY29uc3QgdmFsdWUgPSBub2RlW25hbWVdOwogICAgaWYgKHZhbHVlID09PSBudWxsKSB7CiAgICAgIGNvbnRpbnVlOwogICAgfQogICAgaWYgKGNvbnZlcnRlcnMuaGFzT3duUHJvcGVydHkobmFtZSkpIHsKICAgICAgY29udmVydGVyc1tuYW1lXShub2RlLCBzdHlsZSk7CiAgICAgIGNvbnRpbnVlOwogICAgfQogICAgaWYgKHZhbHVlIGluc3RhbmNlb2YgX3hmYV9vYmplY3QuWEZBT2JqZWN0KSB7CiAgICAgIGNvbnN0IG5ld1N0eWxlID0gdmFsdWVbX3N5bWJvbF91dGlscy4kdG9TdHlsZV0oKTsKICAgICAgaWYgKG5ld1N0eWxlKSB7CiAgICAgICAgT2JqZWN0LmFzc2lnbihzdHlsZSwgbmV3U3R5bGUpOwogICAgICB9IGVsc2UgewogICAgICAgICgwLCBfdXRpbC53YXJuKShgKERFQlVHKSAtIFhGQSAtIHN0eWxlIGZvciAke25hbWV9IG5vdCBpbXBsZW1lbnRlZCB5ZXRgKTsKICAgICAgfQogICAgfQogIH0KICByZXR1cm4gc3R5bGU7Cn0KZnVuY3Rpb24gY3JlYXRlV3JhcHBlcihub2RlLCBodG1sKSB7CiAgY29uc3QgewogICAgYXR0cmlidXRlcwogIH0gPSBodG1sOwogIGNvbnN0IHsKICAgIHN0eWxlCiAgfSA9IGF0dHJpYnV0ZXM7CiAgY29uc3Qgd3JhcHBlciA9IHsKICAgIG5hbWU6ICJkaXYiLAogICAgYXR0cmlidXRlczogewogICAgICBjbGFzczogWyJ4ZmFXcmFwcGVyIl0sCiAgICAgIHN0eWxlOiBPYmplY3QuY3JlYXRlKG51bGwpCiAgICB9LAogICAgY2hpbGRyZW46IFtdCiAgfTsKICBhdHRyaWJ1dGVzLmNsYXNzLnB1c2goInhmYVdyYXBwZWQiKTsKICBpZiAobm9kZS5ib3JkZXIpIHsKICAgIGNvbnN0IHsKICAgICAgd2lkdGhzLAogICAgICBpbnNldHMKICAgIH0gPSBub2RlLmJvcmRlcltfc3ltYm9sX3V0aWxzLiRleHRyYV07CiAgICBsZXQgd2lkdGgsIGhlaWdodDsKICAgIGxldCB0b3AgPSBpbnNldHNbMF07CiAgICBsZXQgbGVmdCA9IGluc2V0c1szXTsKICAgIGNvbnN0IGluc2V0c0ggPSBpbnNldHNbMF0gKyBpbnNldHNbMl07CiAgICBjb25zdCBpbnNldHNXID0gaW5zZXRzWzFdICsgaW5zZXRzWzNdOwogICAgc3dpdGNoIChub2RlLmJvcmRlci5oYW5kKSB7CiAgICAgIGNhc2UgImV2ZW4iOgogICAgICAgIHRvcCAtPSB3aWR0aHNbMF0gLyAyOwogICAgICAgIGxlZnQgLT0gd2lkdGhzWzNdIC8gMjsKICAgICAgICB3aWR0aCA9IGBjYWxjKDEwMCUgKyAkeyh3aWR0aHNbMV0gKyB3aWR0aHNbM10pIC8gMiAtIGluc2V0c1d9cHgpYDsKICAgICAgICBoZWlnaHQgPSBgY2FsYygxMDAlICsgJHsod2lkdGhzWzBdICsgd2lkdGhzWzJdKSAvIDIgLSBpbnNldHNIfXB4KWA7CiAgICAgICAgYnJlYWs7CiAgICAgIGNhc2UgImxlZnQiOgogICAgICAgIHRvcCAtPSB3aWR0aHNbMF07CiAgICAgICAgbGVmdCAtPSB3aWR0aHNbM107CiAgICAgICAgd2lkdGggPSBgY2FsYygxMDAlICsgJHt3aWR0aHNbMV0gKyB3aWR0aHNbM10gLSBpbnNldHNXfXB4KWA7CiAgICAgICAgaGVpZ2h0ID0gYGNhbGMoMTAwJSArICR7d2lkdGhzWzBdICsgd2lkdGhzWzJdIC0gaW5zZXRzSH1weClgOwogICAgICAgIGJyZWFrOwogICAgICBjYXNlICJyaWdodCI6CiAgICAgICAgd2lkdGggPSBpbnNldHNXID8gYGNhbGMoMTAwJSAtICR7aW5zZXRzV31weClgIDogIjEwMCUiOwogICAgICAgIGhlaWdodCA9IGluc2V0c0ggPyBgY2FsYygxMDAlIC0gJHtpbnNldHNIfXB4KWAgOiAiMTAwJSI7CiAgICAgICAgYnJlYWs7CiAgICB9CiAgICBjb25zdCBjbGFzc05hbWVzID0gWyJ4ZmFCb3JkZXIiXTsKICAgIGlmIChpc1ByaW50T25seShub2RlLmJvcmRlcikpIHsKICAgICAgY2xhc3NOYW1lcy5wdXNoKCJ4ZmFQcmludE9ubHkiKTsKICAgIH0KICAgIGNvbnN0IGJvcmRlciA9IHsKICAgICAgbmFtZTogImRpdiIsCiAgICAgIGF0dHJpYnV0ZXM6IHsKICAgICAgICBjbGFzczogY2xhc3NOYW1lcywKICAgICAgICBzdHlsZTogewogICAgICAgICAgdG9wOiBgJHt0b3B9cHhgLAogICAgICAgICAgbGVmdDogYCR7bGVmdH1weGAsCiAgICAgICAgICB3aWR0aCwKICAgICAgICAgIGhlaWdodAogICAgICAgIH0KICAgICAgfSwKICAgICAgY2hpbGRyZW46IFtdCiAgICB9OwogICAgZm9yIChjb25zdCBrZXkgb2YgWyJib3JkZXIiLCAiYm9yZGVyV2lkdGgiLCAiYm9yZGVyQ29sb3IiLCAiYm9yZGVyUmFkaXVzIiwgImJvcmRlclN0eWxlIl0pIHsKICAgICAgaWYgKHN0eWxlW2tleV0gIT09IHVuZGVmaW5lZCkgewogICAgICAgIGJvcmRlci5hdHRyaWJ1dGVzLnN0eWxlW2tleV0gPSBzdHlsZVtrZXldOwogICAgICAgIGRlbGV0ZSBzdHlsZVtrZXldOwogICAgICB9CiAgICB9CiAgICB3cmFwcGVyLmNoaWxkcmVuLnB1c2goYm9yZGVyLCBodG1sKTsKICB9IGVsc2UgewogICAgd3JhcHBlci5jaGlsZHJlbi5wdXNoKGh0bWwpOwogIH0KICBmb3IgKGNvbnN0IGtleSBvZiBbImJhY2tncm91bmQiLCAiYmFja2dyb3VuZENsaXAiLCAidG9wIiwgImxlZnQiLCAid2lkdGgiLCAiaGVpZ2h0IiwgIm1pbldpZHRoIiwgIm1pbkhlaWdodCIsICJtYXhXaWR0aCIsICJtYXhIZWlnaHQiLCAidHJhbnNmb3JtIiwgInRyYW5zZm9ybU9yaWdpbiIsICJ2aXNpYmlsaXR5Il0pIHsKICAgIGlmIChzdHlsZVtrZXldICE9PSB1bmRlZmluZWQpIHsKICAgICAgd3JhcHBlci5hdHRyaWJ1dGVzLnN0eWxlW2tleV0gPSBzdHlsZVtrZXldOwogICAgICBkZWxldGUgc3R5bGVba2V5XTsKICAgIH0KICB9CiAgd3JhcHBlci5hdHRyaWJ1dGVzLnN0eWxlLnBvc2l0aW9uID0gc3R5bGUucG9zaXRpb24gPT09ICJhYnNvbHV0ZSIgPyAiYWJzb2x1dGUiIDogInJlbGF0aXZlIjsKICBkZWxldGUgc3R5bGUucG9zaXRpb247CiAgaWYgKHN0eWxlLmFsaWduU2VsZikgewogICAgd3JhcHBlci5hdHRyaWJ1dGVzLnN0eWxlLmFsaWduU2VsZiA9IHN0eWxlLmFsaWduU2VsZjsKICAgIGRlbGV0ZSBzdHlsZS5hbGlnblNlbGY7CiAgfQogIHJldHVybiB3cmFwcGVyOwp9CmZ1bmN0aW9uIGZpeFRleHRJbmRlbnQoc3R5bGVzKSB7CiAgY29uc3QgaW5kZW50ID0gKDAsIF91dGlscy5nZXRNZWFzdXJlbWVudCkoc3R5bGVzLnRleHRJbmRlbnQsICIwcHgiKTsKICBpZiAoaW5kZW50ID49IDApIHsKICAgIHJldHVybjsKICB9CiAgY29uc3QgYWxpZ24gPSBzdHlsZXMudGV4dEFsaWduID09PSAicmlnaHQiID8gInJpZ2h0IiA6ICJsZWZ0IjsKICBjb25zdCBuYW1lID0gInBhZGRpbmciICsgKGFsaWduID09PSAibGVmdCIgPyAiTGVmdCIgOiAiUmlnaHQiKTsKICBjb25zdCBwYWRkaW5nID0gKDAsIF91dGlscy5nZXRNZWFzdXJlbWVudCkoc3R5bGVzW25hbWVdLCAiMHB4Iik7CiAgc3R5bGVzW25hbWVdID0gYCR7cGFkZGluZyAtIGluZGVudH1weGA7Cn0KZnVuY3Rpb24gc2V0QWNjZXNzKG5vZGUsIGNsYXNzTmFtZXMpIHsKICBzd2l0Y2ggKG5vZGUuYWNjZXNzKSB7CiAgICBjYXNlICJub25JbnRlcmFjdGl2ZSI6CiAgICAgIGNsYXNzTmFtZXMucHVzaCgieGZhTm9uSW50ZXJhY3RpdmUiKTsKICAgICAgYnJlYWs7CiAgICBjYXNlICJyZWFkT25seSI6CiAgICAgIGNsYXNzTmFtZXMucHVzaCgieGZhUmVhZE9ubHkiKTsKICAgICAgYnJlYWs7CiAgICBjYXNlICJwcm90ZWN0ZWQiOgogICAgICBjbGFzc05hbWVzLnB1c2goInhmYURpc2FibGVkIik7CiAgICAgIGJyZWFrOwogIH0KfQpmdW5jdGlvbiBpc1ByaW50T25seShub2RlKSB7CiAgcmV0dXJuIG5vZGUucmVsZXZhbnQubGVuZ3RoID4gMCAmJiAhbm9kZS5yZWxldmFudFswXS5leGNsdWRlZCAmJiBub2RlLnJlbGV2YW50WzBdLnZpZXduYW1lID09PSAicHJpbnQiOwp9CmZ1bmN0aW9uIGdldEN1cnJlbnRQYXJhKG5vZGUpIHsKICBjb25zdCBzdGFjayA9IG5vZGVbX3N5bWJvbF91dGlscy4kZ2V0VGVtcGxhdGVSb290XSgpW19zeW1ib2xfdXRpbHMuJGV4dHJhXS5wYXJhU3RhY2s7CiAgcmV0dXJuIHN0YWNrLmxlbmd0aCA/IHN0YWNrLmF0KC0xKSA6IG51bGw7Cn0KZnVuY3Rpb24gc2V0UGFyYShub2RlLCBub2RlU3R5bGUsIHZhbHVlKSB7CiAgaWYgKHZhbHVlLmF0dHJpYnV0ZXMuY2xhc3M/LmluY2x1ZGVzKCJ4ZmFSaWNoIikpIHsKICAgIGlmIChub2RlU3R5bGUpIHsKICAgICAgaWYgKG5vZGUuaCA9PT0gIiIpIHsKICAgICAgICBub2RlU3R5bGUuaGVpZ2h0ID0gImF1dG8iOwogICAgICB9CiAgICAgIGlmIChub2RlLncgPT09ICIiKSB7CiAgICAgICAgbm9kZVN0eWxlLndpZHRoID0gImF1dG8iOwogICAgICB9CiAgICB9CiAgICBjb25zdCBwYXJhID0gZ2V0Q3VycmVudFBhcmEobm9kZSk7CiAgICBpZiAocGFyYSkgewogICAgICBjb25zdCB2YWx1ZVN0eWxlID0gdmFsdWUuYXR0cmlidXRlcy5zdHlsZTsKICAgICAgdmFsdWVTdHlsZS5kaXNwbGF5ID0gImZsZXgiOwogICAgICB2YWx1ZVN0eWxlLmZsZXhEaXJlY3Rpb24gPSAiY29sdW1uIjsKICAgICAgc3dpdGNoIChwYXJhLnZBbGlnbikgewogICAgICAgIGNhc2UgInRvcCI6CiAgICAgICAgICB2YWx1ZVN0eWxlLmp1c3RpZnlDb250ZW50ID0gInN0YXJ0IjsKICAgICAgICAgIGJyZWFrOwogICAgICAgIGNhc2UgImJvdHRvbSI6CiAgICAgICAgICB2YWx1ZVN0eWxlLmp1c3RpZnlDb250ZW50ID0gImVuZCI7CiAgICAgICAgICBicmVhazsKICAgICAgICBjYXNlICJtaWRkbGUiOgogICAgICAgICAgdmFsdWVTdHlsZS5qdXN0aWZ5Q29udGVudCA9ICJjZW50ZXIiOwogICAgICAgICAgYnJlYWs7CiAgICAgIH0KICAgICAgY29uc3QgcGFyYVN0eWxlID0gcGFyYVtfc3ltYm9sX3V0aWxzLiR0b1N0eWxlXSgpOwogICAgICBmb3IgKGNvbnN0IFtrZXksIHZhbF0gb2YgT2JqZWN0LmVudHJpZXMocGFyYVN0eWxlKSkgewogICAgICAgIGlmICghKGtleSBpbiB2YWx1ZVN0eWxlKSkgewogICAgICAgICAgdmFsdWVTdHlsZVtrZXldID0gdmFsOwogICAgICAgIH0KICAgICAgfQogICAgfQogIH0KfQpmdW5jdGlvbiBzZXRGb250RmFtaWx5KHhmYUZvbnQsIG5vZGUsIGZvbnRGaW5kZXIsIHN0eWxlKSB7CiAgaWYgKCFmb250RmluZGVyKSB7CiAgICBkZWxldGUgc3R5bGUuZm9udEZhbWlseTsKICAgIHJldHVybjsKICB9CiAgY29uc3QgbmFtZSA9ICgwLCBfdXRpbHMuc3RyaXBRdW90ZXMpKHhmYUZvbnQudHlwZWZhY2UpOwogIHN0eWxlLmZvbnRGYW1pbHkgPSBgIiR7bmFtZX0iYDsKICBjb25zdCB0eXBlZmFjZSA9IGZvbnRGaW5kZXIuZmluZChuYW1lKTsKICBpZiAodHlwZWZhY2UpIHsKICAgIGNvbnN0IHsKICAgICAgZm9udEZhbWlseQogICAgfSA9IHR5cGVmYWNlLnJlZ3VsYXIuY3NzRm9udEluZm87CiAgICBpZiAoZm9udEZhbWlseSAhPT0gbmFtZSkgewogICAgICBzdHlsZS5mb250RmFtaWx5ID0gYCIke2ZvbnRGYW1pbHl9ImA7CiAgICB9CiAgICBjb25zdCBwYXJhID0gZ2V0Q3VycmVudFBhcmEobm9kZSk7CiAgICBpZiAocGFyYSAmJiBwYXJhLmxpbmVIZWlnaHQgIT09ICIiKSB7CiAgICAgIHJldHVybjsKICAgIH0KICAgIGlmIChzdHlsZS5saW5lSGVpZ2h0KSB7CiAgICAgIHJldHVybjsKICAgIH0KICAgIGNvbnN0IHBkZkZvbnQgPSAoMCwgX2ZvbnRzLnNlbGVjdEZvbnQpKHhmYUZvbnQsIHR5cGVmYWNlKTsKICAgIGlmIChwZGZGb250KSB7CiAgICAgIHN0eWxlLmxpbmVIZWlnaHQgPSBNYXRoLm1heCgxLjIsIHBkZkZvbnQubGluZUhlaWdodCk7CiAgICB9CiAgfQp9CmZ1bmN0aW9uIGZpeFVSTChzdHIpIHsKICBjb25zdCBhYnNvbHV0ZVVybCA9ICgwLCBfdXRpbC5jcmVhdGVWYWxpZEFic29sdXRlVXJsKShzdHIsIG51bGwsIHsKICAgIGFkZERlZmF1bHRQcm90b2NvbDogdHJ1ZSwKICAgIHRyeUNvbnZlcnRFbmNvZGluZzogdHJ1ZQogIH0pOwogIHJldHVybiBhYnNvbHV0ZVVybCA/IGFic29sdXRlVXJsLmhyZWYgOiBudWxsOwp9CgovKioqLyB9KSwKLyogODQgKi8KLyoqKi8gKChfX3VudXNlZF93ZWJwYWNrX21vZHVsZSwgZXhwb3J0cywgX193X3BkZmpzX3JlcXVpcmVfXykgPT4gewoKCgpPYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgIl9fZXNNb2R1bGUiLCAoewogIHZhbHVlOiB0cnVlCn0pKTsKZXhwb3J0cy5IVE1MUmVzdWx0ID0gdm9pZCAwOwpleHBvcnRzLmdldEJCb3ggPSBnZXRCQm94OwpleHBvcnRzLmdldENvbG9yID0gZ2V0Q29sb3I7CmV4cG9ydHMuZ2V0RmxvYXQgPSBnZXRGbG9hdDsKZXhwb3J0cy5nZXRJbnRlZ2VyID0gZ2V0SW50ZWdlcjsKZXhwb3J0cy5nZXRLZXl3b3JkID0gZ2V0S2V5d29yZDsKZXhwb3J0cy5nZXRNZWFzdXJlbWVudCA9IGdldE1lYXN1cmVtZW50OwpleHBvcnRzLmdldFJhdGlvID0gZ2V0UmF0aW87CmV4cG9ydHMuZ2V0UmVsZXZhbnQgPSBnZXRSZWxldmFudDsKZXhwb3J0cy5nZXRTdHJpbmdPcHRpb24gPSBnZXRTdHJpbmdPcHRpb247CmV4cG9ydHMuc3RyaXBRdW90ZXMgPSBzdHJpcFF1b3RlczsKdmFyIF91dGlsID0gX193X3BkZmpzX3JlcXVpcmVfXygyKTsKY29uc3QgZGltQ29udmVydGVycyA9IHsKICBwdDogeCA9PiB4LAogIGNtOiB4ID0+IHggLyAyLjU0ICogNzIsCiAgbW06IHggPT4geCAvICgxMCAqIDIuNTQpICogNzIsCiAgaW46IHggPT4geCAqIDcyLAogIHB4OiB4ID0+IHgKfTsKY29uc3QgbWVhc3VyZW1lbnRQYXR0ZXJuID0gLyhbKy1dP1xkK1wuP1xkKikoLiopLzsKZnVuY3Rpb24gc3RyaXBRdW90ZXMoc3RyKSB7CiAgaWYgKHN0ci5zdGFydHNXaXRoKCInIikgfHwgc3RyLnN0YXJ0c1dpdGgoJyInKSkgewogICAgcmV0dXJuIHN0ci5zbGljZSgxLCAtMSk7CiAgfQogIHJldHVybiBzdHI7Cn0KZnVuY3Rpb24gZ2V0SW50ZWdlcih7CiAgZGF0YSwKICBkZWZhdWx0VmFsdWUsCiAgdmFsaWRhdGUKfSkgewogIGlmICghZGF0YSkgewogICAgcmV0dXJuIGRlZmF1bHRWYWx1ZTsKICB9CiAgZGF0YSA9IGRhdGEudHJpbSgpOwogIGNvbnN0IG4gPSBwYXJzZUludChkYXRhLCAxMCk7CiAgaWYgKCFpc05hTihuKSAmJiB2YWxpZGF0ZShuKSkgewogICAgcmV0dXJuIG47CiAgfQogIHJldHVybiBkZWZhdWx0VmFsdWU7Cn0KZnVuY3Rpb24gZ2V0RmxvYXQoewogIGRhdGEsCiAgZGVmYXVsdFZhbHVlLAogIHZhbGlkYXRlCn0pIHsKICBpZiAoIWRhdGEpIHsKICAgIHJldHVybiBkZWZhdWx0VmFsdWU7CiAgfQogIGRhdGEgPSBkYXRhLnRyaW0oKTsKICBjb25zdCBuID0gcGFyc2VGbG9hdChkYXRhKTsKICBpZiAoIWlzTmFOKG4pICYmIHZhbGlkYXRlKG4pKSB7CiAgICByZXR1cm4gbjsKICB9CiAgcmV0dXJuIGRlZmF1bHRWYWx1ZTsKfQpmdW5jdGlvbiBnZXRLZXl3b3JkKHsKICBkYXRhLAogIGRlZmF1bHRWYWx1ZSwKICB2YWxpZGF0ZQp9KSB7CiAgaWYgKCFkYXRhKSB7CiAgICByZXR1cm4gZGVmYXVsdFZhbHVlOwogIH0KICBkYXRhID0gZGF0YS50cmltKCk7CiAgaWYgKHZhbGlkYXRlKGRhdGEpKSB7CiAgICByZXR1cm4gZGF0YTsKICB9CiAgcmV0dXJuIGRlZmF1bHRWYWx1ZTsKfQpmdW5jdGlvbiBnZXRTdHJpbmdPcHRpb24oZGF0YSwgb3B0aW9ucykgewogIHJldHVybiBnZXRLZXl3b3JkKHsKICAgIGRhdGEsCiAgICBkZWZhdWx0VmFsdWU6IG9wdGlvbnNbMF0sCiAgICB2YWxpZGF0ZTogayA9PiBvcHRpb25zLmluY2x1ZGVzKGspCiAgfSk7Cn0KZnVuY3Rpb24gZ2V0TWVhc3VyZW1lbnQoc3RyLCBkZWYgPSAiMCIpIHsKICBkZWYgfHw9ICIwIjsKICBpZiAoIXN0cikgewogICAgcmV0dXJuIGdldE1lYXN1cmVtZW50KGRlZik7CiAgfQogIGNvbnN0IG1hdGNoID0gc3RyLnRyaW0oKS5tYXRjaChtZWFzdXJlbWVudFBhdHRlcm4pOwogIGlmICghbWF0Y2gpIHsKICAgIHJldHVybiBnZXRNZWFzdXJlbWVudChkZWYpOwogIH0KICBjb25zdCBbLCB2YWx1ZVN0ciwgdW5pdF0gPSBtYXRjaDsKICBjb25zdCB2YWx1ZSA9IHBhcnNlRmxvYXQodmFsdWVTdHIpOwogIGlmIChpc05hTih2YWx1ZSkpIHsKICAgIHJldHVybiBnZXRNZWFzdXJlbWVudChkZWYpOwogIH0KICBpZiAodmFsdWUgPT09IDApIHsKICAgIHJldHVybiAwOwogIH0KICBjb25zdCBjb252ID0gZGltQ29udmVydGVyc1t1bml0XTsKICBpZiAoY29udikgewogICAgcmV0dXJuIGNvbnYodmFsdWUpOwogIH0KICByZXR1cm4gdmFsdWU7Cn0KZnVuY3Rpb24gZ2V0UmF0aW8oZGF0YSkgewogIGlmICghZGF0YSkgewogICAgcmV0dXJuIHsKICAgICAgbnVtOiAxLAogICAgICBkZW46IDEKICAgIH07CiAgfQogIGNvbnN0IHJhdGlvID0gZGF0YS50cmltKCkuc3BsaXQoL1xzKjpccyovKS5tYXAoeCA9PiBwYXJzZUZsb2F0KHgpKS5maWx0ZXIoeCA9PiAhaXNOYU4oeCkpOwogIGlmIChyYXRpby5sZW5ndGggPT09IDEpIHsKICAgIHJhdGlvLnB1c2goMSk7CiAgfQogIGlmIChyYXRpby5sZW5ndGggPT09IDApIHsKICAgIHJldHVybiB7CiAgICAgIG51bTogMSwKICAgICAgZGVuOiAxCiAgICB9OwogIH0KICBjb25zdCBbbnVtLCBkZW5dID0gcmF0aW87CiAgcmV0dXJuIHsKICAgIG51bSwKICAgIGRlbgogIH07Cn0KZnVuY3Rpb24gZ2V0UmVsZXZhbnQoZGF0YSkgewogIGlmICghZGF0YSkgewogICAgcmV0dXJuIFtdOwogIH0KICByZXR1cm4gZGF0YS50cmltKCkuc3BsaXQoL1xzKy8pLm1hcChlID0+IHsKICAgIHJldHVybiB7CiAgICAgIGV4Y2x1ZGVkOiBlWzBdID09PSAiLSIsCiAgICAgIHZpZXduYW1lOiBlLnN1YnN0cmluZygxKQogICAgfTsKICB9KTsKfQpmdW5jdGlvbiBnZXRDb2xvcihkYXRhLCBkZWYgPSBbMCwgMCwgMF0pIHsKICBsZXQgW3IsIGcsIGJdID0gZGVmOwogIGlmICghZGF0YSkgewogICAgcmV0dXJuIHsKICAgICAgciwKICAgICAgZywKICAgICAgYgogICAgfTsKICB9CiAgY29uc3QgY29sb3IgPSBkYXRhLnRyaW0oKS5zcGxpdCgvXHMqLFxzKi8pLm1hcChjID0+IE1hdGgubWluKE1hdGgubWF4KDAsIHBhcnNlSW50KGMudHJpbSgpLCAxMCkpLCAyNTUpKS5tYXAoYyA9PiBpc05hTihjKSA/IDAgOiBjKTsKICBpZiAoY29sb3IubGVuZ3RoIDwgMykgewogICAgcmV0dXJuIHsKICAgICAgciwKICAgICAgZywKICAgICAgYgogICAgfTsKICB9CiAgW3IsIGcsIGJdID0gY29sb3I7CiAgcmV0dXJuIHsKICAgIHIsCiAgICBnLAogICAgYgogIH07Cn0KZnVuY3Rpb24gZ2V0QkJveChkYXRhKSB7CiAgY29uc3QgZGVmID0gLTE7CiAgaWYgKCFkYXRhKSB7CiAgICByZXR1cm4gewogICAgICB4OiBkZWYsCiAgICAgIHk6IGRlZiwKICAgICAgd2lkdGg6IGRlZiwKICAgICAgaGVpZ2h0OiBkZWYKICAgIH07CiAgfQogIGNvbnN0IGJib3ggPSBkYXRhLnRyaW0oKS5zcGxpdCgvXHMqLFxzKi8pLm1hcChtID0+IGdldE1lYXN1cmVtZW50KG0sICItMSIpKTsKICBpZiAoYmJveC5sZW5ndGggPCA0IHx8IGJib3hbMl0gPCAwIHx8IGJib3hbM10gPCAwKSB7CiAgICByZXR1cm4gewogICAgICB4OiBkZWYsCiAgICAgIHk6IGRlZiwKICAgICAgd2lkdGg6IGRlZiwKICAgICAgaGVpZ2h0OiBkZWYKICAgIH07CiAgfQogIGNvbnN0IFt4LCB5LCB3aWR0aCwgaGVpZ2h0XSA9IGJib3g7CiAgcmV0dXJuIHsKICAgIHgsCiAgICB5LAogICAgd2lkdGgsCiAgICBoZWlnaHQKICB9Owp9CmNsYXNzIEhUTUxSZXN1bHQgewogIHN0YXRpYyBnZXQgRkFJTFVSRSgpIHsKICAgIHJldHVybiAoMCwgX3V0aWwuc2hhZG93KSh0aGlzLCAiRkFJTFVSRSIsIG5ldyBIVE1MUmVzdWx0KGZhbHNlLCBudWxsLCBudWxsLCBudWxsKSk7CiAgfQogIHN0YXRpYyBnZXQgRU1QVFkoKSB7CiAgICByZXR1cm4gKDAsIF91dGlsLnNoYWRvdykodGhpcywgIkVNUFRZIiwgbmV3IEhUTUxSZXN1bHQodHJ1ZSwgbnVsbCwgbnVsbCwgbnVsbCkpOwogIH0KICBjb25zdHJ1Y3RvcihzdWNjZXNzLCBodG1sLCBiYm94LCBicmVha05vZGUpIHsKICAgIHRoaXMuc3VjY2VzcyA9IHN1Y2Nlc3M7CiAgICB0aGlzLmh0bWwgPSBodG1sOwogICAgdGhpcy5iYm94ID0gYmJveDsKICAgIHRoaXMuYnJlYWtOb2RlID0gYnJlYWtOb2RlOwogIH0KICBpc0JyZWFrKCkgewogICAgcmV0dXJuICEhdGhpcy5icmVha05vZGU7CiAgfQogIHN0YXRpYyBicmVha05vZGUobm9kZSkgewogICAgcmV0dXJuIG5ldyBIVE1MUmVzdWx0KGZhbHNlLCBudWxsLCBudWxsLCBub2RlKTsKICB9CiAgc3RhdGljIHN1Y2Nlc3MoaHRtbCwgYmJveCA9IG51bGwpIHsKICAgIHJldHVybiBuZXcgSFRNTFJlc3VsdCh0cnVlLCBodG1sLCBiYm94LCBudWxsKTsKICB9Cn0KZXhwb3J0cy5IVE1MUmVzdWx0ID0gSFRNTFJlc3VsdDsKCi8qKiovIH0pLAovKiA4NSAqLwovKioqLyAoKF9fdW51c2VkX3dlYnBhY2tfbW9kdWxlLCBleHBvcnRzLCBfX3dfcGRmanNfcmVxdWlyZV9fKSA9PiB7CgoKCk9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCAiX19lc01vZHVsZSIsICh7CiAgdmFsdWU6IHRydWUKfSkpOwpleHBvcnRzLkZvbnRGaW5kZXIgPSB2b2lkIDA7CmV4cG9ydHMuZ2V0TWV0cmljcyA9IGdldE1ldHJpY3M7CmV4cG9ydHMuc2VsZWN0Rm9udCA9IHNlbGVjdEZvbnQ7CnZhciBfc3ltYm9sX3V0aWxzID0gX193X3BkZmpzX3JlcXVpcmVfXyg3OCk7CnZhciBfdXRpbHMgPSBfX3dfcGRmanNfcmVxdWlyZV9fKDg0KTsKdmFyIF91dGlsID0gX193X3BkZmpzX3JlcXVpcmVfXygyKTsKY2xhc3MgRm9udEZpbmRlciB7CiAgY29uc3RydWN0b3IocGRmRm9udHMpIHsKICAgIHRoaXMuZm9udHMgPSBuZXcgTWFwKCk7CiAgICB0aGlzLmNhY2hlID0gbmV3IE1hcCgpOwogICAgdGhpcy53YXJuZWQgPSBuZXcgU2V0KCk7CiAgICB0aGlzLmRlZmF1bHRGb250ID0gbnVsbDsKICAgIHRoaXMuYWRkKHBkZkZvbnRzKTsKICB9CiAgYWRkKHBkZkZvbnRzLCByZWFsbHlNaXNzaW5nRm9udHMgPSBudWxsKSB7CiAgICBmb3IgKGNvbnN0IHBkZkZvbnQgb2YgcGRmRm9udHMpIHsKICAgICAgdGhpcy5hZGRQZGZGb250KHBkZkZvbnQpOwogICAgfQogICAgZm9yIChjb25zdCBwZGZGb250IG9mIHRoaXMuZm9udHMudmFsdWVzKCkpIHsKICAgICAgaWYgKCFwZGZGb250LnJlZ3VsYXIpIHsKICAgICAgICBwZGZGb250LnJlZ3VsYXIgPSBwZGZGb250Lml0YWxpYyB8fCBwZGZGb250LmJvbGQgfHwgcGRmRm9udC5ib2xkaXRhbGljOwogICAgICB9CiAgICB9CiAgICBpZiAoIXJlYWxseU1pc3NpbmdGb250cyB8fCByZWFsbHlNaXNzaW5nRm9udHMuc2l6ZSA9PT0gMCkgewogICAgICByZXR1cm47CiAgICB9CiAgICBjb25zdCBteXJpYWQgPSB0aGlzLmZvbnRzLmdldCgiUGRmSlMtRmFsbGJhY2stUGRmSlMtWEZBIik7CiAgICBmb3IgKGNvbnN0IG1pc3Npbmcgb2YgcmVhbGx5TWlzc2luZ0ZvbnRzKSB7CiAgICAgIHRoaXMuZm9udHMuc2V0KG1pc3NpbmcsIG15cmlhZCk7CiAgICB9CiAgfQogIGFkZFBkZkZvbnQocGRmRm9udCkgewogICAgY29uc3QgY3NzRm9udEluZm8gPSBwZGZGb250LmNzc0ZvbnRJbmZvOwogICAgY29uc3QgbmFtZSA9IGNzc0ZvbnRJbmZvLmZvbnRGYW1pbHk7CiAgICBsZXQgZm9udCA9IHRoaXMuZm9udHMuZ2V0KG5hbWUpOwogICAgaWYgKCFmb250KSB7CiAgICAgIGZvbnQgPSBPYmplY3QuY3JlYXRlKG51bGwpOwogICAgICB0aGlzLmZvbnRzLnNldChuYW1lLCBmb250KTsKICAgICAgaWYgKCF0aGlzLmRlZmF1bHRGb250KSB7CiAgICAgICAgdGhpcy5kZWZhdWx0Rm9udCA9IGZvbnQ7CiAgICAgIH0KICAgIH0KICAgIGxldCBwcm9wZXJ0eSA9ICIiOwogICAgY29uc3QgZm9udFdlaWdodCA9IHBhcnNlRmxvYXQoY3NzRm9udEluZm8uZm9udFdlaWdodCk7CiAgICBpZiAocGFyc2VGbG9hdChjc3NGb250SW5mby5pdGFsaWNBbmdsZSkgIT09IDApIHsKICAgICAgcHJvcGVydHkgPSBmb250V2VpZ2h0ID49IDcwMCA/ICJib2xkaXRhbGljIiA6ICJpdGFsaWMiOwogICAgfSBlbHNlIGlmIChmb250V2VpZ2h0ID49IDcwMCkgewogICAgICBwcm9wZXJ0eSA9ICJib2xkIjsKICAgIH0KICAgIGlmICghcHJvcGVydHkpIHsKICAgICAgaWYgKHBkZkZvbnQubmFtZS5pbmNsdWRlcygiQm9sZCIpIHx8IHBkZkZvbnQucHNOYW1lPy5pbmNsdWRlcygiQm9sZCIpKSB7CiAgICAgICAgcHJvcGVydHkgPSAiYm9sZCI7CiAgICAgIH0KICAgICAgaWYgKHBkZkZvbnQubmFtZS5pbmNsdWRlcygiSXRhbGljIikgfHwgcGRmRm9udC5uYW1lLmVuZHNXaXRoKCJJdCIpIHx8IHBkZkZvbnQucHNOYW1lPy5pbmNsdWRlcygiSXRhbGljIikgfHwgcGRmRm9udC5wc05hbWU/LmVuZHNXaXRoKCJJdCIpKSB7CiAgICAgICAgcHJvcGVydHkgKz0gIml0YWxpYyI7CiAgICAgIH0KICAgIH0KICAgIGlmICghcHJvcGVydHkpIHsKICAgICAgcHJvcGVydHkgPSAicmVndWxhciI7CiAgICB9CiAgICBmb250W3Byb3BlcnR5XSA9IHBkZkZvbnQ7CiAgfQogIGdldERlZmF1bHQoKSB7CiAgICByZXR1cm4gdGhpcy5kZWZhdWx0Rm9udDsKICB9CiAgZmluZChmb250TmFtZSwgbXVzdFdhcm4gPSB0cnVlKSB7CiAgICBsZXQgZm9udCA9IHRoaXMuZm9udHMuZ2V0KGZvbnROYW1lKSB8fCB0aGlzLmNhY2hlLmdldChmb250TmFtZSk7CiAgICBpZiAoZm9udCkgewogICAgICByZXR1cm4gZm9udDsKICAgIH0KICAgIGNvbnN0IHBhdHRlcm4gPSAvLHwtfF98IHxib2xkaXRhbGljfGJvbGR8aXRhbGljfHJlZ3VsYXJ8aXQvZ2k7CiAgICBsZXQgbmFtZSA9IGZvbnROYW1lLnJlcGxhY2VBbGwocGF0dGVybiwgIiIpOwogICAgZm9udCA9IHRoaXMuZm9udHMuZ2V0KG5hbWUpOwogICAgaWYgKGZvbnQpIHsKICAgICAgdGhpcy5jYWNoZS5zZXQoZm9udE5hbWUsIGZvbnQpOwogICAgICByZXR1cm4gZm9udDsKICAgIH0KICAgIG5hbWUgPSBuYW1lLnRvTG93ZXJDYXNlKCk7CiAgICBjb25zdCBtYXliZSA9IFtdOwogICAgZm9yIChjb25zdCBbZmFtaWx5LCBwZGZGb250XSBvZiB0aGlzLmZvbnRzLmVudHJpZXMoKSkgewogICAgICBpZiAoZmFtaWx5LnJlcGxhY2VBbGwocGF0dGVybiwgIiIpLnRvTG93ZXJDYXNlKCkuc3RhcnRzV2l0aChuYW1lKSkgewogICAgICAgIG1heWJlLnB1c2gocGRmRm9udCk7CiAgICAgIH0KICAgIH0KICAgIGlmIChtYXliZS5sZW5ndGggPT09IDApIHsKICAgICAgZm9yIChjb25zdCBbLCBwZGZGb250XSBvZiB0aGlzLmZvbnRzLmVudHJpZXMoKSkgewogICAgICAgIGlmIChwZGZGb250LnJlZ3VsYXIubmFtZT8ucmVwbGFjZUFsbChwYXR0ZXJuLCAiIikudG9Mb3dlckNhc2UoKS5zdGFydHNXaXRoKG5hbWUpKSB7CiAgICAgICAgICBtYXliZS5wdXNoKHBkZkZvbnQpOwogICAgICAgIH0KICAgICAgfQogICAgfQogICAgaWYgKG1heWJlLmxlbmd0aCA9PT0gMCkgewogICAgICBuYW1lID0gbmFtZS5yZXBsYWNlQWxsKC9wc210fG10L2dpLCAiIik7CiAgICAgIGZvciAoY29uc3QgW2ZhbWlseSwgcGRmRm9udF0gb2YgdGhpcy5mb250cy5lbnRyaWVzKCkpIHsKICAgICAgICBpZiAoZmFtaWx5LnJlcGxhY2VBbGwocGF0dGVybiwgIiIpLnRvTG93ZXJDYXNlKCkuc3RhcnRzV2l0aChuYW1lKSkgewogICAgICAgICAgbWF5YmUucHVzaChwZGZGb250KTsKICAgICAgICB9CiAgICAgIH0KICAgIH0KICAgIGlmIChtYXliZS5sZW5ndGggPT09IDApIHsKICAgICAgZm9yIChjb25zdCBwZGZGb250IG9mIHRoaXMuZm9udHMudmFsdWVzKCkpIHsKICAgICAgICBpZiAocGRmRm9udC5yZWd1bGFyLm5hbWU/LnJlcGxhY2VBbGwocGF0dGVybiwgIiIpLnRvTG93ZXJDYXNlKCkuc3RhcnRzV2l0aChuYW1lKSkgewogICAgICAgICAgbWF5YmUucHVzaChwZGZGb250KTsKICAgICAgICB9CiAgICAgIH0KICAgIH0KICAgIGlmIChtYXliZS5sZW5ndGggPj0gMSkgewogICAgICBpZiAobWF5YmUubGVuZ3RoICE9PSAxICYmIG11c3RXYXJuKSB7CiAgICAgICAgKDAsIF91dGlsLndhcm4pKGBYRkEgLSBUb28gbWFueSBjaG9pY2VzIHRvIGd1ZXNzIHRoZSBjb3JyZWN0IGZvbnQ6ICR7Zm9udE5hbWV9YCk7CiAgICAgIH0KICAgICAgdGhpcy5jYWNoZS5zZXQoZm9udE5hbWUsIG1heWJlWzBdKTsKICAgICAgcmV0dXJuIG1heWJlWzBdOwogICAgfQogICAgaWYgKG11c3RXYXJuICYmICF0aGlzLndhcm5lZC5oYXMoZm9udE5hbWUpKSB7CiAgICAgIHRoaXMud2FybmVkLmFkZChmb250TmFtZSk7CiAgICAgICgwLCBfdXRpbC53YXJuKShgWEZBIC0gQ2Fubm90IGZpbmQgdGhlIGZvbnQ6ICR7Zm9udE5hbWV9YCk7CiAgICB9CiAgICByZXR1cm4gbnVsbDsKICB9Cn0KZXhwb3J0cy5Gb250RmluZGVyID0gRm9udEZpbmRlcjsKZnVuY3Rpb24gc2VsZWN0Rm9udCh4ZmFGb250LCB0eXBlZmFjZSkgewogIGlmICh4ZmFGb250LnBvc3R1cmUgPT09ICJpdGFsaWMiKSB7CiAgICBpZiAoeGZhRm9udC53ZWlnaHQgPT09ICJib2xkIikgewogICAgICByZXR1cm4gdHlwZWZhY2UuYm9sZGl0YWxpYzsKICAgIH0KICAgIHJldHVybiB0eXBlZmFjZS5pdGFsaWM7CiAgfSBlbHNlIGlmICh4ZmFGb250LndlaWdodCA9PT0gImJvbGQiKSB7CiAgICByZXR1cm4gdHlwZWZhY2UuYm9sZDsKICB9CiAgcmV0dXJuIHR5cGVmYWNlLnJlZ3VsYXI7Cn0KZnVuY3Rpb24gZ2V0TWV0cmljcyh4ZmFGb250LCByZWFsID0gZmFsc2UpIHsKICBsZXQgcGRmRm9udCA9IG51bGw7CiAgaWYgKHhmYUZvbnQpIHsKICAgIGNvbnN0IG5hbWUgPSAoMCwgX3V0aWxzLnN0cmlwUXVvdGVzKSh4ZmFGb250LnR5cGVmYWNlKTsKICAgIGNvbnN0IHR5cGVmYWNlID0geGZhRm9udFtfc3ltYm9sX3V0aWxzLiRnbG9iYWxEYXRhXS5mb250RmluZGVyLmZpbmQobmFtZSk7CiAgICBwZGZGb250ID0gc2VsZWN0Rm9udCh4ZmFGb250LCB0eXBlZmFjZSk7CiAgfQogIGlmICghcGRmRm9udCkgewogICAgcmV0dXJuIHsKICAgICAgbGluZUhlaWdodDogMTIsCiAgICAgIGxpbmVHYXA6IDIsCiAgICAgIGxpbmVOb0dhcDogMTAKICAgIH07CiAgfQogIGNvbnN0IHNpemUgPSB4ZmFGb250LnNpemUgfHwgMTA7CiAgY29uc3QgbGluZUhlaWdodCA9IHBkZkZvbnQubGluZUhlaWdodCA/IE1hdGgubWF4KHJlYWwgPyAwIDogMS4yLCBwZGZGb250LmxpbmVIZWlnaHQpIDogMS4yOwogIGNvbnN0IGxpbmVHYXAgPSBwZGZGb250LmxpbmVHYXAgPT09IHVuZGVmaW5lZCA/IDAuMiA6IHBkZkZvbnQubGluZUdhcDsKICByZXR1cm4gewogICAgbGluZUhlaWdodDogbGluZUhlaWdodCAqIHNpemUsCiAgICBsaW5lR2FwOiBsaW5lR2FwICogc2l6ZSwKICAgIGxpbmVOb0dhcDogTWF0aC5tYXgoMSwgbGluZUhlaWdodCAtIGxpbmVHYXApICogc2l6ZQogIH07Cn0KCi8qKiovIH0pLAovKiA4NiAqLwovKioqLyAoKF9fdW51c2VkX3dlYnBhY2tfbW9kdWxlLCBleHBvcnRzLCBfX3dfcGRmanNfcmVxdWlyZV9fKSA9PiB7CgoKCk9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCAiX19lc01vZHVsZSIsICh7CiAgdmFsdWU6IHRydWUKfSkpOwpleHBvcnRzLlRleHRNZWFzdXJlID0gdm9pZCAwOwp2YXIgX2ZvbnRzID0gX193X3BkZmpzX3JlcXVpcmVfXyg4NSk7CmNvbnN0IFdJRFRIX0ZBQ1RPUiA9IDEuMDI7CmNsYXNzIEZvbnRJbmZvIHsKICBjb25zdHJ1Y3Rvcih4ZmFGb250LCBtYXJnaW4sIGxpbmVIZWlnaHQsIGZvbnRGaW5kZXIpIHsKICAgIHRoaXMubGluZUhlaWdodCA9IGxpbmVIZWlnaHQ7CiAgICB0aGlzLnBhcmFNYXJnaW4gPSBtYXJnaW4gfHwgewogICAgICB0b3A6IDAsCiAgICAgIGJvdHRvbTogMCwKICAgICAgbGVmdDogMCwKICAgICAgcmlnaHQ6IDAKICAgIH07CiAgICBpZiAoIXhmYUZvbnQpIHsKICAgICAgW3RoaXMucGRmRm9udCwgdGhpcy54ZmFGb250XSA9IHRoaXMuZGVmYXVsdEZvbnQoZm9udEZpbmRlcik7CiAgICAgIHJldHVybjsKICAgIH0KICAgIHRoaXMueGZhRm9udCA9IHsKICAgICAgdHlwZWZhY2U6IHhmYUZvbnQudHlwZWZhY2UsCiAgICAgIHBvc3R1cmU6IHhmYUZvbnQucG9zdHVyZSwKICAgICAgd2VpZ2h0OiB4ZmFGb250LndlaWdodCwKICAgICAgc2l6ZTogeGZhRm9udC5zaXplLAogICAgICBsZXR0ZXJTcGFjaW5nOiB4ZmFGb250LmxldHRlclNwYWNpbmcKICAgIH07CiAgICBjb25zdCB0eXBlZmFjZSA9IGZvbnRGaW5kZXIuZmluZCh4ZmFGb250LnR5cGVmYWNlKTsKICAgIGlmICghdHlwZWZhY2UpIHsKICAgICAgW3RoaXMucGRmRm9udCwgdGhpcy54ZmFGb250XSA9IHRoaXMuZGVmYXVsdEZvbnQoZm9udEZpbmRlcik7CiAgICAgIHJldHVybjsKICAgIH0KICAgIHRoaXMucGRmRm9udCA9ICgwLCBfZm9udHMuc2VsZWN0Rm9udCkoeGZhRm9udCwgdHlwZWZhY2UpOwogICAgaWYgKCF0aGlzLnBkZkZvbnQpIHsKICAgICAgW3RoaXMucGRmRm9udCwgdGhpcy54ZmFGb250XSA9IHRoaXMuZGVmYXVsdEZvbnQoZm9udEZpbmRlcik7CiAgICB9CiAgfQogIGRlZmF1bHRGb250KGZvbnRGaW5kZXIpIHsKICAgIGNvbnN0IGZvbnQgPSBmb250RmluZGVyLmZpbmQoIkhlbHZldGljYSIsIGZhbHNlKSB8fCBmb250RmluZGVyLmZpbmQoIk15cmlhZCBQcm8iLCBmYWxzZSkgfHwgZm9udEZpbmRlci5maW5kKCJBcmlhbCIsIGZhbHNlKSB8fCBmb250RmluZGVyLmdldERlZmF1bHQoKTsKICAgIGlmIChmb250Py5yZWd1bGFyKSB7CiAgICAgIGNvbnN0IHBkZkZvbnQgPSBmb250LnJlZ3VsYXI7CiAgICAgIGNvbnN0IGluZm8gPSBwZGZGb250LmNzc0ZvbnRJbmZvOwogICAgICBjb25zdCB4ZmFGb250ID0gewogICAgICAgIHR5cGVmYWNlOiBpbmZvLmZvbnRGYW1pbHksCiAgICAgICAgcG9zdHVyZTogIm5vcm1hbCIsCiAgICAgICAgd2VpZ2h0OiAibm9ybWFsIiwKICAgICAgICBzaXplOiAxMCwKICAgICAgICBsZXR0ZXJTcGFjaW5nOiAwCiAgICAgIH07CiAgICAgIHJldHVybiBbcGRmRm9udCwgeGZhRm9udF07CiAgICB9CiAgICBjb25zdCB4ZmFGb250ID0gewogICAgICB0eXBlZmFjZTogIkNvdXJpZXIiLAogICAgICBwb3N0dXJlOiAibm9ybWFsIiwKICAgICAgd2VpZ2h0OiAibm9ybWFsIiwKICAgICAgc2l6ZTogMTAsCiAgICAgIGxldHRlclNwYWNpbmc6IDAKICAgIH07CiAgICByZXR1cm4gW251bGwsIHhmYUZvbnRdOwogIH0KfQpjbGFzcyBGb250U2VsZWN0b3IgewogIGNvbnN0cnVjdG9yKGRlZmF1bHRYZmFGb250LCBkZWZhdWx0UGFyYU1hcmdpbiwgZGVmYXVsdExpbmVIZWlnaHQsIGZvbnRGaW5kZXIpIHsKICAgIHRoaXMuZm9udEZpbmRlciA9IGZvbnRGaW5kZXI7CiAgICB0aGlzLnN0YWNrID0gW25ldyBGb250SW5mbyhkZWZhdWx0WGZhRm9udCwgZGVmYXVsdFBhcmFNYXJnaW4sIGRlZmF1bHRMaW5lSGVpZ2h0LCBmb250RmluZGVyKV07CiAgfQogIHB1c2hEYXRhKHhmYUZvbnQsIG1hcmdpbiwgbGluZUhlaWdodCkgewogICAgY29uc3QgbGFzdEZvbnQgPSB0aGlzLnN0YWNrLmF0KC0xKTsKICAgIGZvciAoY29uc3QgbmFtZSBvZiBbInR5cGVmYWNlIiwgInBvc3R1cmUiLCAid2VpZ2h0IiwgInNpemUiLCAibGV0dGVyU3BhY2luZyJdKSB7CiAgICAgIGlmICgheGZhRm9udFtuYW1lXSkgewogICAgICAgIHhmYUZvbnRbbmFtZV0gPSBsYXN0Rm9udC54ZmFGb250W25hbWVdOwogICAgICB9CiAgICB9CiAgICBmb3IgKGNvbnN0IG5hbWUgb2YgWyJ0b3AiLCAiYm90dG9tIiwgImxlZnQiLCAicmlnaHQiXSkgewogICAgICBpZiAoaXNOYU4obWFyZ2luW25hbWVdKSkgewogICAgICAgIG1hcmdpbltuYW1lXSA9IGxhc3RGb250LnBhcmFNYXJnaW5bbmFtZV07CiAgICAgIH0KICAgIH0KICAgIGNvbnN0IGZvbnRJbmZvID0gbmV3IEZvbnRJbmZvKHhmYUZvbnQsIG1hcmdpbiwgbGluZUhlaWdodCB8fCBsYXN0Rm9udC5saW5lSGVpZ2h0LCB0aGlzLmZvbnRGaW5kZXIpOwogICAgaWYgKCFmb250SW5mby5wZGZGb250KSB7CiAgICAgIGZvbnRJbmZvLnBkZkZvbnQgPSBsYXN0Rm9udC5wZGZGb250OwogICAgfQogICAgdGhpcy5zdGFjay5wdXNoKGZvbnRJbmZvKTsKICB9CiAgcG9wRm9udCgpIHsKICAgIHRoaXMuc3RhY2sucG9wKCk7CiAgfQogIHRvcEZvbnQoKSB7CiAgICByZXR1cm4gdGhpcy5zdGFjay5hdCgtMSk7CiAgfQp9CmNsYXNzIFRleHRNZWFzdXJlIHsKICBjb25zdHJ1Y3RvcihkZWZhdWx0WGZhRm9udCwgZGVmYXVsdFBhcmFNYXJnaW4sIGRlZmF1bHRMaW5lSGVpZ2h0LCBmb250cykgewogICAgdGhpcy5nbHlwaHMgPSBbXTsKICAgIHRoaXMuZm9udFNlbGVjdG9yID0gbmV3IEZvbnRTZWxlY3RvcihkZWZhdWx0WGZhRm9udCwgZGVmYXVsdFBhcmFNYXJnaW4sIGRlZmF1bHRMaW5lSGVpZ2h0LCBmb250cyk7CiAgICB0aGlzLmV4dHJhSGVpZ2h0ID0gMDsKICB9CiAgcHVzaERhdGEoeGZhRm9udCwgbWFyZ2luLCBsaW5lSGVpZ2h0KSB7CiAgICB0aGlzLmZvbnRTZWxlY3Rvci5wdXNoRGF0YSh4ZmFGb250LCBtYXJnaW4sIGxpbmVIZWlnaHQpOwogIH0KICBwb3BGb250KHhmYUZvbnQpIHsKICAgIHJldHVybiB0aGlzLmZvbnRTZWxlY3Rvci5wb3BGb250KCk7CiAgfQogIGFkZFBhcmEoKSB7CiAgICBjb25zdCBsYXN0Rm9udCA9IHRoaXMuZm9udFNlbGVjdG9yLnRvcEZvbnQoKTsKICAgIHRoaXMuZXh0cmFIZWlnaHQgKz0gbGFzdEZvbnQucGFyYU1hcmdpbi50b3AgKyBsYXN0Rm9udC5wYXJhTWFyZ2luLmJvdHRvbTsKICB9CiAgYWRkU3RyaW5nKHN0cikgewogICAgaWYgKCFzdHIpIHsKICAgICAgcmV0dXJuOwogICAgfQogICAgY29uc3QgbGFzdEZvbnQgPSB0aGlzLmZvbnRTZWxlY3Rvci50b3BGb250KCk7CiAgICBjb25zdCBmb250U2l6ZSA9IGxhc3RGb250LnhmYUZvbnQuc2l6ZTsKICAgIGlmIChsYXN0Rm9udC5wZGZGb250KSB7CiAgICAgIGNvbnN0IGxldHRlclNwYWNpbmcgPSBsYXN0Rm9udC54ZmFGb250LmxldHRlclNwYWNpbmc7CiAgICAgIGNvbnN0IHBkZkZvbnQgPSBsYXN0Rm9udC5wZGZGb250OwogICAgICBjb25zdCBmb250TGluZUhlaWdodCA9IHBkZkZvbnQubGluZUhlaWdodCB8fCAxLjI7CiAgICAgIGNvbnN0IGxpbmVIZWlnaHQgPSBsYXN0Rm9udC5saW5lSGVpZ2h0IHx8IE1hdGgubWF4KDEuMiwgZm9udExpbmVIZWlnaHQpICogZm9udFNpemU7CiAgICAgIGNvbnN0IGxpbmVHYXAgPSBwZGZGb250LmxpbmVHYXAgPT09IHVuZGVmaW5lZCA/IDAuMiA6IHBkZkZvbnQubGluZUdhcDsKICAgICAgY29uc3Qgbm9HYXAgPSBmb250TGluZUhlaWdodCAtIGxpbmVHYXA7CiAgICAgIGNvbnN0IGZpcnN0TGluZUhlaWdodCA9IE1hdGgubWF4KDEsIG5vR2FwKSAqIGZvbnRTaXplOwogICAgICBjb25zdCBzY2FsZSA9IGZvbnRTaXplIC8gMTAwMDsKICAgICAgY29uc3QgZmFsbGJhY2tXaWR0aCA9IHBkZkZvbnQuZGVmYXVsdFdpZHRoIHx8IHBkZkZvbnQuY2hhcnNUb0dseXBocygiICIpWzBdLndpZHRoOwogICAgICBmb3IgKGNvbnN0IGxpbmUgb2Ygc3RyLnNwbGl0KC9bXHUyMDI5XG5dLykpIHsKICAgICAgICBjb25zdCBlbmNvZGVkTGluZSA9IHBkZkZvbnQuZW5jb2RlU3RyaW5nKGxpbmUpLmpvaW4oIiIpOwogICAgICAgIGNvbnN0IGdseXBocyA9IHBkZkZvbnQuY2hhcnNUb0dseXBocyhlbmNvZGVkTGluZSk7CiAgICAgICAgZm9yIChjb25zdCBnbHlwaCBvZiBnbHlwaHMpIHsKICAgICAgICAgIGNvbnN0IHdpZHRoID0gZ2x5cGgud2lkdGggfHwgZmFsbGJhY2tXaWR0aDsKICAgICAgICAgIHRoaXMuZ2x5cGhzLnB1c2goW3dpZHRoICogc2NhbGUgKyBsZXR0ZXJTcGFjaW5nLCBsaW5lSGVpZ2h0LCBmaXJzdExpbmVIZWlnaHQsIGdseXBoLnVuaWNvZGUsIGZhbHNlXSk7CiAgICAgICAgfQogICAgICAgIHRoaXMuZ2x5cGhzLnB1c2goWzAsIDAsIDAsICJcbiIsIHRydWVdKTsKICAgICAgfQogICAgICB0aGlzLmdseXBocy5wb3AoKTsKICAgICAgcmV0dXJuOwogICAgfQogICAgZm9yIChjb25zdCBsaW5lIG9mIHN0ci5zcGxpdCgvW1x1MjAyOVxuXS8pKSB7CiAgICAgIGZvciAoY29uc3QgY2hhciBvZiBsaW5lLnNwbGl0KCIiKSkgewogICAgICAgIHRoaXMuZ2x5cGhzLnB1c2goW2ZvbnRTaXplLCAxLjIgKiBmb250U2l6ZSwgZm9udFNpemUsIGNoYXIsIGZhbHNlXSk7CiAgICAgIH0KICAgICAgdGhpcy5nbHlwaHMucHVzaChbMCwgMCwgMCwgIlxuIiwgdHJ1ZV0pOwogICAgfQogICAgdGhpcy5nbHlwaHMucG9wKCk7CiAgfQogIGNvbXB1dGUobWF4V2lkdGgpIHsKICAgIGxldCBsYXN0U3BhY2VQb3MgPSAtMSwKICAgICAgbGFzdFNwYWNlV2lkdGggPSAwLAogICAgICB3aWR0aCA9IDAsCiAgICAgIGhlaWdodCA9IDAsCiAgICAgIGN1cnJlbnRMaW5lV2lkdGggPSAwLAogICAgICBjdXJyZW50TGluZUhlaWdodCA9IDA7CiAgICBsZXQgaXNCcm9rZW4gPSBmYWxzZTsKICAgIGxldCBpc0ZpcnN0TGluZSA9IHRydWU7CiAgICBmb3IgKGxldCBpID0gMCwgaWkgPSB0aGlzLmdseXBocy5sZW5ndGg7IGkgPCBpaTsgaSsrKSB7CiAgICAgIGNvbnN0IFtnbHlwaFdpZHRoLCBsaW5lSGVpZ2h0LCBmaXJzdExpbmVIZWlnaHQsIGNoYXIsIGlzRU9MXSA9IHRoaXMuZ2x5cGhzW2ldOwogICAgICBjb25zdCBpc1NwYWNlID0gY2hhciA9PT0gIiAiOwogICAgICBjb25zdCBnbHlwaEhlaWdodCA9IGlzRmlyc3RMaW5lID8gZmlyc3RMaW5lSGVpZ2h0IDogbGluZUhlaWdodDsKICAgICAgaWYgKGlzRU9MKSB7CiAgICAgICAgd2lkdGggPSBNYXRoLm1heCh3aWR0aCwgY3VycmVudExpbmVXaWR0aCk7CiAgICAgICAgY3VycmVudExpbmVXaWR0aCA9IDA7CiAgICAgICAgaGVpZ2h0ICs9IGN1cnJlbnRMaW5lSGVpZ2h0OwogICAgICAgIGN1cnJlbnRMaW5lSGVpZ2h0ID0gZ2x5cGhIZWlnaHQ7CiAgICAgICAgbGFzdFNwYWNlUG9zID0gLTE7CiAgICAgICAgbGFzdFNwYWNlV2lkdGggPSAwOwogICAgICAgIGlzRmlyc3RMaW5lID0gZmFsc2U7CiAgICAgICAgY29udGludWU7CiAgICAgIH0KICAgICAgaWYgKGlzU3BhY2UpIHsKICAgICAgICBpZiAoY3VycmVudExpbmVXaWR0aCArIGdseXBoV2lkdGggPiBtYXhXaWR0aCkgewogICAgICAgICAgd2lkdGggPSBNYXRoLm1heCh3aWR0aCwgY3VycmVudExpbmVXaWR0aCk7CiAgICAgICAgICBjdXJyZW50TGluZVdpZHRoID0gMDsKICAgICAgICAgIGhlaWdodCArPSBjdXJyZW50TGluZUhlaWdodDsKICAgICAgICAgIGN1cnJlbnRMaW5lSGVpZ2h0ID0gZ2x5cGhIZWlnaHQ7CiAgICAgICAgICBsYXN0U3BhY2VQb3MgPSAtMTsKICAgICAgICAgIGxhc3RTcGFjZVdpZHRoID0gMDsKICAgICAgICAgIGlzQnJva2VuID0gdHJ1ZTsKICAgICAgICAgIGlzRmlyc3RMaW5lID0gZmFsc2U7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIGN1cnJlbnRMaW5lSGVpZ2h0ID0gTWF0aC5tYXgoZ2x5cGhIZWlnaHQsIGN1cnJlbnRMaW5lSGVpZ2h0KTsKICAgICAgICAgIGxhc3RTcGFjZVdpZHRoID0gY3VycmVudExpbmVXaWR0aDsKICAgICAgICAgIGN1cnJlbnRMaW5lV2lkdGggKz0gZ2x5cGhXaWR0aDsKICAgICAgICAgIGxhc3RTcGFjZVBvcyA9IGk7CiAgICAgICAgfQogICAgICAgIGNvbnRpbnVlOwogICAgICB9CiAgICAgIGlmIChjdXJyZW50TGluZVdpZHRoICsgZ2x5cGhXaWR0aCA+IG1heFdpZHRoKSB7CiAgICAgICAgaGVpZ2h0ICs9IGN1cnJlbnRMaW5lSGVpZ2h0OwogICAgICAgIGN1cnJlbnRMaW5lSGVpZ2h0ID0gZ2x5cGhIZWlnaHQ7CiAgICAgICAgaWYgKGxhc3RTcGFjZVBvcyAhPT0gLTEpIHsKICAgICAgICAgIGkgPSBsYXN0U3BhY2VQb3M7CiAgICAgICAgICB3aWR0aCA9IE1hdGgubWF4KHdpZHRoLCBsYXN0U3BhY2VXaWR0aCk7CiAgICAgICAgICBjdXJyZW50TGluZVdpZHRoID0gMDsKICAgICAgICAgIGxhc3RTcGFjZVBvcyA9IC0xOwogICAgICAgICAgbGFzdFNwYWNlV2lkdGggPSAwOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICB3aWR0aCA9IE1hdGgubWF4KHdpZHRoLCBjdXJyZW50TGluZVdpZHRoKTsKICAgICAgICAgIGN1cnJlbnRMaW5lV2lkdGggPSBnbHlwaFdpZHRoOwogICAgICAgIH0KICAgICAgICBpc0Jyb2tlbiA9IHRydWU7CiAgICAgICAgaXNGaXJzdExpbmUgPSBmYWxzZTsKICAgICAgICBjb250aW51ZTsKICAgICAgfQogICAgICBjdXJyZW50TGluZVdpZHRoICs9IGdseXBoV2lkdGg7CiAgICAgIGN1cnJlbnRMaW5lSGVpZ2h0ID0gTWF0aC5tYXgoZ2x5cGhIZWlnaHQsIGN1cnJlbnRMaW5lSGVpZ2h0KTsKICAgIH0KICAgIHdpZHRoID0gTWF0aC5tYXgod2lkdGgsIGN1cnJlbnRMaW5lV2lkdGgpOwogICAgaGVpZ2h0ICs9IGN1cnJlbnRMaW5lSGVpZ2h0ICsgdGhpcy5leHRyYUhlaWdodDsKICAgIHJldHVybiB7CiAgICAgIHdpZHRoOiBXSURUSF9GQUNUT1IgKiB3aWR0aCwKICAgICAgaGVpZ2h0LAogICAgICBpc0Jyb2tlbgogICAgfTsKICB9Cn0KZXhwb3J0cy5UZXh0TWVhc3VyZSA9IFRleHRNZWFzdXJlOwoKLyoqKi8gfSksCi8qIDg3ICovCi8qKiovICgoX191bnVzZWRfd2VicGFja19tb2R1bGUsIGV4cG9ydHMsIF9fd19wZGZqc19yZXF1aXJlX18pID0+IHsKCgoKT2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsICJfX2VzTW9kdWxlIiwgKHsKICB2YWx1ZTogdHJ1ZQp9KSk7CmV4cG9ydHMuWG1sT2JqZWN0ID0gZXhwb3J0cy5YRkFPYmplY3RBcnJheSA9IGV4cG9ydHMuWEZBT2JqZWN0ID0gZXhwb3J0cy5YRkFBdHRyaWJ1dGUgPSBleHBvcnRzLlN0cmluZ09iamVjdCA9IGV4cG9ydHMuT3B0aW9uT2JqZWN0ID0gZXhwb3J0cy5PcHRpb24xMCA9IGV4cG9ydHMuT3B0aW9uMDEgPSBleHBvcnRzLkludGVnZXJPYmplY3QgPSBleHBvcnRzLkNvbnRlbnRPYmplY3QgPSB2b2lkIDA7CnZhciBfc3ltYm9sX3V0aWxzID0gX193X3BkZmpzX3JlcXVpcmVfXyg3OCk7CnZhciBfdXRpbHMgPSBfX3dfcGRmanNfcmVxdWlyZV9fKDg0KTsKdmFyIF91dGlsID0gX193X3BkZmpzX3JlcXVpcmVfXygyKTsKdmFyIF9jb3JlX3V0aWxzID0gX193X3BkZmpzX3JlcXVpcmVfXygzKTsKdmFyIF9uYW1lc3BhY2VzID0gX193X3BkZmpzX3JlcXVpcmVfXyg4MSk7CnZhciBfc29tID0gX193X3BkZmpzX3JlcXVpcmVfXyg4OCk7CmNvbnN0IF9hcHBseVByb3RvdHlwZSA9IFN5bWJvbCgpOwpjb25zdCBfYXR0cmlidXRlcyA9IFN5bWJvbCgpOwpjb25zdCBfYXR0cmlidXRlTmFtZXMgPSBTeW1ib2woKTsKY29uc3QgX2NoaWxkcmVuID0gU3ltYm9sKCJfY2hpbGRyZW4iKTsKY29uc3QgX2Nsb25lQXR0cmlidXRlID0gU3ltYm9sKCk7CmNvbnN0IF9kYXRhVmFsdWUgPSBTeW1ib2woKTsKY29uc3QgX2RlZmF1bHRWYWx1ZSA9IFN5bWJvbCgpOwpjb25zdCBfZmlsdGVyZWRDaGlsZHJlbkdlbmVyYXRvciA9IFN5bWJvbCgpOwpjb25zdCBfZ2V0UHJvdG90eXBlID0gU3ltYm9sKCk7CmNvbnN0IF9nZXRVbnNldEF0dHJpYnV0ZXMgPSBTeW1ib2woKTsKY29uc3QgX2hhc0NoaWxkcmVuID0gU3ltYm9sKCk7CmNvbnN0IF9tYXggPSBTeW1ib2woKTsKY29uc3QgX29wdGlvbnMgPSBTeW1ib2woKTsKY29uc3QgX3BhcmVudCA9IFN5bWJvbCgicGFyZW50Iik7CmNvbnN0IF9yZXNvbHZlUHJvdG90eXBlc0hlbHBlciA9IFN5bWJvbCgpOwpjb25zdCBfc2V0QXR0cmlidXRlcyA9IFN5bWJvbCgpOwpjb25zdCBfdmFsaWRhdG9yID0gU3ltYm9sKCk7CmxldCB1aWQgPSAwOwpjb25zdCBOU19EQVRBU0VUUyA9IF9uYW1lc3BhY2VzLk5hbWVzcGFjZUlkcy5kYXRhc2V0cy5pZDsKY2xhc3MgWEZBT2JqZWN0IHsKICBjb25zdHJ1Y3Rvcihuc0lkLCBuYW1lLCBoYXNDaGlsZHJlbiA9IGZhbHNlKSB7CiAgICB0aGlzW19zeW1ib2xfdXRpbHMuJG5hbWVzcGFjZUlkXSA9IG5zSWQ7CiAgICB0aGlzW19zeW1ib2xfdXRpbHMuJG5vZGVOYW1lXSA9IG5hbWU7CiAgICB0aGlzW19oYXNDaGlsZHJlbl0gPSBoYXNDaGlsZHJlbjsKICAgIHRoaXNbX3BhcmVudF0gPSBudWxsOwogICAgdGhpc1tfY2hpbGRyZW5dID0gW107CiAgICB0aGlzW19zeW1ib2xfdXRpbHMuJHVpZF0gPSBgJHtuYW1lfSR7dWlkKyt9YDsKICAgIHRoaXNbX3N5bWJvbF91dGlscy4kZ2xvYmFsRGF0YV0gPSBudWxsOwogIH0KICBnZXQgaXNYRkFPYmplY3QoKSB7CiAgICByZXR1cm4gdHJ1ZTsKICB9CiAgZ2V0IGlzWEZBT2JqZWN0QXJyYXkoKSB7CiAgICByZXR1cm4gZmFsc2U7CiAgfQogIGNyZWF0ZU5vZGVzKHBhdGgpIHsKICAgIGxldCByb290ID0gdGhpcywKICAgICAgbm9kZSA9IG51bGw7CiAgICBmb3IgKGNvbnN0IHsKICAgICAgbmFtZSwKICAgICAgaW5kZXgKICAgIH0gb2YgcGF0aCkgewogICAgICBmb3IgKGxldCBpID0gMCwgaWkgPSBpc0Zpbml0ZShpbmRleCkgPyBpbmRleCA6IDA7IGkgPD0gaWk7IGkrKykgewogICAgICAgIGNvbnN0IG5zSWQgPSByb290W19zeW1ib2xfdXRpbHMuJG5hbWVzcGFjZUlkXSA9PT0gTlNfREFUQVNFVFMgPyAtMSA6IHJvb3RbX3N5bWJvbF91dGlscy4kbmFtZXNwYWNlSWRdOwogICAgICAgIG5vZGUgPSBuZXcgWG1sT2JqZWN0KG5zSWQsIG5hbWUpOwogICAgICAgIHJvb3RbX3N5bWJvbF91dGlscy4kYXBwZW5kQ2hpbGRdKG5vZGUpOwogICAgICB9CiAgICAgIHJvb3QgPSBub2RlOwogICAgfQogICAgcmV0dXJuIG5vZGU7CiAgfQogIFtfc3ltYm9sX3V0aWxzLiRvbkNoaWxkXShjaGlsZCkgewogICAgaWYgKCF0aGlzW19oYXNDaGlsZHJlbl0gfHwgIXRoaXNbX3N5bWJvbF91dGlscy4kb25DaGlsZENoZWNrXShjaGlsZCkpIHsKICAgICAgcmV0dXJuIGZhbHNlOwogICAgfQogICAgY29uc3QgbmFtZSA9IGNoaWxkW19zeW1ib2xfdXRpbHMuJG5vZGVOYW1lXTsKICAgIGNvbnN0IG5vZGUgPSB0aGlzW25hbWVdOwogICAgaWYgKG5vZGUgaW5zdGFuY2VvZiBYRkFPYmplY3RBcnJheSkgewogICAgICBpZiAobm9kZS5wdXNoKGNoaWxkKSkgewogICAgICAgIHRoaXNbX3N5bWJvbF91dGlscy4kYXBwZW5kQ2hpbGRdKGNoaWxkKTsKICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgfQogICAgfSBlbHNlIHsKICAgICAgaWYgKG5vZGUgIT09IG51bGwpIHsKICAgICAgICB0aGlzW19zeW1ib2xfdXRpbHMuJHJlbW92ZUNoaWxkXShub2RlKTsKICAgICAgfQogICAgICB0aGlzW25hbWVdID0gY2hpbGQ7CiAgICAgIHRoaXNbX3N5bWJvbF91dGlscy4kYXBwZW5kQ2hpbGRdKGNoaWxkKTsKICAgICAgcmV0dXJuIHRydWU7CiAgICB9CiAgICBsZXQgaWQgPSAiIjsKICAgIGlmICh0aGlzLmlkKSB7CiAgICAgIGlkID0gYCAoaWQ6ICR7dGhpcy5pZH0pYDsKICAgIH0gZWxzZSBpZiAodGhpcy5uYW1lKSB7CiAgICAgIGlkID0gYCAobmFtZTogJHt0aGlzLm5hbWV9ICR7dGhpcy5oLnZhbHVlfSlgOwogICAgfQogICAgKDAsIF91dGlsLndhcm4pKGBYRkEgLSBub2RlICIke3RoaXNbX3N5bWJvbF91dGlscy4kbm9kZU5hbWVdfSIke2lkfSBoYXMgYWxyZWFkeSBlbm91Z2ggIiR7bmFtZX0iIWApOwogICAgcmV0dXJuIGZhbHNlOwogIH0KICBbX3N5bWJvbF91dGlscy4kb25DaGlsZENoZWNrXShjaGlsZCkgewogICAgcmV0dXJuIHRoaXMuaGFzT3duUHJvcGVydHkoY2hpbGRbX3N5bWJvbF91dGlscy4kbm9kZU5hbWVdKSAmJiBjaGlsZFtfc3ltYm9sX3V0aWxzLiRuYW1lc3BhY2VJZF0gPT09IHRoaXNbX3N5bWJvbF91dGlscy4kbmFtZXNwYWNlSWRdOwogIH0KICBbX3N5bWJvbF91dGlscy4kaXNOc0Fnbm9zdGljXSgpIHsKICAgIHJldHVybiBmYWxzZTsKICB9CiAgW19zeW1ib2xfdXRpbHMuJGFjY2VwdFdoaXRlc3BhY2VdKCkgewogICAgcmV0dXJuIGZhbHNlOwogIH0KICBbX3N5bWJvbF91dGlscy4kaXNDREFUQVhtbF0oKSB7CiAgICByZXR1cm4gZmFsc2U7CiAgfQogIFtfc3ltYm9sX3V0aWxzLiRpc0JpbmRhYmxlXSgpIHsKICAgIHJldHVybiBmYWxzZTsKICB9CiAgW19zeW1ib2xfdXRpbHMuJHBvcFBhcmFdKCkgewogICAgaWYgKHRoaXMucGFyYSkgewogICAgICB0aGlzW19zeW1ib2xfdXRpbHMuJGdldFRlbXBsYXRlUm9vdF0oKVtfc3ltYm9sX3V0aWxzLiRleHRyYV0ucGFyYVN0YWNrLnBvcCgpOwogICAgfQogIH0KICBbX3N5bWJvbF91dGlscy4kcHVzaFBhcmFdKCkgewogICAgdGhpc1tfc3ltYm9sX3V0aWxzLiRnZXRUZW1wbGF0ZVJvb3RdKClbX3N5bWJvbF91dGlscy4kZXh0cmFdLnBhcmFTdGFjay5wdXNoKHRoaXMucGFyYSk7CiAgfQogIFtfc3ltYm9sX3V0aWxzLiRzZXRJZF0oaWRzKSB7CiAgICBpZiAodGhpcy5pZCAmJiB0aGlzW19zeW1ib2xfdXRpbHMuJG5hbWVzcGFjZUlkXSA9PT0gX25hbWVzcGFjZXMuTmFtZXNwYWNlSWRzLnRlbXBsYXRlLmlkKSB7CiAgICAgIGlkcy5zZXQodGhpcy5pZCwgdGhpcyk7CiAgICB9CiAgfQogIFtfc3ltYm9sX3V0aWxzLiRnZXRUZW1wbGF0ZVJvb3RdKCkgewogICAgcmV0dXJuIHRoaXNbX3N5bWJvbF91dGlscy4kZ2xvYmFsRGF0YV0udGVtcGxhdGU7CiAgfQogIFtfc3ltYm9sX3V0aWxzLiRpc1NwbGl0dGFibGVdKCkgewogICAgcmV0dXJuIGZhbHNlOwogIH0KICBbX3N5bWJvbF91dGlscy4kaXNUaGVyZU1vcmVXaWR0aF0oKSB7CiAgICByZXR1cm4gZmFsc2U7CiAgfQogIFtfc3ltYm9sX3V0aWxzLiRhcHBlbmRDaGlsZF0oY2hpbGQpIHsKICAgIGNoaWxkW19wYXJlbnRdID0gdGhpczsKICAgIHRoaXNbX2NoaWxkcmVuXS5wdXNoKGNoaWxkKTsKICAgIGlmICghY2hpbGRbX3N5bWJvbF91dGlscy4kZ2xvYmFsRGF0YV0gJiYgdGhpc1tfc3ltYm9sX3V0aWxzLiRnbG9iYWxEYXRhXSkgewogICAgICBjaGlsZFtfc3ltYm9sX3V0aWxzLiRnbG9iYWxEYXRhXSA9IHRoaXNbX3N5bWJvbF91dGlscy4kZ2xvYmFsRGF0YV07CiAgICB9CiAgfQogIFtfc3ltYm9sX3V0aWxzLiRyZW1vdmVDaGlsZF0oY2hpbGQpIHsKICAgIGNvbnN0IGkgPSB0aGlzW19jaGlsZHJlbl0uaW5kZXhPZihjaGlsZCk7CiAgICB0aGlzW19jaGlsZHJlbl0uc3BsaWNlKGksIDEpOwogIH0KICBbX3N5bWJvbF91dGlscy4kaGFzU2V0dGFibGVWYWx1ZV0oKSB7CiAgICByZXR1cm4gdGhpcy5oYXNPd25Qcm9wZXJ0eSgidmFsdWUiKTsKICB9CiAgW19zeW1ib2xfdXRpbHMuJHNldFZhbHVlXShfKSB7fQogIFtfc3ltYm9sX3V0aWxzLiRvblRleHRdKF8pIHt9CiAgW19zeW1ib2xfdXRpbHMuJGZpbmFsaXplXSgpIHt9CiAgW19zeW1ib2xfdXRpbHMuJGNsZWFuXShidWlsZGVyKSB7CiAgICBkZWxldGUgdGhpc1tfaGFzQ2hpbGRyZW5dOwogICAgaWYgKHRoaXNbX3N5bWJvbF91dGlscy4kY2xlYW51cF0pIHsKICAgICAgYnVpbGRlci5jbGVhbih0aGlzW19zeW1ib2xfdXRpbHMuJGNsZWFudXBdKTsKICAgICAgZGVsZXRlIHRoaXNbX3N5bWJvbF91dGlscy4kY2xlYW51cF07CiAgICB9CiAgfQogIFtfc3ltYm9sX3V0aWxzLiRpbmRleE9mXShjaGlsZCkgewogICAgcmV0dXJuIHRoaXNbX2NoaWxkcmVuXS5pbmRleE9mKGNoaWxkKTsKICB9CiAgW19zeW1ib2xfdXRpbHMuJGluc2VydEF0XShpLCBjaGlsZCkgewogICAgY2hpbGRbX3BhcmVudF0gPSB0aGlzOwogICAgdGhpc1tfY2hpbGRyZW5dLnNwbGljZShpLCAwLCBjaGlsZCk7CiAgICBpZiAoIWNoaWxkW19zeW1ib2xfdXRpbHMuJGdsb2JhbERhdGFdICYmIHRoaXNbX3N5bWJvbF91dGlscy4kZ2xvYmFsRGF0YV0pIHsKICAgICAgY2hpbGRbX3N5bWJvbF91dGlscy4kZ2xvYmFsRGF0YV0gPSB0aGlzW19zeW1ib2xfdXRpbHMuJGdsb2JhbERhdGFdOwogICAgfQogIH0KICBbX3N5bWJvbF91dGlscy4kaXNUcmFuc3BhcmVudF0oKSB7CiAgICByZXR1cm4gIXRoaXMubmFtZTsKICB9CiAgW19zeW1ib2xfdXRpbHMuJGxhc3RBdHRyaWJ1dGVdKCkgewogICAgcmV0dXJuICIiOwogIH0KICBbX3N5bWJvbF91dGlscy4kdGV4dF0oKSB7CiAgICBpZiAodGhpc1tfY2hpbGRyZW5dLmxlbmd0aCA9PT0gMCkgewogICAgICByZXR1cm4gdGhpc1tfc3ltYm9sX3V0aWxzLiRjb250ZW50XTsKICAgIH0KICAgIHJldHVybiB0aGlzW19jaGlsZHJlbl0ubWFwKGMgPT4gY1tfc3ltYm9sX3V0aWxzLiR0ZXh0XSgpKS5qb2luKCIiKTsKICB9CiAgZ2V0IFtfYXR0cmlidXRlTmFtZXNdKCkgewogICAgY29uc3QgcHJvdG8gPSBPYmplY3QuZ2V0UHJvdG90eXBlT2YodGhpcyk7CiAgICBpZiAoIXByb3RvLl9hdHRyaWJ1dGVzKSB7CiAgICAgIGNvbnN0IGF0dHJpYnV0ZXMgPSBwcm90by5fYXR0cmlidXRlcyA9IG5ldyBTZXQoKTsKICAgICAgZm9yIChjb25zdCBuYW1lIG9mIE9iamVjdC5nZXRPd25Qcm9wZXJ0eU5hbWVzKHRoaXMpKSB7CiAgICAgICAgaWYgKHRoaXNbbmFtZV0gPT09IG51bGwgfHwgdGhpc1tuYW1lXSBpbnN0YW5jZW9mIFhGQU9iamVjdCB8fCB0aGlzW25hbWVdIGluc3RhbmNlb2YgWEZBT2JqZWN0QXJyYXkpIHsKICAgICAgICAgIGJyZWFrOwogICAgICAgIH0KICAgICAgICBhdHRyaWJ1dGVzLmFkZChuYW1lKTsKICAgICAgfQogICAgfQogICAgcmV0dXJuICgwLCBfdXRpbC5zaGFkb3cpKHRoaXMsIF9hdHRyaWJ1dGVOYW1lcywgcHJvdG8uX2F0dHJpYnV0ZXMpOwogIH0KICBbX3N5bWJvbF91dGlscy4kaXNEZXNjZW5kZW50XShwYXJlbnQpIHsKICAgIGxldCBub2RlID0gdGhpczsKICAgIHdoaWxlIChub2RlKSB7CiAgICAgIGlmIChub2RlID09PSBwYXJlbnQpIHsKICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgfQogICAgICBub2RlID0gbm9kZVtfc3ltYm9sX3V0aWxzLiRnZXRQYXJlbnRdKCk7CiAgICB9CiAgICByZXR1cm4gZmFsc2U7CiAgfQogIFtfc3ltYm9sX3V0aWxzLiRnZXRQYXJlbnRdKCkgewogICAgcmV0dXJuIHRoaXNbX3BhcmVudF07CiAgfQogIFtfc3ltYm9sX3V0aWxzLiRnZXRTdWJmb3JtUGFyZW50XSgpIHsKICAgIHJldHVybiB0aGlzW19zeW1ib2xfdXRpbHMuJGdldFBhcmVudF0oKTsKICB9CiAgW19zeW1ib2xfdXRpbHMuJGdldENoaWxkcmVuXShuYW1lID0gbnVsbCkgewogICAgaWYgKCFuYW1lKSB7CiAgICAgIHJldHVybiB0aGlzW19jaGlsZHJlbl07CiAgICB9CiAgICByZXR1cm4gdGhpc1tuYW1lXTsKICB9CiAgW19zeW1ib2xfdXRpbHMuJGR1bXBdKCkgewogICAgY29uc3QgZHVtcGVkID0gT2JqZWN0LmNyZWF0ZShudWxsKTsKICAgIGlmICh0aGlzW19zeW1ib2xfdXRpbHMuJGNvbnRlbnRdKSB7CiAgICAgIGR1bXBlZC4kY29udGVudCA9IHRoaXNbX3N5bWJvbF91dGlscy4kY29udGVudF07CiAgICB9CiAgICBmb3IgKGNvbnN0IG5hbWUgb2YgT2JqZWN0LmdldE93blByb3BlcnR5TmFtZXModGhpcykpIHsKICAgICAgY29uc3QgdmFsdWUgPSB0aGlzW25hbWVdOwogICAgICBpZiAodmFsdWUgPT09IG51bGwpIHsKICAgICAgICBjb250aW51ZTsKICAgICAgfQogICAgICBpZiAodmFsdWUgaW5zdGFuY2VvZiBYRkFPYmplY3QpIHsKICAgICAgICBkdW1wZWRbbmFtZV0gPSB2YWx1ZVtfc3ltYm9sX3V0aWxzLiRkdW1wXSgpOwogICAgICB9IGVsc2UgaWYgKHZhbHVlIGluc3RhbmNlb2YgWEZBT2JqZWN0QXJyYXkpIHsKICAgICAgICBpZiAoIXZhbHVlLmlzRW1wdHkoKSkgewogICAgICAgICAgZHVtcGVkW25hbWVdID0gdmFsdWUuZHVtcCgpOwogICAgICAgIH0KICAgICAgfSBlbHNlIHsKICAgICAgICBkdW1wZWRbbmFtZV0gPSB2YWx1ZTsKICAgICAgfQogICAgfQogICAgcmV0dXJuIGR1bXBlZDsKICB9CiAgW19zeW1ib2xfdXRpbHMuJHRvU3R5bGVdKCkgewogICAgcmV0dXJuIG51bGw7CiAgfQogIFtfc3ltYm9sX3V0aWxzLiR0b0hUTUxdKCkgewogICAgcmV0dXJuIF91dGlscy5IVE1MUmVzdWx0LkVNUFRZOwogIH0KICAqW19zeW1ib2xfdXRpbHMuJGdldENvbnRhaW5lZENoaWxkcmVuXSgpIHsKICAgIGZvciAoY29uc3Qgbm9kZSBvZiB0aGlzW19zeW1ib2xfdXRpbHMuJGdldENoaWxkcmVuXSgpKSB7CiAgICAgIHlpZWxkIG5vZGU7CiAgICB9CiAgfQogICpbX2ZpbHRlcmVkQ2hpbGRyZW5HZW5lcmF0b3JdKGZpbHRlciwgaW5jbHVkZSkgewogICAgZm9yIChjb25zdCBub2RlIG9mIHRoaXNbX3N5bWJvbF91dGlscy4kZ2V0Q29udGFpbmVkQ2hpbGRyZW5dKCkpIHsKICAgICAgaWYgKCFmaWx0ZXIgfHwgaW5jbHVkZSA9PT0gZmlsdGVyLmhhcyhub2RlW19zeW1ib2xfdXRpbHMuJG5vZGVOYW1lXSkpIHsKICAgICAgICBjb25zdCBhdmFpbGFibGVTcGFjZSA9IHRoaXNbX3N5bWJvbF91dGlscy4kZ2V0QXZhaWxhYmxlU3BhY2VdKCk7CiAgICAgICAgY29uc3QgcmVzID0gbm9kZVtfc3ltYm9sX3V0aWxzLiR0b0hUTUxdKGF2YWlsYWJsZVNwYWNlKTsKICAgICAgICBpZiAoIXJlcy5zdWNjZXNzKSB7CiAgICAgICAgICB0aGlzW19zeW1ib2xfdXRpbHMuJGV4dHJhXS5mYWlsaW5nTm9kZSA9IG5vZGU7CiAgICAgICAgfQogICAgICAgIHlpZWxkIHJlczsKICAgICAgfQogICAgfQogIH0KICBbX3N5bWJvbF91dGlscy4kZmx1c2hIVE1MXSgpIHsKICAgIHJldHVybiBudWxsOwogIH0KICBbX3N5bWJvbF91dGlscy4kYWRkSFRNTF0oaHRtbCwgYmJveCkgewogICAgdGhpc1tfc3ltYm9sX3V0aWxzLiRleHRyYV0uY2hpbGRyZW4ucHVzaChodG1sKTsKICB9CiAgW19zeW1ib2xfdXRpbHMuJGdldEF2YWlsYWJsZVNwYWNlXSgpIHt9CiAgW19zeW1ib2xfdXRpbHMuJGNoaWxkcmVuVG9IVE1MXSh7CiAgICBmaWx0ZXIgPSBudWxsLAogICAgaW5jbHVkZSA9IHRydWUKICB9KSB7CiAgICBpZiAoIXRoaXNbX3N5bWJvbF91dGlscy4kZXh0cmFdLmdlbmVyYXRvcikgewogICAgICB0aGlzW19zeW1ib2xfdXRpbHMuJGV4dHJhXS5nZW5lcmF0b3IgPSB0aGlzW19maWx0ZXJlZENoaWxkcmVuR2VuZXJhdG9yXShmaWx0ZXIsIGluY2x1ZGUpOwogICAgfSBlbHNlIHsKICAgICAgY29uc3QgYXZhaWxhYmxlU3BhY2UgPSB0aGlzW19zeW1ib2xfdXRpbHMuJGdldEF2YWlsYWJsZVNwYWNlXSgpOwogICAgICBjb25zdCByZXMgPSB0aGlzW19zeW1ib2xfdXRpbHMuJGV4dHJhXS5mYWlsaW5nTm9kZVtfc3ltYm9sX3V0aWxzLiR0b0hUTUxdKGF2YWlsYWJsZVNwYWNlKTsKICAgICAgaWYgKCFyZXMuc3VjY2VzcykgewogICAgICAgIHJldHVybiByZXM7CiAgICAgIH0KICAgICAgaWYgKHJlcy5odG1sKSB7CiAgICAgICAgdGhpc1tfc3ltYm9sX3V0aWxzLiRhZGRIVE1MXShyZXMuaHRtbCwgcmVzLmJib3gpOwogICAgICB9CiAgICAgIGRlbGV0ZSB0aGlzW19zeW1ib2xfdXRpbHMuJGV4dHJhXS5mYWlsaW5nTm9kZTsKICAgIH0KICAgIHdoaWxlICh0cnVlKSB7CiAgICAgIGNvbnN0IGdlbiA9IHRoaXNbX3N5bWJvbF91dGlscy4kZXh0cmFdLmdlbmVyYXRvci5uZXh0KCk7CiAgICAgIGlmIChnZW4uZG9uZSkgewogICAgICAgIGJyZWFrOwogICAgICB9CiAgICAgIGNvbnN0IHJlcyA9IGdlbi52YWx1ZTsKICAgICAgaWYgKCFyZXMuc3VjY2VzcykgewogICAgICAgIHJldHVybiByZXM7CiAgICAgIH0KICAgICAgaWYgKHJlcy5odG1sKSB7CiAgICAgICAgdGhpc1tfc3ltYm9sX3V0aWxzLiRhZGRIVE1MXShyZXMuaHRtbCwgcmVzLmJib3gpOwogICAgICB9CiAgICB9CiAgICB0aGlzW19zeW1ib2xfdXRpbHMuJGV4dHJhXS5nZW5lcmF0b3IgPSBudWxsOwogICAgcmV0dXJuIF91dGlscy5IVE1MUmVzdWx0LkVNUFRZOwogIH0KICBbX3N5bWJvbF91dGlscy4kc2V0U2V0QXR0cmlidXRlc10oYXR0cmlidXRlcykgewogICAgdGhpc1tfc2V0QXR0cmlidXRlc10gPSBuZXcgU2V0KE9iamVjdC5rZXlzKGF0dHJpYnV0ZXMpKTsKICB9CiAgW19nZXRVbnNldEF0dHJpYnV0ZXNdKHByb3RvQXR0cmlidXRlcykgewogICAgY29uc3QgYWxsQXR0ciA9IHRoaXNbX2F0dHJpYnV0ZU5hbWVzXTsKICAgIGNvbnN0IHNldEF0dHIgPSB0aGlzW19zZXRBdHRyaWJ1dGVzXTsKICAgIHJldHVybiBbLi4ucHJvdG9BdHRyaWJ1dGVzXS5maWx0ZXIoeCA9PiBhbGxBdHRyLmhhcyh4KSAmJiAhc2V0QXR0ci5oYXMoeCkpOwogIH0KICBbX3N5bWJvbF91dGlscy4kcmVzb2x2ZVByb3RvdHlwZXNdKGlkcywgYW5jZXN0b3JzID0gbmV3IFNldCgpKSB7CiAgICBmb3IgKGNvbnN0IGNoaWxkIG9mIHRoaXNbX2NoaWxkcmVuXSkgewogICAgICBjaGlsZFtfcmVzb2x2ZVByb3RvdHlwZXNIZWxwZXJdKGlkcywgYW5jZXN0b3JzKTsKICAgIH0KICB9CiAgW19yZXNvbHZlUHJvdG90eXBlc0hlbHBlcl0oaWRzLCBhbmNlc3RvcnMpIHsKICAgIGNvbnN0IHByb3RvID0gdGhpc1tfZ2V0UHJvdG90eXBlXShpZHMsIGFuY2VzdG9ycyk7CiAgICBpZiAocHJvdG8pIHsKICAgICAgdGhpc1tfYXBwbHlQcm90b3R5cGVdKHByb3RvLCBpZHMsIGFuY2VzdG9ycyk7CiAgICB9IGVsc2UgewogICAgICB0aGlzW19zeW1ib2xfdXRpbHMuJHJlc29sdmVQcm90b3R5cGVzXShpZHMsIGFuY2VzdG9ycyk7CiAgICB9CiAgfQogIFtfZ2V0UHJvdG90eXBlXShpZHMsIGFuY2VzdG9ycykgewogICAgY29uc3QgewogICAgICB1c2UsCiAgICAgIHVzZWhyZWYKICAgIH0gPSB0aGlzOwogICAgaWYgKCF1c2UgJiYgIXVzZWhyZWYpIHsKICAgICAgcmV0dXJuIG51bGw7CiAgICB9CiAgICBsZXQgcHJvdG8gPSBudWxsOwogICAgbGV0IHNvbUV4cHJlc3Npb24gPSBudWxsOwogICAgbGV0IGlkID0gbnVsbDsKICAgIGxldCByZWYgPSB1c2U7CiAgICBpZiAodXNlaHJlZikgewogICAgICByZWYgPSB1c2VocmVmOwogICAgICBpZiAodXNlaHJlZi5zdGFydHNXaXRoKCIjc29tKCIpICYmIHVzZWhyZWYuZW5kc1dpdGgoIikiKSkgewogICAgICAgIHNvbUV4cHJlc3Npb24gPSB1c2VocmVmLnNsaWNlKCIjc29tKCIubGVuZ3RoLCAtMSk7CiAgICAgIH0gZWxzZSBpZiAodXNlaHJlZi5zdGFydHNXaXRoKCIuI3NvbSgiKSAmJiB1c2VocmVmLmVuZHNXaXRoKCIpIikpIHsKICAgICAgICBzb21FeHByZXNzaW9uID0gdXNlaHJlZi5zbGljZSgiLiNzb20oIi5sZW5ndGgsIC0xKTsKICAgICAgfSBlbHNlIGlmICh1c2VocmVmLnN0YXJ0c1dpdGgoIiMiKSkgewogICAgICAgIGlkID0gdXNlaHJlZi5zbGljZSgxKTsKICAgICAgfSBlbHNlIGlmICh1c2VocmVmLnN0YXJ0c1dpdGgoIi4jIikpIHsKICAgICAgICBpZCA9IHVzZWhyZWYuc2xpY2UoMik7CiAgICAgIH0KICAgIH0gZWxzZSBpZiAodXNlLnN0YXJ0c1dpdGgoIiMiKSkgewogICAgICBpZCA9IHVzZS5zbGljZSgxKTsKICAgIH0gZWxzZSB7CiAgICAgIHNvbUV4cHJlc3Npb24gPSB1c2U7CiAgICB9CiAgICB0aGlzLnVzZSA9IHRoaXMudXNlaHJlZiA9ICIiOwogICAgaWYgKGlkKSB7CiAgICAgIHByb3RvID0gaWRzLmdldChpZCk7CiAgICB9IGVsc2UgewogICAgICBwcm90byA9ICgwLCBfc29tLnNlYXJjaE5vZGUpKGlkcy5nZXQoX3N5bWJvbF91dGlscy4kcm9vdCksIHRoaXMsIHNvbUV4cHJlc3Npb24sIHRydWUsIGZhbHNlKTsKICAgICAgaWYgKHByb3RvKSB7CiAgICAgICAgcHJvdG8gPSBwcm90b1swXTsKICAgICAgfQogICAgfQogICAgaWYgKCFwcm90bykgewogICAgICAoMCwgX3V0aWwud2FybikoYFhGQSAtIEludmFsaWQgcHJvdG90eXBlIHJlZmVyZW5jZTogJHtyZWZ9LmApOwogICAgICByZXR1cm4gbnVsbDsKICAgIH0KICAgIGlmIChwcm90b1tfc3ltYm9sX3V0aWxzLiRub2RlTmFtZV0gIT09IHRoaXNbX3N5bWJvbF91dGlscy4kbm9kZU5hbWVdKSB7CiAgICAgICgwLCBfdXRpbC53YXJuKShgWEZBIC0gSW5jb21wYXRpYmxlIHByb3RvdHlwZTogJHtwcm90b1tfc3ltYm9sX3V0aWxzLiRub2RlTmFtZV19ICE9PSAke3RoaXNbX3N5bWJvbF91dGlscy4kbm9kZU5hbWVdfS5gKTsKICAgICAgcmV0dXJuIG51bGw7CiAgICB9CiAgICBpZiAoYW5jZXN0b3JzLmhhcyhwcm90bykpIHsKICAgICAgKDAsIF91dGlsLndhcm4pKGBYRkEgLSBDeWNsZSBkZXRlY3RlZCBpbiBwcm90b3R5cGVzIHVzZS5gKTsKICAgICAgcmV0dXJuIG51bGw7CiAgICB9CiAgICBhbmNlc3RvcnMuYWRkKHByb3RvKTsKICAgIGNvbnN0IHByb3RvUHJvdG8gPSBwcm90b1tfZ2V0UHJvdG90eXBlXShpZHMsIGFuY2VzdG9ycyk7CiAgICBpZiAocHJvdG9Qcm90bykgewogICAgICBwcm90b1tfYXBwbHlQcm90b3R5cGVdKHByb3RvUHJvdG8sIGlkcywgYW5jZXN0b3JzKTsKICAgIH0KICAgIHByb3RvW19zeW1ib2xfdXRpbHMuJHJlc29sdmVQcm90b3R5cGVzXShpZHMsIGFuY2VzdG9ycyk7CiAgICBhbmNlc3RvcnMuZGVsZXRlKHByb3RvKTsKICAgIHJldHVybiBwcm90bzsKICB9CiAgW19hcHBseVByb3RvdHlwZV0ocHJvdG8sIGlkcywgYW5jZXN0b3JzKSB7CiAgICBpZiAoYW5jZXN0b3JzLmhhcyhwcm90bykpIHsKICAgICAgKDAsIF91dGlsLndhcm4pKGBYRkEgLSBDeWNsZSBkZXRlY3RlZCBpbiBwcm90b3R5cGVzIHVzZS5gKTsKICAgICAgcmV0dXJuOwogICAgfQogICAgaWYgKCF0aGlzW19zeW1ib2xfdXRpbHMuJGNvbnRlbnRdICYmIHByb3RvW19zeW1ib2xfdXRpbHMuJGNvbnRlbnRdKSB7CiAgICAgIHRoaXNbX3N5bWJvbF91dGlscy4kY29udGVudF0gPSBwcm90b1tfc3ltYm9sX3V0aWxzLiRjb250ZW50XTsKICAgIH0KICAgIGNvbnN0IG5ld0FuY2VzdG9ycyA9IG5ldyBTZXQoYW5jZXN0b3JzKTsKICAgIG5ld0FuY2VzdG9ycy5hZGQocHJvdG8pOwogICAgZm9yIChjb25zdCB1bnNldEF0dHJOYW1lIG9mIHRoaXNbX2dldFVuc2V0QXR0cmlidXRlc10ocHJvdG9bX3NldEF0dHJpYnV0ZXNdKSkgewogICAgICB0aGlzW3Vuc2V0QXR0ck5hbWVdID0gcHJvdG9bdW5zZXRBdHRyTmFtZV07CiAgICAgIGlmICh0aGlzW19zZXRBdHRyaWJ1dGVzXSkgewogICAgICAgIHRoaXNbX3NldEF0dHJpYnV0ZXNdLmFkZCh1bnNldEF0dHJOYW1lKTsKICAgICAgfQogICAgfQogICAgZm9yIChjb25zdCBuYW1lIG9mIE9iamVjdC5nZXRPd25Qcm9wZXJ0eU5hbWVzKHRoaXMpKSB7CiAgICAgIGlmICh0aGlzW19hdHRyaWJ1dGVOYW1lc10uaGFzKG5hbWUpKSB7CiAgICAgICAgY29udGludWU7CiAgICAgIH0KICAgICAgY29uc3QgdmFsdWUgPSB0aGlzW25hbWVdOwogICAgICBjb25zdCBwcm90b1ZhbHVlID0gcHJvdG9bbmFtZV07CiAgICAgIGlmICh2YWx1ZSBpbnN0YW5jZW9mIFhGQU9iamVjdEFycmF5KSB7CiAgICAgICAgZm9yIChjb25zdCBjaGlsZCBvZiB2YWx1ZVtfY2hpbGRyZW5dKSB7CiAgICAgICAgICBjaGlsZFtfcmVzb2x2ZVByb3RvdHlwZXNIZWxwZXJdKGlkcywgYW5jZXN0b3JzKTsKICAgICAgICB9CiAgICAgICAgZm9yIChsZXQgaSA9IHZhbHVlW19jaGlsZHJlbl0ubGVuZ3RoLCBpaSA9IHByb3RvVmFsdWVbX2NoaWxkcmVuXS5sZW5ndGg7IGkgPCBpaTsgaSsrKSB7CiAgICAgICAgICBjb25zdCBjaGlsZCA9IHByb3RvW19jaGlsZHJlbl1baV1bX3N5bWJvbF91dGlscy4kY2xvbmVdKCk7CiAgICAgICAgICBpZiAodmFsdWUucHVzaChjaGlsZCkpIHsKICAgICAgICAgICAgY2hpbGRbX3BhcmVudF0gPSB0aGlzOwogICAgICAgICAgICB0aGlzW19jaGlsZHJlbl0ucHVzaChjaGlsZCk7CiAgICAgICAgICAgIGNoaWxkW19yZXNvbHZlUHJvdG90eXBlc0hlbHBlcl0oaWRzLCBhbmNlc3RvcnMpOwogICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIGNvbnRpbnVlOwogICAgICB9CiAgICAgIGlmICh2YWx1ZSAhPT0gbnVsbCkgewogICAgICAgIHZhbHVlW19zeW1ib2xfdXRpbHMuJHJlc29sdmVQcm90b3R5cGVzXShpZHMsIGFuY2VzdG9ycyk7CiAgICAgICAgaWYgKHByb3RvVmFsdWUpIHsKICAgICAgICAgIHZhbHVlW19hcHBseVByb3RvdHlwZV0ocHJvdG9WYWx1ZSwgaWRzLCBhbmNlc3RvcnMpOwogICAgICAgIH0KICAgICAgICBjb250aW51ZTsKICAgICAgfQogICAgICBpZiAocHJvdG9WYWx1ZSAhPT0gbnVsbCkgewogICAgICAgIGNvbnN0IGNoaWxkID0gcHJvdG9WYWx1ZVtfc3ltYm9sX3V0aWxzLiRjbG9uZV0oKTsKICAgICAgICBjaGlsZFtfcGFyZW50XSA9IHRoaXM7CiAgICAgICAgdGhpc1tuYW1lXSA9IGNoaWxkOwogICAgICAgIHRoaXNbX2NoaWxkcmVuXS5wdXNoKGNoaWxkKTsKICAgICAgICBjaGlsZFtfcmVzb2x2ZVByb3RvdHlwZXNIZWxwZXJdKGlkcywgYW5jZXN0b3JzKTsKICAgICAgfQogICAgfQogIH0KICBzdGF0aWMgW19jbG9uZUF0dHJpYnV0ZV0ob2JqKSB7CiAgICBpZiAoQXJyYXkuaXNBcnJheShvYmopKSB7CiAgICAgIHJldHVybiBvYmoubWFwKHggPT4gWEZBT2JqZWN0W19jbG9uZUF0dHJpYnV0ZV0oeCkpOwogICAgfQogICAgaWYgKHR5cGVvZiBvYmogPT09ICJvYmplY3QiICYmIG9iaiAhPT0gbnVsbCkgewogICAgICByZXR1cm4gT2JqZWN0LmFzc2lnbih7fSwgb2JqKTsKICAgIH0KICAgIHJldHVybiBvYmo7CiAgfQogIFtfc3ltYm9sX3V0aWxzLiRjbG9uZV0oKSB7CiAgICBjb25zdCBjbG9uZSA9IE9iamVjdC5jcmVhdGUoT2JqZWN0LmdldFByb3RvdHlwZU9mKHRoaXMpKTsKICAgIGZvciAoY29uc3QgJHN5bWJvbCBvZiBPYmplY3QuZ2V0T3duUHJvcGVydHlTeW1ib2xzKHRoaXMpKSB7CiAgICAgIHRyeSB7CiAgICAgICAgY2xvbmVbJHN5bWJvbF0gPSB0aGlzWyRzeW1ib2xdOwogICAgICB9IGNhdGNoIHsKICAgICAgICAoMCwgX3V0aWwuc2hhZG93KShjbG9uZSwgJHN5bWJvbCwgdGhpc1skc3ltYm9sXSk7CiAgICAgIH0KICAgIH0KICAgIGNsb25lW19zeW1ib2xfdXRpbHMuJHVpZF0gPSBgJHtjbG9uZVtfc3ltYm9sX3V0aWxzLiRub2RlTmFtZV19JHt1aWQrK31gOwogICAgY2xvbmVbX2NoaWxkcmVuXSA9IFtdOwogICAgZm9yIChjb25zdCBuYW1lIG9mIE9iamVjdC5nZXRPd25Qcm9wZXJ0eU5hbWVzKHRoaXMpKSB7CiAgICAgIGlmICh0aGlzW19hdHRyaWJ1dGVOYW1lc10uaGFzKG5hbWUpKSB7CiAgICAgICAgY2xvbmVbbmFtZV0gPSBYRkFPYmplY3RbX2Nsb25lQXR0cmlidXRlXSh0aGlzW25hbWVdKTsKICAgICAgICBjb250aW51ZTsKICAgICAgfQogICAgICBjb25zdCB2YWx1ZSA9IHRoaXNbbmFtZV07CiAgICAgIGNsb25lW25hbWVdID0gdmFsdWUgaW5zdGFuY2VvZiBYRkFPYmplY3RBcnJheSA/IG5ldyBYRkFPYmplY3RBcnJheSh2YWx1ZVtfbWF4XSkgOiBudWxsOwogICAgfQogICAgZm9yIChjb25zdCBjaGlsZCBvZiB0aGlzW19jaGlsZHJlbl0pIHsKICAgICAgY29uc3QgbmFtZSA9IGNoaWxkW19zeW1ib2xfdXRpbHMuJG5vZGVOYW1lXTsKICAgICAgY29uc3QgY2xvbmVkQ2hpbGQgPSBjaGlsZFtfc3ltYm9sX3V0aWxzLiRjbG9uZV0oKTsKICAgICAgY2xvbmVbX2NoaWxkcmVuXS5wdXNoKGNsb25lZENoaWxkKTsKICAgICAgY2xvbmVkQ2hpbGRbX3BhcmVudF0gPSBjbG9uZTsKICAgICAgaWYgKGNsb25lW25hbWVdID09PSBudWxsKSB7CiAgICAgICAgY2xvbmVbbmFtZV0gPSBjbG9uZWRDaGlsZDsKICAgICAgfSBlbHNlIHsKICAgICAgICBjbG9uZVtuYW1lXVtfY2hpbGRyZW5dLnB1c2goY2xvbmVkQ2hpbGQpOwogICAgICB9CiAgICB9CiAgICByZXR1cm4gY2xvbmU7CiAgfQogIFtfc3ltYm9sX3V0aWxzLiRnZXRDaGlsZHJlbl0obmFtZSA9IG51bGwpIHsKICAgIGlmICghbmFtZSkgewogICAgICByZXR1cm4gdGhpc1tfY2hpbGRyZW5dOwogICAgfQogICAgcmV0dXJuIHRoaXNbX2NoaWxkcmVuXS5maWx0ZXIoYyA9PiBjW19zeW1ib2xfdXRpbHMuJG5vZGVOYW1lXSA9PT0gbmFtZSk7CiAgfQogIFtfc3ltYm9sX3V0aWxzLiRnZXRDaGlsZHJlbkJ5Q2xhc3NdKG5hbWUpIHsKICAgIHJldHVybiB0aGlzW25hbWVdOwogIH0KICBbX3N5bWJvbF91dGlscy4kZ2V0Q2hpbGRyZW5CeU5hbWVdKG5hbWUsIGFsbFRyYW5zcGFyZW50LCBmaXJzdCA9IHRydWUpIHsKICAgIHJldHVybiBBcnJheS5mcm9tKHRoaXNbX3N5bWJvbF91dGlscy4kZ2V0Q2hpbGRyZW5CeU5hbWVJdF0obmFtZSwgYWxsVHJhbnNwYXJlbnQsIGZpcnN0KSk7CiAgfQogICpbX3N5bWJvbF91dGlscy4kZ2V0Q2hpbGRyZW5CeU5hbWVJdF0obmFtZSwgYWxsVHJhbnNwYXJlbnQsIGZpcnN0ID0gdHJ1ZSkgewogICAgaWYgKG5hbWUgPT09ICJwYXJlbnQiKSB7CiAgICAgIHlpZWxkIHRoaXNbX3BhcmVudF07CiAgICAgIHJldHVybjsKICAgIH0KICAgIGZvciAoY29uc3QgY2hpbGQgb2YgdGhpc1tfY2hpbGRyZW5dKSB7CiAgICAgIGlmIChjaGlsZFtfc3ltYm9sX3V0aWxzLiRub2RlTmFtZV0gPT09IG5hbWUpIHsKICAgICAgICB5aWVsZCBjaGlsZDsKICAgICAgfQogICAgICBpZiAoY2hpbGQubmFtZSA9PT0gbmFtZSkgewogICAgICAgIHlpZWxkIGNoaWxkOwogICAgICB9CiAgICAgIGlmIChhbGxUcmFuc3BhcmVudCB8fCBjaGlsZFtfc3ltYm9sX3V0aWxzLiRpc1RyYW5zcGFyZW50XSgpKSB7CiAgICAgICAgeWllbGQqIGNoaWxkW19zeW1ib2xfdXRpbHMuJGdldENoaWxkcmVuQnlOYW1lSXRdKG5hbWUsIGFsbFRyYW5zcGFyZW50LCBmYWxzZSk7CiAgICAgIH0KICAgIH0KICAgIGlmIChmaXJzdCAmJiB0aGlzW19hdHRyaWJ1dGVOYW1lc10uaGFzKG5hbWUpKSB7CiAgICAgIHlpZWxkIG5ldyBYRkFBdHRyaWJ1dGUodGhpcywgbmFtZSwgdGhpc1tuYW1lXSk7CiAgICB9CiAgfQp9CmV4cG9ydHMuWEZBT2JqZWN0ID0gWEZBT2JqZWN0OwpjbGFzcyBYRkFPYmplY3RBcnJheSB7CiAgY29uc3RydWN0b3IobWF4ID0gSW5maW5pdHkpIHsKICAgIHRoaXNbX21heF0gPSBtYXg7CiAgICB0aGlzW19jaGlsZHJlbl0gPSBbXTsKICB9CiAgZ2V0IGlzWEZBT2JqZWN0KCkgewogICAgcmV0dXJuIGZhbHNlOwogIH0KICBnZXQgaXNYRkFPYmplY3RBcnJheSgpIHsKICAgIHJldHVybiB0cnVlOwogIH0KICBwdXNoKGNoaWxkKSB7CiAgICBjb25zdCBsZW4gPSB0aGlzW19jaGlsZHJlbl0ubGVuZ3RoOwogICAgaWYgKGxlbiA8PSB0aGlzW19tYXhdKSB7CiAgICAgIHRoaXNbX2NoaWxkcmVuXS5wdXNoKGNoaWxkKTsKICAgICAgcmV0dXJuIHRydWU7CiAgICB9CiAgICAoMCwgX3V0aWwud2FybikoYFhGQSAtIG5vZGUgIiR7Y2hpbGRbX3N5bWJvbF91dGlscy4kbm9kZU5hbWVdfSIgYWNjZXB0cyBubyBtb3JlIHRoYW4gJHt0aGlzW19tYXhdfSBjaGlsZHJlbmApOwogICAgcmV0dXJuIGZhbHNlOwogIH0KICBpc0VtcHR5KCkgewogICAgcmV0dXJuIHRoaXNbX2NoaWxkcmVuXS5sZW5ndGggPT09IDA7CiAgfQogIGR1bXAoKSB7CiAgICByZXR1cm4gdGhpc1tfY2hpbGRyZW5dLmxlbmd0aCA9PT0gMSA/IHRoaXNbX2NoaWxkcmVuXVswXVtfc3ltYm9sX3V0aWxzLiRkdW1wXSgpIDogdGhpc1tfY2hpbGRyZW5dLm1hcCh4ID0+IHhbX3N5bWJvbF91dGlscy4kZHVtcF0oKSk7CiAgfQogIFtfc3ltYm9sX3V0aWxzLiRjbG9uZV0oKSB7CiAgICBjb25zdCBjbG9uZSA9IG5ldyBYRkFPYmplY3RBcnJheSh0aGlzW19tYXhdKTsKICAgIGNsb25lW19jaGlsZHJlbl0gPSB0aGlzW19jaGlsZHJlbl0ubWFwKGMgPT4gY1tfc3ltYm9sX3V0aWxzLiRjbG9uZV0oKSk7CiAgICByZXR1cm4gY2xvbmU7CiAgfQogIGdldCBjaGlsZHJlbigpIHsKICAgIHJldHVybiB0aGlzW19jaGlsZHJlbl07CiAgfQogIGNsZWFyKCkgewogICAgdGhpc1tfY2hpbGRyZW5dLmxlbmd0aCA9IDA7CiAgfQp9CmV4cG9ydHMuWEZBT2JqZWN0QXJyYXkgPSBYRkFPYmplY3RBcnJheTsKY2xhc3MgWEZBQXR0cmlidXRlIHsKICBjb25zdHJ1Y3Rvcihub2RlLCBuYW1lLCB2YWx1ZSkgewogICAgdGhpc1tfcGFyZW50XSA9IG5vZGU7CiAgICB0aGlzW19zeW1ib2xfdXRpbHMuJG5vZGVOYW1lXSA9IG5hbWU7CiAgICB0aGlzW19zeW1ib2xfdXRpbHMuJGNvbnRlbnRdID0gdmFsdWU7CiAgICB0aGlzW19zeW1ib2xfdXRpbHMuJGNvbnN1bWVkXSA9IGZhbHNlOwogICAgdGhpc1tfc3ltYm9sX3V0aWxzLiR1aWRdID0gYGF0dHJpYnV0ZSR7dWlkKyt9YDsKICB9CiAgW19zeW1ib2xfdXRpbHMuJGdldFBhcmVudF0oKSB7CiAgICByZXR1cm4gdGhpc1tfcGFyZW50XTsKICB9CiAgW19zeW1ib2xfdXRpbHMuJGlzRGF0YVZhbHVlXSgpIHsKICAgIHJldHVybiB0cnVlOwogIH0KICBbX3N5bWJvbF91dGlscy4kZ2V0RGF0YVZhbHVlXSgpIHsKICAgIHJldHVybiB0aGlzW19zeW1ib2xfdXRpbHMuJGNvbnRlbnRdLnRyaW0oKTsKICB9CiAgW19zeW1ib2xfdXRpbHMuJHNldFZhbHVlXSh2YWx1ZSkgewogICAgdmFsdWUgPSB2YWx1ZS52YWx1ZSB8fCAiIjsKICAgIHRoaXNbX3N5bWJvbF91dGlscy4kY29udGVudF0gPSB2YWx1ZS50b1N0cmluZygpOwogIH0KICBbX3N5bWJvbF91dGlscy4kdGV4dF0oKSB7CiAgICByZXR1cm4gdGhpc1tfc3ltYm9sX3V0aWxzLiRjb250ZW50XTsKICB9CiAgW19zeW1ib2xfdXRpbHMuJGlzRGVzY2VuZGVudF0ocGFyZW50KSB7CiAgICByZXR1cm4gdGhpc1tfcGFyZW50XSA9PT0gcGFyZW50IHx8IHRoaXNbX3BhcmVudF1bX3N5bWJvbF91dGlscy4kaXNEZXNjZW5kZW50XShwYXJlbnQpOwogIH0KfQpleHBvcnRzLlhGQUF0dHJpYnV0ZSA9IFhGQUF0dHJpYnV0ZTsKY2xhc3MgWG1sT2JqZWN0IGV4dGVuZHMgWEZBT2JqZWN0IHsKICBjb25zdHJ1Y3Rvcihuc0lkLCBuYW1lLCBhdHRyaWJ1dGVzID0ge30pIHsKICAgIHN1cGVyKG5zSWQsIG5hbWUpOwogICAgdGhpc1tfc3ltYm9sX3V0aWxzLiRjb250ZW50XSA9ICIiOwogICAgdGhpc1tfZGF0YVZhbHVlXSA9IG51bGw7CiAgICBpZiAobmFtZSAhPT0gIiN0ZXh0IikgewogICAgICBjb25zdCBtYXAgPSBuZXcgTWFwKCk7CiAgICAgIHRoaXNbX2F0dHJpYnV0ZXNdID0gbWFwOwogICAgICBmb3IgKGNvbnN0IFthdHRyTmFtZSwgdmFsdWVdIG9mIE9iamVjdC5lbnRyaWVzKGF0dHJpYnV0ZXMpKSB7CiAgICAgICAgbWFwLnNldChhdHRyTmFtZSwgbmV3IFhGQUF0dHJpYnV0ZSh0aGlzLCBhdHRyTmFtZSwgdmFsdWUpKTsKICAgICAgfQogICAgICBpZiAoYXR0cmlidXRlcy5oYXNPd25Qcm9wZXJ0eShfc3ltYm9sX3V0aWxzLiRuc0F0dHJpYnV0ZXMpKSB7CiAgICAgICAgY29uc3QgZGF0YU5vZGUgPSBhdHRyaWJ1dGVzW19zeW1ib2xfdXRpbHMuJG5zQXR0cmlidXRlc10ueGZhLmRhdGFOb2RlOwogICAgICAgIGlmIChkYXRhTm9kZSAhPT0gdW5kZWZpbmVkKSB7CiAgICAgICAgICBpZiAoZGF0YU5vZGUgPT09ICJkYXRhR3JvdXAiKSB7CiAgICAgICAgICAgIHRoaXNbX2RhdGFWYWx1ZV0gPSBmYWxzZTsKICAgICAgICAgIH0gZWxzZSBpZiAoZGF0YU5vZGUgPT09ICJkYXRhVmFsdWUiKSB7CiAgICAgICAgICAgIHRoaXNbX2RhdGFWYWx1ZV0gPSB0cnVlOwogICAgICAgICAgfQogICAgICAgIH0KICAgICAgfQogICAgfQogICAgdGhpc1tfc3ltYm9sX3V0aWxzLiRjb25zdW1lZF0gPSBmYWxzZTsKICB9CiAgW19zeW1ib2xfdXRpbHMuJHRvU3RyaW5nXShidWYpIHsKICAgIGNvbnN0IHRhZ05hbWUgPSB0aGlzW19zeW1ib2xfdXRpbHMuJG5vZGVOYW1lXTsKICAgIGlmICh0YWdOYW1lID09PSAiI3RleHQiKSB7CiAgICAgIGJ1Zi5wdXNoKCgwLCBfY29yZV91dGlscy5lbmNvZGVUb1htbFN0cmluZykodGhpc1tfc3ltYm9sX3V0aWxzLiRjb250ZW50XSkpOwogICAgICByZXR1cm47CiAgICB9CiAgICBjb25zdCB1dGY4VGFnTmFtZSA9ICgwLCBfdXRpbC51dGY4U3RyaW5nVG9TdHJpbmcpKHRhZ05hbWUpOwogICAgY29uc3QgcHJlZml4ID0gdGhpc1tfc3ltYm9sX3V0aWxzLiRuYW1lc3BhY2VJZF0gPT09IE5TX0RBVEFTRVRTID8gInhmYToiIDogIiI7CiAgICBidWYucHVzaChgPCR7cHJlZml4fSR7dXRmOFRhZ05hbWV9YCk7CiAgICBmb3IgKGNvbnN0IFtuYW1lLCB2YWx1ZV0gb2YgdGhpc1tfYXR0cmlidXRlc10uZW50cmllcygpKSB7CiAgICAgIGNvbnN0IHV0ZjhOYW1lID0gKDAsIF91dGlsLnV0ZjhTdHJpbmdUb1N0cmluZykobmFtZSk7CiAgICAgIGJ1Zi5wdXNoKGAgJHt1dGY4TmFtZX09IiR7KDAsIF9jb3JlX3V0aWxzLmVuY29kZVRvWG1sU3RyaW5nKSh2YWx1ZVtfc3ltYm9sX3V0aWxzLiRjb250ZW50XSl9ImApOwogICAgfQogICAgaWYgKHRoaXNbX2RhdGFWYWx1ZV0gIT09IG51bGwpIHsKICAgICAgaWYgKHRoaXNbX2RhdGFWYWx1ZV0pIHsKICAgICAgICBidWYucHVzaChgIHhmYTpkYXRhTm9kZT0iZGF0YVZhbHVlImApOwogICAgICB9IGVsc2UgewogICAgICAgIGJ1Zi5wdXNoKGAgeGZhOmRhdGFOb2RlPSJkYXRhR3JvdXAiYCk7CiAgICAgIH0KICAgIH0KICAgIGlmICghdGhpc1tfc3ltYm9sX3V0aWxzLiRjb250ZW50XSAmJiB0aGlzW19jaGlsZHJlbl0ubGVuZ3RoID09PSAwKSB7CiAgICAgIGJ1Zi5wdXNoKCIvPiIpOwogICAgICByZXR1cm47CiAgICB9CiAgICBidWYucHVzaCgiPiIpOwogICAgaWYgKHRoaXNbX3N5bWJvbF91dGlscy4kY29udGVudF0pIHsKICAgICAgaWYgKHR5cGVvZiB0aGlzW19zeW1ib2xfdXRpbHMuJGNvbnRlbnRdID09PSAic3RyaW5nIikgewogICAgICAgIGJ1Zi5wdXNoKCgwLCBfY29yZV91dGlscy5lbmNvZGVUb1htbFN0cmluZykodGhpc1tfc3ltYm9sX3V0aWxzLiRjb250ZW50XSkpOwogICAgICB9IGVsc2UgewogICAgICAgIHRoaXNbX3N5bWJvbF91dGlscy4kY29udGVudF1bX3N5bWJvbF91dGlscy4kdG9TdHJpbmddKGJ1Zik7CiAgICAgIH0KICAgIH0gZWxzZSB7CiAgICAgIGZvciAoY29uc3QgY2hpbGQgb2YgdGhpc1tfY2hpbGRyZW5dKSB7CiAgICAgICAgY2hpbGRbX3N5bWJvbF91dGlscy4kdG9TdHJpbmddKGJ1Zik7CiAgICAgIH0KICAgIH0KICAgIGJ1Zi5wdXNoKGA8LyR7cHJlZml4fSR7dXRmOFRhZ05hbWV9PmApOwogIH0KICBbX3N5bWJvbF91dGlscy4kb25DaGlsZF0oY2hpbGQpIHsKICAgIGlmICh0aGlzW19zeW1ib2xfdXRpbHMuJGNvbnRlbnRdKSB7CiAgICAgIGNvbnN0IG5vZGUgPSBuZXcgWG1sT2JqZWN0KHRoaXNbX3N5bWJvbF91dGlscy4kbmFtZXNwYWNlSWRdLCAiI3RleHQiKTsKICAgICAgdGhpc1tfc3ltYm9sX3V0aWxzLiRhcHBlbmRDaGlsZF0obm9kZSk7CiAgICAgIG5vZGVbX3N5bWJvbF91dGlscy4kY29udGVudF0gPSB0aGlzW19zeW1ib2xfdXRpbHMuJGNvbnRlbnRdOwogICAgICB0aGlzW19zeW1ib2xfdXRpbHMuJGNvbnRlbnRdID0gIiI7CiAgICB9CiAgICB0aGlzW19zeW1ib2xfdXRpbHMuJGFwcGVuZENoaWxkXShjaGlsZCk7CiAgICByZXR1cm4gdHJ1ZTsKICB9CiAgW19zeW1ib2xfdXRpbHMuJG9uVGV4dF0oc3RyKSB7CiAgICB0aGlzW19zeW1ib2xfdXRpbHMuJGNvbnRlbnRdICs9IHN0cjsKICB9CiAgW19zeW1ib2xfdXRpbHMuJGZpbmFsaXplXSgpIHsKICAgIGlmICh0aGlzW19zeW1ib2xfdXRpbHMuJGNvbnRlbnRdICYmIHRoaXNbX2NoaWxkcmVuXS5sZW5ndGggPiAwKSB7CiAgICAgIGNvbnN0IG5vZGUgPSBuZXcgWG1sT2JqZWN0KHRoaXNbX3N5bWJvbF91dGlscy4kbmFtZXNwYWNlSWRdLCAiI3RleHQiKTsKICAgICAgdGhpc1tfc3ltYm9sX3V0aWxzLiRhcHBlbmRDaGlsZF0obm9kZSk7CiAgICAgIG5vZGVbX3N5bWJvbF91dGlscy4kY29udGVudF0gPSB0aGlzW19zeW1ib2xfdXRpbHMuJGNvbnRlbnRdOwogICAgICBkZWxldGUgdGhpc1tfc3ltYm9sX3V0aWxzLiRjb250ZW50XTsKICAgIH0KICB9CiAgW19zeW1ib2xfdXRpbHMuJHRvSFRNTF0oKSB7CiAgICBpZiAodGhpc1tfc3ltYm9sX3V0aWxzLiRub2RlTmFtZV0gPT09ICIjdGV4dCIpIHsKICAgICAgcmV0dXJuIF91dGlscy5IVE1MUmVzdWx0LnN1Y2Nlc3MoewogICAgICAgIG5hbWU6ICIjdGV4dCIsCiAgICAgICAgdmFsdWU6IHRoaXNbX3N5bWJvbF91dGlscy4kY29udGVudF0KICAgICAgfSk7CiAgICB9CiAgICByZXR1cm4gX3V0aWxzLkhUTUxSZXN1bHQuRU1QVFk7CiAgfQogIFtfc3ltYm9sX3V0aWxzLiRnZXRDaGlsZHJlbl0obmFtZSA9IG51bGwpIHsKICAgIGlmICghbmFtZSkgewogICAgICByZXR1cm4gdGhpc1tfY2hpbGRyZW5dOwogICAgfQogICAgcmV0dXJuIHRoaXNbX2NoaWxkcmVuXS5maWx0ZXIoYyA9PiBjW19zeW1ib2xfdXRpbHMuJG5vZGVOYW1lXSA9PT0gbmFtZSk7CiAgfQogIFtfc3ltYm9sX3V0aWxzLiRnZXRBdHRyaWJ1dGVzXSgpIHsKICAgIHJldHVybiB0aGlzW19hdHRyaWJ1dGVzXTsKICB9CiAgW19zeW1ib2xfdXRpbHMuJGdldENoaWxkcmVuQnlDbGFzc10obmFtZSkgewogICAgY29uc3QgdmFsdWUgPSB0aGlzW19hdHRyaWJ1dGVzXS5nZXQobmFtZSk7CiAgICBpZiAodmFsdWUgIT09IHVuZGVmaW5lZCkgewogICAgICByZXR1cm4gdmFsdWU7CiAgICB9CiAgICByZXR1cm4gdGhpc1tfc3ltYm9sX3V0aWxzLiRnZXRDaGlsZHJlbl0obmFtZSk7CiAgfQogICpbX3N5bWJvbF91dGlscy4kZ2V0Q2hpbGRyZW5CeU5hbWVJdF0obmFtZSwgYWxsVHJhbnNwYXJlbnQpIHsKICAgIGNvbnN0IHZhbHVlID0gdGhpc1tfYXR0cmlidXRlc10uZ2V0KG5hbWUpOwogICAgaWYgKHZhbHVlKSB7CiAgICAgIHlpZWxkIHZhbHVlOwogICAgfQogICAgZm9yIChjb25zdCBjaGlsZCBvZiB0aGlzW19jaGlsZHJlbl0pIHsKICAgICAgaWYgKGNoaWxkW19zeW1ib2xfdXRpbHMuJG5vZGVOYW1lXSA9PT0gbmFtZSkgewogICAgICAgIHlpZWxkIGNoaWxkOwogICAgICB9CiAgICAgIGlmIChhbGxUcmFuc3BhcmVudCkgewogICAgICAgIHlpZWxkKiBjaGlsZFtfc3ltYm9sX3V0aWxzLiRnZXRDaGlsZHJlbkJ5TmFtZUl0XShuYW1lLCBhbGxUcmFuc3BhcmVudCk7CiAgICAgIH0KICAgIH0KICB9CiAgKltfc3ltYm9sX3V0aWxzLiRnZXRBdHRyaWJ1dGVJdF0obmFtZSwgc2tpcENvbnN1bWVkKSB7CiAgICBjb25zdCB2YWx1ZSA9IHRoaXNbX2F0dHJpYnV0ZXNdLmdldChuYW1lKTsKICAgIGlmICh2YWx1ZSAmJiAoIXNraXBDb25zdW1lZCB8fCAhdmFsdWVbX3N5bWJvbF91dGlscy4kY29uc3VtZWRdKSkgewogICAgICB5aWVsZCB2YWx1ZTsKICAgIH0KICAgIGZvciAoY29uc3QgY2hpbGQgb2YgdGhpc1tfY2hpbGRyZW5dKSB7CiAgICAgIHlpZWxkKiBjaGlsZFtfc3ltYm9sX3V0aWxzLiRnZXRBdHRyaWJ1dGVJdF0obmFtZSwgc2tpcENvbnN1bWVkKTsKICAgIH0KICB9CiAgKltfc3ltYm9sX3V0aWxzLiRnZXRSZWFsQ2hpbGRyZW5CeU5hbWVJdF0obmFtZSwgYWxsVHJhbnNwYXJlbnQsIHNraXBDb25zdW1lZCkgewogICAgZm9yIChjb25zdCBjaGlsZCBvZiB0aGlzW19jaGlsZHJlbl0pIHsKICAgICAgaWYgKGNoaWxkW19zeW1ib2xfdXRpbHMuJG5vZGVOYW1lXSA9PT0gbmFtZSAmJiAoIXNraXBDb25zdW1lZCB8fCAhY2hpbGRbX3N5bWJvbF91dGlscy4kY29uc3VtZWRdKSkgewogICAgICAgIHlpZWxkIGNoaWxkOwogICAgICB9CiAgICAgIGlmIChhbGxUcmFuc3BhcmVudCkgewogICAgICAgIHlpZWxkKiBjaGlsZFtfc3ltYm9sX3V0aWxzLiRnZXRSZWFsQ2hpbGRyZW5CeU5hbWVJdF0obmFtZSwgYWxsVHJhbnNwYXJlbnQsIHNraXBDb25zdW1lZCk7CiAgICAgIH0KICAgIH0KICB9CiAgW19zeW1ib2xfdXRpbHMuJGlzRGF0YVZhbHVlXSgpIHsKICAgIGlmICh0aGlzW19kYXRhVmFsdWVdID09PSBudWxsKSB7CiAgICAgIHJldHVybiB0aGlzW19jaGlsZHJlbl0ubGVuZ3RoID09PSAwIHx8IHRoaXNbX2NoaWxkcmVuXVswXVtfc3ltYm9sX3V0aWxzLiRuYW1lc3BhY2VJZF0gPT09IF9uYW1lc3BhY2VzLk5hbWVzcGFjZUlkcy54aHRtbC5pZDsKICAgIH0KICAgIHJldHVybiB0aGlzW19kYXRhVmFsdWVdOwogIH0KICBbX3N5bWJvbF91dGlscy4kZ2V0RGF0YVZhbHVlXSgpIHsKICAgIGlmICh0aGlzW19kYXRhVmFsdWVdID09PSBudWxsKSB7CiAgICAgIGlmICh0aGlzW19jaGlsZHJlbl0ubGVuZ3RoID09PSAwKSB7CiAgICAgICAgcmV0dXJuIHRoaXNbX3N5bWJvbF91dGlscy4kY29udGVudF0udHJpbSgpOwogICAgICB9CiAgICAgIGlmICh0aGlzW19jaGlsZHJlbl1bMF1bX3N5bWJvbF91dGlscy4kbmFtZXNwYWNlSWRdID09PSBfbmFtZXNwYWNlcy5OYW1lc3BhY2VJZHMueGh0bWwuaWQpIHsKICAgICAgICByZXR1cm4gdGhpc1tfY2hpbGRyZW5dWzBdW19zeW1ib2xfdXRpbHMuJHRleHRdKCkudHJpbSgpOwogICAgICB9CiAgICAgIHJldHVybiBudWxsOwogICAgfQogICAgcmV0dXJuIHRoaXNbX3N5bWJvbF91dGlscy4kY29udGVudF0udHJpbSgpOwogIH0KICBbX3N5bWJvbF91dGlscy4kc2V0VmFsdWVdKHZhbHVlKSB7CiAgICB2YWx1ZSA9IHZhbHVlLnZhbHVlIHx8ICIiOwogICAgdGhpc1tfc3ltYm9sX3V0aWxzLiRjb250ZW50XSA9IHZhbHVlLnRvU3RyaW5nKCk7CiAgfQogIFtfc3ltYm9sX3V0aWxzLiRkdW1wXShoYXNOUyA9IGZhbHNlKSB7CiAgICBjb25zdCBkdW1wZWQgPSBPYmplY3QuY3JlYXRlKG51bGwpOwogICAgaWYgKGhhc05TKSB7CiAgICAgIGR1bXBlZC4kbnMgPSB0aGlzW19zeW1ib2xfdXRpbHMuJG5hbWVzcGFjZUlkXTsKICAgIH0KICAgIGlmICh0aGlzW19zeW1ib2xfdXRpbHMuJGNvbnRlbnRdKSB7CiAgICAgIGR1bXBlZC4kY29udGVudCA9IHRoaXNbX3N5bWJvbF91dGlscy4kY29udGVudF07CiAgICB9CiAgICBkdW1wZWQuJG5hbWUgPSB0aGlzW19zeW1ib2xfdXRpbHMuJG5vZGVOYW1lXTsKICAgIGR1bXBlZC5jaGlsZHJlbiA9IFtdOwogICAgZm9yIChjb25zdCBjaGlsZCBvZiB0aGlzW19jaGlsZHJlbl0pIHsKICAgICAgZHVtcGVkLmNoaWxkcmVuLnB1c2goY2hpbGRbX3N5bWJvbF91dGlscy4kZHVtcF0oaGFzTlMpKTsKICAgIH0KICAgIGR1bXBlZC5hdHRyaWJ1dGVzID0gT2JqZWN0LmNyZWF0ZShudWxsKTsKICAgIGZvciAoY29uc3QgW25hbWUsIHZhbHVlXSBvZiB0aGlzW19hdHRyaWJ1dGVzXSkgewogICAgICBkdW1wZWQuYXR0cmlidXRlc1tuYW1lXSA9IHZhbHVlW19zeW1ib2xfdXRpbHMuJGNvbnRlbnRdOwogICAgfQogICAgcmV0dXJuIGR1bXBlZDsKICB9Cn0KZXhwb3J0cy5YbWxPYmplY3QgPSBYbWxPYmplY3Q7CmNsYXNzIENvbnRlbnRPYmplY3QgZXh0ZW5kcyBYRkFPYmplY3QgewogIGNvbnN0cnVjdG9yKG5zSWQsIG5hbWUpIHsKICAgIHN1cGVyKG5zSWQsIG5hbWUpOwogICAgdGhpc1tfc3ltYm9sX3V0aWxzLiRjb250ZW50XSA9ICIiOwogIH0KICBbX3N5bWJvbF91dGlscy4kb25UZXh0XSh0ZXh0KSB7CiAgICB0aGlzW19zeW1ib2xfdXRpbHMuJGNvbnRlbnRdICs9IHRleHQ7CiAgfQogIFtfc3ltYm9sX3V0aWxzLiRmaW5hbGl6ZV0oKSB7fQp9CmV4cG9ydHMuQ29udGVudE9iamVjdCA9IENvbnRlbnRPYmplY3Q7CmNsYXNzIE9wdGlvbk9iamVjdCBleHRlbmRzIENvbnRlbnRPYmplY3QgewogIGNvbnN0cnVjdG9yKG5zSWQsIG5hbWUsIG9wdGlvbnMpIHsKICAgIHN1cGVyKG5zSWQsIG5hbWUpOwogICAgdGhpc1tfb3B0aW9uc10gPSBvcHRpb25zOwogIH0KICBbX3N5bWJvbF91dGlscy4kZmluYWxpemVdKCkgewogICAgdGhpc1tfc3ltYm9sX3V0aWxzLiRjb250ZW50XSA9ICgwLCBfdXRpbHMuZ2V0S2V5d29yZCkoewogICAgICBkYXRhOiB0aGlzW19zeW1ib2xfdXRpbHMuJGNvbnRlbnRdLAogICAgICBkZWZhdWx0VmFsdWU6IHRoaXNbX29wdGlvbnNdWzBdLAogICAgICB2YWxpZGF0ZTogayA9PiB0aGlzW19vcHRpb25zXS5pbmNsdWRlcyhrKQogICAgfSk7CiAgfQogIFtfc3ltYm9sX3V0aWxzLiRjbGVhbl0oYnVpbGRlcikgewogICAgc3VwZXJbX3N5bWJvbF91dGlscy4kY2xlYW5dKGJ1aWxkZXIpOwogICAgZGVsZXRlIHRoaXNbX29wdGlvbnNdOwogIH0KfQpleHBvcnRzLk9wdGlvbk9iamVjdCA9IE9wdGlvbk9iamVjdDsKY2xhc3MgU3RyaW5nT2JqZWN0IGV4dGVuZHMgQ29udGVudE9iamVjdCB7CiAgW19zeW1ib2xfdXRpbHMuJGZpbmFsaXplXSgpIHsKICAgIHRoaXNbX3N5bWJvbF91dGlscy4kY29udGVudF0gPSB0aGlzW19zeW1ib2xfdXRpbHMuJGNvbnRlbnRdLnRyaW0oKTsKICB9Cn0KZXhwb3J0cy5TdHJpbmdPYmplY3QgPSBTdHJpbmdPYmplY3Q7CmNsYXNzIEludGVnZXJPYmplY3QgZXh0ZW5kcyBDb250ZW50T2JqZWN0IHsKICBjb25zdHJ1Y3Rvcihuc0lkLCBuYW1lLCBkZWZhdWx0VmFsdWUsIHZhbGlkYXRvcikgewogICAgc3VwZXIobnNJZCwgbmFtZSk7CiAgICB0aGlzW19kZWZhdWx0VmFsdWVdID0gZGVmYXVsdFZhbHVlOwogICAgdGhpc1tfdmFsaWRhdG9yXSA9IHZhbGlkYXRvcjsKICB9CiAgW19zeW1ib2xfdXRpbHMuJGZpbmFsaXplXSgpIHsKICAgIHRoaXNbX3N5bWJvbF91dGlscy4kY29udGVudF0gPSAoMCwgX3V0aWxzLmdldEludGVnZXIpKHsKICAgICAgZGF0YTogdGhpc1tfc3ltYm9sX3V0aWxzLiRjb250ZW50XSwKICAgICAgZGVmYXVsdFZhbHVlOiB0aGlzW19kZWZhdWx0VmFsdWVdLAogICAgICB2YWxpZGF0ZTogdGhpc1tfdmFsaWRhdG9yXQogICAgfSk7CiAgfQogIFtfc3ltYm9sX3V0aWxzLiRjbGVhbl0oYnVpbGRlcikgewogICAgc3VwZXJbX3N5bWJvbF91dGlscy4kY2xlYW5dKGJ1aWxkZXIpOwogICAgZGVsZXRlIHRoaXNbX2RlZmF1bHRWYWx1ZV07CiAgICBkZWxldGUgdGhpc1tfdmFsaWRhdG9yXTsKICB9Cn0KZXhwb3J0cy5JbnRlZ2VyT2JqZWN0ID0gSW50ZWdlck9iamVjdDsKY2xhc3MgT3B0aW9uMDEgZXh0ZW5kcyBJbnRlZ2VyT2JqZWN0IHsKICBjb25zdHJ1Y3Rvcihuc0lkLCBuYW1lKSB7CiAgICBzdXBlcihuc0lkLCBuYW1lLCAwLCBuID0+IG4gPT09IDEpOwogIH0KfQpleHBvcnRzLk9wdGlvbjAxID0gT3B0aW9uMDE7CmNsYXNzIE9wdGlvbjEwIGV4dGVuZHMgSW50ZWdlck9iamVjdCB7CiAgY29uc3RydWN0b3IobnNJZCwgbmFtZSkgewogICAgc3VwZXIobnNJZCwgbmFtZSwgMSwgbiA9PiBuID09PSAwKTsKICB9Cn0KZXhwb3J0cy5PcHRpb24xMCA9IE9wdGlvbjEwOwoKLyoqKi8gfSksCi8qIDg4ICovCi8qKiovICgoX191bnVzZWRfd2VicGFja19tb2R1bGUsIGV4cG9ydHMsIF9fd19wZGZqc19yZXF1aXJlX18pID0+IHsKCgoKT2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsICJfX2VzTW9kdWxlIiwgKHsKICB2YWx1ZTogdHJ1ZQp9KSk7CmV4cG9ydHMuY3JlYXRlRGF0YU5vZGUgPSBjcmVhdGVEYXRhTm9kZTsKZXhwb3J0cy5zZWFyY2hOb2RlID0gc2VhcmNoTm9kZTsKdmFyIF9zeW1ib2xfdXRpbHMgPSBfX3dfcGRmanNfcmVxdWlyZV9fKDc4KTsKdmFyIF91dGlsID0gX193X3BkZmpzX3JlcXVpcmVfXygyKTsKY29uc3QgbmFtZVBhdHRlcm4gPSAvXlteLltdKy87CmNvbnN0IGluZGV4UGF0dGVybiA9IC9eW15cXV0rLzsKY29uc3Qgb3BlcmF0b3JzID0gewogIGRvdDogMCwKICBkb3REb3Q6IDEsCiAgZG90SGFzaDogMiwKICBkb3RCcmFja2V0OiAzLAogIGRvdFBhcmVuOiA0Cn07CmNvbnN0IHNob3J0Y3V0cyA9IG5ldyBNYXAoW1siJGRhdGEiLCAocm9vdCwgY3VycmVudCkgPT4gcm9vdC5kYXRhc2V0cyA/IHJvb3QuZGF0YXNldHMuZGF0YSA6IHJvb3RdLCBbIiRyZWNvcmQiLCAocm9vdCwgY3VycmVudCkgPT4gKHJvb3QuZGF0YXNldHMgPyByb290LmRhdGFzZXRzLmRhdGEgOiByb290KVtfc3ltYm9sX3V0aWxzLiRnZXRDaGlsZHJlbl0oKVswXV0sIFsiJHRlbXBsYXRlIiwgKHJvb3QsIGN1cnJlbnQpID0+IHJvb3QudGVtcGxhdGVdLCBbIiRjb25uZWN0aW9uU2V0IiwgKHJvb3QsIGN1cnJlbnQpID0+IHJvb3QuY29ubmVjdGlvblNldF0sIFsiJGZvcm0iLCAocm9vdCwgY3VycmVudCkgPT4gcm9vdC5mb3JtXSwgWyIkbGF5b3V0IiwgKHJvb3QsIGN1cnJlbnQpID0+IHJvb3QubGF5b3V0XSwgWyIkaG9zdCIsIChyb290LCBjdXJyZW50KSA9PiByb290Lmhvc3RdLCBbIiRkYXRhV2luZG93IiwgKHJvb3QsIGN1cnJlbnQpID0+IHJvb3QuZGF0YVdpbmRvd10sIFsiJGV2ZW50IiwgKHJvb3QsIGN1cnJlbnQpID0+IHJvb3QuZXZlbnRdLCBbIiEiLCAocm9vdCwgY3VycmVudCkgPT4gcm9vdC5kYXRhc2V0c10sIFsiJHhmYSIsIChyb290LCBjdXJyZW50KSA9PiByb290XSwgWyJ4ZmEiLCAocm9vdCwgY3VycmVudCkgPT4gcm9vdF0sIFsiJCIsIChyb290LCBjdXJyZW50KSA9PiBjdXJyZW50XV0pOwpjb25zdCBzb21DYWNoZSA9IG5ldyBXZWFrTWFwKCk7CmZ1bmN0aW9uIHBhcnNlSW5kZXgoaW5kZXgpIHsKICBpbmRleCA9IGluZGV4LnRyaW0oKTsKICBpZiAoaW5kZXggPT09ICIqIikgewogICAgcmV0dXJuIEluZmluaXR5OwogIH0KICByZXR1cm4gcGFyc2VJbnQoaW5kZXgsIDEwKSB8fCAwOwp9CmZ1bmN0aW9uIHBhcnNlRXhwcmVzc2lvbihleHByLCBkb3REb3RBbGxvd2VkLCBub0V4cHIgPSB0cnVlKSB7CiAgbGV0IG1hdGNoID0gZXhwci5tYXRjaChuYW1lUGF0dGVybik7CiAgaWYgKCFtYXRjaCkgewogICAgcmV0dXJuIG51bGw7CiAgfQogIGxldCBbbmFtZV0gPSBtYXRjaDsKICBjb25zdCBwYXJzZWQgPSBbewogICAgbmFtZSwKICAgIGNhY2hlTmFtZTogIi4iICsgbmFtZSwKICAgIGluZGV4OiAwLAogICAganM6IG51bGwsCiAgICBmb3JtQ2FsYzogbnVsbCwKICAgIG9wZXJhdG9yOiBvcGVyYXRvcnMuZG90CiAgfV07CiAgbGV0IHBvcyA9IG5hbWUubGVuZ3RoOwogIHdoaWxlIChwb3MgPCBleHByLmxlbmd0aCkgewogICAgY29uc3Qgc3BvcyA9IHBvczsKICAgIGNvbnN0IGNoYXIgPSBleHByLmNoYXJBdChwb3MrKyk7CiAgICBpZiAoY2hhciA9PT0gIlsiKSB7CiAgICAgIG1hdGNoID0gZXhwci5zbGljZShwb3MpLm1hdGNoKGluZGV4UGF0dGVybik7CiAgICAgIGlmICghbWF0Y2gpIHsKICAgICAgICAoMCwgX3V0aWwud2FybikoIlhGQSAtIEludmFsaWQgaW5kZXggaW4gU09NIGV4cHJlc3Npb24iKTsKICAgICAgICByZXR1cm4gbnVsbDsKICAgICAgfQogICAgICBwYXJzZWQuYXQoLTEpLmluZGV4ID0gcGFyc2VJbmRleChtYXRjaFswXSk7CiAgICAgIHBvcyArPSBtYXRjaFswXS5sZW5ndGggKyAxOwogICAgICBjb250aW51ZTsKICAgIH0KICAgIGxldCBvcGVyYXRvcjsKICAgIHN3aXRjaCAoZXhwci5jaGFyQXQocG9zKSkgewogICAgICBjYXNlICIuIjoKICAgICAgICBpZiAoIWRvdERvdEFsbG93ZWQpIHsKICAgICAgICAgIHJldHVybiBudWxsOwogICAgICAgIH0KICAgICAgICBwb3MrKzsKICAgICAgICBvcGVyYXRvciA9IG9wZXJhdG9ycy5kb3REb3Q7CiAgICAgICAgYnJlYWs7CiAgICAgIGNhc2UgIiMiOgogICAgICAgIHBvcysrOwogICAgICAgIG9wZXJhdG9yID0gb3BlcmF0b3JzLmRvdEhhc2g7CiAgICAgICAgYnJlYWs7CiAgICAgIGNhc2UgIlsiOgogICAgICAgIGlmIChub0V4cHIpIHsKICAgICAgICAgICgwLCBfdXRpbC53YXJuKSgiWEZBIC0gU09NIGV4cHJlc3Npb24gY29udGFpbnMgYSBGb3JtQ2FsYyBzdWJleHByZXNzaW9uIHdoaWNoIGlzIG5vdCBzdXBwb3J0ZWQgZm9yIG5vdy4iKTsKICAgICAgICAgIHJldHVybiBudWxsOwogICAgICAgIH0KICAgICAgICBvcGVyYXRvciA9IG9wZXJhdG9ycy5kb3RCcmFja2V0OwogICAgICAgIGJyZWFrOwogICAgICBjYXNlICIoIjoKICAgICAgICBpZiAobm9FeHByKSB7CiAgICAgICAgICAoMCwgX3V0aWwud2FybikoIlhGQSAtIFNPTSBleHByZXNzaW9uIGNvbnRhaW5zIGEgSmF2YVNjcmlwdCBzdWJleHByZXNzaW9uIHdoaWNoIGlzIG5vdCBzdXBwb3J0ZWQgZm9yIG5vdy4iKTsKICAgICAgICAgIHJldHVybiBudWxsOwogICAgICAgIH0KICAgICAgICBvcGVyYXRvciA9IG9wZXJhdG9ycy5kb3RQYXJlbjsKICAgICAgICBicmVhazsKICAgICAgZGVmYXVsdDoKICAgICAgICBvcGVyYXRvciA9IG9wZXJhdG9ycy5kb3Q7CiAgICAgICAgYnJlYWs7CiAgICB9CiAgICBtYXRjaCA9IGV4cHIuc2xpY2UocG9zKS5tYXRjaChuYW1lUGF0dGVybik7CiAgICBpZiAoIW1hdGNoKSB7CiAgICAgIGJyZWFrOwogICAgfQogICAgW25hbWVdID0gbWF0Y2g7CiAgICBwb3MgKz0gbmFtZS5sZW5ndGg7CiAgICBwYXJzZWQucHVzaCh7CiAgICAgIG5hbWUsCiAgICAgIGNhY2hlTmFtZTogZXhwci5zbGljZShzcG9zLCBwb3MpLAogICAgICBvcGVyYXRvciwKICAgICAgaW5kZXg6IDAsCiAgICAgIGpzOiBudWxsLAogICAgICBmb3JtQ2FsYzogbnVsbAogICAgfSk7CiAgfQogIHJldHVybiBwYXJzZWQ7Cn0KZnVuY3Rpb24gc2VhcmNoTm9kZShyb290LCBjb250YWluZXIsIGV4cHIsIGRvdERvdEFsbG93ZWQgPSB0cnVlLCB1c2VDYWNoZSA9IHRydWUpIHsKICBjb25zdCBwYXJzZWQgPSBwYXJzZUV4cHJlc3Npb24oZXhwciwgZG90RG90QWxsb3dlZCk7CiAgaWYgKCFwYXJzZWQpIHsKICAgIHJldHVybiBudWxsOwogIH0KICBjb25zdCBmbiA9IHNob3J0Y3V0cy5nZXQocGFyc2VkWzBdLm5hbWUpOwogIGxldCBpID0gMDsKICBsZXQgaXNRdWFsaWZpZWQ7CiAgaWYgKGZuKSB7CiAgICBpc1F1YWxpZmllZCA9IHRydWU7CiAgICByb290ID0gW2ZuKHJvb3QsIGNvbnRhaW5lcildOwogICAgaSA9IDE7CiAgfSBlbHNlIHsKICAgIGlzUXVhbGlmaWVkID0gY29udGFpbmVyID09PSBudWxsOwogICAgcm9vdCA9IFtjb250YWluZXIgfHwgcm9vdF07CiAgfQogIGZvciAobGV0IGlpID0gcGFyc2VkLmxlbmd0aDsgaSA8IGlpOyBpKyspIHsKICAgIGNvbnN0IHsKICAgICAgbmFtZSwKICAgICAgY2FjaGVOYW1lLAogICAgICBvcGVyYXRvciwKICAgICAgaW5kZXgKICAgIH0gPSBwYXJzZWRbaV07CiAgICBjb25zdCBub2RlcyA9IFtdOwogICAgZm9yIChjb25zdCBub2RlIG9mIHJvb3QpIHsKICAgICAgaWYgKCFub2RlLmlzWEZBT2JqZWN0KSB7CiAgICAgICAgY29udGludWU7CiAgICAgIH0KICAgICAgbGV0IGNoaWxkcmVuLCBjYWNoZWQ7CiAgICAgIGlmICh1c2VDYWNoZSkgewogICAgICAgIGNhY2hlZCA9IHNvbUNhY2hlLmdldChub2RlKTsKICAgICAgICBpZiAoIWNhY2hlZCkgewogICAgICAgICAgY2FjaGVkID0gbmV3IE1hcCgpOwogICAgICAgICAgc29tQ2FjaGUuc2V0KG5vZGUsIGNhY2hlZCk7CiAgICAgICAgfQogICAgICAgIGNoaWxkcmVuID0gY2FjaGVkLmdldChjYWNoZU5hbWUpOwogICAgICB9CiAgICAgIGlmICghY2hpbGRyZW4pIHsKICAgICAgICBzd2l0Y2ggKG9wZXJhdG9yKSB7CiAgICAgICAgICBjYXNlIG9wZXJhdG9ycy5kb3Q6CiAgICAgICAgICAgIGNoaWxkcmVuID0gbm9kZVtfc3ltYm9sX3V0aWxzLiRnZXRDaGlsZHJlbkJ5TmFtZV0obmFtZSwgZmFsc2UpOwogICAgICAgICAgICBicmVhazsKICAgICAgICAgIGNhc2Ugb3BlcmF0b3JzLmRvdERvdDoKICAgICAgICAgICAgY2hpbGRyZW4gPSBub2RlW19zeW1ib2xfdXRpbHMuJGdldENoaWxkcmVuQnlOYW1lXShuYW1lLCB0cnVlKTsKICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICBjYXNlIG9wZXJhdG9ycy5kb3RIYXNoOgogICAgICAgICAgICBjaGlsZHJlbiA9IG5vZGVbX3N5bWJvbF91dGlscy4kZ2V0Q2hpbGRyZW5CeUNsYXNzXShuYW1lKTsKICAgICAgICAgICAgY2hpbGRyZW4gPSBjaGlsZHJlbi5pc1hGQU9iamVjdEFycmF5ID8gY2hpbGRyZW4uY2hpbGRyZW4gOiBbY2hpbGRyZW5dOwogICAgICAgICAgICBicmVhazsKICAgICAgICAgIGRlZmF1bHQ6CiAgICAgICAgICAgIGJyZWFrOwogICAgICAgIH0KICAgICAgICBpZiAodXNlQ2FjaGUpIHsKICAgICAgICAgIGNhY2hlZC5zZXQoY2FjaGVOYW1lLCBjaGlsZHJlbik7CiAgICAgICAgfQogICAgICB9CiAgICAgIGlmIChjaGlsZHJlbi5sZW5ndGggPiAwKSB7CiAgICAgICAgbm9kZXMucHVzaChjaGlsZHJlbik7CiAgICAgIH0KICAgIH0KICAgIGlmIChub2Rlcy5sZW5ndGggPT09IDAgJiYgIWlzUXVhbGlmaWVkICYmIGkgPT09IDApIHsKICAgICAgY29uc3QgcGFyZW50ID0gY29udGFpbmVyW19zeW1ib2xfdXRpbHMuJGdldFBhcmVudF0oKTsKICAgICAgY29udGFpbmVyID0gcGFyZW50OwogICAgICBpZiAoIWNvbnRhaW5lcikgewogICAgICAgIHJldHVybiBudWxsOwogICAgICB9CiAgICAgIGkgPSAtMTsKICAgICAgcm9vdCA9IFtjb250YWluZXJdOwogICAgICBjb250aW51ZTsKICAgIH0KICAgIHJvb3QgPSBpc0Zpbml0ZShpbmRleCkgPyBub2Rlcy5maWx0ZXIobm9kZSA9PiBpbmRleCA8IG5vZGUubGVuZ3RoKS5tYXAobm9kZSA9PiBub2RlW2luZGV4XSkgOiBub2Rlcy5mbGF0KCk7CiAgfQogIGlmIChyb290Lmxlbmd0aCA9PT0gMCkgewogICAgcmV0dXJuIG51bGw7CiAgfQogIHJldHVybiByb290Owp9CmZ1bmN0aW9uIGNyZWF0ZURhdGFOb2RlKHJvb3QsIGNvbnRhaW5lciwgZXhwcikgewogIGNvbnN0IHBhcnNlZCA9IHBhcnNlRXhwcmVzc2lvbihleHByKTsKICBpZiAoIXBhcnNlZCkgewogICAgcmV0dXJuIG51bGw7CiAgfQogIGlmIChwYXJzZWQuc29tZSh4ID0+IHgub3BlcmF0b3IgPT09IG9wZXJhdG9ycy5kb3REb3QpKSB7CiAgICByZXR1cm4gbnVsbDsKICB9CiAgY29uc3QgZm4gPSBzaG9ydGN1dHMuZ2V0KHBhcnNlZFswXS5uYW1lKTsKICBsZXQgaSA9IDA7CiAgaWYgKGZuKSB7CiAgICByb290ID0gZm4ocm9vdCwgY29udGFpbmVyKTsKICAgIGkgPSAxOwogIH0gZWxzZSB7CiAgICByb290ID0gY29udGFpbmVyIHx8IHJvb3Q7CiAgfQogIGZvciAobGV0IGlpID0gcGFyc2VkLmxlbmd0aDsgaSA8IGlpOyBpKyspIHsKICAgIGNvbnN0IHsKICAgICAgbmFtZSwKICAgICAgb3BlcmF0b3IsCiAgICAgIGluZGV4CiAgICB9ID0gcGFyc2VkW2ldOwogICAgaWYgKCFpc0Zpbml0ZShpbmRleCkpIHsKICAgICAgcGFyc2VkW2ldLmluZGV4ID0gMDsKICAgICAgcmV0dXJuIHJvb3QuY3JlYXRlTm9kZXMocGFyc2VkLnNsaWNlKGkpKTsKICAgIH0KICAgIGxldCBjaGlsZHJlbjsKICAgIHN3aXRjaCAob3BlcmF0b3IpIHsKICAgICAgY2FzZSBvcGVyYXRvcnMuZG90OgogICAgICAgIGNoaWxkcmVuID0gcm9vdFtfc3ltYm9sX3V0aWxzLiRnZXRDaGlsZHJlbkJ5TmFtZV0obmFtZSwgZmFsc2UpOwogICAgICAgIGJyZWFrOwogICAgICBjYXNlIG9wZXJhdG9ycy5kb3REb3Q6CiAgICAgICAgY2hpbGRyZW4gPSByb290W19zeW1ib2xfdXRpbHMuJGdldENoaWxkcmVuQnlOYW1lXShuYW1lLCB0cnVlKTsKICAgICAgICBicmVhazsKICAgICAgY2FzZSBvcGVyYXRvcnMuZG90SGFzaDoKICAgICAgICBjaGlsZHJlbiA9IHJvb3RbX3N5bWJvbF91dGlscy4kZ2V0Q2hpbGRyZW5CeUNsYXNzXShuYW1lKTsKICAgICAgICBjaGlsZHJlbiA9IGNoaWxkcmVuLmlzWEZBT2JqZWN0QXJyYXkgPyBjaGlsZHJlbi5jaGlsZHJlbiA6IFtjaGlsZHJlbl07CiAgICAgICAgYnJlYWs7CiAgICAgIGRlZmF1bHQ6CiAgICAgICAgYnJlYWs7CiAgICB9CiAgICBpZiAoY2hpbGRyZW4ubGVuZ3RoID09PSAwKSB7CiAgICAgIHJldHVybiByb290LmNyZWF0ZU5vZGVzKHBhcnNlZC5zbGljZShpKSk7CiAgICB9CiAgICBpZiAoaW5kZXggPCBjaGlsZHJlbi5sZW5ndGgpIHsKICAgICAgY29uc3QgY2hpbGQgPSBjaGlsZHJlbltpbmRleF07CiAgICAgIGlmICghY2hpbGQuaXNYRkFPYmplY3QpIHsKICAgICAgICAoMCwgX3V0aWwud2FybikoYFhGQSAtIENhbm5vdCBjcmVhdGUgYSBub2RlLmApOwogICAgICAgIHJldHVybiBudWxsOwogICAgICB9CiAgICAgIHJvb3QgPSBjaGlsZDsKICAgIH0gZWxzZSB7CiAgICAgIHBhcnNlZFtpXS5pbmRleCA9IGluZGV4IC0gY2hpbGRyZW4ubGVuZ3RoOwogICAgICByZXR1cm4gcm9vdC5jcmVhdGVOb2RlcyhwYXJzZWQuc2xpY2UoaSkpOwogICAgfQogIH0KICByZXR1cm4gbnVsbDsKfQoKLyoqKi8gfSksCi8qIDg5ICovCi8qKiovICgoX191bnVzZWRfd2VicGFja19tb2R1bGUsIGV4cG9ydHMsIF9fd19wZGZqc19yZXF1aXJlX18pID0+IHsKCgoKT2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsICJfX2VzTW9kdWxlIiwgKHsKICB2YWx1ZTogdHJ1ZQp9KSk7CmV4cG9ydHMuRGF0YUhhbmRsZXIgPSB2b2lkIDA7CnZhciBfc3ltYm9sX3V0aWxzID0gX193X3BkZmpzX3JlcXVpcmVfXyg3OCk7CmNsYXNzIERhdGFIYW5kbGVyIHsKICBjb25zdHJ1Y3Rvcihyb290LCBkYXRhKSB7CiAgICB0aGlzLmRhdGEgPSBkYXRhOwogICAgdGhpcy5kYXRhc2V0ID0gcm9vdC5kYXRhc2V0cyB8fCBudWxsOwogIH0KICBzZXJpYWxpemUoc3RvcmFnZSkgewogICAgY29uc3Qgc3RhY2sgPSBbWy0xLCB0aGlzLmRhdGFbX3N5bWJvbF91dGlscy4kZ2V0Q2hpbGRyZW5dKCldXTsKICAgIHdoaWxlIChzdGFjay5sZW5ndGggPiAwKSB7CiAgICAgIGNvbnN0IGxhc3QgPSBzdGFjay5hdCgtMSk7CiAgICAgIGNvbnN0IFtpLCBjaGlsZHJlbl0gPSBsYXN0OwogICAgICBpZiAoaSArIDEgPT09IGNoaWxkcmVuLmxlbmd0aCkgewogICAgICAgIHN0YWNrLnBvcCgpOwogICAgICAgIGNvbnRpbnVlOwogICAgICB9CiAgICAgIGNvbnN0IGNoaWxkID0gY2hpbGRyZW5bKytsYXN0WzBdXTsKICAgICAgY29uc3Qgc3RvcmFnZUVudHJ5ID0gc3RvcmFnZS5nZXQoY2hpbGRbX3N5bWJvbF91dGlscy4kdWlkXSk7CiAgICAgIGlmIChzdG9yYWdlRW50cnkpIHsKICAgICAgICBjaGlsZFtfc3ltYm9sX3V0aWxzLiRzZXRWYWx1ZV0oc3RvcmFnZUVudHJ5KTsKICAgICAgfSBlbHNlIHsKICAgICAgICBjb25zdCBhdHRyaWJ1dGVzID0gY2hpbGRbX3N5bWJvbF91dGlscy4kZ2V0QXR0cmlidXRlc10oKTsKICAgICAgICBmb3IgKGNvbnN0IHZhbHVlIG9mIGF0dHJpYnV0ZXMudmFsdWVzKCkpIHsKICAgICAgICAgIGNvbnN0IGVudHJ5ID0gc3RvcmFnZS5nZXQodmFsdWVbX3N5bWJvbF91dGlscy4kdWlkXSk7CiAgICAgICAgICBpZiAoZW50cnkpIHsKICAgICAgICAgICAgdmFsdWVbX3N5bWJvbF91dGlscy4kc2V0VmFsdWVdKGVudHJ5KTsKICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICB9CiAgICAgIGNvbnN0IG5vZGVzID0gY2hpbGRbX3N5bWJvbF91dGlscy4kZ2V0Q2hpbGRyZW5dKCk7CiAgICAgIGlmIChub2Rlcy5sZW5ndGggPiAwKSB7CiAgICAgICAgc3RhY2sucHVzaChbLTEsIG5vZGVzXSk7CiAgICAgIH0KICAgIH0KICAgIGNvbnN0IGJ1ZiA9IFtgPHhmYTpkYXRhc2V0cyB4bWxuczp4ZmE9Imh0dHA6Ly93d3cueGZhLm9yZy9zY2hlbWEveGZhLWRhdGEvMS4wLyI+YF07CiAgICBpZiAodGhpcy5kYXRhc2V0KSB7CiAgICAgIGZvciAoY29uc3QgY2hpbGQgb2YgdGhpcy5kYXRhc2V0W19zeW1ib2xfdXRpbHMuJGdldENoaWxkcmVuXSgpKSB7CiAgICAgICAgaWYgKGNoaWxkW19zeW1ib2xfdXRpbHMuJG5vZGVOYW1lXSAhPT0gImRhdGEiKSB7CiAgICAgICAgICBjaGlsZFtfc3ltYm9sX3V0aWxzLiR0b1N0cmluZ10oYnVmKTsKICAgICAgICB9CiAgICAgIH0KICAgIH0KICAgIHRoaXMuZGF0YVtfc3ltYm9sX3V0aWxzLiR0b1N0cmluZ10oYnVmKTsKICAgIGJ1Zi5wdXNoKCI8L3hmYTpkYXRhc2V0cz4iKTsKICAgIHJldHVybiBidWYuam9pbigiIik7CiAgfQp9CmV4cG9ydHMuRGF0YUhhbmRsZXIgPSBEYXRhSGFuZGxlcjsKCi8qKiovIH0pLAovKiA5MCAqLwovKioqLyAoKF9fdW51c2VkX3dlYnBhY2tfbW9kdWxlLCBleHBvcnRzLCBfX3dfcGRmanNfcmVxdWlyZV9fKSA9PiB7CgoKCk9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCAiX19lc01vZHVsZSIsICh7CiAgdmFsdWU6IHRydWUKfSkpOwpleHBvcnRzLlhGQVBhcnNlciA9IHZvaWQgMDsKdmFyIF9zeW1ib2xfdXRpbHMgPSBfX3dfcGRmanNfcmVxdWlyZV9fKDc4KTsKdmFyIF94bWxfcGFyc2VyID0gX193X3BkZmpzX3JlcXVpcmVfXyg3MSk7CnZhciBfYnVpbGRlciA9IF9fd19wZGZqc19yZXF1aXJlX18oOTEpOwp2YXIgX3V0aWwgPSBfX3dfcGRmanNfcmVxdWlyZV9fKDIpOwpjbGFzcyBYRkFQYXJzZXIgZXh0ZW5kcyBfeG1sX3BhcnNlci5YTUxQYXJzZXJCYXNlIHsKICBjb25zdHJ1Y3Rvcihyb290TmFtZVNwYWNlID0gbnVsbCwgcmljaFRleHQgPSBmYWxzZSkgewogICAgc3VwZXIoKTsKICAgIHRoaXMuX2J1aWxkZXIgPSBuZXcgX2J1aWxkZXIuQnVpbGRlcihyb290TmFtZVNwYWNlKTsKICAgIHRoaXMuX3N0YWNrID0gW107CiAgICB0aGlzLl9nbG9iYWxEYXRhID0gewogICAgICB1c2VkVHlwZWZhY2VzOiBuZXcgU2V0KCkKICAgIH07CiAgICB0aGlzLl9pZHMgPSBuZXcgTWFwKCk7CiAgICB0aGlzLl9jdXJyZW50ID0gdGhpcy5fYnVpbGRlci5idWlsZFJvb3QodGhpcy5faWRzKTsKICAgIHRoaXMuX2Vycm9yQ29kZSA9IF94bWxfcGFyc2VyLlhNTFBhcnNlckVycm9yQ29kZS5Ob0Vycm9yOwogICAgdGhpcy5fd2hpdGVSZWdleCA9IC9eXHMrJC87CiAgICB0aGlzLl9uYnNwcyA9IC9ceGEwKy9nOwogICAgdGhpcy5fcmljaFRleHQgPSByaWNoVGV4dDsKICB9CiAgcGFyc2UoZGF0YSkgewogICAgdGhpcy5wYXJzZVhtbChkYXRhKTsKICAgIGlmICh0aGlzLl9lcnJvckNvZGUgIT09IF94bWxfcGFyc2VyLlhNTFBhcnNlckVycm9yQ29kZS5Ob0Vycm9yKSB7CiAgICAgIHJldHVybiB1bmRlZmluZWQ7CiAgICB9CiAgICB0aGlzLl9jdXJyZW50W19zeW1ib2xfdXRpbHMuJGZpbmFsaXplXSgpOwogICAgcmV0dXJuIHRoaXMuX2N1cnJlbnQuZWxlbWVudDsKICB9CiAgb25UZXh0KHRleHQpIHsKICAgIHRleHQgPSB0ZXh0LnJlcGxhY2UodGhpcy5fbmJzcHMsIG1hdGNoID0+IG1hdGNoLnNsaWNlKDEpICsgIiAiKTsKICAgIGlmICh0aGlzLl9yaWNoVGV4dCB8fCB0aGlzLl9jdXJyZW50W19zeW1ib2xfdXRpbHMuJGFjY2VwdFdoaXRlc3BhY2VdKCkpIHsKICAgICAgdGhpcy5fY3VycmVudFtfc3ltYm9sX3V0aWxzLiRvblRleHRdKHRleHQsIHRoaXMuX3JpY2hUZXh0KTsKICAgICAgcmV0dXJuOwogICAgfQogICAgaWYgKHRoaXMuX3doaXRlUmVnZXgudGVzdCh0ZXh0KSkgewogICAgICByZXR1cm47CiAgICB9CiAgICB0aGlzLl9jdXJyZW50W19zeW1ib2xfdXRpbHMuJG9uVGV4dF0odGV4dC50cmltKCkpOwogIH0KICBvbkNkYXRhKHRleHQpIHsKICAgIHRoaXMuX2N1cnJlbnRbX3N5bWJvbF91dGlscy4kb25UZXh0XSh0ZXh0KTsKICB9CiAgX21rQXR0cmlidXRlcyhhdHRyaWJ1dGVzLCB0YWdOYW1lKSB7CiAgICBsZXQgbmFtZXNwYWNlID0gbnVsbDsKICAgIGxldCBwcmVmaXhlcyA9IG51bGw7CiAgICBjb25zdCBhdHRyaWJ1dGVPYmogPSBPYmplY3QuY3JlYXRlKHt9KTsKICAgIGZvciAoY29uc3QgewogICAgICBuYW1lLAogICAgICB2YWx1ZQogICAgfSBvZiBhdHRyaWJ1dGVzKSB7CiAgICAgIGlmIChuYW1lID09PSAieG1sbnMiKSB7CiAgICAgICAgaWYgKCFuYW1lc3BhY2UpIHsKICAgICAgICAgIG5hbWVzcGFjZSA9IHZhbHVlOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAoMCwgX3V0aWwud2FybikoYFhGQSAtIG11bHRpcGxlIG5hbWVzcGFjZSBkZWZpbml0aW9uIGluIDwke3RhZ05hbWV9PmApOwogICAgICAgIH0KICAgICAgfSBlbHNlIGlmIChuYW1lLnN0YXJ0c1dpdGgoInhtbG5zOiIpKSB7CiAgICAgICAgY29uc3QgcHJlZml4ID0gbmFtZS5zdWJzdHJpbmcoInhtbG5zOiIubGVuZ3RoKTsKICAgICAgICBpZiAoIXByZWZpeGVzKSB7CiAgICAgICAgICBwcmVmaXhlcyA9IFtdOwogICAgICAgIH0KICAgICAgICBwcmVmaXhlcy5wdXNoKHsKICAgICAgICAgIHByZWZpeCwKICAgICAgICAgIHZhbHVlCiAgICAgICAgfSk7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgY29uc3QgaSA9IG5hbWUuaW5kZXhPZigiOiIpOwogICAgICAgIGlmIChpID09PSAtMSkgewogICAgICAgICAgYXR0cmlidXRlT2JqW25hbWVdID0gdmFsdWU7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIGxldCBuc0F0dHJzID0gYXR0cmlidXRlT2JqW19zeW1ib2xfdXRpbHMuJG5zQXR0cmlidXRlc107CiAgICAgICAgICBpZiAoIW5zQXR0cnMpIHsKICAgICAgICAgICAgbnNBdHRycyA9IGF0dHJpYnV0ZU9ialtfc3ltYm9sX3V0aWxzLiRuc0F0dHJpYnV0ZXNdID0gT2JqZWN0LmNyZWF0ZShudWxsKTsKICAgICAgICAgIH0KICAgICAgICAgIGNvbnN0IFtucywgYXR0ck5hbWVdID0gW25hbWUuc2xpY2UoMCwgaSksIG5hbWUuc2xpY2UoaSArIDEpXTsKICAgICAgICAgIGNvbnN0IGF0dHJzID0gbnNBdHRyc1tuc10gfHw9IE9iamVjdC5jcmVhdGUobnVsbCk7CiAgICAgICAgICBhdHRyc1thdHRyTmFtZV0gPSB2YWx1ZTsKICAgICAgICB9CiAgICAgIH0KICAgIH0KICAgIHJldHVybiBbbmFtZXNwYWNlLCBwcmVmaXhlcywgYXR0cmlidXRlT2JqXTsKICB9CiAgX2dldE5hbWVBbmRQcmVmaXgobmFtZSwgbnNBZ25vc3RpYykgewogICAgY29uc3QgaSA9IG5hbWUuaW5kZXhPZigiOiIpOwogICAgaWYgKGkgPT09IC0xKSB7CiAgICAgIHJldHVybiBbbmFtZSwgbnVsbF07CiAgICB9CiAgICByZXR1cm4gW25hbWUuc3Vic3RyaW5nKGkgKyAxKSwgbnNBZ25vc3RpYyA/ICIiIDogbmFtZS5zdWJzdHJpbmcoMCwgaSldOwogIH0KICBvbkJlZ2luRWxlbWVudCh0YWdOYW1lLCBhdHRyaWJ1dGVzLCBpc0VtcHR5KSB7CiAgICBjb25zdCBbbmFtZXNwYWNlLCBwcmVmaXhlcywgYXR0cmlidXRlc09ial0gPSB0aGlzLl9ta0F0dHJpYnV0ZXMoYXR0cmlidXRlcywgdGFnTmFtZSk7CiAgICBjb25zdCBbbmFtZSwgbnNQcmVmaXhdID0gdGhpcy5fZ2V0TmFtZUFuZFByZWZpeCh0YWdOYW1lLCB0aGlzLl9idWlsZGVyLmlzTnNBZ25vc3RpYygpKTsKICAgIGNvbnN0IG5vZGUgPSB0aGlzLl9idWlsZGVyLmJ1aWxkKHsKICAgICAgbnNQcmVmaXgsCiAgICAgIG5hbWUsCiAgICAgIGF0dHJpYnV0ZXM6IGF0dHJpYnV0ZXNPYmosCiAgICAgIG5hbWVzcGFjZSwKICAgICAgcHJlZml4ZXMKICAgIH0pOwogICAgbm9kZVtfc3ltYm9sX3V0aWxzLiRnbG9iYWxEYXRhXSA9IHRoaXMuX2dsb2JhbERhdGE7CiAgICBpZiAoaXNFbXB0eSkgewogICAgICBub2RlW19zeW1ib2xfdXRpbHMuJGZpbmFsaXplXSgpOwogICAgICBpZiAodGhpcy5fY3VycmVudFtfc3ltYm9sX3V0aWxzLiRvbkNoaWxkXShub2RlKSkgewogICAgICAgIG5vZGVbX3N5bWJvbF91dGlscy4kc2V0SWRdKHRoaXMuX2lkcyk7CiAgICAgIH0KICAgICAgbm9kZVtfc3ltYm9sX3V0aWxzLiRjbGVhbl0odGhpcy5fYnVpbGRlcik7CiAgICAgIHJldHVybjsKICAgIH0KICAgIHRoaXMuX3N0YWNrLnB1c2godGhpcy5fY3VycmVudCk7CiAgICB0aGlzLl9jdXJyZW50ID0gbm9kZTsKICB9CiAgb25FbmRFbGVtZW50KG5hbWUpIHsKICAgIGNvbnN0IG5vZGUgPSB0aGlzLl9jdXJyZW50OwogICAgaWYgKG5vZGVbX3N5bWJvbF91dGlscy4kaXNDREFUQVhtbF0oKSAmJiB0eXBlb2Ygbm9kZVtfc3ltYm9sX3V0aWxzLiRjb250ZW50XSA9PT0gInN0cmluZyIpIHsKICAgICAgY29uc3QgcGFyc2VyID0gbmV3IFhGQVBhcnNlcigpOwogICAgICBwYXJzZXIuX2dsb2JhbERhdGEgPSB0aGlzLl9nbG9iYWxEYXRhOwogICAgICBjb25zdCByb290ID0gcGFyc2VyLnBhcnNlKG5vZGVbX3N5bWJvbF91dGlscy4kY29udGVudF0pOwogICAgICBub2RlW19zeW1ib2xfdXRpbHMuJGNvbnRlbnRdID0gbnVsbDsKICAgICAgbm9kZVtfc3ltYm9sX3V0aWxzLiRvbkNoaWxkXShyb290KTsKICAgIH0KICAgIG5vZGVbX3N5bWJvbF91dGlscy4kZmluYWxpemVdKCk7CiAgICB0aGlzLl9jdXJyZW50ID0gdGhpcy5fc3RhY2sucG9wKCk7CiAgICBpZiAodGhpcy5fY3VycmVudFtfc3ltYm9sX3V0aWxzLiRvbkNoaWxkXShub2RlKSkgewogICAgICBub2RlW19zeW1ib2xfdXRpbHMuJHNldElkXSh0aGlzLl9pZHMpOwogICAgfQogICAgbm9kZVtfc3ltYm9sX3V0aWxzLiRjbGVhbl0odGhpcy5fYnVpbGRlcik7CiAgfQogIG9uRXJyb3IoY29kZSkgewogICAgdGhpcy5fZXJyb3JDb2RlID0gY29kZTsKICB9Cn0KZXhwb3J0cy5YRkFQYXJzZXIgPSBYRkFQYXJzZXI7CgovKioqLyB9KSwKLyogOTEgKi8KLyoqKi8gKChfX3VudXNlZF93ZWJwYWNrX21vZHVsZSwgZXhwb3J0cywgX193X3BkZmpzX3JlcXVpcmVfXykgPT4gewoKCgpPYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgIl9fZXNNb2R1bGUiLCAoewogIHZhbHVlOiB0cnVlCn0pKTsKZXhwb3J0cy5CdWlsZGVyID0gdm9pZCAwOwp2YXIgX25hbWVzcGFjZXMgPSBfX3dfcGRmanNfcmVxdWlyZV9fKDgxKTsKdmFyIF9zeW1ib2xfdXRpbHMgPSBfX3dfcGRmanNfcmVxdWlyZV9fKDc4KTsKdmFyIF9zZXR1cCA9IF9fd19wZGZqc19yZXF1aXJlX18oOTIpOwp2YXIgX3RlbXBsYXRlID0gX193X3BkZmpzX3JlcXVpcmVfXyg4MCk7CnZhciBfdW5rbm93biA9IF9fd19wZGZqc19yZXF1aXJlX18oMTAxKTsKdmFyIF91dGlsID0gX193X3BkZmpzX3JlcXVpcmVfXygyKTsKdmFyIF94ZmFfb2JqZWN0ID0gX193X3BkZmpzX3JlcXVpcmVfXyg4Nyk7CmNsYXNzIFJvb3QgZXh0ZW5kcyBfeGZhX29iamVjdC5YRkFPYmplY3QgewogIGNvbnN0cnVjdG9yKGlkcykgewogICAgc3VwZXIoLTEsICJyb290IiwgT2JqZWN0LmNyZWF0ZShudWxsKSk7CiAgICB0aGlzLmVsZW1lbnQgPSBudWxsOwogICAgdGhpc1tfc3ltYm9sX3V0aWxzLiRpZHNdID0gaWRzOwogIH0KICBbX3N5bWJvbF91dGlscy4kb25DaGlsZF0oY2hpbGQpIHsKICAgIHRoaXMuZWxlbWVudCA9IGNoaWxkOwogICAgcmV0dXJuIHRydWU7CiAgfQogIFtfc3ltYm9sX3V0aWxzLiRmaW5hbGl6ZV0oKSB7CiAgICBzdXBlcltfc3ltYm9sX3V0aWxzLiRmaW5hbGl6ZV0oKTsKICAgIGlmICh0aGlzLmVsZW1lbnQudGVtcGxhdGUgaW5zdGFuY2VvZiBfdGVtcGxhdGUuVGVtcGxhdGUpIHsKICAgICAgdGhpc1tfc3ltYm9sX3V0aWxzLiRpZHNdLnNldChfc3ltYm9sX3V0aWxzLiRyb290LCB0aGlzLmVsZW1lbnQpOwogICAgICB0aGlzLmVsZW1lbnQudGVtcGxhdGVbX3N5bWJvbF91dGlscy4kcmVzb2x2ZVByb3RvdHlwZXNdKHRoaXNbX3N5bWJvbF91dGlscy4kaWRzXSk7CiAgICAgIHRoaXMuZWxlbWVudC50ZW1wbGF0ZVtfc3ltYm9sX3V0aWxzLiRpZHNdID0gdGhpc1tfc3ltYm9sX3V0aWxzLiRpZHNdOwogICAgfQogIH0KfQpjbGFzcyBFbXB0eSBleHRlbmRzIF94ZmFfb2JqZWN0LlhGQU9iamVjdCB7CiAgY29uc3RydWN0b3IoKSB7CiAgICBzdXBlcigtMSwgIiIsIE9iamVjdC5jcmVhdGUobnVsbCkpOwogIH0KICBbX3N5bWJvbF91dGlscy4kb25DaGlsZF0oXykgewogICAgcmV0dXJuIGZhbHNlOwogIH0KfQpjbGFzcyBCdWlsZGVyIHsKICBjb25zdHJ1Y3Rvcihyb290TmFtZVNwYWNlID0gbnVsbCkgewogICAgdGhpcy5fbmFtZXNwYWNlU3RhY2sgPSBbXTsKICAgIHRoaXMuX25zQWdub3N0aWNMZXZlbCA9IDA7CiAgICB0aGlzLl9uYW1lc3BhY2VQcmVmaXhlcyA9IG5ldyBNYXAoKTsKICAgIHRoaXMuX25hbWVzcGFjZXMgPSBuZXcgTWFwKCk7CiAgICB0aGlzLl9uZXh0TnNJZCA9IE1hdGgubWF4KC4uLk9iamVjdC52YWx1ZXMoX25hbWVzcGFjZXMuTmFtZXNwYWNlSWRzKS5tYXAoKHsKICAgICAgaWQKICAgIH0pID0+IGlkKSk7CiAgICB0aGlzLl9jdXJyZW50TmFtZXNwYWNlID0gcm9vdE5hbWVTcGFjZSB8fCBuZXcgX3Vua25vd24uVW5rbm93bk5hbWVzcGFjZSgrK3RoaXMuX25leHROc0lkKTsKICB9CiAgYnVpbGRSb290KGlkcykgewogICAgcmV0dXJuIG5ldyBSb290KGlkcyk7CiAgfQogIGJ1aWxkKHsKICAgIG5zUHJlZml4LAogICAgbmFtZSwKICAgIGF0dHJpYnV0ZXMsCiAgICBuYW1lc3BhY2UsCiAgICBwcmVmaXhlcwogIH0pIHsKICAgIGNvbnN0IGhhc05hbWVzcGFjZURlZiA9IG5hbWVzcGFjZSAhPT0gbnVsbDsKICAgIGlmIChoYXNOYW1lc3BhY2VEZWYpIHsKICAgICAgdGhpcy5fbmFtZXNwYWNlU3RhY2sucHVzaCh0aGlzLl9jdXJyZW50TmFtZXNwYWNlKTsKICAgICAgdGhpcy5fY3VycmVudE5hbWVzcGFjZSA9IHRoaXMuX3NlYXJjaE5hbWVzcGFjZShuYW1lc3BhY2UpOwogICAgfQogICAgaWYgKHByZWZpeGVzKSB7CiAgICAgIHRoaXMuX2FkZE5hbWVzcGFjZVByZWZpeChwcmVmaXhlcyk7CiAgICB9CiAgICBpZiAoYXR0cmlidXRlcy5oYXNPd25Qcm9wZXJ0eShfc3ltYm9sX3V0aWxzLiRuc0F0dHJpYnV0ZXMpKSB7CiAgICAgIGNvbnN0IGRhdGFUZW1wbGF0ZSA9IF9zZXR1cC5OYW1lc3BhY2VTZXRVcC5kYXRhc2V0czsKICAgICAgY29uc3QgbnNBdHRycyA9IGF0dHJpYnV0ZXNbX3N5bWJvbF91dGlscy4kbnNBdHRyaWJ1dGVzXTsKICAgICAgbGV0IHhmYUF0dHJzID0gbnVsbDsKICAgICAgZm9yIChjb25zdCBbbnMsIGF0dHJzXSBvZiBPYmplY3QuZW50cmllcyhuc0F0dHJzKSkgewogICAgICAgIGNvbnN0IG5zVG9Vc2UgPSB0aGlzLl9nZXROYW1lc3BhY2VUb1VzZShucyk7CiAgICAgICAgaWYgKG5zVG9Vc2UgPT09IGRhdGFUZW1wbGF0ZSkgewogICAgICAgICAgeGZhQXR0cnMgPSB7CiAgICAgICAgICAgIHhmYTogYXR0cnMKICAgICAgICAgIH07CiAgICAgICAgICBicmVhazsKICAgICAgICB9CiAgICAgIH0KICAgICAgaWYgKHhmYUF0dHJzKSB7CiAgICAgICAgYXR0cmlidXRlc1tfc3ltYm9sX3V0aWxzLiRuc0F0dHJpYnV0ZXNdID0geGZhQXR0cnM7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgZGVsZXRlIGF0dHJpYnV0ZXNbX3N5bWJvbF91dGlscy4kbnNBdHRyaWJ1dGVzXTsKICAgICAgfQogICAgfQogICAgY29uc3QgbmFtZXNwYWNlVG9Vc2UgPSB0aGlzLl9nZXROYW1lc3BhY2VUb1VzZShuc1ByZWZpeCk7CiAgICBjb25zdCBub2RlID0gbmFtZXNwYWNlVG9Vc2U/LltfbmFtZXNwYWNlcy4kYnVpbGRYRkFPYmplY3RdKG5hbWUsIGF0dHJpYnV0ZXMpIHx8IG5ldyBFbXB0eSgpOwogICAgaWYgKG5vZGVbX3N5bWJvbF91dGlscy4kaXNOc0Fnbm9zdGljXSgpKSB7CiAgICAgIHRoaXMuX25zQWdub3N0aWNMZXZlbCsrOwogICAgfQogICAgaWYgKGhhc05hbWVzcGFjZURlZiB8fCBwcmVmaXhlcyB8fCBub2RlW19zeW1ib2xfdXRpbHMuJGlzTnNBZ25vc3RpY10oKSkgewogICAgICBub2RlW19zeW1ib2xfdXRpbHMuJGNsZWFudXBdID0gewogICAgICAgIGhhc05hbWVzcGFjZTogaGFzTmFtZXNwYWNlRGVmLAogICAgICAgIHByZWZpeGVzLAogICAgICAgIG5zQWdub3N0aWM6IG5vZGVbX3N5bWJvbF91dGlscy4kaXNOc0Fnbm9zdGljXSgpCiAgICAgIH07CiAgICB9CiAgICByZXR1cm4gbm9kZTsKICB9CiAgaXNOc0Fnbm9zdGljKCkgewogICAgcmV0dXJuIHRoaXMuX25zQWdub3N0aWNMZXZlbCA+IDA7CiAgfQogIF9zZWFyY2hOYW1lc3BhY2UobnNOYW1lKSB7CiAgICBsZXQgbnMgPSB0aGlzLl9uYW1lc3BhY2VzLmdldChuc05hbWUpOwogICAgaWYgKG5zKSB7CiAgICAgIHJldHVybiBuczsKICAgIH0KICAgIGZvciAoY29uc3QgW25hbWUsIHsKICAgICAgY2hlY2sKICAgIH1dIG9mIE9iamVjdC5lbnRyaWVzKF9uYW1lc3BhY2VzLk5hbWVzcGFjZUlkcykpIHsKICAgICAgaWYgKGNoZWNrKG5zTmFtZSkpIHsKICAgICAgICBucyA9IF9zZXR1cC5OYW1lc3BhY2VTZXRVcFtuYW1lXTsKICAgICAgICBpZiAobnMpIHsKICAgICAgICAgIHRoaXMuX25hbWVzcGFjZXMuc2V0KG5zTmFtZSwgbnMpOwogICAgICAgICAgcmV0dXJuIG5zOwogICAgICAgIH0KICAgICAgICBicmVhazsKICAgICAgfQogICAgfQogICAgbnMgPSBuZXcgX3Vua25vd24uVW5rbm93bk5hbWVzcGFjZSgrK3RoaXMuX25leHROc0lkKTsKICAgIHRoaXMuX25hbWVzcGFjZXMuc2V0KG5zTmFtZSwgbnMpOwogICAgcmV0dXJuIG5zOwogIH0KICBfYWRkTmFtZXNwYWNlUHJlZml4KHByZWZpeGVzKSB7CiAgICBmb3IgKGNvbnN0IHsKICAgICAgcHJlZml4LAogICAgICB2YWx1ZQogICAgfSBvZiBwcmVmaXhlcykgewogICAgICBjb25zdCBuYW1lc3BhY2UgPSB0aGlzLl9zZWFyY2hOYW1lc3BhY2UodmFsdWUpOwogICAgICBsZXQgcHJlZml4U3RhY2sgPSB0aGlzLl9uYW1lc3BhY2VQcmVmaXhlcy5nZXQocHJlZml4KTsKICAgICAgaWYgKCFwcmVmaXhTdGFjaykgewogICAgICAgIHByZWZpeFN0YWNrID0gW107CiAgICAgICAgdGhpcy5fbmFtZXNwYWNlUHJlZml4ZXMuc2V0KHByZWZpeCwgcHJlZml4U3RhY2spOwogICAgICB9CiAgICAgIHByZWZpeFN0YWNrLnB1c2gobmFtZXNwYWNlKTsKICAgIH0KICB9CiAgX2dldE5hbWVzcGFjZVRvVXNlKHByZWZpeCkgewogICAgaWYgKCFwcmVmaXgpIHsKICAgICAgcmV0dXJuIHRoaXMuX2N1cnJlbnROYW1lc3BhY2U7CiAgICB9CiAgICBjb25zdCBwcmVmaXhTdGFjayA9IHRoaXMuX25hbWVzcGFjZVByZWZpeGVzLmdldChwcmVmaXgpOwogICAgaWYgKHByZWZpeFN0YWNrPy5sZW5ndGggPiAwKSB7CiAgICAgIHJldHVybiBwcmVmaXhTdGFjay5hdCgtMSk7CiAgICB9CiAgICAoMCwgX3V0aWwud2FybikoYFVua25vd24gbmFtZXNwYWNlIHByZWZpeDogJHtwcmVmaXh9LmApOwogICAgcmV0dXJuIG51bGw7CiAgfQogIGNsZWFuKGRhdGEpIHsKICAgIGNvbnN0IHsKICAgICAgaGFzTmFtZXNwYWNlLAogICAgICBwcmVmaXhlcywKICAgICAgbnNBZ25vc3RpYwogICAgfSA9IGRhdGE7CiAgICBpZiAoaGFzTmFtZXNwYWNlKSB7CiAgICAgIHRoaXMuX2N1cnJlbnROYW1lc3BhY2UgPSB0aGlzLl9uYW1lc3BhY2VTdGFjay5wb3AoKTsKICAgIH0KICAgIGlmIChwcmVmaXhlcykgewogICAgICBwcmVmaXhlcy5mb3JFYWNoKCh7CiAgICAgICAgcHJlZml4CiAgICAgIH0pID0+IHsKICAgICAgICB0aGlzLl9uYW1lc3BhY2VQcmVmaXhlcy5nZXQocHJlZml4KS5wb3AoKTsKICAgICAgfSk7CiAgICB9CiAgICBpZiAobnNBZ25vc3RpYykgewogICAgICB0aGlzLl9uc0Fnbm9zdGljTGV2ZWwtLTsKICAgIH0KICB9Cn0KZXhwb3J0cy5CdWlsZGVyID0gQnVpbGRlcjsKCi8qKiovIH0pLAovKiA5MiAqLwovKioqLyAoKF9fdW51c2VkX3dlYnBhY2tfbW9kdWxlLCBleHBvcnRzLCBfX3dfcGRmanNfcmVxdWlyZV9fKSA9PiB7CgoKCk9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCAiX19lc01vZHVsZSIsICh7CiAgdmFsdWU6IHRydWUKfSkpOwpleHBvcnRzLk5hbWVzcGFjZVNldFVwID0gdm9pZCAwOwp2YXIgX2NvbmZpZyA9IF9fd19wZGZqc19yZXF1aXJlX18oOTMpOwp2YXIgX2Nvbm5lY3Rpb25fc2V0ID0gX193X3BkZmpzX3JlcXVpcmVfXyg5NCk7CnZhciBfZGF0YXNldHMgPSBfX3dfcGRmanNfcmVxdWlyZV9fKDk1KTsKdmFyIF9sb2NhbGVfc2V0ID0gX193X3BkZmpzX3JlcXVpcmVfXyg5Nik7CnZhciBfc2lnbmF0dXJlID0gX193X3BkZmpzX3JlcXVpcmVfXyg5Nyk7CnZhciBfc3R5bGVzaGVldCA9IF9fd19wZGZqc19yZXF1aXJlX18oOTgpOwp2YXIgX3RlbXBsYXRlID0gX193X3BkZmpzX3JlcXVpcmVfXyg4MCk7CnZhciBfeGRwID0gX193X3BkZmpzX3JlcXVpcmVfXyg5OSk7CnZhciBfeGh0bWwgPSBfX3dfcGRmanNfcmVxdWlyZV9fKDEwMCk7CmNvbnN0IE5hbWVzcGFjZVNldFVwID0gewogIGNvbmZpZzogX2NvbmZpZy5Db25maWdOYW1lc3BhY2UsCiAgY29ubmVjdGlvbjogX2Nvbm5lY3Rpb25fc2V0LkNvbm5lY3Rpb25TZXROYW1lc3BhY2UsCiAgZGF0YXNldHM6IF9kYXRhc2V0cy5EYXRhc2V0c05hbWVzcGFjZSwKICBsb2NhbGVTZXQ6IF9sb2NhbGVfc2V0LkxvY2FsZVNldE5hbWVzcGFjZSwKICBzaWduYXR1cmU6IF9zaWduYXR1cmUuU2lnbmF0dXJlTmFtZXNwYWNlLAogIHN0eWxlc2hlZXQ6IF9zdHlsZXNoZWV0LlN0eWxlc2hlZXROYW1lc3BhY2UsCiAgdGVtcGxhdGU6IF90ZW1wbGF0ZS5UZW1wbGF0ZU5hbWVzcGFjZSwKICB4ZHA6IF94ZHAuWGRwTmFtZXNwYWNlLAogIHhodG1sOiBfeGh0bWwuWGh0bWxOYW1lc3BhY2UKfTsKZXhwb3J0cy5OYW1lc3BhY2VTZXRVcCA9IE5hbWVzcGFjZVNldFVwOwoKLyoqKi8gfSksCi8qIDkzICovCi8qKiovICgoX191bnVzZWRfd2VicGFja19tb2R1bGUsIGV4cG9ydHMsIF9fd19wZGZqc19yZXF1aXJlX18pID0+IHsKCgoKT2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsICJfX2VzTW9kdWxlIiwgKHsKICB2YWx1ZTogdHJ1ZQp9KSk7CmV4cG9ydHMuQ29uZmlnTmFtZXNwYWNlID0gdm9pZCAwOwp2YXIgX25hbWVzcGFjZXMgPSBfX3dfcGRmanNfcmVxdWlyZV9fKDgxKTsKdmFyIF9zeW1ib2xfdXRpbHMgPSBfX3dfcGRmanNfcmVxdWlyZV9fKDc4KTsKdmFyIF94ZmFfb2JqZWN0ID0gX193X3BkZmpzX3JlcXVpcmVfXyg4Nyk7CnZhciBfdXRpbHMgPSBfX3dfcGRmanNfcmVxdWlyZV9fKDg0KTsKdmFyIF91dGlsID0gX193X3BkZmpzX3JlcXVpcmVfXygyKTsKY29uc3QgQ09ORklHX05TX0lEID0gX25hbWVzcGFjZXMuTmFtZXNwYWNlSWRzLmNvbmZpZy5pZDsKY2xhc3MgQWNyb2JhdCBleHRlbmRzIF94ZmFfb2JqZWN0LlhGQU9iamVjdCB7CiAgY29uc3RydWN0b3IoYXR0cmlidXRlcykgewogICAgc3VwZXIoQ09ORklHX05TX0lELCAiYWNyb2JhdCIsIHRydWUpOwogICAgdGhpcy5hY3JvYmF0NyA9IG51bGw7CiAgICB0aGlzLmF1dG9TYXZlID0gbnVsbDsKICAgIHRoaXMuY29tbW9uID0gbnVsbDsKICAgIHRoaXMudmFsaWRhdGUgPSBudWxsOwogICAgdGhpcy52YWxpZGF0ZUFwcHJvdmFsU2lnbmF0dXJlcyA9IG51bGw7CiAgICB0aGlzLnN1Ym1pdFVybCA9IG5ldyBfeGZhX29iamVjdC5YRkFPYmplY3RBcnJheSgpOwogIH0KfQpjbGFzcyBBY3JvYmF0NyBleHRlbmRzIF94ZmFfb2JqZWN0LlhGQU9iamVjdCB7CiAgY29uc3RydWN0b3IoYXR0cmlidXRlcykgewogICAgc3VwZXIoQ09ORklHX05TX0lELCAiYWNyb2JhdDciLCB0cnVlKTsKICAgIHRoaXMuZHluYW1pY1JlbmRlciA9IG51bGw7CiAgfQp9CmNsYXNzIEFEQkVfSlNDb25zb2xlIGV4dGVuZHMgX3hmYV9vYmplY3QuT3B0aW9uT2JqZWN0IHsKICBjb25zdHJ1Y3RvcihhdHRyaWJ1dGVzKSB7CiAgICBzdXBlcihDT05GSUdfTlNfSUQsICJBREJFX0pTQ29uc29sZSIsIFsiZGVsZWdhdGUiLCAiRW5hYmxlIiwgIkRpc2FibGUiXSk7CiAgfQp9CmNsYXNzIEFEQkVfSlNEZWJ1Z2dlciBleHRlbmRzIF94ZmFfb2JqZWN0Lk9wdGlvbk9iamVjdCB7CiAgY29uc3RydWN0b3IoYXR0cmlidXRlcykgewogICAgc3VwZXIoQ09ORklHX05TX0lELCAiQURCRV9KU0RlYnVnZ2VyIiwgWyJkZWxlZ2F0ZSIsICJFbmFibGUiLCAiRGlzYWJsZSJdKTsKICB9Cn0KY2xhc3MgQWRkU2lsZW50UHJpbnQgZXh0ZW5kcyBfeGZhX29iamVjdC5PcHRpb24wMSB7CiAgY29uc3RydWN0b3IoYXR0cmlidXRlcykgewogICAgc3VwZXIoQ09ORklHX05TX0lELCAiYWRkU2lsZW50UHJpbnQiKTsKICB9Cn0KY2xhc3MgQWRkVmlld2VyUHJlZmVyZW5jZXMgZXh0ZW5kcyBfeGZhX29iamVjdC5PcHRpb24wMSB7CiAgY29uc3RydWN0b3IoYXR0cmlidXRlcykgewogICAgc3VwZXIoQ09ORklHX05TX0lELCAiYWRkVmlld2VyUHJlZmVyZW5jZXMiKTsKICB9Cn0KY2xhc3MgQWRqdXN0RGF0YSBleHRlbmRzIF94ZmFfb2JqZWN0Lk9wdGlvbjEwIHsKICBjb25zdHJ1Y3RvcihhdHRyaWJ1dGVzKSB7CiAgICBzdXBlcihDT05GSUdfTlNfSUQsICJhZGp1c3REYXRhIik7CiAgfQp9CmNsYXNzIEFkb2JlRXh0ZW5zaW9uTGV2ZWwgZXh0ZW5kcyBfeGZhX29iamVjdC5JbnRlZ2VyT2JqZWN0IHsKICBjb25zdHJ1Y3RvcihhdHRyaWJ1dGVzKSB7CiAgICBzdXBlcihDT05GSUdfTlNfSUQsICJhZG9iZUV4dGVuc2lvbkxldmVsIiwgMCwgbiA9PiBuID49IDEgJiYgbiA8PSA4KTsKICB9Cn0KY2xhc3MgQWdlbnQgZXh0ZW5kcyBfeGZhX29iamVjdC5YRkFPYmplY3QgewogIGNvbnN0cnVjdG9yKGF0dHJpYnV0ZXMpIHsKICAgIHN1cGVyKENPTkZJR19OU19JRCwgImFnZW50IiwgdHJ1ZSk7CiAgICB0aGlzLm5hbWUgPSBhdHRyaWJ1dGVzLm5hbWUgPyBhdHRyaWJ1dGVzLm5hbWUudHJpbSgpIDogIiI7CiAgICB0aGlzLmNvbW1vbiA9IG5ldyBfeGZhX29iamVjdC5YRkFPYmplY3RBcnJheSgpOwogIH0KfQpjbGFzcyBBbHdheXNFbWJlZCBleHRlbmRzIF94ZmFfb2JqZWN0LkNvbnRlbnRPYmplY3QgewogIGNvbnN0cnVjdG9yKGF0dHJpYnV0ZXMpIHsKICAgIHN1cGVyKENPTkZJR19OU19JRCwgImFsd2F5c0VtYmVkIik7CiAgfQp9CmNsYXNzIEFtZCBleHRlbmRzIF94ZmFfb2JqZWN0LlN0cmluZ09iamVjdCB7CiAgY29uc3RydWN0b3IoYXR0cmlidXRlcykgewogICAgc3VwZXIoQ09ORklHX05TX0lELCAiYW1kIik7CiAgfQp9CmNsYXNzIEFyZWEgZXh0ZW5kcyBfeGZhX29iamVjdC5YRkFPYmplY3QgewogIGNvbnN0cnVjdG9yKGF0dHJpYnV0ZXMpIHsKICAgIHN1cGVyKENPTkZJR19OU19JRCwgImFyZWEiKTsKICAgIHRoaXMubGV2ZWwgPSAoMCwgX3V0aWxzLmdldEludGVnZXIpKHsKICAgICAgZGF0YTogYXR0cmlidXRlcy5sZXZlbCwKICAgICAgZGVmYXVsdFZhbHVlOiAwLAogICAgICB2YWxpZGF0ZTogbiA9PiBuID49IDEgJiYgbiA8PSAzCiAgICB9KTsKICAgIHRoaXMubmFtZSA9ICgwLCBfdXRpbHMuZ2V0U3RyaW5nT3B0aW9uKShhdHRyaWJ1dGVzLm5hbWUsIFsiIiwgImJhcmNvZGUiLCAiY29yZWluaXQiLCAiZGV2aWNlRHJpdmVyIiwgImZvbnQiLCAiZ2VuZXJhbCIsICJsYXlvdXQiLCAibWVyZ2UiLCAic2NyaXB0IiwgInNpZ25hdHVyZSIsICJzb3VyY2VTZXQiLCAidGVtcGxhdGVDYWNoZSJdKTsKICB9Cn0KY2xhc3MgQXR0cmlidXRlcyBleHRlbmRzIF94ZmFfb2JqZWN0Lk9wdGlvbk9iamVjdCB7CiAgY29uc3RydWN0b3IoYXR0cmlidXRlcykgewogICAgc3VwZXIoQ09ORklHX05TX0lELCAiYXR0cmlidXRlcyIsIFsicHJlc2VydmUiLCAiZGVsZWdhdGUiLCAiaWdub3JlIl0pOwogIH0KfQpjbGFzcyBBdXRvU2F2ZSBleHRlbmRzIF94ZmFfb2JqZWN0Lk9wdGlvbk9iamVjdCB7CiAgY29uc3RydWN0b3IoYXR0cmlidXRlcykgewogICAgc3VwZXIoQ09ORklHX05TX0lELCAiYXV0b1NhdmUiLCBbImRpc2FibGVkIiwgImVuYWJsZWQiXSk7CiAgfQp9CmNsYXNzIEJhc2UgZXh0ZW5kcyBfeGZhX29iamVjdC5TdHJpbmdPYmplY3QgewogIGNvbnN0cnVjdG9yKGF0dHJpYnV0ZXMpIHsKICAgIHN1cGVyKENPTkZJR19OU19JRCwgImJhc2UiKTsKICB9Cn0KY2xhc3MgQmF0Y2hPdXRwdXQgZXh0ZW5kcyBfeGZhX29iamVjdC5YRkFPYmplY3QgewogIGNvbnN0cnVjdG9yKGF0dHJpYnV0ZXMpIHsKICAgIHN1cGVyKENPTkZJR19OU19JRCwgImJhdGNoT3V0cHV0Iik7CiAgICB0aGlzLmZvcm1hdCA9ICgwLCBfdXRpbHMuZ2V0U3RyaW5nT3B0aW9uKShhdHRyaWJ1dGVzLmZvcm1hdCwgWyJub25lIiwgImNvbmNhdCIsICJ6aXAiLCAiemlwQ29tcHJlc3MiXSk7CiAgfQp9CmNsYXNzIEJlaGF2aW9yT3ZlcnJpZGUgZXh0ZW5kcyBfeGZhX29iamVjdC5Db250ZW50T2JqZWN0IHsKICBjb25zdHJ1Y3RvcihhdHRyaWJ1dGVzKSB7CiAgICBzdXBlcihDT05GSUdfTlNfSUQsICJiZWhhdmlvck92ZXJyaWRlIik7CiAgfQogIFtfc3ltYm9sX3V0aWxzLiRmaW5hbGl6ZV0oKSB7CiAgICB0aGlzW19zeW1ib2xfdXRpbHMuJGNvbnRlbnRdID0gbmV3IE1hcCh0aGlzW19zeW1ib2xfdXRpbHMuJGNvbnRlbnRdLnRyaW0oKS5zcGxpdCgvXHMrLykuZmlsdGVyKHggPT4geC5pbmNsdWRlcygiOiIpKS5tYXAoeCA9PiB4LnNwbGl0KCI6IiwgMikpKTsKICB9Cn0KY2xhc3MgQ2FjaGUgZXh0ZW5kcyBfeGZhX29iamVjdC5YRkFPYmplY3QgewogIGNvbnN0cnVjdG9yKGF0dHJpYnV0ZXMpIHsKICAgIHN1cGVyKENPTkZJR19OU19JRCwgImNhY2hlIiwgdHJ1ZSk7CiAgICB0aGlzLnRlbXBsYXRlQ2FjaGUgPSBudWxsOwogIH0KfQpjbGFzcyBDaGFuZ2UgZXh0ZW5kcyBfeGZhX29iamVjdC5PcHRpb24wMSB7CiAgY29uc3RydWN0b3IoYXR0cmlidXRlcykgewogICAgc3VwZXIoQ09ORklHX05TX0lELCAiY2hhbmdlIik7CiAgfQp9CmNsYXNzIENvbW1vbiBleHRlbmRzIF94ZmFfb2JqZWN0LlhGQU9iamVjdCB7CiAgY29uc3RydWN0b3IoYXR0cmlidXRlcykgewogICAgc3VwZXIoQ09ORklHX05TX0lELCAiY29tbW9uIiwgdHJ1ZSk7CiAgICB0aGlzLmRhdGEgPSBudWxsOwogICAgdGhpcy5sb2NhbGUgPSBudWxsOwogICAgdGhpcy5sb2NhbGVTZXQgPSBudWxsOwogICAgdGhpcy5tZXNzYWdpbmcgPSBudWxsOwogICAgdGhpcy5zdXBwcmVzc0Jhbm5lciA9IG51bGw7CiAgICB0aGlzLnRlbXBsYXRlID0gbnVsbDsKICAgIHRoaXMudmFsaWRhdGlvbk1lc3NhZ2luZyA9IG51bGw7CiAgICB0aGlzLnZlcnNpb25Db250cm9sID0gbnVsbDsKICAgIHRoaXMubG9nID0gbmV3IF94ZmFfb2JqZWN0LlhGQU9iamVjdEFycmF5KCk7CiAgfQp9CmNsYXNzIENvbXByZXNzIGV4dGVuZHMgX3hmYV9vYmplY3QuWEZBT2JqZWN0IHsKICBjb25zdHJ1Y3RvcihhdHRyaWJ1dGVzKSB7CiAgICBzdXBlcihDT05GSUdfTlNfSUQsICJjb21wcmVzcyIpOwogICAgdGhpcy5zY29wZSA9ICgwLCBfdXRpbHMuZ2V0U3RyaW5nT3B0aW9uKShhdHRyaWJ1dGVzLnNjb3BlLCBbImltYWdlT25seSIsICJkb2N1bWVudCJdKTsKICB9Cn0KY2xhc3MgQ29tcHJlc3NMb2dpY2FsU3RydWN0dXJlIGV4dGVuZHMgX3hmYV9vYmplY3QuT3B0aW9uMDEgewogIGNvbnN0cnVjdG9yKGF0dHJpYnV0ZXMpIHsKICAgIHN1cGVyKENPTkZJR19OU19JRCwgImNvbXByZXNzTG9naWNhbFN0cnVjdHVyZSIpOwogIH0KfQpjbGFzcyBDb21wcmVzc09iamVjdFN0cmVhbSBleHRlbmRzIF94ZmFfb2JqZWN0Lk9wdGlvbjEwIHsKICBjb25zdHJ1Y3RvcihhdHRyaWJ1dGVzKSB7CiAgICBzdXBlcihDT05GSUdfTlNfSUQsICJjb21wcmVzc09iamVjdFN0cmVhbSIpOwogIH0KfQpjbGFzcyBDb21wcmVzc2lvbiBleHRlbmRzIF94ZmFfb2JqZWN0LlhGQU9iamVjdCB7CiAgY29uc3RydWN0b3IoYXR0cmlidXRlcykgewogICAgc3VwZXIoQ09ORklHX05TX0lELCAiY29tcHJlc3Npb24iLCB0cnVlKTsKICAgIHRoaXMuY29tcHJlc3NMb2dpY2FsU3RydWN0dXJlID0gbnVsbDsKICAgIHRoaXMuY29tcHJlc3NPYmplY3RTdHJlYW0gPSBudWxsOwogICAgdGhpcy5sZXZlbCA9IG51bGw7CiAgICB0aGlzLnR5cGUgPSBudWxsOwogIH0KfQpjbGFzcyBDb25maWcgZXh0ZW5kcyBfeGZhX29iamVjdC5YRkFPYmplY3QgewogIGNvbnN0cnVjdG9yKGF0dHJpYnV0ZXMpIHsKICAgIHN1cGVyKENPTkZJR19OU19JRCwgImNvbmZpZyIsIHRydWUpOwogICAgdGhpcy5hY3JvYmF0ID0gbnVsbDsKICAgIHRoaXMucHJlc2VudCA9IG51bGw7CiAgICB0aGlzLnRyYWNlID0gbnVsbDsKICAgIHRoaXMuYWdlbnQgPSBuZXcgX3hmYV9vYmplY3QuWEZBT2JqZWN0QXJyYXkoKTsKICB9Cn0KY2xhc3MgQ29uZm9ybWFuY2UgZXh0ZW5kcyBfeGZhX29iamVjdC5PcHRpb25PYmplY3QgewogIGNvbnN0cnVjdG9yKGF0dHJpYnV0ZXMpIHsKICAgIHN1cGVyKENPTkZJR19OU19JRCwgImNvbmZvcm1hbmNlIiwgWyJBIiwgIkIiXSk7CiAgfQp9CmNsYXNzIENvbnRlbnRDb3B5IGV4dGVuZHMgX3hmYV9vYmplY3QuT3B0aW9uMDEgewogIGNvbnN0cnVjdG9yKGF0dHJpYnV0ZXMpIHsKICAgIHN1cGVyKENPTkZJR19OU19JRCwgImNvbnRlbnRDb3B5Iik7CiAgfQp9CmNsYXNzIENvcGllcyBleHRlbmRzIF94ZmFfb2JqZWN0LkludGVnZXJPYmplY3QgewogIGNvbnN0cnVjdG9yKGF0dHJpYnV0ZXMpIHsKICAgIHN1cGVyKENPTkZJR19OU19JRCwgImNvcGllcyIsIDEsIG4gPT4gbiA+PSAxKTsKICB9Cn0KY2xhc3MgQ3JlYXRvciBleHRlbmRzIF94ZmFfb2JqZWN0LlN0cmluZ09iamVjdCB7CiAgY29uc3RydWN0b3IoYXR0cmlidXRlcykgewogICAgc3VwZXIoQ09ORklHX05TX0lELCAiY3JlYXRvciIpOwogIH0KfQpjbGFzcyBDdXJyZW50UGFnZSBleHRlbmRzIF94ZmFfb2JqZWN0LkludGVnZXJPYmplY3QgewogIGNvbnN0cnVjdG9yKGF0dHJpYnV0ZXMpIHsKICAgIHN1cGVyKENPTkZJR19OU19JRCwgImN1cnJlbnRQYWdlIiwgMCwgbiA9PiBuID49IDApOwogIH0KfQpjbGFzcyBEYXRhIGV4dGVuZHMgX3hmYV9vYmplY3QuWEZBT2JqZWN0IHsKICBjb25zdHJ1Y3RvcihhdHRyaWJ1dGVzKSB7CiAgICBzdXBlcihDT05GSUdfTlNfSUQsICJkYXRhIiwgdHJ1ZSk7CiAgICB0aGlzLmFkanVzdERhdGEgPSBudWxsOwogICAgdGhpcy5hdHRyaWJ1dGVzID0gbnVsbDsKICAgIHRoaXMuaW5jcmVtZW50YWxMb2FkID0gbnVsbDsKICAgIHRoaXMub3V0cHV0WFNMID0gbnVsbDsKICAgIHRoaXMucmFuZ2UgPSBudWxsOwogICAgdGhpcy5yZWNvcmQgPSBudWxsOwogICAgdGhpcy5zdGFydE5vZGUgPSBudWxsOwogICAgdGhpcy51cmkgPSBudWxsOwogICAgdGhpcy53aW5kb3cgPSBudWxsOwogICAgdGhpcy54c2wgPSBudWxsOwogICAgdGhpcy5leGNsdWRlTlMgPSBuZXcgX3hmYV9vYmplY3QuWEZBT2JqZWN0QXJyYXkoKTsKICAgIHRoaXMudHJhbnNmb3JtID0gbmV3IF94ZmFfb2JqZWN0LlhGQU9iamVjdEFycmF5KCk7CiAgfQp9CmNsYXNzIERlYnVnIGV4dGVuZHMgX3hmYV9vYmplY3QuWEZBT2JqZWN0IHsKICBjb25zdHJ1Y3RvcihhdHRyaWJ1dGVzKSB7CiAgICBzdXBlcihDT05GSUdfTlNfSUQsICJkZWJ1ZyIsIHRydWUpOwogICAgdGhpcy51cmkgPSBudWxsOwogIH0KfQpjbGFzcyBEZWZhdWx0VHlwZWZhY2UgZXh0ZW5kcyBfeGZhX29iamVjdC5Db250ZW50T2JqZWN0IHsKICBjb25zdHJ1Y3RvcihhdHRyaWJ1dGVzKSB7CiAgICBzdXBlcihDT05GSUdfTlNfSUQsICJkZWZhdWx0VHlwZWZhY2UiKTsKICAgIHRoaXMud3JpdGluZ1NjcmlwdCA9ICgwLCBfdXRpbHMuZ2V0U3RyaW5nT3B0aW9uKShhdHRyaWJ1dGVzLndyaXRpbmdTY3JpcHQsIFsiKiIsICJBcmFiaWMiLCAiQ3lyaWxsaWMiLCAiRWFzdEV1cm9wZWFuUm9tYW4iLCAiR3JlZWsiLCAiSGVicmV3IiwgIkphcGFuZXNlIiwgIktvcmVhbiIsICJSb21hbiIsICJTaW1wbGlmaWVkQ2hpbmVzZSIsICJUaGFpIiwgIlRyYWRpdGlvbmFsQ2hpbmVzZSIsICJWaWV0bmFtZXNlIl0pOwogIH0KfQpjbGFzcyBEZXN0aW5hdGlvbiBleHRlbmRzIF94ZmFfb2JqZWN0Lk9wdGlvbk9iamVjdCB7CiAgY29uc3RydWN0b3IoYXR0cmlidXRlcykgewogICAgc3VwZXIoQ09ORklHX05TX0lELCAiZGVzdGluYXRpb24iLCBbInBkZiIsICJwY2wiLCAicHMiLCAid2ViQ2xpZW50IiwgInpwbCJdKTsKICB9Cn0KY2xhc3MgRG9jdW1lbnRBc3NlbWJseSBleHRlbmRzIF94ZmFfb2JqZWN0Lk9wdGlvbjAxIHsKICBjb25zdHJ1Y3RvcihhdHRyaWJ1dGVzKSB7CiAgICBzdXBlcihDT05GSUdfTlNfSUQsICJkb2N1bWVudEFzc2VtYmx5Iik7CiAgfQp9CmNsYXNzIERyaXZlciBleHRlbmRzIF94ZmFfb2JqZWN0LlhGQU9iamVjdCB7CiAgY29uc3RydWN0b3IoYXR0cmlidXRlcykgewogICAgc3VwZXIoQ09ORklHX05TX0lELCAiZHJpdmVyIiwgdHJ1ZSk7CiAgICB0aGlzLm5hbWUgPSBhdHRyaWJ1dGVzLm5hbWUgPyBhdHRyaWJ1dGVzLm5hbWUudHJpbSgpIDogIiI7CiAgICB0aGlzLmZvbnRJbmZvID0gbnVsbDsKICAgIHRoaXMueGRjID0gbnVsbDsKICB9Cn0KY2xhc3MgRHVwbGV4T3B0aW9uIGV4dGVuZHMgX3hmYV9vYmplY3QuT3B0aW9uT2JqZWN0IHsKICBjb25zdHJ1Y3RvcihhdHRyaWJ1dGVzKSB7CiAgICBzdXBlcihDT05GSUdfTlNfSUQsICJkdXBsZXhPcHRpb24iLCBbInNpbXBsZXgiLCAiZHVwbGV4RmxpcExvbmdFZGdlIiwgImR1cGxleEZsaXBTaG9ydEVkZ2UiXSk7CiAgfQp9CmNsYXNzIER5bmFtaWNSZW5kZXIgZXh0ZW5kcyBfeGZhX29iamVjdC5PcHRpb25PYmplY3QgewogIGNvbnN0cnVjdG9yKGF0dHJpYnV0ZXMpIHsKICAgIHN1cGVyKENPTkZJR19OU19JRCwgImR5bmFtaWNSZW5kZXIiLCBbImZvcmJpZGRlbiIsICJyZXF1aXJlZCJdKTsKICB9Cn0KY2xhc3MgRW1iZWQgZXh0ZW5kcyBfeGZhX29iamVjdC5PcHRpb24wMSB7CiAgY29uc3RydWN0b3IoYXR0cmlidXRlcykgewogICAgc3VwZXIoQ09ORklHX05TX0lELCAiZW1iZWQiKTsKICB9Cn0KY2xhc3MgRW5jcnlwdCBleHRlbmRzIF94ZmFfb2JqZWN0Lk9wdGlvbjAxIHsKICBjb25zdHJ1Y3RvcihhdHRyaWJ1dGVzKSB7CiAgICBzdXBlcihDT05GSUdfTlNfSUQsICJlbmNyeXB0Iik7CiAgfQp9CmNsYXNzIEVuY3J5cHRpb24gZXh0ZW5kcyBfeGZhX29iamVjdC5YRkFPYmplY3QgewogIGNvbnN0cnVjdG9yKGF0dHJpYnV0ZXMpIHsKICAgIHN1cGVyKENPTkZJR19OU19JRCwgImVuY3J5cHRpb24iLCB0cnVlKTsKICAgIHRoaXMuZW5jcnlwdCA9IG51bGw7CiAgICB0aGlzLmVuY3J5cHRpb25MZXZlbCA9IG51bGw7CiAgICB0aGlzLnBlcm1pc3Npb25zID0gbnVsbDsKICB9Cn0KY2xhc3MgRW5jcnlwdGlvbkxldmVsIGV4dGVuZHMgX3hmYV9vYmplY3QuT3B0aW9uT2JqZWN0IHsKICBjb25zdHJ1Y3RvcihhdHRyaWJ1dGVzKSB7CiAgICBzdXBlcihDT05GSUdfTlNfSUQsICJlbmNyeXB0aW9uTGV2ZWwiLCBbIjQwYml0IiwgIjEyOGJpdCJdKTsKICB9Cn0KY2xhc3MgRW5mb3JjZSBleHRlbmRzIF94ZmFfb2JqZWN0LlN0cmluZ09iamVjdCB7CiAgY29uc3RydWN0b3IoYXR0cmlidXRlcykgewogICAgc3VwZXIoQ09ORklHX05TX0lELCAiZW5mb3JjZSIpOwogIH0KfQpjbGFzcyBFcXVhdGUgZXh0ZW5kcyBfeGZhX29iamVjdC5YRkFPYmplY3QgewogIGNvbnN0cnVjdG9yKGF0dHJpYnV0ZXMpIHsKICAgIHN1cGVyKENPTkZJR19OU19JRCwgImVxdWF0ZSIpOwogICAgdGhpcy5mb3JjZSA9ICgwLCBfdXRpbHMuZ2V0SW50ZWdlcikoewogICAgICBkYXRhOiBhdHRyaWJ1dGVzLmZvcmNlLAogICAgICBkZWZhdWx0VmFsdWU6IDEsCiAgICAgIHZhbGlkYXRlOiBuID0+IG4gPT09IDAKICAgIH0pOwogICAgdGhpcy5mcm9tID0gYXR0cmlidXRlcy5mcm9tIHx8ICIiOwogICAgdGhpcy50byA9IGF0dHJpYnV0ZXMudG8gfHwgIiI7CiAgfQp9CmNsYXNzIEVxdWF0ZVJhbmdlIGV4dGVuZHMgX3hmYV9vYmplY3QuWEZBT2JqZWN0IHsKICBjb25zdHJ1Y3RvcihhdHRyaWJ1dGVzKSB7CiAgICBzdXBlcihDT05GSUdfTlNfSUQsICJlcXVhdGVSYW5nZSIpOwogICAgdGhpcy5mcm9tID0gYXR0cmlidXRlcy5mcm9tIHx8ICIiOwogICAgdGhpcy50byA9IGF0dHJpYnV0ZXMudG8gfHwgIiI7CiAgICB0aGlzLl91bmljb2RlUmFuZ2UgPSBhdHRyaWJ1dGVzLnVuaWNvZGVSYW5nZSB8fCAiIjsKICB9CiAgZ2V0IHVuaWNvZGVSYW5nZSgpIHsKICAgIGNvbnN0IHJhbmdlcyA9IFtdOwogICAgY29uc3QgdW5pY29kZVJlZ2V4ID0gL1VcKyhbMC05YS1mQS1GXSspLzsKICAgIGNvbnN0IHVuaWNvZGVSYW5nZSA9IHRoaXMuX3VuaWNvZGVSYW5nZTsKICAgIGZvciAobGV0IHJhbmdlIG9mIHVuaWNvZGVSYW5nZS5zcGxpdCgiLCIpLm1hcCh4ID0+IHgudHJpbSgpKS5maWx0ZXIoeCA9PiAhIXgpKSB7CiAgICAgIHJhbmdlID0gcmFuZ2Uuc3BsaXQoIi0iLCAyKS5tYXAoeCA9PiB7CiAgICAgICAgY29uc3QgZm91bmQgPSB4Lm1hdGNoKHVuaWNvZGVSZWdleCk7CiAgICAgICAgaWYgKCFmb3VuZCkgewogICAgICAgICAgcmV0dXJuIDA7CiAgICAgICAgfQogICAgICAgIHJldHVybiBwYXJzZUludChmb3VuZFsxXSwgMTYpOwogICAgICB9KTsKICAgICAgaWYgKHJhbmdlLmxlbmd0aCA9PT0gMSkgewogICAgICAgIHJhbmdlLnB1c2gocmFuZ2VbMF0pOwogICAgICB9CiAgICAgIHJhbmdlcy5wdXNoKHJhbmdlKTsKICAgIH0KICAgIHJldHVybiAoMCwgX3V0aWwuc2hhZG93KSh0aGlzLCAidW5pY29kZVJhbmdlIiwgcmFuZ2VzKTsKICB9Cn0KY2xhc3MgRXhjbHVkZSBleHRlbmRzIF94ZmFfb2JqZWN0LkNvbnRlbnRPYmplY3QgewogIGNvbnN0cnVjdG9yKGF0dHJpYnV0ZXMpIHsKICAgIHN1cGVyKENPTkZJR19OU19JRCwgImV4Y2x1ZGUiKTsKICB9CiAgW19zeW1ib2xfdXRpbHMuJGZpbmFsaXplXSgpIHsKICAgIHRoaXNbX3N5bWJvbF91dGlscy4kY29udGVudF0gPSB0aGlzW19zeW1ib2xfdXRpbHMuJGNvbnRlbnRdLnRyaW0oKS5zcGxpdCgvXHMrLykuZmlsdGVyKHggPT4geCAmJiBbImNhbGN1bGF0ZSIsICJjbG9zZSIsICJlbnRlciIsICJleGl0IiwgImluaXRpYWxpemUiLCAicmVhZHkiLCAidmFsaWRhdGUiXS5pbmNsdWRlcyh4KSk7CiAgfQp9CmNsYXNzIEV4Y2x1ZGVOUyBleHRlbmRzIF94ZmFfb2JqZWN0LlN0cmluZ09iamVjdCB7CiAgY29uc3RydWN0b3IoYXR0cmlidXRlcykgewogICAgc3VwZXIoQ09ORklHX05TX0lELCAiZXhjbHVkZU5TIik7CiAgfQp9CmNsYXNzIEZsaXBMYWJlbCBleHRlbmRzIF94ZmFfb2JqZWN0Lk9wdGlvbk9iamVjdCB7CiAgY29uc3RydWN0b3IoYXR0cmlidXRlcykgewogICAgc3VwZXIoQ09ORklHX05TX0lELCAiZmxpcExhYmVsIiwgWyJ1c2VQcmludGVyU2V0dGluZyIsICJvbiIsICJvZmYiXSk7CiAgfQp9CmNsYXNzIEZvbnRJbmZvIGV4dGVuZHMgX3hmYV9vYmplY3QuWEZBT2JqZWN0IHsKICBjb25zdHJ1Y3RvcihhdHRyaWJ1dGVzKSB7CiAgICBzdXBlcihDT05GSUdfTlNfSUQsICJmb250SW5mbyIsIHRydWUpOwogICAgdGhpcy5lbWJlZCA9IG51bGw7CiAgICB0aGlzLm1hcCA9IG51bGw7CiAgICB0aGlzLnN1YnNldEJlbG93ID0gbnVsbDsKICAgIHRoaXMuYWx3YXlzRW1iZWQgPSBuZXcgX3hmYV9vYmplY3QuWEZBT2JqZWN0QXJyYXkoKTsKICAgIHRoaXMuZGVmYXVsdFR5cGVmYWNlID0gbmV3IF94ZmFfb2JqZWN0LlhGQU9iamVjdEFycmF5KCk7CiAgICB0aGlzLm5ldmVyRW1iZWQgPSBuZXcgX3hmYV9vYmplY3QuWEZBT2JqZWN0QXJyYXkoKTsKICB9Cn0KY2xhc3MgRm9ybUZpZWxkRmlsbGluZyBleHRlbmRzIF94ZmFfb2JqZWN0Lk9wdGlvbjAxIHsKICBjb25zdHJ1Y3RvcihhdHRyaWJ1dGVzKSB7CiAgICBzdXBlcihDT05GSUdfTlNfSUQsICJmb3JtRmllbGRGaWxsaW5nIik7CiAgfQp9CmNsYXNzIEdyb3VwUGFyZW50IGV4dGVuZHMgX3hmYV9vYmplY3QuU3RyaW5nT2JqZWN0IHsKICBjb25zdHJ1Y3RvcihhdHRyaWJ1dGVzKSB7CiAgICBzdXBlcihDT05GSUdfTlNfSUQsICJncm91cFBhcmVudCIpOwogIH0KfQpjbGFzcyBJZkVtcHR5IGV4dGVuZHMgX3hmYV9vYmplY3QuT3B0aW9uT2JqZWN0IHsKICBjb25zdHJ1Y3RvcihhdHRyaWJ1dGVzKSB7CiAgICBzdXBlcihDT05GSUdfTlNfSUQsICJpZkVtcHR5IiwgWyJkYXRhVmFsdWUiLCAiZGF0YUdyb3VwIiwgImlnbm9yZSIsICJyZW1vdmUiXSk7CiAgfQp9CmNsYXNzIEluY2x1ZGVYRFBDb250ZW50IGV4dGVuZHMgX3hmYV9vYmplY3QuU3RyaW5nT2JqZWN0IHsKICBjb25zdHJ1Y3RvcihhdHRyaWJ1dGVzKSB7CiAgICBzdXBlcihDT05GSUdfTlNfSUQsICJpbmNsdWRlWERQQ29udGVudCIpOwogIH0KfQpjbGFzcyBJbmNyZW1lbnRhbExvYWQgZXh0ZW5kcyBfeGZhX29iamVjdC5PcHRpb25PYmplY3QgewogIGNvbnN0cnVjdG9yKGF0dHJpYnV0ZXMpIHsKICAgIHN1cGVyKENPTkZJR19OU19JRCwgImluY3JlbWVudGFsTG9hZCIsIFsibm9uZSIsICJmb3J3YXJkT25seSJdKTsKICB9Cn0KY2xhc3MgSW5jcmVtZW50YWxNZXJnZSBleHRlbmRzIF94ZmFfb2JqZWN0Lk9wdGlvbjAxIHsKICBjb25zdHJ1Y3RvcihhdHRyaWJ1dGVzKSB7CiAgICBzdXBlcihDT05GSUdfTlNfSUQsICJpbmNyZW1lbnRhbE1lcmdlIik7CiAgfQp9CmNsYXNzIEludGVyYWN0aXZlIGV4dGVuZHMgX3hmYV9vYmplY3QuT3B0aW9uMDEgewogIGNvbnN0cnVjdG9yKGF0dHJpYnV0ZXMpIHsKICAgIHN1cGVyKENPTkZJR19OU19JRCwgImludGVyYWN0aXZlIik7CiAgfQp9CmNsYXNzIEpvZyBleHRlbmRzIF94ZmFfb2JqZWN0Lk9wdGlvbk9iamVjdCB7CiAgY29uc3RydWN0b3IoYXR0cmlidXRlcykgewogICAgc3VwZXIoQ09ORklHX05TX0lELCAiam9nIiwgWyJ1c2VQcmludGVyU2V0dGluZyIsICJub25lIiwgInBhZ2VTZXQiXSk7CiAgfQp9CmNsYXNzIExhYmVsUHJpbnRlciBleHRlbmRzIF94ZmFfb2JqZWN0LlhGQU9iamVjdCB7CiAgY29uc3RydWN0b3IoYXR0cmlidXRlcykgewogICAgc3VwZXIoQ09ORklHX05TX0lELCAibGFiZWxQcmludGVyIiwgdHJ1ZSk7CiAgICB0aGlzLm5hbWUgPSAoMCwgX3V0aWxzLmdldFN0cmluZ09wdGlvbikoYXR0cmlidXRlcy5uYW1lLCBbInpwbCIsICJkcGwiLCAiaXBsIiwgInRjcGwiXSk7CiAgICB0aGlzLmJhdGNoT3V0cHV0ID0gbnVsbDsKICAgIHRoaXMuZmxpcExhYmVsID0gbnVsbDsKICAgIHRoaXMuZm9udEluZm8gPSBudWxsOwogICAgdGhpcy54ZGMgPSBudWxsOwogIH0KfQpjbGFzcyBMYXlvdXQgZXh0ZW5kcyBfeGZhX29iamVjdC5PcHRpb25PYmplY3QgewogIGNvbnN0cnVjdG9yKGF0dHJpYnV0ZXMpIHsKICAgIHN1cGVyKENPTkZJR19OU19JRCwgImxheW91dCIsIFsicGFnaW5hdGUiLCAicGFuZWwiXSk7CiAgfQp9CmNsYXNzIExldmVsIGV4dGVuZHMgX3hmYV9vYmplY3QuSW50ZWdlck9iamVjdCB7CiAgY29uc3RydWN0b3IoYXR0cmlidXRlcykgewogICAgc3VwZXIoQ09ORklHX05TX0lELCAibGV2ZWwiLCAwLCBuID0+IG4gPiAwKTsKICB9Cn0KY2xhc3MgTGluZWFyaXplZCBleHRlbmRzIF94ZmFfb2JqZWN0Lk9wdGlvbjAxIHsKICBjb25zdHJ1Y3RvcihhdHRyaWJ1dGVzKSB7CiAgICBzdXBlcihDT05GSUdfTlNfSUQsICJsaW5lYXJpemVkIik7CiAgfQp9CmNsYXNzIExvY2FsZSBleHRlbmRzIF94ZmFfb2JqZWN0LlN0cmluZ09iamVjdCB7CiAgY29uc3RydWN0b3IoYXR0cmlidXRlcykgewogICAgc3VwZXIoQ09ORklHX05TX0lELCAibG9jYWxlIik7CiAgfQp9CmNsYXNzIExvY2FsZVNldCBleHRlbmRzIF94ZmFfb2JqZWN0LlN0cmluZ09iamVjdCB7CiAgY29uc3RydWN0b3IoYXR0cmlidXRlcykgewogICAgc3VwZXIoQ09ORklHX05TX0lELCAibG9jYWxlU2V0Iik7CiAgfQp9CmNsYXNzIExvZyBleHRlbmRzIF94ZmFfb2JqZWN0LlhGQU9iamVjdCB7CiAgY29uc3RydWN0b3IoYXR0cmlidXRlcykgewogICAgc3VwZXIoQ09ORklHX05TX0lELCAibG9nIiwgdHJ1ZSk7CiAgICB0aGlzLm1vZGUgPSBudWxsOwogICAgdGhpcy50aHJlc2hvbGQgPSBudWxsOwogICAgdGhpcy50byA9IG51bGw7CiAgICB0aGlzLnVyaSA9IG51bGw7CiAgfQp9CmNsYXNzIE1hcEVsZW1lbnQgZXh0ZW5kcyBfeGZhX29iamVjdC5YRkFPYmplY3QgewogIGNvbnN0cnVjdG9yKGF0dHJpYnV0ZXMpIHsKICAgIHN1cGVyKENPTkZJR19OU19JRCwgIm1hcCIsIHRydWUpOwogICAgdGhpcy5lcXVhdGUgPSBuZXcgX3hmYV9vYmplY3QuWEZBT2JqZWN0QXJyYXkoKTsKICAgIHRoaXMuZXF1YXRlUmFuZ2UgPSBuZXcgX3hmYV9vYmplY3QuWEZBT2JqZWN0QXJyYXkoKTsKICB9Cn0KY2xhc3MgTWVkaXVtSW5mbyBleHRlbmRzIF94ZmFfb2JqZWN0LlhGQU9iamVjdCB7CiAgY29uc3RydWN0b3IoYXR0cmlidXRlcykgewogICAgc3VwZXIoQ09ORklHX05TX0lELCAibWVkaXVtSW5mbyIsIHRydWUpOwogICAgdGhpcy5tYXAgPSBudWxsOwogIH0KfQpjbGFzcyBNZXNzYWdlIGV4dGVuZHMgX3hmYV9vYmplY3QuWEZBT2JqZWN0IHsKICBjb25zdHJ1Y3RvcihhdHRyaWJ1dGVzKSB7CiAgICBzdXBlcihDT05GSUdfTlNfSUQsICJtZXNzYWdlIiwgdHJ1ZSk7CiAgICB0aGlzLm1zZ0lkID0gbnVsbDsKICAgIHRoaXMuc2V2ZXJpdHkgPSBudWxsOwogIH0KfQpjbGFzcyBNZXNzYWdpbmcgZXh0ZW5kcyBfeGZhX29iamVjdC5YRkFPYmplY3QgewogIGNvbnN0cnVjdG9yKGF0dHJpYnV0ZXMpIHsKICAgIHN1cGVyKENPTkZJR19OU19JRCwgIm1lc3NhZ2luZyIsIHRydWUpOwogICAgdGhpcy5tZXNzYWdlID0gbmV3IF94ZmFfb2JqZWN0LlhGQU9iamVjdEFycmF5KCk7CiAgfQp9CmNsYXNzIE1vZGUgZXh0ZW5kcyBfeGZhX29iamVjdC5PcHRpb25PYmplY3QgewogIGNvbnN0cnVjdG9yKGF0dHJpYnV0ZXMpIHsKICAgIHN1cGVyKENPTkZJR19OU19JRCwgIm1vZGUiLCBbImFwcGVuZCIsICJvdmVyd3JpdGUiXSk7CiAgfQp9CmNsYXNzIE1vZGlmeUFubm90cyBleHRlbmRzIF94ZmFfb2JqZWN0Lk9wdGlvbjAxIHsKICBjb25zdHJ1Y3RvcihhdHRyaWJ1dGVzKSB7CiAgICBzdXBlcihDT05GSUdfTlNfSUQsICJtb2RpZnlBbm5vdHMiKTsKICB9Cn0KY2xhc3MgTXNnSWQgZXh0ZW5kcyBfeGZhX29iamVjdC5JbnRlZ2VyT2JqZWN0IHsKICBjb25zdHJ1Y3RvcihhdHRyaWJ1dGVzKSB7CiAgICBzdXBlcihDT05GSUdfTlNfSUQsICJtc2dJZCIsIDEsIG4gPT4gbiA+PSAxKTsKICB9Cn0KY2xhc3MgTmFtZUF0dHIgZXh0ZW5kcyBfeGZhX29iamVjdC5TdHJpbmdPYmplY3QgewogIGNvbnN0cnVjdG9yKGF0dHJpYnV0ZXMpIHsKICAgIHN1cGVyKENPTkZJR19OU19JRCwgIm5hbWVBdHRyIik7CiAgfQp9CmNsYXNzIE5ldmVyRW1iZWQgZXh0ZW5kcyBfeGZhX29iamVjdC5Db250ZW50T2JqZWN0IHsKICBjb25zdHJ1Y3RvcihhdHRyaWJ1dGVzKSB7CiAgICBzdXBlcihDT05GSUdfTlNfSUQsICJuZXZlckVtYmVkIik7CiAgfQp9CmNsYXNzIE51bWJlck9mQ29waWVzIGV4dGVuZHMgX3hmYV9vYmplY3QuSW50ZWdlck9iamVjdCB7CiAgY29uc3RydWN0b3IoYXR0cmlidXRlcykgewogICAgc3VwZXIoQ09ORklHX05TX0lELCAibnVtYmVyT2ZDb3BpZXMiLCBudWxsLCBuID0+IG4gPj0gMiAmJiBuIDw9IDUpOwogIH0KfQpjbGFzcyBPcGVuQWN0aW9uIGV4dGVuZHMgX3hmYV9vYmplY3QuWEZBT2JqZWN0IHsKICBjb25zdHJ1Y3RvcihhdHRyaWJ1dGVzKSB7CiAgICBzdXBlcihDT05GSUdfTlNfSUQsICJvcGVuQWN0aW9uIiwgdHJ1ZSk7CiAgICB0aGlzLmRlc3RpbmF0aW9uID0gbnVsbDsKICB9Cn0KY2xhc3MgT3V0cHV0IGV4dGVuZHMgX3hmYV9vYmplY3QuWEZBT2JqZWN0IHsKICBjb25zdHJ1Y3RvcihhdHRyaWJ1dGVzKSB7CiAgICBzdXBlcihDT05GSUdfTlNfSUQsICJvdXRwdXQiLCB0cnVlKTsKICAgIHRoaXMudG8gPSBudWxsOwogICAgdGhpcy50eXBlID0gbnVsbDsKICAgIHRoaXMudXJpID0gbnVsbDsKICB9Cn0KY2xhc3MgT3V0cHV0QmluIGV4dGVuZHMgX3hmYV9vYmplY3QuU3RyaW5nT2JqZWN0IHsKICBjb25zdHJ1Y3RvcihhdHRyaWJ1dGVzKSB7CiAgICBzdXBlcihDT05GSUdfTlNfSUQsICJvdXRwdXRCaW4iKTsKICB9Cn0KY2xhc3MgT3V0cHV0WFNMIGV4dGVuZHMgX3hmYV9vYmplY3QuWEZBT2JqZWN0IHsKICBjb25zdHJ1Y3RvcihhdHRyaWJ1dGVzKSB7CiAgICBzdXBlcihDT05GSUdfTlNfSUQsICJvdXRwdXRYU0wiLCB0cnVlKTsKICAgIHRoaXMudXJpID0gbnVsbDsKICB9Cn0KY2xhc3MgT3ZlcnByaW50IGV4dGVuZHMgX3hmYV9vYmplY3QuT3B0aW9uT2JqZWN0IHsKICBjb25zdHJ1Y3RvcihhdHRyaWJ1dGVzKSB7CiAgICBzdXBlcihDT05GSUdfTlNfSUQsICJvdmVycHJpbnQiLCBbIm5vbmUiLCAiYm90aCIsICJkcmF3IiwgImZpZWxkIl0pOwogIH0KfQpjbGFzcyBQYWNrZXRzIGV4dGVuZHMgX3hmYV9vYmplY3QuU3RyaW5nT2JqZWN0IHsKICBjb25zdHJ1Y3RvcihhdHRyaWJ1dGVzKSB7CiAgICBzdXBlcihDT05GSUdfTlNfSUQsICJwYWNrZXRzIik7CiAgfQogIFtfc3ltYm9sX3V0aWxzLiRmaW5hbGl6ZV0oKSB7CiAgICBpZiAodGhpc1tfc3ltYm9sX3V0aWxzLiRjb250ZW50XSA9PT0gIioiKSB7CiAgICAgIHJldHVybjsKICAgIH0KICAgIHRoaXNbX3N5bWJvbF91dGlscy4kY29udGVudF0gPSB0aGlzW19zeW1ib2xfdXRpbHMuJGNvbnRlbnRdLnRyaW0oKS5zcGxpdCgvXHMrLykuZmlsdGVyKHggPT4gWyJjb25maWciLCAiZGF0YXNldHMiLCAidGVtcGxhdGUiLCAieGZkZiIsICJ4c2x0Il0uaW5jbHVkZXMoeCkpOwogIH0KfQpjbGFzcyBQYWdlT2Zmc2V0IGV4dGVuZHMgX3hmYV9vYmplY3QuWEZBT2JqZWN0IHsKICBjb25zdHJ1Y3RvcihhdHRyaWJ1dGVzKSB7CiAgICBzdXBlcihDT05GSUdfTlNfSUQsICJwYWdlT2Zmc2V0Iik7CiAgICB0aGlzLnggPSAoMCwgX3V0aWxzLmdldEludGVnZXIpKHsKICAgICAgZGF0YTogYXR0cmlidXRlcy54LAogICAgICBkZWZhdWx0VmFsdWU6ICJ1c2VYRENTZXR0aW5nIiwKICAgICAgdmFsaWRhdGU6IG4gPT4gdHJ1ZQogICAgfSk7CiAgICB0aGlzLnkgPSAoMCwgX3V0aWxzLmdldEludGVnZXIpKHsKICAgICAgZGF0YTogYXR0cmlidXRlcy55LAogICAgICBkZWZhdWx0VmFsdWU6ICJ1c2VYRENTZXR0aW5nIiwKICAgICAgdmFsaWRhdGU6IG4gPT4gdHJ1ZQogICAgfSk7CiAgfQp9CmNsYXNzIFBhZ2VSYW5nZSBleHRlbmRzIF94ZmFfb2JqZWN0LlN0cmluZ09iamVjdCB7CiAgY29uc3RydWN0b3IoYXR0cmlidXRlcykgewogICAgc3VwZXIoQ09ORklHX05TX0lELCAicGFnZVJhbmdlIik7CiAgfQogIFtfc3ltYm9sX3V0aWxzLiRmaW5hbGl6ZV0oKSB7CiAgICBjb25zdCBudW1iZXJzID0gdGhpc1tfc3ltYm9sX3V0aWxzLiRjb250ZW50XS50cmltKCkuc3BsaXQoL1xzKy8pLm1hcCh4ID0+IHBhcnNlSW50KHgsIDEwKSk7CiAgICBjb25zdCByYW5nZXMgPSBbXTsKICAgIGZvciAobGV0IGkgPSAwLCBpaSA9IG51bWJlcnMubGVuZ3RoOyBpIDwgaWk7IGkgKz0gMikgewogICAgICByYW5nZXMucHVzaChudW1iZXJzLnNsaWNlKGksIGkgKyAyKSk7CiAgICB9CiAgICB0aGlzW19zeW1ib2xfdXRpbHMuJGNvbnRlbnRdID0gcmFuZ2VzOwogIH0KfQpjbGFzcyBQYWdpbmF0aW9uIGV4dGVuZHMgX3hmYV9vYmplY3QuT3B0aW9uT2JqZWN0IHsKICBjb25zdHJ1Y3RvcihhdHRyaWJ1dGVzKSB7CiAgICBzdXBlcihDT05GSUdfTlNfSUQsICJwYWdpbmF0aW9uIiwgWyJzaW1wbGV4IiwgImR1cGxleFNob3J0RWRnZSIsICJkdXBsZXhMb25nRWRnZSJdKTsKICB9Cn0KY2xhc3MgUGFnaW5hdGlvbk92ZXJyaWRlIGV4dGVuZHMgX3hmYV9vYmplY3QuT3B0aW9uT2JqZWN0IHsKICBjb25zdHJ1Y3RvcihhdHRyaWJ1dGVzKSB7CiAgICBzdXBlcihDT05GSUdfTlNfSUQsICJwYWdpbmF0aW9uT3ZlcnJpZGUiLCBbIm5vbmUiLCAiZm9yY2VEdXBsZXgiLCAiZm9yY2VEdXBsZXhMb25nRWRnZSIsICJmb3JjZUR1cGxleFNob3J0RWRnZSIsICJmb3JjZVNpbXBsZXgiXSk7CiAgfQp9CmNsYXNzIFBhcnQgZXh0ZW5kcyBfeGZhX29iamVjdC5JbnRlZ2VyT2JqZWN0IHsKICBjb25zdHJ1Y3RvcihhdHRyaWJ1dGVzKSB7CiAgICBzdXBlcihDT05GSUdfTlNfSUQsICJwYXJ0IiwgMSwgbiA9PiBmYWxzZSk7CiAgfQp9CmNsYXNzIFBjbCBleHRlbmRzIF94ZmFfb2JqZWN0LlhGQU9iamVjdCB7CiAgY29uc3RydWN0b3IoYXR0cmlidXRlcykgewogICAgc3VwZXIoQ09ORklHX05TX0lELCAicGNsIiwgdHJ1ZSk7CiAgICB0aGlzLm5hbWUgPSBhdHRyaWJ1dGVzLm5hbWUgfHwgIiI7CiAgICB0aGlzLmJhdGNoT3V0cHV0ID0gbnVsbDsKICAgIHRoaXMuZm9udEluZm8gPSBudWxsOwogICAgdGhpcy5qb2cgPSBudWxsOwogICAgdGhpcy5tZWRpdW1JbmZvID0gbnVsbDsKICAgIHRoaXMub3V0cHV0QmluID0gbnVsbDsKICAgIHRoaXMucGFnZU9mZnNldCA9IG51bGw7CiAgICB0aGlzLnN0YXBsZSA9IG51bGw7CiAgICB0aGlzLnhkYyA9IG51bGw7CiAgfQp9CmNsYXNzIFBkZiBleHRlbmRzIF94ZmFfb2JqZWN0LlhGQU9iamVjdCB7CiAgY29uc3RydWN0b3IoYXR0cmlidXRlcykgewogICAgc3VwZXIoQ09ORklHX05TX0lELCAicGRmIiwgdHJ1ZSk7CiAgICB0aGlzLm5hbWUgPSBhdHRyaWJ1dGVzLm5hbWUgfHwgIiI7CiAgICB0aGlzLmFkb2JlRXh0ZW5zaW9uTGV2ZWwgPSBudWxsOwogICAgdGhpcy5iYXRjaE91dHB1dCA9IG51bGw7CiAgICB0aGlzLmNvbXByZXNzaW9uID0gbnVsbDsKICAgIHRoaXMuY3JlYXRvciA9IG51bGw7CiAgICB0aGlzLmVuY3J5cHRpb24gPSBudWxsOwogICAgdGhpcy5mb250SW5mbyA9IG51bGw7CiAgICB0aGlzLmludGVyYWN0aXZlID0gbnVsbDsKICAgIHRoaXMubGluZWFyaXplZCA9IG51bGw7CiAgICB0aGlzLm9wZW5BY3Rpb24gPSBudWxsOwogICAgdGhpcy5wZGZhID0gbnVsbDsKICAgIHRoaXMucHJvZHVjZXIgPSBudWxsOwogICAgdGhpcy5yZW5kZXJQb2xpY3kgPSBudWxsOwogICAgdGhpcy5zY3JpcHRNb2RlbCA9IG51bGw7CiAgICB0aGlzLnNpbGVudFByaW50ID0gbnVsbDsKICAgIHRoaXMuc3VibWl0Rm9ybWF0ID0gbnVsbDsKICAgIHRoaXMudGFnZ2VkID0gbnVsbDsKICAgIHRoaXMudmVyc2lvbiA9IG51bGw7CiAgICB0aGlzLnZpZXdlclByZWZlcmVuY2VzID0gbnVsbDsKICAgIHRoaXMueGRjID0gbnVsbDsKICB9Cn0KY2xhc3MgUGRmYSBleHRlbmRzIF94ZmFfb2JqZWN0LlhGQU9iamVjdCB7CiAgY29uc3RydWN0b3IoYXR0cmlidXRlcykgewogICAgc3VwZXIoQ09ORklHX05TX0lELCAicGRmYSIsIHRydWUpOwogICAgdGhpcy5hbWQgPSBudWxsOwogICAgdGhpcy5jb25mb3JtYW5jZSA9IG51bGw7CiAgICB0aGlzLmluY2x1ZGVYRFBDb250ZW50ID0gbnVsbDsKICAgIHRoaXMucGFydCA9IG51bGw7CiAgfQp9CmNsYXNzIFBlcm1pc3Npb25zIGV4dGVuZHMgX3hmYV9vYmplY3QuWEZBT2JqZWN0IHsKICBjb25zdHJ1Y3RvcihhdHRyaWJ1dGVzKSB7CiAgICBzdXBlcihDT05GSUdfTlNfSUQsICJwZXJtaXNzaW9ucyIsIHRydWUpOwogICAgdGhpcy5hY2Nlc3NpYmxlQ29udGVudCA9IG51bGw7CiAgICB0aGlzLmNoYW5nZSA9IG51bGw7CiAgICB0aGlzLmNvbnRlbnRDb3B5ID0gbnVsbDsKICAgIHRoaXMuZG9jdW1lbnRBc3NlbWJseSA9IG51bGw7CiAgICB0aGlzLmZvcm1GaWVsZEZpbGxpbmcgPSBudWxsOwogICAgdGhpcy5tb2RpZnlBbm5vdHMgPSBudWxsOwogICAgdGhpcy5wbGFpbnRleHRNZXRhZGF0YSA9IG51bGw7CiAgICB0aGlzLnByaW50ID0gbnVsbDsKICAgIHRoaXMucHJpbnRIaWdoUXVhbGl0eSA9IG51bGw7CiAgfQp9CmNsYXNzIFBpY2tUcmF5QnlQREZTaXplIGV4dGVuZHMgX3hmYV9vYmplY3QuT3B0aW9uMDEgewogIGNvbnN0cnVjdG9yKGF0dHJpYnV0ZXMpIHsKICAgIHN1cGVyKENPTkZJR19OU19JRCwgInBpY2tUcmF5QnlQREZTaXplIik7CiAgfQp9CmNsYXNzIFBpY3R1cmUgZXh0ZW5kcyBfeGZhX29iamVjdC5TdHJpbmdPYmplY3QgewogIGNvbnN0cnVjdG9yKGF0dHJpYnV0ZXMpIHsKICAgIHN1cGVyKENPTkZJR19OU19JRCwgInBpY3R1cmUiKTsKICB9Cn0KY2xhc3MgUGxhaW50ZXh0TWV0YWRhdGEgZXh0ZW5kcyBfeGZhX29iamVjdC5PcHRpb24wMSB7CiAgY29uc3RydWN0b3IoYXR0cmlidXRlcykgewogICAgc3VwZXIoQ09ORklHX05TX0lELCAicGxhaW50ZXh0TWV0YWRhdGEiKTsKICB9Cn0KY2xhc3MgUHJlc2VuY2UgZXh0ZW5kcyBfeGZhX29iamVjdC5PcHRpb25PYmplY3QgewogIGNvbnN0cnVjdG9yKGF0dHJpYnV0ZXMpIHsKICAgIHN1cGVyKENPTkZJR19OU19JRCwgInByZXNlbmNlIiwgWyJwcmVzZXJ2ZSIsICJkaXNzb2x2ZSIsICJkaXNzb2x2ZVN0cnVjdHVyZSIsICJpZ25vcmUiLCAicmVtb3ZlIl0pOwogIH0KfQpjbGFzcyBQcmVzZW50IGV4dGVuZHMgX3hmYV9vYmplY3QuWEZBT2JqZWN0IHsKICBjb25zdHJ1Y3RvcihhdHRyaWJ1dGVzKSB7CiAgICBzdXBlcihDT05GSUdfTlNfSUQsICJwcmVzZW50IiwgdHJ1ZSk7CiAgICB0aGlzLmJlaGF2aW9yT3ZlcnJpZGUgPSBudWxsOwogICAgdGhpcy5jYWNoZSA9IG51bGw7CiAgICB0aGlzLmNvbW1vbiA9IG51bGw7CiAgICB0aGlzLmNvcGllcyA9IG51bGw7CiAgICB0aGlzLmRlc3RpbmF0aW9uID0gbnVsbDsKICAgIHRoaXMuaW5jcmVtZW50YWxNZXJnZSA9IG51bGw7CiAgICB0aGlzLmxheW91dCA9IG51bGw7CiAgICB0aGlzLm91dHB1dCA9IG51bGw7CiAgICB0aGlzLm92ZXJwcmludCA9IG51bGw7CiAgICB0aGlzLnBhZ2luYXRpb24gPSBudWxsOwogICAgdGhpcy5wYWdpbmF0aW9uT3ZlcnJpZGUgPSBudWxsOwogICAgdGhpcy5zY3JpcHQgPSBudWxsOwogICAgdGhpcy52YWxpZGF0ZSA9IG51bGw7CiAgICB0aGlzLnhkcCA9IG51bGw7CiAgICB0aGlzLmRyaXZlciA9IG5ldyBfeGZhX29iamVjdC5YRkFPYmplY3RBcnJheSgpOwogICAgdGhpcy5sYWJlbFByaW50ZXIgPSBuZXcgX3hmYV9vYmplY3QuWEZBT2JqZWN0QXJyYXkoKTsKICAgIHRoaXMucGNsID0gbmV3IF94ZmFfb2JqZWN0LlhGQU9iamVjdEFycmF5KCk7CiAgICB0aGlzLnBkZiA9IG5ldyBfeGZhX29iamVjdC5YRkFPYmplY3RBcnJheSgpOwogICAgdGhpcy5wcyA9IG5ldyBfeGZhX29iamVjdC5YRkFPYmplY3RBcnJheSgpOwogICAgdGhpcy5zdWJtaXRVcmwgPSBuZXcgX3hmYV9vYmplY3QuWEZBT2JqZWN0QXJyYXkoKTsKICAgIHRoaXMud2ViQ2xpZW50ID0gbmV3IF94ZmFfb2JqZWN0LlhGQU9iamVjdEFycmF5KCk7CiAgICB0aGlzLnpwbCA9IG5ldyBfeGZhX29iamVjdC5YRkFPYmplY3RBcnJheSgpOwogIH0KfQpjbGFzcyBQcmludCBleHRlbmRzIF94ZmFfb2JqZWN0Lk9wdGlvbjAxIHsKICBjb25zdHJ1Y3RvcihhdHRyaWJ1dGVzKSB7CiAgICBzdXBlcihDT05GSUdfTlNfSUQsICJwcmludCIpOwogIH0KfQpjbGFzcyBQcmludEhpZ2hRdWFsaXR5IGV4dGVuZHMgX3hmYV9vYmplY3QuT3B0aW9uMDEgewogIGNvbnN0cnVjdG9yKGF0dHJpYnV0ZXMpIHsKICAgIHN1cGVyKENPTkZJR19OU19JRCwgInByaW50SGlnaFF1YWxpdHkiKTsKICB9Cn0KY2xhc3MgUHJpbnRTY2FsaW5nIGV4dGVuZHMgX3hmYV9vYmplY3QuT3B0aW9uT2JqZWN0IHsKICBjb25zdHJ1Y3RvcihhdHRyaWJ1dGVzKSB7CiAgICBzdXBlcihDT05GSUdfTlNfSUQsICJwcmludFNjYWxpbmciLCBbImFwcGRlZmF1bHQiLCAibm9TY2FsaW5nIl0pOwogIH0KfQpjbGFzcyBQcmludGVyTmFtZSBleHRlbmRzIF94ZmFfb2JqZWN0LlN0cmluZ09iamVjdCB7CiAgY29uc3RydWN0b3IoYXR0cmlidXRlcykgewogICAgc3VwZXIoQ09ORklHX05TX0lELCAicHJpbnRlck5hbWUiKTsKICB9Cn0KY2xhc3MgUHJvZHVjZXIgZXh0ZW5kcyBfeGZhX29iamVjdC5TdHJpbmdPYmplY3QgewogIGNvbnN0cnVjdG9yKGF0dHJpYnV0ZXMpIHsKICAgIHN1cGVyKENPTkZJR19OU19JRCwgInByb2R1Y2VyIik7CiAgfQp9CmNsYXNzIFBzIGV4dGVuZHMgX3hmYV9vYmplY3QuWEZBT2JqZWN0IHsKICBjb25zdHJ1Y3RvcihhdHRyaWJ1dGVzKSB7CiAgICBzdXBlcihDT05GSUdfTlNfSUQsICJwcyIsIHRydWUpOwogICAgdGhpcy5uYW1lID0gYXR0cmlidXRlcy5uYW1lIHx8ICIiOwogICAgdGhpcy5iYXRjaE91dHB1dCA9IG51bGw7CiAgICB0aGlzLmZvbnRJbmZvID0gbnVsbDsKICAgIHRoaXMuam9nID0gbnVsbDsKICAgIHRoaXMubWVkaXVtSW5mbyA9IG51bGw7CiAgICB0aGlzLm91dHB1dEJpbiA9IG51bGw7CiAgICB0aGlzLnN0YXBsZSA9IG51bGw7CiAgICB0aGlzLnhkYyA9IG51bGw7CiAgfQp9CmNsYXNzIFJhbmdlIGV4dGVuZHMgX3hmYV9vYmplY3QuQ29udGVudE9iamVjdCB7CiAgY29uc3RydWN0b3IoYXR0cmlidXRlcykgewogICAgc3VwZXIoQ09ORklHX05TX0lELCAicmFuZ2UiKTsKICB9CiAgW19zeW1ib2xfdXRpbHMuJGZpbmFsaXplXSgpIHsKICAgIHRoaXNbX3N5bWJvbF91dGlscy4kY29udGVudF0gPSB0aGlzW19zeW1ib2xfdXRpbHMuJGNvbnRlbnRdLnRyaW0oKS5zcGxpdCgvXHMqLFxzKi8sIDIpLm1hcChyYW5nZSA9PiByYW5nZS5zcGxpdCgiLSIpLm1hcCh4ID0+IHBhcnNlSW50KHgudHJpbSgpLCAxMCkpKS5maWx0ZXIocmFuZ2UgPT4gcmFuZ2UuZXZlcnkoeCA9PiAhaXNOYU4oeCkpKS5tYXAocmFuZ2UgPT4gewogICAgICBpZiAocmFuZ2UubGVuZ3RoID09PSAxKSB7CiAgICAgICAgcmFuZ2UucHVzaChyYW5nZVswXSk7CiAgICAgIH0KICAgICAgcmV0dXJuIHJhbmdlOwogICAgfSk7CiAgfQp9CmNsYXNzIFJlY29yZCBleHRlbmRzIF94ZmFfb2JqZWN0LkNvbnRlbnRPYmplY3QgewogIGNvbnN0cnVjdG9yKGF0dHJpYnV0ZXMpIHsKICAgIHN1cGVyKENPTkZJR19OU19JRCwgInJlY29yZCIpOwogIH0KICBbX3N5bWJvbF91dGlscy4kZmluYWxpemVdKCkgewogICAgdGhpc1tfc3ltYm9sX3V0aWxzLiRjb250ZW50XSA9IHRoaXNbX3N5bWJvbF91dGlscy4kY29udGVudF0udHJpbSgpOwogICAgY29uc3QgbiA9IHBhcnNlSW50KHRoaXNbX3N5bWJvbF91dGlscy4kY29udGVudF0sIDEwKTsKICAgIGlmICghaXNOYU4obikgJiYgbiA+PSAwKSB7CiAgICAgIHRoaXNbX3N5bWJvbF91dGlscy4kY29udGVudF0gPSBuOwogICAgfQogIH0KfQpjbGFzcyBSZWxldmFudCBleHRlbmRzIF94ZmFfb2JqZWN0LkNvbnRlbnRPYmplY3QgewogIGNvbnN0cnVjdG9yKGF0dHJpYnV0ZXMpIHsKICAgIHN1cGVyKENPTkZJR19OU19JRCwgInJlbGV2YW50Iik7CiAgfQogIFtfc3ltYm9sX3V0aWxzLiRmaW5hbGl6ZV0oKSB7CiAgICB0aGlzW19zeW1ib2xfdXRpbHMuJGNvbnRlbnRdID0gdGhpc1tfc3ltYm9sX3V0aWxzLiRjb250ZW50XS50cmltKCkuc3BsaXQoL1xzKy8pOwogIH0KfQpjbGFzcyBSZW5hbWUgZXh0ZW5kcyBfeGZhX29iamVjdC5Db250ZW50T2JqZWN0IHsKICBjb25zdHJ1Y3RvcihhdHRyaWJ1dGVzKSB7CiAgICBzdXBlcihDT05GSUdfTlNfSUQsICJyZW5hbWUiKTsKICB9CiAgW19zeW1ib2xfdXRpbHMuJGZpbmFsaXplXSgpIHsKICAgIHRoaXNbX3N5bWJvbF91dGlscy4kY29udGVudF0gPSB0aGlzW19zeW1ib2xfdXRpbHMuJGNvbnRlbnRdLnRyaW0oKTsKICAgIGlmICh0aGlzW19zeW1ib2xfdXRpbHMuJGNvbnRlbnRdLnRvTG93ZXJDYXNlKCkuc3RhcnRzV2l0aCgieG1sIikgfHwgbmV3IFJlZ0V4cCgiW1xccHtMfV9dW1xccHtMfVxcZC5fXFxwe019LV0qIiwgInUiKS50ZXN0KHRoaXNbX3N5bWJvbF91dGlscy4kY29udGVudF0pKSB7CiAgICAgICgwLCBfdXRpbC53YXJuKSgiWEZBIC0gUmVuYW1lOiBpbnZhbGlkIFhGQSBuYW1lIik7CiAgICB9CiAgfQp9CmNsYXNzIFJlbmRlclBvbGljeSBleHRlbmRzIF94ZmFfb2JqZWN0Lk9wdGlvbk9iamVjdCB7CiAgY29uc3RydWN0b3IoYXR0cmlidXRlcykgewogICAgc3VwZXIoQ09ORklHX05TX0lELCAicmVuZGVyUG9saWN5IiwgWyJzZXJ2ZXIiLCAiY2xpZW50Il0pOwogIH0KfQpjbGFzcyBSdW5TY3JpcHRzIGV4dGVuZHMgX3hmYV9vYmplY3QuT3B0aW9uT2JqZWN0IHsKICBjb25zdHJ1Y3RvcihhdHRyaWJ1dGVzKSB7CiAgICBzdXBlcihDT05GSUdfTlNfSUQsICJydW5TY3JpcHRzIiwgWyJib3RoIiwgImNsaWVudCIsICJub25lIiwgInNlcnZlciJdKTsKICB9Cn0KY2xhc3MgU2NyaXB0IGV4dGVuZHMgX3hmYV9vYmplY3QuWEZBT2JqZWN0IHsKICBjb25zdHJ1Y3RvcihhdHRyaWJ1dGVzKSB7CiAgICBzdXBlcihDT05GSUdfTlNfSUQsICJzY3JpcHQiLCB0cnVlKTsKICAgIHRoaXMuY3VycmVudFBhZ2UgPSBudWxsOwogICAgdGhpcy5leGNsdWRlID0gbnVsbDsKICAgIHRoaXMucnVuU2NyaXB0cyA9IG51bGw7CiAgfQp9CmNsYXNzIFNjcmlwdE1vZGVsIGV4dGVuZHMgX3hmYV9vYmplY3QuT3B0aW9uT2JqZWN0IHsKICBjb25zdHJ1Y3RvcihhdHRyaWJ1dGVzKSB7CiAgICBzdXBlcihDT05GSUdfTlNfSUQsICJzY3JpcHRNb2RlbCIsIFsiWEZBIiwgIm5vbmUiXSk7CiAgfQp9CmNsYXNzIFNldmVyaXR5IGV4dGVuZHMgX3hmYV9vYmplY3QuT3B0aW9uT2JqZWN0IHsKICBjb25zdHJ1Y3RvcihhdHRyaWJ1dGVzKSB7CiAgICBzdXBlcihDT05GSUdfTlNfSUQsICJzZXZlcml0eSIsIFsiaWdub3JlIiwgImVycm9yIiwgImluZm9ybWF0aW9uIiwgInRyYWNlIiwgIndhcm5pbmciXSk7CiAgfQp9CmNsYXNzIFNpbGVudFByaW50IGV4dGVuZHMgX3hmYV9vYmplY3QuWEZBT2JqZWN0IHsKICBjb25zdHJ1Y3RvcihhdHRyaWJ1dGVzKSB7CiAgICBzdXBlcihDT05GSUdfTlNfSUQsICJzaWxlbnRQcmludCIsIHRydWUpOwogICAgdGhpcy5hZGRTaWxlbnRQcmludCA9IG51bGw7CiAgICB0aGlzLnByaW50ZXJOYW1lID0gbnVsbDsKICB9Cn0KY2xhc3MgU3RhcGxlIGV4dGVuZHMgX3hmYV9vYmplY3QuWEZBT2JqZWN0IHsKICBjb25zdHJ1Y3RvcihhdHRyaWJ1dGVzKSB7CiAgICBzdXBlcihDT05GSUdfTlNfSUQsICJzdGFwbGUiKTsKICAgIHRoaXMubW9kZSA9ICgwLCBfdXRpbHMuZ2V0U3RyaW5nT3B0aW9uKShhdHRyaWJ1dGVzLm1vZGUsIFsidXNlUHJpbnRlclNldHRpbmciLCAib24iLCAib2ZmIl0pOwogIH0KfQpjbGFzcyBTdGFydE5vZGUgZXh0ZW5kcyBfeGZhX29iamVjdC5TdHJpbmdPYmplY3QgewogIGNvbnN0cnVjdG9yKGF0dHJpYnV0ZXMpIHsKICAgIHN1cGVyKENPTkZJR19OU19JRCwgInN0YXJ0Tm9kZSIpOwogIH0KfQpjbGFzcyBTdGFydFBhZ2UgZXh0ZW5kcyBfeGZhX29iamVjdC5JbnRlZ2VyT2JqZWN0IHsKICBjb25zdHJ1Y3RvcihhdHRyaWJ1dGVzKSB7CiAgICBzdXBlcihDT05GSUdfTlNfSUQsICJzdGFydFBhZ2UiLCAwLCBuID0+IHRydWUpOwogIH0KfQpjbGFzcyBTdWJtaXRGb3JtYXQgZXh0ZW5kcyBfeGZhX29iamVjdC5PcHRpb25PYmplY3QgewogIGNvbnN0cnVjdG9yKGF0dHJpYnV0ZXMpIHsKICAgIHN1cGVyKENPTkZJR19OU19JRCwgInN1Ym1pdEZvcm1hdCIsIFsiaHRtbCIsICJkZWxlZ2F0ZSIsICJmZGYiLCAieG1sIiwgInBkZiJdKTsKICB9Cn0KY2xhc3MgU3VibWl0VXJsIGV4dGVuZHMgX3hmYV9vYmplY3QuU3RyaW5nT2JqZWN0IHsKICBjb25zdHJ1Y3RvcihhdHRyaWJ1dGVzKSB7CiAgICBzdXBlcihDT05GSUdfTlNfSUQsICJzdWJtaXRVcmwiKTsKICB9Cn0KY2xhc3MgU3Vic2V0QmVsb3cgZXh0ZW5kcyBfeGZhX29iamVjdC5JbnRlZ2VyT2JqZWN0IHsKICBjb25zdHJ1Y3RvcihhdHRyaWJ1dGVzKSB7CiAgICBzdXBlcihDT05GSUdfTlNfSUQsICJzdWJzZXRCZWxvdyIsIDEwMCwgbiA9PiBuID49IDAgJiYgbiA8PSAxMDApOwogIH0KfQpjbGFzcyBTdXBwcmVzc0Jhbm5lciBleHRlbmRzIF94ZmFfb2JqZWN0Lk9wdGlvbjAxIHsKICBjb25zdHJ1Y3RvcihhdHRyaWJ1dGVzKSB7CiAgICBzdXBlcihDT05GSUdfTlNfSUQsICJzdXBwcmVzc0Jhbm5lciIpOwogIH0KfQpjbGFzcyBUYWdnZWQgZXh0ZW5kcyBfeGZhX29iamVjdC5PcHRpb24wMSB7CiAgY29uc3RydWN0b3IoYXR0cmlidXRlcykgewogICAgc3VwZXIoQ09ORklHX05TX0lELCAidGFnZ2VkIik7CiAgfQp9CmNsYXNzIFRlbXBsYXRlIGV4dGVuZHMgX3hmYV9vYmplY3QuWEZBT2JqZWN0IHsKICBjb25zdHJ1Y3RvcihhdHRyaWJ1dGVzKSB7CiAgICBzdXBlcihDT05GSUdfTlNfSUQsICJ0ZW1wbGF0ZSIsIHRydWUpOwogICAgdGhpcy5iYXNlID0gbnVsbDsKICAgIHRoaXMucmVsZXZhbnQgPSBudWxsOwogICAgdGhpcy5zdGFydFBhZ2UgPSBudWxsOwogICAgdGhpcy51cmkgPSBudWxsOwogICAgdGhpcy54c2wgPSBudWxsOwogIH0KfQpjbGFzcyBUaHJlc2hvbGQgZXh0ZW5kcyBfeGZhX29iamVjdC5PcHRpb25PYmplY3QgewogIGNvbnN0cnVjdG9yKGF0dHJpYnV0ZXMpIHsKICAgIHN1cGVyKENPTkZJR19OU19JRCwgInRocmVzaG9sZCIsIFsidHJhY2UiLCAiZXJyb3IiLCAiaW5mb3JtYXRpb24iLCAid2FybmluZyJdKTsKICB9Cn0KY2xhc3MgVG8gZXh0ZW5kcyBfeGZhX29iamVjdC5PcHRpb25PYmplY3QgewogIGNvbnN0cnVjdG9yKGF0dHJpYnV0ZXMpIHsKICAgIHN1cGVyKENPTkZJR19OU19JRCwgInRvIiwgWyJudWxsIiwgIm1lbW9yeSIsICJzdGRlcnIiLCAic3Rkb3V0IiwgInN5c3RlbSIsICJ1cmkiXSk7CiAgfQp9CmNsYXNzIFRlbXBsYXRlQ2FjaGUgZXh0ZW5kcyBfeGZhX29iamVjdC5YRkFPYmplY3QgewogIGNvbnN0cnVjdG9yKGF0dHJpYnV0ZXMpIHsKICAgIHN1cGVyKENPTkZJR19OU19JRCwgInRlbXBsYXRlQ2FjaGUiKTsKICAgIHRoaXMubWF4RW50cmllcyA9ICgwLCBfdXRpbHMuZ2V0SW50ZWdlcikoewogICAgICBkYXRhOiBhdHRyaWJ1dGVzLm1heEVudHJpZXMsCiAgICAgIGRlZmF1bHRWYWx1ZTogNSwKICAgICAgdmFsaWRhdGU6IG4gPT4gbiA+PSAwCiAgICB9KTsKICB9Cn0KY2xhc3MgVHJhY2UgZXh0ZW5kcyBfeGZhX29iamVjdC5YRkFPYmplY3QgewogIGNvbnN0cnVjdG9yKGF0dHJpYnV0ZXMpIHsKICAgIHN1cGVyKENPTkZJR19OU19JRCwgInRyYWNlIiwgdHJ1ZSk7CiAgICB0aGlzLmFyZWEgPSBuZXcgX3hmYV9vYmplY3QuWEZBT2JqZWN0QXJyYXkoKTsKICB9Cn0KY2xhc3MgVHJhbnNmb3JtIGV4dGVuZHMgX3hmYV9vYmplY3QuWEZBT2JqZWN0IHsKICBjb25zdHJ1Y3RvcihhdHRyaWJ1dGVzKSB7CiAgICBzdXBlcihDT05GSUdfTlNfSUQsICJ0cmFuc2Zvcm0iLCB0cnVlKTsKICAgIHRoaXMuZ3JvdXBQYXJlbnQgPSBudWxsOwogICAgdGhpcy5pZkVtcHR5ID0gbnVsbDsKICAgIHRoaXMubmFtZUF0dHIgPSBudWxsOwogICAgdGhpcy5waWN0dXJlID0gbnVsbDsKICAgIHRoaXMucHJlc2VuY2UgPSBudWxsOwogICAgdGhpcy5yZW5hbWUgPSBudWxsOwogICAgdGhpcy53aGl0ZXNwYWNlID0gbnVsbDsKICB9Cn0KY2xhc3MgVHlwZSBleHRlbmRzIF94ZmFfb2JqZWN0Lk9wdGlvbk9iamVjdCB7CiAgY29uc3RydWN0b3IoYXR0cmlidXRlcykgewogICAgc3VwZXIoQ09ORklHX05TX0lELCAidHlwZSIsIFsibm9uZSIsICJhc2NpaTg1IiwgImFzY2lpSGV4IiwgImNjaXR0ZmF4IiwgImZsYXRlIiwgImx6dyIsICJydW5MZW5ndGgiLCAibmF0aXZlIiwgInhkcCIsICJtZXJnZWRYRFAiXSk7CiAgfQp9CmNsYXNzIFVyaSBleHRlbmRzIF94ZmFfb2JqZWN0LlN0cmluZ09iamVjdCB7CiAgY29uc3RydWN0b3IoYXR0cmlidXRlcykgewogICAgc3VwZXIoQ09ORklHX05TX0lELCAidXJpIik7CiAgfQp9CmNsYXNzIFZhbGlkYXRlIGV4dGVuZHMgX3hmYV9vYmplY3QuT3B0aW9uT2JqZWN0IHsKICBjb25zdHJ1Y3RvcihhdHRyaWJ1dGVzKSB7CiAgICBzdXBlcihDT05GSUdfTlNfSUQsICJ2YWxpZGF0ZSIsIFsicHJlU3VibWl0IiwgInByZVByaW50IiwgInByZUV4ZWN1dGUiLCAicHJlU2F2ZSJdKTsKICB9Cn0KY2xhc3MgVmFsaWRhdGVBcHByb3ZhbFNpZ25hdHVyZXMgZXh0ZW5kcyBfeGZhX29iamVjdC5Db250ZW50T2JqZWN0IHsKICBjb25zdHJ1Y3RvcihhdHRyaWJ1dGVzKSB7CiAgICBzdXBlcihDT05GSUdfTlNfSUQsICJ2YWxpZGF0ZUFwcHJvdmFsU2lnbmF0dXJlcyIpOwogIH0KICBbX3N5bWJvbF91dGlscy4kZmluYWxpemVdKCkgewogICAgdGhpc1tfc3ltYm9sX3V0aWxzLiRjb250ZW50XSA9IHRoaXNbX3N5bWJvbF91dGlscy4kY29udGVudF0udHJpbSgpLnNwbGl0KC9ccysvKS5maWx0ZXIoeCA9PiBbImRvY1JlYWR5IiwgInBvc3RTaWduIl0uaW5jbHVkZXMoeCkpOwogIH0KfQpjbGFzcyBWYWxpZGF0aW9uTWVzc2FnaW5nIGV4dGVuZHMgX3hmYV9vYmplY3QuT3B0aW9uT2JqZWN0IHsKICBjb25zdHJ1Y3RvcihhdHRyaWJ1dGVzKSB7CiAgICBzdXBlcihDT05GSUdfTlNfSUQsICJ2YWxpZGF0aW9uTWVzc2FnaW5nIiwgWyJhbGxNZXNzYWdlc0luZGl2aWR1YWxseSIsICJhbGxNZXNzYWdlc1RvZ2V0aGVyIiwgImZpcnN0TWVzc2FnZU9ubHkiLCAibm9NZXNzYWdlcyJdKTsKICB9Cn0KY2xhc3MgVmVyc2lvbiBleHRlbmRzIF94ZmFfb2JqZWN0Lk9wdGlvbk9iamVjdCB7CiAgY29uc3RydWN0b3IoYXR0cmlidXRlcykgewogICAgc3VwZXIoQ09ORklHX05TX0lELCAidmVyc2lvbiIsIFsiMS43IiwgIjEuNiIsICIxLjUiLCAiMS40IiwgIjEuMyIsICIxLjIiXSk7CiAgfQp9CmNsYXNzIFZlcnNpb25Db250cm9sIGV4dGVuZHMgX3hmYV9vYmplY3QuWEZBT2JqZWN0IHsKICBjb25zdHJ1Y3RvcihhdHRyaWJ1dGVzKSB7CiAgICBzdXBlcihDT05GSUdfTlNfSUQsICJWZXJzaW9uQ29udHJvbCIpOwogICAgdGhpcy5vdXRwdXRCZWxvdyA9ICgwLCBfdXRpbHMuZ2V0U3RyaW5nT3B0aW9uKShhdHRyaWJ1dGVzLm91dHB1dEJlbG93LCBbIndhcm4iLCAiZXJyb3IiLCAidXBkYXRlIl0pOwogICAgdGhpcy5zb3VyY2VBYm92ZSA9ICgwLCBfdXRpbHMuZ2V0U3RyaW5nT3B0aW9uKShhdHRyaWJ1dGVzLnNvdXJjZUFib3ZlLCBbIndhcm4iLCAiZXJyb3IiXSk7CiAgICB0aGlzLnNvdXJjZUJlbG93ID0gKDAsIF91dGlscy5nZXRTdHJpbmdPcHRpb24pKGF0dHJpYnV0ZXMuc291cmNlQmVsb3csIFsidXBkYXRlIiwgIm1haW50YWluIl0pOwogIH0KfQpjbGFzcyBWaWV3ZXJQcmVmZXJlbmNlcyBleHRlbmRzIF94ZmFfb2JqZWN0LlhGQU9iamVjdCB7CiAgY29uc3RydWN0b3IoYXR0cmlidXRlcykgewogICAgc3VwZXIoQ09ORklHX05TX0lELCAidmlld2VyUHJlZmVyZW5jZXMiLCB0cnVlKTsKICAgIHRoaXMuQURCRV9KU0NvbnNvbGUgPSBudWxsOwogICAgdGhpcy5BREJFX0pTRGVidWdnZXIgPSBudWxsOwogICAgdGhpcy5hZGRWaWV3ZXJQcmVmZXJlbmNlcyA9IG51bGw7CiAgICB0aGlzLmR1cGxleE9wdGlvbiA9IG51bGw7CiAgICB0aGlzLmVuZm9yY2UgPSBudWxsOwogICAgdGhpcy5udW1iZXJPZkNvcGllcyA9IG51bGw7CiAgICB0aGlzLnBhZ2VSYW5nZSA9IG51bGw7CiAgICB0aGlzLnBpY2tUcmF5QnlQREZTaXplID0gbnVsbDsKICAgIHRoaXMucHJpbnRTY2FsaW5nID0gbnVsbDsKICB9Cn0KY2xhc3MgV2ViQ2xpZW50IGV4dGVuZHMgX3hmYV9vYmplY3QuWEZBT2JqZWN0IHsKICBjb25zdHJ1Y3RvcihhdHRyaWJ1dGVzKSB7CiAgICBzdXBlcihDT05GSUdfTlNfSUQsICJ3ZWJDbGllbnQiLCB0cnVlKTsKICAgIHRoaXMubmFtZSA9IGF0dHJpYnV0ZXMubmFtZSA/IGF0dHJpYnV0ZXMubmFtZS50cmltKCkgOiAiIjsKICAgIHRoaXMuZm9udEluZm8gPSBudWxsOwogICAgdGhpcy54ZGMgPSBudWxsOwogIH0KfQpjbGFzcyBXaGl0ZXNwYWNlIGV4dGVuZHMgX3hmYV9vYmplY3QuT3B0aW9uT2JqZWN0IHsKICBjb25zdHJ1Y3RvcihhdHRyaWJ1dGVzKSB7CiAgICBzdXBlcihDT05GSUdfTlNfSUQsICJ3aGl0ZXNwYWNlIiwgWyJwcmVzZXJ2ZSIsICJsdHJpbSIsICJub3JtYWxpemUiLCAicnRyaW0iLCAidHJpbSJdKTsKICB9Cn0KY2xhc3MgV2luZG93IGV4dGVuZHMgX3hmYV9vYmplY3QuQ29udGVudE9iamVjdCB7CiAgY29uc3RydWN0b3IoYXR0cmlidXRlcykgewogICAgc3VwZXIoQ09ORklHX05TX0lELCAid2luZG93Iik7CiAgfQogIFtfc3ltYm9sX3V0aWxzLiRmaW5hbGl6ZV0oKSB7CiAgICBjb25zdCBwYWlyID0gdGhpc1tfc3ltYm9sX3V0aWxzLiRjb250ZW50XS50cmltKCkuc3BsaXQoL1xzKixccyovLCAyKS5tYXAoeCA9PiBwYXJzZUludCh4LCAxMCkpOwogICAgaWYgKHBhaXIuc29tZSh4ID0+IGlzTmFOKHgpKSkgewogICAgICB0aGlzW19zeW1ib2xfdXRpbHMuJGNvbnRlbnRdID0gWzAsIDBdOwogICAgICByZXR1cm47CiAgICB9CiAgICBpZiAocGFpci5sZW5ndGggPT09IDEpIHsKICAgICAgcGFpci5wdXNoKHBhaXJbMF0pOwogICAgfQogICAgdGhpc1tfc3ltYm9sX3V0aWxzLiRjb250ZW50XSA9IHBhaXI7CiAgfQp9CmNsYXNzIFhkYyBleHRlbmRzIF94ZmFfb2JqZWN0LlhGQU9iamVjdCB7CiAgY29uc3RydWN0b3IoYXR0cmlidXRlcykgewogICAgc3VwZXIoQ09ORklHX05TX0lELCAieGRjIiwgdHJ1ZSk7CiAgICB0aGlzLnVyaSA9IG5ldyBfeGZhX29iamVjdC5YRkFPYmplY3RBcnJheSgpOwogICAgdGhpcy54c2wgPSBuZXcgX3hmYV9vYmplY3QuWEZBT2JqZWN0QXJyYXkoKTsKICB9Cn0KY2xhc3MgWGRwIGV4dGVuZHMgX3hmYV9vYmplY3QuWEZBT2JqZWN0IHsKICBjb25zdHJ1Y3RvcihhdHRyaWJ1dGVzKSB7CiAgICBzdXBlcihDT05GSUdfTlNfSUQsICJ4ZHAiLCB0cnVlKTsKICAgIHRoaXMucGFja2V0cyA9IG51bGw7CiAgfQp9CmNsYXNzIFhzbCBleHRlbmRzIF94ZmFfb2JqZWN0LlhGQU9iamVjdCB7CiAgY29uc3RydWN0b3IoYXR0cmlidXRlcykgewogICAgc3VwZXIoQ09ORklHX05TX0lELCAieHNsIiwgdHJ1ZSk7CiAgICB0aGlzLmRlYnVnID0gbnVsbDsKICAgIHRoaXMudXJpID0gbnVsbDsKICB9Cn0KY2xhc3MgWnBsIGV4dGVuZHMgX3hmYV9vYmplY3QuWEZBT2JqZWN0IHsKICBjb25zdHJ1Y3RvcihhdHRyaWJ1dGVzKSB7CiAgICBzdXBlcihDT05GSUdfTlNfSUQsICJ6cGwiLCB0cnVlKTsKICAgIHRoaXMubmFtZSA9IGF0dHJpYnV0ZXMubmFtZSA/IGF0dHJpYnV0ZXMubmFtZS50cmltKCkgOiAiIjsKICAgIHRoaXMuYmF0Y2hPdXRwdXQgPSBudWxsOwogICAgdGhpcy5mbGlwTGFiZWwgPSBudWxsOwogICAgdGhpcy5mb250SW5mbyA9IG51bGw7CiAgICB0aGlzLnhkYyA9IG51bGw7CiAgfQp9CmNsYXNzIENvbmZpZ05hbWVzcGFjZSB7CiAgc3RhdGljIFtfbmFtZXNwYWNlcy4kYnVpbGRYRkFPYmplY3RdKG5hbWUsIGF0dHJpYnV0ZXMpIHsKICAgIGlmIChDb25maWdOYW1lc3BhY2UuaGFzT3duUHJvcGVydHkobmFtZSkpIHsKICAgICAgcmV0dXJuIENvbmZpZ05hbWVzcGFjZVtuYW1lXShhdHRyaWJ1dGVzKTsKICAgIH0KICAgIHJldHVybiB1bmRlZmluZWQ7CiAgfQogIHN0YXRpYyBhY3JvYmF0KGF0dHJzKSB7CiAgICByZXR1cm4gbmV3IEFjcm9iYXQoYXR0cnMpOwogIH0KICBzdGF0aWMgYWNyb2JhdDcoYXR0cnMpIHsKICAgIHJldHVybiBuZXcgQWNyb2JhdDcoYXR0cnMpOwogIH0KICBzdGF0aWMgQURCRV9KU0NvbnNvbGUoYXR0cnMpIHsKICAgIHJldHVybiBuZXcgQURCRV9KU0NvbnNvbGUoYXR0cnMpOwogIH0KICBzdGF0aWMgQURCRV9KU0RlYnVnZ2VyKGF0dHJzKSB7CiAgICByZXR1cm4gbmV3IEFEQkVfSlNEZWJ1Z2dlcihhdHRycyk7CiAgfQogIHN0YXRpYyBhZGRTaWxlbnRQcmludChhdHRycykgewogICAgcmV0dXJuIG5ldyBBZGRTaWxlbnRQcmludChhdHRycyk7CiAgfQogIHN0YXRpYyBhZGRWaWV3ZXJQcmVmZXJlbmNlcyhhdHRycykgewogICAgcmV0dXJuIG5ldyBBZGRWaWV3ZXJQcmVmZXJlbmNlcyhhdHRycyk7CiAgfQogIHN0YXRpYyBhZGp1c3REYXRhKGF0dHJzKSB7CiAgICByZXR1cm4gbmV3IEFkanVzdERhdGEoYXR0cnMpOwogIH0KICBzdGF0aWMgYWRvYmVFeHRlbnNpb25MZXZlbChhdHRycykgewogICAgcmV0dXJuIG5ldyBBZG9iZUV4dGVuc2lvbkxldmVsKGF0dHJzKTsKICB9CiAgc3RhdGljIGFnZW50KGF0dHJzKSB7CiAgICByZXR1cm4gbmV3IEFnZW50KGF0dHJzKTsKICB9CiAgc3RhdGljIGFsd2F5c0VtYmVkKGF0dHJzKSB7CiAgICByZXR1cm4gbmV3IEFsd2F5c0VtYmVkKGF0dHJzKTsKICB9CiAgc3RhdGljIGFtZChhdHRycykgewogICAgcmV0dXJuIG5ldyBBbWQoYXR0cnMpOwogIH0KICBzdGF0aWMgYXJlYShhdHRycykgewogICAgcmV0dXJuIG5ldyBBcmVhKGF0dHJzKTsKICB9CiAgc3RhdGljIGF0dHJpYnV0ZXMoYXR0cnMpIHsKICAgIHJldHVybiBuZXcgQXR0cmlidXRlcyhhdHRycyk7CiAgfQogIHN0YXRpYyBhdXRvU2F2ZShhdHRycykgewogICAgcmV0dXJuIG5ldyBBdXRvU2F2ZShhdHRycyk7CiAgfQogIHN0YXRpYyBiYXNlKGF0dHJzKSB7CiAgICByZXR1cm4gbmV3IEJhc2UoYXR0cnMpOwogIH0KICBzdGF0aWMgYmF0Y2hPdXRwdXQoYXR0cnMpIHsKICAgIHJldHVybiBuZXcgQmF0Y2hPdXRwdXQoYXR0cnMpOwogIH0KICBzdGF0aWMgYmVoYXZpb3JPdmVycmlkZShhdHRycykgewogICAgcmV0dXJuIG5ldyBCZWhhdmlvck92ZXJyaWRlKGF0dHJzKTsKICB9CiAgc3RhdGljIGNhY2hlKGF0dHJzKSB7CiAgICByZXR1cm4gbmV3IENhY2hlKGF0dHJzKTsKICB9CiAgc3RhdGljIGNoYW5nZShhdHRycykgewogICAgcmV0dXJuIG5ldyBDaGFuZ2UoYXR0cnMpOwogIH0KICBzdGF0aWMgY29tbW9uKGF0dHJzKSB7CiAgICByZXR1cm4gbmV3IENvbW1vbihhdHRycyk7CiAgfQogIHN0YXRpYyBjb21wcmVzcyhhdHRycykgewogICAgcmV0dXJuIG5ldyBDb21wcmVzcyhhdHRycyk7CiAgfQogIHN0YXRpYyBjb21wcmVzc0xvZ2ljYWxTdHJ1Y3R1cmUoYXR0cnMpIHsKICAgIHJldHVybiBuZXcgQ29tcHJlc3NMb2dpY2FsU3RydWN0dXJlKGF0dHJzKTsKICB9CiAgc3RhdGljIGNvbXByZXNzT2JqZWN0U3RyZWFtKGF0dHJzKSB7CiAgICByZXR1cm4gbmV3IENvbXByZXNzT2JqZWN0U3RyZWFtKGF0dHJzKTsKICB9CiAgc3RhdGljIGNvbXByZXNzaW9uKGF0dHJzKSB7CiAgICByZXR1cm4gbmV3IENvbXByZXNzaW9uKGF0dHJzKTsKICB9CiAgc3RhdGljIGNvbmZpZyhhdHRycykgewogICAgcmV0dXJuIG5ldyBDb25maWcoYXR0cnMpOwogIH0KICBzdGF0aWMgY29uZm9ybWFuY2UoYXR0cnMpIHsKICAgIHJldHVybiBuZXcgQ29uZm9ybWFuY2UoYXR0cnMpOwogIH0KICBzdGF0aWMgY29udGVudENvcHkoYXR0cnMpIHsKICAgIHJldHVybiBuZXcgQ29udGVudENvcHkoYXR0cnMpOwogIH0KICBzdGF0aWMgY29waWVzKGF0dHJzKSB7CiAgICByZXR1cm4gbmV3IENvcGllcyhhdHRycyk7CiAgfQogIHN0YXRpYyBjcmVhdG9yKGF0dHJzKSB7CiAgICByZXR1cm4gbmV3IENyZWF0b3IoYXR0cnMpOwogIH0KICBzdGF0aWMgY3VycmVudFBhZ2UoYXR0cnMpIHsKICAgIHJldHVybiBuZXcgQ3VycmVudFBhZ2UoYXR0cnMpOwogIH0KICBzdGF0aWMgZGF0YShhdHRycykgewogICAgcmV0dXJuIG5ldyBEYXRhKGF0dHJzKTsKICB9CiAgc3RhdGljIGRlYnVnKGF0dHJzKSB7CiAgICByZXR1cm4gbmV3IERlYnVnKGF0dHJzKTsKICB9CiAgc3RhdGljIGRlZmF1bHRUeXBlZmFjZShhdHRycykgewogICAgcmV0dXJuIG5ldyBEZWZhdWx0VHlwZWZhY2UoYXR0cnMpOwogIH0KICBzdGF0aWMgZGVzdGluYXRpb24oYXR0cnMpIHsKICAgIHJldHVybiBuZXcgRGVzdGluYXRpb24oYXR0cnMpOwogIH0KICBzdGF0aWMgZG9jdW1lbnRBc3NlbWJseShhdHRycykgewogICAgcmV0dXJuIG5ldyBEb2N1bWVudEFzc2VtYmx5KGF0dHJzKTsKICB9CiAgc3RhdGljIGRyaXZlcihhdHRycykgewogICAgcmV0dXJuIG5ldyBEcml2ZXIoYXR0cnMpOwogIH0KICBzdGF0aWMgZHVwbGV4T3B0aW9uKGF0dHJzKSB7CiAgICByZXR1cm4gbmV3IER1cGxleE9wdGlvbihhdHRycyk7CiAgfQogIHN0YXRpYyBkeW5hbWljUmVuZGVyKGF0dHJzKSB7CiAgICByZXR1cm4gbmV3IER5bmFtaWNSZW5kZXIoYXR0cnMpOwogIH0KICBzdGF0aWMgZW1iZWQoYXR0cnMpIHsKICAgIHJldHVybiBuZXcgRW1iZWQoYXR0cnMpOwogIH0KICBzdGF0aWMgZW5jcnlwdChhdHRycykgewogICAgcmV0dXJuIG5ldyBFbmNyeXB0KGF0dHJzKTsKICB9CiAgc3RhdGljIGVuY3J5cHRpb24oYXR0cnMpIHsKICAgIHJldHVybiBuZXcgRW5jcnlwdGlvbihhdHRycyk7CiAgfQogIHN0YXRpYyBlbmNyeXB0aW9uTGV2ZWwoYXR0cnMpIHsKICAgIHJldHVybiBuZXcgRW5jcnlwdGlvbkxldmVsKGF0dHJzKTsKICB9CiAgc3RhdGljIGVuZm9yY2UoYXR0cnMpIHsKICAgIHJldHVybiBuZXcgRW5mb3JjZShhdHRycyk7CiAgfQogIHN0YXRpYyBlcXVhdGUoYXR0cnMpIHsKICAgIHJldHVybiBuZXcgRXF1YXRlKGF0dHJzKTsKICB9CiAgc3RhdGljIGVxdWF0ZVJhbmdlKGF0dHJzKSB7CiAgICByZXR1cm4gbmV3IEVxdWF0ZVJhbmdlKGF0dHJzKTsKICB9CiAgc3RhdGljIGV4Y2x1ZGUoYXR0cnMpIHsKICAgIHJldHVybiBuZXcgRXhjbHVkZShhdHRycyk7CiAgfQogIHN0YXRpYyBleGNsdWRlTlMoYXR0cnMpIHsKICAgIHJldHVybiBuZXcgRXhjbHVkZU5TKGF0dHJzKTsKICB9CiAgc3RhdGljIGZsaXBMYWJlbChhdHRycykgewogICAgcmV0dXJuIG5ldyBGbGlwTGFiZWwoYXR0cnMpOwogIH0KICBzdGF0aWMgZm9udEluZm8oYXR0cnMpIHsKICAgIHJldHVybiBuZXcgRm9udEluZm8oYXR0cnMpOwogIH0KICBzdGF0aWMgZm9ybUZpZWxkRmlsbGluZyhhdHRycykgewogICAgcmV0dXJuIG5ldyBGb3JtRmllbGRGaWxsaW5nKGF0dHJzKTsKICB9CiAgc3RhdGljIGdyb3VwUGFyZW50KGF0dHJzKSB7CiAgICByZXR1cm4gbmV3IEdyb3VwUGFyZW50KGF0dHJzKTsKICB9CiAgc3RhdGljIGlmRW1wdHkoYXR0cnMpIHsKICAgIHJldHVybiBuZXcgSWZFbXB0eShhdHRycyk7CiAgfQogIHN0YXRpYyBpbmNsdWRlWERQQ29udGVudChhdHRycykgewogICAgcmV0dXJuIG5ldyBJbmNsdWRlWERQQ29udGVudChhdHRycyk7CiAgfQogIHN0YXRpYyBpbmNyZW1lbnRhbExvYWQoYXR0cnMpIHsKICAgIHJldHVybiBuZXcgSW5jcmVtZW50YWxMb2FkKGF0dHJzKTsKICB9CiAgc3RhdGljIGluY3JlbWVudGFsTWVyZ2UoYXR0cnMpIHsKICAgIHJldHVybiBuZXcgSW5jcmVtZW50YWxNZXJnZShhdHRycyk7CiAgfQogIHN0YXRpYyBpbnRlcmFjdGl2ZShhdHRycykgewogICAgcmV0dXJuIG5ldyBJbnRlcmFjdGl2ZShhdHRycyk7CiAgfQogIHN0YXRpYyBqb2coYXR0cnMpIHsKICAgIHJldHVybiBuZXcgSm9nKGF0dHJzKTsKICB9CiAgc3RhdGljIGxhYmVsUHJpbnRlcihhdHRycykgewogICAgcmV0dXJuIG5ldyBMYWJlbFByaW50ZXIoYXR0cnMpOwogIH0KICBzdGF0aWMgbGF5b3V0KGF0dHJzKSB7CiAgICByZXR1cm4gbmV3IExheW91dChhdHRycyk7CiAgfQogIHN0YXRpYyBsZXZlbChhdHRycykgewogICAgcmV0dXJuIG5ldyBMZXZlbChhdHRycyk7CiAgfQogIHN0YXRpYyBsaW5lYXJpemVkKGF0dHJzKSB7CiAgICByZXR1cm4gbmV3IExpbmVhcml6ZWQoYXR0cnMpOwogIH0KICBzdGF0aWMgbG9jYWxlKGF0dHJzKSB7CiAgICByZXR1cm4gbmV3IExvY2FsZShhdHRycyk7CiAgfQogIHN0YXRpYyBsb2NhbGVTZXQoYXR0cnMpIHsKICAgIHJldHVybiBuZXcgTG9jYWxlU2V0KGF0dHJzKTsKICB9CiAgc3RhdGljIGxvZyhhdHRycykgewogICAgcmV0dXJuIG5ldyBMb2coYXR0cnMpOwogIH0KICBzdGF0aWMgbWFwKGF0dHJzKSB7CiAgICByZXR1cm4gbmV3IE1hcEVsZW1lbnQoYXR0cnMpOwogIH0KICBzdGF0aWMgbWVkaXVtSW5mbyhhdHRycykgewogICAgcmV0dXJuIG5ldyBNZWRpdW1JbmZvKGF0dHJzKTsKICB9CiAgc3RhdGljIG1lc3NhZ2UoYXR0cnMpIHsKICAgIHJldHVybiBuZXcgTWVzc2FnZShhdHRycyk7CiAgfQogIHN0YXRpYyBtZXNzYWdpbmcoYXR0cnMpIHsKICAgIHJldHVybiBuZXcgTWVzc2FnaW5nKGF0dHJzKTsKICB9CiAgc3RhdGljIG1vZGUoYXR0cnMpIHsKICAgIHJldHVybiBuZXcgTW9kZShhdHRycyk7CiAgfQogIHN0YXRpYyBtb2RpZnlBbm5vdHMoYXR0cnMpIHsKICAgIHJldHVybiBuZXcgTW9kaWZ5QW5ub3RzKGF0dHJzKTsKICB9CiAgc3RhdGljIG1zZ0lkKGF0dHJzKSB7CiAgICByZXR1cm4gbmV3IE1zZ0lkKGF0dHJzKTsKICB9CiAgc3RhdGljIG5hbWVBdHRyKGF0dHJzKSB7CiAgICByZXR1cm4gbmV3IE5hbWVBdHRyKGF0dHJzKTsKICB9CiAgc3RhdGljIG5ldmVyRW1iZWQoYXR0cnMpIHsKICAgIHJldHVybiBuZXcgTmV2ZXJFbWJlZChhdHRycyk7CiAgfQogIHN0YXRpYyBudW1iZXJPZkNvcGllcyhhdHRycykgewogICAgcmV0dXJuIG5ldyBOdW1iZXJPZkNvcGllcyhhdHRycyk7CiAgfQogIHN0YXRpYyBvcGVuQWN0aW9uKGF0dHJzKSB7CiAgICByZXR1cm4gbmV3IE9wZW5BY3Rpb24oYXR0cnMpOwogIH0KICBzdGF0aWMgb3V0cHV0KGF0dHJzKSB7CiAgICByZXR1cm4gbmV3IE91dHB1dChhdHRycyk7CiAgfQogIHN0YXRpYyBvdXRwdXRCaW4oYXR0cnMpIHsKICAgIHJldHVybiBuZXcgT3V0cHV0QmluKGF0dHJzKTsKICB9CiAgc3RhdGljIG91dHB1dFhTTChhdHRycykgewogICAgcmV0dXJuIG5ldyBPdXRwdXRYU0woYXR0cnMpOwogIH0KICBzdGF0aWMgb3ZlcnByaW50KGF0dHJzKSB7CiAgICByZXR1cm4gbmV3IE92ZXJwcmludChhdHRycyk7CiAgfQogIHN0YXRpYyBwYWNrZXRzKGF0dHJzKSB7CiAgICByZXR1cm4gbmV3IFBhY2tldHMoYXR0cnMpOwogIH0KICBzdGF0aWMgcGFnZU9mZnNldChhdHRycykgewogICAgcmV0dXJuIG5ldyBQYWdlT2Zmc2V0KGF0dHJzKTsKICB9CiAgc3RhdGljIHBhZ2VSYW5nZShhdHRycykgewogICAgcmV0dXJuIG5ldyBQYWdlUmFuZ2UoYXR0cnMpOwogIH0KICBzdGF0aWMgcGFnaW5hdGlvbihhdHRycykgewogICAgcmV0dXJuIG5ldyBQYWdpbmF0aW9uKGF0dHJzKTsKICB9CiAgc3RhdGljIHBhZ2luYXRpb25PdmVycmlkZShhdHRycykgewogICAgcmV0dXJuIG5ldyBQYWdpbmF0aW9uT3ZlcnJpZGUoYXR0cnMpOwogIH0KICBzdGF0aWMgcGFydChhdHRycykgewogICAgcmV0dXJuIG5ldyBQYXJ0KGF0dHJzKTsKICB9CiAgc3RhdGljIHBjbChhdHRycykgewogICAgcmV0dXJuIG5ldyBQY2woYXR0cnMpOwogIH0KICBzdGF0aWMgcGRmKGF0dHJzKSB7CiAgICByZXR1cm4gbmV3IFBkZihhdHRycyk7CiAgfQogIHN0YXRpYyBwZGZhKGF0dHJzKSB7CiAgICByZXR1cm4gbmV3IFBkZmEoYXR0cnMpOwogIH0KICBzdGF0aWMgcGVybWlzc2lvbnMoYXR0cnMpIHsKICAgIHJldHVybiBuZXcgUGVybWlzc2lvbnMoYXR0cnMpOwogIH0KICBzdGF0aWMgcGlja1RyYXlCeVBERlNpemUoYXR0cnMpIHsKICAgIHJldHVybiBuZXcgUGlja1RyYXlCeVBERlNpemUoYXR0cnMpOwogIH0KICBzdGF0aWMgcGljdHVyZShhdHRycykgewogICAgcmV0dXJuIG5ldyBQaWN0dXJlKGF0dHJzKTsKICB9CiAgc3RhdGljIHBsYWludGV4dE1ldGFkYXRhKGF0dHJzKSB7CiAgICByZXR1cm4gbmV3IFBsYWludGV4dE1ldGFkYXRhKGF0dHJzKTsKICB9CiAgc3RhdGljIHByZXNlbmNlKGF0dHJzKSB7CiAgICByZXR1cm4gbmV3IFByZXNlbmNlKGF0dHJzKTsKICB9CiAgc3RhdGljIHByZXNlbnQoYXR0cnMpIHsKICAgIHJldHVybiBuZXcgUHJlc2VudChhdHRycyk7CiAgfQogIHN0YXRpYyBwcmludChhdHRycykgewogICAgcmV0dXJuIG5ldyBQcmludChhdHRycyk7CiAgfQogIHN0YXRpYyBwcmludEhpZ2hRdWFsaXR5KGF0dHJzKSB7CiAgICByZXR1cm4gbmV3IFByaW50SGlnaFF1YWxpdHkoYXR0cnMpOwogIH0KICBzdGF0aWMgcHJpbnRTY2FsaW5nKGF0dHJzKSB7CiAgICByZXR1cm4gbmV3IFByaW50U2NhbGluZyhhdHRycyk7CiAgfQogIHN0YXRpYyBwcmludGVyTmFtZShhdHRycykgewogICAgcmV0dXJuIG5ldyBQcmludGVyTmFtZShhdHRycyk7CiAgfQogIHN0YXRpYyBwcm9kdWNlcihhdHRycykgewogICAgcmV0dXJuIG5ldyBQcm9kdWNlcihhdHRycyk7CiAgfQogIHN0YXRpYyBwcyhhdHRycykgewogICAgcmV0dXJuIG5ldyBQcyhhdHRycyk7CiAgfQogIHN0YXRpYyByYW5nZShhdHRycykgewogICAgcmV0dXJuIG5ldyBSYW5nZShhdHRycyk7CiAgfQogIHN0YXRpYyByZWNvcmQoYXR0cnMpIHsKICAgIHJldHVybiBuZXcgUmVjb3JkKGF0dHJzKTsKICB9CiAgc3RhdGljIHJlbGV2YW50KGF0dHJzKSB7CiAgICByZXR1cm4gbmV3IFJlbGV2YW50KGF0dHJzKTsKICB9CiAgc3RhdGljIHJlbmFtZShhdHRycykgewogICAgcmV0dXJuIG5ldyBSZW5hbWUoYXR0cnMpOwogIH0KICBzdGF0aWMgcmVuZGVyUG9saWN5KGF0dHJzKSB7CiAgICByZXR1cm4gbmV3IFJlbmRlclBvbGljeShhdHRycyk7CiAgfQogIHN0YXRpYyBydW5TY3JpcHRzKGF0dHJzKSB7CiAgICByZXR1cm4gbmV3IFJ1blNjcmlwdHMoYXR0cnMpOwogIH0KICBzdGF0aWMgc2NyaXB0KGF0dHJzKSB7CiAgICByZXR1cm4gbmV3IFNjcmlwdChhdHRycyk7CiAgfQogIHN0YXRpYyBzY3JpcHRNb2RlbChhdHRycykgewogICAgcmV0dXJuIG5ldyBTY3JpcHRNb2RlbChhdHRycyk7CiAgfQogIHN0YXRpYyBzZXZlcml0eShhdHRycykgewogICAgcmV0dXJuIG5ldyBTZXZlcml0eShhdHRycyk7CiAgfQogIHN0YXRpYyBzaWxlbnRQcmludChhdHRycykgewogICAgcmV0dXJuIG5ldyBTaWxlbnRQcmludChhdHRycyk7CiAgfQogIHN0YXRpYyBzdGFwbGUoYXR0cnMpIHsKICAgIHJldHVybiBuZXcgU3RhcGxlKGF0dHJzKTsKICB9CiAgc3RhdGljIHN0YXJ0Tm9kZShhdHRycykgewogICAgcmV0dXJuIG5ldyBTdGFydE5vZGUoYXR0cnMpOwogIH0KICBzdGF0aWMgc3RhcnRQYWdlKGF0dHJzKSB7CiAgICByZXR1cm4gbmV3IFN0YXJ0UGFnZShhdHRycyk7CiAgfQogIHN0YXRpYyBzdWJtaXRGb3JtYXQoYXR0cnMpIHsKICAgIHJldHVybiBuZXcgU3VibWl0Rm9ybWF0KGF0dHJzKTsKICB9CiAgc3RhdGljIHN1Ym1pdFVybChhdHRycykgewogICAgcmV0dXJuIG5ldyBTdWJtaXRVcmwoYXR0cnMpOwogIH0KICBzdGF0aWMgc3Vic2V0QmVsb3coYXR0cnMpIHsKICAgIHJldHVybiBuZXcgU3Vic2V0QmVsb3coYXR0cnMpOwogIH0KICBzdGF0aWMgc3VwcHJlc3NCYW5uZXIoYXR0cnMpIHsKICAgIHJldHVybiBuZXcgU3VwcHJlc3NCYW5uZXIoYXR0cnMpOwogIH0KICBzdGF0aWMgdGFnZ2VkKGF0dHJzKSB7CiAgICByZXR1cm4gbmV3IFRhZ2dlZChhdHRycyk7CiAgfQogIHN0YXRpYyB0ZW1wbGF0ZShhdHRycykgewogICAgcmV0dXJuIG5ldyBUZW1wbGF0ZShhdHRycyk7CiAgfQogIHN0YXRpYyB0ZW1wbGF0ZUNhY2hlKGF0dHJzKSB7CiAgICByZXR1cm4gbmV3IFRlbXBsYXRlQ2FjaGUoYXR0cnMpOwogIH0KICBzdGF0aWMgdGhyZXNob2xkKGF0dHJzKSB7CiAgICByZXR1cm4gbmV3IFRocmVzaG9sZChhdHRycyk7CiAgfQogIHN0YXRpYyB0byhhdHRycykgewogICAgcmV0dXJuIG5ldyBUbyhhdHRycyk7CiAgfQogIHN0YXRpYyB0cmFjZShhdHRycykgewogICAgcmV0dXJuIG5ldyBUcmFjZShhdHRycyk7CiAgfQogIHN0YXRpYyB0cmFuc2Zvcm0oYXR0cnMpIHsKICAgIHJldHVybiBuZXcgVHJhbnNmb3JtKGF0dHJzKTsKICB9CiAgc3RhdGljIHR5cGUoYXR0cnMpIHsKICAgIHJldHVybiBuZXcgVHlwZShhdHRycyk7CiAgfQogIHN0YXRpYyB1cmkoYXR0cnMpIHsKICAgIHJldHVybiBuZXcgVXJpKGF0dHJzKTsKICB9CiAgc3RhdGljIHZhbGlkYXRlKGF0dHJzKSB7CiAgICByZXR1cm4gbmV3IFZhbGlkYXRlKGF0dHJzKTsKICB9CiAgc3RhdGljIHZhbGlkYXRlQXBwcm92YWxTaWduYXR1cmVzKGF0dHJzKSB7CiAgICByZXR1cm4gbmV3IFZhbGlkYXRlQXBwcm92YWxTaWduYXR1cmVzKGF0dHJzKTsKICB9CiAgc3RhdGljIHZhbGlkYXRpb25NZXNzYWdpbmcoYXR0cnMpIHsKICAgIHJldHVybiBuZXcgVmFsaWRhdGlvbk1lc3NhZ2luZyhhdHRycyk7CiAgfQogIHN0YXRpYyB2ZXJzaW9uKGF0dHJzKSB7CiAgICByZXR1cm4gbmV3IFZlcnNpb24oYXR0cnMpOwogIH0KICBzdGF0aWMgdmVyc2lvbkNvbnRyb2woYXR0cnMpIHsKICAgIHJldHVybiBuZXcgVmVyc2lvbkNvbnRyb2woYXR0cnMpOwogIH0KICBzdGF0aWMgdmlld2VyUHJlZmVyZW5jZXMoYXR0cnMpIHsKICAgIHJldHVybiBuZXcgVmlld2VyUHJlZmVyZW5jZXMoYXR0cnMpOwogIH0KICBzdGF0aWMgd2ViQ2xpZW50KGF0dHJzKSB7CiAgICByZXR1cm4gbmV3IFdlYkNsaWVudChhdHRycyk7CiAgfQogIHN0YXRpYyB3aGl0ZXNwYWNlKGF0dHJzKSB7CiAgICByZXR1cm4gbmV3IFdoaXRlc3BhY2UoYXR0cnMpOwogIH0KICBzdGF0aWMgd2luZG93KGF0dHJzKSB7CiAgICByZXR1cm4gbmV3IFdpbmRvdyhhdHRycyk7CiAgfQogIHN0YXRpYyB4ZGMoYXR0cnMpIHsKICAgIHJldHVybiBuZXcgWGRjKGF0dHJzKTsKICB9CiAgc3RhdGljIHhkcChhdHRycykgewogICAgcmV0dXJuIG5ldyBYZHAoYXR0cnMpOwogIH0KICBzdGF0aWMgeHNsKGF0dHJzKSB7CiAgICByZXR1cm4gbmV3IFhzbChhdHRycyk7CiAgfQogIHN0YXRpYyB6cGwoYXR0cnMpIHsKICAgIHJldHVybiBuZXcgWnBsKGF0dHJzKTsKICB9Cn0KZXhwb3J0cy5Db25maWdOYW1lc3BhY2UgPSBDb25maWdOYW1lc3BhY2U7CgovKioqLyB9KSwKLyogOTQgKi8KLyoqKi8gKChfX3VudXNlZF93ZWJwYWNrX21vZHVsZSwgZXhwb3J0cywgX193X3BkZmpzX3JlcXVpcmVfXykgPT4gewoKCgpPYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgIl9fZXNNb2R1bGUiLCAoewogIHZhbHVlOiB0cnVlCn0pKTsKZXhwb3J0cy5Db25uZWN0aW9uU2V0TmFtZXNwYWNlID0gdm9pZCAwOwp2YXIgX25hbWVzcGFjZXMgPSBfX3dfcGRmanNfcmVxdWlyZV9fKDgxKTsKdmFyIF94ZmFfb2JqZWN0ID0gX193X3BkZmpzX3JlcXVpcmVfXyg4Nyk7CmNvbnN0IENPTk5FQ1RJT05fU0VUX05TX0lEID0gX25hbWVzcGFjZXMuTmFtZXNwYWNlSWRzLmNvbm5lY3Rpb25TZXQuaWQ7CmNsYXNzIENvbm5lY3Rpb25TZXQgZXh0ZW5kcyBfeGZhX29iamVjdC5YRkFPYmplY3QgewogIGNvbnN0cnVjdG9yKGF0dHJpYnV0ZXMpIHsKICAgIHN1cGVyKENPTk5FQ1RJT05fU0VUX05TX0lELCAiY29ubmVjdGlvblNldCIsIHRydWUpOwogICAgdGhpcy53c2RsQ29ubmVjdGlvbiA9IG5ldyBfeGZhX29iamVjdC5YRkFPYmplY3RBcnJheSgpOwogICAgdGhpcy54bWxDb25uZWN0aW9uID0gbmV3IF94ZmFfb2JqZWN0LlhGQU9iamVjdEFycmF5KCk7CiAgICB0aGlzLnhzZENvbm5lY3Rpb24gPSBuZXcgX3hmYV9vYmplY3QuWEZBT2JqZWN0QXJyYXkoKTsKICB9Cn0KY2xhc3MgRWZmZWN0aXZlSW5wdXRQb2xpY3kgZXh0ZW5kcyBfeGZhX29iamVjdC5YRkFPYmplY3QgewogIGNvbnN0cnVjdG9yKGF0dHJpYnV0ZXMpIHsKICAgIHN1cGVyKENPTk5FQ1RJT05fU0VUX05TX0lELCAiZWZmZWN0aXZlSW5wdXRQb2xpY3kiKTsKICAgIHRoaXMuaWQgPSBhdHRyaWJ1dGVzLmlkIHx8ICIiOwogICAgdGhpcy5uYW1lID0gYXR0cmlidXRlcy5uYW1lIHx8ICIiOwogICAgdGhpcy51c2UgPSBhdHRyaWJ1dGVzLnVzZSB8fCAiIjsKICAgIHRoaXMudXNlaHJlZiA9IGF0dHJpYnV0ZXMudXNlaHJlZiB8fCAiIjsKICB9Cn0KY2xhc3MgRWZmZWN0aXZlT3V0cHV0UG9saWN5IGV4dGVuZHMgX3hmYV9vYmplY3QuWEZBT2JqZWN0IHsKICBjb25zdHJ1Y3RvcihhdHRyaWJ1dGVzKSB7CiAgICBzdXBlcihDT05ORUNUSU9OX1NFVF9OU19JRCwgImVmZmVjdGl2ZU91dHB1dFBvbGljeSIpOwogICAgdGhpcy5pZCA9IGF0dHJpYnV0ZXMuaWQgfHwgIiI7CiAgICB0aGlzLm5hbWUgPSBhdHRyaWJ1dGVzLm5hbWUgfHwgIiI7CiAgICB0aGlzLnVzZSA9IGF0dHJpYnV0ZXMudXNlIHx8ICIiOwogICAgdGhpcy51c2VocmVmID0gYXR0cmlidXRlcy51c2VocmVmIHx8ICIiOwogIH0KfQpjbGFzcyBPcGVyYXRpb24gZXh0ZW5kcyBfeGZhX29iamVjdC5TdHJpbmdPYmplY3QgewogIGNvbnN0cnVjdG9yKGF0dHJpYnV0ZXMpIHsKICAgIHN1cGVyKENPTk5FQ1RJT05fU0VUX05TX0lELCAib3BlcmF0aW9uIik7CiAgICB0aGlzLmlkID0gYXR0cmlidXRlcy5pZCB8fCAiIjsKICAgIHRoaXMuaW5wdXQgPSBhdHRyaWJ1dGVzLmlucHV0IHx8ICIiOwogICAgdGhpcy5uYW1lID0gYXR0cmlidXRlcy5uYW1lIHx8ICIiOwogICAgdGhpcy5vdXRwdXQgPSBhdHRyaWJ1dGVzLm91dHB1dCB8fCAiIjsKICAgIHRoaXMudXNlID0gYXR0cmlidXRlcy51c2UgfHwgIiI7CiAgICB0aGlzLnVzZWhyZWYgPSBhdHRyaWJ1dGVzLnVzZWhyZWYgfHwgIiI7CiAgfQp9CmNsYXNzIFJvb3RFbGVtZW50IGV4dGVuZHMgX3hmYV9vYmplY3QuU3RyaW5nT2JqZWN0IHsKICBjb25zdHJ1Y3RvcihhdHRyaWJ1dGVzKSB7CiAgICBzdXBlcihDT05ORUNUSU9OX1NFVF9OU19JRCwgInJvb3RFbGVtZW50Iik7CiAgICB0aGlzLmlkID0gYXR0cmlidXRlcy5pZCB8fCAiIjsKICAgIHRoaXMubmFtZSA9IGF0dHJpYnV0ZXMubmFtZSB8fCAiIjsKICAgIHRoaXMudXNlID0gYXR0cmlidXRlcy51c2UgfHwgIiI7CiAgICB0aGlzLnVzZWhyZWYgPSBhdHRyaWJ1dGVzLnVzZWhyZWYgfHwgIiI7CiAgfQp9CmNsYXNzIFNvYXBBY3Rpb24gZXh0ZW5kcyBfeGZhX29iamVjdC5TdHJpbmdPYmplY3QgewogIGNvbnN0cnVjdG9yKGF0dHJpYnV0ZXMpIHsKICAgIHN1cGVyKENPTk5FQ1RJT05fU0VUX05TX0lELCAic29hcEFjdGlvbiIpOwogICAgdGhpcy5pZCA9IGF0dHJpYnV0ZXMuaWQgfHwgIiI7CiAgICB0aGlzLm5hbWUgPSBhdHRyaWJ1dGVzLm5hbWUgfHwgIiI7CiAgICB0aGlzLnVzZSA9IGF0dHJpYnV0ZXMudXNlIHx8ICIiOwogICAgdGhpcy51c2VocmVmID0gYXR0cmlidXRlcy51c2VocmVmIHx8ICIiOwogIH0KfQpjbGFzcyBTb2FwQWRkcmVzcyBleHRlbmRzIF94ZmFfb2JqZWN0LlN0cmluZ09iamVjdCB7CiAgY29uc3RydWN0b3IoYXR0cmlidXRlcykgewogICAgc3VwZXIoQ09OTkVDVElPTl9TRVRfTlNfSUQsICJzb2FwQWRkcmVzcyIpOwogICAgdGhpcy5pZCA9IGF0dHJpYnV0ZXMuaWQgfHwgIiI7CiAgICB0aGlzLm5hbWUgPSBhdHRyaWJ1dGVzLm5hbWUgfHwgIiI7CiAgICB0aGlzLnVzZSA9IGF0dHJpYnV0ZXMudXNlIHx8ICIiOwogICAgdGhpcy51c2VocmVmID0gYXR0cmlidXRlcy51c2VocmVmIHx8ICIiOwogIH0KfQpjbGFzcyBVcmkgZXh0ZW5kcyBfeGZhX29iamVjdC5TdHJpbmdPYmplY3QgewogIGNvbnN0cnVjdG9yKGF0dHJpYnV0ZXMpIHsKICAgIHN1cGVyKENPTk5FQ1RJT05fU0VUX05TX0lELCAidXJpIik7CiAgICB0aGlzLmlkID0gYXR0cmlidXRlcy5pZCB8fCAiIjsKICAgIHRoaXMubmFtZSA9IGF0dHJpYnV0ZXMubmFtZSB8fCAiIjsKICAgIHRoaXMudXNlID0gYXR0cmlidXRlcy51c2UgfHwgIiI7CiAgICB0aGlzLnVzZWhyZWYgPSBhdHRyaWJ1dGVzLnVzZWhyZWYgfHwgIiI7CiAgfQp9CmNsYXNzIFdzZGxBZGRyZXNzIGV4dGVuZHMgX3hmYV9vYmplY3QuU3RyaW5nT2JqZWN0IHsKICBjb25zdHJ1Y3RvcihhdHRyaWJ1dGVzKSB7CiAgICBzdXBlcihDT05ORUNUSU9OX1NFVF9OU19JRCwgIndzZGxBZGRyZXNzIik7CiAgICB0aGlzLmlkID0gYXR0cmlidXRlcy5pZCB8fCAiIjsKICAgIHRoaXMubmFtZSA9IGF0dHJpYnV0ZXMubmFtZSB8fCAiIjsKICAgIHRoaXMudXNlID0gYXR0cmlidXRlcy51c2UgfHwgIiI7CiAgICB0aGlzLnVzZWhyZWYgPSBhdHRyaWJ1dGVzLnVzZWhyZWYgfHwgIiI7CiAgfQp9CmNsYXNzIFdzZGxDb25uZWN0aW9uIGV4dGVuZHMgX3hmYV9vYmplY3QuWEZBT2JqZWN0IHsKICBjb25zdHJ1Y3RvcihhdHRyaWJ1dGVzKSB7CiAgICBzdXBlcihDT05ORUNUSU9OX1NFVF9OU19JRCwgIndzZGxDb25uZWN0aW9uIiwgdHJ1ZSk7CiAgICB0aGlzLmRhdGFEZXNjcmlwdGlvbiA9IGF0dHJpYnV0ZXMuZGF0YURlc2NyaXB0aW9uIHx8ICIiOwogICAgdGhpcy5uYW1lID0gYXR0cmlidXRlcy5uYW1lIHx8ICIiOwogICAgdGhpcy5lZmZlY3RpdmVJbnB1dFBvbGljeSA9IG51bGw7CiAgICB0aGlzLmVmZmVjdGl2ZU91dHB1dFBvbGljeSA9IG51bGw7CiAgICB0aGlzLm9wZXJhdGlvbiA9IG51bGw7CiAgICB0aGlzLnNvYXBBY3Rpb24gPSBudWxsOwogICAgdGhpcy5zb2FwQWRkcmVzcyA9IG51bGw7CiAgICB0aGlzLndzZGxBZGRyZXNzID0gbnVsbDsKICB9Cn0KY2xhc3MgWG1sQ29ubmVjdGlvbiBleHRlbmRzIF94ZmFfb2JqZWN0LlhGQU9iamVjdCB7CiAgY29uc3RydWN0b3IoYXR0cmlidXRlcykgewogICAgc3VwZXIoQ09OTkVDVElPTl9TRVRfTlNfSUQsICJ4bWxDb25uZWN0aW9uIiwgdHJ1ZSk7CiAgICB0aGlzLmRhdGFEZXNjcmlwdGlvbiA9IGF0dHJpYnV0ZXMuZGF0YURlc2NyaXB0aW9uIHx8ICIiOwogICAgdGhpcy5uYW1lID0gYXR0cmlidXRlcy5uYW1lIHx8ICIiOwogICAgdGhpcy51cmkgPSBudWxsOwogIH0KfQpjbGFzcyBYc2RDb25uZWN0aW9uIGV4dGVuZHMgX3hmYV9vYmplY3QuWEZBT2JqZWN0IHsKICBjb25zdHJ1Y3RvcihhdHRyaWJ1dGVzKSB7CiAgICBzdXBlcihDT05ORUNUSU9OX1NFVF9OU19JRCwgInhzZENvbm5lY3Rpb24iLCB0cnVlKTsKICAgIHRoaXMuZGF0YURlc2NyaXB0aW9uID0gYXR0cmlidXRlcy5kYXRhRGVzY3JpcHRpb24gfHwgIiI7CiAgICB0aGlzLm5hbWUgPSBhdHRyaWJ1dGVzLm5hbWUgfHwgIiI7CiAgICB0aGlzLnJvb3RFbGVtZW50ID0gbnVsbDsKICAgIHRoaXMudXJpID0gbnVsbDsKICB9Cn0KY2xhc3MgQ29ubmVjdGlvblNldE5hbWVzcGFjZSB7CiAgc3RhdGljIFtfbmFtZXNwYWNlcy4kYnVpbGRYRkFPYmplY3RdKG5hbWUsIGF0dHJpYnV0ZXMpIHsKICAgIGlmIChDb25uZWN0aW9uU2V0TmFtZXNwYWNlLmhhc093blByb3BlcnR5KG5hbWUpKSB7CiAgICAgIHJldHVybiBDb25uZWN0aW9uU2V0TmFtZXNwYWNlW25hbWVdKGF0dHJpYnV0ZXMpOwogICAgfQogICAgcmV0dXJuIHVuZGVmaW5lZDsKICB9CiAgc3RhdGljIGNvbm5lY3Rpb25TZXQoYXR0cnMpIHsKICAgIHJldHVybiBuZXcgQ29ubmVjdGlvblNldChhdHRycyk7CiAgfQogIHN0YXRpYyBlZmZlY3RpdmVJbnB1dFBvbGljeShhdHRycykgewogICAgcmV0dXJuIG5ldyBFZmZlY3RpdmVJbnB1dFBvbGljeShhdHRycyk7CiAgfQogIHN0YXRpYyBlZmZlY3RpdmVPdXRwdXRQb2xpY3koYXR0cnMpIHsKICAgIHJldHVybiBuZXcgRWZmZWN0aXZlT3V0cHV0UG9saWN5KGF0dHJzKTsKICB9CiAgc3RhdGljIG9wZXJhdGlvbihhdHRycykgewogICAgcmV0dXJuIG5ldyBPcGVyYXRpb24oYXR0cnMpOwogIH0KICBzdGF0aWMgcm9vdEVsZW1lbnQoYXR0cnMpIHsKICAgIHJldHVybiBuZXcgUm9vdEVsZW1lbnQoYXR0cnMpOwogIH0KICBzdGF0aWMgc29hcEFjdGlvbihhdHRycykgewogICAgcmV0dXJuIG5ldyBTb2FwQWN0aW9uKGF0dHJzKTsKICB9CiAgc3RhdGljIHNvYXBBZGRyZXNzKGF0dHJzKSB7CiAgICByZXR1cm4gbmV3IFNvYXBBZGRyZXNzKGF0dHJzKTsKICB9CiAgc3RhdGljIHVyaShhdHRycykgewogICAgcmV0dXJuIG5ldyBVcmkoYXR0cnMpOwogIH0KICBzdGF0aWMgd3NkbEFkZHJlc3MoYXR0cnMpIHsKICAgIHJldHVybiBuZXcgV3NkbEFkZHJlc3MoYXR0cnMpOwogIH0KICBzdGF0aWMgd3NkbENvbm5lY3Rpb24oYXR0cnMpIHsKICAgIHJldHVybiBuZXcgV3NkbENvbm5lY3Rpb24oYXR0cnMpOwogIH0KICBzdGF0aWMgeG1sQ29ubmVjdGlvbihhdHRycykgewogICAgcmV0dXJuIG5ldyBYbWxDb25uZWN0aW9uKGF0dHJzKTsKICB9CiAgc3RhdGljIHhzZENvbm5lY3Rpb24oYXR0cnMpIHsKICAgIHJldHVybiBuZXcgWHNkQ29ubmVjdGlvbihhdHRycyk7CiAgfQp9CmV4cG9ydHMuQ29ubmVjdGlvblNldE5hbWVzcGFjZSA9IENvbm5lY3Rpb25TZXROYW1lc3BhY2U7CgovKioqLyB9KSwKLyogOTUgKi8KLyoqKi8gKChfX3VudXNlZF93ZWJwYWNrX21vZHVsZSwgZXhwb3J0cywgX193X3BkZmpzX3JlcXVpcmVfXykgPT4gewoKCgpPYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgIl9fZXNNb2R1bGUiLCAoewogIHZhbHVlOiB0cnVlCn0pKTsKZXhwb3J0cy5EYXRhc2V0c05hbWVzcGFjZSA9IHZvaWQgMDsKdmFyIF9zeW1ib2xfdXRpbHMgPSBfX3dfcGRmanNfcmVxdWlyZV9fKDc4KTsKdmFyIF9uYW1lc3BhY2VzID0gX193X3BkZmpzX3JlcXVpcmVfXyg4MSk7CnZhciBfeGZhX29iamVjdCA9IF9fd19wZGZqc19yZXF1aXJlX18oODcpOwpjb25zdCBEQVRBU0VUU19OU19JRCA9IF9uYW1lc3BhY2VzLk5hbWVzcGFjZUlkcy5kYXRhc2V0cy5pZDsKY2xhc3MgRGF0YSBleHRlbmRzIF94ZmFfb2JqZWN0LlhtbE9iamVjdCB7CiAgY29uc3RydWN0b3IoYXR0cmlidXRlcykgewogICAgc3VwZXIoREFUQVNFVFNfTlNfSUQsICJkYXRhIiwgYXR0cmlidXRlcyk7CiAgfQogIFtfc3ltYm9sX3V0aWxzLiRpc05zQWdub3N0aWNdKCkgewogICAgcmV0dXJuIHRydWU7CiAgfQp9CmNsYXNzIERhdGFzZXRzIGV4dGVuZHMgX3hmYV9vYmplY3QuWEZBT2JqZWN0IHsKICBjb25zdHJ1Y3RvcihhdHRyaWJ1dGVzKSB7CiAgICBzdXBlcihEQVRBU0VUU19OU19JRCwgImRhdGFzZXRzIiwgdHJ1ZSk7CiAgICB0aGlzLmRhdGEgPSBudWxsOwogICAgdGhpcy5TaWduYXR1cmUgPSBudWxsOwogIH0KICBbX3N5bWJvbF91dGlscy4kb25DaGlsZF0oY2hpbGQpIHsKICAgIGNvbnN0IG5hbWUgPSBjaGlsZFtfc3ltYm9sX3V0aWxzLiRub2RlTmFtZV07CiAgICBpZiAobmFtZSA9PT0gImRhdGEiICYmIGNoaWxkW19zeW1ib2xfdXRpbHMuJG5hbWVzcGFjZUlkXSA9PT0gREFUQVNFVFNfTlNfSUQgfHwgbmFtZSA9PT0gIlNpZ25hdHVyZSIgJiYgY2hpbGRbX3N5bWJvbF91dGlscy4kbmFtZXNwYWNlSWRdID09PSBfbmFtZXNwYWNlcy5OYW1lc3BhY2VJZHMuc2lnbmF0dXJlLmlkKSB7CiAgICAgIHRoaXNbbmFtZV0gPSBjaGlsZDsKICAgIH0KICAgIHRoaXNbX3N5bWJvbF91dGlscy4kYXBwZW5kQ2hpbGRdKGNoaWxkKTsKICB9Cn0KY2xhc3MgRGF0YXNldHNOYW1lc3BhY2UgewogIHN0YXRpYyBbX25hbWVzcGFjZXMuJGJ1aWxkWEZBT2JqZWN0XShuYW1lLCBhdHRyaWJ1dGVzKSB7CiAgICBpZiAoRGF0YXNldHNOYW1lc3BhY2UuaGFzT3duUHJvcGVydHkobmFtZSkpIHsKICAgICAgcmV0dXJuIERhdGFzZXRzTmFtZXNwYWNlW25hbWVdKGF0dHJpYnV0ZXMpOwogICAgfQogICAgcmV0dXJuIHVuZGVmaW5lZDsKICB9CiAgc3RhdGljIGRhdGFzZXRzKGF0dHJpYnV0ZXMpIHsKICAgIHJldHVybiBuZXcgRGF0YXNldHMoYXR0cmlidXRlcyk7CiAgfQogIHN0YXRpYyBkYXRhKGF0dHJpYnV0ZXMpIHsKICAgIHJldHVybiBuZXcgRGF0YShhdHRyaWJ1dGVzKTsKICB9Cn0KZXhwb3J0cy5EYXRhc2V0c05hbWVzcGFjZSA9IERhdGFzZXRzTmFtZXNwYWNlOwoKLyoqKi8gfSksCi8qIDk2ICovCi8qKiovICgoX191bnVzZWRfd2VicGFja19tb2R1bGUsIGV4cG9ydHMsIF9fd19wZGZqc19yZXF1aXJlX18pID0+IHsKCgoKT2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsICJfX2VzTW9kdWxlIiwgKHsKICB2YWx1ZTogdHJ1ZQp9KSk7CmV4cG9ydHMuTG9jYWxlU2V0TmFtZXNwYWNlID0gdm9pZCAwOwp2YXIgX25hbWVzcGFjZXMgPSBfX3dfcGRmanNfcmVxdWlyZV9fKDgxKTsKdmFyIF94ZmFfb2JqZWN0ID0gX193X3BkZmpzX3JlcXVpcmVfXyg4Nyk7CnZhciBfdXRpbHMgPSBfX3dfcGRmanNfcmVxdWlyZV9fKDg0KTsKY29uc3QgTE9DQUxFX1NFVF9OU19JRCA9IF9uYW1lc3BhY2VzLk5hbWVzcGFjZUlkcy5sb2NhbGVTZXQuaWQ7CmNsYXNzIENhbGVuZGFyU3ltYm9scyBleHRlbmRzIF94ZmFfb2JqZWN0LlhGQU9iamVjdCB7CiAgY29uc3RydWN0b3IoYXR0cmlidXRlcykgewogICAgc3VwZXIoTE9DQUxFX1NFVF9OU19JRCwgImNhbGVuZGFyU3ltYm9scyIsIHRydWUpOwogICAgdGhpcy5uYW1lID0gImdyZWdvcmlhbiI7CiAgICB0aGlzLmRheU5hbWVzID0gbmV3IF94ZmFfb2JqZWN0LlhGQU9iamVjdEFycmF5KDIpOwogICAgdGhpcy5lcmFOYW1lcyA9IG51bGw7CiAgICB0aGlzLm1lcmlkaWVtTmFtZXMgPSBudWxsOwogICAgdGhpcy5tb250aE5hbWVzID0gbmV3IF94ZmFfb2JqZWN0LlhGQU9iamVjdEFycmF5KDIpOwogIH0KfQpjbGFzcyBDdXJyZW5jeVN5bWJvbCBleHRlbmRzIF94ZmFfb2JqZWN0LlN0cmluZ09iamVjdCB7CiAgY29uc3RydWN0b3IoYXR0cmlidXRlcykgewogICAgc3VwZXIoTE9DQUxFX1NFVF9OU19JRCwgImN1cnJlbmN5U3ltYm9sIik7CiAgICB0aGlzLm5hbWUgPSAoMCwgX3V0aWxzLmdldFN0cmluZ09wdGlvbikoYXR0cmlidXRlcy5uYW1lLCBbInN5bWJvbCIsICJpc29uYW1lIiwgImRlY2ltYWwiXSk7CiAgfQp9CmNsYXNzIEN1cnJlbmN5U3ltYm9scyBleHRlbmRzIF94ZmFfb2JqZWN0LlhGQU9iamVjdCB7CiAgY29uc3RydWN0b3IoYXR0cmlidXRlcykgewogICAgc3VwZXIoTE9DQUxFX1NFVF9OU19JRCwgImN1cnJlbmN5U3ltYm9scyIsIHRydWUpOwogICAgdGhpcy5jdXJyZW5jeVN5bWJvbCA9IG5ldyBfeGZhX29iamVjdC5YRkFPYmplY3RBcnJheSgzKTsKICB9Cn0KY2xhc3MgRGF0ZVBhdHRlcm4gZXh0ZW5kcyBfeGZhX29iamVjdC5TdHJpbmdPYmplY3QgewogIGNvbnN0cnVjdG9yKGF0dHJpYnV0ZXMpIHsKICAgIHN1cGVyKExPQ0FMRV9TRVRfTlNfSUQsICJkYXRlUGF0dGVybiIpOwogICAgdGhpcy5uYW1lID0gKDAsIF91dGlscy5nZXRTdHJpbmdPcHRpb24pKGF0dHJpYnV0ZXMubmFtZSwgWyJmdWxsIiwgImxvbmciLCAibWVkIiwgInNob3J0Il0pOwogIH0KfQpjbGFzcyBEYXRlUGF0dGVybnMgZXh0ZW5kcyBfeGZhX29iamVjdC5YRkFPYmplY3QgewogIGNvbnN0cnVjdG9yKGF0dHJpYnV0ZXMpIHsKICAgIHN1cGVyKExPQ0FMRV9TRVRfTlNfSUQsICJkYXRlUGF0dGVybnMiLCB0cnVlKTsKICAgIHRoaXMuZGF0ZVBhdHRlcm4gPSBuZXcgX3hmYV9vYmplY3QuWEZBT2JqZWN0QXJyYXkoNCk7CiAgfQp9CmNsYXNzIERhdGVUaW1lU3ltYm9scyBleHRlbmRzIF94ZmFfb2JqZWN0LkNvbnRlbnRPYmplY3QgewogIGNvbnN0cnVjdG9yKGF0dHJpYnV0ZXMpIHsKICAgIHN1cGVyKExPQ0FMRV9TRVRfTlNfSUQsICJkYXRlVGltZVN5bWJvbHMiKTsKICB9Cn0KY2xhc3MgRGF5IGV4dGVuZHMgX3hmYV9vYmplY3QuU3RyaW5nT2JqZWN0IHsKICBjb25zdHJ1Y3RvcihhdHRyaWJ1dGVzKSB7CiAgICBzdXBlcihMT0NBTEVfU0VUX05TX0lELCAiZGF5Iik7CiAgfQp9CmNsYXNzIERheU5hbWVzIGV4dGVuZHMgX3hmYV9vYmplY3QuWEZBT2JqZWN0IHsKICBjb25zdHJ1Y3RvcihhdHRyaWJ1dGVzKSB7CiAgICBzdXBlcihMT0NBTEVfU0VUX05TX0lELCAiZGF5TmFtZXMiLCB0cnVlKTsKICAgIHRoaXMuYWJiciA9ICgwLCBfdXRpbHMuZ2V0SW50ZWdlcikoewogICAgICBkYXRhOiBhdHRyaWJ1dGVzLmFiYnIsCiAgICAgIGRlZmF1bHRWYWx1ZTogMCwKICAgICAgdmFsaWRhdGU6IHggPT4geCA9PT0gMQogICAgfSk7CiAgICB0aGlzLmRheSA9IG5ldyBfeGZhX29iamVjdC5YRkFPYmplY3RBcnJheSg3KTsKICB9Cn0KY2xhc3MgRXJhIGV4dGVuZHMgX3hmYV9vYmplY3QuU3RyaW5nT2JqZWN0IHsKICBjb25zdHJ1Y3RvcihhdHRyaWJ1dGVzKSB7CiAgICBzdXBlcihMT0NBTEVfU0VUX05TX0lELCAiZXJhIik7CiAgfQp9CmNsYXNzIEVyYU5hbWVzIGV4dGVuZHMgX3hmYV9vYmplY3QuWEZBT2JqZWN0IHsKICBjb25zdHJ1Y3RvcihhdHRyaWJ1dGVzKSB7CiAgICBzdXBlcihMT0NBTEVfU0VUX05TX0lELCAiZXJhTmFtZXMiLCB0cnVlKTsKICAgIHRoaXMuZXJhID0gbmV3IF94ZmFfb2JqZWN0LlhGQU9iamVjdEFycmF5KDIpOwogIH0KfQpjbGFzcyBMb2NhbGUgZXh0ZW5kcyBfeGZhX29iamVjdC5YRkFPYmplY3QgewogIGNvbnN0cnVjdG9yKGF0dHJpYnV0ZXMpIHsKICAgIHN1cGVyKExPQ0FMRV9TRVRfTlNfSUQsICJsb2NhbGUiLCB0cnVlKTsKICAgIHRoaXMuZGVzYyA9IGF0dHJpYnV0ZXMuZGVzYyB8fCAiIjsKICAgIHRoaXMubmFtZSA9ICJpc29uYW1lIjsKICAgIHRoaXMuY2FsZW5kYXJTeW1ib2xzID0gbnVsbDsKICAgIHRoaXMuY3VycmVuY3lTeW1ib2xzID0gbnVsbDsKICAgIHRoaXMuZGF0ZVBhdHRlcm5zID0gbnVsbDsKICAgIHRoaXMuZGF0ZVRpbWVTeW1ib2xzID0gbnVsbDsKICAgIHRoaXMubnVtYmVyUGF0dGVybnMgPSBudWxsOwogICAgdGhpcy5udW1iZXJTeW1ib2xzID0gbnVsbDsKICAgIHRoaXMudGltZVBhdHRlcm5zID0gbnVsbDsKICAgIHRoaXMudHlwZUZhY2VzID0gbnVsbDsKICB9Cn0KY2xhc3MgTG9jYWxlU2V0IGV4dGVuZHMgX3hmYV9vYmplY3QuWEZBT2JqZWN0IHsKICBjb25zdHJ1Y3RvcihhdHRyaWJ1dGVzKSB7CiAgICBzdXBlcihMT0NBTEVfU0VUX05TX0lELCAibG9jYWxlU2V0IiwgdHJ1ZSk7CiAgICB0aGlzLmxvY2FsZSA9IG5ldyBfeGZhX29iamVjdC5YRkFPYmplY3RBcnJheSgpOwogIH0KfQpjbGFzcyBNZXJpZGllbSBleHRlbmRzIF94ZmFfb2JqZWN0LlN0cmluZ09iamVjdCB7CiAgY29uc3RydWN0b3IoYXR0cmlidXRlcykgewogICAgc3VwZXIoTE9DQUxFX1NFVF9OU19JRCwgIm1lcmlkaWVtIik7CiAgfQp9CmNsYXNzIE1lcmlkaWVtTmFtZXMgZXh0ZW5kcyBfeGZhX29iamVjdC5YRkFPYmplY3QgewogIGNvbnN0cnVjdG9yKGF0dHJpYnV0ZXMpIHsKICAgIHN1cGVyKExPQ0FMRV9TRVRfTlNfSUQsICJtZXJpZGllbU5hbWVzIiwgdHJ1ZSk7CiAgICB0aGlzLm1lcmlkaWVtID0gbmV3IF94ZmFfb2JqZWN0LlhGQU9iamVjdEFycmF5KDIpOwogIH0KfQpjbGFzcyBNb250aCBleHRlbmRzIF94ZmFfb2JqZWN0LlN0cmluZ09iamVjdCB7CiAgY29uc3RydWN0b3IoYXR0cmlidXRlcykgewogICAgc3VwZXIoTE9DQUxFX1NFVF9OU19JRCwgIm1vbnRoIik7CiAgfQp9CmNsYXNzIE1vbnRoTmFtZXMgZXh0ZW5kcyBfeGZhX29iamVjdC5YRkFPYmplY3QgewogIGNvbnN0cnVjdG9yKGF0dHJpYnV0ZXMpIHsKICAgIHN1cGVyKExPQ0FMRV9TRVRfTlNfSUQsICJtb250aE5hbWVzIiwgdHJ1ZSk7CiAgICB0aGlzLmFiYnIgPSAoMCwgX3V0aWxzLmdldEludGVnZXIpKHsKICAgICAgZGF0YTogYXR0cmlidXRlcy5hYmJyLAogICAgICBkZWZhdWx0VmFsdWU6IDAsCiAgICAgIHZhbGlkYXRlOiB4ID0+IHggPT09IDEKICAgIH0pOwogICAgdGhpcy5tb250aCA9IG5ldyBfeGZhX29iamVjdC5YRkFPYmplY3RBcnJheSgxMik7CiAgfQp9CmNsYXNzIE51bWJlclBhdHRlcm4gZXh0ZW5kcyBfeGZhX29iamVjdC5TdHJpbmdPYmplY3QgewogIGNvbnN0cnVjdG9yKGF0dHJpYnV0ZXMpIHsKICAgIHN1cGVyKExPQ0FMRV9TRVRfTlNfSUQsICJudW1iZXJQYXR0ZXJuIik7CiAgICB0aGlzLm5hbWUgPSAoMCwgX3V0aWxzLmdldFN0cmluZ09wdGlvbikoYXR0cmlidXRlcy5uYW1lLCBbImZ1bGwiLCAibG9uZyIsICJtZWQiLCAic2hvcnQiXSk7CiAgfQp9CmNsYXNzIE51bWJlclBhdHRlcm5zIGV4dGVuZHMgX3hmYV9vYmplY3QuWEZBT2JqZWN0IHsKICBjb25zdHJ1Y3RvcihhdHRyaWJ1dGVzKSB7CiAgICBzdXBlcihMT0NBTEVfU0VUX05TX0lELCAibnVtYmVyUGF0dGVybnMiLCB0cnVlKTsKICAgIHRoaXMubnVtYmVyUGF0dGVybiA9IG5ldyBfeGZhX29iamVjdC5YRkFPYmplY3RBcnJheSg0KTsKICB9Cn0KY2xhc3MgTnVtYmVyU3ltYm9sIGV4dGVuZHMgX3hmYV9vYmplY3QuU3RyaW5nT2JqZWN0IHsKICBjb25zdHJ1Y3RvcihhdHRyaWJ1dGVzKSB7CiAgICBzdXBlcihMT0NBTEVfU0VUX05TX0lELCAibnVtYmVyU3ltYm9sIik7CiAgICB0aGlzLm5hbWUgPSAoMCwgX3V0aWxzLmdldFN0cmluZ09wdGlvbikoYXR0cmlidXRlcy5uYW1lLCBbImRlY2ltYWwiLCAiZ3JvdXBpbmciLCAicGVyY2VudCIsICJtaW51cyIsICJ6ZXJvIl0pOwogIH0KfQpjbGFzcyBOdW1iZXJTeW1ib2xzIGV4dGVuZHMgX3hmYV9vYmplY3QuWEZBT2JqZWN0IHsKICBjb25zdHJ1Y3RvcihhdHRyaWJ1dGVzKSB7CiAgICBzdXBlcihMT0NBTEVfU0VUX05TX0lELCAibnVtYmVyU3ltYm9scyIsIHRydWUpOwogICAgdGhpcy5udW1iZXJTeW1ib2wgPSBuZXcgX3hmYV9vYmplY3QuWEZBT2JqZWN0QXJyYXkoNSk7CiAgfQp9CmNsYXNzIFRpbWVQYXR0ZXJuIGV4dGVuZHMgX3hmYV9vYmplY3QuU3RyaW5nT2JqZWN0IHsKICBjb25zdHJ1Y3RvcihhdHRyaWJ1dGVzKSB7CiAgICBzdXBlcihMT0NBTEVfU0VUX05TX0lELCAidGltZVBhdHRlcm4iKTsKICAgIHRoaXMubmFtZSA9ICgwLCBfdXRpbHMuZ2V0U3RyaW5nT3B0aW9uKShhdHRyaWJ1dGVzLm5hbWUsIFsiZnVsbCIsICJsb25nIiwgIm1lZCIsICJzaG9ydCJdKTsKICB9Cn0KY2xhc3MgVGltZVBhdHRlcm5zIGV4dGVuZHMgX3hmYV9vYmplY3QuWEZBT2JqZWN0IHsKICBjb25zdHJ1Y3RvcihhdHRyaWJ1dGVzKSB7CiAgICBzdXBlcihMT0NBTEVfU0VUX05TX0lELCAidGltZVBhdHRlcm5zIiwgdHJ1ZSk7CiAgICB0aGlzLnRpbWVQYXR0ZXJuID0gbmV3IF94ZmFfb2JqZWN0LlhGQU9iamVjdEFycmF5KDQpOwogIH0KfQpjbGFzcyBUeXBlRmFjZSBleHRlbmRzIF94ZmFfb2JqZWN0LlhGQU9iamVjdCB7CiAgY29uc3RydWN0b3IoYXR0cmlidXRlcykgewogICAgc3VwZXIoTE9DQUxFX1NFVF9OU19JRCwgInR5cGVGYWNlIiwgdHJ1ZSk7CiAgICB0aGlzLm5hbWUgPSBhdHRyaWJ1dGVzLm5hbWUgfCAiIjsKICB9Cn0KY2xhc3MgVHlwZUZhY2VzIGV4dGVuZHMgX3hmYV9vYmplY3QuWEZBT2JqZWN0IHsKICBjb25zdHJ1Y3RvcihhdHRyaWJ1dGVzKSB7CiAgICBzdXBlcihMT0NBTEVfU0VUX05TX0lELCAidHlwZUZhY2VzIiwgdHJ1ZSk7CiAgICB0aGlzLnR5cGVGYWNlID0gbmV3IF94ZmFfb2JqZWN0LlhGQU9iamVjdEFycmF5KCk7CiAgfQp9CmNsYXNzIExvY2FsZVNldE5hbWVzcGFjZSB7CiAgc3RhdGljIFtfbmFtZXNwYWNlcy4kYnVpbGRYRkFPYmplY3RdKG5hbWUsIGF0dHJpYnV0ZXMpIHsKICAgIGlmIChMb2NhbGVTZXROYW1lc3BhY2UuaGFzT3duUHJvcGVydHkobmFtZSkpIHsKICAgICAgcmV0dXJuIExvY2FsZVNldE5hbWVzcGFjZVtuYW1lXShhdHRyaWJ1dGVzKTsKICAgIH0KICAgIHJldHVybiB1bmRlZmluZWQ7CiAgfQogIHN0YXRpYyBjYWxlbmRhclN5bWJvbHMoYXR0cnMpIHsKICAgIHJldHVybiBuZXcgQ2FsZW5kYXJTeW1ib2xzKGF0dHJzKTsKICB9CiAgc3RhdGljIGN1cnJlbmN5U3ltYm9sKGF0dHJzKSB7CiAgICByZXR1cm4gbmV3IEN1cnJlbmN5U3ltYm9sKGF0dHJzKTsKICB9CiAgc3RhdGljIGN1cnJlbmN5U3ltYm9scyhhdHRycykgewogICAgcmV0dXJuIG5ldyBDdXJyZW5jeVN5bWJvbHMoYXR0cnMpOwogIH0KICBzdGF0aWMgZGF0ZVBhdHRlcm4oYXR0cnMpIHsKICAgIHJldHVybiBuZXcgRGF0ZVBhdHRlcm4oYXR0cnMpOwogIH0KICBzdGF0aWMgZGF0ZVBhdHRlcm5zKGF0dHJzKSB7CiAgICByZXR1cm4gbmV3IERhdGVQYXR0ZXJucyhhdHRycyk7CiAgfQogIHN0YXRpYyBkYXRlVGltZVN5bWJvbHMoYXR0cnMpIHsKICAgIHJldHVybiBuZXcgRGF0ZVRpbWVTeW1ib2xzKGF0dHJzKTsKICB9CiAgc3RhdGljIGRheShhdHRycykgewogICAgcmV0dXJuIG5ldyBEYXkoYXR0cnMpOwogIH0KICBzdGF0aWMgZGF5TmFtZXMoYXR0cnMpIHsKICAgIHJldHVybiBuZXcgRGF5TmFtZXMoYXR0cnMpOwogIH0KICBzdGF0aWMgZXJhKGF0dHJzKSB7CiAgICByZXR1cm4gbmV3IEVyYShhdHRycyk7CiAgfQogIHN0YXRpYyBlcmFOYW1lcyhhdHRycykgewogICAgcmV0dXJuIG5ldyBFcmFOYW1lcyhhdHRycyk7CiAgfQogIHN0YXRpYyBsb2NhbGUoYXR0cnMpIHsKICAgIHJldHVybiBuZXcgTG9jYWxlKGF0dHJzKTsKICB9CiAgc3RhdGljIGxvY2FsZVNldChhdHRycykgewogICAgcmV0dXJuIG5ldyBMb2NhbGVTZXQoYXR0cnMpOwogIH0KICBzdGF0aWMgbWVyaWRpZW0oYXR0cnMpIHsKICAgIHJldHVybiBuZXcgTWVyaWRpZW0oYXR0cnMpOwogIH0KICBzdGF0aWMgbWVyaWRpZW1OYW1lcyhhdHRycykgewogICAgcmV0dXJuIG5ldyBNZXJpZGllbU5hbWVzKGF0dHJzKTsKICB9CiAgc3RhdGljIG1vbnRoKGF0dHJzKSB7CiAgICByZXR1cm4gbmV3IE1vbnRoKGF0dHJzKTsKICB9CiAgc3RhdGljIG1vbnRoTmFtZXMoYXR0cnMpIHsKICAgIHJldHVybiBuZXcgTW9udGhOYW1lcyhhdHRycyk7CiAgfQogIHN0YXRpYyBudW1iZXJQYXR0ZXJuKGF0dHJzKSB7CiAgICByZXR1cm4gbmV3IE51bWJlclBhdHRlcm4oYXR0cnMpOwogIH0KICBzdGF0aWMgbnVtYmVyUGF0dGVybnMoYXR0cnMpIHsKICAgIHJldHVybiBuZXcgTnVtYmVyUGF0dGVybnMoYXR0cnMpOwogIH0KICBzdGF0aWMgbnVtYmVyU3ltYm9sKGF0dHJzKSB7CiAgICByZXR1cm4gbmV3IE51bWJlclN5bWJvbChhdHRycyk7CiAgfQogIHN0YXRpYyBudW1iZXJTeW1ib2xzKGF0dHJzKSB7CiAgICByZXR1cm4gbmV3IE51bWJlclN5bWJvbHMoYXR0cnMpOwogIH0KICBzdGF0aWMgdGltZVBhdHRlcm4oYXR0cnMpIHsKICAgIHJldHVybiBuZXcgVGltZVBhdHRlcm4oYXR0cnMpOwogIH0KICBzdGF0aWMgdGltZVBhdHRlcm5zKGF0dHJzKSB7CiAgICByZXR1cm4gbmV3IFRpbWVQYXR0ZXJucyhhdHRycyk7CiAgfQogIHN0YXRpYyB0eXBlRmFjZShhdHRycykgewogICAgcmV0dXJuIG5ldyBUeXBlRmFjZShhdHRycyk7CiAgfQogIHN0YXRpYyB0eXBlRmFjZXMoYXR0cnMpIHsKICAgIHJldHVybiBuZXcgVHlwZUZhY2VzKGF0dHJzKTsKICB9Cn0KZXhwb3J0cy5Mb2NhbGVTZXROYW1lc3BhY2UgPSBMb2NhbGVTZXROYW1lc3BhY2U7CgovKioqLyB9KSwKLyogOTcgKi8KLyoqKi8gKChfX3VudXNlZF93ZWJwYWNrX21vZHVsZSwgZXhwb3J0cywgX193X3BkZmpzX3JlcXVpcmVfXykgPT4gewoKCgpPYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgIl9fZXNNb2R1bGUiLCAoewogIHZhbHVlOiB0cnVlCn0pKTsKZXhwb3J0cy5TaWduYXR1cmVOYW1lc3BhY2UgPSB2b2lkIDA7CnZhciBfbmFtZXNwYWNlcyA9IF9fd19wZGZqc19yZXF1aXJlX18oODEpOwp2YXIgX3hmYV9vYmplY3QgPSBfX3dfcGRmanNfcmVxdWlyZV9fKDg3KTsKY29uc3QgU0lHTkFUVVJFX05TX0lEID0gX25hbWVzcGFjZXMuTmFtZXNwYWNlSWRzLnNpZ25hdHVyZS5pZDsKY2xhc3MgU2lnbmF0dXJlIGV4dGVuZHMgX3hmYV9vYmplY3QuWEZBT2JqZWN0IHsKICBjb25zdHJ1Y3RvcihhdHRyaWJ1dGVzKSB7CiAgICBzdXBlcihTSUdOQVRVUkVfTlNfSUQsICJzaWduYXR1cmUiLCB0cnVlKTsKICB9Cn0KY2xhc3MgU2lnbmF0dXJlTmFtZXNwYWNlIHsKICBzdGF0aWMgW19uYW1lc3BhY2VzLiRidWlsZFhGQU9iamVjdF0obmFtZSwgYXR0cmlidXRlcykgewogICAgaWYgKFNpZ25hdHVyZU5hbWVzcGFjZS5oYXNPd25Qcm9wZXJ0eShuYW1lKSkgewogICAgICByZXR1cm4gU2lnbmF0dXJlTmFtZXNwYWNlW25hbWVdKGF0dHJpYnV0ZXMpOwogICAgfQogICAgcmV0dXJuIHVuZGVmaW5lZDsKICB9CiAgc3RhdGljIHNpZ25hdHVyZShhdHRyaWJ1dGVzKSB7CiAgICByZXR1cm4gbmV3IFNpZ25hdHVyZShhdHRyaWJ1dGVzKTsKICB9Cn0KZXhwb3J0cy5TaWduYXR1cmVOYW1lc3BhY2UgPSBTaWduYXR1cmVOYW1lc3BhY2U7CgovKioqLyB9KSwKLyogOTggKi8KLyoqKi8gKChfX3VudXNlZF93ZWJwYWNrX21vZHVsZSwgZXhwb3J0cywgX193X3BkZmpzX3JlcXVpcmVfXykgPT4gewoKCgpPYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgIl9fZXNNb2R1bGUiLCAoewogIHZhbHVlOiB0cnVlCn0pKTsKZXhwb3J0cy5TdHlsZXNoZWV0TmFtZXNwYWNlID0gdm9pZCAwOwp2YXIgX25hbWVzcGFjZXMgPSBfX3dfcGRmanNfcmVxdWlyZV9fKDgxKTsKdmFyIF94ZmFfb2JqZWN0ID0gX193X3BkZmpzX3JlcXVpcmVfXyg4Nyk7CmNvbnN0IFNUWUxFU0hFRVRfTlNfSUQgPSBfbmFtZXNwYWNlcy5OYW1lc3BhY2VJZHMuc3R5bGVzaGVldC5pZDsKY2xhc3MgU3R5bGVzaGVldCBleHRlbmRzIF94ZmFfb2JqZWN0LlhGQU9iamVjdCB7CiAgY29uc3RydWN0b3IoYXR0cmlidXRlcykgewogICAgc3VwZXIoU1RZTEVTSEVFVF9OU19JRCwgInN0eWxlc2hlZXQiLCB0cnVlKTsKICB9Cn0KY2xhc3MgU3R5bGVzaGVldE5hbWVzcGFjZSB7CiAgc3RhdGljIFtfbmFtZXNwYWNlcy4kYnVpbGRYRkFPYmplY3RdKG5hbWUsIGF0dHJpYnV0ZXMpIHsKICAgIGlmIChTdHlsZXNoZWV0TmFtZXNwYWNlLmhhc093blByb3BlcnR5KG5hbWUpKSB7CiAgICAgIHJldHVybiBTdHlsZXNoZWV0TmFtZXNwYWNlW25hbWVdKGF0dHJpYnV0ZXMpOwogICAgfQogICAgcmV0dXJuIHVuZGVmaW5lZDsKICB9CiAgc3RhdGljIHN0eWxlc2hlZXQoYXR0cmlidXRlcykgewogICAgcmV0dXJuIG5ldyBTdHlsZXNoZWV0KGF0dHJpYnV0ZXMpOwogIH0KfQpleHBvcnRzLlN0eWxlc2hlZXROYW1lc3BhY2UgPSBTdHlsZXNoZWV0TmFtZXNwYWNlOwoKLyoqKi8gfSksCi8qIDk5ICovCi8qKiovICgoX191bnVzZWRfd2VicGFja19tb2R1bGUsIGV4cG9ydHMsIF9fd19wZGZqc19yZXF1aXJlX18pID0+IHsKCgoKT2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsICJfX2VzTW9kdWxlIiwgKHsKICB2YWx1ZTogdHJ1ZQp9KSk7CmV4cG9ydHMuWGRwTmFtZXNwYWNlID0gdm9pZCAwOwp2YXIgX25hbWVzcGFjZXMgPSBfX3dfcGRmanNfcmVxdWlyZV9fKDgxKTsKdmFyIF9zeW1ib2xfdXRpbHMgPSBfX3dfcGRmanNfcmVxdWlyZV9fKDc4KTsKdmFyIF94ZmFfb2JqZWN0ID0gX193X3BkZmpzX3JlcXVpcmVfXyg4Nyk7CmNvbnN0IFhEUF9OU19JRCA9IF9uYW1lc3BhY2VzLk5hbWVzcGFjZUlkcy54ZHAuaWQ7CmNsYXNzIFhkcCBleHRlbmRzIF94ZmFfb2JqZWN0LlhGQU9iamVjdCB7CiAgY29uc3RydWN0b3IoYXR0cmlidXRlcykgewogICAgc3VwZXIoWERQX05TX0lELCAieGRwIiwgdHJ1ZSk7CiAgICB0aGlzLnV1aWQgPSBhdHRyaWJ1dGVzLnV1aWQgfHwgIiI7CiAgICB0aGlzLnRpbWVTdGFtcCA9IGF0dHJpYnV0ZXMudGltZVN0YW1wIHx8ICIiOwogICAgdGhpcy5jb25maWcgPSBudWxsOwogICAgdGhpcy5jb25uZWN0aW9uU2V0ID0gbnVsbDsKICAgIHRoaXMuZGF0YXNldHMgPSBudWxsOwogICAgdGhpcy5sb2NhbGVTZXQgPSBudWxsOwogICAgdGhpcy5zdHlsZXNoZWV0ID0gbmV3IF94ZmFfb2JqZWN0LlhGQU9iamVjdEFycmF5KCk7CiAgICB0aGlzLnRlbXBsYXRlID0gbnVsbDsKICB9CiAgW19zeW1ib2xfdXRpbHMuJG9uQ2hpbGRDaGVja10oY2hpbGQpIHsKICAgIGNvbnN0IG5zID0gX25hbWVzcGFjZXMuTmFtZXNwYWNlSWRzW2NoaWxkW19zeW1ib2xfdXRpbHMuJG5vZGVOYW1lXV07CiAgICByZXR1cm4gbnMgJiYgY2hpbGRbX3N5bWJvbF91dGlscy4kbmFtZXNwYWNlSWRdID09PSBucy5pZDsKICB9Cn0KY2xhc3MgWGRwTmFtZXNwYWNlIHsKICBzdGF0aWMgW19uYW1lc3BhY2VzLiRidWlsZFhGQU9iamVjdF0obmFtZSwgYXR0cmlidXRlcykgewogICAgaWYgKFhkcE5hbWVzcGFjZS5oYXNPd25Qcm9wZXJ0eShuYW1lKSkgewogICAgICByZXR1cm4gWGRwTmFtZXNwYWNlW25hbWVdKGF0dHJpYnV0ZXMpOwogICAgfQogICAgcmV0dXJuIHVuZGVmaW5lZDsKICB9CiAgc3RhdGljIHhkcChhdHRyaWJ1dGVzKSB7CiAgICByZXR1cm4gbmV3IFhkcChhdHRyaWJ1dGVzKTsKICB9Cn0KZXhwb3J0cy5YZHBOYW1lc3BhY2UgPSBYZHBOYW1lc3BhY2U7CgovKioqLyB9KSwKLyogMTAwICovCi8qKiovICgoX191bnVzZWRfd2VicGFja19tb2R1bGUsIGV4cG9ydHMsIF9fd19wZGZqc19yZXF1aXJlX18pID0+IHsKCgoKT2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsICJfX2VzTW9kdWxlIiwgKHsKICB2YWx1ZTogdHJ1ZQp9KSk7CmV4cG9ydHMuWGh0bWxOYW1lc3BhY2UgPSB2b2lkIDA7CnZhciBfc3ltYm9sX3V0aWxzID0gX193X3BkZmpzX3JlcXVpcmVfXyg3OCk7CnZhciBfbmFtZXNwYWNlcyA9IF9fd19wZGZqc19yZXF1aXJlX18oODEpOwp2YXIgX2h0bWxfdXRpbHMgPSBfX3dfcGRmanNfcmVxdWlyZV9fKDgzKTsKdmFyIF91dGlscyA9IF9fd19wZGZqc19yZXF1aXJlX18oODQpOwp2YXIgX3hmYV9vYmplY3QgPSBfX3dfcGRmanNfcmVxdWlyZV9fKDg3KTsKY29uc3QgWEhUTUxfTlNfSUQgPSBfbmFtZXNwYWNlcy5OYW1lc3BhY2VJZHMueGh0bWwuaWQ7CmNvbnN0ICRyaWNoVGV4dCA9IFN5bWJvbCgpOwpjb25zdCBWQUxJRF9TVFlMRVMgPSBuZXcgU2V0KFsiY29sb3IiLCAiZm9udCIsICJmb250LWZhbWlseSIsICJmb250LXNpemUiLCAiZm9udC1zdHJldGNoIiwgImZvbnQtc3R5bGUiLCAiZm9udC13ZWlnaHQiLCAibWFyZ2luIiwgIm1hcmdpbi1ib3R0b20iLCAibWFyZ2luLWxlZnQiLCAibWFyZ2luLXJpZ2h0IiwgIm1hcmdpbi10b3AiLCAibGV0dGVyLXNwYWNpbmciLCAibGluZS1oZWlnaHQiLCAib3JwaGFucyIsICJwYWdlLWJyZWFrLWFmdGVyIiwgInBhZ2UtYnJlYWstYmVmb3JlIiwgInBhZ2UtYnJlYWstaW5zaWRlIiwgInRhYi1pbnRlcnZhbCIsICJ0YWItc3RvcCIsICJ0ZXh0LWFsaWduIiwgInRleHQtZGVjb3JhdGlvbiIsICJ0ZXh0LWluZGVudCIsICJ2ZXJ0aWNhbC1hbGlnbiIsICJ3aWRvd3MiLCAia2VybmluZy1tb2RlIiwgInhmYS1mb250LWhvcml6b250YWwtc2NhbGUiLCAieGZhLWZvbnQtdmVydGljYWwtc2NhbGUiLCAieGZhLXNwYWNlcnVuIiwgInhmYS10YWItc3RvcHMiXSk7CmNvbnN0IFN0eWxlTWFwcGluZyA9IG5ldyBNYXAoW1sicGFnZS1icmVhay1hZnRlciIsICJicmVha0FmdGVyIl0sIFsicGFnZS1icmVhay1iZWZvcmUiLCAiYnJlYWtCZWZvcmUiXSwgWyJwYWdlLWJyZWFrLWluc2lkZSIsICJicmVha0luc2lkZSJdLCBbImtlcm5pbmctbW9kZSIsIHZhbHVlID0+IHZhbHVlID09PSAibm9uZSIgPyAibm9uZSIgOiAibm9ybWFsIl0sIFsieGZhLWZvbnQtaG9yaXpvbnRhbC1zY2FsZSIsIHZhbHVlID0+IGBzY2FsZVgoJHtNYXRoLm1heCgwLCBNYXRoLm1pbihwYXJzZUludCh2YWx1ZSkgLyAxMDApKS50b0ZpeGVkKDIpfSlgXSwgWyJ4ZmEtZm9udC12ZXJ0aWNhbC1zY2FsZSIsIHZhbHVlID0+IGBzY2FsZVkoJHtNYXRoLm1heCgwLCBNYXRoLm1pbihwYXJzZUludCh2YWx1ZSkgLyAxMDApKS50b0ZpeGVkKDIpfSlgXSwgWyJ4ZmEtc3BhY2VydW4iLCAiIl0sIFsieGZhLXRhYi1zdG9wcyIsICIiXSwgWyJmb250LXNpemUiLCAodmFsdWUsIG9yaWdpbmFsKSA9PiB7CiAgdmFsdWUgPSBvcmlnaW5hbC5mb250U2l6ZSA9ICgwLCBfdXRpbHMuZ2V0TWVhc3VyZW1lbnQpKHZhbHVlKTsKICByZXR1cm4gKDAsIF9odG1sX3V0aWxzLm1lYXN1cmVUb1N0cmluZykoMC45OSAqIHZhbHVlKTsKfV0sIFsibGV0dGVyLXNwYWNpbmciLCB2YWx1ZSA9PiAoMCwgX2h0bWxfdXRpbHMubWVhc3VyZVRvU3RyaW5nKSgoMCwgX3V0aWxzLmdldE1lYXN1cmVtZW50KSh2YWx1ZSkpXSwgWyJsaW5lLWhlaWdodCIsIHZhbHVlID0+ICgwLCBfaHRtbF91dGlscy5tZWFzdXJlVG9TdHJpbmcpKCgwLCBfdXRpbHMuZ2V0TWVhc3VyZW1lbnQpKHZhbHVlKSldLCBbIm1hcmdpbiIsIHZhbHVlID0+ICgwLCBfaHRtbF91dGlscy5tZWFzdXJlVG9TdHJpbmcpKCgwLCBfdXRpbHMuZ2V0TWVhc3VyZW1lbnQpKHZhbHVlKSldLCBbIm1hcmdpbi1ib3R0b20iLCB2YWx1ZSA9PiAoMCwgX2h0bWxfdXRpbHMubWVhc3VyZVRvU3RyaW5nKSgoMCwgX3V0aWxzLmdldE1lYXN1cmVtZW50KSh2YWx1ZSkpXSwgWyJtYXJnaW4tbGVmdCIsIHZhbHVlID0+ICgwLCBfaHRtbF91dGlscy5tZWFzdXJlVG9TdHJpbmcpKCgwLCBfdXRpbHMuZ2V0TWVhc3VyZW1lbnQpKHZhbHVlKSldLCBbIm1hcmdpbi1yaWdodCIsIHZhbHVlID0+ICgwLCBfaHRtbF91dGlscy5tZWFzdXJlVG9TdHJpbmcpKCgwLCBfdXRpbHMuZ2V0TWVhc3VyZW1lbnQpKHZhbHVlKSldLCBbIm1hcmdpbi10b3AiLCB2YWx1ZSA9PiAoMCwgX2h0bWxfdXRpbHMubWVhc3VyZVRvU3RyaW5nKSgoMCwgX3V0aWxzLmdldE1lYXN1cmVtZW50KSh2YWx1ZSkpXSwgWyJ0ZXh0LWluZGVudCIsIHZhbHVlID0+ICgwLCBfaHRtbF91dGlscy5tZWFzdXJlVG9TdHJpbmcpKCgwLCBfdXRpbHMuZ2V0TWVhc3VyZW1lbnQpKHZhbHVlKSldLCBbImZvbnQtZmFtaWx5IiwgdmFsdWUgPT4gdmFsdWVdLCBbInZlcnRpY2FsLWFsaWduIiwgdmFsdWUgPT4gKDAsIF9odG1sX3V0aWxzLm1lYXN1cmVUb1N0cmluZykoKDAsIF91dGlscy5nZXRNZWFzdXJlbWVudCkodmFsdWUpKV1dKTsKY29uc3Qgc3BhY2VzUmVnRXhwID0gL1xzKy9nOwpjb25zdCBjcmxmUmVnRXhwID0gL1tcclxuXSsvZzsKY29uc3QgY3JsZkZvclJpY2hUZXh0UmVnRXhwID0gL1xyXG4/L2c7CmZ1bmN0aW9uIG1hcFN0eWxlKHN0eWxlU3RyLCBub2RlLCByaWNoVGV4dCkgewogIGNvbnN0IHN0eWxlID0gT2JqZWN0LmNyZWF0ZShudWxsKTsKICBpZiAoIXN0eWxlU3RyKSB7CiAgICByZXR1cm4gc3R5bGU7CiAgfQogIGNvbnN0IG9yaWdpbmFsID0gT2JqZWN0LmNyZWF0ZShudWxsKTsKICBmb3IgKGNvbnN0IFtrZXksIHZhbHVlXSBvZiBzdHlsZVN0ci5zcGxpdCgiOyIpLm1hcChzID0+IHMuc3BsaXQoIjoiLCAyKSkpIHsKICAgIGNvbnN0IG1hcHBpbmcgPSBTdHlsZU1hcHBpbmcuZ2V0KGtleSk7CiAgICBpZiAobWFwcGluZyA9PT0gIiIpIHsKICAgICAgY29udGludWU7CiAgICB9CiAgICBsZXQgbmV3VmFsdWUgPSB2YWx1ZTsKICAgIGlmIChtYXBwaW5nKSB7CiAgICAgIG5ld1ZhbHVlID0gdHlwZW9mIG1hcHBpbmcgPT09ICJzdHJpbmciID8gbWFwcGluZyA6IG1hcHBpbmcodmFsdWUsIG9yaWdpbmFsKTsKICAgIH0KICAgIGlmIChrZXkuZW5kc1dpdGgoInNjYWxlIikpIHsKICAgICAgc3R5bGUudHJhbnNmb3JtID0gc3R5bGUudHJhbnNmb3JtID8gYCR7c3R5bGVba2V5XX0gJHtuZXdWYWx1ZX1gIDogbmV3VmFsdWU7CiAgICB9IGVsc2UgewogICAgICBzdHlsZVtrZXkucmVwbGFjZUFsbCgvLShbYS16QS1aXSkvZywgKF8sIHgpID0+IHgudG9VcHBlckNhc2UoKSldID0gbmV3VmFsdWU7CiAgICB9CiAgfQogIGlmIChzdHlsZS5mb250RmFtaWx5KSB7CiAgICAoMCwgX2h0bWxfdXRpbHMuc2V0Rm9udEZhbWlseSkoewogICAgICB0eXBlZmFjZTogc3R5bGUuZm9udEZhbWlseSwKICAgICAgd2VpZ2h0OiBzdHlsZS5mb250V2VpZ2h0IHx8ICJub3JtYWwiLAogICAgICBwb3N0dXJlOiBzdHlsZS5mb250U3R5bGUgfHwgIm5vcm1hbCIsCiAgICAgIHNpemU6IG9yaWdpbmFsLmZvbnRTaXplIHx8IDAKICAgIH0sIG5vZGUsIG5vZGVbX3N5bWJvbF91dGlscy4kZ2xvYmFsRGF0YV0uZm9udEZpbmRlciwgc3R5bGUpOwogIH0KICBpZiAocmljaFRleHQgJiYgc3R5bGUudmVydGljYWxBbGlnbiAmJiBzdHlsZS52ZXJ0aWNhbEFsaWduICE9PSAiMHB4IiAmJiBzdHlsZS5mb250U2l6ZSkgewogICAgY29uc3QgU1VCX1NVUEVSX1NDUklQVF9GQUNUT1IgPSAwLjU4MzsKICAgIGNvbnN0IFZFUlRJQ0FMX0ZBQ1RPUiA9IDAuMzMzOwogICAgY29uc3QgZm9udFNpemUgPSAoMCwgX3V0aWxzLmdldE1lYXN1cmVtZW50KShzdHlsZS5mb250U2l6ZSk7CiAgICBzdHlsZS5mb250U2l6ZSA9ICgwLCBfaHRtbF91dGlscy5tZWFzdXJlVG9TdHJpbmcpKGZvbnRTaXplICogU1VCX1NVUEVSX1NDUklQVF9GQUNUT1IpOwogICAgc3R5bGUudmVydGljYWxBbGlnbiA9ICgwLCBfaHRtbF91dGlscy5tZWFzdXJlVG9TdHJpbmcpKE1hdGguc2lnbigoMCwgX3V0aWxzLmdldE1lYXN1cmVtZW50KShzdHlsZS52ZXJ0aWNhbEFsaWduKSkgKiBmb250U2l6ZSAqIFZFUlRJQ0FMX0ZBQ1RPUik7CiAgfQogIGlmIChyaWNoVGV4dCAmJiBzdHlsZS5mb250U2l6ZSkgewogICAgc3R5bGUuZm9udFNpemUgPSBgY2FsYygke3N0eWxlLmZvbnRTaXplfSAqIHZhcigtLXNjYWxlLWZhY3RvcikpYDsKICB9CiAgKDAsIF9odG1sX3V0aWxzLmZpeFRleHRJbmRlbnQpKHN0eWxlKTsKICByZXR1cm4gc3R5bGU7Cn0KZnVuY3Rpb24gY2hlY2tTdHlsZShub2RlKSB7CiAgaWYgKCFub2RlLnN0eWxlKSB7CiAgICByZXR1cm4gIiI7CiAgfQogIHJldHVybiBub2RlLnN0eWxlLnRyaW0oKS5zcGxpdCgvXHMqO1xzKi8pLmZpbHRlcihzID0+ICEhcykubWFwKHMgPT4gcy5zcGxpdCgvXHMqOlxzKi8sIDIpKS5maWx0ZXIoKFtrZXksIHZhbHVlXSkgPT4gewogICAgaWYgKGtleSA9PT0gImZvbnQtZmFtaWx5IikgewogICAgICBub2RlW19zeW1ib2xfdXRpbHMuJGdsb2JhbERhdGFdLnVzZWRUeXBlZmFjZXMuYWRkKHZhbHVlKTsKICAgIH0KICAgIHJldHVybiBWQUxJRF9TVFlMRVMuaGFzKGtleSk7CiAgfSkubWFwKGt2ID0+IGt2LmpvaW4oIjoiKSkuam9pbigiOyIpOwp9CmNvbnN0IE5vV2hpdGVzID0gbmV3IFNldChbImJvZHkiLCAiaHRtbCJdKTsKY2xhc3MgWGh0bWxPYmplY3QgZXh0ZW5kcyBfeGZhX29iamVjdC5YbWxPYmplY3QgewogIGNvbnN0cnVjdG9yKGF0dHJpYnV0ZXMsIG5hbWUpIHsKICAgIHN1cGVyKFhIVE1MX05TX0lELCBuYW1lKTsKICAgIHRoaXNbJHJpY2hUZXh0XSA9IGZhbHNlOwogICAgdGhpcy5zdHlsZSA9IGF0dHJpYnV0ZXMuc3R5bGUgfHwgIiI7CiAgfQogIFtfc3ltYm9sX3V0aWxzLiRjbGVhbl0oYnVpbGRlcikgewogICAgc3VwZXJbX3N5bWJvbF91dGlscy4kY2xlYW5dKGJ1aWxkZXIpOwogICAgdGhpcy5zdHlsZSA9IGNoZWNrU3R5bGUodGhpcyk7CiAgfQogIFtfc3ltYm9sX3V0aWxzLiRhY2NlcHRXaGl0ZXNwYWNlXSgpIHsKICAgIHJldHVybiAhTm9XaGl0ZXMuaGFzKHRoaXNbX3N5bWJvbF91dGlscy4kbm9kZU5hbWVdKTsKICB9CiAgW19zeW1ib2xfdXRpbHMuJG9uVGV4dF0oc3RyLCByaWNoVGV4dCA9IGZhbHNlKSB7CiAgICBpZiAoIXJpY2hUZXh0KSB7CiAgICAgIHN0ciA9IHN0ci5yZXBsYWNlQWxsKGNybGZSZWdFeHAsICIiKTsKICAgICAgaWYgKCF0aGlzLnN0eWxlLmluY2x1ZGVzKCJ4ZmEtc3BhY2VydW46eWVzIikpIHsKICAgICAgICBzdHIgPSBzdHIucmVwbGFjZUFsbChzcGFjZXNSZWdFeHAsICIgIik7CiAgICAgIH0KICAgIH0gZWxzZSB7CiAgICAgIHRoaXNbJHJpY2hUZXh0XSA9IHRydWU7CiAgICB9CiAgICBpZiAoc3RyKSB7CiAgICAgIHRoaXNbX3N5bWJvbF91dGlscy4kY29udGVudF0gKz0gc3RyOwogICAgfQogIH0KICBbX3N5bWJvbF91dGlscy4kcHVzaEdseXBoc10obWVhc3VyZSwgbXVzdFBvcCA9IHRydWUpIHsKICAgIGNvbnN0IHhmYUZvbnQgPSBPYmplY3QuY3JlYXRlKG51bGwpOwogICAgY29uc3QgbWFyZ2luID0gewogICAgICB0b3A6IE5hTiwKICAgICAgYm90dG9tOiBOYU4sCiAgICAgIGxlZnQ6IE5hTiwKICAgICAgcmlnaHQ6IE5hTgogICAgfTsKICAgIGxldCBsaW5lSGVpZ2h0ID0gbnVsbDsKICAgIGZvciAoY29uc3QgW2tleSwgdmFsdWVdIG9mIHRoaXMuc3R5bGUuc3BsaXQoIjsiKS5tYXAocyA9PiBzLnNwbGl0KCI6IiwgMikpKSB7CiAgICAgIHN3aXRjaCAoa2V5KSB7CiAgICAgICAgY2FzZSAiZm9udC1mYW1pbHkiOgogICAgICAgICAgeGZhRm9udC50eXBlZmFjZSA9ICgwLCBfdXRpbHMuc3RyaXBRdW90ZXMpKHZhbHVlKTsKICAgICAgICAgIGJyZWFrOwogICAgICAgIGNhc2UgImZvbnQtc2l6ZSI6CiAgICAgICAgICB4ZmFGb250LnNpemUgPSAoMCwgX3V0aWxzLmdldE1lYXN1cmVtZW50KSh2YWx1ZSk7CiAgICAgICAgICBicmVhazsKICAgICAgICBjYXNlICJmb250LXdlaWdodCI6CiAgICAgICAgICB4ZmFGb250LndlaWdodCA9IHZhbHVlOwogICAgICAgICAgYnJlYWs7CiAgICAgICAgY2FzZSAiZm9udC1zdHlsZSI6CiAgICAgICAgICB4ZmFGb250LnBvc3R1cmUgPSB2YWx1ZTsKICAgICAgICAgIGJyZWFrOwogICAgICAgIGNhc2UgImxldHRlci1zcGFjaW5nIjoKICAgICAgICAgIHhmYUZvbnQubGV0dGVyU3BhY2luZyA9ICgwLCBfdXRpbHMuZ2V0TWVhc3VyZW1lbnQpKHZhbHVlKTsKICAgICAgICAgIGJyZWFrOwogICAgICAgIGNhc2UgIm1hcmdpbiI6CiAgICAgICAgICBjb25zdCB2YWx1ZXMgPSB2YWx1ZS5zcGxpdCgvIFx0LykubWFwKHggPT4gKDAsIF91dGlscy5nZXRNZWFzdXJlbWVudCkoeCkpOwogICAgICAgICAgc3dpdGNoICh2YWx1ZXMubGVuZ3RoKSB7CiAgICAgICAgICAgIGNhc2UgMToKICAgICAgICAgICAgICBtYXJnaW4udG9wID0gbWFyZ2luLmJvdHRvbSA9IG1hcmdpbi5sZWZ0ID0gbWFyZ2luLnJpZ2h0ID0gdmFsdWVzWzBdOwogICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICBjYXNlIDI6CiAgICAgICAgICAgICAgbWFyZ2luLnRvcCA9IG1hcmdpbi5ib3R0b20gPSB2YWx1ZXNbMF07CiAgICAgICAgICAgICAgbWFyZ2luLmxlZnQgPSBtYXJnaW4ucmlnaHQgPSB2YWx1ZXNbMV07CiAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgIGNhc2UgMzoKICAgICAgICAgICAgICBtYXJnaW4udG9wID0gdmFsdWVzWzBdOwogICAgICAgICAgICAgIG1hcmdpbi5ib3R0b20gPSB2YWx1ZXNbMl07CiAgICAgICAgICAgICAgbWFyZ2luLmxlZnQgPSBtYXJnaW4ucmlnaHQgPSB2YWx1ZXNbMV07CiAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgIGNhc2UgNDoKICAgICAgICAgICAgICBtYXJnaW4udG9wID0gdmFsdWVzWzBdOwogICAgICAgICAgICAgIG1hcmdpbi5sZWZ0ID0gdmFsdWVzWzFdOwogICAgICAgICAgICAgIG1hcmdpbi5ib3R0b20gPSB2YWx1ZXNbMl07CiAgICAgICAgICAgICAgbWFyZ2luLnJpZ2h0ID0gdmFsdWVzWzNdOwogICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgfQogICAgICAgICAgYnJlYWs7CiAgICAgICAgY2FzZSAibWFyZ2luLXRvcCI6CiAgICAgICAgICBtYXJnaW4udG9wID0gKDAsIF91dGlscy5nZXRNZWFzdXJlbWVudCkodmFsdWUpOwogICAgICAgICAgYnJlYWs7CiAgICAgICAgY2FzZSAibWFyZ2luLWJvdHRvbSI6CiAgICAgICAgICBtYXJnaW4uYm90dG9tID0gKDAsIF91dGlscy5nZXRNZWFzdXJlbWVudCkodmFsdWUpOwogICAgICAgICAgYnJlYWs7CiAgICAgICAgY2FzZSAibWFyZ2luLWxlZnQiOgogICAgICAgICAgbWFyZ2luLmxlZnQgPSAoMCwgX3V0aWxzLmdldE1lYXN1cmVtZW50KSh2YWx1ZSk7CiAgICAgICAgICBicmVhazsKICAgICAgICBjYXNlICJtYXJnaW4tcmlnaHQiOgogICAgICAgICAgbWFyZ2luLnJpZ2h0ID0gKDAsIF91dGlscy5nZXRNZWFzdXJlbWVudCkodmFsdWUpOwogICAgICAgICAgYnJlYWs7CiAgICAgICAgY2FzZSAibGluZS1oZWlnaHQiOgogICAgICAgICAgbGluZUhlaWdodCA9ICgwLCBfdXRpbHMuZ2V0TWVhc3VyZW1lbnQpKHZhbHVlKTsKICAgICAgICAgIGJyZWFrOwogICAgICB9CiAgICB9CiAgICBtZWFzdXJlLnB1c2hEYXRhKHhmYUZvbnQsIG1hcmdpbiwgbGluZUhlaWdodCk7CiAgICBpZiAodGhpc1tfc3ltYm9sX3V0aWxzLiRjb250ZW50XSkgewogICAgICBtZWFzdXJlLmFkZFN0cmluZyh0aGlzW19zeW1ib2xfdXRpbHMuJGNvbnRlbnRdKTsKICAgIH0gZWxzZSB7CiAgICAgIGZvciAoY29uc3QgY2hpbGQgb2YgdGhpc1tfc3ltYm9sX3V0aWxzLiRnZXRDaGlsZHJlbl0oKSkgewogICAgICAgIGlmIChjaGlsZFtfc3ltYm9sX3V0aWxzLiRub2RlTmFtZV0gPT09ICIjdGV4dCIpIHsKICAgICAgICAgIG1lYXN1cmUuYWRkU3RyaW5nKGNoaWxkW19zeW1ib2xfdXRpbHMuJGNvbnRlbnRdKTsKICAgICAgICAgIGNvbnRpbnVlOwogICAgICAgIH0KICAgICAgICBjaGlsZFtfc3ltYm9sX3V0aWxzLiRwdXNoR2x5cGhzXShtZWFzdXJlKTsKICAgICAgfQogICAgfQogICAgaWYgKG11c3RQb3ApIHsKICAgICAgbWVhc3VyZS5wb3BGb250KCk7CiAgICB9CiAgfQogIFtfc3ltYm9sX3V0aWxzLiR0b0hUTUxdKGF2YWlsYWJsZVNwYWNlKSB7CiAgICBjb25zdCBjaGlsZHJlbiA9IFtdOwogICAgdGhpc1tfc3ltYm9sX3V0aWxzLiRleHRyYV0gPSB7CiAgICAgIGNoaWxkcmVuCiAgICB9OwogICAgdGhpc1tfc3ltYm9sX3V0aWxzLiRjaGlsZHJlblRvSFRNTF0oe30pOwogICAgaWYgKGNoaWxkcmVuLmxlbmd0aCA9PT0gMCAmJiAhdGhpc1tfc3ltYm9sX3V0aWxzLiRjb250ZW50XSkgewogICAgICByZXR1cm4gX3V0aWxzLkhUTUxSZXN1bHQuRU1QVFk7CiAgICB9CiAgICBsZXQgdmFsdWU7CiAgICBpZiAodGhpc1skcmljaFRleHRdKSB7CiAgICAgIHZhbHVlID0gdGhpc1tfc3ltYm9sX3V0aWxzLiRjb250ZW50XSA/IHRoaXNbX3N5bWJvbF91dGlscy4kY29udGVudF0ucmVwbGFjZUFsbChjcmxmRm9yUmljaFRleHRSZWdFeHAsICJcbiIpIDogdW5kZWZpbmVkOwogICAgfSBlbHNlIHsKICAgICAgdmFsdWUgPSB0aGlzW19zeW1ib2xfdXRpbHMuJGNvbnRlbnRdIHx8IHVuZGVmaW5lZDsKICAgIH0KICAgIHJldHVybiBfdXRpbHMuSFRNTFJlc3VsdC5zdWNjZXNzKHsKICAgICAgbmFtZTogdGhpc1tfc3ltYm9sX3V0aWxzLiRub2RlTmFtZV0sCiAgICAgIGF0dHJpYnV0ZXM6IHsKICAgICAgICBocmVmOiB0aGlzLmhyZWYsCiAgICAgICAgc3R5bGU6IG1hcFN0eWxlKHRoaXMuc3R5bGUsIHRoaXMsIHRoaXNbJHJpY2hUZXh0XSkKICAgICAgfSwKICAgICAgY2hpbGRyZW4sCiAgICAgIHZhbHVlCiAgICB9KTsKICB9Cn0KY2xhc3MgQSBleHRlbmRzIFhodG1sT2JqZWN0IHsKICBjb25zdHJ1Y3RvcihhdHRyaWJ1dGVzKSB7CiAgICBzdXBlcihhdHRyaWJ1dGVzLCAiYSIpOwogICAgdGhpcy5ocmVmID0gKDAsIF9odG1sX3V0aWxzLmZpeFVSTCkoYXR0cmlidXRlcy5ocmVmKSB8fCAiIjsKICB9Cn0KY2xhc3MgQiBleHRlbmRzIFhodG1sT2JqZWN0IHsKICBjb25zdHJ1Y3RvcihhdHRyaWJ1dGVzKSB7CiAgICBzdXBlcihhdHRyaWJ1dGVzLCAiYiIpOwogIH0KICBbX3N5bWJvbF91dGlscy4kcHVzaEdseXBoc10obWVhc3VyZSkgewogICAgbWVhc3VyZS5wdXNoRm9udCh7CiAgICAgIHdlaWdodDogImJvbGQiCiAgICB9KTsKICAgIHN1cGVyW19zeW1ib2xfdXRpbHMuJHB1c2hHbHlwaHNdKG1lYXN1cmUpOwogICAgbWVhc3VyZS5wb3BGb250KCk7CiAgfQp9CmNsYXNzIEJvZHkgZXh0ZW5kcyBYaHRtbE9iamVjdCB7CiAgY29uc3RydWN0b3IoYXR0cmlidXRlcykgewogICAgc3VwZXIoYXR0cmlidXRlcywgImJvZHkiKTsKICB9CiAgW19zeW1ib2xfdXRpbHMuJHRvSFRNTF0oYXZhaWxhYmxlU3BhY2UpIHsKICAgIGNvbnN0IHJlcyA9IHN1cGVyW19zeW1ib2xfdXRpbHMuJHRvSFRNTF0oYXZhaWxhYmxlU3BhY2UpOwogICAgY29uc3QgewogICAgICBodG1sCiAgICB9ID0gcmVzOwogICAgaWYgKCFodG1sKSB7CiAgICAgIHJldHVybiBfdXRpbHMuSFRNTFJlc3VsdC5FTVBUWTsKICAgIH0KICAgIGh0bWwubmFtZSA9ICJkaXYiOwogICAgaHRtbC5hdHRyaWJ1dGVzLmNsYXNzID0gWyJ4ZmFSaWNoIl07CiAgICByZXR1cm4gcmVzOwogIH0KfQpjbGFzcyBCciBleHRlbmRzIFhodG1sT2JqZWN0IHsKICBjb25zdHJ1Y3RvcihhdHRyaWJ1dGVzKSB7CiAgICBzdXBlcihhdHRyaWJ1dGVzLCAiYnIiKTsKICB9CiAgW19zeW1ib2xfdXRpbHMuJHRleHRdKCkgewogICAgcmV0dXJuICJcbiI7CiAgfQogIFtfc3ltYm9sX3V0aWxzLiRwdXNoR2x5cGhzXShtZWFzdXJlKSB7CiAgICBtZWFzdXJlLmFkZFN0cmluZygiXG4iKTsKICB9CiAgW19zeW1ib2xfdXRpbHMuJHRvSFRNTF0oYXZhaWxhYmxlU3BhY2UpIHsKICAgIHJldHVybiBfdXRpbHMuSFRNTFJlc3VsdC5zdWNjZXNzKHsKICAgICAgbmFtZTogImJyIgogICAgfSk7CiAgfQp9CmNsYXNzIEh0bWwgZXh0ZW5kcyBYaHRtbE9iamVjdCB7CiAgY29uc3RydWN0b3IoYXR0cmlidXRlcykgewogICAgc3VwZXIoYXR0cmlidXRlcywgImh0bWwiKTsKICB9CiAgW19zeW1ib2xfdXRpbHMuJHRvSFRNTF0oYXZhaWxhYmxlU3BhY2UpIHsKICAgIGNvbnN0IGNoaWxkcmVuID0gW107CiAgICB0aGlzW19zeW1ib2xfdXRpbHMuJGV4dHJhXSA9IHsKICAgICAgY2hpbGRyZW4KICAgIH07CiAgICB0aGlzW19zeW1ib2xfdXRpbHMuJGNoaWxkcmVuVG9IVE1MXSh7fSk7CiAgICBpZiAoY2hpbGRyZW4ubGVuZ3RoID09PSAwKSB7CiAgICAgIHJldHVybiBfdXRpbHMuSFRNTFJlc3VsdC5zdWNjZXNzKHsKICAgICAgICBuYW1lOiAiZGl2IiwKICAgICAgICBhdHRyaWJ1dGVzOiB7CiAgICAgICAgICBjbGFzczogWyJ4ZmFSaWNoIl0sCiAgICAgICAgICBzdHlsZToge30KICAgICAgICB9LAogICAgICAgIHZhbHVlOiB0aGlzW19zeW1ib2xfdXRpbHMuJGNvbnRlbnRdIHx8ICIiCiAgICAgIH0pOwogICAgfQogICAgaWYgKGNoaWxkcmVuLmxlbmd0aCA9PT0gMSkgewogICAgICBjb25zdCBjaGlsZCA9IGNoaWxkcmVuWzBdOwogICAgICBpZiAoY2hpbGQuYXR0cmlidXRlcz8uY2xhc3MuaW5jbHVkZXMoInhmYVJpY2giKSkgewogICAgICAgIHJldHVybiBfdXRpbHMuSFRNTFJlc3VsdC5zdWNjZXNzKGNoaWxkKTsKICAgICAgfQogICAgfQogICAgcmV0dXJuIF91dGlscy5IVE1MUmVzdWx0LnN1Y2Nlc3MoewogICAgICBuYW1lOiAiZGl2IiwKICAgICAgYXR0cmlidXRlczogewogICAgICAgIGNsYXNzOiBbInhmYVJpY2giXSwKICAgICAgICBzdHlsZToge30KICAgICAgfSwKICAgICAgY2hpbGRyZW4KICAgIH0pOwogIH0KfQpjbGFzcyBJIGV4dGVuZHMgWGh0bWxPYmplY3QgewogIGNvbnN0cnVjdG9yKGF0dHJpYnV0ZXMpIHsKICAgIHN1cGVyKGF0dHJpYnV0ZXMsICJpIik7CiAgfQogIFtfc3ltYm9sX3V0aWxzLiRwdXNoR2x5cGhzXShtZWFzdXJlKSB7CiAgICBtZWFzdXJlLnB1c2hGb250KHsKICAgICAgcG9zdHVyZTogIml0YWxpYyIKICAgIH0pOwogICAgc3VwZXJbX3N5bWJvbF91dGlscy4kcHVzaEdseXBoc10obWVhc3VyZSk7CiAgICBtZWFzdXJlLnBvcEZvbnQoKTsKICB9Cn0KY2xhc3MgTGkgZXh0ZW5kcyBYaHRtbE9iamVjdCB7CiAgY29uc3RydWN0b3IoYXR0cmlidXRlcykgewogICAgc3VwZXIoYXR0cmlidXRlcywgImxpIik7CiAgfQp9CmNsYXNzIE9sIGV4dGVuZHMgWGh0bWxPYmplY3QgewogIGNvbnN0cnVjdG9yKGF0dHJpYnV0ZXMpIHsKICAgIHN1cGVyKGF0dHJpYnV0ZXMsICJvbCIpOwogIH0KfQpjbGFzcyBQIGV4dGVuZHMgWGh0bWxPYmplY3QgewogIGNvbnN0cnVjdG9yKGF0dHJpYnV0ZXMpIHsKICAgIHN1cGVyKGF0dHJpYnV0ZXMsICJwIik7CiAgfQogIFtfc3ltYm9sX3V0aWxzLiRwdXNoR2x5cGhzXShtZWFzdXJlKSB7CiAgICBzdXBlcltfc3ltYm9sX3V0aWxzLiRwdXNoR2x5cGhzXShtZWFzdXJlLCBmYWxzZSk7CiAgICBtZWFzdXJlLmFkZFN0cmluZygiXG4iKTsKICAgIG1lYXN1cmUuYWRkUGFyYSgpOwogICAgbWVhc3VyZS5wb3BGb250KCk7CiAgfQogIFtfc3ltYm9sX3V0aWxzLiR0ZXh0XSgpIHsKICAgIGNvbnN0IHNpYmxpbmdzID0gdGhpc1tfc3ltYm9sX3V0aWxzLiRnZXRQYXJlbnRdKClbX3N5bWJvbF91dGlscy4kZ2V0Q2hpbGRyZW5dKCk7CiAgICBpZiAoc2libGluZ3MuYXQoLTEpID09PSB0aGlzKSB7CiAgICAgIHJldHVybiBzdXBlcltfc3ltYm9sX3V0aWxzLiR0ZXh0XSgpOwogICAgfQogICAgcmV0dXJuIHN1cGVyW19zeW1ib2xfdXRpbHMuJHRleHRdKCkgKyAiXG4iOwogIH0KfQpjbGFzcyBTcGFuIGV4dGVuZHMgWGh0bWxPYmplY3QgewogIGNvbnN0cnVjdG9yKGF0dHJpYnV0ZXMpIHsKICAgIHN1cGVyKGF0dHJpYnV0ZXMsICJzcGFuIik7CiAgfQp9CmNsYXNzIFN1YiBleHRlbmRzIFhodG1sT2JqZWN0IHsKICBjb25zdHJ1Y3RvcihhdHRyaWJ1dGVzKSB7CiAgICBzdXBlcihhdHRyaWJ1dGVzLCAic3ViIik7CiAgfQp9CmNsYXNzIFN1cCBleHRlbmRzIFhodG1sT2JqZWN0IHsKICBjb25zdHJ1Y3RvcihhdHRyaWJ1dGVzKSB7CiAgICBzdXBlcihhdHRyaWJ1dGVzLCAic3VwIik7CiAgfQp9CmNsYXNzIFVsIGV4dGVuZHMgWGh0bWxPYmplY3QgewogIGNvbnN0cnVjdG9yKGF0dHJpYnV0ZXMpIHsKICAgIHN1cGVyKGF0dHJpYnV0ZXMsICJ1bCIpOwogIH0KfQpjbGFzcyBYaHRtbE5hbWVzcGFjZSB7CiAgc3RhdGljIFtfbmFtZXNwYWNlcy4kYnVpbGRYRkFPYmplY3RdKG5hbWUsIGF0dHJpYnV0ZXMpIHsKICAgIGlmIChYaHRtbE5hbWVzcGFjZS5oYXNPd25Qcm9wZXJ0eShuYW1lKSkgewogICAgICByZXR1cm4gWGh0bWxOYW1lc3BhY2VbbmFtZV0oYXR0cmlidXRlcyk7CiAgICB9CiAgICByZXR1cm4gdW5kZWZpbmVkOwogIH0KICBzdGF0aWMgYShhdHRyaWJ1dGVzKSB7CiAgICByZXR1cm4gbmV3IEEoYXR0cmlidXRlcyk7CiAgfQogIHN0YXRpYyBiKGF0dHJpYnV0ZXMpIHsKICAgIHJldHVybiBuZXcgQihhdHRyaWJ1dGVzKTsKICB9CiAgc3RhdGljIGJvZHkoYXR0cmlidXRlcykgewogICAgcmV0dXJuIG5ldyBCb2R5KGF0dHJpYnV0ZXMpOwogIH0KICBzdGF0aWMgYnIoYXR0cmlidXRlcykgewogICAgcmV0dXJuIG5ldyBCcihhdHRyaWJ1dGVzKTsKICB9CiAgc3RhdGljIGh0bWwoYXR0cmlidXRlcykgewogICAgcmV0dXJuIG5ldyBIdG1sKGF0dHJpYnV0ZXMpOwogIH0KICBzdGF0aWMgaShhdHRyaWJ1dGVzKSB7CiAgICByZXR1cm4gbmV3IEkoYXR0cmlidXRlcyk7CiAgfQogIHN0YXRpYyBsaShhdHRyaWJ1dGVzKSB7CiAgICByZXR1cm4gbmV3IExpKGF0dHJpYnV0ZXMpOwogIH0KICBzdGF0aWMgb2woYXR0cmlidXRlcykgewogICAgcmV0dXJuIG5ldyBPbChhdHRyaWJ1dGVzKTsKICB9CiAgc3RhdGljIHAoYXR0cmlidXRlcykgewogICAgcmV0dXJuIG5ldyBQKGF0dHJpYnV0ZXMpOwogIH0KICBzdGF0aWMgc3BhbihhdHRyaWJ1dGVzKSB7CiAgICByZXR1cm4gbmV3IFNwYW4oYXR0cmlidXRlcyk7CiAgfQogIHN0YXRpYyBzdWIoYXR0cmlidXRlcykgewogICAgcmV0dXJuIG5ldyBTdWIoYXR0cmlidXRlcyk7CiAgfQogIHN0YXRpYyBzdXAoYXR0cmlidXRlcykgewogICAgcmV0dXJuIG5ldyBTdXAoYXR0cmlidXRlcyk7CiAgfQogIHN0YXRpYyB1bChhdHRyaWJ1dGVzKSB7CiAgICByZXR1cm4gbmV3IFVsKGF0dHJpYnV0ZXMpOwogIH0KfQpleHBvcnRzLlhodG1sTmFtZXNwYWNlID0gWGh0bWxOYW1lc3BhY2U7CgovKioqLyB9KSwKLyogMTAxICovCi8qKiovICgoX191bnVzZWRfd2VicGFja19tb2R1bGUsIGV4cG9ydHMsIF9fd19wZGZqc19yZXF1aXJlX18pID0+IHsKCgoKT2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsICJfX2VzTW9kdWxlIiwgKHsKICB2YWx1ZTogdHJ1ZQp9KSk7CmV4cG9ydHMuVW5rbm93bk5hbWVzcGFjZSA9IHZvaWQgMDsKdmFyIF9uYW1lc3BhY2VzID0gX193X3BkZmpzX3JlcXVpcmVfXyg4MSk7CnZhciBfeGZhX29iamVjdCA9IF9fd19wZGZqc19yZXF1aXJlX18oODcpOwpjbGFzcyBVbmtub3duTmFtZXNwYWNlIHsKICBjb25zdHJ1Y3Rvcihuc0lkKSB7CiAgICB0aGlzLm5hbWVzcGFjZUlkID0gbnNJZDsKICB9CiAgW19uYW1lc3BhY2VzLiRidWlsZFhGQU9iamVjdF0obmFtZSwgYXR0cmlidXRlcykgewogICAgcmV0dXJuIG5ldyBfeGZhX29iamVjdC5YbWxPYmplY3QodGhpcy5uYW1lc3BhY2VJZCwgbmFtZSwgYXR0cmlidXRlcyk7CiAgfQp9CmV4cG9ydHMuVW5rbm93bk5hbWVzcGFjZSA9IFVua25vd25OYW1lc3BhY2U7CgovKioqLyB9KSwKLyogMTAyICovCi8qKiovICgoX191bnVzZWRfd2VicGFja19tb2R1bGUsIGV4cG9ydHMsIF9fd19wZGZqc19yZXF1aXJlX18pID0+IHsKCgoKT2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsICJfX2VzTW9kdWxlIiwgKHsKICB2YWx1ZTogdHJ1ZQp9KSk7CmV4cG9ydHMuRGF0YXNldFJlYWRlciA9IHZvaWQgMDsKdmFyIF91dGlsID0gX193X3BkZmpzX3JlcXVpcmVfXygyKTsKdmFyIF9jb3JlX3V0aWxzID0gX193X3BkZmpzX3JlcXVpcmVfXygzKTsKdmFyIF94bWxfcGFyc2VyID0gX193X3BkZmpzX3JlcXVpcmVfXyg3MSk7CmZ1bmN0aW9uIGRlY29kZVN0cmluZyhzdHIpIHsKICB0cnkgewogICAgcmV0dXJuICgwLCBfdXRpbC5zdHJpbmdUb1VURjhTdHJpbmcpKHN0cik7CiAgfSBjYXRjaCAoZXgpIHsKICAgICgwLCBfdXRpbC53YXJuKShgVVRGLTggZGVjb2RpbmcgZmFpbGVkOiAiJHtleH0iLmApOwogICAgcmV0dXJuIHN0cjsKICB9Cn0KY2xhc3MgRGF0YXNldFhNTFBhcnNlciBleHRlbmRzIF94bWxfcGFyc2VyLlNpbXBsZVhNTFBhcnNlciB7CiAgY29uc3RydWN0b3Iob3B0aW9ucykgewogICAgc3VwZXIob3B0aW9ucyk7CiAgICB0aGlzLm5vZGUgPSBudWxsOwogIH0KICBvbkVuZEVsZW1lbnQobmFtZSkgewogICAgY29uc3Qgbm9kZSA9IHN1cGVyLm9uRW5kRWxlbWVudChuYW1lKTsKICAgIGlmIChub2RlICYmIG5hbWUgPT09ICJ4ZmE6ZGF0YXNldHMiKSB7CiAgICAgIHRoaXMubm9kZSA9IG5vZGU7CiAgICAgIHRocm93IG5ldyBFcnJvcigiQWJvcnRpbmcgRGF0YXNldFhNTFBhcnNlci4iKTsKICAgIH0KICB9Cn0KY2xhc3MgRGF0YXNldFJlYWRlciB7CiAgY29uc3RydWN0b3IoZGF0YSkgewogICAgaWYgKGRhdGEuZGF0YXNldHMpIHsKICAgICAgdGhpcy5ub2RlID0gbmV3IF94bWxfcGFyc2VyLlNpbXBsZVhNTFBhcnNlcih7CiAgICAgICAgaGFzQXR0cmlidXRlczogdHJ1ZQogICAgICB9KS5wYXJzZUZyb21TdHJpbmcoZGF0YS5kYXRhc2V0cykuZG9jdW1lbnRFbGVtZW50OwogICAgfSBlbHNlIHsKICAgICAgY29uc3QgcGFyc2VyID0gbmV3IERhdGFzZXRYTUxQYXJzZXIoewogICAgICAgIGhhc0F0dHJpYnV0ZXM6IHRydWUKICAgICAgfSk7CiAgICAgIHRyeSB7CiAgICAgICAgcGFyc2VyLnBhcnNlRnJvbVN0cmluZyhkYXRhWyJ4ZHA6eGRwIl0pOwogICAgICB9IGNhdGNoIHt9CiAgICAgIHRoaXMubm9kZSA9IHBhcnNlci5ub2RlOwogICAgfQogIH0KICBnZXRWYWx1ZShwYXRoKSB7CiAgICBpZiAoIXRoaXMubm9kZSB8fCAhcGF0aCkgewogICAgICByZXR1cm4gIiI7CiAgICB9CiAgICBjb25zdCBub2RlID0gdGhpcy5ub2RlLnNlYXJjaE5vZGUoKDAsIF9jb3JlX3V0aWxzLnBhcnNlWEZBUGF0aCkocGF0aCksIDApOwogICAgaWYgKCFub2RlKSB7CiAgICAgIHJldHVybiAiIjsKICAgIH0KICAgIGNvbnN0IGZpcnN0ID0gbm9kZS5maXJzdENoaWxkOwogICAgaWYgKGZpcnN0Py5ub2RlTmFtZSA9PT0gInZhbHVlIikgewogICAgICByZXR1cm4gbm9kZS5jaGlsZHJlbi5tYXAoY2hpbGQgPT4gZGVjb2RlU3RyaW5nKGNoaWxkLnRleHRDb250ZW50KSk7CiAgICB9CiAgICByZXR1cm4gZGVjb2RlU3RyaW5nKG5vZGUudGV4dENvbnRlbnQpOwogIH0KfQpleHBvcnRzLkRhdGFzZXRSZWFkZXIgPSBEYXRhc2V0UmVhZGVyOwoKLyoqKi8gfSksCi8qIDEwMyAqLwovKioqLyAoKF9fdW51c2VkX3dlYnBhY2tfbW9kdWxlLCBleHBvcnRzLCBfX3dfcGRmanNfcmVxdWlyZV9fKSA9PiB7CgoKCk9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCAiX19lc01vZHVsZSIsICh7CiAgdmFsdWU6IHRydWUKfSkpOwpleHBvcnRzLlhSZWYgPSB2b2lkIDA7CnZhciBfdXRpbCA9IF9fd19wZGZqc19yZXF1aXJlX18oMik7CnZhciBfcHJpbWl0aXZlcyA9IF9fd19wZGZqc19yZXF1aXJlX18oNCk7CnZhciBfcGFyc2VyID0gX193X3BkZmpzX3JlcXVpcmVfXygxNik7CnZhciBfY29yZV91dGlscyA9IF9fd19wZGZqc19yZXF1aXJlX18oMyk7CnZhciBfYmFzZV9zdHJlYW0gPSBfX3dfcGRmanNfcmVxdWlyZV9fKDUpOwp2YXIgX2NyeXB0byA9IF9fd19wZGZqc19yZXF1aXJlX18oNzQpOwpjbGFzcyBYUmVmIHsKICAjZmlyc3RYUmVmU3RtUG9zID0gbnVsbDsKICBjb25zdHJ1Y3RvcihzdHJlYW0sIHBkZk1hbmFnZXIpIHsKICAgIHRoaXMuc3RyZWFtID0gc3RyZWFtOwogICAgdGhpcy5wZGZNYW5hZ2VyID0gcGRmTWFuYWdlcjsKICAgIHRoaXMuZW50cmllcyA9IFtdOwogICAgdGhpcy5feHJlZlN0bXMgPSBuZXcgU2V0KCk7CiAgICB0aGlzLl9jYWNoZU1hcCA9IG5ldyBNYXAoKTsKICAgIHRoaXMuX3BlbmRpbmdSZWZzID0gbmV3IF9wcmltaXRpdmVzLlJlZlNldCgpOwogICAgdGhpcy5fbmV3UGVyc2lzdGVudFJlZk51bSA9IG51bGw7CiAgICB0aGlzLl9uZXdUZW1wb3JhcnlSZWZOdW0gPSBudWxsOwogIH0KICBnZXROZXdQZXJzaXN0ZW50UmVmKG9iaikgewogICAgaWYgKHRoaXMuX25ld1BlcnNpc3RlbnRSZWZOdW0gPT09IG51bGwpIHsKICAgICAgdGhpcy5fbmV3UGVyc2lzdGVudFJlZk51bSA9IHRoaXMuZW50cmllcy5sZW5ndGggfHwgMTsKICAgIH0KICAgIGNvbnN0IG51bSA9IHRoaXMuX25ld1BlcnNpc3RlbnRSZWZOdW0rKzsKICAgIHRoaXMuX2NhY2hlTWFwLnNldChudW0sIG9iaik7CiAgICByZXR1cm4gX3ByaW1pdGl2ZXMuUmVmLmdldChudW0sIDApOwogIH0KICBnZXROZXdUZW1wb3JhcnlSZWYoKSB7CiAgICBpZiAodGhpcy5fbmV3VGVtcG9yYXJ5UmVmTnVtID09PSBudWxsKSB7CiAgICAgIHRoaXMuX25ld1RlbXBvcmFyeVJlZk51bSA9IHRoaXMuZW50cmllcy5sZW5ndGggfHwgMTsKICAgIH0KICAgIHJldHVybiBfcHJpbWl0aXZlcy5SZWYuZ2V0KHRoaXMuX25ld1RlbXBvcmFyeVJlZk51bSsrLCAwKTsKICB9CiAgcmVzZXROZXdUZW1wb3JhcnlSZWYoKSB7CiAgICB0aGlzLl9uZXdUZW1wb3JhcnlSZWZOdW0gPSBudWxsOwogIH0KICBzZXRTdGFydFhSZWYoc3RhcnRYUmVmKSB7CiAgICB0aGlzLnN0YXJ0WFJlZlF1ZXVlID0gW3N0YXJ0WFJlZl07CiAgfQogIHBhcnNlKHJlY292ZXJ5TW9kZSA9IGZhbHNlKSB7CiAgICBsZXQgdHJhaWxlckRpY3Q7CiAgICBpZiAoIXJlY292ZXJ5TW9kZSkgewogICAgICB0cmFpbGVyRGljdCA9IHRoaXMucmVhZFhSZWYoKTsKICAgIH0gZWxzZSB7CiAgICAgICgwLCBfdXRpbC53YXJuKSgiSW5kZXhpbmcgYWxsIFBERiBvYmplY3RzIik7CiAgICAgIHRyYWlsZXJEaWN0ID0gdGhpcy5pbmRleE9iamVjdHMoKTsKICAgIH0KICAgIHRyYWlsZXJEaWN0LmFzc2lnblhyZWYodGhpcyk7CiAgICB0aGlzLnRyYWlsZXIgPSB0cmFpbGVyRGljdDsKICAgIGxldCBlbmNyeXB0OwogICAgdHJ5IHsKICAgICAgZW5jcnlwdCA9IHRyYWlsZXJEaWN0LmdldCgiRW5jcnlwdCIpOwogICAgfSBjYXRjaCAoZXgpIHsKICAgICAgaWYgKGV4IGluc3RhbmNlb2YgX2NvcmVfdXRpbHMuTWlzc2luZ0RhdGFFeGNlcHRpb24pIHsKICAgICAgICB0aHJvdyBleDsKICAgICAgfQogICAgICAoMCwgX3V0aWwud2FybikoYFhSZWYucGFyc2UgLSBJbnZhbGlkICJFbmNyeXB0IiByZWZlcmVuY2U6ICIke2V4fSIuYCk7CiAgICB9CiAgICBpZiAoZW5jcnlwdCBpbnN0YW5jZW9mIF9wcmltaXRpdmVzLkRpY3QpIHsKICAgICAgY29uc3QgaWRzID0gdHJhaWxlckRpY3QuZ2V0KCJJRCIpOwogICAgICBjb25zdCBmaWxlSWQgPSBpZHM/Lmxlbmd0aCA/IGlkc1swXSA6ICIiOwogICAgICBlbmNyeXB0LnN1cHByZXNzRW5jcnlwdGlvbiA9IHRydWU7CiAgICAgIHRoaXMuZW5jcnlwdCA9IG5ldyBfY3J5cHRvLkNpcGhlclRyYW5zZm9ybUZhY3RvcnkoZW5jcnlwdCwgZmlsZUlkLCB0aGlzLnBkZk1hbmFnZXIucGFzc3dvcmQpOwogICAgfQogICAgbGV0IHJvb3Q7CiAgICB0cnkgewogICAgICByb290ID0gdHJhaWxlckRpY3QuZ2V0KCJSb290Iik7CiAgICB9IGNhdGNoIChleCkgewogICAgICBpZiAoZXggaW5zdGFuY2VvZiBfY29yZV91dGlscy5NaXNzaW5nRGF0YUV4Y2VwdGlvbikgewogICAgICAgIHRocm93IGV4OwogICAgICB9CiAgICAgICgwLCBfdXRpbC53YXJuKShgWFJlZi5wYXJzZSAtIEludmFsaWQgIlJvb3QiIHJlZmVyZW5jZTogIiR7ZXh9Ii5gKTsKICAgIH0KICAgIGlmIChyb290IGluc3RhbmNlb2YgX3ByaW1pdGl2ZXMuRGljdCkgewogICAgICB0cnkgewogICAgICAgIGNvbnN0IHBhZ2VzID0gcm9vdC5nZXQoIlBhZ2VzIik7CiAgICAgICAgaWYgKHBhZ2VzIGluc3RhbmNlb2YgX3ByaW1pdGl2ZXMuRGljdCkgewogICAgICAgICAgdGhpcy5yb290ID0gcm9vdDsKICAgICAgICAgIHJldHVybjsKICAgICAgICB9CiAgICAgIH0gY2F0Y2ggKGV4KSB7CiAgICAgICAgaWYgKGV4IGluc3RhbmNlb2YgX2NvcmVfdXRpbHMuTWlzc2luZ0RhdGFFeGNlcHRpb24pIHsKICAgICAgICAgIHRocm93IGV4OwogICAgICAgIH0KICAgICAgICAoMCwgX3V0aWwud2FybikoYFhSZWYucGFyc2UgLSBJbnZhbGlkICJQYWdlcyIgcmVmZXJlbmNlOiAiJHtleH0iLmApOwogICAgICB9CiAgICB9CiAgICBpZiAoIXJlY292ZXJ5TW9kZSkgewogICAgICB0aHJvdyBuZXcgX2NvcmVfdXRpbHMuWFJlZlBhcnNlRXhjZXB0aW9uKCk7CiAgICB9CiAgICB0aHJvdyBuZXcgX3V0aWwuSW52YWxpZFBERkV4Y2VwdGlvbigiSW52YWxpZCBSb290IHJlZmVyZW5jZS4iKTsKICB9CiAgcHJvY2Vzc1hSZWZUYWJsZShwYXJzZXIpIHsKICAgIGlmICghKCJ0YWJsZVN0YXRlIiBpbiB0aGlzKSkgewogICAgICB0aGlzLnRhYmxlU3RhdGUgPSB7CiAgICAgICAgZW50cnlOdW06IDAsCiAgICAgICAgc3RyZWFtUG9zOiBwYXJzZXIubGV4ZXIuc3RyZWFtLnBvcywKICAgICAgICBwYXJzZXJCdWYxOiBwYXJzZXIuYnVmMSwKICAgICAgICBwYXJzZXJCdWYyOiBwYXJzZXIuYnVmMgogICAgICB9OwogICAgfQogICAgY29uc3Qgb2JqID0gdGhpcy5yZWFkWFJlZlRhYmxlKHBhcnNlcik7CiAgICBpZiAoISgwLCBfcHJpbWl0aXZlcy5pc0NtZCkob2JqLCAidHJhaWxlciIpKSB7CiAgICAgIHRocm93IG5ldyBfdXRpbC5Gb3JtYXRFcnJvcigiSW52YWxpZCBYUmVmIHRhYmxlOiBjb3VsZCBub3QgZmluZCB0cmFpbGVyIGRpY3Rpb25hcnkiKTsKICAgIH0KICAgIGxldCBkaWN0ID0gcGFyc2VyLmdldE9iaigpOwogICAgaWYgKCEoZGljdCBpbnN0YW5jZW9mIF9wcmltaXRpdmVzLkRpY3QpICYmIGRpY3QuZGljdCkgewogICAgICBkaWN0ID0gZGljdC5kaWN0OwogICAgfQogICAgaWYgKCEoZGljdCBpbnN0YW5jZW9mIF9wcmltaXRpdmVzLkRpY3QpKSB7CiAgICAgIHRocm93IG5ldyBfdXRpbC5Gb3JtYXRFcnJvcigiSW52YWxpZCBYUmVmIHRhYmxlOiBjb3VsZCBub3QgcGFyc2UgdHJhaWxlciBkaWN0aW9uYXJ5Iik7CiAgICB9CiAgICBkZWxldGUgdGhpcy50YWJsZVN0YXRlOwogICAgcmV0dXJuIGRpY3Q7CiAgfQogIHJlYWRYUmVmVGFibGUocGFyc2VyKSB7CiAgICBjb25zdCBzdHJlYW0gPSBwYXJzZXIubGV4ZXIuc3RyZWFtOwogICAgY29uc3QgdGFibGVTdGF0ZSA9IHRoaXMudGFibGVTdGF0ZTsKICAgIHN0cmVhbS5wb3MgPSB0YWJsZVN0YXRlLnN0cmVhbVBvczsKICAgIHBhcnNlci5idWYxID0gdGFibGVTdGF0ZS5wYXJzZXJCdWYxOwogICAgcGFyc2VyLmJ1ZjIgPSB0YWJsZVN0YXRlLnBhcnNlckJ1ZjI7CiAgICBsZXQgb2JqOwogICAgd2hpbGUgKHRydWUpIHsKICAgICAgaWYgKCEoImZpcnN0RW50cnlOdW0iIGluIHRhYmxlU3RhdGUpIHx8ICEoImVudHJ5Q291bnQiIGluIHRhYmxlU3RhdGUpKSB7CiAgICAgICAgaWYgKCgwLCBfcHJpbWl0aXZlcy5pc0NtZCkob2JqID0gcGFyc2VyLmdldE9iaigpLCAidHJhaWxlciIpKSB7CiAgICAgICAgICBicmVhazsKICAgICAgICB9CiAgICAgICAgdGFibGVTdGF0ZS5maXJzdEVudHJ5TnVtID0gb2JqOwogICAgICAgIHRhYmxlU3RhdGUuZW50cnlDb3VudCA9IHBhcnNlci5nZXRPYmooKTsKICAgICAgfQogICAgICBsZXQgZmlyc3QgPSB0YWJsZVN0YXRlLmZpcnN0RW50cnlOdW07CiAgICAgIGNvbnN0IGNvdW50ID0gdGFibGVTdGF0ZS5lbnRyeUNvdW50OwogICAgICBpZiAoIU51bWJlci5pc0ludGVnZXIoZmlyc3QpIHx8ICFOdW1iZXIuaXNJbnRlZ2VyKGNvdW50KSkgewogICAgICAgIHRocm93IG5ldyBfdXRpbC5Gb3JtYXRFcnJvcigiSW52YWxpZCBYUmVmIHRhYmxlOiB3cm9uZyB0eXBlcyBpbiBzdWJzZWN0aW9uIGhlYWRlciIpOwogICAgICB9CiAgICAgIGZvciAobGV0IGkgPSB0YWJsZVN0YXRlLmVudHJ5TnVtOyBpIDwgY291bnQ7IGkrKykgewogICAgICAgIHRhYmxlU3RhdGUuc3RyZWFtUG9zID0gc3RyZWFtLnBvczsKICAgICAgICB0YWJsZVN0YXRlLmVudHJ5TnVtID0gaTsKICAgICAgICB0YWJsZVN0YXRlLnBhcnNlckJ1ZjEgPSBwYXJzZXIuYnVmMTsKICAgICAgICB0YWJsZVN0YXRlLnBhcnNlckJ1ZjIgPSBwYXJzZXIuYnVmMjsKICAgICAgICBjb25zdCBlbnRyeSA9IHt9OwogICAgICAgIGVudHJ5Lm9mZnNldCA9IHBhcnNlci5nZXRPYmooKTsKICAgICAgICBlbnRyeS5nZW4gPSBwYXJzZXIuZ2V0T2JqKCk7CiAgICAgICAgY29uc3QgdHlwZSA9IHBhcnNlci5nZXRPYmooKTsKICAgICAgICBpZiAodHlwZSBpbnN0YW5jZW9mIF9wcmltaXRpdmVzLkNtZCkgewogICAgICAgICAgc3dpdGNoICh0eXBlLmNtZCkgewogICAgICAgICAgICBjYXNlICJmIjoKICAgICAgICAgICAgICBlbnRyeS5mcmVlID0gdHJ1ZTsKICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgY2FzZSAibiI6CiAgICAgICAgICAgICAgZW50cnkudW5jb21wcmVzc2VkID0gdHJ1ZTsKICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgaWYgKCFOdW1iZXIuaXNJbnRlZ2VyKGVudHJ5Lm9mZnNldCkgfHwgIU51bWJlci5pc0ludGVnZXIoZW50cnkuZ2VuKSB8fCAhKGVudHJ5LmZyZWUgfHwgZW50cnkudW5jb21wcmVzc2VkKSkgewogICAgICAgICAgdGhyb3cgbmV3IF91dGlsLkZvcm1hdEVycm9yKGBJbnZhbGlkIGVudHJ5IGluIFhSZWYgc3Vic2VjdGlvbjogJHtmaXJzdH0sICR7Y291bnR9YCk7CiAgICAgICAgfQogICAgICAgIGlmIChpID09PSAwICYmIGVudHJ5LmZyZWUgJiYgZmlyc3QgPT09IDEpIHsKICAgICAgICAgIGZpcnN0ID0gMDsKICAgICAgICB9CiAgICAgICAgaWYgKCF0aGlzLmVudHJpZXNbaSArIGZpcnN0XSkgewogICAgICAgICAgdGhpcy5lbnRyaWVzW2kgKyBmaXJzdF0gPSBlbnRyeTsKICAgICAgICB9CiAgICAgIH0KICAgICAgdGFibGVTdGF0ZS5lbnRyeU51bSA9IDA7CiAgICAgIHRhYmxlU3RhdGUuc3RyZWFtUG9zID0gc3RyZWFtLnBvczsKICAgICAgdGFibGVTdGF0ZS5wYXJzZXJCdWYxID0gcGFyc2VyLmJ1ZjE7CiAgICAgIHRhYmxlU3RhdGUucGFyc2VyQnVmMiA9IHBhcnNlci5idWYyOwogICAgICBkZWxldGUgdGFibGVTdGF0ZS5maXJzdEVudHJ5TnVtOwogICAgICBkZWxldGUgdGFibGVTdGF0ZS5lbnRyeUNvdW50OwogICAgfQogICAgaWYgKHRoaXMuZW50cmllc1swXSAmJiAhdGhpcy5lbnRyaWVzWzBdLmZyZWUpIHsKICAgICAgdGhyb3cgbmV3IF91dGlsLkZvcm1hdEVycm9yKCJJbnZhbGlkIFhSZWYgdGFibGU6IHVuZXhwZWN0ZWQgZmlyc3Qgb2JqZWN0Iik7CiAgICB9CiAgICByZXR1cm4gb2JqOwogIH0KICBwcm9jZXNzWFJlZlN0cmVhbShzdHJlYW0pIHsKICAgIGlmICghKCJzdHJlYW1TdGF0ZSIgaW4gdGhpcykpIHsKICAgICAgY29uc3Qgc3RyZWFtUGFyYW1ldGVycyA9IHN0cmVhbS5kaWN0OwogICAgICBjb25zdCBieXRlV2lkdGhzID0gc3RyZWFtUGFyYW1ldGVycy5nZXQoIlciKTsKICAgICAgbGV0IHJhbmdlID0gc3RyZWFtUGFyYW1ldGVycy5nZXQoIkluZGV4Iik7CiAgICAgIGlmICghcmFuZ2UpIHsKICAgICAgICByYW5nZSA9IFswLCBzdHJlYW1QYXJhbWV0ZXJzLmdldCgiU2l6ZSIpXTsKICAgICAgfQogICAgICB0aGlzLnN0cmVhbVN0YXRlID0gewogICAgICAgIGVudHJ5UmFuZ2VzOiByYW5nZSwKICAgICAgICBieXRlV2lkdGhzLAogICAgICAgIGVudHJ5TnVtOiAwLAogICAgICAgIHN0cmVhbVBvczogc3RyZWFtLnBvcwogICAgICB9OwogICAgfQogICAgdGhpcy5yZWFkWFJlZlN0cmVhbShzdHJlYW0pOwogICAgZGVsZXRlIHRoaXMuc3RyZWFtU3RhdGU7CiAgICByZXR1cm4gc3RyZWFtLmRpY3Q7CiAgfQogIHJlYWRYUmVmU3RyZWFtKHN0cmVhbSkgewogICAgY29uc3Qgc3RyZWFtU3RhdGUgPSB0aGlzLnN0cmVhbVN0YXRlOwogICAgc3RyZWFtLnBvcyA9IHN0cmVhbVN0YXRlLnN0cmVhbVBvczsKICAgIGNvbnN0IFt0eXBlRmllbGRXaWR0aCwgb2Zmc2V0RmllbGRXaWR0aCwgZ2VuZXJhdGlvbkZpZWxkV2lkdGhdID0gc3RyZWFtU3RhdGUuYnl0ZVdpZHRoczsKICAgIGNvbnN0IGVudHJ5UmFuZ2VzID0gc3RyZWFtU3RhdGUuZW50cnlSYW5nZXM7CiAgICB3aGlsZSAoZW50cnlSYW5nZXMubGVuZ3RoID4gMCkgewogICAgICBjb25zdCBbZmlyc3QsIG5dID0gZW50cnlSYW5nZXM7CiAgICAgIGlmICghTnVtYmVyLmlzSW50ZWdlcihmaXJzdCkgfHwgIU51bWJlci5pc0ludGVnZXIobikpIHsKICAgICAgICB0aHJvdyBuZXcgX3V0aWwuRm9ybWF0RXJyb3IoYEludmFsaWQgWFJlZiByYW5nZSBmaWVsZHM6ICR7Zmlyc3R9LCAke259YCk7CiAgICAgIH0KICAgICAgaWYgKCFOdW1iZXIuaXNJbnRlZ2VyKHR5cGVGaWVsZFdpZHRoKSB8fCAhTnVtYmVyLmlzSW50ZWdlcihvZmZzZXRGaWVsZFdpZHRoKSB8fCAhTnVtYmVyLmlzSW50ZWdlcihnZW5lcmF0aW9uRmllbGRXaWR0aCkpIHsKICAgICAgICB0aHJvdyBuZXcgX3V0aWwuRm9ybWF0RXJyb3IoYEludmFsaWQgWFJlZiBlbnRyeSBmaWVsZHMgbGVuZ3RoOiAke2ZpcnN0fSwgJHtufWApOwogICAgICB9CiAgICAgIGZvciAobGV0IGkgPSBzdHJlYW1TdGF0ZS5lbnRyeU51bTsgaSA8IG47ICsraSkgewogICAgICAgIHN0cmVhbVN0YXRlLmVudHJ5TnVtID0gaTsKICAgICAgICBzdHJlYW1TdGF0ZS5zdHJlYW1Qb3MgPSBzdHJlYW0ucG9zOwogICAgICAgIGxldCB0eXBlID0gMCwKICAgICAgICAgIG9mZnNldCA9IDAsCiAgICAgICAgICBnZW5lcmF0aW9uID0gMDsKICAgICAgICBmb3IgKGxldCBqID0gMDsgaiA8IHR5cGVGaWVsZFdpZHRoOyArK2opIHsKICAgICAgICAgIGNvbnN0IHR5cGVCeXRlID0gc3RyZWFtLmdldEJ5dGUoKTsKICAgICAgICAgIGlmICh0eXBlQnl0ZSA9PT0gLTEpIHsKICAgICAgICAgICAgdGhyb3cgbmV3IF91dGlsLkZvcm1hdEVycm9yKCJJbnZhbGlkIFhSZWYgYnl0ZVdpZHRocyAndHlwZScuIik7CiAgICAgICAgICB9CiAgICAgICAgICB0eXBlID0gdHlwZSA8PCA4IHwgdHlwZUJ5dGU7CiAgICAgICAgfQogICAgICAgIGlmICh0eXBlRmllbGRXaWR0aCA9PT0gMCkgewogICAgICAgICAgdHlwZSA9IDE7CiAgICAgICAgfQogICAgICAgIGZvciAobGV0IGogPSAwOyBqIDwgb2Zmc2V0RmllbGRXaWR0aDsgKytqKSB7CiAgICAgICAgICBjb25zdCBvZmZzZXRCeXRlID0gc3RyZWFtLmdldEJ5dGUoKTsKICAgICAgICAgIGlmIChvZmZzZXRCeXRlID09PSAtMSkgewogICAgICAgICAgICB0aHJvdyBuZXcgX3V0aWwuRm9ybWF0RXJyb3IoIkludmFsaWQgWFJlZiBieXRlV2lkdGhzICdvZmZzZXQnLiIpOwogICAgICAgICAgfQogICAgICAgICAgb2Zmc2V0ID0gb2Zmc2V0IDw8IDggfCBvZmZzZXRCeXRlOwogICAgICAgIH0KICAgICAgICBmb3IgKGxldCBqID0gMDsgaiA8IGdlbmVyYXRpb25GaWVsZFdpZHRoOyArK2opIHsKICAgICAgICAgIGNvbnN0IGdlbmVyYXRpb25CeXRlID0gc3RyZWFtLmdldEJ5dGUoKTsKICAgICAgICAgIGlmIChnZW5lcmF0aW9uQnl0ZSA9PT0gLTEpIHsKICAgICAgICAgICAgdGhyb3cgbmV3IF91dGlsLkZvcm1hdEVycm9yKCJJbnZhbGlkIFhSZWYgYnl0ZVdpZHRocyAnZ2VuZXJhdGlvbicuIik7CiAgICAgICAgICB9CiAgICAgICAgICBnZW5lcmF0aW9uID0gZ2VuZXJhdGlvbiA8PCA4IHwgZ2VuZXJhdGlvbkJ5dGU7CiAgICAgICAgfQogICAgICAgIGNvbnN0IGVudHJ5ID0ge307CiAgICAgICAgZW50cnkub2Zmc2V0ID0gb2Zmc2V0OwogICAgICAgIGVudHJ5LmdlbiA9IGdlbmVyYXRpb247CiAgICAgICAgc3dpdGNoICh0eXBlKSB7CiAgICAgICAgICBjYXNlIDA6CiAgICAgICAgICAgIGVudHJ5LmZyZWUgPSB0cnVlOwogICAgICAgICAgICBicmVhazsKICAgICAgICAgIGNhc2UgMToKICAgICAgICAgICAgZW50cnkudW5jb21wcmVzc2VkID0gdHJ1ZTsKICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICBjYXNlIDI6CiAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgZGVmYXVsdDoKICAgICAgICAgICAgdGhyb3cgbmV3IF91dGlsLkZvcm1hdEVycm9yKGBJbnZhbGlkIFhSZWYgZW50cnkgdHlwZTogJHt0eXBlfWApOwogICAgICAgIH0KICAgICAgICBpZiAoIXRoaXMuZW50cmllc1tmaXJzdCArIGldKSB7CiAgICAgICAgICB0aGlzLmVudHJpZXNbZmlyc3QgKyBpXSA9IGVudHJ5OwogICAgICAgIH0KICAgICAgfQogICAgICBzdHJlYW1TdGF0ZS5lbnRyeU51bSA9IDA7CiAgICAgIHN0cmVhbVN0YXRlLnN0cmVhbVBvcyA9IHN0cmVhbS5wb3M7CiAgICAgIGVudHJ5UmFuZ2VzLnNwbGljZSgwLCAyKTsKICAgIH0KICB9CiAgaW5kZXhPYmplY3RzKCkgewogICAgY29uc3QgVEFCID0gMHg5LAogICAgICBMRiA9IDB4YSwKICAgICAgQ1IgPSAweGQsCiAgICAgIFNQQUNFID0gMHgyMDsKICAgIGNvbnN0IFBFUkNFTlQgPSAweDI1LAogICAgICBMVCA9IDB4M2M7CiAgICBmdW5jdGlvbiByZWFkVG9rZW4oZGF0YSwgb2Zmc2V0KSB7CiAgICAgIGxldCB0b2tlbiA9ICIiLAogICAgICAgIGNoID0gZGF0YVtvZmZzZXRdOwogICAgICB3aGlsZSAoY2ggIT09IExGICYmIGNoICE9PSBDUiAmJiBjaCAhPT0gTFQpIHsKICAgICAgICBpZiAoKytvZmZzZXQgPj0gZGF0YS5sZW5ndGgpIHsKICAgICAgICAgIGJyZWFrOwogICAgICAgIH0KICAgICAgICB0b2tlbiArPSBTdHJpbmcuZnJvbUNoYXJDb2RlKGNoKTsKICAgICAgICBjaCA9IGRhdGFbb2Zmc2V0XTsKICAgICAgfQogICAgICByZXR1cm4gdG9rZW47CiAgICB9CiAgICBmdW5jdGlvbiBza2lwVW50aWwoZGF0YSwgb2Zmc2V0LCB3aGF0KSB7CiAgICAgIGNvbnN0IGxlbmd0aCA9IHdoYXQubGVuZ3RoLAogICAgICAgIGRhdGFMZW5ndGggPSBkYXRhLmxlbmd0aDsKICAgICAgbGV0IHNraXBwZWQgPSAwOwogICAgICB3aGlsZSAob2Zmc2V0IDwgZGF0YUxlbmd0aCkgewogICAgICAgIGxldCBpID0gMDsKICAgICAgICB3aGlsZSAoaSA8IGxlbmd0aCAmJiBkYXRhW29mZnNldCArIGldID09PSB3aGF0W2ldKSB7CiAgICAgICAgICArK2k7CiAgICAgICAgfQogICAgICAgIGlmIChpID49IGxlbmd0aCkgewogICAgICAgICAgYnJlYWs7CiAgICAgICAgfQogICAgICAgIG9mZnNldCsrOwogICAgICAgIHNraXBwZWQrKzsKICAgICAgfQogICAgICByZXR1cm4gc2tpcHBlZDsKICAgIH0KICAgIGNvbnN0IGdFbmRvYmpSZWdFeHAgPSAvXGIoZW5kb2JqfFxkK1xzK1xkK1xzK29ianx4cmVmfHRyYWlsZXJccyo8PClcYi9nOwogICAgY29uc3QgZ1N0YXJ0eHJlZlJlZ0V4cCA9IC9cYihzdGFydHhyZWZ8XGQrXHMrXGQrXHMrb2JqKVxiL2c7CiAgICBjb25zdCBvYmpSZWdFeHAgPSAvXihcZCspXHMrKFxkKylccytvYmpcYi87CiAgICBjb25zdCB0cmFpbGVyQnl0ZXMgPSBuZXcgVWludDhBcnJheShbMTE2LCAxMTQsIDk3LCAxMDUsIDEwOCwgMTAxLCAxMTRdKTsKICAgIGNvbnN0IHN0YXJ0eHJlZkJ5dGVzID0gbmV3IFVpbnQ4QXJyYXkoWzExNSwgMTE2LCA5NywgMTE0LCAxMTYsIDEyMCwgMTE0LCAxMDEsIDEwMl0pOwogICAgY29uc3QgeHJlZkJ5dGVzID0gbmV3IFVpbnQ4QXJyYXkoWzQ3LCA4OCwgODIsIDEwMSwgMTAyXSk7CiAgICB0aGlzLmVudHJpZXMubGVuZ3RoID0gMDsKICAgIHRoaXMuX2NhY2hlTWFwLmNsZWFyKCk7CiAgICBjb25zdCBzdHJlYW0gPSB0aGlzLnN0cmVhbTsKICAgIHN0cmVhbS5wb3MgPSAwOwogICAgY29uc3QgYnVmZmVyID0gc3RyZWFtLmdldEJ5dGVzKCksCiAgICAgIGJ1ZmZlclN0ciA9ICgwLCBfdXRpbC5ieXRlc1RvU3RyaW5nKShidWZmZXIpLAogICAgICBsZW5ndGggPSBidWZmZXIubGVuZ3RoOwogICAgbGV0IHBvc2l0aW9uID0gc3RyZWFtLnN0YXJ0OwogICAgY29uc3QgdHJhaWxlcnMgPSBbXSwKICAgICAgeHJlZlN0bXMgPSBbXTsKICAgIHdoaWxlIChwb3NpdGlvbiA8IGxlbmd0aCkgewogICAgICBsZXQgY2ggPSBidWZmZXJbcG9zaXRpb25dOwogICAgICBpZiAoY2ggPT09IFRBQiB8fCBjaCA9PT0gTEYgfHwgY2ggPT09IENSIHx8IGNoID09PSBTUEFDRSkgewogICAgICAgICsrcG9zaXRpb247CiAgICAgICAgY29udGludWU7CiAgICAgIH0KICAgICAgaWYgKGNoID09PSBQRVJDRU5UKSB7CiAgICAgICAgZG8gewogICAgICAgICAgKytwb3NpdGlvbjsKICAgICAgICAgIGlmIChwb3NpdGlvbiA+PSBsZW5ndGgpIHsKICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICB9CiAgICAgICAgICBjaCA9IGJ1ZmZlcltwb3NpdGlvbl07CiAgICAgICAgfSB3aGlsZSAoY2ggIT09IExGICYmIGNoICE9PSBDUik7CiAgICAgICAgY29udGludWU7CiAgICAgIH0KICAgICAgY29uc3QgdG9rZW4gPSByZWFkVG9rZW4oYnVmZmVyLCBwb3NpdGlvbik7CiAgICAgIGxldCBtOwogICAgICBpZiAodG9rZW4uc3RhcnRzV2l0aCgieHJlZiIpICYmICh0b2tlbi5sZW5ndGggPT09IDQgfHwgL1xzLy50ZXN0KHRva2VuWzRdKSkpIHsKICAgICAgICBwb3NpdGlvbiArPSBza2lwVW50aWwoYnVmZmVyLCBwb3NpdGlvbiwgdHJhaWxlckJ5dGVzKTsKICAgICAgICB0cmFpbGVycy5wdXNoKHBvc2l0aW9uKTsKICAgICAgICBwb3NpdGlvbiArPSBza2lwVW50aWwoYnVmZmVyLCBwb3NpdGlvbiwgc3RhcnR4cmVmQnl0ZXMpOwogICAgICB9IGVsc2UgaWYgKG0gPSBvYmpSZWdFeHAuZXhlYyh0b2tlbikpIHsKICAgICAgICBjb25zdCBudW0gPSBtWzFdIHwgMCwKICAgICAgICAgIGdlbiA9IG1bMl0gfCAwOwogICAgICAgIGNvbnN0IHN0YXJ0UG9zID0gcG9zaXRpb24gKyB0b2tlbi5sZW5ndGg7CiAgICAgICAgbGV0IGNvbnRlbnRMZW5ndGgsCiAgICAgICAgICB1cGRhdGVFbnRyaWVzID0gZmFsc2U7CiAgICAgICAgaWYgKCF0aGlzLmVudHJpZXNbbnVtXSkgewogICAgICAgICAgdXBkYXRlRW50cmllcyA9IHRydWU7CiAgICAgICAgfSBlbHNlIGlmICh0aGlzLmVudHJpZXNbbnVtXS5nZW4gPT09IGdlbikgewogICAgICAgICAgdHJ5IHsKICAgICAgICAgICAgY29uc3QgcGFyc2VyID0gbmV3IF9wYXJzZXIuUGFyc2VyKHsKICAgICAgICAgICAgICBsZXhlcjogbmV3IF9wYXJzZXIuTGV4ZXIoc3RyZWFtLm1ha2VTdWJTdHJlYW0oc3RhcnRQb3MpKQogICAgICAgICAgICB9KTsKICAgICAgICAgICAgcGFyc2VyLmdldE9iaigpOwogICAgICAgICAgICB1cGRhdGVFbnRyaWVzID0gdHJ1ZTsKICAgICAgICAgIH0gY2F0Y2ggKGV4KSB7CiAgICAgICAgICAgIGlmIChleCBpbnN0YW5jZW9mIF9jb3JlX3V0aWxzLlBhcnNlckVPRkV4Y2VwdGlvbikgewogICAgICAgICAgICAgICgwLCBfdXRpbC53YXJuKShgaW5kZXhPYmplY3RzIC0tIGNoZWNraW5nIG9iamVjdCAoJHt0b2tlbn0pOiAiJHtleH0iLmApOwogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgIHVwZGF0ZUVudHJpZXMgPSB0cnVlOwogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIGlmICh1cGRhdGVFbnRyaWVzKSB7CiAgICAgICAgICB0aGlzLmVudHJpZXNbbnVtXSA9IHsKICAgICAgICAgICAgb2Zmc2V0OiBwb3NpdGlvbiAtIHN0cmVhbS5zdGFydCwKICAgICAgICAgICAgZ2VuLAogICAgICAgICAgICB1bmNvbXByZXNzZWQ6IHRydWUKICAgICAgICAgIH07CiAgICAgICAgfQogICAgICAgIGdFbmRvYmpSZWdFeHAubGFzdEluZGV4ID0gc3RhcnRQb3M7CiAgICAgICAgY29uc3QgbWF0Y2ggPSBnRW5kb2JqUmVnRXhwLmV4ZWMoYnVmZmVyU3RyKTsKICAgICAgICBpZiAobWF0Y2gpIHsKICAgICAgICAgIGNvbnN0IGVuZFBvcyA9IGdFbmRvYmpSZWdFeHAubGFzdEluZGV4ICsgMTsKICAgICAgICAgIGNvbnRlbnRMZW5ndGggPSBlbmRQb3MgLSBwb3NpdGlvbjsKICAgICAgICAgIGlmIChtYXRjaFsxXSAhPT0gImVuZG9iaiIpIHsKICAgICAgICAgICAgKDAsIF91dGlsLndhcm4pKGBpbmRleE9iamVjdHM6IEZvdW5kICIke21hdGNoWzFdfSIgaW5zaWRlIG9mIGFub3RoZXIgIm9iaiIsIGAgKyAnY2F1c2VkIGJ5IG1pc3NpbmcgImVuZG9iaiIgLS0gdHJ5aW5nIHRvIHJlY292ZXIuJyk7CiAgICAgICAgICAgIGNvbnRlbnRMZW5ndGggLT0gbWF0Y2hbMV0ubGVuZ3RoICsgMTsKICAgICAgICAgIH0KICAgICAgICB9IGVsc2UgewogICAgICAgICAgY29udGVudExlbmd0aCA9IGxlbmd0aCAtIHBvc2l0aW9uOwogICAgICAgIH0KICAgICAgICBjb25zdCBjb250ZW50ID0gYnVmZmVyLnN1YmFycmF5KHBvc2l0aW9uLCBwb3NpdGlvbiArIGNvbnRlbnRMZW5ndGgpOwogICAgICAgIGNvbnN0IHhyZWZUYWdPZmZzZXQgPSBza2lwVW50aWwoY29udGVudCwgMCwgeHJlZkJ5dGVzKTsKICAgICAgICBpZiAoeHJlZlRhZ09mZnNldCA8IGNvbnRlbnRMZW5ndGggJiYgY29udGVudFt4cmVmVGFnT2Zmc2V0ICsgNV0gPCA2NCkgewogICAgICAgICAgeHJlZlN0bXMucHVzaChwb3NpdGlvbiAtIHN0cmVhbS5zdGFydCk7CiAgICAgICAgICB0aGlzLl94cmVmU3Rtcy5hZGQocG9zaXRpb24gLSBzdHJlYW0uc3RhcnQpOwogICAgICAgIH0KICAgICAgICBwb3NpdGlvbiArPSBjb250ZW50TGVuZ3RoOwogICAgICB9IGVsc2UgaWYgKHRva2VuLnN0YXJ0c1dpdGgoInRyYWlsZXIiKSAmJiAodG9rZW4ubGVuZ3RoID09PSA3IHx8IC9ccy8udGVzdCh0b2tlbls3XSkpKSB7CiAgICAgICAgdHJhaWxlcnMucHVzaChwb3NpdGlvbik7CiAgICAgICAgY29uc3Qgc3RhcnRQb3MgPSBwb3NpdGlvbiArIHRva2VuLmxlbmd0aDsKICAgICAgICBsZXQgY29udGVudExlbmd0aDsKICAgICAgICBnU3RhcnR4cmVmUmVnRXhwLmxhc3RJbmRleCA9IHN0YXJ0UG9zOwogICAgICAgIGNvbnN0IG1hdGNoID0gZ1N0YXJ0eHJlZlJlZ0V4cC5leGVjKGJ1ZmZlclN0cik7CiAgICAgICAgaWYgKG1hdGNoKSB7CiAgICAgICAgICBjb25zdCBlbmRQb3MgPSBnU3RhcnR4cmVmUmVnRXhwLmxhc3RJbmRleCArIDE7CiAgICAgICAgICBjb250ZW50TGVuZ3RoID0gZW5kUG9zIC0gcG9zaXRpb247CiAgICAgICAgICBpZiAobWF0Y2hbMV0gIT09ICJzdGFydHhyZWYiKSB7CiAgICAgICAgICAgICgwLCBfdXRpbC53YXJuKShgaW5kZXhPYmplY3RzOiBGb3VuZCAiJHttYXRjaFsxXX0iIGFmdGVyICJ0cmFpbGVyIiwgYCArICdjYXVzZWQgYnkgbWlzc2luZyAic3RhcnR4cmVmIiAtLSB0cnlpbmcgdG8gcmVjb3Zlci4nKTsKICAgICAgICAgICAgY29udGVudExlbmd0aCAtPSBtYXRjaFsxXS5sZW5ndGggKyAxOwogICAgICAgICAgfQogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICBjb250ZW50TGVuZ3RoID0gbGVuZ3RoIC0gcG9zaXRpb247CiAgICAgICAgfQogICAgICAgIHBvc2l0aW9uICs9IGNvbnRlbnRMZW5ndGg7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgcG9zaXRpb24gKz0gdG9rZW4ubGVuZ3RoICsgMTsKICAgICAgfQogICAgfQogICAgZm9yIChjb25zdCB4cmVmU3RtIG9mIHhyZWZTdG1zKSB7CiAgICAgIHRoaXMuc3RhcnRYUmVmUXVldWUucHVzaCh4cmVmU3RtKTsKICAgICAgdGhpcy5yZWFkWFJlZih0cnVlKTsKICAgIH0KICAgIGNvbnN0IHRyYWlsZXJEaWN0cyA9IFtdOwogICAgbGV0IGlzRW5jcnlwdGVkID0gZmFsc2U7CiAgICBmb3IgKGNvbnN0IHRyYWlsZXIgb2YgdHJhaWxlcnMpIHsKICAgICAgc3RyZWFtLnBvcyA9IHRyYWlsZXI7CiAgICAgIGNvbnN0IHBhcnNlciA9IG5ldyBfcGFyc2VyLlBhcnNlcih7CiAgICAgICAgbGV4ZXI6IG5ldyBfcGFyc2VyLkxleGVyKHN0cmVhbSksCiAgICAgICAgeHJlZjogdGhpcywKICAgICAgICBhbGxvd1N0cmVhbXM6IHRydWUsCiAgICAgICAgcmVjb3ZlcnlNb2RlOiB0cnVlCiAgICAgIH0pOwogICAgICBjb25zdCBvYmogPSBwYXJzZXIuZ2V0T2JqKCk7CiAgICAgIGlmICghKDAsIF9wcmltaXRpdmVzLmlzQ21kKShvYmosICJ0cmFpbGVyIikpIHsKICAgICAgICBjb250aW51ZTsKICAgICAgfQogICAgICBjb25zdCBkaWN0ID0gcGFyc2VyLmdldE9iaigpOwogICAgICBpZiAoIShkaWN0IGluc3RhbmNlb2YgX3ByaW1pdGl2ZXMuRGljdCkpIHsKICAgICAgICBjb250aW51ZTsKICAgICAgfQogICAgICB0cmFpbGVyRGljdHMucHVzaChkaWN0KTsKICAgICAgaWYgKGRpY3QuaGFzKCJFbmNyeXB0IikpIHsKICAgICAgICBpc0VuY3J5cHRlZCA9IHRydWU7CiAgICAgIH0KICAgIH0KICAgIGxldCB0cmFpbGVyRGljdCwgdHJhaWxlckVycm9yOwogICAgZm9yIChjb25zdCBkaWN0IG9mIFsuLi50cmFpbGVyRGljdHMsICJnZW5GYWxsYmFjayIsIC4uLnRyYWlsZXJEaWN0c10pIHsKICAgICAgaWYgKGRpY3QgPT09ICJnZW5GYWxsYmFjayIpIHsKICAgICAgICBpZiAoIXRyYWlsZXJFcnJvcikgewogICAgICAgICAgYnJlYWs7CiAgICAgICAgfQogICAgICAgIHRoaXMuX2dlbmVyYXRpb25GYWxsYmFjayA9IHRydWU7CiAgICAgICAgY29udGludWU7CiAgICAgIH0KICAgICAgbGV0IHZhbGlkUGFnZXNEaWN0ID0gZmFsc2U7CiAgICAgIHRyeSB7CiAgICAgICAgY29uc3Qgcm9vdERpY3QgPSBkaWN0LmdldCgiUm9vdCIpOwogICAgICAgIGlmICghKHJvb3REaWN0IGluc3RhbmNlb2YgX3ByaW1pdGl2ZXMuRGljdCkpIHsKICAgICAgICAgIGNvbnRpbnVlOwogICAgICAgIH0KICAgICAgICBjb25zdCBwYWdlc0RpY3QgPSByb290RGljdC5nZXQoIlBhZ2VzIik7CiAgICAgICAgaWYgKCEocGFnZXNEaWN0IGluc3RhbmNlb2YgX3ByaW1pdGl2ZXMuRGljdCkpIHsKICAgICAgICAgIGNvbnRpbnVlOwogICAgICAgIH0KICAgICAgICBjb25zdCBwYWdlc0NvdW50ID0gcGFnZXNEaWN0LmdldCgiQ291bnQiKTsKICAgICAgICBpZiAoTnVtYmVyLmlzSW50ZWdlcihwYWdlc0NvdW50KSkgewogICAgICAgICAgdmFsaWRQYWdlc0RpY3QgPSB0cnVlOwogICAgICAgIH0KICAgICAgfSBjYXRjaCAoZXgpIHsKICAgICAgICB0cmFpbGVyRXJyb3IgPSBleDsKICAgICAgICBjb250aW51ZTsKICAgICAgfQogICAgICBpZiAodmFsaWRQYWdlc0RpY3QgJiYgKCFpc0VuY3J5cHRlZCB8fCBkaWN0LmhhcygiRW5jcnlwdCIpKSAmJiBkaWN0LmhhcygiSUQiKSkgewogICAgICAgIHJldHVybiBkaWN0OwogICAgICB9CiAgICAgIHRyYWlsZXJEaWN0ID0gZGljdDsKICAgIH0KICAgIGlmICh0cmFpbGVyRGljdCkgewogICAgICByZXR1cm4gdHJhaWxlckRpY3Q7CiAgICB9CiAgICBpZiAodGhpcy50b3BEaWN0KSB7CiAgICAgIHJldHVybiB0aGlzLnRvcERpY3Q7CiAgICB9CiAgICB0aHJvdyBuZXcgX3V0aWwuSW52YWxpZFBERkV4Y2VwdGlvbigiSW52YWxpZCBQREYgc3RydWN0dXJlLiIpOwogIH0KICByZWFkWFJlZihyZWNvdmVyeU1vZGUgPSBmYWxzZSkgewogICAgY29uc3Qgc3RyZWFtID0gdGhpcy5zdHJlYW07CiAgICBjb25zdCBzdGFydFhSZWZQYXJzZWRDYWNoZSA9IG5ldyBTZXQoKTsKICAgIHdoaWxlICh0aGlzLnN0YXJ0WFJlZlF1ZXVlLmxlbmd0aCkgewogICAgICB0cnkgewogICAgICAgIGNvbnN0IHN0YXJ0WFJlZiA9IHRoaXMuc3RhcnRYUmVmUXVldWVbMF07CiAgICAgICAgaWYgKHN0YXJ0WFJlZlBhcnNlZENhY2hlLmhhcyhzdGFydFhSZWYpKSB7CiAgICAgICAgICAoMCwgX3V0aWwud2FybikoInJlYWRYUmVmIC0gc2tpcHBpbmcgWFJlZiB0YWJsZSBzaW5jZSBpdCB3YXMgYWxyZWFkeSBwYXJzZWQuIik7CiAgICAgICAgICB0aGlzLnN0YXJ0WFJlZlF1ZXVlLnNoaWZ0KCk7CiAgICAgICAgICBjb250aW51ZTsKICAgICAgICB9CiAgICAgICAgc3RhcnRYUmVmUGFyc2VkQ2FjaGUuYWRkKHN0YXJ0WFJlZik7CiAgICAgICAgc3RyZWFtLnBvcyA9IHN0YXJ0WFJlZiArIHN0cmVhbS5zdGFydDsKICAgICAgICBjb25zdCBwYXJzZXIgPSBuZXcgX3BhcnNlci5QYXJzZXIoewogICAgICAgICAgbGV4ZXI6IG5ldyBfcGFyc2VyLkxleGVyKHN0cmVhbSksCiAgICAgICAgICB4cmVmOiB0aGlzLAogICAgICAgICAgYWxsb3dTdHJlYW1zOiB0cnVlCiAgICAgICAgfSk7CiAgICAgICAgbGV0IG9iaiA9IHBhcnNlci5nZXRPYmooKTsKICAgICAgICBsZXQgZGljdDsKICAgICAgICBpZiAoKDAsIF9wcmltaXRpdmVzLmlzQ21kKShvYmosICJ4cmVmIikpIHsKICAgICAgICAgIGRpY3QgPSB0aGlzLnByb2Nlc3NYUmVmVGFibGUocGFyc2VyKTsKICAgICAgICAgIGlmICghdGhpcy50b3BEaWN0KSB7CiAgICAgICAgICAgIHRoaXMudG9wRGljdCA9IGRpY3Q7CiAgICAgICAgICB9CiAgICAgICAgICBvYmogPSBkaWN0LmdldCgiWFJlZlN0bSIpOwogICAgICAgICAgaWYgKE51bWJlci5pc0ludGVnZXIob2JqKSAmJiAhdGhpcy5feHJlZlN0bXMuaGFzKG9iaikpIHsKICAgICAgICAgICAgdGhpcy5feHJlZlN0bXMuYWRkKG9iaik7CiAgICAgICAgICAgIHRoaXMuc3RhcnRYUmVmUXVldWUucHVzaChvYmopOwogICAgICAgICAgICB0aGlzLiNmaXJzdFhSZWZTdG1Qb3MgPz89IG9iajsKICAgICAgICAgIH0KICAgICAgICB9IGVsc2UgaWYgKE51bWJlci5pc0ludGVnZXIob2JqKSkgewogICAgICAgICAgaWYgKCFOdW1iZXIuaXNJbnRlZ2VyKHBhcnNlci5nZXRPYmooKSkgfHwgISgwLCBfcHJpbWl0aXZlcy5pc0NtZCkocGFyc2VyLmdldE9iaigpLCAib2JqIikgfHwgISgob2JqID0gcGFyc2VyLmdldE9iaigpKSBpbnN0YW5jZW9mIF9iYXNlX3N0cmVhbS5CYXNlU3RyZWFtKSkgewogICAgICAgICAgICB0aHJvdyBuZXcgX3V0aWwuRm9ybWF0RXJyb3IoIkludmFsaWQgWFJlZiBzdHJlYW0iKTsKICAgICAgICAgIH0KICAgICAgICAgIGRpY3QgPSB0aGlzLnByb2Nlc3NYUmVmU3RyZWFtKG9iaik7CiAgICAgICAgICBpZiAoIXRoaXMudG9wRGljdCkgewogICAgICAgICAgICB0aGlzLnRvcERpY3QgPSBkaWN0OwogICAgICAgICAgfQogICAgICAgICAgaWYgKCFkaWN0KSB7CiAgICAgICAgICAgIHRocm93IG5ldyBfdXRpbC5Gb3JtYXRFcnJvcigiRmFpbGVkIHRvIHJlYWQgWFJlZiBzdHJlYW0iKTsKICAgICAgICAgIH0KICAgICAgICB9IGVsc2UgewogICAgICAgICAgdGhyb3cgbmV3IF91dGlsLkZvcm1hdEVycm9yKCJJbnZhbGlkIFhSZWYgc3RyZWFtIGhlYWRlciIpOwogICAgICAgIH0KICAgICAgICBvYmogPSBkaWN0LmdldCgiUHJldiIpOwogICAgICAgIGlmIChOdW1iZXIuaXNJbnRlZ2VyKG9iaikpIHsKICAgICAgICAgIHRoaXMuc3RhcnRYUmVmUXVldWUucHVzaChvYmopOwogICAgICAgIH0gZWxzZSBpZiAob2JqIGluc3RhbmNlb2YgX3ByaW1pdGl2ZXMuUmVmKSB7CiAgICAgICAgICB0aGlzLnN0YXJ0WFJlZlF1ZXVlLnB1c2gob2JqLm51bSk7CiAgICAgICAgfQogICAgICB9IGNhdGNoIChlKSB7CiAgICAgICAgaWYgKGUgaW5zdGFuY2VvZiBfY29yZV91dGlscy5NaXNzaW5nRGF0YUV4Y2VwdGlvbikgewogICAgICAgICAgdGhyb3cgZTsKICAgICAgICB9CiAgICAgICAgKDAsIF91dGlsLmluZm8pKCIod2hpbGUgcmVhZGluZyBYUmVmKTogIiArIGUpOwogICAgICB9CiAgICAgIHRoaXMuc3RhcnRYUmVmUXVldWUuc2hpZnQoKTsKICAgIH0KICAgIGlmICh0aGlzLnRvcERpY3QpIHsKICAgICAgcmV0dXJuIHRoaXMudG9wRGljdDsKICAgIH0KICAgIGlmIChyZWNvdmVyeU1vZGUpIHsKICAgICAgcmV0dXJuIHVuZGVmaW5lZDsKICAgIH0KICAgIHRocm93IG5ldyBfY29yZV91dGlscy5YUmVmUGFyc2VFeGNlcHRpb24oKTsKICB9CiAgZ2V0IGxhc3RYUmVmU3RyZWFtUG9zKCkgewogICAgcmV0dXJuIHRoaXMuI2ZpcnN0WFJlZlN0bVBvcyA/PyAodGhpcy5feHJlZlN0bXMuc2l6ZSA+IDAgPyBNYXRoLm1heCguLi50aGlzLl94cmVmU3RtcykgOiBudWxsKTsKICB9CiAgZ2V0RW50cnkoaSkgewogICAgY29uc3QgeHJlZkVudHJ5ID0gdGhpcy5lbnRyaWVzW2ldOwogICAgaWYgKHhyZWZFbnRyeSAmJiAheHJlZkVudHJ5LmZyZWUgJiYgeHJlZkVudHJ5Lm9mZnNldCkgewogICAgICByZXR1cm4geHJlZkVudHJ5OwogICAgfQogICAgcmV0dXJuIG51bGw7CiAgfQogIGZldGNoSWZSZWYob2JqLCBzdXBwcmVzc0VuY3J5cHRpb24gPSBmYWxzZSkgewogICAgaWYgKG9iaiBpbnN0YW5jZW9mIF9wcmltaXRpdmVzLlJlZikgewogICAgICByZXR1cm4gdGhpcy5mZXRjaChvYmosIHN1cHByZXNzRW5jcnlwdGlvbik7CiAgICB9CiAgICByZXR1cm4gb2JqOwogIH0KICBmZXRjaChyZWYsIHN1cHByZXNzRW5jcnlwdGlvbiA9IGZhbHNlKSB7CiAgICBpZiAoIShyZWYgaW5zdGFuY2VvZiBfcHJpbWl0aXZlcy5SZWYpKSB7CiAgICAgIHRocm93IG5ldyBFcnJvcigicmVmIG9iamVjdCBpcyBub3QgYSByZWZlcmVuY2UiKTsKICAgIH0KICAgIGNvbnN0IG51bSA9IHJlZi5udW07CiAgICBjb25zdCBjYWNoZUVudHJ5ID0gdGhpcy5fY2FjaGVNYXAuZ2V0KG51bSk7CiAgICBpZiAoY2FjaGVFbnRyeSAhPT0gdW5kZWZpbmVkKSB7CiAgICAgIGlmIChjYWNoZUVudHJ5IGluc3RhbmNlb2YgX3ByaW1pdGl2ZXMuRGljdCAmJiAhY2FjaGVFbnRyeS5vYmpJZCkgewogICAgICAgIGNhY2hlRW50cnkub2JqSWQgPSByZWYudG9TdHJpbmcoKTsKICAgICAgfQogICAgICByZXR1cm4gY2FjaGVFbnRyeTsKICAgIH0KICAgIGxldCB4cmVmRW50cnkgPSB0aGlzLmdldEVudHJ5KG51bSk7CiAgICBpZiAoeHJlZkVudHJ5ID09PSBudWxsKSB7CiAgICAgIHRoaXMuX2NhY2hlTWFwLnNldChudW0sIHhyZWZFbnRyeSk7CiAgICAgIHJldHVybiB4cmVmRW50cnk7CiAgICB9CiAgICBpZiAodGhpcy5fcGVuZGluZ1JlZnMuaGFzKHJlZikpIHsKICAgICAgdGhpcy5fcGVuZGluZ1JlZnMucmVtb3ZlKHJlZik7CiAgICAgICgwLCBfdXRpbC53YXJuKShgSWdub3JpbmcgY2lyY3VsYXIgcmVmZXJlbmNlOiAke3JlZn0uYCk7CiAgICAgIHJldHVybiBfcHJpbWl0aXZlcy5DSVJDVUxBUl9SRUY7CiAgICB9CiAgICB0aGlzLl9wZW5kaW5nUmVmcy5wdXQocmVmKTsKICAgIHRyeSB7CiAgICAgIHhyZWZFbnRyeSA9IHhyZWZFbnRyeS51bmNvbXByZXNzZWQgPyB0aGlzLmZldGNoVW5jb21wcmVzc2VkKHJlZiwgeHJlZkVudHJ5LCBzdXBwcmVzc0VuY3J5cHRpb24pIDogdGhpcy5mZXRjaENvbXByZXNzZWQocmVmLCB4cmVmRW50cnksIHN1cHByZXNzRW5jcnlwdGlvbik7CiAgICAgIHRoaXMuX3BlbmRpbmdSZWZzLnJlbW92ZShyZWYpOwogICAgfSBjYXRjaCAoZXgpIHsKICAgICAgdGhpcy5fcGVuZGluZ1JlZnMucmVtb3ZlKHJlZik7CiAgICAgIHRocm93IGV4OwogICAgfQogICAgaWYgKHhyZWZFbnRyeSBpbnN0YW5jZW9mIF9wcmltaXRpdmVzLkRpY3QpIHsKICAgICAgeHJlZkVudHJ5Lm9iaklkID0gcmVmLnRvU3RyaW5nKCk7CiAgICB9IGVsc2UgaWYgKHhyZWZFbnRyeSBpbnN0YW5jZW9mIF9iYXNlX3N0cmVhbS5CYXNlU3RyZWFtKSB7CiAgICAgIHhyZWZFbnRyeS5kaWN0Lm9iaklkID0gcmVmLnRvU3RyaW5nKCk7CiAgICB9CiAgICByZXR1cm4geHJlZkVudHJ5OwogIH0KICBmZXRjaFVuY29tcHJlc3NlZChyZWYsIHhyZWZFbnRyeSwgc3VwcHJlc3NFbmNyeXB0aW9uID0gZmFsc2UpIHsKICAgIGNvbnN0IGdlbiA9IHJlZi5nZW47CiAgICBsZXQgbnVtID0gcmVmLm51bTsKICAgIGlmICh4cmVmRW50cnkuZ2VuICE9PSBnZW4pIHsKICAgICAgY29uc3QgbXNnID0gYEluY29uc2lzdGVudCBnZW5lcmF0aW9uIGluIFhSZWY6ICR7cmVmfWA7CiAgICAgIGlmICh0aGlzLl9nZW5lcmF0aW9uRmFsbGJhY2sgJiYgeHJlZkVudHJ5LmdlbiA8IGdlbikgewogICAgICAgICgwLCBfdXRpbC53YXJuKShtc2cpOwogICAgICAgIHJldHVybiB0aGlzLmZldGNoVW5jb21wcmVzc2VkKF9wcmltaXRpdmVzLlJlZi5nZXQobnVtLCB4cmVmRW50cnkuZ2VuKSwgeHJlZkVudHJ5LCBzdXBwcmVzc0VuY3J5cHRpb24pOwogICAgICB9CiAgICAgIHRocm93IG5ldyBfY29yZV91dGlscy5YUmVmRW50cnlFeGNlcHRpb24obXNnKTsKICAgIH0KICAgIGNvbnN0IHN0cmVhbSA9IHRoaXMuc3RyZWFtLm1ha2VTdWJTdHJlYW0oeHJlZkVudHJ5Lm9mZnNldCArIHRoaXMuc3RyZWFtLnN0YXJ0KTsKICAgIGNvbnN0IHBhcnNlciA9IG5ldyBfcGFyc2VyLlBhcnNlcih7CiAgICAgIGxleGVyOiBuZXcgX3BhcnNlci5MZXhlcihzdHJlYW0pLAogICAgICB4cmVmOiB0aGlzLAogICAgICBhbGxvd1N0cmVhbXM6IHRydWUKICAgIH0pOwogICAgY29uc3Qgb2JqMSA9IHBhcnNlci5nZXRPYmooKTsKICAgIGNvbnN0IG9iajIgPSBwYXJzZXIuZ2V0T2JqKCk7CiAgICBjb25zdCBvYmozID0gcGFyc2VyLmdldE9iaigpOwogICAgaWYgKG9iajEgIT09IG51bSB8fCBvYmoyICE9PSBnZW4gfHwgIShvYmozIGluc3RhbmNlb2YgX3ByaW1pdGl2ZXMuQ21kKSkgewogICAgICB0aHJvdyBuZXcgX2NvcmVfdXRpbHMuWFJlZkVudHJ5RXhjZXB0aW9uKGBCYWQgKHVuY29tcHJlc3NlZCkgWFJlZiBlbnRyeTogJHtyZWZ9YCk7CiAgICB9CiAgICBpZiAob2JqMy5jbWQgIT09ICJvYmoiKSB7CiAgICAgIGlmIChvYmozLmNtZC5zdGFydHNXaXRoKCJvYmoiKSkgewogICAgICAgIG51bSA9IHBhcnNlSW50KG9iajMuY21kLnN1YnN0cmluZygzKSwgMTApOwogICAgICAgIGlmICghTnVtYmVyLmlzTmFOKG51bSkpIHsKICAgICAgICAgIHJldHVybiBudW07CiAgICAgICAgfQogICAgICB9CiAgICAgIHRocm93IG5ldyBfY29yZV91dGlscy5YUmVmRW50cnlFeGNlcHRpb24oYEJhZCAodW5jb21wcmVzc2VkKSBYUmVmIGVudHJ5OiAke3JlZn1gKTsKICAgIH0KICAgIHhyZWZFbnRyeSA9IHRoaXMuZW5jcnlwdCAmJiAhc3VwcHJlc3NFbmNyeXB0aW9uID8gcGFyc2VyLmdldE9iaih0aGlzLmVuY3J5cHQuY3JlYXRlQ2lwaGVyVHJhbnNmb3JtKG51bSwgZ2VuKSkgOiBwYXJzZXIuZ2V0T2JqKCk7CiAgICBpZiAoISh4cmVmRW50cnkgaW5zdGFuY2VvZiBfYmFzZV9zdHJlYW0uQmFzZVN0cmVhbSkpIHsKICAgICAgdGhpcy5fY2FjaGVNYXAuc2V0KG51bSwgeHJlZkVudHJ5KTsKICAgIH0KICAgIHJldHVybiB4cmVmRW50cnk7CiAgfQogIGZldGNoQ29tcHJlc3NlZChyZWYsIHhyZWZFbnRyeSwgc3VwcHJlc3NFbmNyeXB0aW9uID0gZmFsc2UpIHsKICAgIGNvbnN0IHRhYmxlT2Zmc2V0ID0geHJlZkVudHJ5Lm9mZnNldDsKICAgIGNvbnN0IHN0cmVhbSA9IHRoaXMuZmV0Y2goX3ByaW1pdGl2ZXMuUmVmLmdldCh0YWJsZU9mZnNldCwgMCkpOwogICAgaWYgKCEoc3RyZWFtIGluc3RhbmNlb2YgX2Jhc2Vfc3RyZWFtLkJhc2VTdHJlYW0pKSB7CiAgICAgIHRocm93IG5ldyBfdXRpbC5Gb3JtYXRFcnJvcigiYmFkIE9ialN0bSBzdHJlYW0iKTsKICAgIH0KICAgIGNvbnN0IGZpcnN0ID0gc3RyZWFtLmRpY3QuZ2V0KCJGaXJzdCIpOwogICAgY29uc3QgbiA9IHN0cmVhbS5kaWN0LmdldCgiTiIpOwogICAgaWYgKCFOdW1iZXIuaXNJbnRlZ2VyKGZpcnN0KSB8fCAhTnVtYmVyLmlzSW50ZWdlcihuKSkgewogICAgICB0aHJvdyBuZXcgX3V0aWwuRm9ybWF0RXJyb3IoImludmFsaWQgZmlyc3QgYW5kIG4gcGFyYW1ldGVycyBmb3IgT2JqU3RtIHN0cmVhbSIpOwogICAgfQogICAgbGV0IHBhcnNlciA9IG5ldyBfcGFyc2VyLlBhcnNlcih7CiAgICAgIGxleGVyOiBuZXcgX3BhcnNlci5MZXhlcihzdHJlYW0pLAogICAgICB4cmVmOiB0aGlzLAogICAgICBhbGxvd1N0cmVhbXM6IHRydWUKICAgIH0pOwogICAgY29uc3QgbnVtcyA9IG5ldyBBcnJheShuKTsKICAgIGNvbnN0IG9mZnNldHMgPSBuZXcgQXJyYXkobik7CiAgICBmb3IgKGxldCBpID0gMDsgaSA8IG47ICsraSkgewogICAgICBjb25zdCBudW0gPSBwYXJzZXIuZ2V0T2JqKCk7CiAgICAgIGlmICghTnVtYmVyLmlzSW50ZWdlcihudW0pKSB7CiAgICAgICAgdGhyb3cgbmV3IF91dGlsLkZvcm1hdEVycm9yKGBpbnZhbGlkIG9iamVjdCBudW1iZXIgaW4gdGhlIE9ialN0bSBzdHJlYW06ICR7bnVtfWApOwogICAgICB9CiAgICAgIGNvbnN0IG9mZnNldCA9IHBhcnNlci5nZXRPYmooKTsKICAgICAgaWYgKCFOdW1iZXIuaXNJbnRlZ2VyKG9mZnNldCkpIHsKICAgICAgICB0aHJvdyBuZXcgX3V0aWwuRm9ybWF0RXJyb3IoYGludmFsaWQgb2JqZWN0IG9mZnNldCBpbiB0aGUgT2JqU3RtIHN0cmVhbTogJHtvZmZzZXR9YCk7CiAgICAgIH0KICAgICAgbnVtc1tpXSA9IG51bTsKICAgICAgb2Zmc2V0c1tpXSA9IG9mZnNldDsKICAgIH0KICAgIGNvbnN0IHN0YXJ0ID0gKHN0cmVhbS5zdGFydCB8fCAwKSArIGZpcnN0OwogICAgY29uc3QgZW50cmllcyA9IG5ldyBBcnJheShuKTsKICAgIGZvciAobGV0IGkgPSAwOyBpIDwgbjsgKytpKSB7CiAgICAgIGNvbnN0IGxlbmd0aCA9IGkgPCBuIC0gMSA/IG9mZnNldHNbaSArIDFdIC0gb2Zmc2V0c1tpXSA6IHVuZGVmaW5lZDsKICAgICAgaWYgKGxlbmd0aCA8IDApIHsKICAgICAgICB0aHJvdyBuZXcgX3V0aWwuRm9ybWF0RXJyb3IoIkludmFsaWQgb2Zmc2V0IGluIHRoZSBPYmpTdG0gc3RyZWFtLiIpOwogICAgICB9CiAgICAgIHBhcnNlciA9IG5ldyBfcGFyc2VyLlBhcnNlcih7CiAgICAgICAgbGV4ZXI6IG5ldyBfcGFyc2VyLkxleGVyKHN0cmVhbS5tYWtlU3ViU3RyZWFtKHN0YXJ0ICsgb2Zmc2V0c1tpXSwgbGVuZ3RoLCBzdHJlYW0uZGljdCkpLAogICAgICAgIHhyZWY6IHRoaXMsCiAgICAgICAgYWxsb3dTdHJlYW1zOiB0cnVlCiAgICAgIH0pOwogICAgICBjb25zdCBvYmogPSBwYXJzZXIuZ2V0T2JqKCk7CiAgICAgIGVudHJpZXNbaV0gPSBvYmo7CiAgICAgIGlmIChvYmogaW5zdGFuY2VvZiBfYmFzZV9zdHJlYW0uQmFzZVN0cmVhbSkgewogICAgICAgIGNvbnRpbnVlOwogICAgICB9CiAgICAgIGNvbnN0IG51bSA9IG51bXNbaV0sCiAgICAgICAgZW50cnkgPSB0aGlzLmVudHJpZXNbbnVtXTsKICAgICAgaWYgKGVudHJ5ICYmIGVudHJ5Lm9mZnNldCA9PT0gdGFibGVPZmZzZXQgJiYgZW50cnkuZ2VuID09PSBpKSB7CiAgICAgICAgdGhpcy5fY2FjaGVNYXAuc2V0KG51bSwgb2JqKTsKICAgICAgfQogICAgfQogICAgeHJlZkVudHJ5ID0gZW50cmllc1t4cmVmRW50cnkuZ2VuXTsKICAgIGlmICh4cmVmRW50cnkgPT09IHVuZGVmaW5lZCkgewogICAgICB0aHJvdyBuZXcgX2NvcmVfdXRpbHMuWFJlZkVudHJ5RXhjZXB0aW9uKGBCYWQgKGNvbXByZXNzZWQpIFhSZWYgZW50cnk6ICR7cmVmfWApOwogICAgfQogICAgcmV0dXJuIHhyZWZFbnRyeTsKICB9CiAgYXN5bmMgZmV0Y2hJZlJlZkFzeW5jKG9iaiwgc3VwcHJlc3NFbmNyeXB0aW9uKSB7CiAgICBpZiAob2JqIGluc3RhbmNlb2YgX3ByaW1pdGl2ZXMuUmVmKSB7CiAgICAgIHJldHVybiB0aGlzLmZldGNoQXN5bmMob2JqLCBzdXBwcmVzc0VuY3J5cHRpb24pOwogICAgfQogICAgcmV0dXJuIG9iajsKICB9CiAgYXN5bmMgZmV0Y2hBc3luYyhyZWYsIHN1cHByZXNzRW5jcnlwdGlvbikgewogICAgdHJ5IHsKICAgICAgcmV0dXJuIHRoaXMuZmV0Y2gocmVmLCBzdXBwcmVzc0VuY3J5cHRpb24pOwogICAgfSBjYXRjaCAoZXgpIHsKICAgICAgaWYgKCEoZXggaW5zdGFuY2VvZiBfY29yZV91dGlscy5NaXNzaW5nRGF0YUV4Y2VwdGlvbikpIHsKICAgICAgICB0aHJvdyBleDsKICAgICAgfQogICAgICBhd2FpdCB0aGlzLnBkZk1hbmFnZXIucmVxdWVzdFJhbmdlKGV4LmJlZ2luLCBleC5lbmQpOwogICAgICByZXR1cm4gdGhpcy5mZXRjaEFzeW5jKHJlZiwgc3VwcHJlc3NFbmNyeXB0aW9uKTsKICAgIH0KICB9CiAgZ2V0Q2F0YWxvZ09iaigpIHsKICAgIHJldHVybiB0aGlzLnJvb3Q7CiAgfQp9CmV4cG9ydHMuWFJlZiA9IFhSZWY7CgovKioqLyB9KSwKLyogMTA0ICovCi8qKiovICgoX191bnVzZWRfd2VicGFja19tb2R1bGUsIGV4cG9ydHMsIF9fd19wZGZqc19yZXF1aXJlX18pID0+IHsKCgoKT2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsICJfX2VzTW9kdWxlIiwgKHsKICB2YWx1ZTogdHJ1ZQp9KSk7CmV4cG9ydHMuTWVzc2FnZUhhbmRsZXIgPSB2b2lkIDA7CnZhciBfdXRpbCA9IF9fd19wZGZqc19yZXF1aXJlX18oMik7CmNvbnN0IENhbGxiYWNrS2luZCA9IHsKICBVTktOT1dOOiAwLAogIERBVEE6IDEsCiAgRVJST1I6IDIKfTsKY29uc3QgU3RyZWFtS2luZCA9IHsKICBVTktOT1dOOiAwLAogIENBTkNFTDogMSwKICBDQU5DRUxfQ09NUExFVEU6IDIsCiAgQ0xPU0U6IDMsCiAgRU5RVUVVRTogNCwKICBFUlJPUjogNSwKICBQVUxMOiA2LAogIFBVTExfQ09NUExFVEU6IDcsCiAgU1RBUlRfQ09NUExFVEU6IDgKfTsKZnVuY3Rpb24gd3JhcFJlYXNvbihyZWFzb24pIHsKICBpZiAoIShyZWFzb24gaW5zdGFuY2VvZiBFcnJvciB8fCB0eXBlb2YgcmVhc29uID09PSAib2JqZWN0IiAmJiByZWFzb24gIT09IG51bGwpKSB7CiAgICAoMCwgX3V0aWwudW5yZWFjaGFibGUpKCd3cmFwUmVhc29uOiBFeHBlY3RlZCAicmVhc29uIiB0byBiZSBhIChwb3NzaWJseSBjbG9uZWQpIEVycm9yLicpOwogIH0KICBzd2l0Y2ggKHJlYXNvbi5uYW1lKSB7CiAgICBjYXNlICJBYm9ydEV4Y2VwdGlvbiI6CiAgICAgIHJldHVybiBuZXcgX3V0aWwuQWJvcnRFeGNlcHRpb24ocmVhc29uLm1lc3NhZ2UpOwogICAgY2FzZSAiTWlzc2luZ1BERkV4Y2VwdGlvbiI6CiAgICAgIHJldHVybiBuZXcgX3V0aWwuTWlzc2luZ1BERkV4Y2VwdGlvbihyZWFzb24ubWVzc2FnZSk7CiAgICBjYXNlICJQYXNzd29yZEV4Y2VwdGlvbiI6CiAgICAgIHJldHVybiBuZXcgX3V0aWwuUGFzc3dvcmRFeGNlcHRpb24ocmVhc29uLm1lc3NhZ2UsIHJlYXNvbi5jb2RlKTsKICAgIGNhc2UgIlVuZXhwZWN0ZWRSZXNwb25zZUV4Y2VwdGlvbiI6CiAgICAgIHJldHVybiBuZXcgX3V0aWwuVW5leHBlY3RlZFJlc3BvbnNlRXhjZXB0aW9uKHJlYXNvbi5tZXNzYWdlLCByZWFzb24uc3RhdHVzKTsKICAgIGNhc2UgIlVua25vd25FcnJvckV4Y2VwdGlvbiI6CiAgICAgIHJldHVybiBuZXcgX3V0aWwuVW5rbm93bkVycm9yRXhjZXB0aW9uKHJlYXNvbi5tZXNzYWdlLCByZWFzb24uZGV0YWlscyk7CiAgICBkZWZhdWx0OgogICAgICByZXR1cm4gbmV3IF91dGlsLlVua25vd25FcnJvckV4Y2VwdGlvbihyZWFzb24ubWVzc2FnZSwgcmVhc29uLnRvU3RyaW5nKCkpOwogIH0KfQpjbGFzcyBNZXNzYWdlSGFuZGxlciB7CiAgY29uc3RydWN0b3Ioc291cmNlTmFtZSwgdGFyZ2V0TmFtZSwgY29tT2JqKSB7CiAgICB0aGlzLnNvdXJjZU5hbWUgPSBzb3VyY2VOYW1lOwogICAgdGhpcy50YXJnZXROYW1lID0gdGFyZ2V0TmFtZTsKICAgIHRoaXMuY29tT2JqID0gY29tT2JqOwogICAgdGhpcy5jYWxsYmFja0lkID0gMTsKICAgIHRoaXMuc3RyZWFtSWQgPSAxOwogICAgdGhpcy5zdHJlYW1TaW5rcyA9IE9iamVjdC5jcmVhdGUobnVsbCk7CiAgICB0aGlzLnN0cmVhbUNvbnRyb2xsZXJzID0gT2JqZWN0LmNyZWF0ZShudWxsKTsKICAgIHRoaXMuY2FsbGJhY2tDYXBhYmlsaXRpZXMgPSBPYmplY3QuY3JlYXRlKG51bGwpOwogICAgdGhpcy5hY3Rpb25IYW5kbGVyID0gT2JqZWN0LmNyZWF0ZShudWxsKTsKICAgIHRoaXMuX29uQ29tT2JqT25NZXNzYWdlID0gZXZlbnQgPT4gewogICAgICBjb25zdCBkYXRhID0gZXZlbnQuZGF0YTsKICAgICAgaWYgKGRhdGEudGFyZ2V0TmFtZSAhPT0gdGhpcy5zb3VyY2VOYW1lKSB7CiAgICAgICAgcmV0dXJuOwogICAgICB9CiAgICAgIGlmIChkYXRhLnN0cmVhbSkgewogICAgICAgIHRoaXMuI3Byb2Nlc3NTdHJlYW1NZXNzYWdlKGRhdGEpOwogICAgICAgIHJldHVybjsKICAgICAgfQogICAgICBpZiAoZGF0YS5jYWxsYmFjaykgewogICAgICAgIGNvbnN0IGNhbGxiYWNrSWQgPSBkYXRhLmNhbGxiYWNrSWQ7CiAgICAgICAgY29uc3QgY2FwYWJpbGl0eSA9IHRoaXMuY2FsbGJhY2tDYXBhYmlsaXRpZXNbY2FsbGJhY2tJZF07CiAgICAgICAgaWYgKCFjYXBhYmlsaXR5KSB7CiAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoYENhbm5vdCByZXNvbHZlIGNhbGxiYWNrICR7Y2FsbGJhY2tJZH1gKTsKICAgICAgICB9CiAgICAgICAgZGVsZXRlIHRoaXMuY2FsbGJhY2tDYXBhYmlsaXRpZXNbY2FsbGJhY2tJZF07CiAgICAgICAgaWYgKGRhdGEuY2FsbGJhY2sgPT09IENhbGxiYWNrS2luZC5EQVRBKSB7CiAgICAgICAgICBjYXBhYmlsaXR5LnJlc29sdmUoZGF0YS5kYXRhKTsKICAgICAgICB9IGVsc2UgaWYgKGRhdGEuY2FsbGJhY2sgPT09IENhbGxiYWNrS2luZC5FUlJPUikgewogICAgICAgICAgY2FwYWJpbGl0eS5yZWplY3Qod3JhcFJlYXNvbihkYXRhLnJlYXNvbikpOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoIlVuZXhwZWN0ZWQgY2FsbGJhY2sgY2FzZSIpOwogICAgICAgIH0KICAgICAgICByZXR1cm47CiAgICAgIH0KICAgICAgY29uc3QgYWN0aW9uID0gdGhpcy5hY3Rpb25IYW5kbGVyW2RhdGEuYWN0aW9uXTsKICAgICAgaWYgKCFhY3Rpb24pIHsKICAgICAgICB0aHJvdyBuZXcgRXJyb3IoYFVua25vd24gYWN0aW9uIGZyb20gd29ya2VyOiAke2RhdGEuYWN0aW9ufWApOwogICAgICB9CiAgICAgIGlmIChkYXRhLmNhbGxiYWNrSWQpIHsKICAgICAgICBjb25zdCBjYlNvdXJjZU5hbWUgPSB0aGlzLnNvdXJjZU5hbWU7CiAgICAgICAgY29uc3QgY2JUYXJnZXROYW1lID0gZGF0YS5zb3VyY2VOYW1lOwogICAgICAgIG5ldyBQcm9taXNlKGZ1bmN0aW9uIChyZXNvbHZlKSB7CiAgICAgICAgICByZXNvbHZlKGFjdGlvbihkYXRhLmRhdGEpKTsKICAgICAgICB9KS50aGVuKGZ1bmN0aW9uIChyZXN1bHQpIHsKICAgICAgICAgIGNvbU9iai5wb3N0TWVzc2FnZSh7CiAgICAgICAgICAgIHNvdXJjZU5hbWU6IGNiU291cmNlTmFtZSwKICAgICAgICAgICAgdGFyZ2V0TmFtZTogY2JUYXJnZXROYW1lLAogICAgICAgICAgICBjYWxsYmFjazogQ2FsbGJhY2tLaW5kLkRBVEEsCiAgICAgICAgICAgIGNhbGxiYWNrSWQ6IGRhdGEuY2FsbGJhY2tJZCwKICAgICAgICAgICAgZGF0YTogcmVzdWx0CiAgICAgICAgICB9KTsKICAgICAgICB9LCBmdW5jdGlvbiAocmVhc29uKSB7CiAgICAgICAgICBjb21PYmoucG9zdE1lc3NhZ2UoewogICAgICAgICAgICBzb3VyY2VOYW1lOiBjYlNvdXJjZU5hbWUsCiAgICAgICAgICAgIHRhcmdldE5hbWU6IGNiVGFyZ2V0TmFtZSwKICAgICAgICAgICAgY2FsbGJhY2s6IENhbGxiYWNrS2luZC5FUlJPUiwKICAgICAgICAgICAgY2FsbGJhY2tJZDogZGF0YS5jYWxsYmFja0lkLAogICAgICAgICAgICByZWFzb246IHdyYXBSZWFzb24ocmVhc29uKQogICAgICAgICAgfSk7CiAgICAgICAgfSk7CiAgICAgICAgcmV0dXJuOwogICAgICB9CiAgICAgIGlmIChkYXRhLnN0cmVhbUlkKSB7CiAgICAgICAgdGhpcy4jY3JlYXRlU3RyZWFtU2luayhkYXRhKTsKICAgICAgICByZXR1cm47CiAgICAgIH0KICAgICAgYWN0aW9uKGRhdGEuZGF0YSk7CiAgICB9OwogICAgY29tT2JqLmFkZEV2ZW50TGlzdGVuZXIoIm1lc3NhZ2UiLCB0aGlzLl9vbkNvbU9iak9uTWVzc2FnZSk7CiAgfQogIG9uKGFjdGlvbk5hbWUsIGhhbmRsZXIpIHsKICAgIGNvbnN0IGFoID0gdGhpcy5hY3Rpb25IYW5kbGVyOwogICAgaWYgKGFoW2FjdGlvbk5hbWVdKSB7CiAgICAgIHRocm93IG5ldyBFcnJvcihgVGhlcmUgaXMgYWxyZWFkeSBhbiBhY3Rpb25OYW1lIGNhbGxlZCAiJHthY3Rpb25OYW1lfSJgKTsKICAgIH0KICAgIGFoW2FjdGlvbk5hbWVdID0gaGFuZGxlcjsKICB9CiAgc2VuZChhY3Rpb25OYW1lLCBkYXRhLCB0cmFuc2ZlcnMpIHsKICAgIHRoaXMuY29tT2JqLnBvc3RNZXNzYWdlKHsKICAgICAgc291cmNlTmFtZTogdGhpcy5zb3VyY2VOYW1lLAogICAgICB0YXJnZXROYW1lOiB0aGlzLnRhcmdldE5hbWUsCiAgICAgIGFjdGlvbjogYWN0aW9uTmFtZSwKICAgICAgZGF0YQogICAgfSwgdHJhbnNmZXJzKTsKICB9CiAgc2VuZFdpdGhQcm9taXNlKGFjdGlvbk5hbWUsIGRhdGEsIHRyYW5zZmVycykgewogICAgY29uc3QgY2FsbGJhY2tJZCA9IHRoaXMuY2FsbGJhY2tJZCsrOwogICAgY29uc3QgY2FwYWJpbGl0eSA9IG5ldyBfdXRpbC5Qcm9taXNlQ2FwYWJpbGl0eSgpOwogICAgdGhpcy5jYWxsYmFja0NhcGFiaWxpdGllc1tjYWxsYmFja0lkXSA9IGNhcGFiaWxpdHk7CiAgICB0cnkgewogICAgICB0aGlzLmNvbU9iai5wb3N0TWVzc2FnZSh7CiAgICAgICAgc291cmNlTmFtZTogdGhpcy5zb3VyY2VOYW1lLAogICAgICAgIHRhcmdldE5hbWU6IHRoaXMudGFyZ2V0TmFtZSwKICAgICAgICBhY3Rpb246IGFjdGlvbk5hbWUsCiAgICAgICAgY2FsbGJhY2tJZCwKICAgICAgICBkYXRhCiAgICAgIH0sIHRyYW5zZmVycyk7CiAgICB9IGNhdGNoIChleCkgewogICAgICBjYXBhYmlsaXR5LnJlamVjdChleCk7CiAgICB9CiAgICByZXR1cm4gY2FwYWJpbGl0eS5wcm9taXNlOwogIH0KICBzZW5kV2l0aFN0cmVhbShhY3Rpb25OYW1lLCBkYXRhLCBxdWV1ZWluZ1N0cmF0ZWd5LCB0cmFuc2ZlcnMpIHsKICAgIGNvbnN0IHN0cmVhbUlkID0gdGhpcy5zdHJlYW1JZCsrLAogICAgICBzb3VyY2VOYW1lID0gdGhpcy5zb3VyY2VOYW1lLAogICAgICB0YXJnZXROYW1lID0gdGhpcy50YXJnZXROYW1lLAogICAgICBjb21PYmogPSB0aGlzLmNvbU9iajsKICAgIHJldHVybiBuZXcgUmVhZGFibGVTdHJlYW0oewogICAgICBzdGFydDogY29udHJvbGxlciA9PiB7CiAgICAgICAgY29uc3Qgc3RhcnRDYXBhYmlsaXR5ID0gbmV3IF91dGlsLlByb21pc2VDYXBhYmlsaXR5KCk7CiAgICAgICAgdGhpcy5zdHJlYW1Db250cm9sbGVyc1tzdHJlYW1JZF0gPSB7CiAgICAgICAgICBjb250cm9sbGVyLAogICAgICAgICAgc3RhcnRDYWxsOiBzdGFydENhcGFiaWxpdHksCiAgICAgICAgICBwdWxsQ2FsbDogbnVsbCwKICAgICAgICAgIGNhbmNlbENhbGw6IG51bGwsCiAgICAgICAgICBpc0Nsb3NlZDogZmFsc2UKICAgICAgICB9OwogICAgICAgIGNvbU9iai5wb3N0TWVzc2FnZSh7CiAgICAgICAgICBzb3VyY2VOYW1lLAogICAgICAgICAgdGFyZ2V0TmFtZSwKICAgICAgICAgIGFjdGlvbjogYWN0aW9uTmFtZSwKICAgICAgICAgIHN0cmVhbUlkLAogICAgICAgICAgZGF0YSwKICAgICAgICAgIGRlc2lyZWRTaXplOiBjb250cm9sbGVyLmRlc2lyZWRTaXplCiAgICAgICAgfSwgdHJhbnNmZXJzKTsKICAgICAgICByZXR1cm4gc3RhcnRDYXBhYmlsaXR5LnByb21pc2U7CiAgICAgIH0sCiAgICAgIHB1bGw6IGNvbnRyb2xsZXIgPT4gewogICAgICAgIGNvbnN0IHB1bGxDYXBhYmlsaXR5ID0gbmV3IF91dGlsLlByb21pc2VDYXBhYmlsaXR5KCk7CiAgICAgICAgdGhpcy5zdHJlYW1Db250cm9sbGVyc1tzdHJlYW1JZF0ucHVsbENhbGwgPSBwdWxsQ2FwYWJpbGl0eTsKICAgICAgICBjb21PYmoucG9zdE1lc3NhZ2UoewogICAgICAgICAgc291cmNlTmFtZSwKICAgICAgICAgIHRhcmdldE5hbWUsCiAgICAgICAgICBzdHJlYW06IFN0cmVhbUtpbmQuUFVMTCwKICAgICAgICAgIHN0cmVhbUlkLAogICAgICAgICAgZGVzaXJlZFNpemU6IGNvbnRyb2xsZXIuZGVzaXJlZFNpemUKICAgICAgICB9KTsKICAgICAgICByZXR1cm4gcHVsbENhcGFiaWxpdHkucHJvbWlzZTsKICAgICAgfSwKICAgICAgY2FuY2VsOiByZWFzb24gPT4gewogICAgICAgICgwLCBfdXRpbC5hc3NlcnQpKHJlYXNvbiBpbnN0YW5jZW9mIEVycm9yLCAiY2FuY2VsIG11c3QgaGF2ZSBhIHZhbGlkIHJlYXNvbiIpOwogICAgICAgIGNvbnN0IGNhbmNlbENhcGFiaWxpdHkgPSBuZXcgX3V0aWwuUHJvbWlzZUNhcGFiaWxpdHkoKTsKICAgICAgICB0aGlzLnN0cmVhbUNvbnRyb2xsZXJzW3N0cmVhbUlkXS5jYW5jZWxDYWxsID0gY2FuY2VsQ2FwYWJpbGl0eTsKICAgICAgICB0aGlzLnN0cmVhbUNvbnRyb2xsZXJzW3N0cmVhbUlkXS5pc0Nsb3NlZCA9IHRydWU7CiAgICAgICAgY29tT2JqLnBvc3RNZXNzYWdlKHsKICAgICAgICAgIHNvdXJjZU5hbWUsCiAgICAgICAgICB0YXJnZXROYW1lLAogICAgICAgICAgc3RyZWFtOiBTdHJlYW1LaW5kLkNBTkNFTCwKICAgICAgICAgIHN0cmVhbUlkLAogICAgICAgICAgcmVhc29uOiB3cmFwUmVhc29uKHJlYXNvbikKICAgICAgICB9KTsKICAgICAgICByZXR1cm4gY2FuY2VsQ2FwYWJpbGl0eS5wcm9taXNlOwogICAgICB9CiAgICB9LCBxdWV1ZWluZ1N0cmF0ZWd5KTsKICB9CiAgI2NyZWF0ZVN0cmVhbVNpbmsoZGF0YSkgewogICAgY29uc3Qgc3RyZWFtSWQgPSBkYXRhLnN0cmVhbUlkLAogICAgICBzb3VyY2VOYW1lID0gdGhpcy5zb3VyY2VOYW1lLAogICAgICB0YXJnZXROYW1lID0gZGF0YS5zb3VyY2VOYW1lLAogICAgICBjb21PYmogPSB0aGlzLmNvbU9iajsKICAgIGNvbnN0IHNlbGYgPSB0aGlzLAogICAgICBhY3Rpb24gPSB0aGlzLmFjdGlvbkhhbmRsZXJbZGF0YS5hY3Rpb25dOwogICAgY29uc3Qgc3RyZWFtU2luayA9IHsKICAgICAgZW5xdWV1ZShjaHVuaywgc2l6ZSA9IDEsIHRyYW5zZmVycykgewogICAgICAgIGlmICh0aGlzLmlzQ2FuY2VsbGVkKSB7CiAgICAgICAgICByZXR1cm47CiAgICAgICAgfQogICAgICAgIGNvbnN0IGxhc3REZXNpcmVkU2l6ZSA9IHRoaXMuZGVzaXJlZFNpemU7CiAgICAgICAgdGhpcy5kZXNpcmVkU2l6ZSAtPSBzaXplOwogICAgICAgIGlmIChsYXN0RGVzaXJlZFNpemUgPiAwICYmIHRoaXMuZGVzaXJlZFNpemUgPD0gMCkgewogICAgICAgICAgdGhpcy5zaW5rQ2FwYWJpbGl0eSA9IG5ldyBfdXRpbC5Qcm9taXNlQ2FwYWJpbGl0eSgpOwogICAgICAgICAgdGhpcy5yZWFkeSA9IHRoaXMuc2lua0NhcGFiaWxpdHkucHJvbWlzZTsKICAgICAgICB9CiAgICAgICAgY29tT2JqLnBvc3RNZXNzYWdlKHsKICAgICAgICAgIHNvdXJjZU5hbWUsCiAgICAgICAgICB0YXJnZXROYW1lLAogICAgICAgICAgc3RyZWFtOiBTdHJlYW1LaW5kLkVOUVVFVUUsCiAgICAgICAgICBzdHJlYW1JZCwKICAgICAgICAgIGNodW5rCiAgICAgICAgfSwgdHJhbnNmZXJzKTsKICAgICAgfSwKICAgICAgY2xvc2UoKSB7CiAgICAgICAgaWYgKHRoaXMuaXNDYW5jZWxsZWQpIHsKICAgICAgICAgIHJldHVybjsKICAgICAgICB9CiAgICAgICAgdGhpcy5pc0NhbmNlbGxlZCA9IHRydWU7CiAgICAgICAgY29tT2JqLnBvc3RNZXNzYWdlKHsKICAgICAgICAgIHNvdXJjZU5hbWUsCiAgICAgICAgICB0YXJnZXROYW1lLAogICAgICAgICAgc3RyZWFtOiBTdHJlYW1LaW5kLkNMT1NFLAogICAgICAgICAgc3RyZWFtSWQKICAgICAgICB9KTsKICAgICAgICBkZWxldGUgc2VsZi5zdHJlYW1TaW5rc1tzdHJlYW1JZF07CiAgICAgIH0sCiAgICAgIGVycm9yKHJlYXNvbikgewogICAgICAgICgwLCBfdXRpbC5hc3NlcnQpKHJlYXNvbiBpbnN0YW5jZW9mIEVycm9yLCAiZXJyb3IgbXVzdCBoYXZlIGEgdmFsaWQgcmVhc29uIik7CiAgICAgICAgaWYgKHRoaXMuaXNDYW5jZWxsZWQpIHsKICAgICAgICAgIHJldHVybjsKICAgICAgICB9CiAgICAgICAgdGhpcy5pc0NhbmNlbGxlZCA9IHRydWU7CiAgICAgICAgY29tT2JqLnBvc3RNZXNzYWdlKHsKICAgICAgICAgIHNvdXJjZU5hbWUsCiAgICAgICAgICB0YXJnZXROYW1lLAogICAgICAgICAgc3RyZWFtOiBTdHJlYW1LaW5kLkVSUk9SLAogICAgICAgICAgc3RyZWFtSWQsCiAgICAgICAgICByZWFzb246IHdyYXBSZWFzb24ocmVhc29uKQogICAgICAgIH0pOwogICAgICB9LAogICAgICBzaW5rQ2FwYWJpbGl0eTogbmV3IF91dGlsLlByb21pc2VDYXBhYmlsaXR5KCksCiAgICAgIG9uUHVsbDogbnVsbCwKICAgICAgb25DYW5jZWw6IG51bGwsCiAgICAgIGlzQ2FuY2VsbGVkOiBmYWxzZSwKICAgICAgZGVzaXJlZFNpemU6IGRhdGEuZGVzaXJlZFNpemUsCiAgICAgIHJlYWR5OiBudWxsCiAgICB9OwogICAgc3RyZWFtU2luay5zaW5rQ2FwYWJpbGl0eS5yZXNvbHZlKCk7CiAgICBzdHJlYW1TaW5rLnJlYWR5ID0gc3RyZWFtU2luay5zaW5rQ2FwYWJpbGl0eS5wcm9taXNlOwogICAgdGhpcy5zdHJlYW1TaW5rc1tzdHJlYW1JZF0gPSBzdHJlYW1TaW5rOwogICAgbmV3IFByb21pc2UoZnVuY3Rpb24gKHJlc29sdmUpIHsKICAgICAgcmVzb2x2ZShhY3Rpb24oZGF0YS5kYXRhLCBzdHJlYW1TaW5rKSk7CiAgICB9KS50aGVuKGZ1bmN0aW9uICgpIHsKICAgICAgY29tT2JqLnBvc3RNZXNzYWdlKHsKICAgICAgICBzb3VyY2VOYW1lLAogICAgICAgIHRhcmdldE5hbWUsCiAgICAgICAgc3RyZWFtOiBTdHJlYW1LaW5kLlNUQVJUX0NPTVBMRVRFLAogICAgICAgIHN0cmVhbUlkLAogICAgICAgIHN1Y2Nlc3M6IHRydWUKICAgICAgfSk7CiAgICB9LCBmdW5jdGlvbiAocmVhc29uKSB7CiAgICAgIGNvbU9iai5wb3N0TWVzc2FnZSh7CiAgICAgICAgc291cmNlTmFtZSwKICAgICAgICB0YXJnZXROYW1lLAogICAgICAgIHN0cmVhbTogU3RyZWFtS2luZC5TVEFSVF9DT01QTEVURSwKICAgICAgICBzdHJlYW1JZCwKICAgICAgICByZWFzb246IHdyYXBSZWFzb24ocmVhc29uKQogICAgICB9KTsKICAgIH0pOwogIH0KICAjcHJvY2Vzc1N0cmVhbU1lc3NhZ2UoZGF0YSkgewogICAgY29uc3Qgc3RyZWFtSWQgPSBkYXRhLnN0cmVhbUlkLAogICAgICBzb3VyY2VOYW1lID0gdGhpcy5zb3VyY2VOYW1lLAogICAgICB0YXJnZXROYW1lID0gZGF0YS5zb3VyY2VOYW1lLAogICAgICBjb21PYmogPSB0aGlzLmNvbU9iajsKICAgIGNvbnN0IHN0cmVhbUNvbnRyb2xsZXIgPSB0aGlzLnN0cmVhbUNvbnRyb2xsZXJzW3N0cmVhbUlkXSwKICAgICAgc3RyZWFtU2luayA9IHRoaXMuc3RyZWFtU2lua3Nbc3RyZWFtSWRdOwogICAgc3dpdGNoIChkYXRhLnN0cmVhbSkgewogICAgICBjYXNlIFN0cmVhbUtpbmQuU1RBUlRfQ09NUExFVEU6CiAgICAgICAgaWYgKGRhdGEuc3VjY2VzcykgewogICAgICAgICAgc3RyZWFtQ29udHJvbGxlci5zdGFydENhbGwucmVzb2x2ZSgpOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICBzdHJlYW1Db250cm9sbGVyLnN0YXJ0Q2FsbC5yZWplY3Qod3JhcFJlYXNvbihkYXRhLnJlYXNvbikpOwogICAgICAgIH0KICAgICAgICBicmVhazsKICAgICAgY2FzZSBTdHJlYW1LaW5kLlBVTExfQ09NUExFVEU6CiAgICAgICAgaWYgKGRhdGEuc3VjY2VzcykgewogICAgICAgICAgc3RyZWFtQ29udHJvbGxlci5wdWxsQ2FsbC5yZXNvbHZlKCk7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIHN0cmVhbUNvbnRyb2xsZXIucHVsbENhbGwucmVqZWN0KHdyYXBSZWFzb24oZGF0YS5yZWFzb24pKTsKICAgICAgICB9CiAgICAgICAgYnJlYWs7CiAgICAgIGNhc2UgU3RyZWFtS2luZC5QVUxMOgogICAgICAgIGlmICghc3RyZWFtU2luaykgewogICAgICAgICAgY29tT2JqLnBvc3RNZXNzYWdlKHsKICAgICAgICAgICAgc291cmNlTmFtZSwKICAgICAgICAgICAgdGFyZ2V0TmFtZSwKICAgICAgICAgICAgc3RyZWFtOiBTdHJlYW1LaW5kLlBVTExfQ09NUExFVEUsCiAgICAgICAgICAgIHN0cmVhbUlkLAogICAgICAgICAgICBzdWNjZXNzOiB0cnVlCiAgICAgICAgICB9KTsKICAgICAgICAgIGJyZWFrOwogICAgICAgIH0KICAgICAgICBpZiAoc3RyZWFtU2luay5kZXNpcmVkU2l6ZSA8PSAwICYmIGRhdGEuZGVzaXJlZFNpemUgPiAwKSB7CiAgICAgICAgICBzdHJlYW1TaW5rLnNpbmtDYXBhYmlsaXR5LnJlc29sdmUoKTsKICAgICAgICB9CiAgICAgICAgc3RyZWFtU2luay5kZXNpcmVkU2l6ZSA9IGRhdGEuZGVzaXJlZFNpemU7CiAgICAgICAgbmV3IFByb21pc2UoZnVuY3Rpb24gKHJlc29sdmUpIHsKICAgICAgICAgIHJlc29sdmUoc3RyZWFtU2luay5vblB1bGw/LigpKTsKICAgICAgICB9KS50aGVuKGZ1bmN0aW9uICgpIHsKICAgICAgICAgIGNvbU9iai5wb3N0TWVzc2FnZSh7CiAgICAgICAgICAgIHNvdXJjZU5hbWUsCiAgICAgICAgICAgIHRhcmdldE5hbWUsCiAgICAgICAgICAgIHN0cmVhbTogU3RyZWFtS2luZC5QVUxMX0NPTVBMRVRFLAogICAgICAgICAgICBzdHJlYW1JZCwKICAgICAgICAgICAgc3VjY2VzczogdHJ1ZQogICAgICAgICAgfSk7CiAgICAgICAgfSwgZnVuY3Rpb24gKHJlYXNvbikgewogICAgICAgICAgY29tT2JqLnBvc3RNZXNzYWdlKHsKICAgICAgICAgICAgc291cmNlTmFtZSwKICAgICAgICAgICAgdGFyZ2V0TmFtZSwKICAgICAgICAgICAgc3RyZWFtOiBTdHJlYW1LaW5kLlBVTExfQ09NUExFVEUsCiAgICAgICAgICAgIHN0cmVhbUlkLAogICAgICAgICAgICByZWFzb246IHdyYXBSZWFzb24ocmVhc29uKQogICAgICAgICAgfSk7CiAgICAgICAgfSk7CiAgICAgICAgYnJlYWs7CiAgICAgIGNhc2UgU3RyZWFtS2luZC5FTlFVRVVFOgogICAgICAgICgwLCBfdXRpbC5hc3NlcnQpKHN0cmVhbUNvbnRyb2xsZXIsICJlbnF1ZXVlIHNob3VsZCBoYXZlIHN0cmVhbSBjb250cm9sbGVyIik7CiAgICAgICAgaWYgKHN0cmVhbUNvbnRyb2xsZXIuaXNDbG9zZWQpIHsKICAgICAgICAgIGJyZWFrOwogICAgICAgIH0KICAgICAgICBzdHJlYW1Db250cm9sbGVyLmNvbnRyb2xsZXIuZW5xdWV1ZShkYXRhLmNodW5rKTsKICAgICAgICBicmVhazsKICAgICAgY2FzZSBTdHJlYW1LaW5kLkNMT1NFOgogICAgICAgICgwLCBfdXRpbC5hc3NlcnQpKHN0cmVhbUNvbnRyb2xsZXIsICJjbG9zZSBzaG91bGQgaGF2ZSBzdHJlYW0gY29udHJvbGxlciIpOwogICAgICAgIGlmIChzdHJlYW1Db250cm9sbGVyLmlzQ2xvc2VkKSB7CiAgICAgICAgICBicmVhazsKICAgICAgICB9CiAgICAgICAgc3RyZWFtQ29udHJvbGxlci5pc0Nsb3NlZCA9IHRydWU7CiAgICAgICAgc3RyZWFtQ29udHJvbGxlci5jb250cm9sbGVyLmNsb3NlKCk7CiAgICAgICAgdGhpcy4jZGVsZXRlU3RyZWFtQ29udHJvbGxlcihzdHJlYW1Db250cm9sbGVyLCBzdHJlYW1JZCk7CiAgICAgICAgYnJlYWs7CiAgICAgIGNhc2UgU3RyZWFtS2luZC5FUlJPUjoKICAgICAgICAoMCwgX3V0aWwuYXNzZXJ0KShzdHJlYW1Db250cm9sbGVyLCAiZXJyb3Igc2hvdWxkIGhhdmUgc3RyZWFtIGNvbnRyb2xsZXIiKTsKICAgICAgICBzdHJlYW1Db250cm9sbGVyLmNvbnRyb2xsZXIuZXJyb3Iod3JhcFJlYXNvbihkYXRhLnJlYXNvbikpOwogICAgICAgIHRoaXMuI2RlbGV0ZVN0cmVhbUNvbnRyb2xsZXIoc3RyZWFtQ29udHJvbGxlciwgc3RyZWFtSWQpOwogICAgICAgIGJyZWFrOwogICAgICBjYXNlIFN0cmVhbUtpbmQuQ0FOQ0VMX0NPTVBMRVRFOgogICAgICAgIGlmIChkYXRhLnN1Y2Nlc3MpIHsKICAgICAgICAgIHN0cmVhbUNvbnRyb2xsZXIuY2FuY2VsQ2FsbC5yZXNvbHZlKCk7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIHN0cmVhbUNvbnRyb2xsZXIuY2FuY2VsQ2FsbC5yZWplY3Qod3JhcFJlYXNvbihkYXRhLnJlYXNvbikpOwogICAgICAgIH0KICAgICAgICB0aGlzLiNkZWxldGVTdHJlYW1Db250cm9sbGVyKHN0cmVhbUNvbnRyb2xsZXIsIHN0cmVhbUlkKTsKICAgICAgICBicmVhazsKICAgICAgY2FzZSBTdHJlYW1LaW5kLkNBTkNFTDoKICAgICAgICBpZiAoIXN0cmVhbVNpbmspIHsKICAgICAgICAgIGJyZWFrOwogICAgICAgIH0KICAgICAgICBuZXcgUHJvbWlzZShmdW5jdGlvbiAocmVzb2x2ZSkgewogICAgICAgICAgcmVzb2x2ZShzdHJlYW1TaW5rLm9uQ2FuY2VsPy4od3JhcFJlYXNvbihkYXRhLnJlYXNvbikpKTsKICAgICAgICB9KS50aGVuKGZ1bmN0aW9uICgpIHsKICAgICAgICAgIGNvbU9iai5wb3N0TWVzc2FnZSh7CiAgICAgICAgICAgIHNvdXJjZU5hbWUsCiAgICAgICAgICAgIHRhcmdldE5hbWUsCiAgICAgICAgICAgIHN0cmVhbTogU3RyZWFtS2luZC5DQU5DRUxfQ09NUExFVEUsCiAgICAgICAgICAgIHN0cmVhbUlkLAogICAgICAgICAgICBzdWNjZXNzOiB0cnVlCiAgICAgICAgICB9KTsKICAgICAgICB9LCBmdW5jdGlvbiAocmVhc29uKSB7CiAgICAgICAgICBjb21PYmoucG9zdE1lc3NhZ2UoewogICAgICAgICAgICBzb3VyY2VOYW1lLAogICAgICAgICAgICB0YXJnZXROYW1lLAogICAgICAgICAgICBzdHJlYW06IFN0cmVhbUtpbmQuQ0FOQ0VMX0NPTVBMRVRFLAogICAgICAgICAgICBzdHJlYW1JZCwKICAgICAgICAgICAgcmVhc29uOiB3cmFwUmVhc29uKHJlYXNvbikKICAgICAgICAgIH0pOwogICAgICAgIH0pOwogICAgICAgIHN0cmVhbVNpbmsuc2lua0NhcGFiaWxpdHkucmVqZWN0KHdyYXBSZWFzb24oZGF0YS5yZWFzb24pKTsKICAgICAgICBzdHJlYW1TaW5rLmlzQ2FuY2VsbGVkID0gdHJ1ZTsKICAgICAgICBkZWxldGUgdGhpcy5zdHJlYW1TaW5rc1tzdHJlYW1JZF07CiAgICAgICAgYnJlYWs7CiAgICAgIGRlZmF1bHQ6CiAgICAgICAgdGhyb3cgbmV3IEVycm9yKCJVbmV4cGVjdGVkIHN0cmVhbSBjYXNlIik7CiAgICB9CiAgfQogIGFzeW5jICNkZWxldGVTdHJlYW1Db250cm9sbGVyKHN0cmVhbUNvbnRyb2xsZXIsIHN0cmVhbUlkKSB7CiAgICBhd2FpdCBQcm9taXNlLmFsbFNldHRsZWQoW3N0cmVhbUNvbnRyb2xsZXIuc3RhcnRDYWxsPy5wcm9taXNlLCBzdHJlYW1Db250cm9sbGVyLnB1bGxDYWxsPy5wcm9taXNlLCBzdHJlYW1Db250cm9sbGVyLmNhbmNlbENhbGw/LnByb21pc2VdKTsKICAgIGRlbGV0ZSB0aGlzLnN0cmVhbUNvbnRyb2xsZXJzW3N0cmVhbUlkXTsKICB9CiAgZGVzdHJveSgpIHsKICAgIHRoaXMuY29tT2JqLnJlbW92ZUV2ZW50TGlzdGVuZXIoIm1lc3NhZ2UiLCB0aGlzLl9vbkNvbU9iak9uTWVzc2FnZSk7CiAgfQp9CmV4cG9ydHMuTWVzc2FnZUhhbmRsZXIgPSBNZXNzYWdlSGFuZGxlcjsKCi8qKiovIH0pLAovKiAxMDUgKi8KLyoqKi8gKChfX3VudXNlZF93ZWJwYWNrX21vZHVsZSwgZXhwb3J0cywgX193X3BkZmpzX3JlcXVpcmVfXykgPT4gewoKCgpPYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgIl9fZXNNb2R1bGUiLCAoewogIHZhbHVlOiB0cnVlCn0pKTsKZXhwb3J0cy5QREZXb3JrZXJTdHJlYW0gPSB2b2lkIDA7CnZhciBfdXRpbCA9IF9fd19wZGZqc19yZXF1aXJlX18oMik7CmNsYXNzIFBERldvcmtlclN0cmVhbSB7CiAgY29uc3RydWN0b3IobXNnSGFuZGxlcikgewogICAgdGhpcy5fbXNnSGFuZGxlciA9IG1zZ0hhbmRsZXI7CiAgICB0aGlzLl9jb250ZW50TGVuZ3RoID0gbnVsbDsKICAgIHRoaXMuX2Z1bGxSZXF1ZXN0UmVhZGVyID0gbnVsbDsKICAgIHRoaXMuX3JhbmdlUmVxdWVzdFJlYWRlcnMgPSBbXTsKICB9CiAgZ2V0RnVsbFJlYWRlcigpIHsKICAgICgwLCBfdXRpbC5hc3NlcnQpKCF0aGlzLl9mdWxsUmVxdWVzdFJlYWRlciwgIlBERldvcmtlclN0cmVhbS5nZXRGdWxsUmVhZGVyIGNhbiBvbmx5IGJlIGNhbGxlZCBvbmNlLiIpOwogICAgdGhpcy5fZnVsbFJlcXVlc3RSZWFkZXIgPSBuZXcgUERGV29ya2VyU3RyZWFtUmVhZGVyKHRoaXMuX21zZ0hhbmRsZXIpOwogICAgcmV0dXJuIHRoaXMuX2Z1bGxSZXF1ZXN0UmVhZGVyOwogIH0KICBnZXRSYW5nZVJlYWRlcihiZWdpbiwgZW5kKSB7CiAgICBjb25zdCByZWFkZXIgPSBuZXcgUERGV29ya2VyU3RyZWFtUmFuZ2VSZWFkZXIoYmVnaW4sIGVuZCwgdGhpcy5fbXNnSGFuZGxlcik7CiAgICB0aGlzLl9yYW5nZVJlcXVlc3RSZWFkZXJzLnB1c2gocmVhZGVyKTsKICAgIHJldHVybiByZWFkZXI7CiAgfQogIGNhbmNlbEFsbFJlcXVlc3RzKHJlYXNvbikgewogICAgdGhpcy5fZnVsbFJlcXVlc3RSZWFkZXI/LmNhbmNlbChyZWFzb24pOwogICAgZm9yIChjb25zdCByZWFkZXIgb2YgdGhpcy5fcmFuZ2VSZXF1ZXN0UmVhZGVycy5zbGljZSgwKSkgewogICAgICByZWFkZXIuY2FuY2VsKHJlYXNvbik7CiAgICB9CiAgfQp9CmV4cG9ydHMuUERGV29ya2VyU3RyZWFtID0gUERGV29ya2VyU3RyZWFtOwpjbGFzcyBQREZXb3JrZXJTdHJlYW1SZWFkZXIgewogIGNvbnN0cnVjdG9yKG1zZ0hhbmRsZXIpIHsKICAgIHRoaXMuX21zZ0hhbmRsZXIgPSBtc2dIYW5kbGVyOwogICAgdGhpcy5vblByb2dyZXNzID0gbnVsbDsKICAgIHRoaXMuX2NvbnRlbnRMZW5ndGggPSBudWxsOwogICAgdGhpcy5faXNSYW5nZVN1cHBvcnRlZCA9IGZhbHNlOwogICAgdGhpcy5faXNTdHJlYW1pbmdTdXBwb3J0ZWQgPSBmYWxzZTsKICAgIGNvbnN0IHJlYWRhYmxlU3RyZWFtID0gdGhpcy5fbXNnSGFuZGxlci5zZW5kV2l0aFN0cmVhbSgiR2V0UmVhZGVyIik7CiAgICB0aGlzLl9yZWFkZXIgPSByZWFkYWJsZVN0cmVhbS5nZXRSZWFkZXIoKTsKICAgIHRoaXMuX2hlYWRlcnNSZWFkeSA9IHRoaXMuX21zZ0hhbmRsZXIuc2VuZFdpdGhQcm9taXNlKCJSZWFkZXJIZWFkZXJzUmVhZHkiKS50aGVuKGRhdGEgPT4gewogICAgICB0aGlzLl9pc1N0cmVhbWluZ1N1cHBvcnRlZCA9IGRhdGEuaXNTdHJlYW1pbmdTdXBwb3J0ZWQ7CiAgICAgIHRoaXMuX2lzUmFuZ2VTdXBwb3J0ZWQgPSBkYXRhLmlzUmFuZ2VTdXBwb3J0ZWQ7CiAgICAgIHRoaXMuX2NvbnRlbnRMZW5ndGggPSBkYXRhLmNvbnRlbnRMZW5ndGg7CiAgICB9KTsKICB9CiAgZ2V0IGhlYWRlcnNSZWFkeSgpIHsKICAgIHJldHVybiB0aGlzLl9oZWFkZXJzUmVhZHk7CiAgfQogIGdldCBjb250ZW50TGVuZ3RoKCkgewogICAgcmV0dXJuIHRoaXMuX2NvbnRlbnRMZW5ndGg7CiAgfQogIGdldCBpc1N0cmVhbWluZ1N1cHBvcnRlZCgpIHsKICAgIHJldHVybiB0aGlzLl9pc1N0cmVhbWluZ1N1cHBvcnRlZDsKICB9CiAgZ2V0IGlzUmFuZ2VTdXBwb3J0ZWQoKSB7CiAgICByZXR1cm4gdGhpcy5faXNSYW5nZVN1cHBvcnRlZDsKICB9CiAgYXN5bmMgcmVhZCgpIHsKICAgIGNvbnN0IHsKICAgICAgdmFsdWUsCiAgICAgIGRvbmUKICAgIH0gPSBhd2FpdCB0aGlzLl9yZWFkZXIucmVhZCgpOwogICAgaWYgKGRvbmUpIHsKICAgICAgcmV0dXJuIHsKICAgICAgICB2YWx1ZTogdW5kZWZpbmVkLAogICAgICAgIGRvbmU6IHRydWUKICAgICAgfTsKICAgIH0KICAgIHJldHVybiB7CiAgICAgIHZhbHVlOiB2YWx1ZS5idWZmZXIsCiAgICAgIGRvbmU6IGZhbHNlCiAgICB9OwogIH0KICBjYW5jZWwocmVhc29uKSB7CiAgICB0aGlzLl9yZWFkZXIuY2FuY2VsKHJlYXNvbik7CiAgfQp9CmNsYXNzIFBERldvcmtlclN0cmVhbVJhbmdlUmVhZGVyIHsKICBjb25zdHJ1Y3RvcihiZWdpbiwgZW5kLCBtc2dIYW5kbGVyKSB7CiAgICB0aGlzLl9tc2dIYW5kbGVyID0gbXNnSGFuZGxlcjsKICAgIHRoaXMub25Qcm9ncmVzcyA9IG51bGw7CiAgICBjb25zdCByZWFkYWJsZVN0cmVhbSA9IHRoaXMuX21zZ0hhbmRsZXIuc2VuZFdpdGhTdHJlYW0oIkdldFJhbmdlUmVhZGVyIiwgewogICAgICBiZWdpbiwKICAgICAgZW5kCiAgICB9KTsKICAgIHRoaXMuX3JlYWRlciA9IHJlYWRhYmxlU3RyZWFtLmdldFJlYWRlcigpOwogIH0KICBnZXQgaXNTdHJlYW1pbmdTdXBwb3J0ZWQoKSB7CiAgICByZXR1cm4gZmFsc2U7CiAgfQogIGFzeW5jIHJlYWQoKSB7CiAgICBjb25zdCB7CiAgICAgIHZhbHVlLAogICAgICBkb25lCiAgICB9ID0gYXdhaXQgdGhpcy5fcmVhZGVyLnJlYWQoKTsKICAgIGlmIChkb25lKSB7CiAgICAgIHJldHVybiB7CiAgICAgICAgdmFsdWU6IHVuZGVmaW5lZCwKICAgICAgICBkb25lOiB0cnVlCiAgICAgIH07CiAgICB9CiAgICByZXR1cm4gewogICAgICB2YWx1ZTogdmFsdWUuYnVmZmVyLAogICAgICBkb25lOiBmYWxzZQogICAgfTsKICB9CiAgY2FuY2VsKHJlYXNvbikgewogICAgdGhpcy5fcmVhZGVyLmNhbmNlbChyZWFzb24pOwogIH0KfQoKLyoqKi8gfSkKLyoqKioqKi8gCV0pOwovKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqLwovKioqKioqLyAJLy8gVGhlIG1vZHVsZSBjYWNoZQovKioqKioqLyAJdmFyIF9fd2VicGFja19tb2R1bGVfY2FjaGVfXyA9IHt9OwovKioqKioqLyAJCi8qKioqKiovIAkvLyBUaGUgcmVxdWlyZSBmdW5jdGlvbgovKioqKioqLyAJZnVuY3Rpb24gX193X3BkZmpzX3JlcXVpcmVfXyhtb2R1bGVJZCkgewovKioqKioqLyAJCS8vIENoZWNrIGlmIG1vZHVsZSBpcyBpbiBjYWNoZQovKioqKioqLyAJCXZhciBjYWNoZWRNb2R1bGUgPSBfX3dlYnBhY2tfbW9kdWxlX2NhY2hlX19bbW9kdWxlSWRdOwovKioqKioqLyAJCWlmIChjYWNoZWRNb2R1bGUgIT09IHVuZGVmaW5lZCkgewovKioqKioqLyAJCQlyZXR1cm4gY2FjaGVkTW9kdWxlLmV4cG9ydHM7Ci8qKioqKiovIAkJfQovKioqKioqLyAJCS8vIENyZWF0ZSBhIG5ldyBtb2R1bGUgKGFuZCBwdXQgaXQgaW50byB0aGUgY2FjaGUpCi8qKioqKiovIAkJdmFyIG1vZHVsZSA9IF9fd2VicGFja19tb2R1bGVfY2FjaGVfX1ttb2R1bGVJZF0gPSB7Ci8qKioqKiovIAkJCS8vIG5vIG1vZHVsZS5pZCBuZWVkZWQKLyoqKioqKi8gCQkJLy8gbm8gbW9kdWxlLmxvYWRlZCBuZWVkZWQKLyoqKioqKi8gCQkJZXhwb3J0czoge30KLyoqKioqKi8gCQl9OwovKioqKioqLyAJCi8qKioqKiovIAkJLy8gRXhlY3V0ZSB0aGUgbW9kdWxlIGZ1bmN0aW9uCi8qKioqKiovIAkJX193ZWJwYWNrX21vZHVsZXNfX1ttb2R1bGVJZF0obW9kdWxlLCBtb2R1bGUuZXhwb3J0cywgX193X3BkZmpzX3JlcXVpcmVfXyk7Ci8qKioqKiovIAkKLyoqKioqKi8gCQkvLyBSZXR1cm4gdGhlIGV4cG9ydHMgb2YgdGhlIG1vZHVsZQovKioqKioqLyAJCXJldHVybiBtb2R1bGUuZXhwb3J0czsKLyoqKioqKi8gCX0KLyoqKioqKi8gCQovKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqLwp2YXIgX193ZWJwYWNrX2V4cG9ydHNfXyA9IHt9OwovLyBUaGlzIGVudHJ5IG5lZWQgdG8gYmUgd3JhcHBlZCBpbiBhbiBJSUZFIGJlY2F1c2UgaXQgbmVlZCB0byBiZSBpc29sYXRlZCBhZ2FpbnN0IG90aGVyIG1vZHVsZXMgaW4gdGhlIGNodW5rLgooKCkgPT4gewp2YXIgZXhwb3J0cyA9IF9fd2VicGFja19leHBvcnRzX187CgoKT2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsICJfX2VzTW9kdWxlIiwgKHsKICB2YWx1ZTogdHJ1ZQp9KSk7Ck9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCAiV29ya2VyTWVzc2FnZUhhbmRsZXIiLCAoewogIGVudW1lcmFibGU6IHRydWUsCiAgZ2V0OiBmdW5jdGlvbiAoKSB7CiAgICByZXR1cm4gX3dvcmtlci5Xb3JrZXJNZXNzYWdlSGFuZGxlcjsKICB9Cn0pKTsKdmFyIF93b3JrZXIgPSBfX3dfcGRmanNfcmVxdWlyZV9fKDEpOwpjb25zdCBwZGZqc1ZlcnNpb24gPSAnMy4xMS4xNzQnOwpjb25zdCBwZGZqc0J1aWxkID0gJ2NlODcxNjc0Myc7Cn0pKCk7CgovKioqKioqLyAJcmV0dXJuIF9fd2VicGFja19leHBvcnRzX187Ci8qKioqKiovIH0pKCkKOwp9KTsKLy8jIHNvdXJjZU1hcHBpbmdVUkw9cGRmLndvcmtlci5qcy5tYXA=",_export_sfc=(wI,b)=>{const ZI=wI.__vccOpts||wI;for(const[G,R]of b)ZI[G]=R;return ZI},_hoisted_1$1={style:{"text-align":"center"}},_hoisted_2$1={style:{"margin-top":"1rem",display:"flex","align-items":"center","justify-content":"center",gap:"1rem"}},_hoisted_3$1=["disabled"],_hoisted_4$1=["disabled"],_sfc_main$2={__name:"SigningPad",props:{url:{type:String,required:!0}},setup(wI){pdfExports.GlobalWorkerOptions.workerSrc=pdfjsWorker;const b=wI,ZI=vue.ref(null),G=vue.ref(null),R=vue.ref(1),cI=vue.ref(0),U=async()=>{if(!G.value)return;const W=await G.value.getPage(R.value),z=W.getViewport({scale:1.5}),J=ZI.value,V=J.getContext("2d");J.width=z.width,J.height=z.height,await W.render({canvasContext:V,viewport:z}).promise},WI=async()=>{try{const W=pdfjsDist.getDocument(b.url);G.value=await W.promise,cI.value=G.value.numPages,await U()}catch(W){console.error("Error loading PDF:",W)}},L=()=>{R.value>1&&R.value--},e=()=>{R.value<cI.value&&R.value++};return vue.watch(()=>b.url,WI),vue.watch(R,U),vue.onMounted(WI),(W,z)=>(vue.openBlock(),vue.createElementBlock("div",_hoisted_1$1,[vue.createElementVNode("canvas",{ref_key:"canvasRef",ref:ZI},null,512),vue.createElementVNode("div",_hoisted_2$1,[vue.createElementVNode("button",{onClick:L,disabled:R.value<=1},"Previous",8,_hoisted_3$1),vue.createElementVNode("span",null,"Page "+vue.toDisplayString(R.value)+" of "+vue.toDisplayString(cI.value),1),vue.createElementVNode("button",{onClick:e,disabled:R.value>=cI.value},"Next",8,_hoisted_4$1)])]))}},SigningPad=_export_sfc(_sfc_main$2,[["__scopeId","data-v-45af899a"]]),_sfc_main$1={__name:"AuthForm",emits:["submit"],setup(wI,{emit:b}){const ZI=vue.ref(null),G=vue.ref(""),R=b,cI=()=>{if(!ZI.value){alert("Please select a ZIP file.");return}const U=new FormData;U.append("zip",ZI.value),U.append("password",G.value),R("submit",U)};return(U,WI)=>{const L=vue.resolveComponent("VFileInput"),e=vue.resolveComponent("VTextField"),W=vue.resolveComponent("VBtn"),z=vue.resolveComponent("VForm"),J=vue.resolveComponent("VCard");return vue.openBlock(),vue.createBlock(J,{class:"pa-6"},{default:vue.withCtx(()=>[WI[3]||(WI[3]=vue.createElementVNode("h3",{class:"mb-4"},"Upload ZIP File",-1)),vue.createVNode(z,{onSubmit:vue.withModifiers(cI,["prevent"])},{default:vue.withCtx(()=>[vue.createVNode(L,{label:"ZIP File",accept:".zip",onChange:WI[0]||(WI[0]=V=>ZI.value=V.target.files[0]),required:""}),vue.createVNode(e,{label:"Password",type:"password",modelValue:G.value,"onUpdate:modelValue":WI[1]||(WI[1]=V=>G.value=V),required:"",class:"mt-4"},null,8,["modelValue"]),vue.createVNode(W,{color:"primary",type:"submit",class:"mt-6"},{default:vue.withCtx(()=>WI[2]||(WI[2]=[vue.createTextVNode(" Upload ")])),_:1,__:[2]})]),_:1})]),_:1,__:[3]})}}},_hoisted_1={style:{"text-align":"center"}},_hoisted_2={style:{"margin-top":"1rem",display:"flex","align-items":"center","justify-content":"center",gap:"1rem"}},_hoisted_3=["disabled"],_hoisted_4=["disabled"],_sfc_main={__name:"PdfViewer",props:{url:{type:String,required:!0}},setup(wI){pdfExports.GlobalWorkerOptions.workerSrc=`https://unpkg.com/pdfjs-dist@${pdfExports.version}/build/pdf.worker.js`;const b=wI,ZI=vue.ref(null),G=vue.ref(null),R=vue.ref(1),cI=vue.ref(0),U=async()=>{if(!G.value)return;const W=await G.value.getPage(R.value),z=W.getViewport({scale:1.5}),J=ZI.value,V=J.getContext("2d");J.width=z.width,J.height=z.height,await W.render({canvasContext:V,viewport:z}).promise},WI=async()=>{try{const W=pdfExports.getDocument(b.url);G.value=await W.promise,cI.value=G.value.numPages,R.value=1,await U()}catch(W){console.error("Error loading PDF:",W)}},L=()=>{R.value>1&&R.value--},e=()=>{R.value<cI.value&&R.value++};return vue.watch(()=>b.url,WI),vue.watch(R,U),vue.onMounted(WI),(W,z)=>(vue.openBlock(),vue.createElementBlock("div",_hoisted_1,[vue.createElementVNode("canvas",{ref_key:"canvasRef",ref:ZI},null,512),vue.createElementVNode("div",_hoisted_2,[vue.createElementVNode("button",{onClick:L,disabled:R.value<=1},"Previous",8,_hoisted_3),vue.createElementVNode("span",null,"Page "+vue.toDisplayString(R.value)+" of "+vue.toDisplayString(cI.value),1),vue.createElementVNode("button",{onClick:e,disabled:R.value>=cI.value},"Next",8,_hoisted_4)])]))}},PdfViewer=_export_sfc(_sfc_main,[["__scopeId","data-v-10d43522"]]),components=Object.freeze(Object.defineProperty({__proto__:null,AuthForm:_sfc_main$1,SigningPad,UiPdfViewer:PdfViewer},Symbol.toStringTag,{value:"Module"})),index={install(wI){for(const b in components)wI.component(b,components[b])}};return index});
